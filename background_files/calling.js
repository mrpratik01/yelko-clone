"use strict";(self.webpackChunkskype4life=self.webpackChunkskype4life||[]).push([[789],{15602:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(94224),o=i(2278),s=i(80200),r=i(69840),l=i(11930),c=i(98278),d=i(77381),u=i(46096),h=i(36237),p=i(15877),g=i(33754),C=i(64723),m=i(93446),S=i(4735),y=i(29130),f=i(72425),_=i(86045),b=i(22222),T=i(81760),v=i(11010),w=i(11828),I=i(80837),P=i(90970),M=i(19675),k=i(53374),A=(0,p.lazyProperties)({commonTextStyle:()=>a.Styles.createTextStyle({textAlign:"center"}),headerStyle:()=>a.Styles.createTextStyle({color:T.Color.white,marginTop:20,marginBottom:10}),textStyleLightTheme:()=>a.Styles.createTextStyle({color:T.Color.gray300}),subTextStyle:()=>a.Styles.createTextStyle({paddingTop:5,color:T.Color.whiteOverlay70,maxWidth:360,marginBottom:20}),containerStyle:()=>a.Styles.createViewStyle({justifyContent:"flex-end",alignItems:"center",paddingBottom:180,backgroundColor:T.Color.blackOverlay20,paddingHorizontal:10}),containerStyleDesktopCallStage:()=>a.Styles.createViewStyle({paddingBottom:110,backgroundColor:T.Color.transparent}),containerStyleOnMobile:()=>a.Styles.createViewStyle({paddingBottom:80}),containerStyleOnMobileForPortraitMode:()=>a.Styles.createViewStyle({paddingBottom:100}),hyperLinkText:()=>a.Styles.createTextStyle({color:T.Color.blue}),hyperLinkStyle:()=>a.Styles.createTextStyle({marginTop:-15}),subTextContainer:()=>a.Styles.createTextStyle({alignItems:"center",justifyContent:"center",marginTop:-5})});class R extends d.default{constructor(){super(...arguments),this._onInviteButtonRef=e=>{this._shareInviteButtonRef=e||void 0},this._getShareInviteButtonRef=()=>this._shareInviteButtonRef,this._onShareInvitePress=e=>{this.state.joinLink?m.default.show({anchor:this._getShareInviteButtonRef,event:e,rootViewId:this._getRootViewId(),positionPriorities:["bottom","top"],threadId:this.props.conversationMri,joinLink:this.state.joinLink,meetNowParameters:{origin:C.MeetNowOrigin.MessageStream},allowJoiningLink:!0}):h.log(u.LogTraceArea.JoinLink,`AloneInTheCallInformationView._onShareInvitePress cannot show the menu because join link is not defined joinLink: ${this.state.joinLink}, threadId: ${this.props.conversationMri}`)},this._onHyperLinkPress=e=>{const t=k.default.newCauseId();h.log(u.LogTraceArea.CallingUI,"GoLiveInformationView._onHyperLinkPress, causeId: "+t),S.default.openCallRoster(this.props.conversationMri,this.props.callId,this._getContext()),P.default.createSession(this.props.callId,s.CallRosterOrigin.GoLiveInformationView,!1),o.default.updateCallTelemetry(this.props.callId,t,(e=>e.callRosterOpenedCount()))},this._onRingTheGroupButtonPress=()=>{f.default.handleRingTheGroup(this.props.conversationMri,this.props.callId);const e=g.getString("CallPanel.GroupCallRingingStatusMessage");a.Accessibility.announceForAccessibility(e),o.default.trackRingTheGroup(this.props.callId)},this._getHeaderText=()=>{switch(this.state.ringlessCallType){case f.LocallyStartedRinglessCallType.OnePerson:case f.LocallyStartedRinglessCallType.SmallGroup:return g.getString("CallPanel.GroupCallWithOnlyCallInitiatorMessage");case f.LocallyStartedRinglessCallType.LargeGroup:return g.getString("CallPanel.RinglessCallHeader");default:return}},this._getText=()=>{switch(this.state.ringlessCallType){case f.LocallyStartedRinglessCallType.OnePerson:return;case f.LocallyStartedRinglessCallType.SmallGroup:return this.state.hasRingingParticipants?g.getString("CallPanel.GroupCallRingingStatusMessage"):g.getString("CallPanel.GroupCallNotifiedTheGroupMessage");case f.LocallyStartedRinglessCallType.LargeGroup:return g.getString("CallPanel.RinglessCallDescription");default:return}}}_buildState(e,t){const i=n.default.CallingStore.hasRingingParticipants(e.callId,!0),a=n.default.CallingStore.isCallConnected(e.callId),o=f.default.getRinglessCallType(e.conversationMri,e.callId);return{isConvIconCentered:y.default.getHeight(this._getRootViewId())>700,hasRingingParticipants:i,isCallConnected:a,ringlessCallType:o,joinLink:o===f.LocallyStartedRinglessCallType.OnePerson?r.default.getLink(e.conversationMri):void 0}}componentDidMount(){super.componentDidMount(),this._announceForAccessibility()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),!this.state.hasRingingParticipants&&t.hasRingingParticipants&&this._announceForAccessibility()}render(){const e=this._getHeaderText(),t=a.createElement(a.Text,{style:this._getHeaderStyles()},e),i=this._renderSubText(),n=this._renderRingTheGroupButton(),o=this.state.ringlessCallType===f.LocallyStartedRinglessCallType.OnePerson?this._renderInviteButton():void 0;return a.createElement(a.View,{style:this._getContainerStyles(),ignorePointerEvents:!0},t,i,n,o)}_announceForAccessibility(){let e;e=this._isRingTheGroupAvailable()||this.state.ringlessCallType===f.LocallyStartedRinglessCallType.LargeGroup?this._getAdditionalScreenReaderText():this._getText();const t=l.default.combinedAccessibilityLabel(this._getHeaderText(),e);_.default.maybeAnnounceForAccessibility(t,100)}_renderInviteButton(){return a.createElement(b.default,{key:"invite",ref:this._onInviteButtonRef,buttonStyle:c.SXButtonStyle.BlueFill,title:g.getString("MeetNow.ShareInvite"),onPress:this._onShareInvitePress,buttonSize:c.SXButtonSize.Medium,iconSize:w.IconSize.size14,iconPositon:c.SXButtonIconPosition.End,disabled:!this.state.joinLink})}_renderRingTheGroupButton(){if(this._isRingTheGroupAvailable())return a.createElement(b.default,{buttonStyle:c.SXButtonStyle.BlueFill,buttonSize:c.SXButtonSize.Medium,title:g.getString("CallPanel.GroupCallRingTheGroupButtonTitle"),allowTextWrap:!0,onPress:this._onRingTheGroupButtonPress,disabled:!this.state.isCallConnected})}_renderSubText(){const e=this._getText();if(!e)return;if(this.state.ringlessCallType===f.LocallyStartedRinglessCallType.SmallGroup&&!this.state.hasRingingParticipants)return;const t=[A.subTextStyle,A.commonTextStyle,this.state.isConvIconCentered?v.default.fontStyle.messagingHeaderSmall:v.default.fontStyle.panelHeader,this.props.useLightTheme?A.textStyleLightTheme:void 0];return a.createElement(a.View,{style:A.subTextContainer},a.createElement(a.Text,{style:t},e),this._renderHyperLink())}_renderHyperLink(){if(this.state.ringlessCallType!==f.LocallyStartedRinglessCallType.LargeGroup)return;const e=[A.subTextStyle,A.commonTextStyle,A.hyperLinkText,this.state.isConvIconCentered?v.default.fontStyle.messagingHeaderSmall:v.default.fontStyle.panelHeader],t=g.getString("CallPanel.RinglessCallHyperLink");return a.createElement(a.Button,{onPress:this._onHyperLinkPress,style:A.hyperLinkStyle,accessibilityLabel:t},a.createElement(M.BodyText,{style:e},t))}_getAdditionalScreenReaderText(){return this.state.ringlessCallType===f.LocallyStartedRinglessCallType.LargeGroup?g.getString("CallPanel.RinglessCallHyperLinkScreenReaderText"):g.getString("CallPanel.GroupCallRingTheGroupButtonDescriptiveScreenReaderText")}_isRingTheGroupAvailable(){return!this.state.hasRingingParticipants&&this.state.ringlessCallType===f.LocallyStartedRinglessCallType.SmallGroup}_getContainerStyles(){const e=[A.containerStyle,I.default.absoluteFill];return this.props.useDesktopCallControls&&e.push(A.containerStyleDesktopCallStage),this.state.isConvIconCentered||this.props.callControlsType===s.CallControlsType.DesktopMinSmallest||(this.props.isLandscape?e.push(A.containerStyleOnMobile):e.push(A.containerStyleOnMobileForPortraitMode)),e}_getHeaderStyles(){const e=[A.headerStyle,A.commonTextStyle];return this.props.useLightTheme&&e.push(A.textStyleLightTheme),this.state.isConvIconCentered?e.push(v.default.fontStyle.messagingHeader):e.push(v.default.fontStyle.messagingHeaderSmall),e}}t.default=R},30734:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(31844),n=i(2604),o=i(16778),s=i(44770),r=i(62033),l=i(67930),c=i(98278),d=i(37490),u=i(46096),h=i(36237),p=i(15877),g=i(33754),C=i(81736),m=i(29130),S=i(51070),y=i(81115),f=i(10265),_=i(22222),b=i(80837),T=i(19675),v=i(53374),w=(0,p.lazyProperties)({container:()=>o.Styles.createViewStyle({flex:1,flexDirection:"column",justifyContent:"center",alignItems:"center"}),containerLandscape:()=>o.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"center",alignItems:"center"}),innerContainer:()=>o.Styles.createViewStyle({flexBasis:0,flex:1,justifyContent:"center",alignItems:"stretch",alignSelf:"stretch"}),imageContainer:()=>o.Styles.createViewStyle({flexBasis:0,flex:1,alignSelf:"stretch"}),headerText:()=>o.Styles.createTextStyle({marginVertical:15,marginHorizontal:10,textAlign:"center"}),descriptionText:()=>o.Styles.createTextStyle({marginBottom:15,marginHorizontal:10,textAlign:"center"}),button:()=>o.Styles.createButtonStyle({marginHorizontal:20,alignSelf:"stretch"})});class I extends l.default{constructor(){super(...arguments),this._onBack=()=>(this._submitPressedTrue(),!0),this._submitPressedTrue=()=>this._submitPressed(!0),this._submitPressedFalse=()=>this._submitPressed(!1)}_buildState(e,t){const i=this._getRootViewId();return{isLandscape:m.default.getDeviceOrientation(i)===a.DeviceOrientation.Landscape,safeAreaHorizontalInsets:S.default.horizontalInsets()}}componentDidMount(){super.componentDidMount(),d.dismissAll(),r.default.subscribe(this._onBack)}componentWillUnmount(){super.componentWillUnmount(),r.default.unsubscribe(this._onBack)}render(){const e=this._getHeaderText(this.state),t=[w.innerContainer];this.state.safeAreaHorizontalInsets.right&&t.push(y.default.horizontalPaddingStyle({right:this.state.safeAreaHorizontalInsets.right,left:0}));const i=o.createElement(o.View,{style:this.state.isLandscape?w.containerLandscape:w.container},o.createElement(o.View,{style:w.imageContainer},o.createElement(o.Image,{source:s.Collection.ANDROID_CALL_MONITOR_PERM_ILLUSTRATION,style:b.default.flexOne,resizeMode:"cover"})),o.createElement(o.View,{style:t},o.createElement(T.PanelHeader,{style:w.headerText},e),o.createElement(T.BodyText,{style:w.descriptionText},g.getString("AndroidCallMonitorPermissionsPanel.DescriptionText")),o.createElement(_.default,{style:w.button,buttonStyle:c.SXButtonStyle.BlueFill,onPress:this._submitPressedFalse,title:g.getString("AndroidCallMonitorPermissionsPanel.GrantPermissionButtonTitle")}),o.createElement(_.default,{buttonStyle:c.SXButtonStyle.ThemeNoBackground,buttonSize:c.SXButtonSize.Medium,style:w.button,onPress:this._submitPressedTrue,title:g.getString("AndroidCallMonitorPermissionsPanel.NotNowButtonTitle")})));return o.createElement(f.default,{dialogId:this.props.dialogId,containerStyle:this._themeStyles.primaryBackgroundColorStyle,closeOnClickOutside:!0,maxWidth:void 0,maxHeight:void 0,fullScreen:!0,useFullSizeContainer:!0,accessibilityLabel:e},o.createElement(o.View,{style:[b.default.flexOne,this._themeStyles.primaryBackgroundColorStyle]},i))}_submitPressed(e){const t=v.default.newCauseId();h.log(u.LogTraceArea.Navigation,"AndroidCallMonitorPermissionPanel._submitPressed, causeId"+t),this.isComponentMounted(),C.default.updateDrawOverPrePermissionStatus(e?n.PermissionStatus.Denied:n.PermissionStatus.Granted),e||n.default.requestDrawOverPermission(),this._goBack(t)}_getHeaderText(e){return g.getString("AndroidCallMonitorPermissionsPanel.HeaderText")}}t.default=I},32143:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});i(63297);const a=i(98356),n=i(16778),o=i(88837),s=i(75492),r=i(94224),l=i(47447),c=i(10117),d=i(83706),u=i(15877),h=i(30124),p=i(81115),g=i(86045),C=i(81760),m=i(40363),S=i(11828),y=i(19675),f=(0,u.lazyProperties)({warningContainer:()=>n.Styles.createViewStyle({position:"absolute",bottom:0,left:0,right:0,height:30}),innerContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",paddingVertical:5,marginHorizontal:50}),statusText:()=>n.Styles.createTextStyle({color:C.Color.white,backgroundColor:C.Color.transparent}),iconPadding:()=>n.Styles.createViewStyle({paddingRight:10}),iconPaddingRTL:()=>n.Styles.createViewStyle({paddingLeft:10}),background:()=>n.Styles.createViewStyle({backgroundColor:C.Color.blackOverlay20}),desktopCallControlsStyle:()=>n.Styles.createViewStyle({bottom:70})});class _ extends o.ComponentBase{constructor(){super(...arguments),this._onAnimatedWaringRef=e=>{this._animatedView=e||void 0}}_buildState(e,t){const i=h.default.isUsingStackNavigationContext(),a=l.CallingCapabilities.speakerVolumeControlSupported();return{areControlsVisible:s.default.areCallControlsVisible(),isNotificationHidden:e.hideNotification||i&&s.default.isOverflowMenuVisible(),showMicrophoneMuted:e.isMicrophoneMutedWhileSpeaking||r.default.CallingStore.isMicrophoneMuted(e.callId),callAudioOutputRoute:r.default.CallControlsStore.getAudioOutput(),speakerVolumeControlSupported:a,isSpeakerMuted:!!a&&(r.default.CallingStore.isSpeakerMuted(e.callId)||0===r.default.DeviceStore.getSpeakerVolume())}}componentDidMount(){super.componentDidMount(),this._getWarningViewinfo(),this.state.viewInformation&&g.default.maybeAnnounceForAccessibility(this.state.viewInformation.warningText)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this._getWarningViewinfo(),this.state.isNotificationHidden!==t.isNotificationHidden&&this._showOrHideWarningView(!this.state.isNotificationHidden,!1),!this.state.viewInformation||t.viewInformation&&t.viewInformation.warningText===this.state.viewInformation.warningText||g.default.maybeAnnounceForAccessibility(this.state.viewInformation.warningText)}_showOrHideWarningView(e,t=!0,i=0){this.isComponentMounted()&&this._animatedView&&(this._animatedView.stop(),t?e?this._animatedView.fadeIn(void 0,void 0,{delay:i}):this._animatedView.fadeOut(void 0,void 0,{delay:i}):this._animatedView.setValue({opacity:e?1:0}))}render(){if(!this.state.viewInformation)return null;const e=[f.warningContainer];let t,i;return this.state.viewInformation&&!this.state.areControlsVisible&&e.push(f.background),this.props.bottomPadding&&(e.push(p.default.paddingBottomStyle(this.props.bottomPadding)),e.push(p.default.heightStyle(30+this.props.bottomPadding))),this.state.viewInformation&&(i=this.state.viewInformation.warningText?this._getWarningText(this.state.viewInformation.warningText):void 0,t=this.state.viewInformation.icon?this._getWarningIcon(this.state.viewInformation.icon):void 0),this.props.useDesktopCallControls&&e.push(f.desktopCallControlsStyle),n.createElement(n.View,{style:e,blockPointerEvents:!0,ignorePointerEvents:!0},n.createElement(a.View,{ref:this._onAnimatedWaringRef,style:f.innerContainer},t,i))}_getWarningViewinfo(){let e;(this.state.speakerVolumeControlSupported||this.state.showMicrophoneMuted)&&(e=d.default.getViewInformationForAudioMuted(this.state.showMicrophoneMuted,this.state.isSpeakerMuted)),this.setState({viewInformation:e})}_getWarningText(e){return n.createElement(y.BodyText,{style:f.statusText},e)}_getWarningIcon(e){let t=C.Color.white;return this.state.viewInformation&&this.state.viewInformation.optionalIconColor&&(t=this.state.viewInformation.optionalIconColor),n.createElement(c.default,{icon:e,size:S.IconSize.size15,color:t,style:m.default.isRTL()?f.iconPaddingRTL:f.iconPadding})}}t.default=_},79231:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AudioOutputRouteHelper=void 0;const a=i(63297),n=i(89391),o=i(33754),s=(i(4057),i(40363),i(11828));t.AudioOutputRouteHelper=class{static displayInfoForOutputRoute(e){let t=s.SkypeIcon.VolumeMax,i="CallControls.CallButtonSpeaker",n="CallControls.CallButtonSpeakerAccessibilityLabel";return e&&(e===a.default.AudioOutputEarpiece?(t=s.SkypeIcon.VolumeOff,i="CallControls.CallButtonEarpiece",n="CallControls.CallButtonEarpieceAccessibilityLabel"):e===a.default.AudioOutputWiredHeadset?(t=s.SkypeIcon.Headset,i="CallControls.CallButtonHeadset",n="CallControls.CallButtonHeadsetAccessibilityLabel"):e===a.default.AudioOutputBluetooth&&(t=s.SkypeIcon.Bluetooth,i="CallControls.CallButtonBluetooth",n="CallControls.CallButtonBluetoothAccessibilityLabel")),{icon:t,title:o.getString(i),accessibilityLabel:o.getString(n)}}static useiOSRoutePicker(){n.default.getSkypeAudioLibraryFeatures().ECS_AudioDL_DisableRouteChangeNotification;return!1}}},41789:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AudioRouteSelectionPresenter=t.AudioOutputRouteStrings=void 0;const a=i(96486),n=i(63297),o=i(94224),s=i(2278),r=i(46096),l=i(36237),c=i(33754),d=i(93194);var u;!function(e){e.CallButtonEarpiece="CallControls.CallButtonEarpiece",e.CallButtonSpeaker="CallControls.CallButtonSpeaker",e.CallButtonBluetooth="CallControls.CallButtonBluetooth",e.CallButtonHeadset="CallControls.CallButtonHeadset"}(u=t.AudioOutputRouteStrings||(t.AudioOutputRouteStrings={}));const h={[n.default.AudioOutputEarpiece]:u.CallButtonEarpiece,[n.default.AudioOutputSpeaker]:u.CallButtonSpeaker,[n.default.AudioOutputBluetooth]:u.CallButtonBluetooth,[n.default.AudioOutputWiredHeadset]:u.CallButtonHeadset},p={[n.default.AudioOutputEarpiece]:"Earpiece",[n.default.AudioOutputSpeaker]:"Speaker",[n.default.AudioOutputBluetooth]:"Bluetooth",[n.default.AudioOutputWiredHeadset]:"WiredHeadset",[n.default.AudioOutputOther]:"Other"};t.AudioRouteSelectionPresenter=class{constructor(e){this._causeId=e,this._providingVideo=!1,this._onMenuCancelled=()=>{const e=o.default.CallControlsStore.getAudioOutput(),t=p[e];s.default.trackAudioOutputRouteChange(t,t)},this._onMenuItemSelected=e=>{switch(l.log(r.LogTraceArea.CallingUI,`AudioRouteSelectionPresenter,_onMenuItemSelected command: ${e} causeId: ${this._causeId}`),e){case u.CallButtonEarpiece:this._requestAudioOutputRoute(n.default.AudioOutputEarpiece);break;case u.CallButtonSpeaker:this._requestAudioOutputRoute(n.default.AudioOutputSpeaker);break;case u.CallButtonBluetooth:this._requestAudioOutputRoute(n.default.AudioOutputBluetooth);break;case u.CallButtonHeadset:this._requestAudioOutputRoute(n.default.AudioOutputWiredHeadset)}this._resumeCallControlTimer&&this._resumeCallControlTimer()}}setUserProvidingVideo(e){this._providingVideo=e}setControlTimerHandlers(e,t){this._suspendCallControlTimer=e,this._resumeCallControlTimer=t}show(e,t,i){const s=o.default.CallControlsStore.getAudioOutput();n.default.requestAvailableOutputRoutesArray(s).then((o=>{this._providingVideo&&(o=a.filter(o,(e=>e!==n.default.AudioOutputEarpiece))),o.length>2?this._showMenu(e,t,i,o):2===o.length?this._toggleRoutes(o,s):l.log(r.LogTraceArea.CallingUI,`AudioRouteSelectionPresenter.show() only single route option available current: ${s} available: ${o} causeId: ${this._causeId}`)}))}_toggleRoutes(e,t){e[0]===t?this._requestAudioOutputRoute(e[1]):this._requestAudioOutputRoute(e[0]),this._resumeCallControlTimer&&this._resumeCallControlTimer()}_showMenu(e,t,i,n){const o=[];a.each(n,(e=>{e?o.push({text:c.getString(h[e]),command:h[e]}):l.warn(r.LogTraceArea.CallingUI,"AudioRouteSelectionPresenter._showMenu invalid route in outputRoutes")})),this._suspendCallControlTimer&&this._suspendCallControlTimer(),d.default.showWithActionMenuConfig({options:{anchor:i,buttons:o,title:c.getString("CallPanel.SelectAudioRouteTitle")},callback:this._onMenuItemSelected,maintainAnchor:!0,rootViewId:e,onCancel:this._onMenuCancelled,invokingEvent:t})}_requestAudioOutputRoute(e){const t=o.default.CallControlsStore.getAudioOutput();s.default.trackAudioOutputRouteChange(p[t],p[e]),n.default.requestOutput(e)}}},67743:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(75352),o=i(94224),s=i(9520),r=i(2278),l=i(87134),c=i(85043),d=i(15877),u=i(33754),h=i(35337),p=i(42484),g=i(19675),C=(0,d.lazyProperties)({popupContainer:()=>a.Styles.createViewStyle({width:300,paddingHorizontal:15,borderRadius:5,opacity:.85}),popupTitleRow:()=>a.Styles.createTextStyle({marginTop:15,flexDirection:"row",justifyContent:"space-between"})});class m extends c.HoverPopup{constructor(){super(...arguments),this._allowShowPopup=()=>this._defaultAllowShowPopupConditions()&&!this.state.isAwaitingCameraConfirmation,this._allowHidePopup=()=>this._defaultAllowHidePopupConditions(),this._onMicrophoneSelected=e=>{r.default.updateCallAudioSettingsPopupEvent((t=>{e&&t.markDidChangeMicDevice()}))},this._onSpeakerSelected=e=>{r.default.updateCallAudioSettingsPopupEvent((t=>{e&&t.markDidChangeSpeakerDevice()}))},this._onAdjustSpeakerVolume=()=>{r.default.updateCallAudioSettingsPopupEvent((e=>e.markDidAdjustSpeakerVolume()))},this._onAdjustMicVolume=()=>{r.default.updateCallAudioSettingsPopupEvent((e=>e.markDidAdjustMicVolume()))},this._onToggleMusicMode=e=>{r.default.updateCallAudioSettingsPopupEvent((e=>e.markDidChangeMusicMode()))},this._onToggleAECMode=e=>{r.default.updateCallAudioSettingsPopupEvent((e=>e.markDidChangeAECMode()))}}_buildState(e,t){return Object.assign(Object.assign({},super._buildState(e,t)),{isAwaitingCameraConfirmation:o.default.CallControlsStore.isAwaitingCameraConfirmation()})}componentWillUnmount(){super.componentWillUnmount(),this.onClosed()}renderContent(){return a.createElement(a.View,{style:[C.popupContainer,this._themeStyles.primaryBackgroundColorStyle]},a.createElement(a.View,{style:C.popupTitleRow},a.createElement(g.Subtitle,null,u.getString("CallControlsOverFlowMenu.AdjustAudioSettings"))),a.createElement(h.default,{callId:this.props.callId,colorThemeOverride:this._currentTheme,hideAutoAdjustSetting:!0,micLevelMeterSteps:13,labelMaxWidth:166,onMicrophoneSelected:this._onMicrophoneSelected,onAdjustVolume:this._onAdjustMicVolume,onToggleMusicMode:this._onToggleMusicMode,onToggleAEC:this._onToggleAECMode,origin:n.MicrophoneSettingsOrigin.InCallPopup}),a.createElement(l.default,{colorThemeOverride:this._currentTheme}),a.createElement(p.default,{colorThemeOverride:this._currentTheme,compactView:!0,labelMaxWidth:166,onSpeakerSelected:this._onSpeakerSelected,onAdjustVolume:this._onAdjustSpeakerVolume}))}popupDescription(){return"AudioSettings"}onOpened(e){r.default.setCallAudioSettingsPopupEvent(new s.CallAudioSettingsPopup(this.props.callId,e)),o.default.CallControlsStore.setSettingsPopupVisibility(!0)}onClosed(){o.default.CallControlsStore.setSettingsPopupVisibility(!1)}}t.default=m},37726:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.dismiss=t.show=void 0;const a=i(15069),n=i(2604),o=i(16778),s=(i(4330),i(94224)),r=i(30062),l=i(47204),c=i(98278),d=i(98278),u=i(46096),h=i(36237),p=i(15877),g=i(33754),C=i(57538),m=i(78735),S=i(81736),y=i(64956),f=i(10265),_=i(10056),b=i(22222),T=i(78262),v=i(19675),w=i(53374),I=i(29130),P=i(24576),M=i(97634),k=(0,p.lazyProperties)({panel:()=>o.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"center"}),mainDisplayText:()=>o.Styles.createTextStyle({marginTop:35,textAlign:"center",maxWidth:640,paddingHorizontal:10}),mainDisplayTextSafari:()=>o.Styles.createTextStyle({fontSize:16}),downloadSuggestionText:()=>o.Styles.createTextStyle({marginRight:10}),chromeDisplayImage:()=>o.Styles.createImageStyle({width:612,height:266}),downloadButton:()=>o.Styles.createButtonStyle({alignSelf:"center",minWidth:d.SXButtonSize.Small}),continueWithoutAVButton:()=>o.Styles.createButtonStyle({alignSelf:"center",minWidth:d.SXButtonSize.Small,margin:20}),suggestionContent:()=>o.Styles.createViewStyle({position:"absolute",top:30,right:30,alignItems:"center",flexDirection:"row",overflow:"visible"})});function A(e,t,i){h.log(u.LogTraceArea.Permissions,"AugmentedPermissionsPanelProps.dismiss dismiss causeId: "+i),l.default.dismissModal(e,t)}t.show=function(e,t,i,a,n,s){h.log(u.LogTraceArea.Permissions,"AugmentedPermissionsPanelProps.show permissionType: "+i+" causeId: "+a);const r=o.createElement(R,{causeId:a,modalId:e,permissionType:i,onContinueAfterPermissionsDenied:s});return l.default.showModal(r,e,t),e=>A(e,t.rootViewId,a)},t.dismiss=A;class R extends P.default{constructor(){super(...arguments),this._onJoinCallWithoutAVPermissions=()=>{this.props.onContinueAfterPermissionsDenied&&this.props.onContinueAfterPermissionsDenied(),this._setTelemetryAction(r.AVPermissionsAction.ContinueWithoutAV),this._dismissAndCleanup()},this._onCancelButtonClick=()=>{this._setTelemetryAction(r.AVPermissionsAction.Cancel),this._dismissAndCleanup()}}_buildState(e,t){const i={permissionStatus:S.default.permissionStatus(e.permissionType),isContinueCallWithoutAVEnabled:s.default.CallingFeaturesHelper.isCallWithoutAVPermissionsBrowserEnabled()};return t&&(i.permissionStatus===n.PermissionStatus.Unknown?S.default.getPermissionStatusFetchIfUnavailable(e.permissionType).then((e=>{i.permissionStatus=e,this._initializeTelemetry(i)})):this._initializeTelemetry(i)),i}componentDidMount(){if(super.componentDidMount(),S.default.permissionStatus(this.props.permissionType)===n.PermissionStatus.Unknown)switch(this.props.permissionType){case T.PermissionType.Microphone:m.default.setUserPreferencesLocal({wasInstructedAboutMicrophoneWebPermissions:!0});break;case T.PermissionType.Camera:m.default.setUserPreferencesLocal({wasInstructedAboutCameraWebPermissions:!0});break;case T.PermissionType.MicrophoneAndCamera:m.default.setUserPreferencesLocal({wasInstructedAboutMicrophoneWebPermissions:!0,wasInstructedAboutCameraWebPermissions:!0})}}componentWillUnmount(){super.componentWillUnmount(),this._callPermissionDeniedEvent&&(this._isGranted(this.state.permissionStatus)&&this._callPermissionDeniedEvent.setAction(r.AVPermissionsAction.PermissionGranted),h.track(this._callPermissionDeniedEvent))}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this.state.permissionStatus!==n.PermissionStatus.Granted&&t.permissionStatus===n.PermissionStatus.Granted&&(this._setTelemetryAction(r.AVPermissionsAction.PermissionGranted),this._dismissAndCleanup())}render(){const{primaryTextColorStyle:e,primaryBackgroundColorStyle:t}=M.themeStyles(this._getContext(),this.props.colorThemeOverride);return this.state.permissionStatus===n.PermissionStatus.Unknown&&s.default.CallingFeaturesHelper.isBrowserCheckPermissionSupported()?null:o.createElement(f.default,{dialogId:this.props.modalId,containerStyle:C.MeetNowStyle.bgColorStyle,closeOnClickOutside:!1,maxWidth:void 0,fullScreen:!0,useFullSizeContainer:!0},o.createElement(o.View,{style:[k.panel,t]},this._renderMainDisplayImage(),this._renderMainDisplayText(e),this._renderJoinCallWithoutAVButton(),!1))}_renderMainDisplayImage(){if(this._isDeniedScreen(this.state)){const e=y.default.getDeniedImageSourceBrowser(),t=a.BrowserEnvironment.isSafari()||I.default.isTinyScreenSizeNoSubscription(this._getRootViewId())?c.ImageResizeModeEnum.contain:c.ImageResizeModeEnum.cover;return e?o.createElement(o.Image,{style:k.chromeDisplayImage,resizeMode:t,source:e}):void 0}return o.createElement(_.SkypeLogo,null)}_renderMainDisplayText(e){const t=this._isDeniedScreen(this.state),i=t?this._renderMainDisplayTextDenied():this._renderMainDisplayTextRequest(),n=[k.mainDisplayText,e,t&&a.BrowserEnvironment.isSafari()?k.mainDisplayTextSafari:void 0];return o.createElement(v.Header,{style:n,size:5,allowFontScaling:!1,importantForAccessibility:o.Types.ImportantForAccessibility.Yes},i)}_assertAndWarnUnsupportedBrowser(){h.warn(u.LogTraceArea.Permissions,"AugmentedPermissions UI is not supported for other browsers")}_renderMainDisplayTextRequest(){const e=a.BrowserEnvironment.isEngineChromium()||a.BrowserEnvironment.isEngineWebkit()||a.BrowserEnvironment.isEngineGecko();switch(this.props.permissionType){case T.PermissionType.Microphone:return e?g.getString("AugmentedPermissions.RequestPermissionsChromeTextMic"):g.getString("AugmentedPermissions.RequestPermissionsEdgeTextMic");case T.PermissionType.Camera:return e?g.getString("AugmentedPermissions.RequestPermissionsChromeTextCam"):g.getString("AugmentedPermissions.RequestPermissionsEdgeTextCam");default:return e?g.getString("AugmentedPermissions.RequestPermissionsChromeTextBoth"):g.getString("AugmentedPermissions.RequestPermissionsEdgeTextBoth")}}_renderMainDisplayTextDenied(){const e=y.default.getDeniedTextDuringCallBrowser(T.PermissionType.Camera),t=y.default.getDeniedTextDuringCallBrowser(T.PermissionType.Microphone),i=y.default.getDeniedTextDuringCallBrowser(T.PermissionType.MicrophoneAndCamera);if(!e||!t||!i)return this._assertAndWarnUnsupportedBrowser(),"";if(this.state.permissionStatus===n.PermissionStatus.MicGrantedAndCameraDenied)return e;if(this.state.permissionStatus===n.PermissionStatus.MicDeniedAndCameraGranted)return t;switch(this.props.permissionType){case T.PermissionType.Camera:return e;case T.PermissionType.Microphone:return t;case T.PermissionType.MicrophoneAndCamera:return i;default:w.default.switchStatementExhaustiveChecking(this.props.permissionType,"AugmentedPermissions called for an incorrect permission type")}}_isDeniedScreen(e){return e.permissionStatus===n.PermissionStatus.Denied||e.permissionStatus===n.PermissionStatus.MicDeniedAndCameraGranted}_renderJoinCallWithoutAVButton(){if(this.state.isContinueCallWithoutAVEnabled&&this.props.onContinueAfterPermissionsDenied)return o.createElement(b.default,{allowTextWrap:!0,buttonSize:d.SXButtonSize.Medium,buttonStyle:d.SXButtonStyle.ThemeStroke,onPress:this._onJoinCallWithoutAVPermissions,style:k.continueWithoutAVButton,title:g.getString("AugmentedPermissions.JoinCallWithoutAV")})}_dismissAndCleanup(){A(this.props.modalId,c.MainRootViewId,""),n.PermissionsPromptHelper.resetPermissionPromptsState()}_initializeTelemetry(e){const t=this._isDeniedScreen(e)?r.InitialScreen.DenyPrompt:r.InitialScreen.AllowPrompt;this._callPermissionDeniedEvent=new r.CallPermissionsBrowserEvent(t)}_setTelemetryAction(e){this._callPermissionDeniedEvent&&this._callPermissionDeniedEvent.setAction(e)}_isGranted(e){switch(this.props.permissionType){case T.PermissionType.Camera:return e===n.PermissionStatus.Granted||e===n.PermissionStatus.MicDeniedAndCameraGranted;case T.PermissionType.Microphone:return e===n.PermissionStatus.Granted||e===n.PermissionStatus.MicGrantedAndCameraDenied;case T.PermissionType.MicrophoneAndCamera:return e===n.PermissionStatus.Granted}}}t.default=R},60662:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(16778),o=i(88837),s=i(81400),r=i(12614),l=i(80200),c=i(71727),d=i(46096),u=i(36237),h=i(6250),p=i(40363),g=i(53374),C=i(94224);class m extends o.ComponentBase{constructor(){super(...arguments),this._itemPrefix="item_",this._lastReactionPostTime=0,this._isRTL=p.default.isRTL(),this._mountedRefsMap=new h.default,this._onPositionDrawer=(e,t)=>{u.log(d.LogTraceArea.CallReactionsDrawer,"_positionDrawer isOpen: "+t.isOpen+" animated: "+e)},this._onPositionDrawerAnimationCompleted=()=>{u.log(d.LogTraceArea.CallReactionsDrawer,"_onPositionDrawerAnimationCompleted isOpen: "+this.state.isOpen),this._drawerAnimation=void 0;const e=this._mountedRefsMap.ref(this._itemPrefix+0);this.isComponentMounted()&&e&&this.state.isOpen&&e.requestFocus(),this.props.onOpenCloseAnimationComplete&&this.props.onOpenCloseAnimationComplete(this.state.isOpen)},this._renderReactionItem=(e,t)=>{switch(e.type){case l.ReactionsItemType.Animation:case l.ReactionsItemType.Emoticon:case l.ReactionsItemType.Sticker:return this._renderItem(e,t)}},this._onToggleOpen=()=>{const e=!this.state.isOpen;u.log(d.LogTraceArea.CallReactionsDrawer,"_onToggleOpen shouldOpen: "+e),this.setState({isOpen:e})},this._onReactionPressed=(e,t)=>{const i=g.default.newCauseId();u.log(d.LogTraceArea.CallReactionsDrawer,"_onReactionPressed causeId: "+i);const a=Date.now();if(a-this._lastReactionPostTime>=500){const n={reactionInfo:e,causeId:i,timestamp:t,postSource:d.PostSource.CallReactionPressed,callId:this.props.callId,conversationMri:this.props.conversationMri,reactionsConversationMri:this.props.reactionsConversationMri,logTraceArea:d.LogTraceArea.CallReactionsDrawer};s.CallReactionPostingHelpers.postReaction(n),this._selectedReactionInfo=e,this._lastReactionPostTime=a}this._onHandleReactionPressed()},this._onReactionPanHorizontal=e=>{}}_buildState(e,t){const i={isOpen:!t&&this.state.isOpen,emoticonReactionKey:c.default.getEmoticonReactionKey(e.celebrationData),reactions:c.default.getReactionItems(e.celebrationData),enableNewMainCallControls:C.default.CallingFeaturesHelper.areNewMainCallControlsEnabled()};return t&&this._positionDrawer(!1,i),i}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=this.state.isOpen!==t.isOpen;a&&this._positionDrawer(!0,this.state),u.log(d.LogTraceArea.CallReactionsDrawer,"componentDidUpdate  openStateChanged: "+a+" isOpen: "+this.state.isOpen+" emoticonReactionKey: "+this.state.emoticonReactionKey)}_renderContent(){let e=0,t=a.map(this.state.reactions,((t,i)=>this._renderReactionItem(t,i+e)));return e+=t.length,this._isRTL&&(t=a.reverse(t)),this._renderReactionViews(a.compact(t))}_renderItem(e,t){if(!e.key)return;const i=this.state.isOpen?void 0:n.Types.ImportantForAccessibility.NoHideDescendants,a=this.state.isOpen?void 0:-1;return n.createElement(r.default,{key:e.key,ref:this._mountedRefsMap.onComponentRef(this._itemPrefix+t),info:e,isAnimated:this.state.isOpen,onPress:this._onReactionPressed,onPanHorizontal:this.state.isOpen?void 0:this._onReactionPanHorizontal,importantForAccessibility:i,tabIndex:a,celebrationData:this.props.celebrationData})}openDrawer(){this.state.isOpen||this._onToggleOpen()}openDrawerOnHover(){}closeDrawer(){return this._drawerAnimation&&(this._drawerAnimation.stop(),this._drawerAnimation=void 0),!!this.state.isOpen&&(u.log(d.LogTraceArea.CallReactionsDrawer,"closeDrawer"),this._onToggleOpen(),!0)}isOpen(){return this.state.isOpen}_onHandleReactionPressed(){}}t.default=m},61541:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocalBaseCallRecorderToast=t.RemoteBaseCallRecorderToast=void 0;const a=i(16778),n=i(89391),o=i(16402),s=i(46096),r=i(36237),l=i(33754),c=i(24576),d=i(12770),u=i(53374);class h extends c.default{constructor(){super(...arguments),this.recordingStartedAnnounceForAccessibility=()=>{if(this.state.initiatorDisplayName){const e=this.state.initiatorDisplayName||"";a.Accessibility.announceForAccessibility(l.getString(this.props.startedAccessibilityLabelTextPath,{name:e}))}},this.recordingStoppedAnnounceForAccessibility=()=>{if(this.state.initiatorDisplayName){const e=this.state.initiatorDisplayName||"";a.Accessibility.announceForAccessibility(l.getString(this.props.stoppedAccessibilityLabelTextPath,{name:e}))}}}componentDidMount(){super.componentDidMount(),this.state.initiatorDisplayName&&this.recordingStartedAnnounceForAccessibility()}componentWillUnmount(){super.componentWillUnmount(),this.recordingStoppedAnnounceForAccessibility()}}t.RemoteBaseCallRecorderToast=h;class p extends c.default{constructor(){super(...arguments),this._onStopPress=e=>{const t=u.default.newCauseId();r.log(s.LogTraceArea.CallingUI,"BaseCallRecorderToast.onStopPress causeId:"+t),this.props.onStopPress(this.state.callId,t)},this._onMorePrivacyInfoPress=e=>{a.Linking.openUrl(n.default.getConfigSettingsNoSubscription().skypeGoLinks.privacyAndCookies)},this._onDismissPrivacyInfoPress=()=>{r.log(s.LogTraceArea.CallingUI,"BaseCallRecorderToast.onDismissPrivacyInfoPress"),this.setState({showPrivacyLink:!1})},this._getElapsedTime=()=>o.default.getElapsedTimeStringFromMs(this.state.recordingElapsedTimeMs),this._recordingStartedAnnounceForAccessibility=()=>{a.Accessibility.announceForAccessibility(l.getString(this.props.startedAccessibilityLabelTextPath))},this._recordingStoppedAnnounceForAccessibility=()=>{a.Accessibility.announceForAccessibility(l.getString(this.props.stoppedAccessibilityLabelTextPath))}}componentDidMount(){super.componentDidMount(),this.callRecordingTimer=d.default.setInterval((()=>{let e=0;const t=this.state.recordingTimestamp?this.state.recordingTimestamp:void 0;if(t){const i=o.default.getUnixMillisecondsTimestamp(t);e=Date.now()-i,e<0&&(e=0)}this.isComponentMounted()&&this.setState({recordingElapsedTimeMs:e})}),1e3),this._recordingStartedAnnounceForAccessibility()}componentWillUnmount(){super.componentWillUnmount(),this.privacyInfoDisplayTimer&&(d.default.clearTimeout(this.privacyInfoDisplayTimer),this.privacyInfoDisplayTimer=void 0),this.callRecordingTimer&&(d.default.clearTimeout(this.callRecordingTimer),this.callRecordingTimer=void 0),this._recordingStoppedAnnounceForAccessibility()}}t.LocalBaseCallRecorderToast=p},60787:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallButton=t.CallButtonSpacing=t.CallButtonBackgroundStyle=t.CallButtonSize=void 0;const a=i(96486),n=i(98356),o=i(16778),s=i(36237),r=i(80200),l=i(11009),c=i(13944),d=i(11828),u=i(46096),h=i(97775),p=i(81760),g=i(77381),C=i(68934),m=i(15877),S=i(40363),y=i(11010),f=i(80837),_=i(53374);var b,T,v;!function(e){e[e.ExtraSmall=0]="ExtraSmall",e[e.Small=1]="Small",e[e.Large=2]="Large",e[e.ExtraLarge=3]="ExtraLarge"}(b=t.CallButtonSize||(t.CallButtonSize={})),function(e){e[e.None=0]="None",e[e.Solid=1]="Solid",e[e.Overlay=2]="Overlay"}(T=t.CallButtonBackgroundStyle||(t.CallButtonBackgroundStyle={})),function(e){e[e.Default=0]="Default",e[e.Small=1]="Small",e[e.None=2]="None"}(v=t.CallButtonSpacing||(t.CallButtonSpacing={}));const w=r.CallButtonSizes.callbuttonExtraLargeSize,I=r.CallButtonSizes.callbuttonLargeSize,P=r.CallButtonSizes.callbuttonSmallSize,M=r.CallButtonSizes.callbuttonExtraSmallSize,k=S.default.getPlatformType()===u.PlatformType.iOS,A=(0,m.lazyProperties)({buttonSolidBackground:()=>o.Styles.createViewStyle({backgroundColor:p.Color.gray400}),buttonOverlayBackground:()=>o.Styles.createViewStyle({backgroundColor:p.Color.gray400Overlay10}),callingButtonExtraLarge:()=>o.Styles.createViewStyle({width:w,height:w,borderRadius:w/2}),callingButtonLarge:()=>o.Styles.createViewStyle({width:I,height:I,borderRadius:I/2}),callingButtonSmall:()=>o.Styles.createViewStyle({width:P,height:P,borderRadius:P/2}),callingButtonExtraSmall:()=>o.Styles.createViewStyle({width:M,height:M,borderRadius:M/2}),squareButtonExtraLarge:()=>o.Styles.createViewStyle({width:w,height:w,borderRadius:w/4}),squareButtonLarge:()=>o.Styles.createViewStyle({width:I,height:I,borderRadius:I/4}),squareButtonSmall:()=>o.Styles.createViewStyle({width:P,height:P,borderRadius:P/4}),squareButtonExtraSmall:()=>o.Styles.createViewStyle({width:M,height:M,borderRadius:M/4}),startCallButton:()=>o.Styles.createButtonStyle({backgroundColor:k?p.Color.greenIOS:p.Color.green}),endCallButton:()=>o.Styles.createButtonStyle({backgroundColor:k?p.Color.redIOS:p.Color.red}),mergeCallButton:()=>o.Styles.createButtonStyle({backgroundColor:p.Color.gray200}),innerContainer:()=>o.Styles.createViewStyle({justifyContent:"center",alignItems:"center",overflow:"visible"}),innerContainerMargin:()=>o.Styles.createViewStyle({marginHorizontal:8}),smallButtonMargin:()=>o.Styles.createViewStyle({marginHorizontal:5}),noButtonMargin:()=>o.Styles.createViewStyle({marginHorizontal:0}),mergeIconColor:()=>o.Styles.createTextStyle({color:p.Color.black}),selected:()=>o.Styles.createViewStyle({backgroundColor:p.Color.white}),modernChatIconBadge:()=>o.Styles.createViewStyle({height:8,width:8,backgroundColor:p.Color.red,borderRadius:4,position:"absolute",right:7,top:7,justifyContent:"center",alignItems:"center"}),containerWithCaption:()=>o.Styles.createViewStyle({justifyContent:"center"}),buttonWithCaption:()=>o.Styles.createViewStyle({width:70,justifyContent:"center",overflow:"visible"}),caption:()=>o.Styles.createTextStyle({paddingTop:0,textAlign:"center",fontSize:y.default.controlFontSize.actionButtonLabel,color:p.Color.white,width:70}),iconButtonWithCaption:()=>o.Styles.createViewStyle({justifyContent:"center"}),mainAndAdditionalImageWrapper:()=>o.Styles.createViewStyle({overflow:"visible"})});class R extends g.default{constructor(){super(...arguments),this._pressed=!1,this._hovered=!1,this._onAnimatedViewRef=e=>{this._animatedView=e||void 0},this._onPressIn=()=>{this._updateButton(!0),this._pressed=!0,this.props.onPressIn&&this.props.onPressIn()},this._onPressOut=()=>{this._pressed&&(this._updateButton(!1),this._pressed=!1),this.props.onPressOut&&this.props.onPressOut()},this._onPress=e=>{e.stopPropagation(),this.props.showToolTip&&C.default.clearToolTip(),this.props.onPress&&this.props.onPress(e)},this._onContentIconButtonRef=e=>{this._contentIconButton=e||void 0},this._onHover=e=>{this._hovered=e;const t=()=>!(!(this.isComponentMounted()&&this.props.showToolTip&&this.props.title&&this._hovered)||o.UserInterface.isNavigatingWithKeyboard());t()?a.delay((()=>{t()&&C.default.showToolTip((()=>this.isComponentMounted()?this:void 0),this._getRootViewId(),t,this.props.title||"",this.props.toolTipConfig)}),150):C.default.clearToolTip(),this.props.onHover&&this.props.onHover(e)}}static sizeForCallButtonSize(e){switch(e){case b.ExtraLarge:return w;case b.Large:return I;case b.Small:return P;case b.ExtraSmall:return M}}componentWillUnmount(){super.componentWillUnmount(),this.props.showToolTip&&this._hovered&&C.default.clearToolTip()}componentDidMount(){super.componentDidMount(),this._updateButtonVisibility()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.props.show!==e.show&&this._updateButtonVisibility()}_updateButtonVisibility(){var e,t;void 0!==this.props.show&&(this.props.show?null===(e=this._animatedView)||void 0===e||e.fadeIn():null===(t=this._animatedView)||void 0===t||t.fadeOut())}_updateButton(e){const t=e?.8:1,i=e?.92:1;this._internalUpdateButton(t,i)}_internalUpdateButton(e,t){const i=_.default.newCauseId();s.log(u.LogTraceArea.SXAnimated,"CallButton._internalUpdateButton causeId: "+i),this._animatedView&&this._animatedView.getAnimation({opacity:e,scale:t},i).start()}_renderIconButton(e,t,i,a,n={}){var s,r,d,u;const g=null!=i?i:this.props.colorConfig?a?this.props.colorConfig.selectedIconColor:this.props.colorConfig.iconColor:a?p.Color.gray400:p.Color.white,C=null===(s=this.props.colorConfig)||void 0===s?void 0:s.hoverStyle,m=Object.assign(Object.assign({},n),{style:e,size:t,title:this.props.showToolTip?void 0:this.props.title,icon:this.props.icon,hoverStyle:C,hoverIcon:null===(r=this.props.colorConfig)||void 0===r?void 0:r.hoverIcon,hoverColor:null===(d=this.props.colorConfig)||void 0===d?void 0:d.hoverColor,color:g,onHover:this.props.onHover||this.props.showToolTip?this._onHover:void 0,showHoverEffect:null===(u=this.props.colorConfig)||void 0===u?void 0:u.showHoverEffect,disabled:this.props.isDisabled,tabIndex:this.props.caption?-1:0});return this.props.coachMarkType&&this.props.anchorAccessibilityLabel?this.props.caption?o.createElement(h.default.View,{anchorRef:this._onContentIconButtonRef,coachMarkType:this.props.coachMarkType,anchorAccessibilityLabel:this.props.anchorAccessibilityLabel,onAnchorPress:this.props.onAnchorPress,positions:[l.PopupAnchorPositon.Top],key:this.props.coachMarkType},o.createElement(c.default,Object.assign({},m))):o.createElement(h.default.IconButton,Object.assign({anchorRef:this._onContentIconButtonRef},m,{coachMarkType:this.props.coachMarkType,anchorAccessibilityLabel:this.props.anchorAccessibilityLabel,onAnchorPress:this.props.onAnchorPress,positions:[l.PopupAnchorPositon.Top],key:this.props.coachMarkType})):o.createElement(c.default,Object.assign({ref:this._onContentIconButtonRef},m))}requestFocus(){this._contentIconButton&&this._contentIconButton.requestFocus()}render(){const{caption:e,isToggledOn:t,colorConfig:i,borderWidth:a,isBadgeOn:s,additionalImage:r}=this.props,l=[f.default.overflowVisible,f.default.noncollapsibleView,f.default.alignItemsCenter,this.props.style],c=t||this.props.colorConfig&&(this.props.isCallEndButton||this.props.isCallStartButton||this.props.isCallMergeButton),d=this._getIconButtonStylesBySize(),u=[d,this._getIconButtonBackgroundStyle(),c?this._getIconButtonToggledBackgroundStyle():void 0],h=[d,A.innerContainer,this.props.doNotAddHorizontalMargin?void 0:A.innerContainerMargin,this._getSpacing()];if(i){if(i.borderColor){const e=o.Styles.createViewStyle({borderColor:i.borderColor,borderWidth:null!=a?a:1},!1);h.push(e),u.push(e)}}else this.props.isCallEndButton&&u.push(A.endCallButton),this.props.isCallStartButton&&u.push(A.startCallButton),this.props.isCallMergeButton&&u.push(A.mergeCallButton);e&&(u.push(A.iconButtonWithCaption),l.push(A.containerWithCaption));const g=this._getIconBySize();let C;s&&(C=o.createElement(o.View,{style:A.modernChatIconBadge}));const m=this._getDefaultButtonProps(),S=null==i?void 0:i.showHoverEffect;let y=o.createElement(n.View,{ref:this._onAnimatedViewRef,style:l},o.createElement(o.View,{onMouseLeave:this._onPressOut,style:A.mainAndAdditionalImageWrapper},o.createElement(o.View,{style:h},this._renderIconButton(u,g,this.props.isCallMergeButton?p.Color.black:void 0,!!c,!e||S?m:void 0),C),r),this._getOptionalCaption());return e&&(y=o.createElement(o.Button,Object.assign({},m,{importantForAccessibility:o.Types.ImportantForAccessibility.Yes,style:A.buttonWithCaption}),y)),y}_getOptionalCaption(){if(!this.props.caption)return;const e=[A.caption,...this.props.colorConfig&&this.props.colorConfig.captionColor?[{color:this.props.colorConfig.captionColor}]:[]];return o.createElement(o.Text,{style:e,ellipsizeMode:"head",numberOfLines:1},this.props.caption)}_getDefaultButtonProps(){return{onPress:this._onPress,onPressIn:this._onPressIn,onPressOut:this._onPressOut,onLongPress:this.props.onLongPress,onContextMenu:this.props.onContextMenu,disabled:this.props.isDisabled,disableTouchOpacityAnimation:!0,accessibilityLabel:this.props.accessibilityLabel,importantForAccessibility:this.props.importantForAccessibility}}_getIconButtonStylesBySize(){let e;switch(this.props.size){case b.ExtraSmall:e=this.props.isSquareButton?A.squareButtonExtraSmall:A.callingButtonExtraSmall;break;case b.Small:e=this.props.isSquareButton?A.squareButtonSmall:A.callingButtonSmall;break;case b.Large:e=this.props.isSquareButton?A.squareButtonLarge:A.callingButtonLarge;break;case b.ExtraLarge:e=this.props.isSquareButton?A.squareButtonExtraLarge:A.callingButtonExtraLarge}return e}_getIconButtonBackgroundStyle(){return this.props.colorConfig?o.Styles.createViewStyle({backgroundColor:this.props.colorConfig.backgroundColor},!1):this.props.backgroundStyle===T.Solid?A.buttonSolidBackground:this.props.backgroundStyle===T.Overlay?A.buttonOverlayBackground:void 0}_getIconButtonToggledBackgroundStyle(){return this.props.colorConfig?o.Styles.createViewStyle({backgroundColor:this.props.colorConfig.selectedBackgroundColor},!1):A.selected}_getIconBySize(){switch(this.props.size){case b.ExtraSmall:return d.IconSize.size16;case b.Small:return d.IconSize.size20;case b.Large:return d.IconSize.size24;case b.ExtraLarge:return d.IconSize.size28}}_getSpacing(){let e;switch(this.props.spacing){case v.Small:e=A.smallButtonMargin;break;case v.None:e=A.noButtonMargin}return e}}t.CallButton=R,t.default=R},28664:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(44279),o=i(98278),s=i(27683),r=i(22222),l=i(81760),c=i(24576),d=i(97634);class u extends c.default{constructor(){super(...arguments),this._onComponentRef=e=>{this._componentRef=e||void 0}}_buildState(e,t){let i;if(s.default.isValidNumberString(e.phoneNumber)){const t=s.default.stripPlusSign(e.phoneNumber);i=n.default.getCallRateByPhoneNumber(t)}return{callRate:i}}render(){const e=s.default.parseAndFormat(this.props.phoneNumber,s.PhoneNumberFormat.INTERNATIONAL)||this.props.phoneNumber,t={backgroundColor:d.isDarkTheme(this._currentTheme)?l.Color.gray100:l.Color.black,textColor:this._themeColors.primaryBackgroundColor,subtitleTextColor:this._themeColors.disabledTextColor};return a.createElement(r.default,{ref:this._onComponentRef,key:"callingbutton_"+this.props.phoneNumber,buttonSize:o.SXButtonSize.Large,buttonStyle:o.SXButtonStyle.Custom,icon:this.props.icon,buttonConfig:t,title:e,subtitle:this.state.callRate,accessibilityLabel:this.props.accessibilityLabel,allowTextWrap:!0,onPress:this.props.onPress})}requestFocus(){this._componentRef&&this._componentRef.requestFocus()}}t.default=u},95571:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallButtonIconSize=void 0;const a=i(96486),n=i(16778),o=i(94224),s=i(98925),r=i(37034),l=i(80200),c=i(71830),d=i(52262),u=i(46096),h=i(13944),p=i(36237),g=i(15877),C=i(18460),m=i(33754),S=i(4735),y=i(30124),f=i(45227),_=i(72425),b=i(34273),T=i(79829),v=i(81760),w=i(11828),I=i(24576),P=i(72758),M=i(53374);var k;!function(e){e[e.Default=0]="Default",e[e.Compact=1]="Compact",e[e.ExtraCompact=2]="ExtraCompact"}(k=t.CallButtonIconSize||(t.CallButtonIconSize={}));const A=(0,g.lazyProperties)({hiddenContainer:()=>n.Styles.createViewStyle({width:0,justifyContent:"flex-end"}),button:()=>n.Styles.createViewStyle({alignItems:"center",paddingHorizontal:10,backgroundColor:v.Color.transparent})});class R extends I.default{constructor(){super(...arguments),this._onAudioButtonRef=e=>{this._audioButtonRef=e||void 0},this._onVideoButtonRef=e=>{this._videoButtonRef=e||void 0},this._onUpcomingCallDetailsButtonPress=e=>{if(e.stopPropagation(),!this.props.scheduledCallId)return;const t=M.default.newCauseId();p.log(u.LogTraceArea.CallNavigation,"CallButtons._onUpcomingCallDetailsButtonPress, causeId: "+t),!this.state.isUsingStackNav&&this.props.mri&&S.default.navigateToConversation({convId:this.props.mri,causeId:t,origin:u.NavigationConversationOrigin.Search});const i=b.default.ScheduledCallsStore.getScheduledCallById(this.props.scheduledCallId);i&&b.default.NavigationActions.navigateToScheduledOverviewPanel({scheduledCallId:i.id,entryPoint:T.ScheduleCallEntryPoint.UpcomingCallComponent},this._getRootViewId())},this._onCallButtonPress=e=>{e.stopPropagation();const t=M.default.newCauseId();p.log(u.LogTraceArea.CallNavigation,"SearchItem._onCallButtonPress causeId: "+t);const i=()=>this._audioButtonRef;this.props.mri&&c.isPhoneMri(this.props.mri)&&(!this.props.addressBookContactOverride||this.props.addressBookContactOverride&&this.props.addressBookContactOverride.shortCircuitMriMatch)?this._handlePstnOnlyClick(i):this._startCall(!1,t,i)},this._onVideoCallButtonPress=e=>{e.stopPropagation();const t=M.default.newCauseId();p.log(u.LogTraceArea.CallNavigation,"SearchItem._onVideoCallButtonPress causeId: "+t);this._startCall(!0,t,(()=>this._videoButtonRef))}}_buildState(e,t){const i={};let a=!1;return e.addressBookContactOverride?(i.isEncrypted=!1,i.displayName=e.addressBookContactOverride.getDisplayName()):e.mri?(i.isEncrypted=c.isEncryptedThread(e.mri),i.displayName=d.default.getDisplayName(e.mri)||"",i.activeCallStatus=o.default.ActiveCallUIHelper.activeCallStatus(e.mri),a=c.isPhoneMri(e.mri)):(i.isEncrypted=!1,i.displayName=""),i.isUsingStackNav=y.default.isUsingStackNavigationContext(),i.multipleAudioCallOptionsAvailable=e.mri&&!c.isEncryptedThread(e.mri)&&c.isOneOnOneConversation(e.mri)&&R._areMultipleAudioCallOptionsAvailable(e),i.callingNotAllowed=!e.mri||!c.isMri(e.mri)||!o.default.CallNavigationHelper.isOutgoingCallingAllowed(e.mri),i.allowOutboundVideo=e.mri&&!e.scheduledCallId&&c.isMri(e.mri)&&o.default.CallingFeaturesHelper.allowOutboundVideo({isPSTNCall:a,isEncryptedCall:i.isEncrypted,conversationMri:e.mri}),i}render(){let e,t,i,o,s;const r=this._themeColors.iconHoverColor,c=this._themeColors.primaryIconColor,d=this.state.activeCallStatus===l.ActiveCallStatus.OnHold;this.props.addressBookContactOverride&&!this.props.addressBookContactOverride.shortCircuitMriMatch?(o=!a.isEmpty(this.props.addressBookContactOverride.phones),s=!1):(o=!0,s=this.state.allowOutboundVideo);const u=[A.button];let p=w.IconSize.size24;if(this.props.iconSize&&(p=this.props.iconSize===k.Compact?w.IconSize.size20:w.IconSize.size16),o){let e,i;d?e=w.SkypeIcon.Pause:this.state.isEncrypted?e=w.SkypeIcon.PrivateCallFill:this.state.multipleAudioCallOptionsAvailable?(e=w.SkypeIcon.CallOptions,i=[n.Types.AccessibilityTrait.Button,n.Types.AccessibilityTrait.HasPopup]):e=w.SkypeIcon.CallStart,t=n.createElement(h.default,{ref:this._onAudioButtonRef,size:p,onPress:this._onCallButtonPress,color:c,hoverColor:r,icon:e,style:u,disabled:this.state.callingNotAllowed,title:m.getString("SkypeUserListItem.StartAudioCallButtonLabel"),accessibilityLabel:m.getString("AccessibilityLabel.StartAudioCallButtonAccessibilityLabel",{displayName:this.state.displayName}),accessibilityTraits:i})}this.props.scheduledCallId&&(i=n.createElement(h.default,{size:p,onPress:this._onUpcomingCallDetailsButtonPress,color:c,hoverColor:r,icon:w.SkypeIcon.Schedule,style:u,title:m.getString("SkypeUserListItem.ViewUpcomingCallDetailsButtonLabel"),accessibilityLabel:m.getString("AccessibilityLabel.ViewUpcomingCallDetailsButtonAccessibilityLabel",{displayName:this.state.displayName})})),s&&(e=n.createElement(h.default,{ref:this._onVideoButtonRef,size:p,onPress:this._onVideoCallButtonPress,color:c,hoverColor:r,icon:w.SkypeIcon.Video,style:u,disabled:this.state.callingNotAllowed,title:m.getString("SkypeUserListItem.StartVideoCallButtonLabel"),accessibilityLabel:m.getString("AccessibilityLabel.StartVideoCallButtonAccessibilityLabel",{displayName:this.state.displayName})}));const g=[f.styles.optionalCallButtonsContainer,this.props.hidden?A.hiddenContainer:void 0];return n.createElement(n.View,{style:g,importantForAccessibility:this.props.hidden?n.Types.ImportantForAccessibility.NoHideDescendants:void 0},i,e,t)}_handlePstnOnlyClick(e){const t=this.props.mri;t&&P.default.getFullUserProfileByMriAsync(t).then((i=>{if(!i)return;const a=c.getPhoneNumberFromMri(t);if(!a)return;const n=C.default.getContactByPhoneNumber(a),o=n?n.getDisplayName():i.getDisplayName();r.default.showForAddressContact(e,this._getRootViewId(),o,u.ContactInviteOrigin.CallPanelSearch,u.NavigationCallOrigin.SkypeUserListItem,i.phones,i.emails)}))}_startCall(e,t,i){const a={skypeMri:this.props.addressBookContactOverride&&!this.props.addressBookContactOverride.shortCircuitMriMatch?void 0:this.props.mri,phones:this.props.addressBookContactOverride?this.props.addressBookContactOverride.phones:void 0,userIntent:e?s.StartCallOrMaybePromptUserIntent.Video:s.StartCallOrMaybePromptUserIntent.Audio,inviteOrigin:u.ContactInviteOrigin.SearchItem,callOrigin:u.NavigationCallOrigin.SearchItem},n=this.props.mri;n&&_.default.shouldShowInterstitial(n,e)?_.default.maybeShowRinglessCallInterstitial(n,e,a.callOrigin,t):r.default.startCallOrMaybePrompt(i,this._getRootViewId(),a,t)}static _areMultipleAudioCallOptionsAvailable(e){return!!e.mri&&(!!c.isPhoneMri(e.mri)||P.default.getDisplayableUserByMri(e.mri).getHasPhoneNumbers())}}t.default=R},68625:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(16778),o=i(48467),s=i(98925),r=i(37034),l=i(78968),c=i(9520),d=i(46565),u=i(71830),h=i(11437),p=i(23293),g=i(16402),C=i(37490),m=i(52262),S=i(46096),y=i(10117),f=i(36237),_=i(15877),b=i(33754),T=i(23284),v=i(68080),w=i(18078),I=i(27683),P=i(36150),M=i(38985),k=i(93194),A=i(81760),R=i(40363),V=i(11010),L=i(11828),E=i(78262),B=i(80837),O=i(19675),D=i(24576),x=i(53374),N=200,U=110,F=k.default.menuId(),H=(0,_.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch",width:N}),cardFooterContainer:()=>n.Styles.createViewStyle({alignItems:"stretch"}),cardFooterContainerEnded:()=>n.Styles.createViewStyle({minHeight:72}),messageText:()=>n.Styles.createTextStyle({paddingHorizontal:10,textAlignVertical:"center",marginTop:3}),messageTextIOS:()=>n.Styles.createTextStyle({paddingVertical:3,marginTop:0}),durationContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",paddingHorizontal:10,paddingBottom:3}),durationIconMargins:()=>n.Styles.createViewStyle({marginRight:3}),optionalButton:()=>n.Styles.createButtonStyle({paddingVertical:13,borderTopWidth:2,borderStyle:"solid"}),optionalButtonText:()=>n.Styles.createTextStyle({textAlign:"center"}),optionalButtonHover:()=>n.Styles.createTextStyle({color:A.Color.gray300}),participantsText:()=>n.Styles.createTextStyle({paddingHorizontal:10,paddingVertical:3}),picturesContainer:()=>n.Styles.createViewStyle({height:U,flexDirection:"row",flexWrap:"wrap",justifyContent:"space-between",backgroundColor:A.Color.gray200}),pictureTripleMain:()=>n.Styles.createViewStyle({height:110,width:100}),pictureTripleStack:()=>n.Styles.createViewStyle({height:55,width:100}),pictureDouble:()=>n.Styles.createViewStyle({height:110,width:100}),pictureSingle:()=>n.Styles.createViewStyle({height:110,width:200}),rightPicturesStackContainer:()=>n.Styles.createViewStyle({justifyContent:"space-between"}),lastPictureOverlay:()=>n.Styles.createViewStyle({position:"absolute",top:0,right:0,bottom:0,left:0,alignItems:"center",justifyContent:"center",backgroundColor:A.Color.blackOverlay20}),lastPictureOverlayText:()=>n.Styles.createTextStyle({color:A.Color.white})});class z extends D.default{constructor(){super(...arguments),this._mediaThumbnailNodes={},this._onCallBackButtonRef=e=>{this._callBackButton=e||void 0},this._onInviteButtonRef=e=>{this._inviteButton=e||void 0},this._onHoverStartCallBack=()=>{this.setState({hoveringOverCallBack:!0})},this._onHoverEndCallBack=()=>{this.setState({hoveringOverCallBack:!1})},this._onHoverStartInvite=()=>{this.setState({hoveringOverInvite:!0})},this._onHoverEndInvite=()=>{this.setState({hoveringOverInvite:!1})},this._onPicturePress=e=>{f.log(S.LogTraceArea.CallCard,"Loading MediaViewer for CallCard"),f.track(new c.CallActionEnterFromCallCard),v.default.showWithMessageConfig({initialMessage:e,animateOpenClose:!0,rootViewId:this._getRootViewId(),getContentNode:e=>this._mediaThumbnailNodes[e],origin:S.NavigationMediaViewerOrigin.CallCard}),C.dismissAll()},this._onCallBackButtonPress=()=>{const e=x.default.newCauseId();f.log(S.LogTraceArea.CallCard,"CallCard._onCallBackButtonPress causeId: "+e),r.default.startCallOrMaybePrompt((()=>this._callBackButton),this._getRootViewId(),{skypeMri:this.props.conversationId,userIntent:s.StartCallOrMaybePromptUserIntent.Generic,callOrigin:S.NavigationCallOrigin.CallCard,inviteOrigin:S.ContactInviteOrigin.Unknown},e)},this._onInviteButtonPress=e=>{const t=u.getPhoneNumberFromMri(this.props.conversationId)||"",i=[{text:I.default.formatNumberWithType({number:t,type:E.PhoneNumberTypes.Other}),command:`sms:${t}`}],a={anchor:()=>this._inviteButton,useTheme:!0};k.default.showWithOptions({id:F,config:a,getMenuItems:()=>i,handleMenuCommand:this._handleInviteActionCommand,menuTitle:b.getString("CallCard.InviteActionTitle"),rootViewId:this._getRootViewId(),invokingEvent:e})},this._handleInviteActionCommand=e=>{if(e===k.SXActionMenuCancel)return;const t=e.split(":")[1];M.default.initiateJoinLinkInvite({target:new M.SmsInvite(t),origin:S.ContactInviteOrigin.CallCard,showLoadingModalWhileGettingJoinLink:!0,rootViewId:this._getRootViewId()})}}static getConstrainedWidth(){return N}_buildState(e,t){const i=w.default.isMyMri(e.creatorMri),n={creatorUserColor:i?void 0:p.default.getColorInfo(e.creatorMri),isCreatedByUser:i};if(t&&(n.hoveringOverInvite=!1,n.hoveringOverCallBack=!1),d.default.hasVisibleCall()&&d.default.isCallVisible(e.callId))n.pictures=t?[]:this.state.pictures,n.participants=t?[]:this.state.participants,n.isLargeCard=!t&&this.state.isLargeCard,n.participantsText=t?"":this.state.participantsText,n.shouldShowInviteButton=!t&&this.state.shouldShowInviteButton,n.isMobileScreenReaderEnabled=!t&&this.state.isMobileScreenReaderEnabled;else{let i;if(i=e.cardType===o.CallCardType.Cast?e.conversationId:u.getReactionsThreadMriForCallId(e.callId),i){const e=l.default.getPictureReactions(i,0,!0);n.pictures=a.sortBy(e,(e=>e.createdTime)),n.reactionsConversationId=i}else n.pictures=t?[]:this.state.pictures;if(n.participants=a.compact(a.map(e.userParticipantMris,(e=>e?m.default.getDisplayableProfile(e):void 0))),n.isLargeCard=e.cardType===o.CallCardType.Ended||e.cardType===o.CallCardType.Cast,n.participantsText=this._getFormattedParticipantNames(e.conversationId,e.creatorMri),n.isMobileScreenReaderEnabled=P.default.isMobileScreenReaderEnabled(),e.isPSTN){const t=u.getPhoneNumberFromMri(e.conversationId);if(t){const e=h.default.getSortedUsersByPhoneNumber(t);n.shouldShowInviteButton=0===e.length&&!1}else n.shouldShowInviteButton=!1}}return n}render(){return n.createElement(n.View,{style:[H.container,this.props.containerRadiusStyles],onPress:this.state.isMobileScreenReaderEnabled&&!this.state.isLargeCard?this._onCallBackButtonPress:void 0},this._renderPictures(),this._renderCardFooter())}_renderPictures(){const e=this.state.pictures.length;if(e){let t=[],i=[];const o=2;this._mediaThumbnailNodes={},a.each(this.state.pictures,((a,s)=>{if(s>o)return!1;let r,l=0,c=0;e>=3?0===s?(r=H.pictureTripleMain,l=110,c=100):(r=H.pictureTripleStack,l=55,c=100):2===e?(r=H.pictureDouble,l=110,c=100):1===e&&(r=H.pictureSingle,l=110,c=200);const d=n.createElement(T.default,{ref:e=>{this._mediaThumbnailNodes[a.cuid]={component:e}},message:a,width:c,height:l});let u;s===o&&3!==e&&(u=n.createElement(n.View,{style:H.lastPictureOverlay,blockPointerEvents:!0},n.createElement(O.BodyText,{bold:!0,style:H.lastPictureOverlayText},"+"+(e-s))));const h=n.createElement(n.View,{key:"callPicture"+s,style:r,onPress:()=>this._onPicturePress(a)},d,u);return e<3||0===s?t.push(h):i.push(h),!0}));const s=i.length?n.createElement(n.View,{style:H.rightPicturesStackContainer},i):null,r=[H.picturesContainer];return!this.state.isCreatedByUser&&this._themeStyles.bubbleColorOtherStyle&&r.push(this._themeStyles.bubbleColorOtherStyle),n.createElement(n.View,{style:r},t,s)}}_renderCardFooter(){const e=this._isMissedCall(),t=u.isBlockedPSTNMri(this.props.conversationId),i=[V.default.fontStyle.cardAction,this._themeStyles.buttonTextColorStyle,H.optionalButtonText];this.state.hoveringOverCallBack&&i.push(H.optionalButtonHover);const a=e&&!t?n.createElement(n.Button,{ref:this._onCallBackButtonRef,style:[H.optionalButton,this._themeStyles.primaryBorderColorStyle],onPress:this._onCallBackButtonPress,onHoverStart:this._onHoverStartCallBack,onHoverEnd:this._onHoverEndCallBack,underlayColor:this._themeColors.rowHighlightColor},n.createElement(n.Text,{style:i,numberOfLines:1},b.getString("CallCard.CallBackButton"))):null,o=[V.default.fontStyle.cardAction,this._themeStyles.buttonTextColorStyle,H.optionalButtonText];this.state.hoveringOverInvite&&o.push(H.optionalButtonHover);const s=this.state.shouldShowInviteButton&&!t?n.createElement(n.Button,{ref:this._onInviteButtonRef,style:[H.optionalButton,this._themeStyles.primaryBorderColorStyle],onPress:this._onInviteButtonPress,onHoverStart:this._onHoverStartInvite,onHoverEnd:this._onHoverEndInvite},n.createElement(n.Text,{style:o},b.getString("CallCard.InviteButton"))):null,r=[H.cardFooterContainer,this._themeStyles.cardColorStyle];e?r.push(B.default.flexOne):r.push(H.cardFooterContainerEnded);const l=[H.messageText];return R.default.getPlatformType()===S.PlatformType.iOS&&l.push(H.messageTextIOS),n.createElement(n.View,{style:r},n.createElement(O.Subtitle,{style:l,numberOfLines:1},this.props.messageText),n.createElement(O.CardTitle,{style:H.participantsText,numberOfLines:1},this.state.participantsText),n.createElement(n.View,{style:H.durationContainer},n.createElement(y.default,{icon:this.props.iconText,size:L.IconSize.size12,color:this._themeColors.secondaryTextColor,style:H.durationIconMargins}),n.createElement(O.Caption,null,this.props.durationText?this.props.durationText:g.default.getDisplayTimeString(this.props.createdTime))),s,a)}_getFormattedParticipantNames(e,t){const i=u.isThread(e),a=b.getString("DisplayInfoStore.ListMyName"),n=w.default.isMyMri(t)?a:m.default.getShortDisplayName(t);let o="";if(i)o=b.getString("CallCard.CallParticipantsString",{nameA:n,nameB:m.default.getDisplayName(e)||b.getString("Notifications.UnknownUserShort")});else{const i=w.default.isMyMri(t)?m.default.getShortDisplayName(e):a;o=b.getString("CallCard.CallParticipantsString",{nameA:n,nameB:i})}return o}_isMissedCall(){return this.props.cardType===o.CallCardType.Missed}}t.default=z},48777:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(88837),o=i(94224),s=i(32057),r=i(2278),l=i(46096),c=i(10117),d=i(36237),u=i(15877),h=i(33754),p=i(81760),g=i(11828),C=i(19675),m=i(53374),S=(0,u.lazyProperties)({container:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center"}),icon:()=>a.Styles.createViewStyle({marginRight:10})});class y extends n.ComponentBase{constructor(){super(...arguments),this._onStartAudioOnlyPress=e=>{const t=m.default.newCauseId();d.log(l.LogTraceArea.CallingUI,"CallConnectionQualityBanner starting AudioOnly mode. causeId:"+t),o.default.CallingStore.startAudioOnly(this.props.callId,t)},this._onStopAudioOnlyPress=e=>{const t=m.default.newCauseId();d.log(l.LogTraceArea.CallingUI,"CallConnectionQualityBanner stopping AudioOnlyMode. causeId:"+t),o.default.CallingStore.stopAudioOnly(this.props.callId,t)}}_buildState(e,t){const i={callId:e.callId,conversationMri:e.conversationMri,isPSTNCall:o.default.CallingStore.isPSTNCall(e.callId),isEncryptedCall:o.default.CallingStore.isEncryptedCall(e.callId)},a=o.default.CallingStore.isProvidingVideo(e.callId)||o.default.RemoteStreamHelper.isStreamAvailableForAnyParticipant(e.callId),n=(0,s.default)();return{allowAudioOnly:o.default.CallingFeaturesHelper.allowAudioOnly(i)&&a,audioOnlyEnabled:o.default.CallingStore.isAudioOnly(e.callId),callNetworkQualityPoor:n.isCallQualityPoor(e.callId),callNetworkCatastrophic:n.isCallCatastrophic(e.callId)}}_renderHyperlink(){const e=m.default.newCauseId();if(this.state.audioOnlyEnabled){d.log(l.LogTraceArea.CallingUI,`CallConnectionQualityBanner shows stop audio only. causeId: ${e}`);const t=h.getString("CallConnectionQualityToast.StopAudioOnlyLinkText");return this._renderHyperlinkButton(t,this._onStopAudioOnlyPress)}if(this.state.allowAudioOnly&&this.state.callNetworkCatastrophic){d.log(l.LogTraceArea.CallingUI,`CallConnectionQualityBanner audio only suggestion. causeId: ${e}`),r.default.updateCallTelemetry(this.props.callId,e,(e=>e.suggestAudioOnly()));const t=h.getString("CallConnectionQualityToast.StartAudioOnlyLinkText");return this._renderHyperlinkButton(t,this._onStartAudioOnlyPress)}}_renderHyperlinkButton(e,t){return a.createElement(a.Button,{onPress:t},a.createElement(C.BodyText,{style:this.props.linkStyle},e))}_renderIcon(){var e;if(this.state.callNetworkQualityPoor)return a.createElement(c.default,{style:S.icon,icon:g.SkypeIcon.CallQualityIndicator,size:g.IconSize.size24,color:null!==(e=this.props.iconColor)&&void 0!==e?e:p.Color.white})}_getTitleText(){return this.state.callNetworkQualityPoor&&this.state.audioOnlyEnabled?h.getString("CallConnectionQualityToast.PoorConnectionAndAudioOnlyEnabledTitle"):this.state.audioOnlyEnabled?h.getString("CallConnectionQualityToast.AudioOnlyTitle"):h.getString("CallConnectionQualityToast.PoorConnectionTitle")}render(){return a.createElement(a.View,{style:S.container},this._renderIcon(),a.createElement(a.View,{style:this.props.containerStyle},a.createElement(C.BodyText,{bold:!0,style:this.props.textStyle,numberOfLines:1},this._getTitleText()),this._renderHyperlink()))}}t.default=y},20187:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StopScreenShareCommand=t.RequestScreenShareCommand=t.ToggleVideoCommand=t.ChangeCallLayoutCommand=t.MuteEveryoneCommand=t.EndCallForEveryoneCommand=t.EndCallCommand=t.ToggleScreenShareCommand=t.ToggleMuteCommand=void 0;const a=i(96486),n=i(48540),o=i(97691),s=i(89391),r=i(94224),l=i(47176),c=i(36850),d=i(2278),u=i(80200),h=i(71727),p=i(46565),g=i(39549),C=i(46096),m=i(36237),S=i(44972),y=i(78735),f=i(18078),_=i(4735),b=i(64956),T=i(4057),v=i(78262),w=i(66123),I=i(53374),P=i(67024);t.ToggleMuteCommand=class{constructor(e,t,i,a,n,o){this._callId=e,this._muted=t,this._serverMuted=i,this._isPermissionDenied=a,this._rootViewId=n,this._scenarioId=o}execute(){const e=I.default.newCauseId(),t=`ToggleMuteCommand.execute causeId: ${e}`,i=`this.state.isMuted: ${this._muted}`,a=`this.state.isServerMuted: ${this._serverMuted}`;m.log(C.LogTraceArea.CallingUI,`${t}, ${i}, ${a}`),r.default.CallPermissionsUtils.requestPermissionStatus(v.PermissionType.Microphone,e).then((t=>{t?this._toggleMic(e):this._showMicDeniedPrompt()}))}_showMicDeniedPrompt(){b.default.showDeniedPromptWithSettingsOption(v.PermissionType.Microphone,this._rootViewId)}_toggleMic(e,t){this._muted?(r.default.CallingStore.unmute(this._callId,e).then((()=>{t&&P.default.markActionDoneAndRemoveTracker(t)})),h.default.announceMicrophoneState(!1,!1)):(r.default.CallingStore.mute(this._callId,e).then((()=>{t&&P.default.markActionDoneAndRemoveTracker(t)})),h.default.announceMicrophoneState(!0,!1)),d.default.updateCallTelemetry(this._callId,e,(e=>e.micButtonPress()))}};t.ToggleScreenShareCommand=class{constructor(e,t){this._callInfo=e,this._screenSharing=t}canExecute(){return r.default.CallingFeaturesHelper.allowScreenSharing(this._callInfo)}execute(){const e=I.default.newCauseId();m.log(C.LogTraceArea.CallMonitor,`ToggleScreenShareCommand.execute causeId: ${e}`),this._screenSharing?r.default.CallMonitorService.onStopSharing(e):r.default.CallMonitorService.onSwitchToMainView(e).then((()=>{r.default.CallMonitorService.onStartSharing(e)}),(t=>{m.warn(C.LogTraceArea.CallMonitor,`CallMonitorCallControls.onSwitchToMainView failed ${T.default.errorAsString(t)} causeId: ${e}`)}))}};t.EndCallCommand=class{constructor(e,t){this._callId=e,this._failedHandler=t}execute(){const e=I.default.newCauseId();m.log(C.LogTraceArea.CallingUI,`EndCallCommand.execute causeId: ${e}`),r.default.CallingStore.endCall(this._callId,e).catch((t=>{m.warn(C.LogTraceArea.CallingUI,`EndCallCommand: endCall failed: ${T.default.errorAsString(t)} causeId: ${e}`),this._failedHandler&&this._failedHandler(e)}))}};t.EndCallForEveryoneCommand=class{constructor(e,t,i,a){this._callId=e,this._callInfo=t,this._callUIState=i,this._failedHandler=a}canExecute(){const e=r.default.CallingStore.isCallHostless(this._callId),t=r.default.CallingFeaturesHelper.allowEndCallForEveryone(this._callInfo);return this._callUIState!==u.CallUIState.IncomingRing&&this._callUIState!==u.CallUIState.OutgoingRing&&(e&&t)}execute(){const e=I.default.newCauseId();m.log(C.LogTraceArea.CallingUI,`EndCallForEveryoneCommand.execute causeId: ${e}`),r.default.CallingStore.endCallForEveryone(this._callId,e).catch((t=>{m.warn(C.LogTraceArea.CallingUI,`EndCallForEveryoneCommand: endCall failed: ${T.default.errorAsString(t)} causeId: ${e}`),this._failedHandler&&this._failedHandler(e)}))}};t.MuteEveryoneCommand=class{constructor(e){this._callId=e}canExecute(){const e=r.default.CallingStore.getCallConversationMri(this._callId),t=e&&(0,g.default)().getConversation(e);return(!!e&&l.default.getActiveParticipants(this._callId,e).length)>1&&(0,S.isCurrentUserAdminInModeratedGroup)(t)}execute(){this.canExecute()?r.default.CallingStore.muteParticipants(this._callId,n.MuteScope.All,[],I.default.newCauseId()):m.error(C.LogTraceArea.CallingUI,"[MuteEveryoneCommand] tried execute muting everyone but canExecute is false")}};t.ChangeCallLayoutCommand=class{constructor(e,t,i){this._callInfo=e,this._isIncomingOrOutgoingRing=t,this._fromStageMode=i}canExecute(){return!(!this._callInfo.conversationMri||!this._callInfo.callId)&&(!this._isIncomingOrOutgoingRing&&r.default.CallingStore.getRemoteCallMembers(this._callInfo.callId).length>0)}canExecuteForStageMode(e){switch(e){case u.StageMode.TogetherMode:return r.default.CallingFeaturesHelper.allowCallAudienceBot(this._callInfo);case u.StageMode.LargeGrid:return r.default.CallingFeaturesHelper.allowCallGridViewBot(this._callInfo);default:return!0}}execute(e){const t=I.default.newCauseId();if(m.log(C.LogTraceArea.CallingUI,`ChangeCallLayoutCommand.execute switching stage mode from'\n            + '${u.StageMode[this._fromStageMode]} to ${u.StageMode[e]} causeId ${t}`),!this._callInfo.callId)return void m.error(C.LogTraceArea.CallingUI,`ChangeCallLayoutCommand.execute no callId causeId ${t}`);const i=o.Defer();let a=!0;if(e===u.StageMode.TogetherMode)a=this._handleTogetherModeStage(i,this._callInfo.callId,t);else if(e===u.StageMode.LargeGrid){r.default.CallingStore.isPossiblyNotConnectedGridViewBotInCall(this._callInfo.callId)||(a=!1,r.default.InCallBotService.startGridViewMode(this._callInfo.callId,t).then((()=>{i.resolve()})).catch((e=>{i.reject("failed to start GridViewMode: "+e)})))}a&&i.resolve(),i.promise().then((()=>{this._callInfo.callId?(c.default.setStageMode(this._callInfo.callId,e,t),h.default.announceStageMode(e)):m.error(C.LogTraceArea.CallingUI,`ChangeCallLayoutCommand.execute no callId causeId ${t}`)})).catch((e=>{m.warn(C.LogTraceArea.CallingUI,`ChangeCallLayoutCommand.execute ${e} causeId ${t}`)}))}_handleTogetherModeStage(e,t,i){if(r.default.CallingStore.isPossiblyNotConnectedAudienceBotInCall(t))return!0;const n=n=>{r.default.InCallBotService.startAudienceMode(t,i).then((()=>{a.isUndefined(n)||r.default.AudienceBotService.selectAudienceScene(t,i,n.sceneId),e.resolve()})).catch((t=>{e.reject("failed to start AudienceMode:"+t)}))},{enabledBackgroundSelection:o}=s.default.getS4LCMCFeatures().callAudienceBotConfig;if(!o)return n(void 0),!1;const l=w.default.getTogetherModeBackgrounds();if(a.isEmpty(l))return m.warn(C.LogTraceArea.CallingUI,"ChangeCallLayoutCommand.execute no TogetherMode backgrounds to choose from"),n(void 0),!1;const c={conversationMri:this._callInfo.conversationMri,onChangeBackground:n,onStartTogetherMode:n,onClose:()=>{e.reject("Together Mode Panel got closed")},isAudienceBotInCall:!1,selectedBackground:undefined};return _.default.navigateToTogetherModePanel(c,w.default.getPanelId()),!1}};t.ToggleVideoCommand=class{constructor(e,t){this._callId=e,this._callInfo=t}canExecute(){return r.default.CallingFeaturesHelper.allowOutboundVideo(this._callInfo)}execute(){const e=I.default.newCauseId();if(m.log(C.LogTraceArea.CallMonitor,`ToggleVideoCommand.execute causeId: ${e}`),p.default.isVideoSuggestionTooltipVisible(this._callId)){const e=y.default.getUserPreferencesLocalNoSubscription().videoSuggestionTooltipInteractionCount||0;y.default.setUserPreferencesLocal({videoSuggestionTooltipInteractionCount:e+1}),d.default.updateVideoSuggestionTooltipEvent((e=>{e.markDidTurnOnVideo()})),p.default.setVideoSuggestionTooltipVisibility(this._callId,!1)}r.default.CallControlsStore.toggleVideo(this._callId,e)}};t.RequestScreenShareCommand=class{constructor(e){this._screenShareControl=e}canExecute(){return void 0!==this._screenShareControl&&this._screenShareControl.canRequestControl()}execute(){return this._screenShareControl?this._screenShareControl.requestControl().then((()=>{m.log(C.LogTraceArea.ScreenSharing,"request control succeeded")})).catch((e=>{m.log(C.LogTraceArea.ScreenSharing,`request control failed with ${T.default.errorAsString(e)}`)})):o.Resolved()}};t.StopScreenShareCommand=class{constructor(e){this._screenShareControl=e,this.viewerInControl=this._screenShareControl?this._screenShareControl.viewerInControl():void 0}canExecute(){return void 0!==this.viewerInControl&&f.default.isMyMri(this.viewerInControl.mri)}execute(){return this._screenShareControl&&this.viewerInControl?this._screenShareControl.terminateControl(this.viewerInControl.mri).then((()=>{m.log(C.LogTraceArea.ScreenSharing,"terminate control succeeded")})).catch((e=>{m.log(C.LogTraceArea.ScreenSharing,`terminate control failed with ${T.default.errorAsString(e)}`)})):o.Resolved()}}},50604:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(16778),o=i(89391),s=i(75492),r=i(94224),l=i(2278),c=i(80200),d=i(71727),u=i(3493),h=i(98278),p=i(77381),g=i(11734),C=i(52293),m=i(53211),S=i(57139),y=i(46096),f=i(36237),_=i(78735),b=i(29130),T=(i(86045),i(76)),v=i(93194),w=i(81760),I=i(53374),P=i(73877),M=50,k=w.Color.whiteOverlay30,A=b.default.isSmallDeviceNoSubscription(h.MainRootViewId)?3:4;class R extends p.default{constructor(){super(...arguments),this._recentActions=[]}static menuHeight(e){const t=this._stateForProps(e);let i=0;if(t.toggleItems&&(i+=M*t.toggleItems.length),t.listItems&&(i+=M*t.listItems.length),t.rowButtonsItems&&(i+=M*t.rowButtonsItems.length),i>0){const e={marginTop:8,marginBottom:8};i+=g.default.rowHeight(e)}const a=t.buttonItems;return a&&(a.length>2?i+=C.default.rowHeight(a.length,A):i+=a.length*M),i}static _stateForProps(e){const t=u.default.getCelebrationData(e.conversationMri,e.callId),i=r.default.DeviceStore.isBackgroundBlurEnabled(),a=r.default.DeviceStore.getNoiseSuppressionMode(),n={celebrationData:t,isIncomingVideoDisabled:r.default.CallingStore.isIncomingVideoDisabled(e.callId),isAudioOnlyEnabled:r.default.CallingStore.isAudioOnly(e.callId),noiseSuppressionMode:a,isTranslating:r.default.InCallBotService.isTranslating(e.callId),isRecording:r.default.CallingStore.isRecording(e.callId),isAudienceMode:r.default.CallingStore.isFullscreenBotInCall(e.callId),isScreenShareActive:r.default.CallingStore.isScreenSharing(e.callId),isVideoActive:r.default.CallingStore.isProvidingVideo(e.callId),isBackroundBlurEnabled:i,isBackgroundBlurSelected:r.default.DeviceStore.isBackgroundBlurred(),isBackgroundBlurNewItem:i&&o.default.getS4LCMCFeatures().enableBackgroundBlurNewLabel&&!1},s=Object.assign(Object.assign({},e),n);return n.toggleItems=d.default.overflowMenuToggleDescriptors(s),n.listItems=d.default.overflowMenuListDescriptors(s),n.rowButtonsItems=d.default.overflowMenuRowButtonsDescriptors(s),n.buttonItems=d.default.overflowMenuButtonDescriptors(s,e.callerContext()),n}_buildState(e,t){return R._stateForProps(e)}componentDidMount(){super.componentDidMount();const e=I.default.newCauseId();f.log(y.LogTraceArea.CallingUI,`CallControlsCustomActionMenu.componentDidMount Menu open causeId: ${e}`),s.default.setOverflowMenuVisiblity(!0,e)}componentWillUnmount(){super.componentWillUnmount();const e=I.default.newCauseId();f.log(y.LogTraceArea.CallingUI,`CallControlsCustomActionMenu.componentWillUnMount Menu close causeId: ${e}`),s.default.setOverflowMenuVisiblity(!1,e),l.default.trackOverflowMenuActions(this._recentActions),this.state.isBackroundBlurEnabled&&this.state.isBackgroundBlurNewItem&&_.default.setUserPreferencesLocal(Object.assign({},{}))}_executeDescriptorAndClose(e,t){this._executeDescriptor(e,t),f.log(y.LogTraceArea.CallingUI,`CallControlsCustomActionMenu.ClosingMenu causeId: ${t}`),S.default.close(this._getRootViewId(),t)}_expandList(e,t){const i=c.CallControlsOverflowItem[e.key];f.log(y.LogTraceArea.CallingUI,`CallControlsCustomActionMenu ${i} causeId: ${t}`);const a={anchor:()=>{},useTheme:!0,positionPriorities:["bottom","top"]};return v.default.showWithOptions({id:"listContextMenuItem",config:a,getMenuItems:()=>e.menuItems.map((e=>({text:e.label,command:e.value,isCheckbox:!0}))),handleMenuCommand:t=>{t!==v.SXActionMenuCancel&&(this._recentActions.push(i),e.onItemSelected(t))},rootViewId:this._getRootViewId(),invokingEvent:void 0})}_executeDescriptor(e,t){if(e.onPress){const i=c.CallControlsOverflowItem[e.key];f.log(y.LogTraceArea.CallingUI,`CallControlsCustomActionMenu ${i} causeId: ${t}`),this._recentActions.push(i),e.onPress()}}_createOnRowButtonPress(e){return()=>{const t=I.default.newCauseId();f.log(y.LogTraceArea.CallingUI,`CallControlsCustomActionMenu.Button.onRowPress causeId: ${t}`),S.default.close(this._getRootViewId(),t),this._executeDescriptor(e,t)}}render(){const e=[];if(a.each(this.state.toggleItems,(t=>{const i={key:t.key,disabled:!!t.disabled,rowType:m.CustomActionMenuRowType.Toggle,isSelected:t.selected,accessibilityLabel:t.accessibilityLabel||t.title,titleText:t.title,onRowPress:()=>{const e=I.default.newCauseId();f.log(y.LogTraceArea.CallingUI,`CallControlsCustomActionMenu.Toggle.onRowPress causeId: ${e}`),this._executeDescriptor(t,e)},rowHeight:M,hideBorder:!0,icon:a.isArray(t.icon)?t.icon[0].icon:t.icon.icon,toggleOverlayColorAndroid:w.Color.black,isNew:!!t.isNew};e.push({props:i,builder:m.default.buildRow})})),a.each(this.state.listItems,(t=>{const i={key:t.key,disabled:!!t.disabled,rowType:m.CustomActionMenuRowType.List,listLabel:t.listLabel,accessibilityLabel:t.accessibilityLabel||t.title,titleText:t.title,onRowPress:()=>{const e=I.default.newCauseId();this._expandList(t,e)},rowHeight:M,hideBorder:!0,icon:a.isArray(t.icon)?t.icon[0].icon:t.icon.icon,toggleOverlayColorAndroid:w.Color.black,isNew:!!t.isNew};e.push({props:i,builder:m.default.buildRow})})),a.each(this.state.rowButtonsItems,(t=>{const i={key:t.key,rowType:m.CustomActionMenuRowType.Default,accessibilityLabel:t.accessibilityLabel||t.title,titleText:t.title,onRowPress:this._createOnRowButtonPress(t),rowHeight:M,hideBorder:!0,icon:a.isArray(t.icon)?t.icon[0].icon:t.icon.icon};e.push({props:i,builder:m.default.buildRow})})),e.length){const t={marginTop:8,marginBottom:8},i=Object.assign(Object.assign({},t),{key:"divider",rowHeight:g.default.rowHeight(t),color:k});e.push({props:i,builder:g.default.buildRow})}const t=this.state.buttonItems;if(t.length-a.filter(t,(e=>!!e.doesNotInfluenceMenuLayout)).length>2){const i={key:"grid",buttonDescriptors:a.map(t,(e=>Object.assign(Object.assign({},e),{onPress:()=>{const t=I.default.newCauseId();f.log(y.LogTraceArea.CallingUI,`CallControlsCustomActionMenu.Button.onPress causeId: ${t}`),this._executeDescriptorAndClose(e,t)}}))),rowHeight:C.default.rowHeight(t.length),columnCount:A,estimatedWidth:P.default.measureWindow(this._getRootViewId()).width};e.push({props:i,builder:C.default.buildRow})}else a.each(t,(t=>{const i={key:t.key,accessibilityLabel:t.accessibilityLabel||t.title,titleText:t.title,onRowPress:()=>{const e=I.default.newCauseId();f.log(y.LogTraceArea.CallingUI,`CallControlsCustomActionMenu.Button.onRowPress causeId: ${e}`),this._executeDescriptorAndClose(t,e)},rowHeight:M,hideBorder:!0,icon:a.isArray(t.icon)?t.icon[0].icon:t.icon.icon};e.push({props:i,builder:m.default.buildRow})}));return n.createElement(T.default,{rowBuilders:e,colorThemeOverride:this.props.colorThemeOverride})}}t.default=R},50646:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(63297),o=i(31844),s=i(16778),r=i(48540),l=i(89391),c=i(80843),d=i(68894),u=i(60787),h=i(20187),p=i(94224),g=i(12614),C=i(78968),m=i(9520),S=i(2278),y=i(80200),f=i(71727),_=i(47447),b=i(3493),T=i(71830),v=i(11009),w=i(47204),I=i(98278),P=i(18644),M=i(84912),k=i(97081),A=i(37490),R=i(46096),V=i(5581),L=i(36237),E=i(48638),B=i(72490),O=i(15877),D=i(33754),x=i(98977),N=i(89808),U=i(78735),F=i(4735),H=i(7153),z=i(17093),G=i(98053),W=i(64956),K=i(99189),j=i(90244),Q=i(54306),$=i(86045),q=i(4057),X=i(93194),Z=i(15415),J=i(81760),Y=i(11010),ee=i(11828),te=i(78262),ie=i(80837),ae=i(24576),ne=i(66123),oe=i(53374),se=i(65123),re=i(88154),le="_screenSharingModalId",ce=u.CallButtonSize.Small,de=(0,O.lazyProperties)({spinner:()=>s.Styles.createViewStyle({minWidth:80,alignItems:"center",flex:1,justifyContent:"center",overflow:"visible"}),spinnerMargin:()=>s.Styles.createViewStyle({margin:6,overflow:"visible"}),container:()=>s.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"space-between",flexDirection:"row",overflow:"visible"}),chatPanelButton:()=>s.Styles.createViewStyle({alignItems:"center",overflow:"visible"}),reactionsPickerButton:()=>s.Styles.createViewStyle({overflow:"visible",alignItems:"center",justifyContent:"center",width:70}),secondaryControlsContainer:()=>s.Styles.createViewStyle({flexDirection:"row",alignItems:"center",flexBasis:"50%",flexGrow:1,flexShrink:1,overflow:"visible"}),secondaryControlsContainerRight:()=>s.Styles.createViewStyle({justifyContent:"flex-end"}),caption:()=>s.Styles.createTextStyle({textAlign:"center",fontSize:Y.default.controlFontSize.caption,paddingHorizontal:10,color:J.Color.white}),raiseHandImageWrapper:()=>s.Styles.createViewStyle({position:"absolute",top:-7,left:3,overflow:"visible"}),customCallReactionsButton:()=>s.Styles.createViewStyle({position:"absolute",bottom:8,right:0,overflow:"visible"}),hoverStyleLight:()=>[s.Styles.createButtonStyle({backgroundColor:J.Color.gray100})],hoverStyleDark:()=>[s.Styles.createButtonStyle({backgroundColor:J.Color.black})],tooltipStyleDark:()=>s.Styles.createViewStyle({backgroundColor:J.Color.gray400,paddingHorizontal:14,paddingVertical:7})}),ue={style:de.tooltipStyleDark,showArrow:!0,arrowColor:J.Color.gray400,containerOffsetY:8};class he extends ae.default{constructor(){super(...arguments),this._overflowMenuId=X.default.menuId(),this._screenshareOverflowMenuId=X.default.menuId(),this._secondaryCallControlsManager=new k.DesktopSecondaryCallControlsManager,this._onReactionsPickerHovered=e=>{a.delay((()=>{!this.state.isReactionsPickerSelected&&e&&this.props.onReactionPickerButtonHover()}),50)},this._setMainCallControlsRef=e=>{this._mainCallControls=e},this._getShareCallLinkButton=()=>s.createElement(se.default,{colorConfig:this._colorConfig(),isShowingAloneInCall:this.props.isShowingAloneInCall,conversationMri:this.props.conversationMri,callId:this.props.callId,isShowingRecents:this.props.isShowingRecents,useLightTheme:this.props.useLightTheme,callButtonSize:ce}),this._getShareQRButton=e=>{const t=D.getString("MeetNowCallControls.TwinCam"),i=this._hideCaption()?void 0:t,a=this._colorConfig();return a.hoverIcon=ee.SkypeIcon.TwinCamMidGradient,s.createElement(re.default,{colorConfig:a,conversationMri:this.props.conversationMri,callId:this.props.callId,isDisabled:!this.state.allowTwinCam,isShowingRecents:this.props.isShowingRecents,callButtonSize:ce,caption:i,title:t,showToolTip:!i,toolTipConfig:ue,onStopTwinCamPressed:()=>this._twinCamCommand.execute(!0),isTwinCamConnected:e})},this._getRequestScreenShareControlButton=()=>{const e=D.getString("CallControls.CallButtonRequestScreenShareControl"),t=this._hideCaption()?void 0:e,i=this._colorConfig();return s.createElement(u.CallButton,{key:y.CallControlsKeys.ScreenShareControl,icon:ee.SkypeIcon.ScreenSharingRequestControl,accessibilityLabel:e,caption:t,title:e,size:ce,anchorAccessibilityLabel:e,colorConfig:i,onPress:()=>this._requestScreenShareCommand.execute(),showToolTip:!t,toolTipConfig:ue})},this._getStopScreenShareControlButton=()=>{const e=D.getString("CallControls.CallButtonStopScreenShareControlFromViewer"),t=this._hideCaption()?void 0:e;return s.createElement(u.CallButton,{key:y.CallControlsKeys.ScreenShareControl,icon:ee.SkypeIcon.ScreenSharingStopControl,accessibilityLabel:e,caption:t,title:e,size:ce,anchorAccessibilityLabel:e,colorConfig:this._colorConfig(),onPress:()=>this._stopScreenShareCommand.execute(),showToolTip:!t,toolTipConfig:ue})},this._getScreenShareControlRequestInProgressIndicator=()=>{let e=s.createElement(Z.default,{style:ie.default.overflowVisible,size:I.SXActivityIndicatorSize.Small,useRXIndicator:!0});return e=s.createElement(s.View,{style:de.spinnerMargin},e),s.createElement(s.View,{style:de.spinner},e,s.createElement(s.Text,{style:de.caption},D.getString("CallControls.ScreenShareControlRequesting")))},this._onChatPanelButtonPress=()=>{const e=oe.default.newCauseId();L.log(R.LogTraceArea.CallingUI,"_onChatPanelButtonPress causeId: "+e),this.props.onChatPanelButtonPress(e)},this._onRaiseHandPressed=()=>{this.setState({isRaisedHandDisabled:!0}),this._raiseHandCommand.execute().finally((()=>{this.setState({isRaisedHandDisabled:!1})}))},this._onLowerHandPressed=()=>{this.setState({isRaisedHandDisabled:!0}),this._lowerHandCommand.execute().finally((()=>{this.setState({isRaisedHandDisabled:!1})}))},this._onOverflowMenuButtonRef=e=>{this._overflowButton=e||void 0},this._onScreenShareOverflowMenuButtonRef=e=>{this._screenShareOverflowMenuButton=e||void 0},this._onCallReactionsDrawerItemRef=e=>{this._reactionsEntryPoint=e||void 0,this._setEngagementTooltipAnchor(e)},this._setEngagementTooltipAnchor=e=>{c.default.setAnchor(d.EngagementTooltipType.CallReactionsBar,e)},this._onReactionsPickerPressed=()=>{this.props.onReactionsPickerButtonPress(),this.props.onInteracting(this.state.isReactionsPickerSelected)},this._onParticipantsButtonPress=()=>{const e=oe.default.newCauseId();L.log(R.LogTraceArea.CallingUI,"DesktopCallControls._onParticipantsButtonPress "+e),this.props.onShowParticipants(e,y.CallRosterOrigin.CallControls,this.state.isHandRaised)},this._onAddParticipantsButtonPress=()=>{const e=oe.default.newCauseId();L.log(R.LogTraceArea.CallingUI,"DesktopCallControls._onAddParticipantsButtonPress "+e),this.props.onAddToCall(e,R.NavigationAddToCallOrigin.CallControls)},this._onLiveCaptionsButtonPress=()=>{const e=oe.default.newCauseId();L.log(R.LogTraceArea.CallingUI,"DesktopCallControls._onLiveCaptionsButtonPress "+e),this.state.isCaptioning?F.default.navigateToCallCaptionsSettingsPanel(this.props.callId,this.props.conversationMri,this._getRootViewId()):this._startTranslator()},this._onTogetherModeBackgroundChangeButtonPress=()=>{this._changeTogetherModeBackgroundCommand.execute()},this._getOverflowMenuConfig=e=>({anchor:e,useTheme:!0,positionPriorities:["top","bottom"],popupBeakSize:{height:0,width:0},popupOffset:{x:0,y:-10}}),this._showOverflowMenuPopup=e=>{const t=this._getOverflowMenuConfig(this._getAnchorForOverflowMenu);X.default.showWithOptions({id:this._overflowMenuId,config:t,getMenuItems:this._getOverflowMenuItems,handleMenuCommand:this._selectOverflowMenuItem,onDismiss:this._overflowMenuDismissed,rootViewId:this._getRootViewId(),invokingEvent:e})},this._overflowMenuDismissed=()=>{S.default.trackOverflowMenuActions([])},this._getOverflowMenuItems=()=>this._getOverflowMenuItemsForCommands(this._secondaryCallControlsManager.getOverflowControls()),this._getActiveScreenShareOverflowItems=()=>{const e=[k.OverflowMenuCommands.ConfirmStopSharing];return p.default.CallingFeaturesHelper.allowSwitchingScreenSharing()&&e.push(k.OverflowMenuCommands.SwitchScreen),this._getOverflowMenuItemsForCommands(e)},this._getReactionPickerText=()=>this.state.isReactionsPickerSelected?D.getString("ReactionsStream.ReactionBarCloseDrawerTitle"):D.getString("ReactionsStream.ReactionBarOpenDrawerTitle"),this._getScreenshareButtonTooltip=()=>this.state.isScreenShareActive?D.getString("CallControlsOverFlowMenu.StopShareScreen"):D.getString("CallControlsOverFlowMenu.ShareScreen"),this._getSnapshotText=()=>D.getString("CallReactionsBar.PhotoSnapshotButtonShortTitle"),this._selectOverflowMenuItem=e=>{const t=oe.default.newCauseId();L.log(R.LogTraceArea.CallingUI,"DesktopCallControls._selectOverflowMenuItem "+t);const i=this._getRootViewId();switch(X.default.dismiss(this._overflowMenuId,i),X.default.dismiss(this._screenshareOverflowMenuId,i),S.default.trackOverflowMenuActions([e]),e){case k.OverflowMenuCommands.Blur:p.default.DeviceStore.setBackgroundBlurred(!0),L.track(new m.LocalVideoActionsEvent(m.LocalVideoActions.BackgroundBlur));break;case k.OverflowMenuCommands.Unblur:p.default.DeviceStore.setBackgroundBlurred(!1),L.track(new m.LocalVideoActionsEvent(m.LocalVideoActions.BackgroundUnBlur));break;case k.OverflowMenuCommands.OnAddToCall:this.props.onAddToCall(t,R.NavigationAddToCallOrigin.OverflowMenu);break;case k.OverflowMenuCommands.OnShowParticipants:this.props.onShowParticipants(t,y.CallRosterOrigin.OverflowMenu,!1);break;case k.OverflowMenuCommands.BackgroundEffectsSettings:case k.OverflowMenuCommands.OnShowAVSettings:this._showAVSettings();break;case k.OverflowMenuCommands.OnShowAudioSettings:this._showAudioSettings();break;case k.OverflowMenuCommands.ShareScreen:this._onNewScreenShareButtonPress(void 0,t);break;case k.OverflowMenuCommands.ShareScreenAndSounds:this.state.isScreenShareActive?this._startSoundSharing():this._openScreenSharingModal(!0,t);break;case k.OverflowMenuCommands.ConfirmStopSharing:case k.OverflowMenuCommands.StopSharing:this._stopScreenSharing();break;case k.OverflowMenuCommands.SwitchScreen:this._onSwitchScreen(t);break;case k.OverflowMenuCommands.ScreenShareControl:this._requestScreenShareCommand.execute();break;case k.OverflowMenuCommands.StopScreenShareControl:this._stopScreenShareCommand.execute();break;case k.OverflowMenuCommands.HoldCall:case k.OverflowMenuCommands.ResumeCall:this._toggleHoldState();break;case k.OverflowMenuCommands.StartRecording:this._startRecording();break;case k.OverflowMenuCommands.StopRecording:this._stopRecording();break;case k.OverflowMenuCommands.StartCaptions:this._startTranslator();break;case k.OverflowMenuCommands.StopCaptions:this._stopTranslator();break;case k.OverflowMenuCommands.LiveCaptions:case k.OverflowMenuCommands.LiveCaptionsSettings:this._onLiveCaptionsButtonPress();break;case k.OverflowMenuCommands.EnableIncomingVideo:this._enableIncomingVideo();break;case k.OverflowMenuCommands.DisableIncomingVideo:this._disableIncomingVideo();break;case X.SXActionMenuCancel:break;case k.OverflowMenuCommands.Snap:this.props.onMomentsPress();break;case k.OverflowMenuCommands.React:this._onReactionsPickerPressed();break;case k.OverflowMenuCommands.CustomReact:break;case k.OverflowMenuCommands.CallStats:this._onCallStatsPressed();break;case k.OverflowMenuCommands.Invite:this._invitePeopleCommand.execute();break;case k.OverflowMenuCommands.MuteEveryone:this._muteEveryoneCommand.execute(),L.track(new m.CallMuteEveryoneEvent(m.MuteEveryoneOrigin.OverflowMenu));break;case k.OverflowMenuCommands.RaiseHand:this._onRaiseHandPressed();break;case k.OverflowMenuCommands.LowerHand:this._onLowerHandPressed();break;case k.OverflowMenuCommands.ChangeTogetherModeBackground:this._onTogetherModeBackgroundChangeButtonPress();break;case k.OverflowMenuCommands.TwinCam:this._onTwinCamButtonPress();break;case k.OverflowMenuCommands.StopTwinCam:this._onTwinCamButtonPress(!0)}},this._getAnchorForOverflowMenu=()=>this._overflowButton,this._getAnchorForActiveScreenShareOverflowMenu=()=>this._screenShareOverflowMenuButton,this._toggleHoldState=()=>{const e=oe.default.newCauseId(),t=p.default.ActiveCallUIHelper.connectedToActiveCall(this.props.conversationMri),i=t?"HOLD":"RESUME";if(L.log(R.LogTraceArea.CallingUI,"DesktopCallControls._toggleHoldState to "+i+" causeId: "+e),t)p.default.CallingStore.hold(this.props.callId,e);else{const t=()=>p.default.CallingStore.unhold(this.props.callId,e);this.state.connectedAndNotOnHoldCallId&&this.state.connectedAndNotOnHoldCallId!==this.props.callId?p.default.CallingStore.hold(this.state.connectedAndNotOnHoldCallId,e).then(t):t()}},this._onCallStatsPressed=()=>{this._callStatsCommand.execute()},this._onTwinCamButtonPress=(e=!1)=>{S.default.onShowShareTwinCamConnection(this.props.callId),this._twinCamCommand&&this._twinCamCommand.canExecute()&&this._twinCamCommand.execute(e)},this._onNewScreenShareButtonPress=(e,t)=>{const i=t||oe.default.newCauseId();L.log(R.LogTraceArea.CallingUI,"_onNewScreenShareButtonPress causeId: "+i),p.default.CallingFeaturesHelper.isScreenSharingPermissionEnabled(i).then((t=>{if(t)if(this.state.isScreenShareActive)if(this.state.numberAvailableScreens>1||this.state.windowSharingEnabled){const t=this._getOverflowMenuConfig(this._getAnchorForActiveScreenShareOverflowMenu);X.default.showWithOptions({id:this._screenshareOverflowMenuId,config:t,getMenuItems:this._getActiveScreenShareOverflowItems,handleMenuCommand:this._selectOverflowMenuItem,onDismiss:this._overflowMenuDismissed,rootViewId:this._getRootViewId(),invokingEvent:e})}else this._stopScreenSharing();else this._onShareScreen(i);else W.default.showDeniedPromptWithSettingsOption(te.PermissionType.ScreenRecording,this._getRootViewId(),o.default.openScreenRecordingPrivacyPane)}))},this._openScreenSharingModal=(e,t)=>{L.log(R.LogTraceArea.CallingUI,"DesktopCallControls._openScreenSharingModal causeId: "+t),S.default.updateCallTelemetry(this.props.callId,t,(e=>e.displayScreenSharingDialogCount())),A.dismissAll(),L.log(R.LogTraceArea.CallingUI,"got windows count 0 will navigate to screen share panel"),F.default.navigateToScreenSharePanel({conversationMri:this.props.conversationMri,currentScreenSharingSource:this._currentScreenSharingSource,currentScreenSharingSourceType:this._currentScreenSharingSourceType,isScreenSharingActive:this.state.isScreenShareActive,onSelectSource:this._selectScreenShareSource,onClose:this._closeScreenSharingModal,shareSounds:e},le)},this._showAVSettings=()=>{const e=oe.default.newCauseId();L.log(R.LogTraceArea.CallingUI,"DesktopCallControls._showAVSettings causeId: "+e),F.default.navigateToDesktopSettingsGroup(z.SettingsGroup.AudioVideoSettings,this._getRootViewId(),e)},this._showAudioSettings=()=>{const e=oe.default.newCauseId();L.log(R.LogTraceArea.CallingUI,"DesktopCallControls._showAudioSettings causeId: "+e),F.default.navigateToDesktopSettingsGroup(z.SettingsGroup.AudioSettings,this._getRootViewId(),e)},this._closeScreenSharingModal=()=>{w.default.dismissModal(le,this._getRootViewId())},this._selectScreenShareSource=(e,t,i)=>{const a=oe.default.newCauseId();if(L.log(R.LogTraceArea.CallingUI,"DesktopCallControls._selectScreenShareSource causeId: "+a),S.default.updateCallTelemetry(this.props.callId,a,(e=>e.didUserDisplayScreenSharingDialog())),this.state.isScreenShareActive){if(this._currentScreenSharingSource&&e.getId()===this._currentScreenSharingSource.getId())return void this._closeScreenSharingModal();p.default.CallingStore.setSwitchingScreen(!0),p.default.CallingStore.stopScreenSharing(this.props.callId,a).then((()=>{p.default.CallingStore.startScreenSharing(this.props.callId,a,e,t).then((()=>p.default.CallingStore.setSwitchingScreen(!1))),this._currentScreenSharingSource=e,this._currentScreenSharingSourceType=i})),this._incrementSourceTypeTelemetryCounts(i,a),S.default.updateCallTelemetry(this.props.callId,a,(e=>e.switchScreenWhileSharing()))}else this._startScreenSharing(a,t,e,i);$.default.maybeAnnounceForAccessibility(D.getString("AccessibilityLabel.ScreenShareStarted")),this._closeScreenSharingModal()},this._stopScreenSharing=()=>{const e=oe.default.newCauseId();L.log(R.LogTraceArea.CallingUI,"DesktopCallControls._stopScreenSharing causeId: "+e);const t=p.default.CallingStore.stopScreenSharing(this.props.callId,e,x.StopSharingOrigin.CallView);return $.default.maybeAnnounceForAccessibility(D.getString("AccessibilityLabel.ScreenShareStopped")),this._currentScreenSharingSource=void 0,this._currentScreenSharingSourceType=void 0,S.default.updateCallTelemetry(this.props.callId,e,(e=>e.stopScreenSharing())),this._shouldDisableVideoDuringScreenSharing()&&this.props.showHideOutgoingVideoDisabledToast(!1,e),t},this._startSoundSharing=()=>{const e=oe.default.newCauseId();L.log(R.LogTraceArea.CallingUI,"DesktopCallControls._startSoundSharing causeId: "+e),p.default.CallingStore.startSoundSharing(this.props.callId,e).then((()=>{S.default.updateCallTelemetry(this.props.callId,e,(e=>e.startSoundSharing()))}))},this._togglePstnDialpadShortcut=(e,t)=>!(t!==this._getRootViewId()||!this.props.isPSTNCall)&&(this.props.onOpenDialpad(),!0),this._toggleCallStatsShortcut=(e,t)=>t===this._getRootViewId()&&(this._onCallStatsPressed(),!0),this._onScreenShareEvent=(e,t)=>{this._openScreenSharingModal(e,t)},this._mediaActionEvent=e=>{p.default.CallingStore.getOutgoingCallIds().indexOf(this.props.callId)>=0?(L.track(new m.MediaActionEvent(m.CallControlContext.DesktopCallControls,m.MediaActionEventResult.EndCall)),L.log(R.LogTraceArea.CallingUI,"DesktopCallControls._mediaActionEvent ending call (causeId: "+e+")"),p.default.CallingStore.endCall(this.props.callId,e)):(L.track(new m.MediaActionEvent(m.CallControlContext.DesktopCallControls,m.MediaActionEventResult.Ignore)),L.log(R.LogTraceArea.CallingUI,"DesktopCallControls._mediaActionEvent no action (causeId: "+e+")"))}}_buildState(e,t){var i,a,n,o;this._callStatsCommand=new G.ToggleCallStatsCommand(e.callId,this._getContext()),this._twinCamCommand=new G.TwinCamCommand(e.callId,{conversationMri:e.conversationMri,callId:e.callId,isPSTNCall:e.isPSTNCall,isEncryptedCall:e.isEncryptedCall}),this._muteEveryoneCommand=new h.MuteEveryoneCommand(e.callId),this._changeTogetherModeBackgroundCommand=new G.ChangeTogetherModeBackgroundCommand(e.callId,e.conversationMri),this._invitePeopleCommand=new G.InvitePeopleCommand(e.conversationMri,this._getRootViewId());const s=p.default.CallingStore.isRecording(e.callId),c=p.default.InCallBotService.isTranslating(e.callId),d=p.default.InCallBotService.isCaptioningEnabled(e.callId),u=p.default.CallingStore.isIncomingVideoDisabled(e.callId),g=p.default.CallingStore.isAudioOnly(e.callId),C=l.default.getS4LCMCFeatures(),m=C.customCallReactions,S=C.enableNewCustomCallReactions,v=p.default.CallingStore.getCallRecordingInitiator(e.callId),w=b.default.getCelebrationData(e.conversationMri,e.callId),I=e.callUIState===y.CallUIState.Default,P=p.default.CallingStore.getCallState(e.callId),M=P===r.CallState.Connected?p.default.ScreenSharingControlStoreRegistrar.getStoreFromCallId(e.callId):void 0;this._requestScreenShareCommand=new h.RequestScreenShareCommand(M),this._stopScreenShareCommand=new h.StopScreenShareCommand(M);const k=C.enableAllCallButtonsVisible,A=e.callUIState===y.CallUIState.Default||e.callUIState===y.CallUIState.OutgoingRing||e.callUIState===y.CallUIState.GoLiveSinglePlayer,R=k&&!T.isGroupConversation(e.conversationMri)&&!p.default.CallingFeaturesHelper.hasConnectedParticipants(e),L=p.default.CallingFeaturesHelper.allowRecording(e),B=L&&I,O=p.default.CallingFeaturesHelper.allowScreenSharing(e),D=O&&!R,x=O&&I;this._lowerHandCommand=new K.LowerHandCommand(e.callId,Q.LowerHandOrigin.CallControls),this._raiseHandCommand=new K.RaiseHandCommand(e.callId,e);const F=this._raiseHandCommand.isFeatureEnabled(),H=this._requestScreenShareCommand.canExecute(),z=this._stopScreenShareCommand.canExecute(),W=!e.isNewCallScreen&&this._changeTogetherModeBackgroundCommand.canExecute(),j=k?L&&A:B,$=k?O&&A:x,q=F,X=this._lowerHandCommand.canExecute(),Z=V.default.isConversationTranslated(e.conversationMri),J=p.default.InCallBotService.isPstnTranslationEnabled(e.callId),Y=I&&p.default.CallingFeaturesHelper.allowCaptioning(e)&&!Z&&!J,ee=p.default.CallingStore.getConnectedOrOutgoingAndNotOnHoldCallId(),te=p.default.DeviceStore.isBackgroundBlurCapable(),ie=p.default.CallingStore.isProvidingVideo(e.callId),ae=p.default.DeviceStore.isBackgroundReplacementEnabled(),ne=I&&p.default.CallingFeaturesHelper.allowIncomingVideoToBeDisabled(e),oe=this._muteEveryoneCommand.canExecute(),se=I&&p.default.CallingFeaturesHelper.allowHoldCall(e),re=p.default.CallingStore.isCallOnHoldResumeable(e.callId),le=this._callStatsCommand.canExecute(),ce=p.default.CallingStore.isOneOnOneCall(e.callId),de=p.default.CallingStore.isScreenSharing(e.callId),ue=p.default.DeviceStore.getAvailableScreens().length,he=_.CallingCapabilities.applicationSharingSupported(),pe=p.default.InCallBotUtils.isCallRecordingInitiator(v),ge=p.default.CallingFeaturesHelper.allowTwinCam(e),Ce=ge&&I,me=k?ge&&A:Ce,Se=null===(a=(i=p.default.CallingStore).hasConnectedTwinCam)||void 0===a?void 0:a.call(i,e.callId),ye=l.default.getS4LCMCFeatures().callCaptionsLiveButton,fe=Y&&ye,_e=null!==(o=null===(n=this.state)||void 0===n?void 0:n.isRaisedHandDisabled)&&void 0!==o&&o;let be={isVideoActive:ie,isScreenShareActive:de,isReactionsPickerSelected:!t&&!!this.state&&this.state.isReactionsPickerSelected,connectedAndNotOnHoldCallId:ee,isRecording:s,isIncomingVideoDisabled:u,audioOnlyEnabled:g,numberAvailableScreens:ue,emoticonReactionKey:f.default.getEmoticonReactionKey(w),useHighContrastTheme:f.default.useHighContrastThemeAndChanges(),lightThemeCallingStageEnabled:U.default.getLightThemeCallStageEnabled(),callState:P,isReceivingScreensharing:p.default.CallingStore.isReceivingScreenSharing(e.callId),isChatBadgeOn:this._isUnreadInCallIncomingMessageAndPhoto(),allowScreenSharing:k?D:x,allowRecording:B,isNavigatingWithKeyboard:E.default.isNavigatingWithKeyboard(),windowSharingEnabled:he,isMinDesktop:f.default.isMinDesktop(e.controlsType),canRequestScreenShareControl:H,canStopScreenShareControl:z,screenShareRequestControlInProgress:M&&M.requestControlInProgress(),isConnecting1on1:R,isHandRaisedForCurrentUser:X,isHandRaised:p.default.CallingStore.isAnyHandRaised(e.callId),isOneOnOneCall:ce,enableNewCustomCallReactions:S,showCustomizeReactionsPencilButton:m&&m.enabled&&!m.useNewAddEmojiIcon,allowTwinCam:Ce,userPrimaryColor:N.default.getPrimaryColor(),isTwinCamConnected:Se,isCaptioning:d,isConversationTranslated:Z,isPstnTranslationEnabled:J,isRaisedHandDisabled:_e};const Te={idealLeftControls:this._getIdealLeftControls(j,H,z,W,ce,me,Se,fe),idealRightControls:this._getIdealRightControls($,q,X,S),idealOverflowControls:this._getIdealOverflowControls(!1,Y,c,ee,te,ie,ae,ne,u,g,oe,se,re,le),leftControlForDesktopMinSmallest:this._getLeftControlForDesktopMinSmallest(),controlsType:e.controlsType,isOneOnOneCall:ce,isScreenShareActive:de,numberAvailableScreens:ue,windowSharingEnabled:he,canRequestScreenShareControl:H,allowRecording:B,isRecording:s,connectedAndNotOnHoldCallId:ee,callId:e.callId,isCallRecordingInitiator:pe,allowLiveCaptions:fe,isCaptioning:d};return this._secondaryCallControlsManager.configure(Te),be}componentDidMount(){super.componentDidMount(),this._screenSharingEventSub=p.default.dangerouslyGetCallNavigationUtils().screenSharePopupEvent.subscribe(this._onScreenShareEvent),this._mediaActionEventSub=n.default.mediaActionEvent.subscribe(this._mediaActionEvent),this._registerKeyboardHandlers()}UNSAFE_componentWillUpdate(e,t,i){if(super.UNSAFE_componentWillUpdate(e,t,i),this.state.isChatBadgeOn!==t.isChatBadgeOn&&L.log(R.LogTraceArea.CallingUI,"DesktopCallControls.UNSAFE_componentWillUpdate isChatBadgeOn changed from "+this.state.isChatBadgeOn+" to "+t.isChatBadgeOn),e.isShowingChat!==this.props.isShowingChat&&e.isShowingChat){const e=T.getReactionsThreadMriForCallId(this.props.callId);C.default.resetUnSeenIncomingPhotoCount(e),C.default.resetUnSeenIncomingTextCount(e)}}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),this.state.isScreenShareActive!==t.isScreenShareActive&&f.default.announceScreenShareState(this.state.isScreenShareActive),this._shouldDisableVideoDuringScreenSharing()&&t.isScreenShareActive&&!this.state.isScreenShareActive){const e=oe.default.newCauseId();this.props.showHideOutgoingVideoDisabledToast(!1,e)}}componentWillUnmount(){super.componentWillUnmount(),this._unregisterKeyboardHandlers(),this._screenSharingEventSub&&(this._screenSharingEventSub.unsubscribe(),this._screenSharingEventSub=void 0),this._mediaActionEventSub&&(this._mediaActionEventSub.unsubscribe(),this._mediaActionEventSub=void 0)}toggleReactionsPickerButton(e,t){L.log(R.LogTraceArea.CallingUI,"toggleReactionsPickerButton selected: "+e),this.setState({isReactionsPickerSelected:e},(()=>{t&&this.isComponentMounted()&&!e&&this._reactionsEntryPoint&&this.state.isNavigatingWithKeyboard&&this._reactionsEntryPoint.requestFocus()}))}focusCallEndButton(){this._mainCallControls&&this._mainCallControls.focusCallEndButton()}render(){const e=[de.container,this.props.opacityStyle];return s.createElement(s.Animated.View,{style:e,ignorePointerEvents:!0},s.createElement(s.View,{style:de.secondaryControlsContainer},this._renderControls(this._secondaryCallControlsManager.getLeftControls())),s.createElement(H.default,{ref:this._setMainCallControlsRef,callId:this.props.callId,callUIState:this.props.callUIState,conversationMri:this.props.conversationMri,onOpenDialpad:this.props.onOpenDialpad,onInteracting:this.props.onInteracting,isPSTNCall:this.props.isPSTNCall,isEncryptedCall:this.props.isEncryptedCall,disableMic:this.props.disableMic,onEndCallFailure:this.props.onEndCallFailure,onVideoButtonRef:this.props.onVideoButtonRef,useLightTheme:this.props.useLightTheme,shouldDisableVideoDuringScreenSharing:this._shouldDisableVideoDuringScreenSharing()}),s.createElement(s.View,{style:[de.secondaryControlsContainer,de.secondaryControlsContainerRight],ignorePointerEvents:!0},this._renderControls(this._secondaryCallControlsManager.getRightControls())))}_getIdealLeftControls(e,t,i,a,n,o,s,r){const l=[];return n||l.push({priority:1,type:y.CallControlsKeys.ShareLink}),e&&l.push({priority:1,type:y.CallControlsKeys.Record}),(t||i)&&l.push({priority:2,type:y.CallControlsKeys.ScreenShareControl}),this.props.showParticipantsButton&&l.push({priority:1,type:y.CallControlsKeys.Participants}),a&&l.push({priority:3,type:y.CallControlsKeys.ChangeScene}),o&&l.push({priority:1,type:s?y.CallControlsKeys.StopTwinCam:y.CallControlsKeys.TwinCam}),r&&l.push({priority:2,type:y.CallControlsKeys.LiveCaptions}),l}_getIdealRightControls(e,t,i,a){const n=[];return n.push({priority:2,type:y.CallControlsKeys.Chat}),e&&n.push({priority:5,type:y.CallControlsKeys.ScreenShare}),t&&n.push({priority:4,type:i?y.CallControlsKeys.LowerHand:y.CallControlsKeys.RaiseHand}),this.props.shouldShowReactions&&(a?n.push({priority:3,type:y.CallControlsKeys.ReactionsPopover}):n.push({priority:3,type:y.CallControlsKeys.ReactionsDrawer})),n.push({priority:1,type:y.CallControlsKeys.Overflow}),n}_getIdealOverflowControls(e,t,i,a,n,o,s,r,c,d,u,h,g,C){const m=[];e&&m.push(k.OverflowMenuCommands.Snap);const S=l.default.getS4LCMCFeaturesNoSubscription().callCaptionsLiveButton;if(t&&!S&&(i||a!==this.props.callId?i&&m.push(k.OverflowMenuCommands.StopCaptions):m.push(k.OverflowMenuCommands.StartCaptions)),n&&o&&!s&&(p.default.DeviceStore.isBackgroundBlurred()?m.push(k.OverflowMenuCommands.Unblur):m.push(k.OverflowMenuCommands.Blur)),a===this.props.callId&&s&&m.push(k.OverflowMenuCommands.BackgroundEffectsSettings),r){const e=!c&&!d;e&&a===this.props.callId?m.push(k.OverflowMenuCommands.DisableIncomingVideo):e||m.push(k.OverflowMenuCommands.EnableIncomingVideo)}return u&&m.push(k.OverflowMenuCommands.MuteEveryone),h?m.push(k.OverflowMenuCommands.HoldCall):g&&m.push(k.OverflowMenuCommands.ResumeCall),this.props.isEncryptedCall||this.props.isPSTNCall||this.props.isOutgoingVideoDisabled?m.push(k.OverflowMenuCommands.OnShowAudioSettings):m.push(k.OverflowMenuCommands.OnShowAVSettings),C&&m.push(k.OverflowMenuCommands.CallStats),m}_getLeftControlForDesktopMinSmallest(){return y.CallControlsKeys.Chat}_renderControls(e){return a.map(e,(e=>this._renderControl(e)))}_renderControl(e){switch(e){case y.CallControlsKeys.Mic:case y.CallControlsKeys.MicQuickSettings:case y.CallControlsKeys.Video:case y.CallControlsKeys.VideoQuickSettings:case y.CallControlsKeys.Dialpad:return;case y.CallControlsKeys.Participants:return this._getAppropriateParticipantsButton();case y.CallControlsKeys.ScreenShare:return this._getScreenshareButton();case y.CallControlsKeys.ScreenShareControl:return this._getScreenShareControlButton();case y.CallControlsKeys.EndCall:return;case y.CallControlsKeys.RaiseHand:return this._getRaiseOrLowerHandButton(!0);case y.CallControlsKeys.LowerHand:return this._getRaiseOrLowerHandButton(!1);case y.CallControlsKeys.ShareLink:return this._getShareCallLinkButton();case y.CallControlsKeys.TwinCam:return this._getShareQRButton(!1);case y.CallControlsKeys.StopTwinCam:return this._getShareQRButton(!0);case y.CallControlsKeys.ChangeScene:return this._getTogetherModeBackgroundChangeButton();case y.CallControlsKeys.Record:return this._getRecordCallButton();case y.CallControlsKeys.ReactionsDrawer:return this._getReactionsDrawer();case y.CallControlsKeys.ReactionsPopover:return this._getReactionsPopover();case y.CallControlsKeys.Overflow:return this._renderMoreButton();case y.CallControlsKeys.Moments:return;case y.CallControlsKeys.Chat:return this._getChatPanelButton();case y.CallControlsKeys.LiveCaptions:return this._getLiveCaptionsButton();default:return oe.default.switchStatementExhaustiveChecking(e,"Missing case for an CallControlsKeys element")}}_getChatPanelButton(){const e=D.getString("CallPanel.ChatButton"),t=this._hideCaption()?void 0:e,i=this.props.isShowingChat?D.getString("CallPanel.CloseConversation"):D.getString("CallPanel.OpenConversation"),a=this._colorConfig();return a.hoverIcon=ee.SkypeIcon.MessageGradient,s.createElement(s.View,{style:de.chatPanelButton},s.createElement(u.CallButton,{key:y.CallControlsKeys.Chat,ref:this.props.onChatButtonRef,icon:this.props.isShowingChat?ee.SkypeIcon.MessageGradient:ee.SkypeIcon.Message,accessibilityLabel:i,size:ce,onPress:this._onChatPanelButtonPress,isToggledOn:this.props.isShowingChat,colorConfig:a,isBadgeOn:this.state.isChatBadgeOn,caption:t,title:e,showToolTip:!t,toolTipConfig:ue}))}_getScreenShareControlButton(){return this.state.canRequestScreenShareControl?this._getRequestScreenShareControlButton():this.state.canStopScreenShareControl?this._getStopScreenShareControlButton():this.state.screenShareRequestControlInProgress?this._getScreenShareControlRequestInProgressIndicator():void 0}_getScreenshareButton(){const{allowScreenSharing:e,isScreenShareActive:t}=this.state,i=this._getScreenshareButtonTooltip(),a=this._hideCaption()?void 0:this._getScreenshareButtonTooltip(),n=this._colorConfig();n.hoverIcon=t?void 0:ee.SkypeIcon.ScreenShareGradient;const o=t?ee.SkypeIcon.ScreenShareStopGradient:ee.SkypeIcon.ScreenShare;return s.createElement(u.CallButton,{key:y.CallControlsKeys.ScreenShare,ref:this._onScreenShareOverflowMenuButtonRef,icon:o,accessibilityLabel:i,isDisabled:!e,size:ce,isToggledOn:t,onPress:e=>this._onNewScreenShareButtonPress(e,void 0),coachMarkType:v.CoachMarkType.CallPanelScreenShareButton,anchorAccessibilityLabel:i,colorConfig:n,caption:a,title:i,showToolTip:!a,toolTipConfig:ue})}_getTogetherModeBackgroundChangeButton(){const e=D.getString("CallControlsOverFlowMenu.ChangeTogetherModeBackground"),t=this._hideCaption()?void 0:e;return s.createElement(u.CallButton,{key:y.CallControlsKeys.ChangeScene,icon:ne.default.getBackgroundChangeButtonIcon(),accessibilityLabel:e,size:ce,onPress:this._onTogetherModeBackgroundChangeButtonPress,anchorAccessibilityLabel:e,colorConfig:this._colorConfig(),caption:t,title:e,showToolTip:!t,toolTipConfig:ue})}_getAppropriateParticipantsButton(){return this.state.isOneOnOneCall?this._getAddParticipantsButton():this._getParticipantsButton()}_getParticipantsButton(){const e=this._getParticipantsTitle(),t=this._hideCaption()?void 0:e,i=this.state.isHandRaised?s.createElement(s.View,{style:de.raiseHandImageWrapper},s.createElement(j.default,{type:j.RaiseHandImageType.SmallSizeTopLeftAligned})):void 0;return s.createElement(u.CallButton,{key:y.CallControlsKeys.Participants,icon:ee.SkypeIcon.ContactGroupTwoPersonas,accessibilityLabel:e,size:ce,onPress:this._onParticipantsButtonPress,anchorAccessibilityLabel:e,colorConfig:this._getParticipantsButtonColorConfig(),caption:t,title:e,additionalImage:i,borderWidth:2,showToolTip:!t,toolTipConfig:ue})}_getParticipantsButtonColorConfig(){var e;const t=ee.SkypeIcon.ContactGroupTwoPersonasGradient;if(this.state.isHandRaised){const i=this._colorConfig();return Object.assign(Object.assign({},i),{borderColor:J.Color.raiseHandOrange,hoverIcon:t,hoverStyle:[...null!==(e=i.hoverStyle)&&void 0!==e?e:[],s.Styles.createButtonStyle({borderWidth:2,borderColor:J.Color.raiseHandOrange},!1)]})}{const e=this._colorConfig();return e.hoverIcon=t,e}}_hideCaption(){const{controlsType:e}=this.props;return e===y.CallControlsType.DesktopMinSmallest||e===y.CallControlsType.DesktopMedium}_getAddParticipantsButton(){const e=this._getAddParticipantsTitle(),t=this._hideCaption()?void 0:e,i=this._colorConfig();return i.hoverIcon=ee.SkypeIcon.PersonAddGradient,s.createElement(u.CallButton,{key:y.CallControlsKeys.Participants,icon:ee.SkypeIcon.ContactAdd,accessibilityLabel:e,size:ce,onPress:this._onAddParticipantsButtonPress,anchorAccessibilityLabel:e,colorConfig:i,caption:t,title:e,showToolTip:!t,toolTipConfig:ue})}_getAddParticipantsTitle(){return D.getString("CallControls.AddParticipants")}_getParticipantsTitle(){return D.getString("CallControls.Participants")}_getLiveCaptionsButton(){const e=D.getString("CallControls.LiveCaptions"),t=this._hideCaption()?void 0:e,i=this._colorConfig();let a=ee.SkypeIcon.ClosedCaption;return this.state.isCaptioning&&(a=ee.SkypeIcon.ClosedCaptionSettings),s.createElement(u.CallButton,{key:y.CallControlsKeys.LiveCaptions,icon:a,accessibilityLabel:e,size:ce,onPress:this._onLiveCaptionsButtonPress,anchorAccessibilityLabel:e,colorConfig:i,caption:t,title:e,showToolTip:!t,toolTipConfig:ue})}_getReactionsDrawer(){const e={key:this.state.emoticonReactionKey,type:y.ReactionsItemType.Emoticon},t=this._getReactionPickerText(),i=D.getString("MeetNowCallControls.ReactionBarDrawerTitle"),a=this._hideCaption()?void 0:i,n=this.state.isConnecting1on1?s.createElement(u.CallButton,{ref:this._setEngagementTooltipAnchor,size:ce,icon:ee.SkypeIcon.HeartOutline,isDisabled:!0,caption:a,title:i,accessibilityLabel:t,showToolTip:!0,colorConfig:this._colorConfig()}):s.createElement(g.default,{key:e.key,ref:this._onCallReactionsDrawerItemRef,info:e,isAnimated:!this.props.isHidden,importantForAccessibility:s.Types.ImportantForAccessibility.Yes,accessibilityLabel:t,onPress:this._onReactionsPickerPressed,onHover:this.state.isNavigatingWithKeyboard?void 0:this._onReactionsPickerHovered,caption:a,title:i,useDesktopCallControls:!0,isCallMenuItem:!0,useLightTheme:this.props.useLightTheme,hideIcon:this.state.isReactionsPickerSelected,showToolTip:!a});return s.createElement(s.View,{key:y.CallControlsKeys.ReactionsDrawer,style:de.reactionsPickerButton},n,this.state.showCustomizeReactionsPencilButton&&s.createElement(P.default,{styles:de.customCallReactionsButton,iconSize:ee.IconSize.size12,origin:M.CustomReactionsType.Call}))}_getReactionsPopover(){const e=D.getString("MeetNowCallControls.ReactionBarDrawerTitle"),t=this._hideCaption()?void 0:e,i=this._colorConfig();return i.hoverIcon=ee.SkypeIcon.EmojiAddGradient,s.createElement(s.View,{key:y.CallControlsKeys.ReactionsPopover,style:de.reactionsPickerButton},s.createElement(u.CallButton,{icon:ee.SkypeIcon.EmojiAdd,accessibilityLabel:this._getReactionPickerText(),isDisabled:this.state.isConnecting1on1,size:ce,onPress:()=>{},colorConfig:i,caption:t,title:e,showToolTip:!t,toolTipConfig:ue}))}_renderMoreButton(){const e=D.getString("CallControls.CallButtonOverflowMenu"),t=D.getString("Global.MoreButtonTitle"),i=this._hideCaption()?void 0:t;return s.createElement(u.CallButton,{key:y.CallControlsKeys.Overflow,ref:this._onOverflowMenuButtonRef,icon:this._hideCaption()?ee.SkypeIcon.MoreVertical:ee.SkypeIcon.More,accessibilityLabel:e,size:ce,onPress:this._showOverflowMenuPopup,coachMarkType:this.state.isMinDesktop&&this.state.allowScreenSharing?v.CoachMarkType.CallPanelScreenShareButton:void 0,anchorAccessibilityLabel:e,colorConfig:this._colorConfig(),caption:i,title:t,showToolTip:!i,toolTipConfig:ue})}_getRecordCallButton(){const e=this.state.isRecording?D.getString("CallControlsOverFlowMenu.StopRecording"):D.getString("CallControlsOverFlowMenu.StartRecording"),t=this.state.isRecording?D.getString("CallControlsOverFlowMenu.StopRecording"):D.getString("MeetNowCallControls.StartRecording"),i=this._hideCaption()?void 0:t,a=this._colorConfig();return a.hoverIcon=ee.SkypeIcon.CallRecordGradient,s.createElement(u.CallButton,{key:y.CallControlsKeys.Record,icon:this.state.isRecording?ee.SkypeIcon.CallRecordGradient:ee.SkypeIcon.CallRecord,accessibilityLabel:e,isDisabled:!this.state.allowRecording,isToggledOn:this.state.isRecording,size:ce,colorConfig:a,onPress:this.props.onRecordCallPress,caption:i,title:t,showToolTip:!i,toolTipConfig:ue})}_isUnreadInCallIncomingMessageAndPhoto(){const e=T.getReactionsThreadMriForCallId(this.props.callId);return C.default.getUnseenIncomingTextCount(e)>0||C.default.getUnseenIncomingPhotoCount(e)>0}_highContrastColorConfig(e=!1){const t=e?this._themeColors.primaryBackgroundColor:this._themeColors.primaryTextColor,i=e?this._themeColors.primaryTextColor:this._themeColors.primaryBackgroundColor;return{iconColor:i,backgroundColor:t,selectedIconColor:i,selectedBackgroundColor:t,captionColor:t,showHoverEffect:!0,hoverStyle:[s.Styles.createButtonStyle({backgroundColor:t},!1)]}}_colorConfig(){return this.state.useHighContrastTheme?this._highContrastColorConfig(!this.props.useLightTheme&&!this.state.lightThemeCallingStageEnabled):this.props.useLightTheme?this._lightThemeColorConfig():{iconColor:J.Color.gray50,backgroundColor:J.Color.transparent,selectedIconColor:this.state.userPrimaryColor,selectedBackgroundColor:J.Color.black,showHoverEffect:!0,hoverStyle:de.hoverStyleDark,hoverColor:this.state.userPrimaryColor}}_lightThemeColorConfig(){return{iconColor:J.Color.gray400,backgroundColor:J.Color.transparent,selectedIconColor:this.state.userPrimaryColor,selectedBackgroundColor:J.Color.gray100,borderColor:J.Color.transparent,captionColor:J.Color.gray400,showHoverEffect:!0,hoverStyle:de.hoverStyleLight,hoverColor:this.state.userPrimaryColor}}_getRaiseOrLowerHandButton(e){const{key:t,icon:i,buttonLabel:a,a11yLabel:n,onButtonPress:o}=e?this._getRaiseHandProps():this._getLowerHandProps(),l=this._colorConfig();l.hoverIcon=ee.SkypeIcon.LowerHandGradient;const c=this._hideCaption()?void 0:a;return s.createElement(u.CallButton,{key:t,icon:i,title:a,size:ce,isToggledOn:this.state.isHandRaisedForCurrentUser,onPress:o,accessibilityLabel:n,colorConfig:l,anchorAccessibilityLabel:n,caption:c,isDisabled:this.state.isRaisedHandDisabled||!(this.state.callState===r.CallState.Connected),showToolTip:!c,toolTipConfig:ue})}_getRaiseHandProps(){const e=D.getString("CallControls.RaiseHand"),t=D.getString("CallControls.RaiseHandLabel"),i=this._onRaiseHandPressed,a=ee.SkypeIcon.RaiseHand;return{key:y.CallControlsKeys.RaiseHand,icon:a,buttonLabel:e,a11yLabel:t,onButtonPress:i}}_getLowerHandProps(){const e=D.getString("CallControls.LowerHand"),t=D.getString("CallControls.LowerHandLabel"),i=this._onLowerHandPressed,a=ee.SkypeIcon.LowerHandGradient;return{key:y.CallControlsKeys.LowerHand,icon:a,buttonLabel:e,a11yLabel:t,onButtonPress:i}}_getOverflowMenuItemsForCommands(e){const t=a.map(e,(e=>{const t=this._menuTextForCommand(e),i=this._menuIconForCommand(e);return t?{text:t,command:e,icon:i}:void 0}));return a.compact(t)}_menuIconForCommand(e){switch(e){case k.OverflowMenuCommands.BackgroundEffectsSettings:case k.OverflowMenuCommands.Blur:case k.OverflowMenuCommands.Unblur:return I.SXMenuIcon.BlurBackground;case k.OverflowMenuCommands.ConfirmStopSharing:case k.OverflowMenuCommands.StopSharing:return I.SXMenuIcon.ScreenshareOff;case k.OverflowMenuCommands.ShareScreen:case k.OverflowMenuCommands.ShareScreenAndSounds:return I.SXMenuIcon.Screenshare;case k.OverflowMenuCommands.SwitchScreen:return I.SXMenuIcon.ViewSwitch;case k.OverflowMenuCommands.ScreenShareControl:return I.SXMenuIcon.ScreenSharingRequestControl;case k.OverflowMenuCommands.StopScreenShareControl:return I.SXMenuIcon.ScreenSharingStopControl;case k.OverflowMenuCommands.Snap:return I.SXMenuIcon.Snapshot;case k.OverflowMenuCommands.React:return I.SXMenuIcon.React;case k.OverflowMenuCommands.CustomReact:return I.SXMenuIcon.CustomReact;case k.OverflowMenuCommands.RaiseHand:return I.SXMenuIcon.RaiseHand;case k.OverflowMenuCommands.LowerHand:return I.SXMenuIcon.LowerHand;case k.OverflowMenuCommands.OnAddToCall:return I.SXMenuIcon.SkypeContacts;case k.OverflowMenuCommands.OnShowParticipants:return I.SXMenuIcon.ContactGroupPair;case k.OverflowMenuCommands.OnShowAudioSettings:case k.OverflowMenuCommands.OnShowAVSettings:case k.OverflowMenuCommands.CallStats:return I.SXMenuIcon.Settings;case k.OverflowMenuCommands.Invite:return I.SXMenuIcon.AddSkypeContacts;case k.OverflowMenuCommands.HoldCall:return I.SXMenuIcon.HoldCall;case k.OverflowMenuCommands.ResumeCall:return I.SXMenuIcon.ResumeCall;case k.OverflowMenuCommands.StartRecording:case k.OverflowMenuCommands.StopRecording:return I.SXMenuIcon.Record;case k.OverflowMenuCommands.StartCaptions:case k.OverflowMenuCommands.StopCaptions:case k.OverflowMenuCommands.LiveCaptions:return I.SXMenuIcon.Subtitles;case k.OverflowMenuCommands.LiveCaptionsSettings:return I.SXMenuIcon.SubtitlesSettings;case k.OverflowMenuCommands.EnableIncomingVideo:return I.SXMenuIcon.VideoEnable;case k.OverflowMenuCommands.DisableIncomingVideo:return I.SXMenuIcon.VideoOff;case k.OverflowMenuCommands.MuteEveryone:return I.SXMenuIcon.MicrophoneOff;case k.OverflowMenuCommands.ChangeTogetherModeBackground:return I.SXMenuIcon.Picture;case k.OverflowMenuCommands.BingBackgrounds:return I.SXMenuIcon.Bing;case k.OverflowMenuCommands.TwinCam:return I.SXMenuIcon.TwinCam;case k.OverflowMenuCommands.StopTwinCam:return I.SXMenuIcon.StopTwinCam;default:return}}_menuTextForCommand(e){switch(e){case k.OverflowMenuCommands.Blur:case k.OverflowMenuCommands.Unblur:return p.default.DeviceStore.isBackgroundBlurred()?D.getString("CallControls.CallMenuUnBlurBackground"):D.getString("CallControls.CallMenuBlurBackground");case k.OverflowMenuCommands.ConfirmStopSharing:return D.getString("CallControlsOverFlowMenu.ConfirmStopShareScreen");case k.OverflowMenuCommands.StopSharing:case k.OverflowMenuCommands.ShareScreen:return this.state.isScreenShareActive?D.getString("CallControlsOverFlowMenu.StopShareScreen"):D.getString("CallControlsOverFlowMenu.ShareScreen");case k.OverflowMenuCommands.ShareScreenAndSounds:return D.getString("CallControlsOverFlowMenu.ShareScreenAndSounds");case k.OverflowMenuCommands.ScreenShareControl:return D.getString("CallControls.CallButtonRequestScreenShareControl");case k.OverflowMenuCommands.StopScreenShareControl:return D.getString("CallControls.CallButtonStopScreenShareControlFromViewer");case k.OverflowMenuCommands.SwitchScreen:return this.state.windowSharingEnabled?D.getString("CallControlsOverFlowMenu.SwitchScreenOrWindow"):D.getString("CallControlsOverFlowMenu.SwitchScreen");case k.OverflowMenuCommands.Snap:return this._getSnapshotText();case k.OverflowMenuCommands.React:case k.OverflowMenuCommands.CustomReact:return this._getReactionPickerText();case k.OverflowMenuCommands.RaiseHand:return D.getString("CallControls.RaiseHandLabel");case k.OverflowMenuCommands.LowerHand:return D.getString("CallControls.LowerHandLabel");case k.OverflowMenuCommands.OnAddToCall:return this._getAddParticipantsTitle();case k.OverflowMenuCommands.OnShowParticipants:return this._getParticipantsTitle();case k.OverflowMenuCommands.OnShowAudioSettings:return D.getString("CallControlsOverFlowMenu.AdjustAudioSettings");case k.OverflowMenuCommands.OnShowAVSettings:return D.getString("CallControlsOverFlowMenu.AdjustAVSettings");case k.OverflowMenuCommands.BackgroundEffectsSettings:return D.getString("CallControlsOverFlowMenu.BackgroundEffectsSettings");case k.OverflowMenuCommands.HoldCall:return D.getString("CallControlsOverFlowMenu.HoldCall");case k.OverflowMenuCommands.ResumeCall:return D.getString("CallControlsOverFlowMenu.ResumeCall");case k.OverflowMenuCommands.StartRecording:return D.getString("CallControlsOverFlowMenu.StartRecording");case k.OverflowMenuCommands.StopRecording:return D.getString("CallControlsOverFlowMenu.StopRecording");case k.OverflowMenuCommands.StartCaptions:return D.getString("CallControlsOverFlowMenu.StartSubtitles");case k.OverflowMenuCommands.StopCaptions:return D.getString("CallControlsOverFlowMenu.StopSubtitles");case k.OverflowMenuCommands.EnableIncomingVideo:return D.getString("CallControlsOverFlowMenu.StartIncomingVideo");case k.OverflowMenuCommands.DisableIncomingVideo:return D.getString("CallControlsOverFlowMenu.StopIncomingVideo");case k.OverflowMenuCommands.CallStats:return D.getString("CallPanel.CallStats");case k.OverflowMenuCommands.Invite:return D.getString("MeetNow.ShareInvite");case k.OverflowMenuCommands.MuteEveryone:return D.getString("CallControls.CallButtonMuteEveryone");case k.OverflowMenuCommands.ChangeTogetherModeBackground:return D.getString("CallControlsOverFlowMenu.ChangeTogetherModeBackground");case k.OverflowMenuCommands.BingBackgrounds:return D.getString("CallControls.BingBackgrounds");case k.OverflowMenuCommands.TwinCam:return D.getString("CallControlsOverFlowMenu.TwinCam");case k.OverflowMenuCommands.StopTwinCam:return D.getString("CallControlsOverFlowMenu.StopTwinCam");case k.OverflowMenuCommands.LiveCaptions:return D.getString("CallControlsOverFlowMenu.LiveCaptionsStart");case k.OverflowMenuCommands.LiveCaptionsSettings:return D.getString("CallControlsOverFlowMenu.LiveCaptionsSettings");default:return}}_onSwitchScreen(e){this._stopScreenSharing().then((()=>{this._startBrowserScreenSharing(e),S.default.updateCallTelemetry(this.props.callId,e,(e=>e.switchScreenWhileSharing()))}))}_onShareScreen(e){this._startBrowserScreenSharing(e)}_startBrowserScreenSharing(e){L.log(R.LogTraceArea.CallingUI,"DesktopCallControls._startBrowserScreenSharing for browser causeId: "+e),this._shouldDisableVideoDuringScreenSharing()&&this.state.isVideoActive?p.default.CallingStore.stopVideo(this.props.callId,e).then((()=>{this.props.showHideOutgoingVideoDisabledToast(!0,e),this._startScreenSharing(e,!1,void 0,void 0)})):this._startScreenSharing(e,!1,void 0,void 0)}_shouldDisableVideoDuringScreenSharing(){return!0}_startScreenSharing(e,t,i,a){p.default.CallingStore.startScreenSharing(this.props.callId,e,i,t).catch((t=>{t&&"permissionDeniedError"===t.type&&S.default.updateCallTelemetry(this.props.callId,e,(e=>{e.cancelScreenSharing()}))})),this._currentScreenSharingSource=i,this._currentScreenSharingSourceType=a,S.default.updateCallTelemetry(this.props.callId,e,(e=>{e.startScreenSharing(),t&&e.startSoundSharing()})),a&&this._incrementSourceTypeTelemetryCounts(a,e)}_incrementSourceTypeTelemetryCounts(e,t){S.default.updateCallTelemetry(this.props.callId,t,(t=>e===r.SharingSourceType.Monitor?t.wholeScreenSharedCount():t.appWindowSharedCount()))}_registerKeyboardHandlers(){B.default.addHandler(R.KeyboardShortcut.OpenDialpad,this._togglePstnDialpadShortcut)}_unregisterKeyboardHandlers(){B.default.removeHandler(R.KeyboardShortcut.OpenDialpad,this._togglePstnDialpadShortcut)}_startRecording(){const e=oe.default.newCauseId();L.log(R.LogTraceArea.CallingUI,"DesktopCallControls._startRecording causeId: "+e),p.default.InCallBotService.startRecording(this.props.callId,e)}_stopRecording(){const e=oe.default.newCauseId();L.log(R.LogTraceArea.CallingUI,"DesktopCallControls._stopRecording causeId: "+e),p.default.InCallBotService.stopRecording(this.props.callId,e)}_startTranslator(){const e=oe.default.newCauseId();L.log(R.LogTraceArea.CallingUI,"DesktopCallControls._startTranslator causeId: "+e),f.default.announceSubtitleState(true,!1),p.default.InCallBotService.startTranslator(this.props.callId,e).then((()=>{f.default.announceSubtitleState(true,!0)})).catch((t=>{L.log(R.LogTraceArea.CallingUI,"DesktopCallControls._startTranslator error: "+q.default.errorAsString(t)+" causeId: "+e)}))}_stopTranslator(){const e=oe.default.newCauseId();L.log(R.LogTraceArea.CallingUI,"DesktopCallControls._stopTranslator causeId: "+e),f.default.announceSubtitleState(false,!1),p.default.InCallBotService.stopTranslator(this.props.callId,e).then((()=>{f.default.announceSubtitleState(false,!0)}))}_enableIncomingVideo(){const e=oe.default.newCauseId();L.log(R.LogTraceArea.CallingUI,"DesktopCallControls._startIncomingVideo causeId: "+e),this.state.audioOnlyEnabled?p.default.CallingStore.stopAudioOnly(this.props.callId,e):p.default.CallingStore.enableIncomingVideo(this.props.callId,e).then((()=>{f.default.announceIncomingVideoAllowanceState(!0)}))}_disableIncomingVideo(){const e=oe.default.newCauseId();L.log(R.LogTraceArea.CallingUI,"DesktopCallControls._stopIncomingVideo causeId: "+e),p.default.CallingStore.disableIncomingVideo(this.props.callId,e).then((()=>{f.default.announceIncomingVideoAllowanceState(!1)}))}}t.default=he},7153:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(67294),n=i(16778),o=i(48540),s=i(36237),r=i(33754),l=i(22538),c=i(4736),d=i(60787),u=i(80200),h=i(98278),p=i(11828),g=i(46096),C=i(20187),m=i(67743),S=i(94224),y=i(71727),f=i(81760),_=i(80843),b=i(68894),T=i(6282),v=i(13944),w=i(48638),I=i(72490),P=i(15877),M=i(89808),k=i(4735),A=i(17093),R=i(63841),V=i(24576),L=i(53374),E=i(1494),B=(0,P.lazyProperties)({container:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",overflow:"visible",alignSelf:"center",top:0}),newContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",overflow:"visible",alignSelf:"center",top:0,marginHorizontal:8,backgroundColor:f.Color.gray400,borderRadius:46,height:40}),newContainerLightTheme:()=>n.Styles.createViewStyle({backgroundColor:f.Color.gray100Overlay80}),buttonPopupContainer:()=>n.Styles.createViewStyle({position:"absolute",bottom:0}),newButtonPopupContainer:()=>n.Styles.createViewStyle({}),chevron:()=>n.Styles.createViewStyle({justifyContent:"center",alignItems:"center",paddingHorizontal:4}),extraChevronMargin:()=>n.Styles.createViewStyle({marginRight:8}),micButtonExtraStyles:()=>n.Styles.createViewStyle({marginLeft:-2})});class O extends V.default{constructor(){super(...arguments),this._hangUpButtonAnchor=(0,a.createRef)(),this._onMicHoverStart=()=>{this._onMicHover(!0)},this._onMicHoverEnd=()=>{this._onMicHover(!1)},this._onMicButtonPopupRef=e=>{this._micButtonPopup=e||void 0},this._onVideoButtonPopupRef=e=>{this._videoButtonPopup=e||void 0},this._onMicButtonPopupClosed=()=>{this.setState({isMicPopupOpen:!1})},this._onVideoButtonPopupClosed=()=>{this.setState({isVideoPopupOpen:!1})},this._onMicButtonPopupAnchor=e=>{this._micButtonPopupAnchor=e||void 0},this._onVideoButtonPopupAnchor=e=>{this._videoButtonPopupAnchor=e||void 0,l.EnsureStarted(_.default).then((()=>{_.default.setAnchor(b.EngagementTooltipType.CallVideoSettings,e)}))},this._onVideoButtonHover=e=>{this._videoButtonPopup&&(e?this._videoButtonPopup.onAnchorEnter():this._videoButtonPopup.onAnchorLeave())},this._onMicHover=e=>{this._micButtonPopup&&(e?this._micButtonPopup.onAnchorEnter():this._micButtonPopup.onAnchorLeave())},this._onMicQuickSettings=()=>{this.setState({isMicPopupOpen:!this.state.isMicPopupOpen},(()=>{this._micButtonPopup&&(this.state.isMicPopupOpen?this._micButtonPopup.showImmediately():this._micButtonPopup.hideImmediately())}))},this._onVideoQuickSettings=()=>{this.setState({isVideoPopupOpen:!this.state.isVideoPopupOpen},(()=>{this._videoButtonPopup&&(this.state.isVideoPopupOpen?this._videoButtonPopup.showImmediately():this._videoButtonPopup.hideImmediately())}))},this._onMicButtonLongPress=e=>{e.stopPropagation(),e.preventDefault(),this._micButtonPopup&&this._micButtonPopup.onAnchorLongPress()},this._onVideoButtonLongPress=e=>{e.stopPropagation(),e.preventDefault(),this._videoButtonPopup&&this._videoButtonPopup.onAnchorLongPress()},this._onToggleMicrophone=()=>{this._micButtonPopup&&this._micButtonPopup.onAnchorPress();new C.ToggleMuteCommand(this.props.callId,this.state.isMuted,this.state.isServerMuted,!!this.props.disableMic,this._getRootViewId()).execute(),this.props.onInteracting(!1)},this._onToggleVideo=()=>{const e=L.default.newCauseId();this._videoButtonPopup&&this._videoButtonPopup.onAnchorPress(),this.state.isAwaitingCameraConfirmation?(S.default.CallControlsStore.setIsAwaitingCameraConfirmation(!1),S.default.DeviceStore.choosePreselectedDevices(e)):(this._videoCommand.execute(),this.props.onInteracting(!1))},this._showAVSettings=()=>{const e=L.default.newCauseId();s.log(g.LogTraceArea.CallingUI,"DesktopMainCallControls._showAVSettings causeId: "+e),k.default.navigateToDesktopSettingsGroup(A.SettingsGroup.AudioVideoSettings,this._getRootViewId(),e)}}_buildState(e,t){this._videoCommand=new C.ToggleVideoCommand(e.callId,e);return{isMuted:y.default.isLocalOrServerMuted(e.callId),isServerMuted:S.default.CallingStore.isServerMuted(e.callId),isVideoButtonEnabled:this._videoCommand.canExecute(),isVideoActive:S.default.CallingStore.isProvidingVideo(e.callId),isOutgoingVideoDisabled:S.default.CallingFeaturesHelper.isOutgoingVideoDisabled(),callState:S.default.CallingStore.getCallState(e.callId),isNavigatingWithKeyboard:w.default.isNavigatingWithKeyboard(),enableNewMainCallControls:S.default.CallingFeaturesHelper.areNewMainCallControlsEnabled(),useHighContrastTheme:y.default.useHighContrastThemeAndChanges(),isAwaitingCameraConfirmation:S.default.CallControlsStore.isAwaitingCameraConfirmation(),isScreenShareActive:S.default.CallingStore.isScreenSharing(e.callId),primaryColor:M.default.getPrimaryColor()}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),t.isServerMuted||!this.state.isServerMuted||this.state.isMuted||y.default.announceMicrophoneState(!0,!0),this._logMuteStateChanges(t)}focusCallEndButton(){var e;null===(e=this._hangUpButtonAnchor.current)||void 0===e||e.requestFocus()}render(){let e;const t=this.state.enableNewMainCallControls?B.newButtonPopupContainer:B.buttonPopupContainer;let i;return this.state.isNavigatingWithKeyboard&&!this.state.enableNewMainCallControls||(e=n.createElement(m.default,{colorThemeOverride:this.props.useLightTheme?R.Theme.Colorful:R.Theme.ColorfulDark,ref:this._onMicButtonPopupRef,style:t,callId:this.props.callId,onClosed:this._onMicButtonPopupClosed,isSticky:this.state.enableNewMainCallControls,popupId:"AudioSettingsPopup",anchor:()=>this._micButtonPopupAnchor})),this.state.isNavigatingWithKeyboard&&!this.state.enableNewMainCallControls||(i=n.createElement(E.default,{colorThemeOverride:this.props.useLightTheme?R.Theme.Colorful:R.Theme.ColorfulDark,ref:this._onVideoButtonPopupRef,style:t,callId:this.props.callId,isVideoButtonEnabled:this.state.isVideoButtonEnabled,onClosed:this._onVideoButtonPopupClosed,isVideoDisabledDuringScreenSharing:this._isVideoDisabledDuringScreenSharing(),onChangeBackgroundPress:this._showAVSettings,isOutgoingVideoDisabled:this.props.isOutgoingVideoDisabled,isSticky:this.state.enableNewMainCallControls,popupId:"VideoSettingsPopup",anchor:()=>this._videoButtonPopupAnchor,useLightTheme:this.props.useLightTheme})),this.state.enableNewMainCallControls?this._renderNewMainCallControls(e,i):n.createElement(n.View,{style:[B.container],ignorePointerEvents:!0},e,i,this._getMicButton(),this._getVideoOrDialpadButton(),this._getHangUpButton())}_shouldRenderVideoButton(){return!this.props.isPSTNCall&&!this.props.isEncryptedCall}_getVideoOrDialpadButton(){return this._shouldRenderVideoButton()?this._getVideoButton():this.props.isPSTNCall?this._getDialPadButton():void 0}_renderNewMainCallControls(e,t){const i=[B.newContainer,...this.props.useLightTheme?[B.newContainerLightTheme]:[]];let a,o;return this._shouldRenderVideoButton()?a=[this._getVideoButton(),this._getChevronButton(u.CallControlsKeys.VideoQuickSettings,r.getString("CallControls.CallButtonCameraQuickSettings"),this.state.isVideoPopupOpen?h.FontWeight.bold:h.FontWeight.regular,this._onVideoQuickSettings,this._onVideoButtonPopupAnchor,this.state.isOutgoingVideoDisabled,B.extraChevronMargin)]:this.props.isPSTNCall&&(o=[this._getDialPadButton()]),n.createElement(n.View,{style:B.container},n.createElement(n.View,{style:i,ignorePointerEvents:!0},e,t,this._getMicButton(),this._getChevronButton(u.CallControlsKeys.MicQuickSettings,r.getString("CallControls.CallButtonMicrophoneQuickSettings"),this.state.isMicPopupOpen?h.FontWeight.bold:h.FontWeight.regular,this._onMicQuickSettings,this._onMicButtonPopupAnchor,void 0),this._shouldRenderVideoButton()?a:o),this._getHangUpButton())}_getMicButton(){const e=r.getString(this.state.isMuted?"CallControls.CallButtonUnmuteLabel":"CallControls.CallButtonMute"),t=I.default.generateTooltipLabelWithShortcutForCondition(e,g.KeyboardShortcut.ToggleMicrophone),i=this._getActionButtonColorConfig(!this.state.isMuted,this.props.useLightTheme);return n.createElement(c.default,{key:u.CallControlsKeys.Mic,icon:this.state.isMuted?p.SkypeIcon.MicrophoneOff:p.SkypeIcon.Microphone,size:c.ActionButtonSize.Small,onPress:this._onToggleMicrophone,onHoverStart:this._onMicHoverStart,onHoverEnd:this._onMicHoverEnd,onLongPress:this._onMicButtonLongPress,title:t,accessibilityLabel:e,backgroundColor:null==i?void 0:i.backgroundColor,iconColor:null==i?void 0:i.iconColor,style:B.micButtonExtraStyles,reverseGradientColor:!0})}_getChevronButton(e,t,i,a,o,s,r){return n.createElement(v.default,{ref:o,key:e,icon:p.SkypeIcon.UpChevron,title:t,disabled:s,size:p.IconSize.size12,onPress:a,accessibilityLabel:t,hoverColor:this.props.useLightTheme?f.Color.gray400Overlay50:f.Color.whiteOverlay50,color:this.props.useLightTheme?f.Color.gray400:f.Color.white,style:[B.chevron,r]})}_getActionButtonColorConfig(e,t){if(e)return;const i={iconColor:f.Color.white,backgroundColor:f.Color.transparent};return t&&(i.iconColor=f.Color.gray400),i}_getVideoButton(){let e,t;this.props.isOutgoingVideoDisabled?e=t=r.getString("AudioVideoSettings.OutgoingVideoDisabled"):(e=r.getString(this.state.isVideoActive?"CallControls.CallButtonTurnOffVideoLabel":"CallControls.CallButtonTurnOnVideoLabel"),t=I.default.generateTooltipLabelWithShortcutForCondition(e,g.KeyboardShortcut.ToggleCamera));let i=this._getActionButtonColorConfig(this.state.isVideoActive||this.state.isAwaitingCameraConfirmation,this.props.useLightTheme);return n.createElement(c.default,{ref:this.props.onVideoButtonRef,key:u.CallControlsKeys.Video,icon:this.state.isAwaitingCameraConfirmation?p.SkypeIcon.Ok:this.state.isVideoActive?p.SkypeIcon.Video:p.SkypeIcon.VideoOff,size:c.ActionButtonSize.Small,onPress:this._onToggleVideo,onHoverStart:()=>this._onVideoButtonHover(!0),onHoverEnd:()=>this._onVideoButtonHover(!1),onLongPress:this._onVideoButtonLongPress,title:t,accessibilityLabel:e,backgroundColor:null==i?void 0:i.backgroundColor,iconColor:null==i?void 0:i.iconColor,reverseGradientColor:!0})}_getDialPadButton(){const e=r.getString("CallPanel.DialpadTooltipTitle");return n.createElement(d.CallButton,{key:u.CallControlsKeys.Dialpad,icon:p.SkypeIcon.Dialpad,title:e,size:d.CallButtonSize.Small,isDisabled:!(this.state.callState===o.CallState.Connected||this.state.callState===o.CallState.EarlyMedia),isToggledOn:!0,onPress:this.props.onOpenDialpad,accessibilityLabel:e,backgroundStyle:d.CallButtonBackgroundStyle.Overlay,colorConfig:this._colorConfig(),doNotAddHorizontalMargin:this.state.enableNewMainCallControls})}_getHangUpButton(){return n.createElement(T.HangUpButton,{ref:this._hangUpButtonAnchor,isPSTNCall:this.props.isPSTNCall,isEncryptedCall:this.props.isEncryptedCall,conversationMri:this.props.conversationMri,connectedCallId:this.props.connectedCallId,callUIState:this.props.callUIState,callId:this.props.callId,onEndCallFailure:this.props.onEndCallFailure,focusOnMount:this.state.isNavigatingWithKeyboard,rootViewId:this._getRootViewId()})}_isVideoDisabledDuringScreenSharing(){return this.props.shouldDisableVideoDuringScreenSharing&&this.state.isScreenShareActive}_logMuteStateChanges(e){this.state.isMuted!==e.isMuted&&s.log(g.LogTraceArea.CallingUI,`DesktopMainCallControls.componentDidUpdate, isMuted - ${e.isMuted} to ${this.state.isMuted}`),this.state.isServerMuted!==e.isServerMuted&&s.log(g.LogTraceArea.CallingUI,`DesktopMainCallControls.componentDidUpdate, isServerMuted - ${e.isServerMuted} to ${this.state.isServerMuted}`)}_colorConfig(){return this.state.useHighContrastTheme?y.default.highContrastColorConfig(this._themeColors):void 0}}t.default=O},6282:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HangUpButton=void 0;const a=i(67294),n=i(16778),o=i(88837),s=i(36237),r=i(33754),l=i(4736),c=i(80200),d=i(81760),u=i(20187),h=i(46096),p=i(33289),g=i(72490),C=i(11828),m=i(12770),S=i(53374);t.HangUpButton=(0,a.memo)((0,a.forwardRef)((0,o.withResubAutoSubscriptions)((({callId:e,isPSTNCall:t,isEncryptedCall:i,conversationMri:o,connectedCallId:y,callUIState:f,onEndCallFailure:_,focusOnMount:b,rootViewId:T},v)=>{const w=(0,a.useRef)(null);((e,t)=>{const i=(0,a.useRef)(!1),n=(0,a.useRef)(0);(0,a.useEffect)((()=>(e.current&&t&&!i.current&&(n.current=m.default.setTimeout((()=>{var t;null===(t=e.current)||void 0===t||t.requestFocus()}),1e3)),i.current=!0,()=>{m.default.clearTimeout(n.current)})),[t,e])})(w,b);const I=new u.EndCallForEveryoneCommand(e,{callId:e,isPSTNCall:t,isEncryptedCall:i,conversationMri:o,connectedCallId:y},f,_),P=I.canExecute(),M=new u.EndCallCommand(e,_),k=(e,t)=>{s.log(h.LogTraceArea.CallingUI,"DesktopCallControls._endCall forEveryone: "+e+" causeId: "+t),e?I.execute():M.execute()},A=e=>{e.stopPropagation(),e.preventDefault(),P&&p.default.showEndCallMenuPopup(T,e,(()=>w.current),(e=>{p.default.selectEndCallMenuItem(e,T,k)}))},R=r.getString("CallControls.CallButtonEndCall"),V=g.default.generateTooltipLabelWithShortcutForCondition(R,h.KeyboardShortcut.HangupOrRejectCall);return n.createElement(l.default,{ref:(L=[w,v],function(e){for(const t of L)"function"==typeof t?t(e):null!==t&&(t.current=e)}),key:c.CallControlsKeys.EndCall,icon:C.SkypeIcon.CallEnd,title:V,size:l.ActionButtonSize.Small,backgroundColor:d.Color.red,onPress:()=>{const e=S.default.newCauseId();s.log(h.LogTraceArea.CallingUI,"DesktopCallControls._onEndCallButtonPress "+e),k(!1,e)},onLongPress:A,onContextMenu:A,accessibilityLabel:R});var L})))),t.HangUpButton.displayName="HangUpButton"},99620:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallConversationPanel=void 0;const a=i(16778),n=i(89391),o=i(96074),s=i(9520),r=i(47447),l=i(14920),c=i(14980),d=i(11930),u=i(39549),h=i(37490),p=i(70891),g=i(46096),C=i(39285),m=i(5581),S=i(36237),y=i(15877),f=i(33754),_=i(73319),b=i(63328),T=i(4735),v=i(27357),w=i(26978),I=i(90631),P=i(11010),M=i(11828),k=i(80837),A=i(53374),R=(0,y.lazyProperties)({base:()=>a.Styles.createViewStyle({flex:1,alignItems:"stretch",paddingBottom:20}),baseTablet:()=>a.Styles.createViewStyle({paddingBottom:0}),headerPanelStyle:()=>a.Styles.createViewStyle({paddingHorizontal:0}),centeredText:()=>a.Styles.createTextStyle({textAlign:"center"}),centeredView:()=>a.Styles.createViewStyle({justifyContent:"center",alignItems:"center",flex:1,flexDirection:"row"})});class V extends o.default{constructor(){super(...arguments),this._onToggleFindPanelWithOverflowConfig=e=>{const t=A.default.newCauseId();return S.log(g.LogTraceArea.FindPanel,"CallConversationPanel._onToggleFindPanelWithOverflowConfig, causeId: "+t),this.state.isFindPanelShowing?(S.track(new _.MessageOverflowEvent(_.MessageOverflowAction.MessageOverflowCloseButtonClicked)),T.default.closeFindPanel(t,this._getContext())):(S.track(new _.MessageOverflowEvent(_.MessageOverflowAction.MessageOverflowOpenButtonClicked)),T.default.navigateToFindPanel(this.props.conversationId,e,this._getContext(),t)),!0},this._handleLaunchCamera=()=>{r.UICapabilities.cameraSupported()&&(h.dismissAll(),c.navigateToCaptureComboModalWithParams({capturedContentHandler:new l.CapturedContentHandlerForPosting(this.props.conversationId),conversationId:this.props.conversationId,allowVideo:!0,mediaPickerShouldCollapseFully:!0,showCoachmarksIfNeeded:!0},this._getContext()))},this._onClosePress=()=>{const e=A.default.newCauseId();S.log(g.LogTraceArea.Navigation,"CallConversationPanel._onClosePress, causeId: "+e),this.props.onClose?this.props.onClose(e):T.default.closeConversationInCall(e,this._getContext())},this._onExpandPress=()=>{S.log(g.LogTraceArea.Navigation,"Going to full screen conversation"),S.track(new s.FullChatUXTelemetryEvent(s.FullChatUXNavigation.Enter,this.props.conversationId,this.props.callId)),T.default.navigateToConversation({convId:this.props.conversationId,origin:g.NavigationConversationOrigin.Call,causeId:A.default.newCauseId()})}}_buildState(e,t){const i=(0,u.default)().getConversation(e.conversationId);return{otherPartyMri:i&&i.isOneOnOne()?i.getOtherPartyMri():void 0,sideBarWidth:w.default.getWidth(),isFindPanelShowing:v.default.isFindPanelShowing(this._getRootViewId()),enableFullChatUx:n.default.getS4LMessagingFeatures().enableFullChatUx,isTranslatedConversation:m.default.isConversationTranslated(e.conversationId)}}_getTitleView(){return a.createElement(a.View,{style:R.centeredView},a.createElement(C.HiddenText,{style:[R.centeredText,P.default.fontStyle.h5,this._themeStyles.headerTextColorStyle]},f.getString("CallPanel.ChatTitle")))}render(){const e=d.default.applyShouldGroupAccessibilityChildren({style:[R.base,this._themeStyles.messageStreamBackgroundColorStyle,void 0]}),t={closeButtonType:I.CloseButtonType.Close,onPress:this._onClosePress,title:f.getString("CallPanel.CloseConversation")},i=[];this.state.enableFullChatUx&&i.push({icon:M.SkypeIcon.Expand,text:f.getString("CallPanel.Expand"),onPress:this._onExpandPress});const n=this._getContext().isPresentedInDesktopRightNav?{leftButton:t,rightButtons:i,titleView:this.state.enableFullChatUx?this._getTitleView():void 0,titleTextStyle:this.state.enableFullChatUx?k.default.flexNegativeOne:void 0}:{leftButton:void 0,rightButtons:t,titleView:a.createElement(a.View,{style:k.default.flexOne})};return a.createElement(a.View,Object.assign({},e),a.createElement(I.SimplePanelHeader,Object.assign({style:R.headerPanelStyle,hideBottomBorder:!0,useCenteredControls:!0},n)),a.createElement(b.default,{conversationId:this.props.conversationId,otherPartyMri:this.state.otherPartyMri,renderOrigin:p.MessageRenderOrigin.CallCanvas,allowUploads:!0,hasConnectedCalls:!0,availableWidth:this.state.sideBarWidth,onHandleOverflow:this._onToggleFindPanelWithOverflowConfig,onLaunchCamera:this._handleLaunchCamera,onToggleFindPanel:this._onToggleFindPanelWithOverflowConfig,isFindPanelHidden:!this.state.isFindPanelShowing,isTranslatedConversation:this.state.isTranslatedConversation}))}}t.CallConversationPanel=V,t.default=V},79857:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(69840),o=i(81760),s=i(35084),r=i(57538),l=i(38409),c=i(18078),d=i(15877),u=i(33754),h=i(11828),p=i(10117),g=i(46096),C=i(33603),m=i(72490),S=i(36237),y=i(72758),f=i(65788),_=i(47176),b=i(12770),T=i(10025),v=i(24576),w=i(44285),I=i(39549),P=(0,d.lazyProperties)({container:()=>a.Styles.createViewStyle({position:"absolute",top:40,left:0,right:0,margin:6,padding:24,borderRadius:16,maxWidth:400,minHeight:180}),headerView:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"flex-start",overflow:"visible"}),joinLinkButton:()=>a.Styles.createViewStyle({marginBottom:16}),inviteButton:()=>a.Styles.createButtonStyle({alignSelf:"center",alignContent:"center",alignItems:"center",flexDirection:"row"}),inviteButtonText:()=>a.Styles.createTextStyle({color:o.Color.blue,fontSize:16,lineHeight:24}),nameInput:()=>a.Styles.createViewStyle({marginTop:10}),primaryLabel:()=>a.Styles.createTextStyle({flexGrow:1,marginBottom:16,fontSize:15,lineHeight:22,fontWeight:"600"}),primaryLabelGuestFlow:()=>a.Styles.createTextStyle({flexGrow:1,marginBottom:16,fontSize:16,lineHeight:22}),secondaryLabel:()=>a.Styles.createTextStyle({marginBottom:16,fontSize:16,lineHeight:21}),closeButton:()=>a.Styles.createTextStyle({marginTop:-8,marginRight:-6})});class M extends v.default{constructor(){super(...arguments),this._autoCloseTimeoutMs=5e3,this._isAutoCloseBlocked=!1,this._getContainerBackgroundStyles=()=>{const e=this._useDarkTheme()?o.Color.gray400overlay95:o.Color.gray50overlay95;let t;if(!this.props.isProvidingVideo){const e={backgroundColor:o.Color.whiteOverlay50,shadowColor:o.Color.blackOverlay10,shadowOffset:{width:0,height:2},shadowOpacity:.1,shadowRadius:6},i={backgroundColor:this._themeColors.secondaryBackgroundColor};t=this._useDarkTheme()?i:e}return[P.container,a.Styles.createViewStyle(Object.assign({backgroundColor:e},t))]},this._onClose=()=>(!this.state.isGuestFlow||!this.state.isUserNameRequiredErrorVisible)&&(this._trackCloseEvent(f.MeetNowSharePopupCloseActionType.Manual),this.props.onClose(),!0),this._onUserNameChange=e=>{const t=e.trim();this.setState({isUserNameRequiredErrorVisible:!t.length,guestUserName:t})},this._onInviteSkypeContactsClick=()=>{this._isAutoCloseBlocked=!0},this._inviteByEmail=()=>{if(S.log(g.LogTraceArea.JoinLink,"CallCreatorShareOverlayPopup._inviteByEmail "+r.MeetNowShareInviteCommands.DefaultMail),!this.state.joinLink)return S.log(g.LogTraceArea.JoinLink,"CallCreatorShareOverlayPopup._inviteByEmail abort, no joinLink");C.default.clickShare(r.MeetNowShareInviteCommands.DefaultMail,{joinLink:this.state.joinLink,threadId:this._threadId,rootViewId:this._getRootViewId(),meetNowParameters:Object.assign(Object.assign({},this.props.meetNowParameters),{origin:r.MeetNowOrigin.CreatorPanelPopup})})},this._enableAutoCloseFlow=()=>{const e=_.default.getActiveParticipants(this.props.callId,this.props.conversationMri).length>1,t=!(this._autoCloseTimer||this._isAutoCloseBlocked);e&&t&&this._startAutoCloseTimer(),this._autoCloseTimer&&this._isAutoCloseBlocked&&b.default.clearTimeout(this._autoCloseTimer)},this._startAutoCloseTimer=()=>{this._autoCloseTimer=b.default.setTimeout((()=>{this.isComponentMounted()&&(this._trackCloseEvent(f.MeetNowSharePopupCloseActionType.Auto),this.props.onClose())}),this._autoCloseTimeoutMs)},this._trackCloseEvent=e=>{const t=this._createdAt-(new Date).getTime();S.track(new f.MeetNowSharePopupCloseEvent(this.props.meetNowParameters,e,this.state.isGuestFlow,t))}}_buildState(e,t){var i;const a=c.default.getSkypeMri(),o=y.default.getDisplayableUserByMri(a),s=w.MeetNowHelpers.isGuestFlow();this._threadId=this.props.conversationMri,this._defaultGuestUserName=o.displayName;const r=null===(i=(0,I.default)().getConversation(this._threadId))||void 0===i?void 0:i.isJoinEnabled();return t&&(this._createdAt=(new Date).getTime()),s||this._enableAutoCloseFlow(),{isGuestFlow:s,showLinkCopied:!t&&this.state.showLinkCopied,guestUserName:t?this._defaultGuestUserName:this.state.guestUserName,joinLink:n.default.getLink(this._threadId),isUserNameRequiredErrorVisible:!1,isJoinEnabled:r}}componentDidMount(){super.componentDidMount(),m.default.addEscapeHandler(this._onClose)}componentWillUnmount(){super.componentWillUnmount(),m.default.removeEscapeHandler(this._onClose)}render(){return this.state.isGuestFlow?this._renderGuestPopup():this._renderPopup()}_renderCloseButton(){const e=[P.closeButton];return this._getContext().isRTL&&e.push(a.Styles.createTextStyle({marginRight:0,marginLeft:-6})),a.createElement(a.Button,{accessibilityLabel:u.getString("CallCreatorShareOverlayPopup.CloseButtonAccessibilityLabel"),style:e,onPress:this._onClose},a.createElement(p.default,{key:"dismissButton",color:this._themeColors.primaryIconColor,size:h.IconSize.size24,icon:h.SkypeIcon.Cancel}))}_renderShareInviteEmail(){const e=a.Styles.createTextStyle({textDecorationLine:"underline",alignSelf:"center",color:o.Color.blue});return a.createElement(a.Button,{accessibilityLabel:u.getString("CallCreatorShareOverlayPopup.ShareByEmailLabelAccessibilityLabel"),style:e,onPress:this._inviteByEmail},a.createElement(a.Text,{style:P.inviteButtonText},u.getString("CallCreatorShareOverlayPopup.ShareByEmailLabel")))}_renderMeetNowJoinLinkButton(){return a.createElement(s.default,{threadId:this._threadId,joinLink:this.state.joinLink,partnerParameters:this.props.meetNowParameters,useVerboseView:!0,style:[P.joinLinkButton],useAppTheme:!0})}_renderGuestPopup(){const e=this.state.isJoinEnabled&&a.createElement(a.View,null,a.createElement(a.Text,{style:[P.secondaryLabel,{color:this._themeColors.primaryTextColor}]},u.getString("CallCreatorShareOverlayPopup.SecondaryLabel")),this._renderMeetNowJoinLinkButton(),this._renderShareInviteEmail());return a.createElement(a.View,{style:this._getContainerBackgroundStyles()},a.createElement(a.View,{style:P.headerView},a.createElement(a.Text,{style:[P.primaryLabelGuestFlow,{color:this._themeColors.primaryTextColor}]},u.getString("CallCreatorShareOverlayPopup.PrimaryLabelGuestFlow")),this._renderCloseButton()),a.createElement(l.default,{threadId:this._threadId,isErrorVisible:this.state.isUserNameRequiredErrorVisible,meetNowParameters:this.props.meetNowParameters,onChangeValue:this._onUserNameChange}),e)}_renderPopup(){return a.createElement(a.View,{style:this._getContainerBackgroundStyles()},a.createElement(a.View,{style:P.headerView},a.createElement(a.Text,{style:[P.primaryLabel,{color:this._themeColors.secondaryTextColor}]},u.getString("CallCreatorShareOverlayPopup.PrimaryLabel")),this._renderCloseButton()),a.createElement(a.Text,{style:[P.secondaryLabel,{color:this._themeColors.primaryTextColor}]},u.getString("CallCreatorShareOverlayPopup.SecondaryLabel")),this._renderMeetNowJoinLinkButton(),this.state.joinLink&&a.createElement(T.default,{joinLink:this.state.joinLink,conversationMri:this.props.conversationMri,meetNowParameters:Object.assign(Object.assign({},this.props.meetNowParameters),{origin:r.MeetNowOrigin.CreatorPanelPopup}),logSource:"CallCreatorShareOverlayPopup",onClick:this._onInviteSkypeContactsClick}))}}t.default=M},10701:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallEventStreamItem=void 0;const a=i(16778),n=i(88837),o=(i(34339),i(95952),i(15877)),s=i(90244),r=i(81760),l=i(19675),c=i(2301),d=(0,o.lazyProperties)({container:()=>a.Styles.createViewStyle({position:"absolute",left:16,right:16,paddingTop:12,flexDirection:"row",alignSelf:"stretch",overflow:"visible"}),contentContainer:()=>a.Styles.createViewStyle({flex:-1,alignItems:"stretch",alignSelf:"center",paddingLeft:5,paddingRight:10}),middleContainer:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignSelf:"stretch",overflow:"visible"}),middleContentInner:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"flex-start",overflow:"visible"}),contentText:()=>a.Styles.createTextStyle({color:r.Color.black,paddingVertical:8}),contentTextLight:()=>a.Styles.createTextStyle({color:r.Color.white}),wrapper:()=>a.Styles.createViewStyle({flex:-1,paddingHorizontal:8,flexDirection:"row",minHeight:40,borderRadius:20,backgroundColor:r.Color.blackOverlay50,justifyContent:"center",alignItems:"center",overflow:"visible"}),flipSide:()=>a.Styles.createViewStyle({height:26,width:26,alignItems:"center",justifyContent:"center"}),flipContainer:()=>a.Styles.createViewStyle({height:26,width:26,overflow:"visible"}),raiseHandBorderStyle:()=>a.Styles.createViewStyle({borderColor:r.Color.raiseHandOrange,borderWidth:2})});class u extends n.ComponentBase{constructor(){super(...arguments),this._onLayoutChange=e=>{this.props.layoutController&&this.props.layoutController.setIntrinsicHeight(e.height)}}_getColorStyle(){return a.Styles.createViewStyle({backgroundColor:this.props.backgroundColor},!1)}_getUserIconElement(){if(!this.props.mri)return;const e=a.createElement(c.UserIcon,{size:26,userMri:this.props.mri,imageBorderStyleOverride:this.props.isRaiseHandEvent?d.raiseHandBorderStyle:void 0});return this.props.isLeaveEvent||this.props.isRaiseHandEvent||this.props.isTextEvent,e}componentDidMount(){super.componentDidMount(),a.Accessibility.announceForAccessibility(this.props.displayString)}render(){const e=[d.wrapper,this._getColorStyle()],t=[d.contentText];(this.props.isLeaveEvent||this.props.useLightText)&&t.push(d.contentTextLight);const i=this.props.isRaiseHandEvent?a.createElement(s.default,{type:s.RaiseHandImageType.SmallSizeTopLeftAligned}):void 0,n=a.createElement(a.View,{key:"contentContainerWrapper",style:e},this._getUserIconElement(),i,a.createElement(a.View,{key:"contentContainer",style:d.contentContainer},a.createElement(l.BodyText,{size:l.BodyTextSize.SmallDeprecated,style:t},this.props.displayString))),o=a.createElement(a.View,{key:"middleContentInner",style:d.middleContentInner,ignorePointerEvents:!0},n),r=[d.container];return this.props.layoutController&&r.push(this.props.layoutController.getStyles()),this.props.horizontalSafeAreaInsets&&this.props.horizontalSafeAreaInsets.left>16&&r.push(a.Styles.createViewStyle({left:this.props.horizontalSafeAreaInsets.left,right:this.props.horizontalSafeAreaInsets.right},!1)),a.createElement(a.Animated.View,{style:r,ignorePointerEvents:!0,onLayout:this._onLayoutChange},a.createElement(a.View,{key:"middleContent",style:d.middleContainer,ignorePointerEvents:!0},o))}}t.CallEventStreamItem=u,t.default=u},4325:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(16778),o=i(44770),s=i(89391),r=i(94224),l=i(71727),c=i(46096),d=i(36237),u=i(36400),h=i(15877),p=i(33754),g=i(81760),C=i(11010),m=i(19675),S=i(24576),y=i(53374),f=i(2301),_=i(67977),b=(0,h.lazyProperties)({bingBackgroundsContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",marginRight:16,width:void 0}),bingBackgroundsIcon:()=>n.Styles.createViewStyle({width:16,height:16}),bingBackgroundsIconSmall:()=>n.Styles.createViewStyle({width:12,height:12}),bingBackgroundsIconMargin:()=>n.Styles.createViewStyle({marginRight:5}),bingBackgroundsText:()=>n.Styles.createTextStyle({backgroundColor:g.Color.transparent,textAlign:"center",textAlignVertical:"center",marginRight:5,paddingBottom:1}),bingBackgroundsFont:()=>n.Styles.createTextStyle({fontSize:C.default.fontSize.size13Deprecated,font:C.default.font.uiDisplayRegular}),bingBackgroundsFontColor:()=>n.Styles.createTextStyle({color:g.Color.white}),bingBackgroundsFontColorLight:()=>n.Styles.createTextStyle({color:g.Color.gray400}),bingBackgroundsUserIcon:()=>n.Styles.createViewStyle({marginRight:1}),plusCountContainer:()=>n.Styles.createTextStyle({height:20,minWidth:20,textAlign:"center"})});class T extends S.default{constructor(){super(...arguments),this._onBingBackgroundsPressed=()=>{const e=y.default.newCauseId();d.log(c.LogTraceArea.CallingUI,"CallPanelHeaderV2._onBingBackgroundsPressed, causeId: "+e),this.props.onBingBackgroundsPressed&&this.props.onBingBackgroundsPressed(e)}}_buildState(e,t){const i=r.default.CallParticipantBackgroundInfoStore.getBackgroundInfos(e.callId),a=s.default.getS4LCMCFeatures().bingBackgrounds;return{captions:i,bingBackgroundsUsers:this._getUserIconList(i),showIconCount:a.iconCountInHeader,compactView:l.default.isDesktopMinCallPanelHeaderV2(this._getRootViewId())}}_getUserIconList(e){const t=[];for(let i of a.values(e))""!==i.isoDate&&t.push(i.userId);return t}render(){var e;const t=null!==(e=this.props.textStyleOverride)&&void 0!==e?e:b.bingBackgroundsFont,i=this.props.useLightTheme?b.bingBackgroundsFontColorLight:b.bingBackgroundsFontColor;let a,s,r=_.UserIconSize.Size20,l=20,c=14;this.props.v1&&(r=_.UserIconSize.Size14,l=14,c=void 0,a=4,s=2);const d=n.Styles.createViewStyle({height:l,width:l}),h=n.Styles.createViewStyle({marginTop:s}),g=this.props.v1?b.bingBackgroundsIconSmall:b.bingBackgroundsIcon,C=n.Styles.createViewStyle({height:this.props.height,marginLeft:a,marginRight:c}),S=[];if(this.state.bingBackgroundsUsers&&this.state.bingBackgroundsUsers.length>0&&this.state.showIconCount&&this.state.showIconCount>0){const e=this.state.bingBackgroundsUsers.length>this.state.showIconCount?this.state.showIconCount:this.state.bingBackgroundsUsers.length;for(let t=0;t<e;t++){const e=this.state.bingBackgroundsUsers[t];S.push(n.createElement(f.UserIcon,{key:"userIcon-"+t,userMri:e,size:r,useCircleForAgentMask:!0,statusBorderColor:this._themeColors.primaryBackgroundColor,style:[b.bingBackgroundsUserIcon,h]}))}const a=this.state.bingBackgroundsUsers.length-this.state.showIconCount;a>0&&S.push(n.createElement(m.BodyText,{key:"userIcon-hidden",style:[b.bingBackgroundsUserIcon,b.plusCountContainer,i,t,d,h]},`+${a}`))}const y=p.getString("CallControls.BingBackgrounds");let T;return this.state.compactView||(T=n.createElement(m.BodyText,{style:[b.bingBackgroundsText,t]},y)),n.createElement(u.HoverableButton,{style:[b.bingBackgroundsContainer,C],title:y,accessibilityLabel:y,onPress:this._onBingBackgroundsPressed},n.createElement(n.Image,{source:o.Collection.BING_LOGO_SMALL,style:[g,b.bingBackgroundsIconMargin],resizeMode:"cover"}),T,S)}}t.default=T},81783:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallItemLayoutController=void 0;const a=i(96486),n=i(16778),o=i(74634),s=i(90295),r=i(80200),l=i(23413),c=i(71727),d=i(15877),u=i(30124),h=i(81760),p=i(40363),g=i(80837),C=i(53374),m=(0,d.lazyProperties)({elementBase:()=>n.Styles.createViewStyle({position:"absolute",overflow:"visible"}),stageElementBase:()=>n.Styles.createViewStyle({position:"relative",overflow:"visible",flexGrow:0,flexShrink:1}),stageBackgroundStyle:()=>n.Styles.createViewStyle({backgroundColor:h.Color.callStageLight}),lightThemeBackgroundStyle:()=>n.Styles.createViewStyle({backgroundColor:h.Color.gray50,borderColor:h.Color.gray200}),lightThemeVideoBorderStyle:()=>n.Styles.createViewStyle({backgroundColor:h.Color.gray100Overlay80})});class S{constructor(e,t,i,a,s){this._isCallStageV2=s,this._isHidden=!1,this._isDragging=!1,this._isTopRowElement=!1,this._currentBorderRadius=r.RibbonSizes.ribbonItemSizeSmall/2,this._currentRibbonRightInset=0,this._currentRibbonVerticalOffset=0,this._ribbonExpandedMultiplier=1,this._currentBackgroundOffset=0,this._useApproachValue=!1,this._panningThrottle=0,this._panEventCount=0,this._hasPositionedView=!1,this._globalResizeFactor=1,this._sessionStartResizeFactor=1,this._fullStageRect={x:0,y:0,width:0,height:0},this._currentRect={x:0,y:0,width:r.RibbonSizes.ribbonItemSizeSmall,height:r.RibbonSizes.ribbonItemSizeSmall},this._isResizing=!1,this._rawRibbonRect={x:0,y:0,width:r.RibbonSizes.ribbonItemSizeSmall,height:r.RibbonSizes.ribbonItemSizeSmall},this._animatedHorizontalValue=new n.Animated.Value(this._currentRect.x),this._animatedVerticalValue=new n.Animated.Value(this._currentRect.y),this._animatedWidthValue=new n.Animated.Value(this._currentRect.width),this._animatedHeightValue=new n.Animated.Value(this._currentRect.height),this._animatedBorderRadiusValue=new n.Animated.Value(this._currentBorderRadius),this._animatedBackgroundValue=new n.Animated.Value(this._currentBackgroundOffset),this._rectChangedEvent=new o.default,this._topRowChangedEvent=new o.default,this._isRTL=p.default.isRTL(),this._animatedStageHeightValue=new n.Animated.Value(1),this._animatedStageWidthValue=new n.Animated.Value(1),this._baseAnimatedStyle=n.Styles.createAnimatedViewStyle({width:this._animatedWidthValue,height:this._animatedHeightValue,top:this._animatedVerticalValue}),this._animatedStyleLTR=n.Styles.createAnimatedViewStyle({right:this._animatedHorizontalValue}),this._animatedStyleRTL=n.Styles.createAnimatedViewStyle({left:this._animatedHorizontalValue}),this._animatedInnerStyle=n.Styles.createAnimatedViewStyle({borderRadius:this._animatedBorderRadiusValue}),this._animatedBackgroundStyle=n.Styles.createAnimatedViewStyle({backgroundColor:this._animatedBackgroundValue.interpolate({inputRange:[0,1],outputRange:[h.Color.callStageDark,h.Color.callStageLight]})}),this._animatedStageContainerStyle=n.Styles.createAnimatedViewStyle({height:this._animatedStageHeightValue.interpolate({inputRange:[0,1],outputRange:["0%","100%"]}),width:this._animatedStageWidthValue.interpolate({inputRange:[0,1],outputRange:["0%","100%"]})}),this._key=e,this._currentRibbonRightInset=i,this._currentRibbonVerticalOffset=t,this._ribbonExpandedMultiplier=a}setHidden(e){this._isHidden!==e&&(this._isHidden=e,this._hiddenChangedCallback&&this._hiddenChangedCallback(e))}setResizeFactor(e){this._globalResizeFactor=e}getResizeFactor(){return this._globalResizeFactor}setUIPosition(e){this._uiPosition=e}getUIPosition(){return this._uiPosition}setFullStageRect(e){this._fullStageRect=e}setViewCanAnimateState(e,t){a.isUndefined(this._latestView)?(this._latestView=e,this._latestViewCanAnimate=t):this._latestView===e?(this._latestViewCanAnimate=t,t||(this._latestView=void 0)):this._latestView!==e&&t&&(this._latestView=e,this._latestViewCanAnimate=t)}onPan(e,t,i){if(!this._isDragging&&!e.isComplete&&(this._isDragging=!0,this._useApproachValue)){const e=i||this._currentRect,t={x:e.x+e.width/2,y:e.y+e.height/2};this._startApproach(t,(e=>{const t=this._centerRectAroundPoint(e);this._updateAnimatedValues(t,this._currentBorderRadius,!1,void 0,0,!0)}))}if(!e.isComplete&&this._panningThrottle>0&&this._panEventCount%this._panningThrottle>0)return void this._panEventCount++;const a=Math.max(Math.min(e.pageX-t.x,t.width),0),n=Math.max(Math.min(e.pageY-t.y,t.height),0),o=c.default.translatePoint({x:a,y:n},t.width);if(o)if(this._useApproachValue)this._approachValue&&this._approachValue.updateTarget(o);else{const e=this._centerRectAroundPoint(o);this._updateAnimatedValues(e,this._currentBorderRadius,!1,void 0,0,!0)}e.isComplete?(this._stopApproach(),this._isDragging=!1,this._panEventCount=0):this._panEventCount++}updateRibbonVerticalOffset(e,t,i=!1,a=r.CallStageConfig.animationDuration){if(this._currentRibbonVerticalOffset=e,this.isCompact()&&!this._isDragging){const e=this._ribbonViewRectFromRect(this._rawRibbonRect);this._updateAnimatedValues(e,this._currentBorderRadius,i,void 0,a)}}updateRibbonRightInset(e,t,i=!1,a=r.CallStageConfig.animationDuration){if(this._currentRibbonRightInset=e,this.isCompact()&&!this._isDragging){const e=this._ribbonViewRectFromRect(this._rawRibbonRect);this._updateAnimatedValues(e,this._currentBorderRadius,i,void 0,a)}}updateRibbonExpandedMultiplier(e,t,i=!1,a=r.CallStageConfig.animationDuration){if(this._ribbonExpandedMultiplier=e,this.isCompact()&&!this._isDragging){const e=this._ribbonViewRectFromRect(this._rawRibbonRect);this._updateAnimatedValues(e,this._currentBorderRadius,i,void 0,a)}}ribbonViewRect(){return this._ribbonViewRectFromRect(this._rawRibbonRect)}setRibbonPosition(e,t,i,a,n=!1){if(this._positionedInRibbon=!0,this._fullStageRect=i,this._rawRibbonRect=e,!this._isDragging){const i=this._ribbonViewRectFromRect(e);this._updateAnimatedValues(i,this._borderRadius(!1,t,a),n)}}resizeRect(e,t,i,n){if(!this._isDragging){if(this._isResizing||(this._sessionStartResizeFactor=this._globalResizeFactor,this._isResizing=!0),this._uiPosition===r.CallingViewUIPostion.FloatingOnTop){a.isUndefined(this._currentRectForResizingSession)&&(this._currentRectForResizingSession=this._currentRect),this._currentRectForResizingSession.height*e<r.RibbonSizes.ribbonItemSizeSmall&&(e=r.RibbonSizes.ribbonItemSizeSmall/this._currentRectForResizingSession.height),this._currentRectForResizingSession.width*e>this._fullStageRect.width/2&&(e=this._fullStageRect.width/2/this._currentRectForResizingSession.width);let t=this._currentRectForResizingSession;switch(i){case r.CallingViewCornerPostion.BottomLeft:t={x:this._currentRectForResizingSession.x,y:this._currentRectForResizingSession.y,width:this._currentRectForResizingSession.width*e,height:this._currentRectForResizingSession.height*e};break;case r.CallingViewCornerPostion.BottomRight:t={x:this._currentRectForResizingSession.x-this._currentRectForResizingSession.width*(e-1),y:this._currentRectForResizingSession.y,width:this._currentRectForResizingSession.width*e,height:this._currentRectForResizingSession.height*e};break;case r.CallingViewCornerPostion.UpperLeft:t={x:this._currentRectForResizingSession.x,y:this._currentRectForResizingSession.y-this._currentRectForResizingSession.height*(e-1),width:this._currentRectForResizingSession.width*e,height:this._currentRectForResizingSession.height*e};break;case r.CallingViewCornerPostion.UpperRight:t={x:this._currentRectForResizingSession.x-this._currentRectForResizingSession.width*(e-1),y:this._currentRectForResizingSession.y-this._currentRectForResizingSession.height*(e-1),width:this._currentRectForResizingSession.width*e,height:this._currentRectForResizingSession.height*e}}this._updateAnimatedValues(t,r.RibbonSizes.ribbonItemRectBorderRadius,!0),n&&(this._currentRectForResizingSession=void 0)}else this._uiPosition===r.CallingViewUIPostion.Ribbon&&(this._globalResizeFactor=Math.min(Math.max(this._sessionStartResizeFactor*e,1),4));n&&(this._isResizing=!1)}}setIsTopRowElement(e){this._isTopRowElement=e,this._topRowChangedEvent.fire(e)}getIsTopRowElement(){return this._isTopRowElement}setStagePosition(e,t,i,a,n,o=!1,s){this._positionedInRibbon=!1,this._fullStageRect=n,this._isDragging||this._updateAnimatedValues(t,this._borderRadius(!0,a,0),o,void 0,void 0,void 0,s),this._animatedBackgroundValue.setValue(i/e)}getStyles(e){return e?this._getStageStyles():[m.elementBase,this._baseAnimatedStyle,this._isRTL&&this._key===r.CallStageElementKeys.localUserKey?this._animatedStyleRTL:this._animatedStyleLTR]}getInnerStyles(){return[g.default.flexOne,this._animatedInnerStyle]}getBackgroundColorStyle(e){const t=e?m.lightThemeBackgroundStyle:m.stageBackgroundStyle;return this._isCallStageV2?t:this._animatedBackgroundStyle}getVideoBorderColorStyle(e){const t=e?m.lightThemeVideoBorderStyle:m.stageBackgroundStyle;return this._isCallStageV2?t:void 0}onDimensionsChanged(e){this._dimensionsChangedCallback=e}onRectChanged(e){return this._rectChangedEvent.subscribe(e)}onHiddenChanged(e){this._hiddenChangedCallback=e}onTopRowChanged(e){return this._topRowChangedEvent.subscribe(e)}isCompact(){return this._positionedInRibbon}isHidden(){return this._isHidden}viewRect(e){if(e){const e=c.default.translateRect(this._currentRect,this._fullStageRect.width);return Object.assign(Object.assign({},e),{x:e.x+this._fullStageRect.x,y:e.y})}return this._currentRect}setCallHeaderPanelLayout(e){this._callPanelHeaderLayout=e}bgInfoCaptionOffset(e,t){let i;const a=t||16;{i=a;const t=this._callPanelHeaderLayout===r.CallPanelHeaderLayout.Float;this._isTopRowElement&&t&&(i+=l.DesktopMinTopMargin);const n=c.default.isDesktopMinCallPanelHeader(e);!this._isCallStageV2&&this._isTopRowElement&&n&&(u.default.isUsingStackNavigationContextNoSubscription()?i+=r.CallPanelHeaderHeight.mobile:i+=r.CallPanelHeaderHeight.window)}return{x:a,y:i,width:0,height:0}}_getStageStyles(){return[m.stageElementBase,this._animatedStageContainerStyle]}_centerRectAroundPoint(e){const t=this._currentRect.width,i=this._currentRect.height;return{x:e.x-t/2,y:e.y-i/2,width:t,height:i}}_stopApproach(){this._approachValue&&(this._approachValue.stop(),this._approachValue=void 0)}_startApproach(e,t){this._useApproachValue&&(this._stopApproach(),this._approachValue=new s.default(e,t),this._approachValue.start())}_borderRadius(e,t,i){return e?0:t?r.RibbonSizes.ribbonItemRectBorderRadius:i/2}_ribbonViewRect(e,t,i,a){const n=C.default.clampValue(this._ribbonExpandedMultiplier,0,1),o=e+this._currentRibbonRightInset,s=(this._maxY(this._rawRibbonRect)+this._currentRibbonVerticalOffset+30)*(1-n),r={x:o,y:t+this._currentRibbonVerticalOffset-s,width:i,height:a};return this._isRTL?c.default.translateRect(r,this._fullStageRect.width):r}_ribbonViewRectFromRect(e){return this._ribbonViewRect(e.x,e.y,e.width,e.height)}_maxY(e){return e.y+e.height}_updateAnimatedValues(e,t,i,o,s,l,d){if(!a.isUndefined(this._latestViewCanAnimate)&&!this._latestViewCanAnimate)return;if(i&&this._hasPositionedView&&c.default.enableLayoutAnimation()){const i=s||r.CallStageConfig.animationDuration,a=o||n.Animated.Easing.InOut();let c=[];c.push(n.Animated.timing(this._animatedVerticalValue,{toValue:e.y,duration:i,easing:a})),c.push(n.Animated.timing(this._animatedHorizontalValue,{toValue:e.x,duration:i,easing:a})),d&&(c.push(n.Animated.timing(this._animatedStageWidthValue,{toValue:d.width,duration:i,easing:a})),c.push(n.Animated.timing(this._animatedStageHeightValue,{toValue:d.height,duration:i,easing:a}))),l||(c.push(n.Animated.timing(this._animatedWidthValue,{toValue:e.width,duration:i,easing:a})),c.push(n.Animated.timing(this._animatedHeightValue,{toValue:e.height,duration:i,easing:a})),c.push(n.Animated.timing(this._animatedBorderRadiusValue,{toValue:t,duration:i,easing:a}))),c.length&&n.Animated.parallel(c).start()}else this._animatedVerticalValue.setValue(e.y),this._animatedHorizontalValue.setValue(e.x),d&&(this._animatedStageWidthValue.setValue(d.width),this._animatedStageHeightValue.setValue(d.height)),l||(this._animatedWidthValue.setValue(e.width),this._animatedHeightValue.setValue(e.height),this._animatedBorderRadiusValue.setValue(t));!this._dimensionsChangedCallback||this._currentRect.height===e.height&&this._currentRect.width===e.width?this._currentRect.x===e.x&&this._currentRect.y===e.y||this._rectChangedEvent.fire(e):(this._dimensionsChangedCallback(e),this._rectChangedEvent.fire(e)),this._currentRect=e,this._currentBorderRadius=t,this._hasPositionedView=!0}}t.CallItemLayoutController=S,t.default=S},92387:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(89391),o=i(39119),s=i(25489),r=i(96096),l=i(98278),c=i(34672),d=i(16402),u=i(52262),h=i(4604),p=i(36237),g=i(15877),C=i(33754),m=i(18078),S=i(4735),y=i(30124),f=i(59433),_=i(19675),b=i(24576),T=i(53374),v=(0,g.lazyProperties)({textStyle:()=>a.Styles.createTextStyle({justifyContent:"center",alignItems:"center",paddingHorizontal:10}),textStyleSelected:()=>a.Styles.createTextStyle({justifyContent:"center",alignItems:"center"}),markerTextPadding:()=>a.Styles.createViewStyle({paddingTop:4}),container:()=>a.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"center",marginLeft:10,marginRight:10,paddingTop:10}),containerComposite:()=>a.Styles.createViewStyle({marginLeft:50,marginRight:0})});class w extends b.default{constructor(){super(...arguments),this._getCallForwardingActionLink=()=>a.createElement(f.default,{key:"callForwardingCTALinkId",style:[v.textStyle,v.markerTextPadding],onPress:this._onCallForwardingButtonPress,url:"#",blue:!0,linkTextStyle:l.LinkTextStyle.Caption},C.getString("CallCard.SetupCallForwardingLink")),this._onCallForwardingButtonPress=()=>{p.track(new c.SetUpCallForwardingClicked),S.default.navigateToCallingSettingsPanel(!1,this._getContext())}}_buildState(e,t){const i=h.default.getCreditEntitlement(),a=!!o.getPositiveCreditBalance(i)||h.default.userHasSubscriptions(),l=s.default.getCallLog(e.callId),c=r.default.calculateCallMarkerInfoFromPath(l,e.callId,e.conversationId,e.markerType,e.duration);return{isUsingStackNavigationContext:y.default.isUsingStackNavigationContext(),callerFirstName:u.default.getMemberShortNameForConversation(e.conversationId,e.callerMri),isCallerTheCurrentUser:m.default.isMyMri(e.callerMri),isPayingUser:a,enablePaidUsersCallForwardingUpsell:n.default.getS4LCommerceFeatures().creditUpsell.enablePaidUsersCallForwardingUpsell,enableAllUsersCallForwardingUpsell:n.default.getS4LCommerceFeatures().creditUpsell.enableAllUsersCallForwardingUpsell,markerType:c.type,duration:c.duration}}render(){let e,t,i,n;const o=this.state.markerType;switch(o){case r.CallMarkerType.Started:e=C.getString("CallCard.CallStartedMarker");break;case r.CallMarkerType.Missed:this.state.isCallerTheCurrentUser?e=C.getString("CallCard.MissedCallMarker"):(e=C.getString("CallCard.MissedCallFromCallerMarker",{caller:this.state.callerFirstName}),(this.state.enablePaidUsersCallForwardingUpsell&&this.state.isPayingUser||this.state.enableAllUsersCallForwardingUpsell)&&(n=this._getCallForwardingActionLink()));break;case r.CallMarkerType.Ended:e=this.props.messagesSentDuringCall?C.getString("CallCard.CallEndedMarker"):C.getString("CallCard.CallMarker"),this.state.duration&&(t=d.default.getFormattedDuration(this.state.duration,!1),i=d.default.getFormattedDuration(this.state.duration,!0));break;case r.CallMarkerType.Declined:e=C.getString("CallCard.CallDeclinedStatusMessage");break;case r.CallMarkerType.NoAnswer:e=C.getString("CallCard.CallNoAnswerStatusMessage");break;case r.CallMarkerType.Failed:e=C.getString("CallCard.CallFailedStatusMessage");break;default:T.default.switchStatementExhaustiveChecking(o)}const s=a.createElement(_.Caption,{selected:!0,style:[v.textStyleSelected,this.props.style],key:"callMarkerText"},e),l=t?C.getParts("CallCard.Marker",{markerText:s,markerValue:t}):s;let c=e;e&&i&&(c=C.getString("AccessibilityLabel.CallMarker",{markerText:e,duration:i}));const u=a.createElement(a.View,{accessibilityLabel:c,accessibilityTraits:a.Types.AccessibilityTrait.Text},a.createElement(_.Caption,{style:[v.textStyle,v.markerTextPadding,this.props.style],textThemeColor:_.TextThemeColor.Secondary,accessibilityHidden:!0},l)),h=[v.container];this.state.isUsingStackNavigationContext||this._getContext().isPresentedInDesktopSubview||h.push(v.containerComposite);const p=a.createElement(_.Caption,{style:[v.textStyle,this.props.style]},d.default.getDisplayTimeString(this.props.timestamp));return a.createElement(a.View,{style:h,key:`callMarker-${this.props.callId}`},p,u,n)}}t.default=w},23413:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DesktopMinTopMargin=void 0;const a=i(96486),n=i(63297),o=i(16778),s=i(48540),r=i(31844),l=i(89391),c=i(79231),d=i(20187),u=i(94224),h=i(53376),p=i(36850),g=i(80200),C=i(71727),m=i(5531),S=i(71830),y=i(98278),f=i(24490),_=i(57139),b=i(46096),T=i(13944),v=i(36237),w=(i(34896),i(24907)),I=i(15877),P=i(33754),M=i(43786),k=i(27357),A=i(36150),R=i(81760),V=i(11828),L=i(34528),E=i(80837),B=i(24576),O=i(63841),D=i(12770),x=i(53374),N=i(30124);var U;!function(e){e[e.Closed=0]="Closed",e[e.Opening=1]="Opening",e[e.Open=2]="Open"}(U||(U={})),t.DesktopMinTopMargin=g.RibbonSizes.ribbonItemSizeSmall+g.RibbonSizes.ribbonItemModernStageTopMargin;const F=(0,I.lazyProperties)({callPanelHeader:()=>o.Styles.createViewStyle({appRegion:"drag",flexDirection:"row",alignSelf:"stretch",height:g.CallPanelHeaderHeight.mobile,overflow:"visible"}),callPanelHeaderDesktop:()=>o.Styles.createViewStyle({backgroundColor:R.Color.transparent,alignItems:"center",height:g.CallPanelHeaderHeight.window}),callPanelHeaderDesktopMin:()=>o.Styles.createViewStyle({marginTop:t.DesktopMinTopMargin,justifyContent:"center"}),leftControl:()=>o.Styles.createViewStyle({flexDirection:"row",justifyContent:"center",alignItems:"center",paddingHorizontal:16,paddingTop:17,height:52,backgroundColor:R.Color.transparent}),leftControlDesktop:()=>o.Styles.createViewStyle({paddingTop:0,paddingLeft:16,paddingRight:0}),leftControlDesktopMin:()=>o.Styles.createViewStyle({position:"absolute",left:0,transform:[{translateY:-1*t.DesktopMinTopMargin}]}),recentsButton:()=>o.Styles.createViewStyle({width:V.IconSize.default,height:V.IconSize.default,borderRadius:V.IconSize.default/2,backgroundColor:R.Color.white,paddingLeft:0,marginLeft:16}),rightControls:()=>o.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-end",paddingTop:10}),rightControlsButton:()=>o.Styles.createButtonStyle({alignSelf:"stretch",alignItems:"center",marginRight:16,height:52}),titleContainerInner:()=>o.Styles.createViewStyle({flex:-1,justifyContent:"center",paddingHorizontal:20}),titleContainer:()=>o.Styles.createViewStyle({alignItems:"stretch",justifyContent:"flex-start",backgroundColor:R.Color.transparent,overflow:"visible",marginRight:16}),titleContainerStackNav:()=>o.Styles.createViewStyle({flex:1,height:g.CallPanelHeaderHeight.mobile}),titleContainerTablet:()=>E.default.flexOne,titleContainerDesktopMin:()=>o.Styles.createViewStyle({justifyContent:"center"}),undraggableRegion:()=>o.Styles.createViewStyle({appRegion:"no-drag"}),backButtonSpacer:()=>o.Styles.createViewStyle({width:64})});class H extends B.default{constructor(){super(...arguments),this._handleBackButtonClick=e=>{e.stopPropagation();const t=x.default.newCauseId();v.log(b.LogTraceArea.CallingUI,"CallPanelHeader._handleBackButtonClick, causeId: "+t),this.props.onBackButtonPressed(t)},this._handleRecentsButtonPress=e=>{e.stopPropagation();const t=x.default.newCauseId();v.log(b.LogTraceArea.CallingUI,"CallPanelHeader._handleRecentsButtonPress, causeId: "+t),this.props.onRecentsButtonPressed(t)},this._onTitleLayout=e=>{if(this.props.onTitleLayout){const t={x:e.x,y:e.y,width:e.width+60,height:e.height};this.props.onTitleLayout(t)}},this._onTitlePress=(e,t)=>{v.log(b.LogTraceArea.CallingUI,"CallPanelHeader._onTitlePress, causeId: "+e),this.props.onTitlePress&&this.props.onTitlePress(e,t)},this._onOpenRoster=()=>{const e=x.default.newCauseId();v.log(b.LogTraceArea.CallingUI,"CallPanelHeader._onOpenRoster, causeId: "+e),this.props.onRosterPressed&&this.props.onRosterPressed(e,g.CallRosterOrigin.FromParticipantCount)},this._onDynamicAudioChoice=e=>{this.props.onDynamicAudioChoice&&this.props.onDynamicAudioChoice(e,(()=>this._audioOutputButton))},this._onAudioOutputButtonRef=e=>{this._audioOutputButton=e||void 0},this._onLayoutButtonRef=e=>{this._layoutButton=e||void 0},this._onNewPickerPress=()=>{const e=()=>this._layoutButton,t=this._getRootViewId();r.default.isFullScreenMode(this._getRootViewId()).then((i=>{_.default.showWithContent({menuId:_.default.menuId(),anchor:e,rootViewId:t,menuHeight:w.default.getLayoutPickerHeight(this.state.availableMenuItems),content:o.createElement(w.default,{anchor:e,rootViewId:t,useMobileControls:this.props.useMobileControls,isIncomingOrOutGoingRing:this.props.incomingOrOutgoingRing,callId:this.props.callId,conversationMri:this.props.conversationId,availableItems:this.state.availableMenuItems,isInFullscreenMode:i}),useBlurredBackground:!0,colorThemeOverride:O.Theme.DelphiDark,headerConfig:{headerType:f.HeaderType.Slim},staticContent:!0,useTransparentShim:!0,hidePopupArrow:!0,getTitle:()=>{},onCloseMenu:e=>_.default.close(t,e),onMenuClosed:this._onMenuClosed},x.default.newCauseId())}))},this._toggleGridFocusView=()=>{const e=this.state.hasIncomingScreenshare?g.StageMode.FocusedScreenShare:g.StageMode.Speaker,t=C.default.isInGridStageMode(this.state.stageMode)?e:g.StageMode.Grid;this._changeCallLayoutCommand.execute(t)},this._onMenuClosed=e=>{this.state.availableMenuItems.forEach((e=>{e.markAsSeen&&e.markAsSeen()}))}}_buildState(e,t){const i=p.default.getStageMode(e.callId),n=u.default.CallScreenShareStore.hasIncomingScreensharing(e.callId),o={isPSTNCall:u.default.CallingStore.isPSTNCall(e.callId),isEncryptedCall:S.isEncryptedThread(e.conversationId),conversationMri:e.conversationId,callId:e.callId};this._changeCallLayoutCommand=new d.ChangeCallLayoutCommand(o,e.incomingOrOutgoingRing,i);const r=u.default.CallingStore.isProvidingVideo(e.callId),h=u.default.OngoingCallService.getStageParticipants(e.callId),y=A.default.isMobileScreenReaderEnabled(),f=e.useMobileControls&&r&&(!(e.isNewCameraFlipEnabled&&!y)||a.includes(h,g.CallStageElementKeys.localUserKey));let _=s.CameraPosition.Unknown;if(f){const e=u.default.DeviceStore.getSelectedCamera();_=e?e.position:s.CameraPosition.Unknown}const b=l.default.getS4LCMCFeatures().enableFullScreenOnWeb&&!N.default.isUsingSplitViewNoSubscription(),T=C.default.getAvailableMenuItems(e.callId,b,e.useMobileControls,e.conversationId),v={showCameraToggle:f,cameraPosition:_,showRecentsButton:!e.isUsingStackNavigationContext&&m.default.navigation().canAccessRecentsList,isDesktopMin:C.default.isDesktopMinCallPanelHeader(this._getRootViewId()),isGalleryShowing:k.default.isGalleryShowing(this._getRootViewId()),outputRoute:u.default.CallControlsStore.getAudioOutput(),useiOSRoutePicker:c.AudioOutputRouteHelper.useiOSRoutePicker(),stageMode:i,hasIncomingScreenshare:n,changeCallLayoutEnabled:e.useMobileControls&&this._changeCallLayoutCommand.canExecute(),moreOutputRoutesAvailable:!1,newLayoutPickerEnabled:l.default.getS4LCMCFeatures().enableNewLayoutPicker,isOneOnOneCall:u.default.CallingStore.isOneOnOneCall(e.callId),availableMenuItems:T};return!t&&e.isRecentsOpen&&this.state?e.isRecentsOpen&&this.state.recentsOpenState===U.Closed&&(v.recentsOpenState=U.Opening,this._clearIsRecentsOpenTimeout(),this._isRecentsOpeUpEdgeTimeout=D.default.setTimeout((()=>{this.isComponentMounted()&&this.setState({recentsOpenState:U.Open}),this._isRecentsOpeUpEdgeTimeout=void 0}),300)):(v.recentsOpenState=e.isRecentsOpen?U.Open:U.Closed,this._clearIsRecentsOpenTimeout()),v}_areMoreAudioOutputsAvailable(e){if(!l.default.getS4LCMCFeatures().earpieceHiddenForVideoCalls)return v.log(b.LogTraceArea.CallingUI,"CallPanelHeader.areMoreAudioRoutesAvailable - ECS disabled.  Showing all audio routes."),!0;const t=u.default.CallControlsStore.getAvailableAudioRoutes();v.log(b.LogTraceArea.CallingUI,`CallPanelHeader.areMoreAudioRoutesAvailable video: ${e} availableRoutes: ${t}`);let i=a.size(t);return e&&a.includes(t,n.default.AudioOutputEarpiece)&&i--,i>1}_clearIsRecentsOpenTimeout(){this._isRecentsOpeUpEdgeTimeout&&(D.default.clearTimeout(this._isRecentsOpeUpEdgeTimeout),this._isRecentsOpeUpEdgeTimeout=void 0)}render(){const e=this.props.useHighContrastTheme||this.props.useLightTheme;let t=e?this._themeColors.headerIconColor:R.Color.white;const i=e?this._themeColors.iconHoverColor:R.Color.gray200,a=this._renderNavigationButton(t,i,e),n=this._renderTitleView(e),s=this._renderFlipCameraButton(t,i),r=this._renderSpeakerButton(t,i),l=this._renderGridFocusToggleButton(t,i),c=[F.titleContainer,F.undraggableRegion];this.props.useMobileControls&&(this.props.isUsingStackNavigationContext?c.push(F.titleContainerStackNav):c.push(F.titleContainerTablet)),this.state.isDesktopMin&&c.push(F.titleContainerDesktopMin);let d=[o.createElement(o.Animated.View,{key:"titleControls",style:c,ignorePointerEvents:!0},n),o.createElement(o.View,{key:"rightControls",style:[F.rightControls,F.undraggableRegion]},l,r,s)];const u=[F.callPanelHeader];return this.props.isUsingStackNavigationContext||(u.push(F.callPanelHeaderDesktop),this.state.isDesktopMin&&u.push(F.callPanelHeaderDesktopMin)),o.createElement(o.View,{style:u,ignorePointerEvents:!0},a,d)}_renderNavigationButton(e,t,i){let a,n;if(!this.props.hideBackButton){const n=[F.leftControl];if(this.props.isUsingStackNavigationContext||n.push(F.leftControlDesktop),this.state.showRecentsButton){let s,r=e,l=t;this._getRootViewType()===y.RootViewType.SplitViewContent?s=P.getString("CallPanel.ShowRecentsButtonTitle"):(s=this.state.recentsOpenState===U.Open?P.getString("CallPanel.CloseRecentsButtonTitle"):P.getString("CallPanel.OpenRecentsButtonTitle"),this.state.recentsOpenState!==U.Closed&&(n.push(F.recentsButton),i?(n.push(this._themeStyles.primaryViewColorStyle),r=this._themeColors.primaryBackgroundColor,l=r):r=R.Color.gray400)),a=o.createElement(T.default,{key:"recents",style:n,size:V.IconSize.size24,onPress:this._handleRecentsButtonPress,color:r,hoverColor:l,icon:V.SkypeIcon.Menu,title:s})}else{const i=this.props.isUsingStackNavigationContext?V.SkypeIcon.Message:L.backIcon(),s=this.props.isUsingStackNavigationContext?P.getString("CallPanel.OpenConversation"):P.getString("Global.BackButtonTitle");a=o.createElement(T.default,{key:"back",style:n,size:V.IconSize.size24,onPress:this._handleBackButtonClick,color:e,hoverColor:t,icon:i,title:s})}}if(this.props.isUsingStackNavigationContext||a){const e=[F.undraggableRegion];this.props.isUsingStackNavigationContext?e.push(F.backButtonSpacer):this.state.isDesktopMin&&e.push(F.leftControlDesktopMin),n=o.createElement(o.View,{key:"leftControl",style:e},a)}return n}_renderTitleView(e){if(this.props.isUsingStackNavigationContext)return o.createElement(M.default,{callId:this.props.callId,conversationMri:this.props.conversationId,isCallActive:this.props.isCallActive,outgoingRingStatus:this.props.outgoingRingStatus,onTitlePress:this.props.onTitlePress?this._onTitlePress:void 0,isSeen:!this.props.minimized,showParticipantCount:this.props.showParticipantCount,useThemeColors:e,isLandscape:this.props.isLandscape});const t=this.state.isGalleryShowing?P.getString("CallReactionsBar.CloseGallery"):P.getString("CallReactionsBar.OpenGallery");return o.createElement(h.default,{onLayout:this.props.onTitleLayout?this._onTitleLayout:void 0,callId:this.props.callId,conversationMri:this.props.conversationId,isCallActive:this.props.isCallActive,outgoingRingStatus:this.props.outgoingRingStatus,onTitlePress:this.props.onTitlePress?this._onTitlePress:void 0,onOpenRoster:this._onOpenRoster,onBingBackgroundsPressed:this.props.onBingBackgroundsPressed,isSeen:!this.props.minimized,showParticipantCount:this.props.showParticipantCount,maxTitleWidth:this.props.maxTitleWidth,containerStyle:F.titleContainerInner,onGalleryPress:this.props.onGalleryPress,isDesktopMin:this.state.isDesktopMin,useHighContrastTheme:this.props.useHighContrastTheme,useLightTheme:!1,renderGalleryIfAllowed:!0,galleryButtonAccessibilityLabel:t})}_renderSpeakerButton(e,t){}_renderFlipCameraButton(e,t){if(this.props.useMobileControls&&this.state.showCameraToggle){let i,a;return i=this.props.isNewCameraFlipEnabled?V.SkypeIcon.NewSwitchCamera:V.SkypeIcon.SwitchCamera,a=this.state.cameraPosition===s.CameraPosition.Front?P.getString("CallControls.CallButtonSwitchCameraBackwardLabel"):P.getString("CallControls.CallButtonSwitchCameraForwardLabel"),o.createElement(T.default,{key:"camera",style:F.rightControlsButton,size:V.IconSize.size24,onPress:this.props.onToggleCameraDirection,color:e,hoverColor:t,icon:i,title:P.getString("CapturePanel.SwitchCameraButtonTitle"),accessibilityLabel:a})}}_renderGridFocusToggleButton(e,t){if(this.state.changeCallLayoutEnabled)return o.createElement(T.default,{ref:this._onLayoutButtonRef,key:"changeLayoutButton",icon:this._getIcon(),title:this._getTitle(),size:V.IconSize.size24,hoverColor:t,onPress:this.state.newLayoutPickerEnabled?this._onNewPickerPress:this._toggleGridFocusView,accessibilityLabel:this._getTitle(),color:e,style:F.rightControlsButton})}_getTitle(){if(this.state.newLayoutPickerEnabled)return C.default.getStageModeItemTitle(this.state.stageMode,!1);return C.default.isInGridStageMode(this.state.stageMode)?this.state.hasIncomingScreenshare?P.getString("CallControls.CallButtonSwitchToContentView"):P.getString("CallControls.CallButtonSwitchToSpeakerView"):P.getString("CallControls.CallButtonSwitchToGridView")}_getIcon(){if(this.state.newLayoutPickerEnabled)return C.default.getIconForStageMode(this.state.stageMode,!1);return C.default.isInGridStageMode(this.state.stageMode)?V.SkypeIcon.GridView:V.SkypeIcon.FocusedView3}}t.default=H},55481:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(89391),o=i(94224),s=i(16402),r=i(36400),l=i(19675),c=i(24576),d=i(12770);class u extends c.default{constructor(){super(...arguments),this._callTimerInterval=1e3,this._onTimerUpdate=()=>{const e=o.default.OngoingCallService.getCallConnectedTime(this.props.callId),t=e?Date.now()-e:0;this.setState({elapsedTimeMs:t})}}_buildState(e,t){let i={};return t&&(i.elapsedTimeMs=0),i}componentDidMount(){super.componentDidMount(),this.props.isTimerActive&&this._maybeStartTimer()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),e.isTimerActive!==this.props.isTimerActive&&this._maybeStartTimer()}componentWillUnmount(){super.componentWillUnmount(),this._stopTimer()}_maybeStartTimer(){this.props.isTimerActive?this._startTimer():this._stopTimer()}_startTimer(){this._timerToken||(this._timerToken=d.default.setInterval(this._onTimerUpdate,this._callTimerInterval),this._onTimerUpdate())}_stopTimer(){this._timerToken&&(d.default.clearInterval(this._timerToken),this._timerToken=void 0)}_shouldRender(){return this.props.participantCountText||this.props.isTimerActive||this.state.elapsedTimeMs&&this.state.elapsedTimeMs>0}render(){if(this._shouldRender()){const e=this.state.elapsedTimeMs||this.props.isTimerActive,t=this.state.elapsedTimeMs||0;let i=e?s.default.getElapsedTimeStringFromMs(this.state.elapsedTimeMs||0):void 0,n=e?s.default.getFormattedDuration(Math.floor(t/1e3),!0):void 0;return this.props.participantCountText&&(n=this.props.participantCountText+(n?", "+n:""),i=this.props.participantCountText+(i?" | "+i:"")),a.createElement(r.HoverableView,{accessibilityLabel:n,accessibilityTraits:a.Types.AccessibilityTrait.Text,importantForAccessibility:a.Types.ImportantForAccessibility.Auto,onPress:this.props.onPress},a.createElement(l.Subtitle,{style:[this.props.baseSubtitleStyle,this.props.textThemeStyle],accessibilityHidden:!0,numberOfLines:1},i))}return null}}class h extends c.default{_buildState(e){return{elapsedTimeSec:o.default.CallDurationStore.getCallDurationInSeconds(e.callId)}}_shouldRender(){return this.props.participantCountText||this.state.elapsedTimeSec&&this.state.elapsedTimeSec>0||this.props.isTimerActive}render(){if(this._shouldRender()){const e=this.state.elapsedTimeSec||this.props.isTimerActive,t=this.state.elapsedTimeSec||0;let i=e?s.default.getElapsedTimeStringFromS(t):void 0,n=e?s.default.getFormattedDuration(Math.floor(t),!0):void 0;return this.props.participantCountText&&(n=this.props.participantCountText+(n?", "+n:""),i=this.props.participantCountText+(i?" | "+i:"")),a.createElement(r.HoverableView,{accessibilityLabel:n,accessibilityTraits:a.Types.AccessibilityTrait.Text,importantForAccessibility:a.Types.ImportantForAccessibility.Auto,onPress:this.props.onPress},a.createElement(l.Subtitle,{style:[this.props.baseSubtitleStyle,this.props.textThemeStyle],accessibilityHidden:!0,numberOfLines:1,v2:this.props.subtitleV2},i))}return null}}class p extends c.default{_buildState(){return{enableEndCallInRecents:n.default.getS4LCMCFeatures().enableEndCallInRecents}}render(){return this.state.enableEndCallInRecents?a.createElement(h,Object.assign({},this.props)):a.createElement(u,Object.assign({},this.props))}}t.default=p},53376:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(94224),o=i(4325),s=i(36850),r=i(55481),l=i(47176),c=i(80200),d=i(71830),u=i(52262),h=i(46096),p=i(11375),g=i(46239),C=i(36400),m=i(36237),S=i(15877),y=i(33754),f=i(81760),_=i(11010),b=i(96755),T=i(19675),v=i(24576),w=i(53374),I=i(89391),P=i(53703),M=i(5531),k=f.Color.gray400,A=(0,S.lazyProperties)({headerContainer:()=>a.Styles.createViewStyle({flex:1,alignItems:"stretch"}),alignDesktopMin:()=>a.Styles.createViewStyle({justifyContent:"center"}),firstRow:()=>a.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-start",marginBottom:0}),conversationNameText:()=>a.Styles.createTextStyle({flex:-1,color:f.Color.white}),conversationNameTextLightTheme:()=>a.Styles.createTextStyle({color:k}),divider:()=>a.Styles.createTextStyle({marginLeft:5}),timerRowContainer:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),timerRowContainerV2:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"flex-start"}),galleryButtonText:()=>a.Styles.createTextInputStyle({marginTop:2}),baseSubtitleStyleV1:()=>a.Styles.createTextStyle({color:f.Color.whiteOverlay50}),baseSubtitleStyleLightTheme:()=>a.Styles.createTextStyle({color:f.Color.blackOverlay60})});class R extends v.default{constructor(){super(...arguments),this.handleFocusEvent=e=>!(e!==p.FocusEvent.CloseRightPanel||!this._galleryButton)&&(this._galleryButton.requestFocus(),!0),this._onTitlePress=()=>{if(this.props.onTitlePress){const e=w.default.newCauseId();m.log(h.LogTraceArea.CallingUI,"CallPanelHeaderTitle._onTitlePress, causeId: "+e),this.props.onTitlePress(e,c.CallRosterOrigin.FromGroupTitle)}},this._onOpenRoster=()=>{if(this.props.onOpenRoster){const e=w.default.newCauseId();m.log(h.LogTraceArea.CallingUI,"CallPanelHeaderTitle._onOpenRoster, causeId: "+e),this.props.onOpenRoster(e,c.CallRosterOrigin.FromParticipantCount)}},this._onGalleryPress=e=>{m.log(h.LogTraceArea.CallingUI,"CallPanelHeaderTitle._onGalleryPress"),this.props.onGalleryPress&&this.props.onGalleryPress()},this._onGalleryButtonRef=e=>{this._galleryButton=e||void 0},this._onManageGroupPress=e=>{const t=w.default.newCauseId();m.log(h.LogTraceArea.CallingUI,"CallPanelHeaderTitle._onManageGroupPress, causeId: "+t),this.props.onTitlePress&&this.props.onTitlePress(t,c.CallRosterOrigin.FromManageGroupButton)},this._getIconColor=e=>{if(!this.props.useHighContrastTheme)return this.props.useLightTheme?k:e}}_buildState(e,t){const i=I.default.getS4LCMCFeatures().bingBackgrounds,a=n.default.CallParticipantBackgroundInfoStore.captionsReceivedCount(e.callId),o=s.default.getStageMode(e.callId);return{conversationName:u.default.getDisplayName(e.conversationMri)||y.getString("Notifications.UnknownUserShort"),activeParticipantCount:e.showParticipantCount?l.default.getActiveParticipants(e.callId,e.conversationMri).length:0,totalParticipantCount:e.showParticipantCount?l.default.getRosterForConversation(e.conversationMri).length:0,allowCallGallery:e.renderGalleryIfAllowed&&n.default.CallingFeaturesHelper.allowCallGallery({isEncryptedCall:d.isEncryptedThread(e.conversationMri),isPSTNCall:n.default.CallingStore.isPSTNCall(e.callId),conversationMri:e.conversationMri,callId:e.callId}),allowManageGroup:I.default.getS4LCMCFeatures().enableLockMeeting&&!!e.onTitlePress&&d.isGroupConversation(e.conversationMri)&&M.default.navigation().canAccessConversationDetails,stageMode:o,allowBingBackgrounds:!e.v2&&a>0&&(o===c.StageMode.LargeGrid||o!==c.StageMode.TogetherMode&&o!==c.StageMode.FocusedScreenShare&&i.showInCallHeader)}}componentDidMount(){super.componentDidMount(),p.register(p.FocusEvent.CloseRightPanel,this)}componentWillUnMount(){super.componentWillUnmount(),p.unregister(p.FocusEvent.CloseRightPanel,this)}render(){const e=!!this.props.onTitlePress,t=e?C.HoverableButton:a.View,i=[A.firstRow];this.props.isDesktopMin&&i.push(A.alignDesktopMin);const n=this.props.useHighContrastTheme?this._themeStyles.primaryTextColorStyle:void 0;let s;e&&(s=d.isOneOnOneConversation(this.props.conversationMri)?this.state.conversationName:y.getString("CallPanel.CallRosterHeaderEntryButtonAccessibilityLabel",{groupName:this.state.conversationName}));const l=[this.props.v2?_.default.fontStyle.callHeaderTitleV2:_.default.fontStyle.messagingHeader,[A.conversationNameText,this.props.useLightTheme?A.conversationNameTextLightTheme:void 0],n],c=this.state.allowManageGroup?a.createElement(P.default,{key:`manageGroupButton-${this.props.conversationMri}`,iconColorOverride:this._getIconColor(f.Color.white),hoverColor:this._getIconColor(f.Color.whiteOverlay80),onPress:this._onManageGroupPress,accessibilityLabel:y.getString("CallPanel.ManageGroupAccessibilityLabel"),isCompact:!!this.props.showCompactManageGroup}):void 0,u=a.createElement(a.View,{style:i},a.createElement(t,{onPress:e?this._onTitlePress:void 0,title:s,accessibilityLabel:s,accessibilityTraits:e?a.Types.AccessibilityTrait.Button:a.Types.AccessibilityTrait.Header,tabIndex:e?void 0:-1,disableHoverOpacityStyles:!e,disableCursor:!e},a.createElement(a.Text,{style:l,numberOfLines:1},this.state.conversationName)),c);let h;this.props.showParticipantCount&&this.state.activeParticipantCount&&this.state.totalParticipantCount&&(h=y.getString("CallPanel.CallRosterTitle",{count:this.state.activeParticipantCount,total:this.state.totalParticipantCount}));const p=[_.default.fontStyle.callHeaderSubtitleV2,this.props.useLightTheme?A.baseSubtitleStyleLightTheme:void 0],m=this.props.v2?p:[_.default.fontStyle.subtitle,A.baseSubtitleStyleV1];let S,v=a.createElement(r.default,{callId:this.props.callId,isTimerActive:!!this.props.isCallActive&&!!this.props.isSeen,participantCountText:h,baseSubtitleStyle:m,textThemeStyle:n,subtitleV2:this.props.v2,onPress:this.props.onOpenRoster?this._onOpenRoster:void 0});if(this.props.outgoingRingStatus&&this.props.outgoingRingStatus.length){const e=[m,this.props.isDesktopMin?A.alignDesktopMin:void 0,n];S=a.createElement(T.Subtitle,{style:e,numberOfLines:1,v2:this.props.v2},this.props.outgoingRingStatus)}const w=[this.props.containerStyle];if(this.props.maxTitleWidth&&w.push(a.Styles.createViewStyle({maxWidth:this.props.maxTitleWidth},!1)),this.props.isCallActive){const e=[m,this.props.v2?A.timerRowContainerV2:A.timerRowContainer];this.props.isDesktopMin&&e.push(A.alignDesktopMin);const t=[m,A.divider],i=this.state.allowCallGallery?[a.createElement(b.default,{key:`galleryDivider-${this.props.conversationMri}`,style:t}),a.createElement(g.default,{ref:this._onGalleryButtonRef,key:`galleryButton-${this.props.conversationMri}`,textStyle:[m,A.galleryButtonText,n],iconColorOverride:this._getIconColor(f.Color.whiteOverlay50),onPress:this._onGalleryPress,accessibilityLabel:this.props.galleryButtonAccessibilityLabel})]:void 0,s=this.state.allowBingBackgrounds?[a.createElement(b.default,{key:`bing-Divider-${this.props.conversationMri}`,style:t}),a.createElement(o.default,{key:`bingBackgroundsButton-${this.props.conversationMri}`,callId:this.props.callId,onBingBackgroundsPressed:this.props.onBingBackgroundsPressed,textStyleOverride:[m,A.galleryButtonText,n],v1:!0,useLightTheme:this.props.useLightTheme})]:void 0;v=a.createElement(a.View,{style:e},v,i,s)}return a.createElement(a.View,{style:w,ignorePointerEvents:!0,onLayout:this.props.onLayout},a.createElement(a.View,{style:A.headerContainer,ignorePointerEvents:!0},u,S,v))}}t.default=R},57011:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(63297),o=i(16778),s=i(48540),r=i(31844),l=i(89391),c=i(79231),d=i(20187),u=i(94224),h=i(4325),p=i(53376),g=i(36850),C=i(80200),m=i(71727),S=i(5531),y=i(71830),f=i(98278),_=i(24490),b=i(57139),T=i(46096),v=i(13944),w=i(36237),I=(i(34896),i(24907)),P=i(15877),M=i(33754),k=i(36150),A=i(81760),R=i(11010),V=i(11828),L=i(34528),E=i(80837),B=i(24576),O=i(63841),D=i(12770),x=i(96229),N=i(53374),U=i(30124),F=i(22854),H=i(67977),z=i(86967),G=i(52262);var W;!function(e){e[e.Closed=0]="Closed",e[e.Opening=1]="Opening",e[e.Open=2]="Open"}(W||(W={}));const K=(0,P.lazyProperties)({callPanelHeaderDesktop:()=>o.Styles.createViewStyle({appRegion:"drag",flexDirection:"row",alignSelf:"stretch",overflow:"visible",backgroundColor:A.Color.transparent,alignItems:"center",height:C.DesktopNewHeaderHeight}),leftControlDesktop:()=>o.Styles.createViewStyle({width:V.IconSize.size28,height:V.IconSize.size28,flexDirection:"row",justifyContent:"center",alignItems:"center",backgroundColor:A.Color.transparent,paddingTop:0,paddingLeft:10,paddingRight:0}),recentsButton:()=>o.Styles.createViewStyle({borderRadius:V.IconSize.size28/2,backgroundColor:A.Color.white,paddingLeft:0,marginLeft:10}),rightControls:()=>o.Styles.createViewStyle({flexGrow:1,flexDirection:"row",justifyContent:"flex-end",marginRight:10}),rightControlsButton:()=>o.Styles.createButtonStyle({alignSelf:"stretch",alignItems:"center",marginRight:16,height:30}),conversationIcon:()=>o.Styles.createViewStyle({marginLeft:6,marginRight:4}),titleContainerInner:()=>o.Styles.createViewStyle({flex:-1,justifyContent:"center",paddingRight:20}),titleContainer:()=>o.Styles.createViewStyle({alignItems:"stretch",justifyContent:"flex-start",backgroundColor:A.Color.transparent,overflow:"visible",marginRight:16}),titleContainerTablet:()=>E.default.flexOne,undraggableRegion:()=>o.Styles.createViewStyle({appRegion:"no-drag"}),backButtonSpacer:()=>o.Styles.createViewStyle({width:64}),bingBackgroundsFontLightTheme:()=>o.Styles.createTextStyle({color:A.Color.gray400,fontSize:R.default.fontSize.size13Deprecated,font:R.default.font.uiDisplayRegular})});class j extends B.default{constructor(){super(...arguments),this._handleBackButtonClick=e=>{e.stopPropagation();const t=N.default.newCauseId();w.log(T.LogTraceArea.CallingUI,"CallPanelHeaderV2._handleBackButtonClick, causeId: "+t),this.props.onBackButtonPressed(t)},this._handleRecentsButtonPress=e=>{e.stopPropagation();const t=N.default.newCauseId();w.log(T.LogTraceArea.CallingUI,"CallPanelHeaderV2._handleRecentsButtonPress, causeId: "+t),this.props.onRecentsButtonPressed(t)},this._onTitleLayout=e=>{if(this.props.onTitleLayout){const t={x:e.x,y:e.y,width:e.width+60,height:e.height};this.props.onTitleLayout(t)}},this._onTitlePress=()=>{const e=N.default.newCauseId();w.log(T.LogTraceArea.CallingUI,"CallPanelHeaderV2._onTitlePress, causeId: "+e),this.props.onTitlePress&&this.props.onTitlePress(e,C.CallRosterOrigin.FromGroupTitle)},this._onOpenRosterFromConversationIcon=()=>{const e=N.default.newCauseId();this._onOpenRoster(e,C.CallRosterOrigin.FromConversationIcon)},this._onOpenRoster=(e,t)=>{w.log(T.LogTraceArea.CallingUI,"CallPanelHeaderV2._onOpenRoster, causeId: "+e),this.props.onRosterPressed&&this.props.onRosterPressed(e,t)},this._onDynamicAudioChoice=e=>{this.props.onDynamicAudioChoice&&this.props.onDynamicAudioChoice(e,(()=>this._audioOutputButton))},this._onAudioOutputButtonRef=e=>{this._audioOutputButton=e||void 0},this._onLayoutButtonRef=e=>{this._layoutButton=e||void 0},this._onNewPickerPress=()=>{const e=()=>this._layoutButton,t=this._getRootViewId();r.default.isFullScreenMode(this._getRootViewId()).then((i=>{b.default.showWithContent({menuId:b.default.menuId(),anchor:e,rootViewId:t,menuHeight:I.default.getLayoutPickerHeight(this.state.availableMenuItems),content:o.createElement(I.default,{anchor:e,rootViewId:t,useMobileControls:this.props.useMobileControls,isIncomingOrOutGoingRing:this.props.incomingOrOutgoingRing,callId:this.props.callId,conversationMri:this.props.conversationId,availableItems:this.state.availableMenuItems,isInFullscreenMode:i}),useBlurredBackground:!0,colorThemeOverride:O.Theme.DelphiDark,headerConfig:{headerType:_.HeaderType.Slim},staticContent:!0,useTransparentShim:!0,hidePopupArrow:!0,getTitle:()=>{},onCloseMenu:e=>b.default.close(t,e),onMenuClosed:this._onMenuClosed},N.default.newCauseId())}))},this._toggleGridFocusView=()=>{const e=this.state.hasIncomingScreenshare?C.StageMode.FocusedScreenShare:C.StageMode.Speaker,t=m.default.isInGridStageMode(this.state.stageMode)?e:C.StageMode.Grid;this._changeCallLayoutCommand.execute(t)},this._onMenuClosed=e=>{this.state.availableMenuItems.forEach((e=>{e.markAsSeen&&e.markAsSeen()}))}}_buildState(e,t){const i=g.default.getStageMode(e.callId),n=u.default.CallScreenShareStore.hasIncomingScreensharing(e.callId),o={isPSTNCall:u.default.CallingStore.isPSTNCall(e.callId),isEncryptedCall:y.isEncryptedThread(e.conversationId),conversationMri:e.conversationId,callId:e.callId};this._changeCallLayoutCommand=new d.ChangeCallLayoutCommand(o,e.incomingOrOutgoingRing,i);const r=u.default.CallingStore.isProvidingVideo(e.callId),h=u.default.OngoingCallService.getStageParticipants(e.callId),p=k.default.isMobileScreenReaderEnabled(),f=e.useMobileControls&&r&&(!(e.isNewCameraFlipEnabled&&!p)||a.includes(h,C.CallStageElementKeys.localUserKey));let _=s.CameraPosition.Unknown;if(f){const e=u.default.DeviceStore.getSelectedCamera();_=e?e.position:s.CameraPosition.Unknown}const b=l.default.getS4LCMCFeatures().enableFullScreenOnWeb&&!U.default.isUsingSplitViewNoSubscription(),T=m.default.getAvailableMenuItemsV2(e.callId,b,e.useMobileControls,e.conversationId),v={showCameraToggle:f,cameraPosition:_,showRecentsButton:S.default.navigation().canAccessRecentsList,outputRoute:u.default.CallControlsStore.getAudioOutput(),useiOSRoutePicker:c.AudioOutputRouteHelper.useiOSRoutePicker(),stageMode:i,hasIncomingScreenshare:n,changeCallLayoutEnabled:e.useMobileControls&&this._changeCallLayoutCommand.canExecute(),moreOutputRoutesAvailable:!1,newLayoutPickerEnabled:l.default.getS4LCMCFeatures().enableNewLayoutPicker,isOneOnOneCall:u.default.CallingStore.isOneOnOneCall(e.callId),availableMenuItems:T,isOneOnOneConversation:y.isOneOnOneConversation(e.conversationId),conversationName:G.default.getDisplayName(e.conversationId)||M.getString("Notifications.UnknownUserShort")};!t&&e.isRecentsOpen&&this.state?e.isRecentsOpen&&this.state.recentsOpenState===W.Closed&&(v.recentsOpenState=W.Opening,this._clearIsRecentsOpenTimeout(),this._isRecentsOpeUpEdgeTimeout=D.default.setTimeout((()=>{this.isComponentMounted()&&this.setState({recentsOpenState:W.Open}),this._isRecentsOpeUpEdgeTimeout=void 0}),300)):(v.recentsOpenState=e.isRecentsOpen?W.Open:W.Closed,this._clearIsRecentsOpenTimeout());const w=l.default.getS4LCMCFeatures().bingBackgrounds,I=u.default.CallParticipantBackgroundInfoStore.captionsReceivedCount(e.callId);return v.shouldShowBingBackgrounds=I>0&&(i===C.StageMode.LargeGrid||i!==C.StageMode.TogetherMode&&i!==C.StageMode.FocusedScreenShare&&w.showInCallHeader),v}_areMoreAudioOutputsAvailable(e){if(!l.default.getS4LCMCFeatures().earpieceHiddenForVideoCalls)return w.log(T.LogTraceArea.CallingUI,"CallPanelHeaderV2.areMoreAudioRoutesAvailable - ECS disabled.  Showing all audio routes."),!0;const t=u.default.CallControlsStore.getAvailableAudioRoutes();w.log(T.LogTraceArea.CallingUI,`CallPanelHeaderV2.areMoreAudioRoutesAvailable video: ${e} availableRoutes: ${t}`);let i=a.size(t);return e&&a.includes(t,n.default.AudioOutputEarpiece)&&i--,i>1}_clearIsRecentsOpenTimeout(){this._isRecentsOpeUpEdgeTimeout&&(D.default.clearTimeout(this._isRecentsOpeUpEdgeTimeout),this._isRecentsOpeUpEdgeTimeout=void 0)}render(){const e=this.props.useHighContrastTheme||this.props.useLightTheme;let t=e?this._themeColors.headerIconColor:A.Color.white;const i=e?this._themeColors.iconHoverColor:A.Color.gray200,a=this._renderNavigationButton(t,e),n=this._renderConversationIcon(),s=this._renderTitleView(),r=this._renderLayoutButton(),l=this._renderTogetherModeBackgroundChangeButton(t),c=this._renderFlipCameraButton(t,i),d=this._renderSpeakerButton(t,i),u=this._renderGridFocusToggleButton(t,i),h=this._renderBingBackgroundsButton(),p=[K.titleContainer,K.undraggableRegion];this.props.useMobileControls&&p.push(K.titleContainerTablet);let g=[n,o.createElement(o.Animated.View,{key:"titleControls",style:p,ignorePointerEvents:!0},s),o.createElement(o.View,{key:"rightControls",style:[K.rightControls,K.undraggableRegion]},h,u,d,c,l,r)];return o.createElement(o.View,{style:K.callPanelHeaderDesktop,ignorePointerEvents:!0},a,g)}_renderNavigationButton(e,t){if(this.props.hideBackButton)return null;let i;const a=this._getRootViewType()===f.RootViewType.SplitViewContent,n=this.state.recentsOpenState===W.Closed,s=t?this._themeColors.iconHoverColor:a||n?A.Color.gray200:A.Color.gray300,r=[K.leftControlDesktop];if(this.state.showRecentsButton){let a,n=e,l=s;this._getRootViewType()===f.RootViewType.SplitViewContent?a=M.getString("CallPanel.ShowRecentsButtonTitle"):(a=this.state.recentsOpenState===W.Open?M.getString("CallPanel.CloseRecentsButtonTitle"):M.getString("CallPanel.OpenRecentsButtonTitle"),this.state.recentsOpenState!==W.Closed&&(r.push(K.recentsButton),t?(r.push(this._themeStyles.primaryViewColorStyle),n=this._themeColors.primaryBackgroundColor,l=n):n=A.Color.gray400)),i=o.createElement(v.default,{key:"recents",style:r,size:V.IconSize.size15,onPress:this._handleRecentsButtonPress,color:n,hoverColor:l,icon:V.SkypeIcon.Menu,title:a})}else i=o.createElement(v.default,{key:"back",style:r,size:V.IconSize.size15,onPress:this._handleBackButtonClick,color:e,hoverColor:s,icon:L.backIcon(),title:M.getString("Global.BackButtonTitle")});const l=[K.undraggableRegion];return o.createElement(o.View,{key:"leftControl",style:l},i)}_renderConversationIcon(){const e=this.state.isOneOnOneConversation?this.state.conversationName:M.getString("CallPanel.CallRosterHeaderEntryButtonAccessibilityLabel",{groupName:this.state.conversationName});return o.createElement(o.View,{style:K.conversationIcon},o.createElement(F.default,{conversationId:this.props.conversationId,size:H.ConversationIconSize.Size28,onPress:this._onOpenRosterFromConversationIcon,accessibilityLabel:e}))}_renderTitleView(){return o.createElement(p.default,{onLayout:this.props.onTitleLayout?this._onTitleLayout:void 0,callId:this.props.callId,conversationMri:this.props.conversationId,isCallActive:this.props.isCallActive,outgoingRingStatus:this.props.outgoingRingStatus,onTitlePress:this.props.onTitlePress?this._onTitlePress:void 0,onOpenRoster:this._onOpenRoster,isSeen:!this.props.minimized,showParticipantCount:this.props.showParticipantCount,maxTitleWidth:this.props.maxTitleWidth,containerStyle:K.titleContainerInner,v2:!0,useHighContrastTheme:this.props.useHighContrastTheme,useLightTheme:this.props.useLightTheme,renderGalleryIfAllowed:!1,showCompactManageGroup:!0})}_renderLayoutButton(){return o.createElement(z.default,{availableLayoutModes:m.default.getAvailableHeaderModes(this.props.useMobileControls,this.state.isOneOnOneConversation),callId:this.props.callId,conversationMri:this.props.conversationId,useHighContrastTheme:this.props.useHighContrastTheme,useLightTheme:this.props.useLightTheme,isIncomingOrOutGoingRing:this.props.incomingOrOutgoingRing,useMobileCallControls:this.props.useMobileControls,height:C.DesktopNewHeaderHeight})}_renderTogetherModeBackgroundChangeButton(e){return o.createElement(x.default,{callId:this.props.callId,conversationMri:this.props.conversationId,labelColor:e})}_renderSpeakerButton(e,t){return null}_renderFlipCameraButton(e,t){if(!this.props.useMobileControls||!this.state.showCameraToggle)return null;let i=this.props.isNewCameraFlipEnabled?V.SkypeIcon.NewSwitchCamera:V.SkypeIcon.SwitchCamera,a=this.state.cameraPosition===s.CameraPosition.Front?M.getString("CallControls.CallButtonSwitchCameraBackwardLabel"):M.getString("CallControls.CallButtonSwitchCameraForwardLabel");return o.createElement(v.default,{key:"camera",style:K.rightControlsButton,size:V.IconSize.size24,onPress:this.props.onToggleCameraDirection,color:e,hoverColor:t,icon:i,title:M.getString("CapturePanel.SwitchCameraButtonTitle"),accessibilityLabel:a})}_renderGridFocusToggleButton(e,t){return this.state.changeCallLayoutEnabled?o.createElement(v.default,{ref:this._onLayoutButtonRef,key:"changeLayoutButton",icon:this._getIcon(),title:this._getTitle(),size:V.IconSize.size24,hoverColor:t,onPress:this.state.newLayoutPickerEnabled?this._onNewPickerPress:this._toggleGridFocusView,accessibilityLabel:this._getTitle(),color:e,style:K.rightControlsButton}):null}_getTitle(){if(this.state.newLayoutPickerEnabled)return m.default.getStageModeItemTitle(this.state.stageMode,!0);return m.default.isInGridStageMode(this.state.stageMode)?this.state.hasIncomingScreenshare?M.getString("CallControls.CallButtonSwitchToContentView"):M.getString("CallControls.CallButtonSwitchToSpeakerView"):M.getString("CallControls.CallButtonSwitchToGridView")}_getIcon(){if(this.state.newLayoutPickerEnabled)return m.default.getIconForStageMode(this.state.stageMode,!0);return m.default.isInGridStageMode(this.state.stageMode)?V.SkypeIcon.GridView:V.SkypeIcon.FocusedView3}_renderBingBackgroundsButton(){return this.state.shouldShowBingBackgrounds?o.createElement(h.default,{callId:this.props.callId,height:C.DesktopNewHeaderHeight,textStyleOverride:this.props.useLightTheme?K.bingBackgroundsFontLightTheme:void 0,onBingBackgroundsPressed:this.props.onBingBackgroundsPressed,useLightTheme:this.props.useLightTheme}):null}}t.default=j},15526:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(88837),o=i(80200),s=i(10117),r=i(15877),l=i(51070),c=i(81115),d=i(81760),u=i(11828),h=i(53374),p=16,g=(0,r.lazyProperties)({accessory:()=>a.Styles.createViewStyle({position:"absolute",width:24,height:24,borderRadius:12,backgroundColor:d.Color.blackOverlay50,alignItems:"center",justifyContent:"center"}),accessoryTopLeft:()=>a.Styles.createViewStyle({left:p,top:p}),accessoryTopRight:()=>a.Styles.createViewStyle({position:"absolute",right:p,top:p}),accessoryBottomLeft:()=>a.Styles.createViewStyle({position:"absolute",left:p,bottom:p}),accessoryBottomRight:()=>a.Styles.createViewStyle({position:"absolute",right:p,bottom:p}),accessoryCenterContainer:()=>a.Styles.createViewStyle({position:"absolute",left:0,right:0,bottom:100,height:24,alignItems:"center",justifyContent:"center"})});class C extends n.ComponentBase{_buildState(e,t){return{safeAreaHorizontalInsets:l.default.horizontalInsets({left:p,right:30})}}_styleForAccessoryPosition(e){switch(e){case o.CallAccessoryPosition.BottomLeft:return g.accessoryBottomLeft;case o.CallAccessoryPosition.BottomRight:return g.accessoryBottomRight;case o.CallAccessoryPosition.TopLeft:return g.accessoryTopLeft;case o.CallAccessoryPosition.TopRight:return g.accessoryTopRight}}render(){const e=this.props.position===o.CallAccessoryPosition.Center,t=[g.accessory];if(!e&&this.props.position){const e=this._styleForAccessoryPosition(this.props.position);if(e&&t.push(e),this.props.position===o.CallAccessoryPosition.BottomRight||this.props.position===o.CallAccessoryPosition.TopRight){!!this.state.safeAreaHorizontalInsets&&c.default.hasHorizontalSafeAreas(this.state.safeAreaHorizontalInsets)&&t.push(c.default.horizontalMarginStyle(this.state.safeAreaHorizontalInsets))}}let i;switch(this.props.type){case o.CallAccessoryType.Mute:i=u.SkypeIcon.MicrophoneOff;break;case o.CallAccessoryType.OnHold:i=u.SkypeIcon.Pause;break;case o.CallAccessoryType.Screensharing:i=u.SkypeIcon.ScreenShare;break;default:i=h.default.switchStatementExhaustiveChecking(this.props.type)}let n=a.createElement(a.View,{style:t,blockPointerEvents:!0,ignorePointerEvents:!0},a.createElement(s.default,{icon:i,size:u.IconSize.size12,color:d.Color.white}));return e&&(n=a.createElement(a.View,{style:g.accessoryCenterContainer,blockPointerEvents:!0,ignorePointerEvents:!0},n)),n}}t.default=C},13805:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallParticipantBackgroundReplaceCaption=void 0;const a=i(74958),n=i(16778),o=i(48540),s=i(44770),r=i(89391),l=i(19061),c=i(29675),d=i(75492),u=i(94224),h=i(68580),p=i(9520),g=i(2278),C=i(62602),m=i(46096),S=i(10117),y=i(36237),f=i(40522),_=i(33754),b=i(15877),T=i(18078),v=i(11828),w=i(19675),I=i(24576),P=i(81760),M=i(53374),k=i(80837),A=i(26712),R=(0,b.lazyProperties)({modernStageBackgroundInfo:()=>n.Styles.createViewStyle({position:"absolute",overflow:"hidden",alignItems:"flex-start",justifyContent:"flex-start"}),bgInfoContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"flex-start"}),topContainer:()=>n.Styles.createViewStyle({flexDirection:"column",alignItems:"stretch",borderRadius:4,paddingHorizontal:8,paddingVertical:8,marginRight:6}),topContainerBg:()=>n.Styles.createViewStyle({backgroundColor:P.Color.blackOverlay70}),topContainerBgLight:()=>n.Styles.createViewStyle({backgroundColor:P.Color.whiteOverlay80}),topContainerBgLightTray:()=>n.Styles.createViewStyle({backgroundColor:P.Color.gray50overlay95}),topLineContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"flex-start"}),bottomLineContainer:()=>n.Styles.createViewStyle({paddingTop:0,flexDirection:"column-reverse",alignItems:"flex-start",height:16}),bingLineContainer:()=>n.Styles.createViewStyle({paddingTop:4,marginTop:6,flexDirection:"column-reverse",alignItems:"flex-start",borderTopWidth:1,flexGrow:1,borderColor:P.Color.whiteOverlay50}),bingLineText:()=>n.Styles.createTextStyle({color:P.Color.whiteOverlay70}),bingLineTextLight:()=>n.Styles.createTextStyle({color:P.Color.gray400}),nameText:()=>n.Styles.createTextStyle({color:P.Color.white}),nameTextLight:()=>n.Styles.createTextStyle({color:P.Color.gray400}),nameTextHover:()=>n.Styles.createTextStyle({textDecorationLine:"underline"}),iconLeft:()=>n.Styles.createViewStyle({margin:0}),iconLeftAlone:()=>n.Styles.createViewStyle({margin:0}),bingIconLeft:()=>n.Styles.createViewStyle({height:16,width:16})});class V extends I.default{constructor(e){super(e),this._onClick=()=>{if(this.state.backgroundEffectImageInfo){const e=this.state.backgroundEffectImageInfo,t=e.link;if(y.log(m.LogTraceArea.CallingUI,`Clicking other user Bing background effect info. IsoDate: ${e.isoDate}, Info exists: ${!!t}, IsCollapsed: ${this.state.isCollapsed}, EffectUser: ${a.pii.Mri(this.state.mri)}`),this.props.callId){const t=M.default.newCauseId();g.default.updateCallTelemetry(this.props.callId,t,(e=>e.bingBackgroundEffectCaptionClick())),y.track(new p.BackgroundEffectsBingInfoClickEvent(this.props.callId,e.isoDate,this.state.mri,e.market,this.state.isCollapsed))}if(t){const e=r.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds;let i=`${e.host}${t}`;e.clickLinkPartnerCode&&""!==e.clickLinkPartnerCode&&A.default.isUrlValid(i)&&(i=A.default.addUrlParameter(i,"pc",e.clickLinkPartnerCode));const a={browserTitle:_.getString("AudioVideoSettings.BackgroundEffectCategoryBing"),preventInAppNavigationForGuest:!l.default.canNavigateInApp(),conversationId:this.props.conversationMri,openInExternalBrowser:!e.tryOpenInAppBrowser,useBingMiniCanvas:!0};f.openUrlWithParams({origin:m.BrowserOrigin.LinkNode,url:i,options:a,rootViewId:this._getRootViewId()})}}},this._onMouseEnter=e=>{this.props.onMouseEnter&&this.props.onMouseEnter(e),this.setState({hover:!0})},this._onMouseLeave=e=>{this.props.onMouseLeave&&this.props.onMouseLeave(e),this.setState({hover:!1})},this._onKeyPress=e=>C.default.maybeHandleKeyPress(e,(()=>{this._onClick()}));const t=this._layoutController();t.onRectChanged&&t.onRectChanged((e=>{this._findSizeAndOffset()})),t.onTopRowChanged&&t.onTopRowChanged((()=>{if(this.isComponentMounted()){let i=!1;t.getIsTopRowElement&&(i=t.getIsTopRowElement());let a=this.state.captionOffsets;t.bgInfoCaptionOffset&&(a=t.bgInfoCaptionOffset(this._getRootViewId(),e.isCallStageV2?e.isInTray?10:12:16)),this.setState({isTopRow:i,captionOffsets:a})}}))}_buildState(e,t){let i=e.renderInfo;e.callId&&!e.renderInfo&&(i=u.default.CallParticipantStore.getParticipantRenderInfo(e.renderKey,e.callId));const a=(null==i?void 0:i.mri)||this._extractMriForKey(i,e.renderKey,!1),n={renderInfo:i,mri:a,streamType:(null==i?void 0:i.renderScreenShare)?o.StreamType.ScreenSharing:o.StreamType.Video,controlsVisible:d.default.areCallControlsVisible(),backgroundEffectId:u.default.DeviceStore.getBackgroundEffectType()};e.callId&&(n.backgroundEffectImageInfo=u.default.CallParticipantBackgroundInfoStore.getBackgroundInfo(e.callId,a),n.backgroundEffectImageInfo||u.default.CallingStore.isCallConnected(e.callId)||!n.backgroundEffectId||(n.backgroundEffectImageInfo=c.default.getBingBackgroundImageInfoFromId(n.backgroundEffectId,e.callId,a)));const s=this._layoutController();if(s.viewRect){const e=s.viewRect();n.width=e.width,n.height=e.height}return s.bgInfoCaptionOffset&&(n.captionOffsets=s.bgInfoCaptionOffset(this._getRootViewId(),e.isCallStageV2?e.isInTray?10:12:16)),n.isTopRow=!1,s.getIsTopRowElement&&(n.isTopRow=s.getIsTopRowElement()),n.isCollapsed=this._isCollapsed(n.width,e.noExpand),n}componentDidMount(){super.componentDidMount(),this._findSizeAndOffset()}_isCollapsed(e,t){return r.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds.captionAlwaysCollapsed||e&&e<500||!!t}_getOptionalBackgroundEffectInfo(){if(!this.state.backgroundEffectImageInfo)return;const e=this.state.backgroundEffectImageInfo,t=e.caption,i=e.copyright;if(!t)return;const a=this._getCaptionOffset(),o=this.state.width?Math.round(this.state.width-2*a.left):void 0,s=n.Styles.createViewStyle({top:a.top,left:a.left,maxWidth:o},!1),r=o?Math.round(o-16+44):void 0,l=n.Styles.createViewStyle({maxWidth:r},!1),c=[R.modernStageBackgroundInfo,s];this.props.nametagOpacityStyle&&c.push(this.props.nametagOpacityStyle);const d=[this.props.useLightTheme?R.nameTextLight:R.nameText,l,k.default.pointerCursor];this.state.hover&&d.push(R.nameTextHover);const u=v.SkypeIcon.Search,h=this.state.isCollapsed&&(!this.state.hover||this.props.noExpand),p=this._iconView(u,h?R.iconLeftAlone:R.iconLeft),g=this.props.useLightTheme?this.props.isInTray?R.topContainerBgLightTray:R.topContainerBgLight:R.topContainerBg,C=this.props.useLightTheme?R.bingLineTextLight:R.bingLineText;let m,S=n.createElement(n.Animated.View,{style:[R.topContainer,g,k.default.pointerCursor]},p);if(h)m=n.createElement(n.Animated.View,{style:R.bgInfoContainer},S);else{const e=n.createElement(n.Animated.View,{style:[R.topContainer,g]},n.createElement(n.Animated.View,{style:[R.topLineContainer]},n.createElement(w.Caption,{style:d,numberOfLines:1},t)),n.createElement(n.Animated.View,{style:R.bottomLineContainer},n.createElement(w.Caption,{small:!0,numberOfLines:1,style:l},i)),n.createElement(n.Animated.View,{style:R.bingLineContainer},n.createElement(w.Caption,{small:!0,numberOfLines:1,style:[l,C]},_.getString("AudioVideoSettings.BackgroundEffectCategoryBing"))));m=n.createElement(n.Animated.View,{style:R.bgInfoContainer},S,e)}return n.createElement(n.Animated.View,{style:c,ignorePointerEvents:!0,key:"BingCaptionWrapper-"+this.state.mri,onPress:this._onClick,onKeyPress:this._onKeyPress,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave,accessibilityTraits:n.Types.AccessibilityTrait.Button,blockPointerEvents:!1,tabIndex:0},m)}render(){var e,t,i,a;const n=r.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds,s=0===(null===(t=null===(e=this.state.renderInfo)||void 0===e?void 0:e.videoDimensions)||void 0===t?void 0:t.height)||0===(null===(a=null===(i=this.state.renderInfo)||void 0===i?void 0:i.videoDimensions)||void 0===a?void 0:a.width);return this.props.hideCaption||!n.showBackgroundCaptions||this.state.streamType!==o.StreamType.Video||s?[void 0]:[this._getOptionalBackgroundEffectInfo()]}_getCaptionOffset(){let e=16,t=16;if(this.props.isCallStageV2){const i=this.props.isInTray?10:12;e=i,t=i}return this.state.captionOffsets&&(e=this.state.captionOffsets.y,t=this.state.captionOffsets.x),{top:e,left:t}}_extractMriForKey(e,t,i=!1){return(null==e?void 0:e.isLocal)?T.default.getSkypeMri():h.default.extractMriFromKey(t,i)}_layoutController(){var e,t;return this.props.layoutController(this.props.renderKey,!!(null===(t=null===(e=this.state)||void 0===e?void 0:e.renderInfo)||void 0===t?void 0:t.renderScreenShare))}_findSizeAndOffset(){if(this.isComponentMounted()){const e=this._layoutController();if(e.viewRect){const t=e.viewRect();this.setState({width:t.width,height:t.height,isCollapsed:this._isCollapsed(t.width,this.props.noExpand)})}}}_iconView(e,t){return r.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds.useBingLogoInsteadOfSearchIcon?n.createElement(n.Image,{source:s.Collection.BING_LOGO_SMALL,style:[t,R.bingIconLeft],resizeMode:"cover"}):e?n.createElement(S.default,{icon:e,color:P.Color.white,size:v.IconSize.size16,style:t}):void 0}}t.CallParticipantBackgroundReplaceCaption=V,t.default=V},39193:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(48540),o=i(96486),s=i(80837),r=i(81760),l=i(11828),c=i(15877),d=i(12770),u=i(2278),h=i(33754),p=i(36237),g=i(80200),C=i(71727),m=i(10117),S=i(9520),y=i(53374),f=i(46096),_=i(24576),b=i(96625),T=i(80306),v=(0,c.lazyProperties)({gestureButton:()=>a.Styles.createButtonStyle({position:"absolute",top:0,bottom:0,left:0,right:0,alignItems:"center",justifyContent:"center",backgroundColor:r.Color.transparent}),gestureButtonInsets:()=>a.Styles.createViewStyle({left:-20,right:-20,top:0,bottom:-40}),innerContainer:()=>s.default.absoluteFill,innerContainerCentered:()=>a.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,alignItems:"center",justifyContent:"flex-end",paddingBottom:5})});class w extends _.default{constructor(){super(...arguments),this._isPressed=!1,this._isPanning=!1,this._isResizing=!1,this._handleMouseCursorChange=e=>{this.setState({mouseCursor:e})},this._handleZoomLevelChange=e=>{this.setState({zoomLevel:e})},this._setZoomLevelFromUIControls=e=>{var t;null===(t=this._zoomController)||void 0===t||t.handleUIControlsZoom(e)},this._handleLayoutChange=e=>{var t;null===(t=this._zoomController)||void 0===t||t.updateScreenShareElementSizes(e)},this._onLongPressHandler=()=>this.props.showContextMenu||this._shouldShowContextMenuForNewStage()?this.props.getContextMenuHandler(!1):this._onLongPress,this._onMultiTouchGesture=e=>{if(this.isComponentMounted()&&this.props.zoomEnabled){if(!this._isPanning){Math.abs(e.initialCenterPageX-e.centerPageX)>20&&(this._isPanning=!0)}if(this._isPanning){const t=this._panPosition||{x:e.centerPageX,y:e.initialCenterPageY},i={x:e.centerPageX,y:e.centerPageY},a=i.x-t.x,n=i.y-t.y,s=this.props.getCallParticipantVideoViews();o.each(s,(e=>{var t;return null===(t=e.getVideoElement())||void 0===t?void 0:t.panVideo({x:a,y:n})})),this._panPosition=i}else{const t=e.distance/e.initialDistance;this.props.sizeToFit?t>=1.3&&(u.default.onZoomIn(this.props.callId||""),p.track(new S.Zoom),this.props.setSizeToFit(!1)):t<=.7&&(u.default.onZoomOut(this.props.callId||""),p.track(new S.Zoom),this.props.setSizeToFit(!0))}}e.isComplete&&(this._panPosition=void 0,this._isPanning=!1)},this._onPressIn=()=>{this._isPressed=!0,this.props.onPressInOrOut&&(this._pressedTimerToken=d.default.setTimeout((()=>{this.isComponentMounted()&&this._isPressed&&this.props.onPressInOrOut&&this.props.onPressInOrOut(this.props.renderKey,!!this.props.isCompact,!0)}),350))},this._onPressOut=()=>{this._isPressed=!1,void 0!==this._pressedTimerToken&&(d.default.clearTimeout(this._pressedTimerToken),this._pressedTimerToken=void 0),this.props.onPressInOrOut&&this.props.onPressInOrOut(this.props.renderKey,!!this.props.isCompact,!1)},this._onLongPress=()=>{},this._onScrollWheel=e=>{var t;null===(t=this._zoomController)||void 0===t||t.handleScrollZoom(e)},this._onPan=e=>{if(this._zoomController)return void this._zoomController.handleDragging(e);const t=this._getViewClientRect();if(this.props.zoomEnabled&&!this.props.isCompact){const t=this._panPosition||{x:e.pageX,y:e.initialPageY},i={x:e.pageX,y:e.pageY},a=i.x-t.x,n=i.y-t.y,s=this.props.getCallParticipantVideoViews();o.each(s,(e=>{var t;return null===(t=e.getVideoElement())||void 0===t?void 0:t.panVideo({x:a,y:n})})),this._panPosition=i,e.isComplete&&(this._panPosition=void 0)}const i=C.default.shouldStartSimulateViewResizing(!!this.props.enableFloatableResizableVideoPreview,this.props.isLocal,this.props.videoStatus===g.VideoStatus.Streaming,!this.props.isDragging,this._mousePosition!==g.CallingViewCornerPostion.NotAtCorner);if(this.props.onResize&&(i||this._isResizing)){const i=this._resizePosition||{x:e.pageX,y:e.initialPageY},a={x:e.pageX,y:e.pageY},n=a.x-i.x,o=a.y-i.y;if(this._isResizing=!0,void 0===this._resizePosition&&(this._lastViewLayoutBeforeResizing=t,this._resizePosition=a,this._mouseResizeSessionStartPosition=this._mousePosition),t&&this._lastViewLayoutBeforeResizing&&void 0!==this._resizePosition){let i=1,s=this._lastViewLayoutBeforeResizing.y,r=0;switch(this._mouseResizeSessionStartPosition){case g.CallingViewCornerPostion.UpperLeft:i=n>0&&o>0||n>0&&0===o||0===n&&o<0?-1:1,s=this._lastViewLayoutBeforeResizing.y,r=s-a.y;break;case g.CallingViewCornerPostion.UpperRight:i=n<0&&o>0||n<0&&0===o||0===n&&o>0?-1:1,s=this._lastViewLayoutBeforeResizing.y,r=s-a.y;break;case g.CallingViewCornerPostion.BottomLeft:i=n>0&&o<0||n>0&&0===o||0===n&&o<0?-1:1,s=this._lastViewLayoutBeforeResizing.y+this._lastViewLayoutBeforeResizing.height,r=a.y-s;break;case g.CallingViewCornerPostion.BottomRight:i=n<0&&o<0||n<0&&0===o||0===n&&o<0?-1:1,s=this._lastViewLayoutBeforeResizing.y+this._lastViewLayoutBeforeResizing.height,r=a.y-s}r=1===i?r>=0?r:0:r<=0?r:0;const l=Math.abs(r)/this._lastViewLayoutBeforeResizing.height*i+1;if(void 0!==this._mouseResizeSessionStartPosition){const i=this.isComponentMounted()?this.props.getLayoutController():void 0;i&&i.resizeRect&&i.resizeRect(l,t.height,this._mouseResizeSessionStartPosition,e.isComplete),this.props.onResize(this.props.renderKey)}if(e.isComplete){const e=y.default.newCauseId();p.log(f.LogTraceArea.CallingUI,this.props.parentViewId+"._onPan, causeId: "+e),this.props.callId&&u.default.updateCallTelemetry(this.props.callId,e,(e=>e.resizeOwnPreview())),this._resizePosition=void 0,this._isResizing=!1,this._mouseResizeSessionStartPosition=void 0}}}else if(this.props.onPan){if(this.props.isLocal&&this.props.videoStatus!==g.VideoStatus.Streaming)return;!this.props.isDragging||e.isComplete?t?this.props.onPan(this.props.renderKey,e,t):this.props.onPan(this.props.renderKey,e):this.props.onPan(this.props.renderKey,e,t)}},this._onTap=e=>{this.props.isCompact&&this.props.onMouseOverOrOut&&this.props.onMouseOverOrOut(this.props.renderKey,!0,!1);const t=this._getNormalizedTimestamp(e);this.props.onDoubleTap?this._isDoubleTap(e)?(this._cancelDoubleTapTimer(),this._sendDoubleTapEvent(),this._lastTapEvent=void 0):(this._reportDelayedTap(t),this._startDoubleTapTimer(e)):this._sendTapEvent(t)},this._sendTapEvent=e=>{this.props.onTap&&this.props.onTap(this.props.renderKey,e)},this._onMouseMove=e=>{this._setMouseOver(),this._mayChangeMouseCursor(e)},this._onMouseEnter=e=>{e.stopPropagation(),this._setMouseOver(),this._mayChangeMouseCursor(e)},this._onMouseLeave=e=>{this.props.onMouseOverOrOut&&(this.props.enableFloatableResizableVideoPreview?d.default.sleep(1e3).then((()=>{this.props.onMouseOverOrOut&&this.props.onMouseOverOrOut(this.props.renderKey,!!this.props.isCompact,!1)})):this.props.onMouseOverOrOut(this.props.renderKey,!!this.props.isCompact,!1)),this.props.isCallStageV2||this.props.setHovering(!1),this._setApplyGestureInsets(!1)}}_buildState(e,t){const i={};return t&&(i.applyGestureButtonInsets=!1,i.mouseCursor=void 0,i.zoomLevel=0),i}componentDidMount(){super.componentDidMount(),this.props.isScreenShareZoomEnabled&&(this._zoomController=new b.default({getVideoElement:this.props.getScreenShareVideoElement,onMouseCursorChange:this._handleMouseCursorChange,onZoomLevelChange:this._handleZoomLevelChange,callId:this.props.callId||""}))}componentWillUnmount(){super.componentWillUnmount(),this._stopZoomController()}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),!this.props.zoomEnabled&&e.zoomEnabled&&(this._isPanning=!1,this._panPosition=void 0),!this.props.enableVideoGestures&&e.enableVideoGestures&&this.props.zoomEnabled){const e=this.props.getCallParticipantVideoViews();o.each(e,(e=>{var t;return null===(t=e.getVideoElement())||void 0===t?void 0:t.resetPan()}))}}render(){const e=this.props.isCompact&&this.state.applyGestureButtonInsets&&!this.props.enableFloatableResizableVideoPreview,t=[v.gestureButton,e?v.gestureButtonInsets:void 0],i=(this.props.enableFloatableResizableVideoPreview||!this.props.enableFloatableResizableVideoPreview)&&!0,n=i?[v.innerContainer,s.default.overflowVisible,a.Styles.createViewStyle({borderRadius:this.props.videoBorderRadius},!1)]:[v.innerContainerCentered,s.default.overflowVisible];return a.createElement(a.View,{style:{flex:1},onLayout:this._handleLayoutChange},a.createElement(a.GestureView,{key:"gestureView",style:n,onPan:this._onPan,onPinchZoom:this.props.zoomEnabled?this._onMultiTouchGesture:void 0,onScrollWheel:this._onScrollWheel,panPixelThreshold:this.props.isCompact?void 0:25,mouseOverCursor:this.state.mouseCursor,importantForAccessibility:this._getImportantForAccessibility(i)},this.props.contentView,i?this._getOptionalFlipIcon():void 0,this.props.accessoryView,this.props.optionalRaiseHandAccessory,i?a.createElement(a.View,{style:t,onPress:this.props.onTap?this._onTap:void 0,onLongPress:this.props.onTap?this._onLongPress:void 0,onMouseMove:this.props.onMouseOverOrOut?this._onMouseMove:void 0,onMouseEnter:this.props.onMouseOverOrOut?this._onMouseEnter:void 0,onMouseLeave:this.props.onMouseOverOrOut?this._onMouseLeave:void 0,accessibilityLabel:this.props.displayName,accessibilityTraits:a.Types.AccessibilityTrait.Button,onContextMenu:this.props.showContextMenu||this._shouldShowContextMenuForNewStage()?this.props.getContextMenuHandler(!1):void 0}):a.createElement(a.Button,{style:t,onPress:this.props.onTap?this._onTap:void 0,onPressOut:this._onPressOut,onPressIn:this._onPressIn,onLongPress:this.props.enableActionMenuOnMobile&&this.props.onTap?this._onLongPressHandler():void 0,onHoverStart:this.props.onMouseOverOrOut?this._onMouseEnter:void 0,onHoverEnd:this.props.onMouseOverOrOut?this._onMouseLeave:void 0,accessibilityLabel:this._getAccessibilityLabel(),onContextMenu:this.props.showContextMenu?this.props.getContextMenuHandler(!1):void 0,tabIndex:this.props.isCompact?void 0:-1}),this.props.optionalNameTagLine,this.props.optionalBackgroundInfo),this._renderScreenShareZoomControls())}_stopZoomController(){this._zoomController&&(this._zoomController.stop(),this._zoomController=void 0)}_renderScreenShareZoomControls(){return this.props.isScreenShareZoomEnabled?a.createElement(T.default,{setZoomLevel:this._setZoomLevelFromUIControls,currentZoomLevel:this.state.zoomLevel,isNavigatingWithKeyboard:this.props.isNavigatingWithKeyboard}):void 0}_getImportantForAccessibility(e){return this.props.isNavigatingWithKeyboard&&this.props.isCompact?a.Types.ImportantForAccessibility.NoHideDescendants:a.Types.ImportantForAccessibility.No}_getOptionalFlipIcon(){if(this.props.allowCameraFlip&&this.props.camera&&this.props.showControls)return a.createElement(m.default,{color:r.Color.white,size:l.IconSize.size18,icon:l.SkypeIcon.NewSwitchCamera})}_getAccessibilityLabel(){if(this.props.isCompact){if(this.props.allowCameraFlip&&this.props.camera){if(this.props.camera.position===n.CameraPosition.Front)return h.getString("CallControls.CallButtonSwitchCameraBackwardLabel");if(this.props.camera.position===n.CameraPosition.Back)return h.getString("CallControls.CallButtonSwitchCameraForwardLabel")}return this.props.displayName}}_shouldShowContextMenuForNewStage(){return!!this.props.isCallStageV2&&(!this.props.isLargeGridBot&&!this.props.isAScreensharing&&(!this.props.isTogetherModeBot||this.props.showChangeTogetherModeBackgroundOption))}_isDoubleTap(e){if(!this._lastTapEvent)return!1;return this._getEventTimestamp(e)-this._getEventTimestamp(this._lastTapEvent)<=200}_startDoubleTapTimer(e){this._lastTapEvent=e;const t=this._getNormalizedTimestamp(e);this._doubleTapTimer=d.default.setTimeout((()=>{this.isComponentMounted()&&(this._reportDelayedTap(t),this._doubleTapTimer=void 0)}),200)}_cancelDoubleTapTimer(){this._doubleTapTimer&&(d.default.clearTimeout(this._doubleTapTimer),this._doubleTapTimer=void 0)}_reportDelayedTap(e){this._lastTapEvent&&this.props.onTap&&(this._sendTapEvent(e),this._lastTapEvent=void 0)}_sendDoubleTapEvent(){this.props.onDoubleTap&&this.props.onDoubleTap(this.props.renderKey)}_getEventTimestamp(e){return e.timeStamp?e.timeStamp.valueOf():0}_getNormalizedTimestamp(e){return Date.now()}_setApplyGestureInsets(e){this.isComponentMounted()&&this.state.applyGestureButtonInsets!==e&&this.setState({applyGestureButtonInsets:e})}_mayChangeMouseCursor(e){const t=this._getViewCallUIPosition(),i=!!t&&(t===g.CallingViewUIPostion.Ribbon||t===g.CallingViewUIPostion.FloatingOnTop);if(this.isComponentMounted()&&this.props.enableFloatableResizableVideoPreview&&this.props.isLocal&&i&&this.props.videoStatus===g.VideoStatus.Streaming){const t=e.clientX,i=e.clientY,n=this._getViewClientRect();this._mousePosition=C.default.getMouseCornerPosition(t,i,n);let o=a.Types.GestureMouseCursor.Default;this.props.isDragging||this._mousePosition===g.CallingViewCornerPostion.NotAtCorner&&!this._isResizing||(this._mousePosition!==g.CallingViewCornerPostion.BottomLeft&&this._mousePosition!==g.CallingViewCornerPostion.UpperRight||(o=a.Types.GestureMouseCursor.NESWResize),this._mousePosition!==g.CallingViewCornerPostion.UpperLeft&&this._mousePosition!==g.CallingViewCornerPostion.BottomRight||(o=a.Types.GestureMouseCursor.NWSEResize)),this.setState({mouseCursor:o})}}_getViewClientRect(){const e=this.props.getLayoutController();return e&&e.viewRect?e.viewRect(!0):void 0}_getViewCallUIPosition(){const e=this.props.getLayoutController();return e&&e.getUIPosition?e.getUIPosition():void 0}_setMouseOver(){this.props.isDragging||(this.props.onMouseOverOrOut&&this.props.onMouseOverOrOut(this.props.renderKey,!!this.props.isCompact,!0),this.isComponentMounted()&&(this.props.isCompact?this.state.applyGestureButtonInsets||this.setState({applyGestureButtonInsets:!0}):this.props.isCallStageV2||this.props.setHovering(!0)))}}t.default=w},53514:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(24576),o=i(81760),s=i(15877),r=i(71727),l=i(80200),c=i(30098),d=(0,s.lazyProperties)({nameTag:()=>a.Styles.createViewStyle({position:"absolute",left:10,right:10,bottom:10,alignItems:"center",justifyContent:"center",overflow:"visible"}),nametagAndAccessoriesLine:()=>a.Styles.createViewStyle({position:"absolute",flexDirection:"row",justifyContent:"space-between",bottom:12,left:12,right:12,alignSelf:"stretch",flexBasis:0,flexGrow:1,overflow:"hidden",alignItems:"flex-end"}),nametagAndAccessoriesLineTray:()=>a.Styles.createViewStyle({bottom:10,left:10,right:10}),presenterAccessory:()=>a.Styles.createViewStyle({width:24,height:24,borderRadius:12,backgroundColor:o.Color.white,alignItems:"center",justifyContent:"center",marginLeft:8,overflow:"hidden"}),smallAccessoryInnerView:()=>a.Styles.createViewStyle({width:20,height:20,borderRadius:10,backgroundColor:o.Color.white,alignItems:"center",justifyContent:"center"}),smallAccessoryInnerScreenshareView:()=>a.Styles.createViewStyle({backgroundColor:o.Color.white}),desktopNameTag:()=>a.Styles.createViewStyle({position:"absolute",left:10,right:10,bottom:0,alignItems:"center",justifyContent:"center",overflow:"visible"}),desktopNameTagLeft:()=>a.Styles.createViewStyle({position:"relative",alignItems:"flex-end",alignSelf:"stretch",flexDirection:"row",flexShrink:1,left:0,right:0,overflow:"hidden"})});class u extends n.default{render(){if(this.props.isCallStageV2){let e;if(this.props.isPresenter){const t=r.default.getShareScreenIcon(!0),i=[d.smallAccessoryInnerView,d.smallAccessoryInnerScreenshareView];e=a.createElement(a.Animated.View,{style:d.presenterAccessory,ignorePointerEvents:!0},this.props.getDesktopAccessory(i,t))}const t=[d.nametagAndAccessoriesLine,this.props.isInTray?d.nametagAndAccessoriesLineTray:void 0];return a.createElement(a.View,{style:t},this._getOptionalNameTag(),e)}return this._getOptionalNameTag()}_getOptionalNameTag(){var e;const t=[this.props.desktopNameTag?d.desktopNameTag:d.nameTag,this.props.isCallStageV2?d.desktopNameTagLeft:void 0];this.props.nametagOpacityStyle&&t.push(this.props.nametagOpacityStyle);const i=null===(e=this.props.nametagPosition)||void 0===e?void 0:e.offset;if(i&&t.push(a.Styles.createViewStyle({bottom:i},!1)),this.props.callId&&this.props.conversationMri)return a.createElement(a.Animated.View,{style:t,ignorePointerEvents:!0},a.createElement(c.CallParticipantNametagView,{hoveringKey:this.props.renderScreenShare?void 0:this.props.renderKey,callId:this.props.callId,isLocal:this.props.isLocal,conversationMri:this.props.conversationMri,onToggleCropVideoClicked:this.props.toggleCropUncropVideo,sizeToFit:this.props.sizeToFit,videoStatus:this.props.videoStatus||l.VideoStatus.None,onCallParticipantContextMenuOpened:this.props.onCallParticipantContextMenuOpened,onCallParticipantContextMenuDismissed:this.props.onCallParticipantContextMenuDismissed,isCallStageV2:this.props.isCallStageV2,showMoreIcon:this.props.hovering,isOnHold:this.props.isOnHold,useLightTheme:this.props.useLightTheme,isInTray:this.props.isInTray}))}}t.default=u},30098:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallParticipantNametagView=t.CallParticipantNametag=void 0;const a=i(16778),n=i(81770),o=i(94224),s=i(88717),r=i(80200),l=i(71727),c=i(5531),d=i(71830),u=i(11009),h=i(77381),p=i(52262),g=i(15877),C=i(18078),m=i(16582),S=i(90244),y=i(81760),f=i(11828),_=i(49776),b=i(71499),T=i(62602),v=(0,g.lazyProperties)({floatingNameTag:()=>a.Styles.createViewStyle({marginTop:10}),toolTipContainer:()=>a.Styles.createViewStyle({height:24}),toolTipContainerRaiseHand:()=>a.Styles.createViewStyle({overflow:"visible",paddingLeft:5}),toolTipContainerRaiseHandV2:()=>a.Styles.createViewStyle({overflow:"hidden",paddingLeft:35}),nametagBgColorStyle:()=>a.Styles.createViewStyle({backgroundColor:y.Color.blackOverlay50}),nametagBgColorStyleLightThemeStage:()=>a.Styles.createViewStyle({backgroundColor:y.Color.whiteOverlay80}),nametagBgColorStyleLightThemeTray:()=>a.Styles.createViewStyle({backgroundColor:y.Color.gray50overlay95}),nametagBgColorStyleHover:()=>a.Styles.createViewStyle({backgroundColor:y.Color.blackOverlay80}),nametagBgColorStyleHoverLightTheme:()=>a.Styles.createViewStyle({backgroundColor:y.Color.whiteOverlay90}),raisedHandIconV2:()=>a.Styles.createViewStyle({position:"absolute",left:0,bottom:-6}),wrapperStageV2:()=>a.Styles.createViewStyle({height:36,justifyContent:"flex-end",flexGrow:0,flexShrink:1})});class w extends h.default{constructor(){super(...arguments),this._updateAnchorRect=e=>{!e&&this.state.hoveringKey&&this.props.getAnchorInfo&&(e=this.props.getAnchorInfo(this.state.hoveringKey)),this._popupView&&e&&this._popupView.updatePosition(e)},this._onPopupViewRef=e=>{this._popupView=e||void 0},this._getPopUpPositions=e=>[u.PopupAnchorPositon.Bottom],this._getAnchorInfo=()=>{if(this.props.getAnchorInfo&&this.state.hoveringKey)return this.props.getAnchorInfo(this.state.hoveringKey)},this._renderPopupContent=()=>a.createElement(I,{style:v.floatingNameTag,opacityStyle:this.props.opacityStyle,hoveringKey:this.state.hoveringKey,callId:this.props.callId,conversationMri:this.props.conversationMri,isLocal:this.state.hoveringKey===r.CallStageElementKeys.localUserKey,onCallParticipantContextMenuOpened:this.props.onCallParticipantContextMenuOpened,onCallParticipantContextMenuDismissed:this.props.onCallParticipantContextMenuDismissed,onNametagMouseEnter:this.props.onNametagMouseEnter,onNametagMouseLeave:this.props.onNametagMouseLeave,isCompact:!0,isOnHold:this.props.isOnHold})}_buildState(e,t){const i=n.default.getCurrentHoveringParticipantConfig();return{hoveringKey:i?i.key:void 0}}componentDidMount(){super.componentDidMount(),this._updateAnchorRect(),this.state.hoveringKey&&this._updateAnchorRectAndSubscribeForChanges(this.state.hoveringKey)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.state.hoveringKey===t.hoveringKey&&this.props.parentDimensions===e.parentDimensions||(this.state.hoveringKey?this._updateAnchorRectAndSubscribeForChanges(this.state.hoveringKey):this._unsubscribeFromAnchorRectChanges())}componentWillUnmount(){super.componentWillUnmount(),this._unsubscribeFromAnchorRectChanges()}_updateAnchorRectAndSubscribeForChanges(e){this._updateAnchorRect(),this._unsubscribeFromAnchorRectChanges(),this.props.getAnchorInfoChanges&&(this._rectChangeSubscriptionToken=this.props.getAnchorInfoChanges(e,this._updateAnchorRect))}_unsubscribeFromAnchorRectChanges(){this._rectChangeSubscriptionToken&&(this._rectChangeSubscriptionToken.unsubscribe(),this._rectChangeSubscriptionToken=void 0)}render(){return this.state.hoveringKey?a.createElement(m.default,{key:this.state.hoveringKey,ref:this._onPopupViewRef,disablePositionAnimation:!0,getAnchorInfo:this._getAnchorInfo,getPopupPositions:this._getPopUpPositions,renderPopup:this._renderPopupContent,allowTaps:!0,ignorePointerEvents:!0}):null}}t.CallParticipantNametag=w;class I extends h.default{constructor(){super(...arguments),this._onUserNameChevronOverflowPress=e=>{"key"in e?T.default.measureLayoutRelativeToWindow((()=>this._nametagRef)).then((({x:e,y:t})=>{this.props.isLocal?s.default.showLocalVideoActionsContextMenuOnPosition({x:e,y:t},this._getRootViewId(),this._getCallLocalVideoContextMenuOptions(),this.props.onToggleCropVideoClicked):s.default.showParticipantActionsContextMenuOnPosition({x:e,y:t},this._getRootViewId(),this._getCallParticipantContextMenuOptions(),this.props.onCallParticipantContextMenuOpened,this.props.onCallParticipantContextMenuDismissed,this.props.onToggleCropVideoClicked)})):this.props.isLocal?s.default.showLocalVideoActionsContextMenu(e,this._getRootViewId(),this._getCallLocalVideoContextMenuOptions(),this.props.onToggleCropVideoClicked):s.default.showParticipantActionsContextMenu(e,this._getRootViewId(),this._getCallParticipantContextMenuOptions(),this.props.onCallParticipantContextMenuOpened,this.props.onCallParticipantContextMenuDismissed,this.props.onToggleCropVideoClicked)},this._onMouseEnter=e=>{this.props.onNametagMouseEnter&&this.props.hoveringKey&&this.props.onNametagMouseEnter(e,this.props.hoveringKey)},this._onMouseLeave=e=>{this.props.onNametagMouseEnter&&this.props.hoveringKey&&this.props.onNametagMouseEnter(e,this.props.hoveringKey)},this._setNametagRef=e=>{this._nametagRef=e||void 0}}_buildState(e,t){const i=!e.isLocal&&e.hoveringKey?d.asMriMaybe(e.hoveringKey):void 0,a=!e.isLocal;let n,s,c;if(a&&e.hoveringKey&&(n=o.default.CallingStore.findRemoteCallMember(e.callId,e.hoveringKey)),e.isLocal){const e=C.default.getSkypeMri();s=p.default.getDisplayName(e),c=e}else i&&(s=p.default.getDisplayName(i),c=i);const u=!!c&&!!e.callId&&o.default.CallingStore.isHandRaisedForMri(c,e.callId),h=d.isGroupConversation(e.conversationMri);let g={displayName:s,participantViewMuteIconEnabled:a,isServerMutedSupported:!!n&&o.default.CallingStore.getServerMuteUnmuteSupportedForParticipant(e.callId,n),isLocalMuteSupported:o.default.CallingStore.getLocalMuteSupported(e.callId),isMuted:e.isLocal?l.default.isLocalOrServerMuted(e.callId):!!n&&n.isServerMuted,isGroupCall:h,isCallConnected:o.default.CallingStore.isCallConnected(e.callId),isHandRaised:u};{const t=o.default.CallingFeaturesHelper.allowOutboundVideo({isPSTNCall:o.default.CallingStore.isPSTNCall(e.callId),isEncryptedCall:o.default.CallingStore.isEncryptedCall(e.callId),conversationMri:e.conversationMri,callId:e.callId});g.participantViewActionsEnabled=!e.isLocal,g.tooltipsShowing=b.default.getToolTipConfig(this._getRootViewId()).displayText.length>0,g.localVideoActionsEnabled=e.isLocal&&t,g.isPinned=l.default.isCallParticipantPinned(e.isLocal?r.CallStageElementKeys.localUserKey:c,e.callId)}return g}_getCallParticipantContextMenuOptions(){const e=this.props.hoveringKey;return{callId:this.props.callId,conversationMri:this.props.conversationMri,userMri:e,isLocal:this.props.isLocal,isGroupCall:this.state.isGroupCall,isLocalMuteSupported:this.state.isLocalMuteSupported,isMuted:this.state.isMuted,isServerMutedSupported:this.state.isServerMutedSupported,sizeToFit:this.props.sizeToFit,isCompact:!!this.props.isCompact,videoStatus:this.props.videoStatus?this.props.videoStatus:r.VideoStatus.None,isCropVideoEnabledOnGroupCall:!0,isCropVideoEnabledOn1On1Call:!0,showCropUncropMenuOption:!1,showMute:!1,showMuteEveryone:!1,isMuteOptionDisabled:!1,showRemoveCall:!1,showSendMessageMenuOption:c.default.call().canSendMessageToParticipant,showCropVideoOption:!1,showFullVideoOption:!1,showViewProfile:c.default.navigation().canAccessUserDetails,showLowerHandOption:this.state.isHandRaised,showChangeTogetherModeBackgroundOption:!1,showPinOption:l.default.shouldShowCallParticipantPinOption(e,this.props.callId),showUnpinOption:l.default.shouldShowCallParticipantUnpinOption(e,this.props.callId)}}_getCallLocalVideoContextMenuOptions(){return s.default.getCallLocalVideoContextMenuOptions(this.props.callId,this.props.conversationMri,!!this.props.isCompact,this.props.videoStatus?this.props.videoStatus:r.VideoStatus.None,this.props.sizeToFit,this.state.isHandRaised)}_getToolTipStyleV2(){return this.props.useLightTheme?this.props.isInTray?v.nametagBgColorStyleLightThemeTray:v.nametagBgColorStyleLightThemeStage:v.nametagBgColorStyle}render(){const e=this.state.displayName?this.state.displayName:void 0,t=!this.props.isCompact&&this.state.isMuted?f.SkypeIcon.MicrophoneOff:void 0;if(!this.state.isCallConnected||!e||!this.props.isCallStageV2&&!this.state.isGroupCall&&!this.state.isMuted)return null;const i=l.default.getUserOptionsAccessibilityLabel(e,this.state.isMuted,this.state.isHandRaised),n=[this.props.style,this.props.opacityStyle,v.toolTipContainer,this.props.isCallStageV2?this._getToolTipStyleV2():void 0];let o,s;this.state.isHandRaised&&!this.props.isCompact&&(this.props.isCallStageV2?(n.push(v.toolTipContainerRaiseHandV2),s=a.createElement(a.View,{style:v.raisedHandIconV2},a.createElement(S.default,{type:S.RaiseHandImageType.MediumSizeCenterAligned}))):(n.push(v.toolTipContainerRaiseHand),o=a.createElement(S.default,{type:S.RaiseHandImageType.MediumSizeCenterAligned})));const r=[];this.state.isPinned&&r.push(f.SkypeIcon.Pin);let c=this.props.isCallStageV2?t:void 0;this.props.isOnHold&&(c=f.SkypeIcon.Pause),r.push(c);let d=f.SkypeIcon.More;this.props.isCallStageV2&&(this.props.showMoreIcon?n.push(this.props.useLightTheme?v.nametagBgColorStyleHoverLightTheme:v.nametagBgColorStyleHover):d=void 0),r.push(d);const u=this.props.useLightTheme?y.Color.gray400:void 0;let h=a.createElement(_.default,{style:n,displayText:e,leftIcon:this.props.isCallStageV2?void 0:t,leftElement:o,rightIcons:r,onPress:this._onUserNameChevronOverflowPress,accessibilityLabel:i,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave,ellipseCaption:this.props.isCallStageV2,textColor:u,ref:this._setNametagRef});if(this.props.isCallStageV2)return a.createElement(a.View,{style:v.wrapperStageV2},h,s);const p=a.createElement(_.default,{style:n,displayText:e,leftElement:o,textColor:u}),g=a.createElement(_.default,{style:n,displayText:e,leftIcon:t,leftElement:o,textColor:u});return this.state.participantViewMuteIconEnabled||this.state.participantViewActionsEnabled||this.state.localVideoActionsEnabled?!this.state.isGroupCall&&t?g:this.state.participantViewMuteIconEnabled&&this.state.participantViewActionsEnabled||this.state.localVideoActionsEnabled?h:p:p}}t.CallParticipantNametagView=I,t.default=w},92831:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(16778),o=i(88837),s=i(89391),r=i(78968),l=i(76455),c=i(46096),d=i(36237),u=i(15877),h=i(78262),p=(0,u.lazyProperties)({container:()=>n.Styles.createViewStyle({position:"absolute",top:0,right:0,bottom:0,left:0,alignItems:"center",justifyContent:"center"})});class g extends o.ComponentBase{constructor(){super(...arguments),this._onMaybeHandleReaction=e=>{if(d.log(c.LogTraceArea.CallReactions,"CallParticipantReactionView._onMaybeHandleReaction cuid: "+e.reaction.cuid),!this.isComponentMounted())return d.log(c.LogTraceArea.CallReactions,"CallParticipantReactionView._onMaybeHandleReaction cuid: "+e.reaction.cuid+" NOT handled (not mounted)"),!1;const t=!e.reaction.isEmoticonCallReaction()&&e.reactionsTextStyle===h.ReactionsTextStyle.Default;return this.state.enableSimpleTextReactions?(d.log(c.LogTraceArea.CallReactions,"CallParticipantReactionView._onMaybeHandleReaction cuid: "+e.reaction.cuid+" NOT handled (simple text reactions enabled)"),!1):t&&this.props.isCompact?(d.log(c.LogTraceArea.CallReactions,"CallParticipantReactionView._onMaybeHandleReaction cuid: "+e.reaction.cuid+" NOT handled (compact text reaction)"),!1):(this.setState({reactionInfo:e}),d.log(c.LogTraceArea.CallReactions,"CallParticipantReactionView._onMaybeHandleReaction cuid: "+e.reaction.cuid+" handled"),!0)}}_buildState(e,t){const i=s.default.getS4LCMCFeatures();let a={enableSimpleTextReactions:i.enableSimpleTextReactions};return t&&(a.reactionInfo=void 0),i.enableNewAnimations&&(a.newAnimatedReaction=i.callAnimatedReactionsConfig.callAnimatedReactionsKeys),a}componentDidMount(){if(super.componentDidMount(),this.props.getCallReactionsDisplayHelper){this.props.getCallReactionsDisplayHelper().registerParticipantReactionCallback(this.props.participantMri,this._onMaybeHandleReaction)}}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),t.reactionInfo&&t.reactionInfo.isLocal){const e=r.default.maybeGetAndClearReactionPressedScenario();e&&(e.markPerfTargetStepCompleted("componentDidUpdate"),a.defer((()=>{e.markStepCompleted("backOnJSThread"),e.finish()})))}}componentWillUnmount(){if(super.componentWillUnmount(),this.props.getCallReactionsDisplayHelper){const e=this.props.getCallReactionsDisplayHelper();e.unregisterParticipantReactionCallback(this.props.participantMri),e.dismissReaction(this.props.participantMri)}}render(){let e;if(this.state.reactionInfo){let t,i=this.state.reactionInfo.content;if(this.state.reactionInfo.reaction.isEmoticonCallReaction())t=l.CallReactionType.Emoji,i=this.state.reactionInfo.reaction.getEmoticonCallReactionKey();else if(this.state.reactionInfo.reactionsTextStyle===h.ReactionsTextStyle.Sticker)t=l.CallReactionType.Sticker;else if(this.state.reactionInfo.reactionsTextStyle===h.ReactionsTextStyle.Snapshot)t=l.CallReactionType.Snapshot;else{if(this.state.reactionInfo.reactionsTextStyle===h.ReactionsTextStyle.Animation)return null;if(this.state.reactionInfo.isLocal)return null;t=l.CallReactionType.Text}let a=[];this.props.borderRadius&&a.push(n.Styles.createViewStyle({borderRadius:this.props.borderRadius},!1)),i&&(e=n.createElement(l.default,{style:a,reactionType:t,cuid:this.state.reactionInfo.reaction.cuid,creator:this.state.reactionInfo.reaction.creator,content:i,reaction:this.state.reactionInfo.reaction,showBackgroundGradient:this.state.reactionInfo.reactionsTextStyle!==h.ReactionsTextStyle.Animation,gradientColors:this.state.reactionInfo.gradientColors,isCompact:this.props.isCompact,borderRadius:this.props.borderRadius,useMobileReactionsLayout:this.props.useMobileReactionsLayout}))}return n.createElement(n.View,{style:p.container,ignorePointerEvents:!0},e)}}t.default=g},54174:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallParticipantTalkingView=t.CallParticipantTalkingViewSize=void 0;const a=i(16778),n=i(88837),o=i(89391),s=i(15877),r=i(45026),l=i(81760),c=100,d=120;var u;!function(e){e[e.CompactSmall=60]="CompactSmall",e[e.CompactLarge=c]="CompactLarge",e[e.Large=d]="Large"}(u=t.CallParticipantTalkingViewSize||(t.CallParticipantTalkingViewSize={}));const h=(0,s.lazyProperties)({compactSmall:()=>(0,s.lazyProperties)({container:()=>a.Styles.createViewStyle({height:60,width:60,overflow:"visible"}),ring:()=>a.Styles.createViewStyle({position:"absolute",top:-0,left:-0,width:60,height:60,borderRadius:30})}),compactLarge:()=>(0,s.lazyProperties)({container:()=>a.Styles.createViewStyle({height:c,width:c,overflow:"visible"}),ring:()=>a.Styles.createViewStyle({position:"absolute",top:-0,left:-0,width:100,height:100,borderRadius:50})}),large:()=>(0,s.lazyProperties)({container:()=>a.Styles.createViewStyle({height:d,width:d,overflow:"visible"}),ring:()=>a.Styles.createViewStyle({position:"absolute",top:0,left:0,width:d,height:d,borderRadius:60})}),roundedRect:()=>a.Styles.createViewStyle({borderRadius:12}),videoContainer:()=>a.Styles.createViewStyle({position:"absolute",top:-0,left:-0,bottom:-0,right:-0}),videoInnerContainer:()=>a.Styles.createViewStyle({flex:1,borderRadius:12})});class p extends n.ComponentBase{constructor(){super(...arguments),this._isTalking=!1,this._ringScaleAnimatedValue=new a.Animated.Value(1),this._ringScaleAnimatedStyle=a.Styles.createAnimatedViewStyle({transform:[{scale:this._ringScaleAnimatedValue}]}),this._defaultAnimatedColorValue=new a.Animated.Value(0),this._defaultAnimatedColorStyle=a.Styles.createAnimatedViewStyle({backgroundColor:this._defaultAnimatedColorValue.interpolate({inputRange:[0,1],outputRange:[l.Color.blackOverlay20,l.Color.white]})})}_buildState(e,t){let i={disableParticipantTalkingAnimation:o.default.getS4LCMCFeatures().disableParticipantTalkingAnimation};return t&&(i.isAnimating=!1),i}componentDidMount(){super.componentDidMount(),this._updateTalkingRing()}updateTalking(e){this._isTalking!==e&&(this._isTalking=e,this._updateTalkingRing())}_updateTalkingRing(){this._isTalking&&!this.state.isAnimating&&this._startLoopingAnimation()}_startLoopingAnimation(){this.state.disableParticipantTalkingAnimation||(this._loop(),this._updateRingColor(!0))}_loop(){this._ringScaleAnimation||(this._ringScaleAnimation=a.Animated.sequence([r.default.timing(this._ringScaleAnimatedValue,{toValue:1.12,easing:a.Animated.Easing.CubicBezier(.33,0,0,1),duration:2100,isInteraction:!1,useNativeDriver:!0}),r.default.timing(this._ringScaleAnimatedValue,{toValue:1.04,easing:a.Animated.Easing.CubicBezier(.5,0,1,1),duration:1400,isInteraction:!1,useNativeDriver:!0})])),this._ringScaleAnimation.start((e=>{this.isComponentMounted()&&e.finished&&(this._isTalking?this._loop():this._resetTalkingRing())})),this.setState({isAnimating:!0})}_updateRingColor(e){a.Animated.timing(this._defaultAnimatedColorValue,{toValue:e?1:0,easing:a.Animated.Easing.Linear(),duration:300,isInteraction:!1}).start()}_resetTalkingRing(){this._ringScaleAnimation=r.default.timing(this._ringScaleAnimatedValue,{toValue:1,easing:a.Animated.Easing.InOut(),duration:300,isInteraction:!1,useNativeDriver:!0}),this._ringScaleAnimation.start((e=>{this.isComponentMounted()&&(this._ringScaleAnimation=void 0,this._isTalking?this._startLoopingAnimation():this.setState({isAnimating:!1}))})),this._updateRingColor(!1)}render(){if(this.props.isVideo){const e=[h.videoInnerContainer];return this.props.talkingTintColor?e.push(a.Styles.createViewStyle({backgroundColor:this.props.talkingTintColor,opacity:.8},!1)):e.push(this._defaultAnimatedColorStyle),a.createElement(a.Animated.View,{style:[h.videoContainer,this._ringScaleAnimatedStyle]},a.createElement(a.Animated.View,{style:e}))}let e;e=this.props.size<=u.CompactSmall?{container:h.compactSmall.container,ring:h.compactSmall.ring}:this.props.size<=u.CompactLarge?{container:h.compactLarge.container,ring:h.compactLarge.ring}:{container:h.large.container,ring:h.large.ring};const t=[e.container,this._ringScaleAnimatedStyle],i=[e.ring];this.props.talkingTintColor?i.push(a.Styles.createViewStyle({backgroundColor:this.props.talkingTintColor,opacity:.8},!1)):i.push(this._defaultAnimatedColorStyle),this.props.useRoundedRect&&i.push(h.roundedRect);const n=[e.container];return a.createElement(a.View,{style:n},a.createElement(a.Animated.View,{style:t},a.createElement(a.Animated.View,{style:i})))}}t.CallParticipantTalkingView=p,t.default=p},97079:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(36345),o=i(27202),s=i(48540),r=i(16778),l=i(89391),c=i(94224),d=i(23293),u=i(80837),h=i(36237),p=i(53374),g=i(24430),C=i(89808),m=i(24576),S=i(81760),y=i(66355),f=i(15877),_=i(80200),b=i(14976),T=(0,f.lazyProperties)({innerContainer:()=>u.default.absoluteFill,hiddenContainer:()=>r.Styles.createViewStyle({opacity:0}),mainContainer:()=>r.Styles.createViewStyle({position:"relative",flex:1})});class v extends m.default{constructor(){super(...arguments),this._isRendererEnabled=l.default.isEnabledVideoRendererBoundToView(),this._useNewVideoView=!1,this._onFullScreenUserIcon=e=>{this._fullScreenUserIcon=e||void 0},this._onCallingVideoView=e=>{this._isRendererEnabled&&this._resetLocalPreviewRenderer(e);const t=p.default.newCauseId(),i=e||void 0;h.log(y.LogTraceArea.CallingUI,this._componentTag+"._onCallingVideoView "+b.mriOrId(this.props.mri)+" has video view: "+!!i+" causeId: "+t),this._callingVideoView!==i&&(a.isUndefined(i)&&!a.isUndefined(this._callingVideoView)&&(this._dismissedRenderTarget=this._callingVideoView.getVideoContainer()),this._callingVideoView=i,this._updateVideoLinks(t,i?()=>this.props.onTriggerScalingModeUpdate(this):void 0),this.props.onCallingVideoView&&this.props.onCallingVideoView(this._callingVideoView,t))},this._localPreviewRendererPromise=null,this._updateVideoLinks=(e,t)=>{const i=this._callingVideoView;this.props.onUpdateElementLink(this.props.renderKey,this._getVideoKey(),i?i.getVideoContainer():void 0,i?i.getVideoContainer():this._dismissedRenderTarget,this.props.streamType,e,this.getEndpointId(),t)}}_buildState(e,t){return t&&(this._componentTag=v._generateComponentTag(e)),{gradientColors:v._getGradientColors(e)}}componentDidMount(){super.componentDidMount();const e=p.default.newCauseId();h.log(y.LogTraceArea.CallingUI,this._componentTag+".componentDidMount:  causeId: "+e),this._updateVideoLinks(e,(()=>this.props.onTriggerScalingModeUpdate(this)))}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=p.default.newCauseId();h.log(y.LogTraceArea.CallingUI,this._componentTag+".componentDidUpdate:  causeId: "+a),e&&e.videoStatus===this.props.videoStatus||h.log(y.LogTraceArea.CallingUI,this._componentTag+".componentDidUpdate: Video status updated for "+this.props.renderKey+" "+_.VideoStatus[this.props.videoStatus||_.VideoStatus.None]+" causeId: "+a),this._updateVideoLinks(a,(()=>this.props.onTriggerScalingModeUpdate(this)))}componentWillUnmount(){super.componentWillUnmount()}updateTalkingView(e){!this.props.isCompact&&this._fullScreenUserIcon&&this._fullScreenUserIcon.updateTalking(e)}getVideoElement(){return this._callingVideoView}getEndpointId(){return this.props.streamType!==s.StreamType.Video||this.props.isLocal?void 0:this.props.endpointId}render(){const e=this.props.videoStatus!==_.VideoStatus.None?"video_":"icon_",t=e+this.props.renderKey,i=e+this._getVideoKey(!0);let a,n;switch(this.props.videoStatus){case _.VideoStatus.Available:this.props.renderScreenShare?n=this._renderVideoSurface(t,i,!1):(n=this._renderVideoSurface(t,i,!0),a=this._renderStaticSurface(!1));break;case _.VideoStatus.Streaming:const e=this.props.shouldWaitForVideoSize&&(!this.props.videoDimensions||!this.props.videoDimensions.width);n=this._renderVideoSurface(t,i,e);break;case _.VideoStatus.None:this.props.renderScreenShare||(a=this._renderStaticSurface(!0))}return r.createElement(r.View,{style:[T.innerContainer,T.mainContainer,this.props.videoBorderColorStyle]},n,a)}_renderVideoSurface(e,t,i){h.log(y.LogTraceArea.CallingUI,this._componentTag+"._renderVideoSurface "+t+" hidden "+i+" local:"+this.props.isLocal);const a=[T.innerContainer];return i&&a.push(T.hiddenContainer),this._useNewVideoView&&o.VideoView?r.createElement(o.VideoView,{ref:this._onCallingVideoView,key:"video_"+e}):r.createElement(o.default,{ref:this._onCallingVideoView,key:"video_"+e,nametag:e,style:a,isLocal:this.props.isLocal,videoBorderRadius:this.props.videoBorderRadius,parentView:this._componentTag,localPreviewAndroidV2:this.props.localPreviewAndroidV2,experimentalVideo:this.props.experimentalVideo,renderScreenShare:this.props.renderScreenShare})}static _getGradientColors(e){if(e.useDarkBackground){const t=e.useLightTheme?S.Color.gray50:S.Color.callStageLight;return e.isCallStageV2?[t]:[S.Color.callStageDark,S.Color.gray400]}return e.isLocal||e.renderScreenShare?C.default.getGradientColors():d.default.getGradientColors(e.mri)}_renderStaticSurface(e){const t=this.props.mri?r.createElement(g.default,{ref:this._onFullScreenUserIcon,style:T.innerContainer,backgroundColorStyle:this.props.backgroundColorStyle,userMri:this.props.mri,iconOpacity:this.props.iconOpacity||0,backgroundOpacity:this.props.isCompact?0:1,isConnecting:this.props.isRinging,size:this.props.iconSize,animateChanges:this.props.animateIconChanges,gradientColors:this.state.gradientColors,showAudioParticipantBackground:this.props.showAudioParticipantBackground&&e,hideIcon:this.props.hideIcon}):void 0;return r.createElement(r.View,{style:T.innerContainer},t)}_resetLocalPreviewRenderer(e){if(this.props.isLocal||(e=null),this._localPreviewRendererPromise){const e=this._localPreviewRendererPromise.renderTarget;this._localPreviewRendererPromise.then((t=>{c.default.CallingStore.updateLocalPreviewRenderInfoForCall(this.props.callId,e,null),t.dispose()})),this._localPreviewRendererPromise=null}if(e){const t=e.getVideoContainer(),i=this.props.enableTransparentVideoStream?{scalingMode:s.ScalingMode.Crop,transparent:!0}:void 0;this._localPreviewRendererPromise=Object.assign(n.default.getStack().getDeviceManager().createPreviewRenderer(t,i),{renderTarget:t});const a=this._localPreviewRendererPromise;a.then((e=>{this._localPreviewRendererPromise===a&&(c.default.CallingStore.updateLocalPreviewRenderInfoForCall(this.props.callId,t,e),this.props.onTriggerScalingModeUpdate(this))}))}}_getVideoKey(e=!1){return this.props.endpointId&&this.props.streamType===s.StreamType.Video&&!this.props.isLocal?(e?b.mriOrId(this.props.renderKey):this.props.renderKey)+"_"+this.props.endpointId:e?b.mriOrId(this.props.renderKey):this.props.renderKey}static _generateComponentTag(e){return e.parentViewId?e.parentViewId+"#CallParticipantVideoView":"CallParticipantVideoView"}}t.default=v},37103:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallParticipantView=void 0;const a=i(67294),n=i(96486),o=i(38933),s=i(16778),r=i(48540),l=i(89391),c=i(75492),d=i(97079),u=i(78816),h=i(94224),p=i(68580),g=(i(15526),i(88717)),C=i(92831),m=i(54174),S=i(13805),y=i(9520),f=i(80200),_=i(71727),b=i(5531),T=i(62602),v=i(52262),w=i(46096),I=i(10117),P=i(36237),M=i(48638),k=i(15877),A=i(33754),R=i(30124),V=i(90244),L=i(14976),E=i(36150),B=i(4057),O=i(81760),D=i(11828),x=i(80837),N=i(24576),U=i(53374),F=i(39193),H=i(53514),z=(0,k.lazyProperties)({innerContainer:()=>x.default.absoluteFill,participantViewSpacing:()=>s.Styles.createViewStyle({margin:4}),participantViewSpacingTray:()=>s.Styles.createViewStyle({margin:2}),hiddenContainer:()=>s.Styles.createViewStyle({opacity:0}),ringingContainer:()=>s.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,alignItems:"center",justifyContent:"center",backgroundColor:O.Color.blackOverlay50}),backgroundActivityContainer:()=>s.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,alignItems:"center",justifyContent:"center",overflow:"visible"}),keyboardNavigatorPosition:()=>s.Styles.createViewStyle({bottom:0,left:0}),smallAccessory:()=>s.Styles.createViewStyle({position:"absolute",width:24,height:24,borderRadius:12,backgroundColor:O.Color.white,alignItems:"center",justifyContent:"center"}),smallAccessoryPosition:()=>s.Styles.createViewStyle({bottom:0,right:0}),smallAccessoryLocalVideo:()=>s.Styles.createViewStyle({backgroundColor:O.Color.transparent}),smallAccessoryLocalVideoPosition:()=>s.Styles.createViewStyle({bottom:-8,right:-8}),smallAccessoryInnerView:()=>s.Styles.createViewStyle({width:20,height:20,borderRadius:10,backgroundColor:O.Color.white,alignItems:"center",justifyContent:"center"}),smallAccessoryInnerScreenshareView:()=>s.Styles.createViewStyle({backgroundColor:O.Color.white}),smallAccessoryInnerLocalVideoView:()=>s.Styles.createViewStyle({backgroundColor:O.Color.white}),debugContainer:()=>s.Styles.createViewStyle({padding:10}),debugTextStyle:()=>s.Styles.createTextStyle({color:O.Color.greenIOS}),raiseHandInnerBorderStyle:()=>s.Styles.createViewStyle({borderColor:O.Color.raiseHandOrange,borderWidth:2}),activeTalkingInnerBorderStyle:()=>s.Styles.createViewStyle({borderColor:O.Color.black,borderWidth:2}),activeTalkingOuterBorderStyle:()=>s.Styles.createViewStyle({borderColor:O.Color.white,borderWidth:3}),activeTalkingInnerBorderStyleLightTheme:()=>s.Styles.createViewStyle({borderColor:O.Color.white}),activeTalkingOuterBorderStyleLightTheme:()=>s.Styles.createViewStyle({borderColor:O.Color.blue}),raisedHandOuterBorderStyle:()=>s.Styles.createViewStyle({borderColor:O.Color.raiseHandOrange,borderWidth:3}),nametagAndAccessoriesLine:()=>s.Styles.createViewStyle({position:"absolute",flexDirection:"row",justifyContent:"space-between",bottom:12,left:12,right:12,alignSelf:"stretch",flexBasis:0,flexGrow:1,overflow:"hidden",alignItems:"flex-end"}),nametagAndAccessoriesLineTray:()=>s.Styles.createViewStyle({bottom:10,left:10,right:10}),horizontalMultipleStreamsLayout:()=>s.Styles.createViewStyle({flexDirection:"row"}),gestureViewWrapper:()=>s.Styles.createViewStyle({flex:1})});class G extends N.default{constructor(){super(...arguments),this._callParticipantVideoViews={},this._containerId=0,this._isTalking=!1,this._animatedAccessoryOpacityValue=new s.Animated.Value(1),this._animatedAccessoryOpacityStyle=s.Styles.createAnimatedViewStyle({opacity:this._animatedAccessoryOpacityValue}),this._triggerScalingModeUpdate=e=>{if(this.isComponentMounted()&&this.props.onScalingModeChanged){const t=this.state.sizeToFit?r.ScalingMode.Fit:r.ScalingMode.Crop,i=this._extractMriForKey(this.props.renderKey);P.log(w.LogTraceArea.CallingUI,this._componentTag+"._triggerScalingModeUpdate: Scaling mode set for "+this._participantKeyForLogging()+" "+t);const a=n.isUndefined(this._lastKeyForScaling)||n.isUndefined(this._lastTypeForScaling)||n.isUndefined(this._lastModeForScaling),o=(null==e?void 0:e.getVideoElement())!==this._lastCallingVideoViewForScaling,s=this.state.streamType!==this._lastTypeForScaling,l=t!==this._lastModeForScaling,c=i!==this._lastKeyForScaling;(a||o||c||s||l)&&(this.props.onScalingModeChanged(i,this.state.streamType,t,null==e?void 0:e.getEndpointId()),this._lastKeyForScaling=i,this._lastTypeForScaling=this.state.streamType,this._lastModeForScaling=t,this._lastCallingVideoViewForScaling=null==e?void 0:e.getVideoElement())}},this._fetchRendererStats=n.throttle((()=>u.default.fetchRendererStats(this.props.callId,this.state.renderKey,this.state.streamType)),5e3),this._setKeyboardNavigatorRef=e=>{this._keyboardNavigatorRef=e||void 0},this._onDimensionsChanged=e=>{e!==this._renderedDimensions&&(this._renderedDimensions=e,this._updateSizeToFitV2())},this._onHiddenChanged=e=>{this.isComponentMounted()&&this.setState({hidden:e})},this._onCallParticipantTalkingView=e=>{this._callParticipantTalkingView=e||void 0},this._onCallParticipantVideoView=(e,t)=>{e?(this._callParticipantVideoViews[t]=e,e.props.renderScreenShare&&(this._screenShareVideoViewKey=t)):(delete this._callParticipantVideoViews[t],this._screenShareVideoViewKey===t&&(this._screenShareVideoViewKey=void 0))},this._toggleCropUncropVideo=e=>{this.isComponentMounted()&&this.setState({isSizeToFitExplicitlySet:!0},(()=>{P.log(w.LogTraceArea.CallingUI,this._componentTag+"._toggleCropUncropVideo isSizeToFitExplicitlySet="+this.state.isSizeToFitExplicitlySet),this._updateSizeToFitByConextMenuOption(e)}))},this._setSizeToFit=(e,t)=>{this.setState({sizeToFit:e},t)},this._onParticipantContextMenuFromKeyboard=()=>{const e=this._getCallParticipantContextMenuOptions();this.props.callId&&this.props.conversationMri&&this._keyboardNavigatorRef&&e&&T.default.measureLayoutRelativeToWindow((()=>this._keyboardNavigatorRef)).then((({x:t,y:i})=>g.default.showParticipantActionsContextMenuOnPosition({x:t,y:i},this._getRootViewId(),e,this.props.onCallParticipantContextMenuOpened,this.props.onCallParticipantContextMenuDismissed,this._toggleCropUncropVideo)))},this._onParticipantContextMenuHandler=e=>{if(this.props.callId&&this.props.conversationMri){const t=this._getCallParticipantContextMenuOptions();g.default.showParticipantActionsContextMenu(e,this._getRootViewId(),t,this.props.onCallParticipantContextMenuOpened,this.props.onCallParticipantContextMenuDismissed,this._toggleCropUncropVideo)}},this._onLocalVideoContextMenuFromKeyboard=()=>{const e=this._getCallLocalVideoContextMenuOptions();this.props.callId&&this.props.conversationMri&&this._keyboardNavigatorRef&&e&&T.default.measureLayoutRelativeToWindow((()=>this._keyboardNavigatorRef)).then((({x:t,y:i})=>g.default.showLocalVideoActionsContextMenuOnPosition({x:t,y:i},this._getRootViewId(),e,this._toggleCropUncropVideo)))},this._onLocalVideoContextMenuHandler=e=>{if(this.props.callId&&this.props.conversationMri){const t=this._getCallLocalVideoContextMenuOptions();t&&g.default.showLocalVideoActionsContextMenu(e,this._getRootViewId(),t,this._toggleCropUncropVideo)}},this._getContextMenuHandler=e=>e?this.state.isLocal?this._onLocalVideoContextMenuFromKeyboard:this._onParticipantContextMenuFromKeyboard:this.state.isLocal?this._onLocalVideoContextMenuHandler:this._onParticipantContextMenuHandler,this._renderOptionalNameTagLine=e=>{if(this._shouldShowOptionalNameTag(e))return s.createElement(H.default,{isCallStageV2:this.props.isCallStageV2,isPresenter:this.state.isPresenter,isInTray:this.props.isInTray,desktopNameTag:this.props.desktopNameTag,nametagPosition:this.props.nametagPosition,callId:this.props.callId,conversationMri:this.props.conversationMri,renderScreenShare:this.state.renderScreenShare,renderKey:this.state.renderKey,isLocal:!!this.state.isLocal,sizeToFit:this.state.sizeToFit,videoStatus:this.state.videoStatus,isOnHold:this.state.isOnHold,useLightTheme:this.props.useLightTheme,nametagOpacityStyle:this.props.nametagOpacityStyle,getDesktopAccessory:(e,t)=>this._getDesktopAccessory(e,t),onCallParticipantContextMenuOpened:this.props.onCallParticipantContextMenuOpened,onCallParticipantContextMenuDismissed:this.props.onCallParticipantContextMenuDismissed,toggleCropUncropVideo:this._toggleCropUncropVideo,hovering:this.state.hovering})}}static _generateComponentTag(e){return e.parentViewId?e.parentViewId+"#CallParticipantView":"CallParticipantView"}_buildState(e,t){const{autoLetterBoxThresholdRatioForNewStage:i,enableAudioParticipantsBackground:a,enableAudioParticipantsBackgroundInTray:n,enableExperimentalVideoRendering:o,enableMultipleStreamSupport:s,enableScreenShareZoom:d,enableTransparentVideoStream:u,modernCallStage:p}=l.default.getS4LCMCFeatures();let g,C=e.renderInfo;e.callId&&!e.renderInfo&&(C=h.default.CallParticipantStore.getParticipantRenderInfo(e.renderKey,e.callId));const m=(null==C?void 0:C.mri)||this._extractMriForKey(e.renderKey,!1),S=(null==C?void 0:C.isLocal)||e.renderKey===f.CallStageElementKeys.localUserKey;S?g=A.getString("DisplayInfoStore.ListMyName"):(g=v.default.getDisplayName(m),(null==C?void 0:C.renderScreenShare)&&(g=A.getString("CallPanel.CallParticipantScreenshareLabel",{displayName:g||""})));const y=S?h.default.DeviceStore.getSelectedCamera():void 0,b=r.CameraPosition.Unknown,T=(null==C?void 0:C.renderScreenShare)?r.StreamType.ScreenSharing:r.StreamType.Video,I=_.CallUIUtils.isFullScreenBot(m),k=e.isFullscreenBotCall||(null==C?void 0:C.renderScreenShare)||(null==C?void 0:C.streamsStatus)===f.CallParticipantStreamsStatus.Multiple||I,V=d&&(null==C?void 0:C.isAScreensharing)&&!0,L=e.isCallStageV2&&a,B=L&&n,O=e.isInTray?B:L;let D=Object.assign(Object.assign({zoomEnabled:k||e.enableVideoGestures,isScreenShareZoomEnabled:V,isMobileScreenReaderEnabled:E.default.isMobileScreenReaderEnabled(),isNavigatingWithKeyboard:M.default.isNavigatingWithKeyboard(),isUsingStackNavigationContext:R.default.isUsingStackNavigationContext(),hideNameTag:e.hideNameTag||h.default.CallControlsStore.isSettingsPopupVisible()||I,displayName:g,camera:y,cameraPosition:b,showControls:e.allowCameraFlip?c.default.areCallControlsVisible():void 0,streamType:T,metricEnabled:!1,rendererMetrics:void 0,experimentalVideo:o&&e.experimentalVideo,enableTransparentVideoStream:!!e.isCallStageV2&&u,enableMultipleStreamSupport:s,autoLetterBoxThresholdRatio:e.isCallStageV2?i:p.autoLetterBoxThresholdRatio,isFullScreenBot:I},C),{renderKey:e.renderKey,mri:m,isLocal:S,forceSizeToFit:k,showAudioParticipantBackground:O});return t?(D.sizeToFit=D.zoomEnabled,D.isSizeToFitExplicitlySet=!1,D.hidden=e.layoutController(e.renderKey,!!(null==C?void 0:C.renderScreenShare),null==C?void 0:C.videoStatus).isHidden(),D.applyGestureButtonInsets=!1,this._componentTag=G._generateComponentTag(e)):(null==C?void 0:C.videoDimensions)?(null==C?void 0:C.videoDimensions)&&(null==C?void 0:C.videoDimensions.width)||(D.sizeToFit=D.zoomEnabled&&this._sizeToFit(e,D.zoomEnabled)):D.sizeToFit=D.zoomEnabled&&this.state.sizeToFit,(t||e.isCompact||e.isDragging)&&(P.log(w.LogTraceArea.CallingUI,"## setting hovering to false"),D.hovering=!1),D.localPreviewAndroidV2=h.default.CallingStore.isLocalPreviewAndroidV2Enabled(),D}componentDidMount(){super.componentDidMount();const e=U.default.newCauseId();P.log(w.LogTraceArea.CallingUI,this._componentTag+".componentDidMount: Video status updated for "+this._participantKeyForLogging()+" "+f.VideoStatus[this.state.videoStatus||f.VideoStatus.None]+" causeId: "+e),this._updateBadgeOpacity();const t=this._layoutController();t.onDimensionsChanged&&t.onDimensionsChanged(this._onDimensionsChanged),t.onHiddenChanged&&t.onHiddenChanged(this._onHiddenChanged),this.props.enableFloatableResizableVideoPreview&&t.setViewCanAnimateState&&t.setViewCanAnimateState(this,!0)}componentWillUnmount(){super.componentWillUnmount();const e=this._layoutController();e.onDimensionsChanged&&e.onDimensionsChanged(void 0),e.onHiddenChanged&&e.onHiddenChanged(void 0),this.props.enableFloatableResizableVideoPreview&&e.setViewCanAnimateState&&e.setViewCanAnimateState(this,!1),P.log(w.LogTraceArea.CallingUI,this._componentTag+".componentWillUnmount "+this._participantKeyForLogging())}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i);const a=U.default.newCauseId();t.isLocal||t.videoStatus!==f.VideoStatus.Available||this.state.videoStatus!==f.VideoStatus.Streaming||this._containerId++,n.each(this._callParticipantVideoViews,(i=>{var n;e.callId&&e.conversationMri&&this.state.videoStatus!==t.videoStatus&&(P.log(w.LogTraceArea.CallingUI,this._componentTag+".UNSAFE_componentWillUpdate: VideoStatus from "+this.state.videoStatus+" to "+t.videoStatus+" causeId: "+a),h.default.RemoteStreamHelper.logStreamAndRendererStatus(e.callId,e.conversationMri,this.state.streamType,null===(n=i.getVideoElement())||void 0===n?void 0:n.getVideoContainer(),a))}));if(e.onScalingModeChanged&&t.sizeToFit!==this.state.sizeToFit){const i=t.sizeToFit?r.ScalingMode.Fit:r.ScalingMode.Crop,n=t.renderScreenShare?r.StreamType.ScreenSharing:r.StreamType.Video,o=this._extractMriForKey(e.renderKey);P.log(w.LogTraceArea.CallingUI,this._componentTag+".UNSAFE_componentWillUpdate: Scaling mode changed for "+this._participantKeyForLogging()+" "+i+" causeId: "+a),e.onScalingModeChanged(o,n,i),this._lastKeyForScaling=o,this._lastTypeForScaling=n,this._lastModeForScaling=i}if(this.props.enableFloatableResizableVideoPreview&&t.hidden!==this.state.hidden&&t.hidden){const e=this._layoutController();e.setViewCanAnimateState&&e.setViewCanAnimateState(this,!1)}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=U.default.newCauseId(),n=this._participantKeyForLogging();P.log(w.LogTraceArea.CallingUI,this._componentTag+".componentDidUpdate "+n+"  causeId: "+a),(this.props.isCompact!==e.isCompact||this.props.allowCameraFlip&&this.state.showControls!==t.showControls)&&this._updateBadgeOpacity(!0);if(this._updateTalkingView(),(this.state.videoStatus!==f.VideoStatus.None&&t.videoStatus===f.VideoStatus.None||this.state.videoDimensions&&t.videoDimensions&&this.state.videoDimensions.width!==t.videoDimensions.width)&&(this.state.isSizeToFitExplicitlySet?this.setState({isSizeToFitExplicitlySet:!1}):this._updateSizeToFitV2()),this.props.enableFloatableResizableVideoPreview&&t.hidden&&!this.state.hidden){const e=this._layoutController();e.setViewCanAnimateState&&e.setViewCanAnimateState(this,!0)}}updateTalking(e){this._isTalking!==e&&(this._isTalking=e,this._updateTalkingView())}_updateTalkingView(){this.props.isCompact&&this._callParticipantTalkingView&&this._callParticipantTalkingView.updateTalking(this._isTalking),n.each(this._callParticipantVideoViews,(e=>e.updateTalkingView(this._isTalking)))}_updateBadgeOpacity(e=!1){const t=this._currentBadgeOpacity();e&&t>0?s.Animated.timing(this._animatedAccessoryOpacityValue,{toValue:t,duration:250,delay:250,easing:s.Animated.Easing.InOut()}).start((e=>{e.finished||t===this._currentBadgeOpacity()&&this._animatedAccessoryOpacityValue.setValue(t)})):this._animatedAccessoryOpacityValue.setValue(t)}_currentBadgeOpacity(){let e;return e=this.props.isCompact?this.props.allowCameraFlip&&this.state.showControls?0:1:0,e}getVideoElement(e){var t,i;return!e&&n.size(this._callParticipantVideoViews)>0||!this.state.enableMultipleStreamSupport?null===(t=n.first(n.values(this._callParticipantVideoViews)))||void 0===t?void 0:t.getVideoElement():e?null===(i=this._callParticipantVideoViews[e])||void 0===i?void 0:i.getVideoElement():void 0}_getScreenShareVideoElement(){var e;return this._screenShareVideoViewKey&&(null===(e=this._callParticipantVideoViews[this._screenShareVideoViewKey])||void 0===e?void 0:e.getVideoElement())||null}_participantKeyForLogging(){return this._extractMriForKey(this.props.renderKey,!0)}_extractMriForKey(e,t=!1){return p.default.extractMriFromKey(e,t)}_renderContentView(){const e=this.state.videoStatus!==f.VideoStatus.None?"video_":"icon_",t=this.state.renderKey,i=e+this._participantKeyForLogging();P.log(w.LogTraceArea.CallingUI,this._componentTag+"._renderContentView key:"+i+" videoStatus: "+f.VideoStatus[this.state.videoStatus||f.VideoStatus.None]+" shouldWaitforVideoSize: "+this.props.shouldWaitForVideoSize+" videoDimensions:"+B.default.asString(this.state.videoDimensions));const a=this.state.enableMultipleStreamSupport&&this.state.streamsStatus===f.CallParticipantStreamsStatus.Multiple;let n=!1;const r=[],l=this.state.streams||[];!this.state.isFullScreenBot&&this.state.enableMultipleStreamSupport&&void 0!==this.state.streams?this.state.streamsStatus===f.CallParticipantStreamsStatus.None?r.push(this._renderVideoView(t,{videoStatus:f.VideoStatus.None,videoDimensions:_.DummyVideoSize})):l.forEach((e=>{l.length>1&&e.videoStatus===f.VideoStatus.None||(_.CallUIUtils.isPortraitVideo(e.videoDimensions)&&(n=!0),r.push(this._renderVideoView(t,e,a?0:void 0)))})):r.push(this._renderVideoView(t,{videoStatus:this.state.videoStatus,videoDimensions:this.state.videoDimensions}));const c=[z.innerContainer,this._getOptionalRaisedHandStyles(),a?this._getOptionalMultipleStreamsStylesForCompactView():void 0,n?z.horizontalMultipleStreamsLayout:void 0,this.props.borderRadius&&s.Styles.createViewStyle({borderRadius:this.props.borderRadius},!1)];let d,u=s.createElement(s.View,{key:"contentcontainer"+this._containerId,style:c},r);if(this.state.isRinging&&this.props.isCompact){const e=[z.ringingContainer,s.Styles.createViewStyle({borderRadius:this.props.videoBorderRadius},!1)];d=s.createElement(s.View,{style:e},s.createElement(I.default,{icon:D.SkypeIcon.CallAnimSmall4,color:O.Color.white,size:D.IconSize.size20}))}const h=this.state.isLocal&&this.state.videoStatus===f.VideoStatus.Streaming,p=h||this.state.renderScreenShare,g=!this.props.isCompact||this.props.suppressTalkingRing||this.props.isPstnTranslationEnabled?void 0:s.createElement(s.View,{style:z.backgroundActivityContainer},s.createElement(m.default,{ref:this._onCallParticipantTalkingView,size:this.props.iconSize,useRoundedRect:p,isVideo:h})),S=this._layoutController().getInnerStyles();S&&(u=s.createElement(s.Animated.View,{style:S},u));const y=s.createElement(C.default,{ignorePointerEvents:!0,participantMri:this.state.renderKey,borderRadius:this.props.videoBorderRadius,isCompact:!!this.props.isCompact,useMobileReactionsLayout:!!this.props.useMobileReactionsLayout,getCallReactionsDisplayHelper:this.props.getCallReactionsDisplayHelper});let b;if(this.props.allowCameraFlip){const e=s.Styles.createViewStyle({borderRadius:this.props.videoBorderRadius},!1);b=s.createElement(o.GradientView,{style:[x.default.overflowVisible,z.innerContainer,e],direction:o.GradientDirection.TOP_RIGHT,colors:[O.Color.blackOverlay50,O.Color.transparent]})}return s.createElement(s.View,{style:[z.innerContainer,this._getNewCallStageParticipantSpacing(),x.default.overflowVisible]},g,u,this._getActivityIndicationView(),y,d,b)}_getOptionalRaisedHandStyles(){const e=this.props.isCallStageV2||!this.state.isHandRaised||this.state.renderScreenShare?void 0:[z.raiseHandInnerBorderStyle];return this.props.isCompact&&e&&e.push(s.Styles.createViewStyle({borderRadius:this.props.videoBorderRadius},!1)),e}_getOptionalMultipleStreamsStylesForCompactView(){return this.props.isCompact?s.Styles.createViewStyle({borderRadius:this.props.videoBorderRadius,overflow:"hidden"},!1):void 0}_getNewCallStageParticipantSpacing(){if(this.props.isCallStageV2&&this.props.isGroupCall)return this.props.isInTray?z.participantViewSpacingTray:z.participantViewSpacing}_getActivityIndicationView(){const e=this.props.borderRadius&&s.Styles.createViewStyle({borderRadius:this.props.borderRadius},!1),t=this._isRaisedHandNewCallStageUI(),i=this._isActiveTalkingNewCallStageUI();if(!t&&!i)return;const a=[z.backgroundActivityContainer,z.activeTalkingInnerBorderStyle,e],n=[z.backgroundActivityContainer,z.activeTalkingOuterBorderStyle,e];return this.props.useLightTheme&&(a.push(z.activeTalkingInnerBorderStyleLightTheme),n.push(z.activeTalkingOuterBorderStyleLightTheme)),t&&(n.push(z.raisedHandOuterBorderStyle),a.push(z.raiseHandInnerBorderStyle)),t&&i&&n.push(z.activeTalkingOuterBorderStyle),s.createElement(s.View,{style:n},s.createElement(s.View,{style:a}))}_renderVideoView(e,t,i){var a;const o=t.endpointId||e,r=this.props.layoutController(e);let l=!this.props.isPstnTranslationEnabled&&this.state.showAudioParticipantBackground,c=this.props.isPstnTranslationEnabled;return s.createElement(d.default,{key:o,ref:e=>this._onCallParticipantVideoView(e,o),renderKey:e,mri:this.state.mri,videoStatus:t.videoStatus,videoDimensions:t.videoDimensions,isRinging:this.state.isRinging,renderScreenShare:this.state.renderScreenShare,parentViewId:this._componentTag,videoBorderRadius:n.isUndefined(i)?this.props.videoBorderRadius:i,isCompact:this.props.isCompact,iconOpacity:this.props.iconOpacity,animateIconChanges:this.props.animateIconChanges,experimentalVideo:!!this.props.experimentalVideo,useDarkBackground:this.props.useDarkBackground,isCallStageV2:this.props.isCallStageV2,iconSize:this.props.iconSize,isLocal:o===f.CallStageElementKeys.localUserKey,useLightTheme:this.props.useLightTheme,showAudioParticipantBackground:l,backgroundColorStyle:r.getBackgroundColorStyle(this.props.useLightTheme),videoBorderColorStyle:null===(a=r.getVideoBorderColorStyle)||void 0===a?void 0:a.call(r,this.props.useLightTheme),enableTransparentVideoStream:this.state.enableTransparentVideoStream,localPreviewAndroidV2:!!this.state.localPreviewAndroidV2,onTriggerScalingModeUpdate:this._triggerScalingModeUpdate,onUpdateElementLink:this.props.onUpdateElementLink,onCallingVideoView:this.props.onCallingVideoView,shouldWaitForVideoSize:!!this.props.shouldWaitForVideoSize,streamType:this.state.streamType,callId:this.props.callId,endpointId:t.endpointId,hideIcon:c})}_isActiveTalkingNewCallStageUI(){return this.props.isCallStageV2&&this.props.isGroupCall&&this.state.isTalking&&!this.state.isAScreensharing}_isRaisedHandNewCallStageUI(){return this.props.isCallStageV2&&this.state.isHandRaised&&!this.state.isAScreensharing}_isPresenterScreenSharing(){return Boolean(this.state.isAScreensharing||this.state.isPresenter)}_hasToShowKeyboardNavigator(){return this.state.isNavigatingWithKeyboard&&!(this.state.isLocal&&this.props.isScreenSharing)}_renderAccessoryView(){if(!this.state.renderScreenShare&&(this.state.isMuted||this.state.isOnHold||this.state.isAScreensharing||this.state.isPresenter||this.state.isNavigatingWithKeyboard)&&this.props.isCompact){const e=this.state.isLocal&&this.state.videoStatus===f.VideoStatus.Streaming;let t;const i=[z.smallAccessoryInnerView];this.state.isOnHold?t=D.SkypeIcon.Pause:this.state.isMuted&&!this._showOptionalNameTagForMobile()?t=D.SkypeIcon.MicrophoneOff:this._isPresenterScreenSharing()&&(t=_.CallUIUtils.getShareScreenIcon(!0),i.push(z.smallAccessoryInnerScreenshareView)),e&&i.push(z.smallAccessoryInnerLocalVideoView);const n=[z.smallAccessory,z.smallAccessoryPosition,this._animatedAccessoryOpacityStyle];e&&(n.push(z.smallAccessoryLocalVideo),this.props.allowCameraFlip&&n.push(z.smallAccessoryLocalVideoPosition));const o=_.CallUIUtils.getUserOptionsAccessibilityLabel(this.state.displayName,this.state.isMuted,this.state.isHandRaised);return s.createElement(a.Fragment,null,this._hasToShowKeyboardNavigator()&&s.createElement(s.Button,{style:[z.smallAccessory,z.keyboardNavigatorPosition],onPress:this._getContextMenuHandler(!0),title:o,ref:this._setKeyboardNavigatorRef},"..."),t&&s.createElement(s.Animated.View,{style:n,ignorePointerEvents:!0},this._getDesktopAccessory(i,t)))}}_getDesktopAccessory(e,t){return s.createElement(s.View,{style:e},s.createElement(I.default,{icon:t,size:D.IconSize.size12,color:O.Color.gray400}))}_renderRaisedHandOnRibbonParticipant(){if(this.state.isHandRaised&&this.props.isCompact&&!this.state.renderScreenShare)return s.createElement(V.default,{type:V.RaiseHandImageType.SmallSizeTopLeftAligned})}_setHovering(e){this.isComponentMounted()&&this.state.hovering!==e&&this.setState({hovering:e})}_isLandscape(e){return e.width>=e.height}_sizeToFit(e,t){if(!this._renderedDimensions||!this.state.videoDimensions||!this.state.videoDimensions.width||this.state.renderScreenShare||e.isFullscreenBotCall||this.state.streamsStatus===f.CallParticipantStreamsStatus.Multiple)return t;const i=this._isLandscape(this._renderedDimensions),a=this._isLandscape(this.state.videoDimensions),n=i!==a;const o=this.state.videoDimensions.width/this.state.videoDimensions.height,s=Math.floor(this._renderedDimensions.height*o),r=this._renderedDimensions.width/s,l=Math.abs(1-r)>this.state.autoLetterBoxThresholdRatio,c=!a,d=c||n||l;return P.log(w.LogTraceArea.CallingUI,this._componentTag+" _sizeToFit::isPortrait="+c+" isDifferentOrientation="+n+" forceUncrop="+l+" resizingFactor="+r+" incoming video width="+this.state.videoDimensions.width+" container width="+this._renderedDimensions.width+" sizeToFitRet="+d),d}_canUpdateSizeToFit(){return!(!this.isComponentMounted()||this.state.videoStatus===f.VideoStatus.None||this.props.isFullscreenBotCall||this.state.isFullScreenBot)&&(!this.props.isCompact||(P.log(w.LogTraceArea.CallingUI,this._componentTag+"._canUpdateSizeToFit "+this._participantKeyForLogging()+" sizeToFit=false in ribbon view user="+L.mriOrId(this.state.renderKey)),this.setState({sizeToFit:!1}),!1))}_updateSizeToFitByConextMenuOption(e){this._canUpdateSizeToFit()&&!n.isUndefined(e)&&e!==this.state.sizeToFit&&this.state.isSizeToFitExplicitlySet&&(P.log(w.LogTraceArea.CallingUI,this._componentTag+"._updateSizeToFitByConextMenuOption sizeToFitSelected="+e+" user="+L.mriOrId(this.state.renderKey)),this.setState({sizeToFit:e},(()=>{this.props.callId&&h.default.OngoingCallService.setSizeToFitValue(this.props.callId,this.state.renderKey,e),e?P.track(new y.CanvasAndRibbonActionsEvent(y.CanvasAndRibbonActions.FullVideo)):P.track(new y.CanvasAndRibbonActionsEvent(y.CanvasAndRibbonActions.CropVideo))})))}_updateSizeToFitV2(){if(!this._canUpdateSizeToFit())return;let e;if(this.props.callId&&(e=h.default.OngoingCallService.getSizeToFitValue(this.props.callId,this.state.renderKey)),n.isUndefined(e)){const e=this.state.forceSizeToFit||this._sizeToFit(this.props,this.state.zoomEnabled);this.state.sizeToFit!==e&&(P.log(w.LogTraceArea.CallingUI,this._componentTag+"._updateSizeToFitV2 "+this._participantKeyForLogging()+" "+e+" user="+L.mriOrId(this.state.renderKey)),this.setState({sizeToFit:e,isSizeToFitExplicitlySet:!1}),this.props.callId&&h.default.OngoingCallService.setSizeToFitValue(this.props.callId,this.state.renderKey,void 0))}else P.log(w.LogTraceArea.CallingUI,this._componentTag+"._updateSizeToFitV2 sizeToFitPersistence="+e+" user="+L.mriOrId(this.state.renderKey)),this.setState({sizeToFit:e})}_updateSizeToFit(e){if(!this.isComponentMounted()||this.state.videoStatus===f.VideoStatus.None)return;if(this.props.isCompact)return P.log(w.LogTraceArea.CallingUI,this._componentTag+"._updateSizeToFit "+this._participantKeyForLogging()+" sizeToFit=false in ribbon view user="+L.mriOrId(this.state.renderKey)),void this.setState({sizeToFit:!1});if(!n.isUndefined(e)&&e!==this.state.sizeToFit&&this.state.isSizeToFitExplicitlySet)return P.log(w.LogTraceArea.CallingUI,this._componentTag+"._updateSizeToFit sizeToFitSelected="+e+" user="+L.mriOrId(this.state.renderKey)),void this.setState({sizeToFit:e},(()=>{this.props.callId&&h.default.OngoingCallService.setSizeToFitValue(this.props.callId,this.state.renderKey,e),e?P.track(new y.CanvasAndRibbonActionsEvent(y.CanvasAndRibbonActions.FullVideo)):P.track(new y.CanvasAndRibbonActionsEvent(y.CanvasAndRibbonActions.CropVideo))}));let t;if(this.props.callId&&(t=h.default.OngoingCallService.getSizeToFitValue(this.props.callId,this.state.renderKey)),!n.isUndefined(t))return P.log(w.LogTraceArea.CallingUI,this._componentTag+"._updateSizeToFit sizeToFitPersistence="+t+" user="+L.mriOrId(this.state.renderKey)),void this.setState({sizeToFit:t});const i=this.state.forceSizeToFit||this.state.zoomEnabled&&this._sizeToFit(this.props,this.state.zoomEnabled);this.state.sizeToFit!==i&&(P.log(w.LogTraceArea.CallingUI,this._componentTag+"._updateSizeToFit "+this._participantKeyForLogging()+" "+i+" user="+L.mriOrId(this.state.renderKey)),this.setState({sizeToFit:i,isSizeToFitExplicitlySet:!1}),this.props.callId&&h.default.OngoingCallService.setSizeToFitValue(this.props.callId,this.state.renderKey,void 0))}_layoutController(){return this.props.layoutController(this.state.renderKey,!!this.state.renderScreenShare,this.state.videoStatus)}_getOptionalBackgroundEffectInfo(){return s.createElement(S.default,{renderKey:this.props.renderKey,renderInfo:this.props.renderInfo,callId:this.props.callId,conversationMri:this.props.conversationMri,isCallStageV2:this.props.isCallStageV2,nametagOpacityStyle:this.props.nametagOpacityStyle,hideCaption:this.props.isCompact&&!this.props.isCallStageV2||this.state.streamsStatus===f.CallParticipantStreamsStatus.None,noExpand:(this.props.isCompact||this.props.isInTray)&&this.props.isCallStageV2,sizeToFit:this.state.sizeToFit,useLightTheme:this.props.useLightTheme,isInTray:this.props.isInTray,callParticipantView:this,layoutController:this.props.layoutController})}_isLocalMuteSupported(){return!!this.props.callId&&h.default.CallingStore.getLocalMuteSupported(this.props.callId)}_isServerMuteSupported(){let e;return this.props.callId&&(e=h.default.CallingStore.findRemoteCallMember(this.props.callId,this.state.renderKey)),!(!e||!this.props.callId)&&h.default.CallingStore.getServerMuteUnmuteSupportedForParticipant(this.props.callId,e)}_getCallParticipantContextMenuOptions(){var e,t;const i=this.state.renderKey,a=null!==(e=this.props.callId)&&void 0!==e?e:"";return{callId:a,conversationMri:null!==(t=this.props.conversationMri)&&void 0!==t?t:"",userMri:i,isLocal:this.state.isLocal,isGroupCall:!!this.props.isGroupCall,isLocalMuteSupported:this._isLocalMuteSupported(),isMuted:!!this.state.isMuted&&this.state.isMuted,isServerMutedSupported:this._isServerMuteSupported(),sizeToFit:this.state.sizeToFit,isCompact:!!this.props.isCompact,videoStatus:this.state.videoStatus||f.VideoStatus.None,displayName:void 0,isCropVideoEnabledOnGroupCall:!0,isCropVideoEnabledOn1On1Call:!0,showCropUncropMenuOption:!1,showMute:!1,showMuteEveryone:!1,isMuteOptionDisabled:!1,showRemoveCall:!1,showSendMessageMenuOption:b.default.call().canSendMessageToParticipant&&!this.props.showChangeTogetherModeBackgroundOption,showCropVideoOption:!1,showFullVideoOption:!1,showViewProfile:b.default.navigation().canAccessUserDetails&&!this.props.showChangeTogetherModeBackgroundOption,showLowerHandOption:!!this.state.isHandRaised,showChangeTogetherModeBackgroundOption:!!this.props.showChangeTogetherModeBackgroundOption,showPinOption:_.CallUIUtils.shouldShowCallParticipantPinOption(i,a),showUnpinOption:_.CallUIUtils.shouldShowCallParticipantUnpinOption(i,a)}}_getCallLocalVideoContextMenuOptions(){if(this.props.callId&&this.props.conversationMri)return g.default.getCallLocalVideoContextMenuOptions(this.props.callId,this.props.conversationMri,!!this.props.isCompact,this.state.videoStatus||f.VideoStatus.None,this.state.sizeToFit,!!this.state.isHandRaised)}_showOptionalNameTagForDesktop(){return!this.props.isCompact&&!this.state.hideNameTag&&!this.props.isPstnTranslationEnabled}_showOptionalNameTagForMobile(){return!1}_renderDebugInfo(){var e,t,i,a,n;if(this.state.metricEnabled&&void 0!==this.state.rendererMetrics)return s.createElement(s.View,{style:[x.default.absoluteFill,z.debugContainer]},s.createElement(s.Text,{style:z.debugTextStyle},"FrameType: ",null===(e=this.state.rendererMetrics)||void 0===e?void 0:e.frameType),s.createElement(s.Text,{style:z.debugTextStyle},"RendererType: ",null===(t=this.state.rendererMetrics)||void 0===t?void 0:t.rendererType),s.createElement(s.Text,{style:z.debugTextStyle},"StreamSize: ",null===(i=this.state.rendererMetrics)||void 0===i?void 0:i.streamSize),s.createElement(s.Text,{style:z.debugTextStyle},"FramesDropped: ",null===(a=this.state.rendererMetrics)||void 0===a?void 0:a.framesDropped),s.createElement(s.Text,{style:z.debugTextStyle},"FramesTotal: ",null===(n=this.state.rendererMetrics)||void 0===n?void 0:n.framesTotal))}_shouldShowOptionalNameTag(e){return!!(this._showOptionalNameTagForDesktop()||(n.isUndefined(e)||this.state.isHandRaised&&!this.props.isCompact)&&this._showOptionalNameTagForMobile())}render(){if(this.state.hidden)return null;const e=this._renderAccessoryView(),t=this._renderRaisedHandOnRibbonParticipant(),i=!this.props.isCompact&&!this.props.isDragging,a=[this.props.style,this._layoutController().getStyles(i)];return this.props.isCompact&&this.props.ribbonOpacityStyle&&a.push(this.props.ribbonOpacityStyle),s.createElement(s.Animated.View,{style:a,onMouseEnter:this.props.isCallStageV2?()=>{this._setHovering(!0)}:void 0,onMouseLeave:this.props.isCallStageV2?()=>{this._setHovering(!1)}:void 0},this._renderCallParticipantGestureView(e,t),void 0,void 0,this._renderDebugInfo())}_renderCallParticipantGestureView(e,t){const i=this._renderContentView(),a=this._getOptionalBackgroundEffectInfo();return s.createElement(F.default,{isCompact:this.props.isCompact,enableFloatableResizableVideoPreview:this.props.enableFloatableResizableVideoPreview,enableActionMenuOnMobile:!1,isLocal:this.state.isLocal,videoStatus:this.state.videoStatus,videoBorderRadius:this.props.videoBorderRadius,camera:this.state.camera,allowCameraFlip:this.props.allowCameraFlip,isDragging:this.props.isDragging,renderKey:this.state.renderKey,isCallStageV2:this.props.isCallStageV2,showContextMenu:this.props.showContextMenu,callId:this.props.callId,parentViewId:this._componentTag,displayName:this.state.displayName,isLargeGridBot:this.state.isLargeGridBot,isAScreensharing:this.state.isAScreensharing,isTogetherModeBot:this.state.isTogetherModeBot,showChangeTogetherModeBackgroundOption:this.props.showChangeTogetherModeBackgroundOption,showControls:this.state.showControls,enableVideoGestures:this.props.enableVideoGestures,isNavigatingWithKeyboard:this.state.isNavigatingWithKeyboard,isMobileScreenReaderEnabled:this.state.isMobileScreenReaderEnabled,zoomEnabled:this.state.zoomEnabled,isScreenShareZoomEnabled:this.state.isScreenShareZoomEnabled,sizeToFit:this.state.sizeToFit,onTap:this.props.onTap,onPan:this.props.onPan,onMouseOverOrOut:this.props.onMouseOverOrOut,onPressInOrOut:this.props.onPressInOrOut,onResize:this.props.onResize,setHovering:e=>this._setHovering(e),getContextMenuHandler:this._getContextMenuHandler,getLayoutController:()=>this._layoutController(),setSizeToFit:this._setSizeToFit,getScreenShareVideoElement:()=>this._getScreenShareVideoElement(),getCallParticipantVideoViews:()=>this._callParticipantVideoViews,optionalNameTagLine:this._renderOptionalNameTagLine(e),accessoryView:e,contentView:i,optionalRaiseHandAccessory:t,optionalBackgroundInfo:a})}}t.CallParticipantView=G,t.default=G},45092:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.maybePresentCallPreviewPanel=t.HandOffCommand=void 0;const a=i(16778),n=i(96486),o=i(31844),s=i(2604),r=i(48540),l=i(97691),c=i(15069),d=i(94224),u=i(36699),h=i(57538),p=i(67930),g=i(81110),C=i(87720),m=i(13944),S=i(22222),y=i(19675),f=i(42961),_=i(80837),b=i(14976),T=i(99401),v=i(72490),w=i(18078),I=i(4735),P=i(9520),M=i(70665),k=i(64956),A=i(81115),R=i(11010),V=i(34528),L=i(89391),E=i(12187),B=i(78547),O=i(52262),D=i(78735),x=i(30124),N=i(81736),U=i(29130),F=i(51070),H=i(36237),z=i(33754),G=i(98278),W=i(46096),K=i(49603),j=i(81760),Q=i(11828),$=i(78262),q=i(2301),X=i(67977),Z=i(37490),J=i(15877),Y=(i(12770),i(53374)),ee=i(2278),te=i(71727),ie=i(46565),ae=i(80200),ne=i(60787),oe=i(73773);var se;!function(e){e.addDevice="addDevice",e.transferCall="transferCall"}(t.HandOffCommand||(t.HandOffCommand={})),function(e){e[e.None=0]="None",e[e.Join=1]="Join",e[e.TwinCamAvailable=2]="TwinCamAvailable",e[e.TwinCamConnected=3]="TwinCamConnected"}(se||(se={}));const re=(0,J.lazyProperties)({dialog:()=>a.Styles.createViewStyle({flex:1,overflow:"visible"}),videoShadow:()=>a.Styles.createViewStyle({backgroundColor:j.Color.blackOverlay20}),dialogHeaderContainer:()=>a.Styles.createViewStyle({flexDirection:"row",justifyContent:"space-between"}),controlsWrapper:()=>a.Styles.createViewStyle({flexDirection:"column",overflow:"visible",flex:1,justifyContent:"flex-end"}),previewControl:()=>a.Styles.createViewStyle({alignItems:"center",alignSelf:"center",paddingVertical:20}),previewControlOnMobile:()=>a.Styles.createViewStyle({maxWidth:300,marginBottom:10}),previewControlOnMobileLandscape:()=>a.Styles.createViewStyle({maxWidth:500,marginBottom:10}),previewControlLandscape:()=>a.Styles.createViewStyle({paddingVertical:10}),iconTogglesContainer:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"space-between"}),iconStyle:()=>a.Styles.createViewStyle({marginRight:20}),accessibleToggleSwitchStyle:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",minHeight:40}),convIcon:()=>a.Styles.createTextStyle({alignItems:"center",justifyContent:"center",backgroundColor:j.Color.black}),cameraControlContainer:()=>a.Styles.createViewStyle({paddingRight:10}),previewCameraControlSmallScreen:()=>a.Styles.createViewStyle({bottom:100}),newCameraControlContainer:()=>a.Styles.createViewStyle({position:"absolute",bottom:0,left:0,paddingLeft:15,paddingBottom:10}),cameraPickerTopRightCornerNonModal:()=>a.Styles.createViewStyle({minHeight:void 0,marginTop:8}),closeButton:()=>a.Styles.createViewStyle({justifyContent:"center",height:50,paddingLeft:15,paddingRight:15}),conversationHeader:()=>a.Styles.createViewStyle({flex:1,backgroundColor:"transparent"}),conversationTitle:()=>a.Styles.createTextStyle({color:j.Color.white,font:R.default.font.uiDisplayBold,fontSize:R.default.controlFontSize.messagingHeaderSmall,flexShrink:1}),conversationTitleMargin:()=>a.Styles.createTextStyle({marginRight:15}),conversationSubtitle:()=>a.Styles.createTextStyle({color:j.Color.white,flexShrink:1,lineHeight:25,height:25}),cameraToggleButton:()=>a.Styles.createViewStyle({paddingHorizontal:15}),footer:()=>a.Styles.createViewStyle({height:60,alignSelf:"stretch"}),footerLandscape:()=>a.Styles.createViewStyle({height:70,alignSelf:"stretch"}),wideFooter:()=>a.Styles.createViewStyle({height:120,alignSelf:"stretch"}),footerWideLandscape:()=>a.Styles.createViewStyle({height:70,alignSelf:"stretch",flexDirection:"row",justifyContent:"center"}),wideButtonStyle:()=>a.Styles.createViewStyle({margin:10}),mediumButtonStyle:()=>a.Styles.createViewStyle({paddingLeft:65,paddingRight:65,margin:10}),toggleText:()=>a.Styles.createTextStyle({color:j.Color.white,paddingRight:10,backgroundColor:"transparent"}),blurToggleStyleOnDesktop:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",position:"absolute",bottom:0,right:0,paddingRight:15,paddingBottom:10}),blurToggleStyleOnSmallWindow:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",paddingBottom:10}),settingsButtonStyleOnDesktop:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",position:"absolute",top:0,right:0,paddingRight:15}),videoCanvasWrapper:()=>a.Styles.createViewStyle({backgroundColor:j.Color.black}),videoBorderRadius:()=>a.Styles.createViewStyle({borderRadius:10}),pickersUnderVideoCanvas:()=>a.Styles.createViewStyle({bottom:-60}),videoBoxShadow:()=>a.Styles.createViewStyle({shadowColor:j.Color.blackOverlay40,shadowOffset:{width:0,height:2},shadowOpacity:.8,shadowRadius:10}),cameraAndMicrophoneDetails:()=>a.Styles.createTextStyle({color:j.Color.white,fontSize:12,backgroundColor:"transparent",marginBottom:12}),backgroundReplacementButtonStyles:()=>a.Styles.createViewStyle({marginVertical:8}),backgroundReplacementButtonLabelStyles:()=>a.Styles.createTextStyle({color:j.Color.white,paddingLeft:5}),iconTogglesModernContainer:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"space-between",marginBottom:32}),iconTogglesModernContainerLandscape:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"space-between",marginBottom:32,marginLeft:100,marginRight:100}),emptyView:()=>a.Styles.createViewStyle({height:0})});t.maybePresentCallPreviewPanel=function(e,t){Y.default.newCauseId();const i=()=>I.default.navigateToCallPreviewViewModal({callOrigin:e.callOrigin,conversationMri:e.conversationMri,activeCallId:e.activeCallId,isGoLive:e.isGoLive,isTwinCam:e.isTwinCam,skipPermissionPanel:e.skipPermissionPanel},Y.default.newCauseId());L.default.getS4LCMCFeatures().enableCallPreviewPermissionOnLoad?d.default.CallPermissionsUtils.checkPermissionBrowserAndContinue(i,i,e.conversationMri):i()};class le extends p.default{constructor(){super(...arguments),this._isCameraChanged=!1,this._isStartOrJoinCallBtnPressed=!1,this._wasToggleBackgroundBlurChanged=!1,this._wasToggleCameraChanged=!1,this._wasToggleMicrophoneChanged=!1,this._wasTwinCamEnabled=!1,this._maybeCloseModal=(e=!1)=>{if(!this.props.isModal&&!e)return;const t=Y.default.newCauseId();H.log(W.LogTraceArea.CallingUI,"CallPreview _closeModal, causeId: "+t),x.default.isUsingStackNavigationContextNoSubscription()?I.default.goBack(t,this._getContext()):I.default.closeGenericDesktopModal(t,this._getRootViewId())},this._onLocalVideoPreviewRef=e=>{this.props.onVideoRenderingChange&&this.props.onVideoRenderingChange(!!e)},this._isLightAccessibleThemeUnderCamera=()=>this.props.displayControlsUnderVideoCanvas&&this._useAccessibleTheme()&&!this._useDarkTheme(),this._renderIconButtonWithSubtitle=(e,t,i,n,o)=>{let s=re.backgroundReplacementButtonLabelStyles,r=j.Color.white,l=j.Color.whiteOverlay70;this._isLightAccessibleThemeUnderCamera()&&(r=h.MeetNowColors.getButtonColors(!0).backgroundColor,l=j.Color.blackOverlay70,s=h.MeetNowStyle.getStyle(!0).background);const c=a.createElement(y.Subtitle,{numberOfLines:1,style:s},t);return a.createElement(m.default,{icon:n,size:Q.IconSize.size24,title:i,color:r,hoverColor:l,onPress:o,style:[...e,re.backgroundReplacementButtonStyles],accessoryView:c})},this._renderBackgroundReplacementButton=e=>this._renderIconButtonWithSubtitle(e,z.getString("AudioVideoSettings.CameraBackgroundReplacementLabel"),z.getString("AudioVideoSettings.CameraBackgroundReplacementLabel"),Q.SkypeIcon.BackgroundReplacement,this._showAVSettings),this._renderAvSettingsButton=e=>this._renderIconButtonWithSubtitle(e,z.getString("AudioVideoSettings.Title"),z.getString("AudioVideoSettings.Title"),Q.SkypeIcon.Settings,this._showAVSettings),this._switchCameraButtonPressed=()=>{this.isComponentMounted()&&this._updateVideoSource()},this._updateVideoSource=()=>{const e=Y.default.newCauseId(),t=this.state.selectedCamera,i=n.find(this.state.cameras,(e=>e.id!==(null==t?void 0:t.id)&&e.position!==(null==t?void 0:t.position)));i?(d.default.DeviceStore.choosePreferredDevices({camera:i.id},e),H.log(W.LogTraceArea.CallingUI,"CallPreview _updateVideoSource "+t+" -> "+i+" causeId: "+e),this._isCameraChanged=!0):H.error(W.LogTraceArea.CallingUI,"CallPreview _updateVideoSource new camera not found causeId: "+e)},this._closeButtonPressed=()=>{this.props.conversationMri&&!this.props.isTwinCam&&u.default.trackLobbyClosed(this.props.conversationMri),H.log(W.LogTraceArea.CallingUI,"CallPreview closeButtonPressed"),this._maybeCloseModal()},this._onCameraSelected=e=>{var t,i;const a=Y.default.newCauseId();H.log(W.LogTraceArea.CallingUI,"CallPreview _onCameraSelected "+e+"current deviceId"+(null===(t=this.state.selectedCamera)||void 0===t?void 0:t.id)+" causeId: "+a),e!==(null===(i=this.state.selectedCamera)||void 0===i?void 0:i.id)&&(d.default.DeviceStore.choosePreferredDevices({camera:e},a),this._isCameraChanged=!0)},this.onStartOrJoinCall=e=>{var t;const i=Y.default.newCauseId();if(H.log(W.LogTraceArea.CallingUI,"CallPreview.onStartOrJoinCall activeCallId: "+this.props.activeCallId+" conversationMri: "+this.props.conversationMri+" isMicrophoneOn: "+this.state.isMicrophoneOn+" isCameraOn: "+this.state.isCameraOn+" transferCall: "+e+" activeEndpoints: "+this.state.activeUserEndpoints+" causeId: "+i),D.default.setCallPreviewSettings(this.state.isMicrophoneOn,this.state.isCameraOn,this.state.isBackgroundBlurred),this.props.conversationMri){this.props.hideActionButton||u.default.trackStartOrJoinMeetNowButtonClicked(this.props.conversationMri);let a=this.state.isMicrophoneOn?void 0:r.MuteFlags.MuteMicrophone;const n={conversationMri:this.props.conversationMri,withVideo:this.state.isCameraOn,origin:this.props.callOrigin,callId:this._getCallId(),muteFlag:a,isCameraSelected:this.state.isCameraOn&&!!(null===(t=this.state.selectedCamera)||void 0===t?void 0:t.id),permissionsAlreadyChecked:this.state.shouldAskPermissionOnLoad||this.props.permissionAlreadyAsked};if(!this.state.isProtocolLaunchCallPreview&&this.props.isGoLive||this.props.activeCallId)if(this.props.activeCallId){const t=!e&&this.state.screenMode===se.TwinCamAvailable;t&&(a=r.MuteFlags.MuteAll);const n={conversationMri:this.props.conversationMri,callId:this.props.activeCallId,withVideo:this.state.isCameraOn,origin:this.props.callOrigin,isGoLive:this.props.isGoLive,muteFlag:a,isCameraSelected:!0,transferCall:e,skipNavigation:t,isTwinCam:t,permissionsAlreadyChecked:this.state.shouldAskPermissionOnLoad||this.props.permissionAlreadyAsked};let o;if(d.default.ActiveCallUIHelper.getActiveCallId(this.props.conversationMri,t)===this.props.activeCallId){o=d.default.CallNavigationHelper.answerOrJoinCall(n,i);const e=this.state.isCameraOn?P.CallPreviewActions.JoinWithVideo:P.CallPreviewActions.JoinWithoutVideo;ee.default.trackCallPreview(e,this._isCameraChanged,!this.state.isMicrophoneOn,this.state.isBackgroundBlurred,this._getCallId())}else H.log(W.LogTraceArea.CallingUI,"CallPreview answerOrJoinCall call is already ended causeId: "+i),o=l.Rejected();o.then((()=>{this._wasTwinCamEnabled=t})),o.catch((()=>{n.isTwinCam||this._maybeCloseModal(!0)})),n.isTwinCam||this._maybeCloseModal(!0)}else d.default.CallNavigationHelper.startGoLiveCall(n,i),this.props.callOrigin===W.NavigationCallOrigin.MeetNow&&this._maybeCloseModal();else d.default.CallNavigationHelper.startCall(n,i),this.props.callOrigin!==W.NavigationCallOrigin.MeetNow&&this.props.callOrigin!==W.NavigationCallOrigin.DeepLink||this._maybeCloseModal()}else H.log(W.LogTraceArea.CallingUI,"CallPreview.onStartOrJoinCall stopped, conversationMri is undefined causeId: "+i);this._isStartOrJoinCallBtnPressed=!0},this.onEndCall=()=>{const e=Y.default.newCauseId(),t=this.props.activeCallId,i=this.props.conversationMri;t&&i&&d.default.CallingStore.endCall(t,e).then((()=>{var t,i;H.log(W.LogTraceArea.CallingUI,"CallPreview onEndCall call is ended causeId: "+e),this.props.isTwinCam?null===(i=(t=this.props).onTwinCamStopped)||void 0===i||i.call(t):this._updateCallState(e)}))},this._onCallEnded=e=>{e.isTwinCam&&!d.default.CallingStore.hasEndedCallLocally(e.callId)&&this._maybeCloseModal(!0)},this._focusOn=e=>{0},this._onToggleMic=(e,t)=>{const i=Y.default.newCauseId();if(H.log(W.LogTraceArea.CallingUI,"CallPreview._onToggleMic causeId: "+i),t)d.default.CallPermissionsUtils.requestPermissionStatus($.PermissionType.Microphone,i).then((e=>{if(e){const e=!0;this.setState({isMicrophoneOn:e},(()=>this._focusOn(this._microphoneToggleRef))),this._wasToggleMicrophoneChanged=!0,this.props.activeCallId&&this.state.callState===r.CallState.Connected?d.default.CallingStore.unmute(this.props.activeCallId,i):D.default.setCallPreviewMicSettings(e)}else H.log(W.LogTraceArea.CallingUI,"CallPreview._onToggleMic cannot obtain microphone permission current state: "+N.default.permissionStatus($.PermissionType.Microphone)+" causeId: "+i),k.default.showDeniedPromptWithSettingsOption($.PermissionType.Microphone,G.MainRootViewId)}));else{const e=!1;this.setState({isMicrophoneOn:e},(()=>this._focusOn(this._microphoneToggleRef))),this._wasToggleMicrophoneChanged=!0,this.props.activeCallId&&this.state.callState===r.CallState.Connected?d.default.CallingStore.mute(this.props.activeCallId,i):D.default.setCallPreviewMicSettings(e)}},this._onToggleVideo=(e,t)=>{var i,a;const n=Y.default.newCauseId();if(H.log(W.LogTraceArea.CallingUI,"CallPreview._onToggleVideo causeId: "+n),t)d.default.CallPermissionsUtils.requestPermissionStatus($.PermissionType.Camera,n).then((e=>{if(e){const e=!0;this.setState({isCameraOn:e},(()=>this._focusOn(this._cameraToggleRef))),this._wasToggleCameraChanged=!0,this.props.activeCallId&&this.state.callState===r.CallState.Connected?d.default.CallingStore.startVideo(this.props.activeCallId,n):D.default.setCallPreviewCameraSettings(e)}else H.log(W.LogTraceArea.CallingUI,"CallPreview._onToggleVideo cannot obtain camera permission current state: "+N.default.permissionStatus($.PermissionType.Camera)+" causeId: "+n),k.default.showDeniedPromptWithSettingsOption($.PermissionType.Camera,G.MainRootViewId)}));else if(this.isComponentMounted()){const e=!1;this.setState({isCameraOn:e},(()=>this._focusOn(this._cameraToggleRef))),this._wasToggleCameraChanged=!0,this.props.activeCallId&&this.state.callState===r.CallState.Connected?d.default.CallingStore.stopVideo(this.props.activeCallId,n):D.default.setCallPreviewCameraSettings(e)}null===(a=(i=this.props).onVideoStateChanged)||void 0===a||a.call(i,t)},this._onToggleBlur=(e,t)=>{const i=Y.default.newCauseId();this._wasToggleBackgroundBlurChanged=!0,H.log(W.LogTraceArea.CallingUI,"CallPreview blur toggle isBackgroundBlurred"+t+" activeCallId: "+this._getCallId()+" causeId: "+i),d.default.DeviceStore.setBackgroundBlurred(t),this.state.isCameraOn||this.state.isBackgroundBlurred?this.setState({isBackgroundBlurred:t},(()=>this._focusOn(this._backgroundBlurToggleRef))):this.setState({isBackgroundBlurred:t,isCameraOn:!0},(()=>this._focusOn(this._backgroundBlurToggleRef)))},this._showAVSettings=()=>{const e=Y.default.newCauseId();H.log(W.LogTraceArea.CallingUI,"CallPreviewView._showAVSettings causeId: "+e),d.default.CallNavigationHelper.navigateToAVDesktopSettings(this._getRootViewId(),e)},this._canObserveActiveCall=()=>this.state.enableObservingCall&&this.props.conversationMri&&this.props.activeCallId,this._canDisposeObservingCall=()=>!this._isStartOrJoinCallBtnPressed&&this.state.enableObservingCall&&this.state.callState===r.CallState.Observing,this._canPreheatActiveCall=()=>this.state.enablePreHeatCall&&this.props.conversationMri&&this.props.activeCallId,this._canDisposePreheatedCall=e=>!this._isStartOrJoinCallBtnPressed&&this.state.callState!==r.CallState.Connected&&d.default.CallingStore.isPreheated(e),this._onMicrophoneToggleRef=e=>{this._microphoneToggleRef=e||void 0},this._onCameraToggleRef=e=>{this._cameraToggleRef=e||void 0},this._onBackgroundBlurToggleRef=e=>{this._backgroundBlurToggleRef=e||void 0},this._onSwitchCameraRef=e=>{this._switchCameraToggleRef=e||void 0}}_buildState(e,t){const i=this._getRootViewId(),l=e.conversationMri?O.default.getDisplayName(e.conversationMri):void 0,c=L.default.getS4LCMCFeatures(),u=D.default.getUserPreferencesLocal(),h={isLandscape:!this._getContext().isPresentedInDesktopSubview&&U.default.getDeviceOrientation(i)===o.DeviceOrientation.Landscape,isMobileScreenSize:U.default.isMobileScreenSize(i)||x.default.isUsingStackNavigationContext(),isCameraDisabled:!d.default.DeviceStore.hasCameras()&&!d.default.CallingFeaturesHelper.isOutgoingVideoDisabled(),isMicrophoneDisabled:!d.default.DeviceStore.hasMicrophones(),selectedCamera:d.default.DeviceStore.getSelectedCamera(),cameras:d.default.DeviceStore.getCameras(),statusBarHeight:F.default.leavePaddingForStatusBar()?F.default.statusBarHeight():0,userMri:w.default.getSkypeMri(),localPreviewAndroidV2:d.default.CallingStore.isLocalPreviewAndroidV2Enabled(),conversationName:l,isProtocolLaunchCallPreview:e.callOrigin===W.NavigationCallOrigin.DeepLink,enableBlurBackgroundCallPreview:d.default.DeviceStore.isBackgroundBlurEnabled(),isSmallDesktopWindow:U.default.getWidth(i)<640,enableBackgroundReplacement:d.default.DeviceStore.isBackgroundReplacementEnabled(),enablePreHeatCall:c.enablePreHeatCall,enableObservingCall:c.enableObservingCall,enableCallHandoff:c.enableCallHandoff,enableTwinCam:c.twinCamEnabled,multipleEndpoints:!!e.activeCallId&&d.default.CallingStore.getConnectedEndpoints(e.activeCallId).length>0,callState:e.activeCallId?d.default.CallingStore.getCallState(e.activeCallId):void 0,isOutgoingVideoDisabled:d.default.CallingFeaturesHelper.isOutgoingVideoDisabled(),shouldAskPermissionOnLoad:!e.permissionAlreadyAsked&&c.enableCallPreviewPermissionOnLoad,isAwaitingCameraConfirmation:d.default.CallControlsStore.isAwaitingCameraConfirmation(),useHighContrastTheme:te.default.useHighContrastThemeAndChanges(),noPreview:B.default.getAppState()===a.Types.AppActivationState.Background};if(n.includes([r.CallState.Preheated,r.CallState.Observing],h.callState)&&!h.multipleEndpoints&&(this._wasTwinCamEnabled=!1),n.includes([r.CallState.Disconnecting,r.CallState.Disconnected,r.CallState.Connecting],h.callState)||(h.screenMode=se.Join),!this._wasToggleCameraChanged){const e=!0;h.isCameraOn=!h.isOutgoingVideoDisabled&&!h.isCameraDisabled&&e&&N.default.permissionStatus($.PermissionType.Camera)===s.PermissionStatus.Granted&&(n.isUndefined(u.callPreviewCameraSetting)||!!u.callPreviewCameraSetting)}if(h.callState===r.CallState.Connected&&e.activeCallId?h.isMicrophoneOn=!te.default.isLocalOrServerMuted(e.activeCallId):this._wasToggleMicrophoneChanged||(h.isMicrophoneOn=!h.isMicrophoneDisabled&&N.default.permissionStatus($.PermissionType.Microphone)===s.PermissionStatus.Granted&&(n.isUndefined(u.callPreviewMicSetting)||!!u.callPreviewMicSetting)),!this._wasToggleBackgroundBlurChanged){const e=!0;h.isBackgroundBlurred=e||!!u.callPreviewBlurSetting}return h}componentDidMount(){var e,t;super.componentDidMount();const i=Y.default.newCauseId();H.log(W.LogTraceArea.CallingUI,"CallPreview componentDidMount causeId: "+i),Z.dismissAll(),ie.default.setCallPreviewViewSeen(this._getCallId()),M.registerModalDialogDismissalException(this.props.dialogId),this._callEndedEvent=d.default.CallingStore.callEndedEvent().subscribe(this._onCallEnded);const a=E.default.mergeStyles([E.default.createBackgroundColorStyle(j.Color.black),E.default.createBarStyle(K.BarStyleTheme.Light),E.default.createHiddenStyle(!1)]);this._updateStatusBarStyle(a),this.state.enableBackgroundReplacement||this._setBlurBackground(i),this._updateCallState(i),this.state.shouldAskPermissionOnLoad&&d.default.CallPermissionsUtils.checkPermissionBrowserAndContinue(n.noop,n.noop,this.props.conversationMri,this.props.skipPermissionPanel),this.props.conversationMri&&!this.props.isTwinCam&&u.default.trackLobbyOpen(this.props.conversationMri),null===(t=(e=this.props).onVideoStateChanged)||void 0===t||t.call(e,this.state.isCameraOn)}componentDidUpdate(e,t,i){var a;super.componentDidUpdate(e,t,i);const n=Y.default.newCauseId();t.enableBlurBackgroundCallPreview===this.state.enableBlurBackgroundCallPreview&&e.activeCallId===this.props.activeCallId&&t.enableBackgroundReplacement===this.state.enableBackgroundReplacement||(H.log(W.LogTraceArea.CallingUI,"CallPreview componentDidUpdate causeId: "+n),this.state.enableBackgroundReplacement||this._setBlurBackground(n)),e.activeCallId!==this.props.activeCallId?(e.activeCallId&&this._canDisposePreheatedCall(e.activeCallId)&&this._disposePreheatedCall(e.activeCallId),this._updateCallState(n)):this.state.callState!==t.callState&&this.state.callState===r.CallState.Observing&&this._updateCallState(n),this._isCameraChanged&&(null===(a=this._switchCameraToggleRef)||void 0===a||a.requestFocus())}componentWillUnmount(){var e;super.componentWillUnmount();const t=Y.default.newCauseId();H.log(W.LogTraceArea.CallingUI,"CallPreview componentWillUnmount causeId: "+t),ie.default.setCallPreviewViewNotSeen(this._getCallId()),null===(e=this._callEndedEvent)||void 0===e||e.unsubscribe(),this.props.activeCallId&&this._canDisposePreheatedCall(this.props.activeCallId)&&this._disposePreheatedCall(this.props.activeCallId),this._canDisposeObservingCall()&&d.default.CallingStore.disposeObservingCalls(t),this._isStartOrJoinCallBtnPressed||ee.default.trackCallPreview(P.CallPreviewActions.Cancel,this._isCameraChanged,!this.state.isMicrophoneOn,this.state.isBackgroundBlurred,this._getCallId()),this._isStartOrJoinCallBtnPressed||u.default.finishScenario(),D.default.setCallPreviewSettings(this.state.isMicrophoneOn,this.state.isCameraOn,this.state.isBackgroundBlurred)}_updateCallState(e){!this.state.enableObservingCall||this._canDisposeObservingCall()?this._canPreheatActiveCall()&&!this._preheatedCallCauseId&&this._startPreheatingActiveCall():this._canObserveActiveCall()&&this._startObservingActiveCall(e)}render(){var e,t;const i=this.props.isModal?a.createElement(m.default,{style:re.closeButton,icon:V.closeIcon(),size:Q.IconSize.size24,title:z.getString("Global.CloseButtonTitle"),onPress:this._closeButtonPressed,color:j.Color.white,hoverColor:j.Color.whiteOverlay70}):this._renderEmptyForFlexboxView();let n,o,s,r,l;const d=T.formatDevicesForPicker(this.state.cameras),u=this._renderConversationTitle(),{isSmallDesktopWindow:h}=this.state;if(this.props.isNewCallPreviewStyle&&!c.default.isMobile()){const e=[re.settingsButtonStyleOnDesktop];s=this._renderAvSettingsButton(e)}if(this.state.isCameraOn&&!this.state.isCameraDisabled){this.state.noPreview||(n=a.createElement(oe.default,{ref:this._onLocalVideoPreviewRef,nametag:"video_local_preview",localPreviewAndroidV2:this.state.localPreviewAndroidV2,options:this.props.videoPreviewOptions}));{let i=[re.cameraControlContainer];if(this.props.isNewCallPreviewStyle)o=void 0;else if(this.state.isProtocolLaunchCallPreview||!this.state.enableBlurBackgroundCallPreview||h){const e=this.props.displayControlsUnderVideoCanvas&&this.state.enableBlurBackgroundCallPreview,n=this.props.fullScreenMode&&(h?2:3);o=a.createElement(a.View,{style:i},a.createElement(f.default,{tabIndex:n||void 0,items:d,onValueChange:this._onCameraSelected,selectedValue:(null===(t=this.state.selectedCamera)||void 0===t?void 0:t.id)||"",labelColor:e?void 0:j.Color.white,style:this.props.isModal?void 0:re.cameraPickerTopRightCornerNonModal}))}else i.push(re.newCameraControlContainer),this.props.displayControlsUnderVideoCanvas&&i.push(re.pickersUnderVideoCanvas),this.props.fullScreenMode&&i.push(re.previewCameraControlSmallScreen),s=a.createElement(a.View,{style:i},a.createElement(f.default,{items:d,onValueChange:this._onCameraSelected,selectedValue:(null===(e=this.state.selectedCamera)||void 0===e?void 0:e.id)||"",labelColor:this.props.displayControlsUnderVideoCanvas?void 0:j.Color.white}))}}else this.props.fullScreenMode||(r=a.createElement(a.View,{style:[re.convIcon,_.default.absoluteFill]},a.createElement(q.UserIcon,{userMri:this.state.userMri,placeholderIcon:this.props.useAvatarPlaceholderIcon?Q.SkypeIcon.Contact:void 0,size:this.props.avatarSize?this.props.avatarSize:this.state.isLandscape?X.UserIconSize.Size100:X.UserIconSize.Size160})));const p=!this.state.isCameraDisabled&&!this.state.isProtocolLaunchCallPreview&&!h&&this.state.enableBackgroundReplacement&&!this.props.isNewCallPreviewStyle&&!0;if(p){const e=[re.blurToggleStyleOnDesktop];this.props.displayControlsUnderVideoCanvas&&e.push(re.pickersUnderVideoCanvas),this.props.fullScreenMode&&e.push(re.previewCameraControlSmallScreen),l=this.state.enableBackgroundReplacement?this._renderBackgroundReplacementButton(e):this._renderToggleWithText({styles:e,text:z.getString("CallPreview.CallPreviewBlurToggleLabel"),key:"blur",accessibilityLabel:z.getString("CallPreview.CallPreviewBlurToggleLabel"),value:this.state.isBackgroundBlurred,onToggle:this._onToggleBlur})}const g=this._getCallPreviewControl(p),C=[re.dialogHeaderContainer],S=this._getHeaderTopMargin(!!u);S&&C.push(A.default.marginTopStyle(S));const y=[_.default.absoluteFill,re.videoCanvasWrapper];this.props.fullScreenMode||this.state.isMobileScreenSize||(y.push(re.videoBorderRadius),y.push(re.videoBoxShadow));return a.createElement(a.View,{style:re.dialog},a.createElement(a.View,{style:y},n,a.createElement(a.View,{style:[re.videoShadow,_.default.absoluteFill]}),r),a.createElement(a.View,{style:C},i,u,o),this.props.displayControlsUnderVideoCanvas?a.createElement(a.View,{style:re.controlsWrapper},g,s):a.createElement(a.View,{style:re.controlsWrapper},s,g),l)}_renderEmptyForFlexboxView(){const e=[re.closeButton];return this.props.isNewCallPreviewStyle&&e.push(re.emptyView),a.createElement(a.View,{key:"emptyForFlexbox",style:e})}_getHeaderTopMargin(e){return this.state.isMobileScreenSize&&!this.state.isLandscape&&!this._getContext().isPresentedInDesktopSubview&&this.state.statusBarHeight>0?this.state.statusBarHeight:e&&!this.state.isMobileScreenSize&&this.state.isLandscape?15:5}_renderOptionalCameraAndMicrophoneDetails(){if(!this.props.showCameraAndMicrophoneDetails||this.state.isMicrophoneOn&&this.state.isCameraOn)return;let e;return e=!this.state.isMicrophoneOn&&this.state.isCameraOn?z.getString("CallPreview.MicrophoneOff"):this.state.isMicrophoneOn&&!this.state.isCameraOn?z.getString("CallPreview.CameraOff"):z.getString("CallPreview.CameraAndMicrophoneOff"),a.createElement(a.Text,{style:re.cameraAndMicrophoneDetails},e)}_renderConversationTitle(){if(this.props.callOrigin&&W.NavigationCallOrigin[this.props.callOrigin]===W.NavigationCallOrigin[W.NavigationCallOrigin.InviteLink]){let e=[re.conversationTitle];return this.state.isCameraOn,a.createElement(a.View,{style:re.conversationHeader},a.createElement(a.Text,{style:e,ellipsizeMode:"tail",numberOfLines:1},this.state.conversationName),a.createElement(y.Caption,{style:re.conversationSubtitle},z.getString("CallPreview.CallPreviewCallInProgressSubtitle")))}}_renderOptionalActionButton(){if(this.props.hideActionButton)return;const e=this.props.callOrigin===W.NavigationCallOrigin.MeetNow&&!this.props.activeCallId||this.state.isProtocolLaunchCallPreview,t={backgroundColor:e?j.Color.blue:j.Color.green,textColor:j.Color.white};if(this.state.screenMode===se.TwinCamConnected){const e={backgroundColor:j.Color.red,textColor:j.Color.white};return a.createElement(a.View,{style:this.state.isLandscape?re.footerLandscape:re.footer},a.createElement(S.default,{buttonSize:G.SXButtonSize.Medium,buttonStyle:G.SXButtonStyle.Custom,title:z.getString("CallPreview.StopTwinCam"),onPress:()=>this.onEndCall(),buttonConfig:e,autoFocus:!1,disabled:!this.props.conversationMri}))}if(this.state.screenMode!==se.None){const i=this.state.screenMode===se.TwinCamAvailable;if(this.props.callOrigin===W.NavigationCallOrigin.MeetNow&&i)return;let n;n=i?z.getString("CallPreview.StartTwinCam"):e?z.getString("CallPreview.StartCallButtonTitle"):z.getString("CallPreview.JoinButtonTitle");const o=i?{paddingTop:15,paddingBottom:15}:void 0,s=this.state.enableCallHandoff&&(this.state.multipleEndpoints||i),r=s&&!i,l=s&&!r?this.state.isLandscape?re.footerWideLandscape:re.wideFooter:this.state.isLandscape?re.footerLandscape:re.footer;return a.createElement(a.View,{style:l},!r&&a.createElement(S.default,{buttonSize:G.SXButtonSize.Medium,buttonStyle:i?G.SXButtonStyle.ColorFill:G.SXButtonStyle.Custom,title:n,buttonConfig:i?void 0:t,onPress:()=>this.onStartOrJoinCall(!1),autoFocus:!1,disabled:!this.props.conversationMri,backgroundStyle:o,icon:i?Q.SkypeIcon.TwinCamMid:void 0,style:void 0}),(s||r)&&a.createElement(S.default,{buttonSize:G.SXButtonSize.Medium,buttonStyle:G.SXButtonStyle.LightFill,title:z.getString("CallPreview.HandoffCallTransfer"),onPress:()=>this.onStartOrJoinCall(!0),icon:Q.SkypeIcon.CallTransfer,disabled:!this.props.conversationMri,backgroundStyle:o,style:void 0}))}}_getCallPreviewControl(e){const t=[re.previewControl];this.state.isLandscape&&t.push(re.previewControlLandscape),this.props.previewControlStyle&&t.push(this.props.previewControlStyle);const i=!e&&this.state.enableBackgroundReplacement&&this.state.isSmallDesktopWindow&&!this.state.isCameraDisabled&&!this.state.isProtocolLaunchCallPreview&&!this.props.isNewCallPreviewStyle,n=i?this._renderBackgroundReplacementButton([re.blurToggleStyleOnSmallWindow]):void 0;return a.createElement(a.View,{style:t},this._renderOptionalCameraAndMicrophoneDetails(),this._renderControlSection(i||e),n,this._renderOptionalActionButton())}_renderControlSection(e){const{isNewCallPreviewStyle:t}=this.props,i=this._getCallControlMicButton(),n=this._getCallControlVideoButton(),o=this._getCallControlBackgroundBlurButton(e),s=this.state.screenMode===se.TwinCamAvailable;if(c.default.isMobile()&&t){const e=this._getCallControlCameraReverseButton();return a.createElement(a.View,{style:this.state.isLandscape&&s?re.iconTogglesModernContainerLandscape:re.iconTogglesModernContainer},i,n,e,o)}return!0===this.props.isNewCallPreviewStyle?a.createElement(a.View,{style:re.iconTogglesContainer},i,n,o):a.createElement(a.View,{style:re.iconTogglesContainer},n,i,o)}_getCallControlCameraReverseButton(){const{isNewCallPreviewStyle:e,isTwinCam:t}=this.props,{isProtocolLaunchCallPreview:i}=this.state;if(i&&!t||!e)return;let n;return n=this.state.selectedCamera?this.state.selectedCamera.position===r.CameraPosition.Front?z.getString("CallControls.CallButtonSwitchCameraBackwardLabel"):z.getString("CallControls.CallButtonSwitchCameraForwardLabel"):z.getString("CallControls.CallButtonSwitchCameraLabel"),a.createElement(ne.CallButton,{ref:this._onSwitchCameraRef,key:ae.CallControlsKeys.VideoQuickSettings,icon:Q.SkypeIcon.NewSwitchCamera,title:z.getString("CapturePanel.SwitchCameraButtonTitle"),size:ne.CallButtonSize.Large,onPress:this._switchCameraButtonPressed,accessibilityLabel:n,backgroundStyle:ne.CallButtonBackgroundStyle.Solid,colorConfig:this._colorConfig()})}_getCallControlVideoButton(){const e=!this.state.isCameraDisabled&&this.state.isCameraOn;if(this.props.isNewCallPreviewStyle){let t,i;const n=c.default.isMobile()?ne.CallButtonSize.Large:ne.CallButtonSize.Small;return this.state.isOutgoingVideoDisabled?t=i=z.getString("AudioVideoSettings.OutgoingVideoDisabled"):(t=z.getString(e?"CallControls.CallButtonTurnOffVideoLabel":"CallControls.CallButtonTurnOnVideoLabel"),i=v.default.generateTooltipLabelWithShortcutForCondition(t,W.KeyboardShortcut.ToggleCamera)),a.createElement(ne.CallButton,{ref:this._onCameraToggleRef,key:ae.CallControlsKeys.Video,icon:this.state.isAwaitingCameraConfirmation?Q.SkypeIcon.Ok:e?Q.SkypeIcon.Video:Q.SkypeIcon.VideoOff,title:i,size:n,isDisabled:this.state.isCameraDisabled,isToggledOn:e,onPress:t=>this._onToggleVideo(t,!e),accessibilityLabel:t,backgroundStyle:e?ne.CallButtonBackgroundStyle.Overlay:ne.CallButtonBackgroundStyle.Solid,colorConfig:this.state.isAwaitingCameraConfirmation?this._cameraConfirmColorConfig():void 0,doNotAddHorizontalMargin:!1})}{const t=this.state.isOutgoingVideoDisabled?"AudioVideoSettings.OutgoingVideoDisabled":"CallPreview.ToggleVideoAccessibilityLabel";return a.createElement(g.default,{key:"video",ref:this._onCameraToggleRef,icon:e?Q.SkypeIcon.Video:Q.SkypeIcon.VideoOff,accessibilityLabel:z.getString(t),iconSize:Q.IconSize.size24,style:[re.iconTogglesContainer,re.iconStyle],isOn:e,onChange:this._onToggleVideo,disable:this.state.isOutgoingVideoDisabled||this.state.isCameraDisabled})}}_getCallControlMicButton(){const e=!this.state.isMicrophoneDisabled&&this.state.isMicrophoneOn;if(this.props.isNewCallPreviewStyle){const t=c.default.isMobile()?ne.CallButtonSize.Large:ne.CallButtonSize.Small,i=z.getString(e?"CallControls.CallButtonUnmuteLabel":"CallControls.CallButtonMute"),n=v.default.generateTooltipLabelWithShortcutForCondition(i,W.KeyboardShortcut.ToggleMicrophone);return a.createElement(ne.CallButton,{ref:this._onMicrophoneToggleRef,key:ae.CallControlsKeys.Mic,icon:e?Q.SkypeIcon.Microphone:Q.SkypeIcon.MicrophoneOff,title:n,size:t,isToggledOn:e,onPress:t=>this._onToggleMic(t,!e),accessibilityLabel:i,backgroundStyle:e?ne.CallButtonBackgroundStyle.Overlay:ne.CallButtonBackgroundStyle.Solid,colorConfig:this._colorConfig(),doNotAddHorizontalMargin:!1})}return this.state.isProtocolLaunchCallPreview?void 0:a.createElement(g.default,{key:"microphone",ref:this._onMicrophoneToggleRef,icon:e?Q.SkypeIcon.Microphone:Q.SkypeIcon.MicrophoneOff,accessibilityLabel:z.getString("CallPreview.ToggleMicrophoneAccessibilityLabel"),iconSize:Q.IconSize.size24,style:[re.iconTogglesContainer,re.iconStyle],isOn:e,onChange:this._onToggleMic,disable:this.state.isMicrophoneDisabled})}_getCallControlBackgroundBlurButton(e){const t=this.state.enableBlurBackgroundCallPreview&&!e,i=!this.state.isCameraDisabled&&this.state.isCameraOn;if(!this.props.isNewCallPreviewStyle)return t?a.createElement(g.default,{key:"blur",ref:this._onBackgroundBlurToggleRef,icon:Q.SkypeIcon.BackgroundReplacement,accessibilityLabel:z.getString("CallPreview.CallPreviewBlurToggleLabel"),iconSize:Q.IconSize.size24,style:[re.iconTogglesContainer],isOn:i&&this.state.isBackgroundBlurred,onChange:this._onToggleBlur,disable:!i,disableInteraction:!i}):void 0;i&&this.state.isBackgroundBlurred,z.getString("CallPreview.CallPreviewBlurToggleLabel"),c.default.isMobile()?ne.CallButtonSize.Large:ne.CallButtonSize.Small}_renderToggleWithText(e){return a.createElement(a.View,{style:e.styles},a.createElement(y.BodyText,{size:y.BodyTextSize.SmallDeprecated,style:re.toggleText,numberOfLines:1},e.text),a.createElement(C.default,{key:e.key,style:re.accessibleToggleSwitchStyle,isOn:e.value,accessibilityLabel:e.accessibilityLabel,onChange:e.onToggle,disable:e.disable,disableInteraction:e.disableInteraction}))}_getHeaderText(e){return le.getHeaderText()}static getHeaderText(){return z.getString("CallPreview.CallPreviewViewLabel")}_setBlurBackground(e){H.log(W.LogTraceArea.CallingUI,"CallPreview _setBlurBackground causeId: "+e),!this.state.isCameraDisabled&&this.state.enableBlurBackgroundCallPreview&&(H.log(W.LogTraceArea.CallingUI,"CallPreview _setBlurBackground blur background as user preference, callId: "+this._getCallId()+" causeId: "+e),d.default.DeviceStore.setBackgroundBlurred(this.state.isBackgroundBlurred))}_cameraConfirmColorConfig(){return{iconColor:j.Color.white,backgroundColor:j.Color.blue,selectedIconColor:j.Color.white,selectedBackgroundColor:j.Color.blue}}_colorConfig(){return this.state.useHighContrastTheme?te.default.highContrastColorConfig(this._themeColors):void 0}_getCallId(){return this.props.activeCallId||this.props.fallbackCallId||Y.default.newGuid()}_startObservingActiveCall(e){const{conversationMri:t,activeCallId:i,callOrigin:a}=this.props;if(H.log(W.LogTraceArea.CallingUI,"CallPreview._startObservingActiveCall conversationMri: "+b.mriOrId(t)+" activeCallId: "+i+" causeId: "+e),t&&i)this.state.callState!==r.CallState.Observing?d.default.CallingStore.subscribeToCall(t,i,a,e).then((()=>{!this.isComponentMounted()&&this._canDisposeObservingCall()&&this._disposeObservingCall(e)})):H.log(W.LogTraceArea.CallingUI,"CallPreview._startObservingActiveCall abort, call already observed activeCallId: "+i+" causeId: "+e);else{const a="CallPreview._startObservingActiveCall abort, conversationMri and activeCallId cannot be undefined conversationMri: "+b.mriOrId(t)+" activeCallId: "+i+" causeId: "+e;H.error(W.LogTraceArea.CallingUI,a)}}_disposeObservingCall(e=Y.default.newCauseId()){H.log(W.LogTraceArea.CallingUI,`CallPreview._disposeObservingCalls causeId: ${e}`),d.default.CallingStore.disposeObservingCalls(e)}_startPreheatingActiveCall(){const e=Y.default.newCauseId(),{conversationMri:t,activeCallId:i,callOrigin:a}=this.props;if(H.log(W.LogTraceArea.CallingUI,"CallPreview._startPreheatingActiveCall conversationMri: "+t+" activeCallId: "+i+" causeId: "+e),t&&i)d.default.CallingStore.isPreheatedNoSubscription(i)?H.log(W.LogTraceArea.CallingUI,"CallPreview._startPreheatingActiveCall abort, call already preheated activeCallId: "+i+" causeId: "+e):(d.default.CallingStore.startPreheating(t,i,{withVideo:this.state.isCameraOn,muteFlags:this.state.isMicrophoneOn?void 0:r.MuteFlags.MuteMicrophone},a,e).then((()=>{!this.isComponentMounted()&&this._canDisposePreheatedCall(i)&&this._disposePreheatedCall(i)})),this._preheatedCallCauseId=e);else{const a="CallPreview._startPreheatingActiveCall abort, conversationMri and activeCallId cannot be undefined conversationMri: "+t+" activeCallId: "+i+" causeId: "+e;H.error(W.LogTraceArea.CallingUI,a)}}_disposePreheatedCall(e){const t=this._preheatedCallCauseId||Y.default.newCauseId();H.log(W.LogTraceArea.CallingUI,`CallPreview._disposePreheatedCall callId: ${e} causeId: ${t}`),d.default.CallingStore.stopPreheating(e,t)}}t.default=le},11881:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.testableSubmitPressed=void 0;const a=i(96486),n=i(36345),o=i(31844),s=i(16778),r=i(34339),l=i(51587),c=i(62033),d=i(67930),u=i(51638),h=i(9520),p=i(71830),g=i(11930),C=i(98278),m=i(22854),S=i(4336),y=i(37490),f=i(52262),_=i(46096),b=i(39285),T=i(36400),v=i(10117),w=i(36237),I=i(15877),P=i(74606),M=i(33754),k=i(78735),A=i(29130),R=i(51070),V=i(81115),L=i(10265),E=i(90631),B=i(22222),O=i(81760),D=i(40363),x=i(11010),N=i(11828),U=i(80837),F=i(19675),H=i(2301),z=i(67977),G=i(53374),W=(0,I.lazyProperties)({starsPage:()=>s.Styles.createViewStyle({flex:1,alignItems:"center"}),starsPageInnerContainer:()=>s.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"center",paddingTop:20}),starsPageInner:()=>s.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"space-around"}),starsContainer:()=>s.Styles.createViewStyle({flexDirection:"row",alignSelf:"stretch",justifyContent:"space-between"}),problemSectionContainer:()=>s.Styles.createViewStyle({flexDirection:"column",alignItems:"stretch",paddingLeft:10}),problemSectionTitle:()=>s.Styles.createTextStyle({paddingTop:20,paddingBottom:10}),checkboxAndTextContainer:()=>s.Styles.createViewStyle({justifyContent:"center",paddingVertical:5,paddingRight:5,borderBottomWidth:1,minHeight:50}),checkbox:()=>s.Styles.createViewStyle({position:"absolute",right:0,top:12}),problem:()=>s.Styles.createTextStyle({marginRight:48}),starIconSmall:()=>s.Styles.createViewStyle({alignItems:"center"}),starIconDeselected:()=>s.Styles.createViewStyle({opacity:.7}),starText:()=>s.Styles.createTextStyle({textAlign:"center",width:200}),footer:()=>s.Styles.createViewStyle({height:120,alignSelf:"stretch"}),footerLandscape:()=>s.Styles.createViewStyle({height:60,alignSelf:"stretch"}),footerButton:()=>s.Styles.createViewStyle({height:60,alignSelf:"stretch",justifyContent:"center",alignItems:"center"}),titleContainer:()=>s.Styles.createViewStyle({alignSelf:"stretch",justifyContent:"center",alignItems:"center",paddingTop:10}),title:()=>s.Styles.createTextStyle({alignSelf:"stretch",textAlign:"center",marginBottom:5,marginTop:10,marginHorizontal:15}),subtitle:()=>s.Styles.createTextStyle({alignSelf:"stretch",textAlign:"center",marginHorizontal:15}),body:()=>s.Styles.createTextStyle({marginVertical:20,marginHorizontal:10}),rateUsPage:()=>s.Styles.createViewStyle({flex:1,paddingVertical:10}),rateUsSectionContainer:()=>s.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"center",paddingHorizontal:10}),rateUsButton:()=>s.Styles.createButtonStyle({flex:1,alignSelf:"stretch"}),rateUsFooter:()=>s.Styles.createViewStyle({height:120,marginHorizontal:10,alignSelf:"stretch"}),rateUsFooterLandscape:()=>s.Styles.createViewStyle({height:60,marginHorizontal:10,alignSelf:"stretch",flexDirection:"row"}),rateUsText:()=>s.Styles.createTextStyle({marginTop:20,marginHorizontal:10,textAlign:"center"})}),K="CallQualityFeedback.";class j extends d.default{constructor(){super(...arguments),this._submitPressedTrue=()=>this._submitPressed(!0),this._submitPressedFalse=()=>this._submitPressed(!1),this._toggleForStar1=e=>this._starToggled(e,1),this._toggleForStar2=e=>this._starToggled(e,2),this._toggleForStar3=e=>this._starToggled(e,3),this._toggleForStar4=e=>this._starToggled(e,4),this._toggleForStar5=e=>this._starToggled(e,5),this._contentForSection=e=>{const t=M.getStringUnsafe(K+e.title);return s.createElement(s.View,{style:W.problemSectionContainer,key:e.title},s.createElement(F.Subtitle,{style:W.problemSectionTitle},t),a.map(e.problems,this._contentForProblem))},this._contentForProblem=e=>{const t=K+e,i=M.getStringUnsafe(t),n=a.includes(this.state.checkedProblems,e),o=[s.Types.AccessibilityTrait.CheckBox];n&&o.push(s.Types.AccessibilityTrait.Checked);const r=i;return s.createElement(s.Button,{key:e,accessibilityTraits:o,accessibilityLabel:r,onPress:t=>this._problemTokenToggled(t,e)},s.createElement(b.default,{style:[W.checkboxAndTextContainer,this._themeStyles.dividerBorderColorStyle]},s.createElement(F.BodyText,{style:W.problem},i),s.createElement(s.View,{style:W.checkbox},s.createElement(P.default,{isOn:n}))))},this._onBack=()=>(this._submitPressedTrue(),w.log(_.LogTraceArea.HardwareBackButton,"goBack: true componentId: CallQualityFeedbackPanel"),!0)}_buildState(e,t){const i=Object.assign({top:R.default.statusBarPadding(),bottom:R.default.bottomSafeAreaInset(C.BottomInsetDefault)},R.default.horizontalInsets(C.HorizontalInsetDefault)),a=this._getRootViewId();let n={displayName:f.default.getDisplayName(e.conversationMri),isOneOnOne:p.isOneOnOneConversation(e.conversationMri),isLandscape:!this._getContext().isPresentedInDesktopSubview&&A.default.getDeviceOrientation(a)===o.DeviceOrientation.Landscape,isSmallDevice:A.default.isSmallDevice(a),isMobileScreenSize:A.default.isMobileScreenSize(a),safeAreaInsets:i};return t&&(n.stars=0,n.renderingProblems=!1,n.renderingRateUs=!1,n.checkedProblems=[]),n}componentDidMount(){super.componentDidMount(),y.dismissAll(),c.default.subscribe(this._onBack)}componentWillUnmount(){super.componentWillUnmount(),c.default.unsubscribe(this._onBack)}render(){const e=this.state.renderingProblems?this._contentForProblemsPage():this.state.renderingRateUs?this._contentForRateUsPage():this._contentForStarsPage();return s.createElement(L.default,{dialogId:this.props.dialogId,containerStyle:this._themeStyles.primaryBackgroundColorStyle,closeOnClickOutside:!0,maxWidth:this.state.isMobileScreenSize?void 0:S.DefaultWidth,maxHeight:this.state.isMobileScreenSize?void 0:S.DefaultHeight,fullScreen:this.state.isMobileScreenSize,useFullSizeContainer:!0,accessibilityLabel:e.accessibilityLabel},s.createElement(s.View,{style:[U.default.flexOne,this._themeStyles.primaryBackgroundColorStyle]},e.content))}_headerCloseButton(){return{closeButtonType:E.CloseButtonType.Close,title:M.getString("Global.CloseButtonTitle"),onPress:this._submitPressedTrue,color:this._themeColors.primaryIconColor}}_contentForStarsPage(){let e;e=this.state.isOneOnOne?s.createElement(H.UserIcon,{userMri:this.props.conversationMri,size:this.state.isLandscape?z.UserIconSize.Size60:z.UserIconSize.Size120}):s.createElement(m.ConversationIcon,{conversationId:this.props.conversationMri,altName:this.state.displayName,size:this.state.isLandscape?z.ConversationIconSize.Size60:z.ConversationIconSize.Size120});const t=[x.default.messagingHeaderFontStyle(!!this.state.isLandscape),this._themeStyles.primaryTextColorStyle,W.title],i=[W.titleContainer];this.state.safeAreaInsets.top&&i.push(V.default.paddingTopStyle(this.state.safeAreaInsets.top));const a=s.createElement(s.View,{style:i},s.createElement(s.Text,{style:t,numberOfLines:1},this.state.displayName),s.createElement(F.Subtitle,{style:W.subtitle},p.isEncryptedThread(this.props.conversationMri)?M.getString("CallQualityFeedback.SubtitleEncrypted"):M.getString("CallQualityFeedback.Subtitle"))),n=M.getString("CallQualityFeedback.Title");return{content:s.createElement(s.View,{style:W.starsPage},a,s.createElement(s.View,{style:W.starsPageInnerContainer},s.createElement(s.View,{style:W.starsPageInner},e,s.createElement(F.BodyText,{bold:!0,style:W.starText},n),s.createElement(s.View,{style:W.starsContainer},this._contentForStar(1,this._toggleForStar1),this._contentForStar(2,this._toggleForStar2),this._contentForStar(3,this._toggleForStar3),this._contentForStar(4,this._toggleForStar4),this._contentForStar(5,this._toggleForStar5)))),this._renderFooter()),accessibilityLabel:n}}_accessibilityLabelForStarNum(e){switch(e){case 1:return M.getString("CallQualityFeedback.1-StarAccessibilityLabel");case 2:return M.getString("CallQualityFeedback.2-StarAccessibilityLabel");case 3:return M.getString("CallQualityFeedback.3-StarAccessibilityLabel");case 4:return M.getString("CallQualityFeedback.4-StarAccessibilityLabel");default:return M.getString("CallQualityFeedback.5-StarAccessibilityLabel")}}_contentForStar(e,t){const i=this.state.stars||0,a=[W.starIconSmall],n=i<e;n&&a.push(W.starIconDeselected);let o=this._accessibilityLabelForStarNum(e);return i===e&&(o+=", "+M.getString("Global.SelectedAccessibilityLabel")),s.createElement(T.HoverableButton,{onPress:t,accessibilityLabel:o},s.createElement(v.default,{icon:n?N.SkypeIcon.Favourite:N.SkypeIcon.FavouriteFilled,size:N.IconSize.size32,color:O.Color.blue,style:a}))}_contentForProblemsPage(){const e=this._headerCloseButton(),t={icon:N.SkypeIcon.Send,title:M.getString("Global.SendButtonTitle"),disabled:a.isEmpty(this.state.checkedProblems),onPress:this._submitPressedFalse,flipIcon:this._getContext().isRTL},i=s.createElement(E.SimplePanelHeader,{panelName:M.getString("CallQualityFeedback.ProblemsTitle"),leftButton:e,rightButtons:t});let n;n=1===a.size(this.props.problemSections)?this.props.problemSections[0].type===u.ProblemSectionType.Audio?M.getString("CallQualityFeedback.ProblemsAudioBody"):M.getString("CallQualityFeedback.ProblemsVideoBody"):M.getString("CallQualityFeedback.ProblemsAudioAndVideoBody");const o=[W.problemSectionContainer];V.default.hasHorizontalSafeAreas(this.state.safeAreaInsets)&&o.push(V.default.horizontalPaddingStyle(this.state.safeAreaInsets));return{content:s.createElement(s.View,{style:U.default.flexOne},i,s.createElement(s.ScrollView,{style:U.default.flexOne},s.createElement(s.View,{style:o},s.createElement(F.BodyText,{style:W.body},n),a.map(this.props.problemSections,this._contentForSection)))),accessibilityLabel:n}}_contentForRateUsPage(){const e=[W.rateUsPage];this.state.safeAreaInsets.top&&e.push(V.default.paddingTopStyle(this.state.safeAreaInsets.top)),this.state.safeAreaInsets.bottom&&e.push(V.default.paddingBottomStyle(this.state.safeAreaInsets.bottom));const t=M.getString("CallQualityFeedback.RateTheAppBody");return{content:s.createElement(s.View,{style:e},s.createElement(F.PanelHeader,{landscape:this.state.isLandscape,style:W.rateUsText},M.getString("CallQualityFeedback.Thanks")),s.createElement(F.BodyText,{style:W.rateUsText},t),s.createElement(s.View,{style:W.rateUsSectionContainer},s.createElement(r.AnimatedEmoticon,{size:this.state.isLandscape?r.Size.ExtraLarge:r.Size.ExtraExtraLarge,innerText:"like",emoticonName:"like",showPlaceHolder:!0,standaloneAnimation:!0})),s.createElement(s.View,{style:this.state.isLandscape?W.rateUsFooterLandscape:W.rateUsFooter},s.createElement(B.default,{style:W.rateUsButton,buttonStyle:C.SXButtonStyle.BlueFill,onPress:this._submitPressedFalse,title:M.getString("CallQualityFeedback.RateTheApp")}),s.createElement(B.default,{style:W.rateUsButton,buttonSize:C.SXButtonSize.Medium,buttonStyle:C.SXButtonStyle.ThemeNoBackground,title:M.getString("CapturePermissions.PrePromptCancelButtonTitle"),onPress:this._submitPressedTrue}))),accessibilityLabel:t}}_renderFooter(){let e;this.state.renderingProblems||this.state.renderingRateUs||(e={title:this.state.stars?M.getString("Global.SendButtonTitle"):M.getString("Global.CancelLabel"),onPress:this.state.stars?this._submitPressedFalse:this._submitPressedTrue});const t=e?s.createElement(B.default,{style:W.footerButton,buttonSize:C.SXButtonSize.Medium,buttonStyle:C.SXButtonStyle.ThemeNoBackground,title:e.title,onPress:e.onPress}):void 0;return s.createElement(s.View,{style:this.state.isLandscape?W.footerLandscape:W.footer},t)}_submitPressed(e){const t=G.default.newCauseId();w.log(_.LogTraceArea.Navigation,"CallQualityFeedbackPanel._submitPressed,  causeId: "+t),this.isComponentMounted(),Q(this.props,this.state,(e=>{this.isComponentMounted()&&this.setState(e)}),e)&&this._goBack(t)}_problemTokenToggled(e,t){e.stopPropagation();let i=!1;const n=this.state.checkedProblems?a.clone(this.state.checkedProblems):[];a.includes(n,t)?a.remove(n,(e=>e===t)):(n.push(t),i=!0);const o=K+t,r=M.getStringUnsafe(o)+", "+(i?M.getString("FeedbackMechanism.AccLabelCheckboxChecked"):M.getString("FeedbackMechanism.AccLabelCheckboxUnchecked"));s.Accessibility.announceForAccessibility(r),this.setState({checkedProblems:n})}_starToggled(e,t){e.stopPropagation();const i=g.default.combinedAccessibilityLabel(this._accessibilityLabelForStarNum(t),M.getString("Global.SelectedAccessibilityLabel"));i&&s.Accessibility.announceForAccessibility(i),this.setState({stars:t})}_getCheckboxAccessibilityLabel(e,t){const i=this._getCheckboxCheckedState(t);return M.getString("FeedbackMechanism.AccLabelCheckbox",{checkboxTitle:e,state:i})}_getCheckboxCheckedState(e){return e?M.getString("FeedbackMechanism.AccLabelCheckboxChecked"):M.getString("FeedbackMechanism.AccLabelCheckboxUnchecked")}_getHeaderText(e){return j.getHeaderText()}static getHeaderText(){return M.getString("CallQualityFeedback.Title")}}function Q(e,t,i,a){if(t.renderingRateUs)return a||(l.openAppStore(),k.default.setUserPreferencesLocal({lastRateUsPromptInfo:{version:D.default.getAppVersion(),timestamp:Date.now()}})),!0;if(a||t.renderingProblems||5===t.stars){const i=t.stars?"random":"cancel",a=t.stars||void 0,o=t.stars&&t.stars<5?(0,u.tokensString)(t.checkedProblems||[]):void 0;let s=new h.CQF(e.callId,e.endpointId,e.nodeId,e.participantId,a,o,105,i,e.pstnCdrId,e.maxConnectedParticipants);return w.log(_.LogTraceArea.CallQualityFeedback,"CQF: submitting event. reason: "+i+", stars: "+a+", problemTokens: "+o),w.track(s),n.default.provideCallQualityFeedback(e.callId,e.participantId,"105",i,a?a-1:0,o),!0}return i({renderingProblems:!0}),!1}t.default=j,t.testableSubmitPressed=Q},76455:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallReactionType=void 0;const a=i(38933),n=i(16778),o=i(88837),s=i(34339),r=i(60289),l=i(98278),c=i(46096),d=i(36237),u=i(15877),h=i(23752),p=i(18078),g=i(45026),C=i(82677),m=i(81760),S=i(11010),y=i(80837),f=i(19675),_=i(12770),b=i(53374);var T;!function(e){e[e.Text=0]="Text",e[e.Emoji=1]="Emoji",e[e.Sticker=2]="Sticker",e[e.Animation=3]="Animation",e[e.Snapshot=4]="Snapshot"}(T=t.CallReactionType||(t.CallReactionType={}));const v=350,w=n.Animated.Easing.CubicBezier(1,0,.78,1),I=n.Animated.Easing.CubicBezier(.33,0,0,1),P=(0,u.lazyProperties)({container:()=>n.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,paddingHorizontal:16,alignItems:"center",justifyContent:"center"}),containerCompact:()=>n.Styles.createViewStyle({paddingHorizontal:0,paddingVertical:0}),gradient:()=>n.Styles.createViewStyle({position:"absolute",top:0,right:0,bottom:0,left:0,opacity:.8}),textReaction:()=>n.Styles.createTextStyle({color:m.Color.white,textAlign:"center",lineHeight:S.default.controlFontSize.h4+5})});class M extends o.ComponentBase{constructor(){super(...arguments),this._reactionOpacityAnimatedValue=new n.Animated.Value(0),this._reactionAnimatedStyle=n.Styles.createAnimatedViewStyle({opacity:this._reactionOpacityAnimatedValue}),this._reactionScaleAnimatedValue=new n.Animated.Value(.25),this._reactionScaleAnimatedStyle=n.Styles.createAnimatedViewStyle({transform:[{scale:this._reactionScaleAnimatedValue}]}),this._startAnimation=()=>{d.log(c.LogTraceArea.CallReactions,"CallReactionView._startAnimation");let e,t=1.2;e=this.props.reactionType===T.Text?r.default.getTextTimeoutBasedOnContent(this.props.content):2e3,this.props.reactionType!==T.Text&&(this.props.isCompact&&p.default.isMyMri(this.props.creator)||!this.props.isCompact)&&(t=1.5);const i=g.default.timing(this._reactionScaleAnimatedValue,{toValue:t,duration:v,easing:w,useNativeDriver:!0});1!==this._reactionOpacityAnimatedValue._value?this._activeAnimation=n.Animated.parallel([g.default.timing(this._reactionOpacityAnimatedValue,{toValue:1,duration:v,easing:w,useNativeDriver:!0}),i]):this._activeAnimation=i,this._activeAnimation.start((t=>{this.isComponentMounted()&&(this._activeAnimation=g.default.timing(this._reactionScaleAnimatedValue,{toValue:1,duration:v,easing:I,useNativeDriver:!0}),this._activeAnimation.start((t=>{this.isComponentMounted()&&(this._reactionOnScreenTimer=_.default.setTimeout((()=>{this.isComponentMounted()&&(this._reactionOnScreenTimer=void 0,this._activeAnimation=n.Animated.parallel([g.default.timing(this._reactionOpacityAnimatedValue,{toValue:0,duration:v,easing:w,useNativeDriver:!0}),g.default.timing(this._reactionScaleAnimatedValue,{toValue:.25,duration:v,easing:w,useNativeDriver:!0})]),this._activeAnimation.start((()=>{this._activeAnimation=void 0,this.isComponentMounted()&&this.props.onAnimationOut&&this.props.onAnimationOut()})))}),e))})))}))},this._stopAnimation=()=>{this._activeAnimation&&(this._activeAnimation.stop(),this._activeAnimation=void 0),this._clearOnScreenTimer()},this._clearOnScreenTimer=()=>{this._reactionOnScreenTimer&&(_.default.clearTimeout(this._reactionOnScreenTimer),this._reactionOnScreenTimer=void 0)}}componentDidMount(){super.componentDidMount(),this._startAnimation();const e=b.default.newCauseId();d.log(c.LogTraceArea.CallReactions,"CallReactionView.componentDidMount  cuid: "+this.props.cuid+" callReactionType: "+this.props.reactionType+" causeId: "+e)}componentWillUnmount(){super.componentWillUnmount();const e=b.default.newCauseId();d.log(c.LogTraceArea.CallReactions,"CallReactionView.componentWillUnmount causeId: "+e),this._stopAnimation()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=b.default.newCauseId();d.log(c.LogTraceArea.CallReactions,"CallReactionView.componentDidUpdate causeId: "+a),e.cuid!==this.props.cuid&&(this._stopAnimation(),this._startAnimation())}render(){let e,t,i=[P.container,this._reactionAnimatedStyle,this.props.isCompact?P.containerCompact:void 0,this.props.style];if(this.props.reactionType===T.Emoji){const t=C.separateReactionNameAndTone(this.props.content);e=n.createElement(s.AnimatedEmoticon,{size:this.props.isCompact?s.Size.Large:s.Size.ExtraExtraLarge,innerText:this.props.content,emoticonName:t.reactionNameWithoutTone,standaloneAnimation:!0,tone:t.reactionTone})}else if(this.props.reactionType!==T.Text||this.props.isCompact)this.props.reactionType!==T.Snapshot||this.props.isCompact||(e=n.createElement(f.Header,{size:l.HeaderSize.h4,style:P.textReaction},this.props.content));else{const t={renderMedia:!1,textOverrideStyle:[S.default.fontStyle.h4,P.textReaction],allowTextFallbackEmoticons:!0,allowLargeEmoticons:!0,allowHugeEmoticons:!0};e=n.createElement(h.default,{message:this.props.reaction,options:t})}if(this.props.showBackgroundGradient){let e=[P.gradient];this.props.borderRadius&&e.push(n.Styles.createViewStyle({borderRadius:this.props.borderRadius},!1)),t=this.props.gradientColors?n.createElement(a.GradientView,{style:e,direction:a.GradientDirection.BOTTOM,colors:this.props.gradientColors}):void 0}return e=n.createElement(n.Animated.View,{style:[y.default.overflowVisible,this._reactionScaleAnimatedStyle]},e),n.createElement(n.Animated.View,{style:i,ignorePointerEvents:!0},t,e)}}t.default=M},3936:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallReactionsActionSheet=void 0;const a=i(96486),n=i(81400),o=i(46096),s=i(36237),r=i(33004),l=i(93194),c=i(53374);t.CallReactionsActionSheet=class{constructor(e){this._onActionButtonPress=(e,t)=>{if(t===l.SXActionMenuCancel)s.log(o.LogTraceArea.CallingUI,"Dismissing call reaction action sheet");else this._reactionPressed(t)},this._reactionSheetOptions=e,this._reactions=a.map(e.reactions,(e=>({key:e.key,info:e})))}showReactionActionSheet(e,t){a.isEmpty(this._reactions)?s.warn(o.LogTraceArea.CallingUI,"ReactionPack is empty, not showing action sheet"):(s.log(o.LogTraceArea.CallingUI,"showing reactions menu"),this._showReactionActionMenu(e,t))}_showReactionActionMenu(e,t){const i=a.map(this._reactions,(e=>({text:r.default.localizedAccessibilityTextForEmoticon(e.key)||e.key,command:e.key})));l.default.showWithActionMenuConfig({options:{anchor:e,buttons:i},callback:t=>this._onActionButtonPress(e,t),rootViewId:t,invokingEvent:void 0})}_reactionPressed(e){const t=c.default.newCauseId();s.log(o.LogTraceArea.CallingUI,"_onReactionPressed causeId: "+t);const i=a.find(this._reactions,(t=>t.key===e));if(i){const e={reactionInfo:i.info,causeId:t,timestamp:Date.now(),postSource:o.PostSource.CallReactionPressed,callId:this._reactionSheetOptions.callId,conversationMri:this._reactionSheetOptions.conversationMri,reactionsConversationMri:this._reactionSheetOptions.reactionsConversationMri,logTraceArea:o.LogTraceArea.CallingUI};n.CallReactionPostingHelpers.postReaction(e)}}}},99734:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(31844),o=i(16778),s=i(89391),r=i(94224),l=i(3936),c=i(12614),d=i(78968),u=i(2278),h=i(80200),p=i(71727),g=i(3493),C=i(97775),m=i(11009),S=i(98278),y=i(24338),f=i(77381),_=i(46096),b=i(13944),T=i(36237),v=i(15877),w=i(33754),I=i(45026),P=i(29130),M=i(51070),k=i(81115),A=i(36150),R=i(76350),V=i(81760),L=i(11828),E=i(53374);var B;!function(e){e[e.Left1=0]="Left1",e[e.Left2=1]="Left2",e[e.Right1=2]="Right1",e[e.Right2=3]="Right2"}(B||(B={}));const O=(0,v.lazyProperties)({barContainer:()=>o.Styles.createViewStyle({position:"absolute",left:0,right:0,bottom:0,paddingLeft:8,flexDirection:"row",overflow:"visible",backgroundColor:V.Color.transparent}),menu:()=>o.Styles.createViewStyle({paddingLeft:0,paddingTop:10,alignItems:"center",justifyContent:"space-between",overflow:"visible"}),menuIcon:()=>o.Styles.createViewStyle({width:L.IconSize.default,height:L.IconSize.default,alignItems:"center",justifyContent:"center",marginHorizontal:5,overflow:"visible"}),leftControls:()=>o.Styles.createViewStyle({flexDirection:"row",overflow:"visible"}),rightControls:()=>o.Styles.createViewStyle({flexDirection:"row",overflow:"visible"}),tabletReactionsContainer:()=>o.Styles.createViewStyle({justifyContent:"flex-end",height:340}),chatIconBadge:()=>o.Styles.createViewStyle({height:8,width:8,backgroundColor:V.Color.red,borderRadius:4,position:"absolute",right:5,top:5,justifyContent:"center",alignItems:"center"}),backgroundCircle:()=>o.Styles.createViewStyle({position:"absolute",width:L.IconSize.default,height:L.IconSize.default,borderRadius:L.IconSize.default/2,backgroundColor:V.Color.white,opacity:.5})});class D extends f.default{constructor(){super(...arguments),this._coachMarkContext={coachMarkArea:m.CoachMarkAreaType.CallReactionsBar},this._menuAnimatedTansformValue=new o.Animated.Value(0),this._menuAnimatedTansformStyle=o.Styles.createAnimatedViewStyle({transform:[{translateY:this._menuAnimatedTansformValue}]}),this.closeReactionsDrawer=()=>{this._reactionsDrawer&&this._reactionsDrawer.closeDrawer()},this.setOverflowCoachMarksEnabled=e=>{this.setState({overflowCoachMarksEnabled:e})},this._onOpenReactionsDrawer=()=>{const e=E.default.newCauseId();T.log(_.LogTraceArea.CallReactions,"CallReactionsBar.openReactionsDrawer causeId: "+e),this.openReactionsDrawer(e)},this._onOpenCloseAnimationCompleteForStackNav=e=>{I.default.timing(this._menuAnimatedTansformValue,{toValue:e?this.props.minDrawerHeight+(this.props.audioNotificationOffset||0):0,duration:150,easing:o.Animated.Easing.Out(),useNativeDriver:!0}).start(),T.log(_.LogTraceArea.CallReactions,"ReactionsBar._onToggleOpen open: "+e),this.props.onReactionsDrawerOpen&&this.props.onReactionsDrawerOpen(e)},this._onOpenCloseAnimationCompleteForComposite=e=>{this.state.compositeReactionsDrawerOpen!==e&&this.isComponentMounted()&&this.setState({compositeReactionsDrawerOpen:e}),this.props.onReactionsDrawerOpen&&this.props.onReactionsDrawerOpen(e)},this._onGalleryButtonPress=()=>{if(this.props.onGalleryButtonPress){const e=E.default.newCauseId();T.log(_.LogTraceArea.CallingUI,`CallReactionsBar._onGalleryButtonPress, causeId: ${e}`),this.props.onGalleryButtonPress(e)}},this._onChatButtonPress=()=>{if(this.props.onChatButtonPress){const e=E.default.newCauseId();T.log(_.LogTraceArea.CallingUI,`CallReactionsBar._onChatButtonPress, causeId: ${e}`),this.props.onChatButtonPress(e)}},this._onCallReactionPressed=(e,t)=>{const i=E.default.newCauseId();T.log(_.LogTraceArea.CallReactions,"CallReactionsBar._onCallReactionPressed causeId: "+i),this.state.compositeReactionsDrawerOpen?this.closeReactionsDrawer():this.openReactionsDrawer(i)},this._onLayoutChanged=e=>{this.props.onDesiredHeightChanged&&this.props.onDesiredHeightChanged(Math.max(this.props.minDrawerHeight,e.height))},this._onReactionsDrawerRef=e=>{this._reactionsDrawer=e||void 0}}_buildState(e,t){var i,a;const o=s.default.getS4LCMCFeatures(),l=this._getRootViewId(),c=g.default.getCelebrationData(e.conversationMri,e.callId);let d={horizontalInsets:e.isUsingStackNavigationContext?M.default.horizontalInsets(S.HorizontalInsetDefault):{left:15,right:15},enableMomentsCapture:o.enableMomentsCapture,buttonConfig:e.isUsingStackNavigationContext?o.callReactionsBarButtonConfig.mobile:o.callReactionsBarButtonConfig.tablet,emoticonReactionKey:p.default.getEmoticonReactionKey(c),isMobileScreenReaderEnabled:A.default.isMobileScreenReaderEnabled(),celebrationData:c,isReceivingScreenShare:r.default.CallingStore.isReceivingScreenSharing(e.callId),isChatBadgeOn:this._isUnreadInCallIncomingMessageAndPhoto(),showCustomizeReactionsButton:(null===(i=o.customCallReactions)||void 0===i?void 0:i.enabled)&&(null===(a=o.customCallReactions)||void 0===a?void 0:a.useNewAddEmojiIcon)};return t&&(d.rootViewId=l,d.isLandscape=P.default.getDeviceOrientation(l)===n.DeviceOrientation.Landscape,d.compositeReactionsDrawerOpen=!1,d.overflowCoachMarksEnabled=!1),d}_isUnreadInCallIncomingMessageAndPhoto(){return d.default.getUnseenIncomingTextCount(this.props.reactionsConversationId)>0||d.default.getUnseenIncomingPhotoCount(this.props.reactionsConversationId)>0}componentDidMount(){super.componentDidMount();const e=E.default.newCauseId();T.log(_.LogTraceArea.CallReactions,"CallReactionsBar.componentDidMount causeId: "+e),this._startOrStopOrientationListener(!0,e),this.props.controlsType===h.CallControlsType.Mobile&&I.default.markAnimatedValue(this._menuAnimatedTansformValue,0)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this._reactionsDrawer&&this.state.compositeReactionsDrawerOpen!==t.compositeReactionsDrawerOpen&&(this.state.compositeReactionsDrawerOpen?this._reactionsDrawer.openDrawer():this._reactionsDrawer.closeDrawer())}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),e.isShowingChat!==this.props.isShowingChat&&e.isShowingChat&&(d.default.resetUnSeenIncomingPhotoCount(this.props.reactionsConversationId),d.default.resetUnSeenIncomingTextCount(this.props.reactionsConversationId))}componentWillUnmount(){super.componentWillUnmount();const e=E.default.newCauseId();T.log(_.LogTraceArea.CallReactions,"CallReactionsBar.componentWillUnmount causeId: "+e),this._startOrStopOrientationListener(!1,e)}close(){return!(!this._reactionsDrawer||this.props.controlsType===h.CallControlsType.Mobile)&&this._reactionsDrawer.closeDrawer()}openReactionsDrawer(e){T.log(_.LogTraceArea.CallReactions,"CallReactionsBar.openReactionsDrawer causeId: "+e);const t=()=>{};if(this.state.isMobileScreenReaderEnabled){new l.CallReactionsActionSheet({reactionsConversationMri:this.props.reactionsConversationId,conversationMri:this.props.conversationMri,callId:this.props.callId,reactions:p.default.getReactionItems(this.state.celebrationData)}).showReactionActionSheet(t,this._getRootViewId())}else this.isComponentMounted()&&this.setState({compositeReactionsDrawerOpen:!0,openReactionsOnHover:!1})}toggleReactionsPickerHovered(){this.isComponentMounted()&&this.setState({compositeReactionsDrawerOpen:!0,openReactionsOnHover:!0})}isDrawerOpen(){return!!this._reactionsDrawer&&this._reactionsDrawer.isOpen()}_startOrStopOrientationListener(e,t){e?this._deviceOrientationKey||(this._deviceOrientationKey=a.uniqueId("ReactionsBar"),n.default.addOrientationEventListener(this._deviceOrientationKey,(e=>{const i=e===n.DeviceOrientation.Landscape;this.isComponentMounted()&&this.state.isLandscape!==i&&(this.setState({isLandscape:i}),u.default.updateCallTelemetry(this.props.callId,t,(e=>e.orientationChanged(i))))}))):this._deviceOrientationKey&&(n.default.removeOrientationEventListener(this._deviceOrientationKey),this._deviceOrientationKey=void 0)}_buttonForOverflowMenuItem(e){switch(e){case h.CallControlsOverflowItem.Reactions:if(this.props.activitiesEnabled){const t=this._descriptorForOverflowMenuItem(e,this.state.compositeReactionsDrawerOpen);return this._renderMenuItem(t.icon,t.title,t.accessibilityLabel,this.state.compositeReactionsDrawerOpen?V.Color.gray400:void 0,!this.state.compositeReactionsDrawerOpen,this.state.compositeReactionsDrawerOpen?this.closeReactionsDrawer:this._onOpenReactionsDrawer,void 0)}break;case h.CallControlsOverflowItem.Moments:if(this.props.activitiesEnabled&&this.state.enableMomentsCapture){const t=this._descriptorForOverflowMenuItem(e);return this.state.overflowCoachMarksEnabled?this._renderMenuItem(t.icon,t.title,t.accessibilityLabel,void 0,!0,this.props.onCaptureMomentPress,this.state.isReceivingScreenShare?m.CoachMarkType.CallPanelPhotoMomentsForScreenShare:m.CoachMarkType.CallPanelPhotoMoments):this._renderMenuItem(t.icon,t.title,t.accessibilityLabel,void 0,!0)}break;case h.CallControlsOverflowItem.Gallery:if(this.props.activitiesEnabled){const t=this._descriptorForOverflowMenuItem(e);return this._renderMenuItem(t.icon,t.title,t.accessibilityLabel,void 0,!0,this._onGalleryButtonPress)}break;case h.CallControlsOverflowItem.Chat:if(this.props.activitiesEnabled){const t=e===h.CallControlsOverflowItem.Chat&&this.props.isShowingChat,i=this._descriptorForOverflowMenuItem(e,t);return this._renderChatMenuItem(i.icon,i.title,i.accessibilityLabel,void 0,!0,this._onChatButtonPress)}}}_descriptorForOverflowMenuItem(e,t=!1,i=!1){return p.default.overflowMenuItemDescriptor(e,t,i)}_renderReactionsMenu(){if(this.props.controlsType!==h.CallControlsType.Mobile)return;const e={[h.CallControlsOverflowItem.Chat]:this._buttonForOverflowMenuItem(h.CallControlsOverflowItem.Chat),[h.CallControlsOverflowItem.Moments]:this._buttonForOverflowMenuItem(h.CallControlsOverflowItem.Moments),[h.CallControlsOverflowItem.Gallery]:this._buttonForOverflowMenuItem(h.CallControlsOverflowItem.Gallery),[h.CallControlsOverflowItem.Reactions]:this._buttonForOverflowMenuItem(h.CallControlsOverflowItem.Reactions)},t=[...this._barContainerStyles(),O.menu,this._menuAnimatedTansformStyle];return k.default.hasHorizontalSafeAreas(this.state.horizontalInsets)&&t.push(k.default.horizontalPaddingStyle(this.state.horizontalInsets)),o.createElement(o.Animated.View,{style:t,ignorePointerEvents:!0},o.createElement(o.View,{style:O.leftControls},this._optionalButton(B.Left1,e),this._optionalButton(B.Left2,e)),o.createElement(o.View,{style:O.rightControls},this._optionalButton(B.Right1,e),this._optionalButton(B.Right2,e)))}_optionalButton(e,t){if(0!==this.state.buttonConfig.length)switch(e){case B.Left1:if(this.state.buttonConfig[0].length>0)return this._buttonForButtonName(this.state.buttonConfig[0][0],t);break;case B.Left2:if(this.state.buttonConfig[0].length>1)return this._buttonForButtonName(this.state.buttonConfig[0][1],t);break;case B.Right1:if(this.state.buttonConfig[1].length>0)return this._buttonForButtonName(this.state.buttonConfig[1][0],t);break;case B.Right2:if(this.state.buttonConfig[1].length>1)return this._buttonForButtonName(this.state.buttonConfig[1][1],t)}}_buttonForButtonName(e,t){switch(e){case h.CallControlsOverflowItem[h.CallControlsOverflowItem.Reactions]:return this.state.compositeReactionsDrawerOpen?t[h.CallControlsOverflowItem.Reactions]:this._renderOptionalReactionButton();case h.CallControlsOverflowItem[h.CallControlsOverflowItem.Chat]:return t[h.CallControlsOverflowItem.Chat];case h.CallControlsOverflowItem[h.CallControlsOverflowItem.Gallery]:return t[h.CallControlsOverflowItem.Gallery];case h.CallControlsOverflowItem[h.CallControlsOverflowItem.Moments]:return t[h.CallControlsOverflowItem.Moments];default:T.warn(_.LogTraceArea.CallingUI,'CallReactionsBar._buttonForButtonName Invalid CallControlsOverflowItem "'+e+'" specified in ECS param callReactionsBarButtonConfig.')}}_renderOptionalReactionButton(){const e={key:this.state.emoticonReactionKey,type:h.ReactionsItemType.Emoticon};return o.createElement(o.View,{style:O.menuIcon},o.createElement(c.default,{key:e.key,info:e,isAnimated:!1,onPress:this._onCallReactionPressed,accessibilityLabel:w.getString("CallReactionsBar.EmoticonButtonTitle"),importantForAccessibility:o.Types.ImportantForAccessibility.Yes}))}_renderMenuItem(e,t,i,n,s,r,l){const c=a.isArray(e)?e[0].icon:e.icon,d={style:O.menuIcon,icon:c,title:t,accessibilityLabel:i,color:n||V.Color.white,hoverColor:n||V.Color.white,size:this.props.useDesktopCallControls?L.IconSize.size20:L.IconSize.size24,showShadow:s,onPress:r};return l?o.createElement(C.default.IconButton,Object.assign({},d,{key:l,coachMarkType:l,positions:[m.PopupAnchorPositon.Top],anchorAccessibilityLabel:i})):o.createElement(b.default,Object.assign({},d))}_renderChatMenuItem(e,t,i,n,s,r,l){const c={icon:a.isArray(e)?e[0].icon:e.icon,title:t,accessibilityLabel:i,color:n||V.Color.white,hoverColor:n||V.Color.white,size:this.props.useDesktopCallControls?L.IconSize.size20:L.IconSize.size24,showShadow:s,onPress:r},d=this.state.isChatBadgeOn?o.createElement(o.View,{style:O.chatIconBadge}):void 0,u=l?o.createElement(C.default.IconButton,Object.assign({},c,{coachMarkType:l,positions:[m.PopupAnchorPositon.Top],anchorAccessibilityLabel:i})):o.createElement(b.default,Object.assign({},c));return o.createElement(o.View,{style:O.menuIcon},o.createElement(o.Animated.View,{style:O.backgroundCircle}),u,d)}_renderReactionsDrawer(){if(!this.state.compositeReactionsDrawerOpen&&!this.props.isUsingStackNavigationContext)return null;let e;const t=this.props.controlsType===h.CallControlsType.Mobile;e=this.props.isUsingStackNavigationContext?o.createElement(R.default,{ref:this._onReactionsDrawerRef,conversationMri:this.props.conversationMri,reactionsConversationMri:this.props.reactionsConversationId,callId:this.props.callId,bottomSafeAreaInset:this.props.bottomSafeAreaInset,horizontalInsets:this.state.horizontalInsets,controlsType:this.props.controlsType,onOpenCloseAnimationComplete:this._onOpenCloseAnimationCompleteForStackNav,celebrationData:this.state.celebrationData,audioNotificationOffset:this.props.audioNotificationOffset}):o.createElement(y.default,{ref:this._onReactionsDrawerRef,conversationMri:this.props.conversationMri,reactionsConversationMri:this.props.reactionsConversationId,callId:this.props.callId,controlsType:this.props.controlsType,onOpenCloseAnimationComplete:this._onOpenCloseAnimationCompleteForComposite,drawerOpenedOnHover:this.state.openReactionsOnHover,celebrationData:this.state.celebrationData,showCustomizeReactionsButton:this.state.showCustomizeReactionsButton,rootViewId:this.state.rootViewId});const i=!this.props.isUsingStackNavigationContext&&t?[O.tabletReactionsContainer]:this._barContainerStyles();return o.createElement(o.View,{style:i,ignorePointerEvents:!0},e)}_barContainerStyles(){return[O.barContainer,o.Styles.createViewStyle({height:this.props.minDrawerHeight+this.props.bottomSafeAreaInset,paddingBottom:this.props.bottomSafeAreaInset},!1)]}render(){return o.createElement(o.View,{style:this.props.style,onLayout:this.props.onDesiredHeightChanged?this._onLayoutChanged:void 0,ignorePointerEvents:!0},o.createElement(m.CoachMarkContext.Provider,{value:this._coachMarkContext},this._renderReactionsDrawer(),this._renderReactionsMenu()))}}t.default=D},12614:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stickerMargin=void 0;const a=i(96486),n=i(16778),o=i(34339),s=i(89391),r=i(80200),l=i(77381),c=i(68934),d=i(15877),u=i(82677),h=i(33004),p=(i(29130),i(81760)),g=i(11010),C=i(80837);t.stickerMargin=4;const m=(0,d.lazyProperties)({sticker:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center",overflow:"visible",marginHorizontal:t.stickerMargin}),stickerInnerView:()=>n.Styles.createViewStyle({flex:1,overflow:"visible"}),imageSticker:()=>n.Styles.createViewStyle({position:"absolute",top:3,left:3,height:38,width:38}),modernImageSticker:()=>n.Styles.createViewStyle({height:28,width:28}),menuItemPosition:()=>n.Styles.createViewStyle({height:40,padding:3}),scaledEmoticon:()=>n.Styles.createViewStyle({transform:[{scale:.8}]}),caption:()=>n.Styles.createTextStyle({textAlign:"center",fontSize:g.default.controlFontSize.actionButtonLabel,color:p.Color.white,height:15,paddingHorizontal:4,width:70}),captionLightTheme:()=>n.Styles.createTextStyle({color:p.Color.gray400}),hidden:()=>n.Styles.createTextStyle({opacity:0})});class S extends l.default{constructor(){super(...arguments),this._hovered=!1,this._onReactionButtonRef=e=>{this._reactionButton=e||void 0},this._onPress=e=>{this.props.onPress(this.props.info,e.timeStamp)},this._onHoverStart=e=>{this._onHover(!0)},this._onHoverEnd=e=>{this._onHover(!1)}}_buildState(e,t){return{isSmallDevice:!1}}componentWillUnmount(){super.componentWillUnmount(),this._hovered&&c.default.clearToolTip()}_stickerView(){const e=h.default.localizedAccessibilityTextForImageSticker(this.props.info.key),t=[m.imageSticker];return this.props.useDesktopCallControls&&t.push(m.modernImageSticker),n.createElement(n.Image,{style:t,source:h.default.imageForSticker(this.props.info.key),title:e,accessibilityLabel:e})}_emoticonView(){const e=u.separateReactionNameAndTone(this.props.info.key);let t=h.default.localizedAccessibilityTextForEmoticon(e.reactionNameWithoutTone);this.props.celebrationData&&this.props.info.key===s.default.getS4LCMCFeaturesNoSubscription().callCelebrationConfig.callCelebrateButtonKey&&(t=this.props.celebrationData.celebrationText);const i=this.state.isSmallDevice||this.props.useDesktopCallControls?o.Size.Medium:o.Size.Large,a=[m.scaledEmoticon];return this.props.hideIcon&&a.push(m.hidden),this.props.isCallMenuItem&&a.push(m.menuItemPosition),n.createElement(n.View,{style:a,accessibilityLabel:t,title:t},n.createElement(o.AnimatedEmoticon,{size:i,innerText:t,emoticonName:e.reactionNameWithoutTone,standaloneAnimation:!0,isStatic:!this.props.isAnimated,preventSelectable:!0,tone:e.reactionTone}))}_getStickerDimesionStyles(){let e,t;return this.state.isSmallDevice||this.props.useDesktopCallControls?(e=34,t=34):(e=44,t=44),this.props.caption&&(t+=15),n.Styles.createViewStyle({width:e,height:t},!1)}requestFocus(){this._reactionButton&&this._reactionButton.requestFocus()}_onHover(e){this._hovered=e;const t=()=>!(!(this.isComponentMounted()&&this.props.title&&this.props.showToolTip&&this._hovered)||n.UserInterface.isNavigatingWithKeyboard());t()?a.delay((()=>{t()&&c.default.showToolTip((()=>this.isComponentMounted()?this:void 0),this._getRootViewId(),t,this.props.title||"")}),150):c.default.clearToolTip(),this.props.onHover&&this.props.onHover(e)}render(){const e=!!this.props.onPanHorizontal,t=[m.sticker,C.default.noncollapsibleView],i=e?[m.stickerInnerView]:[t,this._getStickerDimesionStyles()];let a,o;if(this.props.info.type===r.ReactionsItemType.Sticker?a=this._stickerView():this.props.info.type!==r.ReactionsItemType.Emoticon&&this.props.info.type!==r.ReactionsItemType.Animation||(a=this._emoticonView()),this.props.caption){const e=[m.caption];this.props.useLightTheme&&e.push(m.captionLightTheme),o=n.createElement(n.Text,{style:e,ellipsizeMode:"tail",numberOfLines:1},this.props.caption)}let s=n.createElement(n.Button,{ref:this._onReactionButtonRef,style:i,activeOpacity:.5,tabIndex:this.props.tabIndex,importantForAccessibility:this.props.importantForAccessibility,accessibilityLabel:this.props.accessibilityLabel,onPress:this._onPress,onHoverStart:this._onHoverStart,onHoverEnd:this._onHoverEnd},a,o);return e&&(s=n.createElement(n.GestureView,{style:[t,this._getStickerDimesionStyles()],onPanHorizontal:this.props.onPanHorizontal,releaseOnRequest:!1,importantForAccessibility:this.props.importantForAccessibility},s)),s}}t.default=S,S.stickerSize=44,S.stickerMargin=t.stickerMargin},66080:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(34828),o=i(16778),s=i(89391),r=i(94224),l=i(719),c=i(47176),d=i(98278),u=i(87134),h=i(46096),p=i(91771),g=i(49770),C=i(36237),m=i(15877),S=i(33754),y=i(72425),f=i(51070),_=i(85683),b=i(81760),T=i(80837),v=i(90970),w=i(19675),I=i(24576),P=i(53374),M="groupShareButton",k="activeParticipantHeader",A="inactiveParticipantHeader",R=(0,m.lazyProperties)({itemDivider:()=>o.Styles.createViewStyle({height:1}),itemContainer:()=>o.Styles.createViewStyle({paddingHorizontal:20}),participantDividerPadding:()=>o.Styles.createViewStyle({marginLeft:50}),sectionTitle:()=>o.Styles.createViewStyle({height:48,flexDirection:"row",alignItems:"center",justifyContent:"flex-start"}),sectionTitleWithButton:()=>o.Styles.createViewStyle({height:48,flexDirection:"row",alignItems:"center",justifyContent:"space-between"}),ringAllButton:()=>o.Styles.createTextStyle({color:b.Color.blue})});class V extends I.default{constructor(){super(...arguments),this._handleRingAgain=e=>{r.default.CallParticipantUtils.addUsersToCallOrRing([e],this.props.callId,this.props.conversationMri,[e],h.NavigationAddToCallOrigin.RosterView);const t=P.default.newCauseId();C.log(h.LogTraceArea.CallingUI,`[CallRosterContent] _addParticipantsToCall, causeId: ${t}`),v.default.updateCallRosterTelemetry(this.props.callId,t,(e=>e.callRosterRangUser())),a.every(this.state.inactiveParticipants,(t=>!0===t.isRinging||t.key===e))&&this.props.onCloseRoster&&this.props.onCloseRoster()},this._onRingTheGroupButtonPress=()=>{y.default.handleRingTheGroup(this.props.conversationMri,this.props.callId);const e=S.getString("CallPanel.GroupCallRingingStatusMessage");o.Accessibility.announceForAccessibility(e);const t=P.default.newCauseId();C.log(h.LogTraceArea.CallingUI,`[CallRosterContent] _onRingTheGroupButtonPress, causeId: ${t}`),v.default.updateCallRosterTelemetry(this.props.callId,t,(e=>e.callRosterRingTheGroup())),this.props.onCloseRoster&&this.props.onCloseRoster()},this._renderItem=e=>{if(e.key===k){const t=S.getString("CallPanel.CallRosterPresentTitle");return o.createElement(o.View,{key:e.key,style:[R.sectionTitle,R.itemContainer]},o.createElement(_.SectionTitle,{key:e.key,title:t,titleStyles:T.default.flexOne}))}const t=this._renderRingTheGroupButton();if(e.key===A){const i=S.getString("CallPanel.CallRosterAbsentTitle"),a=t?R.sectionTitleWithButton:R.sectionTitle;return o.createElement(o.View,{key:e.key,style:[a,R.itemContainer]},o.createElement(_.SectionTitle,{key:e.key,title:i,titleStyles:T.default.flexOne}),t)}let i,a=[R.itemDivider,this._themeStyles.dividerColorStyle];if(e.key===M)i=o.createElement(g.default,{key:e.key,conversationId:this.props.conversationMri,callId:this.props.callId,origin:p.ShareGroupButtonOrigin.CallRosterPanel,hideDivider:!0,renderAsListItem:!0});else{const t=this.state.allParticipants[e.key];i=o.createElement(l.default,{key:e.key,userMri:e.key,callId:this.props.callId,isPresent:t.isActive,isTalking:t.isTalking,isLocal:t.isLocal,isLocalMuteSupported:t.isLocalMuteSupported,isRinging:t.isRinging,isServerMuted:t.isServerMuted,isServerMutedSupported:t.isServerMutedSupported,isLocalMuted:t.isLocalMuted,onRingAgainClicked:this._handleRingAgain}),a.push(R.participantDividerPadding)}return o.createElement(o.View,{style:R.itemContainer},i,o.createElement(u.default,{key:"itemDivider",style:a}))}}_buildState(e,t){const i=r.default.CallingStore.isCallConnected(e.callId);let a=c.default.getAllMembersWithActiveAndInactiveParticipants(e.conversationMri,e.callId,t?{}:this.state.allParticipants),n=a.activeParticipants,o=a.inactiveParticipants;return{allParticipants:a.allParticipants,activeParticipants:n,inactiveParticipants:o,isCallConnected:i,safeAreaHorizontalInsets:f.default.horizontalInsets(d.HorizontalInsetDefault),isGroupJoinLinkEnabled:s.default.getS4LCMCFeatures().enableCallRosterGroupJoinLink,ringlessCallType:y.default.getRinglessCallType(e.conversationMri,e.callId)}}render(){let e=[];this.state.isGroupJoinLinkEnabled&&e.push({key:M,height:70,template:"dcrp_action",accessibilityTrait:o.Types.AccessibilityTrait.Button});let t=[];this.state.activeParticipants.length&&(t.push({key:k,height:48,template:"crv_header"}),a.each(this.state.activeParticipants,(e=>{t.push({key:e.key,height:55,template:"crv_participant"})})));let i=[];return this.state.inactiveParticipants.length&&(i.push({key:A,height:48,template:"crv_header"}),a.each(this.state.inactiveParticipants,(e=>{i.push({key:e.key,height:55,template:"crv_participant"})}))),o.createElement(o.View,{style:T.default.flexOne},o.createElement(n.VirtualListView,{itemList:a.union(e,t,i),renderItem:this._renderItem,animateChanges:!0,keyboardShouldPersistTaps:!0,horizontalPadding:this.state.safeAreaHorizontalInsets}))}_renderRingTheGroupButton(){if(!y.default.isLocallyStartedRinglessCall(this.props.conversationMri,this.props.callId)||!this.state.isCallConnected||r.default.CallingStore.hasRingingParticipants(this.props.callId,!0)||this.state.ringlessCallType!==y.LocallyStartedRinglessCallType.SmallGroup)return;const e=S.getString("CallPanel.GroupCallRingAllButtonTitle");return o.createElement(o.Button,{accessibilityLabel:e,onPress:this._onRingTheGroupButtonPress},o.createElement(w.Caption,{style:R.ringAllButton,selected:!0},e))}}t.default=V},719:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(89391),o=i(94224),s=i(47176),r=i(71727),l=i(71830),c=i(39549),d=i(46096),u=i(39285),h=i(13944),p=i(10117),g=i(36237),C=i(15877),m=i(33754),S=i(51072),y=i(44972),f=i(99189),_=i(90244),b=i(54306),T=i(81760),v=i(11828),w=i(80837),I=i(90970),P=i(19675),M=i(24576),k=i(2301),A=i(67977),R=i(72758),V=i(92772),L=i(53374),E=i(13125),B=i(80200),O=A.UserIconSize.Size40,D=(0,C.lazyProperties)({listItem:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),userIconContainer:()=>a.Styles.createViewStyle({width:50,height:50,alignItems:"flex-start",justifyContent:"center",overflow:"visible"}),ringingView:()=>a.Styles.createViewStyle({position:"absolute",width:O,height:O,borderRadius:O/2,alignItems:"center",justifyContent:"center",backgroundColor:T.Color.blackOverlay50}),optionalIconButton:()=>a.Styles.createViewStyle({alignItems:"center",backgroundColor:T.Color.transparent,paddingLeft:25,paddingRight:10}),optionalButton:()=>a.Styles.createViewStyle({alignItems:"center",backgroundColor:T.Color.transparent,paddingLeft:25}),raiseHandBorderStyle:()=>a.Styles.createViewStyle({borderColor:T.Color.raiseHandOrange,borderWidth:2})});class x extends M.default{constructor(){super(...arguments),this._handleLocalHangup=e=>{const t=L.default.newCauseId();g.log(d.LogTraceArea.CallingUI,`[CallRosterListItem] _handleLocalHangup, causeId: ${t}`),o.default.CallingStore.endCall(this.props.callId,t),I.default.updateCallRosterTelemetry(this.props.callId,t,(e=>e.callRosterRemovedUser()))},this._handleRemoteHangup=e=>{const t=L.default.newCauseId();g.log(d.LogTraceArea.CallingUI,`[CallRosterListItem] _handleRemoteHangup, causeId: ${t}`),s.default.handleRemoteHangup(e,this.props.callId,t),I.default.updateCallRosterTelemetry(this.props.callId,t,(e=>e.callRosterRemovedUser()))},this._onMuteOrUnMuteButtonPress=e=>{e.stopPropagation();const t=L.default.newCauseId();this.props.isLocal?(g.log(d.LogTraceArea.CallingUI,`[CallRosterListItem:_onMuteOrUnMuteButtonPress] handleLocalMuteOrUnmute, causeId: ${t}`),r.default.announceMicrophoneState(s.default.handleLocalMuteOrUnmute(this.props.callId,t))):(g.log(d.LogTraceArea.CallingUI,`[CallRosterListItem:_onMuteOrUnMuteButtonPress] _handleRemoteMute, causeId: ${t}`),s.default.handleRemoteMute(this.props.userMri,this.props.callId,t))},this._onRingAgainOrHangUpButtonPress=e=>{e.stopPropagation(),this.props.isPresent?this.props.isLocal?this._handleLocalHangup(this.props.userMri):this._handleRemoteHangup(this.props.userMri):this.props.onRingAgainClicked(this.props.userMri)},this._onPinUnpinPressed=()=>{this._pinUnpinCommand.execute()},this._onLowerHandPressed=()=>{this._lowerHandParticipantCommand.execute(),r.default.announceLoweredHandState(!!this.props.isLocal,this.state.displayName)},this._onHoverStart=e=>{this.setState({isHovering:!0})},this._onHoverEnd=e=>{this.setState({isHovering:!1})}}_buildState(e,t){const i=R.default.getDisplayableUserByMri(e.userMri),a=o.default.CallingStore.getCallConversationMri(e.callId),s=a&&(0,c.default)().getConversation(a),d=i?i.getDisplayName():m.getString("DisplayInfoStore.ListMyName"),u=e.isLocal?B.CallStageElementKeys.localUserKey:e.userMri;return t&&(this._lowerHandParticipantCommand=new f.LowerHandParticipantCommand(e.callId,e.userMri,b.LowerHandOrigin.ParticipantsPanel,!!e.isLocal,d),this._pinUnpinCommand=new E.PinUnpinCommand(u,e.callId)),{userProfile:l.isAgent(e.userMri)?void 0:i,displayName:d,isEnabledRemoteMute:n.default.getS4LCMCFeatures().enableRemoteMute,hideMuteIcon:(0,y.isRegularMemberInModeratedGroup)(s)&&!e.isLocal,hideCallIcon:(0,y.isRegularMemberInModeratedGroup)(s),canHandBeLowered:this._lowerHandParticipantCommand.canExecute(),isHandRaised:this._lowerHandParticipantCommand.isHandRaised(),isPinned:r.default.isCallParticipantPinned(u,e.callId),isPinningFeatureAllowed:e.isPresent&&(r.default.shouldShowCallParticipantPinOption(u,e.callId)||r.default.shouldShowCallParticipantUnpinOption(u,e.callId))}}_renderRingAgainOrHangUpIcon(){let e;if(!this.props.isRinging&&!this.state.hideCallIcon){let t,i;this.props.isPresent?(t=v.SkypeIcon.CallEnd,i=m.getString("CallControls.CallButtonEndCall")):(t=v.SkypeIcon.CallStart,i=m.getString("SkypeUserListItem.RingButtonLabel")),e=this._renderIconButton(this._onRingAgainOrHangUpButtonPress,t,i)}return e}_renderRemoteMuteOrUnMuteIcon(){let e;if(!this.state.isEnabledRemoteMute||this.state.hideMuteIcon)return e;if(!this.props.isRinging&&this.props.isPresent){let t=s.default.getIconTitleForMuteOrUnMute(this.props.isLocalMuteSupported,this.props.isLocal,this.props.isLocalMuted,this.props.isServerMutedSupported,this.props.isServerMuted);e=this._renderIconButton(this._onMuteOrUnMuteButtonPress,t.icon,t.title,t.disableIcon)}return e}_renderOptionalLowerHandIcon(){if(!this.state.canHandBeLowered)return;const e=m.getString("CallControls.LowerHand");return this._renderIconButton(this._onLowerHandPressed,v.SkypeIcon.RaiseHandCrossed,e)}_renderOptionalPinUnpinButton(){if(!this.state.isPinningFeatureAllowed)return;if(!this.state.isPinned&&!this.state.isHovering)return;const e=this.state.isPinned?m.getString("CallControls.UnpinParticipant"):m.getString("CallControls.PinParticipant"),t=this.state.isPinned?v.SkypeIcon.PinOff:v.SkypeIcon.Pin;return this._renderIconButton(this._onPinUnpinPressed,t,e)}_renderIconButton(e,t,i,n=!1){return a.createElement(h.default,{size:v.IconSize.size24,onPress:e,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,icon:t,style:D.optionalIconButton,title:i,accessibilityLabel:this.state.displayName+","+i,disabled:n})}render(){const e=this.props.isRinging?a.createElement(a.View,{style:D.ringingView},a.createElement(p.default,{icon:v.SkypeIcon.CallAnimSmall4,color:T.Color.white,size:v.IconSize.size20})):void 0,t=this.state.isHandRaised?a.createElement(_.default,{type:_.RaiseHandImageType.SmallSizeTopLeftAligned}):void 0;return a.createElement(S.default.View,{onMouseEnter:this._onHoverStart,onMouseLeave:this._onHoverEnd,style:[D.listItem,w.default.defaultCursor],importantForAccessibility:a.Types.ImportantForAccessibility.Yes,accessibilityLabel:this.state.displayName},a.createElement(u.default,{style:D.userIconContainer},a.createElement(k.UserIcon,{key:"userIcon",userMri:this.props.userMri,size:O,useCircleForAgentMask:!0,statusBorderColor:this._themeColors.primaryBackgroundColor,statusTypes:V.getAllowedStatuses(this.props.userMri),imageBorderStyleOverride:this.state.isHandRaised?D.raiseHandBorderStyle:void 0}),e,t),a.createElement(a.View,{key:"text",style:w.default.flexOne,importantForAccessibility:a.Types.ImportantForAccessibility.NoHideDescendants},a.createElement(P.RowTitle,{numberOfLines:1,textThemeColor:P.TextThemeColor.Primary},this.state.displayName)),this._renderOptionalPinUnpinButton(),this._renderOptionalLowerHandIcon(),this._renderRemoteMuteOrUnMuteIcon(),this._renderRingAgainOrHangUpIcon())}}t.default=x},96625:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(96486),o=i(13598),s=i(2278),r=i(36237),l=i(46096),c=i(47126),d=i(40363);t.default=class{constructor(e){this._zoomLevel=o.ZoomLevelBoundaries.DefaultLevel,this._zoomPositionSizes={originalHeight:0,originalWidth:0,centerX:0,centerY:0,mouseX:0,mouseY:0,mouseCenterDistanceX:0,mouseCenterDistanceY:0},this._active=!1,this._callId="",this._isCtrlPressed=!1,this._isDragging=!1,this._dragInitCoords={x:0,y:0},this._dragFinalCoords={x:0,y:0},this._currentTopDragDifference=0,this._currentLeftDragDifference=0,this._currentTopPosition=0,this._currentLeftPosition=0,this._lastZoomTimestamp=0,this._minZoomDelay=o.ZoomDelayValues.MinDelay,this._zoomedStartTimestamp=0,this._hasDraggedOnce=!1,this._isZoomedIn=!1,this._onKeyDown=e=>(!this._isCtrlPressed&&this._isKeyCtrl(e)&&(r.log(l.LogTraceArea.ScreenSharing,`ScreenShareZoomController CtrlPressed ${e.keyCode}`),this._isCtrlPressed=e.keyCode),!1),this._onKeyUp=e=>this._isCtrlPressed===e.keyCode?(r.log(l.LogTraceArea.ScreenSharing,`ScreenShareZoomController CtrlReleased ${e.keyCode}`),this._isCtrlPressed=!1,!1):!(d.default.getPlatformType()!==l.PlatformType.OSX||e.keyCode!==c.default.MINUS&&e.keyCode!==c.default.PLUS||!e.ctrlKey)&&(this.handleKeyboardZoom(e.keyCode),!0),this.stop=()=>{this._active&&(this._active=!1,a.Input.keyDownEvent.unsubscribe(this._onKeyDown),a.Input.keyUpEvent.unsubscribe(this._onKeyUp),r.log(l.LogTraceArea.ScreenSharing,"ScreenShareZoomController stop"),this._resetZoom(!0),this._resetDragValues(!0),this._callId="",this._isZoomedIn=!1)},this.handleKeyboardZoom=e=>{const t=e===c.default.MINUS;r.log(l.LogTraceArea.ScreenSharing,`ScreenShareZoomController handleKeyboardZoom isZoomOut: ${t}`);const i=t?this._zoomLevel-1:this._zoomLevel+1;this._isZoomLevelAllowed(i)&&this._handleZoom(void 0,i,o.ScreenShareZoomType.Keyboard)},this.handleUIControlsZoom=e=>{r.log(l.LogTraceArea.ScreenSharing,`ScreenShareZoomController handleUIControlsZoom zoomLevel: ${e}`),this._handleZoom(void 0,e,o.ScreenShareZoomType.UIControls)},this.handleScrollZoom=e=>{if(this._isKeyCtrl(e)){const t=this._isCtrlPressed?o.ScreenShareZoomType.ScrollWheel:o.ScreenShareZoomType.TrackPad;this._handleZoom(e,void 0,t)}},this.updateScreenShareElementSizes=e=>{r.log(l.LogTraceArea.ScreenSharing,"ScreenShareZoomController updateScreenShareElementSizes resize"),this._setZoomPositionSizes(e)},this.handleDragging=e=>{if(this._zoomLevel){if(!this._isDragging)return void this._startDragging(e);if(e.isComplete)return void this._stopDragging();this._handleDragging(e)}},this._handleZoom=(e,t,i)=>{const a=this._getVideoElement();if(!a||this._isDragging||this._zoomLevel===t)return;r.log(l.LogTraceArea.ScreenSharing,`ScreenShareZoomController _handleZoom zoomLevelValue: ${t}, zoomType:${i}`);let n=t||o.ZoomLevelBoundaries.DefaultLevel;if(e&&void 0!==n){if(!this._isZoomAllowed(e.timeStamp,i===o.ScreenShareZoomType.TrackPad))return;const t=e.scrollAmount>0,a=t?-1:1;n=this._zoomLevel+a,r.log(l.LogTraceArea.ScreenSharing,`ScreenShareZoomController _handleZoom zoomLevel: ${n}, scrolledDown: ${t}`)}if(!this._isZoomLevelAllowed(n))return;const s=this._zoomLevel===o.ZoomLevelBoundaries.DefaultLevel;this._setZoomLevel(n,i);const c=-25*this._zoomLevel+"%";a.handleZoom(c),this._zoomLevel!==o.ZoomLevelBoundaries.DefaultLevel?this._repositionZoom(e,s,!1):this._resetZoom()},this._sendZoomChangeToTelemetry=(e,t,i,a)=>{const n=t>0&&!this._isZoomedIn,o=0===t&&this._isZoomedIn;void 0!==i&&s.default.onZoomChangeType(e,i),n?this._sendZoomInTelemetry(e,a):o&&this._sendZoomOutTelemetry(e,a)},this._sendZoomInTelemetry=(e,t)=>{this._zoomedStartTimestamp=t,this._isZoomedIn=!0,s.default.onZoomIn(e)},this._sendZoomOutTelemetry=(e,t,i)=>{const a=t-this._zoomedStartTimestamp;this._zoomedStartTimestamp=0,this._isZoomedIn=!1,s.default.onZoomOut(e,a,i)},this._sendZoomChangeToTelemetryDebounce=n.debounce(this._sendZoomChangeToTelemetry,1e3),this._resetZoom=e=>{this._zoomLevel!==o.ZoomLevelBoundaries.DefaultLevel&&this._setZoomLevel(o.ZoomLevelBoundaries.DefaultLevel),this._zoomPositionSizes.mouseCenterDistanceX=0,this._zoomPositionSizes.mouseCenterDistanceY=0,this._setPosition({x:0,y:0},void 0,e)},this._getCurrentSizes=()=>{const{originalHeight:e,originalWidth:t}=this._zoomPositionSizes,i=1+this._zoomLevel/2,a=e*i,n=t*i,o=(a-e)/2,s=(n-t)/2;return{currentHeight:a,currentWidth:n,minT:o,minL:-s,maxT:-o,maxL:s}},this._handleDragging=({clientX:e,clientY:t})=>{this._isDragging&&(this._currentTopDragDifference=t-this._dragInitCoords.y,this._currentLeftDragDifference=e-this._dragInitCoords.x,this._dragFinalCoords.y=this._currentTopPosition+this._currentTopDragDifference,this._dragFinalCoords.x=this._currentLeftPosition+this._currentLeftDragDifference,this._setPosition(this._dragFinalCoords,!0))},this._stopDragging=()=>{if(this._isDragging){this._isDragging=!1,r.log(l.LogTraceArea.ScreenSharing,"ScreenShareZoomController _stopDragging"),this._handleToggleZoomPositionAnimation(!0);const e=1+this._zoomLevel/2,t=this._zoomPositionSizes.mouseCenterDistanceX+this._currentLeftDragDifference/e,i=this._zoomPositionSizes.mouseCenterDistanceY+this._currentTopDragDifference/e;this._zoomPositionSizes.mouseCenterDistanceY=i,this._zoomPositionSizes.mouseCenterDistanceX=t,this._zoomPositionSizes.mouseX=this._zoomPositionSizes.centerX-this._zoomPositionSizes.mouseCenterDistanceX,this._zoomPositionSizes.mouseY=this._zoomPositionSizes.centerY-this._zoomPositionSizes.mouseCenterDistanceY,this._setPosition(this._dragFinalCoords),this._resetDragValues()}},this._onMouseCursorChange=e.onMouseCursorChange,this._onZoomLevelChange=e.onZoomLevelChange,this._getVideoElementCallback=e.getVideoElement,this._callId=e.callId,this._active=!0,a.Input.keyDownEvent.subscribe(this._onKeyDown),a.Input.keyUpEvent.subscribe(this._onKeyUp)}_isKeyCtrl(e){return e.ctrlKey||d.default.getPlatformType()===l.PlatformType.OSX&&e.metaKey}_isZoomLevelAllowed(e){return e>=o.ZoomLevelBoundaries.DefaultLevel&&e<=o.ZoomLevelBoundaries.MaxLevel}_isZoomAllowed(e,t){const i=e-this._lastZoomTimestamp;if(i<this._minZoomDelay){const e=t?o.ZoomDelayValues.TrackPadDelay:o.ZoomDelayValues.MaxDelay;return this._minZoomDelay!==e&&(this._minZoomDelay=e),r.log(l.LogTraceArea.ScreenSharing,`ScreenShareZoomController zoom rejected, durationSinceLastZoom: ${i}`),!1}return this._minZoomDelay!==o.ZoomDelayValues.MinDelay&&(this._minZoomDelay=o.ZoomDelayValues.MinDelay),this._lastZoomTimestamp=e,!0}_setZoomLevel(e,t){this._zoomLevel=e,this._onZoomLevelChange&&this._onZoomLevelChange(this._zoomLevel),r.log(l.LogTraceArea.ScreenSharing,`ScreenShareZoomController new zoom level  _zoomLevel: ${this._zoomLevel}, zoomType:${t}`);const i=Date.now();this._active?this._sendZoomChangeToTelemetryDebounce(this._callId,this._zoomLevel,t,i):this._isZoomedIn&&this._sendZoomOutTelemetry(this._callId,i,!0),this._toggleHandCursor()}_getVideoElement(){if(this._getVideoElementCallback){return this._getVideoElementCallback()}return null}_setZoomPositionSizes(e){const t=this._getVideoElement();if(!t)return;r.log(l.LogTraceArea.ScreenSharing,"ScreenShareZoomController _setZoomPositionSizes");const i=e||t.getZoomControllerRect();if(i){const[t,a]=[i.width,i.height];if(!t||!a)return r.log(l.LogTraceArea.ScreenSharing,"ScreenShareZoomController _setZoomPositionSizes width/height bug"),void this._resetZoom();const[n,o]=[t/2,a/2],s=this._zoomPositionSizes.centerX/n,c=this._zoomPositionSizes.centerY/o,d=this._zoomPositionSizes.mouseX/s,u=this._zoomPositionSizes.mouseY/c;this._zoomPositionSizes=Object.assign(Object.assign({},this._zoomPositionSizes),{originalHeight:a,originalWidth:t,centerX:n,centerY:o,mouseX:d,mouseY:u}),e&&(this._handleToggleZoomPositionAnimation(!1),this._isDragging||this._repositionZoom(void 0,!0,!0))}}_repositionZoom(e,t,i){const{centerX:a,centerY:o}=this._zoomPositionSizes;let{mouseX:s,mouseY:r}=this._zoomPositionSizes;t&&(i||([s,r]=e?[e.clientX,e.clientY]:[a,o],this._zoomPositionSizes.mouseX=s,this._zoomPositionSizes.mouseY=r),this._zoomPositionSizes.mouseCenterDistanceX=a-s,this._zoomPositionSizes.mouseCenterDistanceY=o-r);const{mouseCenterDistanceY:l,mouseCenterDistanceX:c}=this._zoomPositionSizes,d=l+this._zoomLevel/2*l,u=c+this._zoomLevel/2*c;this._setPosition({y:d,x:u}),i&&n.delay((()=>this._handleToggleZoomPositionAnimation(!0)),50)}_setPosition(e,t,i){if(i)return this._currentTopPosition=e.y,void(this._currentLeftPosition=e.x);const a=this._getVideoElement();if(a){const{minT:i,maxT:n,minL:o,maxL:s}=this._getCurrentSizes(),r=i<e.y?i:n>e.y?n:e.y,l=o<e.x?e.x>s?s:e.x:o;t||(this._currentTopPosition=r,this._currentLeftPosition=l),a.handleZoomPositionUpdate(l+"px",r+"px")}}_startDragging({clientX:e,clientY:t}){this._isDragging=!0,r.log(l.LogTraceArea.ScreenSharing,"ScreenShareZoomController _startDragging"),this._hasDraggedOnce||(s.default.onZoomDragUsed(this._callId),this._hasDraggedOnce=!0),this._dragInitCoords={x:e,y:t},this._toggleHandCursor(!0),this._handleToggleZoomPositionAnimation(!1)}_resetDragValues(e){this._isDragging=!1,this._hasDraggedOnce=!1,this._dragInitCoords={x:0,y:0},this._dragFinalCoords={x:0,y:0},this._currentTopDragDifference=0,this._currentLeftDragDifference=0,e||this._toggleHandCursor()}_toggleHandCursor(e){if(!this._onMouseCursorChange)return;let t=a.Types.GestureMouseCursor.Default;this._zoomLevel>o.ZoomLevelBoundaries.DefaultLevel&&(t=e?a.Types.GestureMouseCursor.Grabbing:a.Types.GestureMouseCursor.Grab),this._onMouseCursorChange(t),r.log(l.LogTraceArea.ScreenSharing,`ScreenShareZoomController apply cursor: ${t}`)}_handleToggleZoomPositionAnimation(e){const t=this._getVideoElement();t&&t.togglePositionChangeAnimation(e)}}},40565:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallStageDropTarget=t.CallStageDropTargetType=t.CallStageDropTargetAnimationStyle=void 0;const a=i(96486),n=i(38933),o=i(16778),s=i(88837),r=i(81770),l=i(12854),c=i(10117),d=i(61253),u=i(15877),h=i(89808),p=i(81115),g=i(81760),C=i(11828),m=i(80837),S=(0,u.lazyProperties)({container:()=>o.Styles.createViewStyle({position:"absolute",justifyContent:"center",alignItems:"center"}),gradientContainer:()=>o.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,opacity:.65}),gradientBorder:()=>o.Styles.createViewStyle({borderColor:g.Color.white,opacity:.2,borderWidth:10,top:0,left:0,borderStyle:"solid"}),gradientDashedBorder:()=>o.Styles.createViewStyle({borderColor:g.Color.white,opacity:.5,borderWidth:1,top:0,left:0,borderStyle:"dashed",borderRadius:10}),iconContainer:()=>o.Styles.createViewStyle({width:72,height:72,justifyContent:"center",alignItems:"center",overflow:"hidden"})});var y;!function(e){e[e.None=0]="None",e[e.SlideIn=1]="SlideIn",e[e.FadeIn=2]="FadeIn"}(t.CallStageDropTargetAnimationStyle||(t.CallStageDropTargetAnimationStyle={})),function(e){e[e.Foreground=0]="Foreground",e[e.Background=1]="Background"}(y=t.CallStageDropTargetType||(t.CallStageDropTargetType={}));class f extends s.ComponentBase{constructor(){super(...arguments),this._animatedTopValue=new o.Animated.Value(0),this._animatedHeightValue=new o.Animated.Value(0),this._animatedLeftValue=new o.Animated.Value(0),this._animatedWidthValue=new o.Animated.Value(0),this._animatedOpacityValue=new o.Animated.Value(0),this._animatedStyles=o.Styles.createAnimatedViewStyle({top:this._animatedTopValue,left:this._animatedLeftValue,height:this._animatedHeightValue,width:this._animatedWidthValue,opacity:this._animatedOpacityValue}),this._animatedScaleValue=new o.Animated.Value(1),this._animatedScaleStyle=o.Styles.createAnimatedViewStyle({transform:[{scale:this._animatedScaleValue}]})}_buildState(e,t){return{config:r.default.getCurrentDraggingParticipantConfig(),gradientColors:h.default.getGradientColors()}}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),!this.state.config)return this._animatedScaleValue.setValue(1),void(t.config&&l.default.unprepareFeedback());if(this.state.config&&!t.config){const e=this.state.config.dropTargetViewRect;this._animatedHeightValue.setValue(e.height),this._animatedWidthValue.setValue(e.width),this._animatedLeftValue.setValue(e.x),this._animatedTopValue.setValue(e.y-e.height),this._animatedOpacityValue.setValue(0)}a.isUndefined(this.state.config.showDropTarget)||(this._showOrHide(),l.default.prepareFeedback()),f._selectDropTarget(this.state.config)&&!f._selectDropTarget(t.config)&&l.default.triggerFeedback();const n=!!t.config&&t.config.selectDropTarget,s=!!this.state.config&&this.state.config.selectDropTarget;if(n!==s&&this.props.type!==y.Background){const e=[];e.push(o.Animated.timing(this._animatedScaleValue,{toValue:s?1.2:1,duration:300,easing:o.Animated.Easing.OutBack()})),o.Animated.parallel(e).start()}const r=this.state.config?this.state.config.dropTargetViewRect:void 0,c=t.config?t.config.dropTargetViewRect:void 0;!(0,d.default)(c,r)&&r&&(this._animatedTopValue.setValue(r.y),this._animatedLeftValue.setValue(r.x),this._animatedHeightValue.setValue(r.height),this._animatedWidthValue.setValue(r.width))}_showOrHide(e){if(!this.state.config)return;const t=this.state.config.showDropTarget,i=t?this.state.config.dropTargetViewRect.y:this.state.config.dropTargetViewRect.y-this.state.config.dropTargetViewRect.height,a=t?1:0;this._animatedOpacityValue.setValue(a),this._animatedTopValue.setValue(i)}_containerStyles(){return[S.container,this._animatedStyles]}render(){if(!this.state.config)return null;let e,t=[this.props.style];t.push(this._containerStyles()),this.props.type===y.Background||this.state.config.isVideoPreviewAndFloatingOnTop||(e=o.createElement(o.Animated.View,{style:[S.iconContainer,this._animatedScaleStyle]},o.createElement(c.default,{icon:this.state.config.selectDropTarget||this.state.config.confirmOnly?C.SkypeIcon.Ok:C.SkypeIcon.Plus,size:C.IconSize.size32,color:g.Color.white})),this.state.config.topPadding&&t.push(p.default.paddingTopStyle(this.state.config.topPadding)));const i=this.state.config.isVideoPreviewAndFloatingOnTop?S.gradientDashedBorder:S.gradientBorder,a=this.props.type===y.Foreground&&this.state.config.selectDropTarget?o.createElement(o.View,{style:[S.gradientContainer,i]}):void 0,s=this.props.type!==y.Background||this.state.config.isVideoPreviewAndFloatingOnTop?void 0:o.createElement(o.View,{style:S.gradientContainer},o.createElement(n.GradientView,{style:m.default.flexOne,colors:this.state.gradientColors,direction:n.GradientDirection.BOTTOM_RIGHT}));return o.createElement(o.Animated.View,{style:t,blockPointerEvents:!0,ignorePointerEvents:!0},s,e,a)}static _selectDropTarget(e){return!!e&&e.selectDropTarget}}t.CallStageDropTarget=f,t.default=f},75377:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallStageLayoutController=void 0;const a=i(96486),n=i(89391),o=i(81783),s=i(80200),r=i(80200),l=i(71727),c=i(61253),d=i(30124);i(60305);class u{constructor(e){this._isCallStageV2=e,this._controllers={},this._verticalOffset=r.RibbonSizes.defaultRibbonItemTopMargin,this._baseRightInset=r.RibbonSizes.ribbonItemMargin,this._ribbonScrollRightInset=0,this._ribbonContentWidth=0,this._ribbonExpandedMultiplier=1,this._participantDragState=r.ParticipantDragState.Unspecified,this._maxStageElements=4,this._maxElementsInRow=2,this._maxElementsInColumn=2,this._totalStageElements=0,this._videosDimensionsList=[],this._isStageLandscape=!0,this._isGridSquare=!1,this._narrowOrWide=!1,this._enableRNStreamsV2=n.default.getS4LCMCFeaturesNoSubscription().enableRNStreamsV2}updateLayoutInfoForStage(e,t){const i=(0,c.default)(this._stageRect,t);this._updateStageElements(t.width,t.height,e.length),this._updateStageLayout(e,t,i),this._stageRect=t}updateLayoutInfo(e,t,i,n,o,l,d,u,h,p=!0,g=!1,C=0,m=!1,S=0){const y=a.filter(e,(e=>!!e.displayOnStage)),f=p&&(0,c.default)(this._stageRect,t);if(this._updateStageElements(t.width,t.height,y.length),this._updateStageLayout(y,t,f),this._stageRect=t,m)return 0;let _=C,b=C,T=C,v=-1;const w=a.filter(e,(e=>!e.displayOnStage&&!e.isHiddenBot)),I=w?w.length:0,P=S||i;let M=l-i*h-P,k=0;a.each(w,((e,t)=>{e.isLocal&&e.videoType!==s.LayoutInfoVideoType.None&&(M-=n);const a=e.ribbonPosition,l=a>v;let c=e.isLocal&&e.videoType!==s.LayoutInfoVideoType.None?n:i;const d=this.controllerForKey(e.key).getResizeFactor();d>1&&(c*=d);const u=e.key===r.CallStageElementKeys.ribbonModeViewKey?r.RibbonSizes.ribbonModeElementSize:c,h=c,p=this._positionElementInRibbon(e.key,e.videoType,e.videoAspectRatio,l?_:b,this._stageRect,{height:h,width:u},f,g);l&&(b=_,_=Math.max(_,p.x+p.width+r.RibbonSizes.ribbonItemInnerMargin),v=a,e.key===r.CallStageElementKeys.localUserKey&&(C=_));const m=this.controllerForKey(e.key);!o&&_>=M&&(k||t<I-1)||e.hidden?(m.setHidden(!0),k++):(m.setHidden(!1),T=_)}));const A=this.controllerForKey(r.CallStageElementKeys.remainderViewKey);if(k){const e=this._positionElementInRibbon(r.CallStageElementKeys.remainderViewKey,void 0,void 0,T,this._stageRect,{height:i,width:i},f);T+=e.width+r.RibbonSizes.ribbonItemInnerMargin,A.setHidden(!1)}else A.setHidden(!0);if(u!==r.RibbonExtraVisibility.None){const e=this.controllerForKey(r.CallStageElementKeys.addToCallViewKey),t=this._positionElementInRibbon(r.CallStageElementKeys.addToCallViewKey,void 0,void 0,T,this._stageRect,{height:i,width:i},f);T+=t.width+r.RibbonSizes.ribbonItemInnerMargin,e.setHidden(u===r.RibbonExtraVisibility.Hidden)}const R=this.controllerForKey(r.CallStageElementKeys.ribbonModeViewKey),V=this._positionElementInRibbon(r.CallStageElementKeys.ribbonModeViewKey,void 0,void 0,T,this._stageRect,{height:i,width:P},f);return T+=V.width+r.RibbonSizes.ribbonItemInnerMargin,R.setHidden(d===r.RibbonExtraVisibility.Hidden),this._ribbonContentWidth=T,this._updateRibbonScrollInset(this._ribbonScrollRightInset,t,f),k}updateRibbonExpandedMultiplier(e,t,i=!1){this._ribbonExpandedMultiplier!==e&&(a.each(this._controllers,(a=>a.updateRibbonExpandedMultiplier(e,t,i))),this._ribbonExpandedMultiplier=e)}updateRibbonVerticalOffset(e,t=!1,i=r.CallStageConfig.animationDuration){this._verticalOffset!==e&&(a.each(this._controllers,(a=>a.updateRibbonVerticalOffset(e,this._stageRect,t,i))),this._verticalOffset=e)}ribbonWidth(){return this._ribbonContentWidth+this._baseRightInset}setCallHeaderPanelLayout(e){this._callPanelHeaderLayout=e,a.each(this._controllers,(t=>t.setCallHeaderPanelLayout(e)))}controllerForKey(e){let t=this._controllers[e];return t||(t=new o.CallItemLayoutController(e,this._verticalOffset,this._totalRibbonRightInset(),this._ribbonExpandedMultiplier,this._isCallStageV2),t.setCallHeaderPanelLayout(this._callPanelHeaderLayout),this._controllers[e]=t),t}setParticipantDragState(e){this._participantDragState=e}resetParticipantDragState(){this._onGestureComplete()}getParticipantDragState(){return this._participantDragState}onPan(e,t,i,a,n,o){if(!e)return this._panRibbon(i,a),!1;const s=this.controllerForKey(e);if(this._participantDragState!==r.ParticipantDragState.Move){if(s.isCompact()&&this._panRibbon(i,a))return!1;t&&(this._participantDragState=r.ParticipantDragState.Move)}this._participantDragState===r.ParticipantDragState.Move&&s.onPan(i,a,n);const l=this._participantDragState===r.ParticipantDragState.Move;return i.isComplete&&this._onGestureComplete(),l}getMaxNumberOfStageElements(){return this._maxStageElements}isStageLandscape(){return this._isStageLandscape}isGridSquare(){return this._isGridSquare}shouldSwitchOrientation(){return this.isStageLandscape()&&!this._narrowOrWide&&!this.isGridSquare()||!this.isStageLandscape()&&(this._narrowOrWide||this.isGridSquare())}_updateStageElements(e,t,i){if(0===e||0===t)return;const a=e/t,o=n.default.getS4LCMCFeaturesNoSubscription().modernCallStage,s=d.default.isUsingStackNavigationContextNoSubscription(),r=s?o.mobileMinVideoSize.width:o.minVideoSize.width,c=s?o.mobileMinVideoSize.height:o.minVideoSize.height;if(0===r||0===c)return;let u,h;if(u=Math.round(e/r),h=Math.round(t/c),this._maxElementsInColumn!==h||this._maxElementsInRow!==u||this._totalStageElements!==i){this._maxElementsInRow=u,this._maxElementsInColumn=h;const e=this._maxElementsInRow*this._maxElementsInColumn;this._maxStageElements=Math.min(o.maxStageElements,e);const t=l.default.getStageVideoCount(i,this._maxElementsInRow,this._maxElementsInColumn,a>1);this._totalStageElements=i,this._isGridSquare=t.width===t.height,this._isStageLandscape=a>1,this._narrowOrWide=!this._isGridSquare&&(a>2||a<1),this._videosDimensionsList=l.default.getSizesForStageElements([],i,t,this._isGridSquare?!this._isStageLandscape:this._isStageLandscape,t,this._narrowOrWide)}}_panRibbon(e,t){const i=this._shouldScrollRibbon(t)?20:0;if(this._participantDragState===r.ParticipantDragState.Pan||Math.abs(e.pageY-e.initialPageY)<i){if(!a.isUndefined(this._lastPageX)){const i=this._lastPageX-e.pageX;this._updateRibbonScrollInset(this._ribbonScrollRightInset+i,t),this._participantDragState===r.ParticipantDragState.Unspecified&&Math.abs(e.pageX-e.initialPageX)>20&&(this._participantDragState=r.ParticipantDragState.Pan)}return this._lastPageX=e.pageX,e.isComplete&&this._onGestureComplete(),!0}return!1}_onGestureComplete(){this._participantDragState=r.ParticipantDragState.Unspecified,this._lastPageX=void 0}_shouldScrollRibbon(e){return this._ribbonContentWidth+this._baseRightInset>e.width}_updateRibbonScrollInset(e,t,i=!1,n=r.CallStageConfig.animationDuration){let o=Math.min(e,0);const s=this._shouldScrollRibbon(t)?t.width-(this._ribbonContentWidth+this._baseRightInset):0;o=Math.max(o,s),this._ribbonScrollRightInset!==o&&(this._ribbonScrollRightInset=o,a.each(this._controllers,(e=>e.updateRibbonRightInset(this._totalRibbonRightInset(),t,i,n))))}_totalRibbonRightInset(){return this._baseRightInset+this._ribbonScrollRightInset}_positionElementInRibbon(e,t,i,a,n,o,r=!1,c=!1){const d=this.controllerForKey(e),u=l.default.ribbonLayoutRect(t,i,a,o,c,this._enableRNStreamsV2);return d.setRibbonPosition(u,!!t&&t!==s.LayoutInfoVideoType.None,n,o.width,r),u}_updateStageLayout(e,t,i=!1){a.each(e,(a=>{var n;const o=a.stagePosition,r=this.controllerForKey(a.key),c=this._videosDimensionsList[o],d=l.default.stageLayoutRect(t,c);a.isTopRow=l.default.isTopStageElement(e,this._currentElementKeyPositions,this._videosDimensionsList,o),r.setIsTopRowElement(null!==(n=a.isTopRow)&&void 0!==n&&n),r.setStagePosition(this._maxStageElements,d,o,a.videoType!==s.LayoutInfoVideoType.None,t,i,c),r.setHidden(!1)}))}setElementsPositions(e){const t={};for(let i=0;i<e.length;i++){const a=e[i];t[i]=a}this._currentElementKeyPositions=t}}t.CallStageLayoutController=u,t.default=u},47112:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallStageView=void 0;const a=i(74958),n=i(96486),o=i(38933),s=i(16778),r=i(48540),l=i(89391),c=i(20187),d=(i(78816),i(81770)),u=i(94224),h=i(68580),p=i(30098),g=i(37103),C=i(60289),m=i(40565),S=i(75377),y=i(36850),f=i(2278),_=i(80200),b=i(71727),T=i(46565),v=i(47447),w=i(86251),I=i(71830),P=i(11009),M=i(52262),k=i(46096),A=i(5581),R=i(3573),V=i(36237),L=i(61253),E=i(48638),B=i(72490),O=i(38817),D=i(15877),x=i(47662),N=i(33754),U=i(6250),F=i(18078),H=i(98053),z=i(85376),G=i(2952),W=i(77557),K=i(14976),j=i(51070),Q=i(36150),$=i(86045),q=i(62232),X=i(4057),Z=i(81760),J=i(80837),Y=i(24576),ee=i(12770),te=i(67977),ie=i(72758),ae=i(53374),ne="ss_",oe="video_",se=oe+_.CallStageElementKeys.localUserKey,re=(0,D.lazyProperties)({backdropContainer:()=>s.Styles.createViewStyle({position:"absolute",top:0,right:0}),ribbonBackdrop:()=>s.Styles.createViewStyle({flex:1,backgroundColor:Z.Color.transparent}),reactionsView:()=>J.default.absoluteFill,overlayTopContainer:()=>s.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0}),overlayBottomContainer:()=>s.Styles.createViewStyle({position:"absolute",left:0,right:0,bottom:0}),overlayContainer:()=>s.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,alignItems:"stretch",overflow:"visible",backgroundColor:Z.Color.blackOverlay20}),mobileOverlayShim:()=>s.Styles.createViewStyle({backgroundColor:Z.Color.blackOverlay50}),stageContainerStyle:()=>s.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:Z.Color.transparent,flex:1,flexDirection:"column",flexWrap:"wrap",justifyContent:"center",alignSelf:"center"}),windowTopOffsetStageContainerStyle:()=>s.Styles.createViewStyle({top:_.CallPanelHeaderHeight.window}),zeroTopOffsetStageContainerStyle:()=>s.Styles.createViewStyle({top:0}),modernStageLandscapeContainerStyle:()=>s.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap"})});class le extends Y.default{constructor(){super(...arguments),this._mappedVideos={},this._mappedRefs={},this._layoutController=new S.default(!1),this._mountedRefsMap=new U.default,this._latestVisibleRibbonCallItemKeys=[],this._localUserParticipantInfo={key:_.CallStageElementKeys.localUserKey,mri:F.default.getSkypeMri(),ribbonAddTime:0,connectionSortKey:0,streamsStatus:_.CallParticipantStreamsStatus.None},this._ribbonAnimatedWidthValue=new s.Animated.Value(0),this._ribbonAnimatedWidthStyle=s.Styles.createAnimatedViewStyle({width:this._ribbonAnimatedWidthValue}),this._stageReactionsAnimatedOpacityValue=new s.Animated.Value(1),this._stageReactionsAnimatedStyle=s.Styles.createAnimatedViewStyle({opacity:this._stageReactionsAnimatedOpacityValue}),this._suppressElementAnimation=!1,this._videoScalingMode={},this._screenshareScalingMode={},this._isVideoPreviewFloatingOnTop=!1,this._ribbonRightSideOffSetForVideoPreview=0,this._callReactionsDisplayHelper=new C.default,this._getRenderTargetViaKey=(e,t)=>{var i;const a=this._mountedRefsMap.ref(e);return a?null===(i=a.getVideoElement(t))||void 0===i?void 0:i.getVideoContainer():void 0},this._maybeUpdateRibbonVisibleElements=()=>{if(this.isComponentMounted()){const e=u.default.CallingStore.getRankedSpeakerMris(this.props.callId);if(this._latestVisibleRibbonCallItemKeys.length>0&&b.CallUIUtils.shouldReRenderVisibleRibbonItems(e,this._latestVisibleRibbonCallItemKeys,b.CallUIUtils.shouldRenderStage(this.state)?this.state.stageElements:[])){const e=ae.default.newCauseId();V.log(k.LogTraceArea.CallingUI,"CallStageView._maybeUpdateRibbonVisibleElements updating causeId: "+e),this._updateElementLayout(!1,this.state,this.props,e)}u.default.CallingStore.updateRankedVideoStreams(this.props.callId)}},this._resizeVideoPreviewFromKeyboard=(e,t)=>{const i=this._layoutControllerForLocalUser(),a=b.CallUIUtils.renderVideoPreview(this.state,this.props),n=this._ribbonItemHeight(this.state,!0,!0,!1);if(i&&i.getUIPosition&&this.props.enableFloatableResizableVideoPreview&&a&&i.getUIPosition()===_.CallingViewUIPostion.Ribbon){const e=Math.min(this.props.availableRibbonWidth-3*n,this.props.viewRect.width/2);if(i.viewRect&&i.setResizeFactor&&i.getResizeFactor){const t=i.viewRect(!0),a=e/n*t.height/t.width,o=b.CallUIUtils.getNextScaleFactor(i.getResizeFactor(),a,2);return i.setResizeFactor(o),this._updateElementLayout(!1,this.state,this.props,"_resizeVideoPreviewFromKeyBoard"),!0}}return!1},this._getCurrentCallPanelHeaderLayout=e=>e?e.callPanelHeaderLayout:this.props.callPanelHeaderLayout,this._shouldShowRibbonModeSelector=(e,t)=>{const i=t?t.showRibbonExtras:this.props.showRibbonExtras;return!(t?t.useMobileControls:this.props.useMobileControls)&&i},this._updateElementLink=(e,t,i,a,n,o,s,r)=>{V.log(k.LogTraceArea.CallingUI,"CallStageView._updateElementLink causeId: "+o);const l=oe+t;if(this._mappedRefs[l]!==i){if(this.props.enableFloatableResizableVideoPreview?(i||!i&&this._mappedRefs[l]===a)&&(this._mappedRefs[l]=i):this._mappedRefs[l]=i,!i){if(!this.props.enableFloatableResizableVideoPreview)return;if(l!==se)return}l===se?this._updateLocalVideoLink(o,r,!!i,a):this._updateRemoteVideoLink(t,s,e,this.state.allCallElements[e],o,r)}},this._onStageElementTap=(e,t)=>{if(this._suppressElementAnimation)return void V.log(k.LogTraceArea.CallingUI,"CallStageView._onStageElementTap ignored, layout animations suppressed");const i=this.state.useImmersiveMode&&this.state.enableImmersiveMode;this.props.onStageTap?(this.props.onStageTap(t),i&&ee.default.setTimeout((()=>{this.isComponentMounted()&&this.state.useImmersiveMode&&this._onToggleImmersiveMode()}),750)):i&&this._onToggleImmersiveMode()},this._onRibbonElementTap=e=>{if(this._suppressElementAnimation)return V.log(k.LogTraceArea.CallingUI,"CallStageView._onRibbonElementTap ignored, layout animations suppressed"),!1;const t=ae.default.newCauseId();return V.log(k.LogTraceArea.CallingUI,"CallStageView._onRibbonElementTap causeId: "+t),!n.includes(this.state.stageElements,e)&&(y.default.setStageMode(this.props.callId,_.StageMode.Manual,t),this._moveCallElement(e,!0,this.state.stageElements.length),!0)},this._onScreenshareTap=e=>{if(this._suppressElementAnimation)return V.log(k.LogTraceArea.CallingUI,"CallStageView._onScreenshareTap ignored, layout animations suppressed"),!1;const t=ae.default.newCauseId();return V.log(k.LogTraceArea.CallingUI,"CallStageView._onScreenshareTap causeId: "+t),!n.includes(this.state.stageElements,e)&&(this._changeCallLayoutCommand.execute(_.StageMode.FocusedScreenShare),!0)},this._onRemainderViewRef=e=>{this._remainderView=e||void 0},this._onRemainderViewPressed=()=>{const e=ae.default.newCauseId();V.log(k.LogTraceArea.CallingUI,"CallStageView._onRemainderViewPressed causeId: "+e),this._suppressElementAnimation?V.log(k.LogTraceArea.CallingUI,"CallStageView._onRemainderViewPressed ignored, layout animations suppressed"):this.props.onRemainderViewPressed&&this.props.onRemainderViewPressed(e)},this._onAddToCallViewPressed=()=>{const e=ae.default.newCauseId();V.log(k.LogTraceArea.CallingUI,"CallStageView._onAddToCallViewPressed causeId: "+e),this._suppressElementAnimation?V.log(k.LogTraceArea.CallingUI,"CallStageView._onAddToCallViewPressed ignored, layout animations suppressed"):this.props.onAddToCallPressed&&this.props.onAddToCallPressed(e,k.NavigationAddToCallOrigin.Ribbon)},this._onElementMouseOverOrOut=(e,t,i)=>{if(t&&i){if(!e)return void V.warn(k.LogTraceArea.Calling,"CallStageView._onElementMouseOverOrOut:key is empty");d.default.setHoveringParticipantConfig({key:e,source:_.HoveringParticipantSource.Participant})}else d.default.clearHoveringParticipantConfig(_.HoveringParticipantSource.Participant)},this._onDoubleTap=e=>{this.state.enableImmersiveMode?this._onToggleImmersiveMode():this.state.enableTapToMoveCallParticipant&&this._onToggleParticipantFocus(e)},this._onElementPressInOrOut=(e,t,i)=>{this.state.enableImmersiveMode||this._onPresentDropTargets(e,t,i)},this._onPresentDropTargets=(e,t,i)=>{if(i)if(t){const t=this._stageDropTarget(),i={key:e,dropTargetViewRect:t.rect,showDropTarget:!0,toStage:!0,targetStagePosition:t.targetPosition,confirmOnly:t.confirmOnly};d.default.setDraggingParticipantConfig(i)}else{const t=this.props.topInset||0,i={key:e,dropTargetViewRect:this._ribbonDropTarget(t),showDropTarget:!0,toStage:!1,topPadding:t};d.default.setDraggingParticipantConfig(i)}else this._layoutController.getParticipantDragState()!==_.ParticipantDragState.Move&&d.default.setDraggingParticipantConfig(void 0)},this._onElementScalingModeChanged=(e,t,i,n)=>{const o=ae.default.newCauseId();V.log(k.LogTraceArea.CallingUI,"CallStageView._onElementScalingModeChanged key: "+a.pii.Omit(e)+" scalingMode: "+i+" causeId: "+o);const s=t===r.StreamType.ScreenSharing?this._screenshareScalingMode:this._videoScalingMode,l=s[e];if(s[e]=i,I.isMri(e))u.default.RemoteStreamHelper.setScalingMode(this.props.callId,e,t,i,o,void 0,n).catch((t=>{V.warn(k.LogTraceArea.CallingUI,"CallStageView._onElementScalingModeChanged:Remote setScalingMode failed "+X.default.errorAsString(t)+" - reverting scalingMode to "+l+" causeId: "+o),s[e]=l}));else if(e===_.CallStageElementKeys.localUserKey){let t=this._mappedRefs[se];t&&u.default.CallingStore.setLocalVideoScalingMode(this.props.callId,t,i,o).then((t=>{t||(V.warn(k.LogTraceArea.CallingUI,"CallStageView._onElementScalingModeChanged:Local failed causeId: "+o),s[e]=l)}))}else V.log(k.LogTraceArea.CallingUI,"CallStageView._onElementScalingModeChanged skipping for non-MRI "+a.pii.Omit(e))},this._onToggleImmersiveMode=()=>{const e=!this.state.useImmersiveMode;this.setState({useImmersiveMode:e})},this._onToggleParticipantFocus=e=>{if(this._suppressElementAnimation)return void V.log(k.LogTraceArea.CallingUI,"CallStageView._onParticipantDoubleTap ignored");const t=ae.default.newCauseId();V.log(k.LogTraceArea.CallingUI,"CallStageView._onToggleParticipantFocus causeId: "+t),this.state.focusedParticipant||u.default.OngoingCallService.setPreFocusStageParticipants(this.props.callId,n.clone(this.state.stageElements));const i=this.state.focusedParticipant!==e?e:void 0;let a;a=i?[i]:this.props.stageLayoutMode===_.StageMode.Manual?this._cleanseStageElements(u.default.OngoingCallService.getPreFocusStageParticipants(this.props.callId),this.state,t):this._getStageElementsForOnToggleParticipantUnfocus(),a&&!n.isEmpty(a)||(V.log(k.LogTraceArea.CallingUI,"CallStageView._onParticipantDoubleTap: No stageElements, falling back"),a=b.CallUIUtils.fallbackStageElements(this.state.renderedRemoteElementInfo,this.state.isProvidingVideo,this.props.baseStageMode)),this.setState({focusedParticipant:i,stageElements:a})},this._onRibbonBackdropPan=e=>{this._layoutController.onPan(void 0,!1,e,this.props.viewRect)},this._onStageElementPan=(e,t,i)=>{const a=this.state.stageElements.length>1;this._intOnElementPan(e,a,t,i)},this._onElementPan=(e,t,i)=>{n.includes([_.StageMode.Speaker,_.StageMode.TogetherMode,_.StageMode.LargeGrid],this.props.stageLayoutMode)&&e!==_.CallStageElementKeys.localUserKey||this._intOnElementPan(e,!0,t,i)},this._onElementResize=e=>{V.log(k.LogTraceArea.CallingUI,`CallStageView._onElementResize key ${e} `),this._updateElementLayout(!1,this.state,this.props,"onElementReSize")},this._intOnElementPan=(e,t,i,a)=>{if(i.isComplete&&!this.state.draggingElementKey)return;const n=this._draggingElementConfig(e,i,a),o=n.config,s=b.CallUIUtils.translateRect(a,this.props.viewRect.width),r={x:this.props.viewRect.x+(this.props.containerOffsetX||0),y:this.props.viewRect.y,width:this.props.viewRect.width,height:this.props.viewRect.height};let l=this._layoutController.onPan(e,t,i,r,s,this.state.useImmersiveMode);if(this.state.draggingElementKey===e&&(l=!0,this._layoutController.setParticipantDragState(_.ParticipantDragState.Move)),l)if(i.isComplete){const t=ae.default.newCauseId();V.log(k.LogTraceArea.CallingUI,"CallStageView._intOnElementPan, causeId:"+t),e===_.CallStageElementKeys.localUserKey&&f.default.updateCallTelemetry(this.props.callId,t,(e=>e.moveOwnPreview())),0!==this._ribbonRightSideOffSetForVideoPreview&&(this._ribbonRightSideOffSetForVideoPreview=0,this._updateElementLayout(!1,this.state,this.props,"_draggingElementConfig")),o.selectDropTarget?(o.showDropTarget&&e===_.CallStageElementKeys.localUserKey&&f.default.updateCallTelemetry(this.props.callId,t,(e=>e.dockOwnPreview())),this._moveCallElement(e,!!o.toStage,o.targetStagePosition)):d.default.setDraggingParticipantConfig(void 0),this._layoutController.resetParticipantDragState()}else this._topElement=e,n.changed&&d.default.setDraggingParticipantConfig(o)},this._layoutControllerForKey=e=>this._layoutController.controllerForKey(e),this._layoutControllerForLocalUser=()=>this._layoutControllerForKey(_.CallStageElementKeys.localUserKey),this._onInlineCallStageReactionsViewRef=e=>{this._callReactionsView=e||void 0},this._getCallReactionsDisplayHelper=()=>this._callReactionsDisplayHelper,this._onTextReactionPressed=()=>{if(this.props.onTextReactionPressed){const e=ae.default.newCauseId();V.log(k.LogTraceArea.CallingUI,"CallStageView._onTextReactionPressed, causeId: "+e),this.props.onTextReactionPressed(e)}},this._onCallParticipantNametagMouseEnter=(e,t)=>{d.default.setHoveringParticipantConfig({key:t,source:_.HoveringParticipantSource.Nametag})},this._onCallParticipantNametagMouseLeave=(e,t)=>{d.default.clearHoveringParticipantConfig(_.HoveringParticipantSource.Nametag)},this._onRibbonElementTapBinder=(e,t)=>this._onRibbonElementTap(e),this._onStageTapBinder=(e,t)=>this.props.onStageTap(t),this._getAnchorInfo=e=>{const t=F.default.isMyMri(e)?_.CallStageElementKeys.localUserKey:e;if(t!==_.CallStageElementKeys.localUserKey&&!n.has(this.state.allCallElements,t))return;const i=this._layoutControllerForKey(t);if(i){if(i.isHidden())return;if(i.viewRect)return this._anchorInfoForRect(i.viewRect(),i.isHidden())}},this._getAnchorInfoChanges=(e,t)=>{if(e!==_.CallStageElementKeys.localUserKey&&!n.has(this.state.allCallElements,e))return;const i=this._layoutControllerForKey(e);if(i&&i.onRectChanged){const e=e=>{t(this._anchorInfoForRect(e,i.isHidden()))};return i.onRectChanged(e)}},this._onElementStartDragging=e=>{this._callReactionsView&&this._callReactionsView.dismissReaction&&this._callReactionsView.dismissReaction(e)}}_buildState(e,t){t&&this._updateRibbonVerticalOffset(e.topInset||0,!1,e.stageLayoutMode);let i,a,o={},s=[_.CallStageElementKeys.localUserKey],r={},p=[],g=[],C=[],m=this.state?this.state.renderedRemoteElementInfo:{},S={},f=!1,v=0;const w=e.stageLayoutMode,P=l.default.getS4LCMCFeatures(),M=b.CallUIUtils.isTogetherMode(w)||b.CallUIUtils.isLargeGrid(w),k=M?A.default.getNonVisibleInCallBotMris():A.default.getNonInteractiveInCallBotMris(),R=A.default.getCallAudienceBotMriFilter(),V=A.default.getCallGridViewBotMriFilter();let L,B,O=I.isThread(e.conversationMri);if(n.each(u.default.CallingStore.getRemoteCallMembers(e.callId),(t=>{const i=u.default.CallingStore.getRemoteCallMemberMri(e.callId,t);if(M&&(b.CallUIUtils.isTogetherMode(w)&&n.includes(R,i)||b.CallUIUtils.isLargeGrid(w)&&n.includes(V,i))&&(L=i),b.CallUIUtils.shouldRenderParticipant(e.callId,t,i,k)){v++;const a=b.CallUIUtils.elementInfoForParticipantOrScreenshare(i,i,e.callId,t,m[i],O,void 0,this._getRenderTargetViaKey);S[i]=a,s.push(i),r[i]=h.default.isParticipantTalking(t);const o=_.VideoStatus.Available===a.videoStatus||_.VideoStatus.Streaming===a.videoStatus;f=f||!a.isScreensharing&&o||P.keepScreenShareWhenDisableVideo&&!!a.isScreensharing&&o,o&&p.push(i);const l=S[i].participantState;!n.isUndefined(l)&&h.default.isParticipantStateConnected(l)&&g.push(i)}h.default.isParticipantRinging(t)&&C.push(i),o[i]={mri:i,participantState:t.state}})),u.default.CallScreenShareStore.isActive(e.callId)){const t=u.default.CallScreenShareStore.getRemoteScreenShareParticipant(e.callId);if(t){const n=u.default.CallingStore.getRemoteCallMemberMri(e.callId,t);B=n,a=ne+n;const r=b.CallUIUtils.elementInfoForParticipantOrScreenshare(a,n,e.callId,t,m[a],!1,n,this._getRenderTargetViaKey);S[a]=r,s.push(a),o[a]={mri:n,participantState:t.state,isScreenShare:!0},i=r}else B=F.default.getSkypeMri()}let D={allCallElements:o,screenshareElementInfo:i,ringingParticipants:C,remoteCallMemberCount:v,renderedRemoteElementInfo:S,enableNewIncomingVideoSound:P.enableNewIncomingVideoSound,isOneOnOneConversation:I.isOneOnOneConversation(e.conversationMri),mobilePreviewPercentage:P.mobilePreviewPercentage,bottomSafeAreaInset:j.default.bottomSafeAreaInset(10),anyVideoOrScreensharing:!!i||f,enableImmersiveMode:e.useMobileControls,isProvidingVideo:u.default.CallingStore.isProvidingVideo(e.callId),isMuted:b.CallUIUtils.isLocalOrServerMuted(e.callId),isHandRaised:u.default.CallingStore.isHandRaisedForCurrentUserMri(e.callId),isCallCreator:u.default.CallingStore.isCallCreator(e.callId),callCreator:u.default.CallingStore.getCallCreator(e.callId),draggingElementKey:d.default.getCurrentDraggingParticipantKey(),enableLayoutAnimation:b.CallUIUtils.enableLayoutAnimation(),enableAddToCallRibbonItem:!e.useMobileControls&&u.default.CallingFeaturesHelper.allowAddToCall(e),enableAddToCallCoachmark:!e.useMobileControls&&P.enableAddToCallRibbonCoachMark,isFullscreenBotCall:M,showChangeTogetherModeBackgroundOption:H.ChangeTogetherModeBackgroundCommand.canExecute(e.callId,e.conversationMri),enableTapToMoveCallParticipant:P.enableTapToMoveCallParticipant,enableMultiGradientOverlay:P.enableMultiGradientOverlay,enableTapToFlipCamera:P.enableNewCameraFlipFlow&&!P.enableTapToMoveCallParticipant&&e.useMobileControls&&!Q.default.isMobileScreenReaderEnabled(),localVideoDimension:u.default.CallingStore.getLocalVideoStreamSize(e.callId),isCallVisible:T.default.isCallVisible(e.callId),isNavigatingWithKeyboard:E.default.isNavigatingWithKeyboard(),connectedParticipants:g,disableVideosInRibbon:P.disableVideosInRibbon,nonInteractiveInCallBotMris:A.default.getNonInteractiveInCallBotMris(),checkRaisedHandForReordering:P.enableReorderingParticipantsRaiseHand,screensharingUserMri:B,enableNewLayoutPicker:P.enableNewLayoutPicker,onlyVideoParticipantsOnStage:y.default.getOnlyVideoOnTheStage(e.callId)};const x={isPSTNCall:u.default.CallingStore.isPSTNCall(e.callId),isEncryptedCall:I.isEncryptedThread(e.conversationMri),conversationMri:e.conversationMri,callId:e.callId};if(this._changeCallLayoutCommand=new c.ChangeCallLayoutCommand(x,e.isIncomingOrOutgoingRing,w),t)D.useImmersiveMode=!1,D.ribbonHidden=!1,w===_.StageMode.Manual?D.stageElements=u.default.OngoingCallService.getStageParticipants(e.callId):D.stageElements=a?[a]:L?[L]:[],D.focusedParticipant=u.default.OngoingCallService.getFocusedParticipant(e.callId);else{let t;this._isVideoPreviewFloatingOnTop=e.enableFloatableResizableVideoPreview&&this._isVideoPreviewFloatingOnTop&&this.state.isProvidingVideo;const i=a&&!!this.state&&!b.CallUIUtils.screenShareKey(this.state);let o=i?void 0:this.state.focusedParticipant;const r=D.onlyVideoParticipantsOnStage?p:g;if(n.isEmpty(g)||u.default.OngoingCallService.getHasConnectedParticipantsEdge(e.callId)){const l=b.CallUIUtils.isInIncomingScreenshareMode(w)||i;if(o)n.includes(s,o)?t=this.state.stageElements:(o=void 0,t=w===_.StageMode.Manual?u.default.OngoingCallService.getPreFocusStageParticipants(e.callId):r);else if(l&&a)t=[a];else if(w===_.StageMode.Speaker){const i=this.state.stageElements[0],a=u.default.CallingStore.getTopSpeakerMri(e.callId);t=n.compact([a||i])}else if(M&&L)t=[L];else if(t=[],w===_.StageMode.Manual){t=u.default.OngoingCallService.getStagedParticipantsSelection(e.callId)||this.state.stageElements}else{const i=u.default.OngoingCallService.getStagedParticipantsSelection(e.callId);let o=[];n.isEmpty(i)||(o=n.filter(i,(e=>n.includes(s,e))),n.isEmpty(o)||(t=o)),n.isEmpty(t)&&(t=n.isEmpty(r)||a&&w!==_.StageMode.Grid?this.state.stageElements:r)}}else u.default.OngoingCallService.setHasConnectedParticipantsEdge(e.callId,!0),t=[];if(n.isEmpty(g)||(D.stageElements=this._cleanseStageElements(t,D,"buildState")),D.focusedParticipant=o,D.draggingElementKey&&D.draggingElementKey!==_.CallStageElementKeys.localUserKey){const e=n.keys(S);n.includes(e,D.draggingElementKey)||(D.draggingElementKey=void 0,this._topElement=void 0)}}n.isEmpty(g)&&(D.stageElements=b.CallUIUtils.fallbackStageElements(S,!!D.isProvidingVideo,e.baseStageMode)),n.each(r,((e,t)=>{const i=this._mountedRefsMap.ref(t);i&&i.updateTalking(e)}));const N=this._getCurrentCallPanelHeaderLayout(e);return this._layoutController.setCallHeaderPanelLayout(N),D.ribbonType=N!==_.CallPanelHeaderLayout.Float||e.isDesktopMin?_.RibbonType.Small:_.RibbonType.Large,D.stageMode=e.baseStageMode,D}componentDidMount(){super.componentDidMount();const e=ae.default.newCauseId();V.log(k.LogTraceArea.CallingUI,"CallStageView.componentDidMount causeId: "+e),this._updateElementLayout(!1,this.state,this.props,e),this._updateVideoLinks(e),this._callingStoreSubscriptionId=u.default.CallingStore.subscribe(this._maybeUpdateRibbonVisibleElements,this.props.callId),this.props.onStageChange&&this.props.onStageChange(this._localUserOnStage()),this.state.stageMode!==_.CallStageViewMode.None&&(V.log(k.LogTraceArea.CallingUI,"CallStageView.componentDidMount initiating startVideoSoundTimeout"),this._startVideoSoundTimeout=Date.now()),u.default.SpeakerViewTelemetryService.startTracking(this.props.callId),f.default.setHadOldCallStageEnabled(this.props.callId,e),this._layoutController.setElementsPositions(this.state.stageElements),this._registerKeyboardHandlers()}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this._suppressElementAnimation=!this.props.layoutAnimationEnabled,e.callId!==this.props.callId&&this._callingStoreSubscriptionId&&(u.default.CallingStore.unsubscribe(this._callingStoreSubscriptionId),this._callingStoreSubscriptionId=u.default.CallingStore.subscribe(this._maybeUpdateRibbonVisibleElements,e.callId)),this.state.ribbonHidden===t.ribbonHidden&&this.state.useImmersiveMode===t.useImmersiveMode||this._collapseOrExpandRibbon(t.ribbonHidden||t.useImmersiveMode,e.viewRect,!0);const a=this._layoutControllerForLocalUser(),o=this.props.viewRect.width!==e.viewRect.width||this.props.viewRect.x!==e.viewRect.x,s=this.state.isProvidingVideo!==t.isProvidingVideo;if(o||s){const i=ae.default.newCauseId();if(s&&a&&a.setResizeFactor&&a.setResizeFactor(1),this.props.enableFloatableResizableVideoPreview&&this._isVideoPreviewFloatingOnTop){const t=this._layoutControllerForLocalUser();t&&t.setFullStageRect&&t.setFullStageRect(e.viewRect)}this._updateElementLayout(!1,t,e,i)}this.props.enableFloatableResizableVideoPreview&&(n.includes(this.state.stageElements,_.CallStageElementKeys.localUserKey)&&this.props.onVideoPreviewFloating?(a&&a.setUIPosition&&a.setUIPosition(_.CallingViewUIPostion.Stage),this.props.onVideoPreviewFloating(!1,void 0),this._isVideoPreviewFloatingOnTop=!1):this._isVideoPreviewFloatingOnTop||a&&a.setUIPosition&&a.setResizeFactor&&(this.props.callPanelHeaderLayout===_.CallPanelHeaderLayout.Window?(a.setUIPosition(_.CallingViewUIPostion.RibbonWidowsMode),a.setResizeFactor(1)):a.setUIPosition(_.CallingViewUIPostion.Ribbon))),this.props.topInset!==e.topInset&&this._updateRibbonVerticalOffset(e.topInset||0,!1,e.stageLayoutMode);let r=u.default.OngoingCallService.getStagedParticipantsSelection(this.props.callId);if(r&&t.connectedParticipants.length!==this.state.connectedParticipants.length){const e=n.difference(t.connectedParticipants,this.state.connectedParticipants);t.connectedParticipants.length>this.state.connectedParticipants.length?r=r.concat(e):n.pullAll(r,e),u.default.OngoingCallService.setStagedParticipantsSelection(this.props.callId,r)}}_getRibbonBackdropContainerHeightStyle(e,t){return s.Styles.createViewStyle({height:this._getBackdropContainerHeight(e,t)},!1)}_getHeaderBackdropContainerHeightStyle(e,t){return s.Styles.createViewStyle({height:this._getBackdropContainerHeight(e,t)+15},!1)}_getBackdropContainerHeight(e,t){return(t===_.RibbonType.Large?_.RibbonSizes.ribbonItemSizeLarge:_.RibbonSizes.ribbonItemSizeSmall)+b.CallUIUtils.getRibbonItemTopMargin(e)}_registerKeyboardHandlers(){B.default.addHandler(k.KeyboardShortcut.ResizeVideoPreview,this._resizeVideoPreviewFromKeyboard)}_unregisterKeyboardHandlers(){B.default.removeHandler(k.KeyboardShortcut.ResizeVideoPreview,this._resizeVideoPreviewFromKeyboard)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=ae.default.newCauseId();V.log(k.LogTraceArea.CallingUI,"CallStageView.componentDidUpdate causeId: "+a),this._updateElementLayout(!this._suppressElementAnimation,this.state,this.props,a),this._updateVideoLinks(a,t),this._startVideoSoundTimeout||t.stageMode!==_.CallStageViewMode.None||this.state.stageMode===_.CallStageViewMode.None||(V.log(k.LogTraceArea.CallingUI,"CallStageView: initiating startVideoSoundTimeout"),this._startVideoSoundTimeout=Date.now()),void 0===t.screenshareElementInfo&&this.state.screenshareElementInfo;const o=this._isDragging(this.state);o!==this._isDragging(t)&&(this.props.onDragChange&&this.props.onDragChange(o),this.state.draggingElementKey&&this._onElementStartDragging(this.state.draggingElementKey)),this.state.focusedParticipant!==t.focusedParticipant&&(this.state.focusedParticipant||u.default.OngoingCallService.setPreFocusStageParticipants(this.props.callId,[]),u.default.OngoingCallService.setFocusedParticipant(this.props.callId,this.state.focusedParticipant)),this.props.onStageChange&&this.props.onStageChange(this._localUserOnStage()),u.default.OngoingCallService.setStageParticipants(this.props.callId,this.state.stageElements),this.state.stageMode!==t.stageMode&&d.default.setDraggingParticipantConfig(void 0),this.state.useImmersiveMode!==t.useImmersiveMode&&this.props.onUseImmersiveModeChange(this.state.useImmersiveMode),this._suppressElementAnimation=!this.props.layoutAnimationEnabled,!t.anyVideoOrScreensharing&&this.state.anyVideoOrScreensharing&&this._maybePlayVideoAvailableSound(a);const s=!!this.state.screenshareElementInfo;if(s!==!!t.screenshareElementInfo){const e=this.state.screenshareElementInfo||t.screenshareElementInfo;this._announceScreensharingForAccessibility(s,e)}const r=b.CallUIUtils.shouldRenderStage(this.state)?this.state.stageElements:[],l=this._draggingElementKey();if(!n.includes(r,_.CallStageElementKeys.localUserKey)&&l!==_.CallStageElementKeys.localUserKey){const e=this._elementRenderInfo(_.CallStageElementKeys.localUserKey),t=!this.state.ribbonHidden;if(e&&this.props.enableFloatableResizableVideoPreview&&this.props.onVideoPreviewFloating){const i=this.state.isProvidingVideo,a=i&&!this.props.enableNewCallScreen?this._renderCallElementView(e,!0,this.state.enableTapToMoveCallParticipant,t):void 0;this.props.onVideoPreviewFloating(i,a)}}let c=this.state.stageElements;this._topElement&&n.includes(c,this._topElement)&&(c=n.without(c,this._topElement),c.push(this._topElement)),this._layoutController.setElementsPositions(c)}_announceScreensharingForAccessibility(e,t){if(!t)return;const i=h.default.extractMriFromKey(t.key),a=ie.default.getFullUserProfileByMriNoSubscription(i),n=e?"AccessibilityLabel.RemoteScreenShareStarted":"AccessibilityLabel.RemoteScreenShareStopped";$.default.maybeAnnounceForAccessibility(N.getString(n,{gender:x.getLocalizeParamForGender(a.gender),userName:M.default.getDisplayName(i)||""}))}_maybePlayVideoAvailableSound(e){const t=e=>{if(this.props.isRoutedToEarpiece&&this.isComponentMounted()){V.log(k.LogTraceArea.CallingUI,"CallStageView._maybePlayVideoAvailableSound playing sound - causeId: "+e);(this.state.enableNewIncomingVideoSound?q.default.SkypeIncomingVideoAvailable:q.default.SkypeNotification).playOnce(e)}};if(!this._startVideoSoundTimeout)return void V.warn(k.LogTraceArea.CallingUI,"CallStageView._maybePlayVideoAvailableSound requested to play sound too soon - causeId: "+e);const i=this._startVideoSoundTimeout+5e3-Date.now();i>0?this._soundDelayTimer?V.log(k.LogTraceArea.CallingUI,"CallStageView._maybePlayVideoAvailableSound already pending - causeId: "+e):(this._soundDelayTimer=ee.default.setTimeout((()=>t(e)),i),V.log(k.LogTraceArea.CallingUI,"CallStageView._maybePlayVideoAvailableSound delaying for "+i+"ms - causeId: "+e)):t(e)}componentWillUnmount(){super.componentWillUnmount();const e=ae.default.newCauseId();V.log(k.LogTraceArea.CallingUI,"CallStageView.componentWillUnmount causeId: "+e),this._callingStoreSubscriptionId&&(u.default.CallingStore.unsubscribe(this._callingStoreSubscriptionId),this._callingStoreSubscriptionId=void 0),u.default.CallingStore.isCallConnected(this.props.callId)?V.log(k.LogTraceArea.CallingUI,"CallStageView.componentWillUnmount: Call is still connected; leaving videos attached causeId: "+e):(V.log(k.LogTraceArea.CallingUI,"CallStageView.componentWillUnmount: Call is not connected; tearing down videos causeId: "+e),this._removeVideoLinks(e)),u.default.SpeakerViewTelemetryService.stopTracking(this.props.callId),this._unregisterKeyboardHandlers()}_collapseOrExpandRibbon(e,t,i){const a=e?0:1;this._stageReactionsAnimatedOpacityValue.setValue(e?0:1),this._layoutController.updateRibbonExpandedMultiplier(a,t,!0)}_localUserOnStage(){return b.CallUIUtils.shouldRenderStage(this.state)&&n.includes(this.state.stageElements,_.CallStageElementKeys.localUserKey)}_isDragging(e){return!!e.draggingElementKey}_updateElementLayout(e,t,i,a){if(V.log(k.LogTraceArea.CallingUI,"CallStageView._updateElementLayout causeId: "+a),0===i.viewRect.width||0===i.viewRect.height)return;const o=b.CallUIUtils.renderVideoPreview(t,i),s=b.CallUIUtils.shouldRenderStage(t)?t.stageElements:[],c=n.includes(s,_.CallStageElementKeys.localUserKey),d=n.size(s);let p;p=i.enableFloatableResizableVideoPreview?c||o&&this._isVideoPreviewFloatingOnTop?[]:[_.CallStageElementKeys.localUserKey]:c?[]:[_.CallStageElementKeys.localUserKey];const g=n.values(t.renderedRemoteElementInfo),C=u.default.CallingStore.getRankedSpeakerMris(i.callId);V.log(k.LogTraceArea.CallingUI,`CallStageView._updateElementLayout  causeId: ${a}`),n.each(g,(e=>{const t=n.findIndex(C,(t=>e.key===t));e.activeSpeakerRank=-1===t?Number.MAX_VALUE:t})),c&&g.push(this._localUserParticipantInfo);const m=g.sort(((e,t)=>b.CallUIUtils.compareElementInfo(e,t,!!this.state.checkRaisedHandForReordering))),S=n.map(m,(e=>e.key));p=p.concat(S);const y=!!t.ringingParticipants&&1===t.ringingParticipants.length,f=[];let T=0,v=_.RibbonExtraVisibility.None,w=_.RibbonExtraVisibility.None,P=!1,M=!1,R=!1;t.enableAddToCallRibbonItem&&i.showParticipantsButton&&(w=i.showRibbonExtras?_.RibbonExtraVisibility.Visible:_.RibbonExtraVisibility.Hidden),f.push.apply(f,n.map(p,((e,a)=>{const o={key:e,isScreenshare:e===b.CallUIUtils.screenShareKey(t),videoType:b.CallUIUtils.videoTypeForKey(e,t,i),videoAspectRatio:b.CallUIUtils.videoAspectRatioForKey(e,t,i),isLocal:_.CallStageElementKeys.localUserKey===e,isHostOfScreenshare:!!t.renderedRemoteElementInfo[e]&&t.renderedRemoteElementInfo[e].isScreensharing},l=n.indexOf(s,o.key);if(l>=0)o.stagePosition=l,o.participantRank=l,o.displayOnStage=!0,o.hidden=!1;else{o.ribbonPosition=T,o.participantRank=d+T,o.isHiddenBot=n.includes(A.default.getNonInteractiveInCallBotMris(),o.key),P=!!o.isLocal,M=b.CallUIUtils.renderVideoPreview(this.state,i),R=!0;const a=t.allCallElements[e],s=a?a.participantState:r.ParticipantState.None;h.default.isParticipantStateRinging(s)?o.hidden=!y:o.hidden=!1,T++}return o}))),0!==this._latestVisibleRibbonCallItemKeys.length&&b.CallUIUtils.reorderLayoutInfoViaLeastVisibleItemSwaping(f,this._latestVisibleRibbonCallItemKeys);const L=this._ribbonItemHeight(t,P,M,R),E=this._shouldUseMobilePreviewPercentage(P,M,R)&&i.isLandscape,B=L,O=!!n.find(p,(e=>e===_.CallStageElementKeys.localUserKey));if(i.enableFloatableResizableVideoPreview&&o&&O){const e=i.availableRibbonWidth-3*L,t=this._layoutControllerForLocalUser();if(t&&t.viewRect&&t.setResizeFactor){const i=t.viewRect(!0);if(e<=i.width&&t.getResizeFactor){const a=t.getResizeFactor(),n=e/i.width*a;t.setResizeFactor(Math.max(n,1))}}}const D=this._layoutController.updateLayoutInfo(f,b.CallUIUtils.adjustedStageViewRect(i),L,B,!1,i.availableRibbonWidth,v,w,i.useMobileControls?1:2,e,E,this._ribbonRightSideOffSetForVideoPreview,!1,this.state.enableNewLayoutPicker?_.LayoutPickerButtonWidth:void 0),x=n.filter(p,(e=>this._layoutController.controllerForKey(e).isHidden()));this._latestVisibleRibbonCallItemKeys=b.CallUIUtils.getVisibleSwapableRibbonItemKeys(f,x),V.log(k.LogTraceArea.CallingUI,`CallStageView._updateElementLayout  causeId: ' + ${a}`),f.push({key:_.CallStageElementKeys.remainderViewKey,ribbonPosition:T}),T++,t.enableAddToCallRibbonItem&&(f.push({key:_.CallStageElementKeys.addToCallViewKey,ribbonPosition:T}),T++),i.useMobileControls||(v=this._shouldShowRibbonModeSelector(t,i)?_.RibbonExtraVisibility.Visible:_.RibbonExtraVisibility.Hidden,f.push({key:_.CallStageElementKeys.ribbonModeViewKey,ribbonPosition:T}),T++),this._updateRibbonVerticalOffset(i.topInset||0,!0,i.stageLayoutMode);const N=t.ribbonHidden?0:Math.min(this._layoutController.ribbonWidth(),i.viewRect.width);this._ribbonAnimatedWidthValue.setValue(N);const U=n.sortBy(f,(e=>e.participantRank)),F=n.map(U,(e=>e.key));if(l.default.getS4LCMCFeaturesNoSubscription().twinCamEnabled){const e=u.default.CallingStore.getParticipantsWithTwinCam(i.callId);F.sort(((t,i)=>I.isMri(t)&&I.isMri(i)?n.includes(e,t)&&!n.includes(e,i)?-1:!n.includes(e,t)&&n.includes(e,i)?1:0:0))}u.default.CallingStore.setRemoteVideoPriorityOrder(i.callId,n.without(F,_.CallStageElementKeys.localUserKey,_.CallStageElementKeys.remainderViewKey,_.CallStageElementKeys.ribbonModeViewKey,_.CallStageElementKeys.addToCallViewKey),a),this._remainderView&&this._remainderView.showRemainder(D,!n.isEmpty(t.ringingParticipants))}_updateVideoLinks(e,t){V.log(k.LogTraceArea.CallingUI,"CallStageView._updateVideoLinks causeId: "+e),!t||t.isProvidingVideo===this.state.isProvidingVideo&&t.ribbonHidden===this.state.ribbonHidden?V.log(k.LogTraceArea.CallingUI,"CallStageView._updateVideoLinks ignored due to no state change causeId: "+e):this._updateLocalVideoLink(e,(()=>{}),this.state.isProvidingVideo)}_updateLocalVideoLink(e,t,i,a){if(V.log(k.LogTraceArea.CallingUI,"CallStageView._updateLocalVideoLink causeId: "+e),this.state.isProvidingVideo&&!this.state.ribbonHidden&&this.props.isVideoTarget||(this._mappedRefs[se]=void 0),this.props.isVideoTarget&&(!this.state.ribbonHidden||!this.state.isProvidingVideo)){let o=this._mappedRefs[se];this._mappedVideos[_.CallStageElementKeys.localUserKey]!==o&&(o?this._mappedVideos[_.CallStageElementKeys.localUserKey]=o:delete this._mappedVideos[_.CallStageElementKeys.localUserKey]);const s=this._videoScalingMode[se]||r.ScalingMode.Crop,l=this.props.enableFloatableResizableVideoPreview&&!n.isUndefined(a)?a:o;u.default.CallingStore.setLocalVideoTarget(this.props.callId,!!i,l,{scalingMode:s,transparent:!1},e).finally((()=>{t&&t()}))}}_updateRemoteVideoLink(e,t,i,o,s,l){if(!o)return;const c=o.mri,d=n.startsWith(e,ne)?r.StreamType.ScreenSharing:r.StreamType.Video,h=u.default.RemoteStreamHelper.isStreamAvailable(this.props.callId,c,d,t),p=this.state.disableVideosInRibbon&&b.CallUIUtils.isInGridStageMode(this.props.stageLayoutMode)&&!n.includes(this.state.stageElements,i),g=this.state.isFullscreenBotCall&&!n.includes(this.state.stageElements,i);(!this.props.isVideoTarget||!h||!b.CallUIUtils.shouldRenderParticipantState(o.participantState)||p||g&&d===r.StreamType.Video)&&(this._mappedRefs[oe+e]=void 0);const C=this._mappedRefs[oe+e];if(!this._mappedVideos[e]&&!C)return void(h&&(e===b.CallUIUtils.screenShareKey(this.state)?V.warn(k.LogTraceArea.CallingUI,"CallStageView._updateRemoteVideoLink "+K.mriOrId(c)+" is screensharing but no mapped view found"):V.warn(k.LogTraceArea.CallingUI,"CallStageView._updateRemoteVideoLink "+K.mriOrId(c)+" is streaming video but no mapped view found")));const m=u.default.RemoteStreamHelper.isStreamRenderingForTarget(this.props.callId,c,d,C,t),S=u.default.RemoteStreamHelper.isRemoteStreamInTransitState(this.props.callId,c,d,t);if(V.log(k.LogTraceArea.CallingUI,"CallStageView._updateRemoteVideoLink "+K.mriOrId(c)+" renderTargetChanged "+(this._mappedVideos[e]!==C)+" streamNotRendering "+!m+" streamNotAtTransitState "+!S),this._mappedVideos[e]!==C||!m&&!S){C?this._mappedVideos[e]=C:delete this._mappedVideos[e];const i=o.isScreenShare?r.StreamType.ScreenSharing:r.StreamType.Video,n=(i===r.StreamType.ScreenSharing?this._screenshareScalingMode:this._videoScalingMode)[c]||r.ScalingMode.Fit;if(C){const o=v.CallingCapabilities.directReparentingSupported()?u.default.RemoteStreamHelper.getRemoteStreamRenderer(this.props.callId,c,i,t):void 0;u.default.RemoteStreamHelper.startRemoteStream(this.props.callId,c,"CallStageView._updateRemoteVideoLink",i,C,{scalingMode:n,transparent:!1,rendererTobeReparented:o,disposeRendererWhenStreamisNotAvailable:()=>!1},s,[],t).catch((t=>{V.warn(k.LogTraceArea.CallingUI,"CallStageView._updateRemoteVideoLink key: "+a.pii.Omit(e)+" failed "+X.default.errorAsString(t)+" causeId: "+s),delete this._mappedVideos[e]})).finally((()=>{l&&l()}))}else{if(!this.props.isVideoTarget&&v.CallingCapabilities.directReparentingSupported())return void V.log(k.LogTraceArea.CallingUI,"CallStageView._updateVideoLinks skipped stopRemoteStream  due to isVideoTarget "+this.props.isVideoTarget+" and directRepartingSupported "+s);u.default.RemoteStreamHelper.stopRemoteStream(this.props.callId,c,"CallStageView._updateRemoteVideoLink",i,s,t)}}}_removeVideoLinks(e){V.log(k.LogTraceArea.CallingUI,"CallStageView._removeVideoLinks causeId: "+e),n.each(this._mappedVideos,((t,i)=>{if(i!==_.CallStageElementKeys.localUserKey){const t=n.startsWith(i,ne)?i.substr(ne.length):i;u.default.RemoteStreamHelper.stopRemoteStream(this.props.callId,t,"CallStageView._removeVideoLinks",r.StreamType.Video,e)}}))}_updateRibbonVerticalOffset(e,t,i){const a=Math.max(b.CallUIUtils.getRibbonItemTopMargin(i),e);this._layoutController.updateRibbonVerticalOffset(a,t)}_getStageElementsForOnToggleParticipantUnfocus(){const e=n.keys(this.state.renderedRemoteElementInfo);return this.state.onlyVideoParticipantsOnStage?n.filter(e,(e=>e!==_.CallStageElementKeys.localUserKey&&u.default.RemoteStreamHelper.isStreamRenderingForTarget(this.props.callId,e,r.StreamType.Video,this._getRenderTargetViaKey(e)))):n.filter(e,(e=>e!==_.CallStageElementKeys.localUserKey))}_cleanseStageElements(e,t,i){const a=t||this.state,o=n.keys(a.renderedRemoteElementInfo);a.isFullscreenBotCall||o.push(_.CallStageElementKeys.localUserKey);let s=n.intersection(e,o);const r=this._layoutController.getMaxNumberOfStageElements();return s.length>r&&(s=n.takeRight(s,r)),s&&!n.isEmpty(s)||(V.log(k.LogTraceArea.CallingUI,"CallStageView._cleanseStageElements: No renderedStageElements, falling back (renderedElements:"+o.length+"; currentStageElements:"+e.length+")  causeId:"+i),s=b.CallUIUtils.fallbackStageElements(a.renderedRemoteElementInfo||{},!!a.isProvidingVideo,this.props.baseStageMode)),s||[]}_ribbonDropTargetHeight(){return this.state.ribbonType===_.RibbonType.Small?_.RibbonSizes.ribbonDropTargetSmallHeight:_.RibbonSizes.ribbonDropTargetLargeHeight}_draggingElementConfig(e,t,i){const a=d.default.dangerouslyGetCurrentDraggingParticipantConfig(),o=this.props.enableFloatableResizableVideoPreview,s=e===_.CallStageElementKeys.localUserKey,r=o&&s&&this._isVideoPreviewFloatingOnTop;let l=!n.includes(this.state.stageElements,e)&&!r;const c=this._ribbonRightSideOffSetForVideoPreview,u=this._ribbonDropTargetHeight()+(this.props.topInset||0);let h=!1;const p=t.pageX-this.props.viewRect.x,g=t.pageY-this.props.viewRect.y;let C;h=a&&a.showCancel||l&&g>u,h&&l&&g<u&&(l=!1);let m,S=-1,y=!1;if(l){const e=this._stageDropTarget();C=e.rect,S=e.targetPosition,y=e.confirmOnly}else C=o&&r&&i?this._ribbonDropTargetForVideoPreview(this.props.topInset||0,this._ribbonItemHeight(this.state),i):this._ribbonDropTarget(this.props.topInset||0);if(l)if(o&&s)m=g>=u;else{const e=p<=C.width&&p>=0,t=g<=C.height&&g>=0;m=e&&t}else m=o&&s&&i?g<i.height&&p>this.props.viewRect.width-i.width:g<u;const f=l?0:this.props.topInset||0,b=!(o&&s&&!n.includes(this.state.stageElements,_.CallStageElementKeys.localUserKey))||r&&m;return V.log(k.LogTraceArea.CallingUI,"_draggingElementConfig showDropTarget "+b),o&&(this._ribbonRightSideOffSetForVideoPreview=i&&r&&m?C.width+_.RibbonSizes.ribbonItemMargin:0),c!==this._ribbonRightSideOffSetForVideoPreview&&(0!==this._ribbonRightSideOffSetForVideoPreview?this._updateElementLayout(!1,this.state,this.props,"_draggingElementConfig"):ee.default.sleep(300).then((()=>this._updateElementLayout(!1,this.state,this.props,"_draggingElementConfig")))),a&&a.toStage===l&&a.showDropTarget===b&&a.selectDropTarget===m&&a.targetStagePosition===S&&a.showCancel===h&&a.confirmOnly===y&&a.topPadding===f&&(0,L.default)(a.dropTargetViewRect,C)&&a.isVideoPreviewAndFloatingOnTop===r?{config:a,changed:!1}:{config:{key:e,dropTargetViewRect:C,showDropTarget:b,selectDropTarget:m,toStage:l,targetStagePosition:S,showCancel:h,confirmOnly:y,topPadding:f,isVideoPreviewAndFloatingOnTop:r},changed:!0}}_stageDropTarget(){return{rect:b.CallUIUtils.adjustedStageViewBounds(this.props),targetPosition:this.state.stageElements.length,confirmOnly:0===this.state.stageElements.length}}_ribbonDropTarget(e){return{x:0,y:0,width:this.props.viewRect.width,height:this._ribbonDropTargetHeight()+e}}_ribbonDropTargetForVideoPreview(e,t,i){return{x:this.props.viewRect.width-t*i.width/i.height-_.RibbonSizes.ribbonItemMargin,y:b.CallUIUtils.getRibbonItemTopMargin(this.props.stageLayoutMode),width:t*i.width/i.height,height:t+e}}_moveCallElement(e,t,i){const o=ae.default.newCauseId();V.log(k.LogTraceArea.CallingUI,"CallStageView._moveCallElement: "+a.pii.Omit(e)+" toStage: "+t+" causeId: "+o);const s=n.includes(this.state.stageElements,e),r=this.props.enableFloatableResizableVideoPreview;if(t===s&&e!==_.CallStageElementKeys.localUserKey)return void d.default.setDraggingParticipantConfig(void 0);let l=n.clone(this.state.stageElements);const c=this._layoutControllerForLocalUser(),h=this._layoutController.getMaxNumberOfStageElements();t?(r&&e===_.CallStageElementKeys.localUserKey?(this._isVideoPreviewFloatingOnTop=!0,c&&c.setUIPosition&&c.setUIPosition(_.CallingViewUIPostion.FloatingOnTop)):(l.length>=h&&(l=n.dropRight(l)),l.push(e)),V.log(k.LogTraceArea.CallingUI,"CallStageView._moveCallElement toStage success: "+a.pii.Omit(e)+" causeId: "+o),f.default.updateCallTelemetry(this.props.callId,o,(t=>e===_.CallStageElementKeys.localUserKey?t.moveSelfToStage():t.moveParticipantToStage()))):(r&&e===_.CallStageElementKeys.localUserKey&&!n.includes(this.state.stageElements,_.CallStageElementKeys.localUserKey)?(this._isVideoPreviewFloatingOnTop=!1,c&&c.setUIPosition&&c.setResizeFactor&&(this.props.callPanelHeaderLayout===_.CallPanelHeaderLayout.Window?c.setUIPosition(_.CallingViewUIPostion.RibbonWidowsMode):c.setUIPosition(_.CallingViewUIPostion.Ribbon),c.setResizeFactor(1))):(l=n.without(l,e),this._updateRibbonAddTime(e,b.CallUIUtils.nextRibbonAddTime())),V.log(k.LogTraceArea.CallingUI,"CallStageView._moveCallElement toRibbon success: "+a.pii.Omit(e)+" causeId: "+o),f.default.updateCallTelemetry(this.props.callId,o,(t=>e===_.CallStageElementKeys.localUserKey?t.moveSelfToRibbon():t.moveParticipantToRibbon()))),this.props.enableFloatableResizableVideoPreview?e!==_.CallStageElementKeys.localUserKey&&(y.default.setStageMode(this.props.callId,_.StageMode.Manual,o),l=this._cleanseStageElements(l,this.state,o)):(y.default.setStageMode(this.props.callId,_.StageMode.Manual,o),l=this._cleanseStageElements(l,this.state,o)),u.default.OngoingCallService.setStagedParticipantsSelection(this.props.callId,l),this.setState({stageElements:l,focusedParticipant:void 0},(()=>{d.default.setDraggingParticipantConfig(void 0)}))}_updateRibbonAddTime(e,t){e!==_.CallStageElementKeys.localUserKey?this.state.renderedRemoteElementInfo[e]&&(this.state.renderedRemoteElementInfo[e].ribbonAddTime=t):this._localUserParticipantInfo.ribbonAddTime=t}_elementRenderInfo(e){if(e===_.CallStageElementKeys.localUserKey){const e=b.CallUIUtils.renderVideoPreview(this.state,this.props);return{renderKey:_.CallStageElementKeys.localUserKey,mri:F.default.getSkypeMri(),videoStatus:e?_.VideoStatus.Streaming:_.VideoStatus.None,videoDimensions:e?this.props.viewRect:b.DummyVideoSize,isAScreensharing:!1,isLocal:!0,isMuted:this.state.isMuted,isHandRaised:this.state.isHandRaised,streamsStatus:e?_.CallParticipantStreamsStatus.Single:_.CallParticipantStreamsStatus.None,streams:[{endpointId:_.CallStageElementKeys.localUserKey,videoStatus:e?_.VideoStatus.Streaming:_.VideoStatus.None,videoDimensions:e?this.props.viewRect:b.DummyVideoSize}]}}{const t=!this.props.enableNewCaptureActivityPip||this.props.isVideoTarget,i=this.state.renderedRemoteElementInfo[e];if(i)return{renderKey:e,mri:i.mri,isLocal:!1,videoStatus:t?i.videoStatus:_.VideoStatus.None,videoDimensions:t?i.videoDimensions:b.DummyVideoSize,isAScreensharing:i.isScreensharing,isScreenshareControlling:i.isScreenshareControlling,isRinging:i.isRinging,isOnHold:i.isOnHold,isMuted:i.isServerMuted,renderScreenShare:i.renderScreenShare,isPresenter:i.mri===this.state.screensharingUserMri,isHandRaised:i.isHandRaised,streamsStatus:i.streamsStatus,streams:i.streams}}}_getParticipantIconSize(e){const t=b.CallUIUtils.shouldRenderStage(this.state)&&n.includes(this.state.stageElements,e);let i=this._ribbonItemHeight(this.state);if(t)switch(this.state.stageElements.length){case 1:i=te.UserIconSize.Size120;break;case 2:i=te.UserIconSize.Size100}return i}_draggingElementKey(){return this.state.draggingElementKey}_getNameTagControlsHeight(){return 70}_renderStage(){const e=[],t=n.size(this.state.stageElements);let i=this.state.stageElements;this._topElement&&n.includes(i,this._topElement)&&(i=n.without(this.state.stageElements,this._topElement),i.push(this._topElement));const a=n.map(i,(e=>this._elementRenderInfo(e))),o=n.map(a,((e,i)=>this._renderStageParticipant(e,i,t)));e.push.apply(e,o);const r=[re.stageContainerStyle];return this._getCurrentCallPanelHeaderLayout()===_.CallPanelHeaderLayout.Window&&r.push(re.windowTopOffsetStageContainerStyle),this._layoutController.shouldSwitchOrientation()&&r.push(re.modernStageLandscapeContainerStyle),s.createElement(s.View,{key:"callStage",style:r},e)}_shouldShowParticipantContextMenu(e){if(e.renderScreenShare||e.isLocal)return!1;if(!this.state.isFullscreenBotCall)return!0;return!(this.props.stageLayoutMode!==_.StageMode.TogetherMode)&&this.state.showChangeTogetherModeBackgroundOption}_renderStageParticipant(e,t,i){if(!e)return null;const a=this._draggingElementKey(),o=this.state.enableLayoutAnimation&&!this._suppressElementAnimation,r=e.isLocal;let l;(e.isMuted||e.isOnHold||e.isAScreensharing)&&(l=b.CallUIUtils.accessoryPosition(t,i,!!this.props.isLandscape));const c=b.CallUIUtils.nametagOffset(i,this._getNameTagControlsHeight()),d=a===e.renderKey,u=n.includes(this.state.nonInteractiveInCallBotMris,e.renderKey),h=e.renderScreenShare||this.state.isFullscreenBotCall||e.streamsStatus===_.CallParticipantStreamsStatus.Multiple;return s.createElement(g.CallParticipantView,{key:e.renderKey,ref:this._mountedRefsMap.onComponentRef(e.renderKey),callId:this.props.callId,conversationMri:this.props.conversationMri,nametagPosition:c,showContextMenu:this._shouldShowParticipantContextMenu(e)||r,showChangeTogetherModeBackgroundOption:this.state.showChangeTogetherModeBackgroundOption,renderKey:e.renderKey,renderInfo:e,isDragging:d,onUpdateElementLink:this._updateElementLink,iconOpacity:this.props.hideFullscreenIcon?0:1,onPan:this._onStageElementPan,onTap:this._onStageElementTap,onDoubleTap:this._onDoubleTap,onPressInOrOut:this._onElementPressInOrOut,onScalingModeChanged:this._onElementScalingModeChanged,getCallReactionsDisplayHelper:this._getCallReactionsDisplayHelper,animateIconChanges:o,accessoryPosition:l,isGroupCall:!this.state.isOneOnOneConversation,accessoryOpacityStyle:this.props.callParticipantOpacityStyle,nametagOpacityStyle:this.props.callParticipantTooltipStyle,enableVideoGestures:1===i,forceSizeToFit:h,shouldWaitForVideoSize:!1,useMobileReactionsLayout:this.props.useMobileControls,parentViewId:"CallStageView#StageView",onCallParticipantContextMenuOpened:this.props.onCallParticipantContextMenuOpened,onCallParticipantContextMenuDismissed:this.props.onCallParticipantContextMenuDismissed,renderMobileNameTag:1===i,hideNameTag:this.props.hideNameTag||u,useDarkBackground:!0,enableFloatableResizableVideoPreview:e.isLocal&&!e.isAScreensharing?this.props.enableFloatableResizableVideoPreview:void 0,isSpeakerMode:this.props.stageLayoutMode===_.StageMode.Speaker,desktopNameTag:!this.props.useMobileControls,experimentalVideo:this.state.stageElements.length>4,isFullscreenBotCall:this.state.isFullscreenBotCall,layoutController:this._layoutControllerForKey,iconSize:this._getParticipantIconSize(e.renderKey),isScreenSharing:e.mri===this.state.screensharingUserMri,isPstnTranslationEnabled:this.props.isPstnTranslationEnabled})}_renderCelebrationAnimationView(){return s.createElement(w.default,{key:"celebrationAnimationView",conversationMri:this.props.reactionsConversationId,callId:this.props.callId,height:this.props.viewRect.height,width:this.props.viewRect.width,isLandscape:this.props.isLandscape})}_renderContent(){if(this.state.stageMode===_.CallStageViewMode.None||!this.state.isCallVisible)return;let e=[];if(b.CallUIUtils.shouldRenderStage(this.state)&&e.push(this._renderStage()),(!this.state.draggingElementKey||this.state.draggingElementKey===_.CallStageElementKeys.localUserKey&&this.props.enableFloatableResizableVideoPreview)&&!this.props.useHighContrastTheme)if(this.state.enableMultiGradientOverlay&&this.props.callStageOverlayOpacityStyle){const t=this.props.useMobileControls?.45:.25,i=[Z.Color.transparent,Z.Color.blackOverlay40],a=[this.props.callStageOverlayOpacityStyle,s.Styles.createViewStyle({height:this.props.viewRect.height*t},!1)];this._getCurrentCallPanelHeaderLayout()!==_.CallPanelHeaderLayout.Window&&e.push(s.createElement(s.Animated.View,{key:"callStageOverlayTop",blockPointerEvents:!0,ignorePointerEvents:!0,style:[a,re.overlayTopContainer]},s.createElement(o.GradientView,{style:J.default.flexOne,colors:i,direction:o.GradientDirection.TOP,ignorePointerEvents:!0}))),this.props.useMobileControls&&e.push(s.createElement(s.Animated.View,{key:"callStageOverlayBottom",blockPointerEvents:!0,ignorePointerEvents:!0,style:[a,re.overlayBottomContainer]},s.createElement(o.GradientView,{style:J.default.flexOne,colors:i,direction:o.GradientDirection.BOTTOM,ignorePointerEvents:!0})))}else if(this.props.useMobileControls){const t=[re.overlayContainer,s.Styles.createViewStyle({top:b.CallUIUtils.getStageTopOffset(this.props)},!1)];this.props.callStageOverlayOpacityStyle&&t.push(this.props.callStageOverlayOpacityStyle),this.state.enableTapToFlipCamera&&t.push(re.mobileOverlayShim),e.push(s.createElement(s.Animated.View,{key:"callStageOverlay",blockPointerEvents:!0,ignorePointerEvents:!0,style:t}))}if(this.props.useHighContrastHeaderTheme){const t=this._getHeaderBackdropContainerHeightStyle(this.props.stageLayoutMode,this.state.ribbonType),i=[re.backdropContainer,t,this._themeStyles.primaryBackgroundColorStyle,this.props.callHeaderOpacityStyle];e.push(s.createElement(s.Animated.View,{key:"headerbackdrop",style:i}))}return e.push.apply(e,this._renderRibbon()),this.state.isNavigatingWithKeyboard||e.push(s.createElement(p.default,{key:"nametag",getAnchorInfo:this._getAnchorInfo,getAnchorInfoChanges:this._getAnchorInfoChanges,parentDimensions:this.props.viewRect,opacityStyle:this.props.callParticipantTooltipStyle,callId:this.props.callId,conversationMri:this.props.conversationMri,onCallParticipantContextMenuOpened:this.props.onCallParticipantContextMenuOpened,onCallParticipantContextMenuDismissed:this.props.onCallParticipantContextMenuDismissed,onNametagMouseEnter:this._onCallParticipantNametagMouseEnter,onNametagMouseLeave:this._onCallParticipantNametagMouseLeave})),e}_renderRibbon(){if(this.state.stageMode===_.CallStageViewMode.StageOnly)return;const e=[],t=this._getRibbonBackdropContainerHeightStyle(this.props.stageLayoutMode,this.state.ribbonType),i=[re.backdropContainer,t,this._ribbonAnimatedWidthStyle];e.push(s.createElement(s.Animated.View,{key:"ribbon",style:i,importantForAccessibility:s.Types.ImportantForAccessibility.NoHideDescendants},s.createElement(s.GestureView,{style:re.ribbonBackdrop,onPanHorizontal:this._onRibbonBackdropPan})));const a=b.CallUIUtils.shouldRenderStage(this.state)?this.state.stageElements:[],o=this._draggingElementKey(),r=!this.state.ribbonHidden;let l=!0,c=[];if(!n.includes(a,_.CallStageElementKeys.localUserKey)&&o!==_.CallStageElementKeys.localUserKey){const e=this._elementRenderInfo(_.CallStageElementKeys.localUserKey);e&&c.push(e)}let d=n.keys(this.state.renderedRemoteElementInfo);if(d=n.difference(d,a),o){if(this.props.enableFloatableResizableVideoPreview){const e=o!==_.CallStageElementKeys.localUserKey,t=o===_.CallStageElementKeys.localUserKey&&n.includes(this.state.stageElements,_.CallStageElementKeys.localUserKey);l=e||t}d=n.without(d,o)}e.push(this._renderCelebrationAnimationView());const u=this._ribbonItemHeight(this.state);e.push(s.createElement(G.default,{key:"remainder",ref:this._onRemainderViewRef,layoutController:this._layoutControllerForKey(_.CallStageElementKeys.remainderViewKey),dimensions:{height:u,width:u},useHighContrastTheme:this.props.useHighContrastHeaderTheme,onPress:this._onRemainderViewPressed})),this._shouldShowRibbonModeSelector()&&(this.state.enableNewLayoutPicker?e.push(s.createElement(O.default,{key:"ribbonMode",availableLayoutModes:b.CallUIUtils.getAvailableHeaderModes(this.props.useMobileControls,this.state.isOneOnOneConversation),callId:this.props.callId,conversationMri:this.props.conversationMri,layoutController:this._layoutControllerForKey(_.CallStageElementKeys.ribbonModeViewKey),dimensions:{height:u,width:_.LayoutPickerButtonWidth},useHighContrastTheme:this.props.useHighContrastHeaderTheme,isIncomingOrOutGoingRing:this.props.isIncomingOrOutgoingRing,showChevron:!0,useMobileCallControls:this.props.useMobileControls})):e.push(s.createElement(W.default,{key:"ribbonMode",availableLayoutModes:b.CallUIUtils.getAvailableHeaderModes(this.props.useMobileControls,this.state.isOneOnOneConversation),callId:this.props.callId,conversationMri:this.props.conversationMri,layoutController:this._layoutControllerForKey(_.CallStageElementKeys.ribbonModeViewKey),dimensions:{height:u,width:u},layoutMode:this._getCurrentCallPanelHeaderLayout(),useHighContrastTheme:this.props.useHighContrastHeaderTheme,onCallPanelHeaderLayoutChange:this.props.onCallPanelHeaderLayoutChange,showFullScreenOptionInRibbonSettings:this.props.showFullScreenOptionInRibbonSettings,isIncomingOrOutGoingRing:this.props.isIncomingOrOutgoingRing,showChevron:!0}))),this.state.enableAddToCallRibbonItem&&this.props.showParticipantsButton&&e.push(s.createElement(z.default,{key:"addtocall",layoutController:this._layoutControllerForKey(_.CallStageElementKeys.addToCallViewKey),dimensions:{height:u,width:u},coachMarkType:this.state.enableAddToCallCoachmark?P.CoachMarkType.CallPanelAddToCallButton:void 0,accessibilityLabel:N.getString("CallControlsOverFlowMenu.AddPeopleToCall"),useHighContrastTheme:this.props.useHighContrastHeaderTheme,onPress:this._onAddToCallViewPressed})),this._topElement&&n.includes(d,this._topElement)&&(d=n.without(d,this._topElement),d.push(this._topElement)),d=n.without(d,...this.state.nonInteractiveInCallBotMris);let h=n.map(d,(e=>this._elementRenderInfo(e)));c.push.apply(c,h);const p=n.map(c,(e=>{const t=!n.includes(a,e.renderKey),i=this.props.enableFloatableResizableVideoPreview&&this.props.onVideoPreviewFloating&&this.state.isProvidingVideo;if(e.renderKey!==_.CallStageElementKeys.localUserKey||!i&&!this.props.enableNewCallScreen)return this._renderCallElementView(e,t,this.state.enableTapToMoveCallParticipant,r)}));if(e.push.apply(e,p),e.push(s.createElement(m.CallStageDropTarget,{key:"background",type:m.CallStageDropTargetType.Background})),o&&l){const t=this._elementRenderInfo(o);if(t){const i=!n.includes(a,t.renderKey);if(i){const a=this._renderCallElementView(t,i,!1,r);e.push(a)}}}if(e.push(s.createElement(m.CallStageDropTarget,{key:"foreground",type:m.CallStageDropTargetType.Foreground})),!this.props.disableReactions){const t=s.createElement(R.default,{ref:this._onInlineCallStageReactionsViewRef,reactionsConversationMri:this.props.reactionsConversationId,ignorePointerEvents:!0,parentDimensions:this.props.viewRect,topOffsetForUnhandledReactions:u+(this.props.topInset||0)+20,alignRight:!0,getAnchorInfo:this._getAnchorInfo,getAnchorInfoChanges:this._getAnchorInfoChanges,getCallReactionsDisplayHelper:this._getCallReactionsDisplayHelper,onReactionTap:this._onTextReactionPressed});e.push(s.createElement(s.Animated.View,{style:[re.reactionsView,this._stageReactionsAnimatedStyle],key:_.CallStageElementKeys.callTextReactionViewKey,ignorePointerEvents:!0},t))}return e}_renderCallElementView(e,t,i=!1,a=!1){const n=this.state.enableTapToFlipCamera&&e.isLocal&&e.videoStatus===_.VideoStatus.Streaming&&t,o=e.renderKey===b.CallUIUtils.screenShareKey(this.state),r=e.isLocal,l=!e.renderScreenShare&&!e.isLocal;let c;c=t&&e.isRinging?this._onRemainderViewPressed:o?this._onScreenshareTap:i?this._onRibbonElementTapBinder:n?this.props.onParticipantViewTapped:this._onStageTapBinder;const d=t&&!e.isRinging&&!this.state.enableImmersiveMode&&this.state.enableTapToMoveCallParticipant?this._onToggleParticipantFocus:void 0,u=this.state.enableLayoutAnimation&&!this._suppressElementAnimation;let h=0;if(t){const t=e.renderScreenShare||e.isLocal;h=e.videoStatus===_.VideoStatus.Streaming&&t?_.RibbonSizes.ribbonItemRectBorderRadius:this._ribbonItemHeight(this.state)/2}return s.createElement(g.CallParticipantView,{key:e.renderKey,ref:this._mountedRefsMap.onComponentRef(e.renderKey),showContextMenu:l||r,renderInfo:e,renderKey:e.renderKey,isCompact:t,callId:this.props.callId,isGroupCall:!this.state.isOneOnOneConversation,conversationMri:this.props.conversationMri,isDragging:this._draggingElementKey()===e.renderKey,onUpdateElementLink:this._updateElementLink,onPan:!e.isRinging&&a?this._onElementPan:void 0,onResize:e.renderKey===_.CallStageElementKeys.localUserKey&&this.props.enableFloatableResizableVideoPreview?this._onElementResize:void 0,onPressInOrOut:!e.isRinging&&a?this._onElementPressInOrOut:void 0,onScalingModeChanged:this._onElementScalingModeChanged,onMouseOverOrOut:this._onElementMouseOverOrOut,onTap:c,onDoubleTap:d,getCallReactionsDisplayHelper:this._getCallReactionsDisplayHelper,iconOpacity:1,videoBorderRadius:h,animateIconChanges:u,useMobileReactionsLayout:this.props.useMobileControls,forceSizeToFit:e.renderScreenShare,parentViewId:"CallStageView#CallElementView",allowCameraFlip:n,onCallParticipantContextMenuOpened:this.props.onCallParticipantContextMenuOpened,onCallParticipantContextMenuDismissed:this.props.onCallParticipantContextMenuDismissed,useDarkBackground:!0,enableFloatableResizableVideoPreview:e.isLocal&&!e.isAScreensharing?this.props.enableFloatableResizableVideoPreview:void 0,isSpeakerMode:this.props.stageLayoutMode===_.StageMode.Speaker,experimentalVideo:this.state.stageElements.length>4,isFullscreenBotCall:this.state.isFullscreenBotCall,layoutController:this._layoutControllerForKey,iconSize:this._getParticipantIconSize(e.renderKey),isCallStageV2:!1,isScreenSharing:this.state.screensharingUserMri===e.mri,isPstnTranslationEnabled:this.props.isPstnTranslationEnabled})}_ribbonItemHeight(e,t,i,a){return this._shouldUseMobilePreviewPercentage(!!t,!!i,!!a)?this._mobilePreviewPercentageSize():e.ribbonType===_.RibbonType.Large?_.RibbonSizes.ribbonItemSizeLarge:_.RibbonSizes.ribbonItemSizeSmall}_shouldUseMobilePreviewPercentage(e,t,i){return!1}_mobilePreviewPercentageSize(){return this.props.isLandscape?this.props.viewRect.width*this.state.mobilePreviewPercentage:this.props.viewRect.height*this.state.mobilePreviewPercentage}_anchorInfoForRect(e,t){const i=b.CallUIUtils.translateRect(e,this.props.viewRect.width);let a=t;return i&&(a||i.x<0)&&(i.x=0,a=!0),{rect:i,hidden:a}}render(){return s.createElement(s.View,{style:this.props.style},this._renderContent())}}t.CallStageView=le,t.default=le},57033:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallStageViewV2=void 0;const a=i(96486),n=i(16778),o=i(94224),s=i(60289),r=i(98925),l=i(80200),c=i(46096),d=i(36237),u=i(15877),h=i(90678),p=i(81760),g=i(80837),C=i(24576),m=i(53374),S=i(75377),y=i(86251),f=i(34548),_=i(6250),b=i(37103),T=i(56018),v=i(98053),w=i(2278),I=i(36850),P=(0,u.lazyProperties)({reactionsView:()=>g.default.absoluteFill,stageContainerStyle:()=>n.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:p.Color.transparent,flex:1,flexDirection:"column",flexWrap:"wrap",justifyContent:"center",alignSelf:"center"}),horizontalPaddingStyle:()=>n.Styles.createViewStyle({paddingHorizontal:4}),modernStageLandscapeContainerStyle:()=>n.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap"})});class M extends C.default{constructor(){super(...arguments),this._callReactionsDisplayHelper=new s.default,this._layoutController=new S.default(!0),this._mountedRefsMap=new _.default,this._updateElementLink=(e,t,i,a,n,s,r,l)=>{o.default.VideoLinksManager.updateElementLink(this.props.callId,e,t,i,a,n,s,r,l)},this._layoutControllerForKey=e=>this._layoutController.controllerForKey(e),this._onElementScalingModeChanged=(e,t,i,a)=>{o.default.VideoLinksManager.onElementScalingModeChanged(this.props.callId,e,t,i,a)},this._getCallReactionsDisplayHelper=()=>this._callReactionsDisplayHelper,this._onViewRef=e=>{this._parentViewRef=e||void 0},this._getParentRefForReactions=()=>this._parentViewRef,this._getChildRefForReactions=e=>this._mountedRefsMap.ref(e)}_buildState(e,t){return{stageElements:T.default.getStageElements(e.callId),showChangeTogetherModeBackgroundOption:v.ChangeTogetherModeBackgroundCommand.canExecute(e.callId,e.conversationMri),showMyselfInTheGrid:I.default.getSelfInTheGrid(e.callId)}}componentDidMount(){super.componentDidMount(),d.log(c.LogTraceArea.CallingUI,"CallStageView.componentDidMount"),o.default.SpeakerViewTelemetryService.startTracking(this.props.callId),w.default.setHadNewCallStageEnabled(this.props.callId,m.default.newCauseId())}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i);const a=m.default.newCauseId();d.log(c.LogTraceArea.CallingUI,"CallStageView.UNSAFE_componentWillUpdate causeId: "+a),this._updateElementLayout(t,e,a)}componentWillUnmount(){super.componentWillUnmount();const e=m.default.newCauseId();d.log(c.LogTraceArea.CallingUI,"CallStageView.componentWillUnmount causeId: "+e),o.default.CallingStore.isCallConnected(this.props.callId)?d.log(c.LogTraceArea.CallingUI,"CallStageView.componentWillUnmount: Call is still connected; leaving videos attached causeId: "+e):(d.log(c.LogTraceArea.CallingUI,"CallStageView.componentWillUnmount: Call is not connected; tearing down videos causeId: "+e),o.default.VideoLinksManager.removeVideoLinks(this.props.callId,e)),o.default.SpeakerViewTelemetryService.stopTracking(this.props.callId)}_renderCelebrationAnimationView(){return n.createElement(y.default,{key:"celebrationAnimationView",conversationMri:this.props.reactionsConversationId,callId:this.props.callId,height:this.props.viewRect.height,width:this.props.viewRect.width,isLandscape:this.props.isLandscape})}_updateElementLayout(e,t,i){if(d.log(c.LogTraceArea.CallingUI,"CallStageView._updateElementLayout causeId: "+i),0===t.viewRect.width||0===t.viewRect.height)return;const n=a.map(e.stageElements,(t=>{const i=a.indexOf(e.stageElements,t);return{key:t,videoType:l.LayoutInfoVideoType.None,isLocal:l.CallStageElementKeys.localUserKey===t,isHostOfScreenshare:0===t.indexOf(r.ScreenSharingPrefix),stagePosition:i}}));this._layoutController.updateLayoutInfoForStage(n,this._adjustedStageViewRectV2(t.viewRect)),T.default.setStageCapacity(t.callId,this._layoutController.getMaxNumberOfStageElements())}_renderStageParticipant(e){return n.createElement(b.default,{key:e,renderKey:e,ref:t=>{this._onParticipantViewRef(t,e)},callId:this.props.callId,conversationMri:this.props.conversationMri,nametagPosition:{offset:0},onUpdateElementLink:this._updateElementLink,iconOpacity:1,isGroupCall:!this.props.isOneOnOneConversation,parentViewId:"CallStageView#StageView",onCallParticipantContextMenuOpened:this.props.onCallParticipantContextMenuOpened,onCallParticipantContextMenuDismissed:this.props.onCallParticipantContextMenuDismissed,hideNameTag:this.props.hideNameTag,useDarkBackground:!0,desktopNameTag:!0,isCallStageV2:!0,useLightTheme:this.props.useLightTheme,experimentalVideo:this.state.stageElements.length>4,getCallReactionsDisplayHelper:this._getCallReactionsDisplayHelper,layoutController:this._layoutControllerForKey,iconSize:120,showChangeTogetherModeBackgroundOption:this.state.showChangeTogetherModeBackgroundOption,onScalingModeChanged:this._onElementScalingModeChanged,borderRadius:3,videoBorderRadius:3,isPstnTranslationEnabled:this.props.isPstnTranslationEnabled})}_adjustedStageViewRectV2(e){return{x:e.x,y:e.y+l.DesktopNewHeaderHeight,width:e.width,height:e.height-l.DesktopCallControlsHeight-l.DesktopNewHeaderHeight}}_onParticipantViewRef(e,t){o.default.VideoLinksManager.getMountedRefsMapStage().onComponentRef(t).call(this,e),this._mountedRefsMap.onComponentRef(t).call(this,e)}_renderStage(){const e=a.map(this.state.stageElements,(e=>this._renderStageParticipant(e))),t=[P.stageContainerStyle];return this.props.isOneOnOneConversation||t.push(P.horizontalPaddingStyle),this._layoutController.shouldSwitchOrientation()&&t.push(P.modernStageLandscapeContainerStyle),n.createElement(n.View,{key:"callStage",style:[t,this.props.style],ref:this._onViewRef},e,this._maybeRenderLocalVideoView())}_renderReactionsView(){return n.createElement(f.NewCallReactionsView,{reactionsConversationId:this.props.reactionsConversationId,parentDimensions:this.props.viewRect,getChildRef:this._getChildRefForReactions,getParentRef:this._getParentRefForReactions,onTextReactionPressed:this.props.onTextReactionPressed,disableReactions:this.props.disableReactions,getCallReactionsDisplayHelper:this._getCallReactionsDisplayHelper})}_maybeRenderLocalVideoView(){if(this.props.isOneOnOneConversation&&this.props.stageLayoutMode===l.StageMode.Grid&&!this.state.showMyselfInTheGrid)return n.createElement(h.default,{key:"localVideoView",onUpdateElementLink:this._updateElementLink,getCallReactionsDisplayHelper:this._getCallReactionsDisplayHelper,callId:this.props.callId,conversationMri:this.props.conversationMri,useLightTheme:this.props.useLightTheme})}render(){return[this._renderStage(),this._renderReactionsView(),this._renderCelebrationAnimationView()]}}t.CallStageViewV2=M},54090:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(88837),o=i(71830),s=i(52262),r=i(38891),l=i(15877),c=i(33754),d=i(18078),u=i(81760),h=i(19675),p=i(2301),g=i(67977),C=i(89391),m=i(40363),S=(0,l.lazyProperties)({container:()=>a.Styles.createViewStyle({alignItems:"flex-start",marginBottom:2}),userIcon:()=>a.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,overflow:"visible"}),textSize20:()=>a.Styles.createTextStyle({fontSize:20})});class y extends n.ComponentBase{_buildState(e,t){let i=c.getString("Notifications.UnknownUserShort");if(e.uiv2&&e.transcription.senderMri){const t=o.sanitizeMri(e.transcription.senderMri,o.Namespaces.SkypeId);if(t)if(d.default.isMyMri(t))i=c.getString("DisplayInfoStore.ListMyName");else{i=(C.default.getS4LCMCFeatures().callCaptionsUiV2ShortName?s.default.getShortDisplayName(t):s.default.getDisplayName(t))||c.getString("Notifications.UnknownUserShort")}}return{displayName:i}}render(){let e;if(this.props.transcription.messages&&this.props.transcription.messages.length>0&&this.props.transcription.payloads&&this.props.transcription.payloads.length>0&&this.props.transcription.sentences&&this.props.transcription.sentences.length>0){e="";for(let t=0;t<this.props.transcription.messages.length;t++){const i=this.props.isInterimCaptionConcatenated?this.props.transcription.sentences[t]:this.props.transcription.payloads[t].translation||this.props.transcription.payloads[t].message;i&&(e+=i+" ")}}else e=this.props.isInterimCaptionConcatenated?this.props.transcription.sentence:this.props.transcription.payload.translation||this.props.transcription.payload.message;if(!e)return null;const t=!(this.props.uiPstn&&this.props.callParticipantCount&&1===this.props.callParticipantCount),i=this.props.uiv2?this.props.captionPositionMode===r.CaptionsPositionMode.bottom?g.UserIconSize.Size24:g.UserIconSize.Size40:this.props.iconSize,n=t?i/2:0;let o,s=!this.props.isInterimCaptionHighlightEnabled||this.props.transcription.payload.isFinal?u.Color.white:u.Color.gray300,l=u.Color.blackOverlay80;this.props.uiPstn?s=this.props.useLightTheme?u.Color.delphiPrimaryTextColor:u.Color.gray50:this.props.uiv2&&this.props.useLightTheme?(s=!this.props.isInterimCaptionHighlightEnabled||this.props.transcription.payload.isFinal?u.Color.black:u.Color.blackOverlay80,o=u.Color.blackOverlay50,l=u.Color.whiteOverlay80):this.props.uiv2&&(o=u.Color.gray50Overlay50);const c=[S.userIcon],d=[S.container],y=[a.Styles.createViewStyle({alignItems:"flex-start",marginLeft:n},!1)],f=[a.Styles.createTextStyle({paddingLeft:n+10,paddingRight:10,color:s},!1)];if(this.props.uiPstn)f.push(a.Styles.createTextStyle({fontSize:25,paddingVertical:6},!1));else if(this.props.uiv2){const e=i+16;if(this.props.captionPositionMode===r.CaptionsPositionMode.bottom)d.push(a.Styles.createViewStyle({marginBottom:10,minHeight:e},!1)),this.props.isUsingStackNavigationContext||f.push(S.textSize20);else{if(m.default.isElectronWindows()){const e=C.default.getS4LCMCFeaturesNoSubscription().callCaptionsFloatPanel.letterSpacingWindows;e>0&&f.push(a.Styles.createTextStyle({letterSpacing:e},!1))}d.push(a.Styles.createViewStyle({borderRadius:8,backgroundColor:l,paddingHorizontal:12,paddingVertical:8,marginBottom:4,minHeight:e},!1));const t={backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)"};d.push(t),c.push(a.Styles.createViewStyle({marginLeft:12,marginTop:8},!1))}}else y.push(a.Styles.createViewStyle({borderRadius:3,backgroundColor:l},!1)),f.push(a.Styles.createTextStyle({minHeight:this.props.iconSize,paddingVertical:2},!1));let _,b;if(t&&(_=a.createElement(a.View,{style:c,key:"icon"},a.createElement(p.UserIcon,{userMri:this.props.transcription.senderMri,size:i,showBorder:!0}))),this.props.uiPstn)b=void 0;else if(this.props.uiv2){const e=a.Styles.createTextStyle({fontSize:12,paddingBottom:2,color:o||s},!1);b=a.createElement(a.View,{style:[y,e],key:"nametag"},a.createElement(h.BodyText,{style:[f,e]},this.state.displayName))}return a.createElement(a.View,{style:d,disableTouchOpacityAnimation:!0},b,a.createElement(a.View,{style:y,key:"text"},a.createElement(h.BodyText,{style:f},e)),_)}}t.default=y},91:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(16778),o=i(89391),s=i(94224),r=i(54090),l=i(18154),c=i(85107),d=i(77381),u=i(77388),h=i(13944),p=i(61253),g=i(15877),C=i(33754),m=i(30124),S=i(53172),y=i(81760),f=i(11828),_=i(69015),b=f.IconSize.default,T=f.IconSize.size24,v=f.IconSize.size40,w=f.IconSize.size20,I=(0,g.lazyProperties)({scroll:()=>n.Styles.createViewStyle({flex:1,alignItems:"stretch",backgroundColor:y.Color.black}),buttonIconsContainer:()=>n.Styles.createViewStyle({height:b,alignItems:"flex-start",flexDirection:"row",justifyContent:"space-between"}),buttonIcon:()=>n.Styles.createViewStyle({width:b,height:b,justifyContent:"center",alignItems:"center",alignSelf:"flex-start",opacity:.9,overflow:"visible"}),buttonJumpContainer:()=>n.Styles.createViewStyle({position:"absolute",right:12,width:v,height:v,overflow:"visible"}),buttonJump:()=>n.Styles.createViewStyle({width:v,height:v,borderWidth:1,borderRadius:v/2,borderColor:y.Color.blackOverlay10,justifyContent:"center",alignItems:"center",opacity:.9,overflow:"visible",backgroundColor:y.Color.gray400}),buttonHovered:()=>n.Styles.createViewStyle({opacity:1})});class P{constructor(e,t,i){this.key=e,this.transcription=t,this.height=i,this.focusable=!1}}class M extends d.default{constructor(){super(...arguments),this._renderItem=(e,t)=>e instanceof P?n.createElement(r.default,{key:e.key,transcription:e.transcription,iconSize:c.SenderAvatarSize,isInterimCaptionConcatenated:this.state.isInterimCaptionConcatenated,isInterimCaptionHighlightEnabled:this.state.isInterimCaptionHighlightEnabled,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext}):n.createElement(n.View,null),this._onPressClose=e=>{e.stopPropagation(),this.state.canJumpToEnd||l.default.setConsumptionHorizon(this.props.reactionsMri,this.state.lastMessageTime+1),this.props.onPressClose&&this.props.onPressClose()},this._onPressClosedCaptionSettings=e=>{e.stopPropagation(),s.default.CallNavigationHelper.navigateToSubtitlesCallingSettingsPanel(!1,this._getRootViewId())},this._onPressJump=e=>{e.stopPropagation(),this._listView&&this._listView.scrollToBottom()},this._onVisibleRangeChanged=(e,t,i,n)=>{if(!this._itemList)return;const o=n!==this._itemList.getItemList().length-1;a.defer((()=>{this.isComponentMounted()&&(this.state.canJumpToEnd!==o?this.setState({canJumpToEnd:o}):l.default.resetUnseenTranscriptionCount(this.props.reactionsMri))}))},this._equalsItemInfo=(e,t)=>e instanceof P&&t instanceof P?e.key===t.key&&e.transcription.payload.message===t.transcription.payload.message&&e.transcription.payload.translation===t.transcription.payload.translation&&e.transcription.payload.isFinal===t.transcription.payload.isFinal:(0,p.default)(e,t),this._shouldUpdateItem=(e,t)=>!this._equalsItemInfo(e,t),this._onListViewRef=e=>{this._listView=e||void 0}}_buildState(e,t){var i,n;const s=o.default.getS4LCMCFeatures(),r=l.default.getTranscriptions(e.reactionsMri),c=a.map(r,(e=>new P(e.payload.cid,e))),d=null!==(n=null===(i=a.maxBy(r.map((e=>e.message)),(e=>e.createdTime)))||void 0===i?void 0:i.createdTime)&&void 0!==n?n:0;if(t||!this._itemList)this._itemList=new S.default,this._itemList.addItems(0,c);else{const e=this._itemList.getItemList(),t=u.default.calculateModifications(e,c,!0,!1,this._equalsItemInfo),i=u.default.convertToListModifications(t);this._itemList.applyMany(i)}return{isInterimCaptionConcatenated:s.isInterimCaptionConcatenated,isInterimCaptionHighlightEnabled:s.isInterimCaptionHighlightEnabled,lastMessageTime:d,isUsingStackNavigationContext:m.default.isUsingStackNavigationContext()}}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),l.default.assignCallId(this.props.reactionsMri,this.props.callId)}render(){if(!this._itemList)return null;const e=this.props.bottomPadding||10,t=this.props.topPadding,i=n.Styles.createViewStyle({paddingBottom:e,paddingTop:t},!1),a=this.state.canJumpToEnd?this._renderJumpButton():void 0;return n.createElement(n.View,{key:"subtitleHistory",style:[this.props.style,I.scroll,i]},n.createElement(n.View,{key:"buttonIconsContainer",style:I.buttonIconsContainer},n.createElement(h.default,{style:I.buttonIcon,size:T,color:y.Color.gray50,hoverColor:y.Color.white,hoverStyle:I.buttonHovered,icon:f.SkypeIcon.ClosePanel,onPress:this._onPressClose,title:C.getString("CallTranscription.Collapse")}),n.createElement(h.default,{style:I.buttonIcon,size:T,color:y.Color.gray50,hoverColor:y.Color.white,hoverStyle:I.buttonHovered,icon:f.SkypeIcon.ClosedCaptionSettings,onPress:this._onPressClosedCaptionSettings,title:C.getString("CallingSettingsPanel.SubtitlesButtonLabel")})),n.createElement(_.VirtualMessageView,{ref:this._onListViewRef,observableList:this._itemList,renderItem:this._renderItem,onVisibleRangeChanged:this._onVisibleRangeChanged,shouldUpdateItem:this._shouldUpdateItem,contentMaxWidth:c.SubtitleMaxWidth,horizontalPadding:{left:30,right:30},useWideLayout:!1,leftSpacerWidth:0,rightSpacerWidth:0,canShowSuggestions:!1}),a)}_renderJumpButton(){const e=this.props.bottomPadding||10,t=n.Styles.createViewStyle({bottom:e},!1);return n.createElement(n.View,{key:"jumpToEnd",style:[I.buttonJumpContainer,t]},n.createElement(h.default,{style:I.buttonJump,hoverStyle:I.buttonHovered,size:w,onPress:this._onPressJump,color:y.Color.gray100,hoverColor:y.Color.white,icon:f.SkypeIcon.DownChevron,title:C.getString("CallTranscription.JumpToLast")}))}}t.default=M},40584:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=(i(38933),i(23388),i(16778)),o=i(88837),s=i(89391),r=i(94224),l=i(54090),c=i(18154),d=i(85107),u=i(13944),h=i(61253),p=i(15877),g=i(33754),C=i(81760),m=i(11828),S=i(80837),y=i(19675),f=i(12770),_=i(38891),b=i(30124),T=m.IconSize.default,v=m.IconSize.size24,w=(0,p.lazyProperties)({container:()=>n.Styles.createViewStyle({alignItems:"stretch"}),captionsContainer:()=>n.Styles.createViewStyle({justifyContent:"flex-end",alignItems:"stretch"}),scrollInsideContainer:()=>n.Styles.createViewStyle({justifyContent:"flex-end",alignItems:"stretch"}),scrollInsideContainerDesktop:()=>n.Styles.createViewStyle({justifyContent:"flex-end",alignItems:"stretch"}),scrollInsideDesktop:()=>n.Styles.createViewStyle({justifyContent:"flex-end",alignItems:"stretch",flexGrow:1,flexShrink:1,flexBasis:"100%"}),preview:()=>n.Styles.createViewStyle({position:"absolute",left:0,right:0,bottom:0,justifyContent:"flex-end",alignItems:"stretch"}),messageContainer:()=>n.Styles.createViewStyle({position:"absolute",bottom:0,borderRadius:15,alignItems:"center",alignSelf:"center",backgroundColor:C.Color.blackOverlay35}),messageText:()=>n.Styles.createTextStyle({paddingHorizontal:16,paddingVertical:5,color:C.Color.white}),buttonExpandContainer:()=>n.Styles.createViewStyle({alignItems:"center",alignSelf:"center",opacity:.9}),buttonExpandTitle:()=>n.Styles.createTextStyle({color:C.Color.white,paddingHorizontal:16,paddingVertical:5}),buttonExpand:()=>n.Styles.createViewStyle({width:T,height:T,justifyContent:"center",alignItems:"center",overflow:"visible"}),gradientStyle:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row"}),maskedView:()=>n.Styles.createViewStyle({justifyContent:"flex-end",alignItems:"stretch"})});class I extends o.ComponentBase{constructor(){super(...arguments),this._onScrollViewRef=e=>{this._contentScrollRef=e||void 0},this._onScrollViewLayout=e=>{const t=e.height;t!==this.state.contentVisibleHeight&&this.setState({contentVisibleHeight:t},(()=>{this._scrollToBottom()}))},this._onScrollViewContentSizeChange=(e,t)=>{t!==this.state.contentHeight&&this.setState({contentHeight:t},(()=>{this._scrollToBottom()}))},this._renderItem=(e,t)=>n.createElement(l.default,{key:"item"+t,transcription:e,iconSize:d.SenderAvatarSize,isInterimCaptionConcatenated:this.state.isInterimCaptionConcatenated,isInterimCaptionHighlightEnabled:this.state.isInterimCaptionHighlightEnabled,uiPstn:this.state.uiPstn,uiv2:this.state.uiv2,callParticipantCount:this.state.callParticipantCount,useLightTheme:this.props.useLightTheme&&!this.state.uiv2AlwaysBlack,captionPositionMode:this.props.captionPositionMode,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext}),this._onLayout=e=>{!(0,h.default)(e,this.state.viewRect)&&this.isComponentMounted()&&this.setState({viewRect:e})},this._onPressOpen=e=>{e.stopPropagation(),this.props.onPressOpen&&this.props.onPressOpen()}}_buildState(e,t){var i,a;const n=s.default.getS4LCMCFeatures(),o=r.default.InCallBotService.isPstnTranslationEnabled(e.callId),l=o||e.captionPositionMode===_.CaptionsPositionMode.bottom?void 0:d.SubtitleMaxPreviewLines,u=n.callCaptionsUiV2&&n.callCaptionsMerge?c.default.getTranscriptionsMerged(e.reactionsMri,l):c.default.getTranscriptions(e.reactionsMri,l);return{hasHistory:0!==c.default.transcriptionCount(e.reactionsMri),viewRect:t?{x:0,y:0,width:0,height:0}:this.state.viewRect,isInterimCaptionConcatenated:n.isInterimCaptionConcatenated,isInterimCaptionHighlightEnabled:n.isInterimCaptionHighlightEnabled,callParticipantCount:r.default.CallingStore.connectedParticipantsCount(e.callId),uiPstn:o,uiv2:n.callCaptionsUiV2,uiv2AlwaysBlack:!o&&e.captionPositionMode!==_.CaptionsPositionMode.bottom&&n.callCaptionsUiV2AlwaysBlack,uiv2DynWidth:!o&&n.callCaptionsUiV2DynamicWidth,contentHeight:null===(i=this.state)||void 0===i?void 0:i.contentHeight,contentVisibleHeight:null===(a=this.state)||void 0===a?void 0:a.contentVisibleHeight,transcriptionsCount:c.default.transcriptionCount(e.reactionsMri),captionsClearTimeout:n.callCaptionsClearTimeout,transcriptions:u,isUsingStackNavigationContext:b.default.isUsingStackNavigationContext()}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),a.isEmpty(this.state.transcriptions)||(0,h.default)(this.state.transcriptions,t.transcriptions)||(c.default.resetUnseenTranscriptionCount(this.props.reactionsMri),this._scheduleCaptionsClearTimer())}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),c.default.assignCallId(this.props.reactionsMri,this.props.callId)}componentDidMount(){super.componentDidMount(),this._scheduleCaptionsClearTimer()}_scrollToBottom(){var e;const{contentHeight:t,contentVisibleHeight:i}=this.state;!(null===(e=this._contentScrollRef)||void 0===e?void 0:e.setScrollTop)||a.isUndefined(t)||a.isUndefined(i)||this._contentScrollRef.setScrollTop(t-i,!0)}render(){const e=this.state.hasHistory?void 0:this._renderMessage(g.getString("CallTranscription.StartSubtitles")),t=this._renderPreviewList();return n.createElement(n.View,{style:[w.container,this.props.style],onLayout:this._onLayout,ignorePointerEvents:!0},e,t)}_renderMessage(e){const t=[w.messageContainer],i=this.props.captionPositionMode===_.CaptionsPositionMode.bottom&&!this.state.isUsingStackNavigationContext;if(this.props.bottomPadding){const e=this.state.uiPstn||i?this.props.bottomPadding+15:this.props.bottomPadding;t.push(n.Styles.createViewStyle({bottom:e},!1))}return n.createElement(n.View,{key:"message",style:t},n.createElement(y.BodyText,{style:w.messageText},e))}_renderPreviewList(){const e=this._getHorizontalPadding(),t=n.Styles.createViewStyle({left:e,right:e,bottom:this.props.bottomPadding},!1),i=[w.captionsContainer];let o;if(this.props.showControls&&this.state.hasHistory&&!this.state.uiPstn&&!this.state.uiv2){const e=T,t=a.isEmpty(this.state.transcriptions)?n.createElement(y.BodyText,{style:w.buttonExpandTitle},g.getString("CallTranscription.Expand")):void 0;o=n.createElement(n.View,{key:"buttonExpandContainer",style:w.buttonExpandContainer},n.createElement(u.default,{style:w.buttonExpand,size:v,color:C.Color.gray50,hoverColor:C.Color.white,icon:m.SkypeIcon.UpChevron,onPress:this._onPressOpen,title:g.getString("CallTranscription.ExpandButton")}),t);const s=this.state.viewRect.height-e-(this.props.bottomPadding||0);s>0&&i.push(n.Styles.createViewStyle({maxHeight:s},!1))}const s=a.map(this.state.transcriptions,((e,t)=>this._renderItem(e,t)));let r;if(this.state.uiPstn||this.state.uiv2){const e=this.state.viewRect.height-(this.props.bottomPadding||0);e>0&&i.push(n.Styles.createViewStyle({height:e},!1)),i.push(S.default.flexGrowOne);const t=n.Styles.createViewStyle({minHeight:e},!1),a=e-.25*e,o={maskImage:"linear-gradient(0deg, black "+a+"px, transparent "+e+"px)",WebkitMaskImage:"linear-gradient(0deg, black "+a+"px, transparent "+e+"px)"};r=n.createElement(n.View,{style:[i,o]},n.createElement(n.ScrollView,{style:[i],ref:this._onScrollViewRef,onLayout:this._onScrollViewLayout,onContentSizeChange:this._onScrollViewContentSizeChange},n.createElement(n.View,{style:[w.scrollInsideContainerDesktop,t]},n.createElement(n.View,{style:[w.scrollInsideDesktop,this.state.uiv2DynWidth?S.default.alignItemsFlexStart:void 0]},s))))}else r=n.createElement(n.View,{key:"captionsContainer",style:i},s);return n.createElement(n.View,{key:"subtitlePreview",style:[w.preview,t]},o,r)}_getHorizontalPadding(){let e=d.SubtitleMaxWidth;const t=s.default.getS4LCMCFeaturesNoSubscription().callCaptionsBottomPanel.captionsWidthDesktopPercentage;!this.state.isUsingStackNavigationContext&&this.props.captionPositionMode===_.CaptionsPositionMode.bottom&&t>0?e=this.state.viewRect.width*t:this.state.uiv2&&(e=d.SubtitleMaxWidthV2);return Math.max((this.state.viewRect.width-e)/2,30)}_scheduleCaptionsClearTimer(){this._stopCaptionsClearTimer(),this.state.captionsClearTimeout>0&&(this._onCaptionsClearTimer=f.default.setTimeout((()=>{var e,t;const i=null!==(t=null===(e=a.maxBy(this.state.transcriptions.map((e=>e.message)),(e=>e.createdTime)))||void 0===e?void 0:e.createdTime)&&void 0!==t?t:0;c.default.setConsumptionHorizon(this.props.reactionsMri,i+1),this._onCaptionsClearTimer=void 0}),this.state.captionsClearTimeout))}_stopCaptionsClearTimer(){this._onCaptionsClearTimer&&(f.default.clearTimeout(this._onCaptionsClearTimer),this._onCaptionsClearTimer=void 0)}}t.default=I},43355:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallTransientStateViewType=void 0;i(7159);const a=i(16778),n=i(88837),o=i(10117),s=i(15877),r=i(81760),l=i(11828),c=i(80837),d=i(19675);var u;!function(e){e[e.Hold=0]="Hold",e[e.Reconnect=1]="Reconnect"}(u=t.CallTransientStateViewType||(t.CallTransientStateViewType={}));const h=(0,s.lazyProperties)({container:()=>a.Styles.createViewStyle({alignItems:"center",justifyContent:"center"}),innerContainer:()=>a.Styles.createViewStyle({height:160,width:160,borderRadius:10,paddingHorizontal:20,alignItems:"center",justifyContent:"center",backgroundColor:r.Color.blackOverlay50}),innerContainerIOS:()=>a.Styles.createViewStyle({backgroundColor:r.Color.transparent}),messageHeaderText:()=>a.Styles.createTextStyle({color:r.Color.white,textAlign:"center",backgroundColor:r.Color.transparent,marginTop:8}),messageText:()=>a.Styles.createTextStyle({color:r.Color.white,textAlign:"center",backgroundColor:r.Color.transparent,marginTop:4})});class p extends n.ComponentBase{constructor(){super(...arguments),this._opacityAnimationValue=new a.Animated.Value(0),this._opacityAnimationStyle=a.Styles.createAnimatedViewStyle({opacity:this._opacityAnimationValue})}componentDidMount(){super.componentDidMount(),a.Animated.timing(this._opacityAnimationValue,{duration:200,toValue:1,easing:a.Animated.Easing.Linear()}).start()}render(){const e=[c.default.absoluteFill,h.container,this._opacityAnimationStyle];this.props.style&&e.push(this.props.style);const t=[h.innerContainer,void 0],i=this.props.body?a.createElement(d.BodyText,{style:h.messageText,allowFontScaling:!1},this.props.body):void 0,n=this.props.type===u.Reconnect?l.SkypeIcon.Connecting:l.SkypeIcon.Pause;let s=a.createElement(a.View,{style:t},undefined,a.createElement(o.default,{icon:n,size:l.IconSize.default,color:r.Color.white}),a.createElement(d.RowTitle,{style:h.messageHeaderText,allowFontScaling:!1},this.props.header),i);return this.props.onPress&&(s=a.createElement(a.Button,{onPress:this.props.onPress},s)),a.createElement(a.Animated.View,{style:e,blockPointerEvents:this.props.blockPointerEvents,ignorePointerEvents:this.props.ignorePointerEvents},s)}}t.default=p},99342:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallTrayView=void 0;const a=i(96486),n=i(16778),o=i(94224),s=i(37103),r=i(60289),l=i(80200),c=i(15877),d=i(81760),u=i(80837),h=i(24576),p=i(6250),g=i(34548),C=i(54704),m=i(56018),S=i(71727),y=(0,c.lazyProperties)({reactionsView:()=>u.default.absoluteFill,participantVideoContainer:()=>n.Styles.createViewStyle({width:l.BigTrayCallParticipantWidth.video,flexGrow:0,flexShrink:0}),participantAudioContainer:()=>n.Styles.createViewStyle({width:l.BigTrayCallParticipantWidth.audio,flexGrow:0,flexShrink:0}),trayContainer:()=>n.Styles.createViewStyle({position:"absolute",top:l.DesktopNewHeaderHeight,left:0,right:0,backgroundColor:d.Color.transparent,flex:1,flexDirection:"row-reverse",alignSelf:"center",justifyContent:"space-between",borderBottomWidth:8,borderLeftWidth:8,borderRightWidth:8,borderColor:d.Color.transparent,height:l.DesktopTopTrayHeight,alignItems:"stretch"}),trayContainerMobile:()=>n.Styles.createViewStyle({top:l.MobileNewHeaderHeight,height:l.MobileTopTrayHeight}),participantsContainer:()=>n.Styles.createViewStyle({flexDirection:"row-reverse",justifyContent:"flex-start",alignSelf:"stretch",flexBasis:0,flexGrow:1}),presenterContainer:()=>n.Styles.createViewStyle({flexGrow:0,flexShrink:0,alignSelf:"stretch",flexDirection:"row"}),participantBackgroundStyle:()=>n.Styles.createViewStyle({backgroundColor:d.Color.callStageLight}),participantBackgroundStyleLightTheme:()=>n.Styles.createViewStyle({backgroundColor:d.Color.gray100Overlay80})});class f extends h.default{constructor(){super(...arguments),this._callReactionsDisplayHelper=new r.default,this._mountedRefsMap=new p.default,this._videoParticipantLayoutController={getStyles:()=>[y.participantVideoContainer],getInnerStyles:()=>[u.default.flexOne],getBackgroundColorStyle:e=>e?y.participantBackgroundStyleLightTheme:y.participantBackgroundStyle,getVideoBorderColorStyle:e=>e?y.participantBackgroundStyleLightTheme:y.participantBackgroundStyle,isHidden:()=>!1},this._audioParticipantLayoutController={getStyles:()=>[y.participantAudioContainer],getInnerStyles:()=>[u.default.flexOne],getBackgroundColorStyle:e=>e?y.participantBackgroundStyleLightTheme:y.participantBackgroundStyle,getVideoBorderColorStyle:e=>e?y.participantBackgroundStyleLightTheme:y.participantBackgroundStyle,isHidden:()=>!1},this._updateElementLink=(e,t,i,a,n,s,r,l)=>{o.default.VideoLinksManager.updateElementLink(this.props.callId,e,t,i,a,n,s,r,l)},this._layoutController=(e,t,i)=>i!==l.VideoStatus.None?this._videoParticipantLayoutController:this._audioParticipantLayoutController,this._onElementScalingModeChanged=(e,t,i,a)=>{o.default.VideoLinksManager.onElementScalingModeChanged(this.props.callId,e,t,i,a)},this._getCallReactionsDisplayHelper=()=>this._callReactionsDisplayHelper,this._onViewRef=e=>{this._parentViewRef=e||void 0},this._getParentRefForReactions=()=>this._parentViewRef,this._getChildRefForReactions=e=>this._mountedRefsMap.ref(e),this._onTrayLayout=e=>{this.isComponentMounted()&&m.default.setTrayWidth(this.props.callId,e.width)},this._onTrayLayoutDebounced=a.debounce(this._onTrayLayout,150)}_buildState(e,t){const i=m.default.getTrayElements(e.callId),n=S.default.isInIncomingScreenshareMode(e.stageMode)?o.default.CallScreenShareStore.getPresenter(e.callId):void 0;return{presenter:n,nonPresentingParticipants:a.compact(a.without(i,n)),hiddenParticipantsNumber:m.default.getTrayRemainder(e.callId)}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i)}_renderTrayParticipant(e){return n.createElement(s.CallParticipantView,{key:e,ref:t=>this._onParticipantViewRef(t,e),callId:this.props.callId,conversationMri:this.props.conversationMri,nametagPosition:{offset:0},renderKey:e,onUpdateElementLink:this._updateElementLink,isGroupCall:!this.props.isOneOnOneConversation,iconOpacity:1,nametagOpacityStyle:this.props.callParticipantTooltipStyle,parentViewId:"CallTrayView#TrayView",onCallParticipantContextMenuOpened:this.props.onCallParticipantContextMenuOpened,onCallParticipantContextMenuDismissed:this.props.onCallParticipantContextMenuDismissed,hideNameTag:this.props.hideNameTag,useDarkBackground:!0,desktopNameTag:!0,isCallStageV2:!0,useLightTheme:this.props.useLightTheme,getCallReactionsDisplayHelper:this._getCallReactionsDisplayHelper,layoutController:this._layoutController,iconSize:l.BigTrayCallParticipantAvatarSize,onScalingModeChanged:this._onElementScalingModeChanged,isInTray:!0,borderRadius:2,videoBorderRadius:2})}_onParticipantViewRef(e,t){o.default.VideoLinksManager.getMountedRefsMapTray().onComponentRef(t).call(this,e),this._mountedRefsMap.onComponentRef(t).call(this,e)}_renderPresenterPart(){return this.state.presenter?n.createElement(n.View,{key:"presenter",style:y.presenterContainer},this._renderTrayParticipant(this.state.presenter)):void 0}_renderNonPresentingParticipants(){const e=a.map(this.state.nonPresentingParticipants,(e=>this._renderTrayParticipant(e)));return n.createElement(n.View,{key:"nonPresenters",style:y.participantsContainer},e,n.createElement(C.TrayOverflowButton,{hiddenParticipantsNumber:this.state.hiddenParticipantsNumber,onOverflowButtonPress:this.props.onOverflowButtonPress,useLightTheme:this.props.useLightTheme}))}_renderTray(){const e=[y.trayContainer,...this.props.useMobileControls?[y.trayContainerMobile]:[]];return n.createElement(n.View,{key:"callTray",ref:this._onViewRef,style:e,onLayout:this._onTrayLayoutDebounced},this._renderNonPresentingParticipants(),this._renderPresenterPart())}_renderReactionView(){return n.createElement(g.NewCallReactionsView,{key:"reactionView",reactionsConversationId:this.props.reactionsConversationId,parentDimensions:this.props.viewRect,getChildRef:this._getChildRefForReactions,getParentRef:this._getParentRefForReactions,onTextReactionPressed:this.props.onTextReactionPressed,disableReactions:this.props.disableReactions,getCallReactionsDisplayHelper:this._getCallReactionsDisplayHelper})}render(){return[this._renderTray(),this._renderReactionView()]}}t.CallTrayView=f},2627:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(38933),n=i(16778),o=i(88837),s=i(71830),r=i(22854),l=i(15877),c=i(89808),d=i(45026),u=i(81760),h=i(2301),p=i(67977),g=160,C=100,m=(0,l.lazyProperties)({outerContainer:()=>n.Styles.createViewStyle({position:"absolute",top:0,right:0,bottom:0,left:0,flex:1,paddingHorizontal:50,alignItems:"center",justifyContent:"center",backgroundColor:u.Color.gray400,overflow:"visible"}),lightThemeBackgroundColor:()=>n.Styles.createViewStyle({backgroundColor:u.Color.gray50}),innerContainer:()=>n.Styles.createViewStyle({overflow:"visible",width:g,height:g}),backgroundRingColored:()=>n.Styles.createViewStyle({position:"absolute",top:32,left:32,width:96,height:96,borderRadius:48,backgroundColor:u.Color.gray400,opacity:1}),gradientRing:()=>n.Styles.createViewStyle({position:"absolute",width:C,height:C,borderRadius:50,opacity:1}),backgroundRingMask:()=>n.Styles.createViewStyle({position:"absolute",top:30,left:30,width:C,height:C,borderRadius:50,backgroundColor:u.Color.black,opacity:1}),mainCircle:()=>n.Styles.createViewStyle({position:"absolute",top:0,left:0,width:g,height:g,borderRadius:80,backgroundColor:u.Color.transparent})});class S extends o.ComponentBase{constructor(e){super(e),this._beginningAnimationDuration=1300,this._loopDuration=1830,this._animationShouldLoop=!1,this._backgroundRingColoredScaleAnimatedValue=new n.Animated.Value(3),this._backgroundRingColoredScaleAnimatedStyle=n.Styles.createAnimatedViewStyle({transform:[{scale:this._backgroundRingColoredScaleAnimatedValue}]}),this._backgroundRingMaskScaleAnimatedValue=new n.Animated.Value(3),this._backgroundRingMaskScaleAnimatedStyle=n.Styles.createAnimatedViewStyle({transform:[{scale:this._backgroundRingMaskScaleAnimatedValue}]}),this._mainCircleScaleAnimatedValue=new n.Animated.Value(1.5),this._mainCircleScaleAnimatedStyle=n.Styles.createAnimatedViewStyle({transform:[{scale:this._mainCircleScaleAnimatedValue}]}),this._innerContainerOpacityValue=new n.Animated.Value(0),this._innerContainerOpacityStyle=n.Styles.createAnimatedViewStyle({opacity:this._innerContainerOpacityValue})}_startAnimation(){this._animationBeginning=n.Animated.parallel([d.default.timing(this._backgroundRingColoredScaleAnimatedValue,{toValue:1,easing:n.Animated.Easing.CubicBezier(.33,0,0,1),duration:1.2*this._beginningAnimationDuration,isInteraction:!1,useNativeDriver:!0}),d.default.timing(this._backgroundRingMaskScaleAnimatedValue,{toValue:1,easing:n.Animated.Easing.CubicBezier(.33,0,0,1),duration:1.2*this._beginningAnimationDuration,isInteraction:!1,useNativeDriver:!0}),n.Animated.sequence([d.default.timing(this._mainCircleScaleAnimatedValue,{toValue:1,easing:n.Animated.Easing.CubicBezier(.33,0,0,1),duration:.8*this._beginningAnimationDuration,isInteraction:!1,useNativeDriver:!0}),d.default.timing(this._mainCircleScaleAnimatedValue,{toValue:1.06,easing:n.Animated.Easing.CubicBezier(.33,0,0,1),duration:.2*this._beginningAnimationDuration,isInteraction:!1,useNativeDriver:!0})])]),this._animationLoop=n.Animated.parallel([n.Animated.sequence([d.default.timing(this._backgroundRingColoredScaleAnimatedValue,{toValue:2.3,easing:n.Animated.Easing.CubicBezier(.33,0,0,1),duration:.5*this._loopDuration,isInteraction:!1,useNativeDriver:!0}),d.default.timing(this._backgroundRingColoredScaleAnimatedValue,{toValue:1,easing:n.Animated.Easing.CubicBezier(.9,0,1,1),duration:.22*this._loopDuration,isInteraction:!1,useNativeDriver:!0})]),n.Animated.sequence([d.default.timing(this._backgroundRingMaskScaleAnimatedValue,{toValue:2.3,easing:n.Animated.Easing.CubicBezier(.33,0,0,1),duration:.5*this._loopDuration,isInteraction:!1,useNativeDriver:!0}),d.default.timing(this._backgroundRingMaskScaleAnimatedValue,{toValue:1,easing:n.Animated.Easing.CubicBezier(.9,0,1,1),duration:.22*this._loopDuration,isInteraction:!1,useNativeDriver:!0})]),n.Animated.sequence([d.default.timing(this._mainCircleScaleAnimatedValue,{toValue:.88,easing:n.Animated.Easing.CubicBezier(.33,0,0,1),duration:.56*this._loopDuration,isInteraction:!1,useNativeDriver:!0}),d.default.timing(this._mainCircleScaleAnimatedValue,{toValue:1.06,easing:n.Animated.Easing.CubicBezier(1,0,.78,1),duration:.22*this._loopDuration,isInteraction:!1,useNativeDriver:!0}),d.default.timing(this._mainCircleScaleAnimatedValue,{toValue:1,easing:n.Animated.Easing.CubicBezier(.33,0,.67,1),duration:.22*this._loopDuration,isInteraction:!1,useNativeDriver:!0})])]),!this._animationShouldLoop&&this.isComponentMounted()?this._animationBeginning.start((()=>{this._startAnimation()})):this.isComponentMounted()&&this._animationLoop.start((()=>{this._startAnimation()})),this._animationShouldLoop=!0}componentDidMount(){super.componentDidMount(),this._startAnimation(),d.default.timing(this._innerContainerOpacityValue,{toValue:1,duration:50,delay:d.default.delayDuration(250),easing:n.Animated.Easing.In(),useNativeDriver:!0}).start()}render(){let e;e=s.isOneOnOneConversation(this.props.conversationId)?n.createElement(h.UserIcon,{userMri:this.props.conversationId,forceMediumAvatarSize:!0,size:p.UserIconSize.Size160,showBorder:!0}):n.createElement(r.ConversationIcon,{conversationId:this.props.conversationId,size:p.ConversationIconSize.Size160,showBorder:!0});const t=this.props.useLightTheme?m.lightThemeBackgroundColor:void 0;return n.createElement(n.View,{style:[m.outerContainer,t]},n.createElement(n.Animated.View,{style:[m.innerContainer,this._innerContainerOpacityStyle]},n.createElement(n.Animated.View,{style:[m.backgroundRingMask,t,this._backgroundRingMaskScaleAnimatedStyle]},n.createElement(a.GradientView,{style:m.gradientRing,colors:c.default.getGradientColorsNoSubscription(),direction:a.GradientDirection.BOTTOM_RIGHT})),n.createElement(n.Animated.View,{style:[m.backgroundRingColored,t,this._backgroundRingColoredScaleAnimatedStyle]}),n.createElement(n.Animated.View,{style:[m.mainCircle,this._mainCircleScaleAnimatedStyle]},e)))}}t.default=S},89324:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(80200),o=i(98278),s=i(13944),r=i(15877),l=i(33754),c=i(30124),d=i(64956),u=i(81760),h=i(11828),p=i(59433),g=i(78262),C=i(19675),m=i(24576),S=h.IconSize.size20,y=o.CompositeNotificationToastInfo.horizontal,f=(0,r.lazyProperties)({container:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingHorizontal:y,paddingVertical:o.CompositeNotificationToastInfo.vertical}),containerStack:()=>a.Styles.createViewStyle({backgroundColor:u.Color.gray400Overlay70,paddingVertical:y}),containerComposite:()=>a.Styles.createViewStyle({backgroundColor:u.Color.transparent,paddingRight:20}),textContainerComposite:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",flexWrap:"wrap",paddingHorizontal:10,alignItems:"center"}),textStack:()=>a.Styles.createTextStyle({lineHeight:20}),textComposite:()=>a.Styles.createTextStyle({flex:-1,lineHeight:24,alignSelf:"center",wordBreak:"break-word"}),buttonTextComposite:()=>a.Styles.createTextStyle({marginLeft:4}),blueText:()=>a.Styles.createTextStyle({color:u.Color.sxBlue})});class _ extends m.default{constructor(){super(...arguments),this._onLearnMorePress=()=>{d.default.showDeniedPromptWithSettingsOption(g.PermissionType.Camera,this._getRootViewId())},this._onClosePress=()=>{this.props.closeToast(n.ToastActionType.ManualDismissed)},this._onLayout=e=>{e.width!==this.state.containerWidth&&this.setState({containerWidth:e.width})}}_buildState(e,t){const i={isUsingStackNavigationContext:c.default.isUsingStackNavigationContext()};return t&&(i.containerWidth=0),i}render(){let e,t;const i=[this._themeStyles.primaryTextColorStyle],n=[this._useAccessibleTheme()?this._themeStyles.primaryTextColorStyle:f.blueText];return this.state.isUsingStackNavigationContext?(e=a.Styles.createViewStyle({maxWidth:this.state.containerWidth-S-y-4},!1),t=f.containerStack,i.push(f.textStack),n.push(f.textStack)):(e=f.textContainerComposite,t=f.containerComposite,i.push(f.textComposite),n.push(f.textComposite,f.buttonTextComposite)),a.createElement(a.View,{style:[f.container,t],onLayout:this._onLayout},a.createElement(a.View,{style:e},a.createElement(C.BodyText,{style:i,bold:!1},l.getString("AudioVideoSettings.CameraDeniedBannerSuggestion")),a.createElement(p.default,{url:"#",style:n,onPress:this._onLearnMorePress},l.getString("AudioVideoSettings.LearnMore"))),a.createElement(s.default,{icon:h.SkypeIcon.ClosePanel,size:S,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.primaryIconColor,title:l.getString("Global.CloseButtonTitle"),onPress:this._onClosePress}))}}t.default=_},86251:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(48184),o=i(16778),s=i(88837),r=i(89391),l=i(78968),c=i(46096),d=i(36801),u=i(36237),h=i(15877),p=i(33004),g=i(78262),C=i(80837),m=(0,h.lazyProperties)({reactionContainer:()=>[C.default.absoluteFill,C.default.flexOne],animationStyle:()=>o.Styles.createViewStyle({position:"absolute",top:0,bottom:0,overflow:"visible",alignSelf:"center",alignContent:"center"})});class S extends s.ComponentBase{constructor(){super(...arguments),this._isAnimationPlaying=!1,this._reactionKey="",this._onAEAnimationRef=e=>{this._aeAnimatedView=e||void 0},this._startAnimation=()=>{this._aeAnimatedView&&!this._isAnimationPlaying&&(u.log(c.LogTraceArea.CallReactions,"CelebrationAnimationView._startAnimation"),this._isAnimationPlaying=!0,this._aeAnimatedView.play(),l.default.setAnimationIsPlaying(this._isAnimationPlaying),a.delay((()=>{this.props.onAnimationOut&&this.props.onAnimationOut(),this._isAnimationPlaying=!1,l.default.setAnimationIsPlaying(this._isAnimationPlaying),this.isComponentMounted()&&this.setState({shouldRenderAEAnimationView:!1})}),this.state.animationTimeoutInMs))},this._resetAnimation=()=>{u.log(c.LogTraceArea.CallReactions,"CelebrationAnimationView._resetAnimation"),this._aeAnimatedView&&this._aeAnimatedView.reset()}}_buildState(e,t){const i=t?Date.now():this.state.reactionsCutOff;let a=t?void 0:this.state.animationReactionInfo,n=!t&&this.state.shouldRenderAEAnimationView,o=!1;const s=r.default.getS4LCMCFeatures().enableNewAnimations?r.default.getS4LCMCFeatures().callAnimatedReactionsConfig.callAnimatedReactionsTimeoutsinMs:r.default.getS4LCMCFeatures().callCelebrationConfig.celebrationAnimationTimeoutsinMs;let c=s.default;const d=l.default.getLastReaction(e.conversationMri,i);if(!this._isAnimationPlaying&&d){const e=p.default.callReactionInfoForReaction(d);if(this._reactionKey=this._getReactionKey(e),(e.reactionsTextStyle===g.ReactionsTextStyle.Animation||this._isNewAnimatedReaction(e))&&(o=!0,t||this._didReceiveNewAnimation(a,e))){a=e;const t=this._reactionKey;n=r.default.getS4LUiFeatures().jsonAnimationEnabled,t&&s[t]&&(c=s[t])}}return{reactionsCutOff:i,animationTimeoutInMs:c,animationReactionInfo:a,shouldRenderAEAnimationView:n,isReactionNewAnimation:o}}_isNewAnimatedReaction(e){return r.default.getS4LCMCFeatures().enableNewAnimations&&(null==e?void 0:e.reactionsTextStyle)===g.ReactionsTextStyle.Default&&p.default.isSuperAnimationReaction(this._reactionKey)}_getReactionKey(e){return(null==e?void 0:e.reaction.getEmoticonCallReactionKey())||""}componentWillUnmount(){u.log(c.LogTraceArea.CallReactions,"CelebrationAnimationView.componentWillUnmount"),super.componentWillUnmount(),this._resetAnimation(),this.props.onAnimationOut&&this.props.onAnimationOut()}componentDidMount(){u.log(c.LogTraceArea.CallReactions,"CelebrationAnimationView.componentDidMount"),super.componentDidMount(),this.state.animationReactionInfo&&this._startAnimation()}_didReceiveNewAnimation(e,t){let i=!1;return t&&(e?t.reaction.createdTime>e.reaction.createdTime&&t.reaction.cuid!==e.reaction.cuid&&(i=!0):i=!0),i}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=this._didReceiveNewAnimation(t.animationReactionInfo,this.state.animationReactionInfo);u.log(c.LogTraceArea.CallReactions,"CelebrationAnimationView.componentDidUpdate CallReactionsStore.isAnimationPlaying() "+l.default.isAnimationPlaying()+"; shouldUpdateAnimation "+a),a&&(this._resetAnimation(),this._startAnimation())}shouldComponentUpdate(){return!l.default.isAnimationPlaying()}_getScaledDimensionsStyle(e){const t=e.intrinsicSize.width/e.intrinsicSize.height,i=this.props.width/t<=this.props.height;let a=this.props.width,n=this.props.height,s=0;return i?n=this.props.width/t:(a=this.props.height*t,s=(this.props.width-a)/2),o.Styles.createViewStyle({width:a,height:n,left:s,right:s},!1)}render(){let e;if(this.state.shouldRenderAEAnimationView&&this.state.animationReactionInfo&&this.state.isReactionNewAnimation){const t=p.default.animationInfoForKey(this.state.animationReactionInfo.content||this._reactionKey,!0);if(t){let i=[C.default.absoluteFill,C.default.flexOne];{const e=o.Styles.createViewStyle({width:t.intrinsicSize.width,height:this.props.height},!1);i=[m.animationStyle,e]}const a=d.default.getAssetSourceWithColor(t);e=o.createElement(n.default,Object.assign({},a,{style:i,source:t.source,ref:this._onAEAnimationRef}))}}return o.createElement(o.Animated.View,{style:m.reactionContainer,blockPointerEvents:!0,ignorePointerEvents:!0},e)}}t.default=S},513:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(48777),o=i(94224),s=i(68580),r=i(32057),l=i(98278),c=i(53143),d=i(46096),u=i(36237),h=i(15877),p=i(81760),g=i(80837),C=i(24576),m=(0,h.lazyProperties)({container:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"space-between",paddingHorizontal:20,paddingVertical:l.CompositeNotificationToastInfo.vertical}),metadataContainer:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center",marginVertical:3}),notificationTextStyle:()=>a.Styles.createTextStyle({flex:-1,wordBreak:"break-word",paddingRight:5}),linkStyle:()=>a.Styles.createTextStyle({flex:1,wordBreak:"break-word",color:p.Color.blue})});class S extends C.default{_buildState(e,t){const i={};let a=c.default.getToast(e.toastId);if(a&&a.state){const e=a.state,t=e.callId;i.callId=t,i.callState=o.default.CallingStore.getCallState(t),i.audioOnlyEnabled=o.default.CallingStore.isAudioOnly(t),i.callNetworkQualityPoor=(0,r.default)().isCallQualityPoor(t),i.conversationMri=e.conversationMri}return i}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=this.state.callState&&s.default.isCallStateActive(this.state.callState)&&!s.default.isCallStateOnHold(this.state.callState);(this.state.audioOnlyEnabled||this.state.callNetworkQualityPoor)&&a||(u.log(d.LogTraceArea.CallingUI,"CompositeCallConnectionQualityToast.componentDidUpdate removing toast"),c.default.removeToast(this.props.toastId))}render(){return a.createElement(a.View,{style:m.container},a.createElement(n.default,{callId:this.state.callId,conversationMri:this.state.conversationMri,containerStyle:[m.metadataContainer,g.default.flexNegativeOne],iconColor:this._themeColors.headerIconColor,textStyle:[m.notificationTextStyle,this._themeStyles.headerTextColorStyle],linkStyle:m.linkStyle}))}}t.default=S},46509:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocalCompositeCallMediaCapturerToast=t.RemoteCompositeCallMediaCapturerToast=void 0;const a=i(16778),n=i(88837),o=i(48540),s=i(94224),r=i(68580),l=i(53143),c=i(21936),d=i(7015),u=i(24576),h=i(11828);class p extends u.default{constructor(){super(...arguments),this._shouldToastBeRemoved=e=>!this.state.callId||e!==o.CallState.Connected||!this.state.initiatorMri||!s.default.CallingStore.isCallMediaCaptured(this.state.callId,this.state.initiatorMri)}_buildState(e,t){const i=l.default.getToast(e.toastId);let a,n;if(i&&i.state){let e=i.state;n=e.callId,a=e.initiatorMri}return{initiatorMri:a,callId:n}}render(){const e=[{icon:h.SkypeIcon.CallRemoteNdiRecord,color:this._themeColors.headerIconColor}];return a.createElement(d.RemotePrivacyToastComponent,{id:this.props.toastId,colorThemeOverride:this.props.colorThemeOverride,notificationTextPath:"CallMediaCapturerToast.NotificationText",startedAccessibilityLabelTextPath:"CallMediaCapturerToast.StartedAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallMediaCapturerToast.StoppedAccessibilityLabel",initiatorMri:this.state.initiatorMri,shouldToastBeRemoved:this._shouldToastBeRemoved,icons:e})}}t.RemoteCompositeCallMediaCapturerToast=p;class g extends n.ComponentBase{constructor(){super(...arguments),this._getTimeStamp=()=>{},this._onStopPress=(e,t)=>{c.default.setNdiEnabled(!1)},this._shouldToastBeRemoved=e=>{const t=r.default.isCallStateActive(e)&&!r.default.isCallStateOnHold(e);return!c.default.isNdiEnabled()||!t}}render(){return a.createElement(d.LocalPrivacyToastComponent,{id:this.props.toastId,colorThemeOverride:this.props.colorThemeOverride,stopLinkTextPath:"CallMediaCapturerToast.StopLinkText",privacyStatementTextPath:"CallMediaCapturerToast.PrivacyStatementText",morePrivacyInfoLinkTextPath:"CallMediaCapturerToast.MorePrivacyInfoLinkText",startedAccessibilityLabelTextPath:"CallMediaCapturerToast.StartedInitiatorAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallMediaCapturerToast.StoppedInitiatorAccessibilityLabel",shouldToastBeRemoved:this._shouldToastBeRemoved,onStopPress:this._onStopPress,getTimestamp:this._getTimeStamp})}}t.LocalCompositeCallMediaCapturerToast=g},24338:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(16778),o=i(60662),s=i(80200),r=i(81760),l=i(84912),c=i(46200),d=i(13944),u=i(11828),h=i(36237),p=i(47126),g=i(15877),C=i(33754),m=i(4735),S=34,y=12,f=(0,g.lazyProperties)({drawerContainer:()=>n.Styles.createViewStyle({flex:1,justifyContent:"flex-end",alignItems:"center"}),drawer:()=>n.Styles.createViewStyle({width:52,borderRadius:26,backgroundColor:r.Color.whiteOverlay70}),containerMobile:()=>n.Styles.createViewStyle({bottom:5,right:15}),innerContainer:()=>n.Styles.createViewStyle({flex:1,alignItems:"center",paddingTop:6,backgroundColor:r.Color.transparent}),closeButtonContainer:()=>n.Styles.createViewStyle({position:"relative"}),customizeReactionButtonContainer:()=>n.Styles.createViewStyle({position:"relative"}),closeButton:()=>n.Styles.createViewStyle({width:S,height:S,borderRadius:17,marginTop:6,marginHorizontal:9,alignItems:"center",backgroundColor:r.Color.gray400Overlay10}),customizeReactionButton:()=>n.Styles.createViewStyle({width:S,height:S,alignItems:"center",marginTop:6,marginHorizontal:9}),minContainer:()=>n.Styles.createViewStyle({position:"absolute",right:10,bottom:95}),container:()=>n.Styles.createViewStyle({position:"absolute",right:110,bottom:24}),newMainCallControlsContainer:()=>n.Styles.createViewStyle({position:"absolute",right:80,bottom:24}),divider:()=>n.Styles.createViewStyle({position:"relative",flex:1,marginVertical:6,marginHorizontal:10,height:1,flexDirection:"row",opacity:.3,backgroundColor:r.Color.blackOverlay35})});class _ extends o.default{constructor(){super(...arguments),this._animatedHeightValue=new n.Animated.Value(0),this._animatedOpacityValue=new n.Animated.Value(0),this._animatedContainerStyle=n.Styles.createAnimatedViewStyle({height:this._animatedHeightValue}),this._animatedInnerContainerStyle=n.Styles.createAnimatedViewStyle({opacity:this._animatedOpacityValue}),this._onCloseButtonPress=()=>{this.closeDrawer()},this._onCustomizeReactionsButton=()=>{m.default.navigateToCustomReactionsPanel(l.CustomReactionsType.Call,this.props.rootViewId),h.track(new c.CustomReactionsManipulationTelemetry(c.CustomReactionsManipulationAction.CustomReactionsPanelOpened,{customReactionsType:l.CustomReactionsType.Call}))},this._onMouseLeave=()=>{this.state.isOpen&&this.props.drawerOpenedOnHover&&this.closeDrawer()},this._onKeyPress=e=>!(!this.isComponentMounted()||e.keyCode!==p.default.ESCAPE||!this.state.isOpen)&&(this.closeDrawer(),!0),this._onContainerRef=e=>{this._container=e||void 0}}_positionDrawer(e,t){const i=t.isOpen,a=this._getDrawerHeight(t.reactions.length),o=i?a:0,s=i?1:0;if(this._onPositionDrawer(e,t),this._animatedHeightValue&&this._animatedOpacityValue)if(e){const e=n.Animated.timing(this._animatedHeightValue,{toValue:o,easing:n.Animated.Easing.Linear(),duration:i?_.heightAnimationDurationOnOpen:_.heightAnimationDurationOnClose}),t=n.Animated.timing(this._animatedOpacityValue,{toValue:s,easing:n.Animated.Easing.Linear(),duration:i?_.opacityAnimationDurationOnOpen:_.opacityAnimationDurationOnClose});let a,r;i?(a=e,r=t):(a=t,r=e),this._drawerAnimation=a,this._drawerAnimation.start((()=>{this._drawerAnimation=r,this._drawerAnimation.start((()=>{this._onPositionDrawerAnimationCompleted()}))}))}else this._animatedHeightValue.setValue(o),this._animatedOpacityValue.setValue(s)}_renderReactionViews(e){return a.compact(e)}_getDrawerHeight(e){let t=44*e+y;return this.props.showCustomizeReactionsButton&&(t+=53),this.props.drawerOpenedOnHover||(t+=46),t}_renderCloseButton(){if(this.props.controlsType!==s.CallControlsType.Mobile&&!this.props.drawerOpenedOnHover)return n.createElement(n.View,{ignorePointerEvents:!0,style:f.closeButtonContainer},n.createElement(d.default,{icon:u.SkypeIcon.DownChevron,style:f.closeButton,size:u.IconSize.size20,color:r.Color.gray400,hoverColor:r.Color.gray400,onPress:this._onCloseButtonPress,title:void 0,accessibilityLabel:C.getString("ReactionsStream.ReactionBarCloseDrawerTitle")}))}_renderCustomizeReactionsButton(){if(this.props.showCustomizeReactionsButton)return n.createElement(n.View,{ignorePointerEvents:!0,style:f.customizeReactionButtonContainer},n.createElement(d.default,{icon:u.SkypeIcon.EmojiAdd,style:f.customizeReactionButton,size:u.IconSize.size32,color:r.Color.gray400,hoverColor:r.Color.gray400,onPress:this._onCustomizeReactionsButton,title:C.getString("ReactionsPanel.CustomCallReactionsTitle"),accessibilityLabel:C.getString("ReactionsPanel.CustomCallReactionsTitle")}),n.createElement(n.View,{style:f.divider}))}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);this.state.isOpen!==t.isOpen&&this._resetFocus(this.state.isOpen)}_resetFocus(e){this._container&&this._container.setFocusRestricted(e)}componentDidMount(){super.componentDidMount(),this.state.isOpen||this._resetFocus(!1)}render(){const e=this.props.controlsType===s.CallControlsType.DesktopMinSmallest,t=[f.drawer];this._animatedContainerStyle&&t.push(this._animatedContainerStyle);const i=this._getDrawerHeight(this.state.reactions.length),a=n.Styles.createViewStyle({height:i},!1);let o;o=e?f.minContainer:this.state.enableNewMainCallControls?f.newMainCallControlsContainer:f.container;const r=[a,o],l=[f.innerContainer];let c;this._animatedInnerContainerStyle&&l.push(this._animatedInnerContainerStyle),this.props.controlsType===s.CallControlsType.Mobile&&r.push(f.containerMobile),this.state.isOpen&&(c=this._renderCloseButton());const d=this._renderCustomizeReactionsButton();return n.createElement(n.View,{style:r,onKeyPress:this._onKeyPress,onMouseLeave:this._onMouseLeave,restrictFocusWithin:!0,ref:this._onContainerRef},n.createElement(n.View,{style:f.drawerContainer,ignorePointerEvents:!0},n.createElement(n.Animated.View,{style:t,ignorePointerEvents:!0},n.createElement(n.Animated.View,{style:l,ignorePointerEvents:!0},d,this._renderContent(),c))))}}t.default=_,_.heightAnimationDurationOnOpen=150,_.opacityAnimationDurationOnOpen=150,_.heightAnimationDurationOnClose=50,_.opacityAnimationDurationOnClose=50},9554:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(94224),o=i(68580),s=i(53143),r=i(7015),l=i(24576),c=i(81760),d=i(11828);class u extends l.default{constructor(){super(...arguments),this._onStopPress=(e,t)=>{n.default.InCallBotService.stopRecording(e,t)},this._getTimeStamp=()=>n.default.CallingStore.getCallRecordingTimestamp(this.state.callId),this._shouldLocalToastBeRemoved=e=>!this.state.callId||!n.default.CallingStore.isRecording(this.state.callId)||!o.default.isCallStateActive(e),this._shouldRemoteToastBeRemoved=()=>!n.default.CallingStore.isRecording(this.state.callId)}_buildState(e,t){let i=s.default.getToast(e.toastId);if(i&&i.state){const e=i.state.callId,t=this.state&&this.state.initiatorMri?this.state.initiatorMri:n.default.CallingStore.getCallRecordingInitiator(e);return{initiatorMri:t,callId:e,isLocalInitiator:n.default.InCallBotUtils.isCallRecordingInitiator(t)}}return{}}render(){if(this.state.initiatorMri&&this.state.isLocalInitiator)return a.createElement(r.LocalPrivacyToastComponent,{id:this.props.toastId,colorThemeOverride:this.props.colorThemeOverride,stopLinkTextPath:"CallRecorderToast.StopRecordingLinkText",privacyStatementTextPath:"CallRecorderToast.PrivacyStatementText",morePrivacyInfoLinkTextPath:"CallRecorderToast.RecordingInitiatorMorePrivacyInfoLinkText",startedAccessibilityLabelTextPath:"CallRecorderToast.StartedRecordingInitiatorAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallRecorderToast.StoppedRecordingInitiatorAccessibilityLable",shouldToastBeRemoved:this._shouldLocalToastBeRemoved,onStopPress:this._onStopPress,getTimestamp:this._getTimeStamp});const e=[{icon:d.SkypeIcon.CallRecordStroke,color:this._themeColors.headerIconColor},{icon:d.SkypeIcon.CallRecordDot,color:c.Color.red}];return a.createElement(r.RemotePrivacyToastComponent,{id:this.props.toastId,colorThemeOverride:this.props.colorThemeOverride,notificationTextPath:"CallRecorderToast.IsRecordingText",initialNotificationTextPath:"CallRecorderToast.StartingRecordingText",startedAccessibilityLabelTextPath:"CallRecorderToast.StartedRecordingAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallRecorderToast.StoppedRecordingAccessibilityLabel",initiatorMri:this.state.initiatorMri,shouldToastBeRemoved:this._shouldRemoteToastBeRemoved,icons:e})}}t.default=u},58262:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(94224),o=i(68580),s=i(80200),r=i(89324),l=i(53143),c=i(24576);class d extends c.default{constructor(){super(...arguments),this._closeToast=e=>{l.default.removeToast(this.props.toastId,e)}}_buildState(e,t){let i=l.default.getToast(e.toastId);if(i&&i.state){const e=i.state.callId;return{callId:e,callState:n.default.CallingStore.getCallState(e)}}return{}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);!!this.state.callState&&o.default.isCallStateActive(this.state.callState)||this._closeToast(s.ToastActionType.AutoDismissed)}render(){return a.createElement(r.default,{closeToast:this._closeToast,colorThemeOverride:this.props.colorThemeOverride})}}t.default=d},19310:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(94224),o=i(68580),s=i(80200),r=i(98278),l=i(53143),c=i(46096),d=i(34501),u=i(36237),h=i(15877),p=i(11828),g=i(24576),C=(0,h.lazyProperties)({metadataContainer:()=>a.Styles.createViewStyle({paddingHorizontal:r.CompositeNotificationToastInfo.horizontal}),notificationTextStyle:()=>a.Styles.createTextStyle({flex:-1,wordBreak:"break-word"})});class m extends g.default{constructor(){super(...arguments),this._dismiss=e=>{u.log(c.LogTraceArea.CallingUI,"CompositeGeneralPurposeInCallToast._dismiss type: "+this.props.toastType),l.default.removeToast(this.props.toastId,e),this.props.onDismiss&&e===s.ToastActionType.ManualDismissed&&this.props.onDismiss()},this._onManualDismiss=()=>{this._dismiss(s.ToastActionType.ManualDismissed)}}_buildState(e,t){const i=l.default.getToast(e.toastId);if(i&&i.state){const e=i.state,t=e.callId,a=e.conversationMri;return{callState:n.default.CallingStore.getCallState(t),conversationMri:a}}return{}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);!!this.state.callState&&o.default.isCallStateActive(this.state.callState)||this._dismiss(s.ToastActionType.AutoDismissed)}render(){return a.createElement(d.default,{toastType:this.props.toastType,containerStyle:C.metadataContainer,textStyle:[C.notificationTextStyle,this._themeStyles.headerTextColorStyle],onDismiss:this._onManualDismiss,conversationMri:this.state.conversationMri,iconColor:this._themeColors.headerIconColor,iconSize:p.IconSize.size20})}}t.default=m},96223:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(88837),o=i(60787),s=i(94224),r=i(71727),l=i(47447),c=i(71830),d=i(98278),u=i(53143),h=i(22854),p=i(52262),g=i(46096),C=i(39285),m=i(3989),S=i(36237),y=i(72490),f=i(15877),_=i(33754),b=i(80837),T=i(212),v=i(19675),w=i(63841),I=i(18037),P=i(67977),M=(0,f.lazyProperties)({container:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"space-between",paddingHorizontal:d.CompositeNotificationToastInfo.horizontal,paddingVertical:d.CompositeNotificationToastInfo.vertical}),metadataContainer:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center",marginVertical:3}),userIcon:()=>a.Styles.createViewStyle({marginRight:10}),callButtonsContainer:()=>a.Styles.createViewStyle({justifyContent:"center"})});class k extends n.ComponentBase{constructor(){super(...arguments),this._onComponentRef=e=>{this._view=e||void 0},this._getIncomingCallStrings=()=>{let e;e=this.state.isEncrypted?{message:_.getString("CallBanner.IncomingCallEncryptedCaption"),accessibilityLabel:_.getString("CallBanner.IncomingCallEncryptedAccessibilityLabel",{callerName:this.state.callerDisplayName})}:c.isGroupConversation(this.state.conversationMri)?{message:_.getString("CallBanner.IncomingCallGroupCaption",{callerName:this.state.callerDisplayName}),accessibilityLabel:_.getString("CallBanner.IncomingCallGroupAccessibilityLabel",{groupName:this.state.conversationDisplayName,callerName:this.state.callerDisplayName})}:{message:_.getString("CallBanner.IncomingCallOneOnOneCaption"),accessibilityLabel:_.getString("CallBanner.IncomingCallOneOnOneAccessibilityLabel",{callerName:this.state.callerDisplayName})};{const t=y.default.shortcutListItemForShortcut(g.KeyboardShortcut.AcceptIncomingCall),i=y.default.shortcutListItemForShortcut(g.KeyboardShortcut.HangupOrRejectCall);if(t&&i){const a=_.getString("CallBanner.KeyboardShortcutAccessibilityLabel",{acceptCall:t.command,rejectCall:i.accessibleCommand});e.accessibilityLabel=_.getString("CallBanner.IncomingCallAccessibilityLabelWithKeyboardShortcut",{incomingCall:e.accessibilityLabel,keyboardShortcut:a})}}return e}}_buildState(e){const t=u.default.getToast(e.id);if(t){let e;const i=r.default.useHighContrastThemeAndChanges();e=I.default.useDarkTheme()?i?w.Theme.Accessible:w.Theme.Colorful:i?w.Theme.AccessibleDark:w.Theme.ColorfulDark;const a=s.default.CallingStore.getConnectedAndNotOnHoldCallId(),n=t.state,o=s.default.CallingStore.isEncryptedCall(n.callId),c=s.default.CallingStore.isPSTNCall(n.callId),d=s.default.CallingFeaturesHelper.allowMergeCall({isEncryptedCall:o,isPSTNCall:c,conversationMri:n.conversationMri,callId:n.callId,connectedCallId:a});return{callId:n.callId,conversationMri:n.conversationMri,callerMri:n.callerMri,isCallIncoming:s.default.CallingStore.isCallIncoming(n.callId),callerDisplayName:p.default.getDisplayName(n.callerMri),conversationDisplayName:p.default.getDisplayName(n.conversationMri),connectedToAnotherCall:!!a&&a!==n.callId,themeOverride:e,isEncrypted:o,isPSTN:c,hasAnsweredCallLocally:s.default.CallingStore.hasAnsweredCallLocally(n.callId),callDidExist:s.default.CallingStore.callDidExist(n.callId),isMergePossible:d,callMergeSupported:l.CallingCapabilities.callMergeSupported()}}return{}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this._shouldIgnore()&&(S.log(g.LogTraceArea.CallingUI,"CompositeIncomingRingToast.componentDidUpdate removing toast for callId: "+this.state.callId),u.default.removeToast(this.props.id))}componentDidMount(){super.componentDidMount(),this._shouldIgnore()&&(S.log(g.LogTraceArea.CallingUI,"CompositeIncomingRingToast.componentDidMount removing toast for callId: "+this.state.callId),u.default.removeToast(this.props.id)),this._view&&this._view.requestFocus(),this.state.connectedToAnotherCall&&a.Accessibility.announceForAccessibility(this.state.isMergePossible?_.getString("CallBanner.IncomingCallMergeCallWarning"):_.getString("CallBanner.IncomingCallMultiCallWarning"))}_shouldIgnore(){return!this.state.isCallIncoming||this.state.hasAnsweredCallLocally||this.state.callDidExist}renderCallControls(){return a.createElement(m.default,{conversationMri:this.state.conversationMri,callId:this.state.callId,forMobile:!1,isEncryptedCall:!!this.state.isEncrypted,isPSTNCall:!!this.state.isPSTN,buttonSize:o.CallButtonSize.Small,colorThemeOverride:this.state.themeOverride,showMergeButton:this.state.connectedToAnotherCall&&this.state.callMergeSupported,isMergePossible:this.state.isMergePossible})}render(){if(this._shouldIgnore())return null;const e=T.default.themeStylesForTheme(this.state.themeOverride),t=this.state.isMergePossible?_.getString("CallBanner.IncomingCallMergeCallWarning"):_.getString("CallBanner.IncomingCallMultiCallWarning"),i=this.state.connectedToAnotherCall?a.createElement(v.Caption,{style:e.headerTextColorStyle},t):void 0,n=this._getIncomingCallStrings();return a.createElement(a.View,{style:[M.container,e.buttonBackgroundColorStyle],ref:this._onComponentRef,tabIndex:0,accessibilityLabel:n.accessibilityLabel},a.createElement(a.View,{style:[M.metadataContainer,b.default.flexNegativeOne]},a.createElement(C.default,{style:M.userIcon},a.createElement(h.default,{size:P.ConversationIconSize.Size40,conversationId:this.state.conversationMri})),a.createElement(a.View,{style:b.default.flexNegativeOne},a.createElement(v.BodyText,{bold:!0,style:[b.default.flexNegativeOne,e.primaryTextColorStyle],numberOfLines:1},this.state.conversationDisplayName),a.createElement(v.Caption,{style:[b.default.flexNegativeOne,e.secondaryTextColorStyle]},n.message),i)),a.createElement(a.View,{style:M.callButtonsContainer},this.renderCallControls()))}}t.default=k},90795:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ToastHeight=void 0;const a=i(16778),n=i(94224),o=i(68580),s=i(98278),r=i(53143),l=i(46096),c=i(46767),d=i(36237),u=i(15877),h=i(81760),p=i(80837),g=i(24576);t.ToastHeight=40;const C=(0,u.lazyProperties)({container:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"space-between",paddingHorizontal:20,paddingVertical:s.CompositeNotificationToastInfo.vertical,height:t.ToastHeight}),metadataContainer:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center",marginVertical:3}),notificationTextStyle:()=>a.Styles.createTextStyle({flex:-1,wordBreak:"break-word",paddingRight:5}),linkStyle:()=>a.Styles.createTextStyle({flex:1,wordBreak:"break-word",color:h.Color.blue})});class m extends g.default{_buildState(e,t){let i=r.default.getToast(e.toastId);if(i&&i.state){const e=i.state.callId;return{callId:e,callState:n.default.CallingStore.getCallState(e),shouldBeRemoved:!n.default.CallingStore.isIncomingVideoDisabled(e)}}return{}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=this.state.callState&&o.default.isCallStateActive(this.state.callState)&&o.default.isCallStateOnHold(this.state.callState);!this.state.shouldBeRemoved&&a||(d.log(l.LogTraceArea.CallingUI,"CompositeIncomingVideoDisabledToast.componentDidUpdate removing toast"),r.default.removeToast(this.props.toastId))}render(){return a.createElement(a.View,{style:[C.container]},a.createElement(c.default,{callId:this.state.callId,containerStyle:[C.metadataContainer,p.default.flexNegativeOne],textStyle:[C.notificationTextStyle,this._themeStyles.headerTextColorStyle],linkStyle:C.linkStyle}))}}t.default=m,m.height=t.ToastHeight},42629:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(94224),o=i(18037),s=i(80200),r=i(98278),l=i(53143),c=i(46096),d=i(13944),u=i(10117),h=i(36237),p=i(15877),g=i(33754),C=i(22222),m=i(81760),S=i(11828),y=i(19675),f=i(24576),_=i(12770),b=i(53374),T=S.IconSize.size20,v=(0,p.lazyProperties)({container:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingHorizontal:20,paddingVertical:10}),contentContainer:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",flexWrap:"wrap",paddingHorizontal:10,alignItems:"center"}),textComposite:()=>a.Styles.createTextStyle({flex:-1,lineHeight:24,alignSelf:"center",wordBreak:"break-word"}),avSettingsLinkStyle:()=>a.Styles.createTextStyle({flex:-1,lineHeight:24,alignSelf:"center",wordBreak:"break-word",marginLeft:4,color:m.Color.sxBlue}),buttonContainer:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",flexWrap:"wrap",paddingLeft:10}),buttonStyle:()=>a.Styles.createButtonStyle({paddingLeft:10})});class w extends f.default{constructor(){super(...arguments),this._onCloseButtonPress=e=>{l.default.removeToast(this.props.toastId,s.ToastActionType.ManualDismissed)},this._onAVSettingsLinkPress=e=>{const t=b.default.newCauseId();h.log(c.LogTraceArea.Navigation,"CompositeNotificationToast._onAVSettingsLinkPress causeId: "+t),n.default.CallNavigationHelper.navigateToAVDesktopSettings(this._getRootViewId(),t),l.default.removeToast(this.props.toastId,s.ToastActionType.Actioned)}}_buildState(e){const t=l.default.getToast(e.toastId);if(t&&t.state){const e=t.state;return{notificationText:e.notificationText,showAvSettingsLink:e.showAvSettingsLink,timeout:e.buttons?void 0:e.timeout,icon:e.icon,useDarkTheme:o.default.useDarkTheme(),buttons:e.buttons}}return{}}_getIcon(){if(this.state.icon)return a.createElement(u.default,{icon:this.state.icon,size:S.IconSize.size24,color:this._themeColors.headerIconColor})}render(){const e=this._getIcon(),t=this.state.notificationText,i=this.state.showAvSettingsLink?a.createElement(y.BodyText,{style:v.avSettingsLinkStyle,onPress:this._onAVSettingsLinkPress},g.getString("DesktopProfileMenu.AudioVideoSettingsTitle")):void 0,n=this.state.buttons?a.createElement(a.View,{style:v.buttonContainer},this.state.buttons.map((e=>a.createElement(C.default,{style:v.buttonStyle,buttonStyle:this.state.useDarkTheme?r.SXButtonStyle.LightFill:r.SXButtonStyle.ColorFill,buttonSize:r.SXButtonSize.Small,title:g.getString(e.labelKey),onPress:e.callback})))):void 0,o=[this._themeStyles.headerTextColorStyle,v.textComposite];return a.createElement(a.View,{style:v.container},e,a.createElement(a.View,{style:v.contentContainer},a.createElement(y.BodyText,{style:o},t),i,n),a.createElement(d.default,{icon:S.SkypeIcon.ClosePanel,size:T,color:this._themeColors.headerIconColor,hoverColor:this._themeColors.primaryIconColor,title:g.getString("Global.CloseButtonTitle"),onPress:this._onCloseButtonPress}))}componentDidMount(){super.componentDidMount(),this.state.timeout&&(this._timeoutId=_.default.setTimeout((()=>{l.default.removeToast(this.props.toastId,s.ToastActionType.AutoDismissed),this._timeoutId=void 0}),this.state.timeout))}componentWillUnmount(){super.componentWillUnmount(),this._timeoutId&&(_.default.clearTimeout(this._timeoutId),this._timeoutId=void 0)}}t.default=w},29908:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(94224),o=i(68580),s=i(98278),r=i(53143),l=i(46096),c=i(36237),d=i(15877),u=i(55604),h=i(24576),p=(0,d.lazyProperties)({metadataContainer:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",paddingHorizontal:20,paddingVertical:s.CompositeNotificationToastInfo.vertical}),notificationTextStyle:()=>a.Styles.createTextStyle({flex:-1,wordBreak:"break-word"})});class g extends h.default{constructor(){super(...arguments),this._dismiss=()=>{c.log(l.LogTraceArea.CallingUI,"CompositeSpokenLanguageConflictResolutionToast._dismiss"),r.default.removeToast(this.props.toastId)}}_buildState(e,t){let i=r.default.getToast(e.toastId);if(i&&i.state){const e=i.state.callId;return{callId:e,callState:n.default.CallingStore.getCallState(e),shouldBeRemoved:!n.default.CallingStore.isIncomingVideoDisabled(e)}}return{}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=this.state.callState&&o.default.isCallStateActive(this.state.callState)&&o.default.isCallStateOnHold(this.state.callState);!this.state.shouldBeRemoved&&a||this._dismiss()}render(){return a.createElement(u.default,{containerStyle:p.metadataContainer,textStyle:[p.notificationTextStyle,this._themeStyles.headerTextColorStyle],onDismiss:this._dismiss,callId:this.state.callId,iconColor:this._themeColors.headerIconColor})}}t.default=g},48222:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(94224),o=i(68580),s=i(98278),r=i(53143),l=i(46096),c=i(36237),d=i(15877),u=i(81760),h=i(11828),p=i(37191),g=i(24576),C=(0,d.lazyProperties)({metadataContainer:()=>a.Styles.createViewStyle({paddingHorizontal:s.CompositeNotificationToastInfo.horizontal}),notificationTextStyle:()=>a.Styles.createTextStyle({flex:-1,wordBreak:"break-word"}),linkStyle:()=>a.Styles.createTextStyle({flex:1,wordBreak:"break-word",color:u.Color.blue})});class m extends g.default{constructor(){super(...arguments),this._dismiss=()=>{c.log(l.LogTraceArea.CallingUI,"CompositeTranslationInCallToast._dismiss"),r.default.removeToast(this.props.toastId)}}_buildState(e,t){let i=r.default.getToast(e.toastId);if(i&&i.state){const e=i.state,t=e.callId,a=e.conversationMri;return{callId:t,callState:n.default.CallingStore.getCallState(t),conversationMri:a}}return{}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);this.state.callState&&o.default.isCallStateActive(this.state.callState)&&o.default.isCallStateOnHold(this.state.callState)||this._dismiss()}render(){return a.createElement(p.default,{containerStyle:C.metadataContainer,textStyle:[C.notificationTextStyle,this._themeStyles.headerTextColorStyle],callId:this.state.callId,linkStyle:C.linkStyle,iconColor:this._themeColors.headerIconColor,iconSize:h.IconSize.size20,onDismiss:this._dismiss,conversationMri:this.state.conversationMri})}}t.default=m},62490:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DTMFDialpad=void 0;const a=i(74958),n=i(96486),o=i(16778),s=i(88837),r=i(94224),l=i(51129),c=i(56586),d=i(69965),u=i(46096),h=i(13944),p=i(36237),g=i(61253),C=i(15877),m=i(33754),S=i(81760),y=i(40363),f=i(11010),_=i(11828),b=i(53374),T=(0,C.lazyProperties)({container:()=>o.Styles.createViewStyle({flex:1,alignItems:"stretch",backgroundColor:S.Color.transparent}),dialpadContainer:()=>o.Styles.createViewStyle({flex:1,backgroundColor:S.Color.transparent}),inputDisplayContainer:()=>o.Styles.createViewStyle({flexDirection:"row",height:60,alignSelf:"stretch",justifyContent:"center",paddingLeft:12}),inputDisplayContainerDesktop:()=>o.Styles.createViewStyle({alignSelf:"stretch"}),inputDisplayInnerContainer:()=>o.Styles.createScrollViewStyle({flex:1,backgroundColor:S.Color.transparent}),inputDisplayInnerContainerRTL:()=>o.Styles.createScrollViewStyle({flexDirection:"row-reverse",transform:[{scaleX:-1}]}),inputTextDisplay:()=>o.Styles.createTextStyle({color:S.Color.white,fontSize:f.default.controlFontSize.dialpadInput,font:f.default.font.uiDisplayRegular,backgroundColor:S.Color.transparent,textAlignVertical:"center",alignSelf:"center"}),inputTextDisplayDesktop:()=>o.Styles.createViewStyle({flex:1,borderWidth:0,height:32,alignSelf:"center"}),inputFieldButton:()=>o.Styles.createButtonStyle({flex:0,width:60,height:60}),gestureCatcher:()=>o.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:S.Color.transparent}),flippedView:()=>o.Styles.createViewStyle({transform:[{scaleX:-1}]})});class v extends s.ComponentBase{constructor(){super(...arguments),this._onDialpadButtonPress=e=>{const t=b.default.newCauseId();p.log(u.LogTraceArea.DialerPanel,"DTMFDialpad._onDialpadButtonPress callId: "+this.props.callId+" input: "+a.pii.Omit(e)+" causeId: "+t),e&&this._sendDtmfTonesAndUpdateState(e,t)},this._onDialpadButtonLongPress=e=>{if("0"===e){const e=this.state.inputText+"+";this._setInputAndFocus(e),this.setState({inputText:e})}},this._onKeyPress=e=>{const t=e.keyCode,i=b.default.newCauseId();if(p.log(u.LogTraceArea.DialerPanel,"DTMFDialpad._onKeyPress callId: "+this.props.callId+" keyCode: "+a.pii.Omit(t)+" causeId: "+i),d.isDialPadKeyCode(t,e.shiftKey)){const i=d.getStringFromKeyCode(t,e.shiftKey),n=b.default.newCauseId();p.log(u.LogTraceArea.DialerPanel,"DTMFDialpad._onKeyPress callId: "+this.props.callId+" input: "+a.pii.Omit(i)+" causeId: "+n),this._sendDtmfTonesAndUpdateState(i,n)}},this._onPasteDesktop=e=>{if(!e.clipboardData||!e.clipboardData.items||0===e.clipboardData.items.length)return;const t=n.find(e.clipboardData.items,(e=>"text/plain"===e.type));t&&t.getAsString((e=>{this._onPaste(e)}))},this._onPasteNative=()=>{o.Clipboard.getText().then((e=>{e&&this._onPaste(e)}))},this._onScrollViewContentSizeChanged=(e,t)=>{if(!this.state.viewDimensions.width)return;const i=this.state.viewDimensions.width;this._scrollView&&e>i&&(y.default.isRTL()?this._scrollView.setScrollLeft(0):this._scrollView.setScrollLeft(e-i))},this._onScrollViewRef=e=>{this._scrollView=e||void 0},this._onDialpadInputRef=e=>{this._dialPadInput=e||void 0},this._onLayoutChange=e=>{const t={width:e.width,height:e.height};(0,g.default)(this.state.viewDimensions,t)||this.setState({viewDimensions:t})}}_buildState(e,t){let i={};return t&&(i.inputText="",i.viewDimensions={width:0,height:0}),i}componentDidMount(){super.componentDidMount(),this._setInputAndFocus(this.state.inputText,!0)}_sendDtmfTonesAndUpdateState(e,t){r.default.PstnUtils.sendDTMFTones(this.props.callId,e,t);const i=this.state.inputText+e;this._setInputAndFocus(i),this.setState({inputText:i})}_onPaste(e){const t=l.default.normalizePhoneNumber(e),i=b.default.newCauseId();p.log(u.LogTraceArea.DialerPanel,"DTMFDialpad._onPaste callId: "+this.props.callId+" pasted: "+a.pii.Omit(t)+" causeId: "+i),this._sendDtmfTonesAndUpdateState(t,i)}_setInputAndFocus(e,t){this._dialPadInput&&(this._dialPadInput.setValue(e),n.defer((()=>{if(this.isComponentMounted()&&this._dialPadInput){t||this._dialPadInput.requestFocus();const i=e.length;i>0&&this._dialPadInput.selectRange(i,i)}})))}render(){const e=y.default.isRTL(),t=[T.inputDisplayContainer],i=[T.inputTextDisplay],a=[T.inputDisplayInnerContainer];e&&(a.push(T.inputDisplayInnerContainerRTL),i.push(T.flippedView));let n=o.createElement(o.ScrollView,{ref:this._onScrollViewRef,style:a,horizontal:!0,showsHorizontalScrollIndicator:!1,onLayout:this._onLayoutChange,onContentSizeChange:this._onScrollViewContentSizeChanged},o.createElement(o.Text,{style:i,numberOfLines:1},this.state.inputText));return t.push(T.inputDisplayContainerDesktop),i.push(T.inputTextDisplayDesktop),n=o.createElement(o.TextInput,{style:i,ref:this._onDialpadInputRef,autoFocus:!0,onKeyPress:this._onKeyPress,value:this.state.inputText,clearButtonMode:"never",blurOnSubmit:!0,onPaste:this._onPasteDesktop}),o.createElement(o.View,{style:T.container},o.createElement(o.GestureView,{style:T.gestureCatcher}),o.createElement(o.View,{style:t},n,undefined,o.createElement(h.default,{style:T.inputFieldButton,size:_.IconSize.size20,onPress:this.props.onClose,color:S.Color.white,hoverColor:S.Color.gray300,icon:_.SkypeIcon.Cancel,title:m.getString("Global.CloseButtonTitle")})),o.createElement(o.View,{style:T.dialpadContainer},o.createElement(c.default,{onKeyPress:this._onDialpadButtonPress,onKeyLongPress:this._onDialpadButtonLongPress,isDtmfDialpad:!0,disableFontScaling:!0,enableExtensionDialing:!0})))}}t.DTMFDialpad=v,t.default=v},26208:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(9520),n=i(44228),o=i(53211),s=i(46096),r=i(40138),l=i(36237),c=i(33754),d=i(81760);class u extends n.default{constructor(e){super(e),this._messages=[],this._onMessageBack=e=>{this.props.onClose(),this._rejectCommand.execute(),this._messageCommand.execute(this._messages[e],s.PostSource.DeclineAndMessageMenu),l.track(new a.MobileCallAnswerEvent(a.MobileCallAnswerActions.DeclinedWithMessage,e+1))},this._onDefaultOption=()=>{this.props.onClose(),this._rejectCommand.execute(),l.track(new a.MobileCallAnswerEvent(a.MobileCallAnswerActions.DeclinedWithMessage,this._messages.length+1))},this._messages.push(c.getString("MobileIncomingCallPanel.CantTalkMessage")),this._messages.push(c.getString("MobileIncomingCallPanel.CallRightBackMessage")),this._messages.push(c.getString("MobileIncomingCallPanel.CallLaterMessage")),this._messages.push(c.getString("MobileIncomingCallPanel.CallMeLaterMessage")),this._rejectCommand=new r.RejectIncomingCallCommand(e.callId,!1),this._messageCommand=new r.MessageConversationCommand(e.conversationMri)}_buildRows(e,t){const i=[];for(let e=0;e<this._messages.length;e++){let t=this._messages[e];const a={key:"Message: "+t,titleText:t,accessibilityLabel:t,hideBorder:!0,onRowPress:this._onMessageBack.bind(this,e),titleTextColor:d.Color.white};i.push({props:a,builder:o.default.buildRow})}const a=c.getString("MobileIncomingCallPanel.DefaultOption"),n={key:"DefaultOption",titleText:a,accessibilityLabel:a,hideBorder:!0,onRowPress:this._onDefaultOption,titleTextColor:d.Color.blue};return i.push({props:n,builder:o.default.buildRow}),i}static getMenuHeight(){return 5*o.default.getMenuItemHeight()}}t.default=u},23497:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(74958),n=i(96486),o=i(16778),s=i(88837),r=i(10701),l=i(94224),c=i(80200),d=i(71727),u=i(71830),h=i(52262),p=i(46096),g=i(36237),C=i(47662),m=i(33754),S=i(18078),y=i(51070),f=i(81760),_=i(12770),b=i(72758),T="FixedPositionItem";class v extends s.ComponentBase{constructor(){super(...arguments),this._bottomOffset=0,this._renderItem=e=>{const t=e.id;if(e.item){const i=e.item,a=i.eventType!==c.ParticipantEventType.Join||this.props.useHighContrastTheme?f.Color.blackOverlay70:f.Color.blue;return o.createElement(r.default,{key:t,mri:i.mri,isLeaveEvent:i.eventType===c.ParticipantEventType.Leave||i.eventType===c.ParticipantEventType.Unavailable,isRaiseHandEvent:i.eventType===c.ParticipantEventType.HandRaised,useLightText:!0,displayString:this._getParticipantItemDisplayString(i),backgroundColor:a,layoutController:e.layoutController,horizontalSafeAreaInsets:this.state.horizontalSafeAreaInsets})}if(e.text)return o.createElement(r.default,{key:t,mri:e.text.mri,displayString:e.text.text,backgroundColor:f.Color.blackOverlay70,useLightText:!0,isTextEvent:!0,layoutController:e.layoutController,horizontalSafeAreaInsets:this.state.horizontalSafeAreaInsets})},this._onLayoutChange=e=>{this._layoutController.updateViewDimensions({width:e.width,height:e.height})}}_buildState(e,t){let i={horizontalSafeAreaInsets:y.default.horizontalInsets(),audienceBotMris:l.default.InCallBotMriUtils.getCallAudienceBotMriFilter(),gridViewBotMris:l.default.InCallBotMriUtils.getCallGridViewBotMriFilter()};return t&&(this._eventCount=0,this._layoutController=new I,i.itemRenderInfos=[],this._layoutController.setCallbacks((e=>this._onRemoveItem(e)))),i}textEvent(e,t){this.setState(this._onTextEvent(e,t))}participantEvent(e,t){const i=u.sanitizeMri(e,u.Namespaces.SkypeId),a={mri:i,userName:h.default.getDisplayName(i)||m.getString("Notifications.UnknownUserShort"),eventType:t,gender:b.default.getFullUserProfileByMri(i).gender,isCurrentUser:S.default.isMyMri(i)};this.setState(this._onParticipantEvent(a))}participantActionEvent(e,t,i){const a=u.sanitizeMri(e,u.Namespaces.SkypeId),n=this._getUserNameForEvent(a),o=u.sanitizeMri(t,u.Namespaces.SkypeId),s={mri:a,userName:n,actionMri:o,actionUserName:h.default.getDisplayName(o)||m.getString("Notifications.UnknownUserShort"),eventType:i};this.setState(this._onParticipantEvent(s))}participantsRingingEvent(e){const t={displayString:d.default.getRingingItemDisplayString(e),mri:e[0],participantCount:e.length};this.setState(this._onParticipantsRingingEvent(t))}clearEvents(){this._layoutController.clearEvents()}_onRemoveItem(e){this.isComponentMounted()&&(this._layoutController.removeControllerForKey(e),e===T?this.setState({fixedPositionItem:void 0}):this.setState(this._removeStreamItemsAndReturnNewState(e,this.state)))}_onParticipantEvent(e){let t=n.clone(this.state.itemRenderInfos);const i="participant_"+this._eventCount++;let a=this._bottomOffset;return e.eventType===c.ParticipantEventType.Unavailable&&(a=48),t.push({id:i,item:e,layoutController:this._layoutController.controllerForKey(i,!0,a)}),{itemRenderInfos:t}}_onParticipantsRingingEvent(e){let t=this._layoutController.getFixedPositionItemController(!0),i={id:"FixedPositionItem",ringingItem:e,layoutController:t};if(!this.state.fixedPositionItem&&e.participantCount>0)this._bottomOffset=48,null==t||t.setDismissTimerTimeout(3e4);else{if(0===e.participantCount)return null==t||t.dismissItem(!0),this._bottomOffset=0,this.state;null==t||t.restartDismissTimer()}return{fixedPositionItem:i}}_onTextEvent(e,t){const i=n.clone(this.state.itemRenderInfos),a="text_"+this._eventCount++;return i.push({id:a,text:{mri:t,text:e},layoutController:this._layoutController.controllerForKey(a,!0)}),{itemRenderInfos:i}}_removeStreamItemsAndReturnNewState(e,t){const i=n.clone(t.itemRenderInfos);return{itemRenderInfos:n.filter(i,(t=>t.id!==e))}}_getParticipantItemDisplayString(e){const{eventType:t,userName:i,actionUserName:a,gender:o,isCurrentUser:s}=e;let r;switch(t){case c.ParticipantEventType.Join:r=m.getString("ReactionsStream.ParticipantJoined",{participant:i});break;case c.ParticipantEventType.Leave:r=m.getString("ReactionsStream.ParticipantLeft",{participant:i});break;case c.ParticipantEventType.Muted:r=m.getString("CallPanel.MicrophoneServerMutedPersonalize",{initiator:i,person:a||""});break;case c.ParticipantEventType.HandRaised:r=s?m.getString("ReactionsStream.RaiseHandEventForCurrentUser"):m.getString("ReactionsStream.RaiseHandEvent",{gender:C.getLocalizeParamForGender(o),initiator:i||""});break;case c.ParticipantEventType.KickedOut:r=m.getString("CallPanel.RemoveFromCallPersonalize",{initiator:i,person:a||""});break;case c.ParticipantEventType.BotUnavailable:r=n.includes(this.state.audienceBotMris,e.mri)?m.getString("ReactionsStream.TogetherModeUnavailable"):n.includes(this.state.gridViewBotMris,e.mri)?m.getString("ReactionsStream.LargeGridUnavailable"):m.getString("ReactionsStream.ParticipantUnavailable",{participant:i});break;case c.ParticipantEventType.TogetherModeBackgroundChangeFailed:r=m.getString("ReactionsStream.TogetherModeBackgroundChangeFailed");break;case c.ParticipantEventType.TogetherModeDesiredBackgroundAlreadySet:r=m.getString("ReactionsStream.TogetherModeDesiredBackgroundAlreadySet");break;case c.ParticipantEventType.TogetherModeBackgroundChanged:r=m.getString("ReactionsStream.TogetherModeBackgroundChanged",{participant:i});break;case c.ParticipantEventType.Unavailable:default:r=m.getString("ReactionsStream.ParticipantUnavailable",{participant:i})}return r}_renderFixedPositionItem(){if(!this.state.fixedPositionItem)return;const e=this.state.fixedPositionItem,t=e.id;return e.ringingItem?o.createElement(r.default,{key:t,mri:e.ringingItem.mri,isLeaveEvent:!1,useLightText:!0,displayString:e.ringingItem.displayString,backgroundColor:this.props.useHighContrastTheme?f.Color.blackOverlay70:f.Color.blue,layoutController:e.layoutController,horizontalSafeAreaInsets:this.state.horizontalSafeAreaInsets}):void 0}_getUserNameForEvent(e){const t=u.sanitizeMri(e,u.Namespaces.SkypeId);return h.default.getDisplayName(t)||m.getString("Notifications.UnknownUserShort")}render(){const e=n.map(this.state.itemRenderInfos,this._renderItem),t=this._renderFixedPositionItem();return o.createElement(o.View,{style:this.props.style,onLayout:this._onLayoutChange,ignorePointerEvents:!0},e,t)}}t.default=v;class w{constructor(e,t,i,n=0){this._hasBeenPresented=!1,this._hasBeenDismissed=!1,this._dismissTimerTimeout=5e3,this._currentHeight=0,this._currentBottomOffset=0,this._currentOpacity=0,this._animatedOpacityValue=new o.Animated.Value(this._currentOpacity),this._animatedVerticalValue=new o.Animated.Value(this._currentBottomOffset),this._animatedStyle=o.Styles.createAnimatedViewStyle({opacity:this._animatedOpacityValue,bottom:this._animatedVerticalValue}),g.log(p.LogTraceArea.CallingUI,`EventItemLayoutController constructor ${a.pii.Omit(e)}`),this._id=e,this._onIntrinsicHeightChange=t,this._onRemoveItem=i,this._currentBottomOffset=n}getStyles(){return[this._animatedStyle]}setIntrinsicHeight(e){Math.abs(e-this._currentHeight)>1&&(this._currentHeight=e,this._onIntrinsicHeightChange(this._id,e,!this._hasBeenPresented))}presentItemIfNeeded(e=!1){return!this._hasBeenPresented&&(g.log(p.LogTraceArea.CallingUI,`EventItemLayoutController presentItemIfNeeded ${a.pii.Omit(this._id)}`),this._hasBeenPresented=!0,this._animatedVerticalValue.setValue(-1.2*this._currentHeight),this._updateAnimatedPosition(this._currentBottomOffset,this._currentOpacityValue(),e,!0,450,(()=>this._startDismissTimer())),!0)}setDismissTimerTimeout(e){this._dismissTimerTimeout=e}restartDismissTimer(){this._startDismissTimer()}dismissItem(e=!1){return!this._hasBeenDismissed&&(g.log(p.LogTraceArea.CallingUI,`EventItemLayoutController dismissItem ${a.pii.Omit(this._id)}`),this._clearDismissTimer(),this._updateAnimatedPosition(this._currentBottomOffset+40,0,e,!1,750,(()=>{this._onRemoveItem&&this._onRemoveItem(this._id)})),this._hasBeenDismissed=!0,!0)}addtoBottomOffset(e,t=!1){this._updateAnimatedPosition(this._currentBottomOffset+e,this._currentOpacityValue(),t)}_clearDismissTimer(){this._dismissTimer&&(_.default.clearTimeout(this._dismissTimer),this._dismissTimer=void 0)}_startDismissTimer(){this._clearDismissTimer(),this._dismissTimer=_.default.setTimeout((()=>this.dismissItem(!0)),this._dismissTimerTimeout)}_currentOpacityValue(){return this._hasBeenPresented&&!this._hasBeenDismissed?1:0}_updateAnimatedPosition(e,t=1,i=!1,a=!1,n=300,s,r){if(!this._hasBeenDismissed){if(this._animation&&(this._animation.stop(),this._animation=void 0),i){let i=r||[];0!==t&&i.push(o.Animated.timing(this._animatedVerticalValue,{toValue:e,duration:n,easing:a?o.Animated.Easing.CubicBezier(.87,-.41,.19,1.44):o.Animated.Easing.InOut()})),i.push(o.Animated.timing(this._animatedOpacityValue,{toValue:t,duration:n,easing:o.Animated.Easing.InOut()})),this._animation=o.Animated.parallel(i),this._animation.start((e=>{s&&s()}))}else this._animatedVerticalValue.setValue(e),this._animatedOpacityValue.setValue(t),s&&s();this._currentOpacity=t,this._currentBottomOffset=e}}}class I{constructor(){this._controllers={},this._orderedKeys=[],this._onIntrinsicHeightChange=(e,t,i)=>{let a=n.indexOf(this._orderedKeys,e);if(i)if(e===T){const e=this.getFixedPositionItemController(!1);null==e||e.presentItemIfNeeded()}else{const e=this.controllerForKey(this._orderedKeys[a],!1);e&&e.presentItemIfNeeded(!0)}for(a-=1;a>=0;a--){const e=this.controllerForKey(this._orderedKeys[a],!1);e&&e.addtoBottomOffset(t,!0)}}}updateViewDimensions(e){}setCallbacks(e){this._onRemoveItem=e}clearEvents(){n.each(this._controllers,(e=>e.dismissItem()))}controllerForKey(e,t,i=0){let a=this._controllers[e];return!a&&t&&(a=new w(e,this._onIntrinsicHeightChange,this._onRemoveItem,i),this._controllers[e]=a,this._orderedKeys.push(e)),a}getFixedPositionItemController(e){return!this._fixedPositionItemController&&e&&(this._fixedPositionItemController=new w(T,this._onIntrinsicHeightChange,this._onRemoveItem,0)),this._fixedPositionItemController}removeControllerForKey(e){e===T?delete this._fixedPositionItemController:(delete this._controllers[e],this._orderedKeys=n.without(this._orderedKeys,e))}}},95952:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(88837),o=i(15877),s=i(80837),r=i(12770),l=(0,o.lazyProperties)({backFlippedHorizontal:()=>a.Styles.createViewStyle({transform:[{rotateY:"180deg"}]}),backFlippedVertical:()=>a.Styles.createViewStyle({transform:[{rotateX:"180deg"}]})});class c extends n.ComponentBase{constructor(){super(...arguments),this._rotationYValue=new a.Animated.Value(0),this._rotationYStyle=a.Styles.createAnimatedViewStyle({transform:[{rotateY:this._rotationYValue.interpolate({inputRange:[0,360],outputRange:["0deg","360deg"]})}]}),this._rotationXValue=new a.Animated.Value(0),this._rotationXStyle=a.Styles.createAnimatedViewStyle({transform:[{rotateX:this._rotationXValue.interpolate({inputRange:[0,360],outputRange:["0deg","360deg"]})}]}),this._onToggle=()=>{this._flipAnimation(!this.state.isFlipped)}}_buildState(e,t){const i={};return t&&(i.isFlipped=!1),i}componentDidMount(){super.componentDidMount(),this.props.autoflipTimeout&&r.default.setTimeout((()=>{this.isComponentMounted()&&this._onToggle()}),this.props.autoflipTimeout)}_flipAnimation(e){const t=this.props.duration||1e3;this.props.flipHorizontal?a.Animated.timing(this._rotationYValue,{toValue:e?180:0,duration:t,easing:a.Animated.Easing.InOutBack()}).start():a.Animated.timing(this._rotationXValue,{toValue:e?180:0,duration:t,easing:a.Animated.Easing.InOutBack()}).start(),r.default.setTimeout((()=>{this.isComponentMounted()&&this.setState({isFlipped:e})}),t/2)}render(){const e=this.props.children;let t;t=this.state.isFlipped?a.createElement(d,{key:"back",isBack:!0,flipHorizontal:this.props.flipHorizontal},e[1]):a.createElement(d,{key:"front",flipHorizontal:this.props.flipHorizontal},e[0]);const i=[s.default.flexOne,this.props.flipHorizontal?this._rotationYStyle:this._rotationXStyle];return a.createElement(a.View,{style:this.props.style},a.createElement(a.Animated.View,{style:i},t))}}t.default=c;class d extends n.ComponentBase{render(){const e=[s.default.flexOne];return this.props.isBack&&e.push(this.props.flipHorizontal?l.backFlippedHorizontal:l.backFlippedVertical),a.createElement(a.View,{style:e},this.props.children)}}},74259:(e,t,i)=>{const a=i(74958),n=i(96486),o=i(16778),s=i(48540),r=i(90295),l=i(94224),c=i(68580),d=i(37103),u=i(47176),h=i(2278),p=i(80200),g=i(71727),C=i(46565),m=i(47447),S=i(71830),y=i(77381),f=i(46096),_=i(10117),b=i(36237),T=i(61253),v=i(15877),w=i(33754),I=i(18078),P=i(14976),M=i(4057),k=i(93194),A=i(81760),R=i(11828),V=i(80837),L=i(47017),E=i(53374),B=100,O=120,D="hangup",x="mute",N="unmute",U=(0,v.lazyProperties)({container:()=>o.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"visible"}),pipContainer:()=>o.Styles.createViewStyle({height:B,width:B,borderRadius:50,backgroundColor:A.Color.black}),gestureView:()=>o.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:A.Color.transparent}),pip:()=>o.Styles.createViewStyle({position:"absolute",height:B,width:B,overflow:"visible"}),talkingAnimation:()=>o.Styles.createViewStyle({position:"absolute",top:-10,left:-10,width:O,height:O,overflow:"visible"}),muteIconContainer:()=>o.Styles.createViewStyle({position:"absolute",bottom:2,left:0,right:0,height:30,alignItems:"center",justifyContent:"center",backgroundColor:A.Color.transparent})});class F extends y.default{constructor(){super(...arguments),this._currentPoint={x:0,y:0},this._targetPoint={x:0,y:0},this._isDragging=!1,this._animatedTopValue=new o.Animated.Value(this._currentPoint.y),this._animatedLeftValue=new o.Animated.Value(this._currentPoint.x),this._animatedStyle=o.Styles.createAnimatedViewStyle({top:this._animatedTopValue,left:this._animatedLeftValue}),this._animatedScaleValue=new o.Animated.Value(1),this._animatedScaleStyle=o.Styles.createAnimatedViewStyle({transform:[{scale:this._animatedScaleValue}]}),this._participantLayoutController={getStyles:()=>[U.pipContainer],getInnerStyles:()=>[V.default.flexOne],getBackgroundColorStyle(){},isHidden:()=>!1},this._onPress=()=>{const e=E.default.newCauseId();b.log(f.LogTraceArea.CallingUI,"FloatingPipView._onPress causeId: "+e),this._updateScale(!1),this.state.callConversationMri&&this.state.callId&&l.default.CallNavigationHelper.rejoinCall(this.state.callConversationMri,this.state.callId,e,f.NavigationCallOrigin.PipView)},this._onLongPress=e=>{this._updateScale(!1,750);const t=this._getActionMenu(),i={anchor:()=>this._floatingPipView,buttons:t.menuItems,destructiveButtonIndex:t.destructiveIndex};k.default.showWithActionMenuConfig({options:i,callback:this._onHandleActionMenuCommand,maintainAnchor:!0,rootViewId:this._getRootViewId(),invokingEvent:e})},this._onPressIn=()=>{this._updateScale(!0)},this._onPan=e=>{const t=!e.isComplete;if(this._isDragging!==t&&this._startOrStopDragging(t),!this._approachValue){const e=this._centerPoint(this._currentPoint);this._startApproach(e,(e=>{const t={x:e.x-50,y:e.y-50};this._positionPip(t),!this._isDragging&&Math.abs(this._targetPoint.x-e.x)<1&&Math.abs(this._targetPoint.y-e.y)<1&&this._stopApproach()}))}if(this._approachValue&&this._isDragging&&(this._targetPoint={x:e.pageX,y:e.pageY},this._approachValue.updateTarget(this._targetPoint)),e.isComplete){let t,i;if(Math.abs(e.velocityY)<.25)Math.abs(e.velocityX)<.25?(t=e.pageX>this.state.viewDimensions.width/2?this.state.viewDimensions.width:0,i=this._currentPoint.y+50):(t=e.velocityX>0?this.state.viewDimensions.width:0,i=this._currentPoint.y+50);else{const a=e.velocityY/e.velocityX;t=e.velocityX>0?this.state.viewDimensions.width:0,i=a*(t-e.pageX)+e.pageY}t=Math.max(Math.min(t,this._maxX()),40),i=Math.max(Math.min(i,this._maxY()),114),this._targetPoint={x:t,y:i},this._approachValue&&this._approachValue.updateTarget(this._targetPoint)}},this._updateElementLink=(e,t,i,a,o,r,c,d)=>{b.log(f.LogTraceArea.CallingUI,"FloatingPipView._updateElementLink causeId: "+r);const u=e;if(!this._renderedElementMri||this._renderedElementMri!==u||n.isUndefined(this._renderedElementType)||this._renderedElementType!==o||!this._callingVideoView||this._callingVideoView.getVideoContainer()!==i)if(this._renderedElementMri&&this._renderedElementMri!==u&&this._removeElementLink(r),n.isUndefined(i)||!n.isUndefined(this._renderedElementType)&&this._renderedElementType!==o)this._removeElementLink(r);else{if(this.state.callId)if(this.state.isCallJoinedAsTwinCam)l.default.CallingStore.setLocalVideoTarget(this.state.callId,!!i,i,{scalingMode:s.ScalingMode.Crop,transparent:!1},r).finally((()=>{d&&d()}));else{const e=m.CallingCapabilities.directReparentingSupported()?l.default.RemoteStreamHelper.getRemoteStreamRenderer(this.state.callId,u,o,c):void 0;l.default.RemoteStreamHelper.startRemoteStream(this.state.callId,u,"FloatingPipView",o,i,{scalingMode:s.ScalingMode.Crop,transparent:!1,rendererTobeReparented:e,disposeRendererWhenStreamisNotAvailable:()=>!0},r,[],c).then((()=>{d&&d()}))}this._renderedElementType=o,this._renderedElementMri=u}},this._onLayoutChange=e=>{const t={width:e.width,height:e.height};this.setState({viewDimensions:t})},this._onHandleActionMenuCommand=e=>{const t=E.default.newCauseId();if(b.log(f.LogTraceArea.CallingUI,"FloatingPipView._onHandleActionMenuCommand "+e+" causeId: "+t),this.state.callId)switch(e){case D:l.default.CallingStore.endCall(this.state.callId,t);break;case x:h.default.updateCallTelemetry(this.state.callId,t,(e=>e.muteFloatingPipPress())),l.default.CallingStore.mute(this.state.callId,t);break;case N:h.default.updateCallTelemetry(this.state.callId,t,(e=>e.muteFloatingPipPress())),l.default.CallingStore.unmute(this.state.callId,t);case k.SXActionMenuCancel:}},this._onElementScalingModeChanged=(e,t,i)=>{const n=E.default.newCauseId();b.log(f.LogTraceArea.CallingUI,"FloatingPipView._onElementScalingModeChanged key: "+a.pii.Omit(e)+" scalingMode: "+i+" causeId: "+n),S.isMri(e)&&this.state.callId?l.default.RemoteStreamHelper.setScalingMode(this.state.callId,e,t,i,n).catch((e=>{b.warn(f.LogTraceArea.CallingUI,"FloatingPipView._onElementScalingModeChanged setScalingMode failed "+M.default.errorAsString(e)+" causeId: "+n)})):b.log(f.LogTraceArea.CallingUI,"CallStageView._onElementScalingModeChanged skipping for non-MRI "+a.pii.Omit(e))},this._layoutController=()=>this._participantLayoutController,this._onFloatingPipRef=e=>{this._floatingPipView=e||void 0},this._onCallingVideoView=(e,t)=>{b.log(f.LogTraceArea.CallingUI,"FloatingPipView._onCallingVideoView causeId"+t),this._callingVideoView!==e&&(this._callingVideoView=e)}}_buildState(e,t){const i={};t&&(i.viewDimensions={width:0,height:0});const a=l.default.CallingStore.getConnectedOrOutgoingAndNotOnHoldCallId();if(!a||C.default.isCallVisible(a))return i.showPip=!1,i.callState=s.CallState.None,i.videoAvailable=!1,i.videoStreaming=!1,i.screenshareAvailable=!1,i.screenshareStreaming=!1,i.isMuted=!1,i.callId=void 0,i.callConversationMri=void 0,i.speakerMri=void 0,i;const o=l.default.CallingStore.getCallConversationMri(a);if(l.default.CallingStore.isCallCreator(a)&&o&&1===u.default.getActiveParticipants(a,o).length)i.speakerMri=n.first(I.default.getMyMris());else{const e=l.default.CallingStore.getTopSpeakerMri(a);if(e)i.speakerMri=e;else{const e=l.default.CallingStore.getRemoteCallMemberMris(a);i.speakerMri=this._fallbackSpeakerParticipantKey(a,e)}}if(i.isCallJoinedAsTwinCam=l.default.CallingStore.isCallJoinedAsTwinCam(a),i.isCallJoinedAsTwinCam){const e=C.default.hasCallPreviewViewBeenSeen(a),t=l.default.CallingStore.isProvidingVideo(a);i.showPip=!e,i.callId=a,i.callConversationMri=o,i.callState=l.default.CallingStore.getCallState(a),i.videoAvailable=t,i.screenshareAvailable=!1,i.videoStreaming=t&&!e,i.screenshareStreaming=!1,i.isMuted=g.default.isLocalOrServerMuted(a)}else i.speakerMri?(i.showPip=!0,i.callId=a,i.callConversationMri=o,i.callState=l.default.CallingStore.getCallState(a),i.videoAvailable=l.default.RemoteStreamHelper.isStreamAvailable(a,i.speakerMri,s.StreamType.Video),i.screenshareAvailable=l.default.RemoteStreamHelper.isStreamAvailable(a,i.speakerMri,s.StreamType.ScreenSharing),i.videoStreaming=l.default.RemoteStreamHelper.isStreamRenderingForTarget(a,i.speakerMri,s.StreamType.Video,this._callingVideoView?this._callingVideoView.getVideoContainer():void 0),i.screenshareStreaming=l.default.RemoteStreamHelper.isStreamRenderingForTarget(a,i.speakerMri,s.StreamType.ScreenSharing,this._callingVideoView?this._callingVideoView.getVideoContainer():void 0),i.isMuted=g.default.isLocalOrServerMuted(a)):(i.showPip=!1,i.callState=s.CallState.None,i.videoAvailable=!1,i.videoStreaming=!1,i.screenshareAvailable=!1,i.screenshareStreaming=!1,i.isMuted=!1,i.callId=void 0,i.callConversationMri=void 0);return i}componentDidMount(){super.componentDidMount(),this.state.showPip&&this.state.viewDimensions.width&&this._presentPip();const e=this.state.showPip?"Showing":"Hiding";b.log(f.LogTraceArea.CallingUI,"FloatingPipView.componentDidMount: "+e+" PiP")}componentWillUnmount(){super.componentWillUnmount();const e=E.default.newCauseId();b.log(f.LogTraceArea.CallingUI,"FloatingPipView.componentWillUnmount causeId: "+e),this._removeElementLink(e)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=E.default.newCauseId();if(b.log(f.LogTraceArea.CallingUI,"FloatingPipView.componentDidUpdate causeId: "+a),this.state.showPip!==t.showPip&&(this.state.showPip&&this._presentPip(),this.state.showPip||c.default.isCallStateActive(this.state.callState)||this._removeElementLink(a),this.state.showPip!==t.showPip)){const e=this.state.showPip?"Showing":"Hiding";b.log(f.LogTraceArea.CallingUI,"FloatingPipView.componentDidUpdate: "+e+" PiP")}(0,T.default)(this.state.viewDimensions,t.viewDimensions)||(t.viewDimensions.width?this._updatePipPosition():this.state.showPip&&this._presentPip())}requestFocus(){}_presentPip(){b.log(f.LogTraceArea.CallingUI,"FloatingPipView._presentPip");const e={x:this.state.viewDimensions.width,y:84};this._positionPip(e),this._positionPip({x:e.x-90,y:e.y},!0,200)}_stopApproach(){this._approachValue&&(this._approachValue.stop(),this._approachValue=void 0)}_startApproach(e,t){this._stopApproach(),this._approachValue=new r.default(e,t),this._approachValue.start()}_startOrStopDragging(e){this._isDragging=e,this._updateScale(e)}_updateScale(e,t=250){o.Animated.timing(this._animatedScaleValue,{toValue:e?.9:1,easing:o.Animated.Easing.OutBack(),duration:t}).start()}_fallbackSpeakerParticipantKey(e,t){if(!t||n.isEmpty(t))return;const i=n.find(t,(t=>l.default.RemoteStreamHelper.isStreamAvailable(e,t,s.StreamType.ScreenSharing)));if(i)return i;const a=n.find(t,(t=>l.default.RemoteStreamHelper.isStreamAvailable(e,t,s.StreamType.Video)));return a||t[0]}_updatePipPosition(){if(this._isDragging)return;let e=this._currentPoint.x,t=this._currentPoint.y;e>0&&(e=this._maxX()-50);const i=this._maxY()-50;t>i&&(t=i),this._positionPip({x:e,y:t})}_maxX(){return this.state.viewDimensions.width-50+10}_maxY(){return this.state.viewDimensions.height-50+10}_centerPoint(e){return{x:e.x+50,y:e.y+50}}_removeElementLink(e){b.log(f.LogTraceArea.CallingUI,"FloatingPipView._removeElementLink causeId: "+e),this._renderedElementMri&&this.state.callId&&!n.isUndefined(this._renderedElementType)&&this._renderedElementMri!==p.CallStageElementKeys.localUserKey&&(l.default.RemoteStreamHelper.stopRemoteStream(this.state.callId,this._renderedElementMri,"FloatingPipView",this._renderedElementType,e),this._renderedElementType=void 0,this._renderedElementMri=void 0)}_positionPip(e,t=!1,i=0){t?o.Animated.parallel([o.Animated.timing(this._animatedTopValue,{toValue:e.y,easing:o.Animated.Easing.Out(),duration:250,delay:i}),o.Animated.timing(this._animatedLeftValue,{toValue:e.x,easing:o.Animated.Easing.Out(),duration:250,delay:i})]).start():(this._animatedTopValue.setValue(e.y),this._animatedLeftValue.setValue(e.x)),this._currentPoint=e}_getActionMenu(){const e=[];return e.push({text:w.getString("FloatingPipView.HangupAction"),command:D}),this.state.isMuted?e.push({text:w.getString("FloatingPipView.UnmuteAction"),command:N}):e.push({text:w.getString("FloatingPipView.MuteAction"),command:x}),{menuItems:e,destructiveIndex:0}}_getRenderInfo(){let e=p.VideoStatus.None;return(this.state.videoAvailable||this.state.screenshareAvailable)&&(e=p.VideoStatus.Available,(this.state.videoStreaming||this.state.screenshareStreaming)&&(e=p.VideoStatus.Streaming)),{renderKey:this.state.speakerMri||"",mri:this.state.speakerMri||"",isLocal:!1,videoStatus:e,renderScreenShare:this.state.screenshareAvailable}}_getLocalRenderInfo(){return{renderKey:p.CallStageElementKeys.localUserKey,mri:I.default.getSkypeMri(),isLocal:!0,videoStatus:this.state.videoStreaming?p.VideoStatus.Streaming:p.VideoStatus.None,renderScreenShare:!1}}render(){if(!this.state.showPip||!this.state.viewDimensions.width)return o.createElement(o.View,{style:U.container,onLayout:this._onLayoutChange,ignorePointerEvents:!0});b.log(f.LogTraceArea.CallingUI,"FloatingPipView: Showing PiP for call user "+P.mriOrId(this.state.speakerMri)+", videoAvailable "+this.state.videoAvailable+", videoStreaming "+this.state.videoStreaming+", videoDimension "+this.state.viewDimensions.width+" "+this.state.viewDimensions.height+", threadId: "+P.mriOrId(this.state.callConversationMri)+", callId: "+this.state.callId);const e=this.state.isCallJoinedAsTwinCam?this._getLocalRenderInfo():this._getRenderInfo(),t=this.state.isMuted?o.createElement(o.View,{style:U.muteIconContainer},o.createElement(_.default,{icon:R.SkypeIcon.MicrophoneOff,size:R.IconSize.size16,color:A.Color.white})):void 0;return o.createElement(o.View,{style:U.container,onLayout:this._onLayoutChange,ignorePointerEvents:!0},o.createElement(o.Animated.View,{ref:this._onFloatingPipRef,style:[U.pip,this._animatedStyle,this._animatedScaleStyle],ignorePointerEvents:!0},o.createElement(L.default,{style:U.talkingAnimation,animate:!0,size:O}),this.state.callId&&o.createElement(d.CallParticipantView,{callId:this.state.callId,renderInfo:e,renderKey:e.renderKey,isCompact:!0,iconOpacity:1,onUpdateElementLink:this._updateElementLink,onScalingModeChanged:this._onElementScalingModeChanged,videoBorderRadius:50,suppressTalkingRing:!0,parentViewId:"FloatingPipView",onCallingVideoView:this._onCallingVideoView,layoutController:this._layoutController,iconSize:100}),t,o.createElement(o.GestureView,{style:U.gestureView,onPan:this.state.showPip?this._onPan:void 0,releaseOnRequest:!1,importantForAccessibility:o.Types.ImportantForAccessibility.No},o.createElement(o.Button,{style:U.gestureView,onPress:this.state.showPip?this._onPress:void 0,onPressIn:this._onPressIn,onLongPress:this._onLongPress,delayLongPress:500,disableTouchOpacityAnimation:!0,accessibilityLabel:w.getString("FloatingPipView.ReturnToCallButtonAccessibilityLabel"),accessibilityTraits:o.Types.AccessibilityTrait.Button}))))}}t.Z=F},22003:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(88837),o=i(94224),s=i(46565);class r extends n.ComponentBase{_buildState(e,t){if(!t&&this.state.renderPipView)return{};{const e=o.default.CallingStore.getConnectedOrOutgoingAndNotOnHoldCallId();return{renderPipView:!!e&&!s.default.isCallVisible(e)}}}render(){if(this.state.renderPipView){const e=i(74259).Z;return a.createElement(e,null)}return null}}t.default=r},24430:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(38933),n=i(16778),o=i(18967),s=i(54174),r=i(71727),l=i(98278),c=i(15877),d=i(15415),u=i(81760),h=i(80837),p=i(24576),g=i(2301),C=i(67977).UserIconSize.Size120,m=(0,c.lazyProperties)({container:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center"}),containerAndroid:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center",overflow:"visible"}),innerView:()=>h.default.absoluteFill,backgroundContainerView:()=>n.Styles.createViewStyle({backgroundColor:u.Color.transparent}),icon:()=>n.Styles.createViewStyle({width:C,height:C,overflow:"visible"}),connecting:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center",position:"absolute",top:0,left:0,height:C,width:C,borderRadius:C/2,backgroundColor:u.Color.blackOverlay20,overflow:"hidden"}),talkingViewContainer:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center",overflow:"visible"})});class S extends p.default{constructor(){super(...arguments),this._isTalking=!1,this._animatedBackgroundOpacityValue=new n.Animated.Value(0),this._animatedBackgroundOpacityStyle=n.Styles.createAnimatedViewStyle({opacity:this._animatedBackgroundOpacityValue}),this._animatedIconOpacityValue=new n.Animated.Value(0),this._animatedIconScaleValue=new n.Animated.Value(1),this._animatedIconStyle=n.Styles.createAnimatedViewStyle({opacity:this._animatedIconOpacityValue,transform:[{scale:this._animatedIconScaleValue}]}),this._onCallParticipantTalkingViewRef=e=>{this._callParticipantTalkingView=e||void 0}}_buildState(e,t){return{useHighContrastTheme:r.default.useHighContrastThemeAndChanges()}}componentDidMount(){super.componentDidMount(),this._updateIconOpacity(),this._updateBackgroundIconOpacity(!1),this._updateIconScale()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.props.iconOpacity!==e.iconOpacity&&this._updateIconOpacity(this.props.animateChanges),this.props.isConnecting===e.isConnecting&&this.props.backgroundOpacity===e.backgroundOpacity||this._updateBackgroundIconOpacity(r.default.enableLayoutAnimation()),this.props.size!==e.size&&this._updateIconScale(this.props.animateChanges),this._updateTalkingView()}updateTalking(e){this._isTalking!==e&&(this._isTalking=e,this._updateTalkingView())}_updateTalkingView(){this._callParticipantTalkingView&&this._callParticipantTalkingView.updateTalking(this._isTalking)}_updateIconScale(e=!1){const t=this.props.size/C;e?n.Animated.timing(this._animatedIconScaleValue,{duration:250,toValue:t,easing:n.Animated.Easing.InOut()}).start():this._animatedIconScaleValue.setValue(t)}_updateIconOpacity(e=!1){const t=this.props.iconOpacity||0;e?n.Animated.timing(this._animatedIconOpacityValue,{duration:250,toValue:t,easing:n.Animated.Easing.InOut()}).start():this._animatedIconOpacityValue.setValue(t)}_updateBackgroundIconOpacity(e){const t=this.props.isConnecting||!this.props.backgroundOpacity?0:this.props.backgroundOpacity;e?n.Animated.timing(this._animatedBackgroundOpacityValue,{duration:250,toValue:t,easing:n.Animated.Easing.InOut()}).start():this._animatedBackgroundOpacityValue.setValue(t)}render(){const e=this.props.isConnecting?n.createElement(n.View,{style:m.connecting},n.createElement(d.default,{size:l.SXActivityIndicatorSize.Medium,tintColor:u.Color.whiteOverlay80})):void 0,t=this.props.backgroundOpacity&&this.props.backgroundOpacity>0?n.createElement(n.View,{style:[m.innerView,m.talkingViewContainer]},n.createElement(s.default,{ref:this._onCallParticipantTalkingViewRef,size:s.CallParticipantTalkingViewSize.Large,talkingTintColor:this.state.useHighContrastTheme?u.Color.gray200:void 0})):void 0;let i=[this.props.style];i.push(m.container);const r=[m.innerView,m.backgroundContainerView];this.state.useHighContrastTheme?r.push(this._themeStyles.primaryBackgroundColorStyle):this.props.backgroundColorStyle&&r.push(this.props.backgroundColorStyle),this._animatedBackgroundOpacityStyle&&r.push(this._animatedBackgroundOpacityStyle);const c=this.props.gradientColors&&!this.state.useHighContrastTheme?n.createElement(a.GradientView,{style:m.innerView,direction:a.GradientDirection.BOTTOM,colors:this.props.gradientColors}):void 0,p=this.props.showAudioParticipantBackground?n.createElement(o.default,null):void 0,S=this.props.hideIcon?void 0:n.createElement(n.View,{style:m.icon},n.createElement(n.Animated.View,{style:[h.default.overflowVisible,this._animatedIconStyle]},t,n.createElement(g.UserIcon,{userMri:this.props.userMri,size:C,forceMediumAvatarSize:!0,useCircleForAgentMask:!0,showBorder:!0}),e));return n.createElement(n.View,{style:i},n.createElement(n.Animated.View,{style:r},c,p),S)}}t.default=S},34501:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(89391),o=i(53143),s=i(52262),r=i(46096),l=i(10117),c=i(15877),d=i(40522),u=i(33754),h=i(81760),p=i(11010),g=i(11828),C=i(59433),m=i(19675),S=i(24576),y=(0,c.lazyProperties)({contentContainer:()=>a.Styles.createButtonStyle({flex:1,flexDirection:"row",alignItems:"center",marginVertical:10}),textContentContainer:()=>a.Styles.createViewStyle({flex:1,alignSelf:"center"}),textContent:()=>a.Styles.createTextStyle({paddingLeft:10,paddingRight:15,flexWrap:"wrap",flex:1}),textContentMobile:()=>a.Styles.createTextStyle({fontSize:p.default.controlFontSize.caption}),container:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"flex-start"}),dismissButtonDesktop:()=>a.Styles.createViewStyle({margin:12}),dismissButtonMobile:()=>a.Styles.createViewStyle({marginTop:10}),translationIconDesktop:()=>a.Styles.createViewStyle({marginLeft:10})});class f extends S.default{constructor(){super(...arguments),this._onPressMusicModeNoticeLearnMore=()=>{d.openUrlWithParams({origin:r.BrowserOrigin.CallPanel,url:n.default.getConfigSettingsNoSubscription().musicMode.learnMoreUrl,rootViewId:this._getRootViewId()})},this._onPressTogetherModeNoticeLearnMore=()=>{d.openUrlWithParams({origin:r.BrowserOrigin.CallPanel,url:n.default.getConfigSettingsNoSubscription().togetherModeNotice.learnMoreUrl,rootViewId:this._getRootViewId()})},this._onPressPstnTranslatorNoticeLearnMore=()=>{d.openUrlWithParams({origin:r.BrowserOrigin.CallPanel,url:n.default.getS4LCMCFeaturesNoSubscription().pstnTranslation.privacyLink,rootViewId:this._getRootViewId()})},this._onDismiss=()=>{this.props.onDismiss&&this.props.onDismiss()}}_buildState(e,t){return{conversationName:s.default.getDisplayName(e.conversationMri)||""}}render(){return a.createElement(a.View,{style:[this.props.containerStyle,y.container]},a.createElement(a.View,{style:y.contentContainer},this._renderTeamsIcon(),this._renderTextContent()),this._renderDismissButton())}_renderTeamsIcon(){var e,t;const i=this._getIconForType();if(i)return a.createElement(l.default,{key:"teamsIcon",style:y.translationIconDesktop,icon:i,color:null!==(e=this.props.iconColor)&&void 0!==e?e:h.Color.white,size:null!==(t=this.props.iconSize)&&void 0!==t?t:g.IconSize.size16})}_getIconForType(){switch(this.props.toastType){case o.ToastType.TogetherModeNotice:return g.SkypeIcon.Audience;case o.ToastType.TeamsInterop:return g.SkypeIcon.MSTeams;case o.ToastType.PstnTranslation:return g.SkypeIcon.Warning;case o.ToastType.MusicModeEnabled:return g.SkypeIcon.PersonVoice}}_renderTextContent(){switch(this.props.toastType){case o.ToastType.TogetherModeNotice:return this._renderTogetherModeNoticeTextContent();case o.ToastType.MusicModeEnabled:return this._renderMusicModeNoticeTextContent();case o.ToastType.TeamsInterop:return this._renderTeamsInteropContent();case o.ToastType.NewCallScreenRevertNotice:return this._renderNewCallScreenRevertNoticeContent();case o.ToastType.PstnTranslation:return this._renderPstnTranslatorContent()}}_renderMusicModeNoticeTextContent(){const e=this._getAudioModeLearnMoreLink();return a.createElement(a.View,{key:"textContentContainer",style:y.textContentContainer},a.createElement(m.BodyText,{style:this._getTextStyles()},u.getParts("MusicModeNoticeBanner.MusicModeNoticeInCallBannerText",{learnMoreLink:e})))}_renderPstnTranslatorContent(){return a.createElement(a.View,{key:"textContentContainer",style:y.textContentContainer},a.createElement(m.BodyText,{style:this._getTextStyles()},u.getString("LanguageAndTranslationSettingsPanel.TranslationBannerText")+" ",a.createElement(C.default,{url:n.default.getS4LCMCFeaturesNoSubscription().pstnTranslation.privacyLink,onPress:this._onPressPstnTranslatorNoticeLearnMore,blue:!0,key:"pstnTranslatorNoticeLearnMoreLink "},u.getString("LanguageAndTranslationSettingsPanel.TranslationBannerMorePrivacyInfoText"))))}_renderTeamsInteropContent(){return a.createElement(a.View,{key:"textContentContainer",style:y.textContentContainer},a.createElement(m.BodyText,{style:this._getTextStyles()},u.getString("TeamsInteropBanner.TeamsInteropInCallBannerText",{userName:this.state.conversationName})))}_renderTogetherModeNoticeTextContent(){const e=this._getTogetherModeLearnMoreLink();return a.createElement(a.View,{key:"textContentContainer",style:y.textContentContainer},a.createElement(m.BodyText,{style:this._getTextStyles()},u.getParts("TogetherModeNoticeBanner.TogetherModeNoticeInCallBannerText",{learnMoreLink:e})))}_renderNewCallScreenRevertNoticeContent(){return a.createElement(a.View,{key:"textContentContainer",style:y.textContentContainer},a.createElement(m.BodyText,{style:this._getTextStyles()},u.getString("NewCallScreenRevertNoticeBanner.NewCallScreenRevertNoticeInCallBannerText")))}_getTogetherModeLearnMoreLink(){return a.createElement(C.default,{url:n.default.getConfigSettingsNoSubscription().togetherModeNotice.learnMoreUrl,onPress:this._onPressTogetherModeNoticeLearnMore,blue:!0,key:"togetherModeNoticeLearnMoreLink "},u.getString("Global.LearnMore"))}_getAudioModeLearnMoreLink(){return a.createElement(C.default,{url:n.default.getConfigSettingsNoSubscription().musicMode.learnMoreUrl,onPress:this._onPressMusicModeNoticeLearnMore,blue:!0,key:"musicModeNoticeLearnMoreLink "},u.getString("Global.LearnMore"))}_renderDismissButton(){var e,t;return a.createElement(l.default,{key:"dismissButton",style:y.dismissButtonDesktop,color:null!==(e=this.props.iconColor)&&void 0!==e?e:h.Color.white,onPress:this._onDismiss,size:null!==(t=this.props.iconSize)&&void 0!==t?t:g.IconSize.size24,icon:g.SkypeIcon.Cancel})}_getTextStyles(){return[this.props.textStyle,y.textContent]}}t.default=f},85043:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HoverPopup=void 0;const a=i(98356),n=i(16778),o=i(62033),s=i(47204),r=i(46096),l=i(36237),c=i(15877),d=i(81760),u=i(24576),h=i(12770),p=i(62038),g=(0,c.lazyProperties)({transparentWrapper:()=>n.Styles.createViewStyle({padding:65})});class C extends u.default{constructor(){super(...arguments),this._isPopupHovered=!1,this._isAnchorHovered=!1,this._isAnchorLongPressed=!1,this._onBack=()=>(this._dismissSticky(),!0),this._dismissSticky=()=>{this.props.isSticky&&s.default.dismissPopup(this.props.popupId,this._getRootViewId()),this._onClosed()},this._showPopup=()=>{h.default.setTimeout((()=>{this._allowShowPopup()&&this.isComponentMounted()&&this.showImmediately()}),1e3)},this._renderPopup=(e,t,i,a)=>n.createElement(p.default,{anchorPosition:e,anchorOffset:t,popupWidth:i,popupHeight:a,fillColor:d.Color.transparent,strokeColor:d.Color.transparent,popupAccessibilityTitle:this.popupDescription(),offset:{x:-5,y:-18},onContentDimensionsChanged:this._reconstructPopup,renderContent:()=>this.renderContent()}),this._reconstructPopup=()=>{this.hideImmediately(),this.showImmediately()},this.showImmediately=()=>{l.log(r.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}].showImmediately, executed`),this.setState({shouldShowPopup:!0},(()=>{if(this._animatedPopupRef&&this._animatedPopupRef.fadeIn(),this.props.isSticky){const e={getAnchor:this.props.anchor,renderPopup:this._renderPopup,rootViewId:this._getRootViewId(),positionPriorities:["top"],onDismiss:this._onClosed,dismissIfShown:!0};s.default.showPopup(e,this.props.popupId)}this._onOpened(this._isAnchorLongPressed)}))},this.hideImmediately=()=>{l.log(r.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}].hideImmediately, executed`),this.setState({shouldShowPopup:!1}),this.props.isSticky?this._dismissSticky():this._onClosed()},this._hidePopup=e=>{l.log(r.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}]._hidePopup, settingTimeout`),h.default.setTimeout((()=>{l.log(r.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}]._hidePopup, shouldFade: ${e}`),this._allowHidePopup()?e?this._animatedPopupRef&&this._animatedPopupRef.fadeOut((e=>{e.finished&&this.isComponentMounted()&&this.hideImmediately()})):this.isComponentMounted()&&this.hideImmediately():l.log(r.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}]._hidePopup, notAllowed`)}),50)},this.onAnchorEnter=()=>{l.log(r.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}].onAnchorEnter`),this._isAnchorHovered=!0,this.props.isSticky||this._showPopup()},this.onAnchorLeave=()=>{l.log(r.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}].onAnchorLeave`),this._isAnchorHovered=!1,this._isAnchorLongPressed=!1,this.props.isSticky||this._hidePopup(!0)},this.onAnchorLongPress=()=>{l.log(r.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}].onAnchorLongPress`),this._isAnchorHovered=!1,this._isAnchorLongPressed=!0,this.props.isSticky?this.showImmediately():this._showPopup()},this.onAnchorPress=()=>{l.log(r.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}].onAnchorPress`),this._isAnchorHovered=!1,this._isAnchorLongPressed=!1,this.props.isSticky?this.hideImmediately():this._hidePopup(!1)},this._defaultAllowShowPopupConditions=()=>(this._isAnchorHovered||this._isAnchorLongPressed)&&!this.state.shouldShowPopup,this._defaultAllowHidePopupConditions=()=>!this._isAnchorHovered&&!this._isAnchorLongPressed&&!this._isPopupHovered&&this.state.shouldShowPopup,this._allowShowPopup=()=>this._defaultAllowShowPopupConditions(),this._allowHidePopup=()=>this._defaultAllowHidePopupConditions(),this._onOpened=e=>{this.onOpened(e),this.props.onOpened&&this.props.onOpened()},this._onClosed=()=>{this.onClosed(),this.props.onClosed&&this.props.onClosed()},this._onPopupEnter=()=>{l.log(r.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}]._onPopupEnter`),this._isPopupHovered=!0},this._onPopupLeave=()=>{l.log(r.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}]._onPopupLeave`),this._isPopupHovered=!1,this.props.isSticky||this._hidePopup(!0)},this._onAnimatedPopupRef=e=>{this._animatedPopupRef=e||void 0}}_buildState(e,t){let i={};return t&&(i.shouldShowPopup=!1),i}render(){return!this.state.shouldShowPopup||this.props.isSticky?null:n.createElement(a.View,{ref:this._onAnimatedPopupRef,style:[g.transparentWrapper,this.props.style],opacity:0,onMouseEnter:this._onPopupEnter,onMouseLeave:this._onPopupLeave},this.renderContent())}componentDidMount(){super.componentDidMount(),this.props.isSticky&&(this._getContext().isPresentedInGenericDesktopModal||o.default.subscribe(this._onBack))}componentWillUnmount(){super.componentWillUnmount(),o.default.unsubscribe(this._onBack)}}t.HoverPopup=C},20279:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PstnTranslatorPanelPosition=void 0;const a=i(96486),n=i(16778),o=i(89391),s=i(94224),r=i(2278),l=i(71830),c=i(77381),d=i(24490),u=i(57139),h=i(37490),p=i(46096),g=i(10117),C=i(38891),m=i(5581),S=i(36237),y=i(58666),f=i(15877),_=i(33754),b=i(46929),T=i(30124),v=i(50845),w=(i(16610),i(36150)),I=i(93194),P=i(81760),M=i(11828),k=i(19675),A=i(12770),R=i(63841),V=i(53374);var L;!function(e){e[e.Header=0]="Header",e[e.Footer=1]="Footer"}(L=t.PstnTranslatorPanelPosition||(t.PstnTranslatorPanelPosition={}));const E=P.Color.gray400,B=(0,f.lazyProperties)({translateButtonContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",alignSelf:"center",backgroundColor:P.Color.gray400,borderRadius:5,minHeight:40,paddingHorizontal:20,paddingVertical:5,opacity:1}),statusText:()=>n.Styles.createTextStyle({color:P.Color.white}),isTranslatingStatusText:()=>n.Styles.createTextStyle({color:P.Color.white,fontWeight:"100",textAlign:"center",textAlignVertical:"center",flexGrow:1}),container:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",alignSelf:"center",marginBottom:30}),containerDesktop:()=>n.Styles.createViewStyle({position:"absolute",flexDirection:"row",alignItems:"center",justifyContent:"center",alignSelf:"center"}),settingsContainer:()=>n.Styles.createViewStyle({flexDirection:"column",alignItems:"center",justifyContent:"center",alignSelf:"center",backgroundColor:P.Color.gray400,borderRadius:5,paddingTop:10,paddingBottom:10,paddingLeft:15,paddingRight:15,marginLeft:5,marginRight:5,width:120}),pauseContainer:()=>n.Styles.createViewStyle({flexDirection:"column",alignItems:"center",justifyContent:"center",alignSelf:"center",backgroundColor:P.Color.gray400,borderRadius:6,paddingTop:10,paddingBottom:10,paddingLeft:15,paddingRight:15,marginLeft:5,marginRight:5,width:120}),containerBgLight:()=>n.Styles.createViewStyle({backgroundColor:P.Color.whiteOverlay80}),containerBgBlack:()=>n.Styles.createViewStyle({backgroundColor:P.Color.callStageDark}),iconPadding:()=>n.Styles.createViewStyle({paddingRight:10}),isTranslatingIconPadding:()=>n.Styles.createViewStyle({marginBottom:5}),onlyLanguageBarContainer:()=>n.Styles.createViewStyle({flexDirection:"row",left:0,paddingLeft:10,paddingRight:10,marginTop:15}),lightFontColor:()=>n.Styles.createTextStyle({color:E}),settingsFontSizeDesktop:()=>n.Styles.createTextStyle({fontSize:16}),menuPadding:()=>n.Styles.createViewStyle({paddingLeft:16,paddingRight:16}),anchor:()=>n.Styles.createViewStyle({position:"absolute",bottom:0,left:0,right:0,height:0})});class O extends c.default{constructor(){super(...arguments),this._onMobileAnchorRef=e=>{this._mobileAnchorRef=e||void 0},this._onDesktopAnchorRef=e=>{this._desktopAnchorRef=e||void 0},this._pressPause=()=>{const e=V.default.newCauseId();S.log(p.LogTraceArea.CallingUI,`_togglePstnTranslationPause causeId: ${e}`),this.state.isPaused?s.default.InCallBotService.setPstnTranslationPause(this.props.callId,!1,e).then((()=>{this.setState({isPaused:!1})})):s.default.InCallBotService.setPstnTranslationPause(this.props.callId,!0,e).then((()=>{this.setState({isPaused:!0})}))},this._pressTranslateButton=()=>{const e=V.default.newCauseId();r.default.onStartPstnTranslationClicked(this.props.callId,e),this._canTranslateNow()?this._startTranslateCall(!1):(s.default.InCallBotService.preheatTranslator(this.props.callId,e),this._toggleSettingsMenu())},this._toggleSettingsMenu=()=>{const e=V.default.newCauseId();S.log(p.LogTraceArea.CallingUI,`_togglePstnTranslationMobileOverflowMenu causeId: ${e}`),A.default.clearTimeout(this._hideMenuTimeout);const t=this._getRootViewId(),i=()=>{S.log(p.LogTraceArea.CallingUI,"onCloseMenu using X in header. causeId: "+e),A.default.clearTimeout(this._hideMenuTimeout),u.default.close(t,e)},a=()=>this._desktopAnchorRef,o={callId:this.props.callId,conversationMri:this.state.conversationMri||this.props.conversationMri,isPSTNCall:this.props.isPstnCall,isEncryptedCall:!1,callerContext:()=>this._getContext(),callUIState:this.props.callUIState},s=this.props.useLightTheme?R.Theme.Delphi:R.Theme.DelphiDark,r=n.createElement(v.default,Object.assign({colorThemeOverride:s,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,translateCall:this._startTranslationAndHideSettings,changeVoice:this._changeVoice,changeLanguage:this._changeLanguage,flipLanguages:this._flipLanguages,closeMenu:i,style:B.menuPadding},o)),l=()=>_.getString("LanguageAndTranslationSettingsPanel.CallTranslationSettingsTitle"),c=v.default.menuHeight();u.default.showWithContent({menuId:u.default.menuId(),anchor:a,rootViewId:t,menuHeight:c,menuWidth:450,content:r,useBlurredBackground:!1,colorThemeOverride:s,borderRadius:8,headerConfig:{headerType:d.HeaderType.Default,rightButton:{icon:M.SkypeIcon.Cancel,onPress:e=>{i()}}},staticContent:!0,useTransparentShim:!0,hidePopupArrow:!0,useDesktopPopup:!this.state.isUsingStackNavigationContext&&!this.state.isMobileScreenReaderEnabled,getTitle:l,onCloseMenu:e=>{S.log(p.LogTraceArea.CallingUI,"onCloseMenu causeId: "+e),u.default.close(t,e)}},e),h.dismissAll()},this._hideTranslationSettingsMenu=()=>{u.default.closeIfNeeded(this._getRootViewId(),V.default.newCauseId())},this._startTranslationAndHideSettings=()=>{this._startTranslateCall(this.state.settings.hideSettingsOnTranslationStart)},this._startTranslateCall=e=>{const t=V.default.newCauseId();this._canTranslateNow()?this.state.isTranslating?(S.log(p.LogTraceArea.CallingUI,`_togglePstnTranslationTranslateCall stopPstnTranslation causeId: ${t}`),s.default.InCallBotService.stopPstnTranslation(this.props.callId,t).then((()=>{this.setState({isPaused:!1})}))):(S.log(p.LogTraceArea.CallingUI,`_togglePstnTranslationTranslateCall startPstnTranslation causeId: ${t}`),s.default.InCallBotService.startPstnTranslation(this.props.callId,t).then((()=>{this.setState({isPaused:!1}),e&&(A.default.clearTimeout(this._hideMenuTimeout),this._hideMenuTimeout=A.default.setTimeout((()=>this._hideTranslationSettingsMenu()),this.state.settings.translationSettingsHideTimeout))}))):S.log(p.LogTraceArea.CallingUI,`_togglePstnTranslationTranslateCall pressed but info missing. causeId: ${t}`)},this._flipLanguages=()=>{const e=V.default.newCauseId();S.log(p.LogTraceArea.CallingUI,`PstnTranslatorCallControlsCustomActionMenu.Button Flip languages pressed causeId: ${e}`);const t=this.state.conversationMri||this.props.conversationMri;m.default.switchPstnCallTranlatorBotSpokenLanguageLocales(t),this._updateTranslationSettings(e)},this._changeVoice=()=>{const e=V.default.newCauseId();S.log(p.LogTraceArea.CallingUI,`_togglePstnTranslationChangeVoice causeId: ${e}`),this._toggleVoiceMenu()},this._toggleVoiceMenu=()=>{const e=V.default.newCauseId();S.log(p.LogTraceArea.CallingUI,`_togglePstnTranslationVoiceMenu causeId: ${e}`);let t=_.getString("LanguageAndTranslationSettingsPanel.TranslationSelectVoiceTitle");const i=[{command:C.Gender.female,text:C.Gender.female},{command:C.Gender.male,text:C.Gender.male}],a=this._getRootViewId(),n={anchor:()=>{},buttons:i,title:t};I.default.showWithActionMenuConfig({options:n,callback:t=>this._actuallyChangeVoice(t,e),onCancel:()=>this._maybeToggleSettingsMenu(),maintainAnchor:!1,rootViewId:a,useAlertForMobile:!0,useAlertForDesktop:this._useAlertForDesktop(),invokingEvent:void 0,allowScrolling:this._useAlertForDesktop()})},this._actuallyChangeVoice=(e,t)=>{e!==C.Gender.female&&e!==C.Gender.male?S.log(p.LogTraceArea.CallingUI,`_togglePstnTranslationVoiceMenu newVoice ${e} not in supported voices list. causeId: ${t}`):(b.default.setCallTranslatorBotTranslationVoice(e),this.setState({translationVoice:e},(()=>{this._updateTranslationSettings(t)}))),this._maybeToggleSettingsMenu()},this._changeLanguage=e=>{const t=V.default.newCauseId();S.log(p.LogTraceArea.CallingUI,`PstnTranslatorCallControlsCustomActionMenu.Button Change my language pressed causeId: ${t}`),this._toggleLanguageMenu(e)},this._toggleLanguageMenu=e=>{const t=V.default.newCauseId();S.log(p.LogTraceArea.CallingUI,`_togglePstnTranslationLanguageMenu causeId: ${t}`);let i=_.getString("LanguageAndTranslationSettingsPanel.TranslationSelectLocalLanguageTitle");e||(i=_.getString("LanguageAndTranslationSettingsPanel.TranslationSelectOtherLanguageTitle"));const n=[],s=o.default.getS4LCMCFeaturesNoSubscription().callTranslatorBotConfig.languageSupport.speech,r=_.getLanguageFromLocale(),l=[...s].sort(((e,t)=>{const i=this._getLanguageNameFromLocale(e),a=this._getLanguageNameFromLocale(t);return i.localeCompare(a,r)}));a.each(l,(e=>{n.push({text:this._getLanguageNameFromLocale(e),command:e})}));const c=this._getRootViewId(),d={anchor:()=>{},buttons:n,title:i};I.default.showWithActionMenuConfig({options:d,callback:i=>this._actuallyChangeLanguage(e,i,t),onCancel:()=>this._maybeToggleSettingsMenu(),maintainAnchor:!1,rootViewId:c,useAlertForMobile:!0,useAlertForDesktop:this._useAlertForDesktop(),invokingEvent:void 0,allowScrolling:this._useAlertForDesktop()})},this._actuallyChangeLanguage=(e,t,i)=>{const n=o.default.getS4LCMCFeaturesNoSubscription().callTranslatorBotConfig.languageSupport.speech;if(a.includes(n,t)){let a={};const n=this.state.conversationMri||this.props.conversationMri;let o;e?(o=m.default.getLocalPstnCallTranlatorBotSpokenLanguageLocale(n),m.default.setLocalPstnCallTranlatorBotSpokenLanguageLocale(n,t),a={localLanguageLocale:t}):(o=m.default.getOtherPstnCallTranlatorBotSpokenLanguageLocale(n),m.default.setOtherPstnCallTranlatorBotSpokenLanguageLocale(n,t),a={otherLanguageLocale:t});const l=s.default.InCallBotService.getPstnTranslationSessionId(this.props.callId);r.default.onPstnTranslationLanguageChange(this.props.callId,l,e,null!=o?o:"",t,i),this.setState(a,(()=>{this._updateTranslationSettings(i)}))}else S.log(p.LogTraceArea.CallingUI,`_togglePstnTranslationLanguageMenu newLocale ${t} not in supported langs list. causeId: ${i}`);this._maybeToggleSettingsMenu()}}_buildState(e,t){return{settings:o.default.getS4LCMCFeatures().pstnTranslation,conversationMri:s.default.CallingStore.getCallConversationMri(e.callId),isTranslating:s.default.InCallBotService.isPstnTranslationEnabled(e.callId),translationVoice:b.default.getCallTranslatorBotTranslationVoice(),isUsingStackNavigationContext:T.default.isUsingStackNavigationContext(),isMobileScreenReaderEnabled:w.default.isMobileScreenReaderEnabled(),localLanguageLocale:m.default.getLocalPstnCallTranlatorBotSpokenLanguageLocale(e.conversationMri),otherLanguageLocale:m.default.getOtherPstnCallTranlatorBotSpokenLanguageLocale(e.conversationMri),callParticipantCount:s.default.CallingStore.connectedParticipantsCount(e.callId),isCaptioning:s.default.InCallBotService.isCaptioningEnabled(e.callId),isVoiceTranslating:s.default.InCallBotService.isVoiceTranslationEnabled(e.callId)}}componentDidMount(){if(super.componentDidMount(),!this.state.localLanguageLocale&&this._isEnabled()){const e=m.default.getLocalCallTranslatorBotSpokenLanguageLocale();if(e){const t=V.default.newCauseId();this._actuallyChangeLanguage(!0,e,t)}}}componentWillUnmount(){super.componentWillUnmount(),A.default.clearTimeout(this._hideMenuTimeout)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i)}_canTranslateNow(){return this.state.translationVoice&&this.state.localLanguageLocale&&this.state.otherLanguageLocale}_updateTranslationSettings(e){this.state.isTranslating&&!this.state.isPaused?(S.log(p.LogTraceArea.CallingUI,"_updatePstnTranslationSettings requesting update of translation settings"),s.default.InCallBotService.startPstnTranslation(this.props.callId,e)):!this.state.isTranslating&&this._canTranslateNow()&&this._startTranslationAndHideSettings()}_getLanguageNameFromLocale(e){const t=y.getShortLanguageTitle(e);return a.isEmpty(t)?e:t}_maybeToggleSettingsMenu(){this._useAlertForDesktop()&&this._toggleSettingsMenu()}_isEnabled(){return this.state.settings.enabled&&!this.state.isCaptioning&&!this.state.isVoiceTranslating&&this.state.conversationMri&&l.isPhoneMri(this.state.conversationMri)&&1===this.state.callParticipantCount}_getBgColorStyle(){return this.props.callStageV2&&this.props.useLightTheme?B.containerBgLight:B.containerBgBlack}_useAlertForDesktop(){return!0}render(){var e,t;if(!this._isEnabled())return null;n.Styles.createViewStyle({marginBottom:null!==(e=this.props.marginBottom)&&void 0!==e?e:30},!1);const i=n.Styles.createViewStyle({bottom:null!==(t=this.props.marginBottom)&&void 0!==t?t:110},!1),a=n.createElement(n.View,{style:B.anchor,ref:this._onDesktopAnchorRef});if(this.props.panelPosition===L.Footer&&this.state.isTranslating){const e=this.state.isPaused?_.getString("LanguageAndTranslationSettingsPanel.TranslationResume"):_.getString("LanguageAndTranslationSettingsPanel.TranslationPause"),t=this.state.isPaused?M.SkypeIcon.PauseOffCircle:M.SkypeIcon.PauseCircle,o=[B.containerDesktop,i],s=this.props.useLightTheme?P.Color.gray300:P.Color.white,r=M.IconSize.size20,l=this.props.useLightTheme?B.lightFontColor:void 0,c=B.settingsFontSizeDesktop,d=[B.isTranslatingStatusText,l,c];return n.createElement(n.View,{ref:this._onMobileAnchorRef,style:o},n.createElement(n.Button,{style:[B.settingsContainer,this._getBgColorStyle()],onPress:this._toggleSettingsMenu,accessibilityTraits:n.Types.AccessibilityTrait.Button,accessibilityLabel:_.getString("LanguageAndTranslationSettingsPanel.TranslationSettings"),importantForAccessibility:n.Types.ImportantForAccessibility.Auto},n.createElement(g.default,{icon:M.SkypeIcon.SkypeTranslator,size:r,color:s,style:B.isTranslatingIconPadding}),n.createElement(k.Caption,{style:d,numberOfLines:2},_.getString("LanguageAndTranslationSettingsPanel.TranslationSettings"))),n.createElement(n.Button,{style:[B.pauseContainer,this._getBgColorStyle()],onPress:this._pressPause,accessibilityTraits:n.Types.AccessibilityTrait.Button,accessibilityLabel:e,importantForAccessibility:n.Types.ImportantForAccessibility.Auto},n.createElement(g.default,{icon:t,size:r,color:s,style:B.isTranslatingIconPadding}),n.createElement(k.Caption,{style:d,numberOfLines:2},e)),a)}if(this.props.panelPosition===L.Footer){const e=[B.containerDesktop,i],t=this.props.useLightTheme?P.Color.gray300:P.Color.white,o=this.props.useLightTheme?B.lightFontColor:void 0,s=[B.statusText,o];return n.createElement(n.View,{ref:this._onMobileAnchorRef,style:e},n.createElement(n.Button,{style:[B.translateButtonContainer,this._getBgColorStyle()],onPress:this._pressTranslateButton,accessibilityTraits:n.Types.AccessibilityTrait.Button,accessibilityLabel:_.getString("LanguageAndTranslationSettingsPanel.TranslateThisCall"),importantForAccessibility:n.Types.ImportantForAccessibility.Auto},n.createElement(g.default,{icon:M.SkypeIcon.SkypeTranslator,size:M.IconSize.size15,color:t,style:B.iconPadding}),n.createElement(k.BodyText,{style:s},_.getString("LanguageAndTranslationSettingsPanel.TranslateThisCall"))),a)}return null}}t.default=O},58722:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(10117),o=i(15877),s=i(86045),r=i(81760),l=i(11828),c=i(19675),d=i(24576),u=(0,o.lazyProperties)({container:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",alignSelf:"center",backgroundColor:r.Color.white,minHeight:40,borderRadius:20,marginBottom:20,paddingHorizontal:20,paddingVertical:5,marginTop:-55}),statusText:()=>a.Styles.createTextStyle({color:r.Color.gray300}),statusTextAccessible:()=>a.Styles.createTextStyle({color:r.Color.gray400}),iconPadding:()=>a.Styles.createViewStyle({paddingRight:10}),iconPaddingRTL:()=>a.Styles.createViewStyle({paddingLeft:10}),warningAnimatedView:()=>a.Styles.createViewStyle({overflow:"visible",height:0})});class h extends d.default{constructor(){super(...arguments),this._warningViewAnimatedOpacityValue=new a.Animated.Value(1),this._warningViewAnimatedOpacityStyle=a.Styles.createAnimatedViewStyle({opacity:this._warningViewAnimatedOpacityValue})}componentDidMount(){super.componentDidMount(),s.default.maybeAnnounceForAccessibility(this.props.viewInformation.warningText)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),e.viewInformation.warningText!==this.props.viewInformation.warningText&&s.default.maybeAnnounceForAccessibility(this.props.viewInformation.warningText)}showOrHideWarningView(e,t=!0,i=0){if(this.isComponentMounted()){const n=e?1:0;t?a.Animated.timing(this._warningViewAnimatedOpacityValue,{toValue:n,duration:200,delay:i,easing:a.Animated.Easing.Out()}).start():this._warningViewAnimatedOpacityValue.setValue(n)}}render(){const e=[u.container];this.props.viewInformation.opacityStyle&&e.push(this.props.viewInformation.opacityStyle);const t=this.props.viewInformation.icon?this._getWarningIcon(this.props.viewInformation.icon):void 0,i=this.props.viewInformation.warningText?this._getWarningText(this.props.viewInformation.warningText):void 0;return a.createElement(a.Animated.View,{style:[this._warningViewAnimatedOpacityStyle,u.warningAnimatedView],blockPointerEvents:!0,ignorePointerEvents:!0},a.createElement(a.Animated.View,{style:e},t,i))}_getWarningText(e){return a.createElement(c.BodyText,{style:this._useAccessibleTheme()?u.statusTextAccessible:u.statusText},e)}_getWarningIcon(e){return a.createElement(n.default,{icon:e,size:l.IconSize.size15,color:this.props.viewInformation.optionalIconColor||r.Color.gray300,style:this._getContext().isRTL?u.iconPaddingRTL:u.iconPadding})}}t.default=h},40138:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageConversationCommand=t.MergeIncomingCallCommand=t.AcceptIncomingCallCommand=t.RejectIncomingCallCommand=void 0;const a=i(94224),n=i(51077),o=i(71830),s=i(46096),r=i(11375),l=i(23944),c=i(36237),d=i(78735),u=i(85207),h=i(40363),p=i(53374);t.RejectIncomingCallCommand=class{constructor(e,t){this._callId=e,this._setFocusAfterReject=t}execute(){const e=p.default.newCauseId();c.log(s.LogTraceArea.CallingUI,`RejectIncomingCallCommand callId: ${this._callId} causeId: ${e}`),a.default.CallingStore.rejectCall(this._callId,e),this._setFocusAfterReject&&r.setFocus(r.FocusEvent.DeclineCallFromCallBanner)}};t.AcceptIncomingCallCommand=class{constructor(e,t,i){this._callId=e,this._callInfo=t,this._skipNavigation=i,this._executed=!1}execute(e=!1){if(this._executed)return void c.warn(s.LogTraceArea.CallingUI,`Tried to execute AcceptIncomingCallCommand multiple times. withVideo:${e}; callId: ${this._callId}`);this._executed=!0;const t=p.default.newCauseId();c.log(s.LogTraceArea.CallingUI,`AcceptIncomingCallCommand withVideo:${e}; callId: ${this._callId}; causeId: ${t}`);const i=!h.default.isWindows10Plus();a.default.CallNavigationHelper.answerOrJoinCall({conversationMri:this._callInfo.conversationMri,callId:this._callId,withVideo:e,skipNavigation:this._skipNavigation,knownToBeAnswer:i,origin:s.NavigationCallOrigin.CallControls},t)}canExecuteWithVideo(){return a.default.CallingFeaturesHelper.allowOutboundVideo(this._callInfo)}};t.MergeIncomingCallCommand=class{constructor(e){this._callId=e}execute(){const e=p.default.newCauseId();c.log(s.LogTraceArea.CallingUI,`MergeIncomingCallCommand callId: ${this._callId}; causeId: ${e}`),a.default.CallingStore.mergeCall(this._callId,e)}};t.MessageConversationCommand=class{constructor(e){this._conversationMri=e}execute(e,t){const i=d.default.getValueOfDoNotFormatPreferenceOrFalseIfDisabled(this._conversationMri),a=o.isConversationWithPhoneNumber(this._conversationMri),s=i&&!a,r=a;u.default.postMessageFromInput(this._conversationMri,t,l.convertRawTextToInputEntities(e,s,r),n.MessageTypes.RichText)}}},3989:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(16778),o=i(4736),s=i(60787),r=i(9520),l=i(71727),c=i(81760),d=i(52262),u=i(89667),h=i(46096),p=i(40138),g=i(80640),C=i(72490),m=i(15877),S=i(33754),y=i(11828),f=(0,m.lazyProperties)({buttonRow:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",overflow:"visible"}),buttonRowReversed:()=>n.Styles.createViewStyle({flexDirection:"row-reverse"}),buttonSpacing:()=>n.Styles.createViewStyle({marginHorizontal:6})}),_={key:"green-gradient",colors:(0,u.getButtonsAgnosticGradientFillColor)(c.AgnosticGradientFillButtonColors.green)},b=S.getString("CallControls.CallButtonDeclineLabel");class T extends g.IncomingRingControlsBase{constructor(e){super(r.CallControlContext.IncomingRingControls,e),this._onAnswerCallKeyboardShortcut=()=>(this._answerCommand.execute(),!0),this._onRejectCallKeyboardShortcut=()=>(this._rejectCommand.execute(),!0),this._onRejectCall=()=>{this._rejectCommand.execute()},this._onAnswerCallWithVideo=()=>{this.props.onPress&&this.props.onPress(),this._answerCommand.execute(!0)},this._onAnswerCall=()=>{this.props.onPress&&this.props.onPress(),this._answerCommand.execute()},this._onMergeCall=()=>{this.props.onPress&&this.props.onPress();new p.MergeIncomingCallCommand(this.props.callId).execute()}}_buildState(e,t){return this._initializeCommands(e,e.forMobile),{conversationName:d.default.getDisplayName(e.conversationMri)||S.getString("Notifications.UnknownUserShort"),useHighContrastTheme:l.default.useHighContrastThemeAndChanges(),allowVideoButton:this._answerCommand.canExecuteWithVideo()}}componentDidMount(){super.componentDidMount(),this._registerKeyboardHandlers()}componentWillUnmount(){super.componentWillUnmount(),this._unregisterKeyboardHandlers()}_buttonSize(){return a.isUndefined(this.props.buttonSize)?s.CallButtonSize.Large:this.props.buttonSize}_registerKeyboardHandlers(){C.default.addHandler(h.KeyboardShortcut.AcceptIncomingCall,this._onAnswerCallKeyboardShortcut),C.default.addHandler(h.KeyboardShortcut.HangupOrRejectCall,this._onRejectCallKeyboardShortcut)}_unregisterKeyboardHandlers(){C.default.removeHandler(h.KeyboardShortcut.AcceptIncomingCall,this._onAnswerCallKeyboardShortcut),C.default.removeHandler(h.KeyboardShortcut.HangupOrRejectCall,this._onRejectCallKeyboardShortcut)}_colorConfig(){return this.state.useHighContrastTheme?l.default.highContrastColorConfig(this._themeColors):void 0}render(){const e=this._buttonSize(),t=this._colorConfig(),i=this.props.hasSmallerSpacing?s.CallButtonSpacing.Small:s.CallButtonSpacing.Default;let a,r;if(this.props.showMergeButton){const o=this.props.isMergePossible?S.getString("CallControls.CallButtonMergeLabel",{conversationName:this.state.conversationName}):S.getString("CallControls.CallButtonMergeDisabledLabel");a=n.createElement(s.CallButton,{icon:y.SkypeIcon.CallMerge,isToggledOn:!1,title:o,onPress:this._onMergeCall,isCallMergeButton:!0,size:e,accessibilityLabel:o,colorConfig:t,spacing:i,isDisabled:!this.props.isMergePossible})}if(this.state.allowVideoButton){const e=S.getString("CallControls.CallButtonVideoLabel",{conversationName:this.state.conversationName});r=n.createElement(o.default,{icon:y.SkypeIcon.Video,title:e,onPress:this._onAnswerCallWithVideo,size:o.ActionButtonSize.Small,accessibilityLabel:e,userColor:_,style:f.buttonSpacing})}const l=S.getString("CallControls.CallButtonAudioLabel",{conversationName:this.state.conversationName});return n.createElement(n.View,{style:[f.buttonRow,void 0,this.props.style]},a,r,n.createElement(o.default,{ref:this._onAnswerCallButtonRef,icon:y.SkypeIcon.CallStart,title:l,onPress:this._onAnswerCall,size:o.ActionButtonSize.Small,accessibilityLabel:l,userColor:_,style:f.buttonSpacing,autoFocus:!0}),n.createElement(o.default,{icon:y.SkypeIcon.CallEnd,title:b,onPress:this._onRejectCall,size:o.ActionButtonSize.Small,accessibilityLabel:b,backgroundColor:c.Color.red,style:f.buttonSpacing}))}}t.default=T},80640:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IncomingRingControlsBase=void 0;const a=i(96486),n=i(63297),o=i(94224),s=i(9520),r=i(46096),l=i(40138),c=i(36237),d=i(24576);class u extends d.default{constructor(e,t){super(t),this._instrumentationContext=e,this._mediaActionEvent=e=>{if(o.default.CallingStore.isCallIncoming(this.props.callId)){c.track(new s.MediaActionEvent(this._instrumentationContext,s.MediaActionEventResult.AnswerCall));const t=o.default.CallingStore.incomingCallHasVideo(this.props.callId);c.log(r.LogTraceArea.CallingUI,`${this._instrumentationContext}._mediaActionEvent answering call (video: ${t}); causeId: ${e}`),t&&this._answerCommand.canExecuteWithVideo()?this._answerCommand.execute(!0):this._answerCommand.execute()}else c.track(new s.MediaActionEvent(this._instrumentationContext,s.MediaActionEventResult.Ignore)),c.log(r.LogTraceArea.CallingUI,`${this._instrumentationContext}._mediaActionEvent no action; causeId: ${e}`)},this._onAnswerCallButtonRef=e=>{this._answerCallButton=e||void 0}}_initializeCommands(e,t){this._forMobile=t,this._rejectCommand=new l.RejectIncomingCallCommand(e.callId,!t),this._answerCommand=new l.AcceptIncomingCallCommand(e.callId,e,t)}componentDidMount(){super.componentDidMount(),this._forMobile&&a.delay((()=>{this.isComponentMounted()&&this._answerCallButton&&this._answerCallButton.requestFocus()}),100),this._mediaActionEventSub=n.default.mediaActionEvent.subscribe(this._mediaActionEvent),n.default.maybeEndCallFromAndroidBtScoDisconnectEvent&&(this._maybeEndCallFromAndroidBtScoDisconnectSub=n.default.maybeEndCallFromAndroidBtScoDisconnectEvent.subscribe((()=>{c.track(new s.MaybeEndCallFromAndroidBtScoDisconnectEvent(this._instrumentationContext))})))}componentWillUnmount(){super.componentWillUnmount(),this._mediaActionEventSub&&(this._mediaActionEventSub.unsubscribe(),this._mediaActionEventSub=void 0),this._maybeEndCallFromAndroidBtScoDisconnectSub&&(this._maybeEndCallFromAndroidBtScoDisconnectSub.unsubscribe(),this._maybeEndCallFromAndroidBtScoDisconnectSub=void 0)}}t.IncomingRingControlsBase=u},46767:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(88837),o=i(94224),s=i(46096),r=i(36237),l=i(33754),c=i(19675),d=i(53374);class u extends n.ComponentBase{constructor(){super(...arguments),this._onStopPress=e=>{const t=d.default.newCauseId();r.log(s.LogTraceArea.CallingUI,"StackNavAudioOnlyToast disable audio only clicked. causeId:"+t),o.default.CallingStore.enableIncomingVideo(this.props.callId,t)}}componentDidMount(){super.componentDidMount(),a.Accessibility.announceForAccessibility(l.getString("CallControlsOverFlowMenu.AllowIncomingVideoStartStateAnnouncement"))}componentWillUnmount(){super.componentWillUnmount(),a.Accessibility.announceForAccessibility(l.getString("CallControlsOverFlowMenu.AllowIncomingVideoStopStateAnnouncement"))}render(){return a.createElement(a.View,{style:this.props.containerStyle},a.createElement(c.BodyText,{bold:!0,style:this.props.textStyle,numberOfLines:1},l.getString("IncomingVideoDisabledToast.BannerTitle")),a.createElement(a.Button,{onPress:this._onStopPress},a.createElement(c.BodyText,{style:this.props.linkStyle},l.getString("IncomingVideoDisabledToast.ResumeLinkText"))))}}t.default=u},17287:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(88837),o=i(60289),s=i(11009),r=i(18330),l=i(15877),c=i(16582),d=i(81760),u=i(79669),h=i(15362),p=(0,l.lazyProperties)({unhandledBubbleContainer:()=>a.Styles.createViewStyle({backgroundColor:d.Color.white,borderRadius:10,paddingVertical:5})});class g extends n.ComponentBase{constructor(){super(...arguments),this._animationConfig={presentOffset:{x:200,y:15},dismissOffset:{x:200,y:15},duration:350,easing:a.Animated.Easing.OutBack()},this.updateAnchorInfo=e=>{const t=e||this.props.getAnchorInfo(this.props.creatorKey);this._popupView&&t&&this._popupView.updatePosition(t)},this._onPopupViewRef=e=>{this._popupView=e||void 0},this._getAnchorInfo=()=>this.props.getAnchorInfo(this.props.creatorKey),this._getPopUpPositions=e=>[s.PopupAnchorPositon.Bottom],this._getAnimationDirection=e=>e?this.props.alignRight?s.PopupAnchorPositon.Right:s.PopupAnchorPositon.Left:s.PopupAnchorPositon.Bottom,this._renderPopupContent=(e,t,i,n,s)=>{const l=this.props.callParticipantReaction.reaction,c=a.createElement(h.default,{key:"reaction"+l.cuid,id:l.cuid,mri:l.creator,content:this.props.callParticipantReaction.content,reaction:this.props.callParticipantReaction.reaction,gradientColors:this.props.callParticipantReaction.gradientColors,textTimeoutMs:o.default.getTextTimeoutBasedOnContent(l.content),hideBackground:!0,hideUserIcon:!s,style:s?p.unhandledBubbleContainer:void 0,onPress:this.props.onReactionTap?this._onPress:void 0});return s?c:a.createElement(u.default,{anchorPosition:r.default.popupAnchorPositionToString(e),anchorOffset:t,popupWidth:i,popupHeight:n,borderRadius:10,strokeColor:d.Color.white,fillColor:d.Color.white,shadow:"0px 2px 4px rgba(0, 0, 0, 0.25)",skipPopupAutoFocus:!0},c)},this._onPress=()=>{this.dismiss(!1),this.props.onReactionTap&&this.props.onReactionTap()}}componentDidMount(){super.componentDidMount(),this.props.callParticipantReaction&&this.updateAnchorInfo(),this._rectChangeSubscriptionToken=this.props.getAnchorRectChanges(this.props.creatorKey,this.updateAnchorInfo)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.props.callParticipantReaction&&this.updateAnchorInfo()}componentWillUnmount(){super.componentWillUnmount(),this._rectChangeSubscriptionToken&&(this._rectChangeSubscriptionToken.unsubscribe(),this._rectChangeSubscriptionToken=void 0)}dismiss(e=!1){this._popupView&&this._popupView.dismiss(e)}render(){if(!this.props.callParticipantReaction)return null;const e=this.props.callParticipantReaction;return a.createElement(c.default,{key:"reaction"+this.props.callParticipantReaction.reaction.cuid,ref:this._onPopupViewRef,animateDismissal:!0,animationConfig:this._animationConfig,getAnchorInfo:this._getAnchorInfo,getPopupPositions:this._getPopUpPositions,getAnimationDirection:this._getAnimationDirection,renderPopup:this._renderPopupContent,timeoutMs:5e3,allowTaps:!0,onDismissPopup:()=>{this.props.onRemoveReaction&&this.props.onRemoveReaction(e)}})}}t.default=g},3573:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(74958),n=i(96486),o=i(16778),s=i(88837),r=i(78968),l=i(80200),c=i(46096),d=i(17287),u=i(36237),h=i(15877),p=i(6250),g=i(18078),C=i(33004),m=(0,h.lazyProperties)({container:()=>o.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"visible"})});class S extends s.ComponentBase{constructor(){super(...arguments),this._mountedRefsMap=new p.default,this.showMessage=e=>{u.log(c.LogTraceArea.CallReactions,"InlineCallStageReactionsView.showMessage cuid: "+e.reaction.cuid);const t=this.state.callParticipantReactions,i=e.reaction.creator,a=g.default.isMyMri(i)?l.CallStageElementKeys.localUserKey:i;t[a]=e,n.each(n.keys(t),(e=>{if(e!==a){const t=this._mountedRefsMap.ref(e);t&&t.dismiss()}}));const o=this.state.sequence+1;return this.setState({callParticipantReactions:t,sequence:o}),!0},this.dismissReaction=e=>{u.log(c.LogTraceArea.CallReactions,"InlineCallStageReactionsView.dismissReaction, key: "+a.pii.Omit(e));const t=this.state.callParticipantReactions;if(t[e]){delete t[e];const i=this.state.sequence+1;this.setState({callParticipantReactions:t,sequence:i})}},this._onAnimationEnd=e=>{if(this.isComponentMounted()){const t=e.reaction.creator,i=g.default.isMyMri(t)?l.CallStageElementKeys.localUserKey:t,a=e.reaction.cuid,n=this.state.callParticipantReactions;if(n[i]&&n[i].reaction.cuid===a){delete n[i];const e=this.state.sequence+1;this.setState({callParticipantReactions:n,sequence:e})}}},this._getAnchorInfo=e=>this.props.getAnchorInfo(e)||{rect:{x:this.props.alignRight?this.props.parentDimensions.width:0,y:20,height:this.props.topOffsetForUnhandledReactions,width:this.props.topOffsetForUnhandledReactions/2},hidden:!0}}_buildState(e,t){const i=t?Date.now():this.state.reactionsCutoff,a=r.default.getLastReaction(e.reactionsConversationMri,i);let n={lastReactionInfo:a&&C.default.callReactionInfoForReaction(a),reactionsCutoff:i};return t&&(n.callParticipantReactions={},n.sequence=0),n}componentDidMount(){super.componentDidMount();const e=this.props.getCallReactionsDisplayHelper();e.registerUnhandledReactionCallback(this.showMessage),e.registerUnhandledReactionDismissCallback(this.dismissReaction)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=t.lastReactionInfo?t.lastReactionInfo.reaction.cuid:void 0,n=this.state.lastReactionInfo?this.state.lastReactionInfo.reaction.cuid:void 0;this.state.lastReactionInfo&&a!==n&&this.props.getCallReactionsDisplayHelper().showReaction(this.state.lastReactionInfo)}componentWillUnmount(){super.componentWillUnmount(),this.props.getCallReactionsDisplayHelper().unregisterUnhandledReactionCallback(),this.props.getCallReactionsDisplayHelper().unregisterUnhandledReactionDismissCallback()}updateElementDimensions(e,t){const i=this._mountedRefsMap.ref(e);i&&i.updateAnchorInfo()}_renderReactionsFeed(e,t){return o.createElement(d.default,{key:e+"feed",ref:this._mountedRefsMap.onComponentRef(e),creatorKey:e,callParticipantReaction:t,alignRight:this.props.alignRight,onRemoveReaction:this._onAnimationEnd,getAnchorInfo:this._getAnchorInfo,getAnchorRectChanges:this.props.getAnchorInfoChanges,onReactionTap:this.props.onReactionTap})}render(){const e=n.map(this.state.callParticipantReactions,((e,t)=>e?this._renderReactionsFeed(t,e):void 0));return o.createElement(o.View,{style:[m.container,this.props.style],blockPointerEvents:this.props.blockPointerEvents,ignorePointerEvents:this.props.ignorePointerEvents},e)}}t.default=S},34896:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IosRouteControlButton=void 0;const a=i(63297),n=i(16778),o=i(77381),s=i(80837);class r extends o.default{render(){const e=a.default.routePickerView();return n.createElement(n.View,{style:this.props.style},this.props.children,n.createElement(e,{style:s.default.absoluteFill,accessibilityLabel:this.props.accessibilityLabel}))}}t.IosRouteControlButton=r,t.default=r},90678:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(37103),o=i(80200),s=i(77381),r=i(15877),l=i(81760),c=i(80837),d=(0,r.lazyProperties)({newLocalViewContainer:()=>a.Styles.createViewStyle({height:120,width:200,position:"absolute",right:0,top:0,overflow:"visible",shadowOffset:{width:0,height:4},shadowRadius:4,shadowColor:l.Color.blackOverlay70}),localParticipantBackgroundStyle:()=>a.Styles.createViewStyle({backgroundColor:l.Color.callStageLight}),backgroundStyleLightTheme:()=>a.Styles.createViewStyle({backgroundColor:l.Color.gray50})});class u extends s.default{constructor(){super(...arguments),this._participantLayoutController={getStyles:()=>[c.default.flexOne,d.newLocalViewContainer],getInnerStyles:()=>[c.default.flexOne],getBackgroundColorStyle:e=>e?d.backgroundStyleLightTheme:d.localParticipantBackgroundStyle,isHidden:()=>!1},this._layoutController=()=>this._participantLayoutController}render(){return a.createElement(n.CallParticipantView,{key:o.CallStageElementKeys.localUserKey,renderKey:o.CallStageElementKeys.localUserKey,parentViewId:"LocalCallParticipantView",onUpdateElementLink:this.props.onUpdateElementLink,getCallReactionsDisplayHelper:this.props.getCallReactionsDisplayHelper,callId:this.props.callId,conversationMri:this.props.conversationMri,useDarkBackground:!0,desktopNameTag:!0,isCallStageV2:!0,showContextMenu:!0,layoutController:this._layoutController,iconSize:64,iconOpacity:1,isGroupCall:!1,useLightTheme:this.props.useLightTheme})}}t.default=u},73773:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(27202),n=i(16778),o=(i(89391),i(94224)),s=i(46096),r=i(36237),l=i(4057),c=i(80837);class d extends n.Component{constructor(){super(...arguments),this._callingVideoView=null,this._rendererPromise=null,this._useNewVideoView=!1,this._onCallingVideoView=e=>{this._callingVideoView=e,this._resetRenderer()}}render(){return this._useNewVideoView&&a.VideoView?n.createElement(a.VideoView,{ref:this._onCallingVideoView}):n.createElement(a.default,{ref:this._onCallingVideoView,style:c.default.absoluteFill,isLocal:!0,parentView:d.name,nametag:this.props.nametag,localPreviewAndroidV2:this.props.localPreviewAndroidV2})}componentWillUnmount(){r.log(s.LogTraceArea.Calling,"LocalVideoPreview: componentWillUnmount"),this._clearRenderer()}componentDidUpdate(e){this.props.device!==e.device&&(r.log(s.LogTraceArea.Calling,"LocalVideoPreview: component change requiring new renderer"),this._resetRenderer())}_clearRenderer(){this._rendererPromise&&(this._rendererPromise.then((e=>e.dispose())),this._rendererPromise=null)}_resetRenderer(){this._clearRenderer(),this._callingVideoView&&(r.log(s.LogTraceArea.Calling,`LocalVideoPreview: create renderer { device: ${this.props.device} }`),this._rendererPromise=o.default.DeviceStore.createPreviewRenderer(this._callingVideoView.getVideoContainer(),this.props.options,this.props.device),this._rendererPromise.fail((e=>{r.warn(s.LogTraceArea.Calling,"LocalVideoPreview: DeviceStore.createPreviewRenderer failed. "+l.default.errorAsString(e))})))}}t.default=d},52251:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(63297),o=i(16778),s=i(48540),r=i(60787),l=i(20187),c=i(33289),d=i(94224),u=i(9520),h=i(80200),p=i(71727),g=i(46096),C=i(13944),m=i(36237),S=i(15877),y=i(33754),f=i(30124),_=i(91670),b=i(98053),T=i(36150),v=i(81760),w=i(11828),I=i(24576),P=i(53374),M=i(67024),k=i(15963),A=(0,S.lazyProperties)({container:()=>o.Styles.createViewStyle({flexDirection:"row",justifyContent:"space-between",paddingLeft:5,paddingRight:5,paddingBottom:20,overflow:"visible",alignItems:"center"}),primaryControlsContainer:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",overflow:"visible"}),buttonControlsLeft:()=>o.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-start",minWidth:44}),buttonControlsRight:()=>o.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-end",minWidth:44}),iconControl:()=>o.Styles.createViewStyle({width:44,height:44})});class R extends I.default{constructor(){super(...arguments),this._onCallEndButtonRef=e=>{this._callEndButton=e||void 0,this._callEndButton&&this.isComponentMounted()&&this._maybeFocusCallEndButton()},this._onSnapshotPressed=()=>{this._snapshotCommand.execute(),this.props.onInteracting(!1)},this._onToggleVideoPressed=e=>{const t=P.default.newCauseId();M.default.createTrackerAndMarkPressTime(t,k.ScenarioName.ResponsivenessToggleVideoCall,e),this._videoCommand.execute(),this.props.onInteracting(!1),M.default.markActionDoneAndRemoveTracker(t)},this._onEndCallPressed=e=>{const t=P.default.newCauseId();M.default.createTrackerAndMarkPressTime(t,k.ScenarioName.ResponsivenessEndCall,e);const i=P.default.newCauseId();m.log(g.LogTraceArea.CallingUI,"MobileCallControls._onEndCallPressed "+i),this._endCall(!1,i),M.default.markActionDoneAndRemoveTracker(t)},this._onEndCallButtonLongPress=e=>{e.stopPropagation(),e.preventDefault(),c.default.showEndCallMenuPopup(this._getRootViewId(),e,this._getAnchorForEndCallMenu,this._selectEndCallMenuItem)},this._onChatPanelButtonPressed=e=>{const t=P.default.newCauseId();M.default.createTrackerAndMarkPressTime(t,k.ScenarioName.ResponsivenessChatPanelInCall,e);const i=P.default.newCauseId();m.log(g.LogTraceArea.CallingUI,"MobileCallControls._onChatPanelButtonPressed "+i),this.props.onChatPanelButtonPress(i),this.props.onInteracting(!1),M.default.markActionDoneAndRemoveTracker(t)},this._getAnchorForEndCallMenu=()=>this._callEndButton,this._selectEndCallMenuItem=e=>{c.default.selectEndCallMenuItem(e,this._getRootViewId(),this._endCall)},this._endCall=(e,t)=>{if(m.log(g.LogTraceArea.CallingUI,"MobileCallControls._endCall forEveryone: "+e+" causeId: "+t),e)this._endCallForAllCommand.execute();else{new l.EndCallCommand(this.props.callId,this.props.onEndCallFailure).execute()}},this._onToggleMicrophonePressed=e=>{const t=P.default.newCauseId();M.default.createTrackerAndMarkPressTime(t,k.ScenarioName.ResponsivenessMuteCall,e);new l.ToggleMuteCommand(this.props.callId,this.state.isMuted,this.state.isServerMuted,!!this.props.disableMic,this._getRootViewId(),t).execute(),this.state.isMuted&&this.props.onLocalUnmute&&this.props.onLocalUnmute(),this.props.onInteracting(!1)},this._mediaActionEvent=e=>{d.default.CallingStore.getOutgoingCallIds().indexOf(this.props.callId)>=0?(m.track(new u.MediaActionEvent(u.CallControlContext.MobileCallControls,u.MediaActionEventResult.EndCall)),m.log(g.LogTraceArea.CallingUI,"MobileCallControls._mediaActionEvent ending call (causeId: "+e+")"),d.default.CallingStore.endCall(this.props.callId,e)):(m.track(new u.MediaActionEvent(u.CallControlContext.MobileCallControls,u.MediaActionEventResult.Ignore)),m.log(g.LogTraceArea.CallingUI,"MobileCallControls._mediaActionEvent no action (causeId: "+e+")"))}}_buildState(e,t){this._videoCommand=new l.ToggleVideoCommand(e.callId,e),this._snapshotCommand=new b.MomentCommand(e.callId,e,e.reactionsConversationMri),this._endCallForAllCommand=new l.EndCallForEveryoneCommand(e.callId,e,e.callUIState,e.onEndCallFailure);const i=d.default.CallingStore.isCallConnected(e.callId),a=e.callUIState!==h.CallUIState.None,n=d.default.CallingFeaturesHelper.allowReactionsInCallStageMobile();let o;this._reactionCommand=void 0,n&&(o=p.default.getReactionButtonType(e.conversationMri,e.callId),this._reactionCommand=p.default.getReactionCommand(o,e.callId,e,e.reactionsConversationMri));const s=n&&void 0!==this._reactionCommand&&a,r=!s&&this._snapshotCommand.canExecute()&&a;return{isMuted:p.default.isLocalOrServerMuted(e.callId),isServerMuted:d.default.CallingStore.isServerMuted(e.callId),isVideoActive:d.default.CallingStore.isProvidingVideo(e.callId),isMobileScreenReaderEnabled:T.default.isMobileScreenReaderEnabled(),isVideoButtonEnabled:this._videoCommand.canExecute(),hangupAllEnabled:this._endCallForAllCommand.canExecute(),isSnapshotButtonVisible:r,useHighContrastTheme:p.default.useHighContrastThemeAndChanges(),callState:d.default.CallingStore.getCallState(e.callId),isTablet:!f.default.isUsingStackNavigationContext(),isCallConnected:i,shouldMakeSecondaryActionsAvailable:a,showReactButton:s,reactionButtonType:o}}componentDidMount(){super.componentDidMount(),this._maybeFocusCallEndButton(100),this._mediaActionEventSub=n.default.mediaActionEvent.subscribe(this._mediaActionEvent),n.default.maybeEndCallFromAndroidBtScoDisconnectEvent&&(this._maybeEndCallFromAndroidBtScoDisconnectSub=n.default.maybeEndCallFromAndroidBtScoDisconnectEvent.subscribe((()=>{m.track(new u.MaybeEndCallFromAndroidBtScoDisconnectEvent(u.CallControlContext.MobileCallControls))})))}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),t.isServerMuted||!this.state.isServerMuted||this.state.isMuted||p.default.announceMicrophoneState(!0,!0),this._logMuteStateChanges(t)}componentWillUnmount(){super.componentWillUnmount(),this._mediaActionEventSub&&(this._mediaActionEventSub.unsubscribe(),this._mediaActionEventSub=void 0),this._maybeEndCallFromAndroidBtScoDisconnectSub&&(this._maybeEndCallFromAndroidBtScoDisconnectSub.unsubscribe(),this._maybeEndCallFromAndroidBtScoDisconnectSub=void 0)}_logMuteStateChanges(e){this.state.isMuted!==e.isMuted&&m.log(g.LogTraceArea.CallMonitor,`MobileCallControls.componentDidUpdate, isMuted - ${e.isMuted} to ${this.state.isMuted}`),this.state.isServerMuted!==e.isServerMuted&&m.log(g.LogTraceArea.CallMonitor,`MobileCallControls.componentDidUpdate, isServerMuted - ${e.isServerMuted} to ${this.state.isServerMuted}`)}_colorConfig(){return this.state.useHighContrastTheme?p.default.highContrastColorConfig(this._themeColors):void 0}_maybeFocusCallEndButton(e=0){const t=()=>{this._callEndButton&&this.isComponentMounted()&&this.state.isMobileScreenReaderEnabled&&this._callEndButton.requestFocus()};e?a.delay(t,e):a.defer(t)}_getPrimaryControls(){let e;return this.props.isPSTNCall?e=this._getPSTNDialPadButton():this.props.isEncryptedCall||(e=this._getVideoButton()),o.createElement(o.View,{style:A.primaryControlsContainer},this._getMicButton(),e,this._getHangUpButton())}_getHangUpButton(){return o.createElement(r.CallButton,{key:"endcall",ref:this._onCallEndButtonRef,icon:w.SkypeIcon.CallEnd,title:y.getString("CallControls.CallButtonEndCall"),size:r.CallButtonSize.Large,isToggledOn:!1,isCallEndButton:!0,onPress:this._onEndCallPressed,onLongPress:this.state.hangupAllEnabled?this._onEndCallButtonLongPress:void 0,accessibilityLabel:y.getString("CallControls.CallButtonEndCall"),backgroundStyle:r.CallButtonBackgroundStyle.Solid,colorConfig:this._colorConfig()})}_getMicButton(){const e=y.getString(this.state.isMuted?"CallControls.CallButtonUnmuteLabel":"CallControls.CallButtonMute");return o.createElement(r.CallButton,{key:h.CallControlsKeys.Mic,icon:this.state.isMuted?w.SkypeIcon.MicrophoneOff:w.SkypeIcon.Microphone,title:e,size:r.CallButtonSize.Large,isToggledOn:!this.state.isMuted,onPress:this._onToggleMicrophonePressed,accessibilityLabel:e,backgroundStyle:this.state.isMuted?r.CallButtonBackgroundStyle.Solid:r.CallButtonBackgroundStyle.Overlay,colorConfig:this._colorConfig()})}_getVideoButton(){const e=y.getString(this.state.isVideoActive?"CallControls.CallButtonTurnOffVideoLabel":"CallControls.CallButtonTurnOnVideoLabel");return o.createElement(r.CallButton,{ref:this.props.onVideoButtonRef,key:h.CallControlsKeys.Video,icon:this.state.isVideoActive?w.SkypeIcon.Video:w.SkypeIcon.VideoOff,title:e,size:r.CallButtonSize.Large,isDisabled:!this.state.isVideoButtonEnabled,isToggledOn:this.state.isVideoActive,onPress:this._onToggleVideoPressed,accessibilityLabel:e,backgroundStyle:this.state.isVideoActive?r.CallButtonBackgroundStyle.Overlay:r.CallButtonBackgroundStyle.Solid,colorConfig:this._colorConfig()})}_getPSTNDialPadButton(){return o.createElement(r.CallButton,{key:h.CallControlsKeys.Dialpad,icon:w.SkypeIcon.Dialpad,title:y.getString("CallPanel.DialpadTooltipTitle"),size:r.CallButtonSize.Large,isDisabled:!(this.state.callState===s.CallState.Connected||this.state.callState===s.CallState.EarlyMedia),isToggledOn:!0,onPress:this.props.onOpenDialpad,accessibilityLabel:y.getString("CallPanel.DialpadTooltipTitle"),backgroundStyle:r.CallButtonBackgroundStyle.Overlay,colorConfig:this._colorConfig()})}_getSnapshotButton(){if(this.state.isSnapshotButtonVisible)return o.createElement(C.default,{style:A.iconControl,icon:w.SkypeIcon.Snapshot,title:y.getString("CallReactionsBar.PhotoSnapshotButtonShortTitle"),size:w.IconSize.size24,onPress:this._onSnapshotPressed,accessibilityLabel:y.getString("CallReactionsBar.PhotoSnapshotButtonShortTitle"),color:v.Color.white,hoverColor:v.Color.whiteOverlay20})}_getReactionButton(){if(!this.state.showReactButton||!this._reactionCommand||void 0===this.state.reactionButtonType)return;const e=p.default.getReactionButtonDescriptors(this.state.reactionButtonType,this._reactionCommand);return o.createElement(C.default,Object.assign({style:A.iconControl,size:w.IconSize.size24,color:v.Color.white,hoverColor:v.Color.whiteOverlay20,disabled:!this.state.isCallConnected},e))}_getChatPanelButton(){if(!this.state.isTablet)return;const e=this.props.isShowingChat?y.getString("CallPanel.CloseConversation"):y.getString("CallPanel.OpenConversation"),t=this.props.isShowingChat?w.SkypeIcon.ChatsInverted:w.SkypeIcon.Message;return o.createElement(C.default,{style:A.iconControl,icon:t,title:e,accessibilityLabel:e,size:w.IconSize.size24,onPress:this._onChatPanelButtonPressed,color:v.Color.white,hoverColor:v.Color.whiteOverlay20})}render(){const e=!this.props.isEncryptedCall&&this.state.shouldMakeSecondaryActionsAvailable?o.createElement(_.default,{size:44,onOverflowPressed:this.props.onOverflowPressed}):void 0;return o.createElement(o.View,{style:[A.container,this.props.style],ignorePointerEvents:this.props.ignorePointerEvents,blockPointerEvents:this.props.blockPointerEvents},o.createElement(o.View,{style:A.buttonControlsLeft},this._getChatPanelButton(),this._getSnapshotButton(),this._getReactionButton()),this._getPrimaryControls(),o.createElement(o.View,{style:A.buttonControlsRight},e))}}t.default=R},43786:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(94224),o=i(47176),s=i(80200),r=i(11930),l=i(16402),c=i(52262),d=i(46096),u=i(36237),h=i(15877),p=i(33754),g=i(81760),C=i(19675),m=i(24576),S=i(12770),y=i(53374),f=(0,h.lazyProperties)({titleContainer:()=>a.Styles.createViewStyle({flex:-1,paddingTop:6,justifyContent:"center",backgroundColor:g.Color.transparent}),headerContainer:()=>a.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"flex-start",height:s.CallPanelHeaderHeight.mobile}),headerContainerLeftAligned:()=>a.Styles.createViewStyle({alignItems:"flex-start"}),firstRow:()=>a.Styles.createViewStyle({paddingTop:16,justifyContent:"center",marginBottom:8}),firstRowLeftAligned:()=>a.Styles.createViewStyle({marginBottom:1}),conversationNameText:()=>a.Styles.createTextStyle({color:g.Color.white}),callInfo:()=>a.Styles.createTextStyle({color:g.Color.whiteOverlay70})});class _ extends m.default{constructor(){super(...arguments),this._onPress=()=>{if(this.props.onTitlePress){const e=y.default.newCauseId();u.log(d.LogTraceArea.CallingUI,"MobileCallPanelHeaderTitle._onPress, causeId: "+e),this.props.onTitlePress(e,s.CallRosterOrigin.FromGroupTitle)}}}_buildState(e,t){const i=n.default.CallingStore.getConnectedAndNotOnHoldCallId(),a=!!i&&i!==e.callId;return{conversationName:c.default.getDisplayName(e.conversationMri)||p.getString("Notifications.UnknownUserShort"),activeParticipantCount:e.showParticipantCount?o.default.getActiveParticipants(e.callId,e.conversationMri).length:void 0,totalParticipantCount:e.showParticipantCount?o.default.getRosterForConversation(e.conversationMri).length:void 0,multipleCallWarning:a?p.getString("CallBanner.IncomingCallMultiCallWarning"):void 0}}render(){const e=[f.firstRow],t=[f.headerContainer,f.headerContainerLeftAligned],i=[this.props.useThemeColors?{color:this._themeColors.headerTextColor}:f.conversationNameText,f.firstRowLeftAligned],n=[this.props.useThemeColors?{color:this._themeColors.secondaryTextColor}:f.callInfo],o=a.createElement(a.View,{style:e},a.createElement(C.PanelHeader,{landscape:this.props.isLandscape,style:i,numberOfLines:1},this.state.conversationName));let s,r;this.props.outgoingRingStatus&&this.props.outgoingRingStatus.length&&(s=a.createElement(C.Caption,{style:n,numberOfLines:1},this.props.outgoingRingStatus)),this.props.showParticipantCount&&this.state.activeParticipantCount&&this.state.totalParticipantCount&&(r=p.getString("CallPanel.CallRosterTitleUpper",{count:this.state.activeParticipantCount,total:this.state.totalParticipantCount}));const l=a.createElement(b,{callId:this.props.callId,isActive:this.props.isCallActive&&this.props.isSeen,participantCountText:r,textStyle:n});let c;this.state.multipleCallWarning&&(c=a.createElement(C.Caption,{style:n},this.state.multipleCallWarning));const d=!!this.props.onTitlePress;return a.createElement(a.Button,{style:f.titleContainer,onPress:d?this._onPress:void 0,accessibilityTraits:d?a.Types.AccessibilityTrait.Button:a.Types.AccessibilityTrait.Text,disableTouchOpacityAnimation:!d},a.createElement(a.View,{style:t},o,s,c,l))}_subscribeToThemeChanges(){return!1}}t.default=_;class b extends m.default{constructor(){super(...arguments),this._onTimerUpdate=()=>{const e=n.default.OngoingCallService.getCallConnectedTime(this.props.callId),t=e?Date.now()-e:0;this.setState({elapsedTimeMs:t})}}_buildState(e,t){let i={};return t&&(i.elapsedTimeMs=0),i}componentDidMount(){super.componentDidMount(),this.props.isActive&&this._maybeStartTimer()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),e.isActive!==this.props.isActive&&this._maybeStartTimer()}componentWillUnmount(){super.componentWillUnmount(),this._startOrStopCallTimer(!1)}_maybeStartTimer(){this._startOrStopCallTimer(!!this.props.isActive)}_startOrStopCallTimer(e){e?this._timerToken||(this._timerToken=S.default.setInterval(this._onTimerUpdate,1e3),this._onTimerUpdate()):this._timerToken&&(S.default.clearInterval(this._timerToken),this._timerToken=void 0)}render(){let e=null;if(this.props.participantCountText||this.state.elapsedTimeMs>0||this.props.isActive){const t=this.state.elapsedTimeMs||this.props.isActive,i=t?l.default.getElapsedTimeStringFromMs(this.state.elapsedTimeMs):void 0,n=t?l.default.getFormattedDuration(Math.floor(this.state.elapsedTimeMs/1e3),!0):void 0,o=this.props.participantCountText&&i?a.createElement(a.Text,null," | "):void 0;let s;s=this.props.participantCountText&&n?r.default.combinedAccessibilityLabel(this.props.participantCountText,n):this.props.participantCountText||n,e=a.createElement(a.View,{accessibilityLabel:s,importantForAccessibility:a.Types.ImportantForAccessibility.Yes,accessibilityTraits:a.Types.AccessibilityTrait.Text},a.createElement(C.Caption,{style:this.props.textStyle,numberOfLines:1,accessibilityHidden:!0},this.props.participantCountText,o,i))}return e}_subscribeToThemeChanges(){return!1}}},67354:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(89391),o=i(60787),s=i(94224),r=i(9520),l=i(9520),c=i(71727),d=i(71830),u=i(24490),h=i(57139),p=i(26208),g=i(52262),C=i(46096),m=i(80640),S=i(36237),y=i(15877),f=i(33754),_=i(81760),b=i(11828),T=i(19675),v=i(53374),w=(0,y.lazyProperties)({containerViewBase:()=>a.Styles.createViewStyle({flex:1,alignItems:"center",alignSelf:"stretch",backgroundColor:_.Color.transparent}),titleStyle:()=>a.Styles.createTextStyle({marginTop:30,marginHorizontal:50,textAlign:"center",color:_.Color.white}),messageStyle:()=>a.Styles.createTextStyle({marginTop:10,marginHorizontal:50,textAlign:"center",color:_.Color.whiteOverlay70}),buttonInfoStyle:()=>a.Styles.createTextStyle({marginTop:10,marginHorizontal:5,textAlign:"center",color:_.Color.whiteOverlay70}),actionPane:()=>a.Styles.createViewStyle({position:"absolute",left:0,right:0,bottom:30,alignItems:"center",alignSelf:"stretch"}),minorButtonsRowOneItem:()=>a.Styles.createViewStyle({marginBottom:30,alignContent:"center",justifyContent:"center"}),minorButtonsRowMultiItem:()=>a.Styles.createViewStyle({marginBottom:30,marginHorizontal:100,flexDirection:"row",alignSelf:"stretch",alignContent:"center",justifyContent:"space-between"}),majorButtonsRow:()=>a.Styles.createViewStyle({marginVertical:20,marginHorizontal:60,flexDirection:"row",alignSelf:"stretch",alignContent:"center",justifyContent:"space-between"})});class I extends m.IncomingRingControlsBase{constructor(e){super(l.CallControlContext.MobileIncomingRingPanel,e),this._onMessageButtonRef=e=>{this._callMessageButton=e||void 0},this._onRejectCall=()=>{this._rejectCommand.execute(),S.track(new r.MobileCallAnswerEvent(r.MobileCallAnswerActions.Declined,0))},this._onAnswerCallWithVideo=()=>{this._answerCommand.execute(!0),S.track(new r.MobileCallAnswerEvent(r.MobileCallAnswerActions.AnsweredWithVideo,0))},this._onAnswerCall=()=>{this._answerCommand.execute(),S.track(new r.MobileCallAnswerEvent(r.MobileCallAnswerActions.AnsweredWithAudio,0))},this._onMesageBack=()=>{const e=v.default.newCauseId();s.default.OngoingCallService.stopCallSounds(this.props.callId,e);const t={callId:this.props.callId,conversationMri:this.props.conversationMri,onClose:this._closeMessagePrompt},i=a.createElement(p.default,Object.assign({},t)),n=p.default.getMenuHeight(),o={headerType:u.HeaderType.Slim,hideCloseButton:!0};h.default.showWithContent({menuId:h.default.menuId(),anchor:()=>this._callMessageButton,rootViewId:this._getRootViewId(),menuHeight:n,content:i,onCloseMenu:this._closeMessagePrompt,getTitle:()=>{},headerConfig:o,backgroundColor:_.Color.black},e)},this._closeMessagePrompt=()=>{const e=v.default.newCauseId();S.log(C.LogTraceArea.CallingUI,"MobileIncomingRingPanel._closeMessagePrompt causeId: "+e),h.default.close(this._getRootViewId(),e)}}_buildState(e,t){this._initializeCommands(e,!0);const i=s.default.CallingStore.getConnectedAndNotOnHoldCallId();return{conversationName:g.default.getDisplayName(e.conversationMri)||f.getString("Notifications.UnknownUserShort"),useHighContrastTheme:c.default.useHighContrastThemeAndChanges(),allowVideoButton:this._answerCommand.canExecuteWithVideo(),withVideo:s.default.CallingStore.incomingCallHasVideo(e.callId),isGroupCall:d.isGroupConversation(e.conversationMri),connectedToAnotherCall:!!i&&i!==e.callId,showMessageButton:n.default.getS4LCMCFeatures().enableDeclineAndMessageOnRingControls&&!s.default.CallingStore.isPSTNCall(e.callId)}}_colorConfig(e){return this.state.useHighContrastTheme?c.default.highContrastColorConfig(this._themeColors):{iconColor:_.Color.white,backgroundColor:e,selectedIconColor:_.Color.white,selectedBackgroundColor:e}}render(){return a.createElement(a.View,{style:[w.containerViewBase,this.props.style]},this._renderTitle(),this._renderCallInfo(),a.createElement(a.View,{style:w.actionPane},this._renderCallButtons()))}_renderTitle(){return a.createElement(T.PanelHeader,{style:w.titleStyle,numberOfLines:1},this.state.conversationName)}_renderCaption(e,t){return a.createElement(T.Caption,{style:t},e)}_renderCallInfo(){return this._renderCaption(this._getIncomingCallStrings(),w.messageStyle)}_renderCallButtons(){let e;if(this.state.allowVideoButton){const t=f.getString("MobileIncomingCallPanel.CallButtonVideoLabel",{conversationName:this.state.conversationName});e=a.createElement(a.View,null,a.createElement(o.CallButton,{icon:b.SkypeIcon.Video,isToggledOn:!1,title:t,onPress:this._onAnswerCallWithVideo,size:o.CallButtonSize.ExtraLarge,accessibilityLabel:t,colorConfig:this._colorConfig(_.Color.green)}),this._renderCaption(f.getString("MobileIncomingCallPanel.VideoButtonText"),w.buttonInfoStyle))}const t=f.getString("MobileIncomingCallPanel.CallButtonAudioLabel",{conversationName:this.state.conversationName}),i=f.getString("MobileIncomingCallPanel.CallButtonDeclineLabel"),n=f.getString("MobileIncomingCallPanel.CallButtonMessageBackLabel",{conversationName:this.state.conversationName}),s=a.createElement(a.View,null,a.createElement(o.CallButton,{ref:this._onAnswerCallButtonRef,icon:b.SkypeIcon.CallStart,isToggledOn:!1,title:t,onPress:this._onAnswerCall,size:e?o.CallButtonSize.Small:o.CallButtonSize.ExtraLarge,accessibilityLabel:t,colorConfig:this._colorConfig(e?_.Color.gray200Overlay20:_.Color.green),isSquareButton:!!e}),this._renderCaption(f.getString("MobileIncomingCallPanel.AudioButtonText"),w.buttonInfoStyle)),r=a.createElement(a.View,null,a.createElement(o.CallButton,{icon:b.SkypeIcon.CallEnd,isToggledOn:!1,title:i,onPress:this._onRejectCall,isCallEndButton:!0,size:o.CallButtonSize.ExtraLarge,accessibilityLabel:i,colorConfig:this._colorConfig(_.Color.red)}),this._renderCaption(f.getString("MobileIncomingCallPanel.DeclineButtonText"),w.buttonInfoStyle));let l;if(this.state.showMessageButton&&(l=a.createElement(a.View,null,a.createElement(o.CallButton,{ref:this._onMessageButtonRef,icon:b.SkypeIcon.Message,isToggledOn:!1,title:n,onPress:this._onMesageBack,size:o.CallButtonSize.Small,accessibilityLabel:n,colorConfig:this._colorConfig(_.Color.gray200Overlay20),isSquareButton:!0}),this._renderCaption(f.getString("MobileIncomingCallPanel.MessageButtonText"),w.buttonInfoStyle))),e){const t=l?w.minorButtonsRowMultiItem:w.minorButtonsRowOneItem;return[a.createElement(a.View,{key:"minorRow",style:t},l,s),a.createElement(a.View,{key:"majorRow",style:w.majorButtonsRow},r,e)]}return[a.createElement(a.View,{key:"minorRow",style:w.minorButtonsRowOneItem},l),a.createElement(a.View,{key:"majorRow",style:w.majorButtonsRow},r,s)]}_getIncomingCallStrings(){return this.state.connectedToAnotherCall?f.getString("CallBanner.IncomingCallMergeCallWarning"):this.state.isGroupCall?f.getString("MobileIncomingCallPanel.IncomingCall"):this.state.withVideo?f.getString("MobileIncomingCallPanel.IncomingVideoCall"):f.getString("MobileIncomingCallPanel.IncomingAudioCall")}}t.default=I},33643:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(88837),o=i(46096),s=i(10117),r=i(36237),l=i(15877),c=i(33754),d=i(24932),u=i(81760),h=i(11828),p=i(19675),g=(0,l.lazyProperties)({container:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center"}),icon:()=>a.Styles.createViewStyle({marginRight:10})});class C extends n.ComponentBase{constructor(){super(...arguments),this._onStopPress=e=>{r.log(o.LogTraceArea.CallingUI,"MobileScreenShareBanner disable screen-share clicked");new d.MobileScreenShareToggleCommand(this.props).execute()}}render(){return a.createElement(a.View,{style:g.container},a.createElement(s.default,{style:g.icon,icon:h.SkypeIcon.ScreenShare,size:h.IconSize.size24,color:u.Color.white}),a.createElement(a.View,{style:this.props.containerStyle},a.createElement(p.BodyText,{bold:!0,style:this.props.textStyle,numberOfLines:1},c.getString("MobileScreenSharingToast.BannerTitle")),a.createElement(a.Button,{onPress:this._onStopPress},a.createElement(p.BodyText,{style:this.props.linkStyle},c.getString("MobileScreenSharingToast.StopSharingLinkText")))))}}t.default=C},91670:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(88837),o=i(89391),s=i(94224),r=i(46096),l=i(13944),c=i(36237),d=i(15877),u=i(33754),h=(i(78735),i(81760)),p=i(11828),g=(0,d.lazyProperties)({redDot:()=>a.Styles.createViewStyle({width:10,height:10,borderRadius:5,backgroundColor:h.Color.red,position:"absolute",right:5})});class C extends n.ComponentBase{constructor(){super(...arguments),this._showOverflowMenu=()=>{c.log(r.LogTraceArea.CallingUI,"OverflowMenuButton._showOverflowMenu"),this.props.onOverflowPressed((()=>this._overflowButton)),this.setState({showRedDot:!1})},this._onOverflowButtonRef=e=>{this._overflowButton=e||void 0}}_buildState(e,t){return{showRedDot:s.default.DeviceStore.isBackgroundBlurEnabled()&&o.default.getS4LCMCFeatures().enableBackgroundBlurNewLabel&&!1}}render(){const e=this.props.size||44,t=a.Styles.createViewStyle({width:e,height:e},!1),i=u.getString("CallControls.CallButtonOverflowMenu"),n=a.Styles.createViewStyle({top:e/2-10},!1);return a.createElement(a.View,null,this.state.showRedDot?a.createElement(a.View,{style:[g.redDot,n]}):void 0,a.createElement(l.default,{key:"overflow",style:t,ref:this._onOverflowButtonRef,icon:p.SkypeIcon.More,title:i,size:p.IconSize.size24,onPress:this._showOverflowMenu,accessibilityLabel:i,color:h.Color.white,hoverColor:h.Color.whiteOverlay20}))}}t.default=C},1838:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PhotoEventsLayoutController=t.PhotoEventItemLayoutController=void 0;const a=i(96486),n=i(16778),o=i(89391),s=i(80200),r=i(46096),l=i(36237),c=i(62232),d=i(50795),u=i(12770),h=i(53374),p={width:300,height:300};class g{constructor(e,t,i,a,o,s,r,l,d=10,u=10){if(this._hasBeenPresented=!1,this._hasBeenDismissed=!1,this._isPanning=!1,this._viewRect={x:0,y:0,width:0,height:0},this._animatedVerticalValue=new n.Animated.Value(0),this._animatedHorizontalValue=new n.Animated.Value(0),this._animatedHeightValue=new n.Animated.Value(1),this._animatedWidthValue=new n.Animated.Value(1),this._animatedTransfromValueForScale=new n.Animated.Value(0),this._animatedTransformValueForX=new n.Animated.Value(0),this._animatedTransformValueForY=new n.Animated.Value(0),this._incomingPhotoSound=c.default.SkypeShutter,this._id=e,this._parentViewDimensions=t,this._onWillRemoveItem=a,this._onDidRemoveItem=o,this._onPanItem=i,this._isDesktop=s,this._animationDirection=r,this._bottomMargin=d,this._desktopSideMargin=u,l&&l.width&&l.height){let e,t;l.width>l.height?(e=p.width,t=p.width*(l.height/l.width)):(t=260,e=p.height*(l.width/l.height)),e=Math.max(e,260),t=Math.max(t,260),this._containerDimensions={width:e,height:t}}else this._containerDimensions=p;const h=this._animationOffset();this._animatedTransformValue=new n.Animated.Value(h),this._rectStyleForMobile=n.Styles.createAnimatedViewStyle({left:this._animatedHorizontalValue,bottom:this._animatedVerticalValue,height:this._animatedHeightValue,width:this._animatedWidthValue});const g={bottom:this._bottomMargin,height:this._containerDimensions.height,width:this._containerDimensions.width};g.right=this._desktopSideMargin,this._rectStyleForDesktop=n.Styles.createViewStyle(g,!1),this._setPositionStyle(),this._imageStyle=n.Styles.createImageStyle({width:this._containerDimensions.width,height:this._containerDimensions.height},!1)}_setPositionStyle(){switch(this._animationDirection){case s.PhotoAnimationDirection.Zoom:this._positionStyle=n.Styles.createAnimatedViewStyle({transform:[{translateX:this._animatedTransformValueForX},{translateY:this._animatedTransformValueForY},{scale:this._animatedTransfromValueForScale}],opacity:this._animatedTransfromValueForScale});break;case s.PhotoAnimationDirection.Up:this._positionStyle=n.Styles.createAnimatedViewStyle({transform:[{translateY:this._animatedTransformValue}]});break;default:this._positionStyle=n.Styles.createAnimatedViewStyle({transform:[{translateX:this._animatedTransformValue}]})}}getRectStyles(){return this._isDesktop?this._rectStyleForDesktop:this._rectStyleForMobile}getPositionStyles(){return this._positionStyle}getImageStyle(){return this._imageStyle}presentItemIfReady(e=!0){if(this._hasBeenPresented)return!1;this._hasBeenPresented=!0;const t=h.default.newCauseId();l.log(r.LogTraceArea.GenericUnsafe,"PhotoEventItemLayoutController.presentItemIfReady causeId: "+t),this._incomingPhotoSound.playOnce(t);const i=o.default.getS4LCMCFeaturesNoSubscription().photoEventTimeoutMs;return this._isDesktop?this._updateAnimatedPositionForDesktop(this._itemRect(),0,!0,1,!1,(()=>this._startDismissTimer(i))):this._updateAnimatedPosition(this._itemRect(),0,!1,e,(()=>this._startDismissTimer(i))),!0}_itemRect(){const e=this._containerDimensions;let t,i;return this._isDesktop?(t=this._desktopSideMargin,i=this._bottomMargin):(t=(this._parentViewDimensions.width-e.width)/2,i=(this._parentViewDimensions.height-e.height)/2),Object.assign({x:t,y:i},e)}dismissItem(e=!0){return!this._hasBeenDismissed&&!this._isPanning&&(this._onWillRemoveItem&&this._onWillRemoveItem(this._id),this._clearDismissTimer(),this._isDesktop?this._updateAnimatedPositionForDesktop({x:this._desktopSideMargin-this._desktopSideMargin/2,y:this._bottomMargin-this._bottomMargin/2,width:0,height:0},this._animationOffset(),e,0,e,(()=>{u.default.setTimeout((()=>{this._onDidRemoveItem&&this._onDidRemoveItem(this._id)}),1e3)})):this._updateAnimatedPosition(this._viewRect,this._animationOffset(),!1,e,(()=>{this._onDidRemoveItem&&this._onDidRemoveItem(this._id)})),this._hasBeenDismissed=!0,!0)}onPan(e){if(this._hasBeenDismissed||!this._hasBeenPresented||this._animationDirection===s.PhotoAnimationDirection.Up)return;let t=e.pageX-e.initialPageX;this._animationDirection===s.PhotoAnimationDirection.Left&&t<0?t=-1*Math.sqrt(Math.abs(t)):this._animationDirection===s.PhotoAnimationDirection.Right&&t>0&&(t=Math.sqrt(Math.abs(t))),this._animatedTransformValue.setValue(t),e.isComplete?this._isPanning&&(this._isPanning=!1,this._onPanItem(!1),this.dismissItem()):this._isPanning||(this._isPanning=!0,this._onPanItem(!0))}_animationOffset(){if(!this._parentViewDimensions)return 0;switch(this._animationDirection){case s.PhotoAnimationDirection.Left:return this._parentViewDimensions.width-this._viewRect.x;case s.PhotoAnimationDirection.Right:return-1*(this._parentViewDimensions.width-this._viewRect.x);case s.PhotoAnimationDirection.Up:return this._containerDimensions.height+300;case s.PhotoAnimationDirection.Zoom:return(this._containerDimensions.height+10)/2}return 0}_clearDismissTimer(){this._dismissTimer&&(u.default.clearTimeout(this._dismissTimer),this._dismissTimer=void 0)}_startDismissTimer(e){this._clearDismissTimer(),this._dismissTimer=u.default.setTimeout((()=>this.dismissItem(!0)),e)}updateViewDimensions(e){this._parentViewDimensions=e;const t=this._itemRect();this._animatedVerticalValue.setValue(t.y),this._animatedHorizontalValue.setValue(t.x),this._animatedWidthValue.setValue(t.width),this._animatedHeightValue.setValue(t.height)}_updateAnimatedPositionForDesktop(e,t,i=!0,o,s=!0,r,l){if(this._hasBeenDismissed)return;let c=l||[];i?c.push(d.default.easeOut({value:this._animatedTransfromValueForScale,toValue:o})):this._animatedTransfromValueForScale.setValue(o),s?(c.push(d.default.easeOut({value:this._animatedTransformValueForX,toValue:-1*t})),c.push(d.default.easeOut({value:this._animatedTransformValueForY,toValue:t}))):(this._animatedTransformValueForX.setValue(-1*t),this._animatedTransformValueForY.setValue(t)),a.isEmpty(c)?r&&r():n.Animated.parallel(c).start((e=>{r&&r()})),this._viewRect=e}_updateAnimatedPosition(e,t,i=!0,o=!0,s,r){if(this._hasBeenDismissed)return;let l=r||[];i?(l.push(d.default.easeOut({value:this._animatedVerticalValue,toValue:e.y})),l.push(d.default.easeOut({value:this._animatedHorizontalValue,toValue:e.x})),l.push(d.default.easeOut({value:this._animatedWidthValue,toValue:e.width})),l.push(d.default.easeOut({value:this._animatedHeightValue,toValue:e.height}))):(this._animatedVerticalValue.setValue(e.y),this._animatedHorizontalValue.setValue(e.x),this._animatedWidthValue.setValue(e.width),this._animatedHeightValue.setValue(e.height)),o?l.push(d.default.easeOut({value:this._animatedTransformValue,toValue:t})):this._animatedTransformValue.setValue(t),a.isEmpty(l)?s&&s():n.Animated.parallel(l).start((e=>{s&&s()})),this._viewRect=e}}t.PhotoEventItemLayoutController=g;t.PhotoEventsLayoutController=class{constructor(e,t,i,a){this._controllers={},this._orderedKeys=[],this._isDesktop=e,this._animationDirection=t,this._bottomMargin=i,this._desktopSideMargin=a}updateViewDimensions(e){this._viewDimensions=e,a.each(this._controllers,(t=>t.updateViewDimensions(e)))}setCallbacks(e,t,i){this._onWillRemoveItem=e,this._onDidRemoveItem=t,this._onPanItem=i}clearEvents(e){a.each(this._controllers,((t,i)=>{i!==e&&(this._isDesktop?t.dismissItem(!1):t.dismissItem())}))}dismissItem(e){const t=this.existingControllerForKey(e);t&&t.dismissItem()}presentItemIfReady(e,t=!0){const i=this.existingControllerForKey(e);i&&i.presentItemIfReady(t)}existingControllerForKey(e){return this._intControllerForKey(e,!1)}controllerForKey(e,t,i){return this._intControllerForKey(e,!0,t,i)}_intControllerForKey(e,t,i,a){let n=this._controllers[e];return!n&&t&&(n=new g(e,this._viewDimensions,this._onPanItem,this._onWillRemoveItem,this._onDidRemoveItem,this._isDesktop,i&&!this._isDesktop?s.PhotoAnimationDirection.Up:this._animationDirection,a,this._bottomMargin,this._desktopSideMargin),this._controllers[e]=n,this._orderedKeys.push(e)),n}removeControllerForKey(e){delete this._controllers[e],this._orderedKeys=a.without(this._orderedKeys,e)}}},98040:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(74958),n=i(96486),o=i(16778),s=i(88837),r=i(78968),l=i(80200),c=i(86374),d=i(46096),u=i(36237),h=i(15877),p=i(12762),g=i(18078),C=i(30124),m=i(1838),S=i(77554),y=i(81760),f=i(12770),_=i(53374),b=(0,h.lazyProperties)({container:()=>o.Styles.createViewStyle({backgroundColor:y.Color.transparent}),dismissalView:()=>o.Styles.createViewStyle({position:"absolute",left:0,top:0,right:0,bottom:0,backgroundColor:y.Color.transparent})});class T extends s.ComponentBase{constructor(){super(...arguments),this._backgroundColorValue=new o.Animated.Value(0),this._backgroundColorStyle=o.Styles.createAnimatedViewStyle({backgroundColor:this._backgroundColorValue.interpolate({inputRange:[0,1],outputRange:[y.Color.transparent,y.Color.blackOverlay50]})}),this._isPanning=!1,this._onWillRemoveItem=e=>{this.state.itemRenderInfo.length<=1&&this._toggleBackgroundColor(!1)},this._onDidRemoveItem=e=>{this.isComponentMounted()&&(this._layoutController.removeControllerForKey(e),this.setState(this._removeStreamItemsAndReturnNewState(e)))},this._onPanItem=e=>{this._isPanning=e},this._renderItem=e=>{const t=e.id,i=e.item;return o.createElement(S.default,{key:t,eventId:t,mri:i.mri,message:i.message,layoutController:e.layoutController,onPan:this._onPan,onTap:this._onTap,onLoad:this._onItemLoad,onClose:this._onClose})},this._onClose=e=>{this._layoutController.dismissItem(e),this.props.onPhotoDismissed&&this.props.onPhotoDismissed()},this._onPan=(e,t)=>{const i=this._layoutController.existingControllerForKey(e);i&&i.onPan(t)},this._onTap=(e,t)=>{const i=_.default.newCauseId(),o=n.findIndex(this.state.itemRenderInfo,(t=>t.id===e)),s=-1!==o?this.state.itemRenderInfo[o].item.message:void 0;u.log(d.LogTraceArea.CallReactions,"PhotoEventStream onTap "+a.pii.Omit(e)+" message: "+(s?s.cuid:"none")+" causeId: "+i),this.props.isDesktop||this._layoutController.clearEvents(),this.props.photoTapDelay?f.default.setTimeout((()=>{this.isComponentMounted()&&this.props.onPhotoTap&&this.props.onPhotoTap(s,t,i)}),this.props.photoTapDelay):this.props.onPhotoTap&&this.props.onPhotoTap(s,t,i),this.props.isDesktop&&f.default.setTimeout((()=>{this._layoutController.clearEvents()}),500),s&&!g.default.isMyMri(s.creator)&&r.default.markOneIncomingPhotoSeen(this.props.reactionsConversationMri)},this._onDismissalTap=()=>{this.clearEvents()},this._onItemLoad=e=>{this.isComponentMounted()&&(this.props.isDesktop||this._toggleBackgroundColor(!0),this._layoutController.clearEvents(e),this._layoutController.presentItemIfReady(e))},this._toggleBackgroundColor=(e,t)=>{o.Animated.timing(this._backgroundColorValue,{toValue:e?1:0,duration:200,easing:o.Animated.Easing.InOut()}).start(t)},this._onLayoutChange=e=>{this._layoutController.updateViewDimensions({width:e.width,height:e.height})}}_buildState(e,t){let i={};if(t){this._eventCount=0;let t=e.isDesktop?l.PhotoAnimationDirection.Zoom:C.default.isUsingStackNavigationContext()?l.PhotoAnimationDirection.Right:l.PhotoAnimationDirection.Left;this._layoutController=new m.PhotoEventsLayoutController(!!e.isDesktop,t,e.bottomMargin,e.desktopSideMargin),i.itemRenderInfo=[]}return i}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this._layoutController.setCallbacks((e=>this._onWillRemoveItem(e)),(e=>this._onDidRemoveItem(e)),(e=>this._onPanItem(e)))}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this.state.itemRenderInfo.length&&!t.itemRenderInfo.length&&this._toggleBackgroundColor(!1)}photoEvent(e,t){if(this._isPanning)return;let i=n.clone(this.state.itemRenderInfo);const a="photo_"+this._eventCount++,o=g.default.isMyMri(e.creator),s=c.decode(e);let r;if(this.props.sizePhotosToFit){const e=s.getFirstUriObjectChild(p.PictureNode);if(e){const t=e.getOriginalDimensions();t.width&&t.height&&(r=t)}}u.log(d.LogTraceArea.CallReactions,"PhotoEventStream photoEvent  intrinsicSize "+(r?r.width+", "+r.height:"none")+" message: "+e.cuid);const l=this._layoutController.controllerForKey(a,o,r);i.push({id:a,item:{mri:t,message:e},layoutController:l}),this.setState({itemRenderInfo:i})}clearEvents(){this._layoutController.clearEvents()}_removeStreamItemsAndReturnNewState(e){let t=n.clone(this.state.itemRenderInfo);return{itemRenderInfo:n.filter(t,(t=>t.id!==e))}}render(){const e=n.map(this.state.itemRenderInfo,this._renderItem),t=[b.container,this.props.isDesktop?void 0:this._backgroundColorStyle,this.props.style],i=!this.props.isDesktop&&e.length>0?o.createElement(o.View,{style:b.dismissalView,onPress:this._onDismissalTap}):void 0;return o.createElement(o.Animated.View,{style:t,onLayout:this._onLayoutChange,ignorePointerEvents:!0},i,e)}}t.default=T},77554:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PhotoEventStreamItem=void 0;const a=i(16778),n=i(88837),o=i(86374),s=i(74313),r=i(39285),l=i(36400),c=i(10117),d=i(15877),u=i(33754),h=i(12762),p=i(18078),g=i(81760),C=i(11828),m=i(80837),S=i(75865),y=i(2301),f=i(67977),_=(0,d.lazyProperties)({container:()=>a.Styles.createViewStyle({position:"absolute"}),innerContainer:()=>a.Styles.createViewStyle({borderRadius:10,backgroundColor:g.Color.white,justifyContent:"center",alignItems:"flex-end",flexDirection:"row"}),imageView:()=>a.Styles.createViewStyle({borderTopLeftRadius:10,borderTopRightRadius:10}),imageViewNoFooter:()=>a.Styles.createViewStyle({borderRadius:10}),attributionView:()=>a.Styles.createViewStyle({position:"absolute",top:10,left:10}),closeButtonContainer:()=>a.Styles.createViewStyle({position:"absolute",top:0,right:0,width:50,height:50,alignItems:"center",justifyContent:"center"}),closeButton:()=>a.Styles.createViewStyle({backgroundColor:g.Color.blackOverlay35,width:30,height:30,borderRadius:15,alignItems:"center",justifyContent:"center"})});class b extends n.ComponentBase{constructor(){super(...arguments),this._onPan=e=>{this.props.onPan&&this.props.onPan(this.props.eventId,e)},this._onComponentRef=e=>{this._viewRef=e||void 0},this._onTap=e=>{this.props.onTap&&this.props.onTap(this.props.eventId,this._getRef)},this._getRef=()=>this.isComponentMounted()?this._viewRef:void 0,this._onLoad=e=>{this.props.onLoad&&this.props.onLoad(this.props.eventId)},this._onClose=()=>{this.props.onClose&&this.props.onClose(this.props.eventId)}}_buildState(e,t){let i,a=!1;if(e.message){const t=o.decode(e.message).getFirstUriObjectChild(h.PictureNode);i=t&&t.getDisplayUrlAsThumbnailSanitized(),a=p.default.isMyMri(e.message.creator)}return{thumbnailUrl:i?S.default.getAuthenticatedUrl(i):void 0,postedByCurrentUser:a}}render(){const e=[_.container,m.default.overflowVisible],t=[m.default.absoluteFill,_.innerContainer],i=[this.state.postedByCurrentUser?_.imageViewNoFooter:_.imageView];this.props.layoutController&&(e.push(this.props.layoutController.getRectStyles()),i.push(this.props.layoutController.getImageStyle()),t.push(this.props.layoutController.getPositionStyles()));const n=a.createElement(r.default,{key:"attribution",style:_.attributionView},a.createElement(y.UserIcon,{userMri:this.props.message.creator,size:f.UserIconSize.Size30,showBorder:!0})),o=this.props.onClose?a.createElement(l.HoverableButton,{key:"closebutton",style:_.closeButtonContainer,accessibilityLabel:u.getString("CallPanel.ClosePhoto"),onPress:this._onClose},a.createElement(a.View,{style:_.closeButton},a.createElement(c.default,{icon:C.SkypeIcon.Cancel,size:C.IconSize.size16,color:g.Color.white}))):void 0,d=[m.default.absoluteFill,m.default.pointerCursor],h=[a.createElement(a.GestureView,{key:"imagecontainer",style:d,onPanHorizontal:this._onPan,onTap:this._onTap},a.createElement(s.default,{origin:"PhotoEvent",containerStyle:m.default.absoluteFill,style:i,source:this.state.thumbnailUrl,resizeMode:"cover",onLoad:this._onLoad})),n,o],p=a.createElement(a.Animated.View,{style:t,ignorePointerEvents:!0},h);return a.createElement(a.Animated.View,{ref:this._onComponentRef,style:e,ignorePointerEvents:!0},p)}}t.PhotoEventStreamItem=b,t.default=b},7015:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocalPrivacyToastComponent=t.RemotePrivacyToastComponent=void 0;const a=i(16778),n=i(61541),o=i(94224),s=i(68580),r=i(80200),l=i(98278),c=i(44973),d=i(53143),u=i(52262),h=i(46096),p=i(13944),g=i(36237),C=i(15877),m=i(33754),S=i(81760),y=i(11828),f=i(59433),_=i(19675),b=i(18037),T=(0,C.lazyProperties)({container:()=>a.Styles.createViewStyle({flex:1,justifyContent:"center",paddingHorizontal:l.CompositeNotificationToastInfo.horizontal,paddingVertical:10}),leftContentContainer:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",paddingHorizontal:10}),stopRecordingContentContainer:()=>a.Styles.createViewStyle({paddingHorizontal:5,flexDirection:"row"}),statusContentContainer:()=>a.Styles.createViewStyle({flex:1,alignItems:"center",flexDirection:"row"}),privacyStatementContainer:()=>a.Styles.createViewStyle({flex:1,alignItems:"center",flexDirection:"row"}),privacyStatementTextStyle:()=>a.Styles.createTextStyle({flex:1,color:S.Color.white,wordBreak:"break-word",paddingRight:10,textAlign:"right"}),statusTextStyle:()=>a.Styles.createTextStyle({flex:1,wordBreak:"break-word",paddingLeft:10}),linkStyle:()=>a.Styles.createTextStyle({color:S.Color.sxBlue})});class v extends n.RemoteBaseCallRecorderToast{_buildState(e,t){const i=d.default.getToast(e.id);if(i&&i.state){const t=i.state,a=o.default.CallingStore.getCallState(t.callId);return{callId:t.callId,callState:a,shouldToastBeRemoved:e.shouldToastBeRemoved(a),initiatorDisplayName:e.initiatorMri?u.default.getMemberShortNameForConversation(t.conversationMri,e.initiatorMri):void 0}}return{}}render(){const e=a.createElement(c.default,{icons:this.props.icons});let t,i;return this.state.initiatorDisplayName?t=m.getString(this.props.notificationTextPath,{name:this.state.initiatorDisplayName}):this.props.initialNotificationTextPath&&(t=m.getString(this.props.initialNotificationTextPath)),t&&(i=a.createElement(_.BodyText,{style:[T.statusTextStyle,this._themeStyles.headerTextColorStyle],allowFontScaling:!1},t)),a.createElement(a.View,{style:T.container},a.createElement(a.View,{style:T.leftContentContainer},a.createElement(a.View,{style:T.statusContentContainer},e,i)))}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),!this.state.shouldToastBeRemoved&&s.default.isCallStateActive(this.state.callState)||(g.log(h.LogTraceArea.CallingUI,"RemotePrivacyToastComponent.componentDidUpdate removing toast"),d.default.removeToast(this.props.id))}}t.RemotePrivacyToastComponent=v;class w extends n.LocalBaseCallRecorderToast{_buildState(e,t){const i=d.default.getToast(e.id);if(i&&i.state){const a=i.state,n=o.default.CallingStore.getCallState(a.callId);return{callId:a.callId,showPrivacyLink:t||!(!this.state||!this.state.showPrivacyLink),callState:n,shouldToastBeRemoved:e.shouldToastBeRemoved(n),recordingTimestamp:e.getTimestamp(),useAccessibleTheme:b.default.useAccessibleTheme()}}return{}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.state.shouldToastBeRemoved&&(g.log(h.LogTraceArea.CallingUI,"LocalPrivacyToastComponent.componentDidUpdate removing toast"),d.default.removeToast(this.props.id,r.ToastActionType.Dismissed,!0))}render(){const e=[{icon:y.SkypeIcon.CallRecordStroke,color:this._themeColors.headerIconColor},{icon:y.SkypeIcon.CallRecordDot,color:S.Color.red}];let t,i=a.createElement(a.Button,{onPress:this._onStopPress,accessibilityLabel:m.getString(this.props.stopLinkTextPath)},a.createElement(c.default,{icons:e}));this.state.recordingTimestamp&&(t=a.createElement(_.BodyText,{style:[T.statusTextStyle,this._themeStyles.headerTextColorStyle],allowFontScaling:!1},this._getElapsedTime()));const n=a.createElement(a.View,{style:T.stopRecordingContentContainer},t,a.createElement(_.BodyText,{style:T.statusTextStyle,allowFontScaling:!1},a.createElement(f.default,{url:"#",style:this.state.useAccessibleTheme?this._themeStyles.headerTextColorStyle:T.linkStyle,allowFontScaling:!1,onPress:this._onStopPress},m.getString(this.props.stopLinkTextPath))));let o;if(this.state.showPrivacyLink){const e=a.createElement(f.default,{url:"#",style:this.state.useAccessibleTheme?this._themeStyles.headerTextColorStyle:T.linkStyle,allowFontScaling:!1,onPress:this._onMorePrivacyInfoPress},m.getString(this.props.morePrivacyInfoLinkTextPath));o=a.createElement(a.View,{style:T.privacyStatementContainer},a.createElement(_.BodyText,{style:[T.privacyStatementTextStyle,this._themeStyles.headerTextColorStyle],allowFontScaling:!1},m.getString(this.props.privacyStatementTextPath)," ",e),a.createElement(p.default,{icon:y.SkypeIcon.ClosePanel,size:y.IconSize.size20,color:this._themeColors.headerIconColor,hoverColor:this._themeColors.primaryIconColor,title:m.getString("Global.CloseButtonTitle"),onPress:this._onDismissPrivacyInfoPress}))}return a.createElement(a.View,{style:T.container},a.createElement(a.View,{style:T.leftContentContainer},a.createElement(a.View,{style:T.statusContentContainer},i,n,o)))}}t.LocalPrivacyToastComponent=w},23680:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(80837),o=i(24576);class s extends o.default{constructor(){super(...arguments),this._isBalancePanelCollapsed=!1,this._balancePanelExpandedAnimatedHeight=new a.Animated.Value(0),this._balancePanelExpandedAnimatedStyles=a.Styles.createAnimatedViewStyle({height:this._balancePanelExpandedAnimatedHeight}),this._isBalancePanelCollapsedOnCompletion=!1,this._isCollapsed=()=>this._isBalancePanelCollapsed||this._isBalancePanelCollapsedOnCompletion,this.toggleBalancePanelVisibility=e=>{if(!this.state.balancePanelExpandedHeight||!this._balancePanelExpandedAnimatedHeight)return;if(this._isBalancePanelCollapsed===e)return;if(this.props.onCannotToggle&&this.props.onCannotToggle(e))return;if(this._balancePanelInProgressAnimation){if(this._isBalancePanelCollapsedOnCompletion===e)return;this._balancePanelInProgressAnimation.stop(),this._balancePanelInProgressAnimation=void 0}this._isBalancePanelCollapsedOnCompletion=e;const t=[];e?t.push(a.Animated.timing(this._balancePanelExpandedAnimatedHeight,{toValue:0,duration:10,easing:a.Animated.Easing.Out(),isInteraction:!1})):t.push(a.Animated.timing(this._balancePanelExpandedAnimatedHeight,{toValue:this.state.balancePanelExpandedHeight,duration:10,easing:a.Animated.Easing.In()}));const i=e=>{this._balancePanelInProgressAnimation=void 0,this._isBalancePanelCollapsed=e,this.forceUpdate()};this._balancePanelInProgressAnimation=a.Animated.parallel(t),this._balancePanelInProgressAnimation.start((()=>{i(e)}))},this._onLayout=e=>{this.state.balancePanelExpandedHeight||!this.isComponentMounted()||this.props.isInLandscape||this._isCollapsed()||(this._balancePanelExpandedAnimatedHeight.setValue(e.height),this.setState({balancePanelExpandedHeight:e.height,useAnimatedLayout:!0}))}}_buildState(e,t){return{balancePanelExpandedHeight:t?void 0:this.state.balancePanelExpandedHeight,useAnimatedLayout:!t&&this.state.useAnimatedLayout}}render(){let e;return a.UserInterface.isNavigatingWithKeyboard()&&this._isBalancePanelCollapsed&&(e=n.default.displayNone),!this.props.isInLandscape&&this.state.useAnimatedLayout?a.createElement(a.View,{style:e,onLayout:this._onLayout},a.createElement(a.Animated.View,{style:this._balancePanelExpandedAnimatedStyles},this.props.children)):a.createElement(a.View,{style:e,onLayout:this._onLayout},this.props.children)}}t.default=s},45247:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(13944),o=i(15877),s=i(33754),r=i(29130),l=i(81760),c=i(11828),d=i(80837),u=i(24576),h=(0,o.lazyProperties)({dialerWrapper:()=>a.Styles.createViewStyle({backgroundColor:l.Color.darkThemeSecondaryBackground,flexDirection:"column",flexGrow:1,flexShrink:0,overflow:"visible"}),collapsedDialpadButtonContainer:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"center"}),dialpadIcon:()=>a.Styles.createButtonStyle({borderRadius:20,flexGrow:1,paddingVertical:15})});class p extends u.default{constructor(){super(...arguments),this._isDialpadCollapsed=!1,this._useAnimatedLayout=!1,this._dialpadExpandedAnimatedHeight=new a.Animated.Value(0),this._dialpadExpandedAnimatedStyles=a.Styles.createAnimatedViewStyle({height:this._dialpadExpandedAnimatedHeight}),this._dialpadCollapsedAnimatedHeight=new a.Animated.Value(0),this._dialpadCollapsedAnimatedStyles=a.Styles.createAnimatedViewStyle({height:this._dialpadCollapsedAnimatedHeight}),this._isDialpadCollapsedOnCompletion=!1,this.toggleDialpadToCollapsedState=e=>{this._isDialpadCollapsed!==e&&this._dialpadAnimation(e)},this.isCollapsed=()=>this._isDialpadCollapsed||this._isDialpadCollapsedOnCompletion,this._dialpadAnimation=e=>{if(!this.state.dialpadExpandedHeight||!this._useAnimatedLayout)return;if(this._dialpadInProgressAnimation){if(this._isDialpadCollapsedOnCompletion===e)return;this._dialpadInProgressAnimation.stop(),this._dialpadInProgressAnimation=void 0}this._isDialpadCollapsedOnCompletion=e,this.props.onToggleStart&&this.props.onToggleStart(e);const t=[];e?(t.push(a.Animated.timing(this._dialpadExpandedAnimatedHeight,{toValue:0,duration:210,easing:a.Animated.Easing.Out()})),t.push(a.Animated.timing(this._dialpadCollapsedAnimatedHeight,{toValue:54,duration:30,easing:a.Animated.Easing.In()}))):(t.push(a.Animated.timing(this._dialpadCollapsedAnimatedHeight,{toValue:0,duration:30,easing:a.Animated.Easing.Out()})),t.push(a.Animated.timing(this._dialpadExpandedAnimatedHeight,{toValue:this.state.dialpadExpandedHeight,duration:210,easing:a.Animated.Easing.In()})));const i=e=>{this._dialpadInProgressAnimation=void 0,this.isComponentMounted()&&(this._isDialpadCollapsed=e,this.props.onToggleCompletion&&this.props.onToggleCompletion(e),this.forceUpdate())};this._dialpadInProgressAnimation=a.Animated.sequence(t),this._dialpadInProgressAnimation.start((()=>{i(e)}))},this._onPanVertical=e=>{this.props.isInLandscape||e.isComplete&&Math.abs(e.velocityY)>.2&&(e.velocityY<0?this.toggleDialpadToCollapsedState(!1):this.toggleDialpadToCollapsedState(!0))},this._onPressDialpadViewCollapsed=e=>{e&&(e.stopPropagation(),e.preventDefault()),this.toggleDialpadToCollapsedState(!1)},this._onLayout=e=>{!this.isComponentMounted()||this.props.isInLandscape||this.isCollapsed()||this._useAnimatedLayout||(this._useAnimatedLayout=!0,this.setState({dialpadExpandedHeight:e.height}),this.props.onHeightsChanged&&this.props.onHeightsChanged(e.height,54))},this._renderDialpadViewCollapsed=()=>{const e=[h.dialerWrapper];this._useDarkTheme()||e.push(this._themeStyles.searchBoxColorStyle);const t=this._isDialpadCollapsed||!1,i=s.getString("PeopleList.PstnDialpadLabel");return a.createElement(a.Animated.View,{style:[this._dialpadCollapsedAnimatedStyles,e]},a.createElement(a.View,{style:h.collapsedDialpadButtonContainer,importantForAccessibility:t?a.Types.ImportantForAccessibility.No:a.Types.ImportantForAccessibility.NoHideDescendants},a.createElement(n.default,{icon:c.SkypeIcon.Dialpad,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.primaryIconColor,size:c.IconSize.size24,style:h.dialpadIcon,onPress:this._onPressDialpadViewCollapsed,tabIndex:t?void 0:-1,title:i,accessibilityLabel:i})))}}_buildState(e,t){const i=this._getRootViewId();return{dialpadExpandedHeight:t?void 0:this.state.dialpadExpandedHeight,viewWidth:r.default.getWidth(i),viewHeight:r.default.getHeight(i)}}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),t.dialpadExpandedHeight&&this.state.dialpadExpandedHeight!==t.dialpadExpandedHeight?this._dialpadExpandedAnimatedHeight.setValue(t.dialpadExpandedHeight):this.props.isInLandscape||e.isInLandscape||this.state.viewWidth===t.viewWidth&&this.state.viewHeight===t.viewHeight||(this._useAnimatedLayout=!1,this.isCollapsed()&&(this._dialpadInProgressAnimation&&(this._dialpadInProgressAnimation.stop(),this._dialpadInProgressAnimation=void 0),this._dialpadCollapsedAnimatedHeight.setValue(0),this._isDialpadCollapsed=!1,this._isDialpadCollapsedOnCompletion=!1))}render(){if(this.props.isInLandscape)return a.createElement(a.View,{style:d.default.flexOne},this.props.children);let e;if(this._useAnimatedLayout){const t=[this._dialpadExpandedAnimatedStyles];a.UserInterface.isNavigatingWithKeyboard()&&this._isDialpadCollapsed&&t.push(d.default.displayNone),e=a.createElement(a.View,{onLayout:this._onLayout},a.createElement(a.Animated.View,{style:t},this.props.children),this._renderDialpadViewCollapsed())}else e=a.createElement(a.View,{onLayout:this._onLayout},this.props.children,this._renderDialpadViewCollapsed());return e}}t.default=p},55336:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(24576);class o extends n.default{constructor(){super(...arguments),this._animatedHeight=new a.Animated.Value(0),this._animatedStyles=a.Styles.createAnimatedViewStyle({height:this._animatedHeight})}toggleToCollapsedState(){this._animatedHeight.setValue(this.state.collapsedHeight)}toggleToExpandedState(){this._animatedHeight.setValue(this.state.expandedHeight)}toggleToHiddenState(){this._animatedHeight.setValue(0)}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this.state.expandedHeight!==t.expandedHeight&&this._animatedHeight.setValue(t.expandedHeight)}render(){return this.props.isInLandscape?null:a.createElement(a.Animated.View,{style:this._animatedStyles})}}t.default=o},97306:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(44770),o=i(62633),s=i(36237),r=i(61253),l=i(15877),c=i(35426),d=i(86045),u=i(81760),h=i(80837),p=i(19675),g=i(24576),C=(0,l.lazyProperties)({callRateStyle:()=>a.Styles.createTextStyle({paddingHorizontal:20,color:u.Color.white,backgroundColor:u.Color.transparent,marginBottom:10}),image:()=>a.Styles.createViewStyle({height:110,width:158})});class m extends g.default{_buildState(e,t){const i=o.default.getCallRate(),a=o.default.tasterImageEnabled();return{callRateMessage:i.message,isTasterEligible:i.isTasterEligible,tasterImageEnabled:a}}componentDidMount(){super.componentDidMount(),this.state.isTasterEligible&&this.state.tasterImageEnabled&&s.track(new c.TasterImageShown)}shouldComponentUpdate(e,t){return!(0,r.default)(this.state,t)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),t.isTasterEligible&&t.tasterImageEnabled||!this.state.isTasterEligible||!this.state.tasterImageEnabled||s.track(new c.TasterImageShown),t.callRateMessage!==this.state.callRateMessage&&this.state.callRateMessage&&d.default.shouldAnnounceForAccessibility()&&a.Accessibility.announceForAccessibility(this.state.callRateMessage)}render(){if(void 0===this.state.callRateMessage)return null;const e=[C.callRateStyle];!this._useDarkTheme()&&this._useAccessibleTheme()&&e.push(this._themeStyles.primaryTextColorStyle);const t=a.createElement(p.Subtitle,{style:e},this.state.callRateMessage);return this.state.isTasterEligible&&this.state.tasterImageEnabled?a.createElement(a.View,{style:h.default.alignItemsCenter},a.createElement(a.Image,{source:n.Collection.TASTER_POST_CALL_ILLUSTRATION,style:C.image,resizeMode:"contain"}),t):t}}t.default=m},17456:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(34828),o=i(16778),s=i(98278),r=i(18432),l=i(15877),c=i(33754),d=i(30124),u=i(51070),h=i(86045),p=i(85683),g=i(80837),C=i(24576),m=i(12770),S=(0,l.lazyProperties)({sectionHeader:()=>o.Styles.createViewStyle({height:40,flexDirection:"row",alignItems:"center",paddingHorizontal:12})}),y="country",f="header",_=e=>({key:e.country,height:60,template:y}),b=e=>({key:"recent_"+e.country,height:60,template:y});class T extends C.default{constructor(){super(...arguments),this._onCountrySelect=e=>{this.props.onSelect(e.country)},this._renderCountryItem=e=>{const t=this.props.recentCountries&&this.props.recentCountries[e.key]||this.props.countries[e.key];return o.createElement(r.default,{filter:this.state.filter,country:t,onSelect:this._onCountrySelect})},this._renderHeaderItem=e=>o.createElement(o.View,{style:S.sectionHeader},o.createElement(p.SectionTitle,{key:e.key,title:e.key,titleStyles:g.default.flexOne})),this._renderItem=e=>{switch(e.template){case f:return this._renderHeaderItem(e);case y:return this._renderCountryItem(e);default:return[]}},this._filterCountries=e=>{var t;return e&&a.includes(e.countryName.toLowerCase(),null===(t=this.state.filter)||void 0===t?void 0:t.toLowerCase())}}_buildState(e,t){return{isUsingStackNavigationContext:d.default.isUsingStackNavigationContext(),safeAreaPaddingStyle:u.default.horizontalPaddingStyle(s.HorizontalInsetDefault)}}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),this.state.filter&&this.state.filter!==t.filter){this._cancelAnnoncement();const e=c.getString("PSTNCountryList.SearchResult",{count:a.size(this._filteredCountries)});this._announceForAccessibility(e,500)}}render(){const e=[g.default.flexOne];return this.state.safeAreaPaddingStyle&&e.push(this.state.safeAreaPaddingStyle),o.createElement(o.View,{style:e},o.createElement(n.VirtualListView,{itemList:this._getCountriesListItems(),renderItem:this._renderItem,animateChanges:!1,keyboardShouldPersistTaps:!0,keyboardDismissMode:"on-drag"}))}onFilterChange(e){this.isComponentMounted()&&this.setState({filter:e})}_getListHeader(e){return{key:e,height:40,template:f,isNavigable:!1,accessibilityGroup:n.Types.AccessibilityGroupMarker.Begin,accessibilityGroupLabel:e}}_getCountriesListItems(){this._filteredCountries=this.state.filter?a.filter(this.props.countries,this._filterCountries):a.values(this.props.countries);const e=a.map(this._filteredCountries,_);if(this.state.filter||a.isEmpty(this.props.recentCountries)){const t=[];return this.state.isUsingStackNavigationContext||t.push(this._getListHeader(c.getString("PSTNCountryList.Result"))),a.concat(t,e)}const t=a.filter(this.props.recentCountries,(e=>!!e)),i=a.map(t,b),n=[this._getListHeader(c.getString("PSTNCountryList.Recent"))],o=[this._getListHeader(c.getString("PSTNCountryList.All"))];return a.concat(n,i,o,e)}_announceForAccessibility(e,t=0){this._announcePromise=m.default.sleep(t).then((()=>h.default.maybeAnnounceForAccessibility(e)))}_cancelAnnoncement(){this._announcePromise&&(this._announcePromise.cancel(),this._announcePromise=void 0)}}t.default=T},18432:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(15877),o=i(51072),s=i(89808),r=i(11010),l=i(19675),c=i(24576),d=(0,n.lazyProperties)({countryListItemCode:()=>a.Styles.createTextStyle({flex:0,marginHorizontal:20,textAlign:"right"}),countryListItemName:()=>a.Styles.createTextStyle({flex:1,flexDirection:"row",marginHorizontal:20}),countryListItem:()=>a.Styles.createViewStyle({alignItems:"center",borderBottomWidth:1,flexDirection:"row",height:60,justifyContent:"space-between"})});class u extends c.default{constructor(){super(...arguments),this._onPress=()=>{this.props.onSelect(this.props.country)}}render(){let e;const t=r.default.rowTitleFontStyle(this._currentTheme),i=[t,s.default.getTextColorStyleNoSubscription()],n=[t,this._themeStyles.secondaryTextColorStyle,d.countryListItemCode];if(this.props.filter){const n=this.props.country.countryName.toLowerCase().indexOf(this.props.filter.toLowerCase()),o=this.props.country.countryName.substr(0,n),s=this.props.country.countryName.substr(n,this.props.filter.length),r=this.props.country.countryName.substr(o.length+s.length);e=a.createElement(a.Text,{style:d.countryListItemName,numberOfLines:1},a.createElement(a.Text,{style:t},o),a.createElement(a.Text,{style:i},s),a.createElement(a.Text,{style:t},r))}else e=a.createElement(a.Text,{style:d.countryListItemName,numberOfLines:1},a.createElement(l.RowTitle,null,this.props.country.countryName));return a.createElement(o.default.Button,{style:[d.countryListItem,this._themeStyles.dividerBorderColorStyle],onPress:this._onPress,underlayColor:this._themeColors.rowHighlightColor,accessibilityLabel:`${this.props.country.countryName} +${this.props.country.countryCode}`,accessibilityTraits:a.Types.AccessibilityTrait.Button,importantForAccessibility:a.Types.ImportantForAccessibility.Yes},e,a.createElement(a.Text,{style:n},"+",this.props.country.countryCode))}}t.default=u},56586:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(16778),o=i(50781),s=i(62633),r=i(90580),l=i(47126),c=i(15877),d=i(33754),u=i(61230),h=(0,c.lazyProperties)({dialpad:()=>n.Styles.createViewStyle({flexGrow:1,flexShrink:0,marginHorizontal:5}),row:()=>n.Styles.createViewStyle({flexDirection:"row",flexGrow:1,flexShrink:0}),rowReverse:()=>n.Styles.createViewStyle({flexDirection:"row-reverse",flexGrow:1,flexShrink:0})}),p={dialpad:(0,c.lazyProperties)({MobileSmall:()=>n.Styles.createViewStyle({marginVertical:5}),MobileMedium:()=>n.Styles.createTextStyle({marginVertical:10}),MobileDefaultLandscape:()=>n.Styles.createTextStyle({marginVertical:10}),MobileDefault:()=>n.Styles.createTextStyle({marginVertical:15}),DesktopDefault:()=>n.Styles.createTextStyle({marginVertical:5})})},g=/[\r\n]+/;class C extends u.ResponsiveComponentBase{constructor(e){super(e),this._focusedButtonIndex=0,this._dialpadButtons=[],this._dialpadButtonRefCallbacks={},this._dialpadButtonPressCallbacks={},this._getLocalizationLetters=e=>{let t;switch(e){default:case"ABC":t=d.getString("PSTNDialerPanel.DialpadLocalizationLetters_ABC");break;case"DEF":t=d.getString("PSTNDialerPanel.DialpadLocalizationLetters_DEF");break;case"GHI":t=d.getString("PSTNDialerPanel.DialpadLocalizationLetters_GHI");break;case"JKL":t=d.getString("PSTNDialerPanel.DialpadLocalizationLetters_JKL");break;case"MNO":t=d.getString("PSTNDialerPanel.DialpadLocalizationLetters_MNO");break;case"PQRS":t=d.getString("PSTNDialerPanel.DialpadLocalizationLetters_PQRS");break;case"TUV":t=d.getString("PSTNDialerPanel.DialpadLocalizationLetters_TUV");break;case"WXYZ":t=d.getString("PSTNDialerPanel.DialpadLocalizationLetters_WXYZ")}return a.split(t,g)},this._onKeyPress=e=>{let t=-1;if(e.keyCode===l.default.UP?t=0:e.keyCode===l.default.RIGHT?t=1:e.keyCode===l.default.DOWN?t=2:e.keyCode===l.default.LEFT&&(t=3),t>=0){let i=this._buttonsNavigationMap[this._focusedButtonIndex][t],a=this._dialpadButtons[i];for(;a&&a.props.buttonDisabled;)i=this._buttonsNavigationMap[i][t],a=this._dialpadButtons[i];this._focusButton(a),e.preventDefault(),e.stopPropagation()}},this._onKeyLongPress=e=>t=>{this.props.onKeyLongPress&&this.props.onKeyLongPress(e)},this._onButtonFocused=e=>{const t=this._focusedButtonIndex;if(this._focusedButtonIndex=a.findIndex(this._dialpadButtons,(t=>t&&t.props.value===e.props.title))||0,this._focusedButtonIndex!==t){const e=this._dialpadButtons[t];e&&e.resetFocus()}},this._buttons={1:void 0,2:this._getLocalizationLetters("ABC"),3:this._getLocalizationLetters("DEF"),4:this._getLocalizationLetters("GHI"),5:this._getLocalizationLetters("JKL"),6:this._getLocalizationLetters("MNO"),7:this._getLocalizationLetters("PQRS"),8:this._getLocalizationLetters("TUV"),9:this._getLocalizationLetters("WXYZ"),"*":e.isDtmfDialpad?void 0:[","],",":void 0,0:["+"],"#":void 0},this._buttonsNavigationMap={0:[9,1,3,2],1:[10,2,4,0],2:[11,0,5,1],3:[0,4,6,5],4:[1,5,7,3],5:[2,3,8,4],6:[3,7,9,8],7:[4,8,10,6],8:[5,6,11,7],9:[6,10,0,11],10:[7,11,1,9],11:[8,9,2,10]}}_buildState(e,t){const i=super._buildState(e,t);return i.isCollapsed=s.default.isDialpadCollapsed(),i.isDialingExtension=s.default.isDialingExtension(),i.showCommaButton=!s.default.isDialingExtension()&&!e.isDtmfDialpad,i.canDialComma=s.default.canDialComma(),i}componentDidMount(){super.componentDidMount(),o.default.isCallingBundleLoaded()||(this._dialpadButtons.forEach((e=>null==e?void 0:e.toggleDisabledState(!0))),o.default.getCallingBundleStartupable().performAfterInitialized().then((()=>{this._dialpadButtons.forEach((e=>null==e?void 0:e.toggleDisabledState(!1)))})))}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),!this.props.isDtmfDialpad&&t.showCommaButton!==this.state.showCommaButton){let e=this._dialpadButtons[this._focusedButtonIndex];e&&e.props.buttonDisabled&&(e.resetFocus(),e=this._dialpadButtons[0],e&&e.setLastFocused())}}_getRowsCount(){let e=0;return a.each(this._buttons,(t=>{const i=a.size(t);return!(e<i&&(e=i,2===e))})),e+1}focusFirst(){this._focusButton(this._dialpadButtons[0]),n.Accessibility.announceForAccessibility("1")}render(){const e=[h.dialpad,this._chooseResponsiveStyle(p.dialpad)],t=this._getContext().isRTL?h.rowReverse:h.row,i=this._getRowsCount(),a={onButtonFocused:this._onButtonFocused,isInLandscape:this.props.isInLandscape,isDtmfDialpad:this.props.isDtmfDialpad,disableFontScaling:this.props.disableFontScaling};return n.createElement(n.View,{style:e,onKeyPress:this._onKeyPress,importantForAccessibility:this.state.isCollapsed?n.Types.ImportantForAccessibility.NoHideDescendants:void 0},n.createElement(n.View,{style:t},n.createElement(r.default,Object.assign({value:"1",rowCount:i,letters:this._buttons[1],ref:this._getDialpadButtonRefCallback(0),onPress:this._getDialpadButtonPressCallback("1")},a)),n.createElement(r.default,Object.assign({value:"2",rowCount:i,letters:this._buttons[2],ref:this._getDialpadButtonRefCallback(1),onPress:this._getDialpadButtonPressCallback("2")},a)),n.createElement(r.default,Object.assign({value:"3",rowCount:i,letters:this._buttons[3],ref:this._getDialpadButtonRefCallback(2),onPress:this._getDialpadButtonPressCallback("3")},a))),n.createElement(n.View,{style:t},n.createElement(r.default,Object.assign({value:"4",rowCount:i,letters:this._buttons[4],ref:this._getDialpadButtonRefCallback(3),onPress:this._getDialpadButtonPressCallback("4")},a)),n.createElement(r.default,Object.assign({value:"5",rowCount:i,letters:this._buttons[5],ref:this._getDialpadButtonRefCallback(4),onPress:this._getDialpadButtonPressCallback("5")},a)),n.createElement(r.default,Object.assign({value:"6",rowCount:i,letters:this._buttons[6],ref:this._getDialpadButtonRefCallback(5),onPress:this._getDialpadButtonPressCallback("6")},a))),n.createElement(n.View,{style:t},n.createElement(r.default,Object.assign({value:"7",rowCount:i,letters:this._buttons[7],ref:this._getDialpadButtonRefCallback(6),onPress:this._getDialpadButtonPressCallback("7")},a)),n.createElement(r.default,Object.assign({value:"8",rowCount:i,letters:this._buttons[8],ref:this._getDialpadButtonRefCallback(7),onPress:this._getDialpadButtonPressCallback("8")},a)),n.createElement(r.default,Object.assign({value:"9",rowCount:i,letters:this._buttons[9],ref:this._getDialpadButtonRefCallback(8),onPress:this._getDialpadButtonPressCallback("9")},a))),n.createElement(n.View,{style:t},n.createElement(r.default,Object.assign({overrideKey:"buttonStarComma",value:this.state.showCommaButton?",":"*",accessibilityLabel:this.state.showCommaButton?d.getString("KeyboardShortcuts.CommaKey"):void 0,rowCount:i,letters:this._buttons[this.state.showCommaButton?",":"*"],longPressValue:this.props.isDtmfDialpad||this.state.showCommaButton?void 0:",",buttonDisabled:!this.props.isDtmfDialpad&&!this.state.canDialComma,ref:this._getDialpadButtonRefCallback(9),onPress:this._getDialpadButtonPressCallback(this.state.showCommaButton?",":"*"),onLongPress:this.props.isDtmfDialpad||this.state.showCommaButton?void 0:this._onKeyLongPress("*")},a)),n.createElement(r.default,Object.assign({value:"0",rowCount:i,letters:this._buttons[0],longPressValue:"+",ref:this._getDialpadButtonRefCallback(10),onPress:this._getDialpadButtonPressCallback("0"),onLongPress:this._onKeyLongPress("0")},a)),n.createElement(r.default,Object.assign({value:"#",rowCount:i,letters:this._buttons["#"],buttonDisabled:!this.props.isDtmfDialpad&&!this.state.isDialingExtension,ref:this._getDialpadButtonRefCallback(11),onPress:this._getDialpadButtonPressCallback("#")},a))))}_getDialpadButtonRefCallback(e){return this._dialpadButtonRefCallbacks[e]||(this._dialpadButtonRefCallbacks[e]=t=>{this._dialpadButtons[e]=t||void 0}),this._dialpadButtonRefCallbacks[e]}_getDialpadButtonPressCallback(e){return this._dialpadButtonPressCallbacks[e]||(this._dialpadButtonPressCallbacks[e]=t=>{this.props.onKeyPress&&this.props.onKeyPress(e)}),this._dialpadButtonPressCallbacks[e]}_focusButton(e){e&&e.requestFocus()}}t.default=C},90580:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(94224),o=i(46096),s=i(36237),r=i(15877),l=(i(33754),i(89871)),c=i(61230),d=i(81760),u=i(11010),h=i(19675),p=i(53374),g=(0,r.lazyProperties)({dialpadButton:()=>a.Styles.createViewStyle({alignItems:"center",flexBasis:0,flexDirection:"row",flexGrow:1,flexShrink:0,justifyContent:"center",minHeight:46}),dialpadButtonContent:()=>a.Styles.createViewStyle({alignSelf:"center",flexDirection:"column",flexGrow:1,flexShrink:0}),dialpadButtonContentLandscape:()=>a.Styles.createViewStyle({flexDirection:"row",flexGrow:0,width:50,overflow:"visible",flexWrap:"nowrap"}),buttonLettersContainer:()=>a.Styles.createViewStyle({alignSelf:"center",alignItems:"center"}),buttonLettersContainerLandsape:()=>a.Styles.createViewStyle({paddingLeft:7,alignItems:"flex-start"}),dialpadButtonNumber:()=>a.Styles.createTextStyle({font:u.default.font.uiDisplayBold,textAlign:"center"}),dialpadButtonLetters:()=>a.Styles.createTextStyle({lineHeight:16})}),C=(0,r.lazyProperties)({dialpadButtonNumber:()=>a.Styles.createTextStyle({color:d.Color.white,font:u.default.font.uiDisplayBold}),dialpadButtonLetters:()=>a.Styles.createTextStyle({color:d.Color.white})}),m={dialpadButton:(0,r.lazyProperties)({MobileDefaultLandscape:()=>a.Styles.createViewStyle({margin:void 0}),MobileDefault:()=>a.Styles.createViewStyle({margin:5}),DesktopSmall:()=>a.Styles.createTextStyle({margin:void 0}),DesktopDefault:()=>a.Styles.createTextStyle({margin:5})}),dialpadButtonNumber:(0,r.lazyProperties)({MobileSmall:()=>a.Styles.createTextStyle({fontSize:u.default.controlFontSize.h4,lineHeight:30}),MobileMedium:()=>a.Styles.createTextStyle({fontSize:u.default.controlFontSize.dialpadNumber,lineHeight:36}),MobileDefault:()=>a.Styles.createTextStyle({fontSize:u.default.controlFontSize.dialpadNumberLarge,lineHeight:42}),DesktopDefault:()=>a.Styles.createTextStyle({fontSize:u.default.controlFontSize.h4,lineHeight:30})})};class S extends c.ResponsiveComponentBase{constructor(){super(...arguments),this._onPress=e=>{if(this.props.buttonDisabled)return;const t=p.default.newCauseId();s.log(o.LogTraceArea.DialerStore,"DialpadButton._onPress causeId: "+t),this.props.isDtmfDialpad||(l.default.appendCharToPhoneNumberInput(this.props.value),n.default.PstnUtils.playDTMFSound(this.props.value,t)),this.props.onPress(e)},this._onLongPress=e=>{if(!this.props.buttonDisabled){if(!this.props.isDtmfDialpad){const e=p.default.newCauseId();s.log(o.LogTraceArea.DialerStore,"DialpadButton._onLongPress causeId: "+e),l.default.appendCharToPhoneNumberInput(this.props.longPressValue||this.props.value),n.default.PstnUtils.playDTMFSound(this.props.value,e)}this.props.onLongPress&&this.props.onLongPress(e)}},this._onButtonRef=e=>{this._buttonRef=e||void 0},this._onFocus=e=>{this.isComponentMounted()&&(this.props.onButtonFocused&&this._buttonRef&&!this.props.buttonDisabled&&this.props.onButtonFocused(this._buttonRef),this.setState({isLastFocusedBtn:!0}))}}_buildState(e,t){const i=super._buildState(e,t);return t&&(i.isLastFocusedBtn="1"===e.value),i}requestFocus(){this._buttonRef&&this._buttonRef.requestFocus()}resetFocus(){this.setState({isLastFocusedBtn:!1})}setLastFocused(){this.setState({isLastFocusedBtn:!0})}toggleDisabledState(e){this.setState({isDisabled:e})}render(){var e;const t=[g.dialpadButton,this._chooseResponsiveStyle(m.dialpadButton)],i=[g.dialpadButtonContent],n=[g.buttonLettersContainer];this.props.isInLandscape&&(i.push(g.dialpadButtonContentLandscape),n.push(g.buttonLettersContainerLandsape));const o=[a.Types.AccessibilityTrait.Button];let s=this.props.accessibilityLabel||this.props.value;return this.props.buttonDisabled&&o.push(a.Types.AccessibilityTrait.Disabled),a.createElement(a.Button,{style:t,key:this.props.overrideKey||"button"+this.props.value,ref:this._onButtonRef,onPress:this._onPress,onFocus:this._onFocus,title:this.props.value,onLongPress:this._onLongPress,disabled:this.props.buttonDisabled||null!==(e=this.state.isDisabled)&&void 0!==e&&e,accessibilityTraits:o,accessibilityLabel:s,tabIndex:this.state.isLastFocusedBtn?0:-1},a.createElement(a.View,{style:i,key:"view_"+this.props.value+"button"},this._getValue(),a.createElement(a.View,{style:n,key:"view_"+this.props.value+"letters"},this._getLetters())))}_getValue(){const e=[g.dialpadButtonNumber,this._themeStyles.primaryTextColorStyle,this._chooseResponsiveStyle(m.dialpadButtonNumber)];return this.props.isDtmfDialpad&&e.push(C.dialpadButtonNumber),a.createElement(a.Text,{style:e,key:"value"+this.props.value,allowFontScaling:!this.props.disableFontScaling},this.props.value)}_getLetters(){const e=[g.dialpadButtonLetters,this._themeStyles.primaryTextColorStyle];this.props.isDtmfDialpad&&e.push(C.dialpadButtonLetters);const t=[];for(let i=0;i<this.props.rowCount-1;i++)this.props.letters&&i in this.props.letters?t.push(a.createElement(h.Caption,{style:e,key:"letters"+this.props.value+i,allowFontScaling:!this.props.disableFontScaling,forceDirection:!0},this.props.letters[i])):this.props.isInLandscape||t.push(a.createElement(h.Caption,{style:e,key:"letters"+this.props.value+i,allowFontScaling:!this.props.disableFontScaling}," "));return t}}t.default=S},8113:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(39522),o=i(1866),s=i(62633),r=i(66649),l=i(15877),c=i(89871),d=i(69656),u=i(24576),h=(0,l.lazyProperties)({buttonsContainer:()=>a.Styles.createViewStyle({flex:0,flexDirection:"row",justifyContent:"center",marginBottom:15,minHeight:60,overflow:"visible",paddingLeft:5,paddingRight:5}),buttonWrapper:()=>a.Styles.createViewStyle({alignItems:"center",flex:1,flexBasis:0,flexDirection:"row",justifyContent:"center",minHeight:60})});class p extends u.default{constructor(){super(...arguments),this._callAllowed=()=>this.state.phoneNumber.callable&&!this.state.disableHighBandwidthOperations}shouldComponentUpdate(e,t){return!0}_buildState(e,t){return{isCollapsed:s.default.isDialpadCollapsed(),phoneNumber:c.default.getPhoneNumber(c.TriggerKeys.Callable),disableHighBandwidthOperations:r.default.isUsingGogoNetwork()}}render(){return a.createElement(a.View,{style:h.buttonsContainer,importantForAccessibility:this.state.isCollapsed?a.Types.ImportantForAccessibility.NoHideDescendants:a.Types.ImportantForAccessibility.No},a.createElement(a.View,{style:h.buttonWrapper},a.createElement(d.default,{phoneNumber:this.state.phoneNumber,canSendSms:this.state.phoneNumber.callable})),a.createElement(a.View,{style:h.buttonWrapper},a.createElement(o.default,{phoneNumber:this.state.phoneNumber,canCall:this._callAllowed(),callId:this.props.callId,conversationMri:this.props.conversationId})),a.createElement(a.View,{style:h.buttonWrapper},a.createElement(n.default,null)))}}t.default=p},39522:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(46096),o=i(13944),s=i(15877),r=i(33754),l=i(89871),c=i(86045),d=i(81760),u=i(40363),h=i(11828),p=i(24576),g=(0,s.lazyProperties)({backspaceButton:()=>a.Styles.createButtonStyle({width:60,height:60,alignItems:"center",flexBasis:0,flexDirection:"row",flexGrow:1,flexShrink:0,justifyContent:"center",minHeight:46})});class C extends p.default{constructor(){super(...arguments),this._onBackspace=e=>{const[t,i]=l.default.eraseCharFromPhoneNumberInput();t&&i?c.default.maybeAnnounceForAccessibility(r.getString("PSTNPhoneNumberInput.OnBackspaceAnnouncement",{symbol:t})):c.default.maybeAnnounceForAccessibility(r.getString("PSTNPhoneNumberInput.OnLongBackspaceAnnouncement"))},this._onLongBackspace=e=>{l.default.cleanupPhoneNumberInput(),c.default.maybeAnnounceForAccessibility(r.getString("PSTNPhoneNumberInput.OnLongBackspaceAnnouncement"))}}render(){const e=this._useDarkTheme()||this._useAccessibleTheme()?this._themeColors.headerIconColor:d.Color.black,t=r.getString("Pstn.RemoveNumberButton");return a.createElement(o.default,{icon:h.SkypeIcon.Backspace,color:e,hoverColor:e,size:h.IconSize.size24,style:g.backspaceButton,onPress:this._onBackspace,onLongPress:this._onLongBackspace,title:t,accessibilityLabel:t,flipIcon:this._getContext().isRTL&&u.default.getPlatformType()!==n.PlatformType.Android})}}t.default=C},1866:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(4736),o=i(94224),s=i(97775),r=i(11009),l=i(39549),c=i(36540),d=i(62633),u=i(46096),h=i(36237),p=i(15877),g=i(33754),C=i(4735),m=i(30124),S=i(89871),y=i(35426),f=i(81760),_=i(11828),b=i(24576),T=i(53374),v=(0,p.lazyProperties)({roundButton:()=>a.Styles.createButtonStyle({height:60,overflow:"visible",width:60})});class w extends b.default{constructor(){super(...arguments),this._coachMarkContext={coachMarkArea:r.CoachMarkAreaType.Dialer},this._startPstnCall=()=>{const e=T.default.newCauseId();h.log(u.LogTraceArea.CallingUI,"[action]: Start Call Button, causeId: "+e),h.track(new y.DialerPanelComponentClick(y.DialerPanelClickTarget.CallButton)),c.default.startOrAddPstnCall(this.props.phoneNumber.E164,this.props.phoneNumber.emergency,this.props.phoneNumber.countryCode,this.props.phoneNumber.suffix,this.props.callId,this.props.conversationMri,this.props.phoneNumber.extension),this._isJoinCallRequest()&&(this.state.isUsingStackNavigationContext?this.props.conversationMri&&this.props.callId&&(h.log(u.LogTraceArea.CallingUI,"CallControl._startPstnCall causeId: "+e),o.default.CallNavigationHelper.rejoinCall(this.props.conversationMri,this.props.callId,e,S.default.getPhoneNumberOrigin()||u.NavigationCallOrigin.PstnDialpad)):C.default.closeGenericDesktopModal(e,this._getRootViewId()))}}_buildState(e,t){const i={isUsingStackNavigationContext:m.default.isUsingStackNavigationContext(),conversationMembersMris:[],tasterCoachmarkEnabled:d.default.tasterCoachmarkEnabled(),tasterGreenCallButtonEnabled:d.default.tasterGreenCallButtonEnabled(),isTasterEligible:d.default.getCallRate().isTasterEligible};if(e.callId&&e.conversationMri){const t=(0,l.default)().getConversation(e.conversationMri);t&&(i.conversationMembersMris=t.getMemberMris())}return i}render(){const e=this.state.isTasterEligible&&this.state.tasterGreenCallButtonEnabled?f.Color.green:void 0,t=this.state.isTasterEligible&&this.state.tasterCoachmarkEnabled?a.createElement(s.default.ActionButton,{coachMarkType:r.CoachMarkType.PlaceTasterCall,anchorAccessibilityLabel:g.getString("PSTNDialerPanel.PlaceTasterCallCoachmarkTitle"),positions:[r.PopupAnchorPositon.Top],accessibilityLabel:g.getString("PSTNDialerPanel.CallButtonAccessibilityLabel"),accessibilityTraits:a.Types.AccessibilityTrait.Button,title:g.getString("PSTNDialerPanel.CallButtonAccessibilityLabel"),icon:_.SkypeIcon.CallStart,onPress:this._startPstnCall,disabled:!this.props.canCall,style:v.roundButton,backgroundColor:e}):a.createElement(n.default,{title:g.getString("PSTNDialerPanel.CallButtonAccessibilityLabel"),icon:_.SkypeIcon.CallStart,onPress:this._startPstnCall,disabled:!this.props.canCall,style:v.roundButton,backgroundColor:e});return a.createElement(r.CoachMarkContext.Provider,{value:this._coachMarkContext},t)}_isJoinCallRequest(){return this.props.callId&&this.props.conversationMri}}t.default=w},69656:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(31844),n=i(16778),o=i(89391),s=i(39119),r=i(76621),l=i(51129),c=i(4604),d=i(46096),u=i(13944),h=i(36237),p=i(15877),g=i(33754),C=i(4735),m=i(89871),S=i(35426),y=i(15301),f=i(81760),_=i(40363),b=i(11828),T=i(24576),v=i(53374),w=(0,p.lazyProperties)({smsButtonDimensions:()=>n.Styles.createButtonStyle({width:60,height:60,alignItems:"center",flexBasis:0,flexDirection:"row",flexGrow:1,flexShrink:0,justifyContent:"center",minHeight:46})});class I extends T.default{constructor(){super(...arguments),this._onPress=()=>{if(!this.props.canSendSms)return;const e=v.default.newCauseId();h.log(d.LogTraceArea.DialerPanel,"[action]: Send SMS Button, causeId: "+e),this.props.phoneNumber.emergency?this._startEmergencySMS(e):this._startSkypeSMS(e)}}_buildState(e,t){const i=c.default.getCreditEntitlement(),a=c.default.getSubscriptions(),n={searchResult:m.default.getSearchResults().exactMatch,canShowSmsEntryPoint:o.default.getS4LEntitlementFeatures().SCE.Dialpad.Features.SmsButtonEnabled,supportsEmergencySms:t?void 0:this.state.supportsEmergencySms,sendButtonEnabled:!t&&this.state.sendButtonEnabled,useSmsThreadsFor2way:o.default.getS4LMessagingFeatures().useSmsThreadsFor2way,userEntitlementsSummary:s.getEntitlementCombination(i,a)};return e.canSendSms?e.phoneNumber.emergency&&!n.supportsEmergencySms?n.sendButtonEnabled=!1:n.sendButtonEnabled=!0:n.sendButtonEnabled=!1,n}render(){if(!this.state.canShowSmsEntryPoint)return null;const e=this._useDarkTheme()||this._useAccessibleTheme()?this._themeColors.headerIconColor:f.Color.black;return n.createElement(u.default,{icon:b.SkypeIcon.MobileSmsNew,title:g.getString("SMSMessaging.ContactOptionsPopupSendSMSLabel"),disabled:!this.state.sendButtonEnabled,color:e,hoverColor:e,size:b.IconSize.size24,style:w.smsButtonDimensions,onPress:this._onPress,flipIcon:this._getContext().isRTL&&_.default.getPlatformType()!==d.PlatformType.Android})}componentDidMount(){super.componentDidMount(),void 0===this.state.supportsEmergencySms&&a.default.supportsNativeEmergencyCalling().catch((()=>!1)).then((e=>{this.isComponentMounted()&&this.setState({supportsEmergencySms:e})}))}_startEmergencySMS(e){h.log(d.LogTraceArea.DialerPanel,"SMSControl._startEmergencySMS, causeId: "+e);const t=this.props.phoneNumber.suffix;t?(h.log(d.LogTraceArea.GenericUnsafe,"Placing emergency SMS to "+l.default.maskPhoneNumber(t)+", destination country: "+this.props.phoneNumber.countryCode),a.default.makeNativeEmergencySMS(t).then((e=>{e||h.warn(d.LogTraceArea.GenericUnsafe,"Failed to place emergency SMS")}))):h.warn(d.LogTraceArea.GenericUnsafe,"Refusing to place emergency SMS, reason: no information about phone number suffix")}_startSkypeSMS(e){h.log(d.LogTraceArea.DialerPanel,"SMSControl._startSkypeSMS, causeId: "+e);const t=l.default.getPhoneNumberMri(this.props.phoneNumber);r.default.ensureConversationLoadedOrFaked(t,d.ConversationFakedOrigin.SmsButton).then((i=>{const a={convId:t,origin:d.NavigationConversationOrigin.SmsControl,isNewConversation:i,causeId:e};!this.state.useSmsThreadsFor2way&&this.state.searchResult&&(this.state.searchResult.contact.userMri&&(a.convId=this.state.searchResult.contact.userMri),a.selectedNumberForSMS=this.state.searchResult.phone),y.default.setNextFlowId(y.SmsFlowId.Dialer),h.track(new S.DialerPanelComponentClick(S.DialerPanelClickTarget.SmsButton,this.state.userEntitlementsSummary)),C.default.navigateToConversation(a)}))}}t.default=I},96613:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(47204),o=i(17456),s=i(87134),r=i(46096),l=i(39285),c=i(10117),d=i(36237),u=i(15877),h=i(33754),p=i(4735),g=i(72136),C=i(89871),m=i(35426),S=i(86045),y=i(23528),f=i(90631),_=i(81760),b=i(11828),T=i(79669),v=i(80837),w=i(19675),I=i(24576),P=i(53374),M=(0,u.lazyProperties)({headerControlWrap:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"center",alignItems:"center",height:b.IconSize.default}),headerControlText:()=>a.Styles.createTextStyle({flexGrow:0,flexShrink:1,color:_.Color.white,marginRight:5}),dividerContainer:()=>a.Styles.createViewStyle({height:1}),divider:()=>a.Styles.createViewStyle({position:"absolute",left:10,right:10,bottom:0,height:1}),iconStyle:()=>a.Styles.createViewStyle({paddingLeft:3}),countrySelectorPopupContainer:()=>a.Styles.createViewStyle({height:350,width:300}),titleWrapperStyle:()=>a.Styles.createViewStyle({flexGrow:0,flexShrink:1,flexDirection:"row",alignItems:"center"}),filterInputControl:()=>a.Styles.createViewStyle({height:50,paddingTop:10})}),k="countrySelectorPopup";class A extends I.default{constructor(){super(...arguments),this._close=()=>{const e=P.default.newCauseId();d.log(r.LogTraceArea.Navigation,"DialpadHeader._close, causeId: "+e),p.default.goBack(e,this._getContext())},this._goCallSettings=()=>{d.track(new m.DialerPanelComponentClick(m.DialerPanelClickTarget.SettingsButton)),p.default.navigateToCallingSettingsPanel(!1,this._getContext())},this._onCenterControlsRef=e=>{this._centerControls=e||void 0},this._onCountryTitleRef=e=>{this._countryTitleRef=e||void 0},this._onCountryListRef=e=>{this._countryListRef=e||void 0},this._onCountrySelectorPress=e=>{this.props.isUsingStackNavigationContext?p.default.navigateToCountrySelector(this._getRootViewId()):this._openCountrySelectorModal()},this._openCountrySelectorModal=()=>{const e=e=>{const t=this.state.countries[e];C.default.setSelectedCountry(t,!0),n.default.dismissPopup(k,this._getRootViewId())},t={getAnchor:()=>this._countryTitleRef,renderPopup:(t,i,n,r)=>a.createElement(T.default,{anchorPosition:t,anchorOffset:i,popupWidth:n,popupHeight:r,fillColor:this._themeColors.popoverBackgroundColor,strokeColor:this._useDarkTheme()?this._themeColors.popupBorderColor:void 0,skipPopupAutoFocus:!0,popupAccessibilityTitle:h.getString("PSTNCountryList.CountryList")},a.createElement(a.View,{style:M.countrySelectorPopupContainer},a.createElement(a.View,{style:v.default.flexZero},a.createElement(y.default,{style:M.filterInputControl,placeholderText:h.getString("PSTNCountryList.SearchCountryPlaceholder"),onInputTextChange:this._onSearch,showSearchIcon:!0,hideBackground:!0,useBoldFont:!0})),a.createElement(a.View,{style:M.dividerContainer},a.createElement(s.default,{style:M.divider})),a.createElement(o.default,{ref:this._onCountryListRef,countries:this.state.countries,recentCountries:C.default.getLast5CalledCountriesNoSubscription(),onSelect:e}))),positionPriorities:["top","bottom"],dismissIfShown:!0,rootViewId:this._getRootViewId()};n.default.showPopup(t,k)},this._onSearch=e=>{this.isComponentMounted()&&(this.setState({query:e}),this._countryListRef&&this._countryListRef.onFilterChange(e))}}requestFocus(){this._centerControls&&this._centerControls.requestFocus()}render(){return a.createElement(f.SimplePanelHeader,{useTransparentBackground:!0,hideBottomBorder:!0,leftButton:this._getCloseButton(),rightButtons:this._getCallingSettingseButton(),titleView:this._getHeaderCenterControls(),headerPosition:this.props.isInLandscape?f.HeaderPosition.Start:f.HeaderPosition.Default})}_buildState(e,t){const i={countries:g.default.getCountries(),selectedCountry:C.default.getSelectedCountry()};return t&&(i.selectedCountry&&(i.selectedCountry=g.default.getCountryByCode(i.selectedCountry.country)),this._titleWrapperStyle=[M.titleWrapperStyle,a.Styles.createViewStyle({maxWidth:e.maxWidth},!1)]),i}_getCloseButton(){return{closeButtonType:this.props.isUsingStackNavigationContext||this.props.isAloneInNavStack?f.CloseButtonType.Close:f.CloseButtonType.Back,title:this.props.isUsingStackNavigationContext||this.props.isAloneInNavStack?h.getString("Global.CloseButtonTitle"):h.getString("Global.BackButtonTitle"),onPress:this._close,color:this._useDarkTheme()||this._useAccessibleTheme()?this._themeColors.headerIconColor:_.Color.white,hoverColor:this._useDarkTheme()||this._useAccessibleTheme()?this._themeColors.iconHoverColor:_.Color.whiteOverlay50,accessibilityLabel:this.props.isUsingStackNavigationContext||this.props.isAloneInNavStack?h.getString("Global.CloseButtonTitle"):h.getString("Global.BackButtonTitle")}}_getCallingSettingseButton(){const e=h.getString("UserSettingsPanel.CallSettingsTitle");return{icon:b.SkypeIcon.Settings,title:e,onPress:this._goCallSettings,color:this._useDarkTheme()||this._useAccessibleTheme()?this._themeColors.headerIconColor:_.Color.white,hoverColor:this._useDarkTheme()||this._useAccessibleTheme()?this._themeColors.iconHoverColor:_.Color.whiteOverlay50,accessibilityLabel:e}}_getHeaderCenterControls(){let e=h.getString("PSTNCountrySelectorPanel.Title"),t=h.getString("PSTNCountrySelectorPanel.Title");const i=[M.headerControlText];return this.state.selectedCountry&&(e=this.state.selectedCountry.countryName,t=h.getString("PSTNDialerPanel.CountriesAndRegionsAccessibilityLabel",{countryTitle:e})),(this._useDarkTheme()||this._useAccessibleTheme())&&i.push(this._themeStyles.headerTextColorStyle),a.createElement(a.Button,{ref:this._onCenterControlsRef,style:M.headerControlWrap,onPress:this._onCountrySelectorPress,accessibilityLabel:t,accessibilityTraits:[a.Types.AccessibilityTrait.Button,a.Types.AccessibilityTrait.HasPopup]},a.createElement(l.default,{ref:this._onCountryTitleRef,style:this._titleWrapperStyle},a.createElement(w.PanelHeader,{style:i,numberOfLines:1},e),a.createElement(c.default,{icon:b.SkypeIcon.DownChevron,size:b.IconSize.size12,color:this._useDarkTheme()||this._useAccessibleTheme()?this._themeColors.headerIconColor:_.Color.white,style:M.iconStyle})))}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),C.default.initializeCountrySelection()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.state.selectedCountry&&this._announceCountrySelectedForAccessibility(this.state.selectedCountry.countryName)}shouldComponentUpdate(e,t){return!!this.state.selectedCountry!=!!t.selectedCountry||!!this.state.selectedCountry&&!!t.selectedCountry&&this.state.selectedCountry.country!==t.selectedCountry.country||this.props.isInLandscape!==e.isInLandscape}_announceCountrySelectedForAccessibility(e){this._announceForAccessibility(h.getString("PSTNDialerPanel.CountryAnnouncement",{countryTitle:e}))}_announceForAccessibility(e){S.default.maybeAnnounceForAccessibility(e,1e3)}}t.default=A},8360:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(34828),o=i(16778),s=i(98278),r=i(1889),l=i(46096),c=i(36237),d=i(15877),u=i(33754),h=i(51072),p=i(45227),g=i(89871),C=i(35426),m=i(29130),S=i(70919),y=i(81760),f=i(11010),_=i(78262),b=i(80837),T=i(19675),v=i(24576),w=i(2301),I=i(67977),P=i(10996),M=i(69399),k=(0,d.lazyProperties)({searchResultPanelStyle:()=>o.Styles.createViewStyle({flex:1,minHeight:100}),searchResultPanelDarkThemeStyle:()=>o.Styles.createViewStyle({backgroundColor:y.Color.gray400}),itemDivider:()=>o.Styles.createViewStyle({height:1,marginLeft:50,marginRight:10}),itemDividerDarkTheme:()=>o.Styles.createViewStyle({backgroundColor:y.Color.dialPadHoverDark}),itemDividerLightTheme:()=>o.Styles.createViewStyle({backgroundColor:y.Color.whiteOverlay20}),itemDividerSmallScreen:()=>o.Styles.createViewStyle({marginRight:16}),singleItemDivider:()=>o.Styles.createViewStyle({height:1,marginLeft:10,marginRight:10}),transparentBg:()=>o.Styles.createViewStyle({backgroundColor:y.Color.transparent}),textOnGradient:()=>o.Styles.createTextStyle({color:y.Color.white}),rowHighlightDarkStyle:()=>o.Styles.createViewStyle({backgroundColor:y.Color.dialPadHoverDark})});class A extends v.default{constructor(){super(...arguments),this._onScrollFlag=!1,this._renderItem=e=>{const t=o.createElement(R,{key:e.key,mri:e.profile.userMri,displayName:e.profile.displayName,phoneNumber:this.state.isSingleSelection?void 0:e.phone,itemHeight:e.height,textToHighlight:e.textToHighlight,onResultPress:this._onSearchItemPressed,searchIndex:e.searchIndex});if(e.isLastItem&&!this.state.isSingleSelection)return t;const i=[k.itemDivider];this._useDarkTheme()?i.push(k.itemDividerDarkTheme):i.push(this._themeStyles.dividerColorStyle),this.state.isMobileScreenSize&&i.push(k.itemDividerSmallScreen);const a=o.createElement(o.View,{key:"itemDivider",style:i});if(this.state.isSingleSelection){const e=[k.singleItemDivider];this._useDarkTheme()?e.push(k.itemDividerDarkTheme):e.push(k.itemDividerLightTheme);return[o.createElement(o.View,{key:"itemDivider",style:e}),t]}return[t,a]},this._onSearchItemPressed=(e,t)=>{c.log(l.LogTraceArea.DialerPanel,"[action]: Contact Selection"),c.track(new C.ContactSelected(g.default.getPhoneNumber(g.TriggerKeys.InputValue).E164.length)),g.default.selectSearchResultItem(t),this.props.onItemPressed&&this.props.onItemPressed()},this._onScroll=()=>{this.props.onScroll&&this._onScrollFlag?(this.props.onScroll(),this._onScrollFlag=!1):this._onScrollFlag=!0}}_buildState(e,t){const i=g.default.getSearchResults(),n=S.SearchItemHeights.baseListItemHeight+Math.round(S.SearchItemHeights.scaledListItemHeight*Math.min(m.default.getContentSizeMultiplier(),s.MaxContentSizeMultiplier)),o=this._getRootViewId(),r={isMobileScreenSize:m.default.isMobileScreenSize(o),searchQuery:i.query,sessionId:i.sessionId,profiles:[],isSingleSelection:!!i.selectedResult};return i.results.length>0&&!i.selectedResult&&(a.each(i.results,((e,t)=>{r.profiles.push({profile:e.contact,phone:e.phone.number,textToHighlight:e.matchedString,template:"profile",height:n,key:"ct_"+e.contact.uniqueId+t,searchIndex:t,isLastItem:!1})})),r.profiles[r.profiles.length-1].isLastItem=!0),r}render(){const e=[k.searchResultPanelStyle];return this.state.isSingleSelection||0===this.state.profiles.length?e.push(k.transparentBg):this._useDarkTheme()?e.push(k.searchResultPanelDarkThemeStyle):e.push(this._themeStyles.primaryBackgroundColorStyle),o.createElement(o.View,{style:e,importantForAccessibility:this._accessibilityForSearchResultsView()},o.createElement(n.VirtualListView,{itemList:this.state.profiles,renderItem:this._renderItem,animateChanges:!1,skipRenderIfItemUnchanged:!1,keyboardDismissMode:"on-drag",keyboardShouldPersistTaps:!0,horizontalPadding:this.props.safeAreaHorizontalInsets,hoveredItemStyle:this.state.isSingleSelection?void 0:this._themeStyles.rowHoverViewStyle,onScroll:this._onScroll,accessibilityLabel:u.getString("PSTNDialerPanel.FastContactsSearchList")}))}componentDidMount(){super.componentDidMount(),g.default.initializeSearch()}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),this._onScrollFlag=!1,this.state.profiles.length>0){const e=0===this.state.searchQuery.length;(0,P.searchResultsRendered)(M.ScenarioSearchTypes.FastContacts,this.state.sessionId,e);const t={publicDirectory:!1,message:!1,indexedDb:!1,bots:!1,allPeople:!1,fastContacts:!0,messageInConversation:!1};(0,P.compositeScenarioResultsRendered)(this.state.searchQuery,M.CompositeSearchOrigin.Dialpad,void 0,e,t)}this.props.onRender&&this.props.onRender()}componentWillUnmount(){super.componentWillUnmount(),g.default.destroySearch()}_accessibilityForSearchResultsView(){return 0===this.state.profiles.length?o.Types.ImportantForAccessibility.NoHideDescendants:void 0}}class R extends v.default{constructor(){super(...arguments),this._onHoverOverItemStart=e=>{this.isComponentMounted()&&this.setState({isHoveringOverItem:!0})},this._onHoverOverItemEnd=e=>{this.isComponentMounted()&&this.setState({isHoveringOverItem:!1})},this._onItemPressed=()=>{this.props.phoneNumber&&(this.props.onResultPress(this.props.phoneNumber,this.props.searchIndex),this.isComponentMounted()&&this.setState({isHoveringOverItem:!1}))}}render(){const e=p.getItemHeightStyle(this.props.itemHeight-1),t=[p.styles.listItem];e&&t.push(e),this.state.isHoveringOverItem&&this.props.phoneNumber&&(this._useDarkTheme()?t.push(k.rowHighlightDarkStyle):t.push(this._themeStyles.rowHighlightViewStyle));const i=[f.default.fontStyle.body,this._themeStyles.secondaryTextColorStyle,b.default.flexNegativeOne],a=[...i,p.styles.statusTextInnerContainer],n=this.props.displayName,s=this.props.phoneNumber;let l,c;if(s)c=o.createElement(o.View,{style:p.styles.statusContainer,title:s},o.createElement(r.default,{displayText:s,textToHighlight:this.props.textToHighlight,containerStyles:a,inlineTextStyle:i,highlightType:_.TextToHighlightType.PhoneNumber}));else{c=void 0;let e=k.textOnGradient;!this._useDarkTheme()&&this._useAccessibleTheme()&&(e=this._themeStyles.primaryTextColorStyle),l=e}const d=-1!==n.indexOf(this.props.textToHighlight)?o.createElement(r.default,{displayText:n,textToHighlight:this.props.textToHighlight,containerStyles:a,inlineTextStyle:[f.default.rowTitleFontStyle(this._currentTheme),l],highlightType:_.TextToHighlightType.DisplayName}):o.createElement(T.RowTitle,{style:l,numberOfLines:1},n);return o.createElement(h.default.Button,{style:t,onPress:s?this._onItemPressed:void 0,onHoverStart:s?this._onHoverOverItemStart:void 0,onHoverEnd:s?this._onHoverOverItemEnd:void 0,underlayColor:this._useDarkTheme()?y.Color.dialPadHoverDark:this._themeColors.rowHighlightColor,accessibilityTraits:o.Types.AccessibilityTrait.Button,accessibilityLabel:n+(s?", "+s:"")},o.createElement(w.UserIcon,{key:"userIcon",size:I.UserIconSize.Size40,userMri:this.props.mri,statusBorderColor:this._themeColors.primaryBackgroundColor}),o.createElement(o.View,{key:"text",style:p.styles.textContainer},d,c))}}t.default=A},61499:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PhoneNumberInputBase=void 0;const a=i(16778),n=i(89391),o=i(44279),s=i(56976),r=i(46096),l=i(13944),c=i(36237),d=i(15877),u=i(33754),h=i(4735),p=i(27683),g=i(89871),C=i(89871),m=i(35426),S=i(61230),y=i(86045),f=i(81760),_=i(11828);var b;!function(e){e[e.Regular=0]="Regular",e[e.Emergency=1]="Emergency"}(b||(b={}));const T=(0,d.lazyProperties)({contactsIcon:()=>a.Styles.createViewStyle({paddingLeft:10,paddingRight:10,paddingBottom:10,paddingTop:8,alignSelf:"flex-start",flex:0})});class v extends S.ResponsiveComponentBase{constructor(e){super(e),this._getOptionalContactsIcon=()=>this.state.isContactsIconEnabled?a.createElement(l.default,{icon:_.SkypeIcon.People,color:this._useAccessibleTheme()?this._themeColors.primaryIconColor:f.Color.white,hoverColor:this._useAccessibleTheme()?this._themeColors.iconHoverColor:f.Color.whiteOverlay50,size:_.IconSize.size24,style:T.contactsIcon,onPress:this._onContactsButtonClick,title:u.getString("PSTNDialerPanel.ContactsButtonTitle")}):void 0,this._onContactsButtonClick=()=>{c.track(new m.DialerPanelComponentClick(m.DialerPanelClickTarget.ContactsIcon)),h.default.navigateToContactsPanel(void 0,!1,this._getContext())}}_buildState(e,t){const i=super._buildState(e,t),a=g.default.getPhoneNumber(C.TriggerKeys.Emergency);i.value=g.default.getPhoneNumber(C.TriggerKeys.InputValue).inputValue,i.selectedResult=g.default.getSearchResults().selectedResult,i.phoneNumber=a,i.phoneNumber.emergency?i.mode=b.Emergency:i.mode=b.Regular;const o=n.default.getS4LEntitlementFeatures().SCE;return i.isContactsIconEnabled=o.Dialpad.Features.ContactsIconEnabled,i.isRateIntegrationEnabled=o.UserServices.Client.Features.RateIntegrationEnabled,i.accessibilitySummary=g.default.getAccessibilitySummary(),i.callRate=this._getCallRate(a),t&&(i.showInvalidNumberNote=e.openedOnInvalidNumberError),i}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount();const e=this.props.prefilledInput;e&&this._writeToStore(e,r.NavigationCallOrigin.PstnDialpadPrefilled);const t=s.default.restorePhoneNumberInputIfNeeded();t&&this._writeToStore(t,r.NavigationCallOrigin.PstnDialpadSaveContact),s.default.clearState()}_getCallRate(e){if(e.E164&&p.default.isValidNumberString(e.E164))return o.default.getCallRateByPhoneNumber(p.default.stripPlusSign(e.E164))}_isEmergencyMode(){return this.state.mode===b.Emergency}_writeToStore(e,t){g.default.overwritePhoneNumberInput(e,!1,t)}_announceForAccessibility(e,t){return y.default.maybeAnnounceForAccessibility(e,t)}}t.PhoneNumberInputBase=v},39254:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(16778),o=i(89391),s=i(98278),r=i(4336),l=i(36540),c=i(51129),d=i(46096),u=i(10117),h=i(66649),p=i(36237),g=i(15877),C=i(33754),m=i(4735),S=i(30124),y=i(61499),f=i(89871),_=i(35426),b=i(86045),T=i(22222),v=i(81760),w=i(11010),I=i(11828),P=i(80837),M=i(19675),k=i(53374),A=(0,g.lazyProperties)({numberInputContainer:()=>n.Styles.createViewStyle({alignItems:"center",flexDirection:"row",paddingBottom:10,paddingLeft:20,paddingRight:10}),numberInput:()=>n.Styles.createTextStyle({backgroundColor:v.Color.transparent,color:v.Color.white,flex:0,font:w.default.font.uiDisplayBold}),emergencyCallContainerStyle:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),emergencyCallContainerStyleLandscape:()=>n.Styles.createViewStyle({flexDirection:"column"}),emergencyCallStyle:()=>n.Styles.createTextStyle({backgroundColor:v.Color.transparent,color:v.Color.white,marginBottom:5,paddingHorizontal:10,flexShrink:1}),emergencyCallLearnMoreStyle:()=>n.Styles.createViewStyle({alignSelf:"flex-start",marginRight:10}),emergencyCallLearnMoreStyleLandscape:()=>n.Styles.createViewStyle({alignSelf:"flex-start",marginLeft:10}),emergencyCallBackground:()=>n.Styles.createViewStyle({backgroundColor:v.Color.red,height:r.DefaultHeight}),errorNotificationFlexStyle:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",marginLeft:10,marginRight:40}),invalidNumberNotificationStyle:()=>n.Styles.createTextStyle({flex:1,backgroundColor:v.Color.transparent,color:v.Color.white,marginBottom:5,marginLeft:10})}),R={numberInput:(0,g.lazyProperties)({MobileSmall:()=>n.Styles.createTextStyle({fontSize:w.default.controlFontSize.h4}),MobileMedium:()=>n.Styles.createTextStyle({fontSize:w.default.controlFontSize.dialpadNumber}),MobileDefault:()=>n.Styles.createTextStyle({fontSize:w.default.controlFontSize.dialpadNumberLarge}),DesktopDefault:()=>n.Styles.createTextStyle({fontSize:w.default.controlFontSize.h4})})};class V extends y.PhoneNumberInputBase{constructor(){super(...arguments),this._onChangeTextEvent={isLocked:!1,newValue:""},this._onPressPhoneNumberContainer=e=>{this.props.onPress&&this.props.onPress()},this._onSubmit=()=>{if(!this.state.phoneNumber.callable||this.state.disableHighBandwidthOperations)return void p.log(d.LogTraceArea.DialerPanel,"PhoneNumberInputDesktop._onSubmit not callable phone number");const e=k.default.newCauseId();p.log(d.LogTraceArea.DialerPanel,"PhoneNumberInputDesktop._onSubmit, causeId: "+e),l.default.startOrAddPstnCall(this.state.phoneNumber.E164,this.state.phoneNumber.emergency,this.state.phoneNumber.countryCode,this.state.phoneNumber.suffix,this.props.callId,this.props.conversationId),!S.default.isUsingStackNavigationContext()&&this._isJoinCallRequest()&&m.default.closeGenericDesktopModal(e,this._getRootViewId())},this._onPaste=e=>{if(!e.clipboardData||!e.clipboardData.items||0===e.clipboardData.items.length)return;const t=a.find(e.clipboardData.items,(e=>"text/plain"===e.type)),i=!!this._textInputRef&&c.default.isCursorPlacedInPrefixArea(this.state.phoneNumber,this._textInputRef.getSelectionRange());t&&(this._onChangeTextEvent.isLocked=!0,t.getAsString((e=>{this._onChangeTextEvent.isLocked=!1;const t=c.default.normalizePhoneNumber(e);if(c.default.isE164Format(t))this._onChangeText(t,d.NavigationCallOrigin.PstnDialpadPasted);else if(i)this._onChangeText(t,d.NavigationCallOrigin.PstnDialpadPasted);else if(!a.isEmpty(this._onChangeTextEvent.newValue)){const e=c.default.normalizePhoneNumber(this._onChangeTextEvent.newValue);this._onChangeText(e,d.NavigationCallOrigin.PstnDialpadPasted)}p.track(new _.PasteNumber)})))},this._renderEmergencyCallElements=()=>{if(!this._isEmergencyMode())return;const e=[],t=[];if(this.state.phoneNumber.forceChangedPrefix){p.debug((()=>"PhoneNumberInputDesktop._renderOptionalEmergencyCallNotification: 0"));const i=C.getString("PSTNDialerPanel.EmergencyCallingDefaultCountryAppliedLabel",{number:this.state.phoneNumber.suffix?this.state.phoneNumber.suffix:"",country:this.state.selectedCountry?this.state.selectedCountry.countryName:""});e.push(n.createElement(M.BodyText,{key:"EmergencyCallingDefaultCountryAppliedLabel",size:M.BodyTextSize.SmallDeprecated,style:A.emergencyCallStyle},i)),t.push(i)}if(this.state.phoneNumber.callable){let i;if(p.debug((()=>"PhoneNumberInputDesktop._renderOptionalEmergencyCallNotification: 1")),a.includes(this.state.e911EnabledCountries,a.toLower(this.state.phoneNumber.countryCode)))i=C.getString("PSTNDialerPanel.E911CallingLimitedLabel");else{i=C.getString("PSTNDialerPanel.EmergencyCallingLimitedLabel")+" "+C.getString("PstnUtils.EmergencyCallWarning")}e.push(n.createElement(n.View,{key:"EmergencyCallingContainer",style:this.props.isInLandscape?A.emergencyCallContainerStyleLandscape:A.emergencyCallContainerStyle},n.createElement(M.Subtitle,{key:"EmergencyCallingLimitedLabel",style:A.emergencyCallStyle},i),n.createElement(T.default,{key:"EmergencyCallingLimitedLabelContainer",buttonSize:s.SXButtonSize.Small,buttonStyle:s.SXButtonStyle.LightFill,style:this.props.isInLandscape?A.emergencyCallLearnMoreStyleLandscape:A.emergencyCallLearnMoreStyle,title:C.getString("PstnUtils.EmergencyCallingLearnMore"),allowTextWrap:!0,onPress:this._onPressEmergencyCallLearnMoreHandler}))),t.push(i)}else{p.debug((()=>"PhoneNumberInputDesktop._renderOptionalEmergencyCallNotification: 2"));const i=C.getString("PSTNDialerPanel.EmergencyCallingNoCallingLabel"),a=C.getString("PstnUtils.EmergencyCallingNotSupportedRegion");e.push(n.createElement(M.Subtitle,{key:"EmergencyCallingNoCallingLabel",style:A.emergencyCallStyle},i),n.createElement(M.Caption,{key:"EmergencyCallingNotSupportedRegion",style:A.emergencyCallStyle},a)),t.push(i),t.push(a)}return t.length>0&&b.default.maybeAnnounceForAccessibility(t.join(" ")),e},this._renderInvalidNotification=()=>{if(this.state.showInvalidNumberNote)return n.createElement(n.View,{style:A.errorNotificationFlexStyle},n.createElement(u.default,{key:"infoIcon",icon:I.SkypeIcon.Info,size:I.IconSize.size20,color:v.Color.white}),n.createElement(M.BodyText,{size:M.BodyTextSize.BigDeprecated,bold:!0,style:A.invalidNumberNotificationStyle,numberOfLines:2},C.getString("PSTNDialerPanel.InvalidNumberError")))},this._onPressEmergencyCallLearnMoreHandler=()=>{n.Linking.openUrl(o.default.getConfigSettingsNoSubscription().calling.emergencyCallingLearnMoreLink)},this._onTextInputRef=e=>{this._textInputRef=e||void 0},this._handleChangeText=e=>{this._onChangeText(e,d.NavigationCallOrigin.PstnDialpadTyped)},this._onChangeText=(e,t)=>{this._onChangeTextEvent.isLocked?this._onChangeTextEvent.newValue=e:e!==this.state.value&&(e&&!c.default.isValidPhoneNumberInput(e)?this._textInputRef&&this._textInputRef.setValue(this.state.value):f.default.overwritePhoneNumberInput(e,!0,t),this.props.onPress&&this.props.onPress())}}_buildState(e,t){const i=super._buildState(e,t);return i.selectedCountry=f.default.getSelectedCountry(),i.disableHighBandwidthOperations=h.default.isUsingGogoNetwork(),i.e911EnabledCountries=o.default.getS4LEntitlementFeatures().SCE.Dialpad.E911.enabledCountries,i}_getTextInput(){const e=[A.numberInput,this._chooseResponsiveStyle(R.numberInput)];(this._useDarkTheme()||this._useAccessibleTheme())&&e.push(this._themeStyles.headerTextColorStyle);let t=n.createElement(n.View,{style:P.default.flexOne,onPress:this._onPressPhoneNumberContainer},n.createElement(n.TextInput,{style:e,autoFocus:!0,value:this.state.value,placeholder:C.getString("PSTNPhoneNumberInput.NumberPlaceholder"),accessibilityLabel:this._getAccessibilityLabel(),placeholderTextColor:this._useAccessibleTheme()?v.Color.whiteOverlay80:v.Color.whiteOverlay50,onChangeText:this._handleChangeText,ref:this._onTextInputRef,onPaste:this._onPaste,onSubmitEditing:this._onSubmit,clearButtonMode:"never"}));return t=n.createElement("div",{className:this._useAccessibleTheme()?void 0:"inputGradient"},t),t}_isJoinCallRequest(){return this.props.callId&&this.props.conversationId}_isInputFocused(){return this._textInputRef&&this._textInputRef.isFocused()}render(){const e=this._isEmergencyMode()||this.state.showInvalidNumberNote?n.createElement(n.View,null,this._renderEmergencyCallElements(),this._renderInvalidNotification()):void 0;return n.createElement(n.View,{style:this._isEmergencyMode()?A.emergencyCallBackground:void 0},n.createElement(n.View,{style:A.numberInputContainer},n.createElement(n.View,{style:P.default.flexOne},this._getTextInput()),this._getOptionalContactsIcon()),e)}componentDidMount(){super.componentDidMount(),this._textInputRef&&this._textInputRef.selectRange(-1,-1)}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),this.state.showInvalidNumberNote&&this.props.prefilledInput!==this.state.phoneNumber.E164&&this.setState({showInvalidNumberNote:!1}),this._isInputFocused()||!this.state.phoneNumber.inputValue)return void(this.state.isRateIntegrationEnabled&&this.state.callRate&&b.default.maybeAnnounceForAccessibility(this.state.callRate));const a=this._getAccessibilityLabel(!0);a&&b.default.maybeAnnounceForAccessibility(a,500),this.state.selectedResult&&!t.selectedResult&&this.requestFocus()}requestFocus(){a.defer((()=>{if(this.isComponentMounted()&&this._textInputRef){this._textInputRef.requestFocus();const e=this.state.phoneNumber.inputValue.length;e>0&&this._textInputRef.selectRange(e,e)}}))}_getCallAccessibilityLabel(){return this._isInputFocused()?C.getString("PSTNPhoneNumberInput.AccessibilityLabelEnterToCall"):C.getString("PSTNPhoneNumberInput.AccessibilityLabel")}_getAccessibilityLabel(e=!1){const t=e?[this.state.value]:[];return this.state.showInvalidNumberNote?t.push(C.getString("PSTNDialerPanel.InvalidNumberError")):this.state.phoneNumber.callable&&t.push(this._getCallAccessibilityLabel()),this.state.accessibilitySummary&&(this.state.accessibilitySummary.searchHasResults&&t.push(C.getString("PSTNPhoneNumberInput.A11yLabelContactsFound")),this.state.accessibilitySummary.selectedContactDisplayName&&t.push(C.getString("PSTNPhoneNumberInput.A11yLabelSingleContactSelected",{contactName:this.state.accessibilitySummary.selectedContactDisplayName})),!c.default.isE164Format(this.state.value)&&this.state.accessibilitySummary.selectedCountryName&&t.push(C.getString("PSTNPhoneNumberInput.AccessibilityLabelDestinationCountry",{country:this.state.accessibilitySummary.selectedCountryName}))),this.state.isRateIntegrationEnabled&&!this._isInputFocused()&&this.state.callRate&&t.push(this.state.callRate),t.length?t.join(", "):void 0}}t.default=V},54344:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(32377),n=i(16778),o=i(46096),s=i(10117),r=i(36237),l=i(15877),c=i(33754),d=i(30124),u=i(61499),h=i(35426),p=i(81760),g=i(11010),C=i(11828),m=i(80837),S=i(19675),y=i(451),f=(0,l.lazyProperties)({numberInputContainer:()=>n.Styles.createViewStyle({alignItems:"center",flexDirection:"row",paddingBottom:10,paddingLeft:10,paddingRight:0,minHeight:45}),inputWrapper:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row"}),numberInput:()=>n.Styles.createTextStyle({backgroundColor:"transparent",color:p.Color.white,flex:0,font:g.default.font.uiDisplayBold,paddingRight:10}),numberInputFade:()=>n.Styles.createTextStyle({color:p.Color.whiteOverlay50}),numberInputFadeAccessibleLight:()=>n.Styles.createTextStyle({color:p.Color.blackOverlay60}),numberInputFadeAccessibleDark:()=>n.Styles.createTextStyle({color:p.Color.whiteOverlay80}),contextMenu:()=>n.Styles.createViewStyle({alignSelf:"stretch",flex:1}),errorNotificationFlexStyle:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",marginRight:40}),invalidNumberNotificationStyle:()=>n.Styles.createTextStyle({flex:1,backgroundColor:p.Color.transparent,color:p.Color.white,textAlignVertical:"top",marginBottom:5,marginLeft:10}),extendedHeight:()=>n.Styles.createTextStyle({minHeight:150})}),_={numberInput:(0,l.lazyProperties)({MobileSmall:()=>n.Styles.createTextStyle({fontSize:g.default.controlFontSize.h4}),MobileMedium:()=>n.Styles.createTextStyle({fontSize:g.default.controlFontSize.dialpadNumber}),MobileDefault:()=>n.Styles.createTextStyle({fontSize:g.default.controlFontSize.dialpadNumberLarge}),DesktopDefault:()=>n.Styles.createTextStyle({fontSize:g.default.controlFontSize.h4})})},b="copy",T="paste";class v extends u.PhoneNumberInputBase{constructor(){super(...arguments),this._onPress=e=>{this.props.onPress&&this.props.onPress()},this._onContextMenuRef=e=>{this._contextMenu=e||void 0},this._showContextMenu=()=>{this._contextMenu&&this._contextMenu.showContextMenu()},this._handleItemSelected=e=>{switch(e){case b:const e=this.state.value;e&&y.default.writeText(e);break;case T:r.track(new h.PasteNumber),n.Clipboard.getText().then((e=>{this._writeToStore(e,o.NavigationCallOrigin.PstnDialpadPasted)}))}},this._renderInvalidNotification=()=>{if(this.state.showInvalidNumberNote)return n.createElement(n.View,{style:f.errorNotificationFlexStyle},n.createElement(s.default,{icon:C.SkypeIcon.Info,color:p.Color.white,size:C.IconSize.size20}),n.createElement(S.BodyText,{size:S.BodyTextSize.BigDeprecated,bold:!0,style:f.invalidNumberNotificationStyle},c.getString("PSTNDialerPanel.InvalidNumberError")))}}_buildState(e,t){const i=super._buildState(e,t);return i.isUsingStackNavigationContext=d.default.isUsingStackNavigationContext(),i}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),this.state.showInvalidNumberNote)return this.props.prefilledInput!==this.state.phoneNumber.E164&&this.setState({showInvalidNumberNote:!1}),void(t.showInvalidNumberNote||this._announceForAccessibility(c.getString("PSTNDialerPanel.InvalidNumberError")));this.state.accessibilitySummary&&t.value===this.state.value&&(this.state.accessibilitySummary.searchHasResults?this._announceForAccessibility(c.getString("PSTNPhoneNumberInput.A11yLabelContactsFound")):this.state.accessibilitySummary.selectedContactDisplayName&&this._announceForAccessibility(c.getString("PSTNPhoneNumberInput.A11yLabelSingleContactSelected",{contactName:this.state.accessibilitySummary.selectedContactDisplayName})))}_announceForAccessibility(e){n.Accessibility.announceForAccessibility(e)}_getTextInput(){const e=[f.numberInput,this._chooseResponsiveStyle(_.numberInput)];(this._useDarkTheme()||this._useAccessibleTheme())&&e.push(this._themeStyles.headerTextColorStyle),0===this.state.value.length&&(this._useAccessibleTheme()?e.push(this._useDarkTheme()?f.numberInputFadeAccessibleDark:f.numberInputFadeAccessibleLight):e.push(f.numberInputFade));const t=this.state.value;return n.createElement(n.Text,{style:e,numberOfLines:1,allowFontScaling:!1,ellipsizeMode:"head"},t||c.getString("PSTNPhoneNumberInput.NumberPlaceholder"))}render(){let e;this.state.isUsingStackNavigationContext&&(e=[f.inputWrapper]);const t=this.state.value.length?c.getString("PSTNPhoneNumberInput.AccessibilityLabelEnteredPhoneNumber",{number:this.state.value}):c.getString("PSTNPhoneNumberInput.AccessibilityLabelNumberPlaceholder");return n.createElement(n.View,{style:this.state.showInvalidNumberNote?[f.numberInputContainer,f.extendedHeight]:f.numberInputContainer},n.createElement(a.ContextMenu,{items:this._getMenuItems(),onItemSelected:this._handleItemSelected,style:f.contextMenu,ref:this._onContextMenuRef},n.createElement(n.View,{onLongPress:this._showContextMenu,onPress:this._onPress,style:m.default.flexOne},n.createElement(n.View,{style:e,accessibilityLabel:t},this._getTextInput()),this._renderInvalidNotification())),this._getOptionalContactsIcon())}_getMenuItems(){return[{text:c.getString("Pstn.CopyContextMenu"),command:b},{text:c.getString("Pstn.PasteContextMenu"),command:T}]}}t.default=v},61230:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ResponsiveComponentBase=void 0;const a=i(29130),n=i(24576);class o extends n.default{constructor(e){super(e),this._mobileSmallBreakpoint=360,this._mobileMediumBreakpoint=400,this._desktopSmallBreakpoint=800,this._desktopSmallHeightBreakpoint=600}_buildState(e,t){const i=this._getRootViewId(),n={};return n.xSize=a.default.getWidth(i),n.ySize=a.default.getHeight(i),n.isMobileScreenSize=a.default.isMobileScreenSize(i),n}_chooseResponsiveStyle(e){const t=this.props.isInLandscape?this.state.ySize:this.state.xSize,i=this.state.ySize,a=(this.props.isInLandscape?e.MobileDefaultLandscape:void 0)||e.MobileDefault;return this.state.isMobileScreenSize?t<=this._mobileSmallBreakpoint?e.MobileSmall||a:t<=this._mobileMediumBreakpoint?e.MobileMedium||a:e.MobileDefault:(t<=this._desktopSmallBreakpoint||i<=this._desktopSmallHeightBreakpoint)&&e.DesktopSmall||e.DesktopDefault}}t.ResponsiveComponentBase=o},78314:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(16778),o=i(98278),s=i(58031),r=i(984),l=i(51129),c=i(56976),d=i(87134),u=(i(46096),i(24393)),h=i(36237),p=i(15877),g=i(33754),C=i(4735),m=i(89871),S=i(89871),y=i(35426),f=i(29130),_=i(81760),b=i(11010),T=i(11828),v=i(78262),w=i(24576),I=(0,p.lazyProperties)({buttonContainer:()=>n.Styles.createViewStyle({backgroundColor:_.Color.transparent,marginBottom:12,alignItems:"flex-start"}),buttonStyle:()=>n.Styles.createViewStyle({paddingHorizontal:20}),titleStyle:()=>n.Styles.createTextStyle({paddingLeft:12}),topBorderDividerDarkTheme:()=>n.Styles.createViewStyle({backgroundColor:_.Color.dialPadHoverDark}),topBorderDividerLightTheme:()=>n.Styles.createViewStyle({backgroundColor:_.Color.whiteOverlay20})});class P extends w.default{constructor(){super(...arguments),this._onButtonPress=e=>{if(e.stopPropagation(),this.state.phoneNumber){const e=l.default.getPhoneNumberMri(this.state.phoneNumber);if(r.default.isContact(e))return;c.default.savePhoneNumberInput(this.state.phoneNumber.inputValue),h.track(new y.DialerPanelComponentClick(y.DialerPanelClickTarget.SaveContactButton));const t={number:a.isEmpty(this.state.phoneNumber.E164)?this.state.phoneNumber.suffix:this.state.phoneNumber.E164,type:v.PhoneNumberTypes.Mobile};C.default.navigateToAddPhoneNumberPanel(s.AddPhoneNumberPanelOrigin.DialpadPanel,this._getRootViewId(),void 0,[t],void 0,this._onPhoneNumberSaved,this._onSaveNumberCancelled)}},this._onPhoneNumberSaved=e=>{S.default.preselectSavedContact(e),this.props.onContactSaved&&this.props.onContactSaved(),h.track(new y.SaveContactDialpadFlowStep(y.SaveContactFlowStep.SaveContactSuceeded))},this._onSaveNumberCancelled=()=>{c.default.shouldRestoreState(),h.track(new y.SaveContactDialpadFlowStep(y.SaveContactFlowStep.SaveContactCancelled))}}_buildState(e,t){return{phoneNumber:S.default.getPhoneNumber(m.TriggerKeys.E164),contentSizeMultiplier:f.default.getContentSizeMultiplier()}}render(){const e=this._useAccessibleTheme()?this._themeColors.primaryIconColor:_.Color.white,t=n.Styles.createTextStyle({color:e},!1),i=[I.titleStyle,b.default.bodyFontStyle(this._currentTheme),t];return!this._useDarkTheme()&&this._useAccessibleTheme()&&i.push(this._themeStyles.primaryTextColorStyle),h.track(new y.SaveContactDialpadFlowStep(y.SaveContactFlowStep.SaveContactButtonShow)),n.createElement(n.View,{style:I.buttonContainer},n.createElement(d.default,{marginLeft:10,marginRight:10,marginBottom:10,style:this._useDarkTheme()?I.topBorderDividerDarkTheme:I.topBorderDividerLightTheme}),n.createElement(u.default,{size:this._getContentSizeHeight(T.IconSize.size24),color:this._useAccessibleTheme()?this._themeColors.primaryIconColor:_.Color.white,icon:T.SkypeIcon.ContactAdd,title:g.getString("PSTNDialerPanel.PSTNDialerSaveContactButtonLabel"),accessibilityLabel:g.getString("PSTNDialerPanel.PSTNDialerSaveContactButtonLabel"),titleStyle:i,useTrailingIcon:!1,onPress:this._onButtonPress,style:I.buttonStyle}))}_getContentSizeHeight(e){return e*Math.min(this.state.contentSizeMultiplier||1,o.MaxContentSizeMultiplier)}}t.default=P},37627:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(15877),o=(i(33754),i(89871)),s=(i(86045),i(81760)),r=i(19675),l=i(24576),c=i(2301),d=i(67977),u=(0,n.lazyProperties)({container:()=>a.Styles.createButtonStyle({flex:0,flexDirection:"row",alignItems:"center",paddingHorizontal:10,paddingVertical:4}),textContainer:()=>a.Styles.createViewStyle({flex:1,marginHorizontal:10}),textStyle:()=>a.Styles.createTextStyle({backgroundColor:s.Color.transparent,color:s.Color.white})});class h extends l.default{_buildState(e,t){return{selectedResult:o.default.getSearchResults().selectedResult}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i)}render(){if(!this.state.selectedResult)return null;const e=!this._useDarkTheme()&&this._useAccessibleTheme();return a.createElement(a.View,{style:u.container},a.createElement(c.default,{key:"selectedContactUserIcon",size:d.UserIconSize.Size40,userMri:this.state.selectedResult.contact.userMri,statusBorderColor:this._themeColors.primaryBackgroundColor}),a.createElement(a.View,{style:u.textContainer},a.createElement(r.RowTitle,{style:e?this._themeStyles.primaryTextColorStyle:u.textStyle,numberOfLines:1},this.state.selectedResult.contact.displayName)))}}t.default=h},16610:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(16778),o=i(89391),s=i(10117),r=i(5581),l=i(58666),c=i(15877),d=i(33754),u=i(18078),h=i(81760),p=i(11010),g=i(11828),C=i(80837),m=i(24576),S=i(2301),y=i(67977),f=(0,c.lazyProperties)({iconPadding:()=>n.Styles.createViewStyle({paddingRight:10,paddingLeft:10}),selectLang:()=>n.Styles.createTextStyle({paddingTop:0,height:22,lineHeight:20,overflow:"hidden",flexShrink:1}),container:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),selectLangContainer:()=>n.Styles.createViewStyle({flex:1,flexGrow:1,flexShrink:1,flexDirection:"row",alignItems:"flex-start",alignContent:"flex-start",justifyContent:"flex-start",borderRadius:7}),selectLangContainerWidth:()=>n.Styles.createViewStyle({flexBasis:"40%"}),selectLangContainerPadding8:()=>n.Styles.createViewStyle({paddingTop:8,paddingBottom:6,paddingLeft:4,paddingRight:4}),selectLangContainerPadding3:()=>n.Styles.createViewStyle({padding:3}),selectLangContainerBg:()=>n.Styles.createViewStyle({backgroundColor:h.Color.gray400}),flagContainerMobile:()=>n.Styles.createViewStyle({marginLeft:4,marginRight:4,borderRadius:10,borderWidth:1,width:20,height:20,overflow:"hidden",paddingTop:4,paddingLeft:2,paddingRight:2,alignItems:"center"}),flagContainerDesktop:()=>n.Styles.createViewStyle({marginLeft:4,marginRight:4,borderRadius:10,borderWidth:1,width:20,height:20,overflow:"hidden",paddingTop:3,paddingLeft:2,paddingRight:2,alignItems:"center"}),flagContainerBig:()=>n.Styles.createViewStyle({marginLeft:4,marginRight:4,borderRadius:20,borderWidth:2,width:40,height:40,overflow:"hidden",paddingTop:8,paddingLeft:2,paddingRight:2,alignItems:"center"}),flagContainerBorderGray:()=>n.Styles.createViewStyle({borderColor:h.Color.gray200}),flagContainerBorderBlue:()=>n.Styles.createViewStyle({borderColor:h.Color.blue}),flag:()=>n.Styles.createTextStyle({fontSize:9,fontWeight:"700"}),flagColor:()=>n.Styles.createTextStyle({color:h.Color.white}),flagBig:()=>n.Styles.createTextStyle({color:h.Color.white,fontSize:18,fontWeight:"700"})}),_={textTransform:"uppercase"},b={textOverflow:"ellipsis",whiteSpace:"nowrap"};class T extends m.default{constructor(){super(...arguments),this._onLanguageChange=()=>{this.props.onLanguageChange(this.props.isLocalLanguage)},this._onButtonRef=e=>{this.props.onRef&&e&&this.props.onRef(e)}}_buildState(e,t){return{settings:o.default.getS4LCMCFeatures().pstnTranslation}}_getLangCodeFromCode(e){return a.split(e,"-")[0]}_getNameFromCode(e){const t=l.getShortLanguageTitle(e);return a.isEmpty(t)?e:t}render(){let e,t;const i=this._themeStyles.buttonBackgroundColorStyle,a=this._themeStyles.primaryIconColorStyle,o=this._themeColors.primaryIconColor,r=[f.selectLangContainer],l=[],c=[_];this.props.onlyIcon?(r.push(f.selectLangContainerPadding3),l.push(f.flagContainerBig),c.push(f.flagBig)):(r.push(i),r.push(f.selectLangContainerPadding8),r.push(f.selectLangContainerWidth),l.push(f.flagContainerDesktop),c.push(f.flag),c.push(a)),this.props.languageCode?l.push(f.flagContainerBorderBlue):l.push(f.flagContainerBorderGray);const h=[];if(!this.props.onlyIcon&&this.state.settings.useUserIconInsteadOfFlags){{const e=24;l.push(n.Styles.createViewStyle({borderWidth:0,paddingTop:0,paddingLeft:0,paddingRight:0,width:e,height:e+2},!1)),h.push(n.Styles.createTextStyle({height:e,lineHeight:e},!1))}t=this.props.languageCode?this._getNameFromCode(this.props.languageCode):d.getString("LanguageAndTranslationSettingsPanel.TranslationSelectLanguage");const i=this.props.isLocalLanguage?u.default.getSkypeMri():this.props.conversationId,a=y.UserIconSize.Size24;e=n.createElement(S.UserIcon,{userMri:i,size:a,showBorder:!0})}else this.props.languageCode?(t=this._getNameFromCode(this.props.languageCode),e=n.createElement(n.Text,{style:c},this._getLangCodeFromCode(this.props.languageCode))):(t=d.getString("LanguageAndTranslationSettingsPanel.TranslationSelectLanguage"),e=n.createElement(s.default,{icon:g.SkypeIcon.SkypeTranslator,size:g.IconSize.size20,color:o}));const C=this.props.onlyIcon?void 0:n.createElement(n.Text,{numberOfLines:1,style:[f.selectLang,this._themeStyles.primaryTextColorStyle,p.default.fontStyle.secondaryButton,b,...h]},t);let m;return this.props.languageCode?(m=this.props.isLocalLanguage?d.getString("LanguageAndTranslationSettingsPanel.TranslationSelectedLocalLanguageTitleAccessibility"):d.getString("LanguageAndTranslationSettingsPanel.TranslationSelectedOtherLanguageTitleAccessibility"),m+=": "+this._getNameFromCode(this.props.languageCode)):m=this.props.isLocalLanguage?d.getString("LanguageAndTranslationSettingsPanel.TranslationSelectLocalLanguageTitleAccessibility"):d.getString("LanguageAndTranslationSettingsPanel.TranslationSelectOtherLanguageTitleAccessibility"),n.createElement(n.Button,{style:r,onPress:this._onLanguageChange,accessibilityTraits:n.Types.AccessibilityTrait.Button,accessibilityLabel:m,importantForAccessibility:n.Types.ImportantForAccessibility.Auto,ref:this._onButtonRef},n.createElement(n.View,{style:l},e),C)}}class v extends m.default{constructor(){super(...arguments),this._onButtonRef=e=>{this.props.onRef&&e&&this.props.onRef(e)}}_buildState(e,t){return{localLanguageLocale:r.default.getLocalPstnCallTranlatorBotSpokenLanguageLocale(e.conversationId),otherLanguageLocale:r.default.getOtherPstnCallTranlatorBotSpokenLanguageLocale(e.conversationId)}}render(){const e=[f.container],t=[f.iconPadding];let i=g.IconSize.size24;this.props.onlyIcons||e.push(C.default.flexOne);const a=this._themeColors.primaryIconColor;return n.createElement(n.View,{style:e},n.createElement(T,{colorThemeOverride:this.props.colorThemeOverride,languageCode:this.state.localLanguageLocale,onLanguageChange:this.props.changeLanguage,onlyIcon:this.props.onlyIcons,isLocalLanguage:!0,onRef:this.props.onRef}),n.createElement(n.Button,{onPress:this.props.flipLanguages,accessibilityTraits:n.Types.AccessibilityTrait.Button,accessibilityLabel:d.getString("LanguageAndTranslationSettingsPanel.TranslationLanguageSwitchTitle"),importantForAccessibility:n.Types.ImportantForAccessibility.Auto,ref:this._onButtonRef},n.createElement(s.default,{icon:g.SkypeIcon.Refresh,size:i,color:a,style:t})),n.createElement(T,{colorThemeOverride:this.props.colorThemeOverride,languageCode:this.state.otherLanguageLocale,onLanguageChange:this.props.changeLanguage,onlyIcon:this.props.onlyIcons,isLocalLanguage:!1,onRef:this.props.onRef,conversationId:this.props.conversationId}))}}t.default=v},50845:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(62033),o=i(94224),s=i(98278),r=i(11734),l=i(53211),c=i(57139),d=i(46096),u=i(5581),h=i(36237),p=i(47126),g=i(15877),C=i(33754),m=i(46929),S=i(16610),y=i(76),f=(i(86045),i(81760)),_=i(11828),b=i(22222),T=i(24576),v=i(33574),w=i(53374),I=i(212),P=(0,g.lazyProperties)({langBarContainer:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center"}),langBarContainerPaddingTop:()=>a.Styles.createViewStyle({paddingTop:20}),doneButtonContainer:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",justifyContent:"center"}),doneButton:()=>a.Styles.createButtonStyle({alignSelf:"center"})}),M={marginTop:0,marginBottom:0};class k extends T.default{constructor(){super(...arguments),this._dividerCount=0,this._buttons=[],this._onKeyUp=e=>(e.keyCode===p.default.ESCAPE&&this._onBack(),!1),this._onBack=()=>{const e=w.default.newCauseId();return h.log(d.LogTraceArea.CallingUI,`PstnTranslatorCallControlsCustomActionMenu._onBack Menu close on ESC press, causeId: ${e}`),c.default.close(this._getRootViewId(),e),!0},this._onButtonsRef=e=>{e&&this._buttons.push(e)}}static menuHeight(){let e=0;return e+=150,e+=2*r.default.rowHeight(M),e+=r.default.rowHeight(M),e+=60,e}_buildState(e,t){const i={translatorVoice:m.default.getCallTranslatorBotTranslationVoice(),localLanguageLocale:u.default.getLocalPstnCallTranlatorBotSpokenLanguageLocale(e.conversationMri),otherLanguageLocale:u.default.getOtherPstnCallTranlatorBotSpokenLanguageLocale(e.conversationMri)};return e.callId&&(i.isTranslating=o.default.InCallBotService.isPstnTranslationEnabled(e.callId)),i}componentDidMount(){if(super.componentDidMount(),this._buttons.length>0){const e=this._buttons[0];0,null==e||e.requestFocus()}const e=w.default.newCauseId();h.log(d.LogTraceArea.CallingUI,`PstnTranslatorCallControlsCustomActionMenu.componentDidMount Menu open causeId: ${e}`),n.default.subscribe(this._onBack),a.Input.keyUpEvent.subscribe(this._onKeyUp)}componentWillUnmount(){super.componentWillUnmount();const e=w.default.newCauseId();h.log(d.LogTraceArea.CallingUI,`PstnTranslatorCallControlsCustomActionMenu.componentWillUnMount Menu close causeId: ${e}`),n.default.unsubscribe(this._onBack),a.Input.keyUpEvent.unsubscribe(this._onKeyUp)}_translationDisabled(){return!this.state.localLanguageLocale||!this.state.otherLanguageLocale||!this.state.translatorVoice}_getDividerProps(){let e=f.Color.whiteOverlay30;if(this.props.colorThemeOverride){e=I.default.themeColorsForTheme(this.props.colorThemeOverride).secondaryTextColor}return Object.assign(Object.assign({},M),{key:"divider-"+this._dividerCount++,rowHeight:r.default.rowHeight(M),color:e})}render(){const e=[],t=a.createElement(a.View,{style:[P.langBarContainer,void 0]},a.createElement(S.default,{colorThemeOverride:this.props.colorThemeOverride,conversationId:this.props.conversationMri,flipLanguages:this.props.flipLanguages,changeLanguage:this.props.changeLanguage})),i=C.getString("LanguageAndTranslationSettingsPanel.TranslationSelectLanguageTitle"),n={key:"langswitch",rowType:l.CustomActionMenuRowType.Custom,accessibilityLabel:i,rowHeight:70,hideBorder:!0,customElement:t,hoverStyle:a.Styles.createViewStyle({})};e.push({props:n,builder:l.default.buildRow}),e.push({props:this._getDividerProps(),builder:r.default.buildRow});const o=C.getString("LanguageAndTranslationSettingsPanel.TranslationSelectVoiceTitle"),c=this.state.translatorVoice?v.default.getLabelForGender(this.state.translatorVoice):C.getString("LanguageAndTranslationSettingsPanel.TranslationSelectDefaultValue"),d=o+", "+c,u={key:"translationvoice",rowType:l.CustomActionMenuRowType.Default,accessibilityLabel:d,titleText:o,onRowPress:this.props.changeVoice,rowHeight:50,hideBorder:!0,icon:_.SkypeIcon.PersonVoice,rightSideText:c,onRef:this._onButtonsRef,hoverStyle:a.Styles.createViewStyle({})};e.push({props:u,builder:l.default.buildRow}),e.push({props:this._getDividerProps(),builder:r.default.buildRow});const h=C.getString("LanguageAndTranslationSettingsPanel.TranslateThisCall"),p=h+", "+(this.state.isTranslating?C.getString("ToggleSwitch.OnText"):C.getString("ToggleSwitch.OffText")),g={key:"translatecall",rowType:l.CustomActionMenuRowType.Toggle,isSelected:this.state.isTranslating,accessibilityLabel:p,titleText:h,onRowPress:this.props.translateCall,rowHeight:50,hideBorder:!0,icon:_.SkypeIcon.SkypeTranslator,disabled:this._translationDisabled(),toggleOverlayColorAndroid:f.Color.black,onRef:this._onButtonsRef,hoverStyle:a.Styles.createViewStyle({})};if(e.push({props:g,builder:l.default.buildRow}),!this.props.isUsingStackNavigationContext){e.push({props:this._getDividerProps(),builder:r.default.buildRow});const t=C.getString("Global.DoneButtonTitle"),i=a.createElement(a.View,{style:[P.doneButtonContainer]},a.createElement(b.default,{buttonSize:s.SXButtonSize.Small,buttonStyle:s.SXButtonStyle.ColorFill,title:t,onPress:this.props.closeMenu,style:P.doneButton})),n={key:"done",rowType:l.CustomActionMenuRowType.Custom,accessibilityLabel:t,rowHeight:60,hideBorder:!0,customElement:i,hoverStyle:a.Styles.createViewStyle({})};e.push({props:n,builder:l.default.buildRow})}return a.createElement(y.default,{rowBuilders:e,colorThemeOverride:this.props.colorThemeOverride,style:this.props.style})}}t.default=k},1452:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(31844),n=i(16778),o=i(44770),s=i(98278),r=i(72822),l=i(35251),c=i(15877),d=i(33754),u=i(4735),h=i(94021),p=i(38980),g=(i(28377),i(29130)),C=i(22222),m=i(19675),S=i(24576),y=(0,c.lazyProperties)({noCallsItemContainer:()=>n.Styles.createViewStyle({alignItems:"center",paddingHorizontal:10}),noCallsItemContainerSmallTopMargin:()=>n.Styles.createViewStyle({marginTop:20}),noCallsItemContainerLargeTopMargin:()=>n.Styles.createViewStyle({marginTop:70,marginBottom:10}),noCallsItemInfoText:()=>n.Styles.createTextStyle({textAlign:"center"}),noCallsItemButton:()=>n.Styles.createButtonStyle({flex:1,marginTop:20,minWidth:190,alignSelf:"center"}),noCallsImageV3:()=>n.Styles.createImageStyle({width:130,height:130,alignSelf:"center"})});class f extends S.default{constructor(){super(...arguments),this._syncLocalAddressStore=()=>{this.state.hideSyncAddressBookCta||u.default.navigateToSyncAddressBook({origin:r.DialogNavOrigin.NoCallsItem,hideSkipButton:!0},void 0,this._getRootViewId())}}static getDefaultHeight(){return 157}_buildState(e,t){const i=this._getRootViewId();let n={hideSyncAddressBookCta:!0,isLandscape:g.default.getDeviceOrientation(i)===a.DeviceOrientation.Landscape&&!this._getContext().isPresentedInDesktopSubview,isSmallDevice:g.default.isSmallDevice(i)};return t&&(n.hideSyncAddressBookCta||p.default.track(new h.DisplayedEmptyStateCta(h.EmptyStateOrigin.NoCalls))),n}render(){let e,t,i=[y.noCallsItemContainer];return this.state.hideSyncAddressBookCta||(e=n.createElement(C.default,{style:y.noCallsItemButton,buttonStyle:s.SXButtonStyle.ColorFill,buttonSize:s.SXButtonSize.Medium,onPress:this._syncLocalAddressStore,title:d.getString("NoCallsItem.ConnectButton")})),this.state.isLandscape||(t=n.createElement(n.Image,{style:y.noCallsImageV3,resizeMode:"contain",source:o.Collection.ONBOARDING_CALLS_EMPTYSTATE_NOCALLS_V3})),n.createElement(n.View,{style:i},t,n.createElement(l.default,{headerText:this.props.title}),n.createElement(m.BodyText,{style:y.noCallsItemInfoText,textThemeColor:m.TextThemeColor.Secondary},this.props.infoLabel),e)}}t.default=f},70170:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(15069),o=i(31844),s=i(16778),r=i(74634),l=i(89391),c=i(67930),d=i(94224),u=i(68580),h=i(98925),p=i(37034),g=i(71830),C=i(52754),m=i(80128),S=i(11930),y=i(3056),f=i(98278),_=i(984),b=i(39549),T=i(41444),v=i(24631),w=i(81011),I=i(46096),P=i(81722),M=i(66127),k=i(13944),A=i(66649),R=i(36237),V=i(15877),L=i(18460),E=i(41209),B=i(33754),O=i(78735),D=i(34537),x=i(4735),N=i(30124),U=i(48199),F=i(1452),H=i(28377),z=i(91570),G=i(82052),W=i(93003),K=i(29130),j=i(14976),Q=i(51070),$=i(81115),q=i(36150),X=i(4101),Z=i(70919),J=i(94622),Y=i(10541),ee=i(32514),te=i(29165),ie=i(48367),ae=i(24067),ne=i(90631),oe=i(95384),se=i(58585),re=i(19364),le=i(16392),ce=i(49603),de=i(12187),ue=i(22222),he=i(11828),pe=i(80837),ge=i(72758),Ce=i(53374),me=i(91066),Se=i(11010),ye=[z.QuickCallPanelFilter.All,z.QuickCallPanelFilter.Skype,z.QuickCallPanelFilter.Phone],fe=(0,V.lazyProperties)({mainContainer:()=>s.Styles.createViewStyle({alignSelf:"stretch",flex:1}),headerContainer:()=>s.Styles.createViewStyle({flexDirection:"column",alignItems:"stretch"}),innerHeaderContainer:()=>s.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),searchInputContainer:()=>s.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),noCallsContainer:()=>s.Styles.createViewStyle({flex:1,paddingLeft:12,paddingRight:12,paddingTop:20,paddingBottom:20}),searchBoxContainerCompositeNav:()=>s.Styles.createViewStyle({alignSelf:"stretch",alignItems:"stretch",justifyContent:"center",flexDirection:"row",height:Z.SearchInputHeight.default,paddingLeft:15,paddingVertical:10,flex:1}),searchHeaderWrapper:()=>s.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0}),searchAccessoryButton:()=>s.Styles.createViewStyle({marginRight:5}),dialpadBarAccessibilityOffset:()=>s.Styles.createViewStyle({marginBottom:65})}),_e={zeroInput:[{groupType:I.SearchResultsListGroup.PstnDialpad},{groupType:I.SearchResultsListGroup.UpcomingCalls},{groupType:I.SearchResultsListGroup.RecentCalls},{groupType:I.SearchResultsListGroup.SuggestedFrequentConversations},{groupType:I.SearchResultsListGroup.CombinedContactsWithoutAlphaHeaders}],zeroInputWithDialpadAccessory:[{groupType:I.SearchResultsListGroup.UpcomingCalls},{groupType:I.SearchResultsListGroup.RecentCalls},{groupType:I.SearchResultsListGroup.SuggestedFrequentConversations},{groupType:I.SearchResultsListGroup.CombinedContactsWithoutAlphaHeaders}],zeroInputSearchOnly:[{groupType:I.SearchResultsListGroup.RecentCalls},{groupType:I.SearchResultsListGroup.SuggestedFrequentConversations},{groupType:I.SearchResultsListGroup.CombinedContactsWithoutAlphaHeaders}],zeroInputOneOnOneCall:[{groupType:I.SearchResultsListGroup.RecentCalls},{groupType:I.SearchResultsListGroup.SuggestedFrequentConversations},{groupType:I.SearchResultsListGroup.CombinedContactsWithoutAlphaHeaders}],zeroInputAddToOneOnOneCall:[{groupType:I.SearchResultsListGroup.SuggestedFrequentConversations},{groupType:I.SearchResultsListGroup.CombinedContactsWithoutAlphaHeaders}],zeroInputGroupCall:[{groupType:I.SearchResultsListGroup.GroupMember},{groupType:I.SearchResultsListGroup.SuggestedFrequentConversations},{groupType:I.SearchResultsListGroup.CombinedContactsWithoutAlphaHeaders}],zeroInputCallsOnly:[{groupType:I.SearchResultsListGroup.RecentCallsExtended}],shortQuery:[{groupType:I.SearchResultsListGroup.AllPeople},{groupType:I.SearchResultsListGroup.GroupChats}],longQuery:[{groupType:I.SearchResultsListGroup.AllPeople,isCollapsible:!0},{groupType:I.SearchResultsListGroup.GroupChats,isCollapsible:!0},{groupType:I.SearchResultsListGroup.PublicDirectory,isCollapsible:!0}]},be="quickCallHeader",Te="selectedProfilesList",ve="quickCallSearchResultList",we="compositeNavsearchResultsListWrapper";class Ie extends c.default{constructor(e){super(e),this._onKeyDownEvent=new r.default,this._searchActive=!1,this._shadowVisible=!1,this._headerExpanded=!0,this._selectedProfiles=[],this._headerAnimatedTopValue=new s.Animated.Value(0),this._headerAnimatedTopStyle=s.Styles.createAnimatedViewStyle({transform:[{translateY:this._headerAnimatedTopValue}]}),this._resetTransitionTransformValue=new s.Animated.Value(0),this._resetTransitionOpacityValue=new s.Animated.Value(1),this._resetTransitionStyle=s.Styles.createAnimatedViewStyle({opacity:this._resetTransitionOpacityValue,transform:[{translateY:this._resetTransitionTransformValue}]}),this._shadowOpacityValue=new s.Animated.Value(0),this._shadowOpacityStyle=s.Styles.createAnimatedViewStyle({opacity:this._shadowOpacityValue}),this._renderAddContacts=()=>s.createElement(s.View,{style:fe.noCallsContainer,key:"noCallsItem"},s.createElement(F.default,{infoLabel:B.getString("QuickCallPanel.NoCallsDescriptionDesktop"),title:B.getString("QuickCallPanel.NoCallsTitleDesktop")})),this._renderDialpadButtonMobile=()=>s.createElement(k.default,{size:he.IconSize.size24,onPress:this._onPressDialer,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,icon:he.SkypeIcon.Dialpad,title:B.getString("PeopleList.PstnDialpadLabel")}),this._handleMenuCommand=e=>{if(!this.isComponentMounted())return;const t=Ie._filterForCommand(e);a.isUndefined(t)||(O.default.setUserPreferencesLocal({quickCallFilter:t}),this.setState({filter:t}))},this._getSearchButton=(e,t)=>{const i=e?$.default.horizontalPaddingStyle(e):void 0;let a=s.createElement(X.default,{key:"search",buttonOnly:!0,placeholderText:this.state.modernizeMobileTabHeader?B.getString("SearchInputControl.PlaceHolderTextShort"):B.getString("SearchInputControl.PlaceHolderTextPeopleGroupsMessages"),accessibilityLabel:this.state.isMobileScreenReaderEnabled?B.getString("HubHeaderPanel.SearchHubAccessibilityLabel"):void 0,useIOSStyles:!this.state.modernizeMobileTabHeader&&this.state.useIOSSearchStyles,safeAreaPaddingStyle:i,showSearchIcon:this._getContext().isPresentedInGenericDesktopModal||this.state.modernizeMobileTabHeader,onPress:this._handleSearchButtonClick});if(e&&t){const t=s.Styles.createViewStyle({marginLeft:-1*e.left,marginRight:-1*e.right},!1);a=s.createElement(s.View,{style:t},a)}return this.state.useMobileOrTabletUI?a:s.createElement(s.View,{style:[fe.searchBoxContainerCompositeNav,this._themeStyles.searchBoxColorStyle]},a)},this._handleSearchButtonClick=()=>{const e=Ce.default.newCauseId();R.log(I.LogTraceArea.QuickCallPanel,"_handleSearchButtonClick causeId: "+e),x.default.navigateToSearchFromPanel(e,this._getContext(),this._isPresentedInTabletLeftNav(),I.SearchPanelInitiator.QuickCallPanel)},this._addSelectedUsersToCall=()=>{const e=Ce.default.newCauseId();R.log(I.LogTraceArea.QuickCallPanel,"_addSelectedUsersToCall causeId: "+e),this.state.selectedMris&&this._addUsersToCall(this.state.selectedMris.map((e=>{const t=this.state.mriToPhoneMriMap.get(e);return t||e})),e)},this._handleSearchResultsListAddUserToCall=(e,t)=>{const i=Ce.default.newCauseId();R.log(I.LogTraceArea.QuickCallPanel,"_handleAddUserToCall causeId: "+i),this._containerRef&&this._containerRef.requestFocus?this._searchResultsListActionHelper(t,e,i):R.error(I.LogTraceArea.QuickCallPanel,"_searchResultsListActionHelper anchor is not focusable:  has container ref: "+!!this._containerRef+", causeId: "+i)},this._handleSearchResultsListItemClick=(e,t,i)=>{const a=Ce.default.newCauseId();if(R.log(I.LogTraceArea.QuickCallPanel,"_handleListItemClick causeId: "+a),i===I.SearchResultsListGroup.PstnDialpad)this._onPressDialer();else{const i=()=>e.isComponentMounted()?e:void 0;this._searchResultsListActionHelper(i,t,a)}},this._onPressDialer=()=>{const e=Ce.default.newCauseId();R.log(I.LogTraceArea.QuickCallPanel,"_onToggleDialpad, causeId: "+e),this._onInputTextChange("");let t=I.DialerNavigationSource.QuickCallPanel;this.props.callId?t=this.props.newGroup?I.DialerNavigationSource.QuickCallPanelAddToCall:I.DialerNavigationSource.QuickCallPanelNewCall:this.state.isInGroupCallMode&&(t=this.props.newGroup?I.DialerNavigationSource.QuickCallPanelNewCall:I.DialerNavigationSource.QuickCallPanelAddToCall),x.default.navigateToPSTNDialerWithParams({callId:this.props.callId,conversationId:this.props.conversationId,causeId:e,navigationSource:t},this._getRootViewId())},this._removeProfileFromSelection=e=>{if(this.isComponentMounted()){const t=e.getMri(),i=t?this._removeEntryFromMriToPhoneMap(t):void 0,n=a.compact(a.without(this.state.selectedMris,i||t));this.setState({selectedMris:n}),this._searchResultsList?this._searchResultsList.focusFirst():this._groupCallModeHeaderButtonRef&&this._groupCallModeHeaderButtonRef.requestFocus()}},this._onSimplePanelHeaderRef=e=>{this._headerRef=e||void 0},this._onSearchResultsListRef=e=>{this._searchResultsList=e||void 0},this._onContainerRef=e=>{this._containerRef=e||void 0},this._onGroupCallModeHeaderButtonRef=e=>{this._groupCallModeHeaderButtonRef=e||void 0},this._onGroupCallBackHeaderButtonRef=e=>{this._groupCallBackHeaderButtonRef=e||void 0},this._onSearchActive=e=>{this._showOrHideHeader(this.state,!e,!0),e?this.setState({isSearchActive:e}):this.setState({isSearchActive:e,rawSearchQuery:""}),this._updateStatusBarStyle(e&&!this._useAccessibleTheme()?de.default.createBarStyle(ce.BarStyleTheme.Light,!0):de.default.createBarStyle(this._themeColors.defaultStatusBarTheme,!0))},this._onPressClose=()=>{const e=Ce.default.newCauseId();R.log(I.LogTraceArea.QuickCallPanel,"_onPressClose causeId: "+e),this.setState({rawSearchQuery:""}),this._goBack(e)},this._onSearchInputKeyDown=e=>{this._onKeyDownEvent.fire(e.keyCode)},this._onContentWrapperRef=e=>{this._wrappedTransitionView=e||void 0},this._onSearchHeaderRef=e=>{this._searchHeader=e||void 0},this._onHeaderExpanded=e=>{if(this.isComponentMounted()){let t;t=e&&!this._useAccessibleTheme()?de.default.createBarStyle(ce.BarStyleTheme.Light):de.default.createBarStyle(this._themeColors.defaultStatusBarTheme),this._updateStatusBarStyle(t)}},this._onScroll=(e,t)=>{if(this.props.onScroll&&this.props.onScroll(e,t),this._shouldCollapseHeader()){let i=this._headerExpanded;if(e<m.default.collapsableHeight(this._getRootViewId()))i=!0;else{const a=t-e>0;i=i&&a}this._expandOrCollapseHeader(i,!0)}},this._onExperimentalNavScroll=(e,t)=>{this.props.onScroll&&this.props.onScroll(e,t);const i=e>0;this._shadowVisible!==i&&(s.Animated.timing(this._shadowOpacityValue,{toValue:i?.5:0,duration:100,easing:s.Animated.Easing.Out()}).start(),this._shadowVisible=i)},this._onExperimentalCallButtonPress=e=>{{const t=Ce.default.newCauseId();R.log(I.LogTraceArea.QuickCallPanel,"_handleGroupCallButtonClick_Floating_CTA_desktop causeId: "+t),this._enterGroupCallMode(e)}},this._enterGroupCallMode=e=>{e.stopPropagation(),this.setState({isInGroupCallMode:!0})},this._leaveGroupCallMode=e=>{e.stopPropagation(),this.setState({isInGroupCallMode:!1,selectedMris:[]})},this._startGroupCall=()=>{const e=Ce.default.newCauseId();if(R.log(I.LogTraceArea.QuickCallPanel,"_startGroupCall causeId: "+e),this.state.selectedMris&&1===this.state.selectedMris.length){const t=()=>this._groupCallModeHeaderButtonRef;this._startCallToMri(this.state.selectedMris[0],t,e,I.NavigationCallOrigin.QuickCallPanelNewCall)}else this.setState({isNewGroupCallStarting:!0}),this.state.selectedMris?d.default.CallNavigationHelper.startNewGroupCallAndConversation(this.state.selectedMris,!1,e,void 0,I.NavigationCallOrigin.StartNewGroupCallAndConv).always((()=>{this.isComponentMounted()&&this.setState({isNewGroupCallStarting:!1})})):R.error(I.LogTraceArea.QuickCallPanel,"_startGroupCall with no mris causeId: "+e)},this._onInputTextChange=e=>{this.isComponentMounted()&&this.setState({rawSearchQuery:e})},this._goBack=e=>(R.log(I.LogTraceArea.QuickCallPanel,"QuickCallPanel._goBack, causeId: "+e),this._isPresentedInTabletLeftNav()?(x.default.closeCallSearchPanel(e,this._getContext()),!0):super._goBack(e)),e.searchOnly&&(this._transitionSubscriptionToken=U.default.transitionInfoEvent().subscribe((e=>{if(e.inProgress&&this.isComponentMounted())if(U.default.isHubSearchTransition()){if(e.toRoute&&e.fromRoute&&e.progress){const t=e.toRoute.type===U.RouteType.Search?e.toRoute.index:e.fromRoute.index;a.isUndefined(t)?this._clearAnimatedValues():this._setAnimatedValues(e.progress,t)}}else this._clearAnimatedValues()})))}_buildState(e,t){let i=z.QuickCallPanelFilter.All;e.useExperimentalDesktopUtilityBar&&(i=O.default.getUserPreferencesLocal().quickCallFilter||z.QuickCallPanelFilter.All);let n={filter:i};t&&(n.isSearchActive=!1,n.isInGroupCallMode=!1,n.isNewGroupCallStarting=!1,n.selectedMris=[],n.mriToPhoneMriMap=new Map,n.rawSearchQuery="",this._searchController=new ee.default,e.newGroup&&(n.isInGroupCallMode=!0),n.modernizeMobileTabHeader=M.default.canModernizeMobileTabHeader()||M.default.canModernizeMobileTabHeaderTablets(),this._headerAnimatedHeightValue=new s.Animated.Value(m.default.expandedHeight(this._getRootViewId())),this._headerAnimatedHeightStyle=s.Styles.createAnimatedViewStyle({height:this._headerAnimatedHeightValue}));const r=this._getContext(),l=this._getRootViewId(),c=N.default.isUsingStackNavigationContext(),h=!e.hideHeader&&(!r.isPresentedInDesktopSubview||this._isPresentedInTabletLeftNav());n.isSmallDevice=K.default.isSmallDevice(l),n.statusBarPadding=h?Q.default.statusBarPadding():0,n.isPortrait=K.default.getDeviceOrientation(l)===o.DeviceOrientation.Portrait,n.isSyncAddressBookEnabled=H.default.getSyncAddressBookPrivacySetting(),n.hasCallsAndContacts=(0,b.default)().hasJoinedConversationsWithCall()||_.default.getFilteredSortedAllPeopleProfiles("",{excludeBots:!0,excludeShortCircuitMatches:!n.isSyncAddressBookEnabled,excludeUnauthorized:!n.isSyncAddressBookEnabled,excludeBlocked:!0}).length>0,n.useIOSSearchStyles=m.default.useIOSSearchStyles(),n.useMobileOrTabletUI=c||!!this._isPresentedInTabletLeftNav(),n.disableHighBandwidthOperations=A.default.isUsingGogoNetwork();const p=e.callId,g=e.conversationId;if(p&&g){n.activeCallMemberMris=a.map(a.filter(d.default.CallingStore.getRemoteCallMembers(p),(e=>!!e&&(u.default.isParticipantConnected(e)||u.default.isParticipantStateRinging(e.state)))),(e=>d.default.CallingStore.getRemoteCallMemberMri(p,e)));const e=(0,b.default)().getConversation(g);e&&(n.conversationMemberMris=e.getMemberMris())}return n.isMobileScreenReaderEnabled=q.default.isMobileScreenReaderEnabled(),n.rowSize=this._isPresentedInDesktopLeftNav()?G.default.nonRecentRowSizeAndChanges():void 0,n.enableIOSCallsFABExperiment=!1,n.modernizeConversationList=M.default.canModernizeConversationList(),n}scrollToTop(){this._searchResultsList&&this._searchResultsList.scrollToTop()}componentDidMount(){super.componentDidMount();const e=de.default.mergeStyles([de.default.createBarStyle(this.props.searchOnly?ce.BarStyleTheme.Light:this._themeColors.defaultStatusBarTheme),de.default.createHiddenStyle(!1)]);this._updateStatusBarStyle(e),this._showOrHideHeader(this.state,!this._searchActive,!1),this._onScroll(0,0),oe.default.showPromptIfNeeded(this.props.conversationId||f.MainRootViewId)}componentWillUnmount(){super.componentWillUnmount(),this._transitionSubscriptionToken&&(this._transitionSubscriptionToken.unsubscribe(),this._transitionSubscriptionToken=void 0),this._searchController&&this._searchController.destroy(),this._onScroll(0,0)}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i);const n=e=>{const t=this.state.mriToPhoneMriMap.get(e);return t||e};this._selectedProfiles=a.map(t.selectedMris,(e=>ge.default.getDisplayableUserByMri(n(e)))),this.state.statusBarPadding===t.statusBarPadding&&this.state.isPortrait===t.isPortrait&&this.state.selectedMris===t.selectedMris||this._showOrHideHeader(t,!this._searchActive,!1)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.state.isInGroupCallMode!==t.isInGroupCallMode&&(this._headerRef&&this._headerRef.requestFocus(),this._groupCallBackHeaderButtonRef&&this.state.isInGroupCallMode&&this._groupCallBackHeaderButtonRef.requestFocus())}render(){const e=this._shouldCollapseHeader(),t=a.trim(this.state.rawSearchQuery),i=0===t.length;let n;if(i)if(this.state.filter===z.QuickCallPanelFilter.Phone||this.state.filter===z.QuickCallPanelFilter.Skype)n=a.clone(_e.zeroInputCallsOnly);else if(e)n=a.clone(_e.zeroInputSearchOnly);else{let e=a.clone(_e.zeroInputGroupCall);l.default.getS4LCMCFeaturesNoSubscription().enableAddToCallGroupJoinLink&&e.unshift({groupType:I.SearchResultsListGroup.ShareGroup}),n=this.state.isInGroupCallMode?this.props.conversationId&&g.isGroupConversation(this.props.conversationId)?e:this.props.callId?a.clone(_e.zeroInputAddToOneOnOneCall):a.clone(_e.zeroInputOneOnOneCall):a.clone(_e.zeroInputWithDialpadAccessory)}else n=t.length<l.default.getConfigSettingsNoSubscription().search.longQueryCharCount?a.clone(_e.shortQuery):a.clone(_e.longQuery);(this.state.isInGroupCallMode||this.props.callId)&&a.remove(n,(e=>e.groupType===I.SearchResultsListGroup.GroupChats));const o=this._shouldShowDialPadBar(n),r=this.props.useExperimentalDesktopUtilityBar?this._renderUtilityBar():void 0,c=r?this._renderShadow():void 0,d=[fe.mainContainer,this._getBackgroundColorStyle()];let u=[];if(this.state.hasCallsAndContacts||this.state.isSyncAddressBookEnabled){this.state.isInGroupCallMode&&!a.isEmpty(this._selectedProfiles)&&u.push(s.createElement(te.default,{key:Te,selectedProfiles:this._selectedProfiles,onProfileRemoved:this._removeProfileFromSelection}));const t=this.props.callId||this.state.isInGroupCallMode?Y.FilterType.GroupCallCapable:Y.FilterType.CallCapable;let r=0;e&&(r=m.default.collapsableHeight(this._getRootViewId()));const l=!this.state.isInGroupCallMode&&(!this.props.callId&&i),d=Math.max(this.props.bottomPadding||0,o&&!this.state.isMobileScreenReaderEnabled?65:0),h=e||this.props.onScroll?this._onScroll:c?this._onExperimentalNavScroll:void 0,p=this._getContext().isPresentedInGenericDesktopModal?I.SearchResultsListOrigin.QuickCallPanelModal:I.SearchResultsListOrigin.QuickCallPanel,g=s.createElement(J.SearchResultsList,{rawSearchQuery:this.state.rawSearchQuery,origin:p,ref:this._onSearchResultsListRef,key:ve,userMrisToExclude:this.state.activeCallMemberMris,searchResultGroups:n,searchController:this._searchController,isSearchActive:this.state.isSearchActive,hasCallIcons:l,hasAddToCallIcon:!!this.props.callId&&!this.props.newGroup,filterPeopleType:t,arePeopleSelectableForInvite:this.state.isInGroupCallMode,maxNumberOfSuggestedContacts:20,onListItemClick:this._handleSearchResultsListItemClick,onAddUserToCall:this.props.callId?this._handleSearchResultsListAddUserToCall:void 0,selectedMris:this.state.isInGroupCallMode?this.state.selectedMris:void 0,showInviteButton:!1,showButtonsOnHover:this.props.useExperimentalDesktopUtilityBar,disableItemOnLongPress:!0,excludeGroups:this.state.isInGroupCallMode,excludeEncrypted:this.state.isInGroupCallMode,onlyPstn:this.state.filter===z.QuickCallPanelFilter.Phone,excludePstn:this.state.filter===z.QuickCallPanelFilter.Skype,keyDownEvent:this._onKeyDownEvent,headerViewConfig:this._getSearchButtonConfig(),topInset:r,bottomPadding:d,onScroll:h,accessibilityLabel:B.getString("QuickCallPanel.CallsList"),suppressPseudoFocus:!0,conversationId:this.props.conversationId,hideEmptyState:this.props.newGroup,rowSize:this.state.rowSize,excludeRecentCallFromSuggestedList:!0,isMobileTab:!!this.props.isMobileTab});this.state.useMobileOrTabletUI?u.push(g):u.push(s.createElement(s.View,{style:pe.default.flexOne,key:we},g,c))}else this._isPresentedInDesktopLeftNav()||u.push(s.createElement(re.default,{key:"skypeToPhoneCardExperiment",location:P.ExperimentLocation.CallsPanel})),u.push(this._renderAddContacts());const h=[pe.default.flexOne];let p;this.state.useMobileOrTabletUI?(this.props.searchOnly&&h.push(s.Styles.createViewStyle({marginTop:m.default.collapsedHeight(this._getRootViewId())+this.state.statusBarPadding},!1)),o&&this.state.isMobileScreenReaderEnabled&&h.push(fe.dialpadBarAccessibilityOffset),p=s.createElement(s.View,{key:"content",style:h},u)):p=u;const C=e?this._renderSearchHeader():this._renderHeaderContainer(),S=o?s.createElement(w.default,{key:"DialpadBarExperiment",location:P.ExperimentLocation.CallsPanel,onPress:this._onPressDialer,onCallButtonPress:this._onExperimentalCallButtonPress}):void 0,f=this._getFooterButton(),_=[C,r,p,S];let b=s.createElement(s.View,{ref:this._onContainerRef,style:d},e?a.reverse(_):_,this._renderEntitlementsBanner(),f?this._getPanelFooter(f):void 0);return this.props.searchOnly&&(b=s.createElement(me.default,{ref:this._onContentWrapperRef,style:fe.mainContainer},b)),s.createElement(y.default,{goBack:this._goBack},b)}_getPanelFooter(e){const t=s.createElement(ae.default,{button:e});return this.state.modernizeConversationList?s.createElement(s.View,{style:D.default.getBannerBackgroundColorStyle(this._useDarkTheme(),this._useAccessibleTheme(),this._themeStyles)},t):t}_getBackgroundColorStyle(){return this.state.modernizeConversationList&&(this._isPresentedInDesktopLeftNav()||this._isPresentedInTabletLeftNav())?D.default.getBackgroundColorStyle(this._useDarkTheme(),this._useAccessibleTheme(),this._themeStyles):this._isPresentedInDesktopLeftNav()?this._themeStyles.secondaryBackgroundColorStyle:this._themeStyles.primaryBackgroundColorStyle}_renderShadow(){return s.createElement(v.default,{opacityStyle:this._shadowOpacityStyle})}_renderUtilityBar(){const e=Ie._menuItemTitle(this.state.filter),t=S.default.combinedAccessibilityLabel(B.getString("QuickCallPanel.ViewByMenu"),e);return s.createElement(ie.default,{key:"utilitybar",getMenuSections:this._getMenuSections(),currentMenuText:e,accessibilityText:t,onHandleMenuCommand:this._handleMenuCommand,newActionPickerContext:this.props.newActionPickerContext})}_renderSearchHeader(){if(this.state.useMobileOrTabletUI)return s.createElement(s.View,{key:be,style:fe.searchHeaderWrapper,ignorePointerEvents:!0},s.createElement(C.default,{ref:this._onSearchHeaderRef,initialValue:1,autoFocus:!0,rawSearchQuery:this.state.rawSearchQuery||"",onInputTextChange:this._onInputTextChange,cancelSearch:this._onPressClose,onExpanded:this._onHeaderExpanded}))}_renderHeaderContainer(){if(this.props.hideHeader)return;let e;if(this.state.useMobileOrTabletUI){let t,i;t=s.createElement(C.default,{initialValue:1,showButtonWhenInactive:!0,placeholderText:this.state.modernizeMobileTabHeader?B.getString("SearchInputControl.PlaceHolderTextShort"):B.getString("SearchInputControl.PlaceHolderTextPeopleGroupsMessages"),buttonAccessibilityLabel:this.state.isMobileScreenReaderEnabled?B.getString("HubHeaderPanel.SearchHubAccessibilityLabel"):void 0,rawSearchQuery:this.state.rawSearchQuery||"",onInputTextChange:this._onInputTextChange,onActive:this._onSearchActive,actionButton:this.state.isInGroupCallMode?this._groupCallModeHeaderButton():void 0,buttonAccessoryView:this._renderDialpadButtonMobile(),hideButtonAccessoryViewBorder:!0}),this.state.hasCallsAndContacts&&(i=s.createElement(s.View,{style:fe.searchInputContainer},t));const a=this._getHeaderText(this.state),o=a?void 0:s.createElement(s.View,{style:pe.default.flexOne});e=s.createElement(s.Animated.View,{key:be,style:[fe.headerContainer,this._headerAnimatedHeightStyle]},s.createElement(s.Animated.View,{style:n.default.isMobile()?void 0:this._headerAnimatedTopStyle},s.createElement(ne.SimplePanelHeader,{ref:this._onSimplePanelHeaderRef,panelName:a,leftButton:this._getHeaderCloseButton(),titleView:o,hideBottomBorder:!0,delayHeaderFocus:!1,shouldAnnouncePanelNameOnMount:!!this.props.callId&&!1}),i))}else{let t;if(this.state.hasCallsAndContacts){const e=s.createElement(ue.default,{style:fe.searchAccessoryButton,buttonStyle:f.SXButtonStyle.LightFill,buttonSize:f.SXButtonSize.Small,title:B.getString("QuickCallPanel.DialpadButtonLabel"),allowTextWrap:!1,icon:he.SkypeIcon.Dialpad,showShadow:!0,onPress:this._onPressDialer});t=s.createElement(s.View,{style:fe.searchInputContainer},s.createElement(T.default,{placeholderText:B.getString("SearchInputControl.PlaceHolderTextPeopleGroupsMessages"),accessoryView:e,showButtonWhenInactive:!0,autoFocus:!s.UserInterface.isNavigatingWithKeyboard(),autoFocusWhenActive:!0,buttonAccessibilityLabel:this.state.isMobileScreenReaderEnabled?B.getString("HubHeaderPanel.SearchHubAccessibilityLabel"):void 0,rawSearchQuery:this.state.rawSearchQuery||"",onInputTextChange:this._onInputTextChange,onActive:this._onSearchActive,onKeyDown:this._onSearchInputKeyDown}))}e=s.createElement(s.View,{style:fe.headerContainer,key:be},this._renderCompositeNavHeader(),s.createElement(s.View,{style:[fe.innerHeaderContainer,this._themeStyles.searchBoxColorStyle]},t))}return e}_renderEntitlementsBanner(){if(this._isPresentedInDesktopLeftNav())return s.createElement(se.default,{location:P.ExperimentLocation.CallsPanelBanner,useCompactLayout:this.state.rowSize===W.RowSize.ExtraCompact,onClose:()=>{this._searchResultsList&&this._searchResultsList.focusFirst()}})}_renderCompositeNavHeader(){return s.createElement(ne.SimplePanelHeader,{panelName:this._getHeaderText(this.state),leftButton:this._getHeaderCloseButton(),hideBottomBorder:!0,delayHeaderFocus:!1})}_getMenuSections(){return[{key:"calls",menuItems:a.map(ye,(e=>({text:Ie._menuItemTitle(e),command:Ie._menuItemCommand(e),selected:e===this.state.filter,isCheckbox:!0})))}]}_getSearchButtonConfig(){if(!this.props.hideHeader||this.props.hideSearchBar)return;const e=this.state.modernizeMobileTabHeader?Z.SearchInputHeight.modernizedSmall:this.state.useIOSSearchStyles?Z.SearchInputHeight.iOS:this.state.isSmallDevice?Z.SearchInputHeight.small:Z.SearchInputHeight.default;return{renderItem:this._getSearchButton,height:e}}_getHeaderCloseButton(){return this.state.isInGroupCallMode&&!this.props.newGroup?{text:B.getString("Global.CancelLabel"),onPress:this._leaveGroupCallMode,title:B.getString("Global.CancelLabel"),closeButtonType:ne.CloseButtonType.Back}:{title:this.props.callId||!this.state.useMobileOrTabletUI&&!this.props.isAloneInNavStack?B.getString("Global.BackButtonTitle"):B.getString("QuickCallPanel.CloseButtonAccessibilityLabel"),onPress:this._onPressClose,setButtonRef:this._onGroupCallBackHeaderButtonRef,closeButtonType:(this.state.useMobileOrTabletUI||this.props.isAloneInNavStack)&&this.props.navigationDirection!==le.StackNavigationDirection.Push?ne.CloseButtonType.Close:ne.CloseButtonType.Back}}_groupCallModeHeaderButton(){const e=!this.state.selectedMris||0===this.state.selectedMris.length;return{text:this.props.callId?B.getString("QuickCallPanel.AddToCallText"):B.getString("QuickCallPanel.StartCallText"),onPress:this.props.callId?this._addSelectedUsersToCall:this._startGroupCall,disabled:e,showActivityIndicator:this.state.isNewGroupCallStarting,setButtonRef:this._onGroupCallModeHeaderButtonRef}}_getFooterButton(){return this.state.isInGroupCallMode?this._groupCallModeHeaderButton():this._getFooterButtonForDesktop()}_getFooterButtonForDesktop(){const e=this.props.callId?B.getString("QuickCallPanel.AddMultiplePeople"):B.getString("QuickCallPanel.CallMultiplePeople");return{icon:this.props.callId?he.SkypeIcon.ContactGroupAdd:he.SkypeIcon.ContactGroupCall,text:e,backgroundStyle:{borderRadius:32,paddingLeft:14,paddingRight:14},iconSize:he.IconSize.size24,iconHorizontalMargin:4,buttonStyle:f.SXButtonStyle.GradientFill,textStyleOverride:[Se.default.font.uiDisplayRegular],disabled:this.state.disableHighBandwidthOperations,onPress:this._enterGroupCallMode}}_getHeaderText(e){let t=B.getString("QuickCallPanel.PanelHeaderDefault");return this.props.callId?t=B.getString(this.props.newGroup?"QuickCallPanel.PanelHeaderAddToCall":"QuickCallPanel.PanelHeaderNewCall"):e.isInGroupCallMode&&(t=B.getString(this.props.newGroup?"QuickCallPanel.PanelHeaderNewCall":"QuickCallPanel.SelectParticipantsHeader")),t}_addUsersToCall(e,t){if(R.log(I.LogTraceArea.QuickCallPanel,"_addUsersToCall causeId: "+t),!this.props.callId)return;d.default.CallParticipantUtils.addUsersToCallOrRing(e,this.props.callId,this.props.conversationId,this.state.conversationMemberMris,this.props.addToCallTelemetryOrigin||I.NavigationAddToCallOrigin.Unknown);const i=B.getString("QuickCallPanel.AddToCallAnnouncement",{count:e.length});s.Accessibility.announceForAccessibility(i),this.state.useMobileOrTabletUI?this._onPressClose():this._goBack(t)}_searchResultsListActionHelper(e,t,i){if(this.state.isInGroupCallMode){if(!l.default.getS4LCMCFeatures().enableUIToSelectSkypeOrPSTNContactToAddToGroupCall)return void this._addOrRemoveUserSelection(t,i);const n=e=>{this._addOrRemoveUserSelection(e,i)},o=(e,t)=>{this.state.mriToPhoneMriMap.set(t,e),n(t)},s=ge.default.getDisplayableUserByMri(t);let r=g.isPhoneMri(t)?[]:E.mergeMriProfileAndExtraPhones(t,void 0,s?s.phoneNumbers:void 0);const c=a.includes(this.state.selectedMris,t);return void(a.isEmpty(r)||c?(c&&this._removeEntryFromMriToPhoneMap(t),this._addOrRemoveUserSelection(t,i)):p.default.showForSkypeMri(e,this._getRootViewId(),t,void 0,!0,I.ContactInviteOrigin.Unknown,I.NavigationCallOrigin.Unknown,n,o,void 0,r))}if(this.props.callId)return void this._addUserToExistingCall(t,i);if(!t)return void R.error(I.LogTraceArea.QuickCallPanel,"_searchResultsListActionHelper with unactionable listItemMri: "+j.mriOrId(t)+", causeId: "+i);if(!g.isMri(t)&&E.isLocalAddressBookContact(t))return void this._handleAddressBookContactClick(e,t);const n=()=>{x.default.navigateToConversation({convId:t,causeId:i,origin:I.NavigationConversationOrigin.Search})};a.trim(this.state.rawSearchQuery).length||this._isPresentedInDesktopLeftNav()&&t?n():this._startCallToMri(t,e,i,I.NavigationCallOrigin.CallsTabQuickCallPanel)}_startCallToMri(e,t,i,a){if(R.log(I.LogTraceArea.QuickCallPanel,"_startCallToMri causeId: "+i),this.props.callId)return void R.log(I.LogTraceArea.QuickCallPanel,"_startCallToMri, callId must not be defined, causeId: "+i);if(!e||!g.isMri(e)||!d.default.CallNavigationHelper.isOutgoingCallingAllowed(e))return void R.log(I.LogTraceArea.QuickCallPanel,"_startCallToMri, calling not allowed, causeId: "+i);const n=L.default.getContactByCorrespondingMri(e);p.default.startCallOrMaybePrompt(t,this._getRootViewId(),{skypeMri:e,phones:n?n.phones:void 0,inviteOrigin:I.ContactInviteOrigin.CallPanelSearch,callOrigin:a,userIntent:h.StartCallOrMaybePromptUserIntent.Generic},i)}_handleAddressBookContactClick(e,t){const i=L.default.getContactById(t);i&&i.phones&&p.default.showForAddressContact(e,this._getRootViewId(),i.getDisplayName(),I.ContactInviteOrigin.CallPanelSearch,I.NavigationCallOrigin.QuickCallPanelCall,i.phones,i.emails)}_addUserToExistingCall(e,t){if(R.log(I.LogTraceArea.QuickCallPanel,"_addUserToExistingCall causeId: "+t),!this.props.callId)return;if(!this.state.conversationMemberMris||0===this.state.conversationMemberMris.length)return;const i=g.sanitizeMri(e,g.Namespaces.SkypeId);d.default.CallParticipantUtils.addUsersToCallOrRing([i],this.props.callId,this.props.conversationId,this.state.conversationMemberMris,this.props.addToCallTelemetryOrigin||I.NavigationAddToCallOrigin.Unknown),this._onPressClose()}_removeEntryFromMriToPhoneMap(e){const t=g.isPhoneMri(e)?ge.default.getConversationOwnerNoSubscription(e):e;return t&&this.state.mriToPhoneMriMap.delete(t),t}_addOrRemoveUserSelection(e,t){R.log(I.LogTraceArea.QuickCallPanel,"_addOrRemoveUserSelection causeId: "+t);const i=a.without(this.state.selectedMris,e);i.length===(this.state.selectedMris?this.state.selectedMris.length:0)&&i.push(e),this.setState({selectedMris:i})}_shouldCollapseHeader(){return this.state.useMobileOrTabletUI&&this.props.searchOnly}_expandOrCollapseHeader(e,t=!0){this._headerExpanded!==e&&(this._searchHeader&&this._searchHeader.setExpandedValue(e?1:0,t),this._headerExpanded=e)}_showOrHideHeader(e,t,i=!0){this._searchActive=!t;const a=this._getRootViewId(),n=this._headerHeight(e),o=t?0:-1*n;let r=t?n+m.default.collapsableHeight(a):m.default.expandedHeight(a)+e.statusBarPadding;i?s.Animated.parallel([s.Animated.timing(this._headerAnimatedTopValue,{toValue:o,duration:200,easing:s.Animated.Easing.Out()}),s.Animated.timing(this._headerAnimatedHeightValue,{toValue:r,duration:200,easing:s.Animated.Easing.Out()})]).start():(this._headerAnimatedTopValue.setValue(o),this._headerAnimatedHeightValue.setValue(r))}_headerHeight(e){return(e.isPortrait?e.isSmallDevice?ne.HeaderHeightSmall:ne.HeaderHeight:e.isSmallDevice?ne.HeaderHeightLandscapeSmall:ne.HeaderHeightLandscape)+e.statusBarPadding}_setAnimatedValues(e,t){if(this._wrappedTransitionView){const i=s.Styles.createAnimatedViewStyle({transform:[{translateY:e.interpolate({inputRange:[t-1,t,t+1],outputRange:[90,0,0]})}]});this._wrappedTransitionView.setAnimatedStyle(i)}}_clearAnimatedValues(){this._wrappedTransitionView&&this._wrappedTransitionView.setAnimatedStyle(this._resetTransitionStyle)}_shouldShowDialPadBar(e){return a.some(e,(e=>e.groupType===I.SearchResultsListGroup.PstnDialpad))&&!this._isPresentedInDesktopLeftNav()&&!this.state.enableIOSCallsFABExperiment}_isUsedDuringCall(){return!!this.props.callId}_updateStatusBarStyle(e){this._getContext().isPresentedByMobileStackNavigator&&super._updateStatusBarStyle(e)}static _menuItemTitle(e){switch(e){case z.QuickCallPanelFilter.All:return B.getString("QuickCallPanel.AllFilter");case z.QuickCallPanelFilter.Skype:return B.getString("QuickCallPanel.SkypeFilter");case z.QuickCallPanelFilter.Phone:return B.getString("QuickCallPanel.PhoneFilter")}return""}static _menuItemCommand(e){switch(e){case z.QuickCallPanelFilter.All:return z.QuickCallPanelMenuItemCommand.all;case z.QuickCallPanelFilter.Skype:return z.QuickCallPanelMenuItemCommand.skype;case z.QuickCallPanelFilter.Phone:return z.QuickCallPanelMenuItemCommand.phone}return""}static _filterForCommand(e){switch(e){case z.QuickCallPanelMenuItemCommand.all:return z.QuickCallPanelFilter.All;case z.QuickCallPanelMenuItemCommand.skype:return z.QuickCallPanelFilter.Skype;case z.QuickCallPanelMenuItemCommand.phone:return z.QuickCallPanelFilter.Phone}}}t.default=Ie},90244:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RaiseHandImageType=void 0;const a=i(16778),n=i(88837),o=i(44770),s=i(15877);var r;!function(e){e[e.MediumSizeCenterAligned=0]="MediumSizeCenterAligned",e[e.SmallSizeTopLeftAligned=1]="SmallSizeTopLeftAligned"}(r=t.RaiseHandImageType||(t.RaiseHandImageType={}));const l=(0,s.lazyProperties)({raiseHandIcon20:()=>a.Styles.createImageStyle({height:20,width:20,position:"absolute",top:2,left:0}),raiseHandIcon32:()=>a.Styles.createImageStyle({height:30,width:32,alignSelf:"center",marginBottom:8})});class c extends n.ComponentBase{render(){const e=this._getStyle(),t=this._getSource();return a.createElement(a.Image,{style:e,resizeMode:"contain",source:t})}_getStyle(){switch(this.props.type){case r.MediumSizeCenterAligned:return l.raiseHandIcon32;case r.SmallSizeTopLeftAligned:return l.raiseHandIcon20}}_getSource(){switch(this.props.type){case r.MediumSizeCenterAligned:return o.Collection.RAISE_HAND_MEDIUM;case r.SmallSizeTopLeftAligned:return o.Collection.RAISE_HAND_SMALL}}}t.default=c},2557:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(16778),o=i(88837),s=i(89391),r=i(94224),l=i(68580),c=i(78968),d=i(80200),u=i(71727),h=i(71830),p=i(52262),g=i(46096),C=i(23497),m=i(5581),S=i(36237),y=i(15877),f=i(18078),_=i(98040),b=i(33004),T=i(14976),v=i(78262),w=i(80837),I=i(12770),P=(0,y.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,overflow:"visible"}),fullScreenView:()=>w.default.absoluteFill,eventsContainer:()=>n.Styles.createViewStyle({paddingBottom:20,overflow:"visible"}),mobileEventsContainerWithCallControls:()=>n.Styles.createViewStyle({paddingBottom:75}),streamContainer:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch",overflow:"visible"})});class M extends o.ComponentBase{constructor(){super(...arguments),this._subscriptions=[],this._onSelectSceneResponseFailedEvent=e=>{if(this._eventStream){const t=this._getAudienceBotMri(this.props.callId);a.isUndefined(t)||this._eventStream.participantEvent(t,e)}},this._onSceneChangedEvent=(e,t)=>{this._eventStream&&this._eventStream.participantEvent(t,d.ParticipantEventType.TogetherModeBackgroundChanged)},this._onEventStreamRef=e=>{this._eventStream=e||void 0},this._onPhotoEventStreamRef=e=>{this._photoEventStream=e||void 0}}_buildState(e,t){t&&(this._subscriptions.push(r.default.AudienceBotService.selectSceneResponseFailedEvent(e.callId).subscribe(this._onSelectSceneResponseFailedEvent)),this._subscriptions.push(r.default.AudienceBotService.sceneChangedEvent(e.callId).subscribe(this._onSceneChangedEvent)));const i=s.default.getS4LCMCFeatures(),n=i.enableRingingNotifications,o=[],l=[],d=m.default.getNonVisibleInCallBotMris(),h=m.default.getNonInteractiveInCallBotMris(),p=[];a.each(r.default.CallingStore.getRemoteCallMembers(e.callId),(t=>{const i=r.default.CallingStore.getRemoteCallMemberMri(e.callId,t);u.default.shouldRenderConnectedParticipantInEventStream(t,i,h)?o.push(i):n&&u.default.shouldRenderRingingParticipantInEventStream(t,i,d)&&l.push(i)})),i.enableRaiseHands&&r.default.CallingStore.getParticipantsWithRaisedHands(e.callId).map((e=>{const t=a.concat(o,[f.default.getSkypeMri()]);a.find(t,(t=>t===e.id))&&p.push(e.id)}));const g=c.default.hasPostedReactions(e.reactionsConversationMri);let C;if(!t&&this._reactionsInteropMessageAllowed()&&g&&!this.state.hasPostedReactions){const t=r.default.CallingStore.getRemoteMembersNotSupportingCallingReactions(e.callId);t&&(C=u.default.getFeatureUnsupportedParticipantsInfo(e.callId,t,e.conversationMri))}const S=t?Date.now():this.state.callEntryTime,y=a.last(c.default.getPictureReactions(e.reactionsConversationMri,S)),_=this._photoInfoForMessage(y,e.conversationMri),b=c.default.getEventsReaction(e.reactionsConversationMri,S);let T={callParticipantMris:o,ringingParticipantMris:l,reactionsMessageInfo:C,hasPostedReactions:g,lastPhotoInfo:_,eventReactions:b,enableRingingNotifications:n,enableNotifyUsersMuteKick:i.enableNotifyUsersMuteKick,handRaisedMris:p};return t&&(T.suppressParticipantEvents=!0,T.callEntryTime=S),T}componentWillUnmount(){super.componentWillUnmount(),this._subscriptions.forEach((e=>e.unsubscribe())),this._subscriptions=[]}_getAudienceBotMri(e){const t=m.default.getCallAudienceBotMri(),i=m.default.getCallAudienceBotMriFilter();return r.default.InCallBotService.findActualBotMri(e,t,i)}_reactionsInteropMessageAllowed(){return h.isThread(this.props.conversationMri)||h.isSkypeIdMri(this.props.conversationMri)}_photoInfoForMessage(e,t){return e?{message:e,user:p.default.getMemberShortNameForConversation(t,e.creator)}:void 0}_identifyParticipantChange(e,t){if(this.state.suppressParticipantEvents||h.isOneOnOneConversation(this.props.conversationMri))return;const i=a.difference(e,t),n=a.difference(t,e);n.length&&this._onJoin(n),i.length&&this._onLeave(i)}_identifyParticipantRaiseHandChange(e,t){const i=a.difference(t,e);i.length&&this._onRaised(i)}_identifyParticipantRingingChange(e,t){if(!this.state.enableRingingNotifications||this.state.suppressParticipantEvents)return;const i=a.difference(e,t);(a.difference(t,e).length||i.length)&&this._onParticipantsRinging(t),i.length&&this._onStopRinging(i)}_onJoin(e){a.each(e,((e,t)=>{this._eventStream&&this._eventStream.participantEvent(e,d.ParticipantEventType.Join)}))}_onRaised(e){a.each(e,((e,t)=>{this._eventStream&&this._eventStream.participantEvent(e,d.ParticipantEventType.HandRaised)}))}_onLeave(e){a.each(e,((e,t)=>{this._eventStream&&this._eventStream.participantEvent(e,d.ParticipantEventType.Leave)}))}_onMuted(e){this._eventStream&&this._eventStream.participantActionEvent(e.mri,e.actionMri,d.ParticipantEventType.Muted)}_onKickedOut(e){this._eventStream&&this._eventStream.participantActionEvent(e.mri,e.actionMri,d.ParticipantEventType.KickedOut)}_onStopRinging(e){a.each(e,((t,i)=>{if(this._eventStream){const i=r.default.CallingStore.findRemoteCallMember(this.props.callId,t);l.default.isParticipantConnected(i)||l.default.isParticipantInCanStreamMediaState(i)||this._eventStream.participantEvent(t,this._getStopRingingEventType(e))}}))}_getStopRingingEventType(e){return e.length&&a.intersection(r.default.InCallBotMriUtils.getCallFullscreenBotMris(),e).length?d.ParticipantEventType.BotUnavailable:d.ParticipantEventType.Unavailable}_onParticipantsRinging(e){this._eventStream&&this._eventStream.participantsRingingEvent(e)}componentDidMount(){super.componentDidMount(),h.isOneOnOneConversation(this.props.conversationMri)?I.default.setTimeout((()=>{this.isComponentMounted()&&this.setState({suppressParticipantEvents:!1})}),3e3):I.default.setTimeout((()=>{this.isComponentMounted()&&this.setState({suppressParticipantEvents:!1})}),1e4)}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),this._identifyParticipantRingingChange(t.ringingParticipantMris,this.state.ringingParticipantMris),this._identifyParticipantChange(t.callParticipantMris,this.state.callParticipantMris),this._identifyParticipantRaiseHandChange(t.handRaisedMris,this.state.handRaisedMris),this.state.reactionsMessageInfo&&!t.reactionsMessageInfo){const e=this.state.reactionsMessageInfo.count;if(0===e)return;S.log(g.LogTraceArea.CallReactions,"ReactionsPanel.componentDidUpdate: reactionsMessageInfo,  count: "+e+" firstUser: "+(T.mriOrId(this.state.reactionsMessageInfo.firstUser)||"none")+" secondUser: "+(T.mriOrId(this.state.reactionsMessageInfo.secondUser)||"none"));const t=u.default.getFeatureUnsupportedMessage(this.state.reactionsMessageInfo,u.UnsupportedFeature.CallReactions);t&&this._eventStream&&this._eventStream.textEvent(t)}if(this._photoEventStream&&this.state.lastPhotoInfo){this.state.lastPhotoInfo.message.cuid!==(t.lastPhotoInfo?t.lastPhotoInfo.message.cuid:void 0)&&this._photoEventStream.photoEvent(this.state.lastPhotoInfo.message,this.state.lastPhotoInfo.message.creator)}if(this.state.enableNotifyUsersMuteKick&&this.state.eventReactions){const e=a.last(this.state.eventReactions),i=a.last(t.eventReactions);(e?e.cuid:void 0)!==(i?i.cuid:void 0)&&this.state.eventReactions.forEach((e=>{const t=b.default.parseCallEventReaction(e);t&&(t.eventType===v.ReactionsTextType.CallEventMuted?this._onMuted(t):t.eventType===v.ReactionsTextType.CallEventKickedOut&&this._onKickedOut(t))}))}}render(){const e=[P.fullScreenView,P.eventsContainer,this.props.bottomStyle];return this.props.areMobileCallControlsVisible&&e.push(P.mobileEventsContainerWithCallControls),n.createElement(n.View,{style:P.container,ignorePointerEvents:!0},n.createElement(n.Animated.View,{style:e,ignorePointerEvents:!0,blockPointerEvents:!0},n.createElement(C.default,{style:P.streamContainer,ref:this._onEventStreamRef,useHighContrastTheme:this.props.useHighContrastTheme})),n.createElement(_.default,{style:P.fullScreenView,ref:this._onPhotoEventStreamRef,isDesktop:this.props.isDesktop,bottomMargin:this.props.desktopBottomMargin,desktopSideMargin:this.props.desktopSideMargin,sizePhotosToFit:this.props.sizePhotosToFit,photoTapDelay:this.props.photoTapDelay,onPhotoTap:this.props.onPhotoTap,onPhotoDismissed:this.props.onPhotoDismissed,reactionsConversationMri:this.props.reactionsConversationMri}))}}t.default=M},85376:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(33754),n=i(53602),o=i(81760),s=i(11828);class r extends n.default{_iconSize(){return s.IconSize.size20}_iconBackgroundColor(){return this.props.useHighContrastTheme?this._themeColors.primaryBackgroundColor:o.Color.gray300Overlay80}_icon(){return s.SkypeIcon.ContactAdd}_label(){}_tooltip(){return a.getString("CallBanner.AddPeopleToTheCallTooltip")}}t.default=r},53602:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RibbonExtraViewBase=void 0;const a=i(16778),n=i(97775),o=i(11009),s=i(36400),r=i(10117),l=i(15877),c=i(81760),d=i(11828),u=i(19675),h=i(24576),p=(0,l.lazyProperties)({container:()=>a.Styles.createViewStyle({justifyContent:"center",alignItems:"center"}),innerContainer:()=>a.Styles.createViewStyle({justifyContent:"center",alignItems:"center",overflow:"hidden",flexDirection:"row"}),label:()=>a.Styles.createTextStyle({color:c.Color.whiteOverlay80,backgroundColor:c.Color.transparent,textAlign:"center",textAlignVertical:"center",marginHorizontal:5,paddingBottom:1}),chevronIcon:()=>a.Styles.createViewStyle({marginLeft:5}),iconStyle:()=>a.Styles.createViewStyle({overflow:"visible"}),redDot:()=>a.Styles.createViewStyle({width:10,height:10,borderRadius:5,backgroundColor:c.Color.red,position:"absolute",left:12,top:15})}),g=c.Color.blackOverlay50;class C extends h.default{constructor(){super(...arguments),this._onHiddenChanged=e=>{this.isComponentMounted()&&this.state.hidden!==e&&this.setState({hidden:e})},this._onPress=e=>{this._handleOnPress(e)},this._onButtonRef=e=>{this._buttonRef=e||void 0}}_iconSize(){return d.IconSize.size16}_iconBackgroundColor(){return this.props.useHighContrastTheme?this._themeColors.primaryBackgroundColor:g}_iconBorderColor(){return this.props.useHighContrastTheme?this._themeColors.dividerColor:void 0}_tooltip(){}_accessibilityLabel(){return this.props.accessibilityLabel}_labelStyle(){}_shouldRenderRedDot(){return!1}_iconColor(){}_containerStyle(){}_getMainContainerStyles(){}_buildState(e,t){const i={};return t&&(i.hidden=e.layoutController.isHidden()),i}_handleOnPress(e){this.props.onPress&&this.props.onPress()}componentDidMount(){super.componentDidMount(),this.props.layoutController.onHiddenChanged&&this.props.layoutController.onHiddenChanged(this._onHiddenChanged)}render(){if(this.state.hidden)return null;const e=this._label(),t=this._icon(),i=[p.label,this.props.useHighContrastTheme?this._themeStyles.primaryTextColorStyle:void 0,this._labelStyle()],l=e?a.createElement(u.BodyText,{style:i},e):void 0;let h,g,C,m=this._iconColor();m||(m=this.props.useHighContrastTheme?this._themeColors.primaryIconColor:c.Color.whiteOverlay80),t&&(h=a.createElement(r.default,{icon:t,size:this._iconSize(),color:m,style:p.iconStyle})),this._shouldRenderRedDot()&&(g=a.createElement(a.View,{style:p.redDot})),this.props.showChevron&&(C=a.createElement(r.default,{icon:d.SkypeIcon.DownChevron,size:6,color:m,style:p.chevronIcon}));const S=this.props.dimensions.width===this.props.dimensions.height?this.props.dimensions.width/2:0,y=[p.innerContainer,a.Styles.createViewStyle({backgroundColor:this._iconBackgroundColor(),height:this.props.dimensions.height,width:this.props.dimensions.width,borderRadius:S},!1)],f=this._iconBorderColor();f&&y.push(a.Styles.createViewStyle({borderColor:f,borderWidth:1},!1)),y.push(this._containerStyle());const _=this._accessibilityLabel(),b={style:y,title:this._tooltip(),accessibilityLabel:_,onPress:this._onPress};let T;const v=this.props.coachMarkType;T=v&&_?a.createElement(n.default.HoverableButton,Object.assign({},b,{coachMarkType:v,anchorAccessibilityLabel:_,onAnchorPress:this._onPress,positions:[o.PopupAnchorPositon.Bottom],anchorRef:this._onButtonRef}),h,l,g,C):a.createElement(s.HoverableButton,Object.assign({},b,{ref:this._onButtonRef}),h,l,g,C);const w=[p.container,this.props.layoutController.getStyles()];return this.props.ribbonOpacityStyle&&w.push(this.props.ribbonOpacityStyle),w.push(this._getMainContainerStyles()),a.createElement(a.Animated.View,{style:w},T)}}t.RibbonExtraViewBase=C,t.default=C},2952:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(33754),n=i(53602),o=i(81760),s=i(11828);class r extends n.default{_buildState(e,t){const i=super._buildState(e,t);return t&&(i.remainder=void 0,i.ringing=void 0),i}showRemainder(e,t){!this.isComponentMounted()||this.state.remainder===e&&this.state.ringing===t||this.setState({remainder:e,ringing:t})}_iconBackgroundColor(){return this.props.useHighContrastTheme?this._themeColors.primaryBackgroundColor:o.Color.gray400Overlay80}_icon(){return this.state.ringing?s.SkypeIcon.CallAnimSmall4:s.SkypeIcon.Plus}_label(){return this.state.remainder&&this.state.remainder>0?this.state.remainder.toString():void 0}_tooltip(){return this._intTooltip()}_accessibilityLabel(){return this.props.accessibilityLabel||this._intTooltip()}_intTooltip(){return this.state.remainder&&this.state.remainder>0?a.getString("CallBanner.MorePeopleInTheCallTooltip",{count:this.state.remainder}):void 0}}t.default=r},77557:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(31844),o=i(20187),s=i(94224),r=i(36850),l=i(71830),c=i(73145),d=i(33790),u=i(33754),h=i(53602),p=i(74984),g=i(81760),C=i(11828);class m extends h.default{_buildState(e,t){const i=r.default.getStageMode(e.callId),a=s.default.CallScreenShareStore.hasIncomingScreensharing(e.callId),n={isPSTNCall:s.default.CallingStore.isPSTNCall(e.callId),isEncryptedCall:l.isEncryptedThread(e.conversationMri),conversationMri:e.conversationMri,callId:e.callId};this._changeCallLayoutCommand=new o.ChangeCallLayoutCommand(n,e.isIncomingOrOutGoingRing,i);const c=Object.assign(Object.assign({},super._buildState(e,t)),{isAudioOnlyCall:n.isPSTNCall&&n.isEncryptedCall,stageMode:i,hasIncomingScreenshare:a,callInfo:n});return t&&(c.hidden=e.layoutController.isHidden()),c}_iconSize(){return C.IconSize.size20}_iconBackgroundColor(){return this.props.useHighContrastTheme?this._themeColors.primaryBackgroundColor:g.Color.transparent}_icon(){return C.SkypeIcon.ViewSwitcher}_label(){}_tooltip(){return this._intLabel()}_accessibilityLabel(){return this._intLabel()}_handleOnPress(e){let t;const i=e;if(i.pageX&&i.pageY){d.default.setAnchorPosition({x:i.pageX,y:i.pageY});const e=this._getRootViewId();t=c.default.getMenuTargetCallback(e)}else t=()=>this._buttonRef;this.props.showFullScreenOptionInRibbonSettings?n.default.isFullScreenMode(this._getRootViewId()).then((i=>{this._showRibbonSettingsMenu(!0,i,t,e)})):this._showRibbonSettingsMenu(!1,!1,t,e)}_showRibbonSettingsMenu(e,t,i,n){const o=a.pick(n,"pageX","pageY");a.defer((()=>{p.default.show(this.props.availableLayoutModes,this.props.layoutMode,this.props.onCallPanelHeaderLayoutChange,i,this._getRootViewId(),o,this.state.isAudioOnlyCall,e,t,this.state.stageMode,this.state.hasIncomingScreenshare,this._changeCallLayoutCommand)}))}_intLabel(){return u.getString("CallPanel.RibbonLayoutAccessibilityLabel")}}t.default=m},97982:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.maybePresentRinglessCallInterstitial=void 0;const a=i(31844),n=i(16778),o=i(44770),s=i(67930),r=i(94224),l=i(9520),c=i(2278),d=i(11930),u=i(47204),h=i(98278),p=i(4336),g=i(37490),C=i(46096),m=i(13944),S=i(36237),y=i(15877),f=i(33754),_=i(29130),b=i(51070),T=i(81115),v=i(10265),w=i(49603),I=i(12187),P=i(22222),M=i(81760),k=i(11828),A=i(34528),R=i(19675),V="RinglessCallInterstitial",L=(0,y.lazyProperties)({dialog:()=>n.Styles.createViewStyle({flex:1,justifyContent:"center"}),dialogHeaderContainer:()=>n.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,flexDirection:"row",justifyContent:"space-between"}),closeButton:()=>n.Styles.createViewStyle({paddingLeft:15,paddingRight:15}),footer:()=>n.Styles.createViewStyle({height:60,alignSelf:"center"}),footerLandscape:()=>n.Styles.createViewStyle({height:50,alignSelf:"center"}),footerButton:()=>n.Styles.createViewStyle({alignSelf:"center",justifyContent:"center",alignItems:"center",marginTop:10}),interstitialImage:()=>n.Styles.createImageStyle({height:120,width:360,alignSelf:"center",marginTop:5}),message:()=>n.Styles.createTextStyle({alignSelf:"center",textAlign:"center",marginVertical:10,marginHorizontal:30,backgroundColor:M.Color.transparent})});t.maybePresentRinglessCallInterstitial=function(e,t){S.log(C.LogTraceArea.CallingUI,"RinglessCallInterstitial maybePresentRinglessCallInterstitial, causeId: "+e.causeId);const i=n.createElement(E,{dialogId:V,conversationMri:e.conversationMri,withVideo:e.withVideo,origin:e.origin,isLargeGroup:e.isLargeGroup,causeId:e.causeId});u.default.showModal(i,V,t)};class E extends s.default{constructor(){super(...arguments),this._closeButtonPressed=()=>{S.log(C.LogTraceArea.CallNavigation,"RinglessCallInterstitial._closeButtonPressed causeId: "+this.props.causeId),c.default.trackRinglessCallInterstitial(l.RinglessCallInterstitialActions.Cancel,this.props.isLargeGroup),u.default.dismissModal(this.props.dialogId,this._getRootViewId())},this._onButtonPressed=()=>{S.log(C.LogTraceArea.CallNavigation,"RinglessCallInterstitial._onButtonPressed causeId: "+this.props.causeId),c.default.trackRinglessCallInterstitial(l.RinglessCallInterstitialActions.ContinueWithCall,this.props.isLargeGroup),r.default.CallNavigationHelper.startCall({conversationMri:this.props.conversationMri,withVideo:this.props.withVideo,origin:this.props.origin},this.props.causeId)}}_buildState(e,t){const i=this._getRootViewId();return{isLandscape:!this._getContext().isPresentedInDesktopSubview&&_.default.getDeviceOrientation(i)===a.DeviceOrientation.Landscape,isMobileScreenSize:_.default.isMobileScreenSize(i),statusBarHeight:b.default.leavePaddingForStatusBar()?b.default.statusBarHeight():0}}componentDidMount(){super.componentDidMount(),g.dismissAll();const e=I.default.mergeStyles([I.default.createBarStyle(w.BarStyleTheme.Light),I.default.createHiddenStyle(!1)]);this._updateStatusBarStyle(e)}componentWillUnmount(){super.componentWillUnmount(),S.log(C.LogTraceArea.CallingUI,"RinglessCallInterstitial componentWillUnmount")}render(){const e=this._renderCloseButton(),t=this._renderActionButton(),i=this.state.isMobileScreenSize?{maxWidth:void 0,maxHeight:void 0}:{maxWidth:p.CompactWidth,maxHeight:462},a=this._renderImage(),o=this._getTitleText(),s=this._getContentText(),r=d.default.combinedAccessibilityLabel(o,s);return n.createElement(v.default,Object.assign({dialogId:this.props.dialogId,containerStyle:this._themeStyles.primaryBackgroundColorStyle,closeOnClickOutside:!0},i,{maxWidth:this.state.isMobileScreenSize?void 0:p.DefaultWidth,fullScreen:this.state.isMobileScreenSize,useFullSizeContainer:!0,accessibilityLabel:r}),n.createElement(n.View,{style:L.dialog},e,a,n.createElement(R.PanelHeader,{style:L.message},o),n.createElement(R.BodyText,{style:L.message},s),t))}_getHeaderTopMargin(){return this.state.isMobileScreenSize&&!this.state.isLandscape&&!this._getContext().isPresentedInDesktopSubview&&this.state.statusBarHeight>0?this.state.statusBarHeight:!this.state.isMobileScreenSize&&this.state.isLandscape?15:5}_renderCloseButton(){const e=[L.dialogHeaderContainer],t=this._getHeaderTopMargin();return t&&e.push(T.default.marginTopStyle(t)),n.createElement(n.View,{style:e},n.createElement(m.default,{style:L.closeButton,icon:A.closeIcon(),size:k.IconSize.size24,title:f.getString("Global.CloseButtonTitle"),onPress:this._closeButtonPressed,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor}))}_renderActionButton(){return n.createElement(n.View,{style:this.state.isLandscape?L.footerLandscape:L.footer},n.createElement(P.default,{buttonSize:h.SXButtonSize.Medium,buttonStyle:h.SXButtonStyle.BlueFill,style:L.footerButton,allowTextWrap:!0,title:f.getString("CallPanel.GroupCallRingLessContinueToCallButtonTitle"),onPress:this._onButtonPressed,autoFocus:!1}))}_renderImage(){const e=this.props.isLargeGroup?o.Collection.RINGLESS_CALL_LARGE_GROUP:o.Collection.RINGLESS_CALL_SMALL_GROUP;return n.createElement(n.Image,{source:e,style:L.interstitialImage})}_getTitleText(){return this.props.isLargeGroup?f.getString("CallPanel.GroupCallRinglessLargeGroup"):f.getString("CallPanel.GroupCallRinglessSmallGroup")}_getHeaderText(e){return this._getTitleText()}_getContentText(){return this.props.isLargeGroup?f.getString("CallPanel.GroupCallRinglessLargeGroupExplanation"):f.getString("CallPanel.GroupCallRinglessSmallGroupExplanation")}}t.default=E},51804:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(88837),o=i(11010),s=i(81760),r=i(15877),l=i(33754),c=(0,r.lazyProperties)({controlItem:()=>a.Styles.createViewStyle({alignItems:"center",justifyContent:"center",cursor:"pointer",backgroundColor:s.Color.black,marginBottom:7}),controlItemText:()=>a.Styles.createTextStyle({textAlign:"center",color:s.Color.white}),controlItemTextActive:()=>a.Styles.createTextStyle({fontSize:o.default.controlFontSize.screenShareZoomControlActiveItem}),controlItemTextNonActive:()=>a.Styles.createTextStyle({fontSize:o.default.controlFontSize.screenShareZoomControlNonActiveItem})});class d extends n.ComponentBase{constructor(){super(...arguments),this._onReactionButtonRef=e=>{this._reactionButton=e||void 0}}requestFocus(){this._reactionButton&&this._reactionButton.requestFocus()}render(){const e=[c.controlItem,...this.props.styles],t=[c.controlItemText,this.props.isActive?c.controlItemTextActive:c.controlItemTextNonActive];return a.createElement(a.Button,{style:e,onPress:this.props.onClick,ref:this._onReactionButtonRef,accessibilityLabel:l.getString("CallControls.ScreenShareZoomControlsZoomButtonAnnouncement",{zoomLevel:this.props.zoomLevelText})},a.createElement(a.Text,{style:t},this.props.textToShow))}}t.default=d},80306:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(88837),o=i(15877),s=i(81760),r=i(13598),l=i(51804),c=i(97775),d=i(11009),u=i(33754),h=i(13944),p=i(11828),g=i(6250),C=i(46096),m=i(40363),S="item_",y=(0,o.lazyProperties)({controlsContainer:()=>a.Styles.createViewStyle({width:36,minHeight:36,borderRadius:18,borderWidth:2,position:"absolute",bottom:15,right:15,alignItems:"center",justifyContent:"center",borderColor:s.Color.black,backgroundColor:s.Color.white}),controlsContainerOpened:()=>a.Styles.createViewStyle({paddingTop:3}),controlsMenuWrapper:()=>a.Styles.createViewStyle({alignItems:"center",height:30,overflow:"hidden"}),controlsMenuInnerWrapper:()=>a.Styles.createViewStyle({alignItems:"center"}),controlsClosedButtonWrapper:()=>a.Styles.createViewStyle({width:30,height:30,position:"absolute",backgroundColor:s.Color.white}),controlsClosedButton:()=>a.Styles.createViewStyle({width:30,height:30,alignItems:"center",justifyContent:"center"}),controlsClosedButtonText:()=>a.Styles.createTextStyle({fontSize:15}),closeControlsIcon:()=>a.Styles.createViewStyle({width:22,height:22,borderRadius:11,backgroundColor:s.Color.black,marginBottom:3}),activeItem:()=>a.Styles.createViewStyle({width:r.zoomDrawerValues.activeItemSize,height:r.zoomDrawerValues.activeItemSize,borderRadius:14}),notActiveItem:()=>a.Styles.createViewStyle({width:r.zoomDrawerValues.nonActiveItemSize,height:r.zoomDrawerValues.nonActiveItemSize,borderRadius:11}),lastItemMargin:()=>a.Styles.createViewStyle({marginBottom:r.zoomDrawerValues.lastItemMargin})});class f extends n.ComponentBase{constructor(){super(...arguments),this._mountedRefsMap=new g.default,this._animatedHeightValue=new a.Animated.Value(r.zoomDrawerValues.minHeight),this._animatedOpacityValue=new a.Animated.Value(r.zoomDrawerValues.minOpacity),this._animatedContainerStyle=a.Styles.createAnimatedViewStyle({height:this._animatedHeightValue}),this._animatedInnerContainerStyle=a.Styles.createAnimatedViewStyle({opacity:this._animatedOpacityValue}),this._onMenuCloseButtonRef=e=>{this._menuClosedButtonRef=e||void 0},this._handleOpenMenu=()=>{this.setState({shouldDrawerBeOpened:!0,isDrawerOpened:!0,menuOpenedWithKeyboard:this.props.isNavigatingWithKeyboard})},this._handleCloseMenu=()=>{this.setState({shouldDrawerBeOpened:!1,menuOpenedWithKeyboard:!1})}}_buildState(e,t){const i={};return t&&(i.shouldDrawerBeOpened=!1,i.isDrawerOpened=!1,i.menuOpenedWithKeyboard=!1),i}componentWillUnmount(){super.componentWillUnmount(),this._drawerAnimation&&(this._drawerAnimation.stop(),this._drawerAnimation=void 0)}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),this.state.shouldDrawerBeOpened!==t.shouldDrawerBeOpened&&this._positionControlsDrawer(),this.state.isDrawerOpened!==t.isDrawerOpened){const e=this.state.isDrawerOpened?this._mountedRefsMap.ref("item_0"):this._menuClosedButtonRef;e&&e.requestFocus()}}render(){const{isDrawerOpened:e,menuOpenedWithKeyboard:t}=this.state,{currentZoomLevel:i,isNavigatingWithKeyboard:n}=this.props,o=r.zoomUiSizesText.length-1,s=[y.controlsMenuWrapper,this._animatedContainerStyle],l=[y.controlsMenuInnerWrapper,this._animatedInnerContainerStyle],h=m.default.getPlatformType()===C.PlatformType.OSX?u.getString("CallControls.ScreenShareZoomCoachMarkMacLabel"):u.getString("CallControls.ScreenShareZoomCoachMarkDefaultLabel");return a.createElement(c.default.View,{coachMarkType:d.CoachMarkType.ScreenShareZoomControl,anchorAccessibilityLabel:h,positions:[d.PopupAnchorPositon.Left,d.PopupAnchorPositon.Bottom],onMouseEnter:this._handleOpenMenu,onMouseLeave:this._handleCloseMenu,widthOverride:r.zoomDrawerValues.coachMarkWidth,style:[y.controlsContainer,e?y.controlsContainerOpened:void 0]},e?a.createElement(a.Animated.View,{style:s},a.createElement(a.Animated.View,{style:l},this._renderZoomLevelButtons(o,i),t&&this._renderDrawerCloseButton())):a.createElement(a.Animated.View,{style:y.controlsClosedButtonWrapper},a.createElement(a.Button,{accessibilityLabel:u.getString("CallControls.ScreenShareZoomControlsOpenButtonAnnouncement"),ref:this._onMenuCloseButtonRef,onPress:n?this._handleOpenMenu:void 0,style:y.controlsClosedButton},a.createElement(a.Text,{style:y.controlsClosedButtonText},r.zoomUiSizesText[o-i]+"x"))))}_renderDrawerCloseButton(){return a.createElement(h.default,{icon:p.SkypeIcon.DownChevron,size:p.IconSize.size16,color:s.Color.white,accessibilityLabel:u.getString("CallControls.ScreenShareZoomControlsCloseButtonAnnouncement"),style:y.closeControlsIcon,onPress:this._handleCloseMenu})}_renderZoomLevelButtons(e,t){return r.zoomUiSizesText.map(((i,n)=>{const o=e-n,s=n===e,r=!this.state.menuOpenedWithKeyboard&&s,c=o===t,d=[c?y.activeItem:y.notActiveItem,r?y.lastItemMargin:void 0];return a.createElement(l.default,{zoomLevelText:i,key:i,textToShow:s?i+"x":i,ref:this._mountedRefsMap.onComponentRef(S+n),styles:d,isActive:c,onClick:()=>this._setZoomLevel(o)})}))}_positionControlsDrawer(){const{shouldDrawerBeOpened:e}=this.state,t=e?this._getDrawerHeight(this.state.menuOpenedWithKeyboard):r.zoomDrawerValues.minHeight,i=e?r.zoomDrawerValues.maxOpacity:r.zoomDrawerValues.minOpacity;if(!this._animatedHeightValue||!this._animatedOpacityValue)return;const n=a.Animated.timing(this._animatedHeightValue,{toValue:t,easing:a.Animated.Easing.Linear(),duration:e?r.zoomDrawerValues.openDuration:r.zoomDrawerValues.closeDuration}),o=a.Animated.timing(this._animatedOpacityValue,{toValue:i,easing:a.Animated.Easing.Linear(),duration:e?r.zoomDrawerValues.openDuration:r.zoomDrawerValues.closeDuration});let s,l;e?(s=n,l=o):(s=o,l=n),this._drawerAnimation=s,this._drawerAnimation.start((()=>{this._drawerAnimation=l,this._drawerAnimation.start((()=>{this._onPositionDrawerAnimationCompleted()}))}))}_onPositionDrawerAnimationCompleted(){const{shouldDrawerBeOpened:e}=this.state;e||this.setState({isDrawerOpened:!1})}_getDrawerHeight(e){const t=r.zoomUiSizesText.length+(e?1:0);return(r.zoomDrawerValues.nonActiveItemSize+r.zoomDrawerValues.itemMargin)*(t-1)+(r.zoomDrawerValues.activeItemSize+r.zoomDrawerValues.lastItemMargin)}_setZoomLevel(e){this.props.currentZoomLevel!==e&&this.props.setZoomLevel(e)}}t.default=f},35428:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(16778),o=i(48540),s=i(87720),r=i(89391),l=i(94224),c=i(47447),d=i(71727),u=i(98278),h=i(87134),p=i(46096),g=i(13944),C=i(36237),m=i(48638),S=i(72490),y=i(15877),f=i(33754),_=i(78735),b=i(29130),T=i(72997),v=i(28477),w=i(96187),I=i(11275),P=i(10265),M=i(22222),k=i(81760),A=i(11010),R=i(11828),V=i(34528),L=i(78262),E=i(80837),B=i(19675),O=i(24576),D=i(12770),x=k.Color.gray400,N=(0,y.lazyProperties)({panel:()=>n.Styles.createViewStyle({flex:1,flexDirection:"column",alignSelf:"stretch",backgroundColor:x}),modalContainerForAll:()=>n.Styles.createViewStyle({flex:1,flexDirection:"column",alignItems:"center",justifyContent:"flex-start",padding:20}),sourcesLists:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",marginHorizontal:40,justifyContent:"flex-start",alignSelf:"center"}),screensSourcesList:()=>n.Styles.createViewStyle({flex:1,flexDirection:"column",justifyContent:"center",flexWrap:"wrap"}),windowsSourcesList:()=>n.Styles.createViewStyle({flex:1,flexWrap:"wrap",flexDirection:"column",justifyContent:"center"}),title:()=>n.Styles.createViewStyle({marginBottom:30}),titleText:()=>n.Styles.createTextStyle({color:k.Color.white,fontSize:A.default.controlFontSize.cardTitle}),divider:()=>n.Styles.createViewStyle({flex:1,height:void 0,minWidth:2}),sourceListScreen:()=>n.Styles.createViewStyle({justifyContent:"flex-start"}),sourceListWindow:()=>n.Styles.createViewStyle({flexWrap:"wrap",flexDirection:"row",justifyContent:"flex-start"}),buttons:()=>n.Styles.createViewStyle({flexDirection:"row"}),button:()=>n.Styles.createViewStyle({marginHorizontal:10,marginTop:15,width:180}),modalAudioLabelContainer:()=>n.Styles.createViewStyle({paddingHorizontal:4,flexDirection:"row",alignItems:"center",justifyContent:"center",alignSelf:"stretch",marginTop:15}),includeAudioLabel:()=>n.Styles.createTextStyle({color:k.Color.white}),audioMargin:()=>n.Styles.createViewStyle({marginRight:10}),sectionHeader:()=>n.Styles.createTextStyle({color:k.Color.white,marginLeft:5,marginBottom:10}),closeButton:()=>n.Styles.createViewStyle({alignSelf:"flex-start",justifyContent:"center",height:50,paddingLeft:15,paddingRight:15})});class U extends O.default{constructor(){super(...arguments),this._onAudioToggleChange=(e,t)=>{e.stopPropagation(),C.log(p.LogTraceArea.CallingUI,"ScreenSharingPanel._onAudioToggleChange"),this.setState({includeAudio:t},(()=>{D.default.setTimeout((()=>{this.isComponentMounted()&&this._audioToggleRef&&this._audioToggleRef.focusToggle()}),100)}))},this._onEscape=()=>(C.log(p.LogTraceArea.CallingUI,"ScreenSharingPanel._onEscape"),this._onClose(v.ScreenSharingPanelCancelOrigin.Esc),!0),this._onAudioToggleRef=e=>{this._audioToggleRef=e||void 0},this._onClose=e=>{var t;this.props.onClose&&(C.track(new v.ScreenSharingPanelCancelEvent(e,this.state.screensSourcesList.length,(null===(t=this.state.windowsSourcesList)||void 0===t?void 0:t.length)||0,this.props.isScreenSharingActive)),this.props.onClose())},this._onSourceSelected=(e,t)=>{C.log(p.LogTraceArea.CallingUI,"ScreenSharingPanel: _onSourceSelected "+o.SharingSourceType[this.state.selectedSourcesType]),t&&this.state.isNavigatingWithKeyboard?this._shareScreen(v.ScreenSharingStartOrigin.EnterWithKeyboardNavigation):this.setState({selectedSource:e})},this._shareScreen=e=>{var t;this.state.selectedSource&&(C.track(new v.ScreenSharingPanelStartedSharingEvent(this.state.selectedSource.getType(),e,this.state.screensSourcesList.length,(null===(t=this.state.windowsSourcesList)||void 0===t?void 0:t.length)||0,this.props.isScreenSharingActive)),this.props.onSelectSource(this.state.selectedSource,this.state.includeAudio,this.state.selectedSource.getType()))}}_buildState(e,t){t&&(this._rootViewId=this._getRootViewId());let i=c.CallingCapabilities.applicationSharingSupported(),n=b.default.getWidth(this._rootViewId);const s=T.default.responsiveWidthForSize(n),u=l.default.DeviceStore.getAvailableScreens(),h=i?l.default.DeviceStore.getAvailableWindows():void 0;let g,S;t?(g=e.currentScreenSharingSource||a.first(u),S=e.currentScreenSharingSourceType||o.SharingSourceType.Monitor,l.default.DeviceStore.fetchAvailableWindows()):(g=this.state.selectedSource,S=this.state.selectedSourcesType),C.log(p.LogTraceArea.CallingUI,`created new state screensSourcesList ${u.length} windowSharingEnabled ${i}`),h&&C.log(p.LogTraceArea.CallingUI,`windowsSourcesList ${h.length}`);const y=r.default.getS4LCMCFeatures(),f=d.default.useLightTheme()&&y.enableNewCallScreen&&_.default.getNewCallScreenDesignEnabled(),v=this._useAccessibleTheme(),w=f||v;return{includeAudio:t?!!e.initialShareSounds:this.state.includeAudio,screensSourcesList:u,windowsSourcesList:h||[],hasWindowsSection:!!(null==h?void 0:h.length),appWidth:n,selectedSourcesType:S,selectedSource:g,screenSize:s,isNavigatingWithKeyboard:m.default.isNavigatingWithKeyboard(),useHighContrastTheme:v,useDefaultTheme:w}}componentDidMount(){super.componentDidMount(),S.default.addEscapeHandler(this._onEscape),this._windowsInterval=D.default.setInterval((()=>l.default.DeviceStore.fetchAvailableWindows()),1e3)}componentWillUnmount(){super.componentWillUnmount(),S.default.removeEscapeHandler(this._onEscape),D.default.clearInterval(this._windowsInterval),l.default.DeviceStore.clearAvailableWindows()}render(){const e=w.default.getWindowSourceItemDimensions(),t=this.state.appWidth<=650?e.width:this.state.screenSize<=L.ResponsiveWidth.Tiny?2*e.width:void 0,i=[N.windowsSourcesList,n.Styles.createViewStyle({maxWidth:t},!1)],a=[N.sectionHeader];this.state.useDefaultTheme&&a.push(this._themeStyles.primaryTextColorStyle);const o=this.state.hasWindowsSection&&[n.createElement(h.default,{key:"divider",style:N.divider,color:this.state.useDefaultTheme?this._themeColors.dividerColor:k.Color.gray200Overlay20,marginRight:25,marginLeft:18}),n.createElement(n.View,{style:i,key:"windowsList"},n.createElement(B.RowTitle,{style:a},f.getString("ScreenSharingModal.WindowsSection")),n.createElement(I.ScreenSharingSourceList,{style:N.sourceListWindow,sourcesList:this.state.windowsSourcesList,itemWidth:e.width,itemHeight:e.height,currentScreenSharingSource:this.props.currentScreenSharingSource,isNavigatingWithKeyboard:this.state.isNavigatingWithKeyboard,shareScreen:this._shareScreen,selectedSource:this.state.selectedSource,onSourceSelected:this._onSourceSelected,accessibilityLabel:f.getString("ScreenSharingModal.WindowsSection"),useHighContrastTheme:this.state.useHighContrastTheme,useDefaultTheme:this.state.useDefaultTheme}))],s=[N.titleText];this.state.useDefaultTheme&&s.push(this._themeStyles.primaryTextColorStyle);const r=w.default.getScreenSourceItemDimensions(this.state.screenSize,!this.state.hasWindowsSection,this.state.screensSourcesList.length),l=[N.screensSourcesList,n.Styles.createViewStyle({minWidth:r.width},!1)],d=c.CallingCapabilities.screenSharingWithSoundSupported(),u=n.createElement(n.View,{style:N.modalContainerForAll},n.createElement(n.View,{style:N.title},n.createElement(B.RowTitle,{style:s},f.getString("ScreenSharingModal.Title"))),n.createElement(n.View,{style:N.sourcesLists},n.createElement(n.View,{style:l},n.createElement(B.RowTitle,{style:a},f.getString("ScreenSharingModal.ScreensSection")),n.createElement(I.ScreenSharingSourceList,{style:this.state.hasWindowsSection?N.sourceListScreen:N.sourceListWindow,sourcesList:this.state.screensSourcesList,itemWidth:r.width,itemHeight:r.height,currentScreenSharingSource:this.props.currentScreenSharingSource,isNavigatingWithKeyboard:this.state.isNavigatingWithKeyboard,shareScreen:this._shareScreen,selectedSource:this.state.selectedSource,onSourceSelected:this._onSourceSelected,accessibilityLabel:f.getString("ScreenSharingModal.ScreensSection"),useHighContrastTheme:this.state.useHighContrastTheme,useDefaultTheme:this.state.useDefaultTheme})),o),c.CallingCapabilities.screenSharingWithSoundSupported()&&this._getAudioToggle(),n.createElement(n.View,{style:this.state.screenSize>L.ResponsiveWidth.MinDesktop?N.buttons:void 0},this._getCancelButton(),this._getStartSharingButton())),p=[N.panel];return this.state.useDefaultTheme&&p.push(this._themeStyles.primaryBackgroundColorStyle),n.createElement(P.default,{dialogId:"screenShare",onClickOutside:()=>this._onClose(v.ScreenSharingPanelCancelOrigin.ClickOutside),maxWidth:w.default.getModalWidth(this.state.screenSize,this.state.screensSourcesList.length,this.state.windowsSourcesList.length),maxHeight:w.default.getModalHeigh(this.state.screensSourcesList.length,this.state.windowsSourcesList.length,d),fullScreen:this.state.screenSize<=L.ResponsiveWidth.Tiny,useFullSizeContainer:!0},n.createElement(n.View,{style:p},this.state.screenSize<=L.ResponsiveWidth.Tiny&&this._getBackButton(),u))}_getBackButton(){return n.createElement(g.default,{style:N.closeButton,icon:V.closeIcon(),size:R.IconSize.size24,title:f.getString("Global.CloseButtonTitle"),onPress:()=>this._onClose(v.ScreenSharingPanelCancelOrigin.BackButton),color:k.Color.white,hoverColor:k.Color.whiteOverlay70})}_getAudioToggle(){const e=n.createElement(s.default,{ref:this._onAudioToggleRef,isOn:this.state.includeAudio,accessibilityLabel:f.getString("ScreenSharingModal.IncludeAudioToggleAccessibilityLabel"),onChange:this._onAudioToggleChange,style:E.default.alignItemsCenter}),t=[N.includeAudioLabel];this.state.useDefaultTheme&&t.push(this._themeStyles.primaryTextColorStyle);const i=n.createElement(n.View,{style:N.audioMargin},n.createElement(B.RowTitle,{style:t},f.getString("ScreenSharingModal.IncludeAudioText")));return n.createElement(n.View,{style:N.modalAudioLabelContainer},i,e)}_getCancelButton(){let e=this.state.useHighContrastTheme?u.SXButtonStyle.ThemeStroke:u.SXButtonStyle.ColorStroke;return n.createElement(M.default,{title:f.getString("ScreenSharingModal.Cancel"),style:N.button,buttonStyle:e,buttonSize:u.SXButtonSize.Medium,onPress:()=>this._onClose(v.ScreenSharingPanelCancelOrigin.CancelButton)})}_getStartSharingButton(){const e=this.state.useHighContrastTheme?u.SXButtonStyle.ThemeFill:u.SXButtonStyle.ColorFill;return n.createElement(M.default,{title:this._getScreenShareButtonText(),style:N.button,buttonStyle:e,buttonSize:u.SXButtonSize.Medium,onPress:()=>this._shareScreen(v.ScreenSharingStartOrigin.StartButton),disabled:!this.state.selectedSource})}_getScreenShareButtonText(){return this.props.isScreenSharingActive?this.state.selectedSourcesType&&this.state.selectedSourcesType===o.SharingSourceType.Window?f.getString("ScreenSharingModal.SwitchWindow"):f.getString("ScreenSharingModal.SwitchScreen"):this.state.hasWindowsSection?f.getString("ScreenSharingModal.ShareScreenOrWindow"):this.state.includeAudio?f.getString("ScreenSharingModal.ShareScreenAndSounds"):f.getString("ScreenSharingModal.ShareScreen")}}t.default=U},65974:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(48540),o=i(9520),s=i(46096),r=i(10117),l=i(36237),c=i(15877),d=i(33754),u=i(89808),h=i(14976),p=i(96187),g=i(4057),C=i(81760),m=i(11828),S=i(19675),y=i(24576),f=(0,c.lazyProperties)({image:()=>a.Styles.createViewStyle({borderColor:C.Color.transparent,backgroundColor:C.Color.gray400}),missingPreviewView:()=>a.Styles.createViewStyle({borderColor:C.Color.transparent,backgroundColor:C.Color.gray400,flexDirection:"column",alignContent:"center",alignItems:"center",justifyContent:"space-around"}),missingPreviewText:()=>a.Styles.createTextStyle({color:C.Color.white}),imageSelectedBorder:()=>a.Styles.createImageStyle({borderColor:C.Color.blue}),imageHoverBorder:()=>a.Styles.createImageStyle({borderColor:C.Color.gray200Overlay20}),imageSelectedBackground:()=>a.Styles.createViewStyle({backgroundColor:C.Color.blue}),imageHoverBackground:()=>a.Styles.createViewStyle({backgroundColor:C.Color.gray200Overlay60}),centerContent:()=>a.Styles.createViewStyle({borderRadius:4,alignItems:"center",paddingBottom:8,paddingTop:4}),sourceItem:()=>a.Styles.createViewStyle({justifyContent:"center",marginTop:4}),sourceDescription:()=>a.Styles.createTextStyle({textAlign:"center",color:C.Color.white,marginTop:8}),appDescription:()=>a.Styles.createTextStyle({textAlign:"left"}),textLine:()=>a.Styles.createViewStyle({marginLeft:5})});class _ extends y.default{constructor(){super(...arguments),this._failedCode="Failed",this._onHoverStart=()=>{this.isComponentMounted()&&this.setState({isHoveringOn:!0})},this._onHoverEnd=()=>{this.isComponentMounted()&&this.setState({isHoveringOn:!1})},this._toggleSelection=()=>{l.log(s.LogTraceArea.CallingUI,"ScreenSharingSourceItem: _toggleSelection Source Selected "+h.dev_unknownOmit(this.props.sourceDetails.getDescription())),this.props.onSourceSelected(this.props.sourceDetails,this.props.isSelected)},this._onContainerRef=e=>{this._containerRef=e||void 0}}_buildState(e,t){return{selectedColor:u.default.getPrimaryColor()}}requestFocus(){this._containerRef&&this._containerRef.requestFocus()}componentDidMount(){super.componentDidMount(),this._setPreviewUrl(this.props.width,this.props.height)}render(){let e,t;const i=this.props.sourceDetails.getDescription(),n=a.Styles.createViewStyle({width:this.props.width,height:this.props.height,borderWidth:this.props.borderWidth},!1);let o;if(this.props.isSelected){const e=a.Styles.createImageStyle({borderColor:this.state.selectedColor},!1);o=this.props.useHighContrastTheme?this._themeStyles.primaryViewColorStyle:e}else this.state.isHoveringOn&&(o=f.imageHoverBorder);const s=[f.image,n,o],l=[f.missingPreviewView,n,o],c=this._getPlaceholderSize();if(this.state.previewUrl)if(this.state.previewUrl===this._failedCode){let t=d.getString("ScreenSharingModal.PreviewUnavailable");e=a.createElement(a.View,{style:[l]},a.createElement(r.default,{icon:m.SkypeIcon.MissingPreview,color:C.Color.white,size:c}),a.createElement(S.BodyText,{style:f.missingPreviewText},t))}else e=a.createElement(a.Image,{style:s,source:this.state.previewUrl,resizeMode:"stretch"});const u=[a.Styles.createViewStyle({width:this.props.width},!1)];u.push(f.appDescription,f.textLine),this.props.useDefaultTheme&&(this.props.isSelected?u.push(this._themeStyles.primaryBackgroundColorTextStyle):u.push(this._themeStyles.secondaryTextColorStyle)),t=a.createElement(S.Caption,{style:[f.sourceDescription,u],numberOfLines:1},i);const h=a.Styles.createViewStyle({minWidth:this.props.width+2*this.props.borderWidth,minHeight:this.props.height+2*this.props.borderWidth+16},!1);let p;if(this.props.isSelected){const e=a.Styles.createViewStyle({backgroundColor:this.state.selectedColor},!1);p=this.props.useHighContrastTheme?this._themeStyles.primaryViewColorStyle:e}else this.state.isHoveringOn&&(p=f.imageHoverBackground);return a.createElement(a.GestureView,{onDoubleTap:this.props.onDoubleTap},a.createElement(a.View,{onMouseEnter:this._onHoverStart,onMouseLeave:this._onHoverEnd},a.createElement(a.Button,{ref:this._onContainerRef,style:[f.sourceItem,h],onPress:this._toggleSelection,accessibilityLabel:this.props.accessibilityLabel,tabIndex:this.props.tabIndex},a.createElement(a.View,{style:[f.centerContent,p]},e,t))))}_getPlaceholderSize(){return this.props.height<=p.SharingSourceSize.Small.width?m.IconSize.size48:this.props.height<=p.SharingSourceSize.Medium.width?m.IconSize.size100:m.IconSize.size128}_setPreviewUrl(e,t){this.props.sourceDetails.getPreviewAsync(e,t).then((e=>{this._checkIfUnmountedReportLateApi("get source preview")||e&&this._createCanvasAndSetpreviewUrl(e)})).catch((e=>{this.setState({previewUrl:this._failedCode});const t=g.default.errorAsString(e);l.error(s.LogTraceArea.CallingUI,"ScreenSharingSourceItem._setPreviewUrl "+t),l.track(new o.ScreenShareSourceGetPreviewFailure(t,n.SharingSourceType[this.props.sourceDetails.getType()],String(this.props.currentlyShared)))})),this.props.sourceDetails.getType()!==n.SharingSourceType.Monitor&&this._setPreviewUrlToIcon(e,t)}_setPreviewUrlToIcon(e,t){this.props.sourceDetails.getIcon(50,50).then((i=>{this._checkIfUnmountedReportLateApi("getIcon")||this.state.previewUrl||this._createCanvasForIconAndSetpreviewUrl(i,e,t)})).catch((e=>{const t=g.default.errorAsString(e);l.error(s.LogTraceArea.CallingUI,"ScreenSharingSourceItem._setPreviewUrlToIcon "+t),l.track(new o.ScreenShareSourceGetIconFailure(t,String(this.props.currentlyShared)))}))}_checkIfUnmountedReportLateApi(e){return!this.isComponentMounted()&&(l.log(s.LogTraceArea.GenericUnsafe,"ScreenSharingSource: "+e+" returned after component was unmounted: "+h.dev_unknownOmit(this.props.sourceDetails.getDescription())),!0)}_createCanvasForIconAndSetpreviewUrl(e,t,i){let a=document.createElement("canvas");a.width=t,a.height=i,a.style.width=t+"px",a.style.height=i+"px";let n=a.getContext("2d");n&&(n.fillStyle=C.Color.black,n.fillRect(0,0,t,i),n.putImageData(e,t/2-25,i/2-25)),this.setState({previewUrl:a.toDataURL()})}_createCanvasAndSetpreviewUrl(e){let t=document.createElement("canvas"),i=t.getContext("2d");t.width=e.width,t.height=e.height,t.style.width=e.width+"px",t.style.height=e.height+"px",i&&i.putImageData(e,0,0),this.setState({previewUrl:t.toDataURL()})}}t.default=_},11275:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenSharingSourceList=void 0;const a=i(96486),n=i(16778),o=i(88837),s=i(48540),r=i(11930),l=i(47126),c=i(15877),d=i(33754),u=i(6250),h=i(28477),p=i(65974),g=(0,c.lazyProperties)({scrollView:()=>n.Styles.createScrollViewStyle({marginRight:-30,flex:1})}),C="source";class m extends o.ComponentBase{constructor(){super(...arguments),this._mountedSourceRefsMap=new u.default,this._onKeyPress=e=>{let t=this.state.focusedIndex;e.keyCode!==l.default.UP&&e.keyCode!==l.default.LEFT||(t-=1),e.keyCode!==l.default.DOWN&&e.keyCode!==l.default.RIGHT||(t+=1),t<0||t>=this.props.sourcesList.length||this.isComponentMounted()&&this.setState({focusedIndex:t})}}_buildState(e,t){return{focusedIndex:t?0:this.state.focusedIndex}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.state.focusedIndex!==t.focusedIndex&&this._focusItem(this.state.focusedIndex)}render(){return n.createElement(n.ScrollView,{style:g.scrollView,onKeyPress:this._onKeyPress},n.createElement(n.View,{style:this.props.style},this._getAvailableSharingSources()))}_focusItem(e=0){if(e<0||e>=this.props.sourcesList.length)return;const t=this._mountedSourceRefsMap.ref(C+e);null==t||t.requestFocus()}_getAvailableSharingSources(){return a.map(this.props.sourcesList,((e,t)=>{const i=!!this.props.selectedSource&&e.getId()===this.props.selectedSource.getId(),a=!!this.props.currentScreenSharingSource&&e.getId()===this.props.currentScreenSharingSource.getId(),o=e.getId(),l=e.getDescription(),c=e.getType()===s.SharingSourceType.Monitor?"ScreenSharingModal.DesktopAccessibilityLabel":"ScreenSharingModal.WindowAccessibilityLabel";let u=d.getString(c,{description:l,currentItemIndex:t+1,numberOfItems:this.props.sourcesList.length});return i&&(u=r.default.combinedAccessibilityLabel(u,d.getString("Global.SelectedAccessibilityLabel"))||""),n.createElement(p.default,{ref:this._mountedSourceRefsMap.onComponentRef(C+t),tabIndex:this.state.focusedIndex===t?0:-1,key:o,sourceDetails:e,onSourceSelected:this.props.onSourceSelected,isSelected:i,screenIndex:t,width:this.props.itemWidth-8,height:this.props.itemHeight,borderWidth:4,currentlyShared:a,onDoubleTap:()=>this.props.shareScreen(h.ScreenSharingStartOrigin.DoubleClickSource),accessibilityLabel:u,useHighContrastTheme:this.props.useHighContrastTheme,useDefaultTheme:this.props.useDefaultTheme})}))}}t.ScreenSharingSourceList=m},21284:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(38933),o=i(16778),s=i(94224),r=i(15877),l=i(33754),c=i(89808),d=i(81760),u=i(24576),h=i(12770),p=(0,r.lazyProperties)({progressContainer:()=>o.Styles.createViewStyle({height:20,flexDirection:"row",overflow:"hidden",marginBottom:10,alignSelf:"center",justifyContent:"center"}),progressDotContainer:()=>o.Styles.createViewStyle({width:21,height:20,overflow:"hidden",backgroundColor:d.Color.transparent}),progressDot:()=>o.Styles.createViewStyle({width:40,height:40,borderRadius:20,borderWidth:14,borderStyle:"solid",backgroundColor:d.Color.transparent,marginTop:-10,marginLeft:-10})});class g extends u.default{_buildState(e,t){return t?{level:0}:{}}componentDidMount(){super.componentDidMount(),this._timer=h.default.setInterval((()=>{s.default.DeviceStore.getMicrophoneVolumeLevel().then((e=>{this.isComponentMounted()&&this.setState({level:e||0})}))}),200)}componentWillUnmount(){super.componentWillUnmount(),this._timer&&(h.default.clearInterval(this._timer),this._timer=void 0)}render(){const e=this.props.steps||19,t=[p.progressDot];t.push(o.Styles.createViewStyle({borderColor:this.props.backgroundColor||this._themeColors.primaryBackgroundColor},!1));const i=a.range(e).map((i=>{const a=[t];return i*(1/e)>=this.state.level&&a.push(this._themeStyles.secondaryBackgroundColorStyle),o.createElement(o.View,{key:i.toString(),style:p.progressDotContainer},o.createElement(o.View,{style:a}))}));return o.createElement(o.View,{accessibilityLabel:l.getString("AudioVideoSettings.MicrophoneLevelMeter"),accessibilityTraits:o.Types.AccessibilityTrait.Image,ariaRoleDescription:""},o.createElement(n.GradientView,{style:[p.progressContainer,this.props.style],colors:c.default.getGradientColorsNoSubscription(),direction:n.GradientDirection.LEFT},i))}}t.default=g},46989:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(94224),n=i(33754),o=i(73659);class s extends o.default{_getVolume(){return a.default.DeviceStore.getMicrophoneVolume()}_setVolume(e){a.default.DeviceStore.setMicrophoneVolume(100*e)}_getAccessibilityLabel(){return n.getString("CallControls.CallButtonMicrophoneVolumeLabel")}}t.default=s},54863:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(94224),n=i(33754),o=i(73659);class s extends o.default{_getVolume(){return a.default.DeviceStore.getSpeakerVolume()}_setVolume(e){a.default.DeviceStore.setSpeakerVolume(100*e)}_getAccessibilityLabel(){return n.getString("CallControls.CallButtonSpeakerVolumeLabel")}}t.default=s},73659:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(16778),o=i(94224),s=i(33754),r=(i(86045),i(2597)),l=i(24576);class c extends l.default{constructor(){super(...arguments),this._onVolumeChange=e=>{if(!this.isComponentMounted())return;const t=a.round(10*e,1);this.setState({accessibilityVolume:t}),this.props.onAdjustVolume&&this.props.onAdjustVolume(),this._setVolume(e)},this._onSelectedDeviceChanged=()=>{this.setState({initialValue:this._getVolume()})}}componentDidMount(){super.componentDidMount(),o.default.DeviceStore.selectedDevicesChangedEvent().subscribe(this._onSelectedDeviceChanged)}componentWillUnmount(){super.componentWillUnmount(),o.default.DeviceStore.selectedDevicesChangedEvent().unsubscribe(this._onSelectedDeviceChanged),o.default.DeviceStore.saveSettings()}_getAccessibilityVolumeAnnouncement(e){return s.getString("AudioVideoSettings.SpeakerVolumeSliderAnnouncement",{volume:e})}_buildState(e,t){return{initialValue:t?this._getVolume():-1,accessibilityVolume:a.round(this._getVolume()/10,1)}}render(){return n.createElement(r.default,{style:this.props.style,value:-1!==this.state.initialValue?this.state.initialValue/100:void 0,trackHeight:this.props.trackHeight||10,handleSize:this.props.handleSize||26,onProgressChange:this._onVolumeChange,accessibilityLabel:this._getAccessibilityLabel(),colorThemeOverride:this.props.colorThemeOverride,dragStep:.02,ariaValueNow:this.state.accessibilityVolume})}}t.default=c},55604:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(88837),o=i(89391),s=i(94224),r=i(13944),l=i(10117),c=i(58666),d=i(15877),u=i(33754),h=i(46929),p=i(70102),g=i(81760),C=i(11828),m=i(59433),S=i(80837),y=i(19675),f=i(53374),_=(0,d.lazyProperties)({rightPadding:()=>a.Styles.createViewStyle({paddingRight:5}),marginLeft:()=>a.Styles.createViewStyle({marginLeft:10}),containerStyle:()=>a.Styles.createButtonStyle({alignItems:"flex-start"}),innerContainerStyle:()=>a.Styles.createViewStyle({flexDirection:"column",justifyContent:"center",alignItems:"flex-start"}),closeButtonStyle:()=>a.Styles.createButtonStyle({flexGrow:0,flexShrink:1,paddingLeft:10,overflow:"visible",alignItems:"flex-end",alignSelf:"center",justifyContent:"flex-start"}),emptyContainer:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignSelf:"center",justifyContent:"flex-end"}),controlsContainer:()=>a.Styles.createButtonStyle({flexGrow:1,flexShrink:1,flexDirection:"row",justifyContent:"flex-start",alignItems:"center",flexWrap:"wrap"}),innerDesktopContainerStyle:()=>a.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-start",alignItems:"center",flexWrap:"wrap"}),innerControlStyle:()=>a.Styles.createViewStyle({minHeight:0,marginTop:10,marginBottom:4,marginRight:15}),innerControlDesktopStyle:()=>a.Styles.createViewStyle({marginRight:15,marginTop:4,marginBottom:4}),ccIconStyle:()=>a.Styles.createViewStyle({alignSelf:"center"}),linkStyle:()=>a.Styles.createTextStyle({color:g.Color.sxBlue,fontWeight:"bold"}),langPickerStyle:()=>a.Styles.createViewStyle({minHeight:30}),listPickerStyle:()=>a.Styles.createViewStyle({minHeight:0,marginTop:10,marginBottom:8})});class b extends n.ComponentBase{constructor(){super(...arguments),this._subtitlesStartedMessage=()=>u.getString("CallSubtitleToast.CallStartedInLanguage",{selectedLanguage:this.state.selectedLanguageName}),this._renderSubtitlesStartedInLanguageMessage=()=>{var e;return a.createElement(a.View,{style:[this.props.containerStyle,_.containerStyle]},a.createElement(l.IconView,{color:null!==(e=this.props.iconColor)&&void 0!==e?e:g.Color.white,onPress:this.props.onDismiss,size:C.IconSize.size20,icon:C.SkypeIcon.ClosedCaptionFilled}),a.createElement(a.View,{style:[S.default.flexOne,_.marginLeft,_.innerContainerStyle]},a.createElement(y.BodyText,{style:this.props.textStyle},this._subtitlesStartedMessage()),a.createElement(a.View,{style:_.controlsContainer},a.createElement(p.default,{style:[_.innerControlDesktopStyle,_.langPickerStyle],rowTitle:!1,caption:!1,showSelectOption:!0,selectOptionText:u.getString("CallSubtitleToast.ChangeSpokenLanguageDefaultText"),onHandleMenuCommand:this._onHandleMenuCommand,labelColor:g.Color.sxBlue}),a.createElement(y.BodyText,{allowFontScaling:!1,bold:!0,size:y.BodyTextSize.SmallDeprecated,style:[_.innerControlDesktopStyle]},a.createElement(m.default,{url:"#",style:_.linkStyle,allowFontScaling:!1,onPress:this._onStopPress},u.getString("CallSubtitleToast.StopSubtitles"))))),this._getDismissIconView())},this._renderMultipleSpokenLanguageWarningText=()=>{var e;return a.createElement(a.View,{style:[this.props.containerStyle,_.containerStyle]},a.createElement(l.IconView,{color:null!==(e=this.props.iconColor)&&void 0!==e?e:g.Color.white,onPress:this.props.onDismiss,size:C.IconSize.size20,icon:C.SkypeIcon.ClosedCaptionFilled,style:_.ccIconStyle}),a.createElement(a.View,{style:[S.default.flexOne,_.marginLeft,_.innerDesktopContainerStyle]},a.createElement(y.BodyText,{style:this.props.textStyle},u.getString("CallSubtitleToast.MultipleSpokenLanguageWarningText")),a.createElement(p.default,{style:_.rightPadding,rowTitle:!1,caption:!1,showSelectOption:!0,onHandleMenuCommand:this._onHandleMenuCommand,labelColor:g.Color.blue})),this._getDismissIconView())},this._onHandleMenuCommand=e=>{this.props.onDismiss&&this.props.onDismiss(),s.default.InCallBotService.setSpokenLanguageLocale(this.props.callId,e)},this._onStopPress=()=>{this.props.onDismiss&&this.props.onDismiss();const e=f.default.newCauseId();s.default.InCallBotService.stopTranslator(this.props.callId,e)}}_buildState(e,t){var i;const a=null!==(i=h.default.getCallTranslatorBotSpokenLanguageLocale())&&void 0!==i?i:"",n=c.getShortLanguageTitle(a);return{isStartCaptionsInfoPanelEnabled:o.default.getS4LCMCFeatures().isStartCaptionsInfoPanelEnabled,selectedLanguageName:n}}componentDidMount(){super.componentDidMount();let e=this.state.isStartCaptionsInfoPanelEnabled?this._subtitlesStartedMessage():u.getString("CallSubtitleToast.MultipleSpokenLanguageWarningText");a.Accessibility.announceForAccessibility(e)}render(){return this.state.isStartCaptionsInfoPanelEnabled?this._renderSubtitlesStartedInLanguageMessage():this._renderMultipleSpokenLanguageWarningText()}_getDismissIconView(){var e,t;if(!this.props.onDismiss)return;return a.createElement(r.default,{key:"cancelIcon",size:C.IconSize.size20,color:null!==(e=this.props.iconColor)&&void 0!==e?e:g.Color.white,hoverColor:null!==(t=this.props.iconColor)&&void 0!==t?t:g.Color.whiteOverlay70,icon:C.SkypeIcon.Cancel,style:_.closeButtonStyle,title:u.getString("Global.CloseButtonTitle"),onPress:this.props.onDismiss})}}t.default=b},76350:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(16778),o=i(60662),s=i(46096),r=i(12854),l=i(13944),c=i(15877),d=i(33754),u=i(45026),h=i(81115),p=i(81760),g=i(40363),C=i(11828),m=(0,c.lazyProperties)({container:()=>n.Styles.createViewStyle({position:"absolute",bottom:0,right:0,left:0,height:70,overflow:"visible"}),innerContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",justifyContent:"space-between",backgroundColor:p.Color.blackOverlay20}),innerContainerRTL:()=>n.Styles.createViewStyle({flexDirection:"row-reverse"}),closeIcon:()=>n.Styles.createViewStyle({width:C.IconSize.default,height:C.IconSize.default,alignItems:"center",justifyContent:"center"})});class S extends o.default{constructor(){super(...arguments),this._enableHaptics=g.default.getPlatformType()===s.PlatformType.iOS,this._animatedStylesInitialized=!1}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.state.isOpen!==t.isOpen&&this._positionDrawer(!0,this.state)}openDrawer(){super.openDrawer(),this._enableHaptics&&r.default.prepareFeedback()}closeDrawer(){const e=super.closeDrawer();return this._enableHaptics&&r.default.unprepareFeedback(),e}_onHandleReactionPressed(){super._onHandleReactionPressed(),this._enableHaptics&&r.default.triggerFeedback()}_positionDrawer(e,t){if(this._onPositionDrawer(e,t),!this._animatedStylesInitialized)return void this._maybeInitAnimatedStyles(t);const i=this._animatedValues(t);this._animatedTransformValue&&this._animatedOpacityValue&&(e?(this._drawerAnimation=n.Animated.parallel([u.default.timing(this._animatedTransformValue,{toValue:i.top,easing:n.Animated.Easing.Out(),duration:150,useNativeDriver:!0}),u.default.timing(this._animatedOpacityValue,{toValue:i.opacity,easing:n.Animated.Easing.Out(),duration:150,useNativeDriver:!0})]),this._drawerAnimation.start((e=>{this._onPositionDrawerAnimationCompleted()}))):(this._animatedTransformValue.setValue(i.top),this._animatedOpacityValue.setValue(i.opacity)))}_renderReactionViews(e){const t=n.createElement(l.default,{key:"close",style:m.closeIcon,size:C.IconSize.size24,icon:C.SkypeIcon.Cancel,color:p.Color.white,hoverColor:p.Color.white,title:d.getString("ReactionsStream.ReactionBarCloseDrawerTitle"),onPress:this._onToggleOpen});return a.compact([...e,t])}_maybeInitAnimatedStyles(e){if(!this._animatedStylesInitialized){const t=this._animatedValues(e);this._animatedTransformValue=new n.Animated.Value(t.top),this._animatedOpacityValue=new n.Animated.Value(t.opacity),this._animatedStyle=n.Styles.createAnimatedViewStyle({opacity:this._animatedOpacityValue,transform:[{translateY:this._animatedTransformValue}]}),this._animatedStylesInitialized=!0}}_animatedValues(e){return{top:e.isOpen?0:this._drawerSize(),opacity:e.isOpen?1:0}}_drawerSize(){return 70+this.props.bottomSafeAreaInset}render(){const e=[m.container];this._animatedStyle&&e.push(this._animatedStyle);const t=[m.innerContainer];return h.default.hasHorizontalSafeAreas(this.props.horizontalInsets)&&t.push(h.default.horizontalPaddingStyle(this.props.horizontalInsets)),this._isRTL&&t.push(m.innerContainerRTL),this.props.bottomSafeAreaInset&&(e.push(h.default.heightStyle(this._drawerSize())),t.push(h.default.paddingBottomStyle(this.props.bottomSafeAreaInset))),n.createElement(n.Animated.View,{style:e},n.createElement(n.View,{style:t},this._renderContent()))}}t.default=S},9399:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(48777),o=i(74049);class s extends o.StackNavHeightBasedToast{_getContainerStyle(){return o.CommonToastStyles.container}_renderContent(){return a.createElement(n.default,{callId:this.props.callId,conversationMri:this.props.conversationMri,textStyle:o.CommonToastStyles.titleStyle,linkStyle:o.CommonToastStyles.linkStyle})}}t.default=s},28493:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStackNavCallMediaCapturerToast=t.RemoteStackNavCallMediaCapturerToast=void 0;const a=i(16778),n=i(88837),o=i(21936),s=i(67332),r=i(63841),l=i(81760),c=i(11828);class d extends n.ComponentBase{render(){const e=[{icon:c.SkypeIcon.CallRemoteNdiRecord,color:l.Color.white}];return a.createElement(s.RemoteStackNavPrivacyToast,{conversationMri:this.props.conversationMri,initiatorMri:this.props.initiatorMri,topInset:this.props.topInset,viewWidth:this.props.viewWidth,onDesiredHeightChanged:this.props.onDesiredHeightChanged,notificationTextPath:"CallMediaCapturerToast.NotificationText",startedAccessibilityLabelTextPath:"CallMediaCapturerToast.StartedAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallMediaCapturerToast.StoppedAccessibilityLabel",icons:e})}}t.RemoteStackNavCallMediaCapturerToast=d;class u extends n.ComponentBase{constructor(){super(...arguments),this._getTimestamp=()=>{},this._onStopPress=()=>{o.default.setNdiEnabled(!1)}}render(){return a.createElement(s.LocalStackNavPrivacyToast,{topInset:this.props.topInset,viewWidth:this.props.viewWidth,onDesiredHeightChanged:this.props.onDesiredHeightChanged,onStopPress:this._onStopPress,getTimestamp:this._getTimestamp,colorThemeOverride:r.Theme.ColorfulDark,privacyStatementTextPath:"CallMediaCapturerToast.PrivacyStatementText",morePrivacyInfoLinkTextPath:"CallMediaCapturerToast.MorePrivacyInfoLinkText",stopLinkTextPath:"CallMediaCapturerToast.StopLinkText",startedAccessibilityLabelTextPath:"CallMediaCapturerToast.StartedInitiatorAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallMediaCapturerToast.StoppedInitiatorAccessibilityLabel"})}}t.LocalStackNavCallMediaCapturerToast=u},33778:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(88837),o=i(94224),s=i(67332),r=i(63841),l=i(81760),c=i(11828);class d extends n.ComponentBase{constructor(){super(...arguments),this._getTimestamp=()=>o.default.CallingStore.getCallRecordingTimestamp(this.props.callId)}_buildState(e,t){const i=o.default.CallingStore.getCallRecordingInitiator(e.callId);return{initiatorMri:i,isLocalInitiator:o.default.InCallBotUtils.isCallRecordingInitiator(i)}}render(){if(this.state.initiatorMri&&this.state.isLocalInitiator)return a.createElement(s.LocalStackNavPrivacyToast,{topInset:this.props.topInset,viewWidth:this.props.viewWidth,onDesiredHeightChanged:this.props.onDesiredHeightChanged,onStopPress:this.props.onPress,getTimestamp:this._getTimestamp,colorThemeOverride:r.Theme.ColorfulDark,privacyStatementTextPath:"CallRecorderToast.PrivacyStatementText",morePrivacyInfoLinkTextPath:"CallRecorderToast.RecordingInitiatorMorePrivacyInfoLinkText",stopLinkTextPath:"CallRecorderToast.StopRecordingLinkText",startedAccessibilityLabelTextPath:"CallRecorderToast.StartedRecordingInitiatorAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallRecorderToast.StoppedRecordingInitiatorAccessibilityLable"});const e=[{icon:c.SkypeIcon.CallRecordStroke,color:l.Color.white},{icon:c.SkypeIcon.CallRecordDot,color:l.Color.red}];return a.createElement(s.RemoteStackNavPrivacyToast,{conversationMri:this.props.conversationMri,initiatorMri:this.state.initiatorMri,topInset:this.props.topInset,viewWidth:this.props.viewWidth,onDesiredHeightChanged:this.props.onDesiredHeightChanged,notificationTextPath:"CallRecorderToast.IsRecordingText",initialNotficationTextPath:"CallRecorderToast.StartingRecordingText",startedAccessibilityLabelTextPath:"CallRecorderToast.StartedRecordingAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallRecorderToast.StoppedRecordingAccessibilityLabel",icons:e})}}t.default=d},90089:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(63841),o=i(89324),s=i(74049);class r extends s.StackNavHeightBasedToast{_getContainerStyle(){}_renderContent(){return a.createElement(o.default,{closeToast:this.props.closeToast,colorThemeOverride:n.Theme.ColorfulDark})}}t.default=r},76835:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(34501),o=i(74049);class s extends o.StackNavHeightBasedToast{_getContainerStyle(){return o.CommonToastStyles.container}_renderContent(){return a.createElement(n.default,{toastType:this.props.type,textStyle:o.CommonToastStyles.titleStyle,conversationMri:this.props.conversationMri,onDismiss:this.props.closeToast})}}t.default=s},74049:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StackNavHeightBasedToast=t.CommonToastStyles=void 0;const a=i(16778),n=i(88837),o=i(15877),s=i(81760),r=i(11010),l=(0,o.lazyProperties)({hidden:()=>a.Styles.createViewStyle({opacity:0})});t.CommonToastStyles=(0,o.lazyProperties)({titleStyle:()=>a.Styles.createTextStyle({color:s.Color.white}),linkStyle:()=>a.Styles.createTextStyle({color:s.Color.sxBlue,fontSize:r.default.controlFontSize.smallButton}),container:()=>a.Styles.createViewStyle({paddingLeft:10,paddingRight:10,paddingVertical:10,backgroundColor:s.Color.gray400Overlay70})});class c extends n.ComponentBase{constructor(){super(...arguments),this.onLayout=e=>{const t=this.props.topInset,i=e.height-(t||0);i!==this.state.desiredHeight&&this.setState({desiredHeight:i,initialLayoutComplete:!0})}}_buildState(e,t){const i={};return t&&(i.initialLayoutComplete=!1,i.desiredHeight=0),i}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this.state.desiredHeight!==t.desiredHeight&&this.props.onDesiredHeightChanged(t.desiredHeight)}componentWillUnmount(){super.componentWillUnmount(),this.props.onDesiredHeightChanged(0)}render(){const e=[this._getContainerStyle()];return this.props.topInset&&e.push(a.Styles.createViewStyle({paddingTop:this.props.topInset},!1)),this.state.initialLayoutComplete||e.push(l.hidden),a.createElement(a.View,{style:e,onLayout:this.onLayout},this._renderContent())}}t.StackNavHeightBasedToast=c},54594:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(46767),o=i(74049);class s extends o.StackNavHeightBasedToast{_getContainerStyle(){return o.CommonToastStyles.container}_renderContent(){return a.createElement(n.default,{callId:this.props.callId,textStyle:o.CommonToastStyles.titleStyle,linkStyle:o.CommonToastStyles.linkStyle})}}t.default=s},24431:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(33643),o=i(74049);class s extends o.StackNavHeightBasedToast{_getContainerStyle(){return o.CommonToastStyles.container}_renderContent(){return a.createElement(n.default,{callId:this.props.callId,conversationMri:this.props.conversationMri,isEncryptedCall:this.props.isEncryptedCall,isPSTNCall:this.props.isPSTNCall,textStyle:o.CommonToastStyles.titleStyle,linkStyle:o.CommonToastStyles.linkStyle})}}t.default=s},67332:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStackNavPrivacyToast=t.RemoteStackNavPrivacyToast=void 0;const a=i(16778),n=i(61541),o=i(44973),s=i(52262),r=i(13944),l=i(15877),c=i(33754),d=i(51070),u=i(81760),h=i(11828),p=i(59433),g=i(19675),C=(0,l.lazyProperties)({container:()=>a.Styles.createViewStyle({flexDirection:"row",paddingLeft:10,paddingRight:10,paddingVertical:10,backgroundColor:u.Color.gray400Overlay70}),contentContainer:()=>a.Styles.createViewStyle({flex:1,marginLeft:10,paddingTop:4}),hiddenContainer:()=>a.Styles.createViewStyle({opacity:0}),titleContainer:()=>a.Styles.createViewStyle({flexDirection:"row",flex:1}),privacyStatementContainer:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",paddingTop:5}),privacyStatementTextContainer:()=>a.Styles.createViewStyle({flex:1,marginRight:5}),statusTextStyle:()=>a.Styles.createTextStyle({flex:1,paddingHorizontal:10}),textStyle:()=>a.Styles.createTextStyle({color:u.Color.white}),linkStyle:()=>a.Styles.createTextStyle({color:u.Color.sxBlue})});class m extends n.RemoteBaseCallRecorderToast{constructor(){super(...arguments),this._onLayout=e=>{const t=e.height-(this.props.topInset||0);t!==this.state.desiredHeight&&this.setState({desiredHeight:t,initialLayoutComplete:!0})}}_buildState(e,t){const i=d.default.horizontalPaddingStyle();let a={initiatorDisplayName:e.initiatorMri?s.default.getMemberShortNameForConversation(e.conversationMri,e.initiatorMri):void 0,horizontalPaddingStyle:i};return t&&(a.initialLayoutComplete=!1,a.desiredHeight=0),a}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this.state.desiredHeight!==t.desiredHeight&&this.props.onDesiredHeightChanged(t.desiredHeight)}render(){const e=[C.container];this.state.horizontalPaddingStyle&&e.push(this.state.horizontalPaddingStyle),this.props.topInset&&e.push(a.Styles.createViewStyle({paddingTop:this.props.topInset},!1)),this.state.initialLayoutComplete||e.push(C.hiddenContainer);let t,i=a.createElement(o.default,{icons:this.props.icons});const n=[C.titleContainer,a.Styles.createViewStyle({maxWidth:this.props.viewWidth-55},!1)];let s;return this.state.initiatorDisplayName?s=c.getString(this.props.notificationTextPath,{name:this.state.initiatorDisplayName}):this.props.initialNotficationTextPath&&(s=c.getString(this.props.initialNotficationTextPath)),s&&(t=a.createElement(a.View,{style:n},a.createElement(g.Subtitle,{style:C.textStyle},s))),a.createElement(a.View,{style:e,onLayout:this._onLayout},i,a.createElement(a.View,{style:C.contentContainer},t))}}t.RemoteStackNavPrivacyToast=m;class S extends n.LocalBaseCallRecorderToast{constructor(){super(...arguments),this._onLayout=e=>{const t=e.height-(this.props.topInset||0);t!==this.state.desiredHeight&&this.setState({desiredHeight:t,initialLayoutComplete:!0})}}_buildState(e,t){let i={horizontalPaddingStyle:d.default.horizontalPaddingStyle(),recordingTimestamp:e.getTimestamp()};return t&&(i.showPrivacyLink=!0,i.initialLayoutComplete=!1,i.desiredHeight=0),i}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this.state.desiredHeight!==t.desiredHeight&&this.props.onDesiredHeightChanged(t.desiredHeight)}render(){const e=[{icon:h.SkypeIcon.CallRecordStroke,color:u.Color.white},{icon:h.SkypeIcon.CallRecordDot,color:u.Color.red}],t=[C.container];this.state.horizontalPaddingStyle&&t.push(this.state.horizontalPaddingStyle),this.props.topInset&&t.push(a.Styles.createViewStyle({paddingTop:this.props.topInset},!1)),this.state.initialLayoutComplete||t.push(C.hiddenContainer);let i,n=a.createElement(a.View,{onPress:this._onStopPress},a.createElement(o.default,{icons:e})),s=a.createElement(a.View,{style:C.titleContainer},a.createElement(g.Subtitle,{style:C.textStyle},this._getElapsedTime()),a.createElement(a.Button,{onPress:this._onStopPress},a.createElement(g.Subtitle,{style:[C.statusTextStyle,C.linkStyle]},c.getString(this.props.stopLinkTextPath))));if(this.state.showPrivacyLink){const e=[C.privacyStatementTextContainer,a.Styles.createViewStyle({maxWidth:this.props.viewWidth-80},!1)];i=a.createElement(a.View,{style:C.privacyStatementContainer},a.createElement(a.View,{style:e},a.createElement(g.Caption,{style:C.textStyle},c.getString(this.props.privacyStatementTextPath)," ",a.createElement(p.default,{url:"#",style:C.linkStyle,allowFontScaling:!1,onPress:this._onMorePrivacyInfoPress},c.getString(this.props.morePrivacyInfoLinkTextPath)))),a.createElement(r.default,{icon:h.SkypeIcon.ClosePanel,size:h.IconSize.size20,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.primaryIconColor,title:c.getString("Global.CloseButtonTitle"),onPress:this._onDismissPrivacyInfoPress}))}return a.createElement(a.View,{style:t,onLayout:this._onLayout},n,a.createElement(a.View,{style:C.contentContainer},s,i))}}t.LocalStackNavPrivacyToast=S},91018:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(10117),o=i(15877),s=i(33754),r=i(74049),l=i(81760),c=i(11828),d=i(19675),u=(0,o.lazyProperties)({containerstyle:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),titleStyle:()=>a.Styles.createTextStyle({paddingLeft:7})});class h extends r.StackNavHeightBasedToast{_getContainerStyle(){return r.CommonToastStyles.container}_renderContent(){return a.createElement(a.View,{style:u.containerstyle},a.createElement(n.default,{icon:c.SkypeIcon.MicrophoneOff,size:c.IconSize.size14,color:l.Color.white}),a.createElement(d.BodyText,{bold:!0,style:[r.CommonToastStyles.titleStyle,u.titleStyle],numberOfLines:1},s.getString("CallPanel.MicrophoneServerMuted")))}}t.default=h},17163:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(94224),o=i(46096),s=i(36237),r=i(15877),l=i(55604),c=i(74049),d=(0,r.lazyProperties)({metadataContainer:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center"})});class u extends c.StackNavHeightBasedToast{constructor(){super(...arguments),this._dismiss=()=>{s.log(o.LogTraceArea.CallingUI,"StackNavSpokenLanguageConflictResolutionToast._dismiss"),n.default.InCallBotService.setSpokenLanguageConflictToastShown(this.props.callId,!0),n.default.InCallBotService.hideSubtitlesStartedMessage(this.props.callId)}}_getContainerStyle(){return c.CommonToastStyles.container}_renderContent(){return a.createElement(l.default,{containerStyle:d.metadataContainer,textStyle:c.CommonToastStyles.titleStyle,callId:this.props.callId,onDismiss:this._dismiss})}}t.default=u},84449:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(74049),o=i(66318);class s extends n.StackNavHeightBasedToast{_getContainerStyle(){return n.CommonToastStyles.container}_renderContent(){return a.createElement(o.default,{textStyle:n.CommonToastStyles.titleStyle,conversationMri:this.props.conversationMri,onDismiss:this.props.closeToast})}}t.default=s},97016:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(74049),o=i(37191);class s extends n.StackNavHeightBasedToast{_getContainerStyle(){return n.CommonToastStyles.container}_renderContent(){return a.createElement(o.default,{callId:this.props.callId,textStyle:n.CommonToastStyles.titleStyle,linkStyle:n.CommonToastStyles.linkStyle,conversationMri:this.props.conversationMri})}}t.default=s},62038:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(16778),o=i(77381),s=i(79669);class r extends o.default{constructor(){super(...arguments),this._checkIfContentDimensionsChanged=()=>{if(a.isUndefined(this._popupRef))return;const e=this._popupRef.getBoundingClientRect();a.isUndefined(this.state.prevContentRect)||Math.round(this.state.prevContentRect.width)===Math.round(e.width)&&Math.round(this.state.prevContentRect.height)===Math.round(e.height)||this.props.onContentDimensionsChanged&&this.props.onContentDimensionsChanged(),this.setState({prevContentRect:e})},this._onPopupRef=e=>{this._popupRef=e||void 0}}_buildState(e,t){const i={};return t&&(i.prevContentRect=void 0),i}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this._checkIfContentDimensionsChanged()}render(){return n.createElement("div",{ref:this._onPopupRef},n.createElement(s.default,{anchorPosition:this.props.anchorPosition,anchorOffset:this.props.anchorOffset,popupWidth:this.props.popupWidth,popupHeight:this.props.popupHeight,fillColor:this.props.fillColor,strokeColor:this.props.strokeColor,popupAccessibilityTitle:this.props.popupAccessibilityTitle,offset:this.props.offset},n.createElement(n.View,{style:this.props.style},this.props.renderContent())))}}t.default=r},47017:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(88837),o=i(81760),s=200;class r extends n.ComponentBase{constructor(e){super(e),this._loopDuration=3e3,this._backgroundRing1ScaleAnimatedValue=new a.Animated.Value(1),this._backgroundRing1ScaleAnimatedStyle=a.Styles.createAnimatedViewStyle({transform:[{scale:this._backgroundRing1ScaleAnimatedValue}]}),this._backgroundRing2ScaleAnimatedValue=new a.Animated.Value(1),this._backgroundRing2ScaleAnimatedStyle=a.Styles.createAnimatedViewStyle({transform:[{scale:this._backgroundRing2ScaleAnimatedValue}]}),this._backgroundRing3ScaleAnimatedValue=new a.Animated.Value(1),this._backgroundRing3ScaleAnimatedStyle=a.Styles.createAnimatedViewStyle({transform:[{scale:this._backgroundRing3ScaleAnimatedValue}]})}_startAnimation(){this._animation=a.Animated.parallel([a.Animated.sequence([a.Animated.timing(this._backgroundRing1ScaleAnimatedValue,{delay:.3*this._loopDuration,toValue:1.9,easing:a.Animated.Easing.CubicBezier(.33,0,0,1),duration:.5*this._loopDuration,isInteraction:!1}),a.Animated.timing(this._backgroundRing1ScaleAnimatedValue,{toValue:1,easing:a.Animated.Easing.CubicBezier(.5,0,1,1),duration:.2*this._loopDuration,isInteraction:!1})]),a.Animated.sequence([a.Animated.timing(this._backgroundRing2ScaleAnimatedValue,{toValue:2.1,easing:a.Animated.Easing.CubicBezier(.33,0,0,1),duration:.66*this._loopDuration,isInteraction:!1}),a.Animated.timing(this._backgroundRing2ScaleAnimatedValue,{toValue:1,easing:a.Animated.Easing.CubicBezier(.7,0,1,1),duration:.33*this._loopDuration,isInteraction:!1})]),a.Animated.sequence([a.Animated.timing(this._backgroundRing3ScaleAnimatedValue,{toValue:2.3,easing:a.Animated.Easing.CubicBezier(.33,0,0,1),duration:.75*this._loopDuration,isInteraction:!1}),a.Animated.timing(this._backgroundRing3ScaleAnimatedValue,{toValue:1,easing:a.Animated.Easing.CubicBezier(.9,0,1,1),duration:.25*this._loopDuration,isInteraction:!1})])]),this._animation.start((()=>{this.isComponentMounted()&&this.props.animate&&this._startAnimation()}))}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),!e.animate&&this.props.animate&&this._startAnimation()}componentDidMount(){super.componentDidMount(),this.props.animate&&this._startAnimation()}_containerStyle(){const e=this.props.size||s;return a.Styles.createViewStyle({overflow:"visible",width:e,height:e,alignItems:"center",justifyContent:"center"},!1)}_backgroundRing1Style(){const e=this.props.size||s;return a.Styles.createViewStyle({position:"absolute",top:e/4,left:e/4,width:e/2,height:e/2,borderRadius:e/4,backgroundColor:o.Color.gray300,opacity:.35},!1)}_backgroundRing2Style(){const e=this.props.size||s;return a.Styles.createViewStyle({position:"absolute",top:e/4,left:e/4,width:e/2,height:e/2,borderRadius:e/4,backgroundColor:o.Color.gray300,opacity:.15},!1)}_backgroundRing3Style(){const e=this.props.size||s;return a.Styles.createViewStyle({position:"absolute",top:e/4,left:e/4,width:e/2,height:e/2,borderRadius:e/4,backgroundColor:o.Color.gray300,opacity:.15},!1)}_backgroundRing0Style(){const e=this.props.size||s;return a.Styles.createViewStyle({position:"absolute",top:e/4,left:e/4,width:e/2,height:e/2,borderRadius:e/4,backgroundColor:o.Color.gray300,opacity:.07,transform:[{scale:2.3}]},!1)}render(){return a.createElement(a.View,{style:this.props.style,blockPointerEvents:!0},a.createElement(a.View,{style:this._containerStyle()},a.createElement(a.Animated.View,{style:[this._backgroundRing0Style()]}),a.createElement(a.Animated.View,{style:[this._backgroundRing1Style(),this._backgroundRing1ScaleAnimatedStyle]}),a.createElement(a.Animated.View,{style:[this._backgroundRing2Style(),this._backgroundRing2ScaleAnimatedStyle]}),a.createElement(a.Animated.View,{style:[this._backgroundRing3Style(),this._backgroundRing3ScaleAnimatedStyle]})))}}t.default=r},66318:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(88837),o=i(52262),s=i(10117),r=i(15877),l=i(33754),c=i(81760),d=i(11010),u=i(11828),h=i(19675),p=(0,r.lazyProperties)({contentContainer:()=>a.Styles.createButtonStyle({flex:1,flexDirection:"row",alignItems:"center",marginVertical:10}),textContentContainer:()=>a.Styles.createViewStyle({flex:1,alignSelf:"center"}),textContent:()=>a.Styles.createTextStyle({paddingLeft:10,paddingRight:15,flexWrap:"wrap",flex:1}),textContentMobile:()=>a.Styles.createTextStyle({fontSize:d.default.controlFontSize.caption}),container:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"flex-start"}),dismissButtonDesktop:()=>a.Styles.createViewStyle({margin:10}),dismissButtonMobile:()=>a.Styles.createViewStyle({marginTop:10}),translationIconDesktop:()=>a.Styles.createViewStyle({marginLeft:15})});class g extends n.ComponentBase{constructor(){super(...arguments),this._onDismiss=()=>{this.props.onDismiss&&this.props.onDismiss()}}_buildState(e,t){return{conversationName:o.default.getDisplayName(e.conversationMri)||""}}render(){return a.createElement(a.View,{style:[this.props.containerStyle,p.container]},a.createElement(a.View,{style:p.contentContainer},this._renderTeamsIcon(),this._renderTextContent()),this._renderDismissButton())}_renderTeamsIcon(){return a.createElement(s.default,{key:"teamsIcon",style:p.translationIconDesktop,icon:u.SkypeIcon.MSTeams,color:c.Color.white,size:u.IconSize.size24})}_renderTextContent(){return a.createElement(a.View,{key:"textContentContainer",style:p.textContentContainer},a.createElement(h.BodyText,{style:this._getTextStyles()},l.getString("TeamsInteropBanner.TeamsInteropInCallBannerText",{userName:this.state.conversationName})))}_renderDismissButton(){return a.createElement(s.default,{key:"dismissButton",style:p.dismissButtonDesktop,color:c.Color.white,onPress:this._onDismiss,size:u.IconSize.size24,icon:u.SkypeIcon.Cancel})}_getTextStyles(){return[this.props.textStyle,p.textContent]}}t.default=g},15362:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(38933),n=i(16778),o=i(88837),s=i(47447),r=i(71830),l=i(46096),c=i(36237),d=i(15877),u=i(23752),h=i(18078),p=i(81760),g=i(80837),C=i(12770),m=i(2301),S=i(67977),y=10,f=(0,d.lazyProperties)({bubbleContainer:()=>n.Styles.createViewStyle({flex:-1,flexDirection:"row"}),simpleBubbleContainer:()=>n.Styles.createViewStyle({maxWidth:260}),bubble:()=>n.Styles.createViewStyle({flex:-1,alignSelf:"flex-start",backgroundColor:p.Color.gray400,borderTopRightRadius:y,borderBottomLeftRadius:y,borderBottomRightRadius:y,padding:15,marginBottom:4,marginHorizontal:20}),bubbleSelf:()=>n.Styles.createViewStyle({flex:-1,alignSelf:"flex-end",backgroundColor:p.Color.gray50,borderTopLeftRadius:y,borderTopRightRadius:y,borderBottomLeftRadius:y,padding:15,marginBottom:4,marginHorizontal:20}),simpleBubble:()=>n.Styles.createViewStyle({flex:-1,padding:8}),bubbleGradient:()=>n.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,borderTopRightRadius:y,borderBottomLeftRadius:y,borderBottomRightRadius:y}),bubbleText:()=>n.Styles.createTextStyle({color:p.Color.white,backgroundColor:p.Color.transparent}),bubbleTextSelf:()=>n.Styles.createTextStyle({color:p.Color.gray400,backgroundColor:p.Color.transparent}),userIcon:()=>n.Styles.createViewStyle({marginLeft:5})});class _ extends o.ComponentBase{componentDidMount(){super.componentDidMount(),c.log(l.LogTraceArea.CallReactions,"TextReactionView.componentDidMount cuid: "+this.props.id),this._reactionOnScreenTimer=C.default.setTimeout((()=>{this._reactionOnScreenTimer=void 0,this.isComponentMounted()&&this.props.onAnimationEnd&&this.props.onAnimationEnd(this.props.id,this.props.mri)}),this.props.textTimeoutMs||3e3)}componentWillUnmount(){super.componentWillUnmount(),c.log(l.LogTraceArea.CallReactions,"TextReactionView.componentWillUnmount cuid: "+this.props.id),this._reactionOnScreenTimer&&(C.default.clearTimeout(this._reactionOnScreenTimer),this._reactionOnScreenTimer=void 0)}render(){const e=h.default.isMyMri(this.props.mri),t=r.isAgent(this.props.mri),i=e||this.props.hideBackground?void 0:n.createElement(a.GradientView,{style:f.bubbleGradient,colors:this.props.gradientColors,direction:a.GradientDirection.RIGHT}),o=e||this.props.hideUserIcon?void 0:n.createElement(m.UserIcon,{style:f.userIcon,size:S.UserIconSize.Size30,userMri:this.props.mri}),l=this.props.hideBackground?f.simpleBubble:e?f.bubbleSelf:f.bubble,c=e||this.props.hideBackground?f.bubbleTextSelf:f.bubbleText;let d;if(this.props.reaction){const e={renderMedia:!1,allowLargeEmoticons:!0,textOverrideStyle:c,allowTextFallbackEmoticons:!0,numberOfLines:this.props.hideBackground&&!t&&s.UICapabilities.textNumberOfLinesSupported()?10:void 0};d=n.createElement(u.default,{message:this.props.reaction,options:e})}else this.props.content&&(d=n.createElement(n.Text,{style:c},this.props.content));const p=[];return this.props.hideBackground&&p.push(f.simpleBubbleContainer),this.props.onPress&&p.push(g.default.pointerCursor),this.props.style&&p.push(this.props.style),n.createElement(n.View,{style:p,onPress:this.props.onPress,activeOpacity:.8},n.createElement(n.View,{style:f.bubbleContainer},o,n.createElement(n.View,{style:l},i,d)))}}t.default=_},96229:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(71727),o=i(36400),s=i(10117),r=i(15877),l=i(33754),c=i(98053),d=i(11010),u=i(11828),h=i(19675),p=i(24576),g=i(66123),C=(0,r.lazyProperties)({container:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center",marginRight:16}),labelStyle:()=>a.Styles.createTextStyle({textAlign:"center",textAlignVertical:"center",marginHorizontal:5,paddingBottom:1,fontSize:d.default.fontSize.size13Deprecated,font:d.default.font.uiDisplayRegular}),iconStyle:()=>a.Styles.createViewStyle({overflow:"visible"}),iconCompactStyle:()=>a.Styles.createViewStyle({paddingHorizontal:8})});class m extends p.default{constructor(){super(...arguments),this._onTogetherModeBackgroundChangeButtonPress=()=>{this._changeTogetherModeBackgroundCommand.execute()}}_buildState(e,t){return t&&(this._changeTogetherModeBackgroundCommand=new c.ChangeTogetherModeBackgroundCommand(e.callId,e.conversationMri)),{canChangeTogetherModeBackground:this._changeTogetherModeBackgroundCommand.canExecute(),compactView:n.CallUIUtils.isDesktopMinCallPanelHeaderV2(this._getRootViewId())}}render(){if(!this.state.canChangeTogetherModeBackground)return null;const e=l.getString("CallControlsOverFlowMenu.ChangeTogetherModeBackground"),t=[C.iconStyle,this.state.compactView?C.iconCompactStyle:void 0],i={style:C.container,title:e,accessibilityLabel:e,onPress:this._onTogetherModeBackgroundChangeButtonPress};let n;return this.state.compactView||(n=a.createElement(h.BodyText,{style:[C.labelStyle,{color:this.props.labelColor}]},e)),a.createElement(o.HoverableButton,Object.assign({},i),a.createElement(s.IconView,{icon:g.default.getBackgroundChangeButtonIcon(),size:u.IconSize.size16,color:this.props.labelColor,style:t}),n)}}t.default=m},63520:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(46096),o=i(10117),s=i(36237),r=i(15877),l=i(89808),c=i(14976),d=i(81760),u=i(11010),h=i(11828),p=i(19675),g=i(24576),C=(0,r.lazyProperties)({image:()=>a.Styles.createViewStyle({borderColor:d.Color.transparent,backgroundColor:d.Color.gray400}),imageHoverBorder:()=>a.Styles.createImageStyle({borderColor:d.Color.gray200Overlay20}),imageHoverBackground:()=>a.Styles.createViewStyle({backgroundColor:d.Color.gray200Overlay60}),centerContent:()=>a.Styles.createViewStyle({borderRadius:4,alignItems:"center",paddingBottom:8,paddingTop:4,position:"relative"}),maxAudienceIconAndValue:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center",position:"absolute",top:13,right:13,backgroundColor:"#2B2C33D8",paddingHorizontal:2}),maxAudienceIcon:()=>a.Styles.createViewStyle({marginBottom:2,marginRight:4}),maxAudienceText:()=>a.Styles.createTextStyle({color:d.Color.white}),backgroundItem:()=>a.Styles.createViewStyle({justifyContent:"center",marginTop:4}),backgroundName:()=>a.Styles.createTextStyle({textAlign:"left",color:d.Color.white,marginTop:8}),textLine:()=>a.Styles.createViewStyle({marginLeft:5}),selectedTextStyleDark:()=>a.Styles.createViewStyle({backgroundColor:d.Color.gray400}),selectedTextStyleWhite:()=>a.Styles.createViewStyle({backgroundColor:d.Color.white})});class m extends g.default{constructor(){super(...arguments),this._onHoverStart=()=>{this.isComponentMounted()&&this.setState({isHoveringOn:!0})},this._onHoverEnd=()=>{this.isComponentMounted()&&this.setState({isHoveringOn:!1})},this._onPress=()=>{s.log(n.LogTraceArea.CallingUI,"TogetherModeBackgroundItem: _onPress Background Selected "+c.dev_unknownOmit(this.props.backgroundDetails.untranslatedName)),this.props.onSelected(this.props.backgroundDetails,this.props.isSelected)},this._onContainerRef=e=>{this._containerRef=e||void 0}}_buildState(e,t){return{isHoveringOn:!1,selectedColor:l.default.getPrimaryColor(),primaryBackgroundColorStyle:l.default.getPrimaryBackgroundColorStyle()}}requestFocus(){this._containerRef&&this._containerRef.requestFocus()}render(){const e=this.props.backgroundDetails.label,t=a.Styles.createViewStyle({width:this.props.width,height:this.props.height,borderWidth:this.props.borderWidth},!1),i=[C.image,t,this._getExtraBorderStyle()],n=a.createElement(p.Caption,{style:[C.backgroundName,this._getCaptionStyles()],numberOfLines:1},e),s=a.Styles.createViewStyle({minWidth:this.props.width+2*this.props.borderWidth,minHeight:this.props.height+2*this.props.borderWidth+16},!1),r=a.createElement(a.View,{style:C.maxAudienceIconAndValue},a.createElement(o.default,{style:C.maxAudienceIcon,size:h.IconSize.size14,color:d.Color.white,icon:h.SkypeIcon.ContactGroup}),a.createElement(a.Text,{style:[C.maxAudienceText,u.default.fontStyle.tertiaryButton]},this.props.backgroundDetails.maxAudience));return a.createElement(a.GestureView,{onDoubleTap:this.props.onDoubleTap},a.createElement(a.View,{onMouseEnter:this._onHoverStart,onMouseLeave:this._onHoverEnd},a.createElement(a.Button,{ref:this._onContainerRef,style:[C.backgroundItem,s],onPress:this._onPress,accessibilityLabel:this.props.accessibilityLabel,tabIndex:this.props.tabIndex},a.createElement(a.View,{style:[C.centerContent,this._getExtraBackgroundStyle()]},a.createElement(a.Image,{style:i,source:this.props.backgroundDetails.url,resizeMode:"stretch"}),r,n))))}_getCaptionStyles(){const e=[a.Styles.createViewStyle({width:this.props.width},!1),C.textLine];return this.props.isSelected?e.push(this.props.highContrastTheme?this._themeStyles.primaryBackgroundColorTextStyle:this.state.primaryBackgroundColorStyle):this.props.defaultTheme&&e.push(this._themeStyles.primaryTextColorStyle),e}_getExtraBackgroundStyle(){if(this.props.isSelected){const e=a.Styles.createViewStyle({backgroundColor:this.state.selectedColor},!1);return this.props.highContrastTheme?this._themeStyles.primaryViewColorStyle:e}if(this.state.isHoveringOn)return C.imageHoverBackground}_getExtraBorderStyle(){if(this.props.isSelected){const e=a.Styles.createImageStyle({borderColor:this.state.selectedColor},!1);return this.props.highContrastTheme?this._themeStyles.primaryViewColorStyle:e}if(this.state.isHoveringOn)return C.imageHoverBorder}}t.default=m},29311:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(16778),o=i(88837),s=i(11930),r=i(47126),l=i(15877),c=i(33754),d=i(6250),u=i(63520),h=(0,l.lazyProperties)({scrollView:()=>n.Styles.createScrollViewStyle({flex:1})}),p="source";class g extends o.ComponentBase{constructor(){super(...arguments),this._mountedItemRefsMap=new d.default,this._onKeyPress=e=>{let t=this.state.focusedIndex;e.keyCode!==r.default.UP&&e.keyCode!==r.default.LEFT||(t-=1),e.keyCode!==r.default.DOWN&&e.keyCode!==r.default.RIGHT||(t+=1),t<0||t>=this.props.backgroundsList.length||this.isComponentMounted()&&this.setState({focusedIndex:t})}}_buildState(e,t){return{focusedIndex:t?0:this.state.focusedIndex}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.state.focusedIndex!==t.focusedIndex&&this._focusItem(this.state.focusedIndex)}render(){return n.createElement(n.ScrollView,{style:h.scrollView,onKeyPress:this._onKeyPress,showsVerticalScrollIndicator:!1},n.createElement(n.View,{style:this.props.style},this._getAvailableBackgrounds()))}_focusItem(e=0){if(e<0||e>=this.props.backgroundsList.length)return;const t=this._mountedItemRefsMap.ref(p+e);null==t||t.requestFocus()}_getAvailableBackgrounds(){return a.map(this.props.backgroundsList,((e,t)=>{const i=!!this.props.selectedBackground&&e.sceneId===this.props.selectedBackground.sceneId,a=e.sceneId,o=e.label;let r=c.getString("TogetherModeModal.BackgroundAccessibilityLabel",{name:o,currentItemIndex:t+1,numberOfItems:this.props.backgroundsList.length});return i&&(r=s.default.combinedAccessibilityLabel(r,c.getString("Global.SelectedAccessibilityLabel"))||""),n.createElement(u.default,{ref:this._mountedItemRefsMap.onComponentRef(p+t),tabIndex:this.state.focusedIndex===t?0:-1,key:a,backgroundDetails:e,onSelected:this.props.onItemSelected,isSelected:i,width:this.props.itemWidth-8,height:this.props.itemHeight,borderWidth:4,onDoubleTap:this.props.onItemDoubleTap,accessibilityLabel:r,highContrastTheme:this.props.highContrastTheme,stackNavigation:this.props.stackNavigation,defaultTheme:this.props.defaultTheme})}))}}t.default=g},16383:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(89391),o=i(94224),s=i(98925),r=i(98278),l=i(39549),c=i(52262),d=i(46096),u=i(13944),h=i(10117),p=i(5581),g=i(36237),C=i(15877),m=i(33754),S=i(46929),y=i(4735),f=i(30124),_=i(29130),b=i(14976),T=i(22222),v=i(81760),w=i(11828),I=i(59433),P=i(80837),M=i(19675),k=i(24576),A=i(13084),R=i(53374),V=(0,C.lazyProperties)({container:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",borderTopWidth:1,borderStyle:"solid",backgroundColor:v.Color.whiteOverlay20,justifyContent:"flex-start",alignItems:"center"}),textContent:()=>a.Styles.createTextStyle({flexShrink:1,paddingLeft:10,paddingRight:45,marginVertical:8}),textContentContainer:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",flexWrap:"wrap",alignItems:"center"}),textContentContainerMobile:()=>a.Styles.createTextStyle({flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start"}),textContentContainerDeprecateDesktop:()=>a.Styles.createTextStyle({flexWrap:"nowrap"}),textContentDeprecationDesktop:()=>a.Styles.createTextStyle({flexShrink:1,flex:1}),textStyleMobile:()=>a.Styles.createTextStyle({fontSize:12}),buttonsContainer:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",marginVertical:8,alignSelf:"center"}),buttonsContainerMobile:()=>a.Styles.createViewStyle({alignSelf:"flex-start"}),iconStyle:()=>a.Styles.createViewStyle({marginVertical:10,marginLeft:20}),closeIconStyle:()=>a.Styles.createViewStyle({marginVertical:10,marginRight:20}),actionButton:()=>a.Styles.createViewStyle({marginHorizontal:10})});class L extends k.default{constructor(){super(...arguments),this._onAcceptRequestPress=()=>{A.default.acceptTranslation(this.props.conversationId,this.state.spokenLanguageLocale)},this._onDeclineRequestPress=()=>{A.default.declineTranslationRequest(this.props.conversationId,this.state.spokenLanguageLocale)},this._onDeprecationAcceptPress=()=>{const e=R.default.newCauseId(),t=this.state.remoteUser.getMri();t?(A.default.requestTranslation(t,this.state.spokenLanguageLocale),y.default.navigateToConversation({convId:t,causeId:e,origin:d.NavigationConversationOrigin.EngagementNotice})):g.log(d.LogTraceArea.Calling,"TranslationConversationBanner._onDeprecationAcceptPress conversationId: "+b.mriOrId(this.props.conversationId)+" causeId: "+e)},this._onLearnMoreLinkPress=e=>{a.Linking.openUrl(n.default.getConfigSettingsNoSubscription().translator.learnMoreUrl)},this._onDismiss=e=>{e.stopPropagation(),this.state.translationState===s.TranslationState.Pending?A.default.declineTranslationRequest(this.props.conversationId,this.state.spokenLanguageLocale):this.state.translationState!==s.TranslationState.Requested&&this.state.translationState!==s.TranslationState.Enabled||S.default.setConversationTranslationBannerDismissState(this.props.conversationId,!0)},this._onSpokenLanguageLinkPress=e=>{e.preventDefault(),o.default.CallNavigationHelper.navigateToTranslationSettingsPanel(!1,this._getRootViewId())}}_buildState(e,t){const i=(0,l.default)().getConversation(e.conversationId),a=n.default.getS4LCMCFeatures().translatorAgentId;let o=e.conversationId;return i&&e.isDeprecated&&a&&(o=i.getMemberMrisWithoutMe().filter((e=>e!==a))[0]||o),{isDismissed:S.default.getConversationTranslationBannerDismissState(e.conversationId),isUsingStackNavigationContext:f.default.isUsingStackNavigationContextNoSubscription(),translationState:p.default.getConversationTranslationState(e.conversationId)||s.TranslationState.Disabled,spokenLanguageLocale:p.default.getLocalCallTranslatorBotSpokenLanguageLocale(),isDeviceLanguageSupported:p.default.isDeviceLanguageSupportedForTranslation(),remoteUser:c.default.getDisplayableProfile(o),isSmallScreen:_.default.isWidthSmallerThanThreshold(1024,this._getRootViewId())}}render(){if(this.state.isDismissed||this.state.translationState===s.TranslationState.Disabled&&!this.props.isDeprecated)return null;if(this.state.isDeviceLanguageSupported&&this.state.translationState===s.TranslationState.Enabled)return null;const e=a.createElement(u.default,{style:V.closeIconStyle,hoverColor:this._getIconColor(),color:this._getIconColor(),onPress:this._onDismiss,title:m.getString("Global.CloseButtonTitle"),size:w.IconSize.size24,icon:w.SkypeIcon.Cancel});return a.createElement(a.View,{style:this._getContainerStyles()},this._renderTranslationIcon(),a.createElement(a.View,{style:this._getTextContentContainerStyle()},a.createElement(M.BodyText,{style:this._getTextStyles()},this._getText()),this._renderOptionalActionButtons()),e)}_renderOptionalActionButtons(){const{translationState:e,remoteUser:t}=this.state;return e===s.TranslationState.Pending?a.createElement(a.View,{style:this._getButtonContainerStyle()},a.createElement(T.default,{style:V.actionButton,buttonSize:r.SXButtonSize.Small,buttonStyle:r.SXButtonStyle.ColorFill,title:m.getString("TranslationBanner.AcceptButtonTitle"),onPress:this._onAcceptRequestPress}),a.createElement(T.default,{style:V.actionButton,buttonSize:r.SXButtonSize.Small,buttonStyle:r.SXButtonStyle.LightFill,title:m.getString("TranslationBanner.DeclineButtonTitle"),onPress:this._onDeclineRequestPress})):this.props.isDeprecated?a.createElement(a.View,{style:this._getButtonContainerStyle()},a.createElement(T.default,{style:V.actionButton,buttonSize:r.SXButtonSize.Small,buttonStyle:r.SXButtonStyle.ColorFill,title:m.getString("TranslationBanner.TryNewTranslationsButtonV2",{userName:t.getShortName()}),onPress:this._onDeprecationAcceptPress})):void 0}_getButtonContainerStyle(){return[V.buttonsContainer,void 0,this.props.isDeprecated?P.default.flexZero:void 0]}_getTextContentContainerStyle(){return[V.textContentContainer,void 0,this._isDeprecatedOnWideScreen()?V.textContentContainerDeprecateDesktop:void 0]}_getContainerStyles(){let e=[V.container,this._themeStyles.headerShadowBorderColorStyle];return this._useAccessibleTheme()&&e.push(this._themeStyles.primaryBackgroundColorStyle),e}_renderTranslationIcon(){return a.createElement(h.IconView,{style:V.iconStyle,icon:w.SkypeIcon.SkypeTranslator,color:this._themeColors.primaryIconColor,size:w.IconSize.size24})}_getIconColor(){return this._themeColors.primaryTextColor}_getText(){return this.state.translationState===s.TranslationState.Requested?m.getString("TranslationBanner.RequestSentText",{userName:this.props.conversationName}):this.state.translationState===s.TranslationState.Pending?m.getParts("TranslationBanner.RequestReceivedTextv2",{userName:this.props.conversationName,learnMoreLink:this._getLearnMoreLink()}):this.props.isDeprecated?m.getParts("TranslationBanner.OldBotDeprecationTextV2",{date:this.props.translatorBotDeprecationDate||""}):this.state.isDeviceLanguageSupported||this.state.translationState!==s.TranslationState.Enabled?void 0:m.getParts("UserSettingsPanel.TranslateMessagesAndCallsAppLanguageNotSupportedExplanation",{spokenLanguageLink:this._getLanguageSettingsLink()})}_getLearnMoreLink(){return a.createElement(I.default,{url:"#",key:"keyLearnMore",blue:!0,onPress:this._onLearnMoreLinkPress},m.getString("UserSettingsPanel.TranslationCELAStatementLearnMore"))}_getTextStyles(){return[V.textContent,this._themeStyles.primaryTextColorStyle,void 0,this._isDeprecatedOnWideScreen()?V.textContentDeprecationDesktop:void 0]}_isDeprecatedOnWideScreen(){return!!this.props.isDeprecated&&!this.state.isSmallScreen}_getLanguageSettingsLink(){return a.createElement(I.default,{url:"#",key:"keySpokenLanguage",blue:!0,onPress:this._onSpokenLanguageLinkPress},m.getString("UserSettingsPanel.TranslateMessagesAndCallsAppLanguageNotSupportedSelectLinkText"))}}t.default=L},37191:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(88837),o=i(89391),s=i(10117),r=i(15877),l=i(33754),c=i(46929),d=i(81760),u=i(11010),h=i(11828),p=i(59433),g=i(19675),C=(0,r.lazyProperties)({contentContainer:()=>a.Styles.createButtonStyle({flex:1,flexDirection:"row",alignItems:"center",marginVertical:10}),textContentContainer:()=>a.Styles.createViewStyle({flex:1,alignSelf:"center"}),textContent:()=>a.Styles.createTextStyle({paddingLeft:10,paddingRight:15,flexWrap:"wrap",flex:1}),textContentMobile:()=>a.Styles.createTextStyle({fontSize:u.default.controlFontSize.caption}),container:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"flex-start"}),dismissButtonDesktop:()=>a.Styles.createViewStyle({margin:10}),dismissButtonMobile:()=>a.Styles.createViewStyle({marginTop:10}),translationIconDesktop:()=>a.Styles.createViewStyle({marginLeft:15})});class m extends n.ComponentBase{constructor(){super(...arguments),this._onDismiss=()=>{this.props.onDismiss&&this.props.onDismiss(),c.default.setInCallTranslationBannerDismissState(this.props.conversationMri,!0)},this._onLearnMoreLinkPress=e=>{a.Linking.openUrl(o.default.getConfigSettingsNoSubscription().translator.learnMoreUrl)}}render(){return a.createElement(a.View,{style:[this.props.containerStyle,C.container]},a.createElement(a.View,{style:C.contentContainer},this._renderTranslationIcon(),this._renderTextContent()),this._renderDismissButton())}_renderTranslationIcon(){var e,t;return a.createElement(s.default,{key:"translationIcon",style:C.translationIconDesktop,icon:h.SkypeIcon.SkypeTranslator,color:null!==(e=this.props.iconColor)&&void 0!==e?e:d.Color.white,size:null!==(t=this.props.iconSize)&&void 0!==t?t:h.IconSize.size16})}_renderTextContent(){const e=l.getParts("TranslationBanner.TranslatedConversationInCallText",{learnMore:this._getLearnMoreLink()});return a.createElement(a.View,{key:"textContentContainer",style:C.textContentContainer},a.createElement(g.BodyText,{style:this._getTextStyles()},e))}_renderDismissButton(){var e,t;return a.createElement(s.default,{key:"dismissButton",style:C.dismissButtonDesktop,color:null!==(e=this.props.iconColor)&&void 0!==e?e:d.Color.white,onPress:this._onDismiss,size:null!==(t=this.props.iconSize)&&void 0!==t?t:h.IconSize.size24,icon:h.SkypeIcon.Cancel})}_getLearnMoreLink(){return a.createElement(p.default,{key:"learnMoreLink",style:this.props.linkStyle,url:"#",blue:!0,onPress:this._onLearnMoreLinkPress},l.getString("TranslationBanner.TranslatedConversationInCallLearnMoreLink"))}_getTextStyles(){return[this.props.textStyle,C.textContent]}}t.default=m},88154:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(89391),o=i(24576),s=i(47204),r=i(33754),l=i(46096),c=i(11828),d=i(71830),u=i(82261),h=i(85207),p=i(2278),g=i(80200),C=i(60787),m=i(13912),S="ShareQRPopup";class y extends o.default{constructor(){super(...arguments),this._onShareQRButtonPress=e=>{p.default.onShowShareTwinCamConnection(this.props.callId);if(n.default.getS4LCMCFeaturesNoSubscription().twinCamOneOnOneForceUpdateEnabled&&d.isOneOnOneConversation(this.props.conversationMri)){const e=u.createDataMessage(this.props.conversationMri,l.PostSource.Logs);e&&h.default.postMessage(e)}s.default.showPopup({getAnchor:this._getShareQRButtonRef,rootViewId:this._getRootViewId(),renderPopup:this._renderShareTwinCamQRContent,preventDismissOnPress:!1,positionPriorities:["top","right"]},S)},this._renderShareTwinCamQRContent=()=>{const{callId:e,conversationMri:t}=this.props;return a.createElement(m.default,{callId:e,conversationMri:t,leftOffset:this.props.isShowingRecents?100:0,onStopTwinCamPressed:this.props.onStopTwinCamPressed,isPopup:!0})},this._setShareQRButtonRef=e=>{this._shareTwinCamQRButtonRef=e},this._getShareQRButtonRef=()=>this._shareTwinCamQRButtonRef}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),e.isTwinCamConnected!==this.props.isTwinCamConnected&&s.default.dismissPopup(S,this._getRootViewId())}render(){const{colorConfig:e,caption:t,callButtonSize:i,isDisabled:n,title:o,showToolTip:s,toolTipConfig:l,isTwinCamConnected:d}=this.props,u=c.SkypeIcon.TwinCamMidOffGradient;return d&&e&&(e.hoverIcon=void 0),a.createElement(C.default,{key:g.CallControlsKeys.TwinCam,icon:d?u:c.SkypeIcon.TwinCamMid,accessibilityLabel:r.getString("CallControlsOverFlowMenu.TwinCam"),size:i,colorConfig:e,isDisabled:n,onPress:this._onShareQRButtonPress,caption:t,ref:this._setShareQRButtonRef,isToggledOn:d,title:o,showToolTip:s,toolTipConfig:l})}}t.default=y},13912:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(17673),n=i(16778),o=i(26601),s=i(44770),r=i(94224),l=i(57538),c=i(22222),d=i(59433),u=i(19675),h=i(80837),p=i(24576),g=i(89391),C=i(33754),m=i(98278),S=i(81760),y=i(15877),f=i(11828),_=i(10117),b=i(63841),T=(0,y.lazyProperties)({twinCam:()=>n.Styles.createViewStyle({flexDirection:"column",alignItems:"center",flex:1,padding:20}),header:()=>n.Styles.createViewStyle({paddingHorizontal:10,backgroundColor:S.Color.darkThemeBackground}),twinCamViewContent:()=>n.Styles.createViewStyle({flexDirection:"column",alignItems:"center",flex:1}),twinCamPopup:()=>n.Styles.createViewStyle({borderRadius:8,shadowColor:S.Color.blackOverlay40,shadowOffset:{width:0,height:2},shadowOpacity:.8,shadowRadius:10,width:320,marginBottom:20,backgroundColor:S.Color.darkThemeBackground}),darkAccessibleTwinCamBorder:()=>n.Styles.createViewStyle({borderWidth:1,borderColor:S.Color.white}),twinCamText:()=>n.Styles.createTextStyle({color:S.Color.white,textAlign:"center",fontSize:l.MeetNowFontSize.lobbySubtitleMedium}),twinCamHeaderText:()=>n.Styles.createTextStyle({color:S.Color.white}),twinCamTextPadding:()=>n.Styles.createTextStyle({color:S.Color.white,textAlign:"center",marginBottom:20,marginTop:14,fontSize:l.MeetNowFontSize.lobbySubtitleSmall}),twinCamTitle:()=>n.Styles.createTextStyle({color:S.Color.white,marginBottom:20,textAlign:"center",fontSize:l.MeetNowFontSize.lobbyTitleMedium}),twinCamCode:()=>n.Styles.createTextStyle({color:S.Color.white,marginBottom:20,textAlign:"center",fontSize:l.MeetNowFontSize.lobbySubtitleMedium}),qrBgPortrait:()=>n.Styles.createViewStyle({width:208,height:208,padding:10,borderRadius:10,backgroundColor:S.Color.white,marginBottom:20,marginTop:20}),titleTwinCamArea:()=>n.Styles.createViewStyle({width:115,marginBottom:10,marginTop:5,flexDirection:"row"}),titleTwinCamText:()=>n.Styles.createTextStyle({color:S.Color.white,fontSize:l.MeetNowFontSize.lobbyTextInput,marginLeft:10})});class v extends p.default{constructor(){super(...arguments),this._onLearnMoreLinkPress=e=>{n.Linking.openUrl(g.default.getConfigSettingsNoSubscription().twinCam.learnMoreUrl)}}_buildState(e,t){const i=r.default.CallingStore.getConnectedEndpoints(e.callId).length>0,{twinCamEnabled:n}=g.default.getS4LCMCFeatures(),o=r.default.CallingStore.isCallJoinedAsTwinCam(e.callId);return{isTwinCamConnected:n&&i&&!o,joinLink:"skype:?call&"+a.stringify({twincam:!0,threadId:e.conversationMri,callId:e.callId})}}_getLearnMoreLink(){return n.createElement(d.default,{url:"#",key:"keyLearnMore",white:this._useDarkTheme(),textThemeColor:m.TextThemeColor.Secondary,underline:!0,onPress:this._onLearnMoreLinkPress},C.getString("CallControlsOverFlowMenu.TwinCamHowToConnect"))}_getIconColor(){return this._useDarkTheme()?S.Color.white:S.Color.black}render(){const e=this._useDarkTheme(),t=this._useAccessibleTheme(),i=e||t?l.MeetNowStyle.getStyle(t,e):l.MeetNowStyle.getThemeStyle(b.Theme.Delphi),a=[T.twinCam,this.props.leftOffset?n.Styles.createViewStyle({left:this.props.leftOffset},!1):void 0,this.props.isPopup?T.twinCamPopup:void 0,e?void 0:i.background],r={backgroundColor:this._themeColors.primaryBackgroundColor,textColor:this._themeColors.primaryTextColor},d=e?void 0:n.Styles.createTextStyle({color:r.textColor},!0);t&&e&&a.push(T.darkAccessibleTwinCamBorder);const p=s.Collection.SKYPE_LOGO,g=this.state.isTwinCamConnected?n.createElement(u.BodyText,{style:[T.twinCamCode,d]},C.getString("CallControlsOverFlowMenu.TwinCamConnected")):n.createElement(n.View,{style:T.twinCamViewContent},n.createElement(n.View,{style:T.titleTwinCamArea},n.createElement(_.IconView,{key:"iconTwinCam",size:24,color:this._getIconColor(),icon:f.SkypeIcon.TwinCamMid}),n.createElement(u.BodyText,{style:[T.titleTwinCamText,d]},C.getString("CallControlsOverFlowMenu.TwinCam"))),n.createElement(u.Subtitle,{style:[T.twinCamTitle,d]},C.getString("CallControlsOverFlowMenu.TwinCamShareVideo")),n.createElement(n.View,{style:T.qrBgPortrait},n.createElement(o.default,{message:this.state.joinLink,correctionLevel:"Q",style:h.default.flexOne,color:S.Color.black,backgroundColor:S.Color.white,iconSrc:p,iconHeight:50,iconWidth:50,iconExcavate:!0,size:188})),n.createElement(u.BodyText,{style:[T.twinCamText,d]},C.getString("CallControlsOverFlowMenu.TwinCamJoinCode")),n.createElement(u.BodyText,{style:[T.twinCamTextPadding,d]},this._getLearnMoreLink()));return n.createElement(n.View,{style:a,tabIndex:-1,accessibilityLabel:C.getString("MeetNowCallControls.TwinCam")},g,this.state.isTwinCamConnected&&n.createElement(c.default,{buttonStyle:m.SXButtonStyle.DarkFill,buttonSize:m.SXButtonSize.Medium,title:C.getString("CallControlsOverFlowMenu.StopTwinCam"),allowTextWrap:!0,onPress:this.props.onStopTwinCamPressed}))}}t.default=v},21045:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.dismiss=t.show=void 0;const a=i(96486),n=i(31844),o=i(16778),s=i(34339),r=i(60),l=i(89391),c=i(62033),d=i(96074),u=i(28664),h=i(94224),p=i(98925),g=i(47447),C=i(71830),m=i(47204),S=i(98278),y=i(984),f=i(39549),_=i(57139),b=i(4336),T=i(37490),v=i(52262),w=i(4604),I=i(46096),P=i(11375),M=i(36400),k=i(10117),A=i(97174),R=i(36237),V=i(15340),L=i(72490),E=i(15877),B=i(18460),O=i(41209),D=i(33754),x=i(54757),N=i(70665),U=i(30124),F=i(64956),H=i(27333),z=i(85207),G=i(95697),W=i(29130),K=i(14976),j=i(15963),Q=i(10265),$=i(90631),q=i(22222),X=i(81760),Z=i(11828),J=i(78262),Y=i(80837),ee=i(19675),te=i(76543),ie=i(54298),ae=i(72758),ne=i(53374),oe=(0,E.lazyProperties)({dialog:()=>o.Styles.createViewStyle({flex:1,alignItems:"stretch",justifyContent:"center"}),innerContainer:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center",padding:20}),title:()=>o.Styles.createTextStyle({marginTop:25,marginBottom:20,textAlign:"center",backgroundColor:X.Color.transparent}),sectionTitle:()=>o.Styles.createViewStyle({flex:1,alignItems:"stretch",alignSelf:"stretch",justifyContent:"center",flexDirection:"row"}),sectionTitleText:()=>o.Styles.createTextStyle({paddingHorizontal:10}),message:()=>o.Styles.createTextStyle({marginTop:10,marginBottom:20,textAlign:"center",backgroundColor:X.Color.transparent}),centeredText:()=>o.Styles.createTextStyle({textAlign:"center",backgroundColor:X.Color.transparent}),permissionsText:()=>o.Styles.createTextStyle({paddingBottom:20}),permissions:()=>o.Styles.createViewStyle({alignSelf:"stretch"}),primaryButton:()=>o.Styles.createButtonStyle({marginHorizontal:20,alignSelf:"stretch"}),messageComposerContainer:()=>o.Styles.createViewStyle({alignSelf:"stretch",justifyContent:"center",marginTop:20,marginHorizontal:20}),actionContainer:()=>o.Styles.createViewStyle({alignSelf:"stretch",alignItems:"center",marginBottom:20}),feedbackButton:()=>o.Styles.createButtonStyle({marginTop:20})});function se(e,t,i){R.log(I.LogTraceArea.UnansweredCall,"dismiss causeId: "+i),N.unregisterModalDialogDismissalException(e),m.default.dismissModal(e,t)}t.show=function(e,t,i,a){R.log(I.LogTraceArea.UnansweredCall,"show causeId: "+a);const n=o.createElement(re,{modalId:t,callId:e.originalCallId,conversationMri:e.originalConversationMri,unansweredCallOutput:e});return N.registerModalDialogDismissalException(t),m.default.showModal(n,t,i),e=>se(e,i.rootViewId,a)},t.dismiss=se;class re extends d.default{constructor(){super(...arguments),this._renderAction=(e,t)=>{switch(e.action){case p.UnansweredCallAction.SendMessage:if(C.isPhoneMri(this.props.conversationMri)||this.state.oneToOneConversationUnaccepted)return;const i=e.message&&0===t?o.createElement(ee.BodyText,{bold:!0,style:oe.centeredText},e.message):void 0;return o.createElement(o.View,{key:"composer"+t,style:oe.actionContainer},i,this._renderMessageComposer(e.prepopulatedMessage));case p.UnansweredCallAction.PromptForPermission:let a;this.props.unansweredCallOutput.reason===p.UnansweredCallReason.MicAndCamPermissionDenied?a=F.default.getDeniedPrompt(J.PermissionType.MicrophoneAndCamera):this.props.unansweredCallOutput.reason===p.UnansweredCallReason.CameraPermissionDenied?a=F.default.getDeniedPrompt(J.PermissionType.Camera):this.props.unansweredCallOutput.reason===p.UnansweredCallReason.MicrophonePermissionDenied&&(a=F.default.getDeniedPrompt(J.PermissionType.Microphone));const n=a?o.createElement(ee.BodyText,{bold:!0,style:[oe.centeredText,oe.permissionsText]},a):void 0,s=g.UICapabilities.systemSettingsDeepLinkSupported()?o.createElement(q.default,{style:oe.primaryButton,buttonStyle:S.SXButtonStyle.BlueFill,onPress:this._onPermissionSettingsPress,title:D.getString("UnansweredCallActions.Settings")}):void 0;return o.createElement(o.View,{key:"permissions"+t,style:oe.permissions},n,s);case p.UnansweredCallAction.SendFeedback:return o.createElement(M.HoverableButton,{key:"sendfeedbackbutton"+t,onPress:this._onSendFeedbackPress,style:oe.feedbackButton},o.createElement(ee.BodyText,{key:"sendfeedbacktext"+t,bold:!0,style:oe.centeredText,textThemeColor:ee.TextThemeColor.Secondary},e.message));case p.UnansweredCallAction.CallPSTN:return this._renderCallButtons();case p.UnansweredCallAction.ShowRegulatoryInfoIndia||p.UnansweredCallAction.ShowRegulatoryInfoNetherlands:return this._renderRegulatoryInfoButton(e.action)}},this._onTitleOrMessageRef=e=>{this._titleOrMessageRef=e||void 0},this._onPermissionSettingsPress=()=>{o.Linking.openUrl("app-settings:")},this._onCallButtonPressed=e=>{const t=ne.default.newCauseId();R.log(I.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onCallButtonPressed mri: "+K.mriOrId(e)+" causeId: "+t),te.default.reportUnansweredCallActionTaken(this.props.callId,this.props.unansweredCallOutput.reason,p.UnansweredCallAction.CallPSTN,t),this._closeDialog(this._getRootViewId(),t),R.track(new ie.UnansweredCallCTA("cta_clicked")),h.default.CallNavigationHelper.startCall({conversationMri:e,withVideo:!1,origin:I.NavigationCallOrigin.UnansweredCallPanel},t)},this._onMessageSent=e=>{const t=ne.default.newCauseId();return R.log(I.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onMessageSent causeId: "+t),z.default.postMessageFromInput(this.props.conversationMri,I.PostSource.UnansweredCallPanel,e,void 0,{name:j.ScenarioName.SendTextMessage}),te.default.reportUnansweredCallActionTaken(this.props.callId,this.props.unansweredCallOutput.reason,p.UnansweredCallAction.SendMessage,t),this._closeDialog(this._getRootViewId(),t),!0},this._onSendFeedbackPress=e=>{const t=ne.default.newCauseId();R.log(I.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onSendFeedbackPress causeId: "+t),e.stopPropagation(),G.default.reportProblem(!0,this._getRootViewId()),te.default.reportUnansweredCallActionTaken(this.props.callId,this.props.unansweredCallOutput.reason,p.UnansweredCallAction.SendFeedback,t),this._closeDialog(this._getRootViewId(),t)},this._onClickOutside=()=>{const e=ne.default.newCauseId();R.log(I.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onClickOutside causeId: "+e),this._reportCancel(e)},this._onCancelPress=()=>{const e=ne.default.newCauseId();R.log(I.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onCancelPress causeId: "+e),this._reportCancel(e),this._closeDialog(this._getRootViewId(),e)},this._onBack=()=>{const e=ne.default.newCauseId();return R.log(I.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onBack causeId: "+e),this._reportCancel(e),this._closeDialog(this._getRootViewId(),e),R.log(I.LogTraceArea.HardwareBackButton,"goBack: true componentId: UnansweredCallPanel"),!0},this._onEscape=()=>{const e=ne.default.newCauseId();return R.log(I.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onEscape causeId: "+e),this._reportCancel(e),this._closeDialog(this._getRootViewId(),e),!0},this._onAppStateChange=e=>{if(e===o.Types.AppActivationState.Background){const e=ne.default.newCauseId();R.log(I.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onAppStateChange causeId: "+e),this._reportCancel(e),this._closeDialog(this._getRootViewId(),e)}},this._closeDialog=(e,t)=>{R.log(I.LogTraceArea.UnansweredCall,"UnansweredCallPanel._closeDialog causeId: "+t),se(this.props.modalId,e,t)},this._onPhoneActionsMenuClose=e=>{R.log(I.LogTraceArea.UnansweredCall,"_onPhoneActionsMenuClose causeId: "+e),_.default.close(this._getRootViewId(),e)},this._onTrySkypeToPhoneButtonRef=e=>{this._trySkypeToPhoneButtonRef=e||void 0}}_buildState(e,t){const i=this._getRootViewId(),a=C.isOneOnOneConversation(e.conversationMri);let o;if(a){const t=(0,f.default)().getConversation(e.conversationMri);t?o=t.getOtherPartyMri():C.isSkypeIdMri(e.conversationMri)&&(o=e.conversationMri)}return{isLandscape:W.default.getDeviceOrientation(i)===n.DeviceOrientation.Landscape,isMobileScreenSize:W.default.isMobileScreenSize(i),title:e.unansweredCallOutput.title,oneToOneConversationUnaccepted:a&&!y.default.isConversationAccepted(e.conversationMri),displayName:v.default.getShortDisplayName(e.conversationMri)||D.getString("UnansweredCallTitle.UnknownCallee"),fullName:v.default.getDisplayName(e.conversationMri)||D.getString("UnansweredCallTitle.UnknownCallee"),isOneOnOne:a,localAddressBookContact:B.default.getContactByCorrespondingMri(e.conversationMri),userPhones:o?ae.default.getFullUserProfileByMri(o).phones:[],callActionUcuxEnabled:l.default.getS4LEntitlementFeatures().SCE.UserServices.Client.Features.NewUcuxCallActionEnabled,hasEntitlements:w.default.userHasActiveEntitlements()}}componentDidMount(){super.componentDidMount();const e=ne.default.newCauseId();R.log(I.LogTraceArea.UnansweredCall,"componentDidMount causeId: "+e),this._titleOrMessageRef&&this._titleOrMessageRef.requestFocus(),T.dismissAll(),c.default.subscribe(this._onBack),L.default.addEscapeHandler(this._onEscape),this._activationSubToken=r.default.subscribeForChanges("UnansweredCallPanel",this._onAppStateChange)}componentWillUnmount(){super.componentWillUnmount();const e=ne.default.newCauseId();R.log(I.LogTraceArea.UnansweredCall,"componentWillUnmount causeId: "+e),c.default.unsubscribe(this._onBack),L.default.removeEscapeHandler(this._onEscape),this._reportCancel(e),this._activationSubToken&&(this._activationSubToken.unsubscribe(),this._activationSubToken=void 0),P.setFocusWithDelay(P.FocusEvent.CloseUnansweredCallPanel,500)}render(){return o.createElement(Q.default,{dialogId:this.props.modalId,containerStyle:this._themeStyles.primaryBackgroundColorStyle,closeOnClickOutside:!0,maxWidth:this.state.isMobileScreenSize?void 0:b.CompactWidth,fullScreen:this.state.isMobileScreenSize,useFullSizeContainer:!0,accessibilityLabel:this.state.title||this.props.unansweredCallOutput.optionalSecondaryMessage||"",onClickOutside:this._onClickOutside},o.createElement(V.default,{style:[oe.dialog,this._themeStyles.primaryBackgroundColorStyle]},this._content()))}_renderMessageComposer(e){let t=[];return e&&(t=t.concat(new A.UnhandledEntity(e))),o.createElement(o.View,{key:"composer",style:[oe.messageComposerContainer]},o.createElement(x.default,{conversationId:this.props.conversationMri,otherPartyMri:void 0,hideMediaBar:!0,disableCopyPasteMedia:!0,hideEmoticonKeyboardIcon:!0,hideMediaPickerIcon:!0,hideMojiPickerIcon:!0,hideStickerPickerIcon:!0,hideLocationPickerIcon:!0,hideContactPickerIcon:!0,hideOverflowMenu:!0,hideSmsIcon:!0,hideAudioMessage:!0,shouldAutoFocus:!!e,showSendControlWhenEmpty:!0,initialInputEntities:t,onMessageSent:this._onMessageSent}))}_renderRegulatoryInfoButton(e){let t="",i="";const n=l.default.getConfigSettingsNoSubscription().pstn;if(e===p.UnansweredCallAction.ShowRegulatoryInfoIndia?(t=n.indiaRegulatoryFaq,i=D.getString("PstnUtils.BlockedRegulatoryIndiaButton")):e===p.UnansweredCallAction.ShowRegulatoryInfoNetherlands&&(t=n.netherlandsRegulatoryFaq,i=D.getString("PstnUtils.BlockedRegulatoryNetherlandsButton")),!a.isEmpty(t)&&!a.isEmpty(i))return o.createElement(o.View,{key:"regulatoryButton",style:oe.actionContainer},o.createElement(q.default,{title:i,onPress:()=>{o.Linking.openUrl(t)},buttonStyle:S.SXButtonStyle.ColorFill,buttonSize:S.SXButtonSize.Medium,autoFocus:!0}));R.warn(I.LogTraceArea.UnansweredCall,`Missing button properties for UnansweredCallAction: ${p.UnansweredCallAction[e]}; url = "${t}", buttonTitle = "${i}"`)}_renderCallButtons(){const e=O.mergeMriProfileAndExtraPhones(this.props.conversationMri,this.state.localAddressBookContact?this.state.localAddressBookContact.phones:void 0,this.state.userPhones);let t,i;if(e&&0!==e.length)return 1===e.length?(t=o.createElement(o.View,{style:oe.sectionTitle},o.createElement(ee.Subtitle,{style:[oe.sectionTitleText,this._themeStyles.primaryTextColorStyle]},D.getString("UnansweredCallActions.TrySkypeToPhoneButton"))),i=this._renderCallButton(e[0].number)):i=this._renderTrySkypeToPhoneButton(e),R.track(new ie.UnansweredCallCTA("cta_shown")),o.createElement(o.View,{key:"placecall",style:oe.actionContainer},t,o.createElement(o.View,{style:oe.messageComposerContainer},i))}_renderCallButton(e){const t=C.sanitizeMri(e,C.Namespaces.PSTN),i=`${D.getString("UnansweredCallActions.CallName",{name:this.state.displayName})} ${e} `;return o.createElement(u.default,{key:"callingbutton_"+e,isUsingStackNav:U.default.isUsingStackNavigationContextNoSubscription(),icon:Z.SkypeIcon.SkypeOut,accessibilityLabel:i,phoneNumber:e,onPress:()=>this._onCallButtonPressed(t)})}_renderTrySkypeToPhoneButton(e){return o.createElement(u.default,{key:"trySkypeToPhoneButton",ref:this._onTrySkypeToPhoneButtonRef,isUsingStackNav:U.default.isUsingStackNavigationContextNoSubscription(),icon:Z.SkypeIcon.SkypeOut,phoneNumber:D.getString("UnansweredCallActions.TrySkypeToPhoneButton"),accessibilityLabel:D.getString("UnansweredCallActions.TrySkypeToPhoneButton"),onPress:()=>this._showPhoneActionsMenu(e)})}_headerCloseButton(){return{closeButtonType:$.CloseButtonType.Close,title:D.getString("Global.CloseButtonTitle"),onPress:this._onCancelPress,color:this._themeColors.primaryIconColor}}_content(){const e=this.state.isMobileScreenSize&&this.state.isLandscape,t=o.createElement($.SimplePanelHeader,{leftButton:this._headerCloseButton(),hideBottomBorder:!0,floating:!0,useTransparentBackground:!0}),i=this.state.title?o.createElement(ee.PanelHeader,{key:"title",ref:this._onTitleOrMessageRef,landscape:e,style:oe.title},this.state.title):void 0,n=this.props.unansweredCallOutput.optionalSecondaryMessage?o.createElement(ee.PanelHeader,{key:"message",ref:i?void 0:this._onTitleOrMessageRef,landscape:e,style:oe.message},this.props.unansweredCallOutput.optionalSecondaryMessage):void 0;let r,l;if(a.some(this.props.unansweredCallOutput.actions,(e=>e.action===p.UnansweredCallAction.CallPSTN))){const e=O.mergeMriProfileAndExtraPhones(this.props.conversationMri,this.state.localAddressBookContact?this.state.localAddressBookContact.phones:void 0,this.state.userPhones),t=!C.isPhoneMri(this.props.conversationMri)&&!this.state.oneToOneConversationUnaccepted&&this.state.isOneOnOne&&e.length>0&&this.state.hasEntitlements;t&&R.track(new ie.UnansweredCallCTA("cta_eligible"));const i=t&&this.state.callActionUcuxEnabled?a.filter(this.props.unansweredCallOutput.actions,(e=>e.action===p.UnansweredCallAction.CallPSTN)):a.filter(this.props.unansweredCallOutput.actions,(e=>e.action===p.UnansweredCallAction.SendMessage));r=a.map(i,this._renderAction)}else r=a.map(this.props.unansweredCallOutput.actions,this._renderAction);if(this.props.unansweredCallOutput.visualInfo)switch(this.props.unansweredCallOutput.visualInfo.type){case p.UnansweredCallVisualInfoType.Emoticon:l=o.createElement(s.AnimatedEmoticon,{size:s.Size.ExtraLarge,emoticonName:this.props.unansweredCallOutput.visualInfo.name,standaloneAnimation:!0});break;case p.UnansweredCallVisualInfoType.Icon:l=o.createElement(k.default,{icon:this.props.unansweredCallOutput.visualInfo.name,size:Z.IconSize.size80,color:X.Color.gray300})}return o.createElement(o.View,{style:Y.default.flexOne},o.createElement(o.View,{key:"innercontainer",style:oe.innerContainer},l,i,n,r),t)}_reportCancel(e){R.log(I.LogTraceArea.UnansweredCall,"UnansweredCallPanel._reportCancel causeId: "+e),te.default.reportUnansweredCallActionTaken(this.props.callId,this.props.unansweredCallOutput.reason,p.UnansweredCallAction.None,e)}_showPhoneActionsMenu(e){const t=a.map(e,(e=>{const t=C.sanitizeMri(e.number,C.Namespaces.PSTN);return{props:{key:"pstnButton"+e.number+e.type,phone:e,keepSpaceForSubtitle:!0,onPress:()=>this._onCallButtonPressed(t)},builder:H.default.buildRow}}));_.default.showWithBuilders({builders:t,anchor:()=>this._trySkypeToPhoneButtonRef,getTitle:()=>this.state.fullName,onCloseMenu:this._onPhoneActionsMenuClose,rootViewId:this._getRootViewId()})}}t.default=re},1494:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(94224),o=i(9520),s=i(2278),r=i(24506),l=i(98278),c=i(85043),d=i(13944),u=i(15877),h=i(33754),p=i(22222),g=i(81760),C=i(11828),m=i(19675),S=i(53374),y=(0,u.lazyProperties)({popupContainer:()=>a.Styles.createViewStyle({width:300,paddingHorizontal:15,borderRadius:5,backgroundColor:g.Color.darkThemeBackgroundOverlay85}),popupContainerLightTheme:()=>a.Styles.createViewStyle({backgroundColor:g.Color.whiteOverlay90}),popupContainerBackground:()=>a.Styles.createViewStyle({backgroundColor:g.Color.darkThemeBackground}),popupTitleRow:()=>a.Styles.createTextStyle({marginTop:15,flexDirection:"row",justifyContent:"space-between"}),backgroundReplacementContainer:()=>a.Styles.createViewStyle({marginBottom:15})});class f extends c.HoverPopup{constructor(){super(...arguments),this._allowHidePopup=()=>this._defaultAllowHidePopupConditions()&&!this.state.isAwaitingConfirmation&&!this.state.shouldShowCloseButton,this._onClosePressed=()=>{this.state.shouldShowCloseButton&&this.setState({shouldShowCloseButton:!1},(()=>{this._isAnchorHovered=!1,this._isAnchorLongPressed=!1,this._isPopupHovered=!1,this._hidePopup(!1)}))},this._onCameraSelected=(e,t)=>{const i=S.default.newCauseId();e&&(n.default.CallControlsStore.setIsAwaitingCameraConfirmation(!0),s.default.updateCallVideoSettingsPopupEvent((e=>{e.markDidChangeCameraDevice()})),n.default.DeviceStore.preselectDevices({camera:t},i))},this._onToggleBlur=e=>{s.default.updateCallVideoSettingsPopupEvent((t=>{e?t.toggleBlurOn():t.toggleBlurOff()}))},this._onBackgroundChangePress=e=>{this.props.onChangeBackgroundPress&&this.props.onChangeBackgroundPress()}}_buildState(e,t){return Object.assign(Object.assign({},super._buildState(e,t)),{isAwaitingConfirmation:n.default.CallControlsStore.isAwaitingCameraConfirmation(),enableBackgroundReplacement:n.default.DeviceStore.isBackgroundReplacementEnabled()})}componentWillUnmount(){super.componentWillUnmount(),this.state.isAwaitingConfirmation&&n.default.CallControlsStore.setIsAwaitingCameraConfirmation(!1),this.onClosed()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),t.isAwaitingConfirmation&&!this.state.isAwaitingConfirmation&&this._hidePopup(!0)}renderContent(){const e={backgroundColor:g.Color.blue,textColor:g.Color.white},t=this.state.enableBackgroundReplacement&&a.createElement(a.View,{style:y.backgroundReplacementContainer},a.createElement(p.default,{buttonSize:l.SXButtonSize.Medium,buttonStyle:l.SXButtonStyle.Custom,title:h.getString("AudioVideoSettings.CameraBackgroundReplacementLabel"),onPress:this._onBackgroundChangePress,buttonConfig:e,autoFocus:!1})),i=this.state.shouldShowCloseButton?a.createElement(d.default,{icon:C.SkypeIcon.ClosePanel,color:this._themeColors.primaryTextColor,hoverColor:this._themeColors.primaryIconColor,size:C.IconSize.size20,onPress:this._onClosePressed,title:h.getString("AudioVideoSettings.VideoSettingsClose")}):void 0;return a.createElement(a.View,{style:[y.popupContainer,this.props.useLightTheme?y.popupContainerLightTheme:void 0,this.props.isOutgoingVideoDisabled?y.popupContainerBackground:void 0]},a.createElement(a.View,{style:y.popupTitleRow},a.createElement(m.Subtitle,null,h.getString("CallControlsOverFlowMenu.AdjustVideoSettings")),i),a.createElement(r.default,{colorThemeOverride:this._currentTheme,hideVideoLabel:!0,labelMaxWidth:166,onCameraSelected:this._onCameraSelected,onToggleBlur:this._onToggleBlur,forceVideoOnClose:!0,forceUpdateDefaultDevice:!1,skipVideoOnClose:this.state.isAwaitingConfirmation,overrideVideoPreviewDimensions:{width:270,height:150},isVideoDisabledDuringScreenSharing:this.props.isVideoDisabledDuringScreenSharing,showNewBackgroundReplacementUI:!1,isOutgoingVideoDisabled:this.props.isOutgoingVideoDisabled}),t)}popupDescription(){return"VideoSettings"}onOpened(e){s.default.setCallVideoSettingsPopupEvent(new o.CallVideoSettingsPopup(this.props.callId,e)),n.default.CallControlsStore.setSettingsPopupVisibility(!0),this.state.shouldShowCloseButton||this.props.isVideoButtonEnabled||this.setState({shouldShowCloseButton:!0})}onClosed(){n.default.CallControlsStore.setSettingsPopupVisibility(!1)}}t.default=f},19504:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(16778),o=i(48540),s=i(89391),r=i(94224),l=i(9520),c=i(2278),d=i(46565),u=i(11009),h=i(77381),p=i(52262),g=i(46096),C=i(45381),m=i(36237),S=i(33754),y=i(78735),f=i(99795);class _ extends h.default{constructor(){super(...arguments),this._toolTipAnimationConfig={duration:250,easing:n.Animated.Easing.OutBack()},this._show=()=>{m.log(g.LogTraceArea.CallingUI,"VideoSuggestionTooltip._show, visible: true"),c.default.setVideoSuggestionTooltipEvent(new l.VideoSuggestionTooltipEvent(this.props.callId)),d.default.setVideoSuggestionTooltipVisibility(this.props.callId,!0)},this._onDismiss=()=>{m.log(g.LogTraceArea.CallingUI,"VideoSuggestionTooltip._onDismiss, visible: false"),c.default.sendVideoSuggestionTooltipEvent(),d.default.setVideoSuggestionTooltipVisibility(this.props.callId,!1)},this._toolTipConfig=()=>{const e=f.default.getTooltipText(this.props.callId);return{getElement:this.props.anchor,positions:[u.PopupAnchorPositon.Top],durationMs:1e4,title:e,anchorAccessibilityLabel:e,instanceId:"videobutton",rootViewId:this._getRootViewId()}},this._onTooltipRef=e=>{this._tooltipRef=e||void 0}}_buildState(e,t){let i,n=!1,l=0;const c=r.default.CallingStore.isProvidingVideo(e.callId),u=d.default.hasVideoSuggestionTooltipBeenSeen(e.callId),h=(y.default.getUserPreferencesLocal().videoSuggestionTooltipInteractionCount||0)<s.default.getS4LCMCFeatures().maximumVideoSuggestionTooltipInteraction;if(!u&&h&&!c){a.each(r.default.CallingStore.getRemoteCallMembers(e.callId),(t=>{l+=1,i=p.default.getDisplayName(t.id);const a=r.default.CallingStore.getRemoteCallMemberMri(e.callId,t);n=n||r.default.RemoteStreamHelper.isStreamAvailable(e.callId,a,o.StreamType.Video)}));const t=1===l&&i?S.getString("CallControls.VideoSuggestionTooltipOneOnOne",{displayName:i}):S.getString("CallControls.VideoSuggestionTooltipGroup");f.default.setTooltipText(e.callId,t)}return{hasBeenSeen:u,isProvidingVideo:c,hasProvidedVideo:this.state&&this.state.hasProvidedVideo||c,hasCallPreviewViewBeenSeen:d.default.hasCallPreviewViewBeenSeen(e.callId),hasCameras:r.default.DeviceStore.hasCameras(),isAnyRemoteVideoAvailable:n,isVisible:d.default.isVideoSuggestionTooltipVisible(e.callId),interactionCountBelowMaximum:h}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=!!this.props.anchor(),n=!!f.default.getTooltipText(this.props.callId);m.log(g.LogTraceArea.CallingUI,`VideoSuggestionTooltip.componentDidUpdate,\n            hasMountedAnchor: ${a},\n            !hasBeenSeen: ${!this.state.hasBeenSeen},\n            !hasProvidedVideo: ${!this.state.hasProvidedVideo},\n            !hasCallPreviewBeenSeen: ${!this.state.hasCallPreviewViewBeenSeen},\n            hasCameras: ${this.state.hasCameras},\n            interactionCountBelowMaximum: ${this.state.interactionCountBelowMaximum},\n            !isProvidingVideo: ${!this.state.isProvidingVideo},\n            isAnyRemoteVideoAvailable: ${this.state.isAnyRemoteVideoAvailable},\n            !isVisible: ${!this.state.isVisible}\n            tooltipExists: ${!!n}`),t.isVisible&&!this.state.isVisible&&this._tooltipRef&&this._tooltipRef.dismiss(!0),a&&!this.state.hasBeenSeen&&!this.state.hasProvidedVideo&&!this.state.hasCallPreviewViewBeenSeen&&this.state.hasCameras&&this.state.interactionCountBelowMaximum&&!this.state.isProvidingVideo&&this.state.isAnyRemoteVideoAvailable&&!this.state.isVisible&&n&&this._show()}render(){return this.state.isVisible?n.createElement(C.default,{ref:this._onTooltipRef,toolTipInfo:this._toolTipConfig(),animationConfig:this._toolTipAnimationConfig,animateDismissal:!0,onDismiss:this._onDismiss,containerOffsetY:7,containerOffsetX:this.props.containerOffsetX}):null}}t.default=_},18967:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(26517),o=i(71727),s=i(15877),r=i(80837),l=i(24576),c=(0,s.lazyProperties)({backgroundImage:()=>a.Styles.createImageStyle({position:"absolute",overflow:"hidden"}),opacityLight:()=>a.Styles.createImageStyle({opacity:.3}),opacityDark:()=>a.Styles.createImageStyle({opacity:.5})});class d extends l.default{constructor(){super(...arguments),this._onLayout=e=>{const t=e.width/1,i=e.height/1,a=[{scale:1}];this.setState({backgroundImageSizeStyle:{width:t,height:i,transform:a}})}}_buildState(e,t){const i={useLightCallingTheme:o.CallUIUtils.useLightTheme()};return t&&(i.imageUri=n.default.getAvailableBackgroundUri()),i}componentWillUnmount(){super.componentWillUnmount(),this.state.imageUri&&n.default.setBackgroundAvailable(this.state.imageUri)}render(){if(!this.state.imageUri)return null;const e=this.state.useLightCallingTheme?c.opacityLight:c.opacityDark;return a.createElement(a.View,{style:r.default.absoluteFill,onLayout:this._onLayout},a.createElement(a.Image,{style:[c.backgroundImage,e,this.state.backgroundImageSizeStyle],resizeMode:"cover",source:this.state.imageUri}))}}t.default=d},38817:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(16778),o=i(89391),s=i(36850),r=i(80200),l=i(71727),c=i(57139),d=i(24907),u=i(15877),h=i(33754),p=i(31844),g=i(30124),C=i(53602),m=i(81760),S=i(11010),y=i(11828),f=i(63841),_=i(53374),b=(0,u.lazyProperties)({container:()=>n.Styles.createViewStyle({alignItems:"flex-end"}),innerContainer:()=>n.Styles.createViewStyle({justifyContent:"flex-end",alignItems:"center",overflow:"visible",flexDirection:"row",width:void 0})});class T extends C.default{constructor(){super(...arguments),this._showMenu=e=>{const t=()=>this._buttonRef,i=this._getRootViewId();c.default.showWithContent({menuId:c.default.menuId(),anchor:t,rootViewId:i,menuHeight:d.default.getLayoutPickerHeight(this.state.availableMenuItems),content:n.createElement(d.default,{anchor:t,rootViewId:i,callId:this.props.callId,conversationMri:this.props.conversationMri,useMobileControls:this.props.useMobileCallControls,isIncomingOrOutGoingRing:this.props.isIncomingOrOutGoingRing,showFullScreenOption:this.state.showFullScreenOptionInRibbonSettings,isInFullscreenMode:e,availableItems:this.state.availableMenuItems}),getTitle:()=>{},onCloseMenu:e=>c.default.close(i,e),onMenuClosed:this._onMenuClosed,colorThemeOverride:f.Theme.ColorfulDark,hidePopupArrow:!0,staticContent:!0,menuWidth:264,borderRadius:8,offset:{x:-r.RibbonSizes.ribbonItemSizeSmall-20,y:0}},_.default.newCauseId()),this.setState({isMenuShown:!0})},this._onMenuClosed=e=>{this.state.availableMenuItems.forEach((e=>{e.markAsSeen&&e.markAsSeen()}))}}_buildState(e,t){const i=o.default.getS4LCMCFeatures().enableFullScreenOnWeb&&!g.default.isUsingSplitViewNoSubscription(),n=l.default.getAvailableMenuItems(e.callId,i,e.useMobileCallControls,e.conversationMri);return Object.assign(Object.assign({},super._buildState(e,t)),{stageMode:s.default.getStageMode(e.callId),showFullScreenOptionInRibbonSettings:i,menuContainsNewItem:a.some(n,(e=>e.isNew)),availableMenuItems:n})}_iconSize(){return y.IconSize.size16}_iconColor(){return m.Color.white}_labelStyle(){return[S.default.fontStyle.bodySmallDeprecated,n.Styles.createTextStyle({color:m.Color.white},!1)]}_containerStyle(){return b.innerContainer}_getMainContainerStyles(){return b.container}_iconBackgroundColor(){return this.props.useHighContrastTheme?this._themeColors.primaryBackgroundColor:m.Color.transparent}_icon(){return l.default.getIconForStageMode(this.state.stageMode,!1)}_label(){return l.default.getStageModeItemTitle(this.state.stageMode,!1)}_tooltip(){return this._intLabel()}_accessibilityLabel(){return this._intLabel()}_shouldRenderRedDot(){return this.state.menuContainsNewItem}_handleOnPress(e){this.state.isMenuShown&&c.default.close(this._getRootViewId(),_.default.newCauseId()),this.state.menuContainsNewItem&&this.setState({menuContainsNewItem:!1}),this.state.showFullScreenOptionInRibbonSettings?p.default.isFullScreenMode(this._getRootViewId()).then((e=>{this._showMenu(e)})):this._showMenu(!1)}_intLabel(){return h.getString("CallPanel.RibbonLayoutAccessibilityLabel")}}t.default=T},86967:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(16778),o=i(89391),s=i(36850),r=i(71727),l=i(57139),c=i(24907),d=i(15877),u=i(33754),h=i(31844),p=i(30124),g=i(81760),C=i(11010),m=i(11828),S=i(63841),y=i(53374),f=i(24576),_=i(36400),b=i(19675),T=i(10117),v=g.Color.gray400,w=(0,d.lazyProperties)({innerContainer:()=>n.Styles.createViewStyle({justifyContent:"flex-end",alignItems:"center",overflow:"visible",flexDirection:"row",width:void 0}),label:()=>n.Styles.createTextStyle({backgroundColor:g.Color.transparent,textAlign:"center",textAlignVertical:"center",marginHorizontal:5,paddingBottom:1,color:g.Color.white,fontSize:C.default.fontSize.size13Deprecated,font:C.default.font.uiDisplayRegular}),labelLightTheme:()=>n.Styles.createTextStyle({color:v}),iconStyle:()=>n.Styles.createViewStyle({overflow:"visible"}),chevronIcon:()=>n.Styles.createViewStyle({marginLeft:5}),redDot:()=>n.Styles.createViewStyle({width:8,height:8,borderRadius:4,backgroundColor:g.Color.red,position:"absolute",left:10,top:8})});class I extends f.default{constructor(){super(...arguments),this._handleOnPress=e=>{this.state.isMenuShown&&l.default.close(this._getRootViewId(),y.default.newCauseId()),this.state.menuContainsNewItem&&this.setState({menuContainsNewItem:!1}),this.state.showFullScreenOption?h.default.isFullScreenMode(this._getRootViewId()).then((e=>{this._showMenu(e)})):this._showMenu(!1)},this._onButtonRef=e=>{this._buttonRef=e||void 0},this._showMenu=e=>{const t=()=>this._buttonRef,i=this._getRootViewId();l.default.showWithContent({menuId:l.default.menuId(),anchor:t,rootViewId:i,menuHeight:c.default.getLayoutPickerHeight(this.state.availableMenuItems),content:n.createElement(c.default,{anchor:t,rootViewId:i,callId:this.props.callId,conversationMri:this.props.conversationMri,useMobileControls:this.props.useMobileCallControls,isIncomingOrOutGoingRing:this.props.isIncomingOrOutGoingRing,showFullScreenOption:this.state.showFullScreenOption,isInFullscreenMode:e,availableItems:this.state.availableMenuItems,itemColor:this.props.useLightTheme?v:void 0,dividerColor:this.props.useLightTheme?this._themeColors.dividerColor:void 0}),getTitle:()=>{},onCloseMenu:e=>l.default.close(i,e),onMenuClosed:this._onMenuClosed,colorThemeOverride:this.props.useLightTheme?S.Theme.Colorful:S.Theme.ColorfulDark,hidePopupArrow:!0,staticContent:!0,menuWidth:302,borderRadius:8,backgroundColor:this.props.useLightTheme?this._themeColors.primaryBackgroundColor:"#292828"},y.default.newCauseId()),this.setState({isMenuShown:!0})},this._onMenuClosed=e=>{this.state.availableMenuItems.forEach((e=>{e.markAsSeen&&e.markAsSeen()}))}}_buildState(e,t){const i=o.default.getS4LCMCFeatures().enableFullScreenOnWeb&&!p.default.isUsingSplitViewNoSubscription(),n=r.default.getAvailableMenuItemsV2(e.callId,i,e.useMobileCallControls,e.conversationMri);return{isMenuShown:this.state&&this.state.isMenuShown,stageMode:s.default.getStageMode(e.callId),showFullScreenOption:i,menuContainsNewItem:a.some(n,(e=>e.isNew)),availableMenuItems:n}}render(){const e=[w.label,this.props.useLightTheme?w.labelLightTheme:void 0],t=n.createElement(b.BodyText,{style:e},u.getString("CallPanel.CallHeaderViewLabel"));let i=this.props.useLightTheme?v:g.Color.white;const a=n.createElement(T.default,{icon:m.SkypeIcon.GridView,size:m.IconSize.size16,color:i,style:w.iconStyle}),o=[w.innerContainer,n.Styles.createViewStyle({backgroundColor:this.props.useHighContrastTheme?this._themeColors.primaryBackgroundColor:g.Color.transparent,height:this.props.height},!1)],s=this._intLabel(),r={style:o,title:this._intLabel(),accessibilityLabel:s,onPress:this._handleOnPress};return n.createElement(_.HoverableButton,Object.assign({},r,{ref:this._onButtonRef}),a,t,this.state.menuContainsNewItem?n.createElement(n.View,{style:w.redDot}):void 0)}_intLabel(){return u.getString("CallPanel.RibbonLayoutAccessibilityLabel")}}t.default=I},24907:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(89391),o=i(20187),s=i(94224),r=i(36850),l=i(9520),c=i(2278),d=i(80200),u=i(71727),h=i(71830),p=i(44228),g=i(57139),C=i(66355),m=i(36237),S=i(35025),y=i(33754),f=i(31844),_=i(11828),b=i(53374),T=i(78735),v=i(9520),w={[d.StageMode.Speaker]:l.CallViewMenuActions.SwitchToSpeaker,[d.StageMode.Presentation]:l.CallViewMenuActions.SwitchToPresentation,[d.StageMode.FocusedScreenShare]:l.CallViewMenuActions.SwitchToContent,[d.StageMode.Grid]:l.CallViewMenuActions.SwitchToModernGrid,[d.StageMode.TogetherMode]:l.CallViewMenuActions.SwitchToTogetherMode,[d.StageMode.LargeGrid]:l.CallViewMenuActions.SwitchToLargeGallery},I={[d.CallPanelHeaderLayout.Window]:"CallPanel.CallHeaderLayoutWindowLabel",[d.CallPanelHeaderLayout.Float]:"CallPanel.CallHeaderLayoutFloatLabel"},P={[d.CallPanelHeaderLayout.Window]:l.CallViewMenuActions.SwitchToWindow,[d.CallPanelHeaderLayout.Float]:l.CallViewMenuActions.SwitchToFloat};class M extends p.default{static getLayoutPickerHeight(e){const t=d.DesktopLayoutPickerItemHeight;return a.sum(a.map(e,(e=>e.type===d.LayoutPickerMenuItemType.Divider?11:t)))}_buildState(e,t){const i={isPSTNCall:s.default.CallingStore.isPSTNCall(e.callId),isEncryptedCall:h.isEncryptedThread(e.conversationMri),conversationMri:e.conversationMri,callId:e.callId},a=r.default.getStageMode(e.callId);this._changeCallLayoutCommand=new o.ChangeCallLayoutCommand(i,!!e.isIncomingOrOutGoingRing,a);const l=n.default.getS4LCMCFeatures();return{activeStageMode:a,activeHeaderMode:r.default.getCallHeaderLayoutMode(e.callId),tmNumberOfParticipants:l.callAudienceBotConfig.minParticipantsOnCall,lgNumberOfParticipants:l.callGridViewBotConfig.minParticipantsOnCall,activeOnlyVideoOnTheStage:r.default.getOnlyVideoOnTheStage(e.callId),isNewCallScreenActive:l.enableNewCallScreen&&T.default.getNewCallScreenDesignEnabled(),isSelfInTheGrid:r.default.getSelfInTheGrid(e.callId),isTrayHidden:r.default.isTopTrayHidden(e.callId),useLightThemeStage:u.default.useLightTheme()}}_buildRows(e,t){return e.availableItems.map(((t,i)=>{let a={type:t.type,callId:e.callId,useMobileControls:e.useMobileControls,callStageV2:this.state.isNewCallScreenActive,itemColor:e.itemColor,dividerColor:e.dividerColor};switch(t.type){case d.LayoutPickerMenuItemType.Divider:return this._buildSimpleRowBuilder(Object.assign(Object.assign({},a),{isDivider:!0,key:"divider"+i}));case d.LayoutPickerMenuItemType.StageModeSpeaker:case d.LayoutPickerMenuItemType.StageModeFocusedScreenShare:case d.LayoutPickerMenuItemType.StageModeGrid:case d.LayoutPickerMenuItemType.StageModeManual:case d.LayoutPickerMenuItemType.StageModePresentation:case d.LayoutPickerMenuItemType.StageModeTogetherMode:case d.LayoutPickerMenuItemType.StageModeLargeGrid:const n=u.default.layoutPickerMenuItemTypeToStageMode(t.type);return this._buildSimpleRowBuilder(Object.assign(Object.assign({},a),{icon:u.default.getIconForStageMode(n,this.state.isNewCallScreenActive),title:u.default.getStageModeItemTitle(n,this.state.isNewCallScreenActive),isSelected:n===u.default.displayedStageMode(this.state.activeStageMode),onRowPress:()=>this._onStageRowPress(n),changeLayoutCommand:this._changeCallLayoutCommand,tooltip:this._getTooltipForLgOrTm(n),key:d.StageMode[n]}));case d.LayoutPickerMenuItemType.OnlyVideoOnTheStage:return this._buildSimpleRowBuilder(Object.assign(Object.assign({},a),{icon:_.SkypeIcon.Video,title:y.getString("CallPanel.HideAudioFromTheStage"),onRowPress:()=>this._onOnlyVideoOnTheStageRowPress(),isSelected:this.state.activeOnlyVideoOnTheStage,key:"onlyVideoOnTheStage",isNew:t.isNew}));case d.LayoutPickerMenuItemType.Fullscreen:return this._buildSimpleRowBuilder(Object.assign(Object.assign({},a),{icon:this._getFullscreenModeIcon(!!e.isInFullscreenMode),title:this._getFullscreenModeItemTitle(!!e.isInFullscreenMode),onRowPress:()=>this._onFullScreenRowPress(!e.isInFullscreenMode),key:"fullscreen"}));case d.LayoutPickerMenuItemType.CallPanelHeaderLayoutMobile:case d.LayoutPickerMenuItemType.CallPanelHeaderLayoutFloat:case d.LayoutPickerMenuItemType.CallPanelHeaderLayoutWindow:case d.LayoutPickerMenuItemType.CallPanelHeaderLayoutNone:const o=u.default.layoutPickerMenuItemTypeToHeaderMode(t.type);return this._buildSimpleRowBuilder(Object.assign(Object.assign({},a),{title:this._getHeaderModeItemTitle(o),isSelected:o===this.state.activeHeaderMode,onRowPress:()=>this._onHeaderRowPress(o),key:d.CallPanelHeaderLayout[o]}));case d.LayoutPickerMenuItemType.NewCallScreenToggle:return this._buildSimpleRowBuilder(Object.assign(Object.assign({},a),{icon:_.SkypeIcon.MagicWand,title:y.getString("CallPanel.NewCallScreen"),isSelected:this.state.isNewCallScreenActive,onRowPress:()=>this._onNewCallScreenToggled(),key:"newCallScreen",isNew:t.isNew}));case d.LayoutPickerMenuItemType.SelfInTheGridToggle:return this._buildSimpleRowBuilder(Object.assign(Object.assign({},a),{icon:_.SkypeIcon.Contact,title:y.getString("CallPanel.ShowMyselfInTheGrid"),isSelected:this.state.isSelfInTheGrid,onRowPress:()=>this._onSelfInTheGridToggled(),key:"selfInGrid",isNew:t.isNew}));case d.LayoutPickerMenuItemType.HidePeopleAtTop:return this._buildSimpleRowBuilder(Object.assign(Object.assign({},a),{icon:_.SkypeIcon.TopPanelCollapse,title:y.getString("CallPanel.HidePeopleAtTop"),onRowPress:()=>this._onTopTrayCollapseExpandPress(),key:"hideTray"}));case d.LayoutPickerMenuItemType.ShowPeopleAtTop:return this._buildSimpleRowBuilder(Object.assign(Object.assign({},a),{icon:_.SkypeIcon.TopPanelExpand,title:y.getString("CallPanel.ShowPeopleAtTop"),onRowPress:()=>this._onTopTrayCollapseExpandPress(),key:"showTray"}));case d.LayoutPickerMenuItemType.SwitchToDarkThemeStage:return this._buildSimpleRowBuilder(Object.assign(Object.assign({},a),{icon:_.SkypeIcon.Lightbulb,title:y.getString("CallPanel.SwitchToDarkThemeStage"),onRowPress:()=>this._onSwitchThemeButtonPress(),key:"switchToDarkThemeStage"}));case d.LayoutPickerMenuItemType.SwitchToLightThemeStage:return this._buildSimpleRowBuilder(Object.assign(Object.assign({},a),{icon:_.SkypeIcon.Lightbulb,title:y.getString("CallPanel.SwitchToLightThemeStage"),onRowPress:()=>this._onSwitchThemeButtonPress(),key:"switchToLightThemeStage"}))}}))}_buildSimpleRowBuilder(e){return{props:e,builder:S.default.buildRow}}_onStageRowPress(e){this._changeCallLayoutCommand.execute(e),g.default.close(this.props.rootViewId,b.default.newCauseId()),c.default.trackCallViewMenuActions(w[e])}_onHeaderRowPress(e){r.default.setCallHeaderLayoutMode(this.props.callId,e),g.default.close(this.props.rootViewId,b.default.newCauseId()),c.default.trackCallViewMenuActions(P[e])}_onOnlyVideoOnTheStageRowPress(){const e=!this.state.activeOnlyVideoOnTheStage;r.default.setOnlyVideoOnTheStage(this.props.callId,e),this._forgetManuallySetStageRibbonParticipantPlacements(),g.default.close(this.props.rootViewId,b.default.newCauseId());const t=e?l.CallViewMenuActions.ActivateOnlyVideoOnTheStage:l.CallViewMenuActions.DeactivateOnlyVideoOnTheStage;c.default.trackCallViewMenuActions(t)}_forgetManuallySetStageRibbonParticipantPlacements(){this.state.activeStageMode===d.StageMode.Manual&&this._changeCallLayoutCommand.execute(d.StageMode.Grid),s.default.OngoingCallService.setStagedParticipantsSelection(this.props.callId,void 0)}_onNewCallScreenToggled(){const e=!this.state.isNewCallScreenActive;T.default.setNewCallScreenDesignEnabled(e),n.default.getS4LCMCFeaturesNoSubscription().newCallScreenEnabledByDefault||T.default.setUserPreferencesLocal({wasNewCallScreenRevertNoticeDismissed:!0}),g.default.close(this.props.rootViewId,b.default.newCauseId());const t=e?l.CallViewMenuActions.ActivateNewCallScreen:l.CallViewMenuActions.DeactivateNewCallScreen;c.default.trackCallViewMenuActions(t),m.track(new v.CallStageLayoutChangeEvent(this.state.activeStageMode,this.state.activeStageMode,this.state.activeOnlyVideoOnTheStage,this.state.activeOnlyVideoOnTheStage,e,!1))}_onSelfInTheGridToggled(){const e=!this.state.isSelfInTheGrid;r.default.setSelfInTheGrid(e,this.props.callId),g.default.close(this.props.rootViewId,b.default.newCauseId());const t=e?l.CallViewMenuActions.ActivateSelfInTheGrid:l.CallViewMenuActions.DeactivateSelfInTheGrid;c.default.trackCallViewMenuActions(t)}_onTopTrayCollapseExpandPress(){const e=!this.state.isTrayHidden;r.default.setHideTopTray(e,this.props.callId),g.default.close(this.props.rootViewId,b.default.newCauseId()),m.track(new l.ToggleCallTray(this.props.callId,e))}_onSwitchThemeButtonPress(){const e=!this.state.useLightThemeStage;T.default.setLightThemeCallStageEnabled(e),g.default.close(this.props.rootViewId,b.default.newCauseId());const t=e?l.CallViewMenuActions.SwitchToLightThemeStage:l.CallViewMenuActions.SwitchToDarkThemeStage;c.default.trackCallViewMenuActions(t)}_onFullScreenRowPress(e){g.default.close(this.props.rootViewId,b.default.newCauseId()),e?f.default.tryEnterFullScreenMode(this.props.rootViewId).then((e=>{e?(m.track(new l.RibbonSettingsMenuActionEvent(l.RibbonSettingsMenuActions.EnterFullScreen)),c.default.trackCallViewMenuActions(l.CallViewMenuActions.EnterFullScreen)):m.log(C.LogTraceArea.CallingUI,"Failed to Enter Full Screen Mode")})):f.default.exitFullScreenMode(this.props.rootViewId).then((()=>{m.track(new l.RibbonSettingsMenuActionEvent(l.RibbonSettingsMenuActions.ExitFullScreen))})).catch((e=>{m.log(C.LogTraceArea.CallingUI,"Failed to exit full screen mode:")}))}_getTooltipForLgOrTm(e){if(e===d.StageMode.TogetherMode||e===d.StageMode.LargeGrid)return y.getString("CallPanel.StageModeRequiresMoreParticipantsTooltip",{count:d.StageMode.TogetherMode?this.state.tmNumberOfParticipants:this.state.lgNumberOfParticipants})}_getHeaderModeItemTitle(e){const t=I[e];return t?y.getString(t):(m.error(C.LogTraceArea.CallingUI,"No title found for header mode: "+d.CallPanelHeaderLayout[e]),"")}_getFullscreenModeItemTitle(e){return e?y.getString("CallPanel.ExitFullScreen"):y.getString("CallPanel.EnterFullScreen")}_getFullscreenModeIcon(e){return e?_.SkypeIcon.FitToWindow:_.SkypeIcon.ViewSwitcher}}t.default=M},35025:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(16778),o=i(80200),s=i(53211),r=i(15877),l=i(81760),c=i(11010),d=i(11828),u=i(24576),h=i(36850),p=i(71727),g=i(94224),C=i(76514),m=i(56018),S=(0,r.lazyProperties)({dividerDesktop:()=>n.Styles.createViewStyle({borderBottomWidth:1,height:1,marginTop:5,marginBottom:5,borderColor:l.Color.gray400Overlay70}),dividerDesktopV2:()=>n.Styles.createViewStyle({height:2,marginTop:4,marginBottom:4,backgroundColor:"#11100F"}),dividerMobile:()=>n.Styles.createViewStyle({borderBottomWidth:1,height:1,borderColor:l.Color.whiteOverlay70}),rowMobile:()=>n.Styles.createViewStyle({marginHorizontal:16}),hoverStyle:()=>n.Styles.createViewStyle({backgroundColor:l.Color.gray200Overlay20})}),y=l.Color.white;class f extends u.default{constructor(){super(...arguments),this._onContainerRef=e=>{this._containerRef=e||void 0}}_buildState(e,t){return{disabled:this._isDisabled(e),isSelected:this._isSelected(e)}}_isDisabled(e){let t=!1;const i=p.default.layoutPickerMenuItemTypeToStageMode(e.type);if(e.changeLayoutCommand&&!a.isUndefined(i)&&(t=!e.changeLayoutCommand.canExecuteForStageMode(i)),e.type===o.LayoutPickerMenuItemType.SelfInTheGridToggle){const i=h.default.getOnlyVideoOnTheStage(e.callId)&&!g.default.CallingStore.isProvidingVideo(e.callId),a=C.default.hasPinnedParticipants(e.callId);(i||a)&&(t=!0)}return e.type===o.LayoutPickerMenuItemType.OnlyVideoOnTheStage&&C.default.getPinnedParticipants(e.callId)&&(t=!0),e.type!==o.LayoutPickerMenuItemType.HidePeopleAtTop||m.default.trayHasParticipants(e.callId)||(t=!0),t}_isSelected(e){let t=e.isSelected;if(e.type===o.LayoutPickerMenuItemType.SelfInTheGridToggle){const i=h.default.getOnlyVideoOnTheStage(e.callId)&&!g.default.CallingStore.isProvidingVideo(e.callId),a=C.default.hasPinnedParticipants(e.callId);(i||a)&&(t=!1)}return e.type===o.LayoutPickerMenuItemType.OnlyVideoOnTheStage&&C.default.hasPinnedParticipants(e.callId)&&(t=!1),!!t}render(){if(this.props.isDivider)return this._renderDivider();const e=this.props.itemColor?this.props.itemColor:y,t={onRef:this._onContainerRef,icon:this.props.icon,accessibilityLabel:this.props.title||"",titleText:this.props.title,onRowPress:this.props.onRowPress,colorThemeOverride:this.props.colorThemeOverride,rowHeight:this._getRowHeight(),titleTextColor:e,accessoryIcon:this.state.isSelected?d.SkypeIcon.Ok:void 0,titleStyle:c.default.fontStyle.bodySmallDeprecated,iconSize:d.IconSize.size16,accessoryIconSize:d.IconSize.size16,iconColor:e,accessoryIconColor:e,hideBorder:!this.props.showBorder,disabled:this.state.disabled,borderColor:l.Color.gray50Overlay50,tooltip:this.state.disabled?this.props.tooltip:void 0,containerStyleOverride:this.props.useMobileControls?S.rowMobile:void 0,hoverStyle:S.hoverStyle,isNew:this.props.isNew};return s.default.buildRow(t)}requestFocus(){this._containerRef&&this._containerRef.requestFocus()}_getRowHeight(){return this.props.useMobileControls?o.MobileLayoutPickerItemHeight:o.DesktopLayoutPickerItemHeight}_renderDivider(){const e=this.props.useMobileControls?S.dividerMobile:this.props.callStageV2?S.dividerDesktopV2:S.dividerDesktop;return n.createElement(n.View,{style:[e,this.props.dividerColor&&{backgroundColor:this.props.dividerColor}],importantForAccessibility:n.Types.ImportantForAccessibility.No})}}t.default=f,f.buildRow=e=>n.createElement(f,Object.assign({},e))},34548:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NewCallReactionsView=void 0;const a=i(16778),n=i(24576),o=i(3573),s=i(80200),r=i(15877),l=i(80837),c=i(66355),d=i(53374),u=i(36237),h=i(62602),p=i(18078),g=(0,r.lazyProperties)({reactionsView:()=>l.default.absoluteFill});class C extends n.default{constructor(){super(...arguments),this._stageReactionsAnimatedOpacityValue=new a.Animated.Value(1),this._stageReactionsAnimatedStyle=a.Styles.createAnimatedViewStyle({opacity:this._stageReactionsAnimatedOpacityValue}),this._getAnchorInfoChanges=(e,t)=>{},this._onTextReactionPressed=()=>{if(this.props.onTextReactionPressed){const e=d.default.newCauseId();u.log(c.LogTraceArea.CallingUI,"CallStageView._onTextReactionPressed, causeId: "+e),this.props.onTextReactionPressed(e)}},this._getAnchorInfo=e=>{const t=p.default.isMyMri(e)?s.CallStageElementKeys.localUserKey:e;let i;return h.default.measureLayoutRelativeToAncestor((()=>this.props.getChildRef(t)),this.props.getParentRef).then((e=>{i={rect:e,hidden:!1}})),i}}render(){return this.props.disableReactions?null:a.createElement(a.Animated.View,{style:[g.reactionsView,this._stageReactionsAnimatedStyle],key:s.CallStageElementKeys.callTextReactionViewKey,ignorePointerEvents:!0},a.createElement(o.default,{reactionsConversationMri:this.props.reactionsConversationId,ignorePointerEvents:!0,parentDimensions:this.props.parentDimensions,topOffsetForUnhandledReactions:0,alignRight:!0,getAnchorInfo:this._getAnchorInfo,getAnchorInfoChanges:this._getAnchorInfoChanges,getCallReactionsDisplayHelper:this.props.getCallReactionsDisplayHelper,onReactionTap:this._onTextReactionPressed}))}}t.NewCallReactionsView=C},54704:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TrayOverflowButton=void 0;const a=i(16778),n=i(24576),o=i(81760),s=i(15877),r=i(11010),l=i(36400),c=i(19675),d=i(80200),u=i(53374),h=i(36237),p=i(66355),g=d.BigTrayCallParticipantAvatarSize,C=(0,s.lazyProperties)({overflowButtonContainer:()=>a.Styles.createViewStyle({backgroundColor:o.Color.transparent,width:d.BigTrayOverflowButtonWidth,flexShrink:0,flexGrow:0,alignContent:"center",justifyContent:"center",alignItems:"center",alignSelf:"stretch"}),overflowButton:()=>a.Styles.createButtonStyle({width:g,height:g,borderRadius:g/2,backgroundColor:o.Color.gray200Overlay60,alignContent:"center",justifyContent:"center"}),overflowButtonLightTheme:()=>a.Styles.createButtonStyle({backgroundColor:o.Color.gray100}),overflowButtonLabel:()=>a.Styles.createTextStyle({color:o.Color.whiteOverlay80,backgroundColor:o.Color.transparent,textAlign:"center",textAlignVertical:"center",paddingBottom:1,fontSize:r.default.fontSize.size18}),overflowButtonLabelLightTheme:()=>a.Styles.createTextStyle({color:o.Color.gray400})});class m extends n.default{constructor(){super(...arguments),this._onPress=()=>{const e=u.default.newCauseId();h.log(p.LogTraceArea.CallingUI,"OverflowButton._onPress "+e),this.props.onOverflowButtonPress(e,d.CallRosterOrigin.TrayOverflowButton,!1)}}render(){return this.props.hiddenParticipantsNumber?a.createElement(a.View,{style:C.overflowButtonContainer},a.createElement(l.HoverableButton,{style:[C.overflowButton,this.props.useLightTheme?C.overflowButtonLightTheme:void 0],onPress:this._onPress},a.createElement(c.BodyText,{style:[C.overflowButtonLabel,this.props.useLightTheme?C.overflowButtonLabelLightTheme:void 0]},"+"+this.props.hiddenParticipantsNumber))):null}}t.TrayOverflowButton=m},18128:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(88837),o=i(89391),s=i(66649);class r extends n.ComponentBase{_buildState(e,t){const i=o.default.getS4LEntitlementFeatures().SCE.UserServices.Client.Features.DarkerDialerBarEnabled;return{onPress:e.onPress,enableDarkerColors:i,disableHighBandwidthOperations:s.default.isUsingGogoNetwork()}}render(){const e=this.props.layoutComponent;return a.createElement(e,{experimentSettings:this.props.experimentSettings,onPress:this.state.onPress,onCallButtonPress:this.props.onCallButtonPress,enableDarkerColors:this.state.enableDarkerColors,disabled:this.state.disableHighBandwidthOperations})}}t.default=r},81011:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(18128),o=i(96114),s=i(40493);class r extends o.LayoutExperiment{constructor(e){super(e,"DialpadBar")}_getOptionFromConf(){return"revert"}render(){const e=this._getLayoutToDisplay();if(e)return a.createElement(n.default,Object.assign({layoutComponent:e,experimentSettings:this._getExperimentSettings()},this.props));if(this.props.defaultComponent){const e=this.props.defaultComponent;return a.createElement(e,Object.assign({experimentSettings:this._getExperimentSettings()},this.props))}return null}_getLayoutToDisplay(){return s.default}}t.default=r},40493:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});i(31844);const a=i(38933),n=i(16778),o=i(10117),s=i(2830),r=i(15877),l=i(33754),c=i(89808),d=i(29130),u=i(26978),h=i(81760),p=i(11828),g=(i(60305),i(19675)),C=i(24576),m=(0,r.lazyProperties)({container:()=>n.Styles.createViewStyle({flexDirection:"row",flex:1,paddingVertical:12,justifyContent:"center",bottom:0}),buttonContainer:()=>n.Styles.createViewStyle({alignItems:"center",flex:1,flexGrow:0,flexDirection:"row",height:50,borderRadius:28}),actionButtonStyle:()=>n.Styles.createViewStyle({flex:1,alignItems:"center",flexDirection:"row",borderRadius:20,paddingHorizontal:20}),buttonText:()=>n.Styles.createTextStyle({color:h.Color.white,flex:0,maxWidth:180}),addToCallMargins:()=>n.Styles.createViewStyle({marginLeft:6,marginRight:3}),dialpadMargin:()=>n.Styles.createViewStyle({marginRight:6}),dialpadMarginMulti:()=>n.Styles.createViewStyle({marginLeft:3})});class S extends C.default{constructor(){super(...arguments),this._callButtonLabelName="QuickCallPanel.SkypeCallLabel",this._onPress=()=>{this.props.onPress&&this.props.experimentSettings&&(s.default.registerDialerButtonClickAction(this.props.experimentSettings),this.props.onPress())},this._onCallButtonPress=e=>{this.props.onCallButtonPress&&this.props.experimentSettings&&(s.default.registerCallButtonClickAction(this.props.experimentSettings),this.props.onCallButtonPress(e))},this._onLayout=e=>{this.isComponentMounted()&&this._useLayoutWidth()&&this.setState({width:e.width})}}_buildState(e,t){const i=this._getRootViewId();return{orientation:d.default.getDeviceOrientation(i),useIOSLandscapeStyles:!1,width:this._useLayoutWidth()?void 0:this._getContext().isPresentedInDesktopLeftNav?u.default.getWidth():d.default.getWidth(i),gradientColors:c.default.getGradientColors(),primaryColor:c.default.getPrimaryColor()}}componentDidMount(){super.componentDidMount(),this.props.experimentSettings&&s.default.registerOpenAction(this.props.experimentSettings)}render(){const e=this._useAccessibleTheme()?this._themeColors.primaryIconColor:this.state.primaryColor,t=n.Styles.createViewStyle({borderColor:e,borderWidth:2,backgroundColor:this._themeColors.primaryBackgroundColor},!1),i=n.Styles.createTextStyle({color:e},!1);let s,r;const c=this._isPresentedInDesktopLeftNav()?1:2;if(this.state.width){const e=this.state.width-(this.state.useIOSLandscapeStyles?60:0);s=n.Styles.createViewStyle({position:"absolute",width:this.state.width,paddingHorizontal:this.state.useIOSLandscapeStyles?20:void 0},!1),r=n.Styles.createViewStyle({width:.9*e/c},!1)}const d=this._isPresentedInDesktopLeftNav()?void 0:n.createElement(n.View,{key:"AddCallButton",style:[m.buttonContainer,t,r,m.addToCallMargins]},n.createElement(n.Button,{style:[m.actionButtonStyle,r],onPress:this._onCallButtonPress,accessibilityLabel:l.getString("QuickCallPanel.PanelHeaderNewCall"),disabled:this.props.disabled},n.createElement(o.default,{icon:p.SkypeIcon.CallAdd,color:e,size:p.IconSize.size24}),n.createElement(g.BodyText,{bold:!0,style:[m.buttonText,i],allowFontScaling:!1},l.getString(this._callButtonLabelName)))),u=this._useAccessibleTheme()?n.Styles.createTextStyle({color:this._themeColors.primaryBackgroundColor},!1):void 0,h=n.createElement(n.Button,{key:"DialpadButton",style:[m.actionButtonStyle,r],onPress:this._onPress,accessibilityLabel:l.getString("QuickCallPanel.DialpadButtonAccessibilityLabel"),disabled:this.props.disabled},n.createElement(o.default,{icon:p.SkypeIcon.Dialpad,color:this._themeColors.primaryBackgroundColor,size:p.IconSize.size24}),n.createElement(g.BodyText,{bold:!0,style:[m.buttonText,u],allowFontScaling:!1},l.getString("QuickCallPanel.DialpadButtonLabelShort"))),C=[m.dialpadMargin,c>1?m.dialpadMarginMulti:void 0];let S;if(this._useAccessibleTheme()){const e=[m.buttonContainer,r,C,n.Styles.createViewStyle({backgroundColor:this._themeColors.primaryIconColor},!1)];S=n.createElement(n.View,{key:"Container_View",style:e},h)}else S=n.createElement(a.GradientView,{key:"Gradient_View",style:[m.buttonContainer,r,C],colors:this.state.gradientColors,direction:a.GradientDirection.BOTTOM_RIGHT},h);return n.createElement(n.View,{style:[m.container,s],onLayout:this._useLayoutWidth()?this._onLayout:void 0},d,S)}_useLayoutWidth(){return!0}}t.default=S},96114:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LayoutExperiment=t.ExperimentOption=void 0;const a=i(88837);var n;!function(e){e[e.Default=0]="Default",e[e.NewCta=1]="NewCta"}(n=t.ExperimentOption||(t.ExperimentOption={}));const o={default:n.Default,newCta:n.NewCta};class s extends a.ComponentBase{constructor(e,t){super(e),this._settings={name:t,location:e.location}}shouldComponentUpdate(e,t){return this.state.optionToPresent!==t.optionToPresent}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this._setSettingsLayoutOption(t.optionToPresent)}_buildState(e,t){const i={optionToPresent:this._getOptionFromConf()};return t&&this._setSettingsLayoutOption(i.optionToPresent),i}_getOptionToDisplay(){const e=this.state.optionToPresent;return o[e]?o[e]:n.Default}_getExperimentSettings(){return this._settings}_setSettingsLayoutOption(e){this._settings.layoutOption=e}}t.LayoutExperiment=s},85498:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LayoutOptionDefault=void 0;const a=i(16778),n=i(89391),o=i(98278),s=i(44973),r=i(87134),l=i(46096),c=i(81722),d=i(13944),u=i(2830),h=i(15877),p=i(33754),g=i(66127),C=i(78735),m=i(34537),S=i(4735),y=i(27357),f=i(16392),_=i(22222),b=i(81760),T=i(40363),v=i(11828),w=i(19675),I=i(24576),P=i(22541);var M,k;!function(e){e[e.GetFreeTrial=0]="GetFreeTrial",e[e.GetCredit=1]="GetCredit",e[e.GetSubscription=2]="GetSubscription"}(M||(M={})),function(e){e[e.SkypeToPhone=0]="SkypeToPhone",e[e.Credit=1]="Credit",e[e.Subscription=2]="Subscription"}(k||(k={}));const A=(0,h.lazyProperties)({container:()=>a.Styles.createViewStyle({flex:0,minHeight:60,paddingTop:11,paddingLeft:8,paddingRight:8,paddingBottom:3,flexDirection:"row",alignItems:"flex-start",justifyContent:"space-between"}),buttonContainer:()=>a.Styles.createViewStyle({flex:0,alignSelf:"flex-start",paddingTop:21,paddingLeft:7}),buttonContainerBroad:()=>a.Styles.createViewStyle({flex:0,alignSelf:"flex-end",paddingTop:5}),bannerContainer:()=>a.Styles.createViewStyle({alignItems:"stretch",justifyContent:"space-between",backgroundColor:b.Color.transparent}),closeIconContainer:()=>a.Styles.createViewStyle({position:"absolute",top:8,right:8,padding:4}),textContainer:()=>a.Styles.createViewStyle({flex:1,paddingLeft:7,paddingRight:8,justifyContent:"space-between",alignItems:"flex-start"}),bodyStyle:()=>a.Styles.createTextStyle({flex:1,lineHeight:18,fontSize:13}),caption:()=>a.Styles.createTextStyle({flex:1,lineHeight:16,fontSize:12})}),R={skypeToPhone:{icon:[{icon:v.SkypeIcon.GlobeCredit,color:b.Color.orangeLight},{icon:v.SkypeIcon.CreditGlobe,color:b.Color.blueDark}],buttonType:M.GetCredit,labelType:k.SkypeToPhone},credit:{icon:[{icon:v.SkypeIcon.GlobeCredit,color:b.Color.orangeLight},{icon:v.SkypeIcon.CreditGlobe,color:b.Color.blueDark}],buttonType:M.GetCredit,labelType:k.Credit},subscription:{icon:[{icon:v.SkypeIcon.Globe,color:b.Color.blue}],buttonType:M.GetSubscription,labelType:k.Subscription},freeTrial:{icon:[{icon:v.SkypeIcon.GlobeCredit,color:b.Color.orangeLight},{icon:v.SkypeIcon.CreditGlobe,color:b.Color.blueDark}],buttonType:M.GetFreeTrial,labelType:k.SkypeToPhone}};class V extends I.default{constructor(){super(...arguments),this._appVersion=T.default.getAppVersion(),this._telemetrySent=!1,this._renderActionButton=(e,t)=>t?this._renderButton(M.GetFreeTrial):"credit_only"===e?this._renderButton(M.GetSubscription):this._renderButton(M.GetCredit),this._renderButton=e=>{let t,i="";const n={buttonStyle:o.SXButtonStyle.Custom},s={textColor:b.Color.white};switch(e){case M.GetFreeTrial:t=b.AgnosticGradientFillButtonColors.green,i=p.getString("SkypeToPhonePanel.GetFreeTrialButton");break;case M.GetCredit:t=b.AgnosticGradientFillButtonColors.orange,i=p.getString("SkypeToPhonePanel.GetCreditButton");break;case M.GetSubscription:t=b.AgnosticGradientFillButtonColors.blue,i=p.getString("SkypeToPhonePanel.GetSubscriptionButton")}if(this._useAccessibleTheme()){const e=this._useDarkTheme();s.backgroundColor=e?b.Color.white:b.Color.black,s.textColor=e?b.Color.black:b.Color.white}else n.buttonStyle=o.SXButtonStyle.AgnosticGradientFill,n.agnosticGradientColor=t,n.gradientDirection=P.GradientDirection.BOTTOM_RIGHT;let r=A.buttonContainer;return i.length>16&&!this.state.isCompactView&&(r=A.buttonContainerBroad),{button:a.createElement(_.default,Object.assign({key:"banner_content_button",style:r,backgroundStyle:V._backgroundStyle,title:i,onPress:this._onProceedButtonPress,buttonSize:o.SXButtonSize.Small,buttonConfig:s},n)),titleLength:i.length}},this._onProceedButtonPress=e=>{let t;e.stopPropagation(),this.props.experimentSettings&&(u.default.registerBalanceStateButtonClickAction(this.props.experimentSettings,this.props.userEntitlementsSummary,this.props.isFreeTrialAvailable),t=c.ExperimentLocation[this.props.experimentSettings.location]),S.default.navigateToBalanceStatePanel(t||"SkypeToPhoneBanner.Generic",this._getRootViewId(),void 0,"credit_only"===this.props.userEntitlementsSummary?l.BalanceStatePanelSection.Subscriptions:void 0)},this._getBannerTheme=(e,t)=>t?R.freeTrial:"credit_only"===e?R.subscription:"none"===e?R.skypeToPhone:R.credit,this._onPressClose=()=>{this.props.experimentSettings&&u.default.registerCloseButtonClickAction(this.props.experimentSettings,this.props.userEntitlementsSummary,this.props.isFreeTrialAvailable),C.default.setUserPreferencesLocal({entitlementsBannerOptions:{visible:!1,closedForClientVersion:this._appVersion}}),this.props.onClose()}}_buildState(e,t){const i=C.default.getUserPreferencesLocal().entitlementsBannerOptions,a=i&&(i.visible||i.closedForClientVersion!==this._appVersion),o=n.default.getS4LEntitlementFeatures().SCE.SkypeToPhoneBanner.Features.BannerEnabled,s=n.default.getS4LEntitlementFeatures().SCE.SkypeToPhoneBanner.Features.ForceShowBanner;return{isEntitlementsBannerVisible:a&&(o||s)||"both"!==e.userEntitlementsSummary&&s,isCompactView:y.default.isSplitNavStackCollapsed(f.StackNavigatorId.DesktopContent),modernizeConversationList:g.default.canModernizeConversationList()}}_sendTelemetry(){this.props.experimentSettings&&this.state.isEntitlementsBannerVisible&&!this._telemetrySent&&(u.default.registerOpenAction(this.props.experimentSettings,this.props.userEntitlementsSummary,this.props.isFreeTrialAvailable),this._telemetrySent=!0)}componentDidMount(){super.componentDidMount(),this._sendTelemetry()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this._sendTelemetry()}render(){if(!this.state.isEntitlementsBannerVisible)return null;let e,t=this._getBannerTheme(this.props.userEntitlementsSummary,this.props.isFreeTrialAvailable),i=p.getString("SkypeToPhonePanel.CallPhonesSendSMS");switch(t.labelType){case k.Subscription:i=p.getString("SkypeToPhonePanel.SaveMoreText"),e=p.getString("SkypeToPhonePanel.Subscriptions");break;case k.Credit:e=p.getString("ProfileCard.SkypeCreditsLabel");break;case k.SkypeToPhone:e=p.getString("Entitlements.SkypeToPhoneTitle")}const n=a.createElement(s.default,{iconSize:v.IconSize.size58,icons:t.icon}),o=this._renderActionButton(this.props.userEntitlementsSummary,this.props.isFreeTrialAvailable),l=this.state.isCompactView||o.titleLength<17?[a.createElement(a.View,{style:A.textContainer,key:"text_section"},a.createElement(w.Caption,{style:A.caption},e),a.createElement(w.BodyText,{style:A.bodyStyle,size:this.props.useCompactLayout?w.BodyTextSize.SmallDeprecated:void 0},i)),o.button]:a.createElement(a.View,{style:A.textContainer},a.createElement(w.Caption,{style:A.caption},e),a.createElement(w.BodyText,{style:A.bodyStyle},i),o.button),c=a.createElement(d.default,{style:A.closeIconContainer,size:v.IconSize.size12,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,onPress:this._onPressClose,icon:v.SkypeIcon.ClosePanel,title:p.getString("Global.CloseButtonTitle")}),u=this.state.modernizeConversationList?m.default.getBannerBackgroundColorStyle(this._useDarkTheme(),this._useAccessibleTheme(),this._themeStyles):this._themeStyles.secondaryBackgroundColorStyle;return a.createElement(a.View,{style:A.bannerContainer},a.createElement(r.default,null),a.createElement(a.View,{style:[A.container,u]},n,l),c)}}t.LayoutOptionDefault=V,V._backgroundStyle={paddingLeft:12,paddingRight:12,borderRadius:20},t.default=V},23223:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(16778),o=i(88837),s=i(39119),r=i(4604),l=(i(59261),i(73367)),c=i(34387);class d extends o.ComponentBase{_buildState(e,t){const i=r.default.getSubscriptions(),n=r.default.getCreditEntitlement(),o=l.default.getLoadedPersonalizedRecommendations();return{userEntitlementsSummary:s.getEntitlementCombination(n,i),isFreeTrialAvailable:o&&a.some(o.callingOffers,(e=>e.isFreeTrial)),shouldUseGPlayBilling:c.default.shouldUseGooglePlayBillingForCredit()||c.default.shouldUseGooglePlayBillingForSubscriptions()}}componentDidMount(){super.componentDidMount(),this.state.shouldUseGPlayBilling?c.default.requestUpdate():l.default.requestPersonalizedRecommendationsUpdate()}render(){const e=this.props.layoutComponent;return n.createElement(e,{experimentSettings:this.props.experimentSettings,userEntitlementsSummary:this.state.userEntitlementsSummary,isFreeTrialAvailable:this.state.isFreeTrialAvailable,useCompactLayout:this.props.useCompactLayout,onClose:this.props.onClose})}}t.default=d},58585:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(89391),o=i(96114),s=i(85498),r=i(23223);class l extends o.LayoutExperiment{constructor(e){super(e,"SkypeToPhoneBanner")}_getOptionFromConf(){return n.default.getS4LEntitlementFeatures().SCE.UserServices.Client.Experiments.SkypeToPhoneBanner}render(){return a.createElement(r.default,Object.assign({layoutComponent:s.default,experimentSettings:this._getExperimentSettings()},this.props))}}t.default=l},32516:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LayoutOptionDefault=void 0;const a=i(16778),n=i(44770),o=i(98278),s=i(13944),r=i(2830),l=i(15877),c=i(33754),d=i(51072),u=i(4735),h=i(22222),p=i(81760),g=i(11828),C=i(34528),m=i(80837),S=i(19675),y=i(24576),f=n.Collection.SKYPE_TO_PHONE_SMALL,_=(0,l.lazyProperties)({container:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",paddingHorizontal:10,paddingVertical:4,marginTop:5}),iconContainer:()=>a.Styles.createViewStyle({width:40,height:40,marginRight:10,flexDirection:"row",alignItems:"center",justifyContent:"center",overflow:"visible"}),iconStyle:()=>a.Styles.createImageStyle({width:40,height:40,justifyContent:"center",overflow:"visible"}),labelsContainer:()=>a.Styles.createViewStyle({flex:1,paddingLeft:5}),topTextLine:()=>a.Styles.createViewStyle({flexDirection:"row",justifyContent:"space-between"}),bottomTextLine:()=>a.Styles.createViewStyle({marginTop:2}),rightLabelText:()=>a.Styles.createTextStyle({textAlignVertical:"center",height:20}),rightPartView:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",paddingHorizontal:6,overflow:"visible"}),forwardButton:()=>a.Styles.createViewStyle({alignItems:"center",paddingHorizontal:10}),itemDivider:()=>a.Styles.createViewStyle({height:1,marginHorizontal:10,marginTop:5}),itemDividerMiddle:()=>a.Styles.createViewStyle({height:1,marginLeft:65,marginTop:0}),itemDividerDarkeTheme:()=>a.Styles.createViewStyle({backgroundColor:p.Color.gray400})});class b extends y.default{constructor(){super(...arguments),this._onProceedButtonPress=e=>{e.stopPropagation(),this.props.experimentSettings&&r.default.registerBalanceStateButtonClickAction(this.props.experimentSettings,this.props.userEntitlementsSummary,this.props.isFreeTrialAvailable),u.default.navigateToBalanceStatePanel("DialerPanel.UserEntitlements.navigateBalanceState",this._getRootViewId())},this._renderImage=(e,t)=>{const i=[_.iconStyle];return t&&i.push(t),a.createElement(a.Image,{style:i,source:e})},this._renderOptionalSpacer=(e,t)=>{},this._renderTopText=e=>a.createElement(a.View,{style:_.topTextLine},a.createElement(S.RowTitle,{style:m.default.flexOne,numberOfLines:2},e))}componentDidMount(){super.componentDidMount(),this.props.experimentSettings&&r.default.registerOpenAction(this.props.experimentSettings,this.props.userEntitlementsSummary,this.props.isFreeTrialAvailable)}render(){const e=[_.itemDivider];this._useDarkTheme()?e.push(_.itemDividerDarkeTheme):e.push(this._themeStyles.dividerColorStyle);const t=c.getString("Entitlements.SkypeToPhoneTitle");let i,n,r=t;if(this.props.hasCallingEntitlements){const e=c.getString("Entitlements.SubscriptionsSmallCaps",{count:this.props.subscriptionsCount});r+=", "+e,this.props.formattedBalance&&(r+=", "+this.props.formattedBalance),i=a.createElement(S.BodyText,{style:_.bottomTextLine,numberOfLines:1,textThemeColor:S.TextThemeColor.Secondary},e),n=[a.createElement(S.RowTitle,{key:"creditEntitlementValueText",style:[this._themeStyles.secondaryTextColorStyle,_.rightLabelText,m.default.pointerCursor],numberOfLines:1},this.props.formattedBalance),a.createElement(s.default,{key:"creditEntitlementForwardButton",size:g.IconSize.size20,color:this._themeColors.disclosureArrowColor,hoverColor:this._themeColors.iconHoverColor,icon:C.navForwardIcon(),style:_.forwardButton,title:c.getString("Global.ForwardButton"),accessibilityLabel:c.getString("Global.ForwardButton")})]}else{const e=c.getString("Entitlements.AddFundsLabel");r+=", "+e;const t={backgroundColor:this._themeColors.buttonBackgroundColor,textColor:this._themeColors.primaryIconColor};n=a.createElement(a.View,{blockPointerEvents:!0},a.createElement(h.default,{title:e,buttonStyle:o.SXButtonStyle.Custom,buttonSize:o.SXButtonSize.Small,buttonConfig:t,allowTextWrap:!0}))}return a.createElement(a.View,null,this._renderOptionalSpacer("skypeToPhoneSpacer",[e,_.itemDividerMiddle]),a.createElement(d.MaybeListItem.Button,{style:[_.container,m.default.pointerCursor],accessibilityLabel:r,onPress:this._onProceedButtonPress},a.createElement(a.View,{style:_.iconContainer},this._renderImage(f,void 0)),a.createElement(a.View,{style:[_.labelsContainer,m.default.pointerCursor]},this._renderTopText(t),i),a.createElement(a.View,{style:_.rightPartView},n)),a.createElement(a.View,{style:e}))}}t.LayoutOptionDefault=b,t.default=b},90454:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LayoutOptionNewCta=t.ActionButtonType=void 0;const a=i(96486),n=i(16778),o=i(98278),s=i(32516),r=i(15877),l=i(33754),c=i(51072),d=i(22222),u=i(81760),h=i(80837),p=i(19675),g=i(11828),C=i(44973),m=i(11010),S=i(26978),y=(i(60305),i(22541));var f;!function(e){e[e.GetFreeTrial=0]="GetFreeTrial",e[e.GetCredit=1]="GetCredit",e[e.GetSubscription=2]="GetSubscription"}(f=t.ActionButtonType||(t.ActionButtonType={}));const _=g.IconSize.size58,b=(0,r.lazyProperties)({componentContainer:()=>n.Styles.createViewStyle({paddingHorizontal:16,paddingVertical:6}),listItemContainer:()=>n.Styles.createViewStyle({flexDirection:"row"}),buttonContainer:()=>n.Styles.createViewStyle({flexDirection:"column",justifyContent:"center",paddingLeft:4,overflow:"visible"}),buttonContainerWide:()=>n.Styles.createViewStyle({maxWidth:200}),buttonContainerSmall:()=>n.Styles.createViewStyle({paddingLeft:5}),iconContainer:()=>n.Styles.createViewStyle({flexDirection:"column",justifyContent:"center",alignItems:"center",overflow:"visible"}),centerTextContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"column",justifyContent:"space-around",paddingVertical:3,paddingRight:4,paddingLeft:16,flexGrow:1}),entitlementsContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"column",paddingTop:1}),regularTextStyles:()=>n.Styles.createTextStyle({font:m.default.font.uiDisplayRegular}),buttonTextStyle:()=>n.Styles.createTextStyle({textAlign:"center"}),bannerTextStyle:()=>n.Styles.createTextStyle({fontSize:13,lineHeight:18}),topTextStyle:()=>n.Styles.createTextStyle({fontSize:12,lineHeight:16})});class T extends s.default{constructor(){super(...arguments),this._renderTopText=e=>n.createElement(p.Caption,{numberOfLines:1,messageStreamFontSize:13,style:b.regularTextStyles},e),this._getButtonContainerResponsiveMaxWidth=()=>{const e=(S.default.getWidthNoSubscription(S.SideBar.Left)-32-_)/2;return n.Styles.createViewStyle({maxWidth:e})}}render(){const e=[b.iconContainer],t=[b.buttonContainer],i=[b.centerTextContainer];this.props.isSmallDevice&&!this.props.isLandscape&&t.push(b.buttonContainerSmall),t.push(this._getButtonContainerResponsiveMaxWidth());const o=l.getString("Entitlements.SkypeToPhoneTitle"),s=this._renderTopText(o),r=this._renderCenterText(),d=this._renderActionButton(),p=[o,r.accessibilityLabel,d.accessibilityLabel],m=a.join(p,", "),S=[{icon:g.SkypeIcon.GlobeCredit,color:u.Color.orangeLight},{icon:g.SkypeIcon.CreditGlobe,color:u.Color.blueDark}];return n.createElement(n.View,{style:b.componentContainer},n.createElement(c.MaybeListItem.Button,{style:[b.listItemContainer,h.default.pointerCursor],accessibilityLabel:m,onPress:this._onProceedButtonPress,accessibilityTraits:n.Types.AccessibilityTrait.Button},n.createElement(n.View,{style:e},n.createElement(C.default,{iconSize:_,icons:S})),n.createElement(n.View,{style:i},s,r.element),n.createElement(n.View,{style:t},d.element)))}_renderCenterText(){if(this.props.isFreeTrialAvailable||"none"===this.props.userEntitlementsSummary){const e=l.getString("SkypeToPhonePanel.CallPhoneNumbers");return{element:n.createElement(n.View,{style:b.entitlementsContainer},n.createElement(p.Caption,{numberOfLines:void 0,selected:!0,style:[b.regularTextStyles,b.bannerTextStyle]},e)),accessibilityLabel:e}}{const e=this._renderCallingEntitlement(),t=this._renderSubscriptions(),i=a.compact([e?e.accessibilityLabel:void 0,t.accessibilityLabel]),o=a.join(i,", ");return{element:n.createElement(n.View,{style:b.entitlementsContainer},e?e.element:void 0,t.element),accessibilityLabel:o}}}_renderActionButton(){return this.props.isFreeTrialAvailable?this._renderButton(f.GetFreeTrial):"credit_only"===this.props.userEntitlementsSummary?this._renderButton(f.GetSubscription):this._renderButton(f.GetCredit)}_renderButton(e){let t,i="";const a={buttonStyle:o.SXButtonStyle.Custom},s={textColor:u.Color.white};switch(e){case f.GetFreeTrial:t=u.AgnosticGradientFillButtonColors.green,i=l.getString("SkypeToPhonePanel.GetFreeTrialButton");break;case f.GetCredit:t=u.AgnosticGradientFillButtonColors.orange,i=l.getString("SkypeToPhonePanel.GetCreditButton");break;case f.GetSubscription:t=u.AgnosticGradientFillButtonColors.blue,i=l.getString("SkypeToPhonePanel.GetSubscriptionButton")}if(this._useAccessibleTheme()){const e=this._useDarkTheme();s.backgroundColor=e?u.Color.white:u.Color.black,s.textColor=e?u.Color.black:u.Color.white}else a.buttonStyle=o.SXButtonStyle.AgnosticGradientFill,a.agnosticGradientColor=t,a.gradientDirection=y.GradientDirection.BOTTOM_RIGHT;return{element:n.createElement(n.View,{blockPointerEvents:!0},n.createElement(d.default,Object.assign({title:i,backgroundStyle:T._buttonBackgroundStyles,buttonSize:o.SXButtonSize.Small,buttonConfig:s,allowTextWrap:!0,textStyleOverride:[b.regularTextStyles,b.buttonTextStyle,b.bannerTextStyle]},a))),accessibilityLabel:i}}_renderSubscriptions(){let e;e=this.props.subscriptionMinutes&&1===this.props.subscriptionsCount?-1===this.props.subscriptionMinutes?l.getString("SkypeToPhonePanel.SubscriptionUnlimited"):l.getString("SkypeToPhonePanel.SubscriptionMinutesLeft",{count:this.props.subscriptionMinutes||""}):l.getString("SkypeToPhonePanel.SubscriptionsCount",{count:this.props.subscriptionsCount});return{element:this._renderSmallBodyText(e),accessibilityLabel:e}}_renderCallingEntitlement(){if(this.props.formattedBalance){const e=l.getString("SkypeToPhonePanel.Credit",{amount:this.props.formattedBalance||""});return{element:this._renderSmallBodyText(e),accessibilityLabel:e}}}_renderSmallBodyText(e){return n.createElement(p.BodyText,{numberOfLines:1,bold:!0,size:o.BodyTextSize.SmallDeprecated},e)}}t.LayoutOptionNewCta=T,T._buttonBackgroundStyles={borderRadius:32,paddingLeft:12,paddingRight:12,paddingTop:7,paddingBottom:7},t.default=T},22962:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(31844),o=i(16778),s=i(88837),r=i(89391),l=i(39119),c=i(98278),d=i(4604),u=(i(59261),i(73367)),h=i(29130),p=i(34387);class g extends s.ComponentBase{_buildState(e,t){const i=d.default.getSubscriptions(),o=d.default.getCreditEntitlement(),s=u.default.getLoadedPersonalizedRecommendations();return{canRenderEntitlements:r.default.getS4LEntitlementFeatures().SCE.UserServices.Client.Features.UIEnabled,userFormattedBalance:l.getFormattedBalance(o),userSubscriptionsCount:i?a.size(i):0,hasActiveCreditEntitlements:l.hasUsableCredit(o),hasCallingEntitlements:d.default.userHasSubscriptions(),userEntitlementsSummary:l.getEntitlementCombination(o,i),subscriptionMinutes:1===a.size(i)?i[0].isUnlimited?-1:i[0].availableMinutes:void 0,isFreeTrialAvailable:s&&a.some(s.callingOffers,(e=>e.isFreeTrial)),isSmallDevice:h.default.isSmallDevice(c.MainRootViewId),isLandscape:void 0!==e.isLandscape?e.isLandscape:h.default.getDeviceOrientation(c.MainRootViewId)===n.DeviceOrientation.Landscape,shouldUseGPlayBilling:p.default.shouldUseGooglePlayBillingForCredit()||p.default.shouldUseGooglePlayBillingForSubscriptions()}}componentDidMount(){super.componentDidMount(),this.state.shouldUseGPlayBilling?p.default.requestUpdate():u.default.requestPersonalizedRecommendationsUpdate()}render(){const e=this.props.layoutComponent;return o.createElement(e,{experimentSettings:this.props.experimentSettings,userEntitlementsSummary:this.state.userEntitlementsSummary,formattedBalance:this.state.userFormattedBalance,subscriptionsCount:this.state.userSubscriptionsCount,hasActiveCreditEntitlements:this.state.hasActiveCreditEntitlements,hasCallingEntitlements:this.state.hasCallingEntitlements,subscriptionMinutes:this.state.subscriptionMinutes,isFreeTrialAvailable:this.state.isFreeTrialAvailable,isSmallDevice:this.state.isSmallDevice,isLandscape:this.state.isLandscape})}}t.default=g},19364:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(89391),o=i(96114),s=i(32516),r=i(90454),l=i(22962);class c extends o.LayoutExperiment{constructor(e){super(e,"SkypeToPhoneCard")}_getOptionFromConf(){return n.default.getS4LEntitlementFeatures().SCE.UserServices.Client.Experiments.SkypeToPhoneCard}render(){const e=this._getLayoutToDisplay();if(e)return a.createElement(l.default,Object.assign({layoutComponent:e,experimentSettings:this._getExperimentSettings()},this.props));if(this.props.defaultComponent){const e=this.props.defaultComponent;return a.createElement(e,Object.assign({experimentSettings:this._getExperimentSettings()},this.props))}return null}_getLayoutToDisplay(){return this._getOptionToDisplay()===o.ExperimentOption.NewCta?r.default:s.default}}t.default=c},5201:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GroupMemberHelper=void 0;const a=i(96486),n=i(16778),o=i(46096),s=i(33754),r=i(56644),l=i(1211),c=i(4899),d=i(78262),u="groupMemberHeader",h="groupMemberFooter",p="groupMember_";class g extends c.SearchSectionHelper{constructor(e=o.SearchResultsListGroup.GroupMember){super(),this._keys={footer:h,header:u},this._groupType=e}static _getKey(e){return p+e}static _getMri(e){return e}buildConfig(e,t,i){return{inactiveCallMemberMris:t.searchController.getGroupMemberResults(t.conversationId),searchQuery:i.trimmedNormalizedQuery,limit:3}}getItems(e,t,i,a,n){const r=o.SearchResultsListGroup.GroupMember,l={itemTemplate:"groupMember",header:s.getString("QuickCallPanel.GroupMembersNotOnCallSectionHeader",{count:this._searchConfig.inactiveCallMemberMris.length})},d=c.SearchSectionHelper.generateItemsLists({searchResultsListState:e,searchResultsListProps:t,groupType:r,sourceList:this._searchConfig.inactiveCallMemberMris,keys:this._keys,renderConfig:l,getKey:g._getKey,getMri:g._getMri,limit:3,onFooterPress:n}),u=d.defaultList||[];return e.isShowingMore[this._groupType]&&u.push(...d.listWithRestOfItems),d.footerItem&&u.push(d.footerItem),d.defaultList}renderItem(e){return e.item.key===u?c.SearchSectionHelper.renderHeader(s.getString("QuickCallPanel.GroupMembersNotOnCallSectionHeader",{count:this._searchConfig.inactiveCallMemberMris.length})):e.item.key===h?this._renderFooterItem(e.item):e.item.key.substr(0,p.length)===p?this._renderSearchResultItem(e):void 0}_renderFooterItem(e){return n.createElement(l.default,{shouldShowAllResults:e.isShowingMore,groupType:this._groupType,onShowMorePress:e.onPress})}_renderSearchResultItem(e){const t=e.item.key.substr(p.length),i=c.SearchSectionHelper.getSearchBaseItemProps(e,t),s={textToHighlight:this._searchConfig.searchQuery,highlightType:d.TextToHighlightType.DisplayName};return n.createElement(r.default,Object.assign({},i,{key:"groupMemberItem",mri:t,textToHighlightInfo:s,showLastCallInfo:!1,groupType:o.SearchResultsListGroup.GroupMember,onItemPress:e.item.onListItemClick||a.noop}))}}t.GroupMemberHelper=g},97822:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(2604),o=i(97691),s=i(19784),r=i(89391),l=i(37490),c=i(46096),d=i(36237),u=i(33754),h=i(78887),p=i(4735),g=i(81736),C=i(15414),m=i(40363),S=i(78262),y="phone",f="denied";const _=new class{canPrefillPhoneNumber(){return!!this._isPrefillPhoneNumberAndCodeEnabled()&&this._hasAtLeastOnePermission([S.PermissionType.ReadPhoneState,S.PermissionType.ReadSms])}canAutoSubmitCode(){return!!this._isPrefillPhoneNumberAndCodeEnabled()&&this._hasAtLeastOnePermission([S.PermissionType.ReadSms,S.PermissionType.ReceiveSms,S.PermissionType.SendSms])}startPhoneNumberVerificationFromManageSearchPanel(e,t){d.track(new C.PnvUIStartFromManageSearchPanel),this.startPhoneNumberVerification(e,t)}startPhoneNumberVerification(e,t){r.default.dangerouslyGetS4LSisuFeatures().enableMsaPhoneAccrual?this._startMsaPhoneAccrual(e,t):this._navigateToPnvEnterNumber(e,t)}_startMsaPhoneAccrual(e,t){h.default.displayMsaPhoneAccrualDialog(e,t)}_navigateToPnvEnterNumber(e,t){if(this._isPrefillPhoneNumberAndCodeEnabled()){if(g.default.permissionStatus(S.PermissionType.ReadSms)===n.PermissionStatus.Granted)d.track(new C.PnvUIStartTelemetryEvent(!0,!1,"sms")),p.default.navigateToPnvEnterNumber(t,e);else if(r.default.getOnboardingFeatures().features.showPrefillPhoneNumberPrompt)this._prepromptUserForPermission(t,e);else{const i=g.default.permissionStatus(S.PermissionType.ReadPhoneState)===n.PermissionStatus.Granted?y:f;d.track(new C.PnvUIStartTelemetryEvent(!0,!1,i)),p.default.navigateToPnvEnterNumber(t,e)}}else m.default.getPlatformType()===c.PlatformType.Android&&d.track(new C.PnvUIStartTelemetryEvent(!1,!1)),p.default.navigateToPnvEnterNumber(t,e)}_prepromptUserForPermission(e,t){l.dismissAll();const i=[{text:u.getString("CapturePermissions.PrePromptCancelButtonTitle"),isCancel:!0,onPress:()=>{this._prePromptCancelled(t,e)}},{text:u.getString("CapturePermissions.PrePromptAcceptButtonTitle"),isSubmit:!0,onPress:()=>{this._promptUserForPermissions(t,e)}}],a=u.getString("AudioVideoSettings.CameraPermissionCallToAction"),n=u.getString("PhoneNumberVerification.AutoDetectSMSCodeText");s.default.showWithOptions({title:a,dialogAccessibilityTitle:n,message:n,buttons:i,useHorizontalButtons:!0,rootViewId:t,useFocussedWindowFallback:!0})}_prePromptCancelled(e,t){const i=g.default.permissionStatus(S.PermissionType.ReadPhoneState)===n.PermissionStatus.Granted?"canceled-phone":"canceled";d.track(new C.PnvUIStartTelemetryEvent(!0,!0,i)),p.default.navigateToPnvEnterNumber(t,e)}_promptUserForPermissions(e,t){let i=g.default.permissionStatus(S.PermissionType.ReadSms)===n.PermissionStatus.Granted,a=g.default.permissionStatus(S.PermissionType.ReadPhoneState)===n.PermissionStatus.Granted;o.Resolved().then((()=>{if(!i)return this._requestPermission(S.PermissionType.ReadSms).then((e=>{i=e}))})).then((()=>{if(!i)return this._requestPermission(S.PermissionType.ReadPhoneState).then((e=>{a=e}))})).then((()=>{let n=f;i?n="sms":a&&(n=y),d.track(new C.PnvUIStartTelemetryEvent(!0,!0,n)),p.default.navigateToPnvEnterNumber(t,e)}))}_isPrefillPhoneNumberAndCodeEnabled(){return r.default.getOnboardingFeatures().features.enablePrefillPhoneNumberAndCode&&m.default.getPlatformType()===c.PlatformType.Android}_requestPermission(e){return g.default.requestPermission(e,S.PermissionPromptOptions.SkipPrePrompt|S.PermissionPromptOptions.PromptAgainIfDenied).then((e=>o.Resolved(e===n.PermissionStatus.Granted)))}_hasAtLeastOnePermission(e){let t=!1;return a.each(e,(e=>g.default.permissionStatus(e)!==n.PermissionStatus.Granted||(t=!0,!1))),t}};t.default=_},33727:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PstnDialpadHelper=t.PstnDialpadItem=void 0;const a=i(16778),n=i(88837),o=i(46096),s=i(81722),r=i(66649),l=i(15877),c=i(4899),d=i(19364),u="dialpad",h="dialpadSpacer",p=(0,l.lazyProperties)({spacer:()=>a.Styles.createViewStyle({height:10})});class g extends n.ComponentBase{_buildState(e,t){return{disableHighBandwidthOperations:r.default.isUsingGogoNetwork()}}requestFocus(){}render(){return a.createElement(d.default,{location:s.ExperimentLocation.CallsPanel})}}t.PstnDialpadItem=g;class C extends c.SearchSectionHelper{constructor(){super()}buildConfig(e,t,i){}getItems(e,t,i,a){const n=[];return n.push({key:u,height:56,measureHeight:!0,template:"dialpad",isLastItem:!0,groupType:o.SearchResultsListGroup.PstnDialpad,onListItemClick:t.onListItemClick,isHoverable:!1}),n}renderItem(e){return e.item.key===u?this._renderDialpadItem(e):e.item.key===h?this._renderSpacer():void 0}_renderSpacer(){return a.createElement(a.View,{key:h,style:p.spacer})}_renderDialpadItem(e){return a.createElement(g,Object.assign({},e))}}t.PstnDialpadHelper=C},58735:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RecentCallsHelper=void 0;const a=i(96486),n=i(16778),o=i(71830),s=i(46096),r=i(15877),l=i(33754),c=i(1452),d=i(39543),u=i(34273),h=i(56644),p=i(4899),g=i(78262),C=i(72758),m="recentCallsHeader",S="recentCall_",y="noCallsItemKey",f=(0,r.lazyProperties)({noCallsContainer:()=>n.Styles.createViewStyle({paddingLeft:12,paddingRight:12,paddingTop:20,paddingBottom:20})}),_={header:m};class b extends p.SearchSectionHelper{constructor(e){super(),this._useExtendedCallCount=e}static _getKey(e){return S+e}static _getMri(e){return e}buildConfig(e,t,i){return{localPhoneContacts:d.mapLocalContactsByMri(t.searchController.getAddressBookResults()),conversationIds:t.searchController.getRecentCallsResults(),isSyncAddressBookEnabled:i.isSyncAddressBookEnabled,limit:this._useExtendedCallCount?50:20,searchQuery:i.trimmedNormalizedQuery,upcomingCallsCount:u.default.ScheduledCallsStore.getUpcomingScheduledCalls().length}}getItems(e,t){const i=this._useExtendedCallCount?s.SearchResultsListGroup.RecentCallsExtended:s.SearchResultsListGroup.RecentCalls;if(0===this._searchConfig.conversationIds.length&&0===this._searchConfig.upcomingCallsCount&&!t.hideEmptyState)return[{index:0,isLastItem:!0,key:y,height:c.default.getDefaultHeight(),measureHeight:!0,template:"noCalls",groupType:i}];const n={itemTemplate:"call",header:l.getString("QuickCallPanel.RecentCallsSectionHeader"),hideHeader:this._useExtendedCallCount};return p.SearchSectionHelper.generateItemsLists({searchResultsListState:e,searchResultsListProps:t,groupType:i,sourceList:a.take(this._searchConfig.conversationIds,this._searchConfig.limit),keys:_,renderConfig:n,getKey:b._getKey,getMri:b._getMri}).defaultList}renderItem(e){return e.item.key===m?p.SearchSectionHelper.renderHeader(l.getString("QuickCallPanel.RecentCallsSectionHeader")):e.item.key.substr(0,S.length)===S?this._renderSearchResultItem(e):e.item.key===y?this._renderNoCallsItem():void 0}_getNoCallsTitle(){return l.getString("RecentCallsHelper.NoRecentCallsTitleDesktop")}_renderNoCallsItem(){let e;return e=l.getString("RecentCallsHelper.NoRecentCallsDescriptionDesktop"),n.createElement(n.View,{style:f.noCallsContainer,key:"noCallsItem"},n.createElement(c.default,{infoLabel:e,title:this._getNoCallsTitle()}))}_renderSearchResultItem(e){const t=e.item.key.substr(S.length),i=p.SearchSectionHelper.getSearchBaseItemProps(e,t);let r={key:"recentCallItem",mri:C.default.getConversationOwner(t),origin:e.origin,pstnMri:o.isPhoneMri(t)?t:void 0,showLastCallInfo:!0,onItemPress:e.item.onListItemClick||a.noop};if(o.isPhoneMri(t)){const e=this._searchConfig.localPhoneContacts[t];e&&(r.addressBookContactOverride=e,r.isAddressBookContact=!0)}const l={textToHighlight:this._searchConfig.searchQuery,highlightType:g.TextToHighlightType.DisplayName};return n.createElement(h.default,Object.assign({},i,r,{textToHighlightInfo:l,groupType:this._useExtendedCallCount?s.SearchResultsListGroup.RecentCallsExtended:s.SearchResultsListGroup.RecentCalls}))}}t.RecentCallsHelper=b},39543:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mapLocalContactsByMri=void 0;const a=i(96486),n=i(71830),o=i(27683);t.mapLocalContactsByMri=function(e){const t={},i=a.compact(a.map(e,(e=>e.addressBookContact)));return a.each(i,(e=>{e&&a.each(e.phones,(i=>{if(o.default.isValidNumberString(i.number)){const a=n.getMriFromPhoneNumber(i);t[a]=e}}))})),t}},33289:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(9520),n=i(5531),o=i(46096),s=i(36237),r=i(33754),l=i(93194),c=i(53374),d="LeaveCall",u="EndCallForEveryOne";class h{static selectEndCallMenuItem(e,t,i){const n=c.default.newCauseId();switch(s.log(o.LogTraceArea.CallingUI,"CallControlsEndCallContextMenu.selectEndCallMenuItem causeId: "+n),l.default.dismiss(h._endCallMenuId,t),e){case u:i(!0,n),s.track(new a.EndCallPopupMenuActionsEvent(a.EndCallPopupActions.EndCallForEveryone));break;case d:i(!1,n),s.track(new a.EndCallPopupMenuActionsEvent(a.EndCallPopupActions.LeaveCall))}}static _getEndCallMenuConfig(e){return{anchor:e,useTheme:!0,positionPriorities:["top","bottom"],popupBeakSize:{height:0,width:0},popupOffset:{x:0,y:-10}}}}t.default=h,h._endCallMenuId=l.default.menuId(),h.showEndCallMenuPopup=(e,t,i,n)=>{const o=h._getEndCallMenuConfig(i);l.default.showWithOptions({id:h._endCallMenuId,config:o,getMenuItems:h._getEndCallMenuItems,handleMenuCommand:n,rootViewId:e,invokingEvent:t})&&s.track(new a.EndCallPopupMenuActionsEvent(a.EndCallPopupActions.EndCallPopupShown))},h._getEndCallMenuItems=()=>{let e=[];return e.push({text:r.getString("CallControls.LeaveCall"),command:d}),n.default.call().canEndCallForAll&&e.push({text:r.getString("CallControls.HangupAllMessageDesktop"),command:u}),e}},25207:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(94224),o=i(9520),s=i(2278),r=i(80200),l=i(71727),c=i(98278),d=i(46096),u=i(36237),h=i(33754),p=i(4735),g=i(17093),C=i(99189),m=i(54306),S=i(93194),y=i(53374),f=i(13125),_="TurnOffVideo",b="Mute",T="Unmute",v="BlurBackground",w="UnblurBackground",I="CropVideo",P="FullVideo",M="BackgroundEffectsSettings",k="LowerHand",A="PinParticipant",R="UnpinParticipant";t.default=class{constructor(e){this._callLocalVideoContextMenuOptions=e,this._getActionsMenuConfig=e=>({anchor:e,useTheme:!0,positionPriorities:["top","bottom"],popupBeakSize:{height:0,width:0}}),this._getCallLocalVideoMenuItems=()=>{let e=[],t=this._getCameraMenuItems(),i=this._getOtherMenuItems();return t.length&&e.push({key:"cameraSwitching",menuItems:t}),e.push({key:"otherSettings",menuItems:i}),e},this._getCameraMenuItems=()=>{let e=[],t=n.default.DeviceStore.getCameras(),i=this._getSelectedCameraId();return a.each(t,(t=>{e.push({text:t.label,command:t.id,selected:this._localVideoOn&&t.id===i,selectableType:c.SXMenuItemSelectableType.Checkbox})})),e.push({text:h.getString("CallControls.CallButtonTurnOffVideoLabel"),command:_,selected:!this._localVideoOn,selectableType:c.SXMenuItemSelectableType.Checkbox}),e},this._getOtherMenuItems=()=>{const e=[],t=l.default.isLocalOrServerMuted(this._callLocalVideoContextMenuOptions.callId);if(this._localVideoOn&&n.default.DeviceStore.isBackgroundBlurCapable()&&!n.default.DeviceStore.isBackgroundReplacementEnabled()){const t=n.default.DeviceStore.isBackgroundBlurred();e.push({text:t?h.getString("CallControls.CallMenuUnBlurBackground"):h.getString("CallControls.CallMenuBlurBackground"),command:t?w:v})}return this._localVideoOn&&n.default.DeviceStore.isBackgroundReplacementEnabled()&&e.push({text:h.getString("CallControlsOverFlowMenu.BackgroundEffectsSettings"),command:M}),e.push({text:t?h.getString("CallControls.CallMenuUnmuteMicrophone"):h.getString("CallControls.CallMenuMuteMicrophone"),command:t?T:b}),this._callLocalVideoContextMenuOptions.showLowerHand&&e.push({text:h.getString("CallControls.LowerHand"),command:k}),this._callLocalVideoContextMenuOptions.showCropUncropMenuOption&&!a.isUndefined(this._callLocalVideoContextMenuOptions.sizeToFit)&&(this._callLocalVideoContextMenuOptions.sizeToFit?e.push({text:h.getString("CallControls.ShowCroppedVideo"),command:I}):e.push({text:h.getString("CallControls.ShowFullVideo"),command:P})),this._callLocalVideoContextMenuOptions.showPinOption&&this._callLocalVideoContextMenuOptions.isGroupCall&&e.push({text:h.getString("CallControls.PinParticipant"),command:A}),this._callLocalVideoContextMenuOptions.showUnpinOption&&this._callLocalVideoContextMenuOptions.isGroupCall&&e.push({text:h.getString("CallControls.UnpinParticipant"),command:R}),e},this._selectMenuItem=(e,t,i)=>{const c=y.default.newCauseId();u.log(d.LogTraceArea.CallingUI,"CallLocalVideoContextMenu._selectMenuItem"+e+" causeId: "+c);let h=n.default.DeviceStore.getCameras();switch(a.each(h,(t=>{if(t.id===e)return t.id!==this._getSelectedCameraId()&&(n.default.DeviceStore.choosePreferredDevices({camera:e},c),u.track(new o.LocalVideoActionsEvent(o.LocalVideoActions.SwitchCamera))),void(this._localVideoOn||(n.default.CallingStore.startVideo(this._callLocalVideoContextMenuOptions.callId,c),u.track(new o.LocalVideoActionsEvent(o.LocalVideoActions.TurnOnVideo))))})),e){case _:this._localVideoOn&&(n.default.CallingStore.stopVideo(this._callLocalVideoContextMenuOptions.callId,c),u.track(new o.LocalVideoActionsEvent(o.LocalVideoActions.TurnOffVideo)));break;case b:n.default.CallingStore.mute(this._callLocalVideoContextMenuOptions.callId,c),l.default.announceMicrophoneState(!0),s.default.updateCallTelemetry(this._callLocalVideoContextMenuOptions.callId,c,(e=>e.muteLocalVideoContextMenuPress())),u.track(new o.LocalVideoActionsEvent(o.LocalVideoActions.Mute));break;case T:n.default.CallingStore.unmute(this._callLocalVideoContextMenuOptions.callId,c),l.default.announceMicrophoneState(!1),s.default.updateCallTelemetry(this._callLocalVideoContextMenuOptions.callId,c,(e=>e.muteLocalVideoContextMenuPress())),u.track(new o.LocalVideoActionsEvent(o.LocalVideoActions.Unmute));break;case v:n.default.DeviceStore.setBackgroundBlurred(!0),u.track(new o.LocalVideoActionsEvent(o.LocalVideoActions.BackgroundBlur));break;case w:n.default.DeviceStore.setBackgroundBlurred(!1),u.track(new o.LocalVideoActionsEvent(o.LocalVideoActions.BackgroundUnBlur));break;case I:i&&i(!1);break;case P:i&&i(!0);break;case M:this._showAVSettings(t);break;case k:new C.LowerHandCommand(this._callLocalVideoContextMenuOptions.callId,m.LowerHandOrigin.OverflowMenu).execute();break;case A:case R:new f.PinUnpinCommand(r.CallStageElementKeys.localUserKey,this._callLocalVideoContextMenuOptions.callId).execute()}},this._showCallLocalVideoMenuPopup=(e,t,i,a)=>{const n=this._getActionsMenuConfig(i);S.default.showGroupWithOptions({id:this._callLocalVideoMenuId,config:n,getMenuGroups:this._getCallLocalVideoMenuItems,handleMenuCommand:a,rootViewId:e,invokingEvent:t})&&u.track(new o.LocalVideoActionsEvent(o.LocalVideoActions.PopupShown))},this._getSelectedCameraId=()=>{const e=n.default.DeviceStore.getCurrentDevices();return null==e?void 0:e.camera},this._showAVSettings=e=>{const t=y.default.newCauseId();u.log(d.LogTraceArea.CallingUI,"CallLocalVideContextMenu._showAVSettings causeId: "+t),p.default.navigateToDesktopSettingsGroup(g.SettingsGroup.AudioVideoSettings,e,t)},this._callLocalVideoMenuId=S.default.menuId(),this._localVideoOn=n.default.CallingStore.isProvidingVideo(this._callLocalVideoContextMenuOptions.callId)}showContextMenu(e,t,i,a){!!this._callLocalVideoContextMenuOptions.conversationMri&&n.default.CallingFeaturesHelper.allowOutboundVideo({isPSTNCall:n.default.CallingStore.isPSTNCall(this._callLocalVideoContextMenuOptions.callId),isEncryptedCall:n.default.CallingStore.isEncryptedCall(this._callLocalVideoContextMenuOptions.callId),conversationMri:this._callLocalVideoContextMenuOptions.conversationMri,callId:this._callLocalVideoContextMenuOptions.callId})?this._showCallLocalVideoMenuPopup(e,t,i,(t=>this._selectMenuItem(t,e,a))):u.log(d.LogTraceArea.CallingUI,"CallLocalVideoContextMenu allowOutboundVideo is false")}}},37034:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(97691),n=i(50781),o=i(94224),s=i(78536),r=i(66020),l=i(33754),c=i(93194);t.default=new class{showForSkypeMri(e,t,i,a,n,o,s,l,c,d,u,h,p){r.default.showForSkypeMri(e,t,i,a,n,o,s,l,c,d,u,h,p)}showForPhoneNumber(e,t,i,a,n){r.default.showForPhoneNumber(e,t,i,a,n)}showForAddressContact(e,t,i,a,n,o,s,l,c,d){r.default.showForAddressContact(e,t,i,a,n,o,s,l,c,d)}startCallOrMaybePrompt(e,t,i,d,u,h){const p=(e,t)=>o.default.CallNavigationHelper.startCall({conversationMri:e,withVideo:t,origin:i.callOrigin,openInMainWindow:u,view:h},d),g=i=>{const n=[{text:l.getString("CallOrInviteMenu.UnencryptedCallAlertYes"),command:""}],o={anchor:e,buttons:n,positionPriorities:["bottom"],title:i?l.getString("CallOrInviteMenu.UnencryptedVideoCallAlertTitle"):l.getString("CallOrInviteMenu.UnencryptedAudioCallAlertTitle"),message:i?l.getString("CallOrInviteMenu.UnencryptedVideoCallAlertBody"):l.getString("CallOrInviteMenu.UnencryptedAudioCallAlertBody"),cancelButtonTitle:l.getString("CallOrInviteMenu.UnencryptedCallAlertNo"),cancelButtonPosition:c.CancelButtonPosition.End,destructiveButtonIndex:0},s=a.Defer();return c.default.showWithActionMenuConfig({options:o,callback:e=>{e!==c.SXActionMenuCancel?s.resolve(void 0):s.reject()},rootViewId:t,useAlertForDesktop:!0,useAlertForMobile:!1,invokingEvent:void 0}),s.promise()},C=(e,t,a)=>o.default.CallNavigationHelper.answerOrJoinCall({conversationMri:e,callId:t,withVideo:a,origin:i.callOrigin,isTwinCam:i.showTwinCam,openInMainWindow:u,view:h},d),m=(e,t,a)=>o.default.CallPreviewUtils.answerOrJoinCall({conversationMri:e,callId:t,withVideo:a,origin:i.callOrigin,isTwinCam:i.showTwinCam},d),S=(a,n,o,s,l,c,d,u)=>{r.default.showForSkypeMri(e,t,a,n,o,i.inviteOrigin,i.callOrigin,s,l,c,d,u,i.popupTitleOverride)},y=(a,n,o)=>{r.default.showForAddressContact(e,t,a,i.inviteOrigin,i.callOrigin,n,o,!1)};return n.default.loadCallingBundle().then((()=>s.default.startCallOrMaybePromptHelper(i,p,C,m,S,y,g,d)))}}},19463:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(89391),n=i(20187),o=i(47094),s=i(47176),r=i(9520),l=i(71727),c=i(98278),d=i(46096),u=i(36237),h=i(33754),p=i(4735),g=i(98053),C=i(99189),m=i(54306),S=i(93194),y=i(53374),f=i(13125),_="RemoveFromCall",b="Mute",T="CropVideo",v="FullVideo",w="SendMessage",I="ViewProfile",P="MuteEveryone",M="LowerHand",k="ChangeTogetherModeBackground",A="PinParticipant",R="UnpinParticipant";t.default=class{constructor(e){this._callParticipantContextMenuOptions=e,this._selectUserNameChevronMenuItem=(e,t,i)=>{this._selectCanvasAndRibbonActionsMenuItem(e,t,i)},this._getCanvasAndRibbonActionsMenuConfig=e=>({anchor:e,useTheme:!0,positionPriorities:["top","bottom"],popupBeakSize:{height:0,width:0}}),this._getCallParticipantMenuItems=()=>{let e=[];return this._callParticipantContextMenuOptions.showMute&&e.push({text:h.getString("CallControls.CallButtonMute"),command:b,disabled:!this._callParticipantContextMenuOptions.isMuteOptionDisabled}),this._callParticipantContextMenuOptions.showRemoveCall&&e.push({text:h.getString("CallControls.RemoveFromCall"),command:_}),this._callParticipantContextMenuOptions.showCropVideoOption?e.push({text:h.getString("CallControls.ShowCroppedVideo"),command:T}):this._callParticipantContextMenuOptions.showFullVideoOption&&e.push({text:h.getString("CallControls.ShowFullVideo"),command:v}),this._callParticipantContextMenuOptions.showLowerHandOption&&a.default.getS4LCMCFeatures().enableCallLowerHandByOthers&&l.default.canHandBeLoweredForParticipant(this._callParticipantContextMenuOptions.callId,this._callParticipantContextMenuOptions.userMri)&&e.push({text:h.getString("CallControls.LowerHand"),command:M}),this._callParticipantContextMenuOptions.showChangeTogetherModeBackgroundOption&&e.push({text:h.getString("CallControlsOverFlowMenu.ChangeTogetherModeBackground"),command:k}),this._callParticipantContextMenuOptions.showPinOption&&e.push({text:h.getString("CallControls.PinParticipant"),command:A}),this._callParticipantContextMenuOptions.showUnpinOption&&e.push({text:h.getString("CallControls.UnpinParticipant"),command:R}),e},this._getMenuItemsRelatedToOutsideTheCall=()=>{let e=[];return this._callParticipantContextMenuOptions.showSendMessageMenuOption&&e.push({text:h.getString("CallControls.SendMessageFromParticipantMenuAccessibilityLabel"),command:w}),this._callParticipantContextMenuOptions.showViewProfile&&e.push({text:h.getString("GroupProfilePanel.ViewInfo"),command:I}),e},this._getMenuItemsRelatedToModeratedChat=()=>{let e=[];return this._callParticipantContextMenuOptions.showMuteEveryone&&e.push({text:h.getString("CallControls.CallButtonMuteEveryone"),command:P}),e},this._getCanvasAndRibbonActionsMenuItems=()=>{const e=[],t=this._getCallParticipantMenuItems(),i=this._getMenuItemsRelatedToOutsideTheCall(),a=this._getMenuItemsRelatedToModeratedChat();return t.length>0&&e.push({key:"menuItemsCallParticipant",menuItems:t,title:void 0}),i.length>0&&e.push({key:"menuItemsRelatedToOutsideTheCall",menuItems:i}),a.length>0&&e.push({key:"menuItemsRelatedToModeratedChat",menuItems:a}),e},this._selectCanvasAndRibbonActionsMenuItem=(e,t,i)=>{const a=y.default.newCauseId();switch(u.log(d.LogTraceArea.CallingUI,"CallParticipantActionsContextMenu._selectCanvasAndRibbonActionsMenuItem causeId: "+a),e){case I:p.default.showDetailsPanelWithParams({mri:this._callParticipantContextMenuOptions.userMri,rootViewId:c.MainRootViewId,causeId:a}),u.track(new r.CanvasAndRibbonActionsEvent(r.CanvasAndRibbonActions.ViewProfile));break;case _:s.default.handleRemoteHangup(this._callParticipantContextMenuOptions.userMri,this._callParticipantContextMenuOptions.callId,a),u.track(new r.CanvasAndRibbonActionsEvent(r.CanvasAndRibbonActions.RemoveFromCall));break;case b:s.default.handleRemoteMute(this._callParticipantContextMenuOptions.userMri,this._callParticipantContextMenuOptions.callId,a),u.track(new r.CanvasAndRibbonActionsEvent(r.CanvasAndRibbonActions.Mute));break;case P:new n.MuteEveryoneCommand(this._callParticipantContextMenuOptions.callId).execute(),u.track(new r.CallMuteEveryoneEvent(r.MuteEveryoneOrigin.OverflowMenu));break;case T:if(i){new o.default(i).execute()}break;case v:if(i){new o.FullVideoCommand(i).execute()}break;case w:(new o.SendMessageCommand).execute(this._callParticipantContextMenuOptions.userMri);break;case M:new C.LowerHandParticipantCommand(this._callParticipantContextMenuOptions.callId,this._callParticipantContextMenuOptions.userMri,m.LowerHandOrigin.OverflowMenu,this._callParticipantContextMenuOptions.isLocal,this._callParticipantContextMenuOptions.displayName).execute();break;case k:new g.ChangeTogetherModeBackgroundCommand(this._callParticipantContextMenuOptions.callId,this._callParticipantContextMenuOptions.conversationMri).execute();break;case A:case R:new f.PinUnpinCommand(this._callParticipantContextMenuOptions.userMri,this._callParticipantContextMenuOptions.callId).execute()}},this._showCanvasAndRibbonActionsMenuPopup=(e,t,i,a,n,o)=>{const s=this._getCanvasAndRibbonActionsMenuConfig(i);S.default.showGroupWithOptions({id:this._canvasAndRibbonActionsMenuId,config:s,getMenuGroups:this._getCanvasAndRibbonActionsMenuItems,handleMenuCommand:a,onDismiss:o,maintainTitleForMobile:!0,cancelButtonTitleIOS:h.getString("Global.CancelLabel"),rootViewId:e,invokingEvent:t})&&(n&&n(),u.track(new r.CanvasAndRibbonActionsEvent(r.CanvasAndRibbonActions.PopupShown)))},this._canvasAndRibbonActionsMenuId=S.default.menuId()}showContextMenu(e,t,i,a,n,o){this._showCanvasAndRibbonActionsMenuPopup(e,t,i,(e=>this._selectUserNameChevronMenuItem(e,n,o)),a,n)}}},88717:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(15069),o=i(63413),s=i(20187),r=i(25207),l=i(19463),c=i(80200),d=i(71830),u=i(39549),h=i(73145),p=i(33790),g=i(44972),C=i(71727);t.default=new class{getCallLocalVideoContextMenuOptions(e,t,i,n,o,s){return{callId:e,conversationMri:t,isGroupCall:!!t&&d.isGroupConversation(t),sizeToFit:!a.isUndefined(o)&&o,isCompact:!!i,videoStatus:n,isCropVideoEnabledOnGroupCall:!0,isCropVideoEnabledOn1On1Call:!0,showCropUncropMenuOption:!1,showLowerHand:s,showPinOption:C.default.shouldShowCallParticipantPinOption(c.CallStageElementKeys.localUserKey,e),showUnpinOption:C.default.shouldShowCallParticipantUnpinOption(c.CallStageElementKeys.localUserKey,e)}}getShowCropUncropMenuOption(e,t,i){let a=!0;return(n.BrowserEnvironment.isEngineEdgeHTML()||e||t!==c.VideoStatus.Streaming||i)&&(a=!1),a}getMenuOptionEnabled(e){let t=!1,i=!1,n=!1,r=!1,l=!1,c=!1,h=!1;const p=new s.MuteEveryoneCommand(e.callId).canExecute(),C=(0,u.default)().getConversation(e.conversationMri),m=e.isGroupCall&&!e.isCropVideoEnabledOnGroupCall||!e.isGroupCall&&!e.isCropVideoEnabledOn1On1Call;if(t=this.getShowCropUncropMenuOption(m,e.videoStatus,e.isCompact),!e.isLocal&&e.isGroupCall){n=!0,i=!0;const{showChangeTogetherModeBackgroundOption:a}=e;a?(i=!1,n=!1,t=!1):(0,g.isRegularMemberInModeratedGroup)(C)&&(i=!1,n=!1)}return!e.showSendMessageMenuOption||e.isLocal||!e.isGroupCall||o.default.isMriBlocked(e.userMri)||d.isGuestUserMri(e.userMri)||(l=!0),i&&e.isLocalMuteSupported&&e.isServerMutedSupported&&!e.isMuted&&(r=!0),t&&!a.isUndefined(e.sizeToFit)&&(e.sizeToFit?c=!0:h=!0),{isMuteOptionDisabled:r,showMute:i,showMuteEveryone:p,showRemoveCall:n,showCropUncropMenuOption:t,showSendMessageMenuOption:l,showCropVideoOption:c,showFullVideoOption:h}}showParticipantActionsContextMenuOnPosition(e,t,i,n,o,s){p.default.setAnchorPosition(e),a.defer((()=>{const a=h.default.getMenuTargetCallback(t),r=this.getMenuOptionEnabled(i);i.isMuteOptionDisabled=r.isMuteOptionDisabled,i.showMute=r.showMute,i.showMuteEveryone=r.showMuteEveryone,i.showRemoveCall=r.showRemoveCall,i.showCropUncropMenuOption=r.showCropUncropMenuOption,i.showSendMessageMenuOption=r.showSendMessageMenuOption,i.showCropVideoOption=r.showCropVideoOption,i.showFullVideoOption=r.showFullVideoOption;new l.default(i).showContextMenu(t,{pageX:e.x,pageY:e.y},a,n,o,i.showCropUncropMenuOption?s:void 0)}))}showParticipantActionsContextMenu(e,t,i,n,o,s){e.stopPropagation(),e.preventDefault();const r=a.pick(e,"pageX","pageY");this.showParticipantActionsContextMenuOnPosition({x:r.pageX||0,y:r.pageY||0},t,i,n,o,s)}showLocalVideoActionsContextMenuOnPosition(e,t,i,n){p.default.setAnchorPosition(e),a.defer((()=>{const a=h.default.getMenuTargetCallback(t),o=new r.default(i),s=i.isGroupCall&&!i.isCropVideoEnabledOnGroupCall||!i.isGroupCall&&!i.isCropVideoEnabledOn1On1Call;i.showCropUncropMenuOption=this.getShowCropUncropMenuOption(s,i.videoStatus,i.isCompact),o.showContextMenu(t,{pageX:e.x,pageY:e.y},a,i.showCropUncropMenuOption?n:void 0)}))}showLocalVideoActionsContextMenu(e,t,i,n){e.stopPropagation(),e.preventDefault();const o=a.pick(e,"pageX","pageY");this.showLocalVideoActionsContextMenuOnPosition({x:o.pageX||0,y:o.pageY||0},t,i,n)}}},47094:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SendMessageCommand=t.FullVideoCommand=void 0;const a=i(9520),n=i(76621),o=i(46096),s=i(36237),r=i(4735),l=i(14976),c=i(53374);t.default=class{constructor(e){this._onToggleCropVideo=e}execute(){s.log(o.LogTraceArea.Calling,"CropVideoCommand.execute."),this._onToggleCropVideo(!1)}};t.FullVideoCommand=class{constructor(e){this._onToggleCropVideo=e}execute(){s.log(o.LogTraceArea.Calling,"FullVideoCommand.execute."),this._onToggleCropVideo(!0)}};t.SendMessageCommand=class{execute(e){n.default.ensureConversationLoadedOrFaked(e,o.ConversationFakedOrigin.CallParticipantActionMenu).then((t=>{const i=c.default.newCauseId();s.log(o.LogTraceArea.Calling,"SendMessageCommand.execute, causeId: "+i+" user mri:"+l.mriOrId(e)),r.default.navigateToConversation({convId:e,origin:o.NavigationConversationOrigin.CallParticipantActionMenu,isNewConversation:t,causeId:i}),s.track(new a.CanvasAndRibbonActionsEvent(a.CanvasAndRibbonActions.SendMessage))}))}}},85107:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SubtitleMaxWidthV2=t.SubtitleMaxWidth=t.SubtitleMaxPreviewLines=t.SenderAvatarSize=void 0;const a=i(67977),n=i(53374),o={desktop:{portrait:{preview:{isHorizontal:!0,sizeRatio:.7},interactive:{isHorizontal:!0,sizeRatio:.5}},landscape:{preview:{isHorizontal:!0,sizeRatio:.7},interactive:{isHorizontal:!1,fixedSize:300,sizeRatio:0}}},mobile:{portrait:{preview:{isHorizontal:!0,sizeRatio:.65},interactive:{isHorizontal:!0,sizeRatio:.5}},landscape:{preview:{isHorizontal:!0,sizeRatio:.8},interactive:{isHorizontal:!1,sizeRatio:.5}}}};t.SenderAvatarSize=a.UserIconSize.Size24,t.SubtitleMaxPreviewLines=4,t.SubtitleMaxWidth=500,t.SubtitleMaxWidthV2=600;class s{static getTranscriptionLayout(e,t,i){const a=t?o.mobile:o.desktop,n=i?a.landscape:a.portrait;return e?n.interactive:n.preview}static getTranscriptionLayoutRects(e,t){const i=t.fixedSize?s.shrinkRectByAmount(e,t.fixedSize,t.isHorizontal):s.shrinkRectByRatio(e,t.sizeRatio,t.isHorizontal);let a=i.remainderRect;if(t.paddingSize){const e=s.shrinkRectByAmount(a,t.paddingSize,!t.isHorizontal).shrinkedRect;a={x:t.isHorizontal?e.x+t.paddingSize:e.x,y:t.isHorizontal?e.y:e.y+t.paddingSize,width:e.width,height:e.height}}return{stage:i.shrinkedRect,subtitles:a,isHorizontal:t.isHorizontal}}static shrinkRectByRatio(e,t,i){t=n.default.clampValue(t,0,1);const a=Math.floor((i?e.height:e.width)*t);return s.shrinkRectByAmount(e,a,i)}static shrinkRectByAmount(e,t,i){t=n.default.clampValue(t,0,i?e.height:e.width);const a=i?{x:e.x,y:e.y,width:e.width,height:e.height-t}:{x:e.x,y:e.y,width:e.width-t,height:e.height};return{shrinkedRect:a,remainderRect:i?{x:e.x,y:a.y+a.height,width:e.width,height:e.height-a.height}:{x:a.x+a.width,y:e.y,width:e.width-a.width,height:e.height}}}}t.default=s},74984:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(31844),o=i(16778),s=i(89391),r=i(94224),l=i(9520),c=i(2278),d=i(80200),u=i(71727),h=i(98278),p=i(46096),g=i(36237),C=i(15877),m=i(33754),S=i(93194),y=i(53374),f="ribbonettingspopup";var _;!function(e){e.Speaker="speaker",e.Content="content",e.Grid="grid",e.TogetherMode="togetherMode",e.LargeGrid="largeGrid",e.Window="window",e.Float="float",e.Presentation="presentation",e.EnterFullScreen="enterFullScreen",e.ExitFullScreen="exitFullScreen"}(_||(_={}));const b={[_.Speaker]:d.StageMode.Speaker,[_.Presentation]:d.StageMode.Presentation,[_.Content]:d.StageMode.FocusedScreenShare,[_.Grid]:d.StageMode.Grid,[_.TogetherMode]:d.StageMode.TogetherMode,[_.LargeGrid]:d.StageMode.LargeGrid},T={[_.Speaker]:l.CallViewMenuActions.SwitchToSpeaker,[_.Presentation]:l.CallViewMenuActions.SwitchToPresentation,[_.Content]:l.CallViewMenuActions.SwitchToContent,[_.Grid]:l.CallViewMenuActions.SwitchToModernGrid,[_.TogetherMode]:l.CallViewMenuActions.SwitchToTogetherMode,[_.LargeGrid]:l.CallViewMenuActions.SwitchToLargeGallery},v=(0,C.lazyProperties)({menuContainerStyles:()=>o.Styles.createViewStyle({paddingVertical:20,paddingBottom:10}),menuButtonStyles:()=>o.Styles.createButtonStyle({borderLeftWidth:0,paddingHorizontal:20})});class w{static show(e,t,i,n,o,s,r,l,c,d,u,h){const p={anchor:n,useTheme:!0,popupBeakSize:{height:0,width:0},popupOffset:{x:0,y:5},positionPriorities:["bottom","left"],menuStyles:{menuContainerStyles:v.menuContainerStyles,menuButtonStyles:v.menuButtonStyles},onCallPanelHeaderLayoutChange:i,changeCallLayoutCommand:h,hasIncomingScreenshare:u},g=[],C=[];if(h.canExecute()){const e=this._layoutMenuItemsForGridFocus(d,u,p);g.push({key:"stagelayoutsettings",menuItems:e})}a.each(e,(e=>{const i=this._layoutMenuItemForMode(e,e===t);i&&C.push(i)})),C.length&&g.push({key:"ribbonlayoutsettings",menuItems:C}),l&&(c?g.push({key:"exitfullscreensetting",menuItems:[{text:m.getString("CallPanel.ExitFullScreen"),command:_.ExitFullScreen}]}):g.push({key:"enterfullscreensetting",menuItems:[{text:m.getString("CallPanel.EnterFullScreen"),command:_.EnterFullScreen}]})),S.default.showGroupWithOptions({id:f,config:p,getMenuGroups:()=>g,handleMenuCommand:(e,t)=>this._selectOverflowMenuItem(e,t,o),cancelButtonTitleIOS:m.getString("Global.CancelLabel"),rootViewId:o,invokingEvent:s})}}t.default=w,w._layoutMenuItemsForGridFocus=(e,t,i)=>{const a=(e,t,i,a=!1,n=!0)=>({text:m.getString(e),command:t,selected:i,isCheckbox:n,disabled:a}),n=[a("CallPanel.CallHeaderGridViewLabel",_.Grid,u.default.isInGridStageMode(e))];if(t){const t=r.default.CallingFeaturesHelper.isPresentationModeEnabled(),i=t?_.Presentation:_.Content,o=t?d.StageMode.Presentation:d.StageMode.FocusedScreenShare;n.push(a(t?"CallPanel.CallHeaderPresentationViewLabel":"CallPanel.CallHeaderContentViewLabel",i,e===o))}else n.push(a("CallPanel.CallHeaderSpeakerViewLabel",_.Speaker,e===d.StageMode.Speaker));const o=s.default.getS4LCMCFeaturesNoSubscription();return o.callAudienceBotConfig.enabledGroupCall&&n.push(a("CallPanel.CallHeaderTogetherModeViewLabel",_.TogetherMode,e===d.StageMode.TogetherMode,!i.changeCallLayoutCommand.canExecuteForStageMode(d.StageMode.TogetherMode))),o.callGridViewBotConfig.enabled&&n.push(a("CallPanel.CallHeaderLargeGridViewLabel",_.LargeGrid,e===d.StageMode.LargeGrid,!i.changeCallLayoutCommand.canExecuteForStageMode(d.StageMode.LargeGrid))),n},w._layoutMenuItemForMode=(e,t)=>{switch(e){case d.CallPanelHeaderLayout.Float:return{text:m.getString("CallPanel.CallHeaderLayoutFloatLabel"),command:_.Float,selected:t,selectableType:h.SXMenuItemSelectableType.Checkbox};case d.CallPanelHeaderLayout.Window:return{text:m.getString("CallPanel.CallHeaderLayoutWindowLabel"),command:_.Window,selected:t,selectableType:h.SXMenuItemSelectableType.Checkbox}}},w._selectOverflowMenuItem=(e,t,i)=>{const a=y.default.newCauseId();if(g.log(p.LogTraceArea.Navigation,"RibbonSettingsUtils._selectOverflowMenuItem, causeId: "+a),S.default.dismiss(f,i),t.onCallPanelHeaderLayoutChange)switch(e){case _.Speaker:case _.Presentation:case _.Content:case _.Grid:case _.TogetherMode:case _.LargeGrid:t.changeCallLayoutCommand.execute(b[e]),c.default.trackCallViewMenuActions(T[e]);break;case _.Float:t.onCallPanelHeaderLayoutChange(d.CallPanelHeaderLayout.Float),c.default.trackCallViewMenuActions(l.CallViewMenuActions.SwitchToFloat);break;case _.Window:t.onCallPanelHeaderLayoutChange(d.CallPanelHeaderLayout.Window),c.default.trackCallViewMenuActions(l.CallViewMenuActions.SwitchToWindow);break;case _.EnterFullScreen:n.default.tryEnterFullScreenMode(i).then((e=>{e?(g.track(new l.RibbonSettingsMenuActionEvent(l.RibbonSettingsMenuActions.EnterFullScreen)),c.default.trackCallViewMenuActions(l.CallViewMenuActions.EnterFullScreen)):g.log(p.LogTraceArea.CallingUI,"Failed to Enter Full Screen Mode")}));break;case _.ExitFullScreen:n.default.exitFullScreenMode(i).then((()=>{g.track(new l.RibbonSettingsMenuActionEvent(l.RibbonSettingsMenuActions.ExitFullScreen))})).catch((e=>{g.log(p.LogTraceArea.CallingUI,"Failed to exit full screen mode:")}))}}},96187:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ModalHeight=t.ModalWidth=t.SharingSourceSize=void 0;const a=i(78262);class n{}t.SharingSourceSize=n,n.XLarge={width:960,height:576},n.Large={width:480,height:288},n.Medium={width:240,height:144},n.Small={width:160,height:90},n.XSmall={width:80,height:45};const o=490,s=n.Small.width;var r;!function(e){e[e.FourWindowsColumns=o+3*s]="FourWindowsColumns",e[e.ThreeWindowsColumns=o+2*s]="ThreeWindowsColumns",e[e.TwoWindowsColumns=o+s]="TwoWindowsColumns",e[e.OneWindowsColumn=o]="OneWindowsColumn",e[e.NoWindowsColumn=600]="NoWindowsColumn"}(r=t.ModalWidth||(t.ModalWidth={}));const l=380;var c;!function(e){e[e.ThreeScreens=650]="ThreeScreens",e[e.ThreeScreensAndToggle=720]="ThreeScreensAndToggle",e[e.TwoScreens=515]="TwoScreens",e[e.TwoScreensAndToggle=585]="TwoScreensAndToggle",e[e.OneScreen=l]="OneScreen",e[e.OneScreenAndToggle=450]="OneScreenAndToggle",e[e.NoWindowsOneScreens=640]="NoWindowsOneScreens",e[e.NoWindowsTwoScreens=500]="NoWindowsTwoScreens",e[e.NoWindowsMoreThanTwoScreens=685]="NoWindowsMoreThanTwoScreens"}(c=t.ModalHeight||(t.ModalHeight={}));t.default=class{static getSourceItemDimensions(e,t,i){let a=!1;t&&e<t&&i>1&&(a=!0);let o=e/i;return o>1e3&&!a?n.XLarge:o>200?n.Large:o>90?n.Medium:n.Small}static getWindowSourceItemDimensions(){return n.Small}static getScreenSourceItemDimensions(e,t,i){return t?1===i&&e!==a.ResponsiveWidth.MinDesktop?n.Large:n.Medium:e!==a.ResponsiveWidth.MinDesktop||t?n.Small:n.XSmall}static getModalWidth(e,t,i){if(0===i)return r.NoWindowsColumn;let n,o;switch(e){case a.ResponsiveWidth.Large:n=4;break;case a.ResponsiveWidth.Medium:n=3;break;case a.ResponsiveWidth.Small:default:n=2}o=2!==t||3!==i&&4!==i?i>9?4:i>6?3:i>3?2:1:2;switch(Math.min(n,o)){case 1:default:return r.OneWindowsColumn;case 2:return r.TwoWindowsColumns;case 3:return r.ThreeWindowsColumns;case 4:return r.FourWindowsColumns}}static getModalHeigh(e,t,i){if(0===t)return 1===e?c.NoWindowsOneScreens:2===e?c.NoWindowsTwoScreens:c.NoWindowsMoreThanTwoScreens;let a;switch(a=e>=3?3:2===e?t>4?3:e:t>=3?3:t,a){case 1:return i?c.OneScreenAndToggle:c.OneScreen;case 2:return i?c.TwoScreensAndToggle:c.TwoScreens;default:return i?c.ThreeScreensAndToggle:c.ThreeScreens}}}},89174:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ModalHeight=t.ModalWidth=t.BackgroundSize=void 0;class i{}t.BackgroundSize=i,i.XLarge={width:960,height:576},i.Large={width:288,height:173},i.Medium={width:240,height:144},i.Small={width:160,height:90},i.XSmall={width:80,height:45};const a=380,n=i.Small.width;var o;!function(e){e[e.FourColumns=a+3*n]="FourColumns",e[e.ThreeColumns=a+2*n]="ThreeColumns",e[e.TwoColumns=a+n]="TwoColumns",e[e.OneColumn=a]="OneColumn"}(o=t.ModalWidth||(t.ModalWidth={}));var s;!function(e){e[e.ThreeRows=650]="ThreeRows",e[e.TwoRows=515]="TwoRows",e[e.OneRow=380]="OneRow"}(s=t.ModalHeight||(t.ModalHeight={}));t.default=class{static getBackgroundItemDimensions(e,t,a){return a&&e&&t?i.Medium:e&&t?i.Large:i.Medium}static getModalWidth(e,t){return o.TwoColumns}static getModalHeight(e){return s.ThreeRows}}},99795:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});t.default=new class{constructor(){this._tooltipTextDict={}}getTooltipText(e){return this._tooltipTextDict[e]}setTooltipText(e,t){this._tooltipTextDict[e]=t}}},48467:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallCardType=void 0;const a=i(96486),n=i(71830),o=i(46096),s=i(36237),r=i(14976);t.CallCardType={Started:"started",Ended:"ended",Missed:"missed",Cast:"cast"};t.default=class{static getCallUsersMaxDuration(e,t=0){if(!e.length)return t;const i=a.map(e,(e=>e.duration));return a.max(i)||t}static getMri(e){let t=e.identity;if(t||(e.nameChild&&(t=e.nameChild.getRawText()),t&&t.length))return t}static getCallCardUsers(e){let t=[];return a.each(e,(e=>{const i=this.getMri(e);if(!i)return void s.log(o.LogTraceArea.CallCard,"getCallCardUsers() -  no user in partnode.");const l=n.isMri(i)?n.asMri(i):n.isSkypeId(i)?n.sanitizeMri(i,n.Namespaces.SkypeId):void 0;if(l){if(!n.isAgent(l)){let i;if(e.durationChild&&a.isFunction(e.durationChild.getRawText)){const t=parseInt(e.durationChild.getRawText(),10);a.isFinite(t)&&t>=0?i=t:s.warn(o.LogTraceArea.CallCard,"Invalid Call Card user duration from service")}t.push({mri:l,duration:i,isParticipant:!!i})}}else s.log(o.LogTraceArea.CallCard,"getCallCardUsers() - part node user not valid. value:"+r.mriOrId(i))})),t}}},46228:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.callTranslatorBotSpokenLanguageLocale=t.serviceGridViewBotUri=t.serviceAudienceBotUri=t.stateVersion=t.serviceUri=t.timestamp=t.participantIsAlexa=t.initiatorUserMri=t.participantNotIsVideoCapable=t.participantIsCapturingCallMedia=t.participantHasEndpointMetadata=t.participantSupportsCallMediaCaptureNotifications=t.participantSupportsCallRecording=t.participantSupportsCallingReactions=t.getLocalUserSupportsServerMuteUnmute=t.participantSupportsServerMute=void 0;const a=i(96486),n=i(68580),o=i(90298),s=i(40363);function r(e,t,i){return d(e,(e=>{const n=a.find(e,(e=>!!e.endpointMetadata&&!!e.endpointMetadata.services));if(n){const e=n.endpointMetadata.services;return a.find(e,(e=>e.id===t&&e.version===i))}}))}function l(e,t){return!!e&&(!!e.endpoints&&a.some(e.endpoints.endpointDetails,(e=>!!e.endpointMetadata&&t(e.endpointMetadata))))}function c(e,t){return!!n.default.isParticipantConnected(e)&&l(e,t)}function d(e,t){if(e&&e.endpoints&&n.default.isParticipantConnected(e))return t(e.endpoints.endpointDetails)}function u(e,t){return!!e&&a.some(e,(e=>!!e.capabilities&&t(e.capabilities)))}t.participantSupportsServerMute=function(e){return function(e,t){if(!n.default.isParticipantConnected(e))return!1;if(!e)return!1;if(!e.endpoints)return!1;return u(e.endpoints.endpointDetails,t)}(e,(e=>"enabled"===e.serverMuteUnmute))},t.getLocalUserSupportsServerMuteUnmute=function(e){return u(e,(e=>"enabled"===e.serverMuteUnmute))},t.participantSupportsCallingReactions=function(e){return c(e,(e=>!!e.reactionsEnabled))},t.participantSupportsCallRecording=function(e){return c(e,(e=>!!e.supportsCallRecording))},t.participantSupportsCallMediaCaptureNotifications=function(e){return c(e,(e=>!!e.supportsNotifyCallMediaCaptured))},t.participantHasEndpointMetadata=function(e){return l(e,(e=>!0))},t.participantIsCapturingCallMedia=function(e){return c(e,(e=>!!e.isCallMediaCaptured))},t.participantNotIsVideoCapable=function(e){return c(e,(e=>!a.isUndefined(e.isVideoCapable)&&!e.isVideoCapable))},t.initiatorUserMri=function(e){return d(e,(e=>{const t=a.find(e,(e=>!!e.endpointMetadata&&!!e.endpointMetadata.initiatorUserId));return t?t.endpointMetadata.initiatorUserId:void 0}))},t.participantIsAlexa=function(e){return!!d(e,(e=>a.some(e,(e=>{if(!e)return!1;const t=o.SkypeVersionParser.parse(e.clientVersion);return!!t&&s.default.isAlexaPlatformId(t.platformId)}))))},t.timestamp=function(e){return d(e,(e=>{const t=a.find(e,(e=>!!e.endpointMetadata&&!!e.endpointMetadata.timestamp));return t?t.endpointMetadata.timestamp:void 0}))},t.serviceUri=function(e,t,i){const a=r(e,t,i);return a?a.uri:void 0},t.stateVersion=function(e,t,i){const a=r(e,t,i);return a?a.stateVersion:void 0},t.serviceAudienceBotUri=function(e){return d(e,(e=>{var t,i;const n=a.find(e,(e=>!!e.endpointMetadata&&!!e.endpointMetadata.metadata&&!!e.endpointMetadata.metadata.serviceUri));return n?null===(i=null===(t=n.endpointMetadata)||void 0===t?void 0:t.metadata)||void 0===i?void 0:i.serviceUri:void 0}))},t.serviceGridViewBotUri=function(e){return d(e,(e=>{var t,i;const n=a.find(e,(e=>!!e.endpointMetadata&&!!e.endpointMetadata.metadata&&!!e.endpointMetadata.metadata.serviceUri));return n?null===(i=null===(t=n.endpointMetadata)||void 0===t?void 0:t.metadata)||void 0===i?void 0:i.serviceUri:void 0}))},t.callTranslatorBotSpokenLanguageLocale=function(e){return d(e,(e=>{const t=a.find(e,(e=>!!e.endpointMetadata&&!!e.endpointMetadata.callTranslatorBotSpokenLanguageLocale));return t?t.endpointMetadata.callTranslatorBotSpokenLanguageLocale:void 0}))}},96096:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallMarkerDisplayUtils=t.CallMarkerType=void 0;const a=i(96486),n=i(48467),o=i(76059),s=i(71830),r=i(16402),l=i(46096),c=i(36237),d=i(33754),u=i(11828),h=i(53374);var p;!function(e){e[e.Started=0]="Started",e[e.Ended=1]="Ended",e[e.Missed=2]="Missed",e[e.NoAnswer=3]="NoAnswer",e[e.Declined=4]="Declined",e[e.Failed=5]="Failed"}(p=t.CallMarkerType||(t.CallMarkerType={}));t.default=class{static calculateCallMarkerInfo(e,t){let i=this._extractCallCardInfoFromPartListNode(e);return t&&e.type!==n.CallCardType.Started&&(i=this._mergeCallLogsIntoCallMarkerInfo(t,i)),i}static calculateCallMarkerInfoFromPath(e,t,i,a,n){const o={callId:t,conversationId:i,type:a,duration:n};return this._mergeCallLogsIntoCallMarkerInfo(e,o)}static _mergeCallLogsIntoCallMarkerInfo(e,t){let i=t.type,n=t.duration;if(e)if(e.callState===o.CallState.Failed)i=p.Failed;else if(e.callState===o.CallState.Missed&&e.callDirection===o.CallDirection.Incoming)i=p.Missed;else if(e.callState===o.CallState.Missed&&e.callDirection===o.CallDirection.Outgoing)i=p.NoAnswer;else if(e.callState===o.CallState.Declined)i=p.Declined;else if(e.callState===o.CallState.Accepted&&e.callDirection===o.CallDirection.Outgoing&&e.forwardingInfo&&e.forwardingInfo.acceptedBy&&e.forwardingInfo.acceptedBy.type===o.ParticipantType.Voicemail)i=p.NoAnswer;else if(e.callState===o.CallState.Accepted&&e.callDirection===o.CallDirection.Outgoing&&e.callType===o.CallType.MultiParty&&1===a.size(e.participants))i=p.NoAnswer;else if(e.callState===o.CallState.Accepted&&(i=p.Ended,e.connectTime&&e.endTime)){const t=new Date(e.connectTime).getTime(),i=new Date(e.endTime).getTime();t&&i&&i>t&&(n=a.floor((i-t)/1e3))}return Object.assign(Object.assign({},t),{type:i,duration:n})}static _extractCallCardInfoFromPartListNode(e){const t=!!e.conversationId&&s.isThread(e.conversationId),i=!!e.conversationId&&s.isPhoneMri(e.conversationId),o=!!e.conversationId&&s.isGroupConversation(e.conversationId),r=n.default.getCallCardUsers(e.children),d=a.filter(r,(e=>e.isParticipant));let u,h=p.Ended;const g=a.size(e.children),C=a.size(r),m=a.size(d);g!==C&&c.warn(l.LogTraceArea.CallCard,`renderPartListNodeParts() user mismatch. tree: ${g} card: ${C} participants: ${m}type: ${h} thread: ${t} PSTN: ${i}`);const S=m>1;return e.type===n.CallCardType.Started?h=p.Started:o&&!S||!o&&e.type===n.CallCardType.Missed?h=p.Missed:(u=n.default.getCallUsersMaxDuration(r),h=p.Ended),{callId:e.callId,conversationId:e.conversationId,type:h,duration:u}}};t.CallMarkerDisplayUtils=class{static getText(e,t){switch(e){case p.Started:return d.getString("CallCard.CallStartedStatusMessage");case p.Missed:return d.getString("CallCard.CallMissedStatusMessage");case p.Ended:if(t){const e=r.default.getFormattedDuration(t,!1);return d.getString("CallCard.CallEndedStatusWithDurationMessage",{duration:e})}return d.getString("CallCard.CallEndedStatusMessage");case p.Declined:return d.getString("CallCard.CallDeclinedStatusMessage");case p.NoAnswer:return d.getString("CallCard.CallNoAnswerStatusMessage");case p.Failed:return d.getString("CallCard.CallFailedStatusMessage");default:return h.default.switchStatementExhaustiveChecking(e,"Unknown marker type - Was a call marker type added?")}}static getTextForEncryptedThread(e,t){switch(e){case p.Started:return d.getString("CallCard.EncryptedCallStartedStatusMessage");case p.Missed:return d.getString("CallCard.EncryptedCallMissedStatusMessage");case p.Ended:if(t){const e=r.default.getFormattedDuration(t,!1);return d.getString("CallCard.EncryptedCallEndedStatusWithDurationMessage",{duration:e})}return d.getString("CallCard.EncryptedCallEndedStatusMessage");case p.Declined:return d.getString("CallCard.EncryptedCallDeclinedStatusMessage");case p.NoAnswer:return d.getString("CallCard.EncryptedCallNoAnswerStatusMessage");case p.Failed:return d.getString("CallCard.EncryptedCallFailedStatusMessage");default:return h.default.switchStatementExhaustiveChecking(e,"Unknown marker type - Was a call marker type added?")}}static getIcon(e){switch(e){case p.Started:return u.SkypeIcon.CallStart;case p.Missed:case p.NoAnswer:case p.Declined:case p.Failed:return u.SkypeIcon.CallMissed;case p.Ended:return u.SkypeIcon.CallEnd;default:return h.default.switchStatementExhaustiveChecking(e,"Unknown marker type - Was a call marker type added?")}}static getTextForAccessibilityLabel(e){switch(e){case p.Started:return d.getString("AccessibilityLabel.Call");case p.Missed:return d.getString("AccessibilityLabel.CallMissed");case p.Ended:return d.getString("AccessibilityLabel.Call");case p.Declined:return d.getString("AccessibilityLabel.CallDeclined");case p.NoAnswer:return d.getString("AccessibilityLabel.CallNoAnswer");case p.Failed:return d.getString("AccessibilityLabel.CallFailed");default:return h.default.switchStatementExhaustiveChecking(e,"Unknown marker type - Was a call marker type added?")}}}},38438:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(51077);t.default=class{static updateCallEventMessages(e){const t=a.compact(e),i=a.clone(t);let o,s,r=0;return a.each(t,((e,t)=>{n.isEventCallStartedMessageType(e)?(o=e,r=t,s=void 0):n.isEventCallEndedMessageType(e)?o&&o.skypeguid===e.skypeguid&&(s?i[t]=e.applyPropertyLie("messagesSentDuringCall",!0):i[r]=void 0):e.isShownInStream()&&(s=e)})),a.compact(i)}}},51638:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.problemSections=t.CQFHash=t.shuffleArray=t.XorShift=t.tokensString=t.shouldTriggerForCall=t.ProblemTokens=t.ProblemSectionType=void 0;const a=i(36345),n=i(48540),o=i(97691),s=i(71830),r=i(40276),l=i(46096),c=i(36237),d=i(18078);var u,h;!function(e){e[e.Audio=0]="Audio",e[e.Video=1]="Video"}(u=t.ProblemSectionType||(t.ProblemSectionType={})),function(e){e[e.AudioTokenNoSoundLocal=101]="AudioTokenNoSoundLocal",e[e.AudioTokenNoSoundRemote=102]="AudioTokenNoSoundRemote",e[e.AudioTokenEcho=103]="AudioTokenEcho",e[e.AudioTokenNoise=104]="AudioTokenNoise",e[e.AudioTokenLowSound=105]="AudioTokenLowSound",e[e.AudioTokenDropped=106]="AudioTokenDropped",e[e.AudioTokenDistorted=107]="AudioTokenDistorted",e[e.AudioTokenInterrupted=108]="AudioTokenInterrupted",e[e.AudioTokenOther=109]="AudioTokenOther",e[e.AudioTokenPSTNDialpad=301]="AudioTokenPSTNDialpad",e[e.VideoTokenNoVideoLocal=201]="VideoTokenNoVideoLocal",e[e.VideoTokenNoVideoRemote=202]="VideoTokenNoVideoRemote",e[e.VideoTokenLowQuality=203]="VideoTokenLowQuality",e[e.VideoTokenFreezing=204]="VideoTokenFreezing",e[e.VideoTokenStoppedUnexpectedly=205]="VideoTokenStoppedUnexpectedly",e[e.VideoTokenOtherSideTooDark=206]="VideoTokenOtherSideTooDark",e[e.VideoTokenNoAudioSync=207]="VideoTokenNoAudioSync",e[e.VideoTokenOther=208]="VideoTokenOther"}(h=t.ProblemTokens||(t.ProblemTokens={})),t.shouldTriggerForCall=function(e,t,i){if(e.durationSeconds<t.MinCallDurationSecs)return c.log(l.LogTraceArea.CallQualityFeedback,"CallQualityFeedbackUtils.shouldTriggerForCall: "+e.callId+" duration too short ("+e.durationSeconds+" < "+t.MinCallDurationSecs+"). Returning false."),o.Resolved(!1);if(e.forwardingDestinationType&&"voicemail"===e.forwardingDestinationType)return c.log(l.LogTraceArea.CallQualityFeedback,"CallQualityFeedbackUtils.shouldTriggerForCall: "+e.callId+" went to voicemail. Returning false."),o.Resolved(!1);let r;if(i){const t=s.isGroupConversation(e.conversationMri)?n.EcsCallType.CallTypeGroup:s.isPhoneMri(e.conversationMri)?n.EcsCallType.CallTypePstn:n.EcsCallType.CallTypeS2s;r=a.default.shouldTriggerCQF(d.default.getSkypeId(),e.callId,t).catch((()=>(c.log(l.LogTraceArea.CallQualityFeedback,"CallQualityFeedbackUtils.shouldTriggerForCall: "+e.callId+" calling stack didn't provide a value. Assuming false."),!1)))}else r=o.Resolved(!1);return r.then((i=>{if(i)return!0;const a=s.isGroupConversation(e.conversationMri)?t.GroupCall_Percent:s.isPhoneMri(e.conversationMri)?t.PSTN_Percent:t.S2S_Percent;return C(e.callId)%100>=a?(c.log(l.LogTraceArea.CallQualityFeedback,"CallQualityFeedbackUtils.shouldTriggerForCall: hash for "+e.callId+" not within "+a+"%. Returning false."),!1):(c.log(l.LogTraceArea.CallQualityFeedback,"CallQualityFeedbackUtils.shouldTriggerForCall: hash for "+e.callId+" within "+a+"%. Returning true."),!0)}))},t.tokensString=function(e){if(0!==e.length)return"checks="+e.join("%20")};class p{constructor(e){const t=C(e);this._w=t,this._x=t/2>>>0,this._y=t/3>>>0,this._z=t/4>>>0}getNext(){const e=(this._x^this._x<<11>>>0)>>>0;return this._x=this._y,this._y=this._z,this._z=this._w,this._w=(this._w^this._w>>>19^e^e>>>8)>>>0,this._w}}function g(e,t){const i=new p(t);for(let t=e.length-1;t>=1;t--){const a=i.getNext()%(t+1),n=e[t];e[t]=e[a],e[a]=n}}function C(e){const t=r.computeSHA256(e);return(t[0]<<24|t[1]<<16|t[2]<<8|t[3]<<0)>>>0}t.XorShift=p,t.shuffleArray=g,t.CQFHash=C;const m=[h.AudioTokenNoSoundLocal,h.AudioTokenNoSoundRemote,h.AudioTokenEcho,h.AudioTokenNoise,h.AudioTokenLowSound,h.AudioTokenDropped,h.AudioTokenDistorted,h.AudioTokenInterrupted],S=[h.VideoTokenNoVideoLocal,h.VideoTokenNoVideoRemote,h.VideoTokenLowQuality,h.VideoTokenFreezing,h.VideoTokenStoppedUnexpectedly,h.VideoTokenOtherSideTooDark,h.VideoTokenNoAudioSync];function y(e,t,i){const a=t.slice(0);return g(a,e),a}t.problemSections=function(e,t){const i=[{type:u.Audio,title:"AudioProblems",problems:y(e,m,h.AudioTokenOther)}];return t&&(i.push({type:u.Video,title:"VideoProblems",problems:y(e,S,h.VideoTokenOther)}),g(i,e)),i}},60289:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(80200),n=i(46096),o=i(36237),s=i(33004),r=i(14976),l=i(86045);t.default=class{constructor(){this._participantReactionCallbacks={}}registerUnhandledReactionCallback(e){this._unhandledReactionCallback=e}unregisterUnhandledReactionCallback(){this._unhandledReactionCallback=void 0}registerUnhandledReactionDismissCallback(e){this._dismissUnhandledReactionCallback=e}unregisterUnhandledReactionDismissCallback(){this._dismissUnhandledReactionCallback=void 0}registerParticipantReactionCallback(e,t){o.log(n.LogTraceArea.CallReactions,"CallReactionsDisplayHelper.registerParticipantReactionCallback key: "+r.mriOrId(e)),this._participantReactionCallbacks[e]=t}unregisterParticipantReactionCallback(e){o.log(n.LogTraceArea.CallReactions,"CallReactionsDisplayHelper.unregisterParticipantReactionCallback key: "+r.mriOrId(e)),delete this._participantReactionCallbacks[e]}dismissReaction(e){o.log(n.LogTraceArea.CallReactions,"CallReactionsDisplayHelper.dismissReaction key: "+r.mriOrId(e)),this._dismissUnhandledReactionCallback&&this._dismissUnhandledReactionCallback(e)}showReaction(e){l.default.shouldAnnounceForAccessibility()&&s.default.announceReaction(e.reaction);const t=e.isLocal?a.CallStageElementKeys.localUserKey:e.reaction.creator,i=e.isLocal?a.CallStageElementKeys.localUserKey:r.mriOrId(e.reaction.creator);o.log(n.LogTraceArea.CallReactions,"CallReactionsDisplayHelper.showReaction cuid: "+e.reaction.cuid+" key: "+i+" has callback "+!!this._participantReactionCallbacks[t]),this._participantReactionCallbacks[t]&&this._participantReactionCallbacks[t](e)||this._unhandledReactionCallback&&this._unhandledReactionCallback(e)}static getTextTimeoutBasedOnContent(e){return e.length<=40?3e3:e.length<=100?4500:6e3}}},98172:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(51077);i(71830);t.default=new class{getReactionsThreadPostParams(e){return{[a.MessageProperties.CastParentThreadId]:e}}}},68580:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SubscriptionDisposable=void 0;const a=i(74958),n=i(96486),o=i(99591),s=i(48540),r=i(74634),l=i(97691),c=i(16402),d=i(98925),u=i(71830),h=i(40276),p=i(46096),g=i(36237),C=i(27683),m=i(76173),S=i(14976),y=i(4057),f=i(47447);t.SubscriptionDisposable=class{constructor(e,t){this._token=e,this._unsubscribe=t}dispose(){if(this._token){const e=this._token;this._token=void 0,this._unsubscribe(e)}}};class _{constructor(){this.onCallingError=new r.default,this._callBlacklist=[]}activeCallStates(){return this.connectedCallStates().concat([s.CallState.Connecting,s.CallState.Notified,s.CallState.EarlyMedia])}connectedCallStates(){return this.onHoldCallStates().concat([s.CallState.Connected])}onHoldCallStates(){return[s.CallState.LocalHold,s.CallState.RemoteHold]}isCallStateActive(e){return n.includes(this.activeCallStates(),e)}isCallStateConnected(e){return n.includes(this.connectedCallStates(),e)}isCallStateOnHold(e){return n.includes(this.onHoldCallStates(),e)}isParticipantConnected(e){return!!e&&this.isParticipantStateConnected(e.state)}isParticipantInCanStreamMediaState(e){return(null==e?void 0:e.state)===s.ParticipantState.EarlyMedia}isParticipantStateConnected(e){return e===s.ParticipantState.Connected||e===s.ParticipantState.OnHold}isParticipantRinging(e,t=!0){return e&&this.isParticipantStateRinging(e.state,t)}isParticipantStateRinging(e,t=!0){return t&&e===s.ParticipantState.Connecting||e===s.ParticipantState.Ringing}isParticipantOnHold(e){return e&&e.state===s.ParticipantState.OnHold}isParticipantTalking(e){return e&&e.voiceLevel>0}isParticipantMuted(e){return e&&e.isServerMuted}isPstnNetherlandsReason(e){return!!e&&480===e.callControllerCode&&213432===e.callControllerSubCode}participantMris(e){const t=u.asMri(e.id);return{default:(e.acceptedBy&&e.acceptedBy!==e.id?_._normalizeForwardedEndpoint(u.asMri(e.acceptedBy)):void 0)||t,original:t}}static _normalizeForwardedEndpoint(e){if(!u.isPhoneMri(e))return e;const t=u.splitMri(e),i=C.default.getNormalizedPhoneNumber(t.id);return i?u.sanitizeMri(i,t.namespace):e}conversationLiveStateFromCastNotification(e){if(!e)return void g.error(p.LogTraceArea.Calling,"conversationLiveStateFromCastNotification: Error when parsing castContext: undefined");const t=this._uncompressPayload(e),i=t&&n.attempt((()=>atob(t)));if(!i||n.isError(i))return void g.error(p.LogTraceArea.Calling,"conversationLiveStateFromCastNotification: Error when parsing castContext: "+y.default.errorAsString(i),a.pii.Omit(e||""));const o=y.default.parseJsonErrorToUndefined(i);if(o&&!n.isError(o))return o.groupCallInitiator&&(o.groupCallInitiator=u.sanitizeMri(o.groupCallInitiator,u.Namespaces.SkypeId)),o;g.error(p.LogTraceArea.Calling,"conversationLiveStateFromCastNotification: Error when parsing rawData: "+y.default.errorAsString(o),a.pii.Omit(i||""))}blacklistCallId(e,t){n.includes(this._callBlacklist,e)||(g.log(p.LogTraceArea.Calling,"Blacklisting callId: "+e+" causeId: "+t),this._callBlacklist.push(e))}isLiveStateValid(e){return!this.invalidLiveStateError(e)}invalidLiveStateError(e){return e?"Active"!==e.status?("InActive"===e.status&&g.warn(p.LogTraceArea.Calling,"Got non-null inactive live state "+a.pii.Omit(JSON.stringify(e))),"Status of call is "+e.status):e.expiration?1e3*e.expiration<Date.now()?"Expired with Active status":e.conversationId&&e.conversationUrl?n.includes(this._callBlacklist,e.conversationId)?"Call ID has been blacklisted":u.isMri(e.conversationUrl)&&u.isEncryptedThread(e.conversationUrl)?"Call is encrypted":void 0:"Missing call ID or conversation URL":"Missing expiration":"No live state found"}isLiveStateForGoLive(e){return!!e&&"cast"===e.conversationType}isLiveStateValidAndForGoLive(e){return!!this.isLiveStateValid(e)&&this.isLiveStateForGoLive(e)}incomingCallNotificationForFlamingo(e){let t,i;if(e.content){const a=y.default.parseJsonErrorToUndefined(e.content);a&&(a.cp&&(t=this._uncompressPayload(a.cp)),i=a.callId)}const a=u.getParsedConversationId(e),n=parseInt(e.eventId,10);return{evt:n,gp:t,gpc:e.content,nsp:void 0,displayName:void 0,callId:e.skypeguid||i,conversationMri:_._maybeSanitizeMri(e.conversationId||e.imdisplayname||a,n),callerMri:_._maybeSanitizeMri(e.imdisplayname,n),participantId:e.skypeguid,videoCall:"true"===e.isVideoCall,encryptedKey:void 0,recipientId:void 0}}incomingCallNotificationForPnh(e,t){let i;return t.servicePayload&&t.servicePayload.cp&&(i=this._uncompressPayload(t.servicePayload.cp)),{evt:e,gp:i,gpc:JSON.stringify(t.servicePayload),nsp:void 0,displayName:t.displayName,callId:t.callId,conversationMri:_._maybeConvertToEncryptedThread(_._maybeSanitizeMri(t.convoId,e),e),callerMri:_._maybeSanitizeMri(t.callerId,e),participantId:t.participantId,videoCall:"true"===t.videoCall,encryptedKey:t.encryptedKey,recipientId:_._maybeSanitizeRecipientId(t.recipientId)}}incomingGoLivelNotificationForPnh(e,t){const i=this.conversationLiveStateFromCastNotification(t.castContext);if(i)return{evt:e,callId:t.callId,callerMri:_._maybeSanitizeMri(i.groupCallInitiator,e),conversationMri:_._maybeSanitizeMri(t.threadId,e),recipientId:_._maybeSanitizeRecipientId(t.recipientId),conversationLiveState:i,participantId:void 0};g.warn(p.LogTraceArea.Calling,"Conversation livestate missing from notification: "+a.pii.Omit(JSON.stringify(t)))}stopGoLiveNotificationForPnh(e,t){return{evt:e,callId:t.callId,conversationMri:_._maybeSanitizeMri(t.threadId,e),recipientId:_._maybeSanitizeRecipientId(t.recipientId),participantId:void 0}}incomingGoLiveNotificationForTrouter(e){const t=e.eventId||e.body.evt,i=this.conversationLiveStateFromCastNotification(e.body.castContext);if(i)return{evt:t,callId:e.body.callId,callerMri:_._maybeSanitizeMri(i.groupCallInitiator,t),conversationMri:_._maybeSanitizeMri(e.body.threadId,t),recipientId:_._maybeSanitizeRecipientId(e.body.recipientId),conversationLiveState:i,participantId:void 0};g.warn(p.LogTraceArea.Calling,"Conversation livestate missing from notification: "+a.pii.Omit(JSON.stringify(e.body)))}stopGoLiveNotificationForTrouter(e){const t=e.eventId||e.body.evt;return{evt:t,callId:e.body.callId,conversationMri:_._maybeSanitizeMri(e.body.threadId,t),recipientId:_._maybeSanitizeRecipientId(e.body.recipientId),participantId:void 0}}_uncompressPayload(e){const t=h.base64StringToUint8Array(e);if(!t)return void g.warn(p.LogTraceArea.Calling,"_uncompressPayload: Couldn't un-base64 call data");const i=o.inflate(t);return h.Uint8ArrayToBase64String(i)}stopCallNotificationForPnh(e,t){return{evt:e,reason:t.reason,callId:t.callId,conversationMri:_._maybeSanitizeMri(t.conversationId,e),callerMri:_._maybeSanitizeMri(t.callerMri,e),participantId:t.participantId,recipientId:_._maybeSanitizeRecipientId(t.recipientId)}}stopCallNotificationForPermission(e){return{evt:e.evt,callId:e.callId,participantId:e.participantId,conversationMri:e.conversationMri,callerMri:e.callerMri,reason:"RejectedDueToNoMicPermission",recipientId:e.recipientId}}incomingCallNotificationForTrouter(e){let t;t=e.body.servicePayload&&e.body.servicePayload.cp?this._uncompressPayload(e.body.servicePayload.cp):e.body.gp;const i=e.eventId||e.body.evt;return{evt:i,gp:t,gpc:e.body.servicePayload?JSON.stringify(e.body.servicePayload):void 0,nsp:void 0,displayName:e.body.displayName,callId:e.body.callId,conversationMri:_._maybeConvertToEncryptedThread(_._maybeSanitizeMri(e.body.convoId||e.body.conversationId,i),i),callerMri:_._maybeSanitizeMri(e.body.callerId||e.body.callerMri,i),participantId:e.body.participantId,videoCall:"boolean"==typeof e.body.videoCall?e.body.videoCall:"true"===e.body.videoCall,encryptedKey:e.body.encryptedKey,recipientId:_._maybeSanitizeRecipientId(e.body.recipientId)}}stopCallNotificationForTrouter(e){const t=e.eventId||e.body.evt;return{evt:t,reason:e.body.reason,callId:e.body.callId,conversationMri:_._maybeSanitizeMri(e.body.convoId||e.body.conversationId,t),callerMri:_._maybeSanitizeMri(e.body.callerId||e.body.callerMri,t),participantId:e.body.participantId,recipientId:_._maybeSanitizeRecipientId(e.body.recipientId)}}incomingCallNotificationForP2PPnh(e){const t=e.eventType;return{evt:t,displayName:e.displayName,callId:e.callId,conversationMri:_._maybeSanitizeMri(e.convoId,t),callerMri:_._maybeSanitizeMri(e.callerId,t),participantId:e.participantId,videoCall:"true"===e.videoCall,recipientId:_._maybeSanitizeRecipientId(e.recipientId)}}static _maybeSanitizeMri(e,t){const i=_._getCallerNamespaceForCallEvent(e,t);return e?u.sanitizeMri(e,i):void 0}static _maybeConvertToEncryptedThread(e,t){return t===m.PNHEvents.IncomingNGCEncryptedCall&&e&&!u.isEncryptedThread(e)?u.buildOneOnOneEncryptedThreadId(e):e}static _maybeSanitizeRecipientId(e){return e?u.sanitizeMri(e,u.Namespaces.SkypeId):void 0}buildNGCCallPayload(e,t,i,o,s,r){const l=e.gp;if(!l)return void g.error(p.LogTraceArea.Calling,"buildNGCCallPayload: Error when decoding gp payload: undefined causeId: "+r);const c=n.attempt((()=>atob(l)));if(!c||n.isError(c))return void g.error(p.LogTraceArea.Calling,"buildNGCCallPayload: Error when decoding gp payload: "+y.default.errorAsString(c)+" causeId: "+r+" "+a.pii.Omit(l||""));const d=y.default.parseJsonErrorable(c);if(d&&!n.isError(d)){if(d.callNotification)return{conversationId:e.conversationMri?e.conversationMri:d.groupChat&&d.groupChat.threadId?d.groupChat.threadId:d.callNotification.from.id,messageId:d.groupChat?d.groupChat.messageId:null,callerId:e.callerMri?e.callerMri:d.callNotification.from.id,convoCallId:e.callId?e.callId:d.debugContent.callId,isMultiParty:!!d.conversationInvitation&&d.conversationInvitation.isMultiParty,fromMixer:d.callNotification.fromMixer||!1,ngcCall:!0,body:{evt:e.evt,nsp:e.nsp||"",gp:f.CallingCapabilities.isPluginlessCallingStack()?e.gp||"":e.gpc||e.gp||""},videoCall:e.videoCall,launchTime:i,pushReceivedTime:o.pushReceivedTime,registrationId:s||"",callKey:t||"",participantId:e.participantId||"",connectionType:o.connectionType};g.log(p.LogTraceArea.Calling,"Unable to create incoming NGC payload "+r)}else g.error(p.LogTraceArea.Calling,"buildNGCCallPayload: Error when parsing gp payload: "+y.default.errorAsString(d)+" causeId: "+r+" "+a.pii.Omit(c||""))}static _getCallerNamespaceForCallEvent(e,t){if(e&&u.isMri(e))return u.getMriNamespace(e);switch(t){case m.PNHEvents.IncomingNGCCall:case m.PNHEvents.IncomingP2PCall:case m.PNHEvents.IncomingNGCGroupCall:case m.PNHEvents.IncomingNGCEncryptedCall:return u.Namespaces.SkypeId;case m.PNHEvents.IncomingNGCPSTNCall:return u.Namespaces.PSTN;case m.PNHEvents.IncomingS4BCall:return u.Namespaces.S4B_Bridge;case m.PNHEvents.IncomingNGCStopRinger:return C.default.isPossiblyPhoneNumber(e)?u.Namespaces.PSTN:u.Namespaces.SkypeId;default:return u.Namespaces.SkypeId}}getMediaPeerTypeForIncomingCall(e){switch(e){case m.PNHEvents.IncomingS4BCall:case m.PNHEvents.IncomingNGCCall:case m.PNHEvents.IncomingNGCEncryptedCall:return s.MediaPeerType.ConsumerTwoParty;case m.PNHEvents.IncomingNGCGroupCall:return s.MediaPeerType.ConsumerPstn;case m.PNHEvents.IncomingNGCPSTNCall:default:return s.MediaPeerType.ConsumerMultiParty}}isValidCallingMri(e){if(!e)return!1;if(!u.isMri(e))return!1;switch(u.getMriNamespace(e)){case u.Namespaces.S4B_Bridge:case u.Namespaces.PSTN:case u.Namespaces.SkypeId:case u.Namespaces.Thread:case u.Namespaces.Bot:return!0;default:return!1}}extractMriFromKey(e,t=!1){if(u.isMri(e))return t?S.mriOrId(e):e;const i=["ss_","video_","icon_"];for(let a=0;a<i.length;++a)if(n.startsWith(e,i[a])){const n=e.substr(i[a].length);if(u.isMri(n))return t?`${i[a]}${S.mriOrId(n)}`:n}return t?a.pii.Omit(e):e}sanitizeCallStartOptions(e){return n.mapValues(n.clone(e),((e,t)=>"callKey"===t||"encryptedKey"===t?e?"yes":"no":"label"===t?a.pii.Omit(e):e))}validateIncomingCallNotificationBody(e){return!!e.conversationMri&&(u.isEncryptedThread(e.conversationMri)?!!e.encryptedKey:!e.encryptedKey)}validateOutgoingCall(e,t){return!u.isEncryptedThread(e)||!t.withVideo&&!!t.ringOthers}validateOutgoingCallParticipants(e,t){return!e.ringOthers||t.length>0}generateCallingError(e,t,i,a,n){const o=new d.CallingError(e,t,i,a,n);return g.warn(p.LogTraceArea.Calling,"generateCallingError action: "+e+" message: "+t+" terminatedReason: "+i+" failureType: "+a+" validationReason: "+n||0),this.onCallingError.fire(o),l.Rejected(o)}maybeCallingErrorAsString(e){const t=e.action,i=e.terminatedReason,a=e.failureType,n=e.validationReason?d.CallValidationFailureReason[e.validationReason]:void 0,o=e.message;if(!(t||i||a||n))return{message:y.default.errorAsString(e),isCallingError:!1};return{message:"action: "+t+" terminatedReason: "+i+" failureType: "+a+" validationFailureReason: "+n+" message: "+o,isCallingError:!0}}validateParametersPromise(e,t,i,a){return this.validateParameters(e,i,a)?l.Resolved():this.generateCallingError(t,"Parameter validation failed for "+e+" ("+t+")",s.TerminatedReason.BadRequest,s.FailureType.CallSetupFailed,d.CallValidationFailureReason.InvalidParameters)}validateParameters(e,t,i){let a=!0;return n.each(i,(i=>{const n=n=>{const o="Failed to validate parameter "+S.mriOrId(i.param)+" in method ["+e+"] causeId: "+t+(n?", error "+y.default.errorAsString(n):"");g.error(p.LogTraceArea.Calling,o),a=!1};try{i.check()||n()}catch(e){n(e)}})),a}isEventTypeTriggeringMuteAction(e){return n.includes([d.CallDeviceQualityEventType.DeviceEcho,d.CallDeviceQualityEventType.DeviceMultipleEndpoints,d.CallDeviceQualityEventType.AudioCaptureUltrasoundDetected],e)}createLiveStateFromJoinBlob(e){const t=y.default.parseJsonErrorToUndefined(e.trim());return void 0!==t&&(t.status="Active",t.expiration=c.default.add(Date.now(),0,1)/1e3),void 0!==t?y.default.asString(t):null}}const b=new _;t.default=b},93389:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DialerSearchUtils=void 0;const a=i(96486);t.DialerSearchUtils=class{static sortByDisplayName(e){return a.sortBy(a.values(e),(e=>e.contact.displayName))}static getSearchCriteria(e,t=!1){return 0!==e.inputValue.indexOf("+")&&t||a.isEmpty(e.E164)?e.inputValue:e.E164}}},83706:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(63297),n=i(80200),o=i(33754),s=i(11828);t.default=class{static getViewInformationForAudioRouting(e){let t;switch(e){case a.default.AudioOutputEarpiece:t=o.getString("CallPanel.EarpieceWarning");break;case a.default.AudioOutputSpeaker:t=o.getString("CallPanel.SpeakerWarning");break;case a.default.AudioOutputBluetooth:t=o.getString("CallPanel.BluetoothWarning");break;case a.default.AudioOutputWiredHeadset:t=o.getString("CallPanel.HeadsetWarning");break;default:return}return{warningText:t,warningViewType:n.InCallWarningViewType.Audio}}static getViewInformationForAudioMuted(e,t){if((e||t)&&(e||t)){let i,a;return t&&e?(i=void 0,a=o.getString("CallPanel.SpeakerAndMicrophoneMuted")):t?(i=s.SkypeIcon.VolumeOff,a=o.getString("CallPanel.SpeakerMuted")):e&&(i=s.SkypeIcon.MicrophoneOff,a=o.getString("CallPanel.MicrophoneMuted")),a?{warningText:a,icon:i,warningViewType:n.InCallWarningViewType.Audio}:void 0}}static getViewInformationForVoicemail(){return{warningText:o.getString("CallPanel.RecordingVoicemail"),warningViewType:n.InCallWarningViewType.Voicemail}}static getViewInformationForForwarding(){return{warningText:o.getString("CallPanel.CallForwarding"),warningViewType:n.InCallWarningViewType.Forwarding}}}},2830:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(36237),n=i(54298);t.default=class{static registerOpenAction(e,t,i){a.track(new n.ExperimentOpenAction(e,t,i))}static registerDialerButtonClickAction(e,t,i){a.track(new n.ExperimentButtonClickAction(n.NavigateToDestination.DialerPanel,e,t,i))}static registerBalanceStateButtonClickAction(e,t,i){a.track(new n.ExperimentButtonClickAction(n.NavigateToDestination.BalanceStatePanel,e,t,i))}static registerCallButtonClickAction(e,t){a.track(new n.ExperimentButtonClickAction(n.NavigateToDestination.GroupCall,e,t))}static registerCloseButtonClickAction(e,t,i){a.track(new n.ExperimentBannerCloseAction(e,t,i))}}},27683:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PhoneNumberFormat=void 0;const a=i(74958),n=i(93791),o=i(96486),s=i(46096),r=i(36237),l=i(33754),c=i(4057),d=i(40363),u=i(78262),h=i(53374),p=/[^0-9\.\+]+/g,g=/(,+(.*))/;let C;var m;!function(e){e[e.E164=1]="E164",e[e.INTERNATIONAL=2]="INTERNATIONAL",e[e.NATIONAL=3]="NATIONAL",e[e.RFC3966=4]="RFC3966"}(m=t.PhoneNumberFormat||(t.PhoneNumberFormat={}));class S{static isPossibleNumber(e,t){return S._getInstance().isPossibleNumberString(e,t||d.default.getCountryCode())}static getRegionCodeForNumber(e){try{return e?S._getInstance().getRegionCodeForNumber(e):void 0}catch(t){return void r.error(s.LogTraceArea.Phone,"PhoneUtils.getRegionCodeForNumber: Failed to get region code for number "+a.pii.Omit(e?e.getRawInput():"")+" - "+c.default.errorAsString(t))}}static getCountryCodeForRegion(e){return S._getInstance().getCountryCodeForRegion(e)}static isValidNumberString(e){return S.isValidNumber(S.parse(e))}static isValidNumber(e){return!!e&&S._getInstance().isValidNumber(e)}static parseAndFormat(e,t,i){const a=S.parse(e,i);if(a&&S._getInstance().isValidNumber(a))return S.format(a,t)}static parse(e,t){try{return S._getInstance().parse(e,t)}catch(e){return}}static parseAndKeepRawInput(e,t){try{return S._getInstance().parseAndKeepRawInput(e,t)}catch(t){return void r.error(s.LogTraceArea.Phone,"PhoneUtils.parseAndKeepRawInput: Failed to parse phone number "+a.pii.Omit(e)+" - "+c.default.errorAsString(t))}}static format(e,t){return t?S._getInstance().format(e,S._getGoogleFormat(t)):S._getInstance().format(e)}static formatNumberWithType(e){const t=S.getStringForPhoneType(e.type);let i=e.number;try{const t=S._getInstance().parse(e.number);i=S._getInstance().format(t,n.PhoneNumberFormat.INTERNATIONAL)}catch(e){}return l.getString("PhoneUtils.PhoneFormat",{type:t,number:i})}static getMatchedPhoneNumber(e,t){if(e&&0!==e.length)return o.find(e,(e=>e.number.indexOf(t)>-1))}static getStringForPhoneType(e){switch(e){case u.PhoneNumberTypes.Home:return l.getString("PhoneUtils.PhoneHome");case u.PhoneNumberTypes.Mobile:return l.getString("PhoneUtils.PhoneMobile");case u.PhoneNumberTypes.Office:return l.getString("PhoneUtils.PhoneOffice");case u.PhoneNumberTypes.Other:return l.getString("PhoneUtils.PhoneOther");default:return h.default.switchStatementExhaustiveChecking(e)}}static convertLabelToPhoneType(e){if(!e)return u.PhoneNumberTypes.Other;switch(e.toLowerCase()){case"mobile":return u.PhoneNumberTypes.Mobile;case"office":return u.PhoneNumberTypes.Office;case"home":return u.PhoneNumberTypes.Home;default:return u.PhoneNumberTypes.Other}}static getNormalizedPhoneNumber(e,t=!0){let i=e.trim();if(t&&(i=S.convertPhoneLetters(i),i=i.replace(p,""),0===i.length))return"";let a=d.default.getCountryCode();if(!a){const e=l.getLocale().split("-");e instanceof Array&&e.length>1&&(a=e[1])}i=S.convert00ToPlus(i);let n=S.parse(i,a);return n&&S.isValidNumber(n)?S.format(n,m.E164):n&&o.startsWith(i,"+")?i:o.startsWith(i,"+")?void 0:(n=S.parse("+"+i),n&&S.isValidNumber(n)?S.format(n,m.E164):i)}static normalizePartialNumberWithCountryCode(e){let t=e.replace(p,"");if(0===t.length)return"";const i=d.default.getCountryCode();if(t=S.convert00ToPlus(t),!o.startsWith(t,"+")&&i)try{const e=S._getInstance().getCountryCodeForRegion(i);return S.compilePhoneNumber(t,e)}catch(e){return r.warn(s.LogTraceArea.Phone,"PhoneUtils: Unable to get country code for countryCode: ",a.pii.Omit(i)),t}return t}static convert00ToPlus(e){return o.startsWith(e,"00")?"+"+e.substr(2):e}static compilePhoneNumber(e,t){return"+"+t+e}static stripSpecialChars(e){return e.replace(p,"")}static stripPossibleExtension(e){return e.replace(g,"")}static getPossibleExtension(e,t){const i=e.match(g),a=t?1:2;return i&&i[a]?i[a]:void 0}static isPossiblyPhoneNumber(e){return!!e&&(e.startsWith("+")&&(e=e.slice(1)),!isNaN(parseInt(e,10)))}static stripPlusSign(e){return e&&e.length>0&&"+"===e[0]?e.substr(1):e}static _getInstance(){return C||(C=n.PhoneNumberUtil.getInstance()),C}static _getGoogleFormat(e){switch(e){case m.E164:return n.PhoneNumberFormat.E164;case m.INTERNATIONAL:return n.PhoneNumberFormat.INTERNATIONAL;case m.NATIONAL:return n.PhoneNumberFormat.NATIONAL;case m.RFC3966:return n.PhoneNumberFormat.RFC3966}}static convertPhoneLetters(e){e=e.toLowerCase();let t="";const i=o.startsWith(e,"+");return o.each(e.split(""),(e=>{switch(e){case"0":t+="0";break;case"1":t+="1";break;case"2":case"a":case"b":case"c":t+="2";break;case"3":case"d":case"e":case"f":t+="3";break;case"4":case"g":case"h":case"i":t+="4";break;case"5":case"j":case"k":case"l":t+="5";break;case"6":case"m":case"n":case"o":t+="6";break;case"7":case"p":case"q":case"r":case"s":t+="7";break;case"8":case"t":case"u":case"v":t+="8";break;case"9":case"w":case"x":case"y":case"z":t+="9"}})),i&&(t="+"+t),t}}t.default=S},10771:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(97691),o=i(51638),s=i(46096),r=i(36237);t.default=new class{shouldPresentScheduleNextCallPanel(e,t,i,n,o){if(!a.isEmpty(t))return r.log(s.LogTraceArea.ScheduleCall,"shouldPresentScheduleNextCallPanel: skipping for "+e.callId+" because other calls are active "+JSON.stringify(t)),!1;const l=e.durationSeconds>o.scheduleNextCallDurationSeconds,c=n>=o.scheduleNextCallFrequency,d=i<o.maxScheduleNextCallDisplays;return!!(l&&c&&d&&e.isCallCreator)}shouldPresentCallQualityFeedbackPanel(e,t,i,l,c){return a.isEmpty(t)?l?(r.log(s.LogTraceArea.CallQualityFeedback,"CallQualityFeedbackPanel:_maybePresentCQF: showing because of forceCQF"),n.Resolved(!0)):o.shouldTriggerForCall(e.callInfo,i,c).then((t=>(t&&r.log(s.LogTraceArea.CallQualityFeedback,"CallQualityFeedbackPanel:_maybePresentCQF: showing for "+e.callInfo.callId+" because of ECS"),t))):(r.log(s.LogTraceArea.CallQualityFeedback,"shouldPresentCallQualityFeedbackPanel: skipping for "+e.callInfo.callId+" because other calls are active "+JSON.stringify(t)),n.Resolved(!1))}shouldPresentPermissionPanel(e,t){return!!a.isEmpty(t)||(r.log(s.LogTraceArea.CallMonitor,"shouldPresentPermissionPanel: skipping for "+e.callId+" because other calls are active "+JSON.stringify(t)),!1)}shouldPresentCallerIdPanel(e){return a.isEmpty(e)}}},33004:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(16778),o=i(44770),s=i(89391),r=i(80200),l=i(51077),c=i(23293),d=i(86374),u=i(52262),h=i(82433),p=i(46096),g=i(36237),C=i(33754),m=i(89808),S=i(18078),y=i(4057),f=i(78780),_=i(78262),b=["cid","sender","receivers","message"];class T{static imageForSticker(e){switch(e.toLowerCase()){case"sticker1":return o.Collection.CAPTURE_STICKER1;case"sticker8":return o.Collection.CAPTURE_STICKER8;case"sticker17":return o.Collection.CAPTURE_STICKER17;case"sticker20":return o.Collection.CAPTURE_STICKER20;case"sticker22":return o.Collection.CAPTURE_STICKER22;case"sticker29":return o.Collection.CAPTURE_STICKER29;case"sticker31":return o.Collection.CAPTURE_STICKER31;case"sticker32":return o.Collection.CAPTURE_STICKER32;default:return o.Collection.CAPTURE_STICKER33}}static stickerKeyForText(e){switch(e){case"omg":return"STICKER31";case"snap":return"STICKER33";case"awesome":return"STICKER8";case"BRB":return"STICKER1";case"hello":return"STICKER29";case"oops":return"STICKER22";case"yes":return"STICKER17";case"ouch":return"STICKER20";case"wow":return"STICKER32"}}static textForImageSticker(e){switch(e){case"STICKER31":return"omg";case"STICKER33":return"snap";case"STICKER8":return"awesome";case"STICKER1":return"BRB";case"STICKER29":return"hello";case"STICKER22":return"oops";case"STICKER17":return"yes";case"STICKER20":return"ouch";case"STICKER32":return"wow"}}static localizedAccessibilityTextForImageSticker(e){switch(e){case"STICKER31":return C.getString("Sticker.OMGAccessibilityLabel");case"STICKER33":return C.getString("Sticker.SnapAccessibilityLabel");case"STICKER8":return C.getString("Sticker.AwesomeAccessibilityLabel");case"STICKER1":return C.getString("Sticker.BRBAccessibilityLabel");case"STICKER29":return C.getString("Sticker.HelloAccessibilityLabel");case"STICKER22":return C.getString("Sticker.OopsAccessibilityLabel");case"STICKER17":return C.getString("Sticker.YesAccessibilityLabel");case"STICKER20":return C.getString("Sticker.OuchAccessibilityLabel");case"STICKER32":return C.getString("Sticker.WowAccessibilityLabel")}}static messageToReactionsEmoticonLocalizedAccesssibilityString(e){const t=e.getEmoticonCallReactionKey();return t?this.localizedAccessibilityTextForEmoticon(t):void 0}static localizedAccessibilityTextForEmoticon(e){const t=h.default.getEmoticonByNameNoSubscription(e);return(null==t?void 0:t.description)||e}static isAnimationReaction(e){return"cake"===e}static isSuperAnimationReaction(e){return a.includes(s.default.getS4LCMCFeatures().callAnimatedReactionsConfig.callAnimatedReactionsKeys,e)}static superAnimationReactionsNumber(e){let t=0;return a.each(e,(e=>{this.isSuperAnimationReaction(e)&&t++})),t}static isTranscriptionReaction(e){const t=y.default.parseJsonErrorToUndefined(e.content);return t&&a.every(b,(e=>e in t))}static isCallEventReaction(e){const t=d.decode(e),i=a.last(t.children);if(!i.getInternalType)return!1;const n=i.getInternalType()&&i.getInternalType()||_.ReactionsTextType.Default;return!!i.getUserMri()&&a.includes([_.ReactionsTextType.CallEventMuted,_.ReactionsTextType.CallEventKickedOut,_.ReactionsTextType.CallEventTransfer,_.ReactionsTextType.CallEventKickedOutOwn],n)}static animationInfoForKey(e,t){switch(e){case"beer":return f.default.BEER;case"cake":return t?f.default.CELEBRATION_ICBC:f.default.CELEBRATION_ICBC_PORTRAIT;case"clap":return f.default.CLAP;case"dropthemic":return f.default.DROPTHEMIC;case"facepalm":return f.default.FACEPALM;case"fire":return f.default.FIRE;case"heart":return f.default.HEART;case"highfive":return f.default.HIGHFIVE;case"laugh":return f.default.LAUGH;case"mistletoe":return f.default.MISTLETOE;case"penguin":return f.default.PENGUIN;case"rudolfsurprise":return f.default.RUDOLFSURPRISE;case"sad":return f.default.SAD;case"sarcastic":return f.default.SARCASTIC;case"snowflake":return f.default.SNOWFLAKE;case"surprised":return f.default.SURPRISED;case"xmascwl":return f.default.XMASCWL;case"xmasyes":return f.default.XMASYES;case"yes":return f.default.YES}}static announceReaction(e){const t=u.default.getDisplayableProfile(e.creator);let i,o,s=!0;if(e.isEmoticonCallReaction())i=T.messageToReactionsEmoticonLocalizedAccesssibilityString(e);else{const t=d.decode(e),n=a.last(t.children),r=a.first(t.children);if(o=n.getStyle?n.getStyle():void 0,o===_.ReactionsTextStyle.Sticker){if(r.getRawText?r.getRawText():void 0){const e=T.stickerKeyForText(r.getRawText());i=e&&T.localizedAccessibilityTextForImageSticker(e)}}else{if(r.children.length){const e=a.first(r.children);e.getRawText&&(i=e.getRawText())}else r.getRawText&&(i=r.getRawText());s=!1}}if(i){if(s){let e;e=o===_.ReactionsTextStyle.Snapshot?i:C.getString("AccessibilityLabel.Reactions1User",{firstUser:t.getShortName(),reactionName:i}),n.Accessibility.announceForAccessibility(e)}}else g.warn(p.LogTraceArea.CallReactions,"ReactionsEmojiStream._updateReactionsAndReturnState Unsupported reaction emoticon/sticker or empty text")}static callReactionInfoForReaction(e){const t=d.decode(e),i=a.last(t.children),n=l.getMessageTypeGroup(e),o=i.getStyle&&i.getStyle()||_.ReactionsTextStyle.Default;let s;if(!e.isEmoticonCallReaction()&&n===l.MessageTypeGroups.Text){const i=a.first(t.children);let n;if(i.children.length){const e=a.first(i.children);e.getRawText&&(n=e.getRawText())}else i.getRawText&&(n=i.getRawText());if(o===_.ReactionsTextStyle.Sticker&&n){const e=T.stickerKeyForText(n);e&&(s=T.imageForSticker(e))}else if(o===_.ReactionsTextStyle.Snapshot){const t=u.default.getDisplayableProfile(e.creator);s=C.getString("CallPanel.SnapshotNotification",{name:t.getShortName()})}else s=n}const r=S.default.isMyMri(e.creator);return{reaction:e,reactionsTextStyle:o,gradientColors:r?m.default.getGradientColors():c.default.getGradientColors(e.creator),isLocal:r,content:s}}static parseCallEventReaction(e){const t=d.decode(e),i=a.last(t.children);if((i.getStyle&&i.getStyle()||_.ReactionsTextStyle.Default)===_.ReactionsTextStyle.CallEvent){const t=i.getInternalType()&&i.getInternalType()||_.ReactionsTextType.Default,a=i.getUserMri();if(a)return{mri:e.creator,actionMri:a,eventType:t}}}}t.default=T,T.reactionItems=[{key:"heart",type:r.ReactionsItemType.Emoticon},{key:"STICKER32",type:r.ReactionsItemType.Sticker},{key:"cwl",type:r.ReactionsItemType.Emoticon},{key:"STICKER8",type:r.ReactionsItemType.Sticker},{key:"sad",type:r.ReactionsItemType.Emoticon}]},72311:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(46096),n=i(38891),o=i(40363),s=i(78262),r={disableSlimcoreObjectChangeDebouncing:!1,enableEndCallInRecents:!1,enableElectronIntegratedCalling:!1,enableCreditPurchase:!1,enableEnhancedPhotoExposure:!0,enableStreamVideo:!1,enableFilters:!0,enableAdaptiveCameraContentScale:!1,enableAzMSPublish:!1,enableAzMSConsume:!1,enableDesktopVIM:!0,desktopVIMAMSDocumentType:"sharing/videototranscode",resumableUploads:{enabled:!0,types:["Video","VideoMessage"]},enableDesktopVIMThumbnailUpload:!0,mobilePreviewPercentage:.2,enableNoMicModal:!0,enableMissedCallbackReminderAppActive:!1,enableIncomingVideoNotification:!1,enableNewIncomingVideoSound:!1,maximumVideoSuggestionTooltipInteraction:3,enableMicPopup:!0,enableRNStreamsV2:!1,enableStartVideoOnSettingsClose:!0,desktopVIMAppendExtensionOnUpload:!0,enableOutgoingWarmStartMessage:!0,enableTestCalls:!1,maximumGroupSizeRing:25,maximumGroupSizeGoLive:250,maximumGroupSizeRinglessCall:50,enableCallReconnectUI:!0,enableCallReconnectSound:!0,maxRecordingMs:18e4,videoWidth:640,videoHeight:360,videoBitrate:1300,enableMsnpFlamingoMessages:!0,createTranslatedChatEnabled:!0,translatorAgentId:"28:0d5d6cff-595d-49d7-9cf8-973173f5233b",videoProfile:1,enableVideoBFrame:!1,videoReEncodeKeyFrameSec:1,optimizeVideoForNetwork:!1,captureStopDelayMs:1e4,cameraVersion:1,enableSimpleTextReactions:!1,enableHDVideo:!1,enableMomentsCapture:!0,enableMomentsCaptureCoachmarkforScreenshare:!1,enableNewCaptureActivityPip:!0,androidCallMonitorConfig:{permissionPromptMaxDisplayCount:3,permissionPromptResetIntervalSeconds:2419200},enableDXVAOffloading:!0,enableBufferSharing:!1,callRecorderBotEnabledOneOnOneCall:!0,callRecorderBotEnabledGroupCall:!0,callRecorderBotEnabledOneOnOnePstnCall:!1,callRecorderBotMri:"28:0ad9717e-76fd-4658-a764-beaf21698977",callRecorderBotMriFilter:["28:0ad9717e-76fd-4658-a764-beaf21698977","28:56fc6434-1e40-4e9e-ace2-373ce28cfba4"],callRecorderRetentionDurationDays:30,callReactionsBarButtonConfig:{mobile:[["Moments"],["Reactions"]],tablet:[["Chat","Moments"],["Gallery","Reactions"]]},enablePhotoSharingCoachMark:!1,callKitSupportDisabledCalls:!0,enableCallTechnicalInformation:!1,callReactionButtonKey:"heart",callCelebrationConfig:{callCelebrateButtonKey:"cake",celebrationAnimationTimeoutsinMs:{cake:3750,clap:2e3,default:3e3}},callAnimatedReactionsConfig:{callAnimatedReactionsKeys:["beer","clap","dropthemic","facepalm","fire","heart","highfive","laugh","mistletoe","penguin","rudolfsurprise","sad","sarcastic","snowflake","surprised","xmascwl","xmasyes","yes","cake"],callAnimatedReactionsTimeoutsinMs:{beer:3e3,cake:3750,clap:2e3,default:3e3,fire:3600,heart:2e3,laugh:2e3,penguin:6300,rudolfsurprise:3e3,sad:2e3,sarcastic:2e3,snowflake:5e3,surprised:2e3,yes:2e3}},enableNewAnimations:!1,enableGifCaptureLoadingIndicator:!1,allowIncomingCallsWithExpiredToken:!1,enableAddToCallRibbonCoachMark:!1,enableImmersiveModeRibbon:!0,enableNDISetting:o.default.isElectronOsx()||o.default.isElectronWindows(),learnMoreNDILink:"https://www.newtek.com/blog/tips/using-ndi-in-skype/",broadcastTermsOfServiceUrl:"https://www.skype.com/{lang}/legal/broadcast/",enableMessageTranslation:!1,enableOldMessageTranslation:!0,translatorBotDeprecationDate:"31/12/2019",enableTranslatorBotDeprecation:!1,messageTranslatorEndpointUrl:"https://translatorv2.skype.com/api/v1/text.translation",callCaptionsEnableTranslatedVoiceOption:!1,isCallCaptionsCleanupEnabled:!1,callCaptionsCleanupBatchSize:1e3,callCaptionsCleanupValidDate:"",callCaptionsClearTimeout:7e3,callCaptionsMaxHistory:100,callCaptionsEnableForAllCallsOption:!0,callCaptionsEnableSubtitleLanguageOption:!1,isInterimCaptionConcatenated:!1,isInterimCaptionHighlightEnabled:!1,callCaptionsUiV2:!1,callCaptionsUiV2AlwaysBlack:!0,callCaptionsUiV2DynamicWidth:!0,callCaptionsUiV2ShortName:!0,callCaptionsStartImmediateTrigger:!1,callCaptionsLiveButton:!1,callCaptionsMerge:!0,callCaptionsPositionModeDefault:n.CaptionsPositionMode.float,callCaptionsFloatPanel:{enabled:!0,letterSpacingWindows:0},callCaptionsBottomPanel:{enabled:!0,desktopSizePercentage:.2,mobileSizePercentage:.35,captionsWidthDesktopPercentage:.6},callCaptionsLeftPanel:{enabled:!1},callTranslatorBotConfig:{enabledTranslatorOneOnOneCall:!1,enabledTranslatorOneOnOnePstnCall:!1,enabledTranslatorGroupCall:!1,hideInRoster:!0,botMri:"28:5dad43e6-3db1-435f-b8ee-7b0a759c658f",botMriFilter:["28:9f6cbb6e-083f-4b96-bcfa-802488dcf40e","28:d96d5a9f-c9ae-41af-9187-e213d456041f","28:29a41b3a-90e7-4d23-9d24-afe4dee2e4e7","28:52b0c63e-a675-4e38-b8fb-b373d96ec315","28:f15ea256-e453-4b87-810e-6fabc0a6fdb3","28:f4c739a9-9d32-45a9-bb93-bfb955b30270","28:5dad43e6-3db1-435f-b8ee-7b0a759c658f"],service:{id:"skype.tx",version:1},languageSupport:{speech:["de-DE","en-GB","en-US","es-ES","fr-FR","it-IT","ja-JP","pt-BR","ru-RU","zh-CN","zh-TW"],tts:["de-DE","en-GB","en-US","es-ES","fr-FR","it-IT","ja-JP","pt-BR","ru-RU","zh-CN","zh-TW"]},translatorBotClientTimeoutMs:5e3},pstnTranslation:{enabled:!1,showToast:!0,privacyLink:"https://go.skype.com/privacy",useAlertDialogOnDesktop:!1,useUserIconInsteadOfFlags:!1,hideSettingsOnTranslationStart:!1,translationSettingsHideTimeout:5e3},translationDefaultVoice:n.Gender.female,isStartCaptionsInfoPanelEnabled:!1,callControlTimeoutMs:7e3,callControlShortTimeoutMs:5e3,enableCallKitOnlyBehavior:!0,enableHighContrastTheme:!1,enableSnapshotNotification:!0,syncAdapterMode:"on",autoGrantContactsWritePermissions:!0,photoEventTimeoutMs:5e3,callAudienceBotConfig:{enabledOneOnOneCall:!1,enabledGroupCall:!1,enabledBackgroundSelection:!1,botMri:"28:9cd07db6-fab5-438c-8e34-44117fac7650",botMriFilter:["28:4969df63-cfcb-45e3-b06e-1f2b54d8b9bb","28:9cd07db6-fab5-438c-8e34-44117fac7650","28:3d59cb08-f597-4e49-9add-a05f9735152b"],backgrounds:[],minParticipantsOnCall:2,maxNumberOfAttemptsForDataChannelHandler:4,retryDelayMsForDataChannelHandler:500},callGridViewBotConfig:{enabled:!1,botMri:"28:ab5d1521-415b-4380-82e4-af803fb8bf2d",botMriFilter:["28:9dc84a1d-cd1f-4e39-83b4-365e9482e2ad","28:8cf0f6d9-65dc-464b-a2cb-8f66a9767358","28:ab5d1521-415b-4380-82e4-af803fb8bf2d"],minParticipantsOnCall:2},enableUFDForDeviceHasEcho:!1,enableAttachVideoWithId:!1,enableRemoteMute:!0,enableJoinerCallPreview:!1,enableRinglessCall:!1,enableRinglessCallForSmallGroups:!1,enableEndGoLiveForLastParticipant:!1,enableStopCallControlTimerWhenActionsMenuOpened:!0,enableBlockPSTNUserInContactInviteHeader:!1,enablnewPSTNLandingScreenWhileSearch:!1,enableTapToMoveCallParticipant:!1,enableAddToCallGroupJoinLink:!0,enableCallRosterGroupJoinLink:!0,enableSkypeLogo:!0,enableSlimcorelogging:!1,enableSecondaryRinging:!0,enableUnmuteOnRing:!0,retryPolicy:{maxPostElapsedTime:3e5,maxTransferTime:{postingService_getStatusServerTranscoding:6e4,postingService_postChatMessage:s.NumberShim.MAX_SAFE_INTEGER,postingService_postChatMessageForeground:s.NumberShim.MAX_SAFE_INTEGER},maxRetriesDefault:5,maxRetries:{postingService_urlPreviewFetching:3,postingService_updateChatMessageProperties:3,postingService_getStatusServerTranscoding:1e3,postingService_postChatMessage:s.NumberShim.MAX_SAFE_INTEGER,postingService_postChatMessageForeground:s.NumberShim.MAX_SAFE_INTEGER},constantPollTime:{postingService_getStatusServerTranscoding:500},countLocalNetworkFailures:!0},optimalVideoCountInitialThrottleSeconds:0,serverVideoTranscoding:{enabled:!1,expectedTimeToCompleteMs:1e3,expectedTimeDisplayPercentage:.9},localPreviewAndroidV2:!1,enableShowCallRateInPSTNCallWindow:!0,enableNewCameraFlipFlow:!0,enableMultiGradientOverlay:!0,enablePreRS5HIDSupported:!0,enableAccessibleRecordButton:!1,disableCopyingOriginalVideoToCache:!1,videoReencodeConfig:{profile:2,highQualitySource:!1,outputWidth:1280,outputHeight:720,videoBitrate:2e6,audioBitrate:96e3,minSizeDecreaseRatio:.2},picturePrefetchEnabled:!0,picturePrefetch:{status:"On",maxTimeIntervalPriorToStartupSec:86400,maxQueuedEntriesCount:20},picturePrefetchCacheExpiryTimeSec:259200,videoPrefetchCacheExpiryTimeSec:259200,enableLibraryVideoMarkup:!1,maxVideoDurationOnMobileMin:1,enableRingingNotifications:!0,fileRetentionDurationDays:30,screensharingIconFromECS:"",scheduleNextCallDurationSeconds:300,scheduleNextCallFrequency:20,scheduledCallNotSupportedFallbackUrl:"https://www.skype.com/get-skype",scheduledCallSearchBatchSize:100,enableScheduledCallAddToCalendar:!1,enableScheduledCallsSystemMessages:!1,scheduledCallInviteSendTimeout:3e3,maxScheduleNextCallDisplays:5,enableMeetNowEmoticonPicker:!1,enableMeetNowStickersOnSafari:!1,meetNowTitleSuggestionList:{enableSuggestionList:!1,isFlatList:!0},redesignedLobbiesEnabled:!1,removeThreadIdFromUrlHistory:!1,waitJoinKnowledgeTimeoutMs:15e3,enablePreHeatCall:!1,enableObservingCall:!1,enableFullScreenOnWeb:!1,enableDoubleTapToFullScreen:!1,serverMessagesAfterThreadCreationTimeWindow:3e3,ignoreNonFatalError:!0,earpieceHiddenForVideoCalls:!1,enableRequestNewAppInitiatedCallAPI:!1,reportCallEndedWhenStopTrackingCall:!0,enableMobileScreenSharing:!1,enableCameraPortraitLock:!1,enableMobileSubtitlesRightPanel:!1,enableScreenSharingToolbar:!1,enableDeclineAndMessageOnRingControls:!1,enableBlurBackgroundForAllCalls:!1,footprintServiceIntervalInMinutes:0,footprintServiceConfigUrls:[],enableScreenSharingControl:!1,enableEndCallWhenSystemSleeps:!1,useConverstionSyncForJoinCall:!1,enableOfficeLens:!1,enableOfficeLensOnChromeOs:!1,officeLensMinAndroidOsVersion:26,officeLensMinIosVersion:"12.2.0",disableParticipantTalkingAnimation:!1,enableShouldShowCQFDelegation:!1,enableScreenRecordingPermission:!1,enableCallIntegration:!1,enableBackgroundReplacement:!1,enableBackgroundBlurOnWeb:!1,enableBackgroundBlurOnIOS:!1,enableBackgroundBlurOnAndroid:!1,enableBackgroundBlurNewLabel:!0,backgroundEffects:[],bingBackgrounds:{enabled:!1,enableImageDownload:!1,enableDataChannel:!1,enableRoster:!1,dataChannelId:14,host:"https://www.bing.com",path:"/hp/api/v1/imagegallery?format=json&setmkt=[LOCALE]&today=1",syncIntervalMs:216e5,maxImageDownloadRetries:10,pickImageBasedOnUserIdHash:!1,showInSettings:!1,showInCallHeader:!1,showInCallFooter:!1,iconCountInHeader:1,captionAlwaysCollapsed:!0,useBingLogoInsteadOfSearchIcon:!1,showBackgroundCaptions:!0,tryOpenInAppBrowser:!0,sendBackgroundInfoUpdates:!0,throttleIntervalMs:500,retryDataChannelSendOnError:!0,retryDataChannelMaxNumber:3,retryDataChannelDelayMs:2e3,clickLinkPartnerCode:"SBIOTD"},backgroundCategories:a.BackgroundCategories,enableBackgroundEffectsCategories:!1,numberOfVisibleLastUsedEffects:4,backgroundEffectsUri:"https://secure.skypeassets.com/content/dam/scom/",backgroundEffectsDefaultFolder:"skypebackgroundimage/",hideSnapshotButton:!1,keepScreenShareWhenDisableVideo:!1,modernCallStage:{enabled:!1,maxStageElements:4,animationDuration:250,keepStreamAlive:!1,enableVideoPrioritization:!1,minVideoSize:{width:360,height:270},mobileMinVideoSize:{width:180,height:135},autoLetterBoxThresholdRatio:.3},enableNotifyUsersMuteKick:!1,enablePerfomanceTelemetry:!1,perfomanceTelemetryTimeoutInterval:5e3,enableAllCallButtonsVisible:!1,enableNewBackgroundEffectsLayout:!1,maxNumberOfVideosInUI:12,enableDialpadOnPSTNSubtitlesCalls:!1,disableVideosInRibbon:!1,enableCallPreviewPermissionOnLoad:!1,enableRaiseHands:!1,enableDeviceNumberTelemetry:!1,enableMsixPermissionTelemetry:!1,enableUFDQualityTelemetry:!1,enableShareInviteMessageVariant:!1,enableExperimentalVideoRendering:!1,enablePresentationMode:!1,enableParticipantsButtonInCallControls:!1,enableNewMainCallControlsForOldCallScreen:!1,enableAudioParticipantsOnTheStage:!1,enableAudioParticipantsOnTheStageByDefault:!1,enableAudioParticipantsOnTheStageAsNew:!1,enableNewCallScreen:!1,newCallScreenEnabledByDefault:!1,enableLightThemeOnCallStage:!1,enableTransparentVideoStream:!1,enableAudioParticipantsBackground:!1,enableAudioParticipantsBackgroundInTray:!1,audioParticipantsBackgroundFileNames:[],enableReactionsInCallStageMobile:!1,enableOutgoingVideoFirefox:!1,enableIncomingVideoFirefox:!1,enableScreenSharingFirefox:!1,cameraHelp:{showCameraIssuesText:!1,cameraIssuesLink:"https://go.skype.com/call.quality.guide"},enableUIToSelectSkypeOrPSTNContactToAddToGroupCall:!1,meetNowRequestsConfig:{retryCount:3,timeoutInMs:15e3},electronNavigationDebounce:1e3,enableReorderingParticipantsRaiseHand:!0,enableSpeechConsentFlow:!1,speechConsentFlowConfig:{callsBetweenConsentSuggestion:5,maxSuggestionsShownCount:3},enableNoiseSuppression:!1,enableNewLayoutPicker:!1,enableLockMeeting:!1,enableAudienceDataChannel:!1,enableAsyncMedia:!1,PSTNCampaignTerminatedReasons:[],customCallReactions:{enabled:!1,maxNumberOfCustomReactions:6,defaultPack:["yes","cwl","surprised","clap","cry"],useNewAddEmojiIcon:!1},enableNewCustomCallReactions:!1,timeoutForRendererInState:5e3,enableCallHandoff:!1,enableCallLowerHandByOthers:!1,enableMultipleStreamSupport:!1,autoLetterBoxThresholdRatioForNewStage:.5,enableLocalSpeakingIndicator:!1,callingStoreThrottleMs:void 0,enableEcoMode:!1,enableCallParticipantsPinning:!1,twinCamEnabled:!1,twinCamOneOnOneForceUpdateEnabled:!1,enableTopTrayHiding:!1,enableScreenShareZoom:!1,enableRaisedHandsOnCallMonitor:!1,enablePictureInPictureCallMonitor:!1,enablePerfResponsivenessTracking:!1,responsivenessTrackingTimeout:6e4,responsivenessScenarioSampling:{},enableNSModeSwitching:!1,audioConfig:{enableMusicMode:!1,enableAEC:!1,enableSpatialAudio:!1,defaultMusicMode:!1,defaultAECMode:!1},enableNewCallPanel:!1};t.default=r},26517:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(97691),n=i(89391),o=i(36237),s=i(46096),r=i(22538);t.default=new class{constructor(){this._audioBackgrounds=[],r.RegisterStartupable(this,"AudioParticipantBackgroundHelper")}startup(){const{enableAudioParticipantsBackground:e,audioParticipantsBackgroundFileNames:t,backgroundEffectsUri:i,backgroundEffectsDefaultFolder:o}=n.default.getS4LCMCFeaturesNoSubscription();return e&&(this._audioBackgrounds=t.map((e=>({uri:i+o+e,available:!0})))),a.Resolved()}getAvailableBackgroundUri(){if(0===this._audioBackgrounds.length)return void o.log(s.LogTraceArea.CallingUI,"There are no backgrounds to select from.");this._audioBackgrounds.some((e=>e.available))||this._audioBackgrounds.forEach((e=>e.available=!0));const e=this._audioBackgrounds.find((e=>e.available));return e?(o.log(s.LogTraceArea.CallingUI,"Available background found."),e.available=!1,e.uri):void 0}setBackgroundAvailable(e){const t=this._audioBackgrounds.find((t=>t.uri===e));t&&(t.available=!0)}}},54597:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.updateTelemetry=t.getCallConnectionType=t.getCallConnectionTypeAndUpdateTelemetry=void 0;const a=i(48540),n=i(2278),o=i(71830),s=i(984),r=i(39549),l=i(46096),c=i(36237),d=i(78735),u=i(6819),h=i(14976),p=i(22538);function g(e,t){return c.log(l.LogTraceArea.Calling,"getCallConnectionType conversationMri: "+h.mriOrId(e)+" causeId: "+t),p.EnsureStarted([d.default,u.default]).then((()=>{if(d.default.getUserPreferencesLocalNoSubscription().forceRelay)return c.log(l.LogTraceArea.Calling,"getCallConnectionType NoDirectConnection due to force causeId: "+t),a.ConnectionType.NoDirectConnection;const i=u.default.getCallConnectionType();return i===a.ConnectionType.NoDirectConnection?(c.log(l.LogTraceArea.Calling,"getCallConnectionType NoDirectConnection due to NetworkOperatorStore causeId: "+t),i):e&&(o.isOneToOneThread(e)||o.isSkypeIdMri(e))?(0,r.default)().getConversationPotentiallyBeforeStartupAsync(e).then((e=>s.default.isConversationObjectAccepted(e)?a.ConnectionType.AllSupported:(c.log(l.LogTraceArea.Calling,"getCallConnectionType NoDirectConnection due to ContactsStore.isIncomingContactInvitePending causeId: "+t),a.ConnectionType.NoDirectConnection))):a.ConnectionType.AllSupported}))}function C(e,t,i){n.default.updateCallTelemetry(e,i,(e=>{e.setMccMncCode(u.default.getMccCode(),u.default.getMncCode()),e.callConnectionType(t)}))}t.getCallConnectionTypeAndUpdateTelemetry=function(e,t,i){return g(t,i).then((t=>(C(e,t,i),t)))},t.getCallConnectionType=g,t.updateTelemetry=C},12563:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.postCallEventNotification=void 0;const a=i(18078),n=i(52262),o=i(33754),s=i(46096),r=i(78262),l=i(80200),c=i(81400);t.postCallEventNotification=function(e,t,i,d,u,h){if(!d)return;let p="";const g=n.default.getDisplayableProfile(a.default.getSkypeMri()),C=n.default.getDisplayableProfile(t);switch(e){case r.ReactionsTextType.CallEventMuted:p=o.getString("CallPanel.MicrophoneServerMutedPersonalize",{initiator:g.getDisplayName(),person:C.getDisplayName()});break;case r.ReactionsTextType.CallEventKickedOut:p=o.getString("CallPanel.RemoveFromCallPersonalize",{initiator:g.getDisplayName(),person:C.getDisplayName()});break;case r.ReactionsTextType.CallEventTransfer:case r.ReactionsTextType.CallEventKickedOutOwn:p=o.getString("CallControls.RemovedFromCallByTwinCam")}const m={reactionInfo:{type:l.ReactionsItemType.CallEvent,key:p,internalType:e,userMri:t},causeId:h,timestamp:Date.now(),postSource:s.PostSource.CallMoments,callId:i,conversationMri:d,reactionsConversationMri:u,logTraceArea:s.LogTraceArea.CallingUI};c.CallReactionPostingHelpers.postReaction(m)}},13125:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PinUnpinCommand=void 0;const a=i(36237),n=i(89391),o=i(76514),s=i(9520);t.PinUnpinCommand=class{constructor(e,t){this._key=e,this._callId=t}canExecute(){return n.default.getS4LCMCFeatures().enableCallParticipantsPinning}execute(){const e=o.default.isParticipantPinned(this._key,this._callId);e?o.default.unpinParticipant(this._key,this._callId):o.default.pinParticipant(this._key,this._callId);const t=e?new s.UnpinCallParticipant(this._callId):new s.PinCallParticipant(this._callId);a.track(t)}}},18260:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.compileCallRateLabel=void 0;const a=i(89391),n=i(29951),o=i(88366),s=i(33754);t.compileCallRateLabel=function(e){let t;switch(e.callFundedBy){case o.CallRateFundingSource.Credit:e.price&&e.currency&&(t=s.getString("CallOptionsMenu.CallFundedBy_Credit",{price:n.getFormattedRate(e.price,e.currency,3)}));break;case o.CallRateFundingSource.CallingPlan:t=s.getString("CallOptionsMenu.CallFundedBy_CallingPlan");break;case o.CallRateFundingSource.FreeCall:t=s.getString("CallOptionsMenu.CallFundedBy_FreeCall");break;case o.CallRateFundingSource.TasterCall:t=s.getString("CallOptionsMenu.CallFundedBy_TasterCall",{numberOfMinutes:a.default.getS4LEntitlementFeatures().SCE.CallRates.TasterCallMaxDurationMinutes});break;case o.CallRateFundingSource.NoFunding:t=s.getString("CallOptionsMenu.CallFundedBy_NoFunding")}return t}},81400:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallReactionPostingHelpers=void 0;const a=i(94224),n=i(78968),o=i(98172),s=i(2278),r=i(80200),l=i(82261),c=i(97174),d=i(36237),u=i(85207),h=i(33004),p=i(14976),g=i(78262),C=i(94050);t.CallReactionPostingHelpers=class{static postReaction(e){e.reactionInfo.type===r.ReactionsItemType.Sticker?this._postStickerText(e):e.reactionInfo.type===r.ReactionsItemType.Emoticon?this._postEmoticon(e):e.reactionInfo.type===r.ReactionsItemType.Snapshot?this._postSnapshot(e):e.reactionInfo.type===r.ReactionsItemType.Animation?this._postAnimation(e):e.reactionInfo.type===r.ReactionsItemType.CallEvent&&this._postCallEvent(e)}static _postAnimation(e){const t=e.reactionInfo.key;this._postHelper(e,"animation",(()=>{const i=[new c.UnhandledEntity(t)];e.callId&&(i.push(new c.CallReactionMetadataEntity(e.callId,g.ReactionsTextStyle.Animation)),s.default.updateCallTelemetry(e.callId,e.causeId,(e=>e.postAnimationReaction())),s.default.trackInCallReaction(t,"animation",!1,!1,!0));const a=l.createMessageInfo(e.reactionsConversationMri,e.postSource,i,void 0,o.default.getReactionsThreadPostParams(e.conversationMri));u.default.postMessage(a),s.default.trackInCallActivity(e.callId,e.reactionsConversationMri,a.messageForPosting.clientmessageid)}))}static _postEmoticon(e){this._postHelper(e,"emoticon",(()=>a.default.CallPostMessageService.postEmoticonReactionString(e.reactionInfo.key,e.conversationMri,e.reactionsConversationMri,e.callId,void 0,e.causeId)))}static _postStickerText(e){const t=h.default.textForImageSticker(e.reactionInfo.key);t&&t.length&&this._postHelper(e,"sticker",(()=>{const i=[new c.UnhandledEntity(t)];e.callId&&(i.push(new c.CallReactionMetadataEntity(e.callId,g.ReactionsTextStyle.Sticker)),s.default.updateCallTelemetry(e.callId,e.causeId,(e=>e.postTextReaction())),s.default.trackInCallReaction(t,"sticker",!1,!1,!1));const a=l.createMessageInfo(e.reactionsConversationMri,e.postSource,i,void 0,o.default.getReactionsThreadPostParams(e.conversationMri));u.default.postMessage(a),s.default.trackInCallActivity(e.callId,e.reactionsConversationMri,a.messageForPosting.clientmessageid)}))}static _postSnapshot(e){const t=e.reactionInfo.key;if(!t.length)return;const i=[new c.UnhandledEntity(t)];e.callId&&i.push(new c.CallReactionMetadataEntity(e.callId,g.ReactionsTextStyle.Snapshot));const a=l.createMessageInfo(e.reactionsConversationMri,e.postSource,i,void 0,o.default.getReactionsThreadPostParams(e.conversationMri));u.default.postMessage(a)}static _postCallEvent(e){const t=e.reactionInfo.key;if(!t.length)return;const i=[new c.UnhandledEntity(t)];e.callId&&i.push(new c.CallReactionMetadataEntity(e.callId,g.ReactionsTextStyle.CallEvent,e.reactionInfo.internalType,e.reactionInfo.userMri));const a=l.createMessageInfo(e.reactionsConversationMri,e.postSource,i,void 0,o.default.getReactionsThreadPostParams(e.conversationMri));u.default.postMessage(a)}static _postHelper(e,t,i){let a;d.log(e.logTraceArea,"_postHelper, type: "+t+" reactionsConversationId: "+p.mriOrId(e.reactionsConversationMri)+" callId: "+e.callId+" causeId: "+e.causeId),e.timestamp&&(a=new C.default(C.ScenarioName.RenderLocalCallReaction),a.start(void 0,e.timestamp),a.markStepCompleted("onReactionPressed"),n.default.setReactionPressedScenario(a)),n.default.setHasPostedReactions(e.reactionsConversationMri,!0),i(),a&&a.markStepCompleted("posted")}}},47176:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(48540),o=i(89391),s=i(12563),r=i(94224),l=i(68580),c=i(2278),d=i(71727),u=i(71830),h=i(39549),p=i(46096),g=i(36237),C=i(33754),m=i(18078),S=i(5409),y=i(14976),f=i(11828),_=i(78262),b=i(90970);class T{static getRosterForConversation(e,t=!0){const i=(0,h.default)().getConversation(e);if(!i)return g.warn(p.LogTraceArea.CallingUI,"CallRosterUtils.getRosterForConversation: Failed to get conversation "+y.mriOrId(e)),[];const a=S.default.getSortedPeopleListInConversation(i,t);return a&&0===a.length&&g.warn(p.LogTraceArea.CallingUI,"CallRosterUtils.getRosterForConversation: returns empty list conversationId="+y.mriOrId(e)),a}static getActiveParticipants(e,t){let i=T.getRosterForConversation(t);const n=m.default.getSkypeMri();return a.filter(i,(t=>{if(t===n)return!0;{const i=r.default.CallingStore.findRemoteCallMember(e,t);return l.default.isParticipantConnected(i)}}))}static getInactiveGroupMembersFromRoster(e,t){return a.difference(e,t)}static getInactiveGroupMembers(e,t){return this.getInactiveGroupMembersFromRoster(T.getRosterForConversation(t,!1),r.default.CallingStore.getRemoteCallMemberMris(e))}static getConversationName(e){const t=(0,h.default)().getConversation(e);return t?t.topicName():(g.log(p.LogTraceArea.CallingUI,"CallRosterUtils.getRosterForConversation: Failed to get conversation "+y.mriOrId(e)),"")}static getParticipantRenderInfoConfig(e,t,i,a){const o=a?a.state:void 0,s=l.default.isParticipantConnected(a),c=a&&a.voiceLevel>0,d=o===n.ParticipantState.Ringing||o===n.ParticipantState.Connecting,u=!!a&&a.isServerMuted;return{key:e,participantState:o,isActive:s,isTalking:c,isRinging:d,isServerMuted:u,isServerMutedSupported:!!a&&r.default.CallingStore.getServerMuteUnmuteSupportedForParticipant(t,a),isLocalMuted:u,isLocalMuteSupported:i}}static getRenderInfoForParticipant(e,t){const i=e.key,a=e.participantState,n=e.isActive,o=e.isTalking,s=e.isRinging,r=e.isServerMuted,l=e.isServerMutedSupported,c=e.isLocalMuted,d=e.isLocalMuteSupported;return t&&e.participantState===t.participantState&&o===t.isTalking&&s===t.isRinging&&r===t.isServerMuted&&l===t.isServerMutedSupported&&d===t.isLocalMuteSupported&&c===t.isLocalMuted?t:{key:i,participantState:a,isActive:n,isTalking:o,isRinging:s,isServerMuted:r,isServerMutedSupported:l,isLocalMuted:c,isLocalMuteSupported:d}}static getRenderInfoForCurrentParticipant(e,t,i){const a=d.default.isLocalOrServerMuted(t);return{key:e,participantState:n.ParticipantState.Connected,isActive:!0,isTalking:!1,isRinging:!1,isLocal:!0,isLocalMuteSupported:i,isServerMuted:a,isServerMutedSupported:!0,isLocalMuted:a}}static getAllMembersWithActiveAndInactiveParticipants(e,t,i){let n={},o=[],s=[];const l=m.default.getSkypeMri();let c=T.getRosterForConversation(e);const d=r.default.CallingStore.getLocalMuteSupported(t);let u=T.getRenderInfoForCurrentParticipant(l,t,d);c&&0===c.length&&g.warn(p.LogTraceArea.CallingUI,"CallRosterUtils.getAllMembersWithActiveandInActiveParticipants: allMembers is empty list conversationId="+y.mriOrId(e));const h=a.map(r.default.CallingStore.getParticipantsWithRaisedHands(t),(e=>e.id)),C=a.uniq(a.concat(h,c)),S=a.includes(h,l);return a.each(C,(e=>{if(e!==l){const a=r.default.CallingStore.findRemoteCallMember(t,e),l=T.getParticipantRenderInfoConfig(e,t,u.isLocalMuteSupported,a),c=T.getRenderInfoForParticipant(l,i[e]);a&&c.isActive?o.push(c):s.push(c),n[e]=c}else e===l&&S&&(o.push(u),n[l]=u)})),u&&!S&&(o.push(u),n[l]=u),o&&0===o.length&&g.warn(p.LogTraceArea.CallingUI,"CallRosterUtils.getAllMembersWithActiveandInActiveParticipants: activeParticipants is empty list conversationId="+y.mriOrId(e)),{activeParticipants:o,inactiveParticipants:s,allMembers:c,allParticipants:n}}static getIconTitleForMuteOrUnMute(e,t,i,a,n){let o,s,r=!1;return t&&i?(o=f.SkypeIcon.MicrophoneOff,s=C.getString("CallControls.CallButtonUnmuteLabel")):t&&!i?(o=f.SkypeIcon.Microphone,s=C.getString("CallControls.CallButtonMute")):e&&a?a&&n?(o=f.SkypeIcon.MicrophoneOff,s=C.getString("CallPanel.MicrophoneUnMuteNotAllowed"),r=!0):(o=f.SkypeIcon.Microphone,s=C.getString("CallControls.CallButtonMute")):(o=f.SkypeIcon.Microphone,s=C.getString("CallPanel.MicrophoneMuteNotSupported"),r=!0),{icon:o,title:s,disableIcon:r}}}t.default=T,T.handleLocalMuteOrUnmute=(e,t)=>(c.default.updateCallTelemetry(e,t,(e=>e.muteCallRosterPress())),d.default.isLocalOrServerMuted(e)?(r.default.CallingStore.unmute(e,t),!1):(r.default.CallingStore.mute(e,t),b.default.updateCallRosterTelemetry(e,t,(e=>e.callRosterMutedUser())),!0)),T.handleRemoteMute=(e,t,i)=>{const a=r.default.CallingStore.findRemoteCallMember(t,e),l=u.getReactionsThreadMriForCallId(t),c=r.default.CallingStore.getCallConversationMri(t);a?(r.default.CallingStore.muteParticipants(t,n.MuteScope.Specified,[a],i).then((()=>{o.default.getS4LCMCFeaturesNoSubscription().enableNotifyUsersMuteKick&&s.postCallEventNotification(_.ReactionsTextType.CallEventMuted,e,t,c,l,i)})),b.default.updateCallRosterTelemetry(t,i,(e=>e.callRosterMutedUser()))):g.error(p.LogTraceArea.CallingUI,`[CallRosterUtils] _handleRemoteMute\n                                                          participantToMute is null or empty, causeId: ${i}`)},T.handleRemoteHangup=(e,t,i)=>{const a=u.getReactionsThreadMriForCallId(t),n=r.default.CallingStore.getCallConversationMri(t);o.default.getS4LCMCFeaturesNoSubscription().enableNotifyUsersMuteKick&&s.postCallEventNotification(_.ReactionsTextType.CallEventKickedOut,e,t,n,a,i),r.default.CallingStore.removeParticipant(t,e,i)}},72667:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(61968),n=i(92841),o=i(48540),s=i(97691),r=i(89391),l=i(94224),c=i(81400),d=i(36850),u=i(2278),h=i(80200),p=i(71727),g=i(75080),C=i(98278),m=i(52262),S=i(46096),y=i(49679),f=i(36237),_=i(35400),b=i(33754),T=i(10909),v=i(18078),w=i(85207),I=i(14976),P=i(4057),M=i(78262),k=i(75865),A=i(72758);var R,V,L;!function(e){e[e.Small=1]="Small",e[e.Medium=2]="Medium",e[e.Large=3]="Large"}(R||(R={})),function(e){e[e.Landscape=1]="Landscape",e[e.Portrait=2]="Portrait"}(V||(V={})),function(e){e[e.Row=1]="Row",e[e.Column=2]="Column"}(L||(L={}));class E{constructor(e,t){this.causeId=e,this.mri=t}}class B extends E{constructor(e,t,i){super(e,t),this._size=i}captureFrame(e){return a.default.createImageContext(this._size.width,this._size.height).then((e=>{let t=m.default.getDisplayableProfile(this.mri),i=t.getColor().colors,n=t.getAvatarUrl(M.AvatarSize.Large);n&&(n=k.default.getAuthenticatedUrl(n));let o={x:this._size.width/2,y:0},r={x:this._size.width/2,y:this._size.height},l={origin:{x:0,y:0},size:this._size},c=200;a.default.drawLinearGradient(e,o,i[0],r,i[1],l);const d=s.Defer();if(n)return a.default.createImageContextWithURL(n).then((n=>{if(a.default.isContextValid(n)){let t=a.default.getSize(n),i=t.width<=t.height?t.width:t.height,o=G((t.width-i)/2,(t.height-i)/2,i,i),s=G((this._size.width-c)/2,(this._size.height-c)/2,c,c),r=a.default.createPath(_.GCPathTypes.Arc);r?(r.appencArcToPath({x:this._size.width/2,y:this._size.height/2},100,0,2*Math.PI),a.default.clipPath(e,r)):f.error(S.LogTraceArea.CallingUI,"CallSnapshots.Audioparticipant captureFrame Graphics.createPath return undefined"),a.default.drawGraphicsContext(e,n,o,s)}else{const a=t.getInitials();this.renderAvatarInitialsLook(e,a,i,c)}a.default.createImageData(e,0,0,this._size.width,this._size.height).then((t=>{t?d.resolve(t):(f.error(S.LogTraceArea.CallingUI,"CallSnapshots.Audioparticipant captureFrame Graphics.createImageData return null"),d.resolve(void 0)),a.default.destroyContext(e),a.default.isContextValid(n)&&a.default.destroyContext(n)}))})).catch((()=>(f.error(S.LogTraceArea.CallingUI,"CallSnapshots.Audioparticipant captureFrame Graphics.createImageContextWithURL return null"),s.Resolved(void 0)))),d.promise();{const n=t.getInitials();this.renderAvatarInitialsLook(e,n,i,c),a.default.createImageData(e,0,0,this._size.width,this._size.height).then((t=>{t?d.resolve(t):(f.error(S.LogTraceArea.CallingUI,"CallSnapshots.Audioparticipant captureFrame Graphics.createImageData return null"),d.resolve(void 0)),a.default.destroyContext(e)}))}return d.promise()})).catch((()=>(f.error(S.LogTraceArea.CallingUI,"CallSnapshots.Audioparticipant captureFrame Graphics.createImageContext return null"),s.Resolved(void 0))))}renderAvatarInitialsLook(e,t,i,n){let o=g.colorStringToBodyMovinRgbArray(i[0]);a.default.setFillColor(e,255,255,255,1),a.default.fillArc(e,{x:this._size.width/2,y:this._size.height/2},n/2,0,2*Math.PI),a.default.setStrokeColor(e,Math.ceil(255*o[0]),Math.ceil(255*o[1]),Math.ceil(255*o[2]),1),a.default.setLineWidth(e,2),a.default.strokeArc(e,{x:this._size.width/2,y:this._size.height/2},n/2+1,0,2*Math.PI),a.default.setTextAlignment(e,a.HorizontalTextAlignment.Center,a.VerticalTextAlignment.Center),a.default.setFont(e,"sans-serif",n/4,!0),a.default.setFillColor(e,Math.ceil(255*o[0]),Math.ceil(255*o[1]),Math.ceil(255*o[2]),1),a.default.fillText(e,t,this._size.width/2,this._size.height/2)}}class O extends E{constructor(e,t,i){super(e,t),this._renderer=i}captureFrame(e){return s.fromThenable(this._renderer.captureFrame(e))}}class D{constructor(){this._offset={x:0,y:0},this._size={width:0,height:0},this._sizeScale=1}setSize(e){this._size=e}getSize(){return this._size}setOffset(e){this._offset=e}getOffset(){return this._offset}setSizeScale(e){this._sizeScale=e}concatSizeScale(e){this.setSizeScale(this.getSizeScale()*e)}getSizeScale(){return this._sizeScale}getRenderRectangle(){return G(this._offset.x*this._sizeScale,this._offset.y*this._sizeScale,this._size.width*this._sizeScale,this._size.height*this._sizeScale)}}class x extends D{constructor(e,t,i,a,n){super(),this._boxes=[],this.constructLayout(e,t,i,a,n)}static layoutDefinition(e,t,i,a,n){return f.log(S.LogTraceArea.CallingUI,"CallSnapshots.layoutDefinition (causeId:"+e+" ; landscape count:"+i.length+" ; portrait count: "+a.length+" )"),t.layout===L.Column?new N(e,t,i,a,n):new U(e,t,i,a,n)}static chooseRenderBox(e,t,i,a){f.log(S.LogTraceArea.CallingUI,"CallSnapshots.chooseRenderBox (causeId:"+e+" ; landscape count:"+i.length+" ; portrait count: "+a.length+" )");let n=t.orientation===V.Landscape?i:a;switch(t.sizeClass){case R.Large:return n.splice(n.length-1,1)[0];case R.Medium:return n.splice(Math.floor(n.length/2),1)[0];case R.Small:return n.splice(0,1)[0]}}constructLayout(e,t,i,a,n){if(t.definitions)for(let o of t.definitions)this._boxes.push(x.layoutDefinition(e,o,i,a,n));else if(t.elements)for(let n of t.elements)this._boxes.push(x.chooseRenderBox(e,n,i,a))}boxes(){return this._boxes}render(e){a.default.saveContext(e),a.default.setTranslate(e,this.getOffset().x,this.getOffset().y);for(let t of this._boxes)t.render(e);a.default.restoreContext(e)}setSizeScale(e){for(let t of this._boxes)t.concatSizeScale(e);this.doLayout()}doLayout(){for(let e of this._boxes)e.doLayout()}}class N extends x{doLayout(){super.doLayout();let e=0,t=-1;for(let i of this.boxes())i.getRenderRectangle().size.width>e&&(e=i.getRenderRectangle().size.width),(-1===t||i.getRenderRectangle().size.width<t)&&(t=i.getRenderRectangle().size.width);let i=(e-(e-t)/2)*this.getSizeScale();if(t!==e)for(let e of this.boxes()){let t=i/e.getRenderRectangle().size.width;e.concatSizeScale(t)}let a=0;for(let e of this.boxes())e.setOffset({x:0,y:a}),a+=e.getRenderRectangle().size.height;this.setSize({width:i,height:a})}}class U extends x{doLayout(){super.doLayout();let e=0,t=-1;for(let i of this.boxes())i.getRenderRectangle().size.height>e&&(e=i.getRenderRectangle().size.height),(-1===t||i.getRenderRectangle().size.height<t)&&(t=i.getRenderRectangle().size.height);let i=(e-(e-t)/2)*this.getSizeScale();if(t!==e)for(let e of this.boxes()){let t=i/e.getRenderRectangle().size.height;e.concatSizeScale(t)}let a=0;for(let e of this.boxes())e.setOffset({x:a,y:0}),a+=e.getRenderRectangle().size.width;this.setSize({width:a,height:i})}}class F extends D{constructor(e){super(),this._videoFrame=e,this._renderRect=this._computeRenderRect(),this.setSize({width:this._renderRect.size.width,height:this._renderRect.size.height})}isLandscape(){return this._videoFrame.getSize().width>=this._videoFrame.getSize().height}_computeRenderRect(){let e={origin:{x:0,y:0},size:{width:0,height:0}},t=this._videoFrame.getSize();if(this.isLandscape()){let i=4,a=3;e.size.width=t.width,e.size.height=a/i*e.size.width,e.size.height>t.height&&(e.size.height=t.height,e.size.width=i/a*e.size.height)}else{let i=3,a=4;e.size.height=t.height,e.size.width=i/a*e.size.height,e.size.width>t.width&&(e.size.width=t.width,e.size.height=a/i*e.size.width)}return e.origin.x=(t.width-e.size.width)/2,e.origin.y=(t.height-e.size.height)/2,e}renderRect(){return this._renderRect}doLayout(){}render(e){a.default.drawImage(e,this._videoFrame,this._renderRect.origin.x,this._renderRect.origin.y,this._renderRect.size.width,this._renderRect.size.height,this.getOffset().x,this.getOffset().y,this._renderRect.size.width*this.getSizeScale(),this._renderRect.size.height*this.getSizeScale())}}class H extends F{_computeRenderRect(){let e=this._videoFrame.getSize();return{origin:{x:0,y:0},size:{width:e.width,height:e.height}}}}class z{static takeSnapshot(e,t,i,a,n,c){f.log(S.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot causeId: "+e+" callId: "+t);const h=d.default.getStageMode(t);let g,C=[],m=[],y=0,_=!1;const b=l.default.CallingStore.isConnectedAudienceBotInCall(t),T=l.default.CallingStore.isConnectedGridViewBotInCall(t),w=b&&p.CallUIUtils.isTogetherMode(h),M=T&&p.CallUIUtils.isLargeGrid(h);if(M){const i=l.default.CallingStore.getConnectedGridViewBotMriInCall(t);i&&(z.addVideoParticipantForMri(t,i,m,e),_=!0)}else if(w){const i=l.default.CallingStore.getConnectedAudienceBotMriInCall(t);i&&(z.addVideoParticipantForMri(t,i,m,e),_=!0)}else{for(g=0;g<n.length&&!_;g++){let i=l.default.CallingStore.getBestStreamForMri(t,n[g],o.StreamType.ScreenSharing);if(i){y++;let a=l.default.CallingStore.getRemoteStreamRenderer(t,n[g],i);if(void 0!==a){let t=new O(e,n[g],a);m.push(t),_=!0}}else f.log(S.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot failed to find remote stream causeId: "+e+" callId: "+t+" mri: "+I.mriOrId(n[g]))}if(!_)for(g=0;g<n.length;g++){let i=l.default.CallingStore.getBestStreamForMri(t,n[g],o.StreamType.Video);if(i){let a=l.default.CallingStore.getRemoteStreamRenderer(t,n[g],i);if(a){let t=new O(e,n[g],a);m.push(t)}else{let t={width:600,height:450},i=new B(e,n[g],t);C.push(i)}}else{f.log(S.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot failed to find remote video streamNaN causeId: "+e+" callId: "+t+" mri: "+I.mriOrId(n[g]));let i={width:600,height:450},a=new B(e,n[g],i);C.push(a)}}}f.log(S.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot participation -  causeId: "+e+" callId: "+t+" total audio only "+C.length+" total video "+(m.length-y)+" total screen sharing "+y),u.default.updateCallTelemetry(t,e,(e=>e.setPhotoSnapshotMakeup(C.length,m.length-y,y))),r.default.getS4LCMCFeatures().enableSnapshotNotification&&z.postNotification(e,t,i,a),f.log(S.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot rendering participants -  causeId: "+e);let k=[];this.getLocalRenderer(t).then((i=>{if(!_&&!M&&!w)if(i&&i.captureFrame)try{k.push(s.fromThenable(i.captureFrame(this.sCaptureTimeoutMS)))}catch(t){f.log(S.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot localRenderer.captureFrame "+P.default.errorAsString(t)+" causeId: "+e)}else f.log(S.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot no local renderer frame capture -  causeId: "+e);for(g=0;g<m.length&&k.length<z.sMaxParticipants;g++){const t=m[g];try{k.push(t.captureFrame(this.sCaptureTimeoutMS))}catch(t){f.log(S.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot aParticipant.captureFrame "+P.default.errorAsString(t)+" causeId: "+e)}}s.all(k.map((e=>e.catch((e=>e))))).then((i=>{var a;let n=[];for(let t of i)(null===(a=null==t?void 0:t.getSize)||void 0===a?void 0:a.call(t))?n.push(t):t?f.log(S.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot error rendering a frame -  causeId: "+e+" error: "+t):f.log(S.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot null return rendering a frame -  causeId: "+e);if(n.length>0)this.renderAndPost(e,t,c,n,_);else{let i=[],a={width:600,height:450},n=new B(e,v.default.getSkypeMri(),a);i.push(n.captureFrame(this.sCaptureTimeoutMS));for(let e of C)i.length<z.sMaxParticipants&&i.push(e.captureFrame(this.sCaptureTimeoutMS));s.all(i.map((e=>e.catch((e=>e))))).then((i=>{let a=[];for(let t of i)t?a.push(t):a.length<z.sMaxParticipants&&f.log(S.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot error rendering a frame -  causeId: "+e+" error: "+t);a.length>0&&this.renderAndPost(e,t,c,a,_)}))}}))}))}static addVideoParticipantForMri(e,t,i,a){const n=l.default.CallingStore.getBestStreamForMri(e,t,o.StreamType.Video);if(n){const o=l.default.CallingStore.getRemoteStreamRenderer(e,t,n);if(o){let e=new O(a,t,o);i.push(e)}else f.error(S.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot large grid or together mode renderer is "+o)}else f.error(S.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot large grid or together mode stream is "+n)}static renderAndPost(e,t,i,a,n){let o,s=[],r=[];for(o=0;o<a.length;o++){let i=a[o];if(i){let e=i.getSize();if(!e||e.width<=0||e.height<=0)return void f.error(S.LogTraceArea.CallingUI,"CallSnapshots.renderAndPost frameSize is illegel"+e);f.log(S.LogTraceArea.CallingUI,"CallSnapshots.renderAndPost frame: #"+o+" width: "+e.width+"height: "+e.height),e.width>=e.height?r.push(n?new H(i):new F(i)):s.push(n?new H(i):new F(i))}else f.log(S.LogTraceArea.CallingUI,"CallSnapshots.renderAndPost missing frame @ #"+o+" -  causeId: "+e+" callId: "+t)}let l=this.layoutComposition(e,r.length,s.length,0,0);l&&this.processMoment(e,t,i,l,r,s)}static postNotification(e,t,i,a){const n=A.default.getFullUserProfileByMri(v.default.getSkypeMri()),o={reactionInfo:{type:h.ReactionsItemType.Snapshot,key:b.getString("CallPanel.SnapshotNotification",{name:n.getDisplayName()})},causeId:e,postSource:S.PostSource.SnapshotNotification,callId:t,conversationMri:i,reactionsConversationMri:a,logTraceArea:S.LogTraceArea.CallingUI};c.CallReactionPostingHelpers.postReaction(o)}static processMoment(e,t,i,o,s,r){f.log(S.LogTraceArea.CallingUI,"CallSnapshots.processMoment (causeId:"+e+" ; landscape count:"+s.length+" ; portrait count: "+r.length+" )"),s=s.sort(((e,t)=>e.getSize().width>t.getSize().width?1:e.getSize().width<t.getSize().width?-1:0)),r=r.sort(((e,t)=>e.getSize().height>t.getSize().height?1:e.getSize().height<t.getSize().height?-1:0));let l=x.layoutDefinition(e,o,s,r,{origin:{x:0,y:0},size:{width:0,height:0}});if(l.doLayout(),l.getRenderRectangle().size.width>this.sMaxDim){let e=this.sMaxDim/l.getRenderRectangle().size.width;l.concatSizeScale(e)}if(l.getRenderRectangle().size.height>this.sMaxDim){let e=this.sMaxDim/l.getRenderRectangle().size.height;l.concatSizeScale(e)}let c=!1;a.default.createImageContext(l.getSize().width,l.getSize().height).then((e=>{l.render(e),n.default.drawLogo(e,l.getSize().height,l.getSize().width).then((()=>{a.default.createFileData(e,this.getSnapshotFileName()+".jpeg",(e=>{e?w.default.postUploadAndShowFeedbackToast(i,e,S.PostSource.CallMoments,!1,t):(c=!0,f.error(S.LogTraceArea.CallingUI,"CallSnapshots.processMoment Graphics.createFileData return null data"))})),a.default.destroyContext(e)}))})).catch((t=>{c=!0,f.error(S.LogTraceArea.CallingUI,"CallSnapshots.processMoment failed to create context with error"+P.default.errorAsString(t)+" ( causeId:"+e+" )")})).finally((()=>{c&&T.default.scheduleTextMessage(b.getString("CallPanel.SnapshotFailureMiniToast"),void 0,C.MainRootViewId)}))}static getSnapshotFileName(){const e=new Date(Date.now()),t="Skype-"+y.getISO8601Date(e)+"-"+y.getISO8601Time(e);return t===this.lastSnapshotFileName?(this.lastSnapshotFileName=t,t+"-"+ ++this.counterForSnapshotIn1S):(this.counterForSnapshotIn1S=0,this.lastSnapshotFileName=t,t)}static getLocalRenderer(e){return l.default.CallControlsStore.isProvidingVideo(e)?s.Resolved(l.default.CallingStore.getVideoPreviewRenderer(e)):s.Resolved(void 0)}static layoutComposition(e,t,i,a,n){return f.log(S.LogTraceArea.CallingUI,"CallSnapshots.layoutComposition (causeId:"+e+" ; landscape:"+t+" ; portraitCount: "+i+")"),1===t&&0===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Column,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Large}]}:2===t&&0===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Column,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Large},{position:2,orientation:V.Landscape,sizeClass:R.Large}]}:3===t&&0===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Column,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Large},{position:1,orientation:V.Landscape,sizeClass:R.Large},{position:2,orientation:V.Landscape,sizeClass:R.Large}]}:0===t&&1===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Row,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Large}]}:0===t&&2===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Row,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Medium},{position:1,orientation:V.Portrait,sizeClass:R.Medium}]}:0===t&&3===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Row,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Medium},{position:1,orientation:V.Portrait,sizeClass:R.Medium},{position:2,orientation:V.Portrait,sizeClass:R.Medium}]}:1===t&&1===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Column,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Large},{position:1,orientation:V.Landscape,sizeClass:R.Medium}]}:2===t&&1===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Row,definitions:[{landscape:2,portrait:0,layout:L.Column,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Small},{position:1,orientation:V.Landscape,sizeClass:R.Small}]},{landscape:0,portrait:1,layout:L.Column,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Medium}]}]}:3===t&&1===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Row,definitions:[{landscape:1,portrait:1,layout:L.Column,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Large},{position:1,orientation:V.Landscape,sizeClass:R.Medium}]},{landscape:2,portrait:0,layout:L.Column,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Medium},{position:1,orientation:V.Landscape,sizeClass:R.Medium}]}]}:2===t&&3===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Column,definitions:[{landscape:1,portrait:2,layout:L.Row,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Medium},{position:1,orientation:V.Portrait,sizeClass:R.Small},{position:2,orientation:V.Portrait,sizeClass:R.Small}]},{landscape:1,portrait:1,layout:L.Row,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Large},{position:1,orientation:V.Portrait,sizeClass:R.Small}]}]}:3===t&&2===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Row,definitions:[{landscape:0,portrait:2,layout:L.Column,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Medium},{position:1,orientation:V.Portrait,sizeClass:R.Medium}]},{landscape:3,portrait:0,layout:L.Column,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Medium},{position:1,orientation:V.Landscape,sizeClass:R.Medium},{position:2,orientation:V.Landscape,sizeClass:R.Medium}]}]}:1===t&&2===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Column,definitions:[{landscape:0,portrait:2,layout:L.Row,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Small},{position:1,orientation:V.Portrait,sizeClass:R.Small}]},{landscape:1,portrait:0,layout:L.Row,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Medium}]}]}:2===t&&2===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Row,definitions:[{landscape:1,portrait:1,layout:L.Column,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Small},{position:1,orientation:V.Portrait,sizeClass:R.Medium}]},{landscape:1,portrait:1,layout:L.Column,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Medium},{position:1,orientation:V.Landscape,sizeClass:R.Small}]}]}:1===t&&3===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Column,definitions:[{landscape:1,portrait:1,layout:L.Row,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Small},{position:1,orientation:V.Landscape,sizeClass:R.Medium}]},{landscape:0,portrait:2,layout:L.Row,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Medium},{position:1,orientation:V.Portrait,sizeClass:R.Medium}]}]}:0===t&&4===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Column,definitions:[{landscape:0,portrait:2,layout:L.Row,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Medium},{position:1,orientation:V.Portrait,sizeClass:R.Medium}]},{landscape:0,portrait:2,layout:L.Row,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Medium},{position:1,orientation:V.Portrait,sizeClass:R.Medium}]}]}:4===t&&0===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Column,definitions:[{landscape:2,portrait:0,layout:L.Row,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Medium},{position:1,orientation:V.Landscape,sizeClass:R.Medium}]},{landscape:2,portrait:0,layout:L.Row,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Medium},{position:1,orientation:V.Landscape,sizeClass:R.Medium}]}]}:4===t&&1===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Row,definitions:[{landscape:1,portrait:1,layout:L.Column,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Large},{position:1,orientation:V.Landscape,sizeClass:R.Medium}]},{landscape:3,portrait:0,layout:L.Column,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Medium},{position:1,orientation:V.Landscape,sizeClass:R.Medium},{position:2,orientation:V.Landscape,sizeClass:R.Medium}]}]}:1===t&&4===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Column,definitions:[{landscape:0,portrait:3,layout:L.Row,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Medium},{position:1,orientation:V.Portrait,sizeClass:R.Medium},{position:2,orientation:V.Portrait,sizeClass:R.Medium}]},{landscape:1,portrait:1,layout:L.Row,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Large},{position:1,orientation:V.Portrait,sizeClass:R.Medium}]}]}:0===t&&5===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Row,definitions:[{landscape:0,portrait:3,layout:L.Column,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Small},{position:1,orientation:V.Portrait,sizeClass:R.Small},{position:2,orientation:V.Portrait,sizeClass:R.Small}]},{landscape:0,portrait:2,layout:L.Column,elements:[{position:0,orientation:V.Portrait,sizeClass:R.Medium},{position:1,orientation:V.Portrait,sizeClass:R.Small}]}]}:5===t&&0===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Column,definitions:[{landscape:3,portrait:0,layout:L.Row,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Small},{position:1,orientation:V.Landscape,sizeClass:R.Small},{position:2,orientation:V.Landscape,sizeClass:R.Small}]},{landscape:2,portrait:0,layout:L.Row,elements:[{position:0,orientation:V.Landscape,sizeClass:R.Medium},{position:1,orientation:V.Landscape,sizeClass:R.Small}]}]}:void f.log(S.LogTraceArea.CallingUI,"CallStageView.layoutComposition: Failed to provide layout for "+t+", "+i)}}function G(e,t,i,a){return{origin:{x:Math.ceil(e),y:Math.ceil(t)},size:{width:Math.ceil(i),height:Math.ceil(a)}}}t.default=z,z.sMaxDim=1920,z.sCaptureTimeoutMS=7500,z.sMaxParticipants=5,z.lastSnapshotFileName="",z.counterForSnapshotIn1S=0},2278:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallTriggeredBy=void 0;const a=i(96486),n=i(67287),o=i(16778),s=i(48540),r=i(97691),l=i(89391),c=i(78819),d=i(68580),u=i(9520),h=i(60021),p=i(71830),g=i(62141),C=i(98907),m=i(36699),S=i(46096),y=i(38891),f=i(36237),_=i(98754),b=i(18078),T=i(21936),v=i(1163),w=i(76173),I=i(54416),P=i(15963),M=i(77914),k=i(83181),A=i(16568),R=i(22538),V=i(99948),L=i(4057),E=i(94050),B=i(90970),O=i(18037),D=i(53374);var x;!function(e){e.None="None",e.ScheduleACall="ScheduleACall"}(x=t.CallTriggeredBy||(t.CallTriggeredBy={}));class N{constructor(){this._callTelemetryEvents={},this._callPerformanceTelemetryEvents={},this._callPerformanceTelemetryTokens={},this._incomingCallScenarios={},this._answerCallScenarioIds={},this._answerCallScenarios={},this._callAddPhotoTelemetryEvents={},this._callRecordingEvents={},this._callCaptioningEvents={},this._ndiEvents={},this._callTogetherModeEvents={},this._callLargeGridEvents={},this._onCallingError=e=>{const t=l.default.getS4LCMCFeaturesNoSubscription().PSTNCampaignTerminatedReasons;this._waitForIds().then((()=>f.track(new u.CallActionError(e,A.default.CallingNodeId.get(),A.default.EdfRegistrationId.get(),t))))},this.updateCallAudioSettingsPopupEvent=e=>{this._callAudioSettingsPopupEvent?e(this._callAudioSettingsPopupEvent):f.warn(S.LogTraceArea.Calling,"updateCallAudioSettingsPopupEvent - attempted to update the AudioSettings popup but no popup event has been set")},this.updateCallVideoSettingsPopupEvent=e=>{this._callVideoSettingsPopupEvent?e(this._callVideoSettingsPopupEvent):f.warn(S.LogTraceArea.Calling,"updateCallVideoSettingsPopupEvent - attempted to update the VideoSettings popup but no popup event has been set")},this.updateVideoSuggestionTooltipEvent=e=>{this._videoSuggestionTelemetryEvent?e(this._videoSuggestionTelemetryEvent):f.warn(S.LogTraceArea.Calling,"updateVideoSuggestionTooltipEvent - attempted to update the VideoSettings popup but no popup event has been set")},this.setCallAudioSettingsPopupEvent=e=>{this._callAudioSettingsPopupEvent||(this._callAudioSettingsPopupEvent=e)},this.setCallVideoSettingsPopupEvent=e=>{this._callVideoSettingsPopupEvent||(this._callVideoSettingsPopupEvent=e)},this.setVideoSuggestionTooltipEvent=e=>{this._videoSuggestionTelemetryEvent||(this._videoSuggestionTelemetryEvent=e)},this.sendVideoSuggestionTooltipEvent=()=>{this._videoSuggestionTelemetryEvent&&(f.track(this._videoSuggestionTelemetryEvent),this._videoSuggestionTelemetryEvent=void 0)},this._updatePerformanceEvent=e=>{var t,i,a,n;const o=c.default.getPerformanceMetrics(),s=this._callPerformanceTelemetryEvents[e];s&&o&&(o.systemUsageInfo&&s.setMainUsage(o.systemUsageInfo),s.setGPUUsage(null===(t=o.gpu)||void 0===t?void 0:t.wss,null===(i=o.gpu)||void 0===i?void 0:i.cpu),s.setRendererUsage(null===(a=o.renderer)||void 0===a?void 0:a.wss,null===(n=o.renderer)||void 0===n?void 0:n.cpu))},this._sendCallAVSettingsPopupEvents=()=>{this._callAudioSettingsPopupEvent&&(f.track(this._callAudioSettingsPopupEvent),this._callAudioSettingsPopupEvent=void 0),this._callVideoSettingsPopupEvent&&(f.track(this._callVideoSettingsPopupEvent),this._callVideoSettingsPopupEvent=void 0)},this.onCallManagerError=e=>{this._waitForIds().then((()=>{f.track(new u.CallActionCallKitError(e.operation,e.domain,e.code,e.callId,A.default.CallingNodeId.get(),!!e.terminal))}))},this.onCallManagerSuccess=e=>{f.track(new u.CallActionCallKitSuccess(e.operation,e.result,e.attemptNumber))},d.default.onCallingError.subscribe(this._onCallingError)}_waitForIds(){return r.all([A.default.CallingNodeId.waitUntilSet(),A.default.EdfRegistrationId.waitUntilSet()]).then(a.noop)}onCallCreated(e){if(!this._callTelemetryEvents[e.callId]){if(f.log(S.LogTraceArea.Calling,"Starting to track Call event for callId: "+e.callId+" causeId: "+e.causeId),this._callTelemetryEvents[e.callId]=new u.Call({callId:e.callId,conversationId:e.conversationId,participantId:e.participantId,isCallCreator:e.isCallCreator,origin:e.origin,isScheduledCallActive:e.isScheduledCallActive,source:e.source,isLegacyMeetNow:e.isLegacyMeetNow,isEchoCall:e.isEchoCall,isTranslatedCall:e.isTranslatedCall,nodeId:A.default.CallingNodeId.get(),isGroupCall:e.isGroupConversation,isFirstCall:e.isFirstCall,timeBeforeFirstCallInSec:e.timeBeforeFirstCallInSec,isPreheated:e.isPreheated,noiseSuppressionMode:e.noiseSuppressionMode,isModerated:e.isModerated}),l.default.getS4LCMCFeatures().enablePerfomanceTelemetry){const t=c.default.getPerformanceMetrics();t&&t.systemUsageInfo&&c.default.isTracking()&&(this._callPerformanceTelemetryEvents[e.callId]=new v.CallPerformanceEvent(e.callId,t.systemUsageInfo.cpuSpeed,t.systemUsageInfo.cpuModel,t.systemUsageInfo.cores),this._callPerformanceTelemetryTokens[e.callId]=c.OnMetricsUpdated.subscribe((()=>this._updatePerformanceEvent(e.callId))),c.default.startTrackingPerformance())}f.track(new u.CallEntryPoint(e.callId,e.origin))}}onCallDisposed(e,t,i){var a;if(B.default.getActiveSession()&&(f.log(S.LogTraceArea.Calling,`[CallTelemetryHelper] onCallDisposed, causeId: ${i}`),B.default.completeSession(),this.updateCallTelemetry(e.callId,i,(e=>e.callRosterClosedCount()))),e.failureType!==s.FailureType.CallSetupFailed&&e.durationSeconds>0?(this._maybeCompleteCallRecordingEvent(e.callId,i),this._maybeCompleteCallCaptioningEvent(e.callId,i),this._maybeCompleteNdiEvent(e.callId),this.onStopTogetherMode(e.callId,i),this.onStopGridView(e.callId,i),this.updateCallTelemetry(e.callId,i,(a=>{f.log(S.LogTraceArea.Calling,"Sending Call event for callId: "+e.callId+" causeId: "+i),a.isConversationAccepted(t),a.setIsCallCreator(e.isCallCreator),a.setCallConversationMriNamespace(p.getMriNamespace(e.conversationMri)),a.setCallDurationSeconds(e.durationSeconds),a.setIsPSTNCall(!!e.isPSTNCall),a.setColorTheme(O.default.colorTheme()),f.track(a)})),C.default.trackMeetNowCallIfValid(e.conversationMri),m.default.trackMeetNowCallIfValid(e.conversationMri)):(C.default.finishScenario(),m.default.finishScenario()),l.default.getS4LCMCFeatures().enablePerfomanceTelemetry&&this._callPerformanceTelemetryTokens[e.callId]){null===(a=this._callPerformanceTelemetryTokens[e.callId])||void 0===a||a.unsubscribe();const t=this._callPerformanceTelemetryEvents[e.callId];t&&f.track(t),this._callPerformanceTelemetryTokens[e.callId]=void 0,this._callPerformanceTelemetryEvents[e.callId]=void 0}this._sendCallAVSettingsPopupEvents(),delete this._callTelemetryEvents[e.callId]}updateCallTelemetry(e,t,i){const a=this._callTelemetryEvents[e];a?i&&i(a):f.warn(S.LogTraceArea.Calling,"Attempted to access telemetry event for callId: "+e+" causeId: "+t)}maybeSendInviteFreeDeclinedEvent(e,t,i,a){p.isSkypeIdMri(t)&&!i&&f.track(new u.CallActionInviteFreeDecline(e))}trackInCallReaction(e,t,i,a,n){f.track(new u.InCallReaction(e,t,i,a,n))}trackInCallUFD(e,t,i){f.track(new u.InCallUFD(e,t,i))}trackOverflowMenuActions(e){const t=a.size(e),i=e[0]||"None",n=e[1]||"None";f.track(new u.OverflowMenuOpenedEvent(t,i,n))}trackInCallActivity(e,t,i){const a=h.getCorrelationIdFromMessageParts(b.default.getSkypeMri(),t,i);f.track(new u.InCallActivity(e,a))}trackCallViewMenuActions(e){f.track(new u.CallViewMenuActionEvent(e))}trackCallPreview(e,t,i,a,n){f.track(new u.CallPreviewEvent(e,t,i,a,n))}trackRingTheGroup(e){f.track(new u.RingTheGroupEvent(e))}trackRinglessCallInterstitial(e,t){f.track(new u.RinglessCallInterstitialEvent(e,t))}trackCalleePresence(e,t,i){a.each(t,(t=>i(t).then((t=>f.track(new u.CallActionCalleeUserPresence(e,t))))))}trackAudioOutputRouteChange(e,t){const i=e!==t;f.track(new u.AudioOutputRouteChangedEvent(e,t,i))}trackSystemHotKey(e){f.track(new u.SystemHotKeyCallEvent(e))}onIncomingCallNotification(e,t){const i=D.default.newGuid();return this._waitForIds().then((()=>{if(e.eventType!==w.PNHEvents.IncomingNGCStopRinger)this._sendCallNotificationEvent(e,t),e.eventType!==w.PNHEvents.IncomingP2PCall&&e.eventType!==w.PNHEvents.IncomingGoLiveStart&&this._beginTrackingIncomingCall(i,e,t);else{}})),i}onStopCallNotification(e,t){this._waitForIds().then((()=>this._sendCallNotificationEvent(e,t)))}trackIncomingVideoNotification(e,t,i){const o=e?u.IncomingVideoNotificationAction.Pressed:u.IncomingVideoNotificationAction.Displayed,s=a.isUndefined(i)?n.IncomingVideoNotificationOrigin[n.IncomingVideoNotificationOrigin.NotSpecified]:n.IncomingVideoNotificationOrigin[i];f.track(new u.IncomingVideoNotification(s,t,o))}_sendCallNotificationEvent(e,t){f.log(S.LogTraceArea.Calling,"Sending call notification telemetry for callId: "+e.callId+" source: "+e.source+" causeId: "+t),r.all([this._waitForIds(),R.EnsureStarted(I.default)]).then((()=>{const t=N._hydrateInfo(e);f.track(new u.CallActionPushNotification(t,A.default.CallingNodeId.get(),A.default.EdfRegistrationId.get()))}))}static _hydrateInfo(e){return Object.assign(Object.assign({},e),{hasRegistered:I.default.hasRegisteredWithService(),isStarted:k.default.isUIDisplayed()})}_beginTrackingIncomingCall(e,t,i){r.all([this._waitForIds(),R.EnsureStarted(I.default)]).then((()=>{const a=N._hydrateInfo(t),n={ActivationState:o.Types.AppActivationState[o.App.getActivationState()],EventType:a.eventType,HasRegistered:a.hasRegistered,IsStarted:a.isStarted,Source:a.source,TimeWaitingToProcess:Math.max(0,a.pushProcessedTime-a.pushReceivedTime)};let s=this._incomingCallScenarios[e];if(!s){f.log(S.LogTraceArea.Calling,"Starting incoming call scenario telemetry for scenarioId: "+e+" source: "+a.source+" causeId: "+i);const t={CallId:a.callId,NodeId:A.default.CallingNodeId.get()||"",RegistrationId:A.default.EdfRegistrationId.get()||""};a.participantId&&(t.ParticipantId=a.participantId),s=new E.default(P.ScenarioName.IncomingCall,e,t),this._incomingCallScenarios[e]=s;let o=a.pushReceivedTime||a.pushProcessedTime;if(o<=0){const e="Received invalid incoming call scenario start time";f.error(S.LogTraceArea.Calling,e),o=Date.now()}s.start(n,o)}this.markIncomingCallStep(e,u.IncomingCallStep.NotificationReceived,i,n,a.pushProcessedTime-a.pushReceivedTime)}))}markIncomingCallStep(e,t,i,a,n){this._waitForIds().then((()=>{this._incomingCallScenarios[e]&&(f.log(S.LogTraceArea.Calling,"Marking incoming call scenario step for scenarioId: "+e+" step: "+u.IncomingCallStep[t]+" causeId: "+i),this._incomingCallScenarios[e].markStepCompleted(u.IncomingCallStep[t],a,n))}))}endTrackingIncomingCall(e,t,i){this._waitForIds().then((()=>{if(!this._incomingCallScenarios[e])return void f.warn(S.LogTraceArea.Calling,"Unable to end tracking unknown incoming call: "+e+" causeId: "+t);const a=this._incomingCallScenarios[e];f.log(S.LogTraceArea.Calling,"Completing incoming call scenario telemetry for scenarioId: "+e+" reason: "+(i?u.IncomingCallEndReason[i.reason]:"success")+" causeId: "+t),i?a.fail(u.IncomingCallEndReason[i.reason],i.details):a.finish(),delete this._incomingCallScenarios[e]}))}checkCrashedCalls(){R.EnsureStarted(_.default).then((()=>{const e=_.default.getData(g.InternalKeys.ActiveCalls);e&&e.length&&(f.log(S.LogTraceArea.Calling,`Reporting crashed calls: ${JSON.stringify(e)}`),this.updateActiveCalls(void 0),A.default.CallingNodeId.waitUntilSet().then((()=>{a.each(e,(e=>{f.track(new u.CallCrashEvent(e.callId,e.state,A.default.CallingNodeId.get(),e.participantId,e.endpointId))}))})))}))}updateActiveCalls(e){_.default.putData(g.InternalKeys.ActiveCalls,e)}_getCallAddPhotosEvent(e){return e?this._callAddPhotoTelemetryEvents[e]:void 0}initCallAddPhotosEvent(e,t,i,a=!1){if(this._getCallAddPhotosEvent(e))return;const n=p.isGroupConversation(t);this._callAddPhotoTelemetryEvents[e]=a?new u.CallAddPhotosWithFabEvent(e,n,i):new u.CallAddPhotosEvent(e,n,i)}markPhotosSentCallAddPhotosEvent(e,t){const i=this._getCallAddPhotosEvent(e);i?(i.setPhotosSent(t),i.setNumberOfPhotos(1)):f.warn(S.LogTraceArea.Calling,"CallTelemetryHelper.markPhotosSentCallAddPhotosEvent() no callAddPhotos Event")}markPhotosSelectedCallAddPhotosEvent(e,t){const i=this._getCallAddPhotosEvent(e);i&&i.setMediaPickerPhotosSelected(t)}markFromMediaPickerAndNumberOfPhotosCallAddPhotosEvent(e,t,i){const a=this._getCallAddPhotosEvent(e);a&&(a.setPhotosSent(!0),a.setFromMediaPicker(t),a.setNumberOfPhotos(i))}markPhotoTakenCallAddPhotosEvent(e,t){const i=this._getCallAddPhotosEvent(e);i&&i.setPhotoTaken(t)}completeCallAddPhotosEvent(e){const t=this._getCallAddPhotosEvent(e);t&&(f.track(t),delete this._callAddPhotoTelemetryEvents[e])}onStartRecording(e,t){this._callRecordingEvents[e]?f.warn(S.LogTraceArea.Calling,"CallTelemetryHelper._onStartRecording recording event already exists for callId: "+e+" causeId: "+t):(this.updateCallTelemetry(e,t,(e=>{e.startRecordingCount()})),f.log(S.LogTraceArea.Calling,"CallTelemetryHelper.onStartRecording callId: "+e+" causeId: "+t),this._callRecordingEvents[e]={recordingStartTime:Date.now(),callRecordingEvent:new u.CallRecordingEvent(e)})}onStopRecording(e,t){this._maybeCompleteCallRecordingEvent(e,t),this.updateCallTelemetry(e,t,(e=>{e.stopRecordingCount()}))}onStartPstnTranslationClicked(e,t){this.updateCallTelemetry(e,t,(e=>{e.startPstnTranslationClickedCount()}))}onStartCaptions(e,t,i,a,n,o,s){this._callCaptioningEvents[e]?f.warn(S.LogTraceArea.Calling,"CallTelemetryHelper.onStartCaptions captioning event already exists for callId: "+e+" causeId: "+s):(this.updateCallTelemetry(e,s,(e=>{e.startCaptioningCount()})),f.log(S.LogTraceArea.Calling,"CallTelemetryHelper.onStartCaptions callId: "+e+" causeId: "+s),this._callCaptioningEvents[e]={captioningStartTime:Date.now(),callCaptioningEvent:new u.CallCaptioningEvent(e,t,i,a,n,o)})}onStopCaptions(e,t){this._maybeCompleteCallCaptioningEvent(e,t),this.updateCallTelemetry(e,t,(e=>{e.stopCaptioningCount()}))}onRecieveCaptions(e,t){if(this.updateCallTelemetry(e,t,(e=>{e.didReceiveCaptions()})),this._callCaptioningEvents[e]&&!this._callCaptioningEvents[e].firstCaptionReceivedTime){const i=this._callCaptioningEvents[e].captioningStartTime,a=Date.now()-i;this._callCaptioningEvents[e].firstCaptionReceivedTime=a,this.updateCallTelemetry(e,t,(e=>{e.setFirstCaptionReceivedLengthSeconds(a)}))}}onCaptionPositionModeChanged(e,t,i){if(this._callCaptioningEvents[e]){this._callCaptioningEvents[e].callCaptioningEvent.setPositionMode(t)}}onFailedCaptionsConfig(e,t){this.updateCallTelemetry(e,t,(e=>{e.failedCaptioningConfigCount()}))}onPstnTranslationLanguageChange(e,t,i,a,n,o){const s=new u.CallPstnTranslationLanguageChangeEvent(e,null!=t?t:"",a,n,i);f.track(s)}onSetReceiverSetup(e,t){this.updateCallTelemetry(e,t,(e=>{e.receiverSetupCount()}))}onStartTogetherMode(e,t){this._callTogetherModeEvents[e]?f.warn(S.LogTraceArea.Calling,"CallTelemetryHelper._onStartTogetherMode recording event already exists for callId: "+e+" causeId: "+t):(this.updateCallTelemetry(e,t,(e=>{e.startTogetherMode()})),f.log(S.LogTraceArea.Calling,"CallTelemetryHelper.onStartTogetherMode callId: "+e+" causeId: "+t),this._callTogetherModeEvents[e]={botAddedStartTime:Date.now(),callFullScreenBotEvent:new u.CallFullScreenBotEvent(e,y.BotType[y.BotType.Audience])})}onStopTogetherMode(e,t){if(!this._callTogetherModeEvents[e])return;f.log(S.LogTraceArea.Calling,"CallTelemetryHelper.onStopTogetherMode callId: "+e+" causeId: "+t);const i=this._callTogetherModeEvents[e].callFullScreenBotEvent;i.setBotOnCallLengthSeconds((Date.now()-this._callTogetherModeEvents[e].botAddedStartTime)/1e3);const a=i.getBotOnCallUselessTime();0!==a&&i.addBotOnCallUselessLengthSeconds((Date.now()-a)/1e3),f.track(this._callTogetherModeEvents[e].callFullScreenBotEvent),delete this._callTogetherModeEvents[e]}onTogetherModeFailed(e,t,i){f.track(new u.CallFullScreenBotError(a.isNumber(t)?t:0,t.callId,y.BotType[y.BotType.Audience]))}onGridViewFailed(e,t,i){this._waitForIds().then((()=>{f.track(new u.CallFullScreenBotError(a.isNumber(t)?t:0,t.callId,y.BotType[y.BotType.GridView]))}))}onStartGridView(e,t){this._callLargeGridEvents[e]?f.warn(S.LogTraceArea.Calling,"CallTelemetryHelper._onStartTogetherMode recording event already exists for callId: "+e+" causeId: "+t):(this.updateCallTelemetry(e,t,(e=>{e.startLargeGrid()})),f.log(S.LogTraceArea.Calling,"CallTelemetryHelper.onStartTogetherMode callId: "+e+" causeId: "+t),this._callLargeGridEvents[e]={botAddedStartTime:Date.now(),callFullScreenBotEvent:new u.CallFullScreenBotEvent(e,y.BotType[y.BotType.GridView])})}onStopGridView(e,t){if(!this._callLargeGridEvents[e])return;f.log(S.LogTraceArea.Calling,"CallTelemetryHelper.onStopTogetherMode callId: "+e+" causeId: "+t);const i=this._callLargeGridEvents[e].callFullScreenBotEvent;i.setBotOnCallLengthSeconds((Date.now()-this._callLargeGridEvents[e].botAddedStartTime)/1e3);const a=i.getBotOnCallUselessTime();0!==a&&i.addBotOnCallUselessLengthSeconds((Date.now()-a)/1e3),f.track(this._callLargeGridEvents[e].callFullScreenBotEvent),delete this._callLargeGridEvents[e]}onAddingBotToCall(e,t){f.track(new u.AddBotToCallEvent(e,y.BotType[t]))}onBotAddedToCall(e,t,i){f.track(new u.AddBotToCallSucceededEvent(e,y.BotType[t],i))}onBotFailed(e,t,i,n){f.track(new u.AddBotToCallFailedEvent(e,y.BotType[t],i,a.isNumber(n)?n:0))}_maybeCompleteCallRecordingEvent(e,t){if(!this._callRecordingEvents[e])return;f.log(S.LogTraceArea.Calling,"CallTelemetryHelper._maybeCompleteCallRecordingEvent callId: "+e+" causeId: "+t);this._callRecordingEvents[e].callRecordingEvent.recordingLengthSeconds((Date.now()-this._callRecordingEvents[e].recordingStartTime)/1e3),f.track(this._callRecordingEvents[e].callRecordingEvent),delete this._callRecordingEvents[e]}_maybeCompleteCallCaptioningEvent(e,t){if(!this._callCaptioningEvents[e])return;f.log(S.LogTraceArea.Calling,"CallTelemetryHelper._maybeCompleteCallCaptioningEvent callId: "+e+" causeId: "+t);const i=this._callCaptioningEvents[e].callCaptioningEvent;i.setCaptioningLengthSeconds((Date.now()-this._callCaptioningEvents[e].captioningStartTime)/1e3);const a=this._callCaptioningEvents[e].firstCaptionReceivedTime;a&&i.setFirstCaptionReceivedLengthSeconds(a/1e3),f.track(this._callCaptioningEvents[e].callCaptioningEvent),delete this._callCaptioningEvents[e]}screenShareControlReceivedControlRequest(e,t){this.updateCallTelemetry(e,t,(e=>e.screenShareControlReceivedControlRequest()))}togetherModeSceneChangeRequestCount(e,t){this.updateCallTelemetry(e,t,(e=>e.togetherModeSceneChangeRequestCount()))}screenShareControlReceivedControlRequestCanceled(e,t){this.updateCallTelemetry(e,t,(e=>e.screenShareControlReceivedControlRequestCanceled()))}screenShareControlSentControlRequest(e,t){this.updateCallTelemetry(e,t,(e=>e.screenShareControlSentControlRequest()))}screenShareControlRequestAccepted(e,t){this.updateCallTelemetry(e,t,(e=>e.screenShareControlRequestAccepted()))}screenShareControlRequestDenied(e,t){this.updateCallTelemetry(e,t,(e=>e.screenShareControlRequestDenied()))}screenShareControlGranted(e,t){this.updateCallTelemetry(e,t,(e=>e.screenShareControlGranted()))}screenShareControlSharerTerminatedControl(e,t){this.updateCallTelemetry(e,t,(e=>e.screenShareControlSharerTerminatedControl()))}screenShareControlViewerTerminatedControl(e,t){this.updateCallTelemetry(e,t,(e=>e.screenShareControlViewerTerminatedControl()))}onStopScreenSharing(e,t){f.track(new u.ScreenSharingStoppedEvent(e,t))}pinToolbar(e,t){this.updateCallTelemetry(e,t,(e=>e.pinToolbar()))}unPinToolbar(e,t){this.updateCallTelemetry(e,t,(e=>e.unPinToolbar()))}setGiveControlAsPossible(e,t){this.updateCallTelemetry(e,t,(e=>e.setGiveControlAsPossible()))}onStartNdi(e,t){this._ndiEvents[e]?f.warn(S.LogTraceArea.Calling,"CallTelemetryHelper.onStartNdi ndi event already exists for callId: "+e):(this.updateCallTelemetry(e,"ndi-started",(e=>{e.startNdiCount()})),f.log(S.LogTraceArea.Calling,"CallTelemetryHelper.onStartNdi callId: "+e),this._ndiEvents[e]={broadcastingStartTime:Date.now(),broadcastingEvent:new u.NdiBroadcastEvent(e,t)})}onStopNdi(e){this._maybeCompleteNdiEvent(e),this.updateCallTelemetry(e,"ndi-stopped",(e=>{e.stopNdiCount()}))}onZoomIn(e){this.updateCallTelemetry(e,"ZoomedInCount",(e=>{e.zoomedIn()}))}onZoomOut(e,t,i){this.updateCallTelemetry(e,"ZoomedOutCount",(e=>{e.zoomedOut(t,i)}))}onZoomDragUsed(e){this.updateCallTelemetry(e,"ZoomDragUsed",(e=>{e.zoomDragUsed()}))}onZoomChangeType(e,t){this.updateCallTelemetry(e,"ZoomChangeType",(e=>{e.zoomChangeType(t)}))}onAudioSystemReset(e,t){this.updateCallTelemetry(e,t,(e=>{e.audioSystemResetCount()}))}_maybeCompleteNdiEvent(e){if(!this._ndiEvents[e])return;f.log(S.LogTraceArea.Calling,"CallTelemetryHelper._onStopNdi callId: "+e);const t=this._ndiEvents[e].broadcastingEvent;t.setBroadcastingLengthSeconds((Date.now()-this._ndiEvents[e].broadcastingStartTime)/1e3),t.setWatermarkLocation(T.default.getWatermarkLocation()),f.track(t),delete this._ndiEvents[e]}updateNdiTelemetry(e,t){this._ndiEvents[e]&&t&&t(this._ndiEvents[e].broadcastingEvent)}updateCallRecordingTelemetry(e,t,i){this._callRecordingEvents[e]&&i&&i(this._callRecordingEvents[e].callRecordingEvent)}updateCallCaptioningTelemetry(e,t,i){this._callCaptioningEvents[e]&&i&&i(this._callCaptioningEvents[e].callCaptioningEvent)}updateCallTogetherModeTelemetry(e,t){this._callTogetherModeEvents[e]&&t&&t(this._callTogetherModeEvents[e].callFullScreenBotEvent)}updateCallGridViewTelemetry(e,t){this._callLargeGridEvents[e]&&t&&t(this._callLargeGridEvents[e].callFullScreenBotEvent)}updateTogetherModeAvailability(e,t){this.updateCallTelemetry(e,t,(e=>{e.ableToStartTogetherMode()}))}updateLargeGridAvailability(e,t){this.updateCallTelemetry(e,t,(e=>{e.ableToStartLargeGrid()}))}setHadNewCallStageEnabled(e,t){this.updateCallTelemetry(e,t,(e=>{e.setHadNewCallStageEnabled()}))}setHadOldCallStageEnabled(e,t){this.updateCallTelemetry(e,t,(e=>{e.setHadOldCallStageEnabled()}))}addCallingStoreUpdatePerformance(e,t,i){this.updateCallTelemetry(e,t,(e=>{e.addCallingStoreUpdatePerformance(i)}))}onShowShareTwinCamConnection(e){this.updateCallTelemetry(e,"ShowShareTwinCamConnectionCount",(e=>{e.showShareTwinCamConnection()}))}onUseTwinCamConnection(e){this.updateCallTelemetry(e,"TwinCamConnectionUsedCount",(e=>{e.useTwinCamConnection()}))}onFailedTwinCamConnection(e){this.updateCallTelemetry(e,"TwinCamConnectionFailedCount",(e=>{e.failedTwinCamConnection()}))}onStopTwinCam(e,t){this.updateCallTelemetry(e,"StopTwinCamCount",(e=>{e.stopTwinCam(t)}))}onAbleToStartTwinCam(e,t){this.updateCallTelemetry(e,"AbleToStartTwinCam",(e=>{e.setAbleToStartTwinCam(t)}))}rejoinCallTelemetry(e,t,i){f.log(S.LogTraceArea.Calling,"CallingTelemetryHelper_rejoinCallTelemetry callId: "+e+" causeId: "+t),f.track(new u.CallEntryPoint(e,i,!0))}beginTrackingAnswerCall(e,t,i){return this._waitForIds().then((()=>{let a=this._answerCallScenarioIds[e];if(!a){a=D.default.newGuid(),f.log(S.LogTraceArea.Calling,"Starting answer call scenario telemetry for scenarioId: "+a+" causeId: "+i);const n={CallId:e,NodeId:A.default.CallingNodeId.get()||"",RegistrationId:A.default.EdfRegistrationId.get()||""};if(t){n.IsGroupCall=!p.isOneOnOneConversation(t);let e=x.None;const i=M.default.getScheduledCallByConversationId(t);i&&M.default.isScheduledCallNow(i.id)&&(e=x.ScheduleACall),n.TriggeredBy=e}let o=new E.default(P.ScenarioName.AnswerCall,a,n);this._answerCallScenarios[a]=o,this._answerCallScenarioIds[e]=a,o.setDuplicateStepMarkingEnabled(!0),o.start()}return a}))}markAnswerCallStep(e,t,i,a,n,o){this._waitForIds().then((()=>r.Resolved(this._answerCallScenarioIds[e]))).then((o=>o||(t===u.AnswerCallStep.NotifyingCallee?(V.default.notifyingCallee(n),this.beginTrackingAnswerCall(e,i,a)):r.Rejected("Unable to mark step for unknown answer call: "+e+" causeId: "+a)))).then((e=>{f.log(S.LogTraceArea.Calling,"Marking answer call scenario step for scenarioId: "+e+" step: "+u.AnswerCallStep[t]+" causeId: "+a),this._answerCallScenarios[e].markStepCompleted(u.AnswerCallStep[t],n,o)})).catch((e=>f.warn(S.LogTraceArea.Calling,L.default.errorAsString(e))))}endTrackingAnswerCall(e,t,i){this._waitForIds().then((()=>{let a=this._answerCallScenarioIds[e];if(!a)return void f.warn(S.LogTraceArea.Calling,"Unable to end tracking unknown answer call: "+a+" causeId: "+t);const n=this._answerCallScenarios[a];f.log(S.LogTraceArea.Calling,"Completing answer call scenario telemetry for scenarioId: "+a+" reason: "+(i?u.AnswerCallEndReason[i.reason]:"success")+" causeId: "+t),i?n.fail(u.AnswerCallEndReason[i.reason],i.details):n.finish(),delete this._answerCallScenarios[a],delete this._answerCallScenarioIds[e]}))}test_getAnswerCallScenarios(){return this._answerCallScenarios}test_resetAnswerCallScenarios(){this._answerCallScenarios={},this._answerCallScenarioIds={}}}t.default=new N},71727:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallUIUtils=t.ReactionButtonType=t.UnsupportedFeature=t.MaxVideoWidthOnMobile=t.ServerMutedToastTimeout=t.DummyVideoSize=void 0;const a=i(96486),n=i(16778),o=i(48540),s=i(89391),r=i(94224),l=i(47447),c=i(68580),d=i(98925),u=i(80200),h=i(3493),p=i(39549),g=i(85329),C=i(52262),m=i(46096),S=i(5581),y=i(36237),f=i(33754),_=i(57538),b=i(44972),T=i(18078),v=i(30124),w=i(27357),I=i(98053),P=i(99189),M=i(54306),k=i(33004),A=i(29130),R=i(14976),V=i(86045),L=i(24932),E=i(26978),B=i(81760),O=i(11828),D=i(60305),x=i(18037),N=i(66123),U=i(53374),F=i(78735),H=i(71830),z=i(36850),G=i(76514),W=i(56018);t.DummyVideoSize={height:0,width:0};const K=1e4;var j,Q;t.ServerMutedToastTimeout=5e3,t.MaxVideoWidthOnMobile=1.3*u.RibbonSizes.ribbonItemSizeSmall,function(e){e[e.CallReactions=0]="CallReactions"}(j=t.UnsupportedFeature||(t.UnsupportedFeature={})),function(e){e[e.Celebration=0]="Celebration",e[e.Heart=1]="Heart"}(Q=t.ReactionButtonType||(t.ReactionButtonType={}));const $={[u.StageMode.Speaker]:"CallPanel.CallHeaderSpeakerViewLabel",[u.StageMode.Grid]:"CallPanel.CallHeaderGridViewLabel",[u.StageMode.Presentation]:"CallPanel.CallHeaderPresentationViewLabel",[u.StageMode.FocusedScreenShare]:"CallPanel.CallHeaderContentViewLabel",[u.StageMode.TogetherMode]:"CallPanel.CallHeaderTogetherModeViewLabel",[u.StageMode.LargeGrid]:"CallPanel.CallHeaderLargeGridViewLabel"},q={[u.StageMode.Speaker]:"CallPanel.CallHeaderSpeakerViewLabel",[u.StageMode.Grid]:"CallPanel.CallHeaderGridViewLabel",[u.StageMode.Presentation]:"CallPanel.CallHeaderPresentationViewLabel",[u.StageMode.FocusedScreenShare]:"CallPanel.CallHeaderContentViewLabel",[u.StageMode.TogetherMode]:"CallPanel.CallHeaderTogetherModeViewLabel",[u.StageMode.LargeGrid]:"CallPanel.CallHeaderLargeGalleryViewLabel"},X={[u.StageMode.Speaker]:O.SkypeIcon.StartIncomingVideo,[u.StageMode.Grid]:O.SkypeIcon.Gallery,[u.StageMode.FocusedScreenShare]:O.SkypeIcon.Presenter,[u.StageMode.LargeGrid]:O.SkypeIcon.GalleryLarge,[u.StageMode.TogetherMode]:O.SkypeIcon.Audience},Z={[u.StageMode.Speaker]:O.SkypeIcon.StartIncomingVideo,[u.StageMode.Grid]:O.SkypeIcon.GridView,[u.StageMode.FocusedScreenShare]:O.SkypeIcon.ContentView,[u.StageMode.Presentation]:O.SkypeIcon.Presenter,[u.StageMode.LargeGrid]:O.SkypeIcon.GalleryLarge,[u.StageMode.TogetherMode]:O.SkypeIcon.Audience};class J{static _filterPerEndpointDuplicitStreams(e){const t=new Map;return e.filter((e=>e.isAvailable)).forEach((e=>{const i=t.get(e.endpointId);(!i||e.rank>i.rank)&&t.set(e.endpointId,e)})),Array.from(t.values())}static elementInfoForParticipantOrScreenshare(e,t,i,a,n,s,l,h){const p=a.state,g=this.isFullScreenBot(t)?[d.VideoOverrideReason.FullScreenBot]:void 0,C=l?o.StreamType.ScreenSharing:o.StreamType.Video,S=this._streamStatus(t,C,i,h?h(t):void 0,void 0,g),f=this._streamDimensions(t,C,i),_=!!l&&(S===u.VideoStatus.Streaming||S===u.VideoStatus.Available);let b=!1;if(_){const e=r.default.ScreenSharingControlStoreRegistrar.getStoreFromCallId(i);if(e){const t=e.viewerInControl();t&&T.default.isMyMri(t.mri)&&(b=!0)}else y.warn(m.LogTraceArea.CallingUI,"Screen sharing control store is undefined")}const v=c.default.isParticipantRinging(a),w=s&&c.default.isParticipantOnHold(a),I=c.default.isParticipantMuted(a),P=!!l,M=r.default.CallingStore.getRaisedHandRankForMri(i,t),k=c.default.isParticipantTalking(a),A=t===r.default.CallScreenShareStore.getPresenter(i)&&!l,R=r.default.CallingStore.isHandRaisedForMri(t,i),V=this.isTogetherModeBot(t),L=this.isLargeGridBot(t),E=a.state;let B=0;const O=this._filterPerEndpointDuplicitStreams(a.streams[C]).map((e=>{const a=this._streamStatus(t,C,i,h?h(t,e.endpointId):void 0,e),n=this._streamDimensions(t,C,i,e.endpointId);return a!==u.VideoStatus.None&&B++,{endpointId:e.endpointId,videoStatus:a,videoDimensions:n}}));let D=u.CallParticipantStreamsStatus.None;return 0!==B&&(D=B>1?u.CallParticipantStreamsStatus.Multiple:u.CallParticipantStreamsStatus.Single),n&&p===n.participantState&&S===n.videoStatus&&f===n.videoDimensions&&_===n.isScreensharing&&b===n.isScreenshareControlling&&v===n.isRinging&&w===n.isOnHold&&I===n.isServerMuted&&P===n.renderScreenShare&&M===n.raisedHandRank&&k===n.isTalking&&O===n.streams&&D===n.streamsStatus&&A===n.isPresenter&&R===n.isHandRaised&&E===n.state?n:{key:e,mri:t,participantState:p,videoStatus:S,videoDimensions:f,isScreensharing:_,isScreenshareControlling:b,isRinging:v,isOnHold:w,isServerMuted:I,renderScreenShare:P,ribbonAddTime:n?n.ribbonAddTime:this.nextRibbonAddTime(),connectionSortKey:v?1:0,raisedHandRank:M,isTalking:k,isHandRaised:R,isPresenter:A,state:E,streamsStatus:D,streams:O,isLargeGridBot:L,isTogetherModeBot:V}}static getLocalMediaStreams(e,t,i){const a=T.default.getSkypeMri(),n=r.default.CallingStore.getParticipantId(e),o=[{videoStatus:r.default.CallingStore.isProvidingVideo(e)?u.VideoStatus.Streaming:u.VideoStatus.None,videoDimensions:r.default.CallingStore.getLocalVideoStreamSize(e),endpointId:u.CallStageElementKeys.localUserKey}],s=r.default.CallingStore.getCallMediaStreams(e);return s&&s[t]&&s[t].filter((e=>e.participantId!==n)).map((n=>{const s=this._streamStatus(a,t,e,i?i(u.CallStageElementKeys.localUserKey,n.endpointId):void 0,n),r=this._streamDimensions(a,t,e,n.endpointId);o.push({endpointId:n.endpointId,videoStatus:s,videoDimensions:r})})),o}static isLargeGridBot(e){const t=S.default.getCallGridViewBotMriFilter();return a.includes(t,e)}static isTogetherModeBot(e){const t=S.default.getCallAudienceBotMriFilter();return a.includes(t,e)}static isFullScreenBot(e){return this.isTogetherModeBot(e)||this.isLargeGridBot(e)}static isLocalOrServerMuted(e){return r.default.CallingFeaturesHelper.isLocalOrServerMuted(e)}static nextRibbonAddTime(e=!0){return e?this._ribbonAddTimeValue--:Date.now()}static shouldRenderParticipant(e,t,i,n){return(c.default.isParticipantConnected(t)||c.default.isParticipantRinging(t))&&!a.includes(n,i)}static getMouseCornerPosition(e,t,i){if(i){const a=.15*i.width;if(e-i.x<a&&t-i.y<a)return u.CallingViewCornerPostion.UpperLeft;if(e-i.x<a&&t-i.y>i.height-a)return u.CallingViewCornerPostion.BottomLeft;if(e-i.x>i.width-a&&t-i.y<a)return u.CallingViewCornerPostion.UpperRight;if(e-i.x>i.width-a&&t-i.y>i.height-a)return u.CallingViewCornerPostion.BottomRight}return u.CallingViewCornerPostion.NotAtCorner}static shouldStartSimulateViewResizing(e,t,i,a,n){return e&&t&&i&&a&&n}static shouldReRenderVisibleRibbonItems(e,t,i){const n=Math.min(e.length,t.length),o=i?e.filter((e=>-1===i.indexOf(e)&&-1===i.indexOf("ss_"+e))):e;let s=!1;return a.each(o.slice(0,n),(e=>{-1===t.indexOf(e)&&(s=!0)})),s}static shouldRenderParticipantState(e){return c.default.isParticipantStateConnected(e)||c.default.isParticipantStateRinging(e)}static shouldRenderConnectedParticipantInEventStream(e,t,i){return c.default.isParticipantConnected(e)&&!a.includes(i,t)}static shouldRenderRingingParticipantInEventStream(e,t,i){return c.default.isParticipantRinging(e)&&!a.includes(i,t)}static ribbonLayoutRect(e,t,i,a,n,o){let s=a.height,r=a.width;const l=e&&e!==u.LayoutInfoVideoType.None?J.tryToGetCorrectAspectRatioViaVideoType(e,t,o):1;return n?s=a.height/l:r=a.width*l,{x:i,y:0,width:r,height:s}}static tryToGetCorrectAspectRatioViaVideoType(e,t,i){return a.isUndefined(t)||e===u.LayoutInfoVideoType.None?1:t}static getSwapableRibbionItemKeys(e){return a.map(e.filter((e=>!a.isUndefined(e.ribbonPosition)&&e.ribbonPosition>=0&&!e.displayOnStage&&!e.isLocal&&!e.isHostOfScreenshare&&!e.isScreenshare)),(e=>e.key))}static getSwapableRibbionItemIndex(e){const t=e.filter((e=>!a.isUndefined(e.ribbonPosition)&&!e.displayOnStage&&e.ribbonPosition>=0&&!e.isLocal&&!e.isHostOfScreenshare&&!e.isScreenshare));return a.map(t,(t=>a.findIndex(e,(e=>e.key===t.key))))}static getVisibleSwapableRibbonItemKeys(e,t){return a.map(e.filter((e=>!a.isUndefined(e.ribbonPosition)&&!e.displayOnStage&&e.ribbonPosition>=0&&-1===t.indexOf(e.key)&&!e.isLocal&&!e.isHostOfScreenshare&&!e.isScreenshare)),(e=>e.key))}static reorderLayoutInfoViaLeastVisibleItemSwaping(e,t){const i=Math.min(t.length,e.length),n=J.getSwapableRibbionItemKeys(e).slice(0,i),o=J.getSwapableRibbionItemIndex(e).slice(0,i),s=a.filter(n,(e=>-1===t.indexOf(e)));let r=[],l=0;a.each(t,(t=>{let i;i=-1!==n.indexOf(t)?t:s[l++];const o=a.find(e,(e=>e.key===i));a.isUndefined(o)||r.push(a.clone(o))})),r.forEach(((t,i)=>{if(i<o.length){const a=o[i];if(a<e.length){const i=e[a].ribbonPosition,n=e[a].participantRank;e[a]=t,e[a].ribbonPosition=i,e[a].participantRank=n}}}))}static stageLayoutRect(e,t){const i=e.height*((null==t?void 0:t.height)||1),a=e.width*((null==t?void 0:t.width)||1);return J.translateRect({x:0,y:0,height:i,width:a},e.width)}static translateRect(e,t){if(!e)return;return{x:t-e.x-e.width,y:e.y,width:e.width,height:e.height}}static translatePoint(e,t){if(!e)return;return{x:t-e.x,y:e.y}}static nametagOffset(e,t){return{offset:0+u.AudioNotificationOffset}}static accessoryPosition(e,t,i){if(i)switch(t){case 1:return;case 2:return u.CallAccessoryPosition.Center;case 3:return 0===e?u.CallAccessoryPosition.Center:1===e?u.CallAccessoryPosition.BottomRight:u.CallAccessoryPosition.TopRight}switch(t){case 1:return;case 2:case 3:return 0===e?u.CallAccessoryPosition.BottomRight:u.CallAccessoryPosition.TopRight;case 4:if(0===e||1===e)return u.CallAccessoryPosition.BottomRight;if(2===e||3===e)return u.CallAccessoryPosition.TopRight}}static compareElementInfo(e,t,i){if(e.connectionSortKey!==t.connectionSortKey)return this._compareValue(e.connectionSortKey,t.connectionSortKey);if(e.renderScreenShare!==t.renderScreenShare)return this._compareBoolean(!!t.renderScreenShare,!!e.renderScreenShare);if(e.isScreensharing!==t.isScreensharing)return this._compareBoolean(!!t.isScreensharing,!!e.isScreensharing);if(i&&!e.isTalking&&!t.isTalking&&e.raisedHandRank!==t.raisedHandRank)return this._compareValue(e.raisedHandRank||Number.MAX_VALUE,t.raisedHandRank||Number.MAX_VALUE);if(e.activeSpeakerRank!==t.activeSpeakerRank)return this._compareValue(e.activeSpeakerRank||-1,t.activeSpeakerRank||-1);const a=e.videoStatus===u.VideoStatus.Streaming,n=t.videoStatus===u.VideoStatus.Streaming;return a!==n?this._compareBoolean(n,a):this._compareValue(e.ribbonAddTime,t.ribbonAddTime)}static getOrderedByVideoPresenceParticipants(e,t){const i=r.default.CallParticipantStore.getParticipantRenderInfosForCall(t),n=a.compact(a.map(e,(e=>i.get(e)))).sort(((e,t)=>this._compareRenderInfoBasedOnVideo(e,t)));return a.map(n,(e=>e.renderKey))}static getOrderedDisplayedTrayParticipants(e,t,i,n=!1,o=!1){const s=r.default.CallParticipantStore.getParticipantRenderInfosForCall(i),l=a.compact(a.map(e,(e=>s.get(e)))),c=o?G.default.getPinnedParticipants(i):void 0,d=l.sort(((e,t)=>this._compareTrayRenderInfo(e,t,n,c))),u=this._getNumberOfShownParticipants(t,d),h=a.take(d,u),p=a.takeRight(d,d.length-u),g=a.find(p,(e=>0===e.activeSpeakerRank));return g&&a.fill(h,g,h.length-1),a.map(h,(e=>e.renderKey))}static _compareTrayRenderInfo(e,t,i,n){if(e.isLocal!==t.isLocal)return this._compareBoolean(t.isLocal,e.isLocal);if(i&&e.isPresenter!==t.isPresenter)return this._compareBoolean(!!t.isPresenter,!!e.isPresenter);if(n){const i=a.includes(n,e.renderKey),o=a.includes(n,t.renderKey);if(i!==o)return this._compareBoolean(o,i)}const o=e.videoStatus===u.VideoStatus.Streaming||e.videoStatus===u.VideoStatus.Available,s=t.videoStatus===u.VideoStatus.Streaming||t.videoStatus===u.VideoStatus.Available;if(o!==s)return this._compareBoolean(s,o);const r=0===e.activeSpeakerRank,l=0===t.activeSpeakerRank;if(r!==l)return this._compareBoolean(l,r);if(!e.isTalking&&!t.isTalking&&e.raisedHandRank!==t.raisedHandRank){const i=a.isUndefined(e.raisedHandRank)?Number.MAX_VALUE:e.raisedHandRank,n=a.isUndefined(t.raisedHandRank)?Number.MAX_VALUE:t.raisedHandRank;return this._compareValue(i,n)}return e.activeSpeakerRank!==t.activeSpeakerRank?this._compareValue(e.activeSpeakerRank||-1,t.activeSpeakerRank||-1):0}static _compareRenderInfoBasedOnVideo(e,t){if(e.isLocal!==t.isLocal)return this._compareBoolean(t.isLocal,e.isLocal);const i=e.videoStatus===u.VideoStatus.Streaming||e.videoStatus===u.VideoStatus.Available,n=t.videoStatus===u.VideoStatus.Streaming||t.videoStatus===u.VideoStatus.Available;if(i!==n)return this._compareBoolean(n,i);if(s.default.getS4LCMCFeaturesNoSubscription().twinCamEnabled){const i=!!e.streams&&a.filter(e.streams,(e=>a.includes([u.VideoStatus.Streaming,u.VideoStatus.Available],e.videoStatus))).length>1,n=!!t.streams&&a.filter(t.streams,(e=>a.includes([u.VideoStatus.Streaming,u.VideoStatus.Available],e.videoStatus))).length>1;if(i&&!n)return-1;if(!i&&n)return 1}return 0}static _getNumberOfShownParticipants(e,t){let i=t.length;if(a.sumBy(t,(e=>this._getParticipantWidth(e)))>e){let n=e-u.BigTrayOverflowButtonWidth;a.each(t,((e,t)=>n>this._getParticipantWidth(e)?(n-=this._getParticipantWidth(e),!0):(i=t,!1)))}return i}static _getParticipantWidth(e){return e?e.videoStatus===u.VideoStatus.None?u.BigTrayCallParticipantWidth.audio:u.BigTrayCallParticipantWidth.video:0}static getErrorToastType(e){switch(e){case d.CallDeviceQualityEventType.AudioStoppedWorking:return u.DeviceStatusToastType.AudioStoppedWorking;case d.CallDeviceQualityEventType.MicrophoneStoppedWorking:return u.DeviceStatusToastType.MicrophoneStoppedWorking;case d.CallDeviceQualityEventType.SpeakerStoppedWorking:return u.DeviceStatusToastType.SpeakerStoppedWorking;case d.CallDeviceQualityEventType.AudioDeviceBusy:return u.DeviceStatusToastType.AudioDeviceBusy;case d.CallDeviceQualityEventType.VideoStoppedWorking:return u.DeviceStatusToastType.VideoStoppedWorking;case d.CallDeviceQualityEventType.VideoTimedOut:return u.DeviceStatusToastType.VideoTimedOut;case d.CallDeviceQualityEventType.VideoCameraBusy:return u.DeviceStatusToastType.VideoSystemBusy;case d.CallDeviceQualityEventType.VideoSystemOutOfMemory:return u.DeviceStatusToastType.VideoSystemOutOfMemory;case d.CallDeviceQualityEventType.DeviceCausingEcho:return u.DeviceStatusToastType.DeviceCausingEcho;case d.CallDeviceQualityEventType.MicrophoneNotMuteButSilent:return u.DeviceStatusToastType.MicrophoneNotMuteButSilent;case d.CallDeviceQualityEventType.DeviceRenderGlitches:return u.DeviceStatusToastType.DeviceRenderGlitches;case d.CallDeviceQualityEventType.DeviceLowSNR:return u.DeviceStatusToastType.DeviceLowSNR;case d.CallDeviceQualityEventType.DeviceClipping:return u.DeviceStatusToastType.DeviceClipping;case d.CallDeviceQualityEventType.DeviceEcho:return u.DeviceStatusToastType.DeviceEcho;case d.CallDeviceQualityEventType.DeviceMultipleEndpoints:return u.DeviceStatusToastType.DeviceMultipleEndpoints;case d.CallDeviceQualityEventType.DeviceRenderZeroVolume:return u.DeviceStatusToastType.DeviceRenderZeroVolume;case d.CallDeviceQualityEventType.CpuInsufficient:return u.DeviceStatusToastType.CpuInsufficient;case d.CallDeviceQualityEventType.ZeroCaptureDevicesEnumerated:return u.DeviceStatusToastType.ZeroCaptureDevicesEnumerated;case d.CallDeviceQualityEventType.ZeroRenderDevicesEnumerated:return u.DeviceStatusToastType.ZeroRenderDevicesEnumerated;case d.CallDeviceQualityEventType.VideoCaptureDeviceFreeze:return u.DeviceStatusToastType.VideoCaptureDeviceFreeze;case d.CallDeviceQualityEventType.AudioCapturePermissionDenied:return u.DeviceStatusToastType.AudioCapturePermissionDenied;case d.CallDeviceQualityEventType.VideoCapturePermissionDenied:return u.DeviceStatusToastType.VideoCapturePermissionDenied;case d.CallDeviceQualityEventType.VideoCaptureFreezeRecovered:return u.DeviceStatusToastType.VideoCaptureFreezeRecovered;case d.CallDeviceQualityEventType.DeviceRenderHowling:return u.DeviceStatusToastType.DeviceRenderHowling;case d.CallDeviceQualityEventType.PresentationAudioLoopbackDeviceState:return u.DeviceStatusToastType.PresentationAudioLoopbackDeviceState;case d.CallDeviceQualityEventType.RemoteNetworkConnectivityIssue:return u.DeviceStatusToastType.RemoteNetworkConnectivityIssue;case d.CallDeviceQualityEventType.AudioCaptureUltrasoundDetected:return u.DeviceStatusToastType.AudioCaptureUltrasoundDetected;case d.CallDeviceQualityEventType.MusicModeNotAvailable:return u.DeviceStatusToastType.MusicModeNotAvailable;case d.CallDeviceQualityEventType.CameraLighting:return u.DeviceStatusToastType.CameraLighting;case d.CallDeviceQualityEventType.ImageRenderingQuality:return u.DeviceStatusToastType.ImageRenderingQuality;case d.CallDeviceQualityEventType.AudioCaptureMusicDetectedWithHighNS:return u.DeviceStatusToastType.AudioCaptureMusicDetectedWithHighNS;case d.CallDeviceQualityEventType.AudioCaptureMusicDetectedWithLowNS:return u.DeviceStatusToastType.AudioCaptureMusicDetectedWithLowNS;case d.CallDeviceQualityEventType.AudioCaptureMusicDetectedWithHighNSNotAvailable:return u.DeviceStatusToastType.AudioCaptureMusicDetectedWithHighNSNotAvailable;default:return}}static getToastInformation(e,i,a,n){let o,s,r=!1,l=O.SkypeIcon.Warning;switch(e){case u.DeviceStatusToastType.AudioStoppedWorking:o="CallPanel.AudioDeviceFailed",r=!0;break;case u.DeviceStatusToastType.MicrophoneStoppedWorking:o="CallPanel.MicrophoneFailed",r=!0;break;case u.DeviceStatusToastType.SpeakerStoppedWorking:o="CallPanel.SpeakerFailed",r=!0;break;case u.DeviceStatusToastType.AudioDeviceBusy:o="CallPanel.AudioDeviceBusy",r=!0;break;case u.DeviceStatusToastType.MicrophoneDisconnected:o="CallPanel.NoMicrophone";break;case u.DeviceStatusToastType.SpeakerDisconnected:o="CallPanel.NoSpeaker";break;case u.DeviceStatusToastType.SoundSharingStopped:o="CallPanel.SoundSharingStopped";break;case u.DeviceStatusToastType.VideoStoppedWorking:case u.DeviceStatusToastType.VideoTimedOut:o="CallPanel.CameraFailed",r=!0;break;case u.DeviceStatusToastType.VideoSystemBusy:o="CallPanel.CameraBusy",r=!0;break;case u.DeviceStatusToastType.VideoSystemOutOfMemory:o="CallPanel.CameraStoppedWorkingOutOfMemory";break;case u.DeviceStatusToastType.CameraChanged:o="CallPanel.CameraChanged",r=!0,s=K;break;case u.DeviceStatusToastType.MicrophoneChanged:o="CallPanel.MicrophoneChanged",r=!0,s=K;break;case u.DeviceStatusToastType.SpeakerChanged:o="CallPanel.SpeakerChanged",r=!0,s=K;break;case u.DeviceStatusToastType.CompositeAudioAvailable:a?(o="CallPanel.NewAudio",s=K):(o="CallPanel.CompositeAudioChanged",r=!0,s=K);break;case u.DeviceStatusToastType.DeviceCausingEcho:o="CallPanel.DeviceCausingEcho",s=K;break;case u.DeviceStatusToastType.MicrophoneNotMuteButSilent:o="CallPanel.MicrophoneNotMuteButSilent",r=!0,s=K;break;case u.DeviceStatusToastType.MicrophoneServerMuted:o="CallPanel.MicrophoneServerMuted",s=t.ServerMutedToastTimeout,l=O.SkypeIcon.MicrophoneOff;break;case u.DeviceStatusToastType.OutgoingVideoDisabledDuringScreenSharing:o="CallPanel.OutgoingVideoDisabledScreenSharing";break;case u.DeviceStatusToastType.DeviceRenderGlitches:o="CallPanel.DeviceRenderGlitches",r=!0;break;case u.DeviceStatusToastType.DeviceLowSNR:o="CallPanel.DeviceLowSNR";break;case u.DeviceStatusToastType.DeviceClipping:o="CallPanel.DeviceClipping";break;case u.DeviceStatusToastType.DeviceEcho:o="CallPanel.DeviceEcho",l=O.SkypeIcon.MicrophoneOff;break;case u.DeviceStatusToastType.DeviceMultipleEndpoints:o="CallPanel.DeviceMultipleEndpoints",l=O.SkypeIcon.MicrophoneOff;break;case u.DeviceStatusToastType.DeviceRenderZeroVolume:o="CallPanel.DeviceRenderZeroVolume";break;case u.DeviceStatusToastType.CpuInsufficient:o="CallPanel.CpuInsufficient";break;case u.DeviceStatusToastType.ZeroCaptureDevicesEnumerated:o="CallPanel.ZeroCaptureDevicesEnumerated";break;case u.DeviceStatusToastType.ZeroRenderDevicesEnumerated:o="CallPanel.ZeroRenderDevicesEnumerated";break;case u.DeviceStatusToastType.VideoCaptureDeviceFreeze:o="CallPanel.VideoCaptureDeviceFreeze",r=!0,s=K;break;case u.DeviceStatusToastType.AudioCapturePermissionDenied:o="CallPanel.AudioCapturePermissionDenied",r=!0;break;case u.DeviceStatusToastType.VideoCapturePermissionDenied:o="CallPanel.VideoCapturePermissionDenied",r=!0;break;case u.DeviceStatusToastType.VideoCaptureFreezeRecovered:o="CallPanel.VideoCaptureFreezeRecovered",r=!0,s=K;break;case u.DeviceStatusToastType.DeviceRenderHowling:o="CallPanel.DeviceRenderHowling",r=!0;break;case u.DeviceStatusToastType.PresentationAudioLoopbackDeviceState:o="CallPanel.PresentationAudioLoopbackDeviceState";break;case u.DeviceStatusToastType.RemoteNetworkConnectivityIssue:o="CallPanel.RemoteNetworkConnectivityIssue";break;case u.DeviceStatusToastType.AudioCaptureUltrasoundDetected:o="CallPanel.AudioCaptureUltrasoundDetected",l=O.SkypeIcon.MicrophoneOff;break;case u.DeviceStatusToastType.MusicModeNotAvailable:o="CallPanel.MusicModeNotAvailable";break;case u.DeviceStatusToastType.CameraLighting:o="CallPanel.CameraLighting";break;case u.DeviceStatusToastType.ImageRenderingQuality:o="CallPanel.ImageRenderingQuality";break;case u.DeviceStatusToastType.VideoEffectsQualityChange:o="CallPanel.OnVideoEffectsQuality";break;case u.DeviceStatusToastType.AudioCaptureMusicDetectedWithHighNS:o="CallPanel.MusicDetectedWithHighNS";break;case u.DeviceStatusToastType.AudioCaptureMusicDetectedWithHighNSNotAvailable:r=!0,o="CallPanel.MusicDetectedWithHighNSNotAvailable";break;case u.DeviceStatusToastType.AudioCaptureMusicDetectedWithLowNS:o="CallPanel.MusicDetectedWithLowNS";break;case u.DeviceStatusToastType.None:default:return void y.warn(m.LogTraceArea.CallingUI,"Showing toast without specified error type this shouldnt happen")}return{notificationText:f.getString(o,i),showAvSettingsLink:r,timeout:s,icon:l,buttons:a,action:n}}static enableLayoutAnimation(){return!1}static useLightTheme(){const e=F.default.getLightThemeCallStageEnabled();return s.default.getS4LCMCFeatures().enableLightThemeOnCallStage&&(e||a.isUndefined(e))&&!x.default.useDarkTheme()}static useHighContrastTheme(){return s.default.getS4LCMCFeaturesNoSubscription().enableHighContrastTheme&&x.default.useAccessibleThemeNoSubscription()}static useHighContrastThemeAndChanges(){return s.default.getS4LCMCFeatures().enableHighContrastTheme&&x.default.useAccessibleTheme()}static disableCaptureAndChanges(e){return r.default.CallingStore.isProvidingVideo(e)}static _compareValue(e,t){return e===t?0:e>t?1:-1}static _compareBoolean(e,t){return e===t?0:e?1:-1}static fallbackStageElements(e,t,i){const a=this._fallbackStageParticipantKey(e,t,i);return a?[a]:[]}static isLeftPanelOpen(e){return!v.default.isUsingStackNavigationContext()&&w.default.isLeftPanelShowing(e)}static isGalleryPanelOpen(e){return!v.default.isUsingStackNavigationContext()&&w.default.isGalleryShowing(e)}static isSubtitlesPanelOpen(e){return!v.default.isUsingStackNavigationContext()&&w.default.isSubtitlesShowing(e)}static isRightPanelOpen(e){return!v.default.isUsingStackNavigationContext()&&w.default.isRightSideBarShowing(e)}static getCallCanvasWidth(e){let t=A.default.getWidth(e);return t-=!v.default.isUsingSplitViewNoSubscription()&&this.isLeftPanelOpen(e)?E.default.getWidthNoSubscription(E.SideBar.Left):0,t-=this.isRightPanelOpen(e)?E.default.getWidthNoSubscription(E.SideBar.Right,!1):0,t}static getControlsType(e,t){const i=this.getCallCanvasWidth(e),a=t;let n;return n=v.default.isUsingStackNavigationContext()?u.CallControlsType.Mobile:i<=this._getWidthBreakpoint(u.CallControlsType.DesktopMinSmallest,a)?u.CallControlsType.DesktopMinSmallest:i<=this._getWidthBreakpoint(u.CallControlsType.DesktopMedium,a)?u.CallControlsType.DesktopMedium:i<=this._getWidthBreakpoint(u.CallControlsType.DesktopMinStageTwo,a)?u.CallControlsType.DesktopMinStageTwo:i<=this._getWidthBreakpoint(u.CallControlsType.DesktopMin,a)?u.CallControlsType.DesktopMin:u.CallControlsType.Default,n}static _getWidthBreakpoint(e,t){if(t)switch(e){case u.CallControlsType.DesktopMin:return u.DesktopMinNewCallControlsWidthBreakpoint;case u.CallControlsType.DesktopMedium:return u.DesktopMediumtNewCallControlsWidthBreakpoint;case u.CallControlsType.DesktopMinStageTwo:return u.DesktopMinStageTwoNewCallControlsWidthBreakpoint;case u.CallControlsType.DesktopMinSmallest:return u.DesktopMinSmallestNewCallControlsWidthBreakpoint}else switch(e){case u.CallControlsType.DesktopMin:case u.CallControlsType.DesktopMedium:return u.DesktopMinCallControlsWidthBreakpoint;case u.CallControlsType.DesktopMinStageTwo:return u.DesktopMinStageTwoCallControlsWidthBreakpoint;case u.CallControlsType.DesktopMinSmallest:return u.DesktopMinSmallestCallControlsWidthBreakpoint}return-1}static isMinDesktop(e){return e===u.CallControlsType.DesktopMinSmallest||e===u.CallControlsType.DesktopMinStageTwo||e===u.CallControlsType.DesktopMin}static getMomentsIcon(){return O.SkypeIcon.Snapshot}static isDesktopMinCallPanelHeader(e){return!v.default.isUsingStackNavigationContext()&&!D.default.isTablet()&&this.getCallCanvasWidth(e)<=u.DesktopMinCallPanelHeaderWidthBreakpoint}static isDesktopMinCallRibbon(e){return!v.default.isUsingStackNavigationContext()&&!D.default.isTablet()&&this.getCallCanvasWidth(e)<=u.DesktopMinCallRibbonWidthBreakpoint}static isDesktopMinCallPanelHeaderV2(e){return!v.default.isUsingStackNavigationContext()&&!D.default.isTablet()&&this.getCallCanvasWidth(e)<=u.DesktopMinCallPanelHeaderV2WidthBreakpoint}static overflowMenuRowButtonsDescriptors(e){if(!e.callId||e.isEncryptedCall)return[];let t=[];const i=new I.NativeMobileInvitePeopleCommand(e.conversationMri,_.MeetNowOrigin.CallPanel,e.callId);if(i.canExecute()){const e=f.getString("JoinLinkCard.InvitePopupAccessibilityTitle");let a={key:u.CallControlsOverflowItem.AddPeople,icon:{icon:O.SkypeIcon.ShareiOS,color:B.Color.white},title:e,accessibilityLabel:e,onPress:()=>i.execute()};t.push(a)}return t}static overflowMenuListDescriptors(e){if(!e.callId||e.isEncryptedCall)return[];const t={isPSTNCall:e.isPSTNCall,isEncryptedCall:e.isEncryptedCall,conversationMri:e.conversationMri,callId:e.callId},i=[];if(s.default.getS4LCMCFeaturesNoSubscription().enableNoiseSuppression){const a=new I.ToggleNoiseSuppressionCommand(e.callId,t,e.noiseSuppressionMode);if(a.canExecute()){const t=[{label:f.getString("AudioVideoSettings.NoiseSuppressionOff"),value:o.NoiseSuppressionMode[o.NoiseSuppressionMode.Off]},{label:f.getString("AudioVideoSettings.NoiseSuppressionAuto"),value:o.NoiseSuppressionMode[o.NoiseSuppressionMode.Auto]},{label:f.getString("AudioVideoSettings.NoiseSuppressionLow"),value:o.NoiseSuppressionMode[o.NoiseSuppressionMode.Low]},{label:f.getString("AudioVideoSettings.NoiseSuppressionHigh"),value:o.NoiseSuppressionMode[o.NoiseSuppressionMode.High]}],n=t.find((t=>t.value===o.NoiseSuppressionMode[e.noiseSuppressionMode])),s=n?n.label:"",r=f.getString("AudioVideoSettings.NoiseSuppressionControlAccessibilityLabel",{selectedItem:s}),l={key:u.CallControlsOverflowItem.NoiseSuppression,icon:{icon:O.SkypeIcon.SoundWave,color:B.Color.white},title:f.getString("AudioVideoSettings.NoiseSuppressionControlLabel"),accessibilityLabel:r,onItemSelected:e=>a.execute(e),menuItems:t,listLabel:s};i.push(l)}}return i}static overflowMenuToggleDescriptors(e){if(!e.callId||e.isEncryptedCall)return[];const t={isPSTNCall:e.isPSTNCall,isEncryptedCall:e.isEncryptedCall,conversationMri:e.conversationMri,callId:e.callId},i=[];if(e.isBackroundBlurEnabled){const t=new I.BackgroundBlurCommand(e.callId,e.isVideoActive,e.isBackroundBlurEnabled,e.isBackgroundBlurSelected),a={key:u.CallControlsOverflowItem.BackgroundBlur,icon:{icon:O.SkypeIcon.BackgroundReplacement,color:B.Color.white},title:f.getString("CallControlsOverFlowMenu.EnableBackgroundBlur"),accessibilityLabel:f.getString("CallControlsOverFlowMenu.EnableBackgroundBlur"),onPress:()=>t.execute(),selected:e.isBackgroundBlurSelected,disabled:!t.canExecute(),isNew:e.isBackgroundBlurNewItem};i.push(a)}const a=new I.ToggleIncomingVideoCommand(e.callId,t,e.isAudioOnlyEnabled,e.isIncomingVideoDisabled);if(a.canExecute()){const t=!e.isIncomingVideoDisabled&&!e.isAudioOnlyEnabled,n=f.getString(t?"CallControlsOverFlowMenu.StopIncomingVideo":"CallControlsOverFlowMenu.StartIncomingVideo"),o={key:u.CallControlsOverflowItem.IncomingVideo,icon:{icon:O.SkypeIcon.Video,color:B.Color.white},title:f.getString("CallControlsOverFlowMenu.StartIncomingVideo"),accessibilityLabel:n,onPress:()=>a.execute(),selected:t};i.push(o)}const n=s.default.getS4LCMCFeatures().callCaptionsLiveButton,o=new I.ToggleTranslatorCommand(e.callId,t,e.isTranslating,e.callerContext().rootViewId);if(o.canExecute()&&e.callUIState===u.CallUIState.Default&&!n){const t=f.getString(e.isTranslating?"CallControlsOverFlowMenu.StopSubtitles":"CallControlsOverFlowMenu.StartSubtitles"),a=O.SkypeIcon.ClosedCaption,n=f.getString("CallControlsOverFlowMenu.StartSubtitles"),s={key:u.CallControlsOverflowItem.CallTranslator,icon:{icon:a,color:B.Color.white},title:n,accessibilityLabel:t,onPress:()=>o.execute(),selected:e.isTranslating};i.push(s)}return i}static overflowMenuButtonDescriptors(e,t){if(!e.callId||e.isEncryptedCall)return[];const i={isPSTNCall:e.isPSTNCall,isEncryptedCall:e.isEncryptedCall,conversationMri:e.conversationMri,callId:e.callId},a=[],n=new I.TwinCamCommand(e.callId,i);if(n.canExecute()){const t=r.default.CallingStore.hasConnectedTwinCam(e.callId),i={key:u.CallControlsOverflowItem.TwinCam,icon:{icon:O.SkypeIcon.TwinCamMid,color:B.Color.white},title:t?f.getString("CallControlsOverFlowMenu.StopTwinCam"):f.getString("CallControlsOverFlowMenu.TwinCam"),accessibilityLabel:t?f.getString("CallControlsOverFlowMenu.StopTwinCam"):f.getString("CallControlsOverFlowMenu.TwinCam"),onPress:()=>n.execute(t)};a.push(i)}const o=new I.ShowBingBackgroundsCommand(e.callId,e.callerContext);if(o.canExecute()){const e={key:u.CallControlsOverflowItem.BingBackgrounds,icon:{icon:O.SkypeIcon.Bing,color:B.Color.white},title:f.getString("CallControlsOverFlowMenu.BingBackgrounds"),accessibilityLabel:f.getString("CallControlsOverFlowMenu.BingBackgrounds"),onPress:()=>o.execute()};a.push(e)}const l=new I.AddToCallCommand(e.callId,i,e.conversationMri,e.callerContext,m.NavigationAddToCallOrigin.OverflowMenu);if(l.canExecute()){const e={key:u.CallControlsOverflowItem.AddPeople,icon:{icon:O.SkypeIcon.ContactAdd,color:B.Color.white},title:f.getString("CallControlsOverFlowMenu.AddPeopleToCall"),accessibilityLabel:f.getString("CallControlsOverFlowMenu.AddPeopleToCall"),onPress:()=>l.execute()};a.push(e)}const c=new I.ToggleRecordCommand(e.callId,i,e.isRecording);if(c.canExecute()&&e.callUIState===u.CallUIState.Default){const t=f.getString(e.isRecording?"CallControlsOverFlowMenu.StopRecording":"CallControlsOverFlowMenu.StartRecording"),i={key:u.CallControlsOverflowItem.CallRecording,icon:e.isRecording?[{icon:O.SkypeIcon.CallRecordStroke,color:B.Color.white},{icon:O.SkypeIcon.CallRecordDot,color:B.Color.red}]:{icon:O.SkypeIcon.CallRecord,color:B.Color.white},title:t,accessibilityLabel:t,onPress:()=>c.execute()};a.push(i)}if(!r.default.CallingFeaturesHelper.allowReactionsInCallStageMobile()){const t=this.getReactionButtonType(e.conversationMri,e.callId),n=this.getReactionCommand(t,e.callId,i,e.reactionsConversationMri);if(n){const e=this.getReactionButtonDescriptors(t,n),i=Object.assign(Object.assign({},e),{icon:{icon:e.icon,color:B.Color.white}});a.push(i)}}const d=new I.MomentCommand(i.callId,i,e.reactionsConversationMri);if(d.canExecute()&&r.default.CallingFeaturesHelper.allowReactionsInCallStageMobile()&&e.callUIState===u.CallUIState.Default){const e={icon:O.SkypeIcon.Snapshot,color:B.Color.white},t=f.getString("CallReactionsBar.PhotoSnapshotButtonShortTitle"),i={key:u.CallControlsOverflowItem.Moments,icon:e,title:t,accessibilityLabel:t,onPress:()=>d.execute()};a.push(i)}const h=new L.MobileScreenShareToggleCommand(i);if(h.canExecute()){const t=e.isScreenShareActive?{icon:O.SkypeIcon.ScreenShareOff,color:B.Color.white}:{icon:O.SkypeIcon.ScreenShare,color:B.Color.white},i=f.getString(e.isScreenShareActive?"CallControlsOverFlowMenu.StopShareScreen":"CallControlsOverFlowMenu.ShareScreen"),n={key:u.CallControlsOverflowItem.MobileScreenSharing,icon:t,title:i,accessibilityLabel:i,onPress:()=>h.execute()};a.push(n)}const p=new P.RaiseHandCommand(i.callId,e);if(p.canExecute()){const e={icon:O.SkypeIcon.RaiseHand,color:B.Color.white},t=f.getString("CallControls.RaiseHand"),i=f.getString("CallControls.RaiseHandLabel"),n={key:u.CallControlsOverflowItem.RaiseHands,icon:e,title:t,accessibilityLabel:i,onPress:()=>p.execute()};a.push(n)}const g=new P.LowerHandCommand(i.callId,M.LowerHandOrigin.CallControls);if(g.canExecute()){const e={icon:O.SkypeIcon.LowerHand,color:B.Color.white},t=f.getString("CallControls.LowerHand"),i=f.getString("CallControls.LowerHandLabel"),n={key:u.CallControlsOverflowItem.LowerHands,icon:e,title:t,accessibilityLabel:i,onPress:()=>g.execute()};a.push(n)}const C=new I.ToggleCallStatsCommand(e.callId,t);if(C.canExecute()){const e={key:u.CallControlsOverflowItem.CallStats,icon:{icon:O.SkypeIcon.Info,color:B.Color.white},title:f.getString("CallPanel.CallStats"),doesNotInfluenceMenuLayout:!0,onPress:()=>C.execute()};a.push(e)}const S=new I.ChangeTogetherModeBackgroundCommand(i.callId,i.conversationMri);if(S.canExecute()){const e=f.getString("CallControlsOverFlowMenu.ChangeTogetherModeBackground"),t={key:u.CallControlsOverflowItem.ChangeTogetherModeBackground,icon:{icon:N.default.getBackgroundChangeButtonIcon(),color:B.Color.white},title:e,doesNotInfluenceMenuLayout:!0,onPress:()=>S.execute()};a.push(t)}const y=s.default.getS4LCMCFeatures().callCaptionsLiveButton,_=new I.ToggleTranslatorCommand(e.callId,i,e.isTranslating,e.callerContext().rootViewId);if(_.canExecute()&&e.callUIState===u.CallUIState.Default&&y){const t=f.getString(e.isTranslating?"CallControlsOverFlowMenu.LiveCaptionsSettings":"CallControlsOverFlowMenu.LiveCaptionsStart"),i=e.isTranslating?O.SkypeIcon.ClosedCaptionSettings:O.SkypeIcon.ClosedCaption,n=t,o={key:u.CallControlsOverflowItem.CallTranslator,icon:{icon:i,color:B.Color.white},title:n,accessibilityLabel:t,onPress:()=>_.execute(),selected:e.isTranslating};a.push(o)}return a}static overflowMenuItemDescriptor(e,t=!1,i=!1,a=!1){let n,o,s;switch(e){case u.CallControlsOverflowItem.AddPeople:s={icon:O.SkypeIcon.ContactAdd,color:B.Color.white},n=f.getString("CallControlsOverFlowMenu.AddPeopleToCall");break;case u.CallControlsOverflowItem.Chat:s={icon:t?O.SkypeIcon.ChatsInverted:O.SkypeIcon.Message,color:B.Color.white},n=f.getString("ContentPanel.ChatTabTitle"),o=t?f.getString("CallPanel.CloseConversation"):f.getString("CallPanel.OpenConversation");break;case u.CallControlsOverflowItem.Reactions:let r;r=t?O.SkypeIcon.Cancel:i?O.SkypeIcon.Birthday:O.SkypeIcon.HeartOutline,s={icon:r,color:B.Color.white},n=f.getString("CallReactionsBar.EmoticonButtonShortTitle");break;case u.CallControlsOverflowItem.HeartReaction:s={icon:O.SkypeIcon.HeartOutline,color:B.Color.white},n=f.getString("CallControlsOverFlowMenu.ReactWithHeart");break;case u.CallControlsOverflowItem.ThumbsUpReaction:s={icon:O.SkypeIcon.CategoryYes,color:B.Color.white},n=f.getString("CallControlsOverFlowMenu.ThumbsUp");break;case u.CallControlsOverflowItem.CelebrationAnimation:s={icon:O.SkypeIcon.Birthday,color:B.Color.white},n=f.getString("CallControlsOverFlowMenu.CelebrateBirthday");break;case u.CallControlsOverflowItem.Gallery:s={icon:O.SkypeIcon.Gallery1,color:B.Color.white},n=f.getString("CallReactionsBar.GalleryButtonTitle");break;case u.CallControlsOverflowItem.Moments:s={icon:this.getMomentsIcon(),color:B.Color.white},n=f.getString("CallReactionsBar.PhotoSnapshotButtonShortTitle");break;case u.CallControlsOverflowItem.CallRecording:s=t?[{icon:O.SkypeIcon.CallRecordStroke,color:B.Color.white},{icon:O.SkypeIcon.CallRecordDot,color:B.Color.red}]:{icon:O.SkypeIcon.CallRecord,color:B.Color.white},n=f.getString(t?"CallControlsOverFlowMenu.StopRecording":"CallControlsOverFlowMenu.StartRecording");break;case u.CallControlsOverflowItem.CallTranslator:s=t&&!a?{icon:O.SkypeIcon.ClosedCaptionFilled,color:B.Color.white}:{icon:O.SkypeIcon.ClosedCaption,color:B.Color.white},n=a?f.getString("CallControlsOverFlowMenu.SubtitlesToggle"):f.getString(t?"CallControlsOverFlowMenu.StopSubtitles":"CallControlsOverFlowMenu.StartSubtitles");break;case u.CallControlsOverflowItem.IncomingVideo:s={icon:O.SkypeIcon.Video,color:B.Color.white},n=f.getString("CallControlsOverFlowMenu.StartIncomingVideo");break;case u.CallControlsOverflowItem.AudienceChangeBackground:s={icon:O.SkypeIcon.Bot,color:B.Color.white},n=f.getString("CallControlsOverFlowMenu.AudienceBotBackgroundChange");break;case u.CallControlsOverflowItem.MobileScreenSharing:s={icon:O.SkypeIcon.ScreenShare,color:B.Color.white},n=f.getString("CallControlsOverFlowMenu.ShareScreen");break;case u.CallControlsOverflowItem.CallStats:s={icon:O.SkypeIcon.Info,color:B.Color.white},n=f.getString("CallPanel.CallStats");break;case u.CallControlsOverflowItem.ChangeTogetherModeBackground:s={icon:N.default.getBackgroundChangeButtonIcon(),color:B.Color.white},n=f.getString("CallControlsOverFlowMenu.ChangeTogetherModeBackground");break;case u.CallControlsOverflowItem.BackgroundBlur:s={icon:O.SkypeIcon.BackgroundReplacement,color:B.Color.white},n=f.getString("CallControls.CallMenuBlurBackground");break;case u.CallControlsOverflowItem.RaiseHands:s={icon:O.SkypeIcon.Up,color:B.Color.white},n=f.getString("CallControls.RaiseHand");break;case u.CallControlsOverflowItem.LowerHands:s={icon:O.SkypeIcon.Down,color:B.Color.white},n=f.getString("CallControls.LowerHand");break;case u.CallControlsOverflowItem.BingBackgrounds:s={icon:O.SkypeIcon.BackgroundReplacement,color:B.Color.white},n=f.getString("CallControls.BingBackgrounds");break;case u.CallControlsOverflowItem.TwinCam:s={icon:O.SkypeIcon.TwinCamMid,color:B.Color.white},n=f.getString("CallControlsOverFlowMenu.TwinCam");break;case u.CallControlsOverflowItem.NoiseSuppression:s={icon:O.SkypeIcon.SettingsAudio,color:B.Color.white},n=f.getString("AudioVideoSettings.NoiseSuppressionControlLabel");break;default:return U.default.switchStatementExhaustiveChecking(e)}return{icon:s,title:n,accessibilityLabel:o||n}}static getFeatureUnsupportedParticipantsInfo(e,t,i){return a.isEmpty(t)?void 0:{count:t.length,firstUser:C.default.getMemberShortNameForConversation(i,r.default.CallingStore.getRemoteCallMemberMri(e,t[0])),secondUser:t.length>1?C.default.getMemberShortNameForConversation(i,r.default.CallingStore.getRemoteCallMemberMri(e,t[1])):void 0}}static getFeatureUnsupportedMessage(e,t){const i=e.count;let a;if(e.firstUser&&(e.firstUser||e.secondUser))switch(i){case 1:a=this._getOneCountFeatureUnsupportedMessage(e.firstUser,t);break;case 2:a=this._getTwoCountFeatureUnsupportedMessage(e,t);break;default:a=this._getMoreCountFeatureUnsupportedMessage(e,t)}else a=this._getDefaultFeatureUnsupportedMessage(t);return a||y.error(m.LogTraceArea.CallingUI,"CallUIUtils.getFeatureUnsupportedMessage Missing localized unsupported message"),a}static announceCameraDirectionState(e){if(!V.default.shouldAnnounceForAccessibility())return;let t;e===o.CameraPosition.Front?t=f.getString("CallControls.CameraFrontAnnouncement"):e===o.CameraPosition.Back&&(t=f.getString("CallControls.CameraBackAnnouncement")),t&&n.Accessibility.announceForAccessibility(t)}static getAccessibilityLabelForStageMode(e){switch(e){case u.StageMode.Grid:case u.StageMode.Manual:return f.getString("CallControls.StageModeGridAnnouncement");case u.StageMode.FocusedScreenShare:return f.getString("CallControls.StageModeFocusedScreenShareAnnouncement");case u.StageMode.Presentation:return f.getString("CallPanel.CallHeaderPresentationViewLabel");case u.StageMode.Speaker:return f.getString("CallControls.StageModeFocusAnnouncement");default:return}}static announceStageMode(e){if(!V.default.shouldAnnounceForAccessibility())return;let t=this.getAccessibilityLabelForStageMode(e);t&&n.Accessibility.announceForAccessibility(t)}static announceMicrophoneState(e,t=!1){if(!V.default.shouldAnnounceForAccessibility())return;let i=this.getAccessibilityLabelForMicrophoneMute(e,t);i&&n.Accessibility.announceForAccessibility(i)}static getAccessibilityLabelForMicrophoneMute(e,t=!1){let i;return t&&e?i=f.getString("CallControls.MicrophoneServerMutedAccessibilityLabel"):t||e?!t&&e&&(i=f.getString("CallControls.MicrophoneMutedAccessibilityLabel")):i=f.getString("CallControls.MicrophoneUnmutedAccessibilityLabel"),i}static announceVideoState(e){V.default.shouldAnnounceForAccessibility()&&(e?n.Accessibility.announceForAccessibility(f.getString("CallPreview.ToggleVideoOnLabel")):n.Accessibility.announceForAccessibility(f.getString("CallPreview.ToggleVideoOffLabel")))}static announceHoldState(e){V.default.shouldAnnounceForAccessibility()&&(e?n.Accessibility.announceForAccessibility(f.getString("CallControlsOverFlowMenu.HoldCallAnnouncement")):n.Accessibility.announceForAccessibility(f.getString("CallControlsOverFlowMenu.ResumeCallAnnouncement")))}static announceScreenShareState(e){V.default.shouldAnnounceForAccessibility()&&(e?n.Accessibility.announceForAccessibility(f.getString("CallControlsOverFlowMenu.ScreenShareStartAnnouncement")):n.Accessibility.announceForAccessibility(f.getString("CallControlsOverFlowMenu.ScreenShareEndAnnouncement")))}static announceSubtitleState(e,t){V.default.shouldAnnounceForAccessibility()&&(t?e?n.Accessibility.announceForAccessibility(f.getString("CallControlsOverFlowMenu.SubtitleStartStateAnnouncement")):n.Accessibility.announceForAccessibility(f.getString("CallControlsOverFlowMenu.SubtitleStopStateAnnouncement")):e?n.Accessibility.announceForAccessibility(f.getString("CallControlsOverFlowMenu.SubtitleBeginStartAnnouncement")):n.Accessibility.announceForAccessibility(f.getString("CallControlsOverFlowMenu.SubtitleBeginStopAnnouncement")))}static announceIncomingVideoAllowanceState(e){V.default.shouldAnnounceForAccessibility()&&(e?n.Accessibility.announceForAccessibility(f.getString("CallControlsOverFlowMenu.AllowIncomingVideoStopStateAnnouncement")):n.Accessibility.announceForAccessibility(f.getString("CallControlsOverFlowMenu.AllowIncomingVideoStartStateAnnouncement")))}static getRingingItemDisplayString(e){let t="";if(e.length&&a.intersection(S.default.getCallFullscreenBotMris(),e).length){if(a.intersection(S.default.getCallAudienceBotMriFilter(),e).length)return f.getString("ReactionsStream.CallingTogetherMode");if(a.intersection(S.default.getCallGridViewBotMriFilter(),e).length)return f.getString("ReactionsStream.CallingLargeGridMode")}e.length&&(t=C.default.getDisplayName(e[0])||f.getString("Notifications.UnknownUserShort"));let i="";e.length>1&&(i=C.default.getDisplayName(e[1])||f.getString("Notifications.UnknownUserShort"));let n="";return 1===e.length?n=f.getString("ReactionsStream.CallingParticipant",{participant:t}):2===e.length?n=f.getString("ReactionsStream.CallingTwoParticipants",{firstParticipant:t,secondParticipant:i}):e.length>2&&(n=f.getString("ReactionsStream.CallingMultipleParticipants",{participant:t,count:e.length-1})),n}static getShareScreenIcon(e){return e?O.SkypeIcon.ScreenShareOff:O.SkypeIcon.ScreenShare}static highContrastColorConfig(e){return{iconColor:e.primaryIconColor,backgroundColor:e.primaryBackgroundColor,selectedIconColor:e.primaryBackgroundColor,selectedBackgroundColor:e.primaryTextColor,borderColor:e.primaryTextColor,captionColor:e.primaryTextColor}}static videoTypeForKey(e,t,i){if(e===u.CallStageElementKeys.localUserKey){if(this.renderVideoPreview(t,i))return i.isLandscape?u.LayoutInfoVideoType.Landscape:u.LayoutInfoVideoType.Portrait}else if(e===this.screenShareKey(t)){const i=t.renderedRemoteElementInfo[e];if(i.videoStatus===u.VideoStatus.Streaming)return i.videoDimensions&&i.videoDimensions.width>i.videoDimensions.height?u.LayoutInfoVideoType.Landscape:u.LayoutInfoVideoType.Portrait}return u.LayoutInfoVideoType.None}static videoAspectRatioForKey(e,t,i){const a=s.default.getS4LCMCFeatures();if(e===u.CallStageElementKeys.localUserKey){if(this.renderVideoPreview(t,i)){const e=t.localVideoDimension||{width:a.videoWidth,height:a.videoHeight};if(e&&e.width>0&&e.height>0)return e.width/e.height}}else if(e===this.screenShareKey(t)){const i=t.renderedRemoteElementInfo[e];if(i.videoStatus===u.VideoStatus.Streaming&&i.videoDimensions&&i.videoDimensions.width>0&&i.videoDimensions.height>0)return i.videoDimensions.width/i.videoDimensions.height}return 1}static renderVideoPreview(e,t){return e.isProvidingVideo&&!e.ribbonHidden&&t.isVideoTarget}static screenShareKey(e){return e.screenshareElementInfo?e.screenshareElementInfo.key:void 0}static shouldRenderStage(e){return e.stageMode!==u.CallStageViewMode.RibbonOnly&&e.stageMode!==u.CallStageViewMode.None}static getNextScaleFactor(e,t,i){let n=a.range(1,t,(t-1)/i);n.push(t);const o=a.find(n,(t=>t>e));return a.isUndefined(o)?1:o}static adjustedStageViewRect(e){const t=this.adjustedStageViewBounds(e);return t.x=e.viewRect.x,t}static getSizesForStageElements(e,t,i,a,n,o){const s=i.width*i.height,r=a&&!o||!a&&o;let l;l=r?i.width*(i.height+t-s):i.height*(i.width+t-s);const c=t-l;let d,u;if(a?(u=1/(0===l?t/i.height:i.width),d=1/n.height):(u=1/n.width,d=1/(0===l?t/i.width:i.height)),1===t)return[{width:u,height:d},...e];if(0===l){return new Array(t).fill({width:u,height:d}).concat(e)}for(let t=0;t<l;t++)e.unshift({width:u,height:d});if(c>=1){const t=J.getNewVirtualStageSize(l,i,r);return J.getSizesForStageElements(e,c,t,o?!a:a,n,!1)}return e}static getNewVirtualStageSize(e,t,i){const a=i?t.width:t.height,n=(i?t.height:t.width)-Math.ceil(e/a);return{width:i?a:n,height:i?n:a}}static getStageVideoCount(e,t,i,a){const n=Math.ceil(Math.sqrt(e)),o=Math.min(i,t,n),s=Math.ceil(e/o),r=Math.max(o,s),l=Math.min(o,s);return{width:a?r:l,height:a?l:r}}static isTopStageElement(e,t,i,n){let o=[],s=n;if(0===a.keys(t).length)o=[...i];else{const r={},l=a.invert(t);for(const t of e){const e=l[t.key];if(e&&!a.isUndefined(t.stagePosition)){const o=parseInt(e,10);t.stagePosition===n&&(s=o);a.clone(t).stagePosition=o;const l=t.stagePosition;i[l]&&(r[e]=i[l])}}const c=a.sortBy(a.keys(r));for(let e of c)r[e]&&o.push(r[e])}const r=a.filter(o,(e=>void 0===e)).length>0;if(0===o.length||r)return!1;const l=1/o[0].width;if(o.length>2&&o.length%2==1){const e=a.findIndex(o,{height:1}),t=1/o[0===e?1:0].height;if(e>=0){let i=[e];for(let a=0;a<e;a+=t)i.push(a);for(let a=e+1;a<o.length;a+=t)i.push(a);return a.includes(i,s)}}return s<l}static adjustedStageViewBounds(e){const t=this.getStageTopOffset(e),i=this._getStageBottomOffset(e);return{x:0,y:e.viewRect.y+t,width:e.viewRect.width,height:e.viewRect.height-t-i}}static _getStageBottomOffset(e){return e.useMobileControls?0:u.DesktopCallControlsHeight}static getStageTopOffset(e){return this.getCurrentCallPanelHeaderLayout(e)===u.CallPanelHeaderLayout.Window?u.CallPanelHeaderHeight.window:0}static isInGridStageMode(e){return e===u.StageMode.Grid||e===u.StageMode.Manual}static isInIncomingScreenshareMode(e){return e===u.StageMode.Presentation||e===u.StageMode.FocusedScreenShare}static isInPresentationMode(e){return r.default.CallingFeaturesHelper.isPresentationModeEnabled()&&e===u.StageMode.Presentation}static getScreensharingMode(){return r.default.CallingFeaturesHelper.isPresentationModeEnabled()?u.StageMode.Presentation:u.StageMode.FocusedScreenShare}static getAvailableHeaderModes(e,t){return e?[]:t?[u.CallPanelHeaderLayout.Window,u.CallPanelHeaderLayout.Float]:[]}static isTogetherMode(e){return e===u.StageMode.TogetherMode}static isLargeGrid(e){return e===u.StageMode.LargeGrid}static getRibbonItemTopMargin(e){return u.RibbonSizes.ribbonItemModernStageTopMargin}static getCurrentCallPanelHeaderLayout(e){return e.callPanelHeaderLayout}static _getDefaultFeatureUnsupportedMessage(e){let t;if(e===j.CallReactions)t="CallPanel.ReactionsShortMessageDefault";return t?f.getString(t):void 0}static _getOneCountFeatureUnsupportedMessage(e,t){let i;if(t===j.CallReactions)i="CallPanel.ReactionsShortMessage1User";return i?f.getString(i,{firstUser:e}):void 0}static _getTwoCountFeatureUnsupportedMessage(e,t){let i;if(t===j.CallReactions)i="CallPanel.ReactionsShortMessage2Users";return i?f.getString(i,{firstUser:e.firstUser,secondUser:e.secondUser}):void 0}static _getMoreCountFeatureUnsupportedMessage(e,t){let i;if(t===j.CallReactions)i="CallPanel.ReactionsShortMessageMoreUsers";return i?f.getString(i,{count:e.count-2,firstUser:e.firstUser,secondUser:e.secondUser}):void 0}static _fallbackStageParticipantKey(e,t,i){let n,o=a.keys(e);const s=a.sortBy(a.filter(a.map(o,(t=>e[t])),(e=>e.videoStatus!==u.VideoStatus.None))).map((e=>e.key)),r=a.last(s);if(r)n=r;else if(!t||i===u.CallStageViewMode.StageAndRibbon&&l.CallingCapabilities.floatableResizableVideoPreviewSupported())if(o.length){const t=a.find(o,(t=>{const i=e[t];return i&&!a.isUndefined(i.participantState)&&c.default.isParticipantStateConnected(i.participantState)}));n=t||o[0]}else n=u.CallStageElementKeys.localUserKey;else n=u.CallStageElementKeys.localUserKey;if(y.log(m.LogTraceArea.CallingUI,"CallStageView._fallbackStageParticipantKey: "+R.mriOrId(n)),n===u.CallStageElementKeys.localUserKey)return n;return e[n]?n:void 0}static _streamStatus(e,t,i,a,n,o,s){if(!e)return u.VideoStatus.None;const l=!(!n||!r.default.RemoteStreamHelper.validateStream(i,e,n,o))?n:r.default.RemoteStreamHelper.getAvailableStream(i,e,t,s,o);return r.default.RemoteStreamHelper.isStreamRenderingForTargetStream(l,i,e,t,a)?u.VideoStatus.Streaming:(null==l?void 0:l.isAvailable)?u.VideoStatus.Available:u.VideoStatus.None}static _streamDimensions(e,i,a,n){return e&&r.default.RemoteStreamHelper.getStreamSize(a,e,i,n)||t.DummyVideoSize}static getReactionItems(e){const t=J.getEmoticonReactionKey(e),i=(0,g.default)().getCustomReactions(),n=a.uniq([t,...i].reverse());return a.map(n,(e=>({key:e,type:k.default.isAnimationReaction(e)?u.ReactionsItemType.Animation:u.ReactionsItemType.Emoticon})))}static getEmoticonReactionKey(e){const t=s.default.getS4LCMCFeatures();if(e)return t.callCelebrationConfig.callCelebrateButtonKey;const i=(0,g.default)();if(i.hasBeenCustomized()){const e=i.getCurrentReactions();return 0===e.length?i.getCustomReactions()[0]:e[0]}return t.callReactionButtonKey}static canHandBeLoweredForParticipant(e,t){const i=r.default.CallingStore.getCallConversationMri(e),a=i&&(0,p.default)().getConversation(i);return r.default.CallingStore.isHandRaisedForMri(t,e)&&(!(0,b.isModerated)(a)||(0,b.isCurrentUserAdminInModeratedGroup)(a)||T.default.isMyMri(t))}static announceLoweredHandState(e,t){if(!V.default.shouldAnnounceForAccessibility())return;let i;e?i=f.getString("CallPanel.HandLowered"):t&&(i=f.getString("CallPanel.HandLoweredOther",{displayName:t})),i&&n.Accessibility.announceForAccessibility(i)}static getReactionButtonType(e,t){let i=Q.Heart;return h.default.getCelebrationData(e,t)&&(i=Q.Celebration),i}static getReactionCommand(e,t,i,a){let n;switch(e){case Q.Celebration:n=new I.SendReactionCommand(u.ReactionsItemType.Animation,"cake",t,i,a);break;case Q.Heart:n=new I.SendReactionCommand(u.ReactionsItemType.Emoticon,"heart",t,i,a)}if(n.canExecute())return n}static getReactionButtonDescriptors(e,t){let i;switch(e){case Q.Celebration:i={key:u.CallControlsOverflowItem.CelebrationAnimation,icon:O.SkypeIcon.Birthday,title:f.getString("CallControlsOverFlowMenu.CelebrateBirthday"),accessibilityLabel:f.getString("CallControlsOverFlowMenu.CelebrateBirthday"),onPress:()=>t.execute()};break;case Q.Heart:i={key:u.CallControlsOverflowItem.HeartReaction,icon:O.SkypeIcon.HeartOutline,title:f.getString("CallControlsOverFlowMenu.ReactWithHeart"),accessibilityLabel:f.getString("CallControlsOverFlowMenu.ReactWithHeart"),onPress:()=>t.execute()}}return i}static getStageModeItemTitle(e,t){const i=(t?q:$)[this.displayedStageMode(e)];return i?f.getString(i):(y.error(m.LogTraceArea.CallingUI,"No title found for stage mode: "+u.StageMode[e]),"")}static getIconForStageMode(e,t){const i=(t?Z:X)[this.displayedStageMode(e)];return i||y.error(m.LogTraceArea.CallingUI,"No icon found for stage mode: "+u.StageMode[e]),i}static displayedStageMode(e){return e===u.StageMode.Manual?u.StageMode.Grid:e}static getAvailableMenuItems(e,t,i,a){const n=z.default.getAvailableStageModes(e).reduce(((e,t,a)=>(i&&0!==a&&e.push({type:u.LayoutPickerMenuItemType.Divider}),e.push({type:J.stageModeToLayoutPickerMenuItemType(t)}),e)),[]),o=s.default.getS4LCMCFeatures(),r=H.isOneOnOneConversation(a);o.enableAudioParticipantsOnTheStage&&!r&&(n.push({type:u.LayoutPickerMenuItemType.Divider}),n.push({type:u.LayoutPickerMenuItemType.OnlyVideoOnTheStage,isNew:this._isOnlyVideoOnTheStageNew(o),markAsSeen:this._markOnlyVideoOnTheStageAsSeen})),t&&(n.push({type:u.LayoutPickerMenuItemType.Divider}),n.push({type:u.LayoutPickerMenuItemType.Fullscreen}));const l=J.getAvailableHeaderModes(i,r);return l.length&&n.push({type:u.LayoutPickerMenuItemType.Divider}),l.forEach((e=>{n.push({type:J.headerModeToLayoutPickerMenuItemType(e)})})),o.enableNewCallScreen&&(n.push({type:u.LayoutPickerMenuItemType.Divider}),n.push({type:u.LayoutPickerMenuItemType.NewCallScreenToggle,isNew:this._isNewCallStageItemNew(o),markAsSeen:this._markNewCallStageItemAsSeen})),n}static getAvailableMenuItemsV2(e,t,i,a){const n=z.default.getAvailableStageModesV2(e).reduce(((e,t,a)=>(i&&0!==a&&e.push({type:u.LayoutPickerMenuItemType.Divider}),e.push({type:J.stageModeToLayoutPickerMenuItemType(t)}),e)),[]),o=s.default.getS4LCMCFeatures(),r=H.isOneOnOneConversation(a),l=z.default.getStageMode(e),c=!r&&this.isInGridStageMode(l),d=this.isInGridStageMode(l),h=o.enableTopTrayHiding;if((c||d||h)&&n.push({type:u.LayoutPickerMenuItemType.Divider}),c&&n.push({type:u.LayoutPickerMenuItemType.OnlyVideoOnTheStage,isNew:this._isOnlyVideoOnTheStageNew(o),markAsSeen:this._markOnlyVideoOnTheStageAsSeen}),d&&n.push({type:u.LayoutPickerMenuItemType.SelfInTheGridToggle}),h){const t=z.default.isTopTrayHidden(e)?u.LayoutPickerMenuItemType.ShowPeopleAtTop:u.LayoutPickerMenuItemType.HidePeopleAtTop;n.push({type:t})}if(t&&(n.push({type:u.LayoutPickerMenuItemType.Divider}),n.push({type:u.LayoutPickerMenuItemType.Fullscreen})),o.enableNewCallScreen&&(n.push({type:u.LayoutPickerMenuItemType.Divider}),n.push({type:u.LayoutPickerMenuItemType.NewCallScreenToggle})),o.enableLightThemeOnCallStage&&!x.default.useDarkTheme()){n.push({type:u.LayoutPickerMenuItemType.Divider});const e=this.useLightTheme()?u.LayoutPickerMenuItemType.SwitchToDarkThemeStage:u.LayoutPickerMenuItemType.SwitchToLightThemeStage;n.push({type:e})}return n}static _isOnlyVideoOnTheStageNew(e){return e.enableAudioParticipantsOnTheStageAsNew&&!!F.default.getUserPreferencesLocal().showOnlyVideoOnTheStageAsNew}static _isNewCallStageItemNew(e){return e.enableNewCallScreen&&!e.newCallScreenEnabledByDefault&&!!F.default.getUserPreferencesLocal().showNewStageItemAsNew}static stageModeToLayoutPickerMenuItemType(e){switch(e){case u.StageMode.Speaker:return u.LayoutPickerMenuItemType.StageModeSpeaker;case u.StageMode.FocusedScreenShare:return u.LayoutPickerMenuItemType.StageModeFocusedScreenShare;case u.StageMode.Grid:return u.LayoutPickerMenuItemType.StageModeGrid;case u.StageMode.Manual:return u.LayoutPickerMenuItemType.StageModeManual;case u.StageMode.Presentation:return u.LayoutPickerMenuItemType.StageModePresentation;case u.StageMode.TogetherMode:return u.LayoutPickerMenuItemType.StageModeTogetherMode;case u.StageMode.LargeGrid:return u.LayoutPickerMenuItemType.StageModeLargeGrid}}static layoutPickerMenuItemTypeToStageMode(e){switch(e){case u.LayoutPickerMenuItemType.StageModeSpeaker:return u.StageMode.Speaker;case u.LayoutPickerMenuItemType.StageModeFocusedScreenShare:return u.StageMode.FocusedScreenShare;case u.LayoutPickerMenuItemType.StageModeGrid:return u.StageMode.Grid;case u.LayoutPickerMenuItemType.StageModeManual:return u.StageMode.Manual;case u.LayoutPickerMenuItemType.StageModePresentation:return u.StageMode.Presentation;case u.LayoutPickerMenuItemType.StageModeTogetherMode:return u.StageMode.TogetherMode;case u.LayoutPickerMenuItemType.StageModeLargeGrid:return u.StageMode.LargeGrid;default:return}}static headerModeToLayoutPickerMenuItemType(e){switch(e){case u.CallPanelHeaderLayout.Mobile:return u.LayoutPickerMenuItemType.CallPanelHeaderLayoutMobile;case u.CallPanelHeaderLayout.Float:return u.LayoutPickerMenuItemType.CallPanelHeaderLayoutFloat;case u.CallPanelHeaderLayout.Window:return u.LayoutPickerMenuItemType.CallPanelHeaderLayoutWindow;case u.CallPanelHeaderLayout.None:return u.LayoutPickerMenuItemType.CallPanelHeaderLayoutNone}}static layoutPickerMenuItemTypeToHeaderMode(e){switch(e){case u.LayoutPickerMenuItemType.CallPanelHeaderLayoutMobile:return u.CallPanelHeaderLayout.Mobile;case u.LayoutPickerMenuItemType.CallPanelHeaderLayoutFloat:return u.CallPanelHeaderLayout.Float;case u.LayoutPickerMenuItemType.CallPanelHeaderLayoutWindow:return u.CallPanelHeaderLayout.Window;case u.LayoutPickerMenuItemType.CallPanelHeaderLayoutNone:return u.CallPanelHeaderLayout.None;default:return}}static shouldShowCallParticipantPinOption(e,t){var i;return s.default.getS4LCMCFeaturesNoSubscription().enableCallParticipantsPinning&&F.default.getNewCallScreenDesignEnabled()&&this.isInGridStageMode(z.default.getStageMode(t))&&!this.isCallParticipantPinned(e,t)&&W.default.getStageCapacity(t)>((null===(i=G.default.getPinnedParticipants(t))||void 0===i?void 0:i.length)||0)}static shouldShowCallParticipantUnpinOption(e,t){return s.default.getS4LCMCFeaturesNoSubscription().enableCallParticipantsPinning&&F.default.getNewCallScreenDesignEnabled()&&this.isCallParticipantPinned(e,t)}static isCallParticipantPinned(e,t){return!!e&&G.default.isParticipantPinned(e,t)}static isPortraitVideo(e){return e&&e.height>e.width}static getUserOptionsAccessibilityLabel(e,t,i){if(!e)return;let a;return a=t?f.getString("CallPanel.DisplayNameWithMicrophoneMuted",{displayName:e}):f.getString("SkypeUserListItem.DisplayNameLabel",{displayName:e}),i&&(a=f.getString("CallPanel.DisplayNameWithHandRaised",{prefix:a})),a}}t.CallUIUtils=J,J._ribbonAddTimeValue=1,J._markOnlyVideoOnTheStageAsSeen=()=>{F.default.setUserPreferencesLocal({showOnlyVideoOnTheStageAsNew:!1})},J._markNewCallStageItemAsSeen=()=>{F.default.setUserPreferencesLocal({showNewStageItemAsNew:!1})},t.default=J},78536:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StartCallOptionAction=void 0;const a=i(96486),n=i(48540),o=i(97691),s=i(94224),r=i(68580),l=i(98925),c=i(47447),d=i(71830),u=i(39549),h=i(20076),p=i(46096),g=i(36237),C=i(18460),m=i(41209),S=i(14976),y=i(72758);var f;!function(e){e[e.call=0]="call",e[e.promptForAddresses=1]="promptForAddresses",e[e.promptForSkypeMri=2]="promptForSkypeMri",e[e.failed=3]="failed"}(f=t.StartCallOptionAction||(t.StartCallOptionAction={}));const _=new class{startCallOrMaybePromptHelper(e,t,i,s,u,_,b,T){if(!this._releaseAssert(!!e.skypeMri||!a.isEmpty(e.phones),"CallOptionsHelper.startCallOrMaybePromptHelper","Must pass skypeMri or phones"))return r.default.generateCallingError("start","Must pass skypeMri or phones",n.TerminatedReason.BadRequest,n.FailureType.CallSetupFailed,l.CallValidationFailureReason.InvalidParameters),o.Resolved();if(!this._releaseAssert(!e.skypeMri||r.default.isValidCallingMri(e.skypeMri),"CallOptionsHelper.startCallOrMaybePromptHelper","If skypeMri is passed, it must be valid for calling"))return r.default.generateCallingError("start","If skypeMri is passed, it must be valid for calling",n.TerminatedReason.BadRequest,n.FailureType.CallSetupFailed,l.CallValidationFailureReason.InvalidParameters),o.Resolved();const v=(t,a,n)=>{if(!t)return;const o=this._activeCallIdForMri(t,n);return o?e.showCallPreview?s(t,o,a):i(t,o,a):void 0},w=(i,a)=>{v(i,a,T)||(e.initiatingConversation&&d.isEncryptedThread(e.initiatingConversation)&&!d.isEncryptedThread(i)?b(a).then((()=>t(i,a))):t(i,a)),P()},I=e=>w(e,!1),P=()=>{e.onCallStartedAnsweredOrJoined&&e.onCallStartedAnsweredOrJoined()},M=e=>{w(e,!1)};if(v(e.skypeMri,e.userIntent===l.StartCallOrMaybePromptUserIntent.Video,T))return P(),o.Resolved();const k=[!e.skypeMri||d.isThread(e.skypeMri)?o.Resolved(void 0):y.default.getFullUserProfileByMriAsync(e.skypeMri),c.CallingCapabilities.encryptedCallingSupported()&&e.skypeMri&&d.isSkypeIdMri(e.skypeMri)?h.getEstablishedEncryptedThreadId(e.skypeMri):o.Resolved(void 0)];return o.all(k).then((([t,i])=>{let a=m.mergeMriProfileAndExtraPhones(e.skypeMri,void 0,t?t.phones:e.phones);const n=e.skypeMri?C.default.getContactByCorrespondingMri(e.skypeMri):void 0;a=n?m.mergeMriProfileAndExtraPhones(void 0,a,n.phones):a;const o=this._callingOptionsHelper(e.skypeMri,a,e.userIntent,i);switch(o.action){case f.failed:g.error(p.LogTraceArea.Calling,"CallOptionsHelper._callingOptionsHelper failed. skypeMri: "+S.mriOrId(e.skypeMri)+", allPhones: "+a+", userIntent: "+e.userIntent);break;case f.call:if(!o.callMri){g.error(p.LogTraceArea.Calling,"CallOptionsHelper._callingOptionsHelper returned call action with no mri.");break}w(o.callMri,!!o.withVideo);break;case f.promptForSkypeMri:if(!e.skypeMri){g.error(p.LogTraceArea.Calling,"CallOptionsHelper._callingOptionsHelper promptForSkypeMri called with no mri.");break}u(d.isPhoneMri(e.skypeMri)?void 0:e.skypeMri,i,!!o.suppressPromptVideoOption,w,I,M,a,e.showSmsOption);break;case f.promptForAddresses:const n=e.skypeMri?d.getPhoneNumberFromMri(e.skypeMri):void 0,s=n?C.default.getContactByPhoneNumber(n):void 0,r=s?s.getDisplayName():t?t.getDisplayName():"";_(r,a,t&&t.emails)}}))}test_callingOptionsHelper(e,t){return this._callingOptionsHelper(e.skypeMri,e.phones,e.userIntent,t)}_callingOptionsHelper(e,t,i,n){const o=a.isEmpty(t)?0:t.length;return!e||d.isPhoneMri(e)?o&&i!==l.StartCallOrMaybePromptUserIntent.Video?i===l.StartCallOrMaybePromptUserIntent.Generic?{action:f.promptForAddresses}:1===o?{action:f.call,withVideo:!1,callMri:d.sanitizeMri(t[0].number,d.Namespaces.PSTN)}:{action:e?f.promptForSkypeMri:f.promptForAddresses}:{action:f.failed}:d.isThread(e)?o?{action:f.failed}:i===l.StartCallOrMaybePromptUserIntent.Generic?{action:f.promptForSkypeMri}:{action:f.call,withVideo:i===l.StartCallOrMaybePromptUserIntent.Video,callMri:e}:d.isUserMri(e)?i===l.StartCallOrMaybePromptUserIntent.Generic?{action:f.promptForSkypeMri}:i===l.StartCallOrMaybePromptUserIntent.Video?{action:f.call,withVideo:!0,callMri:e}:0!==o||n?{action:f.promptForSkypeMri,suppressPromptVideoOption:!0}:{action:f.call,withVideo:!1,callMri:e}:{action:f.failed}}_releaseAssert(e,t,i){return!!e||(g.error(p.LogTraceArea.Calling,S.dev_unknownOmit(t)+": "+S.dev_unknownOmit(i)),!1)}_activeCallIdForMri(e,t){if(!e)return;if(d.isThread(e)){const i=(0,u.default)().getConversation(e);if(!i){const i="CallOptionsHelper._activeCallIdForMri: Didn't find conversation";return g.warn(p.LogTraceArea.Calling,i+" "+S.mriOrId(e)+" causeId: "+t),void r.default.generateCallingError("answerOrJoin",i,n.TerminatedReason.BadRequest,n.FailureType.CallSetupFailed,l.CallValidationFailureReason.ConversationNotFound)}const a=i.validLiveState();return a&&a.conversationId}const i=s.default.CallingStore.getCallIdsForConversationMri(e);return a.head(i)}};t.default=_},97081:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DesktopSecondaryCallControlsManager=t.OverflowMenuCommands=void 0;const a=i(96486),n=i(80200),o=i(61253),s=i(53374);var r,l;!function(e){e.OnAddToCall="OnAddToCall",e.OnShowParticipants="OnShowParticipants",e.OnShowAVSettings="OnShowAVSettings",e.OnShowAudioSettings="OnShowAudioSettings",e.ShareScreen="ShareScreen",e.ShareScreenAndSounds="ShareScreenAndSounds",e.ConfirmStopSharing="ConfirmStopSharing",e.StopSharing="StopSharing",e.SwitchScreen="SwitchScreen",e.ScreenShareControl="ScreenShareControl",e.StopScreenShareControl="StopScreenShareControl",e.HoldCall="HoldCall",e.ResumeCall="ResumeCall",e.StartRecording="StartRecording",e.StopRecording="StopRecording",e.StartCaptions="StartCaptions",e.StopCaptions="StopCaptions",e.LiveCaptions="LiveCaptions",e.LiveCaptionsSettings="LiveCaptionsSettings",e.Snap="Snapshot",e.React="React",e.CustomReact="CustomReact",e.EnableIncomingVideo="EnableIncomingVideo",e.DisableIncomingVideo="DisableIncomingVideo",e.Blur="BlurBackground",e.Unblur="UnblurBackground",e.CallStats="CallStats",e.BackgroundEffectsSettings="BackgroundEffectsSettings",e.MuteEveryone="MuteEveryone",e.RaiseHand="RaiseHand",e.LowerHand="LowerHand",e.ChangeTogetherModeBackground="ChangeTogetherModeBackground",e.BingBackgrounds="BingBackgrounds",e.Invite="Invite",e.TwinCam="TwinCam",e.StopTwinCam="StopTwinCam"}(r=t.OverflowMenuCommands||(t.OverflowMenuCommands={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(l||(l={}));t.DesktopSecondaryCallControlsManager=class{configure(e){(0,o.default)(e,this._input)||(this._input=e,this._computeControlPlacement())}_computeControlPlacement(){if(this._input.controlsType===n.CallControlsType.DesktopMinSmallest){this._leftControls=[this._input.leftControlForDesktopMinSmallest];const e=a.flatMap(this._input.idealLeftControls,(e=>this._callControlKeyToOverflowMenuCommands(e.type))),t=a.flatMap(this._input.idealRightControls,(e=>this._callControlKeyToOverflowMenuCommands(e.type)));this._overflowControls=e.concat(t).concat(this._input.idealOverflowControls);const i=this._callControlKeyToOverflowMenuCommands(this._input.leftControlForDesktopMinSmallest);return 1===i.length&&(this._overflowControls=a.filter(this._overflowControls,(e=>e!==i[0]))),void(this._rightControls=this._overflowControls.length>0?[n.CallControlsKeys.Overflow]:[])}const e=this._getCapacity(this._input.controlsType,l.Left),t=this._getCapacity(this._input.controlsType,l.Right),i=this._restrictControls(this._input.idealLeftControls,e),o=this._restrictControls(this._input.idealRightControls,t);this._leftControls=a.map(i.controlsToKeep,(e=>e.type)),this._rightControls=a.map(o.controlsToKeep,(e=>e.type));const s=a.map(i.controlsForOverflow,(e=>e.type)),r=a.map(o.controlsForOverflow,(e=>e.type));var c=a.flatMap(s,(e=>this._callControlKeyToOverflowMenuCommands(e))),d=a.flatMap(r,(e=>this._callControlKeyToOverflowMenuCommands(e)));c=a.filter(c,(e=>-1===this._input.idealOverflowControls.indexOf(e))),d=a.filter(d,(e=>-1===this._input.idealOverflowControls.indexOf(e))),this._overflowControls=c.concat(d).concat(this._input.idealOverflowControls)}getLeftControls(){return this._leftControls}getRightControls(){return this._rightControls}getOverflowControls(){return this._overflowControls}_restrictControls(e,t){for(var i=a.map(e,(e=>({control:e,delete:!1}))),n=e.length;n>t;){const e=a.filter(i,(e=>!e.delete)),o=a.max(a.map(e,(e=>e.control.priority)));for(let e=0;e<i.length&&!(n<=t);e++)i[e].delete||i[e].control.priority!==o||(i[e].delete=!0,--n)}const o=a.filter(i,(e=>!e.delete)),s=a.filter(i,(e=>e.delete));return{controlsToKeep:a.map(o,(e=>e.control)),controlsForOverflow:a.map(s,(e=>e.control))}}_callControlKeyToOverflowMenuCommands(e){switch(e){case n.CallControlsKeys.Participants:return this._input.isOneOnOneCall?[r.OnAddToCall]:[r.OnShowParticipants];case n.CallControlsKeys.ScreenShare:const t=[this._input.isScreenShareActive?r.StopSharing:r.ShareScreen];return this._input.isScreenShareActive&&(this._input.numberAvailableScreens>1||this._input.windowSharingEnabled)&&t.push(r.SwitchScreen),t;case n.CallControlsKeys.ScreenShareControl:return this._input.canRequestScreenShareControl?[r.ScreenShareControl]:[r.StopScreenShareControl];case n.CallControlsKeys.RaiseHand:return[r.RaiseHand];case n.CallControlsKeys.LowerHand:return[r.LowerHand];case n.CallControlsKeys.ChangeScene:return[r.ChangeTogetherModeBackground];case n.CallControlsKeys.Record:if(this._input.allowRecording){if(!this._input.isRecording&&this._input.connectedAndNotOnHoldCallId===this._input.callId)return[r.StartRecording];if(this._input.isCallRecordingInitiator)return[r.StopRecording]}return[];case n.CallControlsKeys.ReactionsDrawer:return[r.React];case n.CallControlsKeys.ReactionsPopover:return[r.CustomReact];case n.CallControlsKeys.Moments:return[r.Snap];case n.CallControlsKeys.ShareLink:return[r.Invite];case n.CallControlsKeys.TwinCam:return[r.TwinCam];case n.CallControlsKeys.StopTwinCam:return[r.StopTwinCam];case n.CallControlsKeys.LiveCaptions:return this._input.allowLiveCaptions&&this._input.connectedAndNotOnHoldCallId===this._input.callId?this._input.isCaptioning?[r.LiveCaptionsSettings]:[r.LiveCaptions]:[];case n.CallControlsKeys.Mic:case n.CallControlsKeys.MicQuickSettings:case n.CallControlsKeys.Video:case n.CallControlsKeys.VideoQuickSettings:case n.CallControlsKeys.Dialpad:case n.CallControlsKeys.EndCall:case n.CallControlsKeys.Overflow:case n.CallControlsKeys.Chat:return[];default:return s.default.switchStatementExhaustiveChecking(e,"Missing case for an CallControlsKeys element")}}_getCapacity(e,t){switch(e){case n.CallControlsType.CallMonitor:case n.CallControlsType.Mobile:case n.CallControlsType.DesktopIncomingRingToast:return Number.MAX_SAFE_INTEGER;case n.CallControlsType.Default:return 5;case n.CallControlsType.DesktopMin:return t===l.Right?5:4;case n.CallControlsType.DesktopMinStageTwo:return t===l.Right?5:3;case n.CallControlsType.DesktopMedium:return 2;case n.CallControlsType.DesktopMinSmallest:return 1;default:return s.default.switchStatementExhaustiveChecking(e,"Missing case for an CallControlsType element")}}}},36540:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(94224),n=i(71830),o=i(39549),s=i(51129),r=i(59799),l=i(46096),c=i(36237),d=i(89871),u=i(35426),h=i(53374);t.default=class{static startOrAddPstnCall(e,t,i,r,p,g,C){const m=d.default.getPhoneNumberOrigin()||l.NavigationCallOrigin.PstnDialpad;c.track(new u.StartCall(l.NavigationCallOrigin[m])),i&&s.default.setDefaultPstnDestinationCountryCode(i);const S=h.default.newCauseId();if(t)this._startEmergencyPstnCall(e,S,i,r);else{let t;if(e&&(t=n.sanitizeMri(e,n.Namespaces.PSTN)),t)if(p&&g){const e=(0,o.default)().getConversation(g);let i=[];e&&(i=e.getMemberMris()),a.default.CallParticipantUtils.addUsersToCallOrRing([t],p,g,i,l.NavigationAddToCallOrigin.Unknown)}else C&&a.default.PstnUtils.setCallDTMF(t,C),a.default.CallNavigationHelper.startCall({conversationMri:t,withVideo:!1,origin:d.default.getPhoneNumberOrigin()||l.NavigationCallOrigin.PstnDialpad},S),d.default.resetPhoneNumberOrigin()}}static _startEmergencyPstnCall(e,t,i,n){i?n?(c.track(new u.EmergencyCall),c.log(l.LogTraceArea.GenericUnsafe,"Placing emergency call to "+s.default.maskPhoneNumber(e)+", destination country: "+i),r.default.getEmergencyContentForNumberNoSubscription(n)&&c.track(new u.E911EmergencyContentEvent),a.default.CallNavigationHelper.startEmergencyCall(n,i,t).catch((e=>{c.warn(l.LogTraceArea.GenericUnsafe,"Failed to place emergency call, reason: "+JSON.stringify(e)),c.track(new u.EmergencyCallFailed)}))):c.warn(l.LogTraceArea.GenericUnsafe,"Refusing to place emergency call, reason: no information about phone number suffix"):c.warn(l.LogTraceArea.GenericUnsafe,"Refusing to place emergency call, reason: no information about phone number country")}}},51129:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(74958),n=i(96486),o=i(89391),s=i(71830),r=i(46096),l=i(36237),c=i(78735),d=i(46929),u=i(72136),h=i(35426),p=i(4057),g={a:2,b:2,c:2,d:3,e:3,f:3,g:4,h:4,i:4,j:5,k:5,l:5,m:6,n:6,o:6,p:7,q:7,r:7,s:7,t:8,u:8,v:8,w:9,x:9,y:9,z:9,å:2,ä:2,á:2,ā:2,č:2,é:3,ē:3,í:4,ī:4,ģ:4,ķ:5,ļ:5,ö:6,ó:6,õ:6,ø:6,ņ:6,š:7,ü:8,ú:8,ū:8,ž:9,а:2,б:2,в:2,г:2,д:3,е:3,ж:3,з:3,и:4,й:4,к:4,л:4,м:5,н:5,о:5,п:5,р:6,с:6,т:6,у:6,ф:7,х:7,ц:7,ч:7,ш:8,щ:8,ъ:8,ы:8,ь:9,э:9,ю:9,я:9};t.default=class{static isEmergencyNumber(e){const t=o.default.getS4LEntitlementFeatures().SCE.Dialpad.EmergencyCall.allowedNumbers;return!!e.suffix&&n.includes(t,e.suffix)}static getEmergencyCallingCountrySubstitute(e){const t=this.getDefaultEmergencyCallingCountry();if(t&&e!==t&&this.allowedEmergencyCallingDestinationCountry(t))return u.default.getCountryByCode(t)}static isCallableNumber(e){return e.emergency?this.allowedEmergencyCallingDestinationCountry(n.toLower(e.countryCode)):!!e.prefix&&!!e.suffix&&e.suffix.length>1}static isValidPhoneNumberInput(e){return!!e&&/^\+?[\d\s]*(,[\d\s\*\#,]*$|$)/.test(e)}static getDefaultEmergencyCallingCountry(){return d.default.getEmergencyCallDefaultCountry()}static allowedEmergencyCallingDestinationCountry(e){return n.includes(o.default.getS4LEntitlementFeatures().SCE.Dialpad.EmergencyCall.allowedCountries,e)}static normalizePhoneNumber(e){if(!e)return"";let t,i=0;const n=o.default.getS4LEntitlementFeatures().SCE.Dialpad.NumberInput.decodeHtmlMaxIterations;try{do{t=e,e=decodeURIComponent(e),i++}while(t!==e&&i<n)}catch(t){l.error(r.LogTraceArea.DialerPanel,"[DialerPhoneNumberUtils] Failed to decode input number: "+a.pii.Omit(e))}let s=e.replace(/[^\d\+\*\#,]/g,"");return s.lastIndexOf("+")===s.length-1?"+":(s=s.replace(/(?!^)\+/g,""),s=s.replace(/^00/,"+"),"00"===s?"+":s)}static filterPhoneNumberChar(e,t){return t&&/[\d\+\*\#,]/.test(t)&&this.isValidPhoneNumberInput(e+t)?t:""}static getCountryDestinationPrefixIndex(e){let t={},i=-1,a=0;return n.each(e,((e,n)=>{t[e.countryCode]||(t[e.countryCode]=[],++a),t[e.countryCode].push(n),i<e.countryCode&&(i=e.countryCode)})),{index:t,indexSize:a,maxLength:i>=0?i.toString().length:0}}static getFormattedPhoneNumber(e,t){if(!t)return e;const i=t.length+1;return e.length===i?e:e.substr(0,i)+" "+e.substr(i)}static isE164Format(e){return 0===e.indexOf("+")}static getE164FormattedPhoneNumber(e,t){return e?"+"+e+(t||""):""}static getPhoneNumberSuffix(e,t){return t?this.isE164Format(e)?e.slice(t.length+1):e:n.trimStart(e,"+")}static getPhoneNumberPrefixCountry(e,t){if(!e)return;const i=t.index[n.parseInt(e)];if(!i||0===i.length)return;if(1===i.length)return u.default.getCountryByCode(i[0]);const a=o.default.getS4LEntitlementFeatures().SCE.Dialpad.CountryCodeToCountryDefault[e];return a?u.default.getCountryByCode(a.toLowerCase()):u.default.getCountryByCode(i[0])}static getPhoneNumberPrefix(e,t){if(e.length<2||0!==e.indexOf("+"))return;if(!t)return;const i=t.maxLength+1;for(let a=2;a<=i;++a){const i=n.toInteger(e.substring(1,a));if(t.index[i])return i.toString();if(n.includes(o.default.getS4LEntitlementFeatures().SCE.Dialpad.Calling.TestPrefixes,i))return i.toString();if(n.includes(o.default.getS4LEntitlementFeatures().SCE.Dialpad.Calling.NonGeographicPrefixes,i))return i.toString()}}static getDefaultPstnDestinationCountry(){const e=this._getStoredDefaultPstnDestinationCountryCode()||this._getGeoIpCountryCode();if(e)return u.default.getCountryByCode(e)}static setDefaultPstnDestinationCountryCode(e){const t=this._getStoredDefaultPstnDestinationCountryCode();if(t!==e){const i=this._getGeoIpCountryCode();void 0===t&&e!==i&&l.track(new h.DefaultCountryStored(i,e)),c.default.setUserPreferencesLocal({defaultPstnDestinationCountryCode:e})}}static _getStoredDefaultPstnDestinationCountryCode(){return c.default.getUserPreferencesLocal().defaultPstnDestinationCountryCode}static _getGeoIpCountryCode(){return o.default.getHeaders().CountryCode.toLowerCase()}static getPhoneNumberMri(e){return s.sanitizeMri(e.E164,s.Namespaces.PSTN)}static phoneNumberToString(e){return"PhoneNumber(input: "+this.maskPhoneNumber(e.inputValue)+", E164: "+this.maskPhoneNumber(e.E164)+", prefix: "+e.prefix+", suffix: "+this.maskPhoneNumber(e.suffix)+", country: "+e.countryCode+", callable: "+e.callable+", emergency: "+e.emergency+", searchable: "+e.searchable+", fcp: "+e.forceChangedPrefix+")"}static maskPhoneNumber(e){return e?a.pii.Omit(e):""}static containsNonGeographicOrTestPrefixes(e){const t=o.default.getS4LEntitlementFeatures().SCE.Dialpad.Calling;if(t){const i=t.NonGeographicPrefixes?t.NonGeographicPrefixes:[],a=t.TestPrefixes?t.TestPrefixes:[],o=i.concat(a);return n.some(o,(t=>0===e.indexOf("+"+t)))}return!1}static isCursorPlacedInPrefixArea(e,t){if(!this._isSingleCursorPlaced(t))return!1;const i=e.inputValue.length-(e.suffix?e.suffix.length:0);return t.start<i}static mapKeypadLettersToNumbers(e){const t=[];let i;e=p.default.deburrLowerCase(e);for(const a of e)i=g[a],i||0===i?t.push(i):t.push(a);return t.join("")}static _isSingleCursorPlaced(e){return e.start===e.end}}},69965:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getStringFromKeyCode=t.isNumpadNumberKeyCode=t.isNumberKeyCode=t.isDialPadKeyCode=void 0;const a=i(47126);function n(e){return 48<=e&&e<=57}function o(e){return 96<=e&&e<=105}t.isDialPadKeyCode=function(e,t){return t?e===a.default.THREE||e===a.default.EIGHT:n(e)||o(e)||42===e||106===e||35===e||e===a.default.COMMA},t.isNumberKeyCode=n,t.isNumpadNumberKeyCode=o,t.getStringFromKeyCode=function(e,t){return t?e===a.default.THREE?e=35:e===a.default.EIGHT&&(e=42):o(e)?e-=48:106===e?e=42:e===a.default.COMMA&&(e=44),String.fromCharCode(e)}},5581:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(74958),o=i(89391),s=i(98925),r=i(39549),l=i(46096),c=i(38891),d=i(36237),u=i(33754),h=i(78735),p=i(46929),g=i(14976);t.default=new class{getCallRecorderBotMri(){return h.default.getUserPreferencesLocal().callRecorderBotMriOverride||o.default.getS4LCMCFeatures().callRecorderBotMri}getCallRecorderBotMriFilter(){const e=h.default.getUserPreferencesLocal().callRecorderBotMriOverride,t=o.default.getS4LCMCFeatures().callRecorderBotMriFilter;return e?[e,...t]:t}setCallRecorderBotOverride(e){d.log(l.LogTraceArea.Calling,"InCallBotMriUtils.setCallRecorderBotOverride mri: "+g.mriOrId(e)),h.default.setUserPreferencesLocal({callRecorderBotMriOverride:e})}clearCallRecorderBotOverride(){d.log(l.LogTraceArea.Calling,"InCallBotMriUtils.clearCallRecorderBotOverride"),h.default.setUserPreferencesLocal({callRecorderBotMriOverride:void 0})}getCallTranslatorBotMri(){return h.default.getUserPreferencesLocal().callTranslatorBotMriOverride||o.default.getS4LCMCFeatures().callTranslatorBotConfig.botMri}getCallTranslatorBotMriFilter(){const e=h.default.getUserPreferencesLocal().callTranslatorBotMriOverride,t=o.default.getS4LCMCFeatures().callTranslatorBotConfig.botMriFilter;return e?[e,...t]:t}setCallTranslatorBotOverride(e){d.log(l.LogTraceArea.Calling,"InCallBotMriUtils.setCallTranslatorBotOverride mri: "+g.mriOrId(e)),h.default.setUserPreferencesLocal({callTranslatorBotMriOverride:e})}clearCallTranslatorBotOverride(){d.log(l.LogTraceArea.Calling,"InCallBotMriUtils.clearCallTranslatorBotOverride"),h.default.setUserPreferencesLocal({callTranslatorBotMriOverride:void 0})}setCallTranslatorBotHideInRosterOverride(e){d.log(l.LogTraceArea.Calling,"InCallBotMriUtils.setCallTranslatorBotHideInRosterOverride hide: "+e),h.default.setUserPreferencesLocal({callTranslatorBotHideInRosterOverride:e})}getLocalCallTranslatorBotSpokenLanguageLocale(e){if(o.default.getS4LCMCFeaturesNoSubscription().callCaptionsLiveButton){const t=this.getCallTranslatorSpokenLanguage(e);if(t&&!a.isEmpty(t))return t}const t=p.default.getCallTranslatorBotSpokenLanguageLocale();return t&&!a.isEmpty(t)?t:u.getLocale()}getLocalPstnCallTranlatorBotSpokenLanguageLocale(e){if(!e)return;const t=p.default.getCallPstnTranslatorBotSpokenLanguageLocales();return t&&t[e]&&t[e].local?t[e].local:void 0}setLocalPstnCallTranlatorBotSpokenLanguageLocale(e,t){let i=p.default.getCallPstnTranslatorBotSpokenLanguageLocales();i||(i={}),i[e]||(i[e]={}),i[e].local=t,p.default.setCallPstnTranslatorBotSpokenLanguageLocales(i)}getOtherPstnCallTranlatorBotSpokenLanguageLocale(e){if(!e)return;const t=p.default.getCallPstnTranslatorBotSpokenLanguageLocales();return t&&t[e]&&t[e].other?t[e].other:void 0}setOtherPstnCallTranlatorBotSpokenLanguageLocale(e,t){let i=p.default.getCallPstnTranslatorBotSpokenLanguageLocales();i||(i={}),i[e]||(i[e]={}),i[e].other=t,p.default.setCallPstnTranslatorBotSpokenLanguageLocales(i)}switchPstnCallTranlatorBotSpokenLanguageLocales(e){let t=p.default.getCallPstnTranslatorBotSpokenLanguageLocales();if(!t||!t[e])return;const i=t[e].local,a=t[e].other;t[e].local=a,t[e].other=i,p.default.setCallPstnTranslatorBotSpokenLanguageLocales(t)}getCallTranslatorCaptionsPositionMode(e){if(e){if(!o.default.getS4LCMCFeaturesNoSubscription().callCaptionsLiveButton)return c.CaptionsPositionMode.float;const t=p.default.getCallTranslatorCaptionsPositionMode();let i=null==t?void 0:t[e];if(i){if(this._isCaptionsPositionModeEnabled(i))return i;const e=o.default.getS4LCMCFeaturesNoSubscription().callCaptionsPositionModeDefault;return this._isCaptionsPositionModeEnabled(e)?e:c.CaptionsPositionMode.float}}}_isCaptionsPositionModeEnabled(e){const t=o.default.getS4LCMCFeaturesNoSubscription();switch(e){case c.CaptionsPositionMode.bottom:return t.callCaptionsBottomPanel.enabled;case c.CaptionsPositionMode.left:return t.callCaptionsLeftPanel.enabled;case c.CaptionsPositionMode.float:return t.callCaptionsFloatPanel.enabled;default:return!1}}setCallTranslatorCaptionsPositionMode(e,t){d.log(l.LogTraceArea.Calling,`Setting call captions position mode ${t} for conversation ${n.pii.Mri(e)}`);const i=p.default.getCallTranslatorCaptionsPositionMode()||{};i[e]=t,p.default.setCallTranslatorCaptionsPositionMode(i)}getCallTranslatorAlwaysStart(e){if(e){if(!o.default.getS4LCMCFeaturesNoSubscription().callCaptionsLiveButton)return;const t=p.default.getCallTranslatorAlwaysStart();return null==t?void 0:t[e]}}setCallTranslatorAlwaysStart(e,t){d.log(l.LogTraceArea.Calling,`Setting call captions always start to ${t} for conversation ${n.pii.Mri(e)}`);const i=p.default.getCallTranslatorAlwaysStart()||{};i[e]=t,p.default.setCallTranslatorAlwaysStart(i)}getCallTranslatorSpokenLanguage(e){if(e){const t=p.default.getCallTranslatorSpokenLanguage();if(t&&t[e])return t[e];{const t=this.getLocalCallTranslatorBotSubtitleLanguageLocale();if(t)return this.setCallTranslatorSpokenLanguage(e,t),t}}}setCallTranslatorSpokenLanguage(e,t){d.log(l.LogTraceArea.Calling,`Setting call captions spoken language to ${t} for conversation ${n.pii.Mri(e)}`);const i=p.default.getCallTranslatorSpokenLanguage()||{};i[e]=t,p.default.setCallTranslatorSpokenLanguage(i)}getLocalCallTranslatorBotSubtitleLanguageLocale(e){if(o.default.getS4LCMCFeaturesNoSubscription().callCaptionsLiveButton){const t=this.getCallTranslatorSpokenLanguage(e);if(t&&!a.isEmpty(t))return t}const t=p.default.getCallTranslatorBotSubtitleLanguageLocale();return t&&!a.isEmpty(t)?t:this.getLocalCallTranslatorBotSpokenLanguageLocale()}isDeviceLanguageSupportedForTranslation(){return a.includes(o.default.getS4LCMCFeatures().callTranslatorBotConfig.languageSupport.speech,this.getLocalCallTranslatorBotSpokenLanguageLocale())}isConversationTranslated(e){const t=(0,r.default)().getConversation(e);return t?this.isDeviceLanguageSupportedForTranslation()&&t.getTranslationState()===s.TranslationState.Enabled:(d.log(l.LogTraceArea.Calling,"InCallBotMriUtils.isConversationTranslated invalid conversation"),!1)}getConversationTranslationState(e){const t=(0,r.default)().getConversation(e);if(t)return t.getTranslationState();d.log(l.LogTraceArea.Calling,"InCallBotMriUtils.isConversationTranslated invalid conversation")}getCallAudienceBotMri(){return h.default.getUserPreferencesLocal().callAudienceBotMriOverride||o.default.getS4LCMCFeatures().callAudienceBotConfig.botMri}getCallAudienceBotMriFilter(){const e=h.default.getUserPreferencesLocal().callAudienceBotMriOverride,t=o.default.getS4LCMCFeatures().callAudienceBotConfig.botMriFilter;return e?[e,...t]:t}getBotType(e){return a.includes(this.getCallAudienceBotMriFilter(),e)?c.BotType.Audience:a.includes(this.getCallGridViewBotMriFilter(),e)?c.BotType.GridView:a.includes(this.getCallRecorderBotMriFilter(),e)?c.BotType.Recorder:a.includes(this.getCallTranslatorBotMriFilter(),e)?c.BotType.Translator:void 0}setCallAudienceBotOverride(e){d.log(l.LogTraceArea.Calling,"InCallBotMriUtils.setCallAudienceBotOverride mri: "+g.mriOrId(e)),h.default.setUserPreferencesLocal({callAudienceBotMriOverride:e})}clearCallAudienceBotOverride(){d.log(l.LogTraceArea.Calling,"InCallBotMriUtils.clearCallAudienceBotOverride"),h.default.setUserPreferencesLocal({callAudienceBotMriOverride:void 0})}getCallGridViewBotMri(){return h.default.getUserPreferencesLocal().callGridViewBotMriOverride||o.default.getS4LCMCFeatures().callGridViewBotConfig.botMri}getCallGridViewBotMriFilter(){const e=h.default.getUserPreferencesLocal().callGridViewBotMriOverride,t=o.default.getS4LCMCFeatures().callGridViewBotConfig.botMriFilter;return e?[e,...t]:t}setCallGridViewBotOverride(e){d.log(l.LogTraceArea.Calling,"InCallBotMriUtils.setCallGridViewBotOverride mri: "+g.mriOrId(e)),h.default.setUserPreferencesLocal({callGridViewBotMriOverride:e})}clearCallGridViewBotOverride(){d.log(l.LogTraceArea.Calling,"InCallBotMriUtils.clearCallGridViewBotOverride"),h.default.setUserPreferencesLocal({callGridViewBotMriOverride:void 0})}getCallFullscreenBotMris(){return[...this.getCallAudienceBotMriFilter(),...this.getCallGridViewBotMriFilter()]}getMultiParticipantInCallBotMris(){return[...this.getCallRecorderBotMriFilter(),...this.getCallTranslatorBotMriFilter(),...this.getCallAudienceBotMriFilter(),...this.getCallGridViewBotMriFilter()]}getNonVisibleInCallBotMris(){const e=o.default.getS4LCMCFeatures().callTranslatorBotConfig.hideInRoster,t=h.default.getUserPreferencesLocal().callTranslatorBotHideInRosterOverride,i=this.getCallRecorderBotMriFilter();return!t&&e?[...i,...this.getCallTranslatorBotMriFilter()]:i}getNonInteractiveInCallBotMris(){return[...this.getCallRecorderBotMriFilter(),...this.getCallTranslatorBotMriFilter(),...this.getCallAudienceBotMriFilter(),...this.getCallGridViewBotMriFilter()]}}},98053:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TwinCamCommand=t.ToggleCallStatsCommand=t.ShowBingBackgroundsCommand=t.InvitePeopleCommand=t.NativeMobileInvitePeopleCommand=t.ToggleTranslatorCommand=t.ToggleNoiseSuppressionCommand=t.ToggleIncomingVideoCommand=t.BackgroundBlurCommand=t.ToggleRecordCommand=t.ChangeTogetherModeBackgroundCommand=t.ToggleAudienceModeCommand=t.MomentCommand=t.SendReactionCommand=t.AddToCallCommand=void 0;const a=i(96486),n=i(81399),o=i(48540),s=i(18078),r=i(89391),l=i(94224),c=i(71830),d=i(81400),u=i(12563),h=i(72667),p=i(36850),g=i(2278),C=i(80200),m=i(47447),S=i(69840),y=i(39549),f=i(46096),_=i(5581),b=i(36237),T=i(33754),v=i(93446),w=i(44972),I=i(4735),P=i(36150),M=i(86045),k=i(62232),A=i(78262),R=i(90970),V=i(66123),L=i(53374),E=i(35114),B=i(52262);t.AddToCallCommand=class{constructor(e,t,i,a,n){this._callId=e,this._info=t,this._conversationMri=i,this._context=a,this._origin=n}canExecute(){return l.default.CallingFeaturesHelper.allowAddToCall(this._info)}execute(){const e=L.default.newCauseId();b.log(f.LogTraceArea.CallingUI,"AddToCallCommand.execute callId: ${this._callId} causeId: ${causeId}"),b.log(f.LogTraceArea.CallingUI,"AddToCallCommand.onNavigateAwayFrom Call onCallScreenClose,callId: ${this._callId} causeId: ${causeId}"),n.default.onCallScreenClose(),I.default.openAddToCall(this._conversationMri,this._callId,this._origin,this._context(),e),R.default.updateCallRosterTelemetry(this._callId,e,(e=>e.callRosterAddToCall()))}};t.SendReactionCommand=class{constructor(e,t,i,a,n){this._reactionType=e,this._reactionKey=t,this._callId=i,this._info=a,this._reactionsConversationMri=n}canExecute(){return l.default.CallingFeaturesHelper.allowReactions(this._info)}execute(){const e=L.default.newCauseId();b.log(f.LogTraceArea.CallingUI,"SendReactionCommand.execute callId: ${this._callId} causeId: ${causeId}");const t={reactionInfo:{type:this._reactionType,key:this._reactionKey},causeId:e,timestamp:Date.now(),postSource:f.PostSource.CallReactionPressed,callId:this._callId,conversationMri:this._info.conversationMri,reactionsConversationMri:this._reactionsConversationMri,logTraceArea:f.LogTraceArea.CallReactionsDrawer};d.CallReactionPostingHelpers.postReaction(t)}};t.MomentCommand=class{constructor(e,t,i){this._callId=e,this._info=t,this._reactionsConversationMri=i}canExecute(){return l.default.CallingFeaturesHelper.allowSnapshots(this._info)&&m.CallingCapabilities.callSnapshotSupported()}execute(){const e=L.default.newCauseId(),t=k.default.SkypeCameraCapture;b.log(f.LogTraceArea.CallingUI,"MomentCommand.execute callId: ${this._callId} causeId: ${causeId}");const i=[this._info.conversationMri],a=this._info.conversationMri,n=this._reactionsConversationMri;let o=l.default.CallingStore.getRankedSpeakerMris(this._callId);t.playOnce(e),h.default.takeSnapshot(e,this._callId,a,n,o,i),M.default.maybeAnnounceForAccessibility(T.getString("CallPanel.SnapshotPosted")),g.default.updateCallTelemetry(this._callId,e,(e=>e.postPhotoSnapshot()))}};t.ToggleAudienceModeCommand=class{constructor(e,t,i){this._callId=e,this._info=t,this._isAudienceMode=i}canExecute(){return l.default.CallingFeaturesHelper.allowCallAudienceBot(this._info)}execute(){const e=L.default.newCauseId();b.log(f.LogTraceArea.CallingUI,"AudienceCommand.execute callId: ${this._callId} causeId: ${causeId}"),this._isAudienceMode?l.default.InCallBotService.stopAudienceMode(this._callId,e):l.default.InCallBotService.startAudienceMode(this._callId,e)}};class O{constructor(e,t){this._callId=e,this._conversationMri=t}canExecute(){return O.canExecute(this._callId,this._conversationMri)}static canExecute(e,t){if(a.isUndefined(e)||a.isUndefined(t))return!1;const i=p.default.getStageMode(e)===C.StageMode.TogetherMode,{enabledBackgroundSelection:n}=r.default.getS4LCMCFeatures().callAudienceBotConfig,o=l.default.CallingStore.isConnectedAudienceBotInCall(e),s=!a.isEmpty(V.default.getTogetherModeBackgrounds()),c=O._isAllowedToChangeBackgroundIfInModeratedGroup(t);if(i&&n&&o&&c){if(s)return!0;{const e="ChangeTogetherModeBackgroundCommand.canExecute no TogetherMode backgrounds to choose from";return b.warn(f.LogTraceArea.CallingUI,e),!1}}return!1}static _isAllowedToChangeBackgroundIfInModeratedGroup(e){const t=e&&(0,y.default)().getConversation(e);return!(0,w.isModerated)(t)||(0,w.isCurrentUserAdminInModeratedGroup)(t)}execute(){const e=L.default.newCauseId();g.default.togetherModeSceneChangeRequestCount(this._callId,e);const t={conversationMri:this._conversationMri,onChangeBackground:t=>{l.default.AudienceBotService.selectAudienceScene(this._callId,e,t.sceneId)},onStartTogetherMode:a.noop,onClose:a.noop,isAudienceBotInCall:!0,selectedBackground:undefined};I.default.navigateToTogetherModePanel(t,V.default.getPanelId())}}t.ChangeTogetherModeBackgroundCommand=O;t.ToggleRecordCommand=class{constructor(e,t,i){this._callId=e,this._info=t,this._isRecording=i}canExecute(){const e=l.default.CallingStore.getCallRecordingInitiator(this._callId);return l.default.CallingFeaturesHelper.allowRecording(this._info)&&l.default.InCallBotUtils.showCallRecorderControls(e)}execute(){const e=L.default.newCauseId();b.log(f.LogTraceArea.CallingUI,"RecordCommand.execute callId: ${this._callId} causeId: ${causeId}"),this._isRecording?l.default.InCallBotService.stopRecording(this._callId,e):l.default.InCallBotService.startRecording(this._callId,e)}};t.BackgroundBlurCommand=class{constructor(e,t,i,a){this._callId=e,this._isVideoActive=t,this._isBackgroundBlurEnabled=i,this._isBackgroundBlurSelected=a}canExecute(){return this._isBackgroundBlurEnabled&&this._isVideoActive}execute(){const e=L.default.newCauseId();b.log(f.LogTraceArea.CallingUI,`BackgroundBlurCommand.execute callId: ${this._callId} causeId: ${e}`),this._isVideoActive&&(this._isBackgroundBlurSelected=!this._isBackgroundBlurSelected,l.default.DeviceStore.setBackgroundBlurred(this._isBackgroundBlurSelected))}};t.ToggleIncomingVideoCommand=class{constructor(e,t,i,a){this._callId=e,this._info=t,this._audioOnlyEnabled=i,this._isIncomingVideoDisabled=a}canExecute(){return l.default.CallingFeaturesHelper.allowIncomingVideoToBeDisabled(this._info)}execute(){const e=L.default.newCauseId();b.log(f.LogTraceArea.CallingUI,"IncomingVideoCommand.execute callId: ${this._callId} causeId: ${causeId}"),this._audioOnlyEnabled?l.default.CallingStore.stopAudioOnly(this._callId,e):this._isIncomingVideoDisabled?l.default.CallingStore.enableIncomingVideo(this._callId,e):l.default.CallingStore.disableIncomingVideo(this._callId,e)}};t.ToggleNoiseSuppressionCommand=class{constructor(e,t,i){this._callId=e,this._info=t,this._noiseSuppressionMode=i}canExecute(){return l.default.CallingFeaturesHelper.allowIncomingVideoToBeDisabled(this._info)}execute(e){const t=L.default.newCauseId();let i;switch(b.log(f.LogTraceArea.CallingUI,`NoiseSuppressionCommand.execute callId: ${this._callId}\n                                                       item: ${e} mode: ${this._noiseSuppressionMode} causeId: ${t}`),e){case o.NoiseSuppressionMode.Auto:i=o.NoiseSuppressionMode.Auto;break;case o.NoiseSuppressionMode.Off:i=o.NoiseSuppressionMode.Off;break;case o.NoiseSuppressionMode.Low:i=o.NoiseSuppressionMode.Low;break;case o.NoiseSuppressionMode.High:i=o.NoiseSuppressionMode.High;break;default:return}this._noiseSuppressionMode=i,l.default.DeviceStore.setNoiseSuppressionMode(this._noiseSuppressionMode),l.default.CallingStore.setNoiseSuppressionMode(this._noiseSuppressionMode)}};t.ToggleTranslatorCommand=class{constructor(e,t,i,a){this._callId=e,this._info=t,this._isTranslating=i,this._rootViewId=a}canExecute(){const e=_.default.isConversationTranslated(this._info.conversationMri),t=l.default.InCallBotService.isPstnTranslationEnabled(this._info.callId);return l.default.CallingFeaturesHelper.allowCaptioning(this._info)&&!e&&!t}execute(){const e=L.default.newCauseId(),t=r.default.getS4LCMCFeatures().callCaptionsLiveButton;b.log(f.LogTraceArea.CallingUI,"TranslatorCommand.execute callId: ${this._callId} causeId: ${causeId}"),t?(b.log(f.LogTraceArea.CallingUI,`ToggleTranslatorCommand.execute callId: ${this._callId}`),this._isTranslating?(n.default.onCallScreenClose(),I.default.navigateToCallCaptionsSettingsPanel(this._callId,this._info.conversationMri,this._rootViewId)):l.default.InCallBotService.startTranslator(this._callId,e)):this._isTranslating?l.default.InCallBotService.stopTranslator(this._callId,e):l.default.InCallBotService.startTranslator(this._callId,e)}};t.NativeMobileInvitePeopleCommand=class{constructor(e,t,i){this._conversationId=e,this._origin=t,this._callId=i}canExecute(){const e=(0,y.default)().getConversation(this._conversationId);return!(!(null==e?void 0:e.isGroupConversation())||!(null==e?void 0:e.isJoinEnabled()))&&(this._joinLink=S.default.getLink(this._conversationId),!!this._joinLink)}execute(){this._joinLink&&v.default.showMobile({threadId:this._conversationId,joinLink:this._joinLink,callId:this._callId,meetNowParameters:{origin:this._origin}})}};t.InvitePeopleCommand=class{constructor(e,t){this._conversationId=e,this._rootViewId=t}canExecute(){var e;const t=(0,y.default)().getConversation(this._conversationId);return null!==(e=null==t?void 0:t.isGroupConversation())&&void 0!==e&&e}execute(){const e=B.default.getDisplayName(this._conversationId);I.default.navigateToGroupShare(this._conversationId,e,E.InviteLinkOrigin.QuickCallPanel,this._rootViewId)}};t.ShowBingBackgroundsCommand=class{constructor(e,t){this._callId=e,this._context=t}canExecute(){const e=l.default.CallingFeaturesHelper.bingBackgroundsEnabled(),t=l.default.CallParticipantBackgroundInfoStore.captionsReceivedCount(this._callId);return e&&t>0}execute(){b.log(f.LogTraceArea.CallingUI,"ShowBingBackgroundsCommand.execute callId: ${this._callId}"),b.log(f.LogTraceArea.CallingUI,"ShowBingBackgroundsCommand.onNavigateAwayFrom Call onCallScreenClose,callId: ${this._callId} causeId: ${causeId}"),n.default.onCallScreenClose(),I.default.openBingBackgroundsOverview(this._callId,this._context())}};t.ToggleCallStatsCommand=class{constructor(e,t,i){this._callId=e,this._context=t,this._modal=i}canExecute(){return r.default.getS4LCMCFeatures().enableCallTechnicalInformation&&!P.default.isMobileScreenReaderEnabled()&&m.CallingCapabilities.callTechnicalInformationSupported()}execute(){I.default.navigateToCallingDebugPanel(this._callId,this._context,this._modal)}};t.TwinCamCommand=class{constructor(e,t){this._callId=e,this._info=t,this._onStopTwinCamButtonPress=()=>{const e=L.default.newCauseId();if(b.log(f.LogTraceArea.Calling,"_onStopTwinCamButtonPress: causeId: "+e),r.default.getS4LCMCFeaturesNoSubscription().enableNotifyUsersMuteKick){const t=c.getReactionsThreadMriForCallId(this._callId),i=s.default.getSkypeMri();u.postCallEventNotification(A.ReactionsTextType.CallEventKickedOutOwn,i,this._callId,this._info.conversationMri,t,e)}l.default.CallingStore.removeOtherEndpoints(this._callId,e)}}canExecute(){return!a.isUndefined(this._callId)&&!a.isUndefined(this._info.conversationMri)&&l.default.CallingFeaturesHelper.allowTwinCam(this._info)}execute(e){if(e)this._onStopTwinCamButtonPress();else{const e={callId:this._callId,conversationMri:this._info.conversationMri,onStopTwinCamPressed:this._onStopTwinCamButtonPress};I.default.navigateToTwinCamPanel(e)}}}},99189:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LowerHandParticipantCommand=t.LowerHandCommand=t.RaiseHandCommand=void 0;const a=i(94224),n=i(71727),o=i(36237),s=i(54306),r=i(53374);t.RaiseHandCommand=class{constructor(e,t){this._callId=e,this._info=t}isFeatureEnabled(){return a.default.CallingFeaturesHelper.allowRaiseHands(this._info)}canExecute(){return a.default.CallingFeaturesHelper.allowRaiseHands(this._info)&&!a.default.CallingStore.isHandRaisedForCurrentUserMri(this._callId)}execute(){return o.track(new s.RaiseHandTelemetryEvent(this._callId,s.RaiseHandAction.RaiseHand,a.default.CallingStore.connectedParticipantsCount(this._callId)+1)),a.default.CallingStore.raiseHand(this._callId,r.default.newCauseId())}};t.LowerHandCommand=class{constructor(e,t){this._callId=e,this._lowerHandOrigin=t}canExecute(){return a.default.CallingStore.isHandRaisedForCurrentUserMri(this._callId)}execute(){return o.track(new s.RaiseHandTelemetryEvent(this._callId,s.RaiseHandAction.LowerMyHand,a.default.CallingStore.connectedParticipantsCount(this._callId)+1,this._lowerHandOrigin)),n.default.announceLoweredHandState(!0),a.default.CallingStore.lowerHandForCurrentUserMri(this._callId,r.default.newCauseId())}};t.LowerHandParticipantCommand=class{constructor(e,t,i,a,n){this._callId=e,this._mri=t,this._lowerHandOrigin=i,this._isLocal=a,this._displayName=n}isHandRaised(){return a.default.CallingStore.isHandRaisedForMri(this._mri,this._callId)}canExecute(){return n.default.canHandBeLoweredForParticipant(this._callId,this._mri)}execute(){a.default.CallingStore.lowerHandForMri(this._mri,this._callId,r.default.newCauseId()),o.track(new s.RaiseHandTelemetryEvent(this._callId,s.RaiseHandAction.LowerOthersHand,a.default.CallingStore.connectedParticipantsCount(this._callId)+1,this._lowerHandOrigin)),n.default.announceLoweredHandState(this._isLocal,this._displayName)}}},72425:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocallyStartedRinglessCallType=void 0;const a=i(89391),n=i(94224),o=i(47176),s=i(71830),r=i(39549),l=i(46096),c=i(36237),d=i(46929),u=i(4735),h=i(53374);var p;!function(e){e[e.OnePerson=0]="OnePerson",e[e.SmallGroup=1]="SmallGroup",e[e.LargeGroup=2]="LargeGroup",e[e.GoLive=3]="GoLive",e[e.None=4]="None"}(p=t.LocallyStartedRinglessCallType||(t.LocallyStartedRinglessCallType={}));class g{static getRinglessCallType(e,t){const i=g.getMemberCount(e);return t&&!this.isLocallyStartedRinglessCall(e,t)?p.None:1===i?p.OnePerson:i<=a.default.getS4LCMCFeatures().maximumGroupSizeRing&&a.default.getS4LCMCFeatures().enableRinglessCallForSmallGroups?p.SmallGroup:i>a.default.getS4LCMCFeatures().maximumGroupSizeRing&&a.default.getS4LCMCFeatures().enableRinglessCall?p.LargeGroup:p.GoLive}static getMemberCount(e){const t=(0,r.default)().getConversation(e);return t?Math.max(t.getMemberCount(),0):0}static isLocallyStartedRinglessCall(e,t){return n.default.CallingStore.hasStartedCallLocallyGoLive(t)}static handleRingTheGroup(e,t){const i=o.default.getInactiveGroupMembers(t,e);n.default.CallParticipantUtils.addUsersToCallOrRing(i,t,e,i,l.NavigationAddToCallOrigin.GoLiveInformationView);const a=h.default.newCauseId();c.log(l.LogTraceArea.CallingUI,`[GoLiveInformationPanel] _handleRingAll, causeId: ${a}`)}static isRingTheGroupOptionAvailable(e,t){return!(!g.isLocallyStartedRinglessCall(e,t)||n.default.CallingStore.hasRingingParticipants(t,!0)||this.getRinglessCallType(e)!==p.SmallGroup)}static isPotentialRinglessCall(e,t){if(!s.isGroupConversation(e))return!1;switch(g.getRinglessCallType(e)){case p.SmallGroup:return t;case p.LargeGroup:return!0;default:return!1}}static isInterstitialShown(e){const t=g.getMemberCount(e);if(1!==t)return t>a.default.getS4LCMCFeatures().maximumGroupSizeRing?d.default.getInterstitialForLargeGroupRinglessCallsShown():d.default.getInterstitialForSmallGroupRinglessCallsShown()}static shouldShowInterstitial(e,t){return!g.isInterstitialShown(e)&&g.isPotentialRinglessCall(e,t)}static maybeShowRinglessCallInterstitial(e,t,i,a){if(g.isInterstitialShown(e)||!g.isPotentialRinglessCall(e,t))return;c.log(l.LogTraceArea.CallingUI,"RinglessCallUtils show Ringlesscall interstitial");const n=g.getRinglessCallType(e)===p.LargeGroup;u.default.navigateToRinglessCallInterstitial({conversationMri:e,origin:i,withVideo:t,isLargeGroup:n,causeId:a}),n?d.default.setInterstitialForLargeGroupRinglessCallsShown(!0):d.default.setInterstitialForSmallGroupRinglessCallsShown(!0)}}t.default=g},24932:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MobileScreenShareToggleCommand=void 0;i(28421);const a=i(94224),n=i(2278),o=i(46096),s=i(36237),r=i(33754),l=i(86045),c=i(53374);t.MobileScreenShareToggleCommand=class{constructor(e){this._callInfo=e}canExecute(){const e=a.default.DeviceStore.getAvailableScreens();return e&&e.length>0&&a.default.CallingFeaturesHelper.allowMobileScreenSharing(this._callInfo)}execute(){const e=this._callInfo.callId;if(!e)return;const t=c.default.newCauseId(),i=a.default.CallingStore.isScreenSharing(e);if(s.log(o.LogTraceArea.CallingUI,`ScreenShareToggleCommand isScreenShareActive:${i}; callId: ${e}; causeId: ${t}`),i)a.default.CallingStore.stopScreenSharing(e,t),n.default.updateCallTelemetry(e,t,(e=>e.stopScreenSharing())),l.default.maybeAnnounceForAccessibility(r.getString("AccessibilityLabel.ScreenShareStopped"));else{const i=a.default.DeviceStore.getAvailableScreens();if(i&&i.length>0){(()=>{a.default.CallingStore.startScreenSharing(e,t,i[0],!1),n.default.updateCallTelemetry(e,t,(e=>e.startScreenSharing())),l.default.maybeAnnounceForAccessibility(r.getString("AccessibilityLabel.ScreenShareStarted"))})()}else s.error(o.LogTraceArea.CallingUI,"No screens are available for sharing")}}}},46393:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LgTmModeElementsManager=t.PresentationModeElementsManager=t.SpeakerModeElementsManager=t.GridModeElementsManager=t.FullScreenBotType=t.StageModeElementsManager=void 0;const a=i(96486),n=i(18078),o=i(36237),s=i(53374),r=i(80200),l=i(5581),c=i(66355),d=i(98925),u=i(94224),h=i(71727),p=i(76514),g=i(89391);class C{constructor(e,t){this._callId=e,this._trayWidth=t,this._filterOutNonDisplayableParticipants=e=>!0}onInit(e){return o.log(c.LogTraceArea.CallingUI,"StageModeElementsManager: initializing participants"),this.updateParticipants(e)}updateParticipants(e){const t=a.filter(e,this._filterOutNonDisplayableParticipants),i=h.CallUIUtils.getOrderedByVideoPresenceParticipants(a.compact(t),this._callId);if(g.default.getS4LCMCFeatures().modernCallStage.enableVideoPrioritization){const e=s.default.newCauseId();this._updateVideoPriorityOrder(i,e)}const n=this._getStageParticipants(i),o=a.without(i,...n),r=this._getTrayParticipants(i,n);return{stageParticipants:n,trayParticipants:r,trayRemainder:o.length-r.length}}setTrayWidth(e,t){return this._trayWidth=e,this.updateParticipants(t)}_updateVideoPriorityOrder(e,t){if(!this._callId)return;const i=[n.default.getSkypeMri(),...e];u.default.CallingStore.setRemoteVideoPriorityOrder(this._callId,a.without(i,r.CallStageElementKeys.localUserKey),t)}_getTrayParticipants(e,t,i=!1,n=!1){const o=a.without(e,...t);return h.CallUIUtils.getOrderedDisplayedTrayParticipants(o,this._trayWidth,this._callId,i,n)}}var m;t.StageModeElementsManager=C,function(e){e[e.LargeGrid=0]="LargeGrid",e[e.TogetherMode=1]="TogetherMode"}(m=t.FullScreenBotType||(t.FullScreenBotType={}));t.GridModeElementsManager=class extends C{constructor(e,t,i,n,o){super(e,t),this._callId=e,this._trayWidth=t,this._stageCapacity=i,this._onlyVideoOnStage=n,this._showSelfInTheGrid=o,this._filterOutNonDisplayableParticipants=e=>!a.includes(l.default.getNonInteractiveInCallBotMris(),e)}updateStageCapacity(e,t){return o.log(c.LogTraceArea.CallingUI,"GridModeElementsManager.updateStageCapacity to "+t),this._stageCapacity=t,this.updateParticipants(e)}_getStageParticipants(e){if(g.default.getS4LCMCFeatures().enableCallParticipantsPinning&&p.default.hasPinnedParticipants(this._callId))return this._getParticipantsForPinningMode(e);let t=e;this._showSelfInTheGrid||(t=a.without(e,r.CallStageElementKeys.localUserKey));let i=t;return this._onlyVideoOnStage&&(i=a.filter(e,(e=>{var t;const i=null===(t=u.default.CallParticipantStore.getParticipantRenderInfo(e,this._callId))||void 0===t?void 0:t.videoStatus;return i===r.VideoStatus.Streaming||i===r.VideoStatus.Available}))),a.take(i,this._stageCapacity)}_getParticipantsForPinningMode(e){const t=a.intersection(e,p.default.getPinnedParticipants(this._callId));return a.take(t,this._stageCapacity)}_getTrayParticipants(e,t){const i=a.without(e,...t);return u.default.CallingStore.isOneOnOneCall(this._callId)&&a.remove(i,(e=>e===r.CallStageElementKeys.localUserKey)),h.CallUIUtils.getOrderedDisplayedTrayParticipants(i,this._trayWidth,this._callId)}};t.SpeakerModeElementsManager=class extends C{constructor(e,t){super(e,t),this._callId=e,this._trayWidth=t,this._filterOutNonDisplayableParticipants=e=>!a.includes(l.default.getNonInteractiveInCallBotMris(),e)&&!a.startsWith(e,d.ScreenSharingPrefix)}_getStageParticipants(e){const t=a.minBy(e,(e=>{var t;return null===(t=u.default.CallParticipantStore.getParticipantRenderInfo(e,this._callId))||void 0===t?void 0:t.activeSpeakerRank}));return t?[t]:[]}};t.PresentationModeElementsManager=class extends C{constructor(e,t){super(e,t),this._callId=e,this._trayWidth=t,this._filterOutNonDisplayableParticipants=e=>!a.includes(l.default.getNonInteractiveInCallBotMris(),e)}_getStageParticipants(e){const t=e.find((e=>a.startsWith(e,d.ScreenSharingPrefix))),i=[];return t&&i.push(t),i}_updateVideoPriorityOrder(e,t){if(!this._callId)return;const i=[...this._getStageParticipants(e),...e];super._updateVideoPriorityOrder(a.uniq(i),t)}_getTrayParticipants(e,t){return super._getTrayParticipants(e,t,!0,!0)}};t.LgTmModeElementsManager=class extends C{constructor(e,t,i){super(e,t),this._callId=e,this._trayWidth=t,this._botType=i,this._filterOutNonDisplayableParticipants=e=>{const t=this._getBotMrisToFilterOut();return!a.includes(l.default.getNonVisibleInCallBotMris(),e)&&!a.includes(t,e)&&!a.startsWith(e,d.ScreenSharingPrefix)}}_getStageParticipants(e){const t=this._getBotMris(),i=e.find((e=>a.includes(t,e))),n=[];return i&&n.push(i),n}_updateVideoPriorityOrder(e,t){if(!this._callId)return;const i=[...this._getStageParticipants(e),...e];super._updateVideoPriorityOrder(a.uniq(i),t)}_getBotMris(){switch(this._botType){case m.LargeGrid:return l.default.getCallGridViewBotMriFilter();case m.TogetherMode:return l.default.getCallAudienceBotMriFilter()}}_getBotMrisToFilterOut(){switch(this._botType){case m.LargeGrid:return l.default.getCallAudienceBotMriFilter();case m.TogetherMode:return l.default.getCallGridViewBotMriFilter()}}}},66123:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(89391),o=i(33754),s=i(11828),r=new Set(["Auditorium","AuditoriumDark","AuditoriumGold","Amphitheater","DiningRoom","ConferenceRoom","CoffeeShop","BigConferenceRoom","AbstractDark","Halo","Underwater","Classroom","Minecraft","HolidaySnow","HolidayCave","Restaurant","WinterLodge","KitchenDining","WarmSantorini","Dinner","Celebration","Outdoors","Crowd","TropicalSunset","PowerTogether","Airplane","Birthday"]);class l{static getTogetherModeBackgrounds(){const{backgrounds:e}=n.default.getS4LCMCFeatures().callAudienceBotConfig;return a.map(e,(e=>{const t=this._getTranslatedLabel(e);return{sceneId:e.sceneId,untranslatedName:e.name,label:t,url:e.thumbSrc,maxAudience:e.maxAudience}}))}static getTogetherModeBackgroundName(e){var t;return null===(t=l.getTogetherModeBackgrounds().find((t=>t.sceneId===e)))||void 0===t?void 0:t.untranslatedName}static getPanelId(){return"_togetherModeModalId"}static getBackgroundChangeButtonIcon(){return s.SkypeIcon.Picture}static _getTranslatedLabel(e){const t=e.humanFriendlyId;if(!r.has(t))return e.name;const i=`TogetherModeBackgroundNames.${t}`;return o.getString(i)}}t.default=l},13084:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(97691),n=i(89391),o=i(98925),s=i(22801),r=i(51077),l=i(91114),c=i(39549),d=i(82261),u=i(46096),h=i(36237),p=i(46929),g=i(85207),C=i(14976),m=i(4057);t.default=new class{_getTranslationToLocale(e){const t=(0,c.default)().getConversation(e);return t?t.getMessageTranslationLocale():void 0}disableTranslation(e,t){this._changeTranslationState(e,o.TranslationState.Disabled,o.TranslationState.Disabled,t),p.default.deleteTranslationBannerDismissStates(e),h.track(new l.ConversationTranslationAction(e,u.TranslationAction.Disabled,t,this._getTranslationToLocale(e)))}cancelTranslationRequest(e,t){this._changeTranslationState(e,o.TranslationState.Disabled,o.TranslationState.Cancelled,t),p.default.deleteTranslationBannerDismissStates(e),h.track(new l.ConversationTranslationAction(e,u.TranslationAction.Cancelled,t,this._getTranslationToLocale(e)))}declineTranslationRequest(e,t){this._changeTranslationState(e,o.TranslationState.Disabled,o.TranslationState.Declined,t),p.default.deleteTranslationBannerDismissStates(e),h.track(new l.ConversationTranslationAction(e,u.TranslationAction.Declined,t,this._getTranslationToLocale(e)))}requestTranslation(e,t){this._changeTranslationState(e,o.TranslationState.Requested,o.TranslationState.Pending,t),p.default.setInCallTranslationBannerDismissState(e,!1),p.default.setConversationTranslationBannerDismissState(e,!1),h.track(new l.ConversationTranslationAction(e,u.TranslationAction.Requested,t,this._getTranslationToLocale(e)))}acceptTranslation(e,t){this._changeTranslationState(e,o.TranslationState.Enabled,o.TranslationState.Enabled,t),h.track(new l.ConversationTranslationAction(e,u.TranslationAction.Accepted,t,this._getTranslationToLocale(e)))}_changeTranslationState(e,t,i,l){const c=n.default.getS4LCMCFeatures().enableOldMessageTranslation;h.log(u.LogTraceArea.Calling,"TranslationHelper._changeTranslationState conversationId: "+C.mriOrId(e)+" localTranslationState "+o.TranslationState[t]+" remoteTranslationState "+o.TranslationState[i]);const p=d.createTranslationSettingsMessage(e,u.PostSource.MessagePanel,l,i,!1);let S;c&&(S=d.createTranslationSettingsMessage(e,u.PostSource.MessagePanel,l,i,!1,r.MessageTypes.Data)),p?s.default.setTranslationState(e,t).then((()=>c&&S?g.default.postMessage(S):a.Resolved())).then((()=>g.default.postMessage(p))).catch((e=>{h.error(u.LogTraceArea.Calling,"TranslationHelper._changeTranslationState failed: "+m.default.errorAsString(e))})):h.error(u.LogTraceArea.Calling,"TranslationHelper._changeTranslationState failed to create translation settings message")}}},76543:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(2604),n=i(48540),o=i(89391),s=i(16568),r=i(52262),l=i(81736),c=i(36237),d=i(33754),u=i(46096),h=i(11828),p=i(78262),g=i(93486),C=i(71830),m=i(33004),S=i(68580),y=i(18078),f=i(9520),_=i(98925);class b{constructor(){this._endedCalls={},this._unknownReasonTimestamps=[]}test_reset(){this._endedCalls={},this._unknownReasonTimestamps=[]}reportUnansweredCallActionTaken(e,t,i,a){const n=this._endedCalls[e];n?(c.log(u.LogTraceArea.UnansweredCall,"Reporting UCUX action callId: "+n.callId+" reason: "+_.UnansweredCallReason[t]+" action: "+_.UnansweredCallAction[i]+" causeId: "+n.causeId),delete this._endedCalls[e],c.track(new f.UnansweredCallActionEvent(e,s.default.CallingNodeId.get(),n.terminatedReason,n.failureType,t,i))):c.warn(u.LogTraceArea.UnansweredCall,"Attempted to report result of UCUX for unknown callId: "+e+" causeId: "+a)}unansweredCallOptionsParticipant(e,t){const i=this._reasonForAddParticipantFailedInfo(e);if(i!==_.UnansweredCallReason.None)return{reason:i,actions:b._actionsForUnansweredCall(i,e.conversationMri,!1),title:d.getString("PstnUtils.UnableToAddParticipant"),optionalSecondaryMessage:b._titleForUnansweredCall(i,e.participantInfo.mri),originalCallId:e.callId,originalConversationMri:e.conversationMri,visualInfo:b._visualInfoForUnasnweredCall(i)};c.log(u.LogTraceArea.UnansweredCall,"Skipping UCUX in participant flow - callId: "+e.callId+" ParticipantStateReason: "+n.ParticipantStateReason[e.participantInfo.reason]+" causeId: "+t)}unansweredCallOptions(e,t){const i=t.lastEventReaction?m.default.parseCallEventReaction(t.lastEventReaction):void 0,a=(null==i?void 0:i.mri)===y.default.getSkypeMri()&&(null==i?void 0:i.eventType)===p.ReactionsTextType.CallEventKickedOutOwn;if((e.terminatedReason!==n.TerminatedReason.Kicked||a)&&!e.isCallCreator&&(e.terminatedReason!==n.TerminatedReason.CallSetupError||t.hasMicrophones))return void c.log(u.LogTraceArea.UnansweredCall,"Skipping UCUX - user is not call creator and TerminatedReason is NOT Kicked callId: "+e.callId+" causeId: "+e.causeId);if(t.isPreheatedAndNotJoined)return void c.log(u.LogTraceArea.UnansweredCall,"Skipping UCUX - was preheating callId: "+e.callId+" causeId: "+e.causeId);const o=this._reasonForCallEndedInfo(e,t);if(o!==_.UnansweredCallReason.None)return c.log(u.LogTraceArea.UnansweredCall,"Computed UCUX result callId: "+e.callId+" reason: "+_.UnansweredCallReason[o]+" causeId: "+e.causeId),this._endedCalls[e.callId]=e,{reason:o,actions:b._actionsForUnansweredCall(o,e.conversationMri,this._showSendFeedbackOption()),title:b._titleForUnansweredCall(o,e.conversationMri),originalCallId:e.callId,originalConversationMri:e.conversationMri,visualInfo:b._visualInfoForUnasnweredCall(o),optionalSecondaryMessage:b._secondaryMessageForUnansweredCall(o,t)};c.log(u.LogTraceArea.UnansweredCall,"Skipping UCUX - success callId: "+e.callId+" causeId: "+e.causeId)}kickCallOptions(e,t){const i=_.UnansweredCallReason.Kicked;return c.log(u.LogTraceArea.UnansweredCall,"Computed kick UCUX result callId: "+e.callId+" reason: "+_.UnansweredCallReason[i]+" causeId: "+e.causeId),this._endedCalls[e.callId]=e,{reason:i,actions:[{action:_.UnansweredCallAction.None}],title:b._titleForUnansweredCall(i,e.conversationMri,t),originalCallId:e.callId,originalConversationMri:e.conversationMri,visualInfo:b._visualInfoForUnasnweredCall(i,t)}}_resetUnknownReasonCounter(){this._unknownReasonTimestamps=[]}_incrementUnknownReasonCounter(e){this._unknownReasonTimestamps.push(e)}_showSendFeedbackOption(){const e=this._unknownReasonTimestamps.length;if(g.default.isChild()||e<3)return!1;const t=this._unknownReasonTimestamps.slice(e-3,e);return(t[2]-t[0])/1e3<=300}_reasonForAddParticipantFailedInfo(e){let t=_.UnansweredCallReason.None;switch(e.participantInfo.reason){case n.ParticipantStateReason.PstnSkypeoutAccountBlocked:t=_.UnansweredCallReason.PstnSkypeoutAccountBlocked;break;case n.ParticipantStateReason.PstnCouldNotConnectToSkypeProxy:t=_.UnansweredCallReason.PstnCouldNotConnectToSkypeProxy;break;case n.ParticipantStateReason.PstnBlockedByUs:t=_.UnansweredCallReason.PstnBlockedByUs;break;case n.ParticipantStateReason.PstnNumberForbidden:t=_.UnansweredCallReason.PstnNumberForbidden;break;case n.ParticipantStateReason.PstnCallTerminated:t=_.UnansweredCallReason.PstnCallTerminated;break;case n.ParticipantStateReason.PstnNumberUnavailable:t=_.UnansweredCallReason.PstnNumberUnavailable;break;case n.ParticipantStateReason.Declined:case n.ParticipantStateReason.Busy:t=_.UnansweredCallReason.DeclineParticipant;break;case n.ParticipantStateReason.PstnInsufficientFunds:case n.ParticipantStateReason.PstnNoSubscriptionCover:case n.ParticipantStateReason.PstnCreditExpired:case n.ParticipantStateReason.PstnCreditExpiredButEnough:t=_.UnansweredCallReason.InsufficientFunds;break;case n.ParticipantStateReason.PstnBlockedRegulatoryIndia:t=_.UnansweredCallReason.BlockedRegulatoryIndia;break;case n.ParticipantStateReason.PstnInvalidNumber:t=_.UnansweredCallReason.InvalidNumber}return S.default.isPstnNetherlandsReason(e.participantInfo.callEndDiagnosticsInfo)&&(t=_.UnansweredCallReason.BlockedRegulatoryNetherlands),t}_reasonForCallEndedInfo(e,t){const i=e.failureType===n.FailureType.CallSetupFailed||0===e.durationSeconds&&e.failureType!==n.FailureType.CallDropped,o=(Date.now()-t.callCreationTime)/1e3;let s=_.UnansweredCallReason.Unknown;switch(e.terminatedReason){case n.TerminatedReason.Success:s=C.isThread(e.conversationMri)&&0===t.maxConnectedParticipants?_.UnansweredCallReason.NoAnswer:_.UnansweredCallReason.None;break;case n.TerminatedReason.Cancelled:s=o>15?_.UnansweredCallReason.NoAnswer:_.UnansweredCallReason.None;break;case n.TerminatedReason.NoNgcEndpoint:case n.TerminatedReason.NoSignalingFromPeer:case n.TerminatedReason.TemporarilyUnavailable:s=_.UnansweredCallReason.Unreachable;break;case n.TerminatedReason.NetworkError:case n.TerminatedReason.MediaDroppedError:case n.TerminatedReason.LocalHttpStackError:case n.TerminatedReason.NetworkRequestTimeoutError:case n.TerminatedReason.CannotConnectToNetworkError:case n.TerminatedReason.CallSetupError:case n.TerminatedReason.MediaRelayWhiteListingIssue:s=e.terminatedReason!==n.TerminatedReason.CallSetupError||t.hasMicrophones?i?_.UnansweredCallReason.LocalNetworkError:_.UnansweredCallReason.None:_.UnansweredCallReason.NoMicrophoneDetected;break;case n.TerminatedReason.PstnSkypeoutAccountBlocked:s=_.UnansweredCallReason.PstnSkypeoutAccountBlocked;break;case n.TerminatedReason.PstnCouldNotConnectToSkypeProxy:s=_.UnansweredCallReason.PstnCouldNotConnectToSkypeProxy;break;case n.TerminatedReason.PstnBlockedByUs:s=_.UnansweredCallReason.PstnBlockedByUs;break;case n.TerminatedReason.PstnNumberForbidden:s=_.UnansweredCallReason.PstnNumberForbidden;break;case n.TerminatedReason.PstnCallTerminated:s=_.UnansweredCallReason.PstnCallTerminated;break;case n.TerminatedReason.PstnNumberUnavailable:s=_.UnansweredCallReason.PstnNumberUnavailable;break;case n.TerminatedReason.NoPermission:const r=l.default.permissionStatus(p.PermissionType.Microphone)===a.PermissionStatus.Granted,d=l.default.permissionStatus(p.PermissionType.Camera)===a.PermissionStatus.Granted;if(!e.withVideo||r||d)if(r)if(d){const e="TerminatedReason.NoPermission, yet cannot identify what permissions are lacking";c.error(u.LogTraceArea.UnansweredCall,e)}else{const e="Never show 'CameraPermissionDenied' if 'withVideo' is false";c.error(u.LogTraceArea.UnansweredCall,e),s=_.UnansweredCallReason.CameraPermissionDenied}else s=_.UnansweredCallReason.MicrophonePermissionDenied;else s=_.UnansweredCallReason.MicAndCamPermissionDenied;break;case n.TerminatedReason.Missed:s=_.UnansweredCallReason.NoAnswer;break;case n.TerminatedReason.Declined:case n.TerminatedReason.Busy:s=_.UnansweredCallReason.Decline;break;case n.TerminatedReason.PstnInvalidNumber:s=_.UnansweredCallReason.InvalidNumber;break;case n.TerminatedReason.PstnEmergencyCallDenied:s=_.UnansweredCallReason.EmergencyCallDenied;break;case n.TerminatedReason.Kicked:s=_.UnansweredCallReason.Kicked;break;case n.TerminatedReason.PstnInsufficientFunds:case n.TerminatedReason.PstnNoSubscriptionCover:case n.TerminatedReason.PstnCreditExpired:case n.TerminatedReason.PstnCreditExpiredButEnough:s=_.UnansweredCallReason.InsufficientFunds;break;case n.TerminatedReason.PstnBlockedRegulatoryIndia:s=_.UnansweredCallReason.BlockedRegulatoryIndia;break;case n.TerminatedReason.Undefined:s=_.UnansweredCallReason.None}return i||(s=_.UnansweredCallReason.None),s===_.UnansweredCallReason.Unknown?this._incrementUnknownReasonCounter(t.callCreationTime):this._resetUnknownReasonCounter(),s}static _secondaryMessageForUnansweredCall(e,t){if(e===_.UnansweredCallReason.NoMicrophoneDetected)return d.getString("UnansweredCallTitle.NoMicDetectedMessage")}static _titleForUnansweredCall(e,t,i){const a=r.default.getShortDisplayName(t)||d.getString("UnansweredCallTitle.UnknownCallee");switch(e){case _.UnansweredCallReason.NoAnswer:case _.UnansweredCallReason.Decline:return C.isGroupConversation(t)?d.getString("UnansweredCallTitle.NoAnswerGroup"):d.getString("UnansweredCallTitle.Decline",{name:a});case _.UnansweredCallReason.DeclineParticipant:return d.getString("UnansweredCallTitle.Decline",{name:a});case _.UnansweredCallReason.Unreachable:return d.getString("UnansweredCallTitle.Unreachable",{name:a});case _.UnansweredCallReason.LocalNetworkError:return d.getString("UnansweredCallTitle.NetworkError");case _.UnansweredCallReason.MicrophonePermissionDenied:return d.getString("UnansweredCallTitle.NoMicrophonePermission");case _.UnansweredCallReason.CameraPermissionDenied:return d.getString("UnansweredCallTitle.NoCameraPermission");case _.UnansweredCallReason.MicAndCamPermissionDenied:return d.getString("UnansweredCallTitle.NoMicAndCamPermission");case _.UnansweredCallReason.Kicked:{const e=this._getKickedPrimaryMessage(i);return e||d.getString("CallControls.RemovedFromCallMessage")}case _.UnansweredCallReason.NoMicrophoneDetected:return d.getString("UnansweredCallTitle.NoMicDetected");case _.UnansweredCallReason.EmergencyCallDenied:return d.getString("PstnUtils.EmergencyCallDenied");case _.UnansweredCallReason.BlockedRegulatoryIndia:return d.getString("PstnUtils.BlockedRegulatoryIndia");case _.UnansweredCallReason.BlockedRegulatoryNetherlands:return d.getString("PstnUtils.BlockedRegulatoryNetherlands");case _.UnansweredCallReason.PstnBlockedByUs:return d.getString("PstnUtils.BlockedByUs");case _.UnansweredCallReason.PstnSkypeoutAccountBlocked:return d.getString("PstnUtils.SkypeoutAccountBlocked");case _.UnansweredCallReason.PstnCouldNotConnectToSkypeProxy:return d.getString("PstnUtils.CouldNotConnectToSkypeProxy");case _.UnansweredCallReason.PstnNumberForbidden:return d.getString("PstnUtils.NumberForbidden");case _.UnansweredCallReason.PstnCallTerminated:return d.getString("PstnUtils.CallTerminated");case _.UnansweredCallReason.PstnNumberUnavailable:return d.getString("PstnUtils.NumberUnavailable");case _.UnansweredCallReason.InvalidNumber:return d.getString("PstnUtils.InvalidNumber");case _.UnansweredCallReason.Unknown:return d.getString("UnansweredCallTitle.OtherError");case _.UnansweredCallReason.TransferedToTwinCam:return d.getString("CallControls.RemovedFromCallByTwinCam")}return d.getString("UnansweredCallTitle.OtherError")}static _actionsForUnansweredCall(e,t,i){switch(e){case _.UnansweredCallReason.NoAnswer:case _.UnansweredCallReason.Unreachable:return[{action:_.UnansweredCallAction.SendMessage,prepopulatedMessage:b._chatMessagesForReason(e,t)},{action:_.UnansweredCallAction.CallPSTN}];case _.UnansweredCallReason.Decline:return[{action:_.UnansweredCallAction.SendMessage,prepopulatedMessage:b._chatMessagesForReason(e,t)}];case _.UnansweredCallReason.LocalNetworkError:return[{action:_.UnansweredCallAction.SendMessage}];case _.UnansweredCallReason.Kicked:return[{action:_.UnansweredCallAction.None}];case _.UnansweredCallReason.Unknown:const a=[{action:_.UnansweredCallAction.SendMessage,message:""}];return i?a.concat({action:_.UnansweredCallAction.SendFeedback,message:d.getString("FeedbackMechanism.FeedbackDialogTitle")}):a;case _.UnansweredCallReason.MicrophonePermissionDenied:case _.UnansweredCallReason.CameraPermissionDenied:case _.UnansweredCallReason.MicAndCamPermissionDenied:return[{action:_.UnansweredCallAction.PromptForPermission}];case _.UnansweredCallReason.BlockedRegulatoryIndia:return[{action:_.UnansweredCallAction.ShowRegulatoryInfoIndia}];case _.UnansweredCallReason.BlockedRegulatoryNetherlands:return[{action:_.UnansweredCallAction.ShowRegulatoryInfoNetherlands}]}return[]}static _chatMessagesForReason(e,t){if(!C.isThread(t))switch(e){case _.UnansweredCallReason.NoAnswer:case _.UnansweredCallReason.Decline:return d.getString("UnansweredCallChatMessages.CallMeBack")}}static _visualInfoForUnasnweredCall(e,t){switch(e){case _.UnansweredCallReason.Decline:case _.UnansweredCallReason.NoAnswer:case _.UnansweredCallReason.Unreachable:return{type:_.UnansweredCallVisualInfoType.Emoticon,name:"call"};case _.UnansweredCallReason.Kicked:case _.UnansweredCallReason.Unknown:if(t){const e=m.default.parseCallEventReaction(t);if(e&&e.eventType===p.ReactionsTextType.CallEventTransfer)return{type:_.UnansweredCallVisualInfoType.Emoticon,name:"yes"}}return{type:_.UnansweredCallVisualInfoType.Emoticon,name:"cry"};case _.UnansweredCallReason.NoMicrophoneDetected:return{type:_.UnansweredCallVisualInfoType.Icon,name:h.SkypeIcon.MicrophoneOff};case _.UnansweredCallReason.LocalNetworkError:return{type:_.UnansweredCallVisualInfoType.Icon,name:h.SkypeIcon.CallQualityIndicator};case _.UnansweredCallReason.MicAndCamPermissionDenied:case _.UnansweredCallReason.MicrophonePermissionDenied:return{type:_.UnansweredCallVisualInfoType.Icon,name:h.SkypeIcon.MicrophoneOff};case _.UnansweredCallReason.CameraPermissionDenied:return{type:_.UnansweredCallVisualInfoType.Icon,name:h.SkypeIcon.VideoOff};case _.UnansweredCallReason.EmergencyCallDenied:case _.UnansweredCallReason.BlockedRegulatoryIndia:case _.UnansweredCallReason.BlockedRegulatoryNetherlands:return{type:_.UnansweredCallVisualInfoType.Icon,name:h.SkypeIcon.CallBlockedFilled};case _.UnansweredCallReason.PstnBlockedByUs:case _.UnansweredCallReason.PstnCallTerminated:case _.UnansweredCallReason.PstnCouldNotConnectToSkypeProxy:case _.UnansweredCallReason.PstnNumberForbidden:case _.UnansweredCallReason.PstnNumberUnavailable:case _.UnansweredCallReason.PstnSkypeoutAccountBlocked:case _.UnansweredCallReason.InvalidNumber:return{type:_.UnansweredCallVisualInfoType.Icon,name:h.SkypeIcon.CallErrorFilled};case _.UnansweredCallReason.None:return}}static _getKickedPrimaryMessage(e){if(!o.default.getS4LCMCFeaturesNoSubscription().enableNotifyUsersMuteKick)return;if(!e||!m.default.isCallEventReaction(e))return;const t=m.default.parseCallEventReaction(e);if(!t)return;const i=b._getUserName(t.mri);return t.eventType===p.ReactionsTextType.CallEventTransfer?d.getString("CallControls.RemovedFromCallByTwinCam"):d.getString("CallControls.RemovedFromCallMessageWithName",{name:i})}static _getUserName(e){const t=C.sanitizeMri(e,C.Namespaces.SkypeId);return r.default.getDisplayName(t)||d.getString("Notifications.UnknownUserShort")}}const T=new b;t.default=T},69309:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(97691),o=i(89391),s=i(51077),r=i(71830),l=i(62141),c=i(46096),d=i(97811),u=i(17379),h=i(36237),p=i(22538),g=i(4057),C="CallCaptionsCleanupStarted",m="CallCaptionsCleanupFailure";t.default=new class{constructor(){this._isCleanupInProgress=!1,this._doCallCaptionsCleanup=()=>(u.default.queueIdleTask("Scheduling call captions cleanup",u.TaskTypeFlags.CpuIntensive|u.TaskTypeFlags.UsesNetworking,(()=>{try{return o.default.getS4LCMCFeaturesNoSubscription().isCallCaptionsCleanupEnabled?l.default.getLastCallCaptionsCleanupTimestamp().then(this._isCallCaptionsCleanupRequired).then(this._cleanupCallCaptions).catch((e=>{h.track(new d.FundamentalsDebugEvent(m,"FailureInPromise")),this._logError("Call captions cleanup failed. Error: "+g.default.errorAsString(e))})):(this._logInfo("Call captions cleanup disabled."),n.Resolved())}catch(e){return h.track(new d.FundamentalsDebugEvent(m,"FailureInWrapperCatch")),this._logError("Call captions cleanup failed. Error: "+g.default.errorAsString(e)),n.Rejected()}})),n.Resolved()),this._isCallCaptionsCleanupRequired=e=>{if(this._isCleanupInProgress)return!1;if(!e)return h.track(new d.FundamentalsDebugEvent(C,"FirstRun")),this._logInfo("Call captions cleanup not yet done."),!0;return!!(e<this._parseCleanupValidTimestamp())&&(h.track(new d.FundamentalsDebugEvent(C,"Expired")),this._logInfo("Call captions cleanup expired. Need for another cleanup."),!0)},this._parseCleanupValidTimestamp=()=>{const e=o.default.getS4LCMCFeaturesNoSubscription().callCaptionsCleanupValidDate;let t=Date.parse(e);return isNaN(t)?0:t},this._cleanupCallCaptions=e=>e?(this._isCleanupInProgress=!0,n.all([this._setCaptionsCleanupStartTimestamp(),this._processCaptionsCleanup(),this._processConversationCleanup()]).then(this._completeCleanup)):(this._logInfo("Call captions - cleanup valid. No need for another cleanup."),n.Resolved()),this._setCaptionsCleanupStartTimestamp=()=>l.default.openTransaction([l.Stores.InternalData],!0).then((e=>e.getCallCaptionsCleanupStartTimestamp().then((t=>t?n.Resolved():e.setCallCaptionsCleanupStartTimestamp())).then((()=>e.markCompleted()),(e=>{this._logError(`Call captions - Set startTimestamp failed. Error: ${g.default.errorAsString(e)}`)})))),this._processCaptionsCleanup=()=>{const e=n.Defer(),t=o.default.getS4LCMCFeaturesNoSubscription().callCaptionsCleanupBatchSize;return this._cleanMessageCaptionsAsync(e,0,t),e.promise()},this._cleanMessageCaptionsAsync=(e,t,i)=>{u.default.queueIdleTask("Clean Messages startIndex: "+t,u.TaskTypeFlags.CpuIntensive|u.TaskTypeFlags.UsesNetworking,(()=>{l.default.getAllMessages(i,t).then((n=>{if(0===n.length)return this._logInfo("Call captions - cleanup finished"),void e.resolve();const o=this._filterCallCaptionMessageType(n);if(a.isEmpty(o)){const a=t+i;this._logInfo(`Call captions - 0 to delete. Moving offset to ${a}`),this._cleanMessageCaptionsAsync(e,a,i)}else this._removeCaptions(o).then((()=>{let a=t+(i-o.length);a<0&&(a=0),this._logInfo(`Call captions - ${o.length} deleted. Moving offset to ${a}`),this._cleanMessageCaptionsAsync(e,a,i)}))}))}))},this._processConversationCleanup=()=>{const e=n.Defer(),t=o.default.getS4LCMCFeaturesNoSubscription().callCaptionsCleanupBatchSize;return this._cleanConversationsAsync(e,0,t),e.promise()},this._cleanConversationsAsync=(e,t,i)=>{l.default.getAllConversationMetas(i,t).then((n=>{if(0===n.length)return this._logInfo("Conversations - lastMessage captions cleanup finished."),void e.resolve();u.default.queueIdleTask("Clean conversation last message startIndex: "+t,u.TaskTypeFlags.CpuIntensive|u.TaskTypeFlags.UsesNetworking,(()=>{const o=this._filterCallCaptionConversationType(n);a.isEmpty(o)?this._cleanConversationNext(e,t,i,0):this._cleanConversationsLastMessage(o).then((()=>{this._cleanConversationNext(e,t,i,o.length)}))}))}))},this._filterCallCaptionMessageType=e=>{const t=a.filter(e,(e=>s.isCaptionMessageType(e.messagetype)));return this._logInfo("Call captions - filtering captions message type. Found "+t.length+" captions."),t},this._filterCallCaptionConversationType=e=>{const t=a.filter(e,(e=>(0,r.isReactionsThread)(e.conv.id)&&!!e.conv.lastMessage&&s.isCaptionMessageType(e.conv.lastMessage.messagetype)));return this._logInfo(`Conversations - filtering caption conversation type. Found ${t.length} captions conversations.`),t},this._removeCaptions=e=>l.default.openTransaction([l.Stores.Messages],!0).then((t=>t.removeMessages(e).then((()=>{t.markCompleted(),this._logInfo("Call captions - remove batch finished.")}),(e=>(this._logError(`Call captions - remove batch failed. Error: ${g.default.errorAsString(e)}`),n.Rejected(e)))))),this._cleanConversationsLastMessage=e=>(e=a.map(e,(e=>e.updateConversation(e.conv.dropLastMessage()))),l.default.openTransaction([l.Stores.Conversations],!0).then((t=>t.putConversationMetas(e).then((()=>{t.markCompleted(),this._logInfo("Conversations - update batch finished.")}),(e=>(this._logError(`Conversations - update batch failed. Error: ${g.default.errorAsString(e)}`),n.Rejected(e))))))),this._completeCleanup=()=>l.default.openTransaction([l.Stores.InternalData],!0).then((e=>e.getCallCaptionsCleanupStartTimestamp().then((e=>{if(e){const t=Date.now()-e;h.track(new d.FundamentalsDebugEvent("CallCaptionsCleanupTime",t.toString())),this._logInfo(`Captions and conversations cleanup execution time: ${t}ms.`)}})).then((()=>e.deleteCallCaptionsCleanupStartTimestamp())).then((()=>e.setCallCaptionsCleanupEndTimestamp())).then((()=>{this._isCleanupInProgress=!1,e.markCompleted(),this._logInfo("Captions and conversations cleanup finished.")}),(e=>(this._logError(`Captions and conversations cleanup failed. Error: ${g.default.errorAsString(e)}`),n.Rejected(e)))))),this._logInfo=e=>{h.log(c.LogTraceArea.GenericUnsafe,`[CaptionsCleanup] ${e}`)},this._logError=e=>{h.error(c.LogTraceArea.GenericUnsafe,`[CaptionsCleanup] ${e}`)},this.test_doCallCaptionsCleanup=()=>this._doCallCaptionsCleanup(),p.RegisterStartupable(this,"CallCaptionsCleanupService")}startup(){return o.default.subscribe(this._doCallCaptionsCleanup),this._doCallCaptionsCleanup(),n.Resolved()}_cleanConversationNext(e,t,i,a){const n=t+i;this._logInfo(`Conversations - ${a} updated. Moving offset to ${n}`),this._cleanConversationsAsync(e,n,i)}}},3986:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(28107),o=i(97691),s=i(89391),r=i(94224),l=i(71830),c=i(98278),d=i(51129),u=i(46096),h=i(36237),p=i(4329),g=i(4735),C=i(27683),m=i(89871),S=i(22538),y=i(4057),f=i(53374),_="tel:";t.default=new class{constructor(){this._processIntentEvent=e=>{const t=f.default.newCauseId();h.log(u.LogTraceArea.DialerPanel,`CallIntentService._processIntentEvent eventType=${e.type} causeId: ${t}`),e.number&&a.startsWith(e.number,_)&&(e.number=e.number.replace(_,""));const i=e.number&&y.default.safeDecodeURIComponent(e.number),o=C.default.isPossiblyPhoneNumber(i)?e.number:void 0;if(e.type===n.IntentEventType.contactMessage&&e.skypeId){const i=l.sanitizeMri(e.skypeId,l.Namespaces.SkypeId);g.default.navigateToConversation({convId:i,causeId:t,origin:u.NavigationConversationOrigin.NativeContactIntent})}else if(e.type!==n.IntentEventType.contactAudio&&e.type!==n.IntentEventType.contactVideo||!e.skypeId)if(e.type===n.IntentEventType.contactPhone&&i&&o&&(d.default.isE164Format(i)||s.default.getS4LCommerceFeatures().callIntent.allowNonE164NumberCalls)){m.default.initializeCountrySelection(),m.default.overwritePhoneNumberInput(o,!1);const e=m.default.getPhoneNumber(m.TriggerKeys.E164),i=l.sanitizeMri(e.E164,l.Namespaces.PSTN);r.default.CallNavigationHelper.startCall({conversationMri:i,withVideo:!1,origin:u.NavigationCallOrigin.NativeContactIntent},t)}else g.default.navigateToPSTNDialerWithParams({causeId:t,navigationSource:u.DialerNavigationSource.CallIntent,prefilledNumber:o},c.MainRootViewId);else{const i=l.sanitizeMri(e.skypeId,l.Namespaces.SkypeId);r.default.CallNavigationHelper.startCall({conversationMri:i,withVideo:"contactVideo"===e.type,origin:u.NavigationCallOrigin.NativeContactIntent},t)}},S.RegisterStartupable(this,"CallIntentService"),p.default.registerForLogout(this,"CallIntentService")}startup(){return n.default.setListener(this._processIntentEvent),o.Resolved()}test_processIntentEvent(e){this._processIntentEvent(e)}logout(e,t,i){return n.default.removeListener(),o.Resolved()}}},62859:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(16778),o=i(97691),s=i(60),r=i(89391),l=i(23842),c=i(3493),d=i(71830),u=i(62141),h=i(39549),p=i(16402),g=i(68894),C=i(46096),m=i(46096),S=i(57347),y=i(72685),f=i(36237),_=i(98754),b=i(61253),T=i(46929),v=i(18078),w=i(77532),I=i(32514),P=i(22538),M=i(4057),k=i(72758),A=i(53374);t.default=new class{constructor(){this._cachedUserProfilesDict={},this._didShowNotification=!1,this._didIdentifyDifferentTopContacts=!1,this._topContactsWithBirthday=[],this._activationStateChangedSubscribeCallback=()=>{const e=n.App.getActivationState()===n.Types.AppActivationState.Active;this._isAppActive!==e&&(f.log(C.LogTraceArea.Engagement,"Active state changed to "+n.Types.AppActivationState[n.App.getActivationState()]),this._isAppActive=e,this._appConfigStoreSubscribeCallback())},this._appConfigStoreSubscribeCallback=()=>{this._initServiceConfig(),this._isFeatureEnabled?this._usersStoreSubscriptionToken||(this._usersStoreSubscriptionToken=k.default.subscribe((e=>{this._tryCreateBirthdayNotification(e)})),f.log(C.LogTraceArea.Engagement,"Subscribed to UsersStore, _usersStoreSubscriptionToken: "+(this._usersStoreSubscriptionToken?"1":"0"))):(f.log(C.LogTraceArea.Engagement,"CelebrationNotificationService disabled. Disabling subscriptions"),this._usersStoreSubscriptionToken&&(k.default.unsubscribe(this._usersStoreSubscriptionToken),this._usersStoreSubscriptionToken=void 0))},this._tryCreateBirthdayNotification=e=>{if(!this._isFeatureEnabled)return f.log(C.LogTraceArea.Engagement,"Birthday notification feature is not enabled. Skipping scheduling"),o.Resolved();if(this._didShowNotification)return f.log(C.LogTraceArea.Engagement,"Birthday notification already created. Skipping scheduling"),o.Resolved();let t;const i=this._getAllContactsMrisEnabled?this.getAllContacts():this.getFavoriteAndSuggestedContacts();return t=e?a.intersection(e,a.keys(this._cachedUserProfilesDict)):i.favoriteContactsMris.concat(i.nonFavoriteSuggestedContactsMris),this.fetchUserProfiles(t).then((()=>{const e=this.getTopContactMrisWithBirthdaysToday(i);if(a.isUndefined(this._topContactsWithBirthday)||this._topContactsWithBirthday.length<=0)return f.log(C.LogTraceArea.Engagement,"Identified contacts with birthday during first run. Scheduling birthday notification"),this.maybeCreateBirthdayLocalEngagementNotification(e);const t=e[0],n=this._topContactsWithBirthday[0];return t&&t!==n?(f.log(C.LogTraceArea.Engagement,"Identified new contacts with birthday. Scheduling birthday notification"),this.maybeCreateBirthdayLocalEngagementNotification(e)):o.Resolved()}))},P.RegisterStartupable(this,"CelebrationNotificationService",[h.default,y.default,_.default,T.default,k.default,w.default])}startup(){return this._initAppStateConfig(),this._appStateSubscription=s.default.subscribeForChanges("CelebrationNotificationService",this._activationStateChangedSubscribeCallback),this._appConfigStoreSubscription=r.default.subscribe(this._appConfigStoreSubscribeCallback),this._appConfigStoreSubscribeCallback(),y.default.setRefreshOptions("CelebrationNotification",{interval:this._refreshTime,taskTypeFlags:y.TaskTypeFlags.UsesNetworking,callback:()=>this._tryCreateBirthdayNotification()}),this._isFeatureEnabled&&S.default.queueIdleTask("CelebrationNotificationService",y.TaskTypeFlags.CpuIntensive,this._tryCreateBirthdayNotification),o.Resolved()}logout(e,t,i){return f.log(C.LogTraceArea.Engagement,"Logout action triggered for CelebrationNotificationService"),this._usersStoreSubscriptionToken&&(k.default.unsubscribe(this._usersStoreSubscriptionToken),this._usersStoreSubscriptionToken=void 0),this._searchStore&&(this._searchStore.destroy(),this._searchStore=void 0),this._didShowNotification=!1,this._topContactsWithBirthday=[],a.each(this._cachedUserProfilesDict,((e,t)=>{e&&delete this._cachedUserProfilesDict[t]})),f.log(C.LogTraceArea.Engagement,"Cleared local cache of user profiles in CelebrationNotificationService"),o.Resolved()}_initAppStateConfig(){this._isAppActive=n.App.getActivationState()===n.Types.AppActivationState.Active}_initServiceConfig(){const e=r.default.getEngagementFeatures().engagementCelebrationNotificationSetting,t=r.default.getSkypeEngagementFeatures().birthdayContent;f.log(C.LogTraceArea.Engagement,"initServiceConfig callback executed, given featureSettings: "+JSON.stringify(e)+"given birthdayContent: "+JSON.stringify(t)),this._campaignId=t.campaignId,this._variantId=t.variantId,this._isFeatureEnabled=e.enabled,this._refreshTime=e.refreshTime,this._celebrationNotificationsTopContactCutOff=e.celebrationNotificationsTopContactCutOff,this._isThrottlingOnRoamingSettingsEnabled=e.isThrottlingOnRoamingSettingsEnabled,this._isThrottlingOnLocalSettingsEnabled=e.isThrottlingOnLocalSettingsEnabled,this._isContactCutOffEnabled=e.isContactCutOffEnabled,this._getAllContactsMrisEnabled=e.getAllContactsMrisEnabled,this._isDiscardingOnAppActiveEnabled=e.isDiscardingOnAppActiveEnabled}_doesMriHaveBirthdayToday(e){const t=this._cachedUserProfilesDict[e];return t&&c.default.isTodayBirthdayForParticipantProfile(t)}_getSearchStore(){if(!this._searchStore){this._searchStore=new I.default;const e={rawQuery:"",trimmedNormalizedQuery:"",userMriToExclude:[v.default.getSkypeMri()],excludeBots:!0,onlyGroupCapable:!1,onlyCallCapable:!0,includeBlocked:!1,excludeNonManuallyAdded:!0};this._searchStore.updateConfig(e,[m.SearchResultsListGroup.FavoriteContacts,m.SearchResultsListGroup.SuggestedFrequentConversations,m.SearchResultsListGroup.AddressBook])}return this._searchStore}getAllContacts(){if(f.log(C.LogTraceArea.Engagement,"Will try to fetch all contacts"),this._searchStore=this._getSearchStore(),!this._searchStore)return f.log(C.LogTraceArea.Engagement,"Birthday notification search store did not initialize. Returning empty list of contact MRIs"),{favoriteContactsMris:[],nonFavoriteSuggestedContactsMris:[]};let e=this._celebrationNotificationsTopContactCutOff;const t=a.filter(this._searchStore.getCombinedContactsWithoutAddressBookAndShortCircuit(),(t=>{if(!t.skypeContact)return!1;const i=t.skypeContact.getMri();return!!i&&(this._isContactCutOffEnabled&&d.isOneOnOneConversation(i)?(e--,e>=0):d.isOneOnOneConversation(i))})),i=a.map(t,(e=>{if(e.skypeContact)return e.skypeContact.getMri()}));return this._isContactCutOffEnabled&&0===e&&(f.log(C.LogTraceArea.Engagement,"Birthday notification contact cutoff reached. Returning empty list of contact MRIs"),f.track(new l.CelebrationNotificationTelemetryEvent({action:l.CelebrationNotificationTelemetryEventAction.ContactCutOffLimitReached,numberOfTopContacts:this._celebrationNotificationsTopContactCutOff,didIdentifyDifferentTopContacts:this._didIdentifyDifferentTopContacts,cardGuid:this._variantId,cardCampaignId:this._campaignId}))),{favoriteContactsMris:i,nonFavoriteSuggestedContactsMris:[]}}getFavoriteAndSuggestedContacts(){if(f.log(C.LogTraceArea.Engagement,"Will try to fetch favorite and suggested contacts"),this._searchStore=this._getSearchStore(),!this._searchStore)return f.log(C.LogTraceArea.Engagement,"Birthday notification search store did not initialize. Returning empty list of favorite and nonFavorite contact MRIs"),{favoriteContactsMris:[],nonFavoriteSuggestedContactsMris:[]};let e=this._celebrationNotificationsTopContactCutOff;const t=a.filter(this._searchStore.getFavoriteContactsResults(),(t=>this._isContactCutOffEnabled&&d.isOneOnOneConversation(t)?(e--,e>=0):d.isOneOnOneConversation(t)));if(this._isContactCutOffEnabled&&0===e)return f.log(C.LogTraceArea.Engagement,"Birthday notification contact cutoff reached. Returning empty list of nonFavorite contact MRIs"),f.track(new l.CelebrationNotificationTelemetryEvent({action:l.CelebrationNotificationTelemetryEventAction.ContactCutOffLimitReached,numberOfTopContacts:this._celebrationNotificationsTopContactCutOff,didIdentifyDifferentTopContacts:this._didIdentifyDifferentTopContacts,cardGuid:this._variantId,cardCampaignId:this._campaignId})),{favoriteContactsMris:t,nonFavoriteSuggestedContactsMris:[]};let i=[];return i=a.filter(this._searchStore.getSuggestedContactsAndConversationsResults(m.SearchResultsListGroup.SuggestedFrequentConversations),(e=>d.isOneOnOneConversation(e))),i=a.difference(i,t),i=i.splice(e-1,i.length-e),{favoriteContactsMris:t,nonFavoriteSuggestedContactsMris:i}}fetchUserProfiles(e){return f.log(C.LogTraceArea.Engagement,"Starting to fetch user profiles for specified MRIs"),k.default.getFullUserProfileByMrisAsync(e).then((e=>{a.each(e,(e=>{this._cachedUserProfilesDict[e.mri]&&delete this._cachedUserProfilesDict[e.mri],this._cachedUserProfilesDict[e.mri]=e})),f.log(C.LogTraceArea.Engagement,"Finished fetching user profiles for specified MRIs")}))}getTopContactMrisWithBirthdaysToday(e){const t=e.favoriteContactsMris,i=e.nonFavoriteSuggestedContactsMris;let n=a.filter(t,(e=>this._doesMriHaveBirthdayToday(e)));const o=a.filter(i,(e=>this._doesMriHaveBirthdayToday(e)));return n.sort(((e,t)=>this._compareTwoContacts(e,t))),o.sort(((e,t)=>this._compareTwoContacts(e,t))),n=n.concat(o),n}maybeCreateBirthdayLocalEngagementNotification(e){const t=this._getCelebrationNotificationLastShownTime(this._isThrottlingOnLocalSettingsEnabled,this._isThrottlingOnRoamingSettingsEnabled);return this._didIdentifyDifferentTopContacts=!1,this._didShowNotification=!this._wasTimeBeforeToday(t),this._didShowNotification?(f.log(C.LogTraceArea.Engagement,"Birthday notification already created since: "+t+". Skipping scheduling"),f.track(new l.CelebrationNotificationTelemetryEvent({action:l.CelebrationNotificationTelemetryEventAction.NotificationAlreadyShown,numberOfTopContacts:e.length,didIdentifyDifferentTopContacts:this._didIdentifyDifferentTopContacts,cardGuid:this._variantId,cardCampaignId:this._campaignId})),o.Resolved()):(this._didIdentifyDifferentTopContacts=!(0,b.default)(this._topContactsWithBirthday,e),this._topContactsWithBirthday=e,f.log(C.LogTraceArea.Engagement,"Birthday notification will now be created"),this._createLocalBirthdayEngagementNotificationWithTopContacts(this._topContactsWithBirthday).always((e=>e?(this._didShowNotification=!0,f.log(C.LogTraceArea.Engagement,"Birthday notification created successfully"),this._setCelebrationNotificationLastShownTime(Date.now())):(f.log(C.LogTraceArea.Engagement,"Birthday notification not created"),o.Resolved()))))}_createLocalBirthdayEngagementNotificationWithTopContacts(e){if(0===e.length)return f.log(C.LogTraceArea.Notifications,"Ignoring celebration notification because topContacts list is empty."),o.Resolved(!1);const t=e[0],i=k.default.getFullUserProfileByMri(t).getSkypeId();if(!this._cachedUserProfilesDict[t])return f.log(C.LogTraceArea.Notifications,"Ignoring celebration notification because of incomplete user profile."),f.track(new l.CelebrationNotificationTelemetryEvent({action:l.CelebrationNotificationTelemetryEventAction.SelectedTopContactUserProfileIncomplete,numberOfTopContacts:this._topContactsWithBirthday.length,didIdentifyDifferentTopContacts:this._didIdentifyDifferentTopContacts,cardGuid:this._variantId,cardCampaignId:this._campaignId,celebratedUserSkypeId:i})),o.Resolved(!1);if(this._isDiscardingOnAppActiveEnabled&&!this._isAppActive)return f.log(C.LogTraceArea.Notifications,"Ignoring celebration notification because app is not active."),o.Resolved(!1);const a={content:{skypeId:i}};return w.default.openCampaign(this._campaignId,this._variantId,g.EngagementType.PopCard,A.default.newGuid(),a).then((()=>(f.log(C.LogTraceArea.Notifications,"Created celebration popcard notification with campaignId : "+this._campaignId,"variantId : "+this._variantId),f.track(new l.CelebrationNotificationTelemetryEvent({action:l.CelebrationNotificationTelemetryEventAction.Created,notificationType:l.CelebrationNotificationType.EngagementPopCard,numberOfTopContacts:this._topContactsWithBirthday.length,didIdentifyDifferentTopContacts:this._didIdentifyDifferentTopContacts,cardCampaignId:this._campaignId,cardGuid:this._variantId,celebratedUserSkypeId:i})),!0))).fail((e=>(f.log(C.LogTraceArea.Notifications,"Failed to fetch campaign using PullCampaignContentService campaignId : "+this._campaignId+"variantId : "+this._variantId+" error: "+M.default.errorAsString(e)),f.track(new l.CelebrationNotificationTelemetryEvent({action:l.CelebrationNotificationTelemetryEventAction.PullCampaignContentServiceFailed,numberOfTopContacts:this._topContactsWithBirthday.length,didIdentifyDifferentTopContacts:this._didIdentifyDifferentTopContacts,cardGuid:this._variantId,cardCampaignId:this._campaignId,celebratedUserSkypeId:i})),!1)))}_getRecentConversationsInvolvingUser(e){return a.filter((0,h.default)().getDisplayableRecentConversationsSortedAll(),(t=>a.some(t.getMemberMris(),(t=>!v.default.isMyMri(e)&&t===e))))}_compareTwoContacts(e,t){const i=this._getRecentConversationsInvolvingUser(e),a=this._getRecentConversationsInvolvingUser(t),n=i.length-a.length;let o=0;return i.length>0&&a.length>0&&(o=i[0].getTimestamp()-a[0].getTimestamp()),0===n?o:n}_wasTimeBeforeToday(e){const t=new Date(e),i=new Date;return i.setHours(0,0,0,0),t.getTime()<i.getTime()}_getCelebrationNotificationLastShownTime(e,t){const i=e&&_.default.getData(u.InternalKeys.CelebrationNotificationLastShownTime)||0,a=t&&T.default.getCelebrationNotificationLastShownTime()||0;return Math.max(i,a)}_setCelebrationNotificationLastShownTime(e){_.default.putData(u.InternalKeys.CelebrationNotificationLastShownTime,e),T.default.setCelebrationNotificationLastShownTime(e)}test_startup(){this._appConfigStoreSubscribeCallback()}test_reset(){this._searchStore&&(this._searchStore.destroy(),this._searchStore=void 0),this._usersStoreSubscriptionToken&&(k.default.unsubscribe(this._usersStoreSubscriptionToken),this._usersStoreSubscriptionToken=void 0),this._appStateSubscription&&(this._appStateSubscription.unsubscribe(),this._appStateSubscription=void 0),this._appConfigStoreSubscription&&(r.default.unsubscribe(this._appConfigStoreSubscription),this._appConfigStoreSubscription=void 0),a.each(this._cachedUserProfilesDict,((e,t)=>{e&&delete this._cachedUserProfilesDict[t]})),this._didShowNotification=!1;let e=p.default.add(Date.now(),0,-1);this._setCelebrationNotificationLastShownTime(e)}setFavoriteAndSuggestedContactsList(e){a.each(e,(e=>{this._cachedUserProfilesDict[e.mri]=e}))}setTopContactsList(e){this._topContactsWithBirthday=e}}},56976:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class i{static savePhoneNumberInput(e){this.phoneNumberInput=e}static clearState(){this.phoneNumberInput=void 0,this.restoreStateRequired=!1}static restorePhoneNumberInputIfNeeded(){return this.restoreStateRequired?this.phoneNumberInput:void 0}static shouldRestoreState(){this.restoreStateRequired=!0}}t.default=i,i.phoneNumberInput=void 0,i.restoreStateRequired=!1},49663:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.E911Service=void 0;const a=i(96486),n=i(97691),o=i(48564),s=i(40276),r=i(36237),l=i(46096),c=i(35426);class d{getBase64EncodedLocation(e,t,i){return r.log(l.LogTraceArea.Phone,"E911Service: Fetching location from Bing Maps API."),o.default.getInstance().getLocationByPoint(e,t,i).then((i=>{var o;const d=null===(o=i.resourceSets[0])||void 0===o?void 0:o.resources[0];if(a.isUndefined(d))return n.Rejected();r.track(new c.E911BingMapsEvent(String(i.statusCode))),r.log(l.LogTraceArea.Phone,"E911Service: Location is fetched from Bing Maps API. Formatting location to PIDF-LO.");const u=this._formatLocation(e,t,d);return r.log(l.LogTraceArea.Phone,"E911Service: Location is formatted to PIDF-LO. Encoding location to Base64."),(0,s.btoaUtf8)(u)})).catch((e=>{const t=String(a.get(e,"statusCode"))||"NO_STATUS_CODE",i=String(a.get(e,"statusDescription"))||"NO_STATUS_DESCRIPTION";return r.track(new c.E911BingMapsEvent(t)),r.warn(l.LogTraceArea.Phone,"E911Service: Failed to fetch location from Bing Maps API: "+t+" - "+i),n.Rejected()}))}_formatLocation(e,t,i){return`<?xml version="1.0" encoding="utf-8"?>\n            <presence xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="urn:ietf:params:xml:ns:pidf">\n                <tuple id="tuple0">\n                    <status>\n                        <geopriv xmlns="urn:ietf:params:xml:ns:pidf:geopriv10">\n                            <location-info>\n                                <Point srsName="urn:ogc:def:crs:EPSG::4326" xmlns="http://www.opengis.net/gml">\n                                    <pos>${e} ${t}</pos>\n                                </Point>\n                                <civicAddress xmlns="urn:ietf:params:xml:ns:pidf:geopriv10:civicAddr">\n                                    ${`<country>${a.escape(i.address.countryRegionIso2)}</country>\n                <A1>${a.escape(i.address.adminDistrict)}</A1>\n                <A2>${a.escape(i.address.adminDistrict2)}</A2>\n                <A3>${a.escape(i.address.locality)}</A3>\n                <RD>${a.escape(i.address.addressLine)}</RD>\n                <LMK>${a.escape(i.address.landmark)}</LMK>\n                <PC>${a.escape(i.address.postalCode)}</PC>`}\n                                </civicAddress>\n                            </location-info>\n                            <usage-rules>\n                                <retransmission-allowed xmlns="urn:ietf:params:xml:ns:pidf:geopriv10:basicPolicy">true</retransmission-allowed>\n                            </usage-rules>\n                            <method>Derived</method>\n                        </geopriv>\n                    </status>\n                </tuple>\n            </presence>`}}t.E911Service=d,t.default=new d},54416:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(74958),n=i(96486),o=i(30914),s=i(26999),r=i(62783),l=i(74634),c=i(97691),d=i(89391),u=i(62141),h=(i(40276),i(46096)),p=i(36237),g=i(98754),C=i(61253),m=i(33754),S=i(4329),y=i(40821),f=i(11878),_=i(16568),b=i(22538),T=i(4057),v=i(40363),w=i(12770),I=i(94214),P=i(49682),M=i(47447),k=i(53374);t.default=new class{constructor(){this.pushTransportPathChanged=new l.default,this._exponentialTime=new r.ExponentialTime(1e3,3e5),this._checkStateRunning=!1,this._checkStateQueued=!1,this._subscriptions=[],this._handleRegistrationTokenReceived=e=>{if(p.track(new y.GotToken),p.log(h.LogTraceArea.RegistrarService,"OS Push Notification registration token received: "+a.pii.Omit(JSON.stringify(e))),e){let t;t=e,this._setPushTransportPath(t)}else p.warn(h.LogTraceArea.RegistrarService,"Not starting RegistrarService - no push token")},this._handleRegistrationAlertTokenReceived=e=>{if(p.track(new y.GotToken),p.log(h.LogTraceArea.RegistrarService,"OS Push Notification registration token received: "+a.pii.Omit(JSON.stringify(e))),e){let t;t=e,this._setPushTransportAlertPath(t)}else p.warn(h.LogTraceArea.RegistrarService,"Not starting RegistrarService - no push token")},this._gaveUpOnFetchingRegistrationTokenEvent=()=>{p.track(new y.GaveUpOnFetchingToken)},this._nonFatalErrorFetchingRegistrationTokenEvent=e=>{p.track(new y.NonFatalErrorFetchingToken(e.errorCode,e.errorMessage,e.networkConnectivityLevel))},this._handleRegistrationInvalidated=()=>{p.warn(h.LogTraceArea.RegistrarService,"OS Push Notification token has been invalidated")},this._updateTrouter=(e,t)=>{this._trouterUrl===e&&this._trouterTTL===t||(this._setTrouterEndpoint(e,t),this._checkState())},this._checkState=()=>{this._checkStateRunning?this._checkStateQueued=!0:(this._checkStateRunning=!0,this._checkStateInner(),this._checkStateRunning=!1,this._checkStateQueued&&(this._checkStateQueued=!1,this._checkState()))},b.RegisterStartupable(this,"RegistrarService",[g.default,_.default,I.default,P.default]),S.default.registerForLogout(this,"RegistrarService")}startup(){const e=g.default.getData(u.InternalKeys.EdfRegistrationInfo);if(e&&(this._setRegistrationId(e.registrationId,!!e.registrationIdGenerated),this._lastPostedTime=e.lastPostedTime,this._lastPostedPayload=e.lastPostedPayload,p.log(h.LogTraceArea.RegistrarService,"Loaded registrationId: "+this._registrationId+" lastPostedTime: "+this._lastPostedTime),d.default.getS4LFeatures().pushConfig.refreshOnLaunch&&(p.log(h.LogTraceArea.RegistrarService,"Clearing lastPostedPayload - will re-register"),this._lastPostedPayload=void 0)),o.default.useNativeRegistrationId()||this._registrationId)!o.default.useNativeRegistrationId()||this._registrationId&&!this._registrationIdGenerated||_.default.InternalCallingRegistrationId.waitUntilSet().then((()=>this._setAndPersistRegistrationId(_.default.InternalCallingRegistrationId.get(),!1)));else{const e=k.default.newGuid();p.log(h.LogTraceArea.RegistrarService,"Generated new arbitrary registrationId: "+e),this._setAndPersistRegistrationId(e,!0)}this._subscriptions.push(s.PushNotifications.registrationTokenReceivedEvent.subscribe(this._handleRegistrationTokenReceived)),this._subscriptions.push(s.PushNotifications.registrationAlertTokenReceivedEvent.subscribe(this._handleRegistrationAlertTokenReceived)),this._subscriptions.push(s.PushNotifications.gaveUpOnFetchingRegistrationTokenEvent.subscribe(this._gaveUpOnFetchingRegistrationTokenEvent)),this._subscriptions.push(s.PushNotifications.nonFatalErrorFetchingRegistrationTokenEvent.subscribe(this._nonFatalErrorFetchingRegistrationTokenEvent)),this._subscriptions.push(s.PushNotifications.registrationTokenInvalidatedEvent.subscribe(this._handleRegistrationInvalidated));const t=s.PushNotifications.getRegistrationToken();t&&this._handleRegistrationTokenReceived(t);const i=s.PushNotifications.getAlertRegistrationToken();return i&&this._handleRegistrationAlertTokenReceived(i),this._tokenStoreSubscription=I.default.subscribe(this._checkState,I.TriggerKeys.SkypeTokenKey),this._subscriptions.push(P.default.trouterChanged.subscribe(this._updateTrouter)),this._setTrouterEndpoint(P.default.getUrl(),P.default.getTTL()),this._checkState(),c.Resolved()}logout(e,t,i){this._unsubscribe();const a=i?c.Resolved():g.default.putData(u.InternalKeys.EdfRegistrationInfo,void 0),o=this._deleteRegistration(),s=_.default.deleteIds({edfRegistrationId:!0},!i);return c.all([a,s]).always((()=>c.raceTimer(o,500))).then(n.noop)}test_reset(){return this._pushTransportPath=void 0,this._pushTransportAlertPath=void 0,this._trouterUrl=void 0,this._trouterTTL=void 0,this._registrationId=void 0,this._registrationIdGenerated=void 0,this._lastPostedTime=void 0,this._lastPostedPayload=void 0,this._dontPostUntilAfter=void 0,this._registrationInFlight=void 0,this._postingPayload=void 0,this._unsubscribe(),c.all([_.default.deleteIds({edfRegistrationId:!0}),g.default.putData(u.InternalKeys.EdfRegistrationInfo,void 0)]).then(n.noop)}_unsubscribe(){const e=this._subscriptions;if(this._subscriptions=[],n.each(e,(e=>e.unsubscribe())),this._tokenStoreSubscription){const e=this._tokenStoreSubscription;this._tokenStoreSubscription=void 0,I.default.unsubscribe(e)}if(this._appConfigStoreSubscription){const e=this._appConfigStoreSubscription;this._appConfigStoreSubscription=void 0,d.default.unsubscribe(e)}}_setPushTransportPath(e){this._pushTransportPath!==e&&(this._pushTransportPath=e,this.pushTransportPathChanged.fire(),this._checkState())}_setPushTransportAlertPath(e){this._pushTransportAlertPath!==e&&(this._pushTransportAlertPath=e,this._checkState())}getPushTransportPath(){return this._pushTransportPath}test_updateTrouter(e,t){this._updateTrouter(e,t)}_setTrouterEndpoint(e,t){this._trouterUrl=e,this._trouterTTL=t}hasRegisteredWithService(){return!!this._lastPostedPayload}debug_getLastPayload(){return this._lastPostedPayload}debug_enumerateRegistrations(){return f.default.enumerateRegistrations().then((e=>e.bindings))}_deleteRegistration(){return this._registrationId?f.default.deleteRegistration(this._registrationId):c.Resolved()}_checkStateInner(){if(!I.default.hasUsableSkypeToken())return void p.log(h.LogTraceArea.RegistrarService,"Skipping PNH registration request: No usable SkypeToken");if(!this._registrationId)return void p.log(h.LogTraceArea.RegistrarService,"Skipping PNH registration request: No registrationId");if(!this._trouterUrl&&!this._pushTransportPath)return void p.log(h.LogTraceArea.RegistrarService,"Skipping PNH registration request: No valid transport");if(!this._pushTransportAlertPath&&M.UICapabilities.alertNotificationEnabled())return void p.log(h.LogTraceArea.RegistrarService,"Skipping PNH registration request: No valid alert transport path");const e=Date.now();if(this._dontPostUntilAfter&&e<this._dontPostUntilAfter)return this._retryTimer&&w.default.clearExpiration(this._retryTimer),this._retryTimer=w.default.setExpiration(this._checkState,this._dontPostUntilAfter),void p.log(h.LogTraceArea.RegistrarService,"Skipping PNH registration request: Cannot post until "+this._dontPostUntilAfter);const t=this._buildRegistrationPayload();if(!this._lastPostedTime||!(0,C.default)(this._lastPostedPayload,t)||e>this._lastPostedTime+1e3*d.default.getS4LFeatures().pushConfig.refreshIntervalSeconds||e>this._lastPostedTime+this._calcLowestTTLForPayload(this._lastPostedPayload)/2){if(this._registrationInFlight){if((0,C.default)(t,this._postingPayload))return void p.log(h.LogTraceArea.RegistrarService,"Skipping PNH registration request: Already posting");const e=this._registrationInFlight;this._registrationInFlight=void 0,e.cancel()}p.log(h.LogTraceArea.RegistrarService,"Sending PNH registration request:\nClient Description: "+JSON.stringify(t.clientDescription)+", NodeId: "+t.nodeId+", Registration Id: "+t.registrationId+", Transports: "+n.map(t.transports,((e,t)=>{let i="";return"\n"+t+" registered for:"+n.map(e,(e=>(i=i||e.path,", Context: "+e.context+", TTL: "+e.ttl+", CreationTime: "+e.creationTime)))+", with Path: "+p.piiTrustMeThisIsSafe(i)}))),this._postingPayload=t,this._registrationInFlight=f.default.postRegistration(this._postingPayload).finally((()=>{this._registrationInFlight=void 0,this._postingPayload=void 0})).then((()=>{this._dontPostUntilAfter=void 0,this._exponentialTime.reset(),p.log(h.LogTraceArea.RegistrarService,"PNH Registration Succeeded!"),this._lastPostedTime=Date.now(),this._lastPostedPayload=t,this._saveInfoToDb()}),(e=>{p.warn(h.LogTraceArea.RegistrarService,"PNH Registration errored: "+T.default.errorAsString(e)),this._dontPostUntilAfter=Date.now()+this._exponentialTime.getTimeAndCalculateNext()})).finally((()=>{this._checkState()}))}else{const e=this._registrationCompleteDeferred;e&&(p.log(h.LogTraceArea.RegistrarService,"PNH Registration Completed..."),e.resolve(void 0),this._registrationCompleteDeferred=void 0)}}waitForRegistrationComplete(){this._registrationCompleteDeferred||(this._registrationCompleteDeferred=c.Defer());const e=this._registrationCompleteDeferred.promise();return p.log(h.LogTraceArea.RegistrarService,"Awaiting PNH Registration..."),this._checkState(),e}_calcLowestTTLForPayload(e){let t;return n.each(e.transports,(e=>{n.each(e,(e=>{(!t||e.ttl<t)&&(t=e.ttl)}))})),t}_saveInfoToDb(){const e={registrationId:this._registrationId,registrationIdGenerated:this._registrationIdGenerated,lastPostedTime:this._lastPostedTime,lastPostedPayload:this._lastPostedPayload};return g.default.putData(u.InternalKeys.EdfRegistrationInfo,e)}_setAndPersistRegistrationId(e,t){this._setRegistrationId(e,t),this._saveInfoToDb().then((()=>this._checkState()))}getRegistrationId(){return this._registrationId}_setRegistrationId(e,t){this._registrationId=e,this._registrationIdGenerated=t,this._registrationId&&_.default.setEdfRegistrationId(this._registrationId)}_buildRegistrationPayload(){const e=n.merge({},this._pushTransportPath?o.default.getTransports(d.default.getS4LFeatures().pushConfig.ttlSeconds,this._pushTransportPath,this._pushTransportAlertPath,M.UICapabilities.alertNotificationEnabled()):{},this._getTrouterTransport());return{registrationId:this._registrationId,nodeId:"",clientDescription:{appId:o.default.getApplicationId(),platform:o.default.getPlatformName(),languageId:m.getLocale(),templateKey:o.default.getTemplateKey(M.UICapabilities.alertNotificationEnabled()),platformUIVersion:v.default.getClientVersionAndPlatform()+"/",notificationFilteringService:o.default.getNotificationFilteringService()},transports:e}}_getTrouterTransport(){return this._trouterUrl?{TROUTER:[{context:"",creationTime:"",path:this._trouterUrl,ttl:this._trouterTTL}]}:{}}getTrouterUrl(){return this._trouterUrl}}},24688:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=(i(74958),i(97691)),o=i(89391),s=i(94224),r=i(68580),l=i(22801),c=i(984),d=i(95742),u=i(46096),h=i(36237),p=i(4329),g=i(14138),C=i(76173),m=i(54565),S=i(22538),y=i(47202),f=i(72758);t.default=new class{constructor(){this._subscriptions=[],S.RegisterStartupable(this,"TrouterNotificationsService",[g.default]),p.default.registerForLogout(this,"TrouterNotificationsService")}startup(){return this._subscriptions.push(g.default.event_trouterNotificationQueueChanged.subscribe((()=>{this._drainTrouterQueue()}))),this._drainTrouterQueue(),n.Resolved()}_drainTrouterQueue(){a.each(g.default.fetchAndDrainTrouterNotificationQueue(),(e=>{this._handleTrouterMessage(e.notification,e.causeId)}))}logout(e,t,i){const o=this._subscriptions;return this._subscriptions=[],a.each(o,(e=>e.unsubscribe())),n.Resolved()}_handleTrouterMessage(e,t){var i;const n=Number(e.eventId);h.log(u.LogTraceArea.Trouter,"_handleTrouterMessage (Evt: "+n+", causeId: "+t+"), MS-CV: "+e.cv+")"),s.default.CallNotificationHelpers.maybeDisposePendingWarmCallForNotification(n);const p=Date.now();if(n===C.PNHEvents.IncomingNGCCall||n===C.PNHEvents.IncomingNGCGroupCall||n===C.PNHEvents.IncomingNGCPSTNCall||n===C.PNHEvents.IncomingS4BCall||n===C.PNHEvents.IncomingNGCEncryptedCall)s.default.CallNotificationHelpers.processIncomingCallNotification(n,"trouter",r.default.incomingCallNotificationForTrouter(e),p,p,t);else if(n===C.PNHEvents.IncomingGoLiveStart)s.default.CallNotificationHelpers.processIncomingGoLiveNotification(n,"trouter",r.default.incomingGoLiveNotificationForTrouter(e),p,p,t);else if(n===C.PNHEvents.IncomingGoLiveStop)s.default.CallNotificationHelpers.processGoLiveStopNotification(n,"trouter",r.default.stopGoLiveNotificationForTrouter(e),p,p,t);else if(n===C.PNHEvents.IncomingNGCStopRinger)s.default.CallNotificationHelpers.processStopCallNotification("trouter",r.default.stopCallNotificationForTrouter(e),p,p,t);else if(n===C.PNHEvents.IncomingWarmCall)s.default.CallNotificationHelpers.processWarmCallNotification(!1,e.body,t);else if(n===C.PNHEvents.IncomingP2PCall)s.default.CallNotificationHelpers.processP2PCallNotification(n,"trouter",e.body,p,p,t);else if(n===C.PNHEvents.IncomingContactListChange)c.default.processContactListChangeNotification();else if(n===C.PNHEvents.IncomingContactRequest||n===C.PNHEvents.IncomingContactAccept||n===C.PNHEvents.IncomingContactInviteListChange)c.default.processContactInviteNotification();else if(n===C.PNHEvents.IncomingProfileChange)f.default.fetchUserPotentiallyBeforeStartup();else if(n===C.PNHEvents.IncomingAvatarChange)f.default.fetchUserAvatarUrlPotentiallyBeforeStartup();else if(n===C.PNHEvents.SceUserServicesChange)d.default.processSceUserServicesChangeNotification(e.body.data||e.body);else if(n===C.PNHEvents.IncomingTPUMConciergeMessage){const i=e.body;y.default.processTPUMNotification(i,t)}else if(n===C.PNHEvents.IncomingUpsPresence){const t=null===(i=e.body)||void 0===i?void 0:i.presence;a.isEmpty(t)||m.default.trouterUserPresencesReceived(t)}else{if(n!==C.PNHEvents.Ued)return h.warn(u.LogTraceArea.Trouter,"_handleTrouterMessage: Failed to handle event type: "+n+" causeId: "+t+", MS-CV: "+e.cv),!1;{const t=o.default.getS4LMessagingFeaturesNoSubscription().ued,i=t&&t.enabled&&t.consumeEvents;h.log(u.LogTraceArea.Trouter,"Incoming UED event, MS-CV: "+e.cv+", processing enabled:"+i),i&&l.default.handleTrouterEvent(e.body,e.cv)}}return!0}}},49682:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(31844),o=i(74386),s=i(74634),r=i(97691),l=i(89391),c=i(46096),d=i(36237),u=i(76173),h=i(17791),p=i(22538),g=i(4057),C=i(40363),m=i(94214),S=i(81072);t.default=new class{constructor(){this.messageReceived=new s.default,this.trouterChanged=new s.default,this._started=!1,this._activityLevelIsBackground=!1,p.RegisterStartupable(this,"TrouterService",[m.default])}startup(){this._configStoreSubscriptionToken=l.default.subscribe((()=>this._onConfigChanged()));const e=l.default.getTrouterJScriptClientConfig();return o.default.initialize({version:C.default.getUIVersion(),sessionIdProvider:()=>C.default.getDeviceId(),tokenProvider:e=>Promise.resolve(m.default.getRawSkypeToken()),urlProvider:()=>l.default.getTrouterJScriptClientConfig().TrouterConnectionUrl,telemetry:{sender:{logEvent(e){d.track(new S.TrouterEvent(e))}},settings:{enabled:e.TelemetryEnabled,logHealthCheckError:e.ClientTelemetryEventEnabled.logHealthCheckError,trouter_js_client_connected:e.ClientTelemetryEventEnabled.trouter_js_client_connected,trouter_js_client_disconnected:e.ClientTelemetryEventEnabled.trouter_js_client_disconnected,trouter_js_client_error:e.ClientTelemetryEventEnabled.trouter_js_client_error,trouter_js_client_progress:e.ClientTelemetryEventEnabled.trouter_js_client_progress,trouter_js_client_response:e.ClientTelemetryEventEnabled.trouter_js_client_response,numberOfStepsToMaintain:e.ClientTelemetryEventEnabled.numberOfStepsToMaintain,sendProgressTimeoutSecs:e.ClientTelemetryEventEnabled.sendProgressTimeoutSecs}},connectivityChanged:h.default.connectivityChangedEvent}),o.default.registerMessageHandler({handleMessage:e=>this.messageReceived.fire(e),canHandleMessage:e=>!a.isNaN(e.eventId)&&e.eventId!==u.PNHEvents.IncomingUnknown&&a.some(a.values(u.PNHEvents),(t=>a.toNumber(t)===e.eventId))}),o.default.onConnectedChanged((e=>{if(d.log(c.LogTraceArea.Trouter,"onConnectedChanged "+e),e&&this._waitingForTrouterConnected){const e=this._waitingForTrouterConnected;this._waitingForTrouterConnected=void 0,e.resolve(void 0)}this.trouterChanged.fire(o.default.url(),o.default.ttl())})),m.default.performWhenValidSkypeTokenArrives().then((()=>o.default.start())),this._started=!0,r.Resolved()}logout(e,t,i){o.default.clearMessageHandlers(),l.default.unsubscribe(this._configStoreSubscriptionToken),this.setActivityLevel(!0),this._started=!1}isEnabled(){return o.default.isEnabled()}setActivityLevel(e){this._started?e!==this._activityLevelIsBackground&&(d.log(c.LogTraceArea.Trouter,"Setting activity level to "+(e?"background":"foreground")),this._activityLevelIsBackground=e,o.default.setTrouterActivityLevel(this._activityLevelIsBackground),this._activityLevelIsBackground?n.default.disableWifiLock().catch((e=>{d.warn(c.LogTraceArea.Trouter,"disableWifiLock failed: "+g.default.errorAsString(e))})):n.default.enableWifiLock().catch((e=>{d.warn(c.LogTraceArea.Trouter,"enableWifiLock failed: "+g.default.errorAsString(e))}))):d.log(c.LogTraceArea.Trouter,"Ignoring setActivityLevel call - not started")}getUrl(){return o.default.url()}getTTL(){return o.default.ttl()}performWhenTrouterIsConnected(){return o.default.isConnected()?r.Resolved():(this._waitingForTrouterConnected||(this._waitingForTrouterConnected=r.Defer()),this._waitingForTrouterConnected.promise())}_onConfigChanged(){const e=l.default.getCachedEcsConfig();return e?o.default.setEcsConfig(e.config):(d.log(c.LogTraceArea.Trouter,"No cached ECS settings available"),r.Resolved())}}},71502:(e,t,i)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),t.EmailABCHEntry=t.PhoneABCHEntry=t.ABCHEntry=t.VerificationState=void 0;const n=i(70655),o=i(74958),s=i(96486),r=i(88837),l=i(97691),c=i(93705),d=i(3486),u=i(46096),h=i(36237),p=i(78735),g=i(93818),C=i(4057),m=i(53374);var S,y;!function(e){e[e.ProfileChanged=0]="ProfileChanged"}(S||(S={})),function(e){e[e.Unverified=0]="Unverified",e[e.VerificationPending=1]="VerificationPending",e[e.Verified=2]="Verified"}(y=t.VerificationState||(t.VerificationState={}));class f{constructor(e){switch(this.Searchable=e.Searchable,this.Source=e.Source,e.State){case c.VerificationStrings.Verified:this.VerifiedState=y.Verified;break;case c.VerificationStrings.VerificationPending:this.VerifiedState=y.VerificationPending;break;case c.VerificationStrings.Unverified:default:this.VerifiedState=y.Unverified}}}t.ABCHEntry=f;class _ extends f{constructor(e){super(e),this.Phone=d.default.getPhonePartsFromViewValue(e)}}t.PhoneABCHEntry=_;class b extends f{constructor(e){super(e),this.EmailAddress=e.Name}}t.EmailABCHEntry=b;let T=a=class extends r.StoreBase{constructor(){super(...arguments),this._shortCircuitEntries={}}getEntries(){return this._profile||this._initialize(),s.cloneDeep(this._shortCircuitEntries)}getProfile(e=!1){return!this._profile||e?this._initialize():l.Resolved(this._profile)}hidePhoneNumberInSearch(e){const t={Name:e.Number,Country:a.getCountryForVerification(e.CountryIsoCode,e.CountryCallingCode),Searchable:!1},i={Attributes:[{Name:c.AttributeNames.PersonalContactProfilePhones,Edit:[t]}]};return h.log(u.LogTraceArea.ABCHStore,"Hide phone number in search "+o.pii.Omit(e.Number)),c.default.postActionOnPhoneNumber(i).then((e=>this._parseProfile(e)))}showPhoneNumberInSearch(e,t){const i={Name:e.Number,Country:a.getCountryForVerification(e.CountryIsoCode,e.CountryCallingCode),Searchable:!0},n="Msa"===t;n&&(i.Label=c.Phone_Other_Label);const s=n?{Attributes:[{Name:c.AttributeNames.PersonalContactProfilePhones,Add:[i]}]}:{Attributes:[{Name:c.AttributeNames.PersonalContactProfilePhones,Edit:[i]}]};return h.log(u.LogTraceArea.ABCHStore,"Show phone number in search "+o.pii.Omit(e.Number)),c.default.postActionOnPhoneNumber(s).then((e=>this._parseProfile(e)))}deletePhoneNumber(e){const t={Name:e.Number,Country:a.getCountryForVerification(e.CountryIsoCode,e.CountryCallingCode),Label:c.Phone_Other_Label},i={Attributes:[{Name:c.AttributeNames.PersonalContactProfilePhones,Delete:[t]}]};return h.log(u.LogTraceArea.ABCHStore,"Delete phone number "+o.pii.Omit(e.Number)),c.default.postActionOnPhoneNumber(i).then((e=>this._parseProfile(e)))}verifyPhoneNumber(e,t){const i={Token:t,Name:e.Number,Country:a.getCountryForVerification(e.CountryIsoCode,e.CountryCallingCode)},n={Attributes:[{Name:c.AttributeNames.PersonalContactProfilePhones,Edit:[i]}]};return h.log(u.LogTraceArea.ABCHStore,"Verify phone number "+o.pii.Omit(e.Number)),c.default.postActionOnPhoneNumber(n).then((e=>this._parseProfile(e)))}provisionExistingPhoneNumber(e,t,i){const n={Name:e.Number,Country:a.getCountryForVerification(e.CountryIsoCode,e.CountryCallingCode),Searchable:!0,VerifyMethod:t,VerifyLanguage:i},s={Attributes:[{Name:c.AttributeNames.PersonalContactProfilePhones,Edit:[n]}]};return h.log(u.LogTraceArea.ABCHStore,"Provision exisiting phone number "+o.pii.Omit(e.Number)),c.default.postActionOnPhoneNumber(s).then((e=>this._parseProfile(e)))}provisionNewPhoneNumber(e,t,i){const n={Name:e.Number,Country:a.getCountryForVerification(e.CountryIsoCode,e.CountryCallingCode),Searchable:!0,VerifyMethod:t,VerifyLanguage:i,Label:c.Phone_Other_Label},s={Attributes:[{Name:c.AttributeNames.PersonalContactProfilePhones,Add:[n]}]};return h.log(u.LogTraceArea.ABCHStore,"Provision new phone number "+o.pii.Omit(e.Number)),c.default.postActionOnPhoneNumber(s).then((e=>this._parseProfile(e)))}getUnverifiedPhoneNumberFromProfile(e){let t="";return s.eachRight(this._shortCircuitEntries,((i,a)=>!(i instanceof _&&i.VerifiedState!==y.Verified&&i.Source===e)||(t=i.Phone.Number,!1))),t}updateEntrySearchability(e,t){this._shortCircuitEntries[e]&&(this._shortCircuitEntries[e].Searchable=t,this.trigger())}registerMsaVerifiedEmailWithShortCircuit(){return this.getProfile(!0).then((e=>{let t,i;return s.each(e.Views,(e=>{s.each(e.Attributes,(e=>{e.Name===c.AttributeNames.PersonalContactProfileEmails&&s.each(e.Value,(e=>{"Msa"===e.Source&&e.State===c.VerificationStrings.Verified&&!e.Searchable&&e.Name&&(t=e.Name,i=e.Label)}))}))})),!(!t||!i)&&c.default.registerEmailWithShortCircuit(t,i).then((()=>!0))}))}_initialize(){return this._initializationPromise||(this._initializationPromise=c.default.getMyProfile(),h.log(u.LogTraceArea.ABCHStore,"Profile loading started.")),this._initializationPromise.then((e=>(h.log(u.LogTraceArea.ABCHStore,`Profile successfully loaded. Views length: ${e.Views.length}`),this._parseProfile(e)))).catch((e=>(h.track(new g.MyProfileFetch({isSuccess:!1,isV2:!0,isMigrationSuggested:!1,isMigratedToV2:!1,origin:u.MyProfileFetchOrigin.ABCHStore})),l.Rejected(e)))).finally((()=>{this.trigger(S.ProfileChanged),this._initializationPromise=void 0}))}getParsedProfile(){var e;const t={phoneNumbersAndParts:[],emails:[]};if(!this._profile)return this._initialize(),t;const i=s.flatten(s.map(null===(e=this._profile)||void 0===e?void 0:e.Views,"Attributes")),a=s.filter(i,(e=>s.includes([c.AttributeNames.PersonalContactProfilePhones,c.AttributeNames.PersonalContactProfileEmails],e.Name)));return s.each(a,(e=>{s.each(e.Value,(i=>{if(e.Name===c.AttributeNames.PersonalContactProfilePhones&&0===t.phoneNumbersAndParts.length){const e=d.default.getPhonePartsFromViewValue(i);t.phoneNumbersAndParts.push({phoneNumber:d.default.getPhoneKey(e.Number,e.CountryIsoCode,e.CountryCallingCode,!0),phoneParts:e,source:i.Source})}else e.Name===c.AttributeNames.PersonalContactProfileEmails&&0===t.emails.length&&t.emails.push(i.Name)}))})),t}_parseProfile(e){this._profile=e,this._shortCircuitEntries={};let t=!1;s.each(e.Views,(e=>{s.each(e.Attributes,(e=>{s.each(e.Value,(i=>{if(e.Name===c.AttributeNames.PersonalContactProfilePhones){const e=d.default.calculatePhoneKeyFromViewValue(i);this._shortCircuitEntries[e]=new _(i)}else if(e.Name===c.AttributeNames.PersonalContactProfileEmails){const e=this._calculateEmailKeyFromViewValue(i);this._shortCircuitEntries[e]=new b(i),i.State===c.VerificationStrings.Verified&&(t=!0)}}))}))}));const i=s.map(this._shortCircuitEntries,((e,t)=>`${this._getEntryName(e)}:${o.pii.Omit(t)}`)).join("\n");return h.log(u.LogTraceArea.ABCHStore,"Updated profile info:\n"+i),p.default.setUserPreferencesLocal({hasVerifiedEmail:t}),this.trigger(),e}_getEntryName(e){return e instanceof _?"Phone":e instanceof b?"Email":m.default.switchStatementExhaustiveChecking(e)}static getCountryForVerification(e,t){return C.default.toUpper(e)+"-"+t}_calculateEmailKeyFromViewValue(e){return e.Name.trim().toLowerCase()}test_reset_store(){this._profile=void 0,this._initializationPromise=void 0}};(0,n.__decorate)([r.autoSubscribe],T.prototype,"getEntries",null),(0,n.__decorate)([r.autoSubscribe],T.prototype,"getProfile",null),(0,n.__decorate)([(0,r.autoSubscribeWithKey)(S.ProfileChanged)],T.prototype,"getParsedProfile",null),T=a=(0,n.__decorate)([r.AutoSubscribeStore],T),t.default=new T},75492:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(70655),n=i(88837),o=i(46096),s=i(36237);var r;!function(e){e[e.CallStatsVisibilty=0]="CallStatsVisibilty",e[e.OverflowMenuVisibility=1]="OverflowMenuVisibility"}(r||(r={}));let l=class extends n.StoreBase{constructor(){super(...arguments),this._isVisible=!1,this._callStatsVisible=!1,this._overflowMenuVisible=!1}areCallControlsVisible(){return this._isVisible}setCallControlsVisible(e,t){s.log(o.LogTraceArea.CallingUI,"CallControlsVisibilityStore.setCallControlsVisible.visible: "+(e?"true":"false")+" causeId: "+t);this.areCallControlsVisible()!==e&&this._triggerUpdates(e)}_triggerUpdates(e){this._isVisible=e,this.trigger()}isOverflowMenuVisible(){return this._overflowMenuVisible}setOverflowMenuVisiblity(e,t){e!==this._overflowMenuVisible&&(s.log(o.LogTraceArea.CallingUI,`CallControlsVisibilityStore.setOverflowMenuVisibility moving  ${this._overflowMenuVisible}->${e} causeId: ${t}`),this._overflowMenuVisible=e,this.trigger(r.OverflowMenuVisibility))}isCallStatsVisible(){return this._callStatsVisible}setCallStatsVisiblity(e,t){e!==this._callStatsVisible&&(s.log(o.LogTraceArea.CallingUI,`CallControlsVisibilityStore.setCallStatsVisiblity moving  ${this._callStatsVisible}->${e} causeId: ${t}`),this._callStatsVisible=e,this.trigger(r.CallStatsVisibilty))}resetAllVisibility(e){s.log(o.LogTraceArea.CallingUI,`CallControlsVisibilityStore.resetAllVisibility causeId: ${e}`),this._isVisible=!1,this._callStatsVisible=!1,this._overflowMenuVisible=!1}};(0,a.__decorate)([n.autoSubscribe],l.prototype,"areCallControlsVisible",null),(0,a.__decorate)([(0,n.autoSubscribeWithKey)(r.OverflowMenuVisibility)],l.prototype,"isOverflowMenuVisible",null),(0,a.__decorate)([(0,n.autoSubscribeWithKey)(r.CallStatsVisibilty)],l.prototype,"isCallStatsVisible",null),l=(0,a.__decorate)([n.AutoSubscribeStore],l),t.default=new l},78816:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallDebugMenuItem=t.TriggerKeys=void 0;const a=i(70655),n=i(96486),o=i(31844),s=i(88837),r=i(48540),l=i(97691),c=i(94224),d=i(71830),u=i(984),h=i(66355),p=i(36237),g=i(4735),C=i(4057),m=i(12770),S=i(72758),y=i(53374);var f,_;!function(e){e[e.SelectedTab=0]="SelectedTab",e[e.Participants=1]="Participants",e[e.CallTechnicalInfo=2]="CallTechnicalInfo",e[e.AppMetrics=3]="AppMetrics",e[e.RendererMetrics=4]="RendererMetrics"}(f=t.TriggerKeys||(t.TriggerKeys={})),function(e){e[e.CallStats=0]="CallStats",e[e.Simulation=1]="Simulation",e[e.Inspect=2]="Inspect"}(_=t.CallDebugMenuItem||(t.CallDebugMenuItem={}));let b=class extends s.StoreBase{constructor(){super(...arguments),this._selectedItem=_.CallStats,this._refreshIntervalTokens={},this._callTechnicalInfo={},this._callParticipants={},this._rendererStats={},this._showAppMetrics=!1,this._showVideoMetrics=!1,this._handleCallEndedEvent=e=>{const t=y.default.newCauseId();this.dispose(e.callId),this.closeDebugWindow(e.callId,t,void 0)},this._updatePerformanceMetrics=()=>l.all([o.default.getSystemUsage(),o.default.getAppMetrics()]).then((e=>{const[t,i]=e;this._metrics={systemUsageInfo:t,gpu:i?i.find((e=>"GPU"===e.type)):void 0,renderer:i?i.find((e=>"Tab"===e.type)):void 0},this.trigger(f.AppMetrics)})),this._updateCallTechnicalInfo=e=>c.default.CallingStore.getTechnicalInformation(e).then((t=>{const i=C.default.parseJsonErrorToUndefined(t);this._callTechnicalInfo[e]||(this._callTechnicalInfo[e]=void 0),this._callTechnicalInfo[e]=i,this.trigger((0,s.formCompoundKey)(e,f.CallTechnicalInfo))}))}init(e){c.default.CallingStore.callEndedEvent().subscribe(this._handleCallEndedEvent),this.startTrackCallTechnicalInfo(e)}getParticipants(e){return this._callParticipants[e]?this._callParticipants[e]:[]}addParticipant(e){this._callParticipants[e]||(this._callParticipants[e]=[]);const t=this._generateParticipant(e);t&&(this._callParticipants[e].push(t),this.trigger(f.Participants))}resetParticipants(e){delete this._callParticipants[e],this.trigger(f.Participants)}removeParticipants(e){this._callParticipants[e]&&(this._callParticipants[e].pop(),this.trigger(f.Participants))}addGroupParticipants(e){for(let t=0;t<12;t++)this.addParticipant(e);this.trigger(f.Participants)}isFakeCallParticipant(e,t){return!!this._callParticipants[e]&&void 0!==n.find(this._callParticipants[e],(e=>e.mri===t))}closeDebugWindow(e,t,i,a=!0){g.default.closeCallDebugPanel(t,i,a)}openNativeWindow(e,t,i,a){g.default.closeCallDebugPanel(a,i,!t),g.default.navigateToCallingDebugPanel(e,i,t),this.trigger()}getCallTechnicalInfo(e){return this._callTechnicalInfo[e]}getAppMetrics(){return this._metrics}getSelectedTab(){return this._selectedItem}showAppMetrics(){return this._showAppMetrics}showVideoMetrics(){return this._showVideoMetrics}setShowAppMetrics(e){this._showAppMetrics=e,e?this._refreshAppMetricsIntervalTokens||(this._refreshAppMetricsIntervalTokens=m.default.setInterval(this._updatePerformanceMetrics,1e4),this._updatePerformanceMetrics()):this._refreshAppMetricsIntervalTokens&&(m.default.clearInterval(this._refreshAppMetricsIntervalTokens),this._refreshAppMetricsIntervalTokens=void 0,this._metrics=void 0),this.trigger(f.AppMetrics)}setShowVideoMetrics(e){this._showVideoMetrics=e,this.trigger()}getRendererMetrics(e,t){if(this._rendererStats[e]&&this._rendererStats[e][t])return this._rendererStats[e][t]}fetchRendererStats(e,t,i){if(!e)return;const a=c.default.RemoteStreamHelper.getRemoteStreamRenderer(e,t,i);null==a||a.getStats().then((i=>{var n,o;this._rendererStats[e]||(this._rendererStats[e]={}),this._rendererStats[e][t]={framesDropped:i.framesDropped,framesTotal:i.framesTotal,frameType:r.FrameType[null==a?void 0:a.frameType],rendererType:r.RendererType[null==a?void 0:a.rendererType],streamSize:`${null===(n=null==a?void 0:a.streamSize)||void 0===n?void 0:n.width}:${null===(o=null==a?void 0:a.streamSize)||void 0===o?void 0:o.height}`},this.trigger((0,s.formCompoundKey)(e,f.RendererMetrics))}))}setSelectedTab(e){this._selectedItem=e,this.trigger(f.SelectedTab)}startTrackCallTechnicalInfo(e){this._refreshIntervalTokens[e]||(this._refreshIntervalTokens[e]=m.default.setInterval((()=>this._updateCallTechnicalInfo(e)),1e4),this._updateCallTechnicalInfo(e))}getCallDebugMemberMri(e,t){return n.find(this._callParticipants[e],(e=>e.id===t.id)).mri}dispose(e){const t=this._refreshIntervalTokens[e];t&&m.default.clearInterval(t),this._selectedItem=_.CallStats,this._refreshIntervalTokens[e]=void 0,this._callTechnicalInfo[e]=void 0}test_reset(){n.map(this._refreshIntervalTokens,(e=>{e&&m.default.clearInterval(e)})),this._refreshIntervalTokens={},this._callParticipants={},this._selectedItem=_.CallStats,this._callTechnicalInfo={}}_generateParticipant(e){const t=u.default.dangerousGetContactMriListMutable();if(0===t.length)return;const i=n.random(0,t.length);let a;do{a=t[n.random(0,t.length)]}while(!(0,d.isMri)(a));try{const t=S.default.getDisplayableUserByMri(a),n=new T(y.default.newGuid(),t?t.getMri():"8:myfakeuserdebug"+y.default.newCauseId(),t?t.getDisplayName():`MyFakeUser${i}`,r.ParticipantState.Connected);return n.streams={[r.StreamType.Video]:[new v(i,e,!0,!0,1,r.StreamType.Video)]},n}catch(e){return void p.log(h.LogTraceArea.CallDebug,"User doesn't exists")}}};(0,a.__decorate)([(0,s.autoSubscribeWithKey)(f.Participants)],b.prototype,"getParticipants",null),(0,a.__decorate)([(0,s.autoSubscribeWithKey)(f.CallTechnicalInfo),(0,a.__param)(0,s.key)],b.prototype,"getCallTechnicalInfo",null),(0,a.__decorate)([(0,s.autoSubscribeWithKey)(f.AppMetrics)],b.prototype,"getAppMetrics",null),(0,a.__decorate)([(0,s.autoSubscribeWithKey)(f.SelectedTab)],b.prototype,"getSelectedTab",null),(0,a.__decorate)([s.autoSubscribe],b.prototype,"showAppMetrics",null),(0,a.__decorate)([s.autoSubscribe],b.prototype,"showVideoMetrics",null),(0,a.__decorate)([(0,s.autoSubscribeWithKey)(f.RendererMetrics),(0,a.__param)(0,s.key)],b.prototype,"getRendererMetrics",null),(0,a.__decorate)([s.autoSubscribe],b.prototype,"getCallDebugMemberMri",null),b=(0,a.__decorate)([s.AutoSubscribeStore],b);class T{constructor(e,t,i,a){this.id=e,this.mri=t,this.displayName=i,this.state=a}getSourceIdForMediaType(e){return 42}getDiagnosticData(){return"MockedParticipant"}dispose(){}changed(e){return{dispose:e=>{}}}on(e,t){return{dispose:e=>{}}}once(e,t){return{dispose:e=>{}}}}class v{constructor(e,t,i,a,n,o){this.mediaSourceId=0,this.id=e,this.callId=t,this.isAvailable=i,this.isStreaming=a,this.rank=n,this.type=o}changed(e){return{dispose:e=>{}}}dispose(e){}getDiagnosticData(){return""}isActive(){return!0}on(e,t){return{dispose:e=>{}}}once(e,t){return{dispose:e=>{}}}start(e,t){return new Promise(((e,t)=>{const i=c.default.CallingStore.getVideoPreviewRenderer(this.callId);i?e(i):t("No renderer")}))}stop(){return new Promise(((e,t)=>{e()}))}}t.default=new b},81770:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(70655),n=i(74958),o=i(96486),s=i(88837),r=i(46096),l=i(36237),c=i(61253);var d;!function(e){e[e.DropTarget=0]="DropTarget",e[e.Drag=1]="Drag",e[e.Hover=2]="Hover"}(d||(d={}));let u=class extends s.StoreBase{getCurrentDraggingParticipantKey(){return this._currentConfig?this._currentConfig.key:void 0}getCurrentDraggingParticipantConfig(){return this._currentConfig}getCurrentHoveringParticipantConfig(){return this._hoveringConfig}dangerouslyGetCurrentDraggingParticipantConfig(){return this._currentConfig}setDraggingParticipantConfig(e){if((0,c.default)(this._currentConfig,e))return;const t=this._currentConfig;this._currentConfig=e;const i=[],a=t?t.key:null;if(!this._currentConfig||a!==this._currentConfig.key){const e=this._currentConfig?this._currentConfig.key:"none";l.log(r.LogTraceArea.CallingUI,"CallDraggingParticipantStore.setDraggingParticipantConfig change: key: "+n.pii.Omit(e)),i.push(d.Drag)}e&&this._hoveringConfig&&(this._hoveringConfig=void 0,i.push(d.Hover)),i.push(d.DropTarget),this.trigger(i)}clearHoveringParticipantConfig(e){!this._hoveringConfig||e&&this._hoveringConfig.source!==e||(this._hoveringConfig=void 0,o.defer((()=>{this.trigger(d.Hover)})))}setHoveringParticipantConfig(e){(0,c.default)(this._hoveringConfig,e)||(this._hoveringConfig=e,this.trigger(d.Hover))}};(0,a.__decorate)([(0,s.autoSubscribeWithKey)(d.Drag)],u.prototype,"getCurrentDraggingParticipantKey",null),(0,a.__decorate)([(0,s.autoSubscribeWithKey)(d.DropTarget)],u.prototype,"getCurrentDraggingParticipantConfig",null),(0,a.__decorate)([(0,s.autoSubscribeWithKey)(d.Hover)],u.prototype,"getCurrentHoveringParticipantConfig",null),u=(0,a.__decorate)([s.AutoSubscribeStore],u);let h=new u;t.default=h},25489:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Test_CallLogStore=void 0;const a=i(70655),n=i(96486),o=i(88837),s=i(76621),r=i(62141),l=i(46096),c=i(36237);let d=class extends o.StoreBase{constructor(){super(),this._requestThrottle=n.throttle(this._requestCallLogsThrottled,250),this._throttledIds={},this._dbLookups={},this._cache={},this._incomingCallLogsProcessedCallback=e=>{n.each(e,(e=>{const t=this._isTrackingKey(e.callId);t&&this._addToCache(e),c.log(l.LogTraceArea.Calling,`CallLogStore received new calllog: ${e.callId} tracking: ${t}`)}))},s.default.callLogsReceived.subscribe(this._incomingCallLogsProcessedCallback)}getCallLog(e){return this._cache[e]}_startedTrackingKey(e){this._dbLookups[e]||(this._throttledIds[e]=e,this._requestThrottle())}_stoppedTrackingKey(e){delete this._throttledIds[e],delete this._cache[e]}_requestCallLogsThrottled(){if(n.isEmpty(this._throttledIds))return;const e=n.values(this._throttledIds);this._throttledIds={},c.log(l.LogTraceArea.Calling,`CallLogStore processing throttle for ${e}`);const t=r.default.getCallLogs(e).finally((()=>{n.each(e,(e=>delete this._dbLookups[e]))})).then((e=>{n.each(e,(e=>{e&&this._isTrackingKey(e.callId)&&(this._addToCache(e),c.log(l.LogTraceArea.Calling,`CallLogStore adding calllog from store: ${e.callId}`))}))})).fail((t=>{c.warn(l.LogTraceArea.Calling,`CallLogStore failed getting calllogs from store: ${e}`)}));n.each(e,(e=>{this._dbLookups[e]=t}))}_addToCache(e){const t=this._cache[e.callId];t&&t.messageCuid&&e.messageCuid&&!(e.messageCuid>t.messageCuid)||(this._cache[e.callId]=e,this.trigger(e.callId))}test_setCache(e){this._cache=e}};(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],d.prototype,"getCallLog",null),(0,a.__decorate)([o.disableWarnings],d.prototype,"_startedTrackingKey",null),(0,a.__decorate)([o.disableWarnings],d.prototype,"_stoppedTrackingKey",null),d=(0,a.__decorate)([o.AutoSubscribeStore],d),t.Test_CallLogStore=d,t.default=new d},32057:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallNetworkConnectionStore=void 0;const a=i(70655),n=i(96486),o=i(88837),s=i(94224),r=i(98925),l=i(46096),c=i(36237);let d,u=class extends o.StoreBase{constructor(){super(),this._networkSubscription=void 0,this._calls=[],this._reconnection={},this._receiveQuality={},this._receiveCatastrophic={},this._startWatchingForNetworkConnectionChanges=e=>{n.includes(this._calls,e.callId)||this._calls.push(e.callId),this._networkSubscription||(this._networkSubscription=s.default.CallingStore.networkConnectionEvent().subscribe(this._callNetworkStateUpdated))},this._stopWatchingForNetworkConnectionChanges=e=>{delete this._receiveQuality[e.callId],delete this._reconnection[e.callId],delete this._receiveCatastrophic[e.callId],n.pull(this._calls,e.callId),n.isEmpty(this._calls)&&(this._networkSubscription&&(this._networkSubscription.unsubscribe(),this._networkSubscription=void 0),this._reconnection={},this._receiveQuality={},this._receiveCatastrophic={})},this._callNetworkStateUpdated=e=>{const t=e.callId;n.includes(this._calls,t)&&(e.eventType===r.CallNetworkQualityEventType.NetworkReconnection?this._reconnection[t]=e.networkState:e.eventType===r.CallNetworkQualityEventType.NetworkReceiveQuality?this._receiveQuality[t]=e.networkState:e.eventType!==r.CallNetworkQualityEventType.NetworkReceiveCatastrophic&&e.eventType!==r.CallNetworkQualityEventType.NetworkSendCatastrophic||(this._receiveCatastrophic[t]=e.networkState),this.trigger(t))},this._listenStartAndStopCallEvents()}getCallReconnectionState(e){if(e in this._reconnection)return this._reconnection[e]}isCallQualityPoor(e){if(this.isCallCatastrophic(e))return!0;const t=this._getCallReceivedQualityState(e);return c.log(l.LogTraceArea.Calling,`isCallQualityPoor: connectionState=${t}`),t===r.NetworkConnectionState.LostConnection}isCallCatastrophic(e){const t=this._getCallReceiveCatastrophic(e);return c.log(l.LogTraceArea.Calling,`isCallCatastrophic: connectionState=${t}`),t===r.NetworkConnectionState.Connecting||t===r.NetworkConnectionState.LostConnection}_getCallReceivedQualityState(e){if(e in this._receiveQuality)return this._receiveQuality[e]}_getCallReceiveCatastrophic(e){if(e in this._receiveCatastrophic)return this._receiveCatastrophic[e]}test_listenStartAndStopCallEvents(){this._listenStartAndStopCallEvents()}_listenStartAndStopCallEvents(){s.default.CallingStore.callCreatedEvent().subscribe(this._startWatchingForNetworkConnectionChanges),s.default.CallingStore.callEndedEvent().subscribe(this._stopWatchingForNetworkConnectionChanges)}};(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],u.prototype,"getCallReconnectionState",null),(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],u.prototype,"isCallQualityPoor",null),(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],u.prototype,"isCallCatastrophic",null),(0,a.__decorate)([o.disableWarnings],u.prototype,"_listenStartAndStopCallEvents",null),u=(0,a.__decorate)([o.AutoSubscribeStore],u),t.CallNetworkConnectionStore=u,t.default=function(){return d||(d=new u)}},76514:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(70655),n=i(96486),o=i(88837),s=i(36237),r=i(66355),l=i(14976);let c=class extends o.StoreBase{constructor(){super(...arguments),this._pinnedParticipants={}}pinParticipant(e,t){s.log(r.LogTraceArea.CallingUI,"Pinning participant with key "+l.mriOrId(e)+" for the callId: "+t),this._pinnedParticipants[t]||(this._pinnedParticipants[t]=[]),this._pinnedParticipants[t].push(e),this.trigger(t)}unpinParticipant(e,t){s.log(r.LogTraceArea.CallingUI,"Trying to unpin participant with key "+l.mriOrId(e)+" for the callId: "+t),this._pinnedParticipants[t]&&(n.pull(this._pinnedParticipants[t],e),this.trigger(t))}cleanupPinnedParticipants(e){s.log(r.LogTraceArea.CallingUI,"Cleaning up the call participants for a call "+e),delete this._pinnedParticipants[e],this.trigger(e)}getPinnedParticipants(e){return this._pinnedParticipants[e]}isParticipantPinned(e,t){return n.includes(this._pinnedParticipants[t],e)}hasPinnedParticipants(e){return!n.isEmpty(this._pinnedParticipants[e])}};(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],c.prototype,"getPinnedParticipants",null),(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(1,o.key)],c.prototype,"isParticipantPinned",null),(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],c.prototype,"hasPinnedParticipants",null),c=(0,a.__decorate)([o.AutoSubscribeStore],c),t.default=new c},44279:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(70655),n=i(96486),o=i(88837),s=i(18260),r=i(71830),l=i(88366),c=i(95742),d=i(27683);let u=class extends o.StoreBase{constructor(){super(...arguments),this._phoneNumberRates={},this._phoneNumberSkypeCallRates={},this._lookups={},this._getPhoneNumberFromPhoneMri=e=>{const t=r.getPhoneNumberFromMri(e);return t?d.default.stripPlusSign(t):e},this._getPhoneNumberRates=e=>this._phoneNumberRates[e]&&this._phoneNumberRates[e][e]?this._phoneNumberRates[e][e]:void 0,this._getCallRateFundingSourceForPhoneNumber=e=>this._phoneNumberSkypeCallRates[e]&&this._phoneNumberSkypeCallRates[e][e]?this._phoneNumberSkypeCallRates[e][e].callFundedBy:void 0}_startedTrackingKey(e){const t=r.isMri(e)?this._getPhoneNumberFromPhoneMri(e):e;this._lookups[t]||(this._lookups[t]=c.default.getRates([t]).finally((()=>{delete this._lookups[t]})).then((i=>{const a={};n.transform(i,((e,t)=>{const i=s.compileCallRateLabel(t);i&&(e[t.pstnNumber]=i)}),a),this._phoneNumberRates[t]=a,this._phoneNumberSkypeCallRates[t]=i,this.trigger(e)})))}_stoppedTrackingKey(e){const t=this._lookups[e];t&&(delete this._lookups[e],t.cancel()),delete this._phoneNumberRates[e],delete this._phoneNumberSkypeCallRates[e]}getCallRateByPhoneNumber(e){return this._getPhoneNumberRates(e)}getCallRateByMri(e){const t=this._getPhoneNumberFromPhoneMri(e);return this._getPhoneNumberRates(t)}isPhoneNumberEligibleForTaster(e){const t=this._getCallRateFundingSourceForPhoneNumber(e);return!!t&&t===l.CallRateFundingSource.TasterCall}isPhoneMriTollFree(e){const t=this._getPhoneNumberFromPhoneMri(e),i=this._getCallRateFundingSourceForPhoneNumber(t);return!!i&&i===l.CallRateFundingSource.FreeCall}};(0,a.__decorate)([o.disableWarnings],u.prototype,"_startedTrackingKey",null),(0,a.__decorate)([o.disableWarnings],u.prototype,"_stoppedTrackingKey",null),(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],u.prototype,"getCallRateByPhoneNumber",null),(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],u.prototype,"getCallRateByMri",null),(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],u.prototype,"isPhoneNumberEligibleForTaster",null),(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],u.prototype,"isPhoneMriTollFree",null),u=(0,a.__decorate)([o.AutoSubscribeStore],u),t.default=new u},78968:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TriggerKeys=void 0;const a=i(70655),n=i(96486),o=i(88837),s=i(97691),r=i(76621),l=i(51077),c=i(62141),d=i(46096),u=i(36237),h=i(18078),p=i(33004),g=i(14976),C=i(22538);!function(e){e[e.EventReactions=0]="EventReactions"}(t.TriggerKeys||(t.TriggerKeys={}));let m=class extends o.StoreBase{constructor(){super(),this._reactionGroups={},this._outerToInnerThreadMap={},this._isAnimationPlaying=!1,C.RegisterStartupable(this,"CallReactionsStore",[r.default])}startup(){return s.Resolved()}destroy(){this._messagesUpdatedSubscriptionToken&&(this._messagesUpdatedSubscriptionToken.unsubscribe(),this._messagesUpdatedSubscriptionToken=void 0)}_startedTrackingKey(e){u.log(d.LogTraceArea.CallReactions,"CallReactionsStore._startedTrackingKey, reactionsConversationMri: "+g.mriOrId(e)),this._reactionGroups[e]||(this._reactionGroups[e]=this._newCallReactionsGroup()),c.default.getMessagesInConversation(e).then((t=>{t.length&&this._reactionGroups[e]&&this._putInnerOrOuterThreadReactions(e,t)})),this._messagesUpdatedSubscriptionToken||(this._messagesUpdatedSubscriptionToken=r.default.messagesProcessed.subscribe((e=>{const t=n.filter(e,(e=>!!this._reactionGroups[e.conversationId]||!!this._outerToInnerThreadMap[e.conversationId])),i=n.groupBy(t,(e=>e.conversationId));n.each(i,((e,t)=>{this._putInnerOrOuterThreadReactions(t,e)}))})))}_stoppedTrackingKey(e){const t=this._reactionGroups[e];t&&t.outerThreadMri&&this._clearOuterThreadAssignment(e,t.outerThreadMri)}assignOuterThread(e,t){if(u.log(d.LogTraceArea.CallReactions,"CallReactionsStore.assignOuterThread, outerThreadMri: "+g.mriOrId(t)+" innerThreadMri: "+g.mriOrId(e)),this._outerToInnerThreadMap[t]||(this._outerToInnerThreadMap[t]=[]),n.includes(this._outerToInnerThreadMap[t],e)||this._outerToInnerThreadMap[t].push(e),this._reactionGroups[e]){const i=this._reactionGroups[e].outerThreadMri;i&&i!==t&&this._clearOuterThreadAssignment(e,i)}else this._reactionGroups[e]=this._newCallReactionsGroup();this._reactionGroups[e].outerThreadMri=t}clearOuterThreadAssignment(e,t){u.log(d.LogTraceArea.CallReactions,"CallReactionsStore.clearOuterThreadAssignment, outerThreadMri: "+g.mriOrId(t)+" innerThreadMri: "+g.mriOrId(e)),this._clearOuterThreadAssignment(e,t)}setReactionPressedScenario(e){this._reactionPressedScenario=e}maybeGetAndClearReactionPressedScenario(){const e=this._reactionPressedScenario;return this._reactionPressedScenario=void 0,e}setHasPostedReactions(e,t){const i=this._reactionGroups[e];i&&i.hasPostedReactions!==t&&(i.hasPostedReactions=t,t&&this._triggerForMri(e))}getUnseenIncomingTextCount(e){const t=this._reactionGroups[e];return t?t.unseenIncomingTextCount:0}resetUnSeenIncomingTextCount(e){let t=this._reactionGroups[e];t&&(t.unseenIncomingTextCount=0),this._triggerForMri(e)}getUnseenIncomingPhotoCount(e){const t=this._reactionGroups[e];return t?t.unseenIncomingPhotoCount:0}resetUnSeenIncomingPhotoCount(e){let t=this._reactionGroups[e];t&&(t.unseenIncomingPhotoCount=0),this._triggerForMri(e)}markOneIncomingPhotoSeen(e){let t=this._reactionGroups[e];t&&t.unseenIncomingPhotoCount>0&&t.unseenIncomingPhotoCount--,this._triggerForMri(e)}getUnseenIncomingTranscriptionCount(e){const t=this._reactionGroups[e];return t?t.unseenIncomingTranscriptionCount:0}resetUnseenIncomingTranscriptionCount(e){let t=this._reactionGroups[e];t&&(t.unseenIncomingTranscriptionCount=0),this._triggerForMri(e)}getUnseenIncomingEventsCount(e){const t=this._reactionGroups[e];return t?t.unseenIncomingEventsCount:0}resetUnseenIncomingEventsCount(e){let t=this._reactionGroups[e];t&&(t.unseenIncomingEventsCount=0),this._triggerForMri(e)}hasPostedReactions(e){const t=this._reactionGroups[e];return!!t&&t.hasPostedReactions}getReactions(e,t=0){const i=this._reactionsInfoForThreadMri(e);return i&&i.allReactions.length?n.filter(i.allReactions,((e,i)=>e.createdTime>t&&!e.isEmoticonCallReaction())):[]}getTextReactions(e,t=0){const i=this._reactionsInfoForThreadMri(e);return i&&i.textReactions.length?t>0?n.filter(i.textReactions,((e,i)=>e.createdTime>t)):i.textReactions:[]}getLastReaction(e,t=0){const i=this._reactionsInfoForThreadMri(e);if(!i||!i.textReactions.length)return;const a=n.last(i.textReactions);return a&&a.createdTime>t?a:void 0}getPictureReactions(e,t=0,i=!1){const a=this._reactionsInfoForThreadMri(e);return a&&a.photoReactions.length?t>0||i?n.filter(a.photoReactions,((a,n)=>!(a.createdTime<=t)&&(!i||a.conversationId===e))):a.photoReactions:[]}getLastTranscriptionReaction(e,t=0){const i=this._reactionsInfoForThreadMri(e);if(!i||!i.transcriptionReactions.length)return;const a=n.last(i.transcriptionReactions);return a&&a.createdTime>t?a:void 0}getLastTranscriptionReactions(e,t=0){const i=this._reactionsInfoForThreadMri(e);if(!i||!i.transcriptionReactions.length)return[];return n.filter(i.transcriptionReactions,(e=>e.createdTime>t))}getEventsReaction(e,t=0){const i=this._reactionsInfoForThreadMri(e);return i&&i.eventReactions.length?t>0?n.filter(i.eventReactions,((i,a)=>!(i.createdTime<=t)&&i.conversationId===e)):i.eventReactions:[]}getLastEventReaction(e,t=0){const i=this._reactionsInfoForThreadMri(e);if(!i||!i.eventReactions.length)return;const a=n.last(i.eventReactions);return a&&a.createdTime>t?a:void 0}_clearOuterThreadAssignment(e,t){if(this._outerToInnerThreadMap[t]){const i=this._outerToInnerThreadMap[t];n.remove(i,(t=>t===e)),n.isEmpty(i)&&delete this._outerToInnerThreadMap[t]}}_putInnerOrOuterThreadReactions(e,t){const i=this._innerThreadMris(e),a=n.filter(i,(e=>this._putReactions(e,t)));this.trigger(a)}_putReactions(e,t){const i=this._reactionGroups[e];if(!i)return!1;let a=!1;return n.each(t,(t=>{if(t.isDeletedMessage())i.callReactionsInfo.allReactions=n.filter(i.callReactionsInfo.allReactions,(e=>e.cuid!==t.cuid)),i.callReactionsInfo.photoReactions=n.filter(i.callReactionsInfo.photoReactions,(e=>e.cuid!==t.cuid)),i.callReactionsInfo.textReactions=n.filter(i.callReactionsInfo.textReactions,(e=>e.cuid!==t.cuid)),i.callReactionsInfo.transcriptionReactions=n.filter(i.callReactionsInfo.transcriptionReactions,(e=>e.cuid!==t.cuid)),i.callReactionsInfo.eventReactions=n.filter(i.callReactionsInfo.eventReactions,(e=>e.cuid!==t.cuid));else{if(this._maybeUpdateReactionMessage(t,e))return;if(l.getMessageTypeGroup(t)===l.MessageTypeGroups.Picture)i.callReactionsInfo.photoReactions.push(t),h.default.isMyMri(t.creator)||i.unseenIncomingPhotoCount++;else{if(l.getMessageTypeGroup(t)!==l.MessageTypeGroups.Text)return;l.isCaptionMessageType(t.messagetype)?(i.callReactionsInfo.transcriptionReactions.push(t),i.unseenIncomingTranscriptionCount++):p.default.isCallEventReaction(t)?(i.callReactionsInfo.eventReactions.push(t),i.unseenIncomingEventsCount++):(i.callReactionsInfo.textReactions.push(t),t.isEmoticonCallReaction()||i.unseenIncomingTextCount++)}i.callReactionsInfo.allReactions.push(t)}a=!0})),u.log(d.LogTraceArea.CallReactions,"CallReactionsStore._putReactions, triggering changes: "+a+" innerThreadMri: "+g.mriOrId(e)+" unseenIncomingPhotoCount: "+i.unseenIncomingPhotoCount+" unseenIncomingTextCount: "+i.unseenIncomingTextCount),a}setAnimationIsPlaying(e){this._isAnimationPlaying=e}isAnimationPlaying(){return this._isAnimationPlaying}_maybeUpdateReactionMessage(e,t){const i=this._reactionsInfoForThreadMri(t);return!!i&&(!!this._replaceReactionMessage(e,i.allReactions)&&(l.getMessageTypeGroup(e)===l.MessageTypeGroups.Picture?this._replaceReactionMessage(e,i.photoReactions):l.getMessageTypeGroup(e)===l.MessageTypeGroups.Text&&(l.isCaptionMessageType(e.messagetype)?this._replaceReactionMessage(e,i.transcriptionReactions):p.default.isCallEventReaction(e)?this._replaceReactionMessage(e,i.eventReactions):this._replaceReactionMessage(e,i.textReactions)),!0))}_replaceReactionMessage(e,t){let i=n.findIndex(t,(t=>t.cuid===e.cuid));return i>=0&&(t.splice(i,1,e),!0)}_newCallReactionsGroup(){return{callReactionsInfo:{allReactions:[],photoReactions:[],textReactions:[],transcriptionReactions:[],eventReactions:[]},unseenIncomingPhotoCount:0,unseenIncomingTextCount:0,unseenIncomingTranscriptionCount:0,unseenIncomingEventsCount:0,hasPostedReactions:!1}}_reactionsInfoForThreadMri(e){const t=this._reactionGroups[e];if(t&&t.callReactionsInfo)return t.callReactionsInfo}_innerThreadMris(e){return this._reactionGroups[e]?[e]:this._outerToInnerThreadMap[e]||[]}_triggerForMri(e){const t=n.uniq(this._innerThreadMris(e));this.trigger(t)}test_putInnerOrOuterThreadReactions(e,t){this._putInnerOrOuterThreadReactions(e,t)}test_reset(){this._reactionGroups={},this._outerToInnerThreadMap={}}};(0,a.__decorate)([o.disableWarnings],m.prototype,"_startedTrackingKey",null),(0,a.__decorate)([o.disableWarnings],m.prototype,"_stoppedTrackingKey",null),(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],m.prototype,"getUnseenIncomingTextCount",null),(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],m.prototype,"getUnseenIncomingPhotoCount",null),(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],m.prototype,"getUnseenIncomingTranscriptionCount",null),(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],m.prototype,"getUnseenIncomingEventsCount",null),(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],m.prototype,"hasPostedReactions",null),(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],m.prototype,"getReactions",null),(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],m.prototype,"getTextReactions",null),(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],m.prototype,"getLastReaction",null),(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],m.prototype,"getPictureReactions",null),(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],m.prototype,"getLastTranscriptionReaction",null),(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],m.prototype,"getLastTranscriptionReactions",null),(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],m.prototype,"getEventsReaction",null),(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],m.prototype,"getLastEventReaction",null),(0,a.__decorate)([o.autoSubscribe],m.prototype,"isAnimationPlaying",null),m=(0,a.__decorate)([o.AutoSubscribeStore],m),t.default=new m},56018:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallScreenElementsStore=void 0;const a=i(70655),n=i(96486),o=i(48540),s=i(74958),r=i(88837),l=i(89391),c=i(36237),d=i(94224),u=i(36850),h=i(80200),p=i(46096),g=i(61253),C=i(46393),m=i(98925),S=i(53374),y=i(76514);let f=class extends r.StoreBase{constructor(){super(...arguments),this._statePerCallId=new Map}_startedTrackingKey(e){c.log(p.LogTraceArea.CallingUI,`CallScreenElementsStore._startedTrackingKey: callId ${e}`);const t={remoteCallElements:new Map,stageElements:[],trayElements:[],stageCapacity:Number.MAX_VALUE,trayWidth:Number.MAX_VALUE,trayRemainder:0,layoutStoreSubscription:u.default.subscribe((()=>this._onLayoutStoreUpdate(e)),e),callParticipantsStoreSubscription:d.default.CallParticipantStore.subscribe((()=>this._onParticipantsChanged(e)),e),callPinningStoreSubscription:y.default.subscribe((()=>this._onParticipantsChanged(e)),e)};this._statePerCallId.set(e,t),this._onLayoutStoreUpdate(e),this._onParticipantsChanged(e)}_stoppedTrackingKey(e){const t=S.default.newCauseId();c.log(p.LogTraceArea.CallingUI,"CallScreenElementsStore cleaning up subscriptions for call "+e+" causeId: "+t),this._cleanupFullscreenBotStreamOverrides(e,t);const i=this._getCallScreenElementsStateFor(e);i&&(u.default.unsubscribe(i.layoutStoreSubscription),d.default.CallParticipantStore.unsubscribe(i.callParticipantsStoreSubscription),y.default.unsubscribe(i.callPinningStoreSubscription),this._statePerCallId.delete(e))}_getCallScreenElementsStateFor(e){return this._statePerCallId.get(e)}_onLayoutStoreUpdate(e){var t;const i=u.default.getStageMode(e),a=S.default.newCauseId();c.log(p.LogTraceArea.CallingUI,"CallScreenElementsStore._onLayoutStoreUpdate: callId "+e+" stageMode: "+h.StageMode[i]+" causeId: "+a),this._cleanupFullscreenBotStreamOverrides(e,a);const n=this._getCallScreenElementsStateFor(e);n&&(n.manager=this._getStageModeManager(e,i,a),this._updateScreenElements(e,null===(t=n.manager)||void 0===t?void 0:t.onInit(this._getCallParticipantsMris(e)),a))}_cleanupFullscreenBotStreamOverrides(e,t){d.default.CallingStore.unregisterRemoteStreamOverride(e,m.VideoOverrideReason.FullScreenBot,t)}_registerFullscreenBotStreamOverrides(e,t){d.default.CallingStore.registerRemoteStreamOverride(e,m.VideoOverrideReason.FullScreenBot,t)}_updateScreenElements(e,t,i){t&&(this._setStageParticipants(e,t.stageParticipants),this._setTrayParticipants(e,t.trayParticipants),this._setTrayRemainder(e,t.trayRemainder||0))}_getStageModeManager(e,t,i){const a=this._getCallScreenElementsStateFor(e);if(a)switch(t){case h.StageMode.Grid:case h.StageMode.Manual:return new C.GridModeElementsManager(e,a.trayWidth,a.stageCapacity,u.default.getOnlyVideoOnTheStage(e),u.default.getSelfInTheGrid(e));case h.StageMode.Speaker:return new C.SpeakerModeElementsManager(e,a.trayWidth);case h.StageMode.Presentation:case h.StageMode.FocusedScreenShare:return new C.PresentationModeElementsManager(e,a.trayWidth);case h.StageMode.LargeGrid:return this._registerFullscreenBotStreamOverrides(e,i),new C.LgTmModeElementsManager(e,a.trayWidth,C.FullScreenBotType.LargeGrid);case h.StageMode.TogetherMode:return this._registerFullscreenBotStreamOverrides(e,i),new C.LgTmModeElementsManager(e,a.trayWidth,C.FullScreenBotType.TogetherMode)}else c.error(p.LogTraceArea.CallingUI,`CallScreenElementsStore._getStageModeManager call id '${e}' is undefined`)}_onParticipantsChanged(e){var t;const i=S.default.newCauseId(),a=this._getCallScreenElementsStateFor(e);if(!a)return void c.error(p.LogTraceArea.CallingUI,`CallScreenElementsStore._onParticipantsChanged call id '${e}' is undefined`);const s=[...this._getRemoteCallElements(e).keys()],r=d.default.CallParticipantStore.getParticipantRenderInfosForCall(e),l=[];r.forEach((e=>{a.remoteCallElements.set(e.renderKey,{mri:e.mri,renderKey:e.renderKey,participantState:e.state||o.ParticipantState.None,isScreenShare:e.isAScreensharing}),l.push(e.renderKey)}));const u=n.difference(s,l);n.each(u,(e=>{a.remoteCallElements.delete(e)})),this._updateScreenElements(e,null===(t=a.manager)||void 0===t?void 0:t.updateParticipants(this._getCallParticipantsMris(e)),i)}_setStageParticipants(e,t){const i=this._getCallScreenElementsStateFor(e);i?(0,g.default)(i.stageElements,t)||(c.log(p.LogTraceArea.CallingUI,"Stage participants for callId "+e+" updated. New stage elements: "+s.pii.Omit(t.toString())),i.stageElements=t,this.trigger(e)):c.error(p.LogTraceArea.CallingUI,`CallScreenElementsStore._setStageParticipants call id '${e}' is undefined`)}_setTrayParticipants(e,t){const i=this._getCallScreenElementsStateFor(e);i?n.xor(i.trayElements,t).length&&(c.log(p.LogTraceArea.CallingUI,"Tray participants for callId "+e+" updated. New tray elements: "+s.pii.Omit(t.toString())),i.trayElements=t,this.trigger(e)):c.error(p.LogTraceArea.CallingUI,`CallScreenElementsStore._setTrayParticipants call id '${e}' is undefined`)}_getCallParticipantsMris(e){const t=this._getCallScreenElementsStateFor(e);return t?l.default.getS4LCMCFeatures().enableMultipleStreamSupport?n.uniq(Array.from(t.remoteCallElements.values()).map((e=>e.renderKey||e.mri))):Array.from(t.remoteCallElements.keys()):(c.error(p.LogTraceArea.CallingUI,`CallScreenElementsStore._getCallParticipantsMris call id '${e}' is undefined`),[])}_setTrayRemainder(e,t){const i=this._getCallScreenElementsStateFor(e);i?i.trayRemainder!==t&&(i.trayRemainder=t,this.trigger(e)):c.error(p.LogTraceArea.CallingUI,`CallScreenElementsStore._setTrayRemainder call id '${e}' is undefined`)}_getRemoteCallElements(e){var t,i;return n.clone(null!==(i=null===(t=this._getCallScreenElementsStateFor(e))||void 0===t?void 0:t.remoteCallElements)&&void 0!==i?i:new Map)}getStageElements(e){var t,i;return n.clone(null!==(i=null===(t=this._getCallScreenElementsStateFor(e))||void 0===t?void 0:t.stageElements)&&void 0!==i?i:[])}getTrayElements(e){var t,i;return n.clone(null!==(i=null===(t=this._getCallScreenElementsStateFor(e))||void 0===t?void 0:t.trayElements)&&void 0!==i?i:[])}getTrayRemainder(e){var t,i;return null!==(i=null===(t=this._getCallScreenElementsStateFor(e))||void 0===t?void 0:t.trayRemainder)&&void 0!==i?i:0}trayHasParticipants(e){var t,i,a;return(null!==(a=null===(i=null===(t=this._getCallScreenElementsStateFor(e))||void 0===t?void 0:t.trayElements)||void 0===i?void 0:i.length)&&void 0!==a?a:0)>0}setStageCapacity(e,t){const i=this._getCallScreenElementsStateFor(e);if(!i)return void c.error(p.LogTraceArea.CallingUI,`CallScreenElementsStore.setStageCapacity call id '${e}' is undefined`);const{manager:a}=i;if(a&&a instanceof C.GridModeElementsManager&&i.stageCapacity!==t){i.stageCapacity=t;const n=this._getCallParticipantsMris(e),o=S.default.newCauseId();this._updateScreenElements(e,a.updateStageCapacity(n,i.stageCapacity),o),this.trigger(e)}}getStageCapacity(e){var t,i;return null!==(i=null===(t=this._getCallScreenElementsStateFor(e))||void 0===t?void 0:t.stageCapacity)&&void 0!==i?i:0}setTrayWidth(e,t){var i;const a=this._getCallScreenElementsStateFor(e);if(a){if(a.trayWidth!==t&&0!==t){a.trayWidth=t;const n=this._getCallParticipantsMris(e),o=S.default.newCauseId();this._updateScreenElements(e,null===(i=a.manager)||void 0===i?void 0:i.setTrayWidth(t,n),o)}}else c.error(p.LogTraceArea.CallingUI,`CallScreenElementsStore.setTrayWidth call id '${e}' is undefined`)}getRemoteCallElements(e,t=!1){return t&&this._onParticipantsChanged(e),this._getRemoteCallElements(e)}};(0,a.__decorate)([r.disableWarnings],f.prototype,"_startedTrackingKey",null),(0,a.__decorate)([r.disableWarnings],f.prototype,"_stoppedTrackingKey",null),(0,a.__decorate)([r.autoSubscribe,(0,a.__param)(0,r.key)],f.prototype,"getStageElements",null),(0,a.__decorate)([r.autoSubscribe,(0,a.__param)(0,r.key)],f.prototype,"getTrayElements",null),(0,a.__decorate)([r.autoSubscribe,(0,a.__param)(0,r.key)],f.prototype,"getTrayRemainder",null),(0,a.__decorate)([r.autoSubscribe,(0,a.__param)(0,r.key)],f.prototype,"trayHasParticipants",null),(0,a.__decorate)([r.autoSubscribe,(0,a.__param)(0,r.key)],f.prototype,"getStageCapacity",null),(0,a.__decorate)([(0,a.__param)(0,r.key)],f.prototype,"getRemoteCallElements",null),f=(0,a.__decorate)([r.AutoSubscribeStore],f),t.CallScreenElementsStore=f,t.default=new f},36850:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(70655),n=i(96486),o=i(88837),s=i(97691),r=i(89391),l=i(94224),c=i(9520),d=i(80200),u=i(71727),h=i(46096),p=i(36237),g=i(30124),C=i(22538),m=i(53374),S=i(78735),y=d.StageMode.Grid;let f=class extends o.StoreBase{constructor(){super(),this._stageLayoutMode={},this._fallbackStageLayoutMode={},this._callHeaderLayoutMode={},this._fallbackCallHeaderLayoutMode={},this._onlyVideoOnTheStage={},this._selfInTheGrid={},this._hideTopTray={},this._callScreenshareStoreSubscriptions={},this._callCallingStoreSubscriptions={},this._wasFullScreenBotAutoTriggered={},C.RegisterStartupable(this,"CallStageLayoutStore")}startup(){return s.Resolved()}onStartTrackingCall(e,t,i){this._setDefaultHeaderLayoutMode(e,t),this._setDefaultSelfInTheGrid(t,e),this.setStageMode(e,y,i,!0),this._subscribeToScreenshareStore(e),this._subscribeForFullScreenBots(e,t)}onStopTrackingCall(e){this._cleanUpStageLayoutSettings(e),this._unsubscribeFromScreenshareStore(e),this._unsubscribeForFullScreenBots(e)}_subscribeForFullScreenBots(e,t){this._callCallingStoreSubscriptions[e]||(this._callCallingStoreSubscriptions[e]=l.default.CallingStore.subscribe((()=>this._onCallingStoreChanged(e,t)),e))}_unsubscribeForFullScreenBots(e){this._callCallingStoreSubscriptions[e]&&(l.default.CallingStore.unsubscribe(this._callCallingStoreSubscriptions[e]),delete this._callCallingStoreSubscriptions[e],delete this._wasFullScreenBotAutoTriggered[e])}_onCallingStoreChanged(e,t){const i=m.default.newCauseId();if(l.default.CallingStore.isConnectedAudienceBotInCall(e)&&!this._wasFullScreenBotAutoTriggered[e]){p.log(h.LogTraceArea.Calling,`CallStageLayoutStore._onCallingStoreChanged with audience bot,\n                causeId: ${i}`),this._wasFullScreenBotAutoTriggered[e]=!0;const t=d.StageMode.TogetherMode;this._setFallbackStageMode(e,i,t),l.default.CallScreenShareStore.hasIncomingScreensharing(e)||(this._setStageMode(e,t,i,!0),this._setFallbackHeaderLayoutMode(e,i),this._setCallHeaderLayoutMode(e,d.CallPanelHeaderLayout.Window,i))}else if(!l.default.CallingStore.isPossiblyNotConnectedAudienceBotInCall(e)&&this._wasFullScreenBotAutoTriggered[e]){p.log(h.LogTraceArea.Calling,`CallStageLayoutStore._onCallingStoreChanged audience bot disconnected,\n                causeId: ${i}`),this._wasFullScreenBotAutoTriggered[e]=!1;const a=this._getStageMode(e);u.default.isTogetherMode(a)?(this._setDefaultHeaderLayoutMode(e,t),this.setStageMode(e,y,i,!0)):u.default.isInIncomingScreenshareMode(a)&&this._setFallbackStageMode(e,i,y)}}_subscribeToScreenshareStore(e){this._callScreenshareStoreSubscriptions[e]||(this._callScreenshareStoreSubscriptions[e]=l.default.CallScreenShareStore.subscribe((()=>this._onScreensharingChanged(e)),e))}_unsubscribeFromScreenshareStore(e){this._callScreenshareStoreSubscriptions[e]&&(l.default.CallScreenShareStore.unsubscribe(this._callScreenshareStoreSubscriptions[e]),delete this._callScreenshareStoreSubscriptions[e])}_onScreensharingChanged(e){const t=m.default.newCauseId();p.log(h.LogTraceArea.Calling,`CallStageLayoutStore._onScreensharingChanged, causeId: ${t}`),l.default.CallScreenShareStore.hasIncomingScreensharing(e)?this._applyScreensharingSettings(e,t):this._applyFallbackSettings(e,t)}_applyScreensharingSettings(e,t){this._setFallbackStageMode(e,t);const i=u.default.getScreensharingMode();this._setStageMode(e,i,t,!0),this._setFallbackHeaderLayoutMode(e,t),this._setCallHeaderLayoutMode(e,d.CallPanelHeaderLayout.Window,t)}_applyFallbackSettings(e,t){u.default.isInIncomingScreenshareMode(this._getStageMode(e))&&this._resetStageModeToFallback(e,t),this._resetHeaderModeToFallback(e)}getStageMode(e){return this._getStageMode(e)}_getStageMode(e){return n.isUndefined(this._stageLayoutMode[e])?y:this._stageLayoutMode[e]}setStageMode(e,t,i,a){this._setStageMode(e,t,i,a),n.isUndefined(this._fallbackStageLayoutMode[e])||delete this._fallbackStageLayoutMode[e]}getAvailableStageModes(e){const t=r.default.getS4LCMCFeatures(),i=[d.StageMode.Grid],a=l.default.CallingStore.isOneOnOneCall(e);l.default.CallScreenShareStore.hasIncomingScreensharing(e)?i.push(u.default.getScreensharingMode()):a||i.push(d.StageMode.Speaker);const n=l.default.CallingStore.isPSTNCall(e),o=l.default.CallingStore.isEncryptedCall(e);if(n||o)return i;return(a?t.callAudienceBotConfig.enabledOneOnOneCall:t.callAudienceBotConfig.enabledGroupCall)&&i.push(d.StageMode.TogetherMode),!a&&t.callGridViewBotConfig.enabled&&i.push(d.StageMode.LargeGrid),i}getAvailableStageModesV2(e){const t=r.default.getS4LCMCFeatures(),i=[],a=l.default.CallingStore.isOneOnOneCall(e);a||i.push(d.StageMode.Speaker),l.default.CallScreenShareStore.hasIncomingScreensharing(e)&&i.push(u.default.getScreensharingMode()),i.push(d.StageMode.Grid);const n=l.default.CallingStore.isPSTNCall(e),o=l.default.CallingStore.isEncryptedCall(e);if(n||o)return i;!a&&t.callGridViewBotConfig.enabled&&i.push(d.StageMode.LargeGrid);return(a?t.callAudienceBotConfig.enabledOneOnOneCall:t.callAudienceBotConfig.enabledGroupCall)&&i.push(d.StageMode.TogetherMode),i}_setStageMode(e,t,i,a){const n=this._stageLayoutMode[e];if(n!==t){this._stageLayoutMode[e]=t,p.log(h.LogTraceArea.Calling,`CallStageLayoutStore._setStageMode: call stage mode\n                changed from ${d.StageMode[n]} to ${d.StageMode[t]}, causeId: ${i}`);const o=this._getOnlyVideoOnTheStage(e),s=S.default.getUserPreferencesLocalNoSubscription().isNewCallScreenDesignEnabled;p.track(new c.CallStageLayoutChangeEvent(n,t,o,o,!!s,!!a)),this.trigger(e)}}_cleanUpStageLayoutSettings(e){delete this._stageLayoutMode[e],delete this._fallbackStageLayoutMode[e],delete this._callHeaderLayoutMode[e],delete this._fallbackCallHeaderLayoutMode[e],delete this._onlyVideoOnTheStage[e],delete this._selfInTheGrid[e],delete this._hideTopTray[e]}_setFallbackStageMode(e,t,i){const a=n.isUndefined(i)?this._stageLayoutMode[e]:i;this._fallbackStageLayoutMode[e]===a||u.default.isInIncomingScreenshareMode(a)||(this._fallbackStageLayoutMode[e]=a,p.log(h.LogTraceArea.Calling,`CallStageLayoutStore._setFallbackStageMode: fallback call stage mode\n                set to ${d.StageMode[a]}, causeId: ${t}`))}_resetStageModeToFallback(e,t){const i=this._fallbackStageLayoutMode[e];n.isUndefined(i)?(p.log(h.LogTraceArea.Calling,"CallStageLayoutStore.resetStageModeToFallback: No fallback mode found for call id "+e+" causeId: "+t),this.setStageMode(e,y,t,!0)):(p.log(h.LogTraceArea.Calling,`CallStageLayoutStore.resetStageModeToFallback: set stage mode\n                to ${d.StageMode[i]} , causeId ${t}`),this.setStageMode(e,i,void 0,!0),delete this._fallbackStageLayoutMode[e])}getCallHeaderLayoutMode(e){return n.isUndefined(this._callHeaderLayoutMode[e])?this._getDefaultHeaderLayout(!0):this._callHeaderLayoutMode[e]}setCallHeaderLayoutMode(e,t,i){n.isUndefined(this._fallbackCallHeaderLayoutMode[e])||delete this._fallbackCallHeaderLayoutMode[e],this._setCallHeaderLayoutMode(e,t,i)}_setDefaultHeaderLayoutMode(e,t){this._setCallHeaderLayoutMode(e,this._getDefaultHeaderLayout(t))}_setCallHeaderLayoutMode(e,t,i){const a=this._callHeaderLayoutMode[e];a!==t&&(this._callHeaderLayoutMode[e]=t,p.log(h.LogTraceArea.Calling,`CallStageLayoutStore._setCallHeaderLayoutMode: header layout mode\n                changed from ${d.CallPanelHeaderLayout[a]} to ${d.CallPanelHeaderLayout[t]},\n                causeId: ${i}`),this.trigger(e))}_setFallbackHeaderLayoutMode(e,t){const i=this._callHeaderLayoutMode[e];this._fallbackCallHeaderLayoutMode[e]!==i&&(this._fallbackCallHeaderLayoutMode[e]=i,p.log(h.LogTraceArea.Calling,`CallStageLayoutStore._setFallbackHeaderLayoutMode: fallback call header mode\n                set to ${d.CallPanelHeaderLayout[i]}, causeId: ${t}`))}_resetHeaderModeToFallback(e){const t=this._fallbackCallHeaderLayoutMode[e];n.isUndefined(t)?p.log(h.LogTraceArea.Calling,"No header fallback mode found for call id "+e):(p.log(h.LogTraceArea.Calling,`CallStageLayoutStore._resetHeaderModeToFallback: set header mode\n                to ${d.CallPanelHeaderLayout[t]}`),this.setCallHeaderLayoutMode(e,t),delete this._fallbackCallHeaderLayoutMode[e])}_getDefaultHeaderLayout(e){return g.default.isUsingStackNavigationContext()?d.CallPanelHeaderLayout.Mobile:e?d.CallPanelHeaderLayout.Window:d.CallPanelHeaderLayout.Float}getOnlyVideoOnTheStage(e){return this._getOnlyVideoOnTheStage(e)}_getOnlyVideoOnTheStage(e){return n.isUndefined(this._onlyVideoOnTheStage[e])?this._getDefaultOnlyVideoOnTheStage():this._onlyVideoOnTheStage[e]}_getDefaultOnlyVideoOnTheStage(){const e=r.default.getS4LCMCFeaturesNoSubscription();return!S.default.getUserPreferencesLocalNoSubscription().isNewCallScreenDesignEnabled&&!e.enableAudioParticipantsOnTheStageByDefault}setOnlyVideoOnTheStage(e,t,i){const a=this._onlyVideoOnTheStage[e];if(a!==t){this._onlyVideoOnTheStage[e]=t,p.log(h.LogTraceArea.Calling,`CallStageLayoutStore.setOnlyVideoOnTheStage: onlyVideoOnTheStage changed from ${a} to ${t}, causeId: ${i}`);const n=this._getStageMode(e),o=S.default.getUserPreferencesLocalNoSubscription().isNewCallScreenDesignEnabled;p.track(new c.CallStageLayoutChangeEvent(n,n,a,t,!!o,!1)),this.trigger(e)}}getSelfInTheGrid(e){return this._getSelfInTheGrid(e)}_getSelfInTheGrid(e){return!!n.isUndefined(this._selfInTheGrid[e])||this._selfInTheGrid[e]}_setDefaultSelfInTheGrid(e,t){this.setSelfInTheGrid(e,t)}setSelfInTheGrid(e,t){p.log(h.LogTraceArea.CallingUI,"Set local view on the stage to "+e);S.default.getUserPreferencesLocalNoSubscription().isNewCallScreenDesignEnabled?this._getSelfInTheGrid(t)!==e&&(this._selfInTheGrid[t]=e,this.trigger(t)):p.warn(h.LogTraceArea.CallingUI,"Attempt to set local video on stage when new call stage is not enabled")}isTopTrayHidden(e){return!!this._hideTopTray[e]}setHideTopTray(e,t){this._hideTopTray[t]!==e&&(this._hideTopTray[t]=e,this.trigger(t))}};(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],f.prototype,"getStageMode",null),(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],f.prototype,"getAvailableStageModes",null),(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],f.prototype,"getAvailableStageModesV2",null),(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],f.prototype,"getCallHeaderLayoutMode",null),(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],f.prototype,"getOnlyVideoOnTheStage",null),(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],f.prototype,"getSelfInTheGrid",null),(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],f.prototype,"isTopTrayHidden",null),f=(0,a.__decorate)([o.AutoSubscribeStore],f),t.default=new f},18154:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(70655),n=i(74958),o=i(96486),s=i(88837),r=i(89391),l=i(94224),c=i(78968),d=i(46096),u=i(36237),h=i(61253),p=i(18078),g=i(4057);let C=class extends s.StoreBase{constructor(){super(...arguments),this._transcriptionInfo={},this._reactionsStoreSubscription={}}_startedTrackingKey(e){this._reactionsStoreSubscription[e]||(this._reactionsStoreSubscription[e]=c.default.subscribe((()=>this._processReactionsStoreUpdate(e)),e),this._initStorage(e))}_stoppedTrackingKey(e){const t=this._reactionsStoreSubscription[e];t&&(c.default.unsubscribe(t),delete this._reactionsStoreSubscription[e])}_getTranscriptions(e,t){if(!this._transcriptionInfo[e])return[];let i=this._transcriptionInfo[e].transcriptions;if(o.isEmpty(i))return[];if(t){const a=this._transcriptionInfo[e].consumptionHorizon;i=a?o.filter(i,(e=>e.message.createdTime>=a)):o.clone(i),i.splice(0,Math.max(i.length-t,0))}else i=o.clone(i);return i}getTranscriptions(e,t){return this._getTranscriptions(e,t)}getTranscriptionsMerged(e,t){var i,a,n;const s=this._getTranscriptions(e,t),r=[];let l;for(let e of s){if(l===e.senderMri){const t=o.last(r);null===(i=null==t?void 0:t.messages)||void 0===i||i.push(e.message),null===(a=null==t?void 0:t.payloads)||void 0===a||a.push(e.payload),null===(n=null==t?void 0:t.sentences)||void 0===n||n.push(e.sentence)}else{const t=o.cloneDeep(e);t.messages=[t.message],t.payloads=[t.payload],t.sentences=[t.sentence],r.push(t)}l=e.senderMri}return r}transcriptionCount(e){return this._transcriptionInfo[e]?this._transcriptionInfo[e].transcriptions.length:0}resetUnseenTranscriptionCount(e){c.default.resetUnseenIncomingTranscriptionCount(e)}assignCallId(e,t){this._initStorage(e),this._transcriptionInfo[e].callId=t}clearCallIdAssignment(e){this._deleteStorage(e)}setConsumptionHorizon(e,t){this._transcriptionInfo[e]&&this._transcriptionInfo[e].consumptionHorizon!==t&&(this._transcriptionInfo[e].consumptionHorizon=t,this.trigger(e))}clearConsumptionHorizon(e){this.setConsumptionHorizon(e,0)}_processReactionsStoreUpdate(e){if(!this._transcriptionInfo[e])return;const t=this._transcriptionInfo[e].callId;if(!t)return;const i=l.default.CallingStore.getParticipantId(t);if(!i)return;if(l.default.CallingStore.isCallOnHold(t))return void u.log(d.LogTraceArea.CallingUI,"CallTranscriptionStore: Call is on hold, ignoring incoming subtitles");let a=c.default.getLastTranscriptionReactions(e,this._transcriptionInfo[e].lastItemTime);o.isEmpty(a)?u.log(d.LogTraceArea.CallingUI,"CallTranscriptionStore: no transcription reactions"):(o.each(a,(t=>{this._processTranscription(t,e,i),t.createdTime>this._transcriptionInfo[e].lastItemTime&&(this._transcriptionInfo[e].lastItemTime=t.createdTime)})),this.trigger(e))}_processTranscription(e,t,i){const a=g.default.parseJsonErrorToUndefined(e.content);if(!a||!a.sender||o.isEmpty(a.receivers)||!a.message&&!a.translation)return void u.warn(d.LogTraceArea.CallingUI,"CallTranscriptionStore: Invalid transcription payload: "+n.pii.Omit(e.content));if(!o.includes(a.receivers,i))return;const s=this._transcriptionInfo[t].transcriptions,l=o.findIndex(s,(e=>e.payload.cid===a.cid));let c=a.message||a.translation||"";if(l>=0){if((0,h.default)(s[l].payload,a))return;if(s[l].payload.isFinal&&!a.isFinal)return;!a.isFinal&&s[l].sentence&&(c=s[l].sentence+" "+c)}const p={message:e,payload:a,sentence:c,senderMri:this._getSenderMri(t,a.sender)};if(-1===l){const e=Math.max(50,r.default.getS4LCMCFeaturesNoSubscription().callCaptionsMaxHistory),t=s.length-e+1;t>0&&s.splice(0,t),s.push(p)}else s[l]=p}_getSenderMri(e,t){if(!this._transcriptionInfo[e])return;const i=this._transcriptionInfo[e].callId;if(!i)return;const a=l.default.CallingStore.getParticipantId(i);if(!a)return;if(t===a)return p.default.getSkypeMri();const n=l.default.CallingStore.findRemoteCallMemberByEndpointParticipantId(i,t);return n?n.id:void 0}_initStorage(e){this._transcriptionInfo[e]||(this._transcriptionInfo[e]={transcriptions:[],lastItemTime:0,consumptionHorizon:0})}_deleteStorage(e){this._transcriptionInfo[e]&&delete this._transcriptionInfo[e]}};(0,a.__decorate)([s.disableWarnings],C.prototype,"_startedTrackingKey",null),(0,a.__decorate)([s.disableWarnings],C.prototype,"_stoppedTrackingKey",null),(0,a.__decorate)([(0,a.__param)(0,s.key)],C.prototype,"_getTranscriptions",null),(0,a.__decorate)([s.autoSubscribe,(0,a.__param)(0,s.key)],C.prototype,"getTranscriptions",null),(0,a.__decorate)([s.autoSubscribe,(0,a.__param)(0,s.key)],C.prototype,"getTranscriptionsMerged",null),(0,a.__decorate)([s.autoSubscribe,(0,a.__param)(0,s.key)],C.prototype,"transcriptionCount",null),C=(0,a.__decorate)([s.AutoSubscribeStore],C),t.default=new C},46565:(e,t,i)=>{var a;Object.defineProperty(t,"__esModule",{value:!0});const n=i(70655),o=i(96486),s=i(88837),r=i(46096),l=i(36237);var c;!function(e){e[e.CallVisible=0]="CallVisible"}(c||(c={}));let d=a=class extends s.StoreBase{constructor(){super(...arguments),this._visibleCalls={},this._hasVisibleCall=!1,this._videoSuggestionTooltips={},this._callPreviewViews={}}isCallVisible(e){return!!this._visibleCalls[e]}hasVisibleCall(){return this._hasVisibleCall}isVideoSuggestionTooltipVisible(e){return!!this._videoSuggestionTooltips[e]}hasVideoSuggestionTooltipBeenSeen(e){return void 0!==this._videoSuggestionTooltips[e]}hasCallPreviewViewBeenSeen(e){return!!this._callPreviewViews[e]}setVideoSuggestionTooltipVisibility(e,t){this._videoSuggestionTooltips[e]=t,this.trigger(e)}setCallPreviewViewSeen(e){this._callPreviewViews[e]=!0,this.trigger(e)}setCallPreviewViewNotSeen(e){this._callPreviewViews[e]=!1,this.trigger(e)}setCallViewVisible(e,t,i){if(l.log(r.LogTraceArea.CallingUI,"CallVisibilityStore.setCallViewVisible: "+e+" visible: "+(t?"true":"false")+" causeId: "+i),!e)return;const n=!o.isEmpty(this._visibleCalls);if(t){let t=o.find(this._visibleCalls,(t=>t.callId===e));o.isUndefined(t)?this._visibleCalls[e]=a._visibleCall(e):t.refCounter++}else void 0!==this._visibleCalls[e]?(this._visibleCalls[e].refCounter--,this._visibleCalls[e].refCounter<=0&&delete this._visibleCalls[e]):l.warn(r.LogTraceArea.CallingUI,"CallVisibilityStore.setCallViewVisible: "+e+" trying to set visiblity false at a already invisible call");this._triggerUpdates(e,n)}_triggerUpdates(e,t=!0){this.trigger(e);const i=!o.isEmpty(this._visibleCalls);t!==i&&(this._hasVisibleCall=i,this.trigger(c.CallVisible))}static _visibleCall(e){return{callId:e,refCounter:1}}};(0,n.__decorate)([s.autoSubscribe,(0,n.__param)(0,s.key)],d.prototype,"isCallVisible",null),(0,n.__decorate)([(0,s.autoSubscribeWithKey)(c.CallVisible)],d.prototype,"hasVisibleCall",null),(0,n.__decorate)([s.autoSubscribe,(0,n.__param)(0,s.key)],d.prototype,"isVideoSuggestionTooltipVisible",null),(0,n.__decorate)([s.autoSubscribe,(0,n.__param)(0,s.key)],d.prototype,"hasVideoSuggestionTooltipBeenSeen",null),(0,n.__decorate)([s.autoSubscribe,(0,n.__param)(0,s.key)],d.prototype,"hasCallPreviewViewBeenSeen",null),d=a=(0,n.__decorate)([s.AutoSubscribeStore],d),t.default=new d},10190:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallingSettingsStore=t.CallingSettingsFeature=void 0;const a=i(70655),n=i(88837),o=i(89391),s=i(46096),r=i(36237),l=i(72816),c=i(4057);t.CallingSettingsFeature=class{};let d=class extends n.StoreBase{fetch(e=!1){if(this._callingSettings=o.default.getS4LCommerceFeatures().callingSettingsPanel,e)return;const t=this.callForwardingFeature();t&&t.clientEnabled&&this._fetchCallForwarding()}callForwardingFeature(){if(!this._callingSettings)return;const e=this._callingSettings.callForwarding;return{clientEnabled:e.enabled,link:e.link,goTarget:e.goTarget,fetched:void 0!==this._callForwardingEnabled,active:this._callForwardingEnabled}}_fetchCallForwarding(){l.default.getIsCallForwardingEnabledOption().then((e=>this._setCallForwardingEnabled(e))).catch((e=>{r.warn(s.LogTraceArea.Calling,"CallingSettingsStore: "+c.default.errorAsString(e)),this._setCallForwardingEnabled(void 0)}))}_setCallForwardingEnabled(e){this._callForwardingEnabled!==e&&(this._callForwardingEnabled=e,this.trigger())}};(0,a.__decorate)([n.autoSubscribe],d.prototype,"callForwardingFeature",null),d=(0,a.__decorate)([n.AutoSubscribeStore],d),t.CallingSettingsStore=d,t.default=new d},3493:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CelebrationType=void 0;const a=i(70655),n=i(94224),o=i(52262),s=i(46096),r=i(36237),l=i(61253),c=i(33754),d=i(18078),u=i(72758),h=i(88837);var p;!function(e){e[e.Birthday=0]="Birthday",e[e.SpecialDay=1]="SpecialDay"}(p=t.CelebrationType||(t.CelebrationType={}));let g=class extends h.StoreBase{constructor(){super(...arguments),this._celebrationConversations={}}_startedTrackingKey(e){this._celebrationConversations||(this._celebrationConversations={}),this._celebrationConversations[e]||(this._celebrationConversations[e]=this._newCelebrationConversation()),this._celebrationConversations[e].callIdToken||(r.log(s.LogTraceArea.Calling,"CelebrationStore subscribing to CallingStore for callId : "+e),this._celebrationConversations[e].callIdToken=n.default.CallingStore.subscribe((()=>{this._celebrationConversations[e]?(0,l.default)(this._celebrationConversations[e].participantMris,n.default.CallingStore.getRemoteCallMemberMris(e))||(r.log(s.LogTraceArea.Calling,"CelebrationStore triggering for callId : "+e),this._celebrationConversations[e].participantMris=n.default.CallingStore.getRemoteCallMemberMris(e),this.trigger()):r.warn(s.LogTraceArea.Calling,"No celebration conversation for callId : "+e)}),e))}_stoppedTrackingKey(e){const t=this._celebrationConversations[e];t&&t.callIdToken&&(r.log(s.LogTraceArea.Calling,"CelebrationStore unsubscribing from CallingStore for callId : "+e),n.default.CallingStore.unsubscribe(t.callIdToken),delete this._celebrationConversations[e])}_getCelebrateButtonText(e){const t=e.length;switch(t){case 0:return c.getString("ReactionsStream.CelebrateButtonGenericTitle");case 1:return c.getString("ReactionsStream.CelebrateButtonTitle1User",{firstUser:e[0]});case 2:return c.getString("ReactionsStream.CelebrateButtonTitle2Users",{firstUser:e[0],secondUser:e[1]});default:return c.getString("ReactionsStream.CelebrateButtonTitleMoreUsers",{firstUser:e[0],secondUser:e[1],count:t-2})}}_newCelebrationConversation(){return{callIdToken:void 0,participantMris:[]}}getCelebrationData(e,t){this._celebrationConversations||(this._celebrationConversations={}),this._celebrationConversations[t]||(this._celebrationConversations[t]=this._newCelebrationConversation());const i=this._celebrationConversations[t];if(i){(0,l.default)(i.participantMris,n.default.CallingStore.getRemoteCallMemberMris(t))||(i.participantMris=n.default.CallingStore.getRemoteCallMemberMris(t),this.trigger());let a=i.participantMris.filter((e=>this.isTodayBirthdayForParticipant(e,!1))),s=p.Birthday,r=a.map((t=>{let i=o.default.getMemberShortNameForConversation(e,t);return i||""}));if(a.length>0){return{recipientMris:a,recipientFirstNames:r,celebrationType:s,celebrationText:this._getCelebrateButtonText(r)}}}}isTodayBirthdayForParticipant(e,t){if(d.default.isMyMri(e)&&!t)return!1;const i=u.default.getFullUserProfileByMri(e).birthday;if(i){let e=new Date;e.setHours(0,0,0,0);let t=i.split("-");return e.getDate()===Number(t[2])&&e.getMonth()+1===Number(t[1])}return!1}isTodayBirthdayForParticipantProfile(e){const t=e.birthday;if(t){let e=new Date;e.setHours(0,0,0,0);let i=t.split("-");return e.getDate()===Number(i[2])&&e.getMonth()+1===Number(i[1])}return!1}};(0,a.__decorate)([h.disableWarnings],g.prototype,"_startedTrackingKey",null),(0,a.__decorate)([h.disableWarnings],g.prototype,"_stoppedTrackingKey",null),(0,a.__decorate)([h.autoSubscribe,(0,a.__param)(1,h.key)],g.prototype,"getCelebrationData",null),g=(0,a.__decorate)([h.AutoSubscribeStore],g),t.default=new g},11437:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(70655),n=i(96486),o=i(88837),s=i(97691),r=i(81169),l=i(62141),c=i(984);let d=class extends o.StoreBase{constructor(){super(...arguments),this._dbLookups={},this._usersByPhoneNumber={},this._usersByPhoneNumberPromise={}}_startedTrackingKey(e){this._dbLookups[e]||(this._dbLookups[e]=l.default.getUserProfilesByPhoneNumber(e).finally((()=>{delete this._dbLookups[e]})).then((t=>{this._isTrackingKey(e)&&(this._usersByPhoneNumber[e]=t,this.trigger(e))})))}_stoppedTrackingKey(e){const t=this._dbLookups[e];t&&(delete this._dbLookups[e],t.cancel()),delete this._usersByPhoneNumber[e]}getSortedUsersByPhoneNumber(e){return this._sortFoundUsers(this._usersByPhoneNumber[e])}getSortedUsersByPhoneNumberAsync(e){return this._usersByPhoneNumber[e]?s.Resolved(this._usersByPhoneNumber[e]):(this._usersByPhoneNumberPromise[e]||(this._usersByPhoneNumberPromise[e]=l.default.getUserProfilesByPhoneNumber(e).finally((()=>{delete this._usersByPhoneNumberPromise[e]})).then((e=>this._sortFoundUsers(e)))),this._usersByPhoneNumberPromise[e])}getUserByPhoneNumberExactMatch(e){return this._getFirstUserMriByExactPhone(this.getSortedUsersByPhoneNumber(e),e)}getUserByPhoneNumberExactMatchAsync(e){return this._usersByPhoneNumberPromise[e]||(this._usersByPhoneNumberPromise[e]=this.getSortedUsersByPhoneNumberAsync(e)),this._usersByPhoneNumberPromise[e].then((t=>this._getFirstUserMriByExactPhone(t,e)))}_getFirstUserMriByExactPhone(e,t){return n.find(e,(e=>!!e.phones&&!!n.find(e.phones,(e=>e.number===t))))}_sortFoundUsers(e){const t=c.default.dangerousGetContactMriListMutable();return(0,r.chain)(e,(0,r.filter)((e=>e.getMri()&&n.includes(t,e.getMri()))),(0,r.sortBy)((e=>e.getDisplayName().toLowerCase())))}test_reset(){this._dbLookups={},this._usersByPhoneNumberPromise={},this._usersByPhoneNumber={}}};(0,a.__decorate)([o.disableWarnings],d.prototype,"_startedTrackingKey",null),(0,a.__decorate)([o.disableWarnings],d.prototype,"_stoppedTrackingKey",null),(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],d.prototype,"getSortedUsersByPhoneNumber",null),(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],d.prototype,"getUserByPhoneNumberExactMatch",null),d=(0,a.__decorate)([o.AutoSubscribeStore],d);const u=new d;t.default=u},62633:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DialerUXStore=t.TriggerKeys=void 0;const a=i(70655),n=i(96486),o=i(88837),s=i(97691),r=i(89391),l=i(68734),c=i(44279),d=i(98278),u=i(27683),h=i(89871),p=i(29130),g=i(22538);var C;!function(e){e[e.CallerIdCTA=0]="CallerIdCTA",e[e.CallRate=1]="CallRate",e[e.DialpadCollapse=2]="DialpadCollapse",e[e.SaveContact=3]="SaveContact",e[e.TasterPromotion=4]="TasterPromotion",e[e.DialingExtension=5]="DialingExtension",e[e.CanDialComma=6]="CanDialComma"}(C=t.TriggerKeys||(t.TriggerKeys={}));let m=class extends o.StoreBase{constructor(){super(),this._isDialpadCollapsed=!1,this._shouldShowCallerIdCTA=!1,this._isCallerIdCTACollapsedInPortrait=!1,this._isCallerIdCTACollapsedInLandscape=!1,this._callRatesSubscriptions={},this._callRates={},this._rateIntegrationEnabled=!1,this._saveContactEnabled=!1,this._saveContactVisible=!1,this._tasterPromotionEnabled=!1,this._isRoomForTasterImage=!1,this._canDialComma=!1,this._isDialingExtension=!1,this._updateAppConfigFields=()=>{const e=r.default.getS4LEntitlementFeatures().SCE.UserServices.Client.Features.RateIntegrationEnabled;this._rateIntegrationEnabled!==e&&(this._rateIntegrationEnabled=e,this.trigger(C.CallRate),this._updateCallerIdCTAVisibility());const t=r.default.getS4LEntitlementFeatures().SCE.Dialpad.Features.SaveContactEnabled;this._saveContactEnabled!==t&&(this._saveContactEnabled=t,this._updateSaveContactVisibility(),this._updateCallerIdCTAVisibility());const i=r.default.getS4LEntitlementFeatures().SCE.Dialpad.Features.TasterPromotionEnabled;this._tasterPromotionEnabled!==i&&(this._tasterPromotionEnabled=i,this.trigger(C.TasterPromotion))},this._shouldShowCallerIdCTAUpdate=()=>{const e=l.default.shouldShowDialpadCTA();this._shouldShowCallerIdCTA!==e&&(this._shouldShowCallerIdCTA=e,this.trigger(C.CallerIdCTA))},this._searchResultsUpdate=()=>{this._contactSearchResults=h.default.getSearchResults(),this._updateSaveContactVisibility(),this._updateCallerIdCTAVisibility()},this._phoneNumberUpdate=()=>{this._phoneNumber=h.default.getPhoneNumber(h.TriggerKeys.E164),this.trigger(C.CallRate),this._updateSaveContactVisibility(),this._updateCallerIdCTAVisibility()},this._phoneNumberInputUpdate=()=>{this._phoneNumber=h.default.getPhoneNumber(h.TriggerKeys.InputValue),this._updateIsDialingExtension(),this._updateCanDialComma()},this._screenSizeUpdate=()=>{const e=p.default.isMobileScreenSize(d.MainRootViewId)&&!p.default.isHeightSmallerThanThreshold(710,d.MainRootViewId);this._isRoomForTasterImage!==e&&(this._isRoomForTasterImage=e,this.trigger(C.TasterPromotion))},this._updateSaveContactVisibility=()=>{const e=this._saveContactEnabled&&this._phoneNumber&&this._phoneNumber.callable&&!this._phoneNumber.emergency&&!this._phoneNumber.extension&&(!this._contactSearchResults||!this._contactSearchResults.selectedResult&&!this._contactSearchResults.exactMatch)&&!(this._callRates[this._phoneNumber.E164]&&this._callRates[this._phoneNumber.E164].isTasterEligible);this._saveContactVisible!==e&&(this._saveContactVisible=!!e,this.trigger(C.SaveContact))},this._updateCallerIdCTAVisibility=()=>{let e=!1,t=!1;this._phoneNumber&&this._callRates[this._phoneNumber.E164]&&(e=!0),this._contactSearchResults&&(this._contactSearchResults.results.length>0||this._contactSearchResults.selectedResult)&&(e=!0),this.isDialpadCollapsed()&&(e=!0),this._saveContactVisible&&(e=!0),this._phoneNumber&&this._phoneNumber.emergency&&(e=!0,t=!0),this._isCallerIdCTACollapsedInPortrait===e&&this._isCallerIdCTACollapsedInLandscape===t||(this._isCallerIdCTACollapsedInPortrait=e,this._isCallerIdCTACollapsedInLandscape=t,this.trigger(C.CallerIdCTA))},this._updateCanDialComma=()=>{const e=!!this._phoneNumber&&this._phoneNumber.callable;this._canDialComma!==e&&(this._canDialComma=e,this.trigger(C.CanDialComma))},this._updateIsDialingExtension=()=>{const e=!!this._phoneNumber&&!!this._phoneNumber.extension;this._isDialingExtension!==e&&(this._isDialingExtension=e,this.trigger(C.DialingExtension))},g.RegisterStartupable(this,"DialerUXStore")}startup(){return r.default.subscribe(this._updateAppConfigFields),this._updateAppConfigFields(),h.default.subscribe(this._searchResultsUpdate,h.TriggerKeys.SearchResults),this._searchResultsUpdate(),h.default.subscribe(this._phoneNumberUpdate,h.TriggerKeys.E164),this._phoneNumberUpdate(),h.default.subscribe(this._phoneNumberInputUpdate,h.TriggerKeys.InputValue),this._phoneNumberInputUpdate(),p.default.subscribe(this._screenSizeUpdate,p.TriggerKeys.ResponsiveWidth),p.default.subscribe(this._screenSizeUpdate,p.TriggerKeys.Height),this._screenSizeUpdate(),s.Resolved()}resetDialerPanelState(){this.toggleDialpadCollapse(!1)}toggleDialpadCollapse(e){this._isDialpadCollapsed=e,this._updateCallerIdCTAVisibility(),this.trigger(C.DialpadCollapse)}isDialpadCollapsed(){return this._isDialpadCollapsed}getCallRate(){if(!this._phoneNumber||!this._isValidPhoneNumber(this._phoneNumber.E164)||!this._rateIntegrationEnabled)return{};const e=this._phoneNumber.E164,t=u.default.stripPlusSign(e);return void 0===this._callRatesSubscriptions[e]&&(this._callRatesSubscriptions[e]=c.default.subscribe((()=>this._callRateUpdate(e)),t),this._callRates[e]={message:c.default.getCallRateByPhoneNumber(t),isTasterEligible:c.default.isPhoneNumberEligibleForTaster(t)}),this._callRates[e]}isSaveContactVisible(e,t){return!this._isInvalidNumberNotificationVisible(e,t)&&this._saveContactVisible}isCallerIdCTAVisibleInPortrait(e,t){return this._isCallerIdCTAVisible(e,t)&&!this._isCallerIdCTACollapsedInPortrait}isCallerIdCTAVisibleInLandscape(e,t){return this._isCallerIdCTAVisible(e,t)&&!this._isCallerIdCTACollapsedInLandscape}shouldShowRateAboveSelectedContact(){return!(this.tasterImageEnabled()&&this.getCallRate().isTasterEligible)}tasterImageEnabled(){return this._tasterPromotionEnabled&&this._isRoomForTasterImage}tasterCoachmarkEnabled(){return this._tasterPromotionEnabled&&!this._isRoomForTasterImage}tasterGreenCallButtonEnabled(){return this._tasterPromotionEnabled}isDialingExtension(){return this._isDialingExtension}canDialComma(){return this._canDialComma}_isCallerIdCTAVisible(e,t){return!this._isInvalidNumberNotificationVisible(e,t)&&(void 0===this._callerIdPromptStoreSubscription&&(this._callerIdPromptStoreSubscription=l.default.subscribe(this._shouldShowCallerIdCTAUpdate,l.TriggerKeys.DialpadCTA),this._shouldShowCallerIdCTA=l.default.shouldShowDialpadCTA()),this._shouldShowCallerIdCTA)}_isInvalidNumberNotificationVisible(e,t){return!!(e&&t&&this._phoneNumber&&this._phoneNumber.E164===t)}_isValidPhoneNumber(e){try{return!n.isEmpty(e)&&u.default.isValidNumberString(e)}catch(e){return!1}}_callRateUpdate(e){const t=u.default.stripPlusSign(e),i={message:c.default.getCallRateByPhoneNumber(t),isTasterEligible:c.default.isPhoneNumberEligibleForTaster(u.default.stripPlusSign(t))};this._callRates[e].message===i.message&&this._callRates[e].isTasterEligible===i.isTasterEligible||(this._callRates[e]=i,this.trigger(C.CallRate),this._updateCallerIdCTAVisibility()),c.default.unsubscribe(this._callRatesSubscriptions[e]),delete this._callRatesSubscriptions[e]}};(0,a.__decorate)([(0,o.autoSubscribeWithKey)(C.DialpadCollapse)],m.prototype,"isDialpadCollapsed",null),(0,a.__decorate)([(0,o.autoSubscribeWithKey)(C.CallRate)],m.prototype,"getCallRate",null),(0,a.__decorate)([(0,o.autoSubscribeWithKey)(C.SaveContact)],m.prototype,"isSaveContactVisible",null),(0,a.__decorate)([(0,o.autoSubscribeWithKey)(C.CallerIdCTA)],m.prototype,"isCallerIdCTAVisibleInPortrait",null),(0,a.__decorate)([(0,o.autoSubscribeWithKey)(C.CallerIdCTA)],m.prototype,"isCallerIdCTAVisibleInLandscape",null),(0,a.__decorate)([(0,o.autoSubscribeWithKey)([C.CallRate,C.TasterPromotion])],m.prototype,"shouldShowRateAboveSelectedContact",null),(0,a.__decorate)([(0,o.autoSubscribeWithKey)(C.TasterPromotion)],m.prototype,"tasterImageEnabled",null),(0,a.__decorate)([(0,o.autoSubscribeWithKey)(C.TasterPromotion)],m.prototype,"tasterCoachmarkEnabled",null),(0,a.__decorate)([(0,o.autoSubscribeWithKey)(C.TasterPromotion)],m.prototype,"tasterGreenCallButtonEnabled",null),(0,a.__decorate)([(0,o.autoSubscribeWithKey)(C.DialingExtension)],m.prototype,"isDialingExtension",null),(0,a.__decorate)([(0,o.autoSubscribeWithKey)(C.CanDialComma)],m.prototype,"canDialComma",null),m=(0,a.__decorate)([o.AutoSubscribeStore],m),t.DialerUXStore=m,t.default=new m},59799:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.E911Store=void 0;const a=i(70655),n=i(36345),o=i(31844),s=i(96486),r=i(88837),l=i(97691),c=i(89391),d=i(49663),u=i(46096),h=i(36237),p=i(93924),g=i(61253),C=i(46634),m=i(78735),S=i(81736),y=i(46929),f=i(35426),_=i(22538),b=(i(40363),i(78262));let T=class extends r.StoreBase{constructor(){super(),this.requiresSystemPermission=!1,this._supportsNativeEmergencyCalling=!1,_.RegisterStartupable(this,"E911Store",[S.default,y.default,m.default,C.default])}startup(){return o.default.supportsNativeEmergencyCalling().catch((()=>!1)).then((e=>{var t;if(this._supportsNativeEmergencyCalling=e,h.log(u.LogTraceArea.Phone,"E911Store: Native emergency calling capability checked, supports="+e),!e){let e,i=this._isLocationEnabled();if(c.default.subscribe((()=>{this.trigger();const e=this._isLocationEnabled();i!==e&&(i=e,e||this.resetLocation())})),this.requiresSystemPermission){let e=S.default.permissionStatus(b.PermissionType.Location)===p.PermissionStatus.Granted;s.isUndefined(m.default.isE911LocationConsentGranted())||m.default.setE911LocationConsentGranted(e),S.default.subscribe((()=>{if(!s.isUndefined(m.default.isE911LocationConsentGranted())){const t=S.default.permissionStatus(b.PermissionType.Location)===p.PermissionStatus.Granted;e!==t&&(m.default.setE911LocationConsentGranted(t),e=t,t||this.resetLocation())}}),b.PermissionType.Location)}else{let e=!!m.default.isE911LocationConsentGranted();m.default.subscribe((()=>{const t=!!m.default.isE911LocationConsentGranted();e!==t&&(e=t,t||this.resetLocation())}))}null===(t=n.default.getStack())||void 0===t||t.on("e911InfoChanged",(t=>{if((0,g.default)(e,t)){e=t;const i=c.default.getS4LEntitlementFeaturesNoSubscription().SCE.Dialpad.E911;this._canShareLocation()&&i.locationUpdateEventEnabled&&this.updateLocation(u.LocationUpdateReason.E911NetworkChange)}})),this._canShareLocation()&&this.updateLocationWithPermission(u.LocationUpdateReason.E911Startup)}}))}isEnabled(){return this._isEnabled()}_isEnabled(){if(this._supportsNativeEmergencyCalling)return!1;const e=c.default.getHeaders().CountryCode;if(!e)return!1;const t=c.default.getS4LEntitlementFeaturesNoSubscription().SCE.Dialpad.E911;return s.includes(t.enabledCountries,s.toLower(e))}isLocationEnabled(){return this._isLocationEnabled()}_isLocationEnabled(){const e=c.default.getS4LEntitlementFeaturesNoSubscription().SCE.Dialpad.E911;return this._isEnabled()&&e.locationEnabled}_canShareLocation(){return this._isLocationEnabled()&&!!m.default.isE911LocationConsentGranted()}shouldRequestAcknowledgementNoSubscription(){return!!this._isEnabled()&&(!y.default.isE911Acknowledged()||this._isLocationEnabled()&&s.isUndefined(m.default.isE911LocationConsentGranted()))}getEmergencyContentForNumberNoSubscription(e){const t=c.default.getS4LEntitlementFeaturesNoSubscription().SCE.Dialpad.E911;if(!s.includes(t.locationNumbers,e))return;if(!this._canShareLocation()||s.isUndefined(this._location))return;const i={pidf:this._location};return JSON.stringify(i)}requestLocationPermission(){return C.default.getLocationPermission(!0,b.PermissionType.Location)}updateLocation(e){if(!s.isUndefined(this._locationUpdatePromise))return h.log(u.LogTraceArea.Phone,"E911Store: Already updating location. Exit now."),this._locationUpdatePromise;h.log(u.LogTraceArea.Phone,"E911Store: Updating location. Reason: "+e);const t=c.default.getS4LEntitlementFeaturesNoSubscription().SCE.Dialpad.E911.locationUpdateThrottlingMs,i=this._locationUpdateTimestamp?Date.now()-this._locationUpdateTimestamp:void 0;if(!s.isUndefined(this._location)&&!s.isUndefined(i)&&i<t)return h.log(u.LogTraceArea.Phone,"E911Store: Location has been updated recently. Exit now."),l.Resolved(this._location);h.log(u.LogTraceArea.Phone,"E911Store: Resolving geo coordinates.");const a=C.default.updateLocation(e,!0).then((e=>{const t=null==e?void 0:e.coords;return s.isUndefined(t)?l.Rejected():(h.log(u.LogTraceArea.Phone,"E911Store: Geo coordinates resolved. Fetching location."),d.default.getBase64EncodedLocation(t.latitude,t.longitude,this._getCountryLocale()).then((e=>(this._location=e,this._locationUpdateTimestamp=Date.now(),h.track(new f.E911LocationUpdateEvent),h.log(u.LogTraceArea.Phone,"E911Store: Location is updated."),e))))})).catch((()=>(h.warn(u.LogTraceArea.Phone,"E911Store: Failed to update location: Couldn't resolve geo coordinates."),l.Rejected())));return this._locationUpdatePromise=a,a.finally((()=>{this._locationUpdatePromise=void 0})),a}updateLocationWithPermission(e){return this.requestLocationPermission().then((()=>this.updateLocation(e)))}resetLocation(){h.log(u.LogTraceArea.Phone,"E911Store: Resetting location."),this._location=void 0,this._locationUpdateTimestamp=void 0}_getCountryLocale(){const e=c.default.getHeaders().CountryCode;return s.toLower(e),"en-US"}};(0,a.__decorate)([r.autoSubscribe],T.prototype,"isEnabled",null),(0,a.__decorate)([r.autoSubscribe],T.prototype,"isLocationEnabled",null),T=(0,a.__decorate)([r.AutoSubscribeStore],T),t.E911Store=T,t.default=new T},21936:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TestableNdiConfigStore=void 0;const a=i(70655),n=i(52210),o=i(88837),s=i(62141),r=i(36237),l=i(98754),c=i(4057),d=i(53374);let u=class extends o.StoreBase{constructor(){super(),this._ndiConfig={isNdiEnabled:!1,watermarkLocation:"1,0"}}initialize(){const e=d.default.newCauseId(),t=l.default.getDataExclusive(s.InternalKeys.NdiConfig);if(r.log(n.LogTraceArea.Ndi,`NdiConfigStore.initialize. causeId: ${e}`),t){let e=!1;this._ndiConfig.isNdiEnabled===t.isNdiEnabled&&this._ndiConfig.watermarkLocation===t.watermarkLocation||(e=!0),this._ndiConfig.isNdiEnabled=t.isNdiEnabled,this._ndiConfig.watermarkLocation=t.watermarkLocation,e&&this.trigger()}r.log(n.LogTraceArea.Ndi,`Initial ndi config is ${JSON.stringify(this._ndiConfig)}`)}isNdiEnabled(){return this._ndiConfig.isNdiEnabled}setNdiEnabled(e){const t=d.default.newCauseId();this._ndiConfig.isNdiEnabled!==e?(r.log(n.LogTraceArea.Ndi,`updating isNdiEnabled to ${e}. causeId: ${t}`),this._ndiConfig.isNdiEnabled=e,this.trigger(),this._writeToUserConfig(t)):r.log(n.LogTraceArea.Ndi,`setNdiEnabled called with value same as current (${e}). causeId: ${t}`)}getWatermarkLocation(){return this._ndiConfig.watermarkLocation}setWatermarkLocation(e){const t=d.default.newCauseId();this._ndiConfig.watermarkLocation!==e?(r.log(n.LogTraceArea.Ndi,`updating watermarkLocation to ${e} causeId: ${t}`),this._ndiConfig.watermarkLocation=e,this.trigger(),this._writeToUserConfig(t)):r.log(n.LogTraceArea.Ndi,`setWatermarkLocation called with value same as current (${e}). causeId: ${t}`)}_writeToUserConfig(e){r.log(n.LogTraceArea.Ndi,`Writing ${JSON.stringify(this._ndiConfig)} to internalDataStore. causeId: ${e}`),l.default.putData(s.InternalKeys.NdiConfig,this._ndiConfig,void 0,e).catch((t=>r.warn(n.LogTraceArea.Ndi,`putData Failed. causeId: ${e} error: ${c.default.errorAsString(t)}`))).finally((()=>{r.log(n.LogTraceArea.Ndi,`Done writing. causeId: ${e}`)}))}};(0,a.__decorate)([o.autoSubscribe],u.prototype,"isNdiEnabled",null),(0,a.__decorate)([o.autoSubscribe],u.prototype,"getWatermarkLocation",null),u=(0,a.__decorate)([o.AutoSubscribeStore],u),t.TestableNdiConfigStore=u,t.default=new u},89871:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TriggerKeys=void 0;const a=i(70655),n=i(96486),o=i(88837),s=i(89391),r=i(81169),l=i(71830),c=i(11437),d=i(39549),u=i(51129),h=i(93389),p=i(46096),g=i(36237),C=i(18460),m=i(72136),S=i(27683),y=i(35426),f=i(12770),_=i(72758),b=i(10996),T=i(69399);var v;!function(e){e[e.InputValue=0]="InputValue",e[e.Emergency=1]="Emergency",e[e.E164=2]="E164",e[e.SelectedCountry=3]="SelectedCountry",e[e.Prefix=4]="Prefix",e[e.Callable=5]="Callable",e[e.SearchResults=6]="SearchResults"}(v=t.TriggerKeys||(t.TriggerKeys={}));let w=class extends o.StoreBase{constructor(){super(...arguments),this._phoneNumber={inputValue:"",E164:"",callable:!1,emergency:!1,forceChangedPrefix:!1,searchable:!0},this._searchResults={results:[],query:"",sessionId:""},this._searchCache=[],this._searchContacts={},this._searchInitialized=!1,this._searchCacheLoading=!1,this._lastCalledCountryCodes={},this._phoneNumberPrefixIndex={index:{},indexSize:0,maxLength:0}}getPhoneNumber(e){return this._phoneNumber}getSearchResults(){return this._searchResults}getSelectedCountry(){return this._selectedCountry}getDefaultCountry(){return this._defaultCountry}getAccessibilitySummary(){return{searchHasResults:!!this._searchResults.results.length&&!this._searchResults.selectedResult,selectedContactDisplayName:this._searchResults.selectedResult?this._searchResults.selectedResult.contact.displayName:void 0,selectedCountryName:this._selectedCountry?this._selectedCountry.countryName:void 0}}getLast5CalledCountriesNoSubscription(){return this._lastCalledCountryCodes}setSelectedCountry(e,t=!1){if(g.log(p.LogTraceArea.DialerStore,"setSelectedCountry("+JSON.stringify(e)+", "+t+")"),g.log(p.LogTraceArea.DialerStore,"selectedCountry state changed, from ["+JSON.stringify(this._selectedCountry)+"] to ["+JSON.stringify(e)+"]"),this._selectedCountry=e,this._setDefaultCountry(this._selectedCountry),t){let e="";this._selectedCountry&&(this._phoneNumber.suffix&&this._phoneNumber.E164?(g.log(p.LogTraceArea.DialerStore,"Preserving number input"),this._phoneNumber.suffix===this._phoneNumber.inputValue?(this._phoneNumber.prefix=n.toString(this._selectedCountry.countryCode),e=this._phoneNumber.suffix,this._recalculatePhoneNumberCountry(),this._recalculatePhoneNumberE164Format()):e=S.default.compilePhoneNumber(this._phoneNumber.suffix,this._selectedCountry.countryCode)):e="+"+this._selectedCountry.countryCode),this.overwritePhoneNumberInput(e,!!e)}this.setPhoneNumberOrigin(p.NavigationCallOrigin.PstnDialpadTyped),this.trigger(v.SelectedCountry)}_preselectCountry(){const e=s.default.getS4LEntitlementFeatures().SCE.Dialpad.ContactsSearch;if(!this._selectedCountry){const t=u.default.getDefaultPstnDestinationCountry();g.log(p.LogTraceArea.DialerStore,"_preselectCountry() Stored PSTN default country: "+JSON.stringify(t)),t&&this.setSelectedCountry(t,!e.T9SearchEnabled)}!e.T9SearchEnabled||this._searchResults&&this._searchResults.preselected||this.cleanupPhoneNumberInput()}cleanupPhoneNumberInput(e=!0){g.log(p.LogTraceArea.DialerStore,"cleanupPhoneNumberInput("+e+")"),this._setInputValue("",e),this.setPhoneNumberOrigin(p.NavigationCallOrigin.PstnDialpadTyped)}eraseCharFromPhoneNumberInput(e=!0){g.log(p.LogTraceArea.DialerStore,"eraseCharFromPhoneNumberInput("+e+")");const t=this._phoneNumber.inputValue.slice(-1),i=this._phoneNumber.inputValue.slice(0,-1);return this._setInputValue(i,e),this.setPhoneNumberOrigin(p.NavigationCallOrigin.PstnDialpadTyped),[t,i]}appendCharToPhoneNumberInput(e,t=!0){g.log(p.LogTraceArea.DialerStore,"appendCharToPhoneNumberInput(*, "+t+")"),e=u.default.filterPhoneNumberChar(this._phoneNumber.inputValue,e),this._setInputValue(this._phoneNumber.inputValue?this._phoneNumber.inputValue+e:e,t),this.setPhoneNumberOrigin(p.NavigationCallOrigin.PstnDialpadTyped)}overwritePhoneNumberInput(e,t=!0,i=p.NavigationCallOrigin.PstnDialpadTyped){g.log(p.LogTraceArea.DialerStore,"overwritePhoneNumberInput(*, "+t+")"),this._setInputValue(e,t),this.setPhoneNumberOrigin(i)}selectSearchResultItem(e){const t=this._searchResults.results[e];this.overwritePhoneNumberInput(t.phone.number,!1,p.NavigationCallOrigin.PstnDialpadSearchResult),this._resetSearchResults(),this._searchResults.results=[t],this._searchResults.exactMatch=t,this._searchResults.selectedResult=t,this.trigger(v.SearchResults)}initializeSearch(){this._searchInitialized||this._searchCacheLoading||(this._searchCacheLoading=!0,this._searchCachePromise=c.default.getSortedUsersByPhoneNumberAsync("+").then((e=>{this._searchCache=[],n.each(e,(e=>{this._searchContacts[e.getUniqueId()]={displayName:e.getDisplayName(),uniqueId:e.getUniqueId(),userMri:e.getMri()},n.each(e.phones,((t,i)=>{this._searchCache.push({contact:this._searchContacts[e.getUniqueId()],phone:t,t9SearchHash:u.default.mapKeypadLettersToNumbers(e.getDisplayName())})}))})),this._searchCache=h.DialerSearchUtils.sortByDisplayName(this._searchCache),g.log(p.LogTraceArea.DialerStore,"Contact search: [init], Contacts cache: ["+n.size(this._searchContacts)+"], Search cache: ["+n.size(this._searchCache)+"]"),this._localAddressBookSubToken||(this._localAddressBookSubToken=C.default.subscribe((()=>this._updateSearchCache()))),this._updateSearchCache(),this._searchInitialized=!0})).finally((()=>{this._searchCachePromise=void 0,this._searchCacheLoading=!1})))}_updateSearchCache(){const e=C.default.getFilteredSortedAddressBookContacts("",!0,!1);n.each(e,(e=>{this._searchContacts[e.getUniqueId()]={displayName:e.getDisplayName(),uniqueId:e.getUniqueId(),userMri:""},n.remove(this._searchCache,(t=>t.contact.uniqueId===this._searchContacts[e.getUniqueId()].uniqueId)),n.each(e.phones,((t,i)=>{this._searchCache.push({contact:this._searchContacts[e.getUniqueId()],phone:t,t9SearchHash:u.default.mapKeypadLettersToNumbers(e.getDisplayName())})}))})),g.log(p.LogTraceArea.DialerStore,"Contact search: [update], AB contacts: ["+e.length+"] Contacts cache: ["+n.size(this._searchContacts)+"], Search cache: ["+n.size(this._searchCache)+"]"),this._searchCache=h.DialerSearchUtils.sortByDisplayName(this._searchCache)}_scheduleSearch(e){if(this._cancelOngoingSearch(),!this._phoneNumber.searchable)return;this.initializeSearch();const t=s.default.getS4LEntitlementFeatures().SCE.Dialpad.ContactsSearch;this._phoneNumberHandlingPromise=f.default.sleep(t.ExecutionDelay).then((()=>{this._resetSearchResults();const i={resultsName:[],resultsNumber:[]};n.isEmpty(this._searchResults.query)||(n.each(this._searchCache,(e=>{if(t.T9SearchEnabled){let t=e.phone.number.indexOf(this._searchResults.query);-1!==t&&(e.matchedString=this._searchResults.query,i.resultsNumber.push(e)),t=e.t9SearchHash.indexOf(this._searchResults.query),-1!==t&&(e.matchedString=e.contact.displayName.substr(t,this._searchResults.query.length),i.resultsName.push(e))}else n.startsWith(e.phone.number,this._searchResults.query)&&(e.matchedString=this._searchResults.query,i.resultsNumber.push(e));e.phone.number===this._searchResults.query&&(this._searchResults.exactMatch=e)})),this._searchResults.results=i.resultsName.concat(i.resultsNumber),this._searchResults.sessionId=e,(0,b.searchResultsReceived)(T.ScenarioSearchTypes.FastContacts,e,this._isZeroTermSearch()))})).always((()=>{g.log(p.LogTraceArea.DialerStore,"Contact search: [results], Partial match: ["+this._searchResults.results.length+"] Exact match: ["+!!this._searchResults.exactMatch+"]"),this._phoneNumberHandlingPromise=void 0,this.trigger(v.SearchResults)}))}_isZeroTermSearch(){return 0===this._phoneNumber.inputValue.length}_cancelOngoingSearch(){if(this._phoneNumberHandlingPromise){const e=this._phoneNumberHandlingPromise;this._phoneNumberHandlingPromise=void 0,e.cancel()}}_resetSearchResults(){const e=s.default.getS4LEntitlementFeatures().SCE.Dialpad.ContactsSearch.T9SearchEnabled;this._searchResults.query=h.DialerSearchUtils.getSearchCriteria(this._phoneNumber,e),this._searchResults.results=[],this._searchResults.exactMatch=void 0,this._searchResults.selectedResult=void 0,this._searchResults.preselected=void 0}destroySearch(){if(this._cancelOngoingSearch(),this._searchInitialized&&(this._searchCache=[],this._searchContacts={},this._searchInitialized=!1,this._searchCachePromise)){const e=this._searchCachePromise;this._searchCacheLoading=!1,this._searchCachePromise=void 0,e.cancel()}this._localAddressBookSubToken&&(C.default.unsubscribe(this._localAddressBookSubToken),this._localAddressBookSubToken=void 0),this._resetSearchResults(),this.trigger(v.SearchResults),g.log(p.LogTraceArea.DialerStore,"Contact search: [destroy]")}initializeCountrySelection(){g.log(p.LogTraceArea.DialerStore,"CountrySelection: [init]");const e=n.sortBy(n.filter((0,d.default)().getAllConversationsInMemory(),(e=>e.isCurrentUserMember()&&!!e.lastCallTime&&l.isPhoneMri(e.id))),(e=>-1*(e.lastCallTime||0))),t=(0,r.chain)(e,(0,r.map)((e=>this._getRegionCodeForConversation(e))),(0,r.uniq)(),(0,r.compact)());this._lastCalledCountryCodes=(0,r.chain)(t,(0,r.take)(5),(0,r.map)((e=>["recent_"+e,m.default.getCountryByCode(e)])),(0,r.fromPairs)()),this._preselectCountry()}destroyCountrySelection(){this._lastCalledCountryCodes={},this._selectedCountry=void 0,this._defaultCountry=void 0,g.log(p.LogTraceArea.DialerStore,"CountrySelection: [destroy]")}resetPhoneNumber(){this._phoneNumber={inputValue:"",E164:"",callable:!1,emergency:!1,forceChangedPrefix:!1,searchable:!0},g.log(p.LogTraceArea.DialerStore,"PhoneNumber: [destroy]")}_setInputValue(e,t=!0){const i=n.uniqueId("Query");if((0,b.willSearch)(T.ScenarioSearchTypes.FastContacts,i),g.log(p.LogTraceArea.DialerStore,"_setInputValue(): [before] "+u.default.phoneNumberToString(this._phoneNumber)),this._phoneNumber.searchable=t,this._phoneNumber.inputValue===e)return;let a=this._processPhoneNumber(e);0!==a.length&&(a=n.uniq(a.concat(this._identifyEmergencyNumber())),this._identifyCallableNumber()&&a.push(v.Callable),g.log(p.LogTraceArea.DialerStore,"_setInputValue(): TriggerEvents",a),this.trigger(a),(0,b.searchCallSent)(T.ScenarioSearchTypes.FastContacts,i,this._isZeroTermSearch()),this._scheduleSearch(i),g.log(p.LogTraceArea.DialerStore,"_setInputValue(): [after] "+u.default.phoneNumberToString(this._phoneNumber)))}_processPhoneNumber(e){const t=[];e=u.default.normalizePhoneNumber(e);const i=S.default.stripPossibleExtension(e);return this._recalculatePhoneNumberPrefix(i)&&(t.push(v.Prefix),this._recalculatePhoneNumberCountry()),this._phoneNumber.suffix=u.default.getPhoneNumberSuffix(i,this._phoneNumber.prefix),this._phoneNumber.extension=S.default.getPossibleExtension(e,!0),u.default.isE164Format(i)&&(e=u.default.getFormattedPhoneNumber(e,this._phoneNumber.prefix)),this._phoneNumber.inputValue!==e&&(this._phoneNumber.inputValue=e,t.unshift(v.InputValue),this._recalculatePhoneNumberE164Format()&&t.push(v.E164)),t}_identifyEmergencyNumber(){let e=[],t=!1;if(u.default.isEmergencyNumber(this._phoneNumber)){t=!0;const i=u.default.getEmergencyCallingCountrySubstitute(this._phoneNumber.countryCode);if(i&&!u.default.isE164Format(this._phoneNumber.inputValue)){const t=u.default.getE164FormattedPhoneNumber(n.toString(i.countryCode),this._phoneNumber.suffix);e=this._processPhoneNumber(t),this._phoneNumber.forceChangedPrefix=!0}else this._phoneNumber.forceChangedPrefix=!1}return this._phoneNumber.emergency!==t&&(this._phoneNumber.emergency=t,e.push(v.Emergency),t&&g.track(new y.EmergencyNumber)),e}_identifyCallableNumber(){const e=u.default.isCallableNumber(this._phoneNumber);return this._phoneNumber.callable!==e&&(this._phoneNumber.callable=e,!0)}_recalculatePhoneNumberPrefix(e){if(this._phoneNumber.prefix&&1===e.indexOf(this._phoneNumber.prefix))return!1;let t;if(0!==e.indexOf("+")&&e.length>0){const e=this._selectedCountry||this._defaultCountry;e&&(t=n.toString(e.countryCode))}else t=u.default.getPhoneNumberPrefix(e,this._getPhoneNumberPrefixIndex());return this._phoneNumber.prefix!==t&&(this._phoneNumber.prefix=t,!0)}_recalculatePhoneNumberCountry(){const e=u.default.getPhoneNumberPrefixCountry(this._phoneNumber.prefix,this._getPhoneNumberPrefixIndex());e?this._phoneNumber.countryCode!==e.country&&(this._phoneNumber.countryCode=e.country,this._selectedCountry&&n.toString(this._selectedCountry.countryCode)===this._phoneNumber.prefix||this.setSelectedCountry(e)):this._selectedCountry&&(this._phoneNumber.countryCode=void 0,this.setSelectedCountry(void 0))}_recalculatePhoneNumberE164Format(){const e=u.default.getE164FormattedPhoneNumber(this._phoneNumber.prefix,this._phoneNumber.suffix);return this._phoneNumber.E164!==e&&(this._phoneNumber.E164=e,!0)}_setDefaultCountry(e){!e||this._defaultCountry&&this._defaultCountry.country===e.country||(void 0!==this._defaultCountry&&u.default.setDefaultPstnDestinationCountryCode(e.country),g.log(p.LogTraceArea.DialerStore,"Default country state changed, from ["+JSON.stringify(this._defaultCountry)+"] to ["+JSON.stringify(e)+"]"),this._defaultCountry=e)}_getRegionCodeForConversation(e){const t=l.stripMriNamespace(e.id);if(u.default.containsNonGeographicOrTestPrefixes(t))return;const i=S.default.parseAndKeepRawInput(t),a=S.default.getRegionCodeForNumber(i);return a?a.toLowerCase():void 0}_getPhoneNumberPrefixIndex(){return this._phoneNumberPrefixIndex.indexSize<=0&&(this._phoneNumberPrefixIndex=u.default.getCountryDestinationPrefixIndex(m.default.getCountries()),g.log(p.LogTraceArea.DialerStore,"PhoneNumberPrefixIndex init, indexSize:",this._phoneNumberPrefixIndex.indexSize)),this._phoneNumberPrefixIndex}setPhoneNumberOrigin(e){this._phoneNumberOrigin=e}resetPhoneNumberOrigin(){this._phoneNumberOrigin=void 0}getPhoneNumberOrigin(){return this._phoneNumberOrigin}preselectSavedContact(e){const t=_.default.getFullUserProfileByMriNoSubscription(e);if(t&&t.phones){this._resetSearchResults(),this._searchInitialized=!1;const e={contact:{displayName:t.getDisplayName(),uniqueId:t.getUniqueId(),userMri:t.getMri()},phone:t.phones[0]};this.overwritePhoneNumberInput(e.phone.number,!1,p.NavigationCallOrigin.PstnDialpadSaveContact),this._searchResults.results=[e],this._searchResults.exactMatch=e,this._searchResults.selectedResult=e,this._searchResults.preselected=!0,this.trigger(v.SearchResults)}}};(0,a.__decorate)([o.autoSubscribe,(0,a.__param)(0,o.key)],w.prototype,"getPhoneNumber",null),(0,a.__decorate)([(0,o.autoSubscribeWithKey)(v.SearchResults)],w.prototype,"getSearchResults",null),(0,a.__decorate)([(0,o.autoSubscribeWithKey)(v.SelectedCountry)],w.prototype,"getSelectedCountry",null),(0,a.__decorate)([(0,o.autoSubscribeWithKey)(v.SelectedCountry)],w.prototype,"getDefaultCountry",null),(0,a.__decorate)([(0,o.autoSubscribeWithKey)([v.SelectedCountry,v.SearchResults])],w.prototype,"getAccessibilitySummary",null),w=(0,a.__decorate)([o.AutoSubscribeStore],w),t.default=new w},72136:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(70655),n=i(96486),o=i(16778),s=i(88837),r=i(97691),l=i(81169),c=i(62141),d=i(72685),u=i(98754),h=i(72731),p=i(33754),g=i(78735),C=i(99075),m=i(22538),S=i(4057),y=i(15899);let f=class extends s.StoreBase{constructor(){super(),this._handleMemoryWarningEvent=()=>{this._countries={}},this._updateData=(e,t)=>{this._countries=(0,l.chain)(e,(0,l.uniqBy)((e=>e.MSShort)),(0,l.map)((e=>{const t=Number(e.TAPICode);if(!isNaN(t))return{country:n.toLower(e.MSShort),countryName:e.CountryRegionName,countryCode:t}})),(0,l.compact)(),(0,l.keyBy)((e=>e.country)));const i={countries:this._countries,language:t};u.default.putData(c.InternalKeys.PhoneCountryCache,i),this._locale=t,this.trigger()},p.localeChangedEvent.subscribe((e=>{m.HasStarted(this)&&e!==this._locale&&this._requestCountryConfig(e)})),m.RegisterStartupable(this,"PhoneCountryStore",[d.default,u.default,g.default])}startup(){return this._countries={},this._locale=p.getLocale(),o.App.memoryWarningEvent.subscribe(this._handleMemoryWarningEvent),d.default.setRefreshOptions(c.InternalKeys.PhoneCountryCache,{interval:6048e5,taskTypeFlags:d.TaskTypeFlags.UsesNetworking,callback:()=>this._requestCountryConfig(p.getLocale())}),r.Resolved()}getCountries(){return this._getCountries()}getCountryByCode(e){return this._getCountries()[e]}_getCountries(){if(n.isEmpty(this._countries)){const e=u.default.getData(c.InternalKeys.PhoneCountryCache);this._countries=e&&e.countries||{},n.isEmpty(this._countries)?(this._loadDataFromBackupFile(),m.EnsureStarted(this).then((()=>{d.default.fireEarly(c.InternalKeys.PhoneCountryCache)}))):e&&e.language!==p.getLocale()&&m.EnsureStarted(this).then((()=>{d.default.fireEarly(c.InternalKeys.PhoneCountryCache)}))}return this._countries}_requestCountryConfig(e,t=!0){return C.default.getConfig(e).then((t=>this._updateData(t,e))).catch((i=>{if(404===i.statusCode&&t){const t=this._getFallbackLocale(e);if(t!==e)return void this._requestCountryConfig(t,!1)}n.isEmpty(this._countries)&&this._loadDataFromBackupFile()}))}_loadDataFromBackupFile(){this._updateData(y,"en-US")}_getFallbackLocale(e){const t=e&&e.split("-")[0],i=h.getDefaultLocale(t);return`${t}-${S.default.toUpper(i)}`}};(0,a.__decorate)([s.autoSubscribe],f.prototype,"getCountries",null),(0,a.__decorate)([s.autoSubscribe,(0,a.__param)(0,s.key)],f.prototype,"getCountryByCode",null),f=(0,a.__decorate)([s.AutoSubscribeStore],f),t.default=new f},57876:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(70655),n=i(88837),o=i(97691),s=i(71830),r=i(11437);let l=class extends n.StoreBase{constructor(){super(...arguments),this._phoneNumberUserMri={}}_startedTrackingKey(e){const t=r.default.getUserByPhoneNumberExactMatch(e);this._phoneNumberUserMri[e]=t?t.getMri():void 0,this._updateUserMriByPhoneNumber(e)}getConversationMri(e){return this._phoneNumberUserMri[e]}getConversationMriAsync(e){const t=s.getPhoneNumberFromMri(e);return t?this._updateUserMriByPhoneNumber(t).then((()=>this._phoneNumberUserMri[t]||e)):o.Resolved(e)}_updateUserMriByPhoneNumber(e){return r.default.getUserByPhoneNumberExactMatchAsync(e).then((t=>{this._phoneNumberUserMri[e]=t?t.getMri():void 0,this.trigger(e)}))}};(0,a.__decorate)([n.disableWarnings],l.prototype,"_startedTrackingKey",null),(0,a.__decorate)([n.autoSubscribe,(0,a.__param)(0,n.key)],l.prototype,"getConversationMri",null),l=(0,a.__decorate)([n.AutoSubscribeStore],l),t.default=new l},75352:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MicrophoneSettingsOrigin=t.SettingsMode=void 0,function(e){e[e.All=0]="All",e[e.Audio=1]="Audio",e[e.Video=2]="Video"}(t.SettingsMode||(t.SettingsMode={})),function(e){e[e.AVSettings=0]="AVSettings",e[e.InCallPopup=1]="InCallPopup"}(t.MicrophoneSettingsOrigin||(t.MicrophoneSettingsOrigin={}))},76059:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TransferStatus=t.CallDirection=t.CallType=t.CallState=t.CallSessionType=t.ParticipantType=void 0,function(e){e.Default="default",e.Voicemail="voicemail"}(t.ParticipantType||(t.ParticipantType={})),function(e){e.Default="default",e.ScreenSharing="screenSharing"}(t.CallSessionType||(t.CallSessionType={})),function(e){e.Failed="failed",e.Missed="missed",e.Accepted="accepted",e.Declined="declined",e.AcceptedElsewhere="acceptedElsewhere"}(t.CallState||(t.CallState={})),function(e){e.TwoParty="twoParty",e.MultiParty="multiParty"}(t.CallType||(t.CallType={})),function(e){e.Incoming="incoming",e.Outgoing="outgoing"}(t.CallDirection||(t.CallDirection={})),function(e){e.Transferred="transferred",e.TransferAccepted="transferAccepted",e.TransferFailed="transferFailed",e.TransferSucceeded="transferSucceeded"}(t.TransferStatus||(t.TransferStatus={}))},98925:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenSharingPrefix=t.EcoMode=t.SlimcoreSetupKeys=t.KeyDistributionUrlType=t.UdpTransportUrlType=t.ConversationServiceUrlType=t.TranslationState=t.StartCallOrMaybePromptUserIntent=t.UnansweredCallVisualInfoType=t.UnansweredCallVisualInfo=t.UnansweredCallAction=t.UnansweredCallReason=t.CallingError=t.CallValidationFailureReason=t.LocalCallActions=t.VideoOverrideReason=t.CallDeviceQualityEventType=t.CallDeviceState=t.CallNetworkQualityEventType=t.NetworkConnectionState=void 0,function(e){e[e.Unknown=0]="Unknown",e[e.LostConnection=1]="LostConnection",e[e.Connecting=2]="Connecting",e[e.Connected=3]="Connected"}(t.NetworkConnectionState||(t.NetworkConnectionState={})),function(e){e[e.Unknown=0]="Unknown",e[e.NetworkReconnection=1]="NetworkReconnection",e[e.NetworkReceiveQuality=2]="NetworkReceiveQuality",e[e.NetworkReceiveCatastrophic=3]="NetworkReceiveCatastrophic",e[e.NetworkSendCatastrophic=4]="NetworkSendCatastrophic"}(t.CallNetworkQualityEventType||(t.CallNetworkQualityEventType={})),function(e){e[e.Working=0]="Working",e[e.NotWorking=1]="NotWorking"}(t.CallDeviceState||(t.CallDeviceState={})),function(e){e[e.None=0]="None",e[e.AudioStoppedWorking=1]="AudioStoppedWorking",e[e.AudioDeviceBusy=2]="AudioDeviceBusy",e[e.AudioDeviceMuted=3]="AudioDeviceMuted",e[e.MicrophoneStoppedWorking=4]="MicrophoneStoppedWorking",e[e.SpeakerStoppedWorking=5]="SpeakerStoppedWorking",e[e.VideoStoppedWorking=6]="VideoStoppedWorking",e[e.VideoTimedOut=7]="VideoTimedOut",e[e.VideoCameraBusy=8]="VideoCameraBusy",e[e.VideoSystemOutOfMemory=9]="VideoSystemOutOfMemory",e[e.DeviceCausingEcho=10]="DeviceCausingEcho",e[e.MicrophoneNotMuteButSilent=11]="MicrophoneNotMuteButSilent",e[e.DeviceRenderGlitches=12]="DeviceRenderGlitches",e[e.DeviceLowSNR=13]="DeviceLowSNR",e[e.DeviceClipping=14]="DeviceClipping",e[e.DeviceEcho=15]="DeviceEcho",e[e.DeviceMultipleEndpoints=16]="DeviceMultipleEndpoints",e[e.DeviceRenderZeroVolume=17]="DeviceRenderZeroVolume",e[e.CpuInsufficient=18]="CpuInsufficient",e[e.ZeroCaptureDevicesEnumerated=19]="ZeroCaptureDevicesEnumerated",e[e.ZeroRenderDevicesEnumerated=20]="ZeroRenderDevicesEnumerated",e[e.VideoCaptureDeviceFreeze=21]="VideoCaptureDeviceFreeze",e[e.AudioCapturePermissionDenied=22]="AudioCapturePermissionDenied",e[e.VideoCapturePermissionDenied=23]="VideoCapturePermissionDenied",e[e.VideoCaptureFreezeRecovered=24]="VideoCaptureFreezeRecovered",e[e.DeviceRenderHowling=25]="DeviceRenderHowling",e[e.PresentationAudioLoopbackDeviceState=26]="PresentationAudioLoopbackDeviceState",e[e.RemoteNetworkConnectivityIssue=27]="RemoteNetworkConnectivityIssue",e[e.AudioCaptureUltrasoundDetected=28]="AudioCaptureUltrasoundDetected",e[e.MusicModeNotAvailable=29]="MusicModeNotAvailable",e[e.CameraLighting=30]="CameraLighting",e[e.ImageRenderingQuality=31]="ImageRenderingQuality",e[e.AudioCaptureMusicDetectedWithHighNS=32]="AudioCaptureMusicDetectedWithHighNS",e[e.AudioCaptureMusicDetectedWithHighNSNotAvailable=33]="AudioCaptureMusicDetectedWithHighNSNotAvailable",e[e.AudioCaptureMusicDetectedWithLowNS=34]="AudioCaptureMusicDetectedWithLowNS"}(t.CallDeviceQualityEventType||(t.CallDeviceQualityEventType={})),function(e){e[e.Logout=0]="Logout",e[e.InBackground=1]="InBackground",e[e.AudioOnlyMode=2]="AudioOnlyMode",e[e.IncomingVideoDisabled=3]="IncomingVideoDisabled",e[e.FullScreenBot=4]="FullScreenBot"}(t.VideoOverrideReason||(t.VideoOverrideReason={})),function(e){e[e.None=0]="None",e[e.Initialized=1]="Initialized",e[e.StartedWithRing=2]="StartedWithRing",e[e.StartedGoLive=4]="StartedGoLive",e[e.Joined=8]="Joined",e[e.Answered=16]="Answered",e[e.Rejected=32]="Rejected",e[e.Ended=64]="Ended"}(t.LocalCallActions||(t.LocalCallActions={})),function(e){e[e.None=0]="None",e[e.InvalidLiveState=1]="InvalidLiveState",e[e.InvalidParameters=2]="InvalidParameters",e[e.PlatformNotSupported=3]="PlatformNotSupported",e[e.CalleeIsBlocked=4]="CalleeIsBlocked",e[e.CallingNotAllowed=5]="CallingNotAllowed",e[e.CallNotFound=6]="CallNotFound",e[e.ConversationNotFound=7]="ConversationNotFound",e[e.NoCameraPermission=8]="NoCameraPermission",e[e.NoMicPermission=9]="NoMicPermission",e[e.NoMicDetected=10]="NoMicDetected",e[e.OtherCallsOngoing=11]="OtherCallsOngoing",e[e.GogoNetwork=12]="GogoNetwork",e[e.CalleeDoesNotSupportCalling=13]="CalleeDoesNotSupportCalling",e[e.GroupTooLarge=14]="GroupTooLarge",e[e.OnePersonGroup=15]="OnePersonGroup",e[e.E2eeHandshakeIncomplete=16]="E2eeHandshakeIncomplete",e[e.RegularMemberInModeratedGroup=17]="RegularMemberInModeratedGroup"}(t.CallValidationFailureReason||(t.CallValidationFailureReason={}));class i extends Error{constructor(e,t,i,a,n){super(t),this.action=e,this.message=t,this.terminatedReason=i,this.failureType=a,this.validationReason=n}}t.CallingError=i,function(e){e[e.None=0]="None",e[e.PstnNumberUnavailable=1]="PstnNumberUnavailable",e[e.PstnCallTerminated=2]="PstnCallTerminated",e[e.PstnNumberForbidden=3]="PstnNumberForbidden",e[e.PstnBlockedByUs=4]="PstnBlockedByUs",e[e.PstnCouldNotConnectToSkypeProxy=5]="PstnCouldNotConnectToSkypeProxy",e[e.PstnSkypeoutAccountBlocked=6]="PstnSkypeoutAccountBlocked",e[e.NoAnswer=7]="NoAnswer",e[e.Decline=8]="Decline",e[e.DeclineParticipant=9]="DeclineParticipant",e[e.Unreachable=10]="Unreachable",e[e.LocalNetworkError=11]="LocalNetworkError",e[e.NoMicrophoneDetected=12]="NoMicrophoneDetected",e[e.MicrophonePermissionDenied=13]="MicrophonePermissionDenied",e[e.CameraPermissionDenied=14]="CameraPermissionDenied",e[e.MicAndCamPermissionDenied=15]="MicAndCamPermissionDenied",e[e.Unknown=16]="Unknown",e[e.InvalidNumber=17]="InvalidNumber",e[e.EmergencyCallDenied=18]="EmergencyCallDenied",e[e.Kicked=19]="Kicked",e[e.InsufficientFunds=20]="InsufficientFunds",e[e.BlockedRegulatoryIndia=21]="BlockedRegulatoryIndia",e[e.BlockedRegulatoryNetherlands=22]="BlockedRegulatoryNetherlands",e[e.TransferedToTwinCam=23]="TransferedToTwinCam",e[e.KickedOwn=24]="KickedOwn"}(t.UnansweredCallReason||(t.UnansweredCallReason={})),function(e){e[e.None=0]="None",e[e.SendMessage=1]="SendMessage",e[e.PromptForPermission=2]="PromptForPermission",e[e.SendFeedback=3]="SendFeedback",e[e.CallPSTN=4]="CallPSTN",e[e.ShowRegulatoryInfoIndia=5]="ShowRegulatoryInfoIndia",e[e.ShowRegulatoryInfoNetherlands=6]="ShowRegulatoryInfoNetherlands"}(t.UnansweredCallAction||(t.UnansweredCallAction={}));t.UnansweredCallVisualInfo=class{},function(e){e[e.Emoticon=0]="Emoticon",e[e.Icon=1]="Icon"}(t.UnansweredCallVisualInfoType||(t.UnansweredCallVisualInfoType={})),function(e){e[e.Generic=0]="Generic",e[e.Video=1]="Video",e[e.Audio=2]="Audio"}(t.StartCallOrMaybePromptUserIntent||(t.StartCallOrMaybePromptUserIntent={})),function(e){e[e.Disabled=0]="Disabled",e[e.Requested=1]="Requested",e[e.Pending=2]="Pending",e[e.Enabled=3]="Enabled",e[e.Cancelled=4]="Cancelled",e[e.Declined=5]="Declined"}(t.TranslationState||(t.TranslationState={})),function(e){e.Prod="https://api.cc.skype.com/conv/",e.Dev="http://api.conv-dev.skype.net/conv/"}(t.ConversationServiceUrlType||(t.ConversationServiceUrlType={})),function(e){e.Prod="udp://api.cc.skype.com:3478/",e.Dev="udp://api.conv-dev.skype.net:11000/"}(t.UdpTransportUrlType||(t.UdpTransportUrlType={})),function(e){e.Prod="https://api.cc.skype.com/kd/",e.Dev="http://api.conv-dev.skype.net/kd/"}(t.KeyDistributionUrlType||(t.KeyDistributionUrlType={})),function(e){e.UdpEnabled="*Lib/Call/NG/UdpEnabled",e.EnableUdpCanary="*Lib/Call/NG/EnableUdpCanary",e.EnableEncryptedHttp="*Lib/Call/NG/EnableEncryptedHttp",e.EnableEncryptedHttpForBroker="*Lib/Call/NG/EnableEncryptedHttpForBroker",e.ConversationServiceUrl="*Lib/Call/NG/ConversationServiceUrl",e.UdpTransportUrl="*Lib/Call/NG/UdpTransportUrl",e.KeyDistributionUrl="*Lib/Call/NG/KeyDistributionUrl",e.EnableEcoMode="*Lib/Call/EnableEcoMode",e.EnableDnsCache="*Lib/Call/NG/EnableDnsCache",e.TestContextKey="*Lib/Call/TestContextId",e.ECSClientType="*Lib/ECS/ClientType",e.AutoJoinOnConflict="*Lib/Call/NG/AutoJoinOnConflict",e.AdditionalVideoLinesForGroupCalls="*Lib/Call/NG/AdditionalVideoLinesForGroupCalls",e.MaxNrOfVideosVisibleInUI="*Lib/Call/MaxNrOfVideosVisibleInUI",e.EndpointMetadataSetupKey="*Lib/Call/EndpointMetadata",e.LogLevelKey="*Lib/LogLevel",e.AufLogLevelKey="*Lib/AufObjectLogLevel",e.LogRotationSizeKey="*Lib/Logging/Rotation/RotateSize",e.LogRetentionTimeKey="*Lib/Logging/Rotation/RetentionTime",e.LogULMaxSizeKey="*Lib/RootTools/Logging/Appender/MaxSize",e.LogULMaxFilesKey="*Lib/RootTools/Logging/Appender/MaxRotations",e.DeleteOldLogsKey="*Lib/Logging/Rotation/DeleteOldLogs",e.MediaStackLogEnabledKey="*Lib/Media/MediaLibraryLogFileEnabled",e.PreserveFirstLogKey="*Lib/Logging/Rotation/PreserveFirstLog",e.EdfRegistrationKey="*Lib/Call/NG/ForceEDFRegistration",e.RenewSkypeTokenKey="*Lib/Auth/EnableRenewSkypeToken",e.UiLanguageKey="*Lib/Call/NG/LanguageId",e.EmergencyCallingCountryKey="Lib/Call/EmergencyCountry",e.MediaLibraryLogFileEnabledKey="*Lib/Media/MediaLibraryLogFileEnabled",e.AsyncMediaInitKey="*Lib/AsyncMediaInit"}(t.SlimcoreSetupKeys||(t.SlimcoreSetupKeys={})),function(e){e[e.Off=0]="Off",e[e.MobileNetwork=1]="MobileNetwork",e[e.AllNetworks=2]="AllNetworks"}(t.EcoMode||(t.EcoMode={})),t.ScreenSharingPrefix="ss_"},80200:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BigTrayCallParticipantAvatarSize=t.BigTrayOverflowButtonWidth=t.BigTrayCallParticipantWidth=t.CallPanelHeaderHeight=t.RibbonType=t.DesktopMinCallPanelHeaderV2WidthBreakpoint=t.DesktopMinCallRibbonWidthBreakpoint=t.DesktopMinCallPanelHeaderWidthBreakpoint=t.DesktopMinSmallestNewCallControlsWidthBreakpoint=t.DesktopMediumtNewCallControlsWidthBreakpoint=t.DesktopMinStageTwoNewCallControlsWidthBreakpoint=t.DesktopMinNewCallControlsWidthBreakpoint=t.DesktopMinSmallestCallControlsWidthBreakpoint=t.DesktopMinStageTwoCallControlsWidthBreakpoint=t.DesktopMinCallControlsWidthBreakpoint=t.ParticipantEventType=t.CallControlsType=t.ReactionsItemType=t.PhotoAnimationDirection=t.ToastActionType=t.CallRosterOrigin=t.LayoutPickerMenuItemType=t.StageMode=t.DeviceStatusToastType=t.CallControlsKeys=t.InCallWarningViewType=t.CallParticipantStreamsStatus=t.ActiveCallStatus=t.VideoStatus=t.RibbonExtraVisibility=t.CallPanelHeaderLayout=t.ParticipantDragState=t.LayoutInfoVideoType=t.MobileTopTrayHeight=t.MobileNewHeaderHeight=t.DesktopTopTrayHeight=t.DesktopNewHeaderHeight=t.DesktopCallControlsHeight=t.CallStageViewMode=t.CallControlsOverflowItem=t.CallStageConfig=t.CallButtonSizes=t.RibbonSizes=t.CallAccessoryType=t.CallAccessoryPosition=t.HoveringParticipantSource=t.CallStageElementKeys=t.CallingViewUIPostion=t.CallingViewCornerPostion=t.CallUIState=void 0,t.CallTranscriptionBottomViewMinHeight=t.AudioNotificationOffset=t.LayoutPickerButtonWidth=t.MobileLayoutPickerItemHeight=t.DesktopLayoutPickerItemHeight=void 0;const a=i(11828);!function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.IncomingRing=2]="IncomingRing",e[e.OutgoingRing=3]="OutgoingRing",e[e.Disconnected=4]="Disconnected",e[e.Voicemail=5]="Voicemail",e[e.GoLiveSinglePlayer=6]="GoLiveSinglePlayer"}(t.CallUIState||(t.CallUIState={})),function(e){e[e.NotAtCorner=0]="NotAtCorner",e[e.UpperLeft=1]="UpperLeft",e[e.UpperRight=2]="UpperRight",e[e.BottomLeft=3]="BottomLeft",e[e.BottomRight=4]="BottomRight"}(t.CallingViewCornerPostion||(t.CallingViewCornerPostion={})),function(e){e[e.Stage=0]="Stage",e[e.Ribbon=1]="Ribbon",e[e.FloatingOnTop=2]="FloatingOnTop",e[e.RibbonWidowsMode=3]="RibbonWidowsMode"}(t.CallingViewUIPostion||(t.CallingViewUIPostion={})),t.CallStageElementKeys={remainderViewKey:"ringingview",callstageViewKey:"callview",screenShareViewKey:"screenshareview",callTextReactionViewKey:"calltextreactionview",ribbonModeViewKey:"ribbonmode",localUserKey:"local",addToCallViewKey:"addtocall",bingBackgrounds:"bingBackgrounds"},function(e){e[e.Participant=1]="Participant",e[e.Nametag=2]="Nametag"}(t.HoveringParticipantSource||(t.HoveringParticipantSource={})),function(e){e[e.Center=1]="Center",e[e.TopLeft=2]="TopLeft",e[e.TopRight=3]="TopRight",e[e.BottomLeft=4]="BottomLeft",e[e.BottomRight=5]="BottomRight"}(t.CallAccessoryPosition||(t.CallAccessoryPosition={})),function(e){e[e.Mute=1]="Mute",e[e.OnHold=2]="OnHold",e[e.Screensharing=3]="Screensharing"}(t.CallAccessoryType||(t.CallAccessoryType={})),t.RibbonSizes={ribbonItemSizeSmall:60,ribbonItemSizeLarge:100,defaultRibbonItemTopMargin:16,ribbonItemModernStageTopMargin:10,ribbonItemInnerMargin:16,ribbonItemMargin:16,ribbonItemRectBorderRadius:10,ribbonDropTargetSmallHeight:80,ribbonDropTargetLargeHeight:132,ribbonModeElementSize:40},t.CallButtonSizes={callbuttonExtraLargeSize:64,callbuttonLargeSize:52,callbuttonSmallSize:a.IconSize.size40,callbuttonExtraSmallSize:a.IconSize.size32,callbuttonSmallestSize:a.IconSize.size24},t.CallStageConfig={animationDuration:250,maxStageElements:4},function(e){e[e.Reactions=1]="Reactions",e[e.Chat=2]="Chat",e[e.AddPeople=3]="AddPeople",e[e.Gallery=4]="Gallery",e[e.Moments=5]="Moments",e[e.CallRecording=6]="CallRecording",e[e.CallTranslator=7]="CallTranslator",e[e.IncomingVideo=8]="IncomingVideo",e[e.AudienceChangeBackground=9]="AudienceChangeBackground",e[e.HeartReaction=10]="HeartReaction",e[e.CelebrationAnimation=11]="CelebrationAnimation",e[e.ThumbsUpReaction=12]="ThumbsUpReaction",e[e.MobileScreenSharing=13]="MobileScreenSharing",e[e.CallStats=14]="CallStats",e[e.BackgroundBlur=15]="BackgroundBlur",e[e.RaiseHands=16]="RaiseHands",e[e.LowerHands=17]="LowerHands",e[e.ChangeTogetherModeBackground=18]="ChangeTogetherModeBackground",e[e.BingBackgrounds=19]="BingBackgrounds",e[e.NoiseSuppression=20]="NoiseSuppression",e[e.TwinCam=21]="TwinCam"}(t.CallControlsOverflowItem||(t.CallControlsOverflowItem={})),function(e){e[e.None=0]="None",e[e.StageAndRibbon=1]="StageAndRibbon",e[e.RibbonOnly=2]="RibbonOnly",e[e.StageOnly=3]="StageOnly"}(t.CallStageViewMode||(t.CallStageViewMode={})),t.DesktopCallControlsHeight=70,t.DesktopNewHeaderHeight=40,t.DesktopTopTrayHeight=128,t.MobileNewHeaderHeight=0,t.MobileTopTrayHeight=t.DesktopTopTrayHeight,function(e){e[e.None=1]="None",e[e.Portrait=2]="Portrait",e[e.Landscape=3]="Landscape"}(t.LayoutInfoVideoType||(t.LayoutInfoVideoType={})),function(e){e[e.Unspecified=0]="Unspecified",e[e.Pan=1]="Pan",e[e.Move=2]="Move"}(t.ParticipantDragState||(t.ParticipantDragState={})),function(e){e[e.Mobile=0]="Mobile",e[e.Float=1]="Float",e[e.Window=2]="Window",e[e.None=3]="None"}(t.CallPanelHeaderLayout||(t.CallPanelHeaderLayout={})),function(e){e[e.None=0]="None",e[e.Hidden=1]="Hidden",e[e.Visible=2]="Visible"}(t.RibbonExtraVisibility||(t.RibbonExtraVisibility={})),function(e){e[e.None=0]="None",e[e.Available=1]="Available",e[e.Streaming=2]="Streaming"}(t.VideoStatus||(t.VideoStatus={})),function(e){e[e.None=0]="None",e[e.Connected=1]="Connected",e[e.OnHold=2]="OnHold"}(t.ActiveCallStatus||(t.ActiveCallStatus={})),function(e){e[e.None=0]="None",e[e.Single=1]="Single",e[e.Multiple=2]="Multiple"}(t.CallParticipantStreamsStatus||(t.CallParticipantStreamsStatus={})),function(e){e[e.Audio=0]="Audio",e[e.Network=1]="Network",e[e.Voicemail=2]="Voicemail",e[e.Forwarding=3]="Forwarding"}(t.InCallWarningViewType||(t.InCallWarningViewType={})),function(e){e.Mic="mic",e.MicQuickSettings="micQuickSettings",e.Video="video",e.VideoQuickSettings="videoQuickSettings",e.Dialpad="dialpad",e.Participants="participants",e.ScreenShare="screenShare",e.ScreenShareControl="screenShareControl",e.EndCall="endCall",e.RaiseHand="raiseHand",e.LowerHand="lowerHand",e.ShareLink="shareLink",e.ChangeScene="changeScene",e.Record="recordCall",e.ReactionsDrawer="reactionspicker",e.ReactionsPopover="reactionspopover",e.Overflow="overflow",e.Moments="moments",e.Chat="chat",e.TwinCam="twinCam",e.StopTwinCam="StopTwinCam",e.LiveCaptions="LiveCaptions"}(t.CallControlsKeys||(t.CallControlsKeys={})),function(e){e[e.None=0]="None",e[e.SpeakerDisconnected=1]="SpeakerDisconnected",e[e.MicrophoneDisconnected=2]="MicrophoneDisconnected",e[e.CompositeAudioAvailable=3]="CompositeAudioAvailable",e[e.AudioStoppedWorking=4]="AudioStoppedWorking",e[e.MicrophoneStoppedWorking=5]="MicrophoneStoppedWorking",e[e.SpeakerStoppedWorking=6]="SpeakerStoppedWorking",e[e.AudioDeviceBusy=7]="AudioDeviceBusy",e[e.SoundSharingStopped=8]="SoundSharingStopped",e[e.VideoStoppedWorking=9]="VideoStoppedWorking",e[e.VideoTimedOut=10]="VideoTimedOut",e[e.VideoSystemOutOfMemory=11]="VideoSystemOutOfMemory",e[e.VideoSystemBusy=12]="VideoSystemBusy",e[e.SpeakerChanged=13]="SpeakerChanged",e[e.MicrophoneChanged=14]="MicrophoneChanged",e[e.CameraChanged=15]="CameraChanged",e[e.DeviceCausingEcho=16]="DeviceCausingEcho",e[e.MicrophoneNotMuteButSilent=17]="MicrophoneNotMuteButSilent",e[e.MicrophoneServerMuted=18]="MicrophoneServerMuted",e[e.OutgoingVideoDisabledDuringScreenSharing=19]="OutgoingVideoDisabledDuringScreenSharing",e[e.DeviceRenderGlitches=20]="DeviceRenderGlitches",e[e.DeviceLowSNR=21]="DeviceLowSNR",e[e.DeviceClipping=22]="DeviceClipping",e[e.DeviceEcho=23]="DeviceEcho",e[e.DeviceMultipleEndpoints=24]="DeviceMultipleEndpoints",e[e.DeviceRenderZeroVolume=25]="DeviceRenderZeroVolume",e[e.CpuInsufficient=26]="CpuInsufficient",e[e.ZeroCaptureDevicesEnumerated=27]="ZeroCaptureDevicesEnumerated",e[e.ZeroRenderDevicesEnumerated=28]="ZeroRenderDevicesEnumerated",e[e.VideoCaptureDeviceFreeze=29]="VideoCaptureDeviceFreeze",e[e.AudioCapturePermissionDenied=30]="AudioCapturePermissionDenied",e[e.VideoCapturePermissionDenied=31]="VideoCapturePermissionDenied",e[e.VideoCaptureFreezeRecovered=32]="VideoCaptureFreezeRecovered",e[e.DeviceRenderHowling=33]="DeviceRenderHowling",e[e.PresentationAudioLoopbackDeviceState=34]="PresentationAudioLoopbackDeviceState",e[e.RemoteNetworkConnectivityIssue=35]="RemoteNetworkConnectivityIssue",e[e.AudioCaptureUltrasoundDetected=36]="AudioCaptureUltrasoundDetected",e[e.MusicModeNotAvailable=37]="MusicModeNotAvailable",e[e.CameraLighting=38]="CameraLighting",e[e.ImageRenderingQuality=39]="ImageRenderingQuality",e[e.VideoEffectsQualityChange=40]="VideoEffectsQualityChange",e[e.AudioCaptureMusicDetectedWithHighNS=41]="AudioCaptureMusicDetectedWithHighNS",e[e.AudioCaptureMusicDetectedWithHighNSNotAvailable=42]="AudioCaptureMusicDetectedWithHighNSNotAvailable",e[e.AudioCaptureMusicDetectedWithLowNS=43]="AudioCaptureMusicDetectedWithLowNS"}(t.DeviceStatusToastType||(t.DeviceStatusToastType={})),function(e){e[e.Speaker=0]="Speaker",e[e.FocusedScreenShare=1]="FocusedScreenShare",e[e.Grid=2]="Grid",e[e.Manual=3]="Manual",e[e.Presentation=4]="Presentation",e[e.TogetherMode=5]="TogetherMode",e[e.LargeGrid=6]="LargeGrid"}(t.StageMode||(t.StageMode={})),function(e){e[e.Divider=0]="Divider",e[e.StageModeSpeaker=1]="StageModeSpeaker",e[e.StageModeFocusedScreenShare=2]="StageModeFocusedScreenShare",e[e.StageModeGrid=3]="StageModeGrid",e[e.StageModeManual=4]="StageModeManual",e[e.StageModePresentation=5]="StageModePresentation",e[e.StageModeTogetherMode=6]="StageModeTogetherMode",e[e.StageModeLargeGrid=7]="StageModeLargeGrid",e[e.OnlyVideoOnTheStage=8]="OnlyVideoOnTheStage",e[e.Fullscreen=9]="Fullscreen",e[e.CallPanelHeaderLayoutMobile=10]="CallPanelHeaderLayoutMobile",e[e.CallPanelHeaderLayoutFloat=11]="CallPanelHeaderLayoutFloat",e[e.CallPanelHeaderLayoutWindow=12]="CallPanelHeaderLayoutWindow",e[e.CallPanelHeaderLayoutNone=13]="CallPanelHeaderLayoutNone",e[e.NewCallScreenToggle=14]="NewCallScreenToggle",e[e.SelfInTheGridToggle=15]="SelfInTheGridToggle",e[e.HidePeopleAtTop=16]="HidePeopleAtTop",e[e.ShowPeopleAtTop=17]="ShowPeopleAtTop",e[e.SwitchToDarkThemeStage=18]="SwitchToDarkThemeStage",e[e.SwitchToLightThemeStage=19]="SwitchToLightThemeStage"}(t.LayoutPickerMenuItemType||(t.LayoutPickerMenuItemType={})),function(e){e[e.FromGroupTitle=0]="FromGroupTitle",e[e.FromManageGroupButton=1]="FromManageGroupButton",e[e.FromParticipantCount=2]="FromParticipantCount",e[e.FromConversationIcon=3]="FromConversationIcon",e[e.GoLiveInformationView=4]="GoLiveInformationView",e[e.CallControls=5]="CallControls",e[e.OverflowMenu=6]="OverflowMenu",e[e.TrayOverflowButton=7]="TrayOverflowButton"}(t.CallRosterOrigin||(t.CallRosterOrigin={})),function(e){e[e.Actioned=0]="Actioned",e[e.ManualDismissed=1]="ManualDismissed",e[e.AutoDismissed=2]="AutoDismissed",e[e.Dismissed=3]="Dismissed"}(t.ToastActionType||(t.ToastActionType={})),function(e){e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Up=3]="Up",e[e.Zoom=4]="Zoom"}(t.PhotoAnimationDirection||(t.PhotoAnimationDirection={})),function(e){e[e.Sticker=0]="Sticker",e[e.Emoticon=1]="Emoticon",e[e.Snapshot=2]="Snapshot",e[e.Animation=3]="Animation",e[e.CallEvent=4]="CallEvent"}(t.ReactionsItemType||(t.ReactionsItemType={})),function(e){e[e.Default=0]="Default",e[e.CallMonitor=1]="CallMonitor",e[e.Mobile=2]="Mobile",e[e.DesktopMin=3]="DesktopMin",e[e.DesktopMinStageTwo=4]="DesktopMinStageTwo",e[e.DesktopMedium=5]="DesktopMedium",e[e.DesktopMinSmallest=6]="DesktopMinSmallest",e[e.DesktopIncomingRingToast=7]="DesktopIncomingRingToast"}(t.CallControlsType||(t.CallControlsType={})),function(e){e[e.Join=0]="Join",e[e.Leave=1]="Leave",e[e.Unavailable=2]="Unavailable",e[e.BotUnavailable=3]="BotUnavailable",e[e.Muted=4]="Muted",e[e.KickedOut=5]="KickedOut",e[e.HandRaised=6]="HandRaised",e[e.TogetherModeDesiredBackgroundAlreadySet=7]="TogetherModeDesiredBackgroundAlreadySet",e[e.TogetherModeBackgroundChangeFailed=8]="TogetherModeBackgroundChangeFailed",e[e.TogetherModeBackgroundChanged=9]="TogetherModeBackgroundChanged"}(t.ParticipantEventType||(t.ParticipantEventType={})),t.DesktopMinCallControlsWidthBreakpoint=1150,t.DesktopMinStageTwoCallControlsWidthBreakpoint=1e3,t.DesktopMinSmallestCallControlsWidthBreakpoint=850,t.DesktopMinNewCallControlsWidthBreakpoint=1200,t.DesktopMinStageTwoNewCallControlsWidthBreakpoint=1050,t.DesktopMediumtNewCallControlsWidthBreakpoint=899,t.DesktopMinSmallestNewCallControlsWidthBreakpoint=749,t.DesktopMinCallPanelHeaderWidthBreakpoint=824,t.DesktopMinCallRibbonWidthBreakpoint=1128,t.DesktopMinCallPanelHeaderV2WidthBreakpoint=700,function(e){e[e.Small=0]="Small",e[e.Large=1]="Large"}(t.RibbonType||(t.RibbonType={})),t.CallPanelHeaderHeight={mobile:72,window:80},t.BigTrayCallParticipantWidth={video:200,audio:120},t.BigTrayOverflowButtonWidth=t.BigTrayCallParticipantWidth.audio,t.BigTrayCallParticipantAvatarSize=64,t.DesktopLayoutPickerItemHeight=37,t.MobileLayoutPickerItemHeight=53,t.LayoutPickerButtonWidth=200,t.AudioNotificationOffset=30,t.CallTranscriptionBottomViewMinHeight=200},91570:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.QuickCallPanelMenuItemCommand=t.QuickCallPanelFilter=void 0,function(e){e[e.All=0]="All",e[e.Skype=1]="Skype",e[e.Phone=2]="Phone"}(t.QuickCallPanelFilter||(t.QuickCallPanelFilter={})),t.QuickCallPanelMenuItemCommand={all:"all",skype:"skype",phone:"phone"}},13598:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.zoomDrawerValues=t.zoomUiSizesText=t.ZoomDelayValues=t.ZoomLevelBoundaries=t.ScreenShareZoomType=void 0,function(e){e[e.ScrollWheel=0]="ScrollWheel",e[e.UIControls=1]="UIControls",e[e.Keyboard=2]="Keyboard",e[e.TrackPad=3]="TrackPad"}(t.ScreenShareZoomType||(t.ScreenShareZoomType={})),function(e){e[e.DefaultLevel=0]="DefaultLevel",e[e.MaxLevel=4]="MaxLevel"}(t.ZoomLevelBoundaries||(t.ZoomLevelBoundaries={})),function(e){e[e.MinDelay=60]="MinDelay",e[e.MaxDelay=120]="MaxDelay",e[e.TrackPadDelay=240]="TrackPadDelay"}(t.ZoomDelayValues||(t.ZoomDelayValues={})),t.zoomUiSizesText=["3","2.5","2","1.5","1"],t.zoomDrawerValues={minHeight:30,minOpacity:0,maxOpacity:1,openDuration:150,closeDuration:50,activeItemSize:28,nonActiveItemSize:22,itemMargin:7,lastItemMargin:3,coachMarkWidth:400}},24899:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(16778),o=i(89391),s=i(19061),r=i(67930),l=i(94224),c=i(2278),d=i(9520),u=i(87134),h=i(46096),p=i(10117),g=i(2301),C=i(67977),m=i(36237),S=i(15877),y=i(40522),f=i(33754),_=i(4735),b=i(17093),T=i(85683),v=i(90631),w=i(11828),I=i(80837),P=i(19675),M=i(53374),k=i(97634),A=C.UserIconSize.Size40,R=(0,S.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),headerContainer:()=>n.Styles.createViewStyle({alignSelf:"stretch",alignItems:"stretch"}),itemContainer:()=>n.Styles.createViewStyle({alignSelf:"stretch",alignItems:"stretch",flexDirection:"column",paddingHorizontal:20,marginBottom:10}),itemTextContainer:()=>n.Styles.createTextStyle({fontSize:15,cursor:"pointer"}),itemDivider:()=>n.Styles.createViewStyle({height:1}),sectionTitle:()=>n.Styles.createViewStyle({height:48,flexDirection:"row",alignItems:"center",justifyContent:"flex-start",paddingHorizontal:20}),userContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"flex-start",justifyContent:"flex-start",paddingVertical:12}),userIcon:()=>n.Styles.createViewStyle({marginRight:8}),enableFeature:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"stretch",justifyContent:"flex-start",paddingHorizontal:20}),enableFeatureText:()=>n.Styles.createViewStyle({flexDirection:"row",flexGrow:1,alignItems:"center"}),bingIconLeft:()=>n.Styles.createViewStyle({width:16,height:16,marginRight:10}),copyrightText:()=>n.Styles.createTextStyle({fontSize:12}),settignsPanelWrapper:()=>n.Styles.createViewStyle({paddingHorizontal:20}),settignsPanel:()=>n.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-start",marginTop:10,marginBottom:12}),topBgReplaceIcon:()=>n.Styles.createViewStyle({width:24,height:24,marginRight:10}),bgReplaceTextBlock:()=>n.Styles.createViewStyle({flexDirection:"column",justifyContent:"flex-start",flexShrink:1}),bgReplaceTitle:()=>n.Styles.createTextStyle({fontSize:13,paddingBottom:5}),bgReplaceText:()=>n.Styles.createTextStyle({fontSize:13}),bgReplaceTexHover:()=>n.Styles.createTextStyle({cursor:"pointer"})});class V extends r.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._onSettingsTextMouseOver=()=>{this.setState({settingsTextHover:!0})},this._onSettingsTextMouseLeave=()=>{this.setState({settingsTextHover:!1})},this._onSettingClick=()=>{const e=M.default.newCauseId();this._goBack(e),_.default.navigateToDesktopSettingsGroup(b.SettingsGroup.AudioVideoSettings,this._getRootViewId(),e)},this._closeView=()=>{const e=M.default.newCauseId();m.log(h.LogTraceArea.CallingUI,`[CallRosterView] _closeRoster, causeId: ${e}`),this._goBack(e)}}static getHeaderText(){return f.getString("CallPanel.CallRosterAccessibilityLabel")}_buildState(e,t){const i=l.default.CallParticipantBackgroundInfoStore.getBackgroundInfos(e.route.params.callId);return{captions:i,sortedCaptions:this._sortCaptions(i),isBingPictureOfDayBgSelected:l.default.CallParticipantBackgroundInfoStore.getBingBackgroundEnabled(),isBgReplaceEnabled:l.default.DeviceStore.isBackgroundReplacementEnabled()}}_sortCaptions(e){const t={};for(let i of a.values(e)){if(!(i.isoDate&&i.market&&i.caption&&i.copyright))continue;const e=i.market,a=i.isoDate;t[e]||(t[e]={});const n=i.userId;if(t[e][a])t[e][a].userIds.push(n);else{const o={caption:i.caption,copyright:i.copyright,link:i.link,market:e,isoDate:a,userIds:[n]};t[e][a]=o}}return t}_getHeader(){const e={closeButtonType:v.CloseButtonType.Close,onPress:this._closeView,title:f.getString("Global.CloseButtonTitle")},t=n.createElement(n.View,{style:I.default.flexOne});let i=f.getString("CallControls.BingBackgrounds");return n.createElement(n.View,{style:R.headerContainer},n.createElement(v.SimplePanelHeader,{panelName:i,useTransparentBackground:!0,leftButton:e,titleView:t}))}_renderList(){const e=[],{dividerColorStyle:t,secondaryTextColorStyle:i}=k.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride),{primaryIconColor:o,primaryBackgroundColor:s}=k.themeColors(this._getContext(),this.props.route.params.colorThemeOverride),r=[R.itemDivider,t],l=this.state.settingsTextHover?R.bgReplaceTexHover:void 0;if(this.state.isBgReplaceEnabled&&e.push(n.createElement(n.View,{style:R.settignsPanelWrapper},n.createElement(n.View,{style:R.settignsPanel},n.createElement(p.default,{color:o,icon:w.SkypeIcon.BackgroundReplacement,size:w.IconSize.size24,style:R.topBgReplaceIcon}),n.createElement(n.View,{style:R.bgReplaceTextBlock,onMouseOver:this._onSettingsTextMouseOver,onMouseLeave:this._onSettingsTextMouseLeave,onPress:this._onSettingClick},n.createElement(P.BodyText,{bold:!0,style:[R.bgReplaceTitle,l]},f.getString("AudioVideoSettings.BackgroundEffectBingCameraTitle2")),n.createElement(P.BodyText,{style:[R.bgReplaceText,i,l]},f.getString("AudioVideoSettings.BackgroundEffectBingCoachMarkText2")))),n.createElement(u.default,{key:"itemDivider",style:r}))),e.push(n.createElement(n.View,{style:R.sectionTitle},n.createElement(T.SectionTitle,{title:f.getString("CallPanel.BingBackgroundOverviewTitle"),titleStyles:I.default.flexOne}))),this.state.sortedCaptions)for(let t of a.keys(this.state.sortedCaptions)){const o=this.state.sortedCaptions[t];for(let t of a.keys(o)){const a=o[t],l=[];for(let e of a.userIds){const t=e;l.push(n.createElement(g.UserIcon,{key:"userIcon",userMri:t,size:A,useCircleForAgentMask:!0,statusBorderColor:s,style:R.userIcon}))}const c=n.createElement(n.View,{style:R.itemContainer},n.createElement(P.BodyText,{bold:!0,style:R.itemTextContainer,onPress:()=>{this._onClick(a)}},a.caption),n.createElement(P.BodyText,{style:[R.copyrightText,i]},a.copyright),n.createElement(n.View,{style:R.userContainer},l),n.createElement(u.default,{key:"itemDivider",style:r}));e.push(c)}}return n.createElement(n.ScrollView,{key:"scrollview"},e)}render(){const{primaryBackgroundColorStyle:e}=k.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride);return n.createElement(n.View,{style:[R.container,e]},this._getHeader(),this._renderList())}_onClick(e){const{callId:t}=this.props.route.params;if(t){const i=M.default.newCauseId();c.default.updateCallTelemetry(t,i,(e=>e.bingBackgroundEffectCaptionClick())),m.track(new d.BackgroundEffectsBingInfoClickEvent(t,e.isoDate,void 0,e.market,!1))}if(e.link){const t=`${o.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds.host}${e.link}`,i={browserTitle:f.getString("AudioVideoSettings.BackgroundEffectCategoryBing"),preventInAppNavigationForGuest:!s.default.canNavigateInApp()};y.openUrlWithParams({origin:h.BrowserOrigin.LinkNode,url:t,options:i,rootViewId:this._getRootViewId()})}}_getHeaderText(e){return V.getHeaderText()}}t.default=V},51060:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(16778),o=i(15877),s=i(33754),r=i(97634),l=i(67930),c=i(90631),d=i(10117),u=i(19675),h=i(87134),p=i(11828),g=i(58666),C=i(94224),m=i(71727),S=i(46096),y=i(4057),f=i(53374),_=i(36237),b=i(87331),T=i(89391),v=i(93194),w=i(38891),I=i(5581),P=i(11010),M=i(2278),k=(0,o.lazyProperties)({panel:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),scrollbar:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),itemDivider:()=>n.Styles.createViewStyle({height:1}),lineContainer:()=>n.Styles.createViewStyle({paddingVertical:2,paddingHorizontal:12,flexGrow:1,flexDirection:"row",justifyContent:"center",minHeight:46}),leftItem:()=>n.Styles.createViewStyle({flexGrow:0,width:20,justifyContent:"center"}),rightItem:()=>n.Styles.createViewStyle({flexGrow:0,justifyContent:"center"}),rightItemWidth:()=>n.Styles.createViewStyle({width:20}),textItem:()=>n.Styles.createViewStyle({flexGrow:1,paddingTop:2,flexBasis:"85%",paddingHorizontal:12,justifyContent:"center"}),textItemBody:()=>n.Styles.createTextStyle({fontSize:P.default.fontSize.size16})}),A={lineContainerWidth:{width:"100%"}};class R extends l.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._onStartClick=e=>{e.stopPropagation(),this.state.isCaptioning?this._stopTranslator():this._startTranslator()},this._startTranslator=()=>{const e=f.default.newCauseId();_.log(S.LogTraceArea.CallingUI,"CallCaptionsSettingsPanel._startTranslator causeId: "+e),m.default.announceSubtitleState(true,!1),C.default.InCallBotService.startTranslator(this.props.route.params.callId,e).then((()=>{m.default.announceSubtitleState(true,!0)})).catch((t=>{_.log(S.LogTraceArea.CallingUI,"CallCaptionsSettingsPanel._startTranslator error: "+y.default.errorAsString(t)+" causeId: "+e)}))},this._stopTranslator=()=>{const e=f.default.newCauseId();_.log(S.LogTraceArea.CallingUI,"CallCaptionsSettingsPanel._stopTranslator causeId: "+e),m.default.announceSubtitleState(false,!1),C.default.InCallBotService.stopTranslator(this.props.route.params.callId,e).then((()=>{m.default.announceSubtitleState(false,!0)}))},this._toggleLanguageMenu=e=>{e.stopPropagation();const t=f.default.newCauseId();_.log(S.LogTraceArea.CallingUI,`_toggleCaptionsLanguageMenu causeId: ${t}`);let i=s.getString("LanguageAndTranslationSettingsPanel.TranslationSelectLanguageTitle");const a=[];this.state.sortedLangs.map((e=>{a.push({text:this._getLanguageNameFromLocale(e),command:e})}));const n=this._getRootViewId(),o={anchor:()=>{},buttons:a,title:i};v.default.showWithActionMenuConfig({options:o,callback:e=>this._actuallyChangeLanguage(e,t),maintainAnchor:!1,rootViewId:n,useAlertForMobile:!0,useAlertForDesktop:this._useAlertForDesktop(),invokingEvent:void 0,allowScrolling:this._useAlertForDesktop()})},this._actuallyChangeLanguage=(e,t)=>{T.default.getS4LCMCFeaturesNoSubscription().callTranslatorBotConfig.languageSupport.speech.includes(e)?(I.default.setCallTranslatorSpokenLanguage(this.props.route.params.convId,e),this.setState({selectedLanguage:e})):_.log(S.LogTraceArea.CallingUI,`_toggleCaptionsLanguageMenu newLocale ${e} not in supported langs list. causeId: ${t}`)},this._setCaptionAlwaysMode=e=>{e.stopPropagation();const t=!this.state.captionsAlways;I.default.setCallTranslatorAlwaysStart(this.props.route.params.convId,t),this.setState({captionsAlways:t})}}static getHeaderText(){return s.getString("CallControlsOverFlowMenu.LiveCaptionsSettings")}_getHeaderText(e){return R.getHeaderText()}_buildState(e,t){const{callCaptionsLeftPanel:i,callCaptionsBottomPanel:a}=T.default.getS4LCMCFeatures(),n=C.default.InCallBotService.isTranslating(e.route.params.callId),o=C.default.InCallBotService.isCaptioningEnabled(e.route.params.callId),r=T.default.getS4LCMCFeaturesNoSubscription().callTranslatorBotConfig.languageSupport.speech,l=s.getLanguageFromLocale(),c=[...r].sort(((e,t)=>{const i=this._getLanguageNameFromLocale(e),a=this._getLanguageNameFromLocale(t);return i.localeCompare(a,l)}));return{isTranslating:n,isCaptioning:o,leftPanelEnabled:i.enabled,bottomPanelEnabled:a.enabled,sortedLangs:c}}componentDidMount(){super.componentDidMount();const e=I.default.getCallTranslatorSpokenLanguage(this.props.route.params.convId),t=I.default.getCallTranslatorCaptionsPositionMode(this.props.route.params.convId),i=I.default.getCallTranslatorAlwaysStart(this.props.route.params.convId);this.setState({selectedLanguage:e,captionPositionMode:t,captionsAlways:i})}_componentDidUpdate(e,t,i){if(e.route.params.convId!==this.props.route.params.convId){const t=I.default.getCallTranslatorCaptionsPositionMode(e.route.params.convId);t&&(I.default.setCallTranslatorCaptionsPositionMode(this.props.route.params.convId,t),this.setState({captionPositionMode:t}))}}render(){const e={closeButtonType:c.CloseButtonType.Close},t=n.createElement(c.SimplePanelHeader,{panelName:this._getHeaderText(this.state),leftButton:e}),{primaryBackgroundColorStyle:i,dividerColorStyle:a}=r.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride),{primaryIconColor:o}=r.themeColors(this._getContext(),this.props.route.params.colorThemeOverride),l=[k.itemDivider,a],C=n.createElement(d.default,{color:o,icon:p.SkypeIcon.Ok,size:p.IconSize.size20,style:[k.rightItem,k.rightItemWidth]}),m=s.getString("CaptionsSettings.ShowFloat"),S=!this.state.captionPositionMode||this.state.captionPositionMode===w.CaptionsPositionMode.float,y=S?C:void 0,f=S?[n.Types.AccessibilityTrait.Button,n.Types.AccessibilityTrait.Selected]:[n.Types.AccessibilityTrait.Button],_=n.createElement(n.Button,{style:[k.lineContainer,A.lineContainerWidth],onPress:this._setCaptionPositionMode(w.CaptionsPositionMode.float),title:m,accessibilityLabel:m,accessibilityTraits:f,importantForAccessibility:n.Types.ImportantForAccessibility.Yes,tabIndex:0},n.createElement(d.default,{color:o,icon:p.SkypeIcon.PanelFloatingFilled,size:p.IconSize.size20,style:k.leftItem}),n.createElement(n.View,{style:k.textItem},n.createElement(u.BodyText,{style:[k.textItemBody]},m)),y),T=s.getString("CaptionsSettings.ShowOnLeft"),v=this.state.captionPositionMode===w.CaptionsPositionMode.left,I=v?C:void 0,P=v?[n.Types.AccessibilityTrait.Button,n.Types.AccessibilityTrait.Selected]:[n.Types.AccessibilityTrait.Button],M=this.state.leftPanelEnabled?n.createElement(n.Button,{style:[k.lineContainer,A.lineContainerWidth],onPress:this._setCaptionPositionMode(w.CaptionsPositionMode.left),title:T,accessibilityLabel:T,accessibilityTraits:P,importantForAccessibility:n.Types.ImportantForAccessibility.Yes,tabIndex:0},n.createElement(d.default,{color:o,icon:p.SkypeIcon.PanelLeftFilled,size:p.IconSize.size20,style:k.leftItem}),n.createElement(n.View,{style:k.textItem},n.createElement(u.BodyText,{style:[k.textItemBody]},T)),I):void 0,R=s.getString("CaptionsSettings.ShowOnBottom"),V=this.state.captionPositionMode===w.CaptionsPositionMode.bottom,L=V?C:void 0,E=V?[n.Types.AccessibilityTrait.Button,n.Types.AccessibilityTrait.Checked]:[n.Types.AccessibilityTrait.Selected],B=this.state.bottomPanelEnabled?n.createElement(n.Button,{style:[k.lineContainer,A.lineContainerWidth],onPress:this._setCaptionPositionMode(w.CaptionsPositionMode.bottom),title:R,accessibilityLabel:R,accessibilityTraits:E,importantForAccessibility:n.Types.ImportantForAccessibility.Yes,tabIndex:0},n.createElement(d.default,{color:o,icon:p.SkypeIcon.PanelBottomFilled,size:p.IconSize.size20,style:k.leftItem}),n.createElement(n.View,{style:k.textItem},n.createElement(u.BodyText,{style:[k.textItemBody]},R)),L):void 0,O=this.state.selectedLanguage?g.getShortLanguageTitle(this.state.selectedLanguage):void 0;let D=s.getString("CaptionsSettings.LanguageSelected",{language:null!=O?O:""}),x=O?s.getString("CaptionsSettings.LanguageSelectedAccessibility",{language:null!=O?O:""}):s.getString("CaptionsSettings.SelectLanguageAccessibility");const N=n.createElement(n.Button,{style:[k.lineContainer,A.lineContainerWidth],onPress:this._toggleLanguageMenu,title:x,accessibilityLabel:x,accessibilityTraits:n.Types.AccessibilityTrait.Button,importantForAccessibility:n.Types.ImportantForAccessibility.Yes,tabIndex:0},n.createElement(d.default,{color:o,icon:p.SkypeIcon.SkypeTranslator,size:p.IconSize.size20,style:k.leftItem}),n.createElement(n.View,{style:k.textItem},n.createElement(u.BodyText,{style:[k.textItemBody]},D)),n.createElement(d.default,{color:o,icon:p.SkypeIcon.RightChevron,size:p.IconSize.size20,style:[k.rightItem,k.rightItemWidth]})),U=s.getString("CaptionsSettings.AlwaysMode"),F=this.state.captionsAlways?C:void 0,H=this.state.captionsAlways?[n.Types.AccessibilityTrait.Button,n.Types.AccessibilityTrait.Selected]:[n.Types.AccessibilityTrait.Button],z=n.createElement(n.Button,{style:[k.lineContainer,A.lineContainerWidth],onPress:this._setCaptionAlwaysMode,title:U,accessibilityLabel:U,accessibilityTraits:H,importantForAccessibility:n.Types.ImportantForAccessibility.Yes,tabIndex:0},n.createElement(d.default,{color:o,icon:p.SkypeIcon.Repeat,size:p.IconSize.size20,style:k.leftItem}),n.createElement(n.View,{style:k.textItem},n.createElement(u.BodyText,{style:[k.textItemBody]},U)),F),G=s.getString("CaptionsSettings.EnableCaptions"),W=this.state.isCaptioning?[n.Types.AccessibilityTrait.Button,n.Types.AccessibilityTrait.Selected]:[n.Types.AccessibilityTrait.Button],K=n.createElement(n.Button,{style:[k.lineContainer,A.lineContainerWidth],title:G,accessibilityLabel:G,onPress:this._onStartClick,accessibilityTraits:W,importantForAccessibility:n.Types.ImportantForAccessibility.Yes,tabIndex:0},n.createElement(d.default,{color:o,icon:p.SkypeIcon.ClosedCaption,size:p.IconSize.size20,style:k.leftItem}),n.createElement(n.View,{style:k.textItem},n.createElement(u.BodyText,{style:[k.textItemBody]},G)),n.createElement(b.default,{isOn:this.state.isCaptioning,style:k.rightItem}));return n.createElement(n.View,{style:[k.panel,i]},t,n.createElement(n.ScrollView,{key:"scrollview",style:k.scrollbar},K,n.createElement(h.default,{key:"itemDivider",style:l}),N,z,_,M,B))}_getLanguageNameFromLocale(e){const t=g.getShortLanguageTitle(e);return a.isEmpty(t)?e:t}_useAlertForDesktop(){return!0}_setCaptionPositionMode(e){return t=>{if(t.stopPropagation(),this.state.captionPositionMode!==e){const t=f.default.newCauseId();I.default.setCallTranslatorCaptionsPositionMode(this.props.route.params.convId,e),M.default.onCaptionPositionModeChanged(this.props.route.params.callId,e,t),this.setState({captionPositionMode:e})}}}}t.default=R},69254:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallControls=void 0;const a=i(67294),n=i(16778),o=i(50646),s=i(80200),r=i(30150),l=()=>{};t.CallControls=(0,a.memo)((()=>{const{conversationMri:e,callId:t}=(0,r.useCallInfo)(),{callUIState:i}=(0,r.useCallState)(),{toggleChatPanel:a}=(0,r.useSidePanels)();return n.createElement(o.default,{conversationMri:e,callId:t,callUIState:i,controlsType:s.CallControlsType.Default,isShowingChat:!1,isShowingRecents:!1,isShowingAloneInCall:!1,shouldShowReactions:!1,isHidden:!1,onOpenDialpad:l,onInteracting:l,onAddToCall:l,onShowParticipants:l,onChatPanelButtonPress:a,onReactionPickerButtonHover:l,onReactionsPickerButtonPress:l,onEndCallFailure:l,onChatButtonRef:l,onMomentsPress:l,onRecordCallPress:l,showHideOutgoingVideoDisabledToast:l,showParticipantsButton:!1,isNewCallScreen:!0,isPSTNCall:!1,isEncryptedCall:!1})}))},43906:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallPanel=void 0;const a=i(16778),n=i(81878),o=i(67294),s=i(48540),r=i(51832),l=i(10908),c=i(69254);t.CallPanel=(0,o.memo)((()=>((()=>{const{onCallDisconnected:e,callState:t}=(0,r.useCallPanelContext)();(0,o.useEffect)((()=>{t!==s.CallState.Disconnecting&&t!==s.CallState.Disconnected||e()}),[e,t])})(),a.createElement(n.Box,{flexGrow:"1",direction:"column"},a.createElement(l.CallStage,null),a.createElement(n.Box,{flexGrow:"0"},a.createElement(c.CallControls,null)))))),t.default=e=>a.createElement(r.default,Object.assign({},e),a.createElement(t.CallPanel,null))},10908:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallStage=void 0;const a=i(16778),n=i(67294),o=i(81878),s=i(57033),r=i(30150);t.CallStage=(0,n.memo)((()=>{const[e,t]=(0,n.useState)({x:0,y:0,width:0,height:0}),{isOneOnOne:i,conversationMri:l,reactionsConversationMri:c,callId:d}=(0,r.useCallInfo)(),{stageLayoutMode:u}=(0,r.useStageMode)();return a.createElement(o.Box,{flexGrow:"1",onLayout:e=>{t(e.nativeEvent.layout)}},a.createElement(s.CallStageViewV2,{viewRect:e,callId:d,isOneOnOneConversation:i,conversationMri:l,reactionsConversationId:c,stageLayoutMode:u,isLandscape:!0}))}))},51832:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useCallPanelContext=t.CallPanelContext=t.defaultContextValue=void 0;const a=i(16778),n=i(67294),o=i(88837),s=i(48540),r=i(94224),l=i(58187),c=i(4735),d=i(53374),u=i(71727),h=i(71830),p=i(36850),g=i(80200);t.defaultContextValue={callInfo:{conversationMri:"",callId:"",reactionsConversationMri:"",isOneOnOne:!1,forwardingDestinationType:"none"},callState:s.CallState.None,stageMode:g.StageMode.Grid,hasConnectedParticipants:!1,isRightPanelOpened:!1,onCallDisconnected:()=>{}},t.CallPanelContext=(0,n.createContext)(t.defaultContextValue),t.CallPanelContext.displayName="CallPanelContext";t.useCallPanelContext=()=>(0,n.useContext)(t.CallPanelContext),t.default=(0,o.withResubAutoSubscriptions)((({callId:e,initialMri:i,children:o})=>{const s=(0,l.useCommonContext)(),g=u.default.isRightPanelOpen(s.rootViewId),C=r.default.CallingStore.getCallConversationMri(e)||i,m=h.isOneOnOneConversation(C),S=h.getReactionsThreadMriForCallId(e),y=r.default.CallingStore.getCallState(e),f=r.default.CallingStore.getForwardingDestinationType(e),_=r.default.CallingStore.hasConnectedParticipants(e),b=p.default.getStageMode(e),T=(0,n.useCallback)((()=>{c.default.navigateCallComplete(C,!0,!1,s,d.default.newCauseId())}),[C,s]),v=(0,n.useMemo)((()=>({conversationMri:C,callId:e,isOneOnOne:m,reactionsConversationMri:S,forwardingDestinationType:f})),[C,e,m,S,f]),w=(0,n.useMemo)((()=>({callInfo:v,callState:y,isRightPanelOpened:g,hasConnectedParticipants:_,stageMode:b,onCallDisconnected:T})),[v,y,g,_,b,T]);return a.createElement(t.CallPanelContext.Provider,{value:w},o)}))},30150:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useSidePanels=t.useStageMode=t.useCallState=t.useCallInfo=void 0;const a=i(67294),n=i(48540),o=i(58187),s=i(4735),r=i(53374),l=i(80200),c=i(51832);t.useCallInfo=()=>(0,c.useCallPanelContext)().callInfo;t.useCallState=()=>{const{callState:e,hasConnectedParticipants:i}=(0,c.useCallPanelContext)(),{forwardingDestinationType:a}=(0,t.useCallInfo)();let o=l.CallUIState.Default;switch(e){case n.CallState.None:break;case n.CallState.Connected:case n.CallState.LocalHold:case n.CallState.RemoteHold:"voicemail"===a?o=l.CallUIState.Voicemail:i&&(o=l.CallUIState.Default);break;case n.CallState.Disconnecting:break;case n.CallState.Disconnected:o=l.CallUIState.Disconnected;break;case n.CallState.Connecting:case n.CallState.EarlyMedia:o=l.CallUIState.OutgoingRing;break;case n.CallState.Notified:o=l.CallUIState.IncomingRing}return{callUIState:o,callState:e}};t.useStageMode=()=>{const{stageMode:e}=(0,c.useCallPanelContext)();return{stageLayoutMode:e}};t.useSidePanels=()=>{const e=(0,o.useCommonContext)(),{isRightPanelOpened:i}=(0,c.useCallPanelContext)(),{callId:n,conversationMri:l}=(0,t.useCallInfo)(),d=(0,a.useCallback)((()=>{s.default.closeConversationInCall(r.default.newCauseId(),e)}),[e]),u=(0,a.useCallback)((()=>{s.default.openConversationInCall(r.default.newCauseId(),l,n,e,d)}),[l,n,e,d]);return{toggleChatPanel:(0,a.useCallback)((()=>{i?d():u()}),[d,u,i]),isRightPanelOpened:i}}},95328:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(63297),o=i(67287),s=i(31844),r=i(58108),l=i(2604),c=i(81399),d=i(98356),u=i(78045),h=i(16778),p=i(98861),g=i(48540),C=i(19784),m=i(15602),S=i(60),y=i(89391),f=i(32143),_=i(41789),b=i(96074),T=i(20187),v=i(50604),w=i(75492),I=i(79857),P=(i(78816),i(63979)),M=i(2627),k=i(94224),A=i(68580),R=i(98925),V=i(32057),L=i(23413),E=i(99734),B=i(78968),O=i(47176),D=i(72667),x=i(36850),N=i(47112),U=i(57033),F=i(9520),H=i(2278),z=(i(91),i(18154)),G=i(85107),W=i(40584),K=i(43355),j=i(80200),Q=i(71727),$=i(46565),q=i(47447),X=i(32827),Z=i(14920),J=i(14980),Y=i(71830),ee=i(96418),te=i(11009),ie=i(3056),ae=i(98278),ne=i(53143),oe=i(39549),se=i(24490),re=i(57139),le=i(68934),ce=i(37490),de=i(52262),ue=i(62490),he=i(46096),pe=i(11375),ge=i(10117),Ce=i(5581),me=i(20279),Se=i(58722),ye=i(83706),fe=i(3989),_e=i(36237),be=i(10400),Te=i(48638),ve=i(72490),we=i(15877),Ie=i(33754),Pe=i(68080),Me=i(44285),ke=i(57538),Ae=i(10909),Re=i(52251),Ve=(i(67354),i(99201)),Le=i(44972),Ee=i(78735),Be=i(46929),Oe=i(4735),De=i(17093),xe=i(30124),Ne=i(27357),Ue=i(33348),Fe=i(81736),He=i(57876),ze=i(2557),Ge=i(29130),We=i(14976),Ke=i(51070),je=i(81115),Qe=i(36150),$e=i(86045),qe=i(26978),Xe=i(62232),Ze=i(9399),Je=i(28493),Ye=i(33778),et=i(90089),tt=i(76835),it=i(54594),at=i(24431),nt=i(91018),ot=i(17163),st=i(84449),rt=i(97016),lt=i(99948),ct=i(49603),dt=i(12187),ut=i(4057),ht=i(81760),pt=i(40363),gt=i(11828),Ct=i(78262),mt=i(80837),St=i(94050),yt=i(90970),ft=i(63841),_t=i(12770),bt=i(53374),Tt=i(19504),vt=i(57011),wt=i(99342),It=i(56018),Pt=i(18078),Mt=i(5531),kt=i(50646),At=i(38891),Rt=390,Vt="callToast",Lt=(0,we.lazyProperties)({callPanel:()=>h.Styles.createViewStyle({flex:1,alignItems:"center",alignSelf:"stretch",backgroundColor:ht.Color.gray400}),callPanelCallStageV2:()=>h.Styles.createViewStyle({backgroundColor:ht.Color.callStageDark}),callPanelLightTheme:()=>h.Styles.createViewStyle({backgroundColor:ht.Color.gray200Overlay20}),headerContainer:()=>h.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,height:120,overflow:"visible"}),headerContainerV2:()=>h.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,height:j.DesktopNewHeaderHeight,overflow:"visible"}),buttonsContainer:()=>h.Styles.createViewStyle({position:"absolute",bottom:0,left:0,right:0,overflow:"visible"}),buttonsWithNotificationContainer:()=>h.Styles.createViewStyle({bottom:j.AudioNotificationOffset}),modernStageButtonsContainer:()=>h.Styles.createViewStyle({height:j.DesktopCallControlsHeight,backgroundColor:ht.Color.callStageDark,justifyContent:"flex-end"}),lightThemeButtonsContainer:()=>h.Styles.createViewStyle({backgroundColor:ht.Color.transparent}),callingAnimationContainer:()=>h.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,alignItems:"center",justifyContent:"center",overflow:"visible"}),fullScreenView:()=>h.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:ht.Color.transparent,overflow:"visible"}),innerViewBase:()=>h.Styles.createViewStyle({position:"absolute",top:0,left:0,backgroundColor:ht.Color.transparent,overflow:"visible"}),mobileInnerViewBase:()=>h.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:ht.Color.transparent,overflow:"visible"}),reactionsBar:()=>h.Styles.createViewStyle({overflow:"visible",position:"absolute",left:0,right:0,bottom:0,backgroundColor:ht.Color.transparent,height:360,alignItems:"stretch"}),reactionsBarCompositeInner:()=>h.Styles.createViewStyle({overflow:"visible",minHeight:360,backgroundColor:ht.Color.transparent}),dialpadContainer:()=>h.Styles.createViewStyle({position:"absolute",right:0,bottom:0,left:0,top:0,alignItems:"center",justifyContent:"center",backgroundColor:ht.Color.transparent}),dialpadInnerContainer:()=>h.Styles.createViewStyle({position:"absolute",bottom:0,alignItems:"stretch",justifyContent:"center",backgroundColor:ht.Color.gray400}),dialpadShim:()=>h.Styles.createViewStyle({backgroundColor:ht.Color.blackOverlay50}),topBanner:()=>h.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,height:150}),skypeLogo:()=>h.Styles.createViewStyle({position:"absolute",left:20,bottom:20,opacity:.2}),skypeLogoWithAudioBar:()=>h.Styles.createViewStyle({bottom:j.AudioNotificationOffset+j.DesktopCallControlsHeight-10}),skypeLogoV2:()=>h.Styles.createViewStyle({bottom:j.AudioNotificationOffset+j.DesktopCallControlsHeight+10}),hiddenControls:()=>h.Styles.createViewStyle({opacity:0})});class Et extends b.BaseNavigationView{constructor(e){super(e),this._orientationLockKey=a.uniqueId("CallPanel:"),this._hasConnected=!1,this._coachMarkContext={coachMarkArea:te.CoachMarkAreaType.CallPanel},this._reactionsBarHeight=90,this._subscriptions=[],this._disposables=[],this._endCallNavigationRequested=!1,this._shouldDelayCameraToggle=!0,this._callSnapshotSound=Xe.default.SkypeCameraCapture,this._callHeaderAnimatedOpacityValue=new h.Animated.Value(1),this._callHeaderAnimatedTranslateYValue=new h.Animated.Value(0),this._callHeaderAnimatedStyle=h.Styles.createAnimatedViewStyle({opacity:this._callHeaderAnimatedOpacityValue,transform:[{translateY:this._callHeaderAnimatedTranslateYValue}]}),this._callControlsAnimatedTranslateYValue=new h.Animated.Value(-10),this._callControlsAnimatedTranslateYStyle=h.Styles.createAnimatedViewStyle({transform:[{translateY:this._callControlsAnimatedTranslateYValue}]}),this._callControlsAnimatedOpacityValue=new h.Animated.Value(1),this._callControlsOpacityAnimatedStyle=h.Styles.createAnimatedViewStyle({opacity:this._callControlsAnimatedOpacityValue}),this._callStageOverlayOpacityValue=new h.Animated.Value(1),this._callStageOverlayOpacityStyle=h.Styles.createAnimatedViewStyle({opacity:this._callStageOverlayOpacityValue}),this._callParticipantTooltipOpacityValue=new h.Animated.Value(1),this._callParticipantNameTooltipStyle=h.Styles.createAnimatedViewStyle({opacity:this._callParticipantTooltipOpacityValue}),this._callParticipantAccessoryOpacityValue=new h.Animated.Value(1),this._callParticipantAccessoryOpacityStyle=h.Styles.createAnimatedViewStyle({opacity:this._callParticipantAccessoryOpacityValue}),this._newCompositeReactionsAnimatedOpacityValue=new h.Animated.Value(1),this._newCompositeReactionsAnimatedOpacityStyle=h.Styles.createAnimatedViewStyle({opacity:this._newCompositeReactionsAnimatedOpacityValue}),this._reactionsPanelAnimatedBottomValue=new h.Animated.Value(90),this._reactionsPanelAnimatedBottomStyle=h.Styles.createAnimatedViewStyle({bottom:this._reactionsPanelAnimatedBottomValue}),this._dialpadAnimatedOpacityValue=new h.Animated.Value(0),this._dialpadAnimatedOpacityStyle=h.Styles.createAnimatedViewStyle({opacity:this._dialpadAnimatedOpacityValue}),this._dialpadAnimatedTransformValue=new h.Animated.Value(Rt),this._dialpadAnimatedTransformStyle=h.Styles.createAnimatedViewStyle({transform:[{translateY:this._dialpadAnimatedTransformValue}]}),this._topBannerAnimatedOpacityValue=new h.Animated.Value(0),this._leftNoneStateOnce=!1,this._isInteractingWithCallControls=!1,this._hasShownNoMicrophoneConnectedToast=!1,this._hasShownNoSpeakerConnectedToast=!1,this._deviceErrorToasts={},this._hasShownCameraDeniedToast=!1,this._hasShownTeamsInteropBanner=!1,this._hasShownTogetherModeNoticeBannerForCallId=!1,this._hasShownMusicModeNoticeBannerForCallId=!1,this._useMobileControls=()=>this.state.controlsType===j.CallControlsType.Mobile,this._renderDialpad=e=>{if(this.state.showDialpad){const t=[Lt.dialpadContainer,Lt.dialpadShim,this._dialpadAnimatedOpacityStyle],i=[Lt.dialpadInnerContainer],a=Math.min(414,e.width),n=this.state.bottomSafeAreaInset+j.AudioNotificationOffset;return i.push(h.Styles.createViewStyle({height:Math.min(Rt+n,e.height),width:a,left:(e.width-a)/2,paddingBottom:n},!1)),i.push(this._dialpadAnimatedTransformStyle),h.createElement(h.View,{key:"dialpadcontainer",style:Lt.dialpadContainer},h.createElement(h.Animated.View,{key:"shim",style:t},h.createElement(h.GestureView,{style:Lt.dialpadContainer,onTap:this._onCloseDialpad})),h.createElement(h.Animated.View,{key:"dialpad",style:i},h.createElement(ue.default,{callId:this.props.route.params.callId,onClose:this._onCloseDialpad})))}},this._reloadCaptionPositionMode=()=>{const e=this.state.pstnTranslationEnabled?At.CaptionsPositionMode.float:Ce.default.getCallTranslatorCaptionsPositionMode(this.state.conversationMri)||this.state.userCaptionPositionMode;this.state.userCaptionPositionMode!==e&&this.setState({userCaptionPositionMode:e})},this._onKeyUp=e=>{const t=bt.default.newCauseId();return _e.log(he.LogTraceArea.CallingUI,"_onKeyUp causeId:"+t),this._showOrHideControls(!0,t),!1},this._onEscape=()=>this._toggleFullScreenMode(!1),this._toggleFullScreenMode=e=>!!this.state.showFullScreenOptionInRibbonSettings&&(s.default.isFullScreenMode(this._getRootViewId()).then((t=>{const i=void 0!==e?e:!t;i!==t?i?s.default.tryEnterFullScreenMode(this._getRootViewId()).then((e=>{e?(_e.track(new F.RibbonSettingsMenuActionEvent(F.RibbonSettingsMenuActions.EnterFullScreen)),H.default.trackCallViewMenuActions(F.CallViewMenuActions.EnterFullScreen)):_e.error(he.LogTraceArea.CallingUI,"_toggleFullScreenMode Failed to enter full screen mode")})):s.default.exitFullScreenMode(this._getRootViewId()).catch((e=>{_e.error(he.LogTraceArea.CallingUI,"_toggleFullScreenMode Failed to exit full screen mode")})):_e.log(he.LogTraceArea.CallingUI,"_toggleFullScreenMode to "+i+" abort, fullScreenMode is already",t)})),!0),this._closeCameraDeniedToast=()=>{this._hasShownCameraDeniedToast=!0,this.setState({hideCameraDeniedToast:!0})},this._onNewCallScreenRevertNoticeDismiss=()=>{Ee.default.setUserPreferencesLocal({wasNewCallScreenRevertNoticeDismissed:!0}),this.setState({renderMobileNewCallScreenRevertNotice:!1})},this._onPstnTranslationNoticeDismiss=()=>{this.setState({pstnTranslationBannerBeenDismissed:!0})},this._closeTeamsInteropToast=()=>{this._hasShownTeamsInteropBanner=!0,this.setState({hideTeamsInteropToast:!0})},this._closeTogetherModeNoticeToast=()=>{this._hasShownTogetherModeNoticeBannerForCallId=!0,this.setState({hideTogetherModeNoticeToastForCallId:this.props.route.params.callId}),Ee.default.setTogetherModeNoticePresentedForCallId(this.props.route.params.callId)},this._closeMusicModeNoticeToast=()=>{this._hasShownMusicModeNoticeBannerForCallId=!0,this.setState({hideMusicModeNoticeToastForCallId:this.props.route.params.callId}),Ee.default.setMusicModeNoticePresentedForCallId(this.props.route.params.callId)},this._updateServerMutedState=e=>{if(e.callId===this.props.route.params.callId){if(this.isComponentMounted()&&e.serverMuted)if(_e.log(he.LogTraceArea.CallingUI,"_updateServerMutedState: Received serverMuted event for call ID "+e.callId+" causeId: "+e.causeId),this._useMobileControls())this.setState({showServerMutedToastOnMobile:!0}),_t.default.setTimeout((()=>{this.isComponentMounted()&&this.setState({showServerMutedToastOnMobile:!1,serverMuteNotificationBannerHeight:0})}),Q.ServerMutedToastTimeout);else{const t=j.DeviceStatusToastType.MicrophoneServerMuted;this._showDeviceErrorToast(t,e.causeId)}}else _e.warn(he.LogTraceArea.CallingUI,"_updateServerMutedState: Received event for unexpected call ID "+e.callId+" causeId: "+e.causeId)},this._updateDeviceQualityState=e=>{if(e.callId===this.props.route.params.callId){if(_e.log(he.LogTraceArea.CallingUI,"_updateDeviceQualityState device: "+e.eventType+" state: "+R.CallDeviceState[e.deviceState]+" causeId: "+e.causeId),this.isComponentMounted()){if(e.eventType===R.CallDeviceQualityEventType.AudioDeviceMuted&&e.deviceState===R.CallDeviceState.NotWorking)return void this._showMicrophoneMutedPill();const t=Q.default.getErrorToastType(e.eventType),i=[];switch(t){case j.DeviceStatusToastType.AudioCaptureMusicDetectedWithHighNS:case j.DeviceStatusToastType.AudioCaptureMusicDetectedWithLowNS:i.push({labelKey:"NotificationsPrompt.ButtonLabel",callback:()=>{k.default.DeviceStore.setMusicMode(!0),this._hideDeviceErrorToastOfType(j.DeviceStatusToastType.AudioCaptureMusicDetectedWithHighNS),this._hideDeviceErrorToastOfType(j.DeviceStatusToastType.AudioCaptureMusicDetectedWithLowNS)}})}t&&(e.deviceState===R.CallDeviceState.NotWorking?this._showDeviceErrorToast(t,e.causeId,void 0,i):e.deviceState===R.CallDeviceState.Working&&(A.default.isEventTypeTriggeringMuteAction(e.eventType)||this._hideDeviceErrorToastOfType(t)))}}else _e.warn(he.LogTraceArea.CallingUI,"_updateDeviceQualityState: Received event for unexpected call ID "+e.callId+" causeId: "+e.causeId)},this._showMicrophoneMutedPill=()=>{(k.default.CallingStore.isMutedNoSubscription(this.props.route.params.callId)||k.default.CallingStore.isServerMuted(this.props.route.params.callId))&&(this.setState({isMicrophoneMutedWhileSpeaking:!0}),a.isUndefined(this._microphoneMutedTimeout)||_t.default.clearTimeout(this._microphoneMutedTimeout),this._microphoneMutedTimeout=_t.default.setTimeout((()=>{this._microphoneMutedTimeout=void 0,this.isComponentMounted()&&this.setState({isMicrophoneMutedWhileSpeaking:!1})}),5e3))},this._updateDeviceNearEndQuality=(e,t,i)=>{e===this.props.route.params.callId?(t===g.QualityLevel.Bad&&k.default.CallingStore.isSharingSound(e)?this._showDeviceErrorToast(j.DeviceStatusToastType.SoundSharingStopped,i):t===g.QualityLevel.Good&&this._hideDeviceErrorToastOfType(j.DeviceStatusToastType.SoundSharingStopped),_e.log(he.LogTraceArea.CallingUI,"_updateDeviceNearEndQuality level: "+t+" causeId: "+i)):_e.warn(he.LogTraceArea.CallingUI,"_updateDeviceNearEndQualityState: Received event for unexpected call ID "+e+" causeId: "+i)},this._selectedDevicesChanged=(e,t,i)=>{this._devicesChanged(e,t,!0,i)},this._availableDevicesChanged=(e,t)=>{this._devicesChanged(e,!1,!1,t)},this._onVideoEffectsQualityChangedEvent=(e,t,i)=>{this._showDeviceErrorToast(j.DeviceStatusToastType.VideoEffectsQualityChange,i,{deviceName:e})},this._devicesChanged=(e,t,i,a)=>{t||(this._showDeviceChangeToast(e,i,a),_e.log(he.LogTraceArea.CallingUI,"_devicesChanged selected "+i+":"+We.trustMeThisJsonIsSafe(e)+" causeId: "+a))},this._navigateToChatNotBack=e=>{_e.log(he.LogTraceArea.CallingUI,"_navigateToChatNotBack, causeId: "+e),this._navigateToChat(!1,!0,e)},this._toggleChatPanel=e=>{_e.log(he.LogTraceArea.CallingUI,"_toggleChatPanel causeId: "+e);const t=()=>{Oe.default.closeConversationInCall(e,this._getContext())};!this.state.isChatOpen?(()=>{H.default.updateCallTelemetry(this.props.route.params.callId,e,(e=>e.chatOpened())),this._onNavigatedAwayFromCall(e),Oe.default.openConversationInCall(e,this.state.conversationMri,this.props.route.params.callId,this._getContext(),this._toggleChatPanel),this.state.isGalleryPanelOpen?$e.default.maybeAnnounceForAccessibility(Ie.getString("AccessibilityLabel.GalleryClosed")):k.default.OngoingCallService.getIsSubtitleHistoryOpen(this.props.route.params.callId)&&$e.default.maybeAnnounceForAccessibility(Ie.getString("AccessibilityLabel.SubtitlesClosed"))})():this._closeRightPanel(t,e)},this._currentLeftPanelWidth=()=>this.state.isLeftPanelOpen&&!xe.default.isUsingSplitViewNoSubscription()?qe.default.getWidthNoSubscription():0,this._toggleGalleryPanel=()=>{const e=bt.default.newCauseId();_e.log(he.LogTraceArea.CallingUI,"_toggleGalleryPanel causeId: "+e),this._intToggleGalleryPanel(e)},this._intToggleGalleryPanel=e=>{_e.log(he.LogTraceArea.CallingUI,"_intToggleGalleryPanel causeId: "+e),this.state.isGalleryPanelOpen?(this._closeRightPanel((()=>Oe.default.closeGalleryPanel(e,this._getContext())),e),$e.default.maybeAnnounceForAccessibility(Ie.getString("AccessibilityLabel.GalleryClosed"))):(this.state.isChatOpen?$e.default.maybeAnnounceForAccessibility(Ie.getString("AccessibilityLabel.ChatClosed")):k.default.OngoingCallService.getIsSubtitleHistoryOpen(this.props.route.params.callId)&&$e.default.maybeAnnounceForAccessibility(Ie.getString("AccessibilityLabel.SubtitlesClosed")),H.default.updateCallTelemetry(this.props.route.params.callId,e,(e=>e.galleryOpened())),this._onNavigatedAwayFromCall(e),this._showOrHideControls(!1,e),Oe.default.navigateToGallery(this.state.conversationMri,De.GalleryViewMode.All,this._getContext(),this.props.route.params.callId,this.state.conversationMri,this._intToggleGalleryPanel),$e.default.maybeAnnounceForAccessibility(Ie.getString("AccessibilityLabel.GalleryOpened")))},this._showReactionsDrawerOnHover=()=>{this._reactionsBar&&this._reactionsBar.toggleReactionsPickerHovered()},this._showOrHideReactionsDrawer=e=>{e=a.isUndefined(e)?this._reactionsBar&&!this._reactionsBar.isDrawerOpen():e;const t=bt.default.newCauseId();_e.log(he.LogTraceArea.CallingUI,"_showOrHideReactionsDrawer show: "+e+" causeId: "+t),e?this._reactionsBar&&this._reactionsBar.openReactionsDrawer(t):this._reactionsBar&&this._reactionsBar.close(),this._callControls&&this._callControls.toggleReactionsPickerButton(!!e,!0)},this._onAppStateChange=()=>{const e=bt.default.newCauseId();_e.log(he.LogTraceArea.CallingUI,"_onAppStateChange, causeId: "+e),this._updateAudioState(e);const t=h.App.getActivationState();t===h.Types.AppActivationState.Background?H.default.updateCallTelemetry(this.props.route.params.callId,e,(e=>e.backgroundAppInCall())):t===h.Types.AppActivationState.Active&&this._showOrHideControls(!0,e)},this._callParticipantActionsMenuOpened=()=>{if(this.isComponentMounted()){const e=bt.default.newCauseId();_e.log(he.LogTraceArea.CallingUI,"[CallPanel]_callParticipantActionsMenuOpened causeId: "+e),this.setState({isCallParticipantActionsMenuOpened:!0}),this._clearHideControlsTimer()}},this._callParticipantActionsMenuClosed=()=>{if(this.isComponentMounted()){const e=bt.default.newCauseId();_e.log(he.LogTraceArea.CallingUI,"[CallPanel]_callParticipantActionsMenuClosed causeId: "+e),this.setState({isCallParticipantActionsMenuOpened:!1}),this._startHideControlsTimer(!0,this._callControlShortTimeoutMs,e)}},this._onVideoPreviewFloating=(e,t)=>{this.isComponentMounted()&&this.setState({shouldRenderFloatingVideoPreview:e,floatingVideoPreviewView:t})},this._videoToolTipAnchor=()=>this._videoButtonRef,this._onInCallWarningViewRef=e=>{this._inCallWarningView=e||void 0},this._onAudioNotificationViewRef=e=>{this._audioNotificationView=e||void 0},this._onShowHideDisableOutgoingVideoToast=(e,t)=>{e?(_e.log(he.LogTraceArea.CallingUI,`CallPanel._onShowHideDisableOutgoingVideoToast: show causeId ${t}`),this._showDeviceErrorToast(j.DeviceStatusToastType.OutgoingVideoDisabledDuringScreenSharing,t)):(_e.log(he.LogTraceArea.CallingUI,`CallPanel._onShowHideDisableOutgoingVideoToast: hide causeId ${t}`),this._hideDeviceErrorToastOfType(j.DeviceStatusToastType.OutgoingVideoDisabledDuringScreenSharing))},this._renderSkypeLogo=()=>{if(!this.state.isSkypeLogoEnabled)return;const e=[Lt.skypeLogo,this.state.isNewCallScreen?Lt.skypeLogoV2:Lt.skypeLogoWithAudioBar],t=this.state.useLightTheme?ht.Color.gray300:ht.Color.white;return h.createElement(ge.default,{key:"skypeLogo",icon:gt.SkypeIcon.SkypeIcon,size:gt.IconSize.size48,color:t,style:e})},this._onLocalUnmute=()=>{this.isComponentMounted()&&this._useMobileControls()&&this.setState({showServerMutedToastOnMobile:!1,serverMuteNotificationBannerHeight:0})},this._onReactionsDrawerOpen=e=>{const t=bt.default.newCauseId();if(_e.log(he.LogTraceArea.CallingUI,"_onReactionsDrawerOpen open: "+e+" causeId: "+t),!this.isComponentMounted())return;if(this._useMobileControls()){const i=e&&this.state.isUsingStackNavigationContext,a=i!==this.state.hideCallControlsForActivity?{hideCallControlsForActivity:i}:void 0;this._showOrHideControls(!1,t,a)}else this._inCallWarningView&&this._inCallWarningView.showOrHideWarningView(!e),this._callControls&&this._callControls.toggleReactionsPickerButton(e,!0)},this._onEndCallFailure=e=>{this._exitCall(!0,!1,e)},this._onCallTitleLayout=e=>{this.isComponentMounted()&&e.width!==this.state.titleWidth&&this.setState({titleWidth:e.width})},this._onUseImmersiveModeChange=e=>{e!==this.state.useImmersiveMode&&this.setState({useImmersiveMode:e})},this._onHeaderBackButtonPressed=e=>{_e.log(he.LogTraceArea.CallingUI,`_onHeaderBackButtonPressed causedId: ${e}`),this._navigateToChat(this._isIncomingOrOutgoingRing(),!1,e)},this._onRecentsButtonPressed=e=>{if(_e.log(he.LogTraceArea.CallingUI,"_onRecentsButtonPressed causeId: "+e),this.state.isSplitNavCollapsed&&this._getRootViewType()!==ae.RootViewType.SplitViewContent)Oe.default.mainStageContextPopToRoot(!1,e,this._getContext());else{const t=this.state.isRecentsOpen,i=()=>{const i=Oe.default.toggleRecentsInCall(!t,e,this._getContext());return H.default.updateCallTelemetry(this.props.route.params.callId,e,(e=>t?e.navBarClosed():e.navBarOpened())),{willToggle:i.willToggle,completeAction:()=>{i.completeAction(),!t&&i.willToggle&&(pe.setFocusWithDelay(pe.FocusEvent.OpenCallSideBar,100),pe.setFocusWithDelay(pe.FocusEvent.Recent,100))}}};this._toggleLeftPanelForAction(i,!t,e)}},this._onShowOrHideProfile=e=>{this.isComponentMounted()&&Oe.default.showDetailsPanelWithParams({mri:this.state.conversationMri,showConversationSettings:!0,rootViewId:this._getRootViewId(),causeId:e})},this._onShowParticipants=(e,t,i)=>{this._onShowOrHideRoster(e,t,i)},this._onShowOrHideRoster=(e,t,i)=>{const{callId:a}=this.props.route.params;!this._isIncomingOrOutgoingRing()&&this.state.rosterAvailble&&this.isComponentMounted()&&(Oe.default.openCallRoster(this.state.conversationMri,a,this._getContext()),_e.log(he.LogTraceArea.CallingUI,`[CallPanel] show call roster, causeId: ${e}`),yt.default.createSession(a,t||j.CallRosterOrigin.FromGroupTitle,!!i),H.default.updateCallTelemetry(a,e,(e=>e.callRosterOpenedCount())))},this._toggleMobileOverflowMenu=e=>{const t=bt.default.newCauseId();if(_e.log(he.LogTraceArea.CallingUI,`_toggleMobileOverflowMenu causeId: ${t}`),e){const i={callId:this.props.route.params.callId,conversationMri:this.state.conversationMri,reactionsConversationMri:this.state.reactionsConversationMri,isPSTNCall:this.state.isPSTNCall,isEncryptedCall:this.state.isEncryptedCall,callerContext:()=>this._getContext(),callUIState:this.state.callUIState},a=h.createElement(v.default,Object.assign({colorThemeOverride:ft.Theme.DelphiDark},i)),n=this._getRootViewId(),o=v.default.menuHeight(i);re.default.showWithContent({menuId:re.default.menuId(),anchor:e,rootViewId:this._getRootViewId(),menuHeight:o,content:a,useBlurredBackground:!0,colorThemeOverride:ft.Theme.DelphiDark,headerConfig:{headerType:se.HeaderType.Slim},staticContent:!0,useTransparentShim:!0,hidePopupArrow:!0,useDesktopPopup:!this.state.isUsingStackNavigationContext&&!this.state.isMobileScreenReaderEnabled,getTitle:()=>{},onCloseMenu:e=>{_e.log(he.LogTraceArea.CallingUI,"onCloseMenu causeId: "+e),re.default.close(n,e)}},t);const s=!this.state.isUsingStackNavigationContext;this._showOrHideControls(s,t),ce.dismissAll()}},this._onAddToCallKeyboardShortcut=(e,t)=>{if(t!==this._getRootViewId()||this.state.isS4BCall)return!1;const i=bt.default.newCauseId();return _e.log(he.LogTraceArea.CallingUI,"_onAddToCallKeyboardShortcut causeId: "+i),this._onAddToCallPressed(i,he.NavigationAddToCallOrigin.KeyboardShortcut),!0},this._onAddToCallPressed=(e,t)=>{_e.log(he.LogTraceArea.CallingUI,"_onAddToCallPressed causeId: "+e),this._onNavigatedAwayFromCall(e),Oe.default.openAddToCall(this.state.conversationMri,this.props.route.params.callId,t,this._getContext(),e),yt.default.updateCallRosterTelemetry(this.props.route.params.callId,e,(e=>e.callRosterAddToCall()))},this._onBingBackgroundsPressed=e=>{_e.log(he.LogTraceArea.CallingUI,"_onBingBackgroundsPressed causeId: "+e),this._onNavigatedAwayFromCall(e),Oe.default.openBingBackgroundsOverview(this.props.route.params.callId,this._getContext())},this._onOpenDialpad=()=>{const e=bt.default.newCauseId();if(_e.log(he.LogTraceArea.CallingUI,`CallPanel._onOpenDialpad causeId: ${e}`),!this.state.enableDialpadOnPSTNSubtitlesCalls&&k.default.CallingStore.isTranslating(this.props.route.params.callId))return H.default.updateCallTelemetry(this.props.route.params.callId,e,(e=>e.displayedDtmfWarning())),void C.default.showOKAlert(Ie.getString("CallPanel.DialpadUnavailableTitle"),Ie.getString("CallPanel.DialpadUnavailableMessage"),this._getRootViewId());this._onShowOrHideDialpad(!0,e)},this._onCloseDialpad=()=>{const e=bt.default.newCauseId();_e.log(he.LogTraceArea.CallingUI,`CallPanel._onCloseDialpad causeId: ${e}`),this._onShowOrHideDialpad(!1,e)},this._onShowOrHideDialpad=(e,t)=>{e!==this.state.showDialpad&&(e?(H.default.updateCallTelemetry(this.props.route.params.callId,t,(e=>e.accessedDialpad())),this.setState({showDialpad:!0})):this._animateDialpad(!1,t,(()=>{this.isComponentMounted()&&this.setState({showDialpad:!1})})))},this._onLayoutChange=e=>{this.setState({panelLayout:{x:e.x,y:e.y,width:e.width,height:e.height}})},this._onToggleLocalVideoSource=()=>{const e=bt.default.newCauseId();_e.log(he.LogTraceArea.CallingUI,"_onToggleLocalVideoSource causeId: "+e),this._startHideControlsTimer(!0,0,e),this._shouldDelayCameraToggle?_t.default.setTimeout((()=>{this.isComponentMounted()&&this._updateVideoSource()}),500):this._updateVideoSource()},this._updateVideoSource=()=>{const e=bt.default.newCauseId();_e.log(he.LogTraceArea.CallingUI,"_updateVideoSource causeId: "+e);const t=this.state.selectedCamera&&this.state.selectedCamera.position,i=this.state.selectedCamera&&this.state.selectedCamera.id,n=a.find(this.state.cameras,(e=>e.id!==i&&e.position!==t)),o=n&&n.id,s=n&&n.position;k.default.DeviceStore.choosePreferredDevices({camera:o},e),_e.log(he.LogTraceArea.CallingUI,"_updateVideoSource "+i+" position "+t+" -> "+o+" position "+s+" causeId: "+e),H.default.updateCallTelemetry(this.props.route.params.callId,e,(e=>e.toggleCamera()))},this._onVideoButtonRef=e=>{this._videoButtonRef=e||void 0},this._onMouseMove=()=>{if(this.state.callUIState===j.CallUIState.Default||this.state.callUIState===j.CallUIState.Voicemail){const e=bt.default.newCauseId();this.state.buttonsAndInfoHidden?this._showOrHideControls(!0,e):this._startHideControlsTimer(!0,this._callControlShortTimeoutMs,e)}},this._onMouseLeave=()=>{const e=bt.default.newCauseId();_e.log(he.LogTraceArea.CallingUI,"_onMouseLeave causeId: "+e),this._useMobileControls()&&(this.state.callUIState!==j.CallUIState.Default&&this.state.callUIState!==j.CallUIState.Voicemail||this._showOrHideControls(!1,e))},this._onCallPanelHeaderLayoutChange=e=>{x.default.setCallHeaderLayoutMode(this.props.route.params.callId,e)},this._onStageTapped=e=>{const t=bt.default.newCauseId();return _e.log(he.LogTraceArea.CallingUI,"_onStageTapped causeId: "+t),this.state.isVideoSuggestionTooltipVisible&&$.default.setVideoSuggestionTooltipVisibility(this.props.route.params.callId,!1),this.state.isGalleryPanelOpen&&this._intToggleGalleryPanel(t),!(this.state.callUIState!==j.CallUIState.Default&&this.state.callUIState!==j.CallUIState.Voicemail||this._shouldKeepControlsVisible())&&(this._showOrHideControls(this.state.buttonsAndInfoHidden,t,void 0,!1,e),!0)},this._onCallControls=e=>{this._callControls=e||void 0},this._onStageChange=e=>{this._shouldDelayCameraToggle!==!e&&(this._shouldDelayCameraToggle=!e)},this._onParticipantDragChange=e=>{!e||this.state.callUIState!==j.CallUIState.Default&&this.state.callUIState!==j.CallUIState.Voicemail||this._showOrHideReactionsDrawer(!1)},this._onCallControlsInteracting=e=>{const t=bt.default.newCauseId();_e.log(he.LogTraceArea.CallingUI,"_onCallControlsInteracting causeId: "+t),this._isInteractingWithCallControls=e,this._isInteractingWithCallControls?this._clearHideControlsTimer():this._startHideControlsTimer(!0,this._callControlTimeoutMs,t)},this._onReactionsBarDesiredHeight=e=>{this._reactionsBarHeight=e;const t=this.state&&this._useMobileControls()?this._callControlsVisualHeight():this._reactionsBarHeight;this._reactionsPanelAnimatedBottomValue.setValue(t)},this._onToggleVideo=()=>{const e=bt.default.newCauseId();_e.log(he.LogTraceArea.CallingUI,"_onToggleVideo causeId: "+e),k.default.CallControlsStore.toggleVideo(this.props.route.params.callId,e),this._startHideControlsTimer(!0,this._callControlExtraShortTimeoutMs,e)},this._onDynamicAudioChoice=(e,t)=>{const i=bt.default.newCauseId();_e.log(he.LogTraceArea.CallingUI,"CallPanel._onDynamicAudioChoice causeId: "+i);const a=new _.AudioRouteSelectionPresenter(i);a.setUserProvidingVideo(k.default.CallingStore.isProvidingVideo(this.props.route.params.callId)),a.setControlTimerHandlers((()=>{this._clearHideControlsTimer()}),(()=>{this._startHideControlsTimer(!0,this._callControlTimeoutMs,i)})),a.show(this._getRootViewId(),e,t)},this._onCaptureMomentKeyboardShortcut=(e,t)=>{if(t!==this._getRootViewId()||this.state.isS4BCall)return!1;const i=bt.default.newCauseId();return _e.log(he.LogTraceArea.CallingUI,"CallPanel._onCaptureMomentKeyboardShortcut causeId: "+i),this._intOnCaptureMomentPress(i),!0},this._callControlsOnCaptureMomentPress=()=>{const e=bt.default.newCauseId();_e.log(he.LogTraceArea.CallingUI,"CallPanel._callControlsOnCaptureMomentPress causeId: "+e),this._intOnCaptureMomentPress(e)},this._reactionsBarOnCaptureMomentPress=()=>{const e=bt.default.newCauseId();_e.log(he.LogTraceArea.CallingUI,"CallPanel._reactionsBarOnCaptureMomentPress causeId: "+e),this._intOnCaptureMomentPress(e)},this._intOnCaptureMomentPress=e=>{_e.log(he.LogTraceArea.CallingUI,"CallPanel._intOnCaptureMomentPress causeId: "+e);const t=[this._galleryMri()],i=this.props.route.params.callId,a=this.state.conversationMri,n=this.state.reactionsConversationMri;if(q.CallingCapabilities.callSnapshotSupported()){let o=k.default.CallingStore.getRankedSpeakerMris(this.props.route.params.callId);this._callSnapshotSound.playOnce(e),D.default.takeSnapshot(e,i,a,n,o,t),$e.default.maybeAnnounceForAccessibility(Ie.getString("CallPanel.SnapshotPosted")),H.default.updateCallTelemetry(this.props.route.params.callId,e,(e=>e.postPhotoSnapshot()))}},this._onEmptyCallGalleryViewPhotoButtonPress=()=>{this._onPhotoButtonPress(F.CallAddPhotosEntryPoint.CallGalleryEmptyView)},this._onPhotoButtonPress=e=>{const t=bt.default.newCauseId();_e.log(he.LogTraceArea.CallingUI,"_onPhotoButtonPress causeId: "+t);const i=this._useMobileControls(),a={capturedContentHandler:new Z.CapturedContentHandlerForPosting(this._galleryMri(),this.props.route.params.callId),conversationId:this._galleryMri(),callId:this.props.route.params.callId,allowVideo:!1,allowMultiple:!0,defaultToAlbums:!1,mediaPickerOnly:!0,disableMarkup:!0,onSendFlowComplete:this._onReactionsPhotoSendComplete};H.default.initCallAddPhotosEvent(this.props.route.params.callId,this.state.conversationMri,e),i&&this._onNavigatedAwayFromCall(t),this.state.isUsingStackNavigationContext?J.navigateToCaptureComboWithParams(a,this._getContext(),(()=>{Oe.default.reduceNavStack([De.ConversationMediaViewerPanelNavigationId])})):i?J.navigateToCaptureComboModalWithParams(a,this._getContext(),this._setAsVideoTargetWithDelay):this._intToggleGalleryPanel(t)},this._setAsVideoTargetWithDelay=()=>{_e.log(he.LogTraceArea.CallingUI,"CallPanel._setAsVideoTargetWithDelay, isCallPanelVisible before update: "+this.state.isCallPanelVisible),this.isComponentMounted()&&!this.state.isCallPanelVisible&&(_e.log(he.LogTraceArea.CallingUI,"Setting isCallPanelVisible: true"),this.setState({isCallPanelVisible:!0,isInCallGalleryOpenOnMobile:!1}))},this._onCallRecordingPress=()=>{const e=bt.default.newCauseId();_e.log(he.LogTraceArea.CallingUI,"CallPanel._onCallRecordingPress causeId: "+e),this._intOnCallRecordingPress(e)},this._intOnCallRecordingPress=e=>{_e.log(he.LogTraceArea.CallingUI,"CallPanel._intOnCallRecordingPress causeId: "+e),this.state.isRecording?k.default.InCallBotService.stopRecording(this.props.route.params.callId,e):k.default.InCallBotService.startRecording(this.props.route.params.callId,e)},this._onOpenGalleryWithoutMessage=e=>{_e.log(he.LogTraceArea.CallingUI,"CallPanel._onOpenGalleryWithoutMessage causeId: "+e),this._onOpenGallery(void 0,void 0,e)},this._onOpenGallery=(e,t,i)=>{if(_e.log(he.LogTraceArea.CallingUI,"onOpenGallery enableNewCaptureActivityPip: "+this.state.enableNewCaptureActivityPip+" causeId: "+i),this.state.isUsingStackNavigationContext){const t=e?e.conversationId:this._galleryMri();this.state.isUsingStackNavigationContext&&this.state.enableNewCaptureActivityPip&&!xe.default.isMobileSplitView()&&$.default.setCallViewVisible(this.props.route.params.callId,!1,i),H.default.updateCallTelemetry(this.props.route.params.callId,i,(e=>e.galleryOpened())),Oe.default.navigateToConversationMediaViewer({conversationMri:t,initialMessage:e,defaultToLastItem:!0,useOpaqueBackground:!0,emptyMediaDescriptor:{mediaType:P.CallGalleryEmptyViewer.MediaType,launchCamera:this._onEmptyCallGalleryViewPhotoButtonPress},onClose:this._onGalleryClosed,origin:he.NavigationMediaViewerOrigin.CallSharedPhoto},i,this._getContext()),this.setState({isInCallGalleryOpenOnMobile:!0})}else e?(H.default.updateCallTelemetry(this.props.route.params.callId,i,(e=>e.galleryOpened())),this._onNavigatedAwayFromCall(i),Pe.default.showWithMessageConfig({initialMessage:e,defaultToLastItem:!0,rootViewId:this._getRootViewId(),initFromComponent:t,closeToComponent:this._getChatButtonRef,animateOpenClose:!0,onClose:this._onMediaViewerClosed,emptyMediaDescriptor:{mediaType:P.CallGalleryEmptyViewer.MediaType,launchCamera:this._onEmptyCallGalleryViewPhotoButtonPress},origin:he.NavigationMediaViewerOrigin.CallSharedPhoto})):this._intToggleGalleryPanel(i)},this._onMediaViewerClosed=()=>{const e=bt.default.newCauseId();_e.log(he.LogTraceArea.CallingUI,"onGalleryClosed causeId: "+e),this.state.isUsingStackNavigationContext||this._useMobileControls()||this._showOrHideControls(!0,e)},this._onChatButtonRef=e=>{this._chatButton=e||void 0},this._getChatButtonRef=()=>this.isComponentMounted()?this._chatButton:void 0,this._onGalleryClosed=()=>{const e=bt.default.newCauseId();_e.log(he.LogTraceArea.CallingUI,"onGalleryClosed causeId: "+e),$.default.setCallViewVisible(this.props.route.params.callId,!0,e),Oe.default.closeConversationMediaViewer(e,this._getContext())},this._onReactionsPhotoSendComplete=()=>{const e=bt.default.newCauseId();_e.log(he.LogTraceArea.CallingUI,"_onReactionsPhotoSendComplete, causeId: "+e),H.default.markPhotosSentCallAddPhotosEvent(this.props.route.params.callId,!0),H.default.completeCallAddPhotosEvent(this.props.route.params.callId),this.state.isUsingStackNavigationContext?J.closeCaptureCombo(e,this._getContext()):this._useMobileControls()&&X.default.close()},this._onReactionsBarRef=e=>{this._reactionsBar=e||void 0},this._goBack=e=>(_e.log(he.LogTraceArea.CallingUI,"_goBack causeId: "+e),this.state.callUIState===j.CallUIState.IncomingRing?(k.default.CallingStore.rejectCall(this.props.route.params.callId,e),!0):this.state.isChatOpen?(this._toggleChatPanel(e),!0):(this._exitCall(this._isIncomingOrOutgoingRing(),!1,e),!0)),this._requestEndInterruption=()=>n.default.requestEndToInterruption(),this._requestResumeCall=()=>{const e=bt.default.newCauseId();_e.log(he.LogTraceArea.CallingUI,"_requestResumeCall, causeId: "+e),o.default.requestResumeCall(this.props.route.params.callId,e)},this._onToggleVideoKeyboardShortcut=(e,t)=>{if(t!==this._getRootViewId())return!1;const i=bt.default.newCauseId();return _e.log(he.LogTraceArea.CallingUI,"_onToggleVideoKeyboardShortcut, causeId: "+i),this.state.buttonsAndInfoHidden&&this._showOrHideControls(!0,i),this._onToggleVideo(),!0},this._onToggleMicrophoneKeyboardShortcut=(e,t)=>{if(t!==this._getRootViewId())return!1;const i=bt.default.newCauseId();_e.log(he.LogTraceArea.CallingUI,"_onToggleMicrophoneKeyboardShortcut, causeId: "+i),this.state.buttonsAndInfoHidden&&this._showOrHideControls(!0,i);return new T.ToggleMuteCommand(this.props.route.params.callId,k.default.CallingStore.isMuted(this.props.route.params.callId),k.default.CallingStore.isServerMuted(this.props.route.params.callId),this.state.microphonePermissionStatus!==l.PermissionStatus.Granted,this._getRootViewId()).execute(),!0},this._onAnnounceMuteStatusKeyboardShortcut=(e,t)=>{if(t!==this._getRootViewId())return!1;const i=bt.default.newCauseId();return _e.log(he.LogTraceArea.CallingUI,"_onAnnounceMuteStatusKeyboardShortcut, causeId: "+i),this.state.buttonsAndInfoHidden&&this._showOrHideControls(!0,i),k.default.CallingStore.isMuted(this.props.route.params.callId)?Q.default.announceMicrophoneState(!0):Q.default.announceMicrophoneState(!1),!0},this._onAnnounceSelfVideoOnOffStatusKeyboardShortcut=(e,t)=>{if(t!==this._getRootViewId())return!1;const i=bt.default.newCauseId();return _e.log(he.LogTraceArea.CallingUI,"_onAnnounceSelfVideoOnOffStatusKeyboardShortcut, causeId: "+i),this.state.buttonsAndInfoHidden&&this._showOrHideControls(!0,i),k.default.CallingStore.isProvidingVideo(this.props.route.params.callId)?Q.default.announceVideoState(!0):Q.default.announceVideoState(!1),!0},this._hangupCallShortcut=(e,t)=>t===this._getRootViewId()&&(this._hangupCall("CallPanel._hangupCallShortcut"),!0),this._hangupCall=e=>{const t=bt.default.newCauseId();_e.log(he.LogTraceArea.CallingUI,"_hangupCall: "+e+t),this.state.callUIState===j.CallUIState.IncomingRing?k.default.CallingStore.rejectCall(this.props.route.params.callId,t):this._endCall(!1,t)},this._onPressCloseSubtitleHistory=()=>{{const e=bt.default.newCauseId();_e.log(he.LogTraceArea.CallingUI,"_onPressCloseSubtitleHistory, close subtitles panel causeId: "+e),this.state.isUsingStackNavigationContext?(Oe.default.navigateBack(e,this._getContext()),this.isComponentMounted()&&this.setState({isInCallSubtitleHistoryModeOnMobile:!1})):this._closeRightPanel((()=>Oe.default.closeSubtitlesPanel(e,this._getContext())),e)}k.default.OngoingCallService.setIsSubtitleHistoryOpen(this.props.route.params.callId,!1)},this._onPressOpenSubtitleHistory=()=>{if(this.state.isTranslating){const e=bt.default.newCauseId();_e.log(he.LogTraceArea.CallingUI,"_onPressOpenSubtitleHistory, open subtitles panel causeId: "+e),Oe.default.openSubtitles(this.state.reactionsConversationMri,this.props.route.params.callId,this._getContext(),this._onPressCloseSubtitleHistory,e),this.state.isUsingStackNavigationContext&&this.isComponentMounted()&&this.setState({isInCallSubtitleHistoryModeOnMobile:!0}),k.default.OngoingCallService.setIsSubtitleHistoryOpen(this.props.route.params.callId,!0),this.forceUpdate()}},this._onCameraDeniedToastHeightChanged=e=>{const t=e?e+10:0;this._shouldUpdateBannerHeight(t,this.state.cameraDeniedBannerHeight)&&this.setState({cameraDeniedBannerHeight:t})},this._onRecordingBannerHeightChanged=e=>{const t=e?e+10:0;this._shouldUpdateBannerHeight(t,this.state.recordingBannerHeight)&&this.setState({recordingBannerHeight:t})},this._onNdiUsedBannerHeightChanged=e=>{const t=e?e+10:0;this._shouldUpdateBannerHeight(t,this.state.ndiUsedBannerHeight)&&this.setState({ndiUsedBannerHeight:t})},this._onCallMediaCapturedBannerHeightChanged=e=>{const t=e?e+10:0;this._shouldUpdateBannerHeight(t,this.state.callMediaCapturedBannerHeight)&&this.setState({callMediaCapturedBannerHeight:t})},this._onIncomingVideoDisabledBannerHeightChanged=e=>{const t=e?e+10:0;this._shouldUpdateBannerHeight(t,this.state.incomingVideoDisabledBannerHeight)&&this.setState({incomingVideoDisabledBannerHeight:t})},this._onSpokenLangageConflictResolutionViewChanged=e=>{const t=e?e+10:0;this._shouldUpdateBannerHeight(t,this.state.spokenLangageConflictResolutionViewHeight)&&this.setState({spokenLangageConflictResolutionViewHeight:t})},this._onCallConnectionQualityBannerHeightChanged=e=>{const t=e?e+10:0;this._shouldUpdateBannerHeight(t,this.state.callConnectionQualityBannerHeight)&&this.setState({callConnectionQualityBannerHeight:t})},this._onServerMuteNotificationBannerHeightChanged=e=>{const t=e?e+10:0;this._shouldUpdateBannerHeight(t,this.state.serverMuteNotificationBannerHeight)&&this.setState({serverMuteNotificationBannerHeight:t})},this._onMobileScreenShareBannerHeightChanged=e=>{const t=e?e+10:0;this._shouldUpdateBannerHeight(t,this.state.mobileScreenShareBannerHeight)&&this.setState({mobileScreenShareBannerHeight:t})},this._onMobileTeamsInteropBannerHeightChanged=e=>{const t=e?e+10:0;this._shouldUpdateBannerHeight(t,this.state.mobileTeamsInteropBannerHeight||0)&&this.setState({mobileTeamsInteropBannerHeight:t})},this._onMobileTogetherModeNoticeBannerHeightChanged=e=>{const t=e?e+10:0;this._shouldUpdateBannerHeight(t,this.state.mobileTogetherModeNoticeBannerHeight||0)&&this.setState({mobileTogetherModeNoticeBannerHeight:t})},this._onMobileNewCallScreenRevertNoticeBannerHeightChanged=e=>{const t=e?e+10:0;this._shouldUpdateBannerHeight(t,this.state.mobileNewCallScreenRevertNoticeBannerHeight||0)&&this.setState({mobileNewCallScreenRevertNoticeBannerHeight:t})},this._onPstnTranslationNoticeBannerHeightChanged=e=>{const t=e?e+10:0;this._shouldUpdateBannerHeight(t,this.state.pstnTranslationNoticeBannerHeight||0)&&this.setState({pstnTranslationNoticeBannerHeight:t})},this._onMobileTranslationBannerHeightChanged=e=>{const t=e?e+10:0;this._shouldUpdateBannerHeight(t,this.state.mobileTranslationBannerHeight||0)&&this.setState({mobileTranslationBannerHeight:t})},this._onMobileMusicModeNoticeBannerHeightChanged=e=>{const t=e?e+10:0;this._shouldUpdateBannerHeight(t,this.state.mobileMusicModeNoticeBannerHeight||0)&&this.setState({mobileMusicModeNoticeBannerHeight:t})},this._closeCallCreatorShareOverlayPopup=()=>{this.setState({hasCallCreatorShareOverlayPopup:!1})},Ee.default.canEnableNewCallScreenDesignByDefaultNoSubscription()&&Ee.default.setNewCallScreenDesignEnabled(!0)}_buildState(e,t){const i=xe.default.isUsingStackNavigationContextNoSubscription(),{callId:n,initialConversationMri:o,navigationReason:r}=e.route.params,l=y.default.getS4LCMCFeatures();let c=j.CallUIState.Default,d=!1,u=!1,h="user"===k.default.CallingStore.getForwardingDestinationType(n),p=k.default.CallingStore.getCallConversationMri(n)||(t?o:this.state.conversationMri);const C=Y.isOneOnOneConversation(p),m=k.default.CallingStore.isPSTNCall(n),S=Y.isEncryptedThread(p),f=Y.isS4BBridgeMri(p),_=k.default.CallingStore.hasStartedCallLocallyGoLive(n),b=k.default.CallingStore.getCallState(n),T=!!b&&A.default.isCallStateActive(b),v=k.default.CallingStore.isProvidingVideo(n),I=this._getRootViewId(),P=!t&&this.state.isCallCreator||k.default.CallingStore.isCallCreator(n),M=!(t||!this.state.hasBeenPresented)||!Ue.default.isAnimationPending(),R=k.default.CallingStore.hasRejectedCallLocally(n);let L,E=!t&&(this.state.exitingCall||R);switch(b){case g.CallState.None:if(k.default.CallingStore.isCallIncoming(n)&&r!==De.CallNavigationReason.AutoAnsweredRing)c=j.CallUIState.IncomingRing;else{const e=this._leftNoneStateOnce||k.default.CallingStore.callDidExist(n);c=e?j.CallUIState.Disconnected:j.CallUIState.None,E=E||e&&M,e&&!E&&_e.log(he.LogTraceArea.CallingUI,"_buildState: CallState.None, waiting for hasBeenPresented to exit")}d=!0;break;case g.CallState.Connected:case g.CallState.LocalHold:case g.CallState.RemoteHold:u=A.default.isCallStateOnHold(b),"voicemail"===k.default.CallingStore.getForwardingDestinationType(n)?c=j.CallUIState.Voicemail:k.default.CallingStore.hasConnectedParticipants(n)?c=j.CallUIState.Default:(c=t?j.CallUIState.None:this.state.callUIState,_&&(c=j.CallUIState.GoLiveSinglePlayer),d=!t&&this.state.skipRenderingParticipants);break;case g.CallState.Disconnecting:c=t?j.CallUIState.None:this.state.callUIState,d=!0,E=E||M,M||_e.log(he.LogTraceArea.CallingUI,"_buildState: CallState.Disconnecting, waiting for hasBeenPresented to exit");break;case g.CallState.Disconnected:c=j.CallUIState.Disconnected,d=!0,E=E||M,M||_e.log(he.LogTraceArea.CallingUI,"_buildState: CallState.Disconnected, waiting for hasBeenPresented to exit");break;case g.CallState.Connecting:case g.CallState.EarlyMedia:P&&(d=!C&&!v,c=_?j.CallUIState.GoLiveSinglePlayer:j.CallUIState.OutgoingRing);break;case g.CallState.Notified:r===De.CallNavigationReason.AnsweredRing||r===De.CallNavigationReason.AutoAnsweredRing?c=j.CallUIState.Default:(c=j.CallUIState.IncomingRing,d=!0)}const B=()=>S?Ie.getString("CallPanel.EncryptedConnectingStatusMessage"):Ie.getString("CallPanel.ConnectingStatusMessage");c===j.CallUIState.OutgoingRing&&(L=b===g.CallState.EarlyMedia?!t&&this.state.outgoingRingStatus?this.state.outgoingRingStatus:B():b!==g.CallState.Connecting||k.default.CallingStore.hasRingingParticipants(n,!1)||k.default.CallingStore.hasConnectedParticipants(n)?Ie.getString("CallPanel.RingingStatusMessage"):B());const D=Y.getReactionsThreadMriForCallId(n),N=k.default.DeviceStore.getCameras(),U=k.default.DeviceStore.getSelectedCamera();let F;if(C&&m){const e=Y.getPhoneNumberFromMri(p);e&&(F=He.default.getConversationMri(e))}const H=t?{x:0,y:0,width:0,height:0}:this.state.panelLayout,z=Ge.default.getDeviceOrientation(I)===s.DeviceOrientation.Landscape,G=Ke.default.statusBarHeight(),W=y.default.getS4LCMCFeatures().enableFullScreenOnWeb,K=k.default.CallingFeaturesHelper.areNewMainCallControlsEnabled(),X=Q.default.isLeftPanelOpen(I),Z=Q.default.isRightPanelOpen(I),J=Q.default.isGalleryPanelOpen(I),ee=Q.default.isSubtitlesPanelOpen(I),te=Q.default.getControlsType(I,K),ie=Qe.default.isMobileScreenReaderEnabled(),ne=!i&&Ne.default.isDesktopSplitNavStackCollapsedForRootViewId(I),se=!i&&Z&&Ne.default.isCallChatShowing(I),re=l.enableNewCameraFlipFlow&&!l.enableTapToMoveCallParticipant&&te===j.CallControlsType.Mobile,le=l.enableImmersiveModeRibbon,ce=k.default.InCallBotService.isTranslating(n),de=!k.default.InCallBotService.spokenLanguageConflictToastShown(n)&&!k.default.InCallBotService.isVoiceTranslationEnabled(n)&&!k.default.InCallBotService.isPstnTranslationEnabled(n)&&(k.default.InCallBotService.isStartSubtitlesMessageEnabled()?k.default.InCallBotService.shouldDisplaySubtitlesStartedMessage(n):k.default.InCallBotService.isSpokenLanguageConflict(n))&&!l.callCaptionsLiveButton,ue=l.enableMobileSubtitlesRightPanel,pe=k.default.InCallBotUtils.isCallTranslatorBotTranslationEnabled(p)&&Ce.default.isConversationTranslated(p),ge=k.default.CallingFeaturesHelper.allowReactions({isPSTNCall:m,isEncryptedCall:S,conversationMri:p,callId:n}),me=c===j.CallUIState.Default||c===j.CallUIState.OutgoingRing||c===j.CallUIState.GoLiveSinglePlayer,Se=c===j.CallUIState.Default,ye=ge&&l.enableAllCallButtonsVisible?me:Se,fe=(0,V.default)(),be=l.enableNewCallScreen&&Ee.default.getNewCallScreenDesignEnabled(),ve=k.default.InCallBotService.isPstnTranslationEnabled(e.route.params.callId),we=[],Pe=x.default.getStageMode(n),ke={conversationMri:p,isProvidingVideo:v,cameras:N,selectedCamera:U,isCallCreator:P,microphonePermissionStatus:Fe.default.permissionStatus(Ct.PermissionType.Microphone),isRecording:k.default.CallingStore.isRecording(n),remoteParticipantsThatAreCapturingCallMedia:k.default.CallingStore.getRemoteMembersCapturingCallMedia(n),isNdiBeingUsed:k.default.NdiHookupService.isInUse(),isTranslating:ce,isIncomingVideoDisabled:k.default.CallingStore.isIncomingVideoDisabled(n),audioOnlyEnabled:k.default.CallingStore.isAudioOnly(n),isMobileScreenShareActive:!1,callUIState:c,outgoingRingStatus:L,terminatedReason:k.default.CallingStore.getCallTerminatedReason(n),skipRenderingParticipants:d,rosterAvailble:!C,isCallOnHold:u,isCallBeingForwarded:h&&c===j.CallUIState.OutgoingRing,isUsingStackNavigationContext:i,reactionsConversationMri:D,exitingCall:E,isCallActive:T,isLandscape:z,panelLayout:H,hasBeenPresented:M,isMobileScreenReaderEnabled:ie,knownPSTNContactMri:F,isPSTNCall:m,isS4BCall:f,isEncryptedCall:S,statusBarHeight:G,hasMicrophones:k.default.DeviceStore.hasMicrophones(),hasSpeakers:k.default.DeviceStore.hasSpeakers(),isAudioOutputSelectionSupported:k.default.DeviceStore.getIsAudioOutputSelectionSupported(),enableNewCaptureActivityPip:te===j.CallControlsType.Mobile&&l.enableNewCaptureActivityPip,topSafeAreaHeight:re||Ke.default.keepStatusBarVisible()?Ke.default.statusBarPadding():0,bottomSafeAreaInset:Ke.default.bottomSafeAreaInset(ae.BottomInsetDefault),isReconnectUIEnabled:l.enableCallReconnectUI,isSpeakerMuted:!!q.CallingCapabilities.speakerVolumeControlSupported()&&(k.default.CallingStore.isSpeakerMuted(n)||0===k.default.DeviceStore.getSpeakerVolume()),callAudioOutputRoute:k.default.CallControlsStore.getAudioOutput(),isNavigatingWithKeyboard:Te.default.isNavigatingWithKeyboard(),isRecentsOpen:!ne&&Ne.default.isLeftPanelShowing(I),isChatOpen:se,isRightPanelOpen:Z,isGalleryPanelOpen:J,isSubtitlesPanelOpen:ee,isLeftPanelOpen:X,isSplitNavCollapsed:ne,isRinglessCall:_,controlsType:te,isVideoSuggestionTooltipVisible:$.default.isVideoSuggestionTooltipVisible(n),lockOrientationForIncomingRing:c===j.CallUIState.IncomingRing&&i,isDesktopMin:Q.default.isDesktopMinCallPanelHeader(I),isDesktopMinCallRibbon:Q.default.isDesktopMinCallRibbon(I),useHighContrastTheme:Q.default.useHighContrastThemeAndChanges(),useLightTheme:be&&Q.default.useLightTheme(),isTranscriptionEnabled:k.default.InCallBotUtils.isCallTranslatorBotEnabled(p),isSkypeLogoEnabled:l.enableSkypeLogo,isInCallGalleryOpenOnMobile:!t&&this.state.isInCallGalleryOpenOnMobile,shouldShowReactions:ye,enableNewCameraFlipFlow:re,enableStopCallControlTimerWhenActionsMenuOpened:l.enableStopCallControlTimerWhenActionsMenuOpened,enableImmersiveModeRibbon:le,showFullScreenOptionInRibbonSettings:W,callNetworkQualityPoor:fe.isCallQualityPoor(n),callReconnectionState:fe.getCallReconnectionState(n),newMobileOverflowOpen:w.default.isOverflowMenuVisible(),showSpokenLanguageConflict:de,mobileSubtitlesRightPanelEnabled:ue,isInCallSubtitleHistoryModeOnMobile:!t&&this.state.isInCallSubtitleHistoryModeOnMobile&&!$.default.isCallVisible(n),showAloneInCall:_&&P&&O.default.getActiveParticipants(n,p).length+we.length===1,isTranslated:pe,translationBannerBeenDismissed:Be.default.getInCallTranslationBannerDismissState(p),enableDoubleTapToFullScreen:W&&l.enableDoubleTapToFullScreen,enableDialpadOnPSTNSubtitlesCalls:l.enableDialpadOnPSTNSubtitlesCalls,isOutgoingVideoDisabled:k.default.CallingFeaturesHelper.isOutgoingVideoDisabled(),isNewCallScreen:be,wasNewCallScreenRevertNoticeDismissed:Ee.default.getWasNewCallScreenRevertNoticeDismissed(),enableParticipantsButtonInCallControls:l.enableParticipantsButtonInCallControls&&!C,stageLayoutMode:Pe,activeCallsCount:k.default.CallingStore.getCallIds().filter((e=>k.default.CallingStore.isCallActive(e))).length,hideTogetherModeNoticeToastForCallId:Ee.default.getTogetherModeNoticePresentedForCallId(),isPossiblyNotConnectedAudienceBotInCall:k.default.CallingStore.isPossiblyNotConnectedAudienceBotInCall(n),renderHeaderV2:be&&!i,shouldShowTray:be&&!x.default.isTopTrayHidden(n)&&It.default.trayHasParticipants(n),isOneOnOneConversation:C,enableMusicMode:k.default.DeviceStore.getMusicMode(),canAccessConversationDetails:Mt.default.navigation().canAccessConversationDetails,pstnTranslationEnabled:ve};ke.isCallMediaBeingCaptured=!!ke.remoteParticipantsThatAreCapturingCallMedia&&ke.remoteParticipantsThatAreCapturingCallMedia.length>0,ke.callPanelHeaderLayout=x.default.getCallHeaderLayoutMode(n);const Ae=l.callCaptionsLiveButton&&l.callCaptionsPositionModeDefault&&!ve?l.callCaptionsPositionModeDefault:At.CaptionsPositionMode.float;if(t)if(this._callControlTimeoutMs=l.callControlTimeoutMs,this._callControlShortTimeoutMs=l.callControlShortTimeoutMs,this._callControlExtraShortTimeoutMs=500,ke.recordingBannerHeight=0,ke.cameraDeniedBannerHeight=0,ke.ndiUsedBannerHeight=0,ke.incomingVideoDisabledBannerHeight=0,ke.serverMuteNotificationBannerHeight=0,ke.callMediaCapturedBannerHeight=0,ke.callConnectionQualityBannerHeight=0,ke.spokenLangageConflictResolutionViewHeight=0,ke.mobileScreenShareBannerHeight=0,ke.mobileTeamsInteropBannerHeight=0,ke.mobileMusicModeNoticeBannerHeight=0,ke.mobileTogetherModeNoticeBannerHeight=0,ke.mobileNewCallScreenRevertNoticeBannerHeight=0,ke.mobileTranslationBannerHeight=0,ke.pstnTranslationNoticeBannerHeight=0,ke.hideCameraDeniedToast=!1,ke.hideCallControlsForActivity=!1,ke.useImmersiveMode=!1,ke.showDialpad=!1,ke.buttonsAndInfoHidden=!1,ke.suppressParticipantAnimation=!1,ke.titleWidth=0,ke.isMicrophoneMutedWhileSpeaking=!1,ke.showSpeakerOnWarning=!1,ke.showServerMutedToastOnMobile=!1,ke.isCallParticipantActionsMenuOpened=!1,ke.shouldRenderFloatingVideoPreview=!1,ke.hideTeamsInteropToast=!1,ke.hasCallCreatorShareOverlayPopup=!0,ke.userCaptionPositionMode=Ae,i){const e=this._getContext().componentVisibilityStatus;e&&(ke.isCallPanelVisible=e.isVisible(),this._visibilitySubscriptionToken=e.isVisibleEvent().subscribe((e=>{_e.log(he.LogTraceArea.CallingUI,"visibility changed, isVisible: "+e+", isCallPanelVisible: "+this.state.isCallPanelVisible),this.isComponentMounted()&&e!==this.state.isCallPanelVisible&&(e?this._setAsVideoTargetWithDelay():(_e.log(he.LogTraceArea.CallingUI,"Setting isCallPanelVisible: "+e),this.setState({isCallPanelVisible:e})))})))}else ke.isCallPanelVisible=!0;else ke.isRecording||(ke.recordingBannerHeight=0),ke.isNdiBeingUsed||(ke.ndiUsedBannerHeight=0),ke.isCallMediaBeingCaptured||(ke.callMediaCapturedBannerHeight=0),ke.isIncomingVideoDisabled||(ke.incomingVideoDisabledBannerHeight=0),this._showMobileServerMutedToast(ke)||(ke.serverMuteNotificationBannerHeight=0),this._showCallConnectionQualityToast(ke)||(ke.callConnectionQualityBannerHeight=0),ke.showSpokenLanguageConflict&&!ke.isCallOnHold||(ke.spokenLangageConflictResolutionViewHeight=0),ke.isMobileScreenShareActive||(ke.mobileScreenShareBannerHeight=0),ke.isTranslated&&!ke.translationBannerBeenDismissed||(ke.mobileTranslationBannerHeight=0),ke.userCaptionPositionMode=ve?At.CaptionsPositionMode.float:this.state.userCaptionPositionMode;if(this._callState=b,this._mustUpdateSpeakerMutedAsync(n,ke)&&a.defer((()=>{this._updateSpeakerMutedAsync(n).then((e=>{this.isComponentMounted()&&this.setState({isSpeakerMuted:e})}))})),!t&&this.state.conversationMri!==p&&!C&&xe.default.isUsingSplitViewNoSubscription()){const e=this.state.conversationMri,t=p;a.defer((()=>{k.default.CallNavigationHelper.escalateCallOnUWPSplitedView(e,t,n,bt.default.newCauseId())}))}const Re=(0,oe.default)().getConversation(p);return!(null==Re?void 0:Re.isJoinEnabled())&&!Me.MeetNowHelpers.isGuestFlow()&&(ke.hasCallCreatorShareOverlayPopup=!1),ke.isConversationCreator=Pt.default.getSkypeMri()===(null==Re?void 0:Re.creator()),ke}render(){const e=this._useMobileControls(),t=this.state.useLightTheme?Lt.callPanelLightTheme:Lt.callPanelCallStageV2,i=[Lt.callPanel,this.state.isNewCallScreen?t:void 0];h.StatusBar.isOverlay()&&i.push(je.default.paddingTopStyle(this.state.statusBarHeight));const a=Y.isReadOnlyConversation(this.state.conversationMri),n=e&&!this.state.isPSTNCall&&!this.state.isEncryptedCall&&!a,o=this._getTanscriptionRects(e),s=this._getCallStageViewRect(e),r=h.Styles.createViewStyle({width:s.width,height:s.height},!1);let l;if(e){const t=o&&!this.state.mobileSubtitlesRightPanelEnabled?o.stage:s;l=[h.createElement(h.View,{key:"controlscontainer",style:[Lt.mobileInnerViewBase,r]},this._renderCallStage(t),this._renderTray(s),this._renderReactionsPanel(this.state.shouldShowReactions),this._renderCallingAnimation(s,0,0),this._renderTranscriptionView(s,e),this._renderOptionalAloneInTheCallInformationView(),this._renderTransientView(),this._renderCallControls(this.state.shouldShowReactions,s),this._renderMobileTopBanner(s),this._renderTooltips()),this._renderCallPanelHeader(s),this._renderDialpad(s),this._renderAudioNotification()]}else{const e=this.state.enableDoubleTapToFullScreen?h.GestureView:h.View,t={};this.state.enableDoubleTapToFullScreen&&(t.onDoubleTap=()=>this._toggleFullScreenMode()),l=[h.createElement(e,Object.assign({key:"controlscontainer",style:[Lt.innerViewBase,r]},t),this._renderCallStage(s),q.CallingCapabilities.floatableResizableVideoPreviewSupported()?this._renderFloatingVideoPreview():void 0,this._renderCallPanelHeader(s),this._renderTray(s),this._renderSkypeLogo(),this._renderCallingAnimation(s,0,0),this._renderOptionalAloneInTheCallInformationView(),this._renderTransientView(),this._renderTranscriptionView(s),this._renderAudioNotification(),this._renderReactionsBar(s,this.state.shouldShowReactions,n),this._renderReactionsPanel(this.state.shouldShowReactions),this._renderCallControls(this.state.shouldShowReactions,s),this._renderDialpad(s),this._renderTooltips(),this._renderCallCreatorShareOverlayPopup())]}return h.createElement(ie.default,{goBack:this._goBack},h.createElement(h.View,{style:i,onLayout:this._onLayoutChange,onMouseMove:this._onMouseMove,onMouseLeave:this._onMouseLeave},h.createElement(te.CoachMarkContext.Provider,{value:this._coachMarkContext},l)))}componentDidMount(){super.componentDidMount();const{callId:e}=this.props.route.params,t=bt.default.newCauseId();_e.log(he.LogTraceArea.CallingUI,"componentDidMount causeId: "+t),s.default.enableLowProfileMode().catch((e=>{_e.warn(he.LogTraceArea.CallingUI,"enableLowProfileMode failed: "+ut.default.errorAsString(e))})),$.default.setCallViewVisible(e,!0,t),k.default.CallingStore.unregisterRemoteStreamOverride(e,R.VideoOverrideReason.InBackground,t),k.default.CallingStore.unregisterLocalVideoOverride(e,R.VideoOverrideReason.InBackground,t),this.state.isIncomingVideoDisabled&&k.default.CallingStore.disableIncomingVideo(e,t),this.state.buttonsAndInfoHidden||this._callControlsAnimatedTranslateYValue.setValue(this._controlsTranslateY()),this._subscriptions.push(S.default.subscribeForChanges("CallPanel",this._onAppStateChange)),this._updateAudioState(t),k.default.OngoingCallService.updateVideoState(e,h.App.getActivationState()),this._updateLeftNoneStateOnce(t),this.state.callUIState!==j.CallUIState.Default&&this.state.callUIState!==j.CallUIState.Voicemail||this._startParticipantAnimationSuppressionTimeout(),this.state.lockOrientationForIncomingRing&&(_e.log(he.LogTraceArea.CallingUI,"componentDidMount, entered IncomingRing state, locking orientation causeId: "+t),this._lockOrientationForIncomingRing()),this._callParticipantAccessoryOpacityValue.setValue(this.state.buttonsAndInfoHidden?1:0),this.state.isUsingStackNavigationContext&&(_e.log(he.LogTraceArea.CallingUI,"componentDidMount, setting keyboard resize mode to None causeId: "+t),be.default.setResizeMode(r.KeyboardAwareResizeMode.None)),this._subscriptions.push(k.default.CallingStore.callDeviceQualityEvent().subscribe(this._updateDeviceQualityState)),this._subscriptions.push(k.default.CallingStore.serverMutedEvent().subscribe(this._updateServerMutedState)),this._subscriptions.push(k.default.CallingStore.deviceNearEndQualityEvent().subscribe(this._updateDeviceNearEndQuality)),this._subscriptions.push(k.default.DeviceStore.selectedDevicesChangedEvent().subscribe(this._selectedDevicesChanged)),this._subscriptions.push(k.default.DeviceStore.availableDevicesChangedEvent().subscribe(this._availableDevicesChanged)),this._subscriptions.push(k.default.DeviceStore.onVideoEffectsQualityChangedEvent().subscribe(this._onVideoEffectsQualityChangedEvent)),ce.dismissAll();const i=dt.default.mergeStyles([dt.default.createBackgroundColorStyle(ht.Color.black),dt.default.createBarStyle(ct.BarStyleTheme.Light)]);this._updateStatusBarStyle(i),this._startOrStopOrientationListener(!0),this._registerKeyboardHandlers(),this.state.isChatOpen||B.default.assignOuterThread(this.state.reactionsConversationMri,this.state.conversationMri);const a=this._useMobileControls();a||h.Input.keyUpEvent.subscribe(this._onKeyUp),Ae.default.addOrUpdateBottomMargin(Vt,a?82:100),this._maybeShowOrHideDeviceErrorToast(!0,!0,t),this._maybeShowCompositeCallRecordingToast(!1),this._maybeShowCompositeIncomingVideoDisabledToast(!1,t),this._maybeShowCompositeCallConnectionQualityToast(!1,t),this._maybeShowCompositeCameraDeniedToast(),this._maybeShowCompositeTeamsInteropInCallToast(t),this._maybeShowCompositeTogetherModeNoticeInCallToast(t),this._maybeShowCompositeMusicModeNoticeInCallToast(t),this._maybeShowNewCallScreenRevertNotice(t),this._maybeShowCompositePstnTranslationInCallToast(t),this._maybeShowCompositeTranslationInCallToast(t),this.state.controlsType===j.CallControlsType.DesktopMin&&H.default.updateCallTelemetry(e,t,(e=>e.setEnterMinWidth())),k.default.OngoingCallService.getIsChatSidebarOpen(e)&&!this.state.isChatOpen&&this._toggleChatPanel(t),this._disposables.push(new A.SubscriptionDisposable(Be.default.subscribe(this._reloadCaptionPositionMode,Be.TriggerKeys.CallTranslatorCaptionsPositionMode),(e=>Be.default.unsubscribe(e)))),this._reloadCaptionPositionMode(),lt.default.callPanelRendered()}componentWillUnmount(){super.componentWillUnmount();const{callId:e}=this.props.route.params;this._hideAllDeviceErrorToasts(),ee.default.closeCoachMark({});const t=bt.default.newCauseId();_e.log(he.LogTraceArea.CallingUI,"componentWillUnmount causeId: "+t),s.default.disableLowProfileMode().catch((e=>{_e.warn(he.LogTraceArea.CallingUI,"enableLowProfileMode failed: "+ut.default.errorAsString(e))})),k.default.CallingStore.isCallConnected(e)&&H.default.updateCallTelemetry(e,t,(e=>e.sideNavigateInCall())),B.default.setHasPostedReactions(this.state.reactionsConversationMri,!1),this._subscriptions.forEach((e=>e.unsubscribe())),this._subscriptions=[],this._disposables.forEach((e=>e.dispose())),this._disposables=[],$.default.setCallViewVisible(e,!1,t),w.default.resetAllVisibility(t),be.default.setResizeMode(r.KeyboardAwareResizeMode.Default),Ve.default.removeOrientationLock(this._orientationLockKey),this._startOrStopOrientationListener(!1),this._unregisterKeyboardHandlers(),this._visibilitySubscriptionToken&&(this._visibilitySubscriptionToken.unsubscribe(),this._visibilitySubscriptionToken=void 0),this._useMobileControls()||h.Input.keyUpEvent.unsubscribe(this._onKeyUp),Ae.default.removeBottomMargin(Vt),xe.default.isUsingSplitViewNoSubscription()&&this.state.isChatOpen&&Oe.default.closeConversationInCall(t,this._getContext()),this.state.newMobileOverflowOpen&&re.default.closeIfNeeded(this._getRootViewId(),t)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const{callId:o,initialConversationMri:s}=this.props.route.params,r=bt.default.newCauseId();_e.log(he.LogTraceArea.CallingUI,"componentDidUpdate causeId: "+r);const l=this._useMobileControls();if(!t.hasBeenPresented&&this.state.hasBeenPresented&&(_e.log(he.LogTraceArea.CallingUI,"componentDidUpdate, hasBeenPresented: true"),_t.default.setTimeout((()=>{ce.dismissAll()}),1e3)),t.callUIState!==this.state.callUIState&&(_e.log(he.LogTraceArea.CallingUI,"componentDidUpdate, callUIState changed: "+j.CallUIState[t.callUIState]+" -> "+j.CallUIState[this.state.callUIState]+" causeId: "+r),this._updateLeftNoneStateOnce(r),t.callUIState===j.CallUIState.GoLiveSinglePlayer&&this.state.callUIState===j.CallUIState.Default)){const e=a.filter(k.default.CallingStore.getRemoteCallMembers(o),(e=>A.default.isParticipantConnected(e)));if(!a.isEmpty(e)){const t=e[0],i=k.default.CallingStore.getRemoteCallMemberMri(o,t),a=de.default.getDisplayName(i)||"";$e.default.maybeAnnounceForAccessibility(Ie.getString("CallPanel.FirstParticipantJoinAccessibility",{name:a}))}}if(t.lockOrientationForIncomingRing!==this.state.lockOrientationForIncomingRing&&(this.state.lockOrientationForIncomingRing?(_e.log(he.LogTraceArea.CallingUI,"componentDidUpdate, entered IncomingRing state, locking orientation causeId: "+r),this._lockOrientationForIncomingRing()):(_e.log(he.LogTraceArea.CallingUI,"componentDidUpdate, left IncomingRing state, unlocking orientation causeId: "+r),Ve.default.removeOrientationLock(this._orientationLockKey))),t.outgoingRingStatus!==this.state.outgoingRingStatus&&_e.log(he.LogTraceArea.CallingUI,"componentDidUpdate, outgoingRingStatus changed: "+t.outgoingRingStatus+" -> "+this.state.outgoingRingStatus+" causeId: "+r),this.state.exitingCall&&!t.exitingCall&&(_e.log(he.LogTraceArea.CallingUI,"componentDidUpdate, call disconnected, callState = "+this._callState+" terminatedReason = "+this.state.terminatedReason+" endCallNavigationRequested = "+this._endCallNavigationRequested),this._onEscape(),!this._endCallNavigationRequested)){this._endCallNavigationRequested=!0;const e=bt.default.newCauseId();if(this.state.terminatedReason===g.TerminatedReason.PstnInvalidNumber)_e.log(he.LogTraceArea.CallingUI,"componentDidUpdate, exit call with invalid number causeId: "+e),xe.default.isUsingSplitViewNoSubscription()?u.default.closeSplitView(s):this.state.isUsingStackNavigationContext?Oe.default.navigateToHub(e):Oe.default.navigateToWelcomeScreen(e);else{_e.log(he.LogTraceArea.CallingUI,"componentDidUpdate, exit call causeId: "+e);const t=this.state.activeCallsCount>1||this.state.terminatedReason===g.TerminatedReason.Declined||this.state.terminatedReason===g.TerminatedReason.Missed||this.state.terminatedReason===g.TerminatedReason.Cancelled&&!this.state.isCallCreator;this._exitCall(t,!1,e)}}const c=this.state.callUIState===j.CallUIState.Default||this.state.callUIState===j.CallUIState.Voicemail,d=c&&!this._hasConnected,h=!this.state.newMobileOverflowOpen&&t.newMobileOverflowOpen;if(c&&(this.state.buttonsAndInfoHidden!==t.buttonsAndInfoHidden||d||h)&&!this._shouldKeepControlsVisible()){const e=this._useMobileControls()&&!d?this._callControlTimeoutMs:this._callControlShortTimeoutMs;this._startHideControlsTimer(d||!this.state.buttonsAndInfoHidden,e,r),this._hasConnected=!0}if(t.callUIState!==j.CallUIState.Default&&t.callUIState!==j.CallUIState.Voicemail&&c&&(this.state.isCallCreator&&Y.isOneOnOneConversation(this.state.conversationMri)&&k.default.CallPostMessageService.postOneOnOneCallStartedPartListMessage(this.state.conversationMri,o),this._startParticipantAnimationSuppressionTimeout()),!this.state.isCallParticipantActionsMenuOpened&&(t.buttonsAndInfoHidden!==this.state.buttonsAndInfoHidden||this.state.isMobileScreenReaderEnabled!==t.isMobileScreenReaderEnabled||this.state.useImmersiveMode!==t.useImmersiveMode||this.state.hideCallControlsForActivity!==t.hideCallControlsForActivity||this.state.isVideoSuggestionTooltipVisible!==t.isVideoSuggestionTooltipVisible)){const e=this._areControlsVisible()||this.state.isMobileScreenReaderEnabled||this.state.isVideoSuggestionTooltipVisible;this._animateShowOrHideControls(e,!0,r),this._showOrHideStatusBar(e),le.default.clearToolTip()}this.state.isLandscape===t.isLandscape&&this.state.bottomSafeAreaInset===t.bottomSafeAreaInset||(this.state.buttonsAndInfoHidden?this._showOrHideStatusBar(!1):(_e.log(he.LogTraceArea.CallingUI,"componentDidUpdate updating call controls bottom, causeId: "+r),this._callControlsAnimatedTranslateYValue.setValue(this._controlsTranslateY()))),this.state.showDialpad&&!t.showDialpad&&this._animateDialpad(!0,r),(this._isIncomingOrOutgoingRing()||this.state.callUIState===j.CallUIState.GoLiveSinglePlayer)&&this.state.buttonsAndInfoHidden&&this._showOrHideControls(!0,r),this._useMobileControls()||this._areControlsVisible()||this._showOrHideControls(!0,r,{},!0),this.state.conversationMri===t.conversationMri&&this.state.isChatOpen===t.isChatOpen||(this.state.conversationMri!==t.conversationMri&&this.state.isChatOpen&&(Oe.default.closeConversationInCall(r,this._getContext()),Oe.default.openConversationInCall(r,this.state.conversationMri,o,this._getContext(),this._toggleChatPanel)),this.state.isChatOpen?B.default.clearOuterThreadAssignment(this.state.reactionsConversationMri,this.state.conversationMri):B.default.assignOuterThread(this.state.reactionsConversationMri,this.state.conversationMri)),this.state.isTranslating!==t.isTranslating&&(this.state.isTranslating?z.default.assignCallId(this.state.reactionsConversationMri,o):(this.state.pstnTranslationEnabled||z.default.clearCallIdAssignment(this.state.reactionsConversationMri),k.default.OngoingCallService.setIsSubtitleHistoryOpen(o,!1))),this._maybeShowOrHideDeviceErrorToast(t.hasMicrophones,t.hasSpeakers,r),this._maybeShowCompositeCallRecordingToast(t.isRecording),this._maybeShowCompositeIncomingVideoDisabledToast(t.isIncomingVideoDisabled,r),this._maybeShowCompositeCallConnectionQualityToast(t.callNetworkQualityPoor,r),this._maybeShowCompositeCameraDeniedToast(),this._maybeShowCompositeTeamsInteropInCallToast(r),this._maybeShowCompositeTogetherModeNoticeInCallToast(r),this._maybeShowNewCallScreenRevertNotice(r),this._maybeShowCompositeMusicModeNoticeInCallToast(r),this._maybeShowCompositeTranslationInCallToast(r),this._maybeShowCompositePstnTranslationInCallToast(r),t.controlsType!==this.state.controlsType&&this.state.controlsType===j.CallControlsType.DesktopMin&&H.default.updateCallTelemetry(o,r,(e=>e.setEnterMinWidth())),this.state.isProvidingVideo!==t.isProvidingVideo&&Q.default.announceVideoState(this.state.isProvidingVideo),this.state.isCallOnHold!==t.isCallOnHold&&(Q.default.announceHoldState(this.state.isCallOnHold),!this.state.isCallOnHold&&this._callControls&&this._callControls.toggleReactionsPickerButton(!1,!1));const p=t.selectedCamera&&t.selectedCamera.position,C=this.state.selectedCamera&&this.state.selectedCamera.position;if(p!==g.CameraPosition.Unknown&&C!==g.CameraPosition.Unknown&&p!==C&&Q.default.announceCameraDirectionState(C),this.state.callAudioOutputRoute!==n.default.AudioOutputEarpiece&&t.callAudioOutputRoute===n.default.AudioOutputEarpiece&&(this.setState({showSpeakerOnWarning:!0}),a.isUndefined(this._speakerOnWarningTimeout)||_t.default.clearTimeout(this._speakerOnWarningTimeout),this._speakerOnWarningTimeout=_t.default.setTimeout((()=>{this._speakerOnWarningTimeout=void 0,this.isComponentMounted()&&this.setState({showSpeakerOnWarning:!1})}),5e3)),this.state.isNavigatingWithKeyboard!==t.isNavigatingWithKeyboard&&this._showOrHideControls(this.state.isNavigatingWithKeyboard,r),this.state.isChatOpen!==t.isChatOpen&&k.default.OngoingCallService.setIsChatSidebarOpen(o,this.state.isChatOpen),this.state.userCaptionPositionMode===At.CaptionsPositionMode.bottom){const e=this._getCallStageViewRect(l),t=this._innerViewStyleHeight(e,l),i=this._getTransciptionBottomViewHeight(t);this.setState({userCaptionsBottomViewHeight:i})}else this.setState({userCaptionsBottomViewHeight:0})}_lockOrientationForIncomingRing(){Ve.default.addOrUpdateOrientationLock(this._orientationLockKey,s.DeviceOrientation.Portrait),this.setState({isLandscape:!1})}_exitCall(e,t,i){_e.log(he.LogTraceArea.CallingUI,"_exitCall shouldNavigateBack: "+e+" causeId: "+i),this._onNavigatedAwayFromCall(i);const a=this.state.isPSTNCall&&this.state.knownPSTNContactMri||this.props.route.params.initialConversationMri;Oe.default.navigateCallComplete(a,e,t,this._getContext(),i)}_maybeShowCompositeCameraDeniedToast(){!this._useMobileControls()&&this._shouldShowCameraDeniedToast()&&(_e.log(he.LogTraceArea.CallingUI,"CallPanel._maybeShowCompositeCameraDeniedToast, showing toast"),this._hasShownCameraDeniedToast=!0,k.default.CallNavigationHelper.showCameraDeniedToast({callId:this.props.route.params.callId,conversationMri:this.state.conversationMri}))}_shouldShowCameraDeniedToast(){return!!this.props.route.params.convertedVideoToAudio&&!this._hasShownCameraDeniedToast&&!this.state.hideCameraDeniedToast&&this.state.isCallActive}_maybeShowCompositeCallRecordingToast(e){this._useMobileControls()||!this.state.isRecording||e||(_e.log(he.LogTraceArea.CallingUI,"CallPanel._maybeShowCallRecordingToast, showing toast"),k.default.CallNavigationHelper.showCallRecorderToast({callId:this.props.route.params.callId,conversationMri:this.state.conversationMri,action:(e,t)=>{t&&this._callControls&&this._callControls.focusCallEndButton()}}))}_maybeShowCompositeIncomingVideoDisabledToast(e,t){this._useMobileControls()||!this.state.isIncomingVideoDisabled||e||(_e.log(he.LogTraceArea.CallingUI,`CallPanel._maybeShowIncomingVideoDisabledToast.  causeId ${t}`),k.default.CallNavigationHelper.showIncomingVideoDisabledToast({callId:this.props.route.params.callId,conversationMri:this.state.conversationMri},t))}_maybeShowCompositeTeamsInteropInCallToast(e){!this._useMobileControls()&&this._shouldShowTeamsInteropToast()&&(_e.log(he.LogTraceArea.CallingUI,`CallPanel._maybeShowCompositeTeamsInteropInCallToast.  causeId ${e}`),this._hasShownTeamsInteropBanner=!0,k.default.CallNavigationHelper.showGeneralPurposeInCallToast({toastType:ne.ToastType.TeamsInterop,callId:this.props.route.params.callId,conversationMri:this.state.conversationMri},e))}_maybeShowCompositeTogetherModeNoticeInCallToast(e){!this._useMobileControls()&&this._shouldShowTogetherModeNoticeToast()&&(_e.log(he.LogTraceArea.CallingUI,`CallPanel._maybeShowCompositeTogetherModeNoticeInCallToast.  causeId ${e}`),this._hasShownTogetherModeNoticeBannerForCallId=!0,Ee.default.setTogetherModeNoticePresentedForCallId(this.props.route.params.callId),k.default.CallNavigationHelper.showGeneralPurposeInCallToast({toastType:ne.ToastType.TogetherModeNotice,callId:this.props.route.params.callId,conversationMri:this.state.conversationMri},e))}_maybeShowCompositeMusicModeNoticeInCallToast(e){!this._useMobileControls()&&this._shouldShowMusicModeNoticeToast()?(_e.log(he.LogTraceArea.CallingUI,`CallPanel._maybeShowCompositeMusicModeNoticeInCallToast.  causeId ${e}`),this._hasShownMusicModeNoticeBannerForCallId=!0,Ee.default.setMusicModeNoticePresentedForCallId(this.props.route.params.callId),k.default.CallNavigationHelper.showGeneralPurposeInCallToast({toastType:ne.ToastType.MusicModeEnabled,callId:this.props.route.params.callId,conversationMri:this.state.conversationMri},e)):!this.state.enableMusicMode&&this._hasShownMusicModeNoticeBannerForCallId&&this._closeMusicModeNoticeToast()}_maybeShowCompositePstnTranslationInCallToast(e){!this._useMobileControls()&&this.state.pstnTranslationEnabled&&!this.state.pstnTranslationBannerBeenDismissed&&y.default.getS4LCMCFeaturesNoSubscription().pstnTranslation.showToast&&(_e.log(he.LogTraceArea.CallingUI,`CallPanel._maybeShowCompositePstnTranslationInCallToast.  causeId ${e}`),k.default.CallNavigationHelper.showGeneralPurposeInCallToast({toastType:ne.ToastType.PstnTranslation,callId:this.props.route.params.callId,conversationMri:this.state.conversationMri,onDismiss:this._onPstnTranslationNoticeDismiss},e))}_maybeShowNewCallScreenRevertNotice(e){const t=y.default.getS4LCMCFeaturesNoSubscription().newCallScreenEnabledByDefault;this.state.isNewCallScreen&&!this.state.wasNewCallScreenRevertNoticeDismissed&&t&&(this._useMobileControls()?this.setState({renderMobileNewCallScreenRevertNotice:!0}):k.default.CallNavigationHelper.showGeneralPurposeInCallToast({toastType:ne.ToastType.NewCallScreenRevertNotice,callId:this.props.route.params.callId,conversationMri:this.state.conversationMri,onDismiss:this._onNewCallScreenRevertNoticeDismiss},e))}_shouldShowTeamsInteropToast(){return Y.isS4BBridgeMri(this.state.conversationMri)&&!this._hasShownTeamsInteropBanner&&!this.state.hideTeamsInteropToast&&this.state.isCallActive}_shouldShowTogetherModeNoticeToast(){return this.state.isPossiblyNotConnectedAudienceBotInCall&&!this._hasShownTogetherModeNoticeBannerForCallId&&this.state.hideTogetherModeNoticeToastForCallId!==this.props.route.params.callId&&this.state.isCallActive}_shouldShowMusicModeNoticeToast(){return this.state.enableMusicMode&&!this._hasShownMusicModeNoticeBannerForCallId&&this.state.hideMusicModeNoticeToastForCallId!==this.props.route.params.callId&&this.state.isCallActive}_maybeShowCompositeTranslationInCallToast(e){this._useMobileControls()||!this.state.isTranslated||this.state.translationBannerBeenDismissed||(_e.log(he.LogTraceArea.CallingUI,`CallPanel._maybeShowCompositeTranslationInCallToast.  causeId ${e}`),k.default.CallNavigationHelper.showTranslationInCallToast({callId:this.props.route.params.callId,conversationMri:this.state.conversationMri},e))}_maybeShowCompositeCallConnectionQualityToast(e,t){this._useMobileControls()||!this.state.callNetworkQualityPoor||e||(_e.log(he.LogTraceArea.CallingUI,`CallPanel._maybeShowCallConnectionQualityToast.  causeId ${t}`),k.default.CallNavigationHelper.showCallConnectionQualityToast({callId:this.props.route.params.callId,conversationMri:this.state.conversationMri},t))}_maybeShowOrHideDeviceErrorToast(e,t,i){this.state.callUIState!==j.CallUIState.Default&&this.state.callUIState!==j.CallUIState.Voicemail||(this.state.hasMicrophones||!e&&this._hasShownNoMicrophoneConnectedToast?this.state.hasSpeakers||!this.state.isAudioOutputSelectionSupported||!t&&this._hasShownNoSpeakerConnectedToast||(this._showDeviceErrorToast(j.DeviceStatusToastType.SpeakerDisconnected,i),this._hasShownNoSpeakerConnectedToast||(this._hasShownNoSpeakerConnectedToast=!0)):(this._showDeviceErrorToast(j.DeviceStatusToastType.MicrophoneDisconnected,i),this._hasShownNoMicrophoneConnectedToast||(this._hasShownNoMicrophoneConnectedToast=!0))),this.state.hasSpeakers&&!t&&this._hideDeviceErrorToastOfType(j.DeviceStatusToastType.SpeakerDisconnected),this.state.hasMicrophones&&!e&&this._hideDeviceErrorToastOfType(j.DeviceStatusToastType.MicrophoneDisconnected)}_hideAllDeviceErrorToasts(){a.each(this._deviceErrorToasts,(e=>k.default.CallNavigationHelper.hideToast(e))),this._deviceErrorToasts={}}_hideDeviceErrorToastOfType(e){this._deviceErrorToasts[e]&&(k.default.CallNavigationHelper.hideToast(this._deviceErrorToasts[e]),delete this._deviceErrorToasts[e])}_showDeviceErrorToast(e,t,i,a){const n=Q.default.getToastInformation(e,i,a,(i=>{H.default.trackInCallUFD(this.props.route.params.callId,e,i),H.default.updateCallTelemetry(this.props.route.params.callId,t,(e=>e.ufdDisplayed(i)))}));if(n){this._hideDeviceErrorToastOfType(e);const t=k.default.CallNavigationHelper.showNotificationToast(n);t&&(this._deviceErrorToasts[e]=t)}}_showDeviceChangeToast(e,t,i){const n=k.default.DeviceStore.isSelectedCompositeAudioDevice(e);n&&e.push(n),a.isEmpty(a.filter(e,(e=>e.kind!==g.DeviceType.Camera)))||(_e.log(he.LogTraceArea.CallingUI,"_showDeviceChangeToast: remove composite audio device toast if presented"),this._hideDeviceErrorToastOfType(j.DeviceStatusToastType.CompositeAudioAvailable)),e.forEach((e=>{switch(e.kind){case g.DeviceType.Camera:this._showDeviceErrorToast(j.DeviceStatusToastType.CameraChanged,i,{deviceName:e.label});break;case g.DeviceType.Microphone:n||this._showDeviceErrorToast(j.DeviceStatusToastType.MicrophoneChanged,i,{deviceName:e.label});break;case g.DeviceType.Speaker:n||this._showDeviceErrorToast(j.DeviceStatusToastType.SpeakerChanged,i,{deviceName:e.label});break;case g.DeviceType.CompositeAudioDevice:if(n)this._hideDeviceErrorToastOfType(j.DeviceStatusToastType.MicrophoneChanged),this._hideDeviceErrorToastOfType(j.DeviceStatusToastType.SpeakerChanged),this._showDeviceErrorToast(j.DeviceStatusToastType.CompositeAudioAvailable,i,{deviceName:n.label});else if(!t){const t=e,a=()=>this._hideDeviceErrorToastOfType(j.DeviceStatusToastType.CompositeAudioAvailable),n=[{labelKey:"StartCallUtils.ConfirmButtonText",callback:()=>{k.default.DeviceStore.choosePreferredDevices({microphone:t.microphoneId,speaker:t.speakerId},i),a()}},{labelKey:"StartCallUtils.CancelButtonText",callback:a}];this._showDeviceErrorToast(j.DeviceStatusToastType.CompositeAudioAvailable,i,{deviceName:t.label},n)}}}))}_navigateToChat(e,t,i){_e.log(he.LogTraceArea.CallingUI,"_navigateToChat, causeId: "+i),this.state.isUsingStackNavigationContext?(_e.log(he.LogTraceArea.CallingUI,"_navigateToChat, exit to conversation, causeId: "+i),H.default.updateCallTelemetry(this.props.route.params.callId,i,(e=>e.chatOpened())),this._exitCall(e,t,i)):this._toggleChatPanel(i)}_toggleLeftPanelForAction(e,t,i){_e.log(he.LogTraceArea.CallingUI,"_toggleLeftPanelForAction causeId: "+i);e().completeAction()}_closeRightPanel(e,t){_e.log(he.LogTraceArea.CallingUI,"_closeRightPanel causeId: "+t),e()}_animateShowOrHideControls(e,t,i){const a=e?1:0,n=e?0:-1e3,o=e?0:1,s=this._isIncomingOrOutgoingRing()?0:1-o,r=this._useMobileControls();let l,c;if(r||e||r&&!this.state.hideCallControlsForActivity&&!this.state.useImmersiveMode?(l=!0,c=this._controlsTranslateY()):(l=!1,c=r?55+j.AudioNotificationOffset:j.DesktopCallControlsHeight+j.AudioNotificationOffset),_e.log(he.LogTraceArea.CallingUI,"_animateShowOrHideControls showControls:"+e+" adjustedShowControls: "+l+" hideCallControlsForActivity "+this.state.hideCallControlsForActivity+" useImmersiveMode: "+this.state.useImmersiveMode+" animated: "+t+" causeId: "+i),r||this._newCompositeReactionsAnimatedOpacityValue.setValue(e?1:0),e&&(this._callHeaderAnimatedTranslateYValue.setValue(n),this._callControlsAnimatedTranslateYValue.setValue(c)),this._controlsAnimation&&this._controlsAnimation.stop(),t){this._controlsAnimation=h.Animated.parallel([d.timing.easeOut({value:this._callHeaderAnimatedOpacityValue,toValue:a}),d.timing.easeOut({value:this._callControlsAnimatedOpacityValue,toValue:s}),d.timing.easeOut({value:this._topBannerAnimatedOpacityValue,toValue:o}),d.timing.easeOut({value:this._callStageOverlayOpacityValue,toValue:s}),d.timing.easeOut({value:this._callParticipantAccessoryOpacityValue,toValue:o}),d.timing.easeOut({value:this._callParticipantTooltipOpacityValue,toValue:s})]),this._controlsAnimation.start((t=>{this._maybeCompleteRenderCallControlsScenario(),t.finished?(delete this._controlsAnimation,this._callHeaderAnimatedTranslateYValue.setValue(n),this._callControlsAnimatedTranslateYValue.setValue(c)):(_e.log(he.LogTraceArea.CallingUI,"componentDidUpdate buttonsAndInfoHidden animation did not complete, causeId "+i),e===this._areControlsVisible()&&this._animateShowOrHideControls(!this.state.buttonsAndInfoHidden,!1,i))}));const t=this._renderCallControlsScenario;t&&t.markStepCompleted("StartedAnimation")}else this._topBannerAnimatedOpacityValue.setValue(o),this._callHeaderAnimatedOpacityValue.setValue(a),this._callHeaderAnimatedTranslateYValue.setValue(n),this._callControlsAnimatedTranslateYValue.setValue(c),this._callParticipantAccessoryOpacityValue.setValue(o),this._callParticipantTooltipOpacityValue.setValue(s),this._callStageOverlayOpacityValue.setValue(s),this._maybeCompleteRenderCallControlsScenario()}_maybeCompleteRenderCallControlsScenario(){const e=this._renderCallControlsScenario;e&&(e.markStepCompleted("MadeOpaque"),this._renderCallControlsScenario=void 0,a.defer((()=>{e.markStepCompleted("backOnJSThread"),e.finish()})))}_areControlsVisible(){return!this.state.buttonsAndInfoHidden}_coachMarksBeingShown(){return ee.default.isCoachMarkBeingShown({areaType:te.CoachMarkAreaType.CallPanel})}_clearHideControlsTimer(){this._hideControlsTimer&&(_t.default.clearTimeout(this._hideControlsTimer),this._hideControlsTimer=void 0)}_startHideControlsTimer(e,t,i){this._isIncomingOrOutgoingRing()||!this.isComponentMounted()||this.state.isCallParticipantActionsMenuOpened||(this._clearHideControlsTimer(),e&&!this.state.buttonsAndInfoHidden&&(this._hideControlsTimer=_t.default.setTimeout((()=>{this.isComponentMounted()&&!this._isIncomingOrOutgoingRing()&&this._showOrHideControls(!1,i)}),t)))}_renderTranscriptionView(e,t){if(this.state.isSubtitlesPanelOpen||!this._canShowTranscription())return;const i=this._transcriptionLayout(false,t),a=G.default.getTranscriptionLayoutRects(e,i);let n=h.Styles.createViewStyle({position:"absolute",left:a.isHorizontal?0:a.stage.width,right:0,top:a.isHorizontal?a.stage.height:a.subtitles.y,bottom:0},!1);const o=this._getTranscriptionBottomPadding();return this.state.userCaptionPositionMode===At.CaptionsPositionMode.bottom&&(n=h.Styles.createViewStyle({position:"absolute",height:this.state.userCaptionsBottomViewHeight,width:e.width,bottom:this.state.isUsingStackNavigationContext?0:j.DesktopCallControlsHeight,paddingTop:10},!1)),h.createElement(W.default,{style:n,key:"callTranscriptionView",callId:this.props.route.params.callId,reactionsMri:this.state.reactionsConversationMri,bottomPadding:o,showControls:!this.state.buttonsAndInfoHidden,useLightTheme:this.state.useLightTheme,onPressOpen:this._onPressOpenSubtitleHistory,captionPositionMode:this.state.userCaptionPositionMode})}_renderTransientView(){let e;const{callId:t}=this.props.route.params;if(this.state.isCallOnHold){const i=k.default.OngoingCallService.getOnHoldForInterruption(t)?()=>{k.default.CallingStore.isCallKitCall(t).then((e=>{e?this._requestResumeCall():this._requestEndInterruption}))}:void 0;e=h.createElement(K.default,{key:"callTransientStateView",type:K.CallTransientStateViewType.Hold,header:Ie.getString("CallPanel.OnHoldHeader"),onPress:i,ignorePointerEvents:!0})}else this.state.isReconnectUIEnabled&&this.state.callReconnectionState===R.NetworkConnectionState.Connecting?(H.default.updateCallTelemetry(t,"renderTransientView",(e=>e.showedReconnectUI())),e=h.createElement(K.default,{key:"callTransientStateView",type:K.CallTransientStateViewType.Reconnect,header:Ie.getString("CallPanel.ReconnectingHeader"),body:Ie.getString("CallPanel.ReconnectingBody"),blockPointerEvents:!0})):this.state.callReconnectionState===R.NetworkConnectionState.LostConnection&&(e=h.createElement(K.default,{key:"callTransientStateView",type:K.CallTransientStateViewType.Reconnect,header:Ie.getString("CallPanel.NoNetworkHeader"),body:Ie.getString("CallPanel.NoNetworkBody"),blockPointerEvents:!0}));return e}_renderMobileTopBanner(e){const{callId:t}=this.props.route.params;if(!this._useMobileControls())return;let i,n,o,s,r,l,c,d,u,p,g=this.state.topSafeAreaHeight;if(this._shouldShowCameraDeniedToast()&&(n=h.createElement(et.default,{closeToast:this._closeCameraDeniedToast,onDesiredHeightChanged:this._onCameraDeniedToastHeightChanged,topInset:g}),g=0),this.state.isRecording&&(i=h.createElement(Ye.default,{callId:t,conversationMri:this.state.conversationMri,topInset:g,viewWidth:e.width,onDesiredHeightChanged:this._onRecordingBannerHeightChanged,onPress:this._onCallRecordingPress}),g=0),this.state.isNdiBeingUsed&&(o=h.createElement(Je.LocalStackNavCallMediaCapturerToast,{topInset:g,viewWidth:e.width,onDesiredHeightChanged:this._onNdiUsedBannerHeightChanged}),g=0),this.state.isCallMediaBeingCaptured&&!this.state.isCallOnHold){const i=this.state.remoteParticipantsThatAreCapturingCallMedia[0];s=h.createElement(Je.RemoteStackNavCallMediaCapturerToast,{callId:t,conversationMri:this.state.conversationMri,initiatorMri:i,topInset:g,viewWidth:e.width,onDesiredHeightChanged:this._onCallMediaCapturedBannerHeightChanged}),g=0}this.state.isIncomingVideoDisabled&&!this.state.isCallOnHold&&(r=h.createElement(it.default,{callId:t,conversationMri:this.state.conversationMri,topInset:g,onDesiredHeightChanged:this._onIncomingVideoDisabledBannerHeightChanged}),g=0),this.state.showSpokenLanguageConflict&&!this.state.isCallOnHold&&(l=h.createElement(ot.default,{topInset:g,onDesiredHeightChanged:this._onSpokenLangageConflictResolutionViewChanged,callId:t}),g=0),this._showCallConnectionQualityToast(this.state)&&(c=h.createElement(Ze.default,{callId:t,conversationMri:this.state.conversationMri,topInset:g,onDesiredHeightChanged:this._onCallConnectionQualityBannerHeightChanged}),g=0),this._showMobileServerMutedToast(this.state)&&(d=h.createElement(nt.default,{callId:t,conversationMri:this.state.conversationMri,topInset:g,onDesiredHeightChanged:this._onServerMuteNotificationBannerHeightChanged}),g=0),this.state.isMobileScreenShareActive&&!this.state.isCallOnHold&&(u=h.createElement(at.default,{callId:t,conversationMri:this.state.conversationMri,isEncryptedCall:this.state.isEncryptedCall,isPSTNCall:this.state.isPSTNCall,topInset:g,onDesiredHeightChanged:this._onMobileScreenShareBannerHeightChanged}),g=0),this._shouldShowTeamsInteropToast()&&(p=h.createElement(st.default,{closeToast:this._closeTeamsInteropToast,onDesiredHeightChanged:this._onMobileTeamsInteropBannerHeightChanged,topInset:g,conversationMri:this.state.conversationMri}),g=0);let C,m=[];return this._shouldShowTogetherModeNoticeToast()&&(m.push(h.createElement(tt.default,{type:ne.ToastType.TogetherModeNotice,closeToast:this._closeTogetherModeNoticeToast,onDesiredHeightChanged:this._onMobileTogetherModeNoticeBannerHeightChanged,topInset:g,conversationMri:this.state.conversationMri})),g=0),this.state.renderMobileNewCallScreenRevertNotice&&(m.push(h.createElement(tt.default,{type:ne.ToastType.NewCallScreenRevertNotice,closeToast:this._onNewCallScreenRevertNoticeDismiss,onDesiredHeightChanged:this._onMobileNewCallScreenRevertNoticeBannerHeightChanged,topInset:g,conversationMri:this.state.conversationMri})),g=0),this.state.isTranslated&&!this.state.translationBannerBeenDismissed&&this.state.isCallActive&&(C=h.createElement(rt.default,{callId:t,onDesiredHeightChanged:this._onMobileTranslationBannerHeightChanged,topInset:g,conversationMri:this.state.conversationMri}),g=0),this._shouldShowMusicModeNoticeToast()&&(m.push(h.createElement(tt.default,{type:ne.ToastType.MusicModeEnabled,closeToast:this._closeMusicModeNoticeToast,onDesiredHeightChanged:this._onMobileMusicModeNoticeBannerHeightChanged,topInset:g,conversationMri:this.state.conversationMri})),g=0),this.state.pstnTranslationEnabled&&!this.state.pstnTranslationBannerBeenDismissed&&y.default.getS4LCMCFeaturesNoSubscription().pstnTranslation.showToast&&(m.push(h.createElement(tt.default,{type:ne.ToastType.PstnTranslation,closeToast:this._onPstnTranslationNoticeDismiss,onDesiredHeightChanged:this._onPstnTranslationNoticeBannerHeightChanged,topInset:g,conversationMri:this.state.conversationMri})),g=0),i||o||s||r||n||l||d||c||u||C||p||!a.isEmpty(m)?h.createElement(h.Animated.View,{style:Lt.topBanner,ignorePointerEvents:!0},i,r,l,d,o,s,c,n,u,C,p,m):void 0}_renderReactionsBar(e,t,i){if(!t)return;const a=[Lt.reactionsBar,this._newCompositeReactionsAnimatedOpacityStyle,mt.default.floatingStyle];return h.createElement(h.Animated.View,{key:"reactionsBar",style:a,ignorePointerEvents:!0},h.createElement(E.default,{ref:this._onReactionsBarRef,style:Lt.reactionsBarCompositeInner,ignorePointerEvents:!0,conversationMri:this.state.conversationMri,reactionsConversationId:this.state.reactionsConversationMri,callId:this.props.route.params.callId,minDrawerHeight:360,controlsType:this.state.controlsType,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,viewDimensions:e,activitiesEnabled:i,isShowingChat:this.state.isChatOpen,bottomSafeAreaInset:this.state.isLandscape?0:this.state.bottomSafeAreaInset,audioNotificationOffset:j.AudioNotificationOffset,onDesiredHeightChanged:this.state.isUsingStackNavigationContext?this._onReactionsBarDesiredHeight:void 0,onCaptureMomentPress:this._reactionsBarOnCaptureMomentPress,onChatButtonPress:this._navigateToChatNotBack,onGalleryButtonPress:this._onOpenGalleryWithoutMessage,onReactionsDrawerOpen:this._onReactionsDrawerOpen,useDesktopCallControls:!this._useMobileControls()}))}_renderReactionsPanel(e){if(!e)return;const t=this._useMobileControls(),i=this.state.isUsingStackNavigationContext&&t?void 0:85,a=this.state.isUsingStackNavigationContext&&t?void 0:70;return h.createElement(h.Animated.View,{key:"reactionsPanel",style:Lt.fullScreenView,ignorePointerEvents:!0},h.createElement(ze.default,{callId:this.props.route.params.callId,conversationMri:this.state.conversationMri,bottomStyle:this._reactionsPanelAnimatedBottomStyle,reactionsConversationMri:this.state.reactionsConversationMri,isDesktop:!this.state.isUsingStackNavigationContext,desktopBottomMargin:i,desktopSideMargin:a,sizePhotosToFit:!this.state.isUsingStackNavigationContext&&t,photoTapDelay:this.state.isUsingStackNavigationContext||t?0:500,useHighContrastTheme:this.state.useHighContrastTheme,onPhotoTap:this._onOpenGallery,areMobileCallControlsVisible:t&&this._areControlsVisible()}))}_getCallStageViewRect(e){const t=this._getTanscriptionRects(e);return t&&this._canShowTranscription()&&!e&&this._canShowTranscriptionPanel(t),this.state.panelLayout}_innerViewStyleHeight(e,t){return this.state.isNewCallScreen?t?e.height-(this.state.shouldShowTray?j.MobileTopTrayHeight:0):e.height-j.DesktopCallControlsHeight-j.DesktopNewHeaderHeight-(this.state.shouldShowTray?j.DesktopTopTrayHeight:0):t?e.height:e.height-j.DesktopCallControlsHeight}_getTransciptionBottomViewHeight(e){if(this.state.isTranslating&&this.state.userCaptionPositionMode===At.CaptionsPositionMode.bottom){const t=y.default.getS4LCMCFeatures().callCaptionsBottomPanel.desktopSizePercentage;return Math.max(j.CallTranscriptionBottomViewMinHeight,e*t)}return 0}_getCallStageHeight(e,t){return this._innerViewStyleHeight(e,t)-(this.state.userCaptionsBottomViewHeight||0)}_renderTray(e){return this.state.shouldShowTray?h.createElement(wt.CallTrayView,{key:"callTrayView",conversationMri:this.state.conversationMri,callId:this.props.route.params.callId,callParticipantTooltipStyle:this._callParticipantNameTooltipStyle,hideNameTag:this.state.callUIState===j.CallUIState.GoLiveSinglePlayer,onCallParticipantContextMenuOpened:this.state.enableStopCallControlTimerWhenActionsMenuOpened?this._callParticipantActionsMenuOpened:void 0,onCallParticipantContextMenuDismissed:this.state.enableStopCallControlTimerWhenActionsMenuOpened?this._callParticipantActionsMenuClosed:void 0,isOneOnOneConversation:this.state.isOneOnOneConversation,disableReactions:this.state.isEncryptedCall,reactionsConversationId:this.state.reactionsConversationMri,onTextReactionPressed:this._navigateToChatNotBack,viewRect:e,onOverflowButtonPress:this._onShowParticipants,stageMode:this.state.stageLayoutMode,useLightTheme:this.state.useLightTheme,useMobileControls:this._useMobileControls()}):void 0}_renderCallStage(e){const{callId:t}=this.props.route.params,i=this._useMobileControls();let a=[Lt.fullScreenView];if(this.state.isNewCallScreen){const e=i?j.MobileNewHeaderHeight+(this.state.shouldShowTray?j.MobileTopTrayHeight:0):j.DesktopNewHeaderHeight+(this.state.shouldShowTray?j.DesktopTopTrayHeight:0);a.push(h.Styles.createViewStyle({top:e},!1))}let o=h.Styles.createViewStyle({width:e.width,height:this._getCallStageHeight(e,i)},!1);a.push(o);let s=this.state.skipRenderingParticipants||this.state.exitingCall?j.CallStageViewMode.None:this.state.callUIState!==j.CallUIState.Default?j.CallStageViewMode.StageOnly:j.CallStageViewMode.StageAndRibbon;this.state.callUIState===j.CallUIState.GoLiveSinglePlayer&&(s=j.CallStageViewMode.StageAndRibbon);const r=!(this.state.isInCallGalleryOpenOnMobile||this.state.isInCallSubtitleHistoryModeOnMobile);let l=e.width-(this.state.isDesktopMin?60:this.state.titleWidth);this.state.buttonsAndInfoHidden&&this.state.enableImmersiveModeRibbon&&!i&&(l=e.width-20);const c=this._getTopInset();return this.state.isNewCallScreen?h.createElement(U.CallStageViewV2,{key:"callStageView",style:a,conversationMri:this.state.conversationMri,callId:t,viewRect:e,hideNameTag:this.state.callUIState===j.CallUIState.GoLiveSinglePlayer,onCallParticipantContextMenuOpened:this.state.enableStopCallControlTimerWhenActionsMenuOpened?this._callParticipantActionsMenuOpened:void 0,onCallParticipantContextMenuDismissed:this.state.enableStopCallControlTimerWhenActionsMenuOpened?this._callParticipantActionsMenuClosed:void 0,isOneOnOneConversation:this.state.isOneOnOneConversation,disableReactions:this.state.isEncryptedCall,reactionsConversationId:this.state.reactionsConversationMri,onTextReactionPressed:this._navigateToChatNotBack,isLandscape:this.state.isLandscape,stageLayoutMode:this.state.stageLayoutMode,useLightTheme:this.state.useLightTheme,isPstnTranslationEnabled:this.state.pstnTranslationEnabled}):h.createElement(N.default,{key:"callStageView",style:a,conversationMri:this.state.conversationMri,isEncryptedCall:this.state.isEncryptedCall,isPSTNCall:this.state.isPSTNCall,callId:t,disableReactions:this.state.isEncryptedCall,viewRect:e,availableRibbonWidth:l,callControlsType:this.state.controlsType,callParticipantOpacityStyle:this._callParticipantAccessoryOpacityStyle,callParticipantTooltipStyle:this._callParticipantNameTooltipStyle,callStageOverlayOpacityStyle:this._callStageOverlayOpacityStyle,callHeaderOpacityStyle:this._callHeaderAnimatedStyle,reactionsConversationId:this.state.reactionsConversationMri,baseStageMode:s,useMobileControls:i,isLandscape:this.state.isLandscape,hideFullscreenIcon:this._isIncomingOrOutgoingRing(),layoutAnimationEnabled:!this.state.suppressParticipantAnimation,callPanelHeaderLayout:this.state.callPanelHeaderLayout,showRibbonExtras:!i&&!this.state.buttonsAndInfoHidden,isRoutedToEarpiece:this.state.callAudioOutputRoute===n.default.AudioOutputEarpiece,topInset:c,enableNewCaptureActivityPip:this.state.enableNewCaptureActivityPip,isVideoTarget:r,isDesktopMin:this.state.isDesktopMinCallRibbon,onStageTap:this._onStageTapped,onDragChange:this._onParticipantDragChange,onStageChange:this._onStageChange,onRemainderViewPressed:this._onShowOrHideRoster,onAddToCallPressed:this._onAddToCallPressed,onCallPanelHeaderLayoutChange:i?void 0:this._onCallPanelHeaderLayoutChange,onTextReactionPressed:this._navigateToChatNotBack,onUseImmersiveModeChange:this._onUseImmersiveModeChange,useHighContrastTheme:this.state.useHighContrastTheme,isIncomingOrOutgoingRing:this._isIncomingOrOutgoingRing(),useHighContrastHeaderTheme:this._useHighContrastHeader(),onParticipantViewTapped:this._onToggleLocalVideoSource,showFullScreenOptionInRibbonSettings:this.state.showFullScreenOptionInRibbonSettings,hideNameTag:this.state.callUIState===j.CallUIState.GoLiveSinglePlayer,onCallParticipantContextMenuOpened:this.state.enableStopCallControlTimerWhenActionsMenuOpened?this._callParticipantActionsMenuOpened:void 0,onCallParticipantContextMenuDismissed:this.state.enableStopCallControlTimerWhenActionsMenuOpened?this._callParticipantActionsMenuClosed:void 0,onVideoPreviewFloating:q.CallingCapabilities.floatableResizableVideoPreviewSupported()?this._onVideoPreviewFloating:void 0,enableFloatableResizableVideoPreview:q.CallingCapabilities.floatableResizableVideoPreviewSupported(),containerOffsetX:this._currentLeftPanelWidth(),areCallControlsVisible:!this.state.buttonsAndInfoHidden,enableNewCallScreen:this.state.isNewCallScreen,showParticipantsButton:!0,stageLayoutMode:this.state.stageLayoutMode,isPstnTranslationEnabled:this.state.pstnTranslationEnabled})}_shouldShowParticipantsButtonInCallControls(){return this.state.isNewCallScreen||this.state.enableParticipantsButtonInCallControls||Q.default.isInPresentationMode(this.state.stageLayoutMode)}_renderFloatingVideoPreview(){return!this.state.isNewCallScreen&&this.state.shouldRenderFloatingVideoPreview&&this.state.floatingVideoPreviewView?this.state.floatingVideoPreviewView:void 0}_renderCallingAnimation(e,t,i){if(!this._isIncomingOrOutgoingRing()||!e.width||!e.height)return;const n=this.state.isProvidingVideo?void 0:h.createElement(M.default,{conversationId:this.state.conversationMri,useLightTheme:this.state.useLightTheme});let o=[Lt.callingAnimationContainer];return o.push(h.Styles.createViewStyle({top:t,bottom:a.isUndefined(i)?void 0:i},!1)),this._isIncomingOrOutgoingRing()&&n?h.createElement(h.View,{key:"callAnimation",style:o},n):void 0}_renderTooltips(){return h.createElement(Tt.default,{callId:this.props.route.params.callId,anchor:this._videoToolTipAnchor,containerOffsetX:this._currentLeftPanelWidth()})}_renderCallPanelHeader(e){const t=this._useMobileControls(),i=!this._isIncomingOrOutgoingRing()&&!this.state.isUsingStackNavigationContext&&Y.isThread(this.state.conversationMri)&&!this.state.isEncryptedCall,a=[];a.push(this.state.renderHeaderV2?Lt.headerContainerV2:Lt.headerContainer),a.push(this._callHeaderAnimatedStyle);let n,o,s=0;h.StatusBar.isOverlay()&&!this.state.isLandscape&&(s+=this.state.statusBarHeight),t&&(s+=this._getBannersHeight()),a.push(je.default.marginTopStyle(s)),this.state.isUsingStackNavigationContext||(n=this._onShowOrHideRoster,o=this._onCallTitleLayout);const r=this.state.isPSTNCall&&this.state.knownPSTNContactMri||this.state.conversationMri,l=this.state.canAccessConversationDetails?this._onShowOrHideProfile:void 0;return this.state.renderHeaderV2?this._renderCallPanelHeaderV2(a,r,e,i,t,l,n,o):this._renderCallPanelHeaderV1(a,r,e,i,t,l,n,o)}_renderCallPanelHeaderV1(e,t,i,a,n,o,s,r){return h.createElement(h.Animated.View,{key:"callpanelheader"+this.state.callPanelHeaderLayout,style:e,ignorePointerEvents:!0},h.createElement(L.default,{callId:this.props.route.params.callId,conversationId:t,maxTitleWidth:this._maxTitleWidth(i),minimized:this.state.buttonsAndInfoHidden,isCallActive:this.state.callUIState===j.CallUIState.Default||this.state.callUIState===j.CallUIState.Voicemail,outgoingRingStatus:this.state.outgoingRingStatus,showParticipantCount:a,hideBackButton:this.state.callUIState===j.CallUIState.IncomingRing,incomingOrOutgoingRing:this._isIncomingOrOutgoingRing(),isDialPadShowing:this.state.showDialpad,isLandscape:this.state.isLandscape,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,useMobileControls:n,onTitlePress:o,onRosterPressed:s,onBingBackgroundsPressed:this._onBingBackgroundsPressed,onBackButtonPressed:this._onHeaderBackButtonPressed,onRecentsButtonPressed:this._onRecentsButtonPressed,isRecentsOpen:this.state.isRecentsOpen,onTitleLayout:r,onToggleCameraDirection:this._onToggleLocalVideoSource,onGalleryPress:this._toggleGalleryPanel,useHighContrastTheme:this._useHighContrastHeader(),useLightTheme:this.state.useLightTheme,callPanelHeaderLayout:this.state.callPanelHeaderLayout,isNewCameraFlipEnabled:this.state.enableNewCameraFlipFlow,onDynamicAudioChoice:this._onDynamicAudioChoice}),h.createElement(me.default,{panelPosition:me.PstnTranslatorPanelPosition.Header,callId:this.props.route.params.callId,conversationMri:this.state.conversationMri,callUIState:this.state.callUIState,isPstnCall:this.state.isPSTNCall,useLightTheme:this.state.useLightTheme,callStageV2:this.state.isNewCallScreen}))}_renderCallPanelHeaderV2(e,t,i,a,n,o,s,r){return h.createElement(h.Animated.View,{key:"callpanelheader"+this.state.callPanelHeaderLayout,style:e,ignorePointerEvents:!0},h.createElement(vt.default,{callId:this.props.route.params.callId,conversationId:t,maxTitleWidth:this._maxTitleWidth(i),minimized:this.state.buttonsAndInfoHidden,isCallActive:this.state.callUIState===j.CallUIState.Default||this.state.callUIState===j.CallUIState.Voicemail,outgoingRingStatus:this.state.outgoingRingStatus,showParticipantCount:a,hideBackButton:this.state.callUIState===j.CallUIState.IncomingRing,incomingOrOutgoingRing:this._isIncomingOrOutgoingRing(),isDialPadShowing:this.state.showDialpad,isLandscape:this.state.isLandscape,useMobileControls:n,onTitlePress:o,onRosterPressed:s,onBingBackgroundsPressed:this._onBingBackgroundsPressed,onBackButtonPressed:this._onHeaderBackButtonPressed,onRecentsButtonPressed:this._onRecentsButtonPressed,isRecentsOpen:this.state.isRecentsOpen,onTitleLayout:r,onToggleCameraDirection:this._onToggleLocalVideoSource,useHighContrastTheme:this._useHighContrastHeader(),useLightTheme:this.state.useLightTheme,callPanelHeaderLayout:this.state.callPanelHeaderLayout,isNewCameraFlipEnabled:this.state.enableNewCameraFlipFlow,onDynamicAudioChoice:this._onDynamicAudioChoice}))}_maxTitleWidth(e){if(this.state.callPanelHeaderLayout===j.CallPanelHeaderLayout.Window||this.state.callPanelHeaderLayout===j.CallPanelHeaderLayout.Float)return this.state.renderHeaderV2?Math.max(e.width/2,180):Math.max(e.width/2,350)}_renderOptionalNetworkInCallWarning(){let e;return this.state.callUIState===j.CallUIState.Voicemail?e=ye.default.getViewInformationForVoicemail():this.state.isCallBeingForwarded&&(e=ye.default.getViewInformationForForwarding()),e?h.createElement(Se.default,{viewInformation:e,ref:this._onInCallWarningViewRef}):void 0}_renderFooterPstnTranslatorButton(){return h.createElement(me.default,{panelPosition:me.PstnTranslatorPanelPosition.Footer,callId:this.props.route.params.callId,conversationMri:this.state.conversationMri,callUIState:this.state.callUIState,isPstnCall:this.state.isPSTNCall,marginBottom:this._getPstnTranslationButtonsBottomPadding(),useLightTheme:this.state.useLightTheme,callStageV2:this.state.isNewCallScreen})}_renderOptionalAloneInTheCallInformationView(){if(this.state.showAloneInCall)return h.createElement(m.default,{key:"goliveinfo",conversationMri:this.state.conversationMri,isCallCreator:this.state.isCallCreator,callId:this.props.route.params.callId,isProvidingVideo:this.state.isProvidingVideo,isRinglessCall:this.state.isRinglessCall,callControlsType:this.state.controlsType,isLandscape:this.state.isLandscape,useLightTheme:this.state.useLightTheme,useDesktopCallControls:!this._useMobileControls()})}_shouldShowCallCreatorShareOverlayPopup(){var e;const t=!0===(null===(e=this.props.route.params.meetNowParameters)||void 0===e?void 0:e.call),i=Me.MeetNowHelpers.isGuestFlow()&&this.state.isConversationCreator;return this.state.hasCallCreatorShareOverlayPopup&&!Me.MeetNowHelpers.isMobileEnvironmentWithStackNavigation()&&(t||i)}_renderCallCreatorShareOverlayPopup(){if(this._shouldShowCallCreatorShareOverlayPopup())return h.createElement(I.default,{conversationMri:this.state.conversationMri,meetNowParameters:this.props.route.params.meetNowParameters||{origin:ke.MeetNowOrigin.CallPanel},callId:this.props.route.params.callId,isProvidingVideo:this.state.isProvidingVideo,onClose:this._closeCallCreatorShareOverlayPopup})}_intRenderCallControls(e,t,i){const{callId:a}=this.props.route.params;if(this.state.callUIState===j.CallUIState.IncomingRing)return h.createElement(fe.default,{conversationMri:this.state.conversationMri,callId:a,isPSTNCall:this.state.isPSTNCall,isEncryptedCall:this.state.isEncryptedCall,forMobile:this.state.controlsType===j.CallControlsType.Mobile});if(e){const e=this.state.buttonsAndInfoHidden&&!this.state.isVideoSuggestionTooltipVisible;return h.createElement(Re.default,{style:e?Lt.hiddenControls:void 0,conversationMri:this.state.conversationMri,reactionsConversationMri:this.state.reactionsConversationMri,callId:a,callUIState:this.state.callUIState,isPSTNCall:this.state.isPSTNCall,isEncryptedCall:this.state.isEncryptedCall,disableMic:this.state.microphonePermissionStatus!==l.PermissionStatus.Granted,onOpenDialpad:this._onOpenDialpad,onOverflowPressed:this._toggleMobileOverflowMenu,onEndCallFailure:this._onEndCallFailure,onLocalUnmute:this._onLocalUnmute,onInteracting:this._onCallControlsInteracting,blockPointerEvents:e,isShowingChat:this.state.isChatOpen,onChatPanelButtonPress:this._toggleChatPanel,onVideoButtonRef:this._onVideoButtonRef})}return e||i.width!==this.state.panelLayout.width||(i=this.state.panelLayout),h.createElement(kt.default,{ref:this._onCallControls,conversationMri:this.state.conversationMri,callId:a,callUIState:this.state.callUIState,isPSTNCall:this.state.isPSTNCall,isEncryptedCall:this.state.isEncryptedCall,disableMic:this.state.microphonePermissionStatus!==l.PermissionStatus.Granted,opacityStyle:this._callControlsOpacityAnimatedStyle,isShowingChat:this.state.isChatOpen,isShowingRecents:this.state.isRecentsOpen,shouldShowReactions:t,isHidden:this.state.buttonsAndInfoHidden,onOpenDialpad:this._onOpenDialpad,onInteracting:this._onCallControlsInteracting,onAddToCall:this._onAddToCallPressed,onShowParticipants:this._onShowParticipants,onChatPanelButtonPress:this._toggleChatPanel,onReactionsPickerButtonPress:this._showOrHideReactionsDrawer,onReactionPickerButtonHover:this._showReactionsDrawerOnHover,onChatButtonRef:this._onChatButtonRef,onVideoButtonRef:this._onVideoButtonRef,onEndCallFailure:this._onEndCallFailure,onMomentsPress:this._callControlsOnCaptureMomentPress,onRecordCallPress:this._onCallRecordingPress,controlsType:this.state.controlsType,showHideOutgoingVideoDisabledToast:this._onShowHideDisableOutgoingVideoToast,isShowingAloneInCall:this.state.showAloneInCall,isOutgoingVideoDisabled:this.state.isOutgoingVideoDisabled,showParticipantsButton:this._shouldShowParticipantsButtonInCallControls(),isNewCallScreen:this.state.isNewCallScreen,useLightTheme:this.state.useLightTheme})}_renderCallControls(e,t){const i=this._useMobileControls(),a=[Lt.buttonsContainer];if(i){a.push(this._callControlsAnimatedTranslateYStyle);this._audioNotificationView&&this.state.callUIState===j.CallUIState.IncomingRing&&a.push(Lt.buttonsWithNotificationContainer)}else a.push(Lt.modernStageButtonsContainer),this.state.useLightTheme&&a.push(Lt.lightThemeButtonsContainer);return h.createElement(h.Animated.View,{key:"callControls",style:a,ignorePointerEvents:!0,importantForAccessibility:i&&this.state.showDialpad?p.ImportantForAccessibility.NoHideDescendants:void 0},this._renderOptionalNetworkInCallWarning(),this._renderFooterPstnTranslatorButton(),this._intRenderCallControls(i,e,t))}_renderAudioNotification(){const e=[Lt.buttonsContainer];let t=this.state.bottomSafeAreaInset;this._useMobileControls()&&this._areControlsVisible()&&(t+=60);const i=this.state.hideCallControlsForActivity||this.state.showDialpad||this._isIncomingOrOutgoingRing(),a=h.createElement(f.default,{ref:this._onAudioNotificationViewRef,bottomPadding:t,callId:this.props.route.params.callId,showSpeakerOnWarning:this.state.showSpeakerOnWarning,isMicrophoneMutedWhileSpeaking:this.state.isMicrophoneMutedWhileSpeaking,hideNotification:i,useDesktopCallControls:!this._useMobileControls()});if(a)return h.createElement(h.Animated.View,{key:"audioNotification",style:e,ignorePointerEvents:!0},a)}_animateDialpad(e,t,i){_e.log(he.LogTraceArea.CallingUI,`_showOrHideDialpad causeId: ${t}`);const a=e?1:0,n=this.state.isUsingStackNavigationContext?0:-150,o=this.state.isUsingStackNavigationContext?Rt:540;let s;if(e){const e=this.state.isUsingStackNavigationContext?0:(this.state.panelLayout.height-Rt)/2*-1;s=Math.max(e,n)}else s=o;let r=!0;!this.state.isUsingStackNavigationContext&&e&&(r=!1),r?h.Animated.parallel([d.timing.easeOut({value:this._dialpadAnimatedOpacityValue,toValue:a,useNativeDriver:!0}),d.timing.easeOut({value:this._dialpadAnimatedTransformValue,toValue:s,useNativeDriver:!0})]).start(i):(this._dialpadAnimatedOpacityValue.setValue(a),this._dialpadAnimatedTransformValue.setValue(s),i&&i())}_showOrHideControls(e,t,i={},a,n){if(!this._useMobileControls()&&!a)return;this._reactionsBar&&this._reactionsBar.setOverflowCoachMarksEnabled(!e);const o=this._shouldKeepControlsVisible(),s=()=>` showControls: ${e} buttonsAndInfoHidden: ${i.buttonsAndInfoHidden} shouldKeepControlsVisible: ${o}`;a||this.state.buttonsAndInfoHidden!==!e&&!o?(i.buttonsAndInfoHidden=!e,e&&n&&(this._renderCallControlsScenario=new St.default(St.ScenarioName.RenderCallControls),this._renderCallControlsScenario.start(void 0,n),this._renderCallControlsScenario.markStepCompleted("ShowControls")),this.setState(i),_e.log(he.LogTraceArea.CallingUI,"_showOrHideControls "+s()+" causeId: "+t)):(o&&(i.buttonsAndInfoHidden=!1),this.setState(i),_e.log(he.LogTraceArea.CallingUI,"_showOrHideControls "+s()+" causeId: "+t)),w.default.setCallControlsVisible(e,t)}_shouldKeepControlsVisible(){const e=this._coachMarksBeingShown(),t=this.state.callUIState===j.CallUIState.OutgoingRing||this.state.callUIState===j.CallUIState.GoLiveSinglePlayer,i=this._useMobileControls()&&this.state.newMobileOverflowOpen&&!this.state.isUsingStackNavigationContext,a=e||this._isInteractingWithCallControls||this._endCallNavigationRequested||this.state.isPSTNCall||this.state.isMobileScreenReaderEnabled||this.state.isNavigatingWithKeyboard||this.state.isVideoSuggestionTooltipVisible||t||i;return a&&_e.log(he.LogTraceArea.CallingUI,"_shouldKeepControlsVisible isInteractingWithCallControls: "+this._isInteractingWithCallControls+" endCallNavigationRequested: "+this._endCallNavigationRequested+" isPSTNCall: "+this.state.isPSTNCall+" isMobileScreenReaderEnabled: "+this.state.isMobileScreenReaderEnabled+" isNavigatingWithKeyboard: "+this.state.isNavigatingWithKeyboard+" isVideoSuggestionTooltipVisible: "+this.state.isVideoSuggestionTooltipVisible+" coachMarksBeingShown: "+e+" isInOutgoingRingOrWaitState: "+t+" overflowMenuOpenOnTablet: "+i),a}_showOrHideStatusBar(e){let t;t=h.StatusBar.isOverlay()?dt.default.mergeStyles([dt.default.createHiddenStyle(!e),dt.default.createBarStyle(ct.BarStyleTheme.Light)]):dt.default.createBackgroundColorStyle(ht.Color.black,!1),this._updateStatusBarStyle(t)}_startParticipantAnimationSuppressionTimeout(){this.state.suppressParticipantAnimation&&_t.default.setTimeout((()=>{this.isComponentMounted()&&this.setState({suppressParticipantAnimation:!1})}),2e3)}_updateLeftNoneStateOnce(e){_e.log(he.LogTraceArea.CallingUI,"_updateLeftNoneStateOnce callUIState: "+j.CallUIState[this.state.callUIState]+" causeId: "+e),this._leftNoneStateOnce||this.state.callUIState===j.CallUIState.None||(this._leftNoneStateOnce=!0)}_updateAudioState(e){this.isComponentMounted()?(_e.log(he.LogTraceArea.CallingUI,"_updateAudioState causeId: "+e),k.default.CallControlsStore.updateAudioState(this.props.route.params.callId,e)):_e.log(he.LogTraceArea.CallingUI,"_updateAudioState - component no longer mounted, causeId: "+e)}_callControlsVisualHeight(){const e=this._useMobileControls()?55:j.DesktopCallControlsHeight;return Math.max(this._reactionsBarHeight,e+40+-1*this._controlsTranslateY())}_componentId(){return"CapturePanel"}_galleryMri(){return this.state.conversationMri}_isIncomingOrOutgoingRing(e){const t=e||this.state;return t.callUIState===j.CallUIState.IncomingRing||t.callUIState===j.CallUIState.OutgoingRing}_startOrStopOrientationListener(e){}_endCall(e,t){_e.log(he.LogTraceArea.CallingUI,"_endCall forEveryone: "+e+" causeId: "+t);(e?k.default.CallingStore.endCallForEveryone(this.props.route.params.callId,t):k.default.CallingStore.endCall(this.props.route.params.callId,t)).catch((e=>{_e.log(he.LogTraceArea.CallingUI,"_endCall failed: "+ut.default.errorAsString(e)+" causeId: "+t),this._onEndCallFailure(t)}))}_controlsTranslateY(){return this._useMobileControls()?10-this.state.bottomSafeAreaInset:this.state.bottomSafeAreaInset}_registerKeyboardHandlers(){const e=(0,oe.default)().getConversation(this.state.conversationMri);(0,Le.isRegularMemberInModeratedGroup)(e)||(ve.default.addHandler(he.KeyboardShortcut.AddPeopleToCall,this._onAddToCallKeyboardShortcut),ve.default.addHandler(he.KeyboardShortcut.TakeCallSnapshot,this._onCaptureMomentKeyboardShortcut)),ve.default.addHandler(he.KeyboardShortcut.ToggleMicrophone,this._onToggleMicrophoneKeyboardShortcut),this.state.isOutgoingVideoDisabled||ve.default.addHandler(he.KeyboardShortcut.ToggleCamera,this._onToggleVideoKeyboardShortcut),ve.default.addHandler(he.KeyboardShortcut.HangupOrRejectCall,this._hangupCallShortcut),ve.default.addHandler(he.KeyboardShortcut.AnnounceMuteStatus,this._onAnnounceMuteStatusKeyboardShortcut),ve.default.addHandler(he.KeyboardShortcut.AnnounceSelfVideoOnOffStatus,this._onAnnounceSelfVideoOnOffStatusKeyboardShortcut)}_unregisterKeyboardHandlers(){const e=(0,oe.default)().getConversation(this.state.conversationMri);(0,Le.isRegularMemberInModeratedGroup)(e)||(ve.default.removeHandler(he.KeyboardShortcut.AddPeopleToCall,this._onAddToCallKeyboardShortcut),ve.default.removeHandler(he.KeyboardShortcut.TakeCallSnapshot,this._onCaptureMomentKeyboardShortcut)),ve.default.removeHandler(he.KeyboardShortcut.ToggleMicrophone,this._onToggleMicrophoneKeyboardShortcut),this.state.isOutgoingVideoDisabled||ve.default.removeHandler(he.KeyboardShortcut.ToggleCamera,this._onToggleVideoKeyboardShortcut),ve.default.removeHandler(he.KeyboardShortcut.HangupOrRejectCall,this._hangupCallShortcut),ve.default.removeHandler(he.KeyboardShortcut.AnnounceMuteStatus,this._onAnnounceMuteStatusKeyboardShortcut),ve.default.removeHandler(he.KeyboardShortcut.AnnounceSelfVideoOnOffStatus,this._onAnnounceSelfVideoOnOffStatusKeyboardShortcut)}_mustUpdateSpeakerMutedAsync(e,t){return pt.default.isElectronOsx()&&"true"!==y.default.getSkypeAudioLibraryFeatures().ECS_ADSP_VirtualSessionVolume&&t.isSpeakerMuted!==k.default.CallingStore.isSpeakerMuted(e)}_updateSpeakerMutedAsync(e){return k.default.DeviceStore.getSpeakerVolumeAsync(!0).then((t=>0===t||k.default.CallingStore.isSpeakerMuted(e)))}_useHighContrastHeader(){return this.state.useHighContrastTheme&&!this._isIncomingOrOutgoingRing()&&this.state.callPanelHeaderLayout!==j.CallPanelHeaderLayout.Window}_onNavigatedAwayFromCall(e){var t;_e.log(he.LogTraceArea.CallingUI,"onNavigateAwayFrom Call onCallScreenClose, causeId: "+e),this.state.isDesktopMin&&(null===(t=this._reactionsBar)||void 0===t?void 0:t.isDrawerOpen())&&this._showOrHideReactionsDrawer(!1),c.default.onCallScreenClose()}_transcriptionLayout(e,t){return G.default.getTranscriptionLayout(e,!!t,this.state.isLandscape)}_getTanscriptionRects(e){const t=k.default.OngoingCallService.getIsSubtitleHistoryOpen(this.props.route.params.callId)||!1;if(this.state.isTranslating&&t&&!this.state.isRightPanelOpen){const i=this._transcriptionLayout(t,e);return G.default.getTranscriptionLayoutRects(this.state.panelLayout,i)}}_canShowTranscriptionPanel(e){return!!k.default.OngoingCallService.getIsSubtitleHistoryOpen(this.props.route.params.callId)&&(!e||!e.isHorizontal)}_canShowTranscription(){return!!this.state.pstnTranslationEnabled||!(!this.state.isTranscriptionEnabled||!this.state.isTranslating)}_getTranscriptionBottomPadding(){let e=0;if(this._useMobileControls())this.state.userCaptionPositionMode===At.CaptionsPositionMode.bottom?e+=35:e+=90,this._areControlsVisible()&&(e+=45),this.state.pstnTranslationEnabled&&(this._areControlsVisible()?e+=40:e+=60);else if(this.state.userCaptionPositionMode===At.CaptionsPositionMode.bottom)e=20;else if(this._areControlsVisible()){const t=y.default.getS4LCMCFeaturesNoSubscription().callCaptionsUiV2?0:25;e=this._callControlsVisualHeight()+t}else e=this._audioNotificationView?40:20;return!this._useMobileControls()&&this.state.pstnTranslationEnabled&&(e+=95),e}_getPstnTranslationButtonsBottomPadding(){let e=0;return e=this.state.isNewCallScreen?j.AudioNotificationOffset+j.DesktopCallControlsHeight+10:j.AudioNotificationOffset+j.DesktopCallControlsHeight-10,e}_showMobileServerMutedToast(e){return!!e.showServerMutedToastOnMobile&&!e.isCallOnHold}_showCallConnectionQualityToast(e){return(e.callNetworkQualityPoor||e.audioOnlyEnabled)&&!e.isCallOnHold}_shouldUpdateBannerHeight(e,t){return this.isComponentMounted()&&e!==t}_getBannersHeight(){return this.state.recordingBannerHeight+this.state.cameraDeniedBannerHeight+this.state.ndiUsedBannerHeight+this.state.callMediaCapturedBannerHeight+this.state.incomingVideoDisabledBannerHeight+this.state.callConnectionQualityBannerHeight+this.state.serverMuteNotificationBannerHeight+this.state.spokenLangageConflictResolutionViewHeight+this.state.mobileScreenShareBannerHeight+this.state.mobileTeamsInteropBannerHeight+this.state.mobileTranslationBannerHeight+this.state.mobileTogetherModeNoticeBannerHeight+this.state.mobileNewCallScreenRevertNoticeBannerHeight+this.state.pstnTranslationNoticeBannerHeight||0}_getTopInset(){let e=this.state.topSafeAreaHeight;const t=this._getBannersHeight();return this._areControlsVisible()?this._useMobileControls()?(e+=this.state.renderHeaderV2?j.DesktopNewHeaderHeight:j.CallPanelHeaderHeight.mobile,e+=t):this.state.enableNewCameraFlipFlow&&!Ke.default.keepStatusBarVisibleNoSubscription()&&(e+=17):e+=t,e}}t.default=Et},83940:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(96074),o=i(89391),s=i(95328),r=i(43906);class l extends n.BaseNavigationView{_buildState(){const{enableNewCallPanel:e}=o.default.getS4LCMCFeatures();return{enableNewCallPanel:e}}render(){return this.state.enableNewCallPanel?a.createElement(r.default,{callId:this.props.route.params.callId,initialMri:this.props.route.params.initialConversationMri}):a.createElement(s.default,Object.assign({},this.props))}}t.default=l},10604:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(89391),o=i(45092),s=i(51793),r=i(57538);t.default=e=>{const{activeCallId:t,callOrigin:i,conversationMri:l,isGoLive:c,isTwinCam:d,skipPermissionPanel:u}=e.route.params,h=n.default.getS4LCMCFeaturesNoSubscription(),p=h.redesignedLobbiesEnabled,g=h.enableCallPreviewPermissionOnLoad;return p?a.createElement(s.default,{meetNowParameters:{origin:r.MeetNowOrigin.JoinLobby,convId:l},isCallPreviewLobby:!0}):a.createElement(o.default,{dialogId:"CallPreview",conversationMri:l,activeCallId:t,callOrigin:i,isGoLive:c,isTwinCam:d,isModal:!0,permissionAlreadyAsked:g,skipPermissionPanel:u,isNewCallPreviewStyle:!1})}},91848:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(67930),o=i(94224),s=i(66080),r=i(47176),l=i(2278),c=i(71830),d=i(46096),u=i(36237),h=i(15877),p=i(33754),g=i(4735),C=i(14976),m=i(90631),S=i(11828),y=i(80837),f=i(90970),_=i(53374),b=i(97634),T=(0,h.lazyProperties)({container:()=>a.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),headerContainer:()=>a.Styles.createViewStyle({alignSelf:"stretch",alignItems:"stretch"})});class v extends n.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._closeRoster=()=>{const e=_.default.newCauseId();u.log(d.LogTraceArea.CallingUI,`[CallRosterView] _closeRoster, causeId: ${e}`),this._goBack(e),f.default.getActiveSession()&&(f.default.completeSession(),u.log(d.LogTraceArea.CallingUI,`[CallRosterView] _closeRoster Call Roster completeSession, causeId: ${e}`),l.default.updateCallTelemetry(this.props.route.params.callId,e,(e=>e.callRosterClosedCount())))},this._addParticipantsToCall=()=>{const{callId:e,conversationId:t}=this.props.route.params,i=_.default.newCauseId();u.log(d.LogTraceArea.CallingUI,`[CallRosterView] _addParticipantsToCall, causeId: ${i}`),g.default.openAddToCall(t,e,d.NavigationAddToCallOrigin.RosterView,this._getContext(),i),f.default.updateCallRosterTelemetry(e,i,(e=>e.callRosterAddToCall()))}}static getHeaderText(){return p.getString("CallPanel.CallRosterAccessibilityLabel")}_buildState(e,t){const{callId:i,conversationId:a}=e.route.params,n=r.default.getRosterForConversation(a);if(n&&0===n.length){const e=_.default.newCauseId();u.warn(d.LogTraceArea.CallingUI,"CallRosterView._buildState: allParticipants is empty list conversationId="+C.mriOrId(a)+" causeId="+e),l.default.updateCallTelemetry(i,e,(e=>e.callRosterGetAllParticipantsFailedCount()))}const s=r.default.getActiveParticipants(i,a),h=o.default.CallingStore.isPSTNCall(i),p=c.isEncryptedThread(a);return{allParticipantCount:n.length,activeParticipantCount:s.length,conversationName:r.default.getConversationName(a),allowAddToCall:o.default.CallingFeaturesHelper.allowAddToCall({conversationMri:a,isPSTNCall:h,isEncryptedCall:p,callId:i})}}_getCallRosterHeader(){const e={closeButtonType:m.CloseButtonType.Close,onPress:this._closeRoster,title:p.getString("Global.CloseButtonTitle")},t=this.state.allowAddToCall?{onPress:this._addParticipantsToCall,accessibilityLabel:p.getString("CallPanel.AddToCallTooltipTitle"),icon:S.SkypeIcon.ContactAdd}:void 0,i=a.createElement(a.View,{style:y.default.flexOne});let n=p.getString("CallPanel.CallRosterTitle",{count:this.state.activeParticipantCount,total:this.state.allParticipantCount});return a.createElement(a.View,{style:T.headerContainer},a.createElement(m.SimplePanelHeader,{panelName:n,useTransparentBackground:!0,leftButton:e,rightButtons:t,titleView:i}))}render(){const{primaryBackgroundColorStyle:e}=b.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride);return a.createElement(a.View,{style:[T.container,e]},this._getCallRosterHeader(),a.createElement(s.default,{callId:this.props.route.params.callId,conversationMri:this.props.route.params.conversationId}))}_getHeaderText(e){return v.getHeaderText()}}t.default=v},4096:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(16778),o=i(87720),s=i(96074),r=i(78816),l=i(98278),c=i(87134),d=i(15877),u=i(6658),h=i(90602),p=i(90631),g=i(22222),C=i(81760),m=i(11828),S=i(80837),y=i(19675),f=i(53374),_=(0,d.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,flexDirection:"column",padding:15,backgroundColor:C.Color.white}),buttonsContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignContent:"stretch",paddingVertical:5}),headerContainer:()=>n.Styles.createViewStyle({flexDirection:"row",paddingVertical:5,flex:1}),scrollView:()=>n.Styles.createScrollViewStyle({flex:1,alignSelf:"stretch"}),headerStyle:()=>n.Styles.createTextStyle({marginVertical:10}),buttonStyle:()=>n.Styles.createViewStyle({marginVertical:10}),buttonGroupContainer:()=>n.Styles.createViewStyle({flexDirection:"column",paddingVertical:5,flex:1})});class b extends s.BaseNavigationView{constructor(){super(...arguments),this._onAppMetricChange=(e,t)=>{r.default.setShowAppMetrics(t)},this._onVideoMetricChange=(e,t)=>{r.default.setShowVideoMetrics(t)},this._onClose=()=>{const e=f.default.newCauseId();r.default.closeDebugWindow(this.props.route.params.callId,e,this._getContext(),!1)},this._onPopout=()=>{const e=f.default.newCauseId();r.default.openNativeWindow(this.props.route.params.callId,!0,this._getContext(),e)}}_buildState(e,t){return{callTechnicalInfo:r.default.getCallTechnicalInfo(e.route.params.callId),selectedItem:t?r.CallDebugMenuItem.CallStats:r.default.getSelectedTab(),showAppMetrics:r.default.showAppMetrics(),showVideoMetrics:r.default.showVideoMetrics(),appMetrics:r.default.getAppMetrics()}}componentDidMount(){super.componentDidMount(),r.default.init(this.props.route.params.callId)}componentWillUnmount(){super.componentWillUnmount(),r.default.dispose(this.props.route.params.callId)}render(){const{selectedItem:e}=this.state;let t;switch(e){case r.CallDebugMenuItem.Simulation:t=this._renderSimulatePanel();break;case r.CallDebugMenuItem.CallStats:t=this._renderCallStats();break;case r.CallDebugMenuItem.Inspect:t=this._renderInspectContent()}const i={closeButtonType:p.CloseButtonType.Close,onPress:this._onClose,title:"Close"};return n.createElement(n.View,{style:_.container},!this.props.route.params.nativeWindow&&n.createElement(p.SimplePanelHeader,{panelName:"Call debug panel",titleTextStyle:S.default.flexNegativeOne,leftButton:i,rightButtons:undefined,hideBottomBorder:!0,leavePaddingForStatusBar:n.StatusBar.isOverlay()}),n.createElement(n.View,{style:_.buttonsContainer},this._renderMenuItems()),n.createElement(c.default,null),n.createElement(n.ScrollView,{key:"scrollview",style:_.scrollView},n.createElement(n.View,null,t)))}_renderMenuItems(){const{selectedItem:e}=this.state;return a.map(r.CallDebugMenuItem,(t=>{const i=r.CallDebugMenuItem[t];return a.isString(i)?n.createElement(g.default,{key:"calldebug"+i,buttonSize:l.SXButtonSize.Small,buttonStyle:t===e?l.SXButtonStyle.ColorFill:l.SXButtonStyle.ThemeNoBackground,title:r.CallDebugMenuItem[t],onPress:()=>r.default.setSelectedTab(t)}):void 0}))}_renderCallStats(){const{callTechnicalInfo:e}=this.state;if(e)return n.createElement(n.View,null,a.map(null==e?void 0:e.channels,((e,t)=>n.createElement(n.View,null,n.createElement(y.Header,{selectable:!0,style:_.headerStyle,size:5,numberOfLines:1},`Channel ${t}`),a.map(e,((e,t,i)=>{const a="Bandwidth Estimation Algorithm"===t?"Band. est. alg.":t;return n.createElement(n.View,{key:`callstat-${i}`,style:S.default.flexOne},this._renderMetricLine(a,e),n.createElement(c.default,null))}))))))}_renderSimulatePanel(){return n.createElement(n.View,null,n.createElement(y.Header,{key:"actions",style:_.headerStyle,size:5,numberOfLines:1},"Actions"),n.createElement(n.View,{style:_.buttonGroupContainer},n.createElement(g.default,{key:"addParticipant",buttonSize:l.SXButtonSize.Medium,buttonStyle:l.SXButtonStyle.ColorStroke,icon:m.SkypeIcon.ContactAdd,title:"Add participant",style:_.buttonStyle,onPress:()=>this._onAddParticipantPress()}),n.createElement(g.default,{key:"removeParticipant",buttonSize:l.SXButtonSize.Medium,buttonStyle:l.SXButtonStyle.ColorStroke,icon:m.SkypeIcon.SwitchAccount,title:"Remove participant",style:_.buttonStyle,onPress:()=>this._onRemoveParticipantPress()}),n.createElement(g.default,{key:"addGroupParticipant",buttonSize:l.SXButtonSize.Medium,buttonStyle:l.SXButtonStyle.ColorStroke,icon:m.SkypeIcon.ContactGroup,title:"Add 12 participants",style:_.buttonStyle,onPress:()=>this._onGroupParticipantPress()}),n.createElement(g.default,{key:"resetParticipants",buttonSize:l.SXButtonSize.Medium,buttonStyle:l.SXButtonStyle.ColorStroke,icon:m.SkypeIcon.Reload,title:"Reset",style:_.buttonStyle,onPress:()=>this._resetParticipants()})),n.createElement(y.Header,{key:"Simulate",style:_.headerStyle,size:5,numberOfLines:1},"Simulate call states"),n.createElement(y.Header,{key:"Network",style:_.headerStyle,size:5,numberOfLines:1},"Network states"))}_renderInspectContent(){return n.createElement(n.View,null,n.createElement(y.Header,{style:_.headerStyle,size:5,numberOfLines:1},"Actions"),n.createElement(n.View,{style:_.buttonGroupContainer},n.createElement(o.default,{accessibilityLabel:"Show app metrics",style:h.default.controlRowWithDescription,isOn:!!this.state.showAppMetrics,onChange:this._onAppMetricChange},n.createElement(n.View,{style:S.default.flexOne},n.createElement(y.RowTitle,{style:h.default.switchTitleMediumSemiLarge},"Show app metrics"))),n.createElement(o.default,{accessibilityLabel:"Show video metrics",style:h.default.controlRowWithDescription,isOn:!!this.state.showVideoMetrics,onChange:this._onVideoMetricChange},n.createElement(n.View,{style:S.default.flexOne},n.createElement(y.RowTitle,{style:h.default.switchTitleMediumSemiLarge},"Show video metrics"))),this._renderAppMetrics()))}_renderAppMetrics(){var e,t,i,a,o,s,r,l,d,u,h,p,g,C,m,f,b,T,v,w,I,P,M,k,A,R,V,L,E;if(!this.state.showAppMetrics)return;const B=(null===(e=this.state.appMetrics)||void 0===e?void 0:e.gpu)&&n.createElement(n.View,null,n.createElement(y.Header,{style:_.headerStyle,size:5,numberOfLines:1},"GPU ",null===(i=null===(t=this.state.appMetrics)||void 0===t?void 0:t.gpu)||void 0===i?void 0:i.pid),this._renderMetricLine("CPU",`${null===(o=null===(a=this.state.appMetrics)||void 0===a?void 0:a.gpu)||void 0===o?void 0:o.cpu.toFixed(2)} %`),this._renderMetricLine("Memory",`${((null===(r=null===(s=this.state.appMetrics)||void 0===s?void 0:s.gpu)||void 0===r?void 0:r.wss)/1024).toFixed(2)} Mb`)),O=(null===(l=this.state.appMetrics)||void 0===l?void 0:l.renderer)&&n.createElement(n.View,null,n.createElement(y.Header,{style:_.headerStyle,size:5,numberOfLines:1},"Renderer ",null===(u=null===(d=this.state.appMetrics)||void 0===d?void 0:d.renderer)||void 0===u?void 0:u.pid),this._renderMetricLine("CPU",`${null===(p=null===(h=this.state.appMetrics)||void 0===h?void 0:h.renderer)||void 0===p?void 0:p.cpu.toFixed(2)} %`),this._renderMetricLine("Memory",`${((null===(C=null===(g=this.state.appMetrics)||void 0===g?void 0:g.renderer)||void 0===C?void 0:C.wss)/1024).toFixed(2)} Mb`),n.createElement(c.default,null)),D=(null===(m=this.state.appMetrics)||void 0===m?void 0:m.systemUsageInfo)&&n.createElement(n.View,null,n.createElement(y.Header,{style:_.headerStyle,size:5,numberOfLines:1},"Main"),this._renderMetricLine("CPU Model",null===(b=null===(f=this.state.appMetrics)||void 0===f?void 0:f.systemUsageInfo)||void 0===b?void 0:b.cpuModel),this._renderMetricLine("CPU Speed",null===(v=null===(T=this.state.appMetrics)||void 0===T?void 0:T.systemUsageInfo)||void 0===v?void 0:v.cpuSpeed),this._renderMetricLine("CPU Cores",null===(I=null===(w=this.state.appMetrics)||void 0===w?void 0:w.systemUsageInfo)||void 0===I?void 0:I.cores),this._renderMetricLine("Total memory",`${null===(M=null===(P=this.state.appMetrics)||void 0===P?void 0:P.systemUsageInfo)||void 0===M?void 0:M.totalMemory} Mb`),this._renderMetricLine("Free memory",`${null===(A=null===(k=this.state.appMetrics)||void 0===k?void 0:k.systemUsageInfo)||void 0===A?void 0:A.freeMemory} Mb`),this._renderMetricLine("Memory allocated to heap",`${null===(V=null===(R=this.state.appMetrics)||void 0===R?void 0:R.systemUsageInfo)||void 0===V?void 0:V.processMemory} Mb`),this._renderMetricLine("CPU Usage",`${null===(E=null===(L=this.state.appMetrics)||void 0===L?void 0:L.systemUsageInfo)||void 0===E?void 0:E.cpuUsage} %`),n.createElement(c.default,null));return n.createElement(n.View,{style:S.default.flexOne},D,O,B)}_renderMetricLine(e,t){return n.createElement(n.View,{key:e,style:_.headerContainer},n.createElement(y.Caption,{selected:!0,selectable:!0,messageStreamFontSize:u.MessageStreamFontSize.Normal},e,": "),n.createElement(y.Caption,{selectable:!0,messageStreamFontSize:u.MessageStreamFontSize.Normal},t))}_onAddParticipantPress(){r.default.addParticipant(this.props.route.params.callId)}_resetParticipants(){r.default.resetParticipants(this.props.route.params.callId)}_onRemoveParticipantPress(){r.default.removeParticipants(this.props.route.params.callId)}_onGroupParticipantPress(){r.default.addGroupParticipants(this.props.route.params.callId)}}t.default=b},52120:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(96074),o=i(91),s=i(46565),r=i(46096),l=i(36237),c=i(51070),d=i(53374);class u extends n.BaseNavigationView{_buildState(e,t){return{topPadding:c.default.statusBarPadding()}}componentDidMount(){super.componentDidMount();const e=d.default.newCauseId();l.log(r.LogTraceArea.CallingUI,"CallTranscriptionStackPanel.componentDidMount causeId: "+e),s.default.setCallViewVisible(this.props.route.params.callId,!1,e)}componentWillUnmount(){super.componentWillUnmount();const e=d.default.newCauseId();l.log(r.LogTraceArea.CallingUI,"CallTranscriptionStackPanel.componentWillUnmount causeId: "+e),s.default.setCallViewVisible(this.props.route.params.callId,!0,e)}render(){return a.createElement(o.default,{key:"callTranscriptionPanelView",callId:this.props.route.params.callId,reactionsMri:this.props.route.params.conversationMri,onPressClose:this.props.route.params.onClose,topPadding:this.state.topPadding})}_componentId(){return"CallTranscriptionStackPanel"}}t.default=u},24360:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(96486),o=i(31844),s=i(67930),r=i(49603),l=i(52754),c=i(80128),d=i(17456),u=i(41444),h=i(37490),p=i(46096),g=i(36237),C=i(15877),m=i(33754),S=i(4735),y=i(30124),f=i(72136),_=i(89871),b=i(29130),T=i(51070),v=i(90631),w=i(12187),I=i(53374),P=i(97634),M=(0,C.lazyProperties)({panel:()=>a.Styles.createViewStyle({alignSelf:"stretch",flex:1}),headerContainer:()=>a.Styles.createViewStyle({alignItems:"stretch",flexDirection:"column"})});class k extends s.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._searchActive=!1,this._onSearchActive=e=>{this._showOrHideHeader(this.state,!e,!0),e||this.setState({query:""});const{defaultStatusBarTheme:t}=P.themeColors(this._getContext(),this.props.route.params.colorThemeOverride);this._updateStatusBarStyle(e?w.default.createBarStyle(r.BarStyleTheme.Light,!0):w.default.createBarStyle(t,!0))},this._onPressClose=e=>{this._close()},this._onCountrySelected=e=>{this.props.route.params.onCountrySelected?this.props.route.params.onCountrySelected(e):_.default.setSelectedCountry(this.state.countries[e],!0),this._close()},this._onSearch=e=>{this.isComponentMounted()&&(this.setState({query:e}),this._countryListRef&&this._countryListRef.onFilterChange(e))},this._onCountryListRef=e=>{this._countryListRef=e||void 0}}static getHeaderText(){return m.getString("PSTNCountrySelectorPanel.Title")}_buildState(e,t){const i=this._getRootViewId();let s=f.default.getCountries();if(e.route.params.countriesFiltered){s=n.pickBy(s,(function(t,i){return n.includes(e.route.params.countriesFiltered,t.country)}))}const r={countries:s,statusBarPadding:T.default.statusBarPadding(),isPortrait:b.default.getDeviceOrientation(i)===o.DeviceOrientation.Portrait,isUsingStackNavigationContext:y.default.isUsingStackNavigationContext(),isSmallDevice:b.default.isSmallDevice(i)};return t&&(r.query="",this._headerAnimatedHeightValue=new a.Animated.Value(c.default.expandedHeight(i)),this._headerAnimatedHeightStyle=a.Styles.createAnimatedViewStyle({height:this._headerAnimatedHeightValue}),this._headerAnimatedTopValue=new a.Animated.Value(0),this._headerAnimatedTopStyle=a.Styles.createAnimatedViewStyle({transform:[{translateY:this._headerAnimatedTopValue}]})),r}render(){const{primaryBackgroundColorStyle:e}=P.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride);return a.createElement(a.View,{style:[M.panel,e]},this._renderHeaderContainer(),a.createElement(d.default,{ref:this._onCountryListRef,countries:this.state.countries,recentCountries:this.props.route.params.hideRecentCountries?void 0:_.default.getLast5CalledCountriesNoSubscription(),onSelect:this._onCountrySelected}))}componentDidMount(){super.componentDidMount();const{defaultStatusBarTheme:e}=P.themeColors(this._getContext(),this.props.route.params.colorThemeOverride),t=w.default.mergeStyles([w.default.createBarStyle(e),w.default.createHiddenStyle(!1)]);this._updateStatusBarStyle(t),this._showOrHideHeader(this.state,!this._searchActive,!1)}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this.state.statusBarPadding===t.statusBarPadding&&this.state.isPortrait===t.isPortrait||this._showOrHideHeader(t,!this._searchActive,!1)}_renderHeaderContainer(){let e;e=this.state.isUsingStackNavigationContext?a.createElement(l.default,{key:"searchInputButton",initialValue:1,showButtonWhenInactive:!0,placeholderText:m.getString("PSTNCountrySelector.SearchPlaceholder"),rawSearchQuery:this.state.query,onInputTextChange:this._onSearch,onActive:this._onSearchActive}):a.createElement(u.default,{key:"searchInputButton",placeholderText:m.getString("PSTNCountrySelector.SearchPlaceholder"),activePlaceholderText:m.getString("PSTNCountrySelector.SearchPlaceholder"),showButtonWhenInactive:!0,autoFocus:this.props.route.params.searchAutoFocus,autoFocusWhenActive:!0,rawSearchQuery:this.state.query,onInputTextChange:this._onSearch,onActive:this._onSearchActive});const t={closeButtonType:this.props.route.params.isAloneInNavStack||this._getContext().isPresentedByMobileStackNavigator?v.CloseButtonType.Close:v.CloseButtonType.Back,title:m.getString("Global.CloseButtonTitle"),onPress:this._onPressClose},i=a.createElement(v.SimplePanelHeader,{panelName:this._getHeaderText(this.state),leftButton:t,hideBottomBorder:this.state.isUsingStackNavigationContext});let n;return n=this.state.isUsingStackNavigationContext?a.createElement(a.Animated.View,{style:[M.headerContainer,this._headerAnimatedHeightStyle]},a.createElement(a.Animated.View,{style:this._headerAnimatedTopStyle},i,e)):a.createElement(a.View,null,i,e),n}_showOrHideHeader(e,t,i=!0){this._searchActive=!t;const n=this._getRootViewId(),o=this._headerHeight(e),s=t?0:-1*o,r=t?o+c.default.collapsableHeight(n):c.default.expandedHeight(n)+e.statusBarPadding;i?a.Animated.parallel([a.Animated.timing(this._headerAnimatedTopValue,{toValue:s,duration:200,easing:a.Animated.Easing.Out()}),a.Animated.timing(this._headerAnimatedHeightValue,{toValue:r,duration:200,easing:a.Animated.Easing.Out()})]).start():(this._headerAnimatedTopValue.setValue(s),this._headerAnimatedHeightValue.setValue(r))}_headerHeight(e){return(e.isPortrait?e.isSmallDevice?v.HeaderHeightSmall:v.HeaderHeight:e.isSmallDevice?v.HeaderHeightLandscapeSmall:v.HeaderHeightLandscape)+e.statusBarPadding}_close(){const e=I.default.newCauseId();g.log(p.LogTraceArea.Navigation,"CountrySelector._close,  causeId: "+e),h.dismissAll(),S.default.goBack(e,this._getContext())}_getHeaderText(e){return k.getHeaderText()}}t.default=k},79274:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});i(96486),i(31844);const a=i(38933),n=i(16778),o=i(89391),s=i(23680),r=i(67930),l=i(190),c=i(68734),d=i(97306),u=i(77836),h=i(98278),p=i(62633),g=i(56586),C=i(45247),m=i(8113),S=i(96613),y=i(37490),f=i(46096),_=i(81722),b=i(8360),T=i(36237),v=i(15877),w=i(33754),I=i(89808),P=i(4735),M=i(30124),k=i(39254),A=(i(54344),i(29130)),R=i(51070),V=i(81115),L=i(78314),E=i(86045),B=i(55336),O=i(37627),D=i(95384),x=i(19364),N=i(99948),U=i(12187),F=i(81760),H=i(80837),z=i(53374),G=i(97634),W=(0,v.lazyProperties)({dialerWrapper:()=>n.Styles.createViewStyle({backgroundColor:F.Color.darkThemeSecondaryBackground,flexDirection:"column",flexGrow:1,flexShrink:0,overflow:"visible"}),regularLightThemeBackground:()=>n.Styles.createViewStyle({backgroundColor:F.Color.transparent,bottom:0,left:0,position:"absolute",right:0,top:0}),accessibleLightThemeBackground:()=>n.Styles.createViewStyle({backgroundColor:F.Color.gray50,bottom:0,left:0,position:"absolute",right:0,top:0}),darkThemeBackground:()=>n.Styles.createViewStyle({backgroundColor:F.Color.gray400,bottom:0,left:0,position:"absolute",right:0,top:0}),firstGroupLandscape:()=>n.Styles.createViewStyle({flex:1,flexBasis:0}),secondGroup:()=>n.Styles.createViewStyle({bottom:0,left:0,position:"absolute",right:0}),secondGroupLandscape:()=>n.Styles.createViewStyle({flex:1,flexBasis:0,borderLeftWidth:1}),groups:()=>n.Styles.createViewStyle({alignSelf:"stretch",flex:1}),groupsLandscape:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row"}),itemDivider:()=>n.Styles.createViewStyle({backgroundColor:F.Color.gray400,height:1})});class K extends r.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._onScrollFastContactsSearch=()=>{const e=this._fastContactsSearch&&this._fastContactsSearch.state.isSingleSelection;!this._dialpadAnimation||this.state.isInLandscape||e||this._dialpadAnimation.toggleDialpadToCollapsedState(!0)},this._onItemPressedFastContactsSearch=()=>{this._dialpadAnimation&&!this.state.isInLandscape&&this._dialpadAnimation.toggleDialpadToCollapsedState(!1)},this._onRenderFastContactsSearch=()=>{const e=this._getSearchResultCount();if(E.default.shouldAnnounceForAccessibility()&&this._lastAnnouncedSearchCount!==e){this._lastAnnouncedSearchCount=e;const t=w.getString("SearchResultsList.SearchResultsAnnouncement",{count:e});n.Accessibility.announceForAccessibility(t)}!this._dialpadAnimation||this.state.isInLandscape||this._dialpadAnimation.isCollapsed()||this._balancePanelAnimation&&this._fastContactsSearch&&this._balancePanelAnimation.toggleBalancePanelVisibility(this._fastContactsSearch.state.isSingleSelection||e>=1)},this._renderDialpadView=()=>{const{colorThemeOverride:e}=this.props.route.params,{primaryBackgroundColorStyle:t,dividerColorStyle:i}=G.themeStyles(this._getContext(),e),a=[W.dialerWrapper];this.state.bottomSafeAreaInset&&a.push(V.default.paddingBottomStyle(this.state.bottomSafeAreaInset)),G.isUsingDarkTheme(this._getContext(),e)||a.push(t);const o=[W.itemDivider];G.isUsingDarkTheme(this._getContext(),e)||o.push(i);const r=this.state.isInLandscape?void 0:n.createElement(n.View,{style:o});return n.createElement(n.View,{style:a},this.state.isInLandscape?void 0:this._renderCallerIdCTA(),r,n.createElement(s.default,{ref:this._onBalancePanelAnimationRef,isInLandscape:this.state.isInLandscape,onCannotToggle:this._onCannotToggleBalancePanelAnimation},n.createElement(x.default,{isLandscape:this.state.isInLandscape,location:_.ExperimentLocation.DialerPanel})),n.createElement(C.default,{ref:this._onDialpadAnimationRef,isInLandscape:this.state.isInLandscape,onToggleStart:this._onToggleStartDialpadAnimation,onToggleCompletion:this._onToggleCompletionDialpadAnimation,onHeightsChanged:this._onHeightsChangedDialpadAnimation},n.createElement(g.default,{ref:this._onDialpadRef,isInLandscape:this.state.isInLandscape,isDtmfDialpad:!1,enableExtensionDialing:this.state.extensionDialingEnabled}),n.createElement(m.default,{callId:this.props.route.params.callId,conversationId:this.props.route.params.conversationId})))},this._onPress=()=>{this._dialpadAnimation&&this._dialpadAnimation.toggleDialpadToCollapsedState(!1)},this._onContactSaved=()=>{this._dialpadAnimation&&!this.state.isInLandscape&&!this._dialpadAnimation.isCollapsed()&&this._balancePanelAnimation&&this._balancePanelAnimation.toggleBalancePanelVisibility(!1)},this._onCallerIdDialpadCtaPress=()=>{const e=z.default.newCauseId();T.log(f.LogTraceArea.Navigation,"DialerPanel._onCallerIdDialpadCtaPress,  causeId: "+e),u.default.registerCallerIdDialerCTAClick(),P.default.navigateToCallerIdSettingsPanel(this._getRootViewId(),e)},this._onFastContactsSearchRef=e=>{this._fastContactsSearch=e||void 0},this._onSearchSpacerAnimationRef=e=>{this._searchSpacerAnimation=e||void 0},this._onBalancePanelAnimationRef=e=>{this._balancePanelAnimation=e||void 0},this._onCannotToggleBalancePanelAnimation=e=>!e&&!!this._dialpadAnimation&&this._dialpadAnimation.isCollapsed(),this._onDialpadAnimationRef=e=>{this._dialpadAnimation=e||void 0},this._onDialpadRef=e=>{this._dialpad=e||void 0},this._onDialpadHeaderRef=e=>{this._dialpadHeader=e||void 0},this._onToggleStartDialpadAnimation=e=>{this._searchSpacerAnimation&&this._searchSpacerAnimation.toggleToHiddenState(),e&&this._balancePanelAnimation&&this._balancePanelAnimation.toggleBalancePanelVisibility(!0)},this._onToggleCompletionDialpadAnimation=e=>{e?this._searchSpacerAnimation&&this._searchSpacerAnimation.toggleToCollapsedState():(this._balancePanelAnimation&&this._balancePanelAnimation.toggleBalancePanelVisibility(this._getSearchResultCount()>=1),this._searchSpacerAnimation&&this._searchSpacerAnimation.toggleToExpandedState(),this._dialpad&&this._dialpad.focusFirst()),p.default.toggleDialpadCollapse(e)},this._onHeightsChangedDialpadAnimation=(e,t)=>{this._searchSpacerAnimation&&this._searchSpacerAnimation.setState({expandedHeight:e,collapsedHeight:t})}}_buildState(e,t){const i=M.default.isUsingStackNavigationContext(),a=this._getRootViewId(),{callId:n,conversationId:s,prefilledNumber:r,reopenOnInvalidNumber:l}=e.route.params,c=A.default.isHeightSmallerThanThreshold(625,a),d=A.default.isSmallOrTinyScreenSize(a);let u=this._getContext().isPresentedInDesktopSubview?void 0:R.default.horizontalInsets(h.HorizontalInsetDefault);u&&c&&(u={left:u.left,right:0});const g=p.default.isSaveContactVisible(l,r),C=p.default.isCallerIdCTAVisibleInPortrait(l,r),m=p.default.isCallerIdCTAVisibleInLandscape(l,r),S=o.default.getS4LEntitlementFeatures().SCE.Dialpad.Features.ExtensionDialingEnabled;return{screenWidth:A.default.getWidth(a),isSmallOrTinyScreenSize:d,bottomSafeAreaInset:R.default.bottomSafeAreaInset(h.BottomInsetDefault),isInLandscape:c,safeAreaHorizontalInsets:u,isUsingStackNavigationContext:i,shouldShowSaveContact:g,shouldShowCallerIdCTAPortrait:C,shouldShowCallerIdCTALandscape:m,extensionDialingEnabled:S&&void 0===s&&void 0===n,shouldShowRateAboveSelectedContact:p.default.shouldShowRateAboveSelectedContact()}}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),y.dismissAll()}componentDidMount(){super.componentDidMount();const{defaultStatusBarTheme:e}=G.themeColors(this._getContext(),this.props.route.params.colorThemeOverride),t=U.default.mergeStyles([U.default.createBarStyle(e),U.default.createHiddenStyle(!1)]);this._updateStatusBarStyle(t),N.default.dialpadRendered(),c.default.notifyDialpadCTAShown(),D.default.showPromptIfNeeded(this.props.route.params.conversationId||h.MainRootViewId)}componentWillUnmount(){super.componentWillUnmount(),this._removeStatusBarStyle(),p.default.resetDialerPanelState()}render(){const{colorThemeOverride:e,isAloneInNavStack:t}=this.props.route.params,{primaryBackgroundColorStyle:i,searchBoxColorStyle:o,dividerBorderColorStyle:s}=G.themeStyles(this._getContext(),e),r=[W.dialerWrapper,i];let l;return G.isUsingDarkTheme(this._getContext(),e)?(r.push(o),l=n.createElement(n.View,{style:W.darkThemeBackground})):l=G.isUsingAccessibleTheme(this._getContext(),e)?n.createElement(n.View,{style:W.accessibleLightThemeBackground}):n.createElement(a.GradientView,{style:W.regularLightThemeBackground,colors:I.default.getGradientColorsNoSubscription(),direction:a.GradientDirection.BOTTOM_RIGHT}),n.createElement(n.View,{style:this.state.isInLandscape?W.groupsLandscape:W.groups},n.createElement(n.View,{style:this.state.isInLandscape?W.firstGroupLandscape:H.default.flexOne},l,n.createElement(S.default,{ref:this._onDialpadHeaderRef,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,isAloneInNavStack:t,isInLandscape:this.state.isInLandscape,maxWidth:this.state.screenWidth?this.state.screenWidth-100:0}),this._renderPhoneNumberInput(),this.state.shouldShowRateAboveSelectedContact?this._renderCallRates():this._renderSelectedContact(),this._renderSaveContact(),this.state.shouldShowRateAboveSelectedContact?this._renderSelectedContact():this._renderCallRates(),n.createElement(b.default,{ref:this._onFastContactsSearchRef,isInLandscape:this.state.isInLandscape,safeAreaHorizontalInsets:this.state.safeAreaHorizontalInsets,onScroll:this._onScrollFastContactsSearch,onItemPressed:this._onItemPressedFastContactsSearch,onRender:this._onRenderFastContactsSearch}),n.createElement(B.default,{ref:this._onSearchSpacerAnimationRef,isInLandscape:this.state.isInLandscape}),this.state.isInLandscape?this._renderCallerIdCTA():void 0),n.createElement(n.View,{style:this.state.isInLandscape?[W.secondGroupLandscape,s]:W.secondGroup},n.createElement(n.View,{style:r},this._renderDialpadView())))}_renderCallRates(){return n.createElement(d.default,{key:"callRates"})}_renderSelectedContact(){return n.createElement(O.default,{key:"selectedContact"})}_renderSaveContact(){if(!this.state.shouldShowSaveContact)return;return n.createElement(L.default,{onContactSaved:this._onContactSaved})}_renderPhoneNumberInput(){const{callId:e,conversationId:t,prefilledNumber:i,reopenOnInvalidNumber:a}=this.props.route.params;return n.createElement(k.default,{onPress:this._onPress,callId:e,conversationId:t,isInLandscape:this.state.isInLandscape,prefilledInput:i,openedOnInvalidNumberError:a})}_renderCallerIdCTA(){if((this.state.isInLandscape||this.state.shouldShowCallerIdCTAPortrait)&&(!this.state.isInLandscape||this.state.shouldShowCallerIdCTALandscape))return n.createElement(l.default,{onMount:u.default.registerCallerIdDialerCTAOpen,onPress:this._onCallerIdDialpadCtaPress,isSmallScreen:this.state.isSmallOrTinyScreenSize})}_safeAreaMarginStyle(){if(this.state.safeAreaHorizontalInsets&&V.default.hasHorizontalSafeAreas(this.state.safeAreaHorizontalInsets))return V.default.horizontalMarginStyle(this.state.safeAreaHorizontalInsets)}_getSearchResultCount(){return this._fastContactsSearch?this._fastContactsSearch.state.profiles.length:0}_getHeaderText(e){return K.getHeaderText()}static getHeaderText(){return w.getString("PSTNDialerPanel.PSTNDialerPanelAccessibilityTitle")}}t.default=K},94641:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(16778),o=i(44770),s=i(87720),r=i(19784),l=i(89391),c=i(67930),d=i(98278),u=i(59799),h=i(46096),p=i(36237),g=i(15877),C=i(33754),m=i(78735),S=i(46929),y=i(4735),f=i(30124),_=i(35426),b=i(51070),T=i(90631),v=i(22222),w=i(81760),I=i(59433),P=i(80837),M=i(19675),k=i(53374),A=i(97634),R=i(11010),V=i(11828),L=i(10117),E=(0,g.lazyProperties)({panel:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),innerContainer:()=>n.Styles.createViewStyle({alignSelf:"stretch",marginTop:16,marginHorizontal:20,overflow:"visible",flexGrow:1}),titlePadding:()=>n.Styles.createTextStyle({paddingTop:4,paddingBottom:16}),textPadding:()=>n.Styles.createTextStyle({paddingBottom:16}),toggle:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"space-between",marginTop:16,paddingTop:4}),toggleText:()=>n.Styles.createTextStyle({flex:1,marginRight:20}),actionButton:()=>n.Styles.createViewStyle({flex:1,alignSelf:"center",marginVertical:16,minWidth:160}),bullet:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",marginBottom:12}),bulletText:()=>n.Styles.createTextStyle({font:R.default.font.uiDisplaySemibold}),bulletIcon:()=>n.Styles.createViewStyle({marginTop:-2,marginHorizontal:16}),locationImage:()=>n.Styles.createImageStyle({alignSelf:"center"}),locationImageSmall:()=>n.Styles.createImageStyle({marginVertical:20,width:110,height:125}),locationImageLarge:()=>n.Styles.createImageStyle({marginVertical:30,width:145,height:165})});class B extends c.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._close=()=>{const e=k.default.newCauseId();p.log(h.LogTraceArea.Navigation,"E911AcknowledgementPanel._close, causeId: "+e),y.default.goBack(e,this._getContext())},this._onLeftButtonPress=()=>{if(this.state.isAcknowledged)m.default.setE911LocationConsentGranted(this.state.isLocationConsentToggleOn),this.state.isLocationConsentToggleOn&&u.default.updateLocationWithPermission(h.LocationUpdateReason.E911ConsentUpdate),this._close();else if(this.props.route.params.isAloneInNavStack||this.state.isUsingStackNavigationContext){const e=C.getString("E911AcknowledgementPanel.AcknowledgeDismissTitle"),t=C.getString("E911AcknowledgementPanel.AcknowledgeDismissMessage"),i=[{text:C.getString("E911AcknowledgementPanel.AcknowledgeDismissLabel"),onPress:this._close,isSubmit:!0},{text:C.getString("Global.CancelLabel"),isCancel:!0}];r.default.showWithOptions({title:e,dialogAccessibilityTitle:t,message:t,buttons:i,rootViewId:this._getRootViewId()})}else this._close()},this._onScrollViewRef=e=>{this._contentScrollRef=e||void 0},this._onScrollViewScroll=e=>{e!==this.state.contentScrollTop&&this.setState({contentScrollTop:e})},this._onScrollViewLayout=e=>{const t=e.height;t!==this.state.contentVisibleHeight&&this.setState({contentVisibleHeight:t})},this._onScrollViewContentSizeChange=(e,t)=>{t!==this.state.contentHeight&&this.setState({contentHeight:t})},this._onInnerContainerLayout=()=>{this.state.isContentReady||this.setState({isContentReady:!0})},this._onLocationFAQLinkPress=e=>{e.stopPropagation(),e.preventDefault();const t=l.default.getS4LEntitlementFeaturesNoSubscription().SCE.Dialpad.E911;n.Linking.openUrl(t.locationFAQLink)},this._onLocationConsentToggleChange=(e,t)=>{this.setState({isLocationConsentToggleOn:t})},this._onActionButtonPress=()=>{if(this.state.isAcknowledged)u.default.requiresSystemPermission?u.default.requestLocationPermission().then((()=>!0)).catch((()=>!1)).always(this._onLocationConsent):this._onLocationConsent(this.state.isLocationConsentToggleOn);else if(this.state.isUsingStackNavigationContext||this.state.isAcknowledgementReviewed)S.default.setE911Acknowledged(!0),p.track(new _.E911AcknowledgementEvent),this.state.shouldRequestLocationConsent||this.props.route.params.onComplete();else{this._scrollToBottom();const{contentHeight:e,contentVisibleHeight:t}=this.state;!a.isUndefined(e)&&!a.isUndefined(t)&&e<=t&&this._checkAcknowledgementReviewed()}},this._onLocationConsent=e=>{m.default.setE911LocationConsentGranted(e),p.track(new _.E911LocationConsentEvent(e)),e&&(u.default.requiresSystemPermission?u.default.updateLocation(h.LocationUpdateReason.E911ConsentUpdate):u.default.updateLocationWithPermission(h.LocationUpdateReason.E911ConsentUpdate)),this.props.route.params.onComplete()}}static getHeaderText(){return C.getString("E911AcknowledgementPanel.PanelHeader")}_getHeaderText(e){return B.getHeaderText()}_buildState(e,t){const i={isAcknowledged:S.default.isE911Acknowledged(),shouldRequestLocationConsent:!e.route.params.shouldSkipLocationConsent&&u.default.isLocationEnabled()&&a.isUndefined(m.default.isE911LocationConsentGranted()),isUsingStackNavigationContext:f.default.isUsingStackNavigationContext(),safeAreaHorizontalPaddingStyle:this._getContext().isPresentedInDesktopSubview?void 0:b.default.horizontalPaddingStyle(d.HorizontalInsetZero)};return t&&(i.contentScrollTop=0,i.isContentReady=!1,i.isAcknowledgementReviewed=!1,i.isLocationConsentToggleOn=!1),i}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=t.contentScrollTop!==this.state.contentScrollTop,n=t.contentHeight!==this.state.contentHeight,o=t.contentVisibleHeight!==this.state.contentVisibleHeight,s=t.isContentReady!==this.state.isContentReady;(a||n||o||s)&&this._checkAcknowledgementReviewed()}render(){const e={closeButtonType:this.props.route.params.isAloneInNavStack||this.state.isUsingStackNavigationContext?T.CloseButtonType.Close:T.CloseButtonType.Back,onPress:this._onLeftButtonPress},{primaryBackgroundColorStyle:t}=A.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride),i=n.createElement(T.SimplePanelHeader,{panelName:this._getHeaderText(this.state),leftButton:e}),a=this.state.isUsingStackNavigationContext?this._getStackNavigationContent():this._getContent();return n.createElement(n.View,{style:[E.panel,t]},i,a)}_getContent(){return n.createElement(n.View,{style:P.default.flexOne},n.createElement(n.ScrollView,{style:P.default.flexOne,ref:this._onScrollViewRef,onScroll:this._onScrollViewScroll,onLayout:this._onScrollViewLayout,onContentSizeChange:this._onScrollViewContentSizeChange},n.createElement(n.View,{style:this._getInnerContainerStyles(),onLayout:this._onInnerContainerLayout},this._getAcknowledgementSection(),this._getLocationConsentSection())),n.createElement(n.View,null,this._getActionButton()))}_getStackNavigationContent(){return n.createElement(n.ScrollView,{style:P.default.flexOne},n.createElement(n.View,{style:this._getInnerContainerStyles()},this._getAcknowledgementSection(),this._getLocationConsentSection(),this._getActionButton()))}_getInnerContainerStyles(){const e=[E.innerContainer];return this.state.safeAreaHorizontalPaddingStyle&&e.push(this.state.safeAreaHorizontalPaddingStyle),e}_scrollToBottom(){var e;const{contentHeight:t,contentVisibleHeight:i}=this.state;!(null===(e=this._contentScrollRef)||void 0===e?void 0:e.setScrollTop)||a.isUndefined(t)||a.isUndefined(i)||(this._contentScrollRef.setScrollTop(t-i,!0),p.log(h.LogTraceArea.Phone,"E911AcknowledgementPanel: Scrolling to bottom."))}_checkAcknowledgementReviewed(){const{isAcknowledged:e,contentScrollTop:t,contentHeight:i,contentVisibleHeight:n,isContentReady:o,isAcknowledgementReviewed:s}=this.state;e||a.isUndefined(i)||a.isUndefined(n)||!o||!s&&a.round(n+t)>=a.floor(i)&&(p.log(h.LogTraceArea.Phone,"E911AcknowledgementPanel: Acknowledgement reviewed."),this.setState({isAcknowledgementReviewed:!0}))}_getAcknowledgementSection(){if(!this.state.isAcknowledged||!this.state.shouldRequestLocationConsent)return n.createElement(n.View,null,n.createElement(M.BodyText,{style:E.titlePadding,bold:!0},C.getString("E911AcknowledgementPanel.DisclosureTitle")),n.createElement(M.BodyText,{style:E.textPadding},C.getString("E911AcknowledgementPanel.DisclosureText1")),n.createElement(M.BodyText,{style:E.textPadding},C.getString("E911AcknowledgementPanel.DisclosureText2")),n.createElement(M.BodyText,{style:E.titlePadding,bold:!0},C.getString("E911AcknowledgementPanel.LimitationTitle")),n.createElement(M.BodyText,null,C.getString("E911AcknowledgementPanel.LimitationText")))}_getLocationConsentSection(){if(this.state.isAcknowledged&&this.state.shouldRequestLocationConsent)return n.createElement(n.View,null,this._getLocationConsentText(),this._getLocationImage(),this._getLocationConsentBullets(),this._getLocationConsentToggle())}_getLocationConsentText(){const e=u.default.requiresSystemPermission?C.getString("E911AcknowledgementPanel.LocationConsentText3"):C.getString("E911AcknowledgementPanel.LocationConsentText1");return n.createElement(M.BodyText,null,e)}_getLocationImage(){const e=[E.locationImage];return u.default.requiresSystemPermission?e.push(E.locationImageLarge):e.push(E.locationImageSmall),n.createElement(n.Image,{source:o.Collection.LOCATION_SHARE,style:e,resizeMode:"contain"})}_getLocationConsentBullets(){const e=C.getString("E911AcknowledgementPanel.LocationConsentText2"),t=n.createElement(n.Text,null,e),i=u.default.requiresSystemPermission?C.getString("E911AcknowledgementPanel.LocationConsentText5"):C.getString("E911AcknowledgementPanel.LocationConsentText4"),a=n.createElement(I.default,{url:"#",style:E.bulletText,linkTextStyle:d.LinkTextStyle.BodyText,blue:!0,onPress:this._onLocationFAQLinkPress},C.getString("Global.LearnMore")),o=n.createElement(n.Text,null,i," ",a);return[this._getBullet(V.SkypeIcon.GPS,t,"bullet1"),this._getBullet(V.SkypeIcon.LiveLocation,o,"bullet2")]}_getBullet(e,t,i){const a=[P.default.flexOne,E.bulletText],{primaryTextColor:o}=A.themeColors(this._getContext(),this.props.route.params.colorThemeOverride),s=A.isUsingAccessibleTheme(this._getContext(),this.props.route.params.colorThemeOverride)?o:A.isUsingDarkTheme(this._getContext(),this.props.route.params.colorThemeOverride)?w.Color.gray300:w.Color.gray500;return n.createElement(n.View,{key:i,style:E.bullet},n.createElement(L.default,{icon:e,size:V.IconSize.size24,color:s,style:E.bulletIcon}),n.createElement(M.BodyText,{style:a},t))}_getLocationConsentToggle(){if(u.default.requiresSystemPermission)return;const e=C.getString("E911AcknowledgementPanel.LocationConsentToggleLabel");return n.createElement(s.default,{style:E.toggle,isOn:this.state.isLocationConsentToggleOn,accessibilityLabel:e,onChange:this._onLocationConsentToggleChange},n.createElement(M.BodyText,{style:E.toggleText,bold:!0},e))}_getActionButton(){const e=this._getActionButtonTitle();return n.createElement(n.View,{style:E.actionButton},n.createElement(v.default,{buttonSize:d.SXButtonSize.Medium,buttonStyle:d.SXButtonStyle.ColorFill,title:e,allowTextWrap:!0,onPress:this._onActionButtonPress}))}_getActionButtonTitle(){return this.state.isAcknowledged&&this.state.shouldRequestLocationConsent?C.getString("E911AcknowledgementPanel.ContinueLabel"):this.state.isUsingStackNavigationContext||this.state.isAcknowledgementReviewed?C.getString("E911AcknowledgementPanel.AcknowledgeLabel"):C.getString("Global.MoreButtonTitle")}}t.default=B},37876:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.QuickCallNavigation=void 0;const a=i(16778),n=i(70170);t.QuickCallNavigation=e=>{const{conversationId:t,callId:i,newGroup:o,searchOnly:s}=e.route.params;return a.createElement(n.default,{conversationId:t,callId:i,newGroup:o,searchOnly:s})},t.default=t.QuickCallNavigation},77721:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(31844),o=i(16778),s=i(19784),r=i(89391),l=i(96074),c=i(9520),d=i(71727),u=i(47204),h=i(98278),p=i(46096),g=i(10117),C=i(36237),m=i(48638),S=i(72490),y=i(15877),f=i(33754),_=i(78735),b=i(30124),T=i(29130),v=i(72997),w=i(51070),I=i(81115),P=i(10265),M=i(90631),k=i(4057),A=i(22222),R=i(81760),V=i(11828),L=i(60305),E=i(97634),B=i(29311),O=i(66123),D=i(89174),x=i(53374),N=R.Color.gray400,U=(0,y.lazyProperties)({panel:()=>o.Styles.createViewStyle({flex:1,flexDirection:"column",alignSelf:"stretch",backgroundColor:N}),modalContainerForAll:()=>o.Styles.createViewStyle({flex:1,flexDirection:"column",alignItems:"stretch",justifyContent:"flex-start",paddingTop:0,paddingLeft:20,paddingRight:20,paddingBottom:20}),backgroundsList:()=>o.Styles.createViewStyle({flexWrap:"wrap",flexDirection:"row",justifyContent:"center"}),backgroundsListParent:()=>o.Styles.createViewStyle({flex:1,flexWrap:"wrap",flexDirection:"column",justifyContent:"center",alignSelf:"center"}),header:()=>o.Styles.createViewStyle({paddingHorizontal:10,backgroundColor:N}),titleText:()=>o.Styles.createTextStyle({color:R.Color.white}),noteText:()=>o.Styles.createTextStyle({paddingLeft:8,color:R.Color.white}),noteTextRtl:()=>o.Styles.createTextStyle({paddingRight:8,color:R.Color.white}),divider:()=>o.Styles.createViewStyle({flex:1,height:void 0,minWidth:2}),button:()=>o.Styles.createViewStyle({width:180,marginTop:5}),buttonStacked:()=>o.Styles.createViewStyle({marginTop:5}),closeButton:()=>o.Styles.createViewStyle({height:50,paddingLeft:15,paddingRight:15}),infoAndButton:()=>o.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap",justifyContent:"space-between",alignItems:"center",marginHorizontal:10,marginTop:10}),infoAndButtonStacked:()=>o.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignItems:"center",marginHorizontal:10,marginTop:10}),infoIconAndText:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"center",marginTop:5})});class F extends l.BaseNavigationView{constructor(){super(...arguments),this._onEscape=()=>(C.log(p.LogTraceArea.CallingUI,"TogetherModePanel._onEscape"),this._onClose(),!0),this._onClose=()=>{if(this._dismissPanel(),this.props.route.params.onClose){const e=this.props.route.params.isAudienceBotInCall;C.track(new c.TogetherModePanelActionEvent(c.TogetherModePanelActionOrigin.Cancel,e)),this.props.route.params.onClose()}},this._onBackgroundItemDoubleTap=()=>{this._applyTogetherMode()},this._onBackgroundSelected=(e,t)=>{C.log(p.LogTraceArea.CallingUI,"TogetherModePanel: _onBackgroundSelected "+k.default.asString(e.untranslatedName)),t&&this.state.isNavigatingWithKeyboard?this._requestToApplyTogetherMode():this.setState({selectedBackground:e})},this._requestToApplyTogetherMode=()=>{this.state.stackNavigation?this._showApplyConfirmationDialog():this._applyTogetherMode()}}_buildState(e,t){t&&(this._rootViewId=this._getRootViewId());const i=T.default.getWidth(this._rootViewId),n=v.default.responsiveWidthForSize(i),o=O.default.getTogetherModeBackgrounds(),s=a.first(o),l=t?e.route.params.selectedBackground||s:this.state.selectedBackground;C.log(p.LogTraceArea.CallingUI,`created new state backgroundsList ${o.length}`);const c=E.isUsingAccessibleTheme(this._getContext(),e.route.params.colorThemeOverride),u=r.default.getS4LCMCFeatures(),h=d.default.useLightTheme()&&u.enableNewCallScreen&&_.default.getNewCallScreenDesignEnabled(),g=b.default.isUsingStackNavigationContext(),S=h||c||g;return{backgroundsList:o,hasBackgroundsSection:o.length>0,appWidth:i,selectedBackground:l,screenSize:n,isNavigatingWithKeyboard:m.default.isNavigatingWithKeyboard(),highContrastTheme:c,stackNavigation:g,defaultTheme:S,deviceOrientation:T.default.getDeviceOrientation(this._rootViewId),safeAreaHorizontalInsets:w.default.horizontalInsets(),isTablet:L.default.isTablet()}}componentDidMount(){super.componentDidMount(),S.default.addEscapeHandler(this._onEscape)}componentWillUnmount(){super.componentWillUnmount(),S.default.removeEscapeHandler(this._onEscape)}render(){const e=this.state.deviceOrientation===n.DeviceOrientation.Portrait,t=D.default.getBackgroundItemDimensions(this.state.stackNavigation,e,this.state.isTablet),i=this.state.stackNavigation,a=D.default.getModalWidth(this.state.screenSize,this.state.backgroundsList.length),s=D.default.getModalHeight(this.state.backgroundsList.length),r=i?void 0:a,l=[U.backgroundsList,o.Styles.createViewStyle({maxWidth:r},!1)],c=o.createElement(B.default,{style:l,backgroundsList:this.state.backgroundsList,itemWidth:t.width,itemHeight:t.height,selectedBackground:this.state.selectedBackground,isNavigatingWithKeyboard:this.state.isNavigatingWithKeyboard,onItemDoubleTap:this._onBackgroundItemDoubleTap,onItemSelected:this._onBackgroundSelected,accessibilityLabel:f.getString("TogetherModeModal.Title"),highContrastTheme:this.state.highContrastTheme,stackNavigation:this.state.stackNavigation,defaultTheme:this.state.defaultTheme}),d=[U.modalContainerForAll];if(!!this.state.safeAreaHorizontalInsets&&I.default.hasHorizontalSafeAreas(this.state.safeAreaHorizontalInsets)){const e=I.default.horizontalPaddingStyle(this.state.safeAreaHorizontalInsets);d.push(e)}const u=o.createElement(o.View,{style:d},o.createElement(o.View,{style:U.backgroundsListParent},c),this._getInfoIconAndButton()),h=[U.panel],{primaryBackgroundColorStyle:p,primaryTextColorStyle:g}=E.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride);this.state.defaultTheme&&h.push(p);const C=[U.header];this.state.defaultTheme&&C.push(p);const m=this.state.defaultTheme?g:U.titleText;return o.createElement(P.default,{dialogId:"togetherMode",onClickOutside:this._onClose,maxWidth:a,maxHeight:s,fullScreen:i,useFullSizeContainer:!0},o.createElement(o.View,{style:h},o.createElement(M.SimplePanelHeader,{panelName:this._getTitleText(),leftButton:this._getCancelButton(),style:C,titleTextStyle:m,hideBottomBorder:!this.state.stackNavigation,useCenteredControls:!0}),u))}_getCancelButton(){const{headerIconColor:e,iconHoverColor:t}=E.themeColors(this._getContext(),this.props.route.params.colorThemeOverride),i=this.state.defaultTheme?e:R.Color.white,a=this.state.defaultTheme?t:R.Color.gray100;return{closeButtonType:M.CloseButtonType.Close,title:f.getString("Global.CloseButtonTitle"),onPress:this._onClose,color:i,hoverColor:a}}_getApplyButton(){const e=this.state.highContrastTheme?h.SXButtonStyle.ThemeFill:h.SXButtonStyle.ColorFill;return o.createElement(A.default,{title:this._getApplyButtonText(),style:this.state.stackNavigation?U.buttonStacked:U.button,buttonStyle:e,buttonSize:h.SXButtonSize.Medium,onPress:this._requestToApplyTogetherMode,disabled:!this.state.selectedBackground})}_getInfoIconAndButton(){const e=this.state.stackNavigation?U.infoAndButtonStacked:U.infoAndButton,{primaryTextColorStyle:t}=E.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride),{headerIconColor:i}=E.themeColors(this._getContext(),this.props.route.params.colorThemeOverride),a=[this._getContext().isRTL?U.noteTextRtl:U.noteText];this.state.defaultTheme&&a.push(t);const n=this.state.defaultTheme?i:R.Color.white,s=this.state.stackNavigation?void 0:o.createElement(o.View,{style:U.infoIconAndText},o.createElement(g.default,{size:V.IconSize.size16,icon:V.SkypeIcon.Info,color:n}),o.createElement(o.Text,{style:a},f.getString("TogetherModeModal.AppliesToAllParticipantsNote")));return o.createElement(o.View,{style:e},s,this._getApplyButton())}_getTitleText(){const e=this.state.deviceOrientation===n.DeviceOrientation.Portrait;return this.state.stackNavigation&&!this.state.isTablet&&e?f.getString("TogetherModeModal.TitleCompact"):f.getString("TogetherModeModal.Title")}_getApplyButtonText(){const e=this.state.deviceOrientation===n.DeviceOrientation.Portrait,t=this.state.stackNavigation&&!this.state.isTablet&&e;return this.props.route.params.isAudienceBotInCall||t?f.getString("TogetherModeModal.Apply"):f.getString("TogetherModeModal.ApplyAndEnable")}_showApplyConfirmationDialog(){const e=f.getString("TogetherModeModal.ConfirmTitle"),t=f.getString("TogetherModeModal.AppliesToAllParticipantsNote"),i=[{text:f.getString("Global.CancelLabel"),isCancel:!0,onPress:()=>{}},{text:f.getString("Global.ConfirmLabel"),isSubmit:!0,style:"destructive",onPress:()=>{this._applyTogetherMode()}}];s.default.showWithOptions({title:e,dialogAccessibilityTitle:t,message:t,buttons:i,rootViewId:this._getRootViewId()})}_dismissPanel(){if(this.state.stackNavigation){const e=x.default.newCauseId();this._goBack(e)}else u.default.dismissModal(O.default.getPanelId(),this._rootViewId)}_applyTogetherMode(){const e=this.props.route.params.isAudienceBotInCall,t=this.state.selectedBackground;a.isUndefined(t)?e?C.warn(p.LogTraceArea.CallingUI,"Attempting to change Together Mode background to undefined."):C.warn(p.LogTraceArea.CallingUI,"Attempting to start Together Mode without specifying a background."):(C.track(new c.TogetherModePanelActionEvent(c.TogetherModePanelActionOrigin.Apply,e)),this._dismissPanel(),e?this.props.route.params.onChangeBackground(t):this.props.route.params.onStartTogetherMode(t))}}t.default=F},17096:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(16778),n=i(67930),o=i(90631),s=i(80837),r=i(12187),l=i(33754),c=i(15877),d=i(13912),u=i(97634),h=(0,c.lazyProperties)({panel:()=>a.Styles.createViewStyle({flex:1,alignSelf:"stretch"})});class p extends n.BaseNavigationViewPresentedInModal{static getHeaderText(){return l.getString("MeetNowCallControls.TwinCam")}_getHeaderText(e){return p.getHeaderText()}componentDidMount(){super.componentDidMount();const{defaultStatusBarTheme:e}=u.themeColors(this._getContext(),this.props.route.params.colorThemeOverride);this._updateStatusBarStyle(r.default.mergeStyles([r.default.createBarStyle(e),r.default.createHiddenStyle(!1)]))}render(){const{callId:e,conversationMri:t,isAloneInNavStack:i,onStopTwinCamPressed:n,colorThemeOverride:r}=this.props.route.params,{primaryBackgroundColorStyle:c}=u.themeStyles(this._getContext(),r);return a.createElement(a.View,{style:[h.panel,c]},a.createElement(o.SimplePanelHeader,{panelName:l.getString("MeetNowCallControls.TwinCam"),leftButton:{closeButtonType:i?o.CloseButtonType.Close:o.CloseButtonType.Back}}),a.createElement(a.ScrollView,{style:s.default.flexOne},a.createElement(d.default,{callId:e,conversationMri:t,leftOffset:0,onStopTwinCamPressed:n})))}}t.default=p},15315:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TwinCamPanel=t.TogetherModePanel=t.QuickCallNavigation=t.CallTranscriptionStackPanel=t.CallStatsView=t.CallRosterPanel=t.CallPreviewStackNavigation=t.CallPanel=t.BingBackgroundsPanelView=t.E911AcknowledgementPanel=t.DialerPanel=t.CountrySelector=t.CallCaptionsSettingsPanel=void 0;var a=i(51060);Object.defineProperty(t,"CallCaptionsSettingsPanel",{enumerable:!0,get:function(){return a.default}});var n=i(24360);Object.defineProperty(t,"CountrySelector",{enumerable:!0,get:function(){return n.default}});var o=i(79274);Object.defineProperty(t,"DialerPanel",{enumerable:!0,get:function(){return o.default}});var s=i(94641);Object.defineProperty(t,"E911AcknowledgementPanel",{enumerable:!0,get:function(){return s.default}});var r=i(24899);Object.defineProperty(t,"BingBackgroundsPanelView",{enumerable:!0,get:function(){return r.default}});var l=i(83940);Object.defineProperty(t,"CallPanel",{enumerable:!0,get:function(){return l.default}});var c=i(10604);Object.defineProperty(t,"CallPreviewStackNavigation",{enumerable:!0,get:function(){return c.default}});var d=i(91848);Object.defineProperty(t,"CallRosterPanel",{enumerable:!0,get:function(){return d.default}});var u=i(4096);Object.defineProperty(t,"CallStatsView",{enumerable:!0,get:function(){return u.default}});var h=i(52120);Object.defineProperty(t,"CallTranscriptionStackPanel",{enumerable:!0,get:function(){return h.default}});var p=i(37876);Object.defineProperty(t,"QuickCallNavigation",{enumerable:!0,get:function(){return p.default}});var g=i(77721);Object.defineProperty(t,"TogetherModePanel",{enumerable:!0,get:function(){return g.default}});var C=i(17096);Object.defineProperty(t,"TwinCamPanel",{enumerable:!0,get:function(){return C.default}})},4117:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(96486),n=i(6541),o=i(37802),s=i(46096),r=i(36237),l=i(18078),c=i(40363);class d extends n.BaseEntitlementsClient{getRates(e){const t=Date.now(),i=l.default.getSkypeId(),n="users/"+encodeURIComponent(i)+"/call-rates?Platform="+c.default.getSkypePlatformId()+a.map(e,((e,t)=>"&callNumbers["+t+"]="+encodeURIComponent(e))).join("");r.log(s.LogTraceArea.EntitlementsClient,"Performing call to ConsumerEntitlement: GET Call Rates");return this._performRequest(n,{acceptType:"application/json; ver=1.0"}).then((e=>{let i=a.keyBy(e.body,(e=>e.pstnNumber));return r.track(new o.RatesFetching(Date.now()-t)),i}))}}t.default=new d},99075:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(62783),n=i(89391),o=i(33754);class s extends a.GenericRestClient{constructor(){super(n.default.getConfigSettingsNoSubscription().pstn.host),this._ratesEndpoint=n.default.getConfigSettingsNoSubscription().pstn.ratesEndpoint}getConfig(e){const t=(e||o.getLocale()).toLowerCase()+".json";return this.performApiGet(this._ratesEndpoint+t)}}t.default=new s},11878:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(62783),n=i(89391),o=i(46096),s=i(36237),r=i(15963),l=i(16568),c=i(13159),d=i(94050),u=i(94214);class h extends c.SkypeRestClient{constructor(){super(n.default.getConfigSettingsNoSubscription().registrar.host),this._customErrorHandler=(e,t)=>401===t.statusCode&&t.body&&40102===t.body.code?(s.log(o.LogTraceArea.RegistrarService,"RegistrarClient got 401 w/error code 40102 from request -- nuking skypetoken"),u.default.skypeTokenInvalid(e.getRequestHeaders()["X-Skypetoken"]),a.ErrorHandlingType.DoNotRetry):(0,a.DefaultErrorHandler)(e,t),this._defaultOptions.mustHaveValidSkypeToken=!0,this._defaultOptions.customErrorHandler=this._customErrorHandler}_getHeaders(e){const t=super._getHeaders(e);return t["X-Skypetoken"]=u.default.getRawSkypeToken(),t}enumerateRegistrations(){return this.performApiGet(n.default.getConfigSettingsNoSubscription().registrar.registrationRelativeUrl)}postRegistration(e){return l.default.CallingNodeId.waitUntilSet().then((()=>{const t=new d.default(r.ScenarioName.PNH_Post,void 0,{NodeId:l.default.CallingNodeId.get()||""});return t.start(),this.performApiPost(n.default.getConfigSettingsNoSubscription().registrar.registrationRelativeUrl,e).then((()=>t.finish()),(e=>t.fail(e.statusCode.toString(),{body:JSON.stringify(e.body),statusText:e.statusText||""})))}))}deleteRegistration(e){return l.default.CallingNodeId.waitUntilSet().then((()=>{const t=new d.default(r.ScenarioName.PNH_Delete,void 0,{NodeId:l.default.CallingNodeId.get()||""});t.start();const i=n.default.getConfigSettingsNoSubscription().registrar.registrationRelativeUrl+"/"+e;return this.performApiDelete(i).then((()=>t.finish()),(e=>t.fail(e.statusCode.toString(),{body:JSON.stringify(e.body),statusText:e.statusText||""})))}))}}t.default=new h}}]);