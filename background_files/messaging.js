"use strict";(self.webpackChunkskype4life=self.webpackChunkskype4life||[]).push([[523],{34339:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AnimatedEmoticonV1=t.AnimatedEmoticon=t.Size=void 0;const i=s(70655),o=s(51277),n=s(16778),r=s(72374),a=s(76808),l=s(89391),d=s(82433),c=s(32183),h=s(46096),u=s(36237),p=s(32226),g=s(26424);Object.defineProperty(t,"Size",{enumerable:!0,get:function(){return g.EmoticonSize}});const m=s(17707),S=s(58962),f=s(82167),y=s(80837),_=s(19675),v=s(24576);class C extends n.Component{constructor(){super(...arguments),this._isImageCachingStoreAllowed=l.default.getS4LMessagingFeaturesNoSubscription().enableImageCachingStoreForAnimated}render(){if(this._isImageCachingStoreAllowed){const e=this.props,{isStatic:t,showPlaceHolder:s,placeholderBackgroundColor:o,allowTextFallback:r,onlyRenderFallbackText:l,fallbackTextStyle:d}=e,c=(0,i.__rest)(e,["isStatic","showPlaceHolder","placeholderBackgroundColor","allowTextFallback","onlyRenderFallbackText","fallbackTextStyle"]);let h,u;return l?h=a.RenderMode.FallbackTextOnly:t&&(h=a.RenderMode.StaticOnly),s?u={type:a.FallbackType.Placeholder,placeholderStyle:o?n.Styles.createViewStyle({backgroundColor:o},!1):void 0}:r&&(u={type:a.FallbackType.FallbackText,fallbackTextStyle:d}),n.createElement(a.AnimatedEmoticonV2,Object.assign({nonDefaultRenderMode:h,fallback:u},c))}return n.createElement(b,Object.assign({},this.props))}}t.AnimatedEmoticon=C;class b extends v.default{constructor(){super(...arguments),this._onMouseEnter=()=>{this.state.forceAnimateOnHover&&this.setState({forceAnimate:!0})},this._onMouseLeave=()=>{this.state.forceAnimateOnHover&&this.setState({forceAnimate:!1})},this._renderAlternateView=()=>{const e=(0,a.getStyles)(this.props.renderSize?this.props.renderSize:this.props.size);if(u.log(h.LogTraceArea.AnimatedEmoticon,`Rendering alternate view ${this.props.emoticonName}`),!this.props.showPlaceHolder)return;u.log(h.LogTraceArea.AnimatedEmoticon,`Rendering placeholder view ${this.props.emoticonName}`);let t=[a.Styles.placeholderBackground,e.placeholder];return this.props.placeholderBackgroundColor&&t.push(n.Styles.createViewStyle({backgroundColor:this.props.placeholderBackgroundColor},!1)),n.createElement(n.View,{style:t,title:this.props.innerText,importantForAccessibility:n.Types.ImportantForAccessibility.No})}}_initStoreSubscriptions(){return this._emoticonId=b._emoticonRefCount++,this.props.isStatic||r.default.register(this._emoticonId),[]}componentWillUnmount(){super.componentWillUnmount(),this.props.isStatic||r.default.unregister(this._emoticonId)}UNSAFE_componentWillReceiveProps(e,t){this.props.isStatic&&!e.isStatic?r.default.register(this._emoticonId):!this.props.isStatic&&e.isStatic&&r.default.unregister(this._emoticonId),super.UNSAFE_componentWillReceiveProps(e,t)}UNSAFE_componentWillUpdate(e,t,s){this.state.rerenderEmoticonOnNetworkUpdate&&!1===t.rerenderEmoticonOnNetworkUpdate&&this.state.emoticonInfo&&(t.staticImagePrefetched||f.default.prefetch(t.emoticonUrlToFetchOnNetworkUpdate)),super.UNSAFE_componentWillUpdate(e,t,s)}_buildState(e,t){const s=r.default.canAnimate(this._emoticonId),i=d.default.getEmoticonByName(e.emoticonName);if(!i){m.default.triggerEmoticonInfoFetch(e.emoticonName);return{emoticonInfo:void 0,frameCount:0,firstFrame:0,url:void 0,staticUrl:void 0,animate:!1,staticImagePrefetched:!1,animatedImagePrefetched:!1,rerenderEmoticonOnNetworkUpdate:!e.onlyRenderFallbackText&&!this._defaultStaticUrl&&!p.default.isConnected(),emoticonUrlToFetchOnNetworkUpdate:this._defaultStaticUrl,forceAnimateOnHover:!1}}const o=i.frameCount,n=(i.firstFrame||0)%o,a=!!i.frameCount&&i.frameCount>1;let l=!e.isStatic&&a&&s,h=(0,c.getEmoticonUrl)(i.id,e.size,!0,e.tone,i.etag),u=f.default.isImagePrefetched(h,!0,t);u||e.size!==(0,c.getDefaultEmoticonSize)(this._getRootViewId())&&(h=(0,c.getEmoticonUrl)(i.id,(0,c.getDefaultEmoticonSize)(this._getRootViewId()),!0,e.tone,i.etag),u=f.default.isImagePrefetched(h,!0,t));let g=!1;const S=(0,c.getEmoticonUrl)(i.id,e.size,!1,e.tone,i.etag);l?(g=f.default.isImagePrefetched(S,!0,t),g||(l=!1)):g=f.default.isImagePrefetched(S,!1,t),i.etag||(this._defaultStaticUrl=h,this._defaultStaticImagePrefetched=u,this._defaultAnimatedUrl=S,this._defaultAnimate=l);return{emoticonInfo:i,firstFrame:n,frameCount:o,url:S,staticUrl:h,animate:l,staticImagePrefetched:u,animatedImagePrefetched:g,rerenderEmoticonOnNetworkUpdate:!e.onlyRenderFallbackText&&!u&&!p.default.isConnected(),emoticonUrlToFetchOnNetworkUpdate:h,forceAnimateOnHover:a}}render(){const e=(0,a.getStyles)(this.props.renderSize?this.props.renderSize:this.props.size);if(this.props.onlyRenderFallbackText)return u.log(h.LogTraceArea.AnimatedEmoticon,`Permanent Rendering fallback text for emoticon as required by props onlyRenderFallbackText ${this.props.innerText}`),this._renderFallbackText(e);let t,s,i,r=!1,l="Placeholder";if(this.state.emoticonInfo||this._defaultStaticImagePrefetched){i=this.state.url;let a=this.state.animate;s=this.state.staticUrl||this._defaultStaticUrl;let d=this.state.staticImagePrefetched||this._defaultStaticImagePrefetched;if(r=a||this.state.forceAnimate,!this.state.animate&&this._defaultAnimate&&(i=this._defaultAnimatedUrl,a=this._defaultAnimate,s=this._defaultStaticUrl),r&&i&&!this.state.animatedImagePrefetched&&(f.default.prefetch(i),r=!1),r&&i){const r=S.getFrameHeight(this.props.size);t=n.createElement(o.default,{style:e.image,originalWidth:r,originalHeight:r,url:i,staticUrl:s,name:this.props.emoticonName,firstFrame:this.state.firstFrame,sourceFramesCount:this.state.frameCount,synchronized:!this.props.standaloneAnimation,zoomHint:this.props.zoomHint,tooltip:this.props.innerText}),l="Animated"}else if(s)if(this._defaultStaticUrl&&!this.state.staticImagePrefetched&&this._defaultStaticImagePrefetched&&(s=this._defaultStaticUrl,d=this._defaultStaticImagePrefetched),d)t=n.createElement(n.Image,{style:e.image,title:this.props.innerText,source:s,resizeMode:"cover"}),l=this.props.isStatic&&!this.state.forceAnimate?"Image":"FallbackImage";else{if(this.props.allowTextFallback)return u.log(h.LogTraceArea.AnimatedEmoticon,`Rendering text fallback as image is not prefetched ${s}`),this._renderFallbackText(e);t=this._renderAlternateView()}}else{if(u.log(h.LogTraceArea.AnimatedEmoticon,`EmoticonInfo not present for ${this.props.innerText}`),!this.props.showPlaceHolder)return u.log(h.LogTraceArea.AnimatedEmoticon,`Temporary Rendering fallback text for emoticon as no emoticon config data available. ${this.props.innerText}`),this._renderFallbackText(e);t=this._renderAlternateView()}const d=r?i:s;u.log(h.LogTraceArea.AnimatedEmoticon,`${l} emoticon - emoticon:${this.props.emoticonName} - url ${d}`);const c=[e.image];return this.props.style&&c.push(this.props.style),this.state.animate&&c.push(a.Styles.animatedTransform),this.state.forceAnimate&&this.props.onHoverAfterBodyEmoticonStyle&&c.push(this.props.onHoverAfterBodyEmoticonStyle),n.createElement(n.View,{style:c,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave,importantForAccessibility:this.props.importantForAccessibility},n.createElement(n.Text,{style:a.Styles.innerTextTransparent,selectable:!this.props.preventSelectable,importantForAccessibility:this.props.preventSelectable?n.Types.ImportantForAccessibility.NoHideDescendants:void 0},this.props.description||this.props.innerText),t,this.props.children)}_renderFallbackText(e){const t=[y.default.transparentBackground,e.fallbackTextContainer,this._useDarkTheme()?this._themeStyles.secondaryTextColorStyle:this._themeStyles.primaryTextColorStyle];return this.props.fallbackTextStyle&&t.push(this.props.fallbackTextStyle),n.createElement(_.BodyText,{style:t,selectable:!this.props.preventSelectable},this.props.emoticonName)}}t.AnimatedEmoticonV1=b,b._emoticonRefCount=0},76808:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AnimatedEmoticonV2=t.Styles=t.getStyles=t.FallbackType=t.RenderMode=void 0;const i=s(96486),o=s(51277),n=s(16778),r=s(72374),a=s(89391),l=s(36974),d=s(82433),c=s(32183),h=s(46096),u=s(39597),p=s(36237),g=s(61253),m=s(15877),S=s(26424),f=s(17707),y=s(58962),_=s(81760),v=s(80837),C=s(19675),b=s(24576);var T,M;!function(e){e[e.StaticOnly=0]="StaticOnly",e[e.FallbackTextOnly=1]="FallbackTextOnly"}(T=t.RenderMode||(t.RenderMode={})),function(e){e[e.Placeholder=0]="Placeholder",e[e.FallbackText=1]="FallbackText"}(M=t.FallbackType||(t.FallbackType={}));let I={};function w(e){let t=y.getFrameHeight(e);return I[t]||(I[t]={image:n.Styles.createViewStyle({height:t,width:t},!1),placeholder:n.Styles.createViewStyle({height:t,width:t,borderRadius:t/2},!1),fallbackTextContainer:n.Styles.createTextStyle({lineHeight:t,height:t},!1)}),I[t]}var P,k;t.getStyles=w,t.Styles=(0,m.lazyProperties)({placeholderBackground:()=>n.Styles.createViewStyle({backgroundColor:_.Color.gray100}),innerTextTransparent:()=>n.Styles.createTextStyle({color:_.Color.transparent,position:"absolute",backgroundColor:_.Color.transparent}),animatedTransform:()=>n.Styles.createViewStyle({transform:[{rotateZ:"0"}]})}),function(e){e[e.AnimatedIcon=0]="AnimatedIcon",e[e.StaticIcon=1]="StaticIcon",e[e.Fallback=2]="Fallback"}(P||(P={})),function(e){e[e.Empty=0]="Empty",e[e.Animated=1]="Animated",e[e.Image=2]="Image",e[e.FallbackImage=3]="FallbackImage",e[e.Placeholder=4]="Placeholder"}(k||(k={}));class A extends b.default{constructor(){super(...arguments),this._telemetry=new l.default(a.default.getS4LMessagingFeaturesNoSubscription().nativeEmoticonCacheTelemetrySampleRate,(()=>this._getDesiredEmoticonInfo())),this._onMouseEnter=()=>{this.state.forceAnimateOnHover&&this.setState({forceAnimate:!0})},this._onMouseLeave=()=>{this.state.forceAnimateOnHover&&this.setState({forceAnimate:!1})}}_getDesiredEmoticonInfo(){return this.state.desiredComponentType===P.AnimatedIcon||this.state.forceAnimate?this.state.desiredAnimatedIcon||this.state.desiredStaticIcon:this.state.desiredComponentType===P.StaticIcon?this.state.desiredStaticIcon:void 0}_getResultToRender(e){return(e.desiredComponentType===P.AnimatedIcon||e.forceAnimate)&&e.animatedIcon?e.animatedIcon:e.desiredComponentType!==P.Fallback&&e.staticIcon?e.staticIcon:void 0}UNSAFE_componentWillMount(){this._componentId=--A._emoticonRefCount,i.isUndefined(this.props.nonDefaultRenderMode)&&r.default.register(this._componentId),super.UNSAFE_componentWillMount()}componentWillUnmount(){this._telemetry.finishAndResetTelemetry(),super.componentWillUnmount(),i.isUndefined(this.props.nonDefaultRenderMode)&&r.default.unregister(this._componentId)}UNSAFE_componentWillReceiveProps(e,t){!i.isUndefined(this.props.nonDefaultRenderMode)&&i.isUndefined(e.nonDefaultRenderMode)?r.default.register(this._componentId):i.isUndefined(this.props.nonDefaultRenderMode)&&!i.isUndefined(e.nonDefaultRenderMode)&&r.default.unregister(this._componentId),super.UNSAFE_componentWillReceiveProps(e,t)}componentDidMount(){super.componentDidMount(),this._telemetry.updateTelemetry(this._getResultToRender(this.state))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);const i=this._getResultToRender(t),o=this._getResultToRender(this.state);e.emoticonName!==this.props.emoticonName||e.size!==this.props.size||e.nonDefaultRenderMode!==this.props.nonDefaultRenderMode||t.forceAnimate!==this.state.forceAnimate?(this._telemetry.finishAndResetTelemetry(),this._telemetry.updateTelemetry(o)):(0,g.default)(i,o)||this._telemetry.updateTelemetry(o)}_getEmoticonInfo(e,t,s){return{id:e.emoticonName,size:y.getPixelSize(e.size),type:t,etag:s?s.etag:void 0,tone:e.tone}}_getMissingConfigState(e){return{desiredComponentType:e?P.StaticIcon:P.Fallback,animatedIcon:void 0,staticIcon:e,isConfigMissing:!0,frameCount:0,firstFrame:0,forceAnimateOnHover:!1}}_getState(e,t,s,i,o,n){return{desiredComponentType:e,animatedIcon:s,staticIcon:i,isConfigMissing:!1,frameCount:o||0,firstFrame:n||0,forceAnimateOnHover:t}}_buildState(e,t){const s=d.default.getEmoticonByName(e.emoticonName),o=!i.isUndefined(s)&&s.frameCount>1;if(e.nonDefaultRenderMode===T.FallbackTextOnly)return this._getState(P.Fallback,o);if(!s)return f.default.triggerEmoticonInfoFetch(e.emoticonName),this._getMissingConfigState();const n=this._getEmoticonInfo(e,S.EmoticonType.Animated,s),a=this._getEmoticonInfo(e,S.EmoticonType.Static,s);let l=u.default.requestEmoticon((0,c.getUrl)(n),n).result;(null==l?void 0:l.type)!==S.ResultIconType.Final&&(l=void 0);const h=u.default.requestEmoticon((0,c.getUrl)(a),a).result;let p;const g=s.frameCount,m=(s.firstFrame||0)%g;if(e.nonDefaultRenderMode===T.StaticOnly)p=this._getState(P.StaticIcon,o,l,h,g,m);else{p=s.frameCount>1&&r.default.canAnimate(this._componentId)?this._getState(P.AnimatedIcon,o,l,h,g,m):this._getState(P.StaticIcon,o,l,h)}return Object.assign({desiredAnimatedIcon:n,desiredStaticIcon:a},p)}render(){const e=w(this.props.renderSize?this.props.renderSize:this.props.size);let s,i,r;if(this.state.isConfigMissing&&p.log(h.LogTraceArea.AnimatedEmoticon,`EmoticonInfo not present for ${this.props.innerText}`),(this.state.desiredComponentType===P.AnimatedIcon||this.state.forceAnimate)&&this.state.animatedIcon){const t=(0,c.getUrl)(this.state.animatedIcon.icon),a=this.state.staticIcon?(0,c.getUrl)(this.state.staticIcon.icon):(0,c.getEmoticonUrl)(this.props.emoticonName,this.props.size,!0,this.props.tone),l=y.getPixelSize(this.props.size);i=k.Animated,r=t,s=n.createElement(o.default,{style:e.image,originalWidth:l,originalHeight:l,url:t,staticUrl:a,name:this.props.emoticonName,firstFrame:this.state.firstFrame,sourceFramesCount:this.state.frameCount,synchronized:!this.props.standaloneAnimation,zoomHint:this.props.zoomHint,tooltip:this.props.innerText})}else if(this.state.desiredComponentType!==P.Fallback&&this.state.staticIcon){const t=(0,c.getUrl)(this.state.staticIcon.icon);i=this.props.nonDefaultRenderMode!==T.StaticOnly||this.state.forceAnimate?k.FallbackImage:k.Image,r=t,s=n.createElement(n.Image,{style:e.image,title:this.props.innerText,source:t,resizeMode:"cover"})}else{if(this.props.nonDefaultRenderMode===T.FallbackTextOnly||this.props.fallback&&this.props.fallback.type===M.FallbackText)return this.state.desiredComponentType!==P.Fallback?p.log(h.LogTraceArea.AnimatedEmoticon,`Rendering text fallback as image is not prefetched: ${this.props.emoticonName} (size: ${this.props.size})`):this.props.nonDefaultRenderMode===T.FallbackTextOnly&&p.log(h.LogTraceArea.AnimatedEmoticon,`Permanent Rendering fallback text for emoticon as required by renderMode prop - ${this.props.innerText}`),this._renderFallbackText(e);this.props.fallback&&this.props.fallback.type===M.Placeholder?(i=k.Placeholder,r="N/A",s=this._renderPlaceholder(e)):(i=k.Empty,r="N/A",s=null)}p.log(h.LogTraceArea.AnimatedEmoticon,k[i]+` emoticon - emoticon: ${this.props.emoticonName} - url ${r}`);const a=[e.image];return this.props.style&&a.push(this.props.style),i===k.Animated&&a.push(t.Styles.animatedTransform),this.state.forceAnimate&&this.props.onHoverAfterBodyEmoticonStyle&&a.push(this.props.onHoverAfterBodyEmoticonStyle),n.createElement(n.View,{style:a,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave,importantForAccessibility:this.props.importantForAccessibility},n.createElement(n.Text,{style:t.Styles.innerTextTransparent,selectable:!this.props.preventSelectable,importantForAccessibility:this.props.preventSelectable?n.Types.ImportantForAccessibility.NoHideDescendants:void 0},this.props.description||this.props.innerText),s,this.props.children)}_renderPlaceholder(e){p.log(h.LogTraceArea.AnimatedEmoticon,`Rendering placeholder view ${this.props.emoticonName}`);let s=[t.Styles.placeholderBackground,e.placeholder];return this.props.fallback&&this.props.fallback.placeholderStyle&&s.push(this.props.fallback.placeholderStyle),n.createElement(n.View,{style:s,title:this.props.innerText,importantForAccessibility:n.Types.ImportantForAccessibility.No})}_renderFallbackText(e){const t=[v.default.transparentBackground,e.fallbackTextContainer,this._useDarkTheme()?this._themeStyles.secondaryTextColorStyle:this._themeStyles.primaryTextColorStyle];return this.props.fallback&&this.props.fallback.fallbackTextStyle&&t.push(this.props.fallback.fallbackTextStyle),n.createElement(C.BodyText,{style:t,selectable:!this.props.preventSelectable},this.props.emoticonName)}}t.AnimatedEmoticonV2=A,A._emoticonRefCount=0},14353:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(98278),r=s(67121),a=s(25793),l=s(46096),d=s(36237),c=s(15877),h=s(33754),u=s(6658),p=s(30124),g=s(86045),m=s(4057),S=s(22222),f=s(81760),y=s(40363),_=s(19675),v=s(24576),C=(s(12770),s(72758));var b;!function(e){e[e.None=0]="None",e[e.Primary=1]="Primary",e[e.Secondary=2]="Secondary"}(b||(b={}));const T=(0,c.lazyProperties)({container:()=>o.Styles.createViewStyle({maxWidth:u.maxStreamContentWidth,alignItems:"center",justifyContent:"center",marginHorizontal:10,flex:1,marginVertical:10,minHeight:100}),containerComposite:()=>o.Styles.createViewStyle({marginLeft:50,marginRight:50}),button:()=>o.Styles.createButtonStyle({marginTop:10}),secondaryButton:()=>o.Styles.createButtonStyle({marginRight:10}),text:()=>o.Styles.createTextStyle({marginHorizontal:60,textAlign:"center"}),buddyName:()=>o.Styles.createTextStyle({fontWeight:"bold"}),row:()=>o.Styles.createViewStyle({flexDirection:"row"})}),M={dark:{backgroundColor:f.Color.gray400,textColor:f.Color.white,borderColor:f.Color.white},light:{backgroundColor:f.Color.white,textColor:f.Color.gray400,borderColor:f.Color.gray400}};class I extends v.default{constructor(){super(...arguments),this._renderers={},this._failureRenderers={},this._renderConversationEnded=()=>[this._renderTextLine("E2eeHandshakeControl.PrivateConversationEndedTitle",!0),this._renderTextLine("E2eeHandshakeControl.PrivateConversationEndedCaption",!1),o.createElement(S.default,Object.assign({},this._getPrimaryButtonConfig(),{key:"inviteButton",ref:this._onInitialButtonRef,onPress:this._invite,title:h.getString("E2eeHandshakeControl.SendNewInviteButton"),buttonSize:n.SXButtonSize.Medium,showActivityIndicator:this.state.busyButton===b.Primary}))],this._renderExpiredState=()=>[this._renderTextLine("E2eeHandshakeControl.InvitationExpiredTitle",!0),this._renderTextLine("E2eeHandshakeControl.InvitationExpiredCaption",!1),o.createElement(S.default,Object.assign({},this._getPrimaryButtonConfig(),{key:"inviteButton",ref:this._onInitialButtonRef,onPress:this._invite,title:h.getString("E2eeHandshakeControl.SendNewInviteButton"),buttonSize:n.SXButtonSize.Medium,showActivityIndicator:this.state.busyButton===b.Primary}))],this._renderSwitch=()=>[this._renderTextLine("E2eeHandshakeControl.SwitchDeviceTitle",!0),this._renderTextLine("E2eeHandshakeControl.SwitchDeviceCaption",!1),o.createElement(S.default,Object.assign({},this._getPrimaryButtonConfig(),{key:"inviteButton",onPress:this._sendInviteFromSwitch,ref:this._onInitialButtonRef,title:h.getString("E2eeHandshakeControl.SwitchDeviceButton"),buttonSize:n.SXButtonSize.Medium,showActivityIndicator:this.state.busyButton===b.Primary}))],this._renderAcceptInvite=()=>[this._renderTextLine("E2eeHandshakeControl.IncomingInvitationTitle",!0),this._renderTextLine("E2eeHandshakeControl.IncomingInvitationCaption",!1),o.createElement(o.View,{key:"acceptButtonsRow",style:T.row},o.createElement(S.default,Object.assign({},this._getSecondaryButtonConfig(),{key:"rejectButton",ref:this._onInitialButtonRef,onPress:this._declineInvitation,title:h.getString("E2eeHandshakeControl.DeclineButton"),buttonSize:n.SXButtonSize.Medium,showActivityIndicator:this.state.busyButton===b.Secondary})),o.createElement(S.default,Object.assign({},this._getPrimaryButtonConfig(),{key:"acceptButton",onPress:this._acceptInvite,title:h.getString("E2eeHandshakeControl.IncomingInvitationButton"),buttonSize:n.SXButtonSize.Medium,showActivityIndicator:this.state.busyButton===b.Primary})))],this._renderConfirmAcceptance=()=>[this._renderTextLine("E2eeHandshakeControl.GotAcceptTitle",!0),this._renderTextLine("E2eeHandshakeControl.GotAcceptCaption",!1),o.createElement(S.default,Object.assign({},this._getPrimaryButtonConfig(),{key:"confirmButton",ref:this._onInitialButtonRef,onPress:this._confirm,title:h.getString("E2eeHandshakeControl.ConfirmButton"),buttonSize:n.SXButtonSize.Medium,showActivityIndicator:this.state.busyButton===b.Primary}))],this._renderAcceptSwitch=()=>[this._renderTextLine("E2eeHandshakeControl.OtherPartySwitchedTitle",!0),this._renderTextLine("E2eeHandshakeControl.OtherPartySwitchedCaption",!1),o.createElement(o.View,{key:"acceptButtonsRow",style:T.row},o.createElement(S.default,Object.assign({},this._getSecondaryButtonConfig(),{key:"rejectButton",ref:this._onInitialButtonRef,onPress:this._declineSwitch,title:h.getString("E2eeHandshakeControl.DeclineButton"),buttonSize:n.SXButtonSize.Medium,showActivityIndicator:this.state.busyButton===b.Secondary})),o.createElement(S.default,Object.assign({},this._getPrimaryButtonConfig(),{key:"acceptButton",onPress:this._acceptSwitch,title:h.getString("E2eeHandshakeControl.IncomingInvitationButton"),buttonSize:n.SXButtonSize.Medium,showActivityIndicator:this.state.busyButton===b.Primary})))],this._renderInviteSent=()=>{const e="E2eeHandshakeControl.OutgoingInvitationTitle",t="E2eeHandshakeControl.OutgoingInvitationCaption";if(y.default.isElectronOsx()){const s=i.join([h.getString(e),i.join(h.getParts(t,{buddy:this.state.buddyName}),"")],".");return[this._renderFocusableTextLine(e,!0,!1,e,s),this._renderTextLine(t,!1)]}return[this._renderTextLine(e,!0,!1),this._renderTextLine(t,!1)]},this._renderRejectAcceptance=()=>{const e="E2eeHandshakeControl.SentAcceptTitle",t="E2eeHandshakeControl.SentAcceptCaption";if(y.default.isElectronOsx()){const s=i.join([h.getString(e),i.join(h.getParts(t,{buddy:this.state.buddyName}),"")],".");return[this._renderFocusableTextLine(e,!0,!1,e,s),this._renderTextLine(t,!1)]}return[this._renderTextLine(e,!0,!1),this._renderTextLine(t,!1)]},this._renderDeviceSwitched=()=>{const e="E2eeHandshakeControl.DeviceSwitchedTitle",t="E2eeHandshakeControl.DeviceSwitchedCaption";if(y.default.isElectronOsx()){const s=i.join([h.getString(e),i.join(h.getParts(t,{buddy:this.state.buddyName}),"")],".");return[this._renderFocusableTextLine(e,!0,!1,e,s),this._renderTextLine(t,!1)]}return[this._renderTextLine(e,!0,!1),this._renderTextLine(t,!1)]},this._renderBuddyName=()=>o.createElement(o.Text,{key:"buddyName",style:T.buddyName},this.state.buddyName),this._renderOutgoingInvitationFailed=()=>this._renderStateWithTryAgainButton("E2eeHandshakeControl.OutgoingInvitationFailedTitle",this._invite),this._renderSwitchDeviceFailed=()=>this._renderStateWithTryAgainButton("E2eeHandshakeControl.SwitchDeviceFailedTitle",this._sendInviteFromSwitch),this._renderAcceptanceFailed=()=>this.state.lastFailingAction===b.Primary?this._renderStateWithTryAgainButton("E2eeHandshakeControl.AcceptanceFailedTitle",this._acceptInvite):this._renderStateWithTryAgainButton("E2eeHandshakeControl.InviteDeclinationFailedTitle",this._declineInvitation),this._renderConfirmationFailed=()=>this._renderStateWithTryAgainButton("E2eeHandshakeControl.ConfirmationFailedTitle",this._confirm),this._renderSwitchAcceptanceFailed=()=>this.state.lastFailingAction===b.Primary?this._renderStateWithTryAgainButton("E2eeHandshakeControl.SwitchAcceptanceFailedTitle",this._acceptSwitch):this._renderStateWithTryAgainButton("E2eeHandshakeControl.SwitchDeclinationFailedTitle",this._declineSwitch),this._onInitialButtonRef=e=>{this._initialComponent=e||void 0},this._onInitialTitleRef=e=>{this._initialComponent=e||void 0},this._onInitialFocusedTitleRef=e=>{this._initialComponent=e||void 0},this._invite=()=>{const e=this._isExpired()?l.E2EEInviteOrigin.InvitationExpire:l.E2EEInviteOrigin.ConversationEnd;this._sendInvite(e,"invite")},this._sendInviteFromSwitch=()=>{this._sendInvite(l.E2EEInviteOrigin.DeviceSwitch,"switch")},this._acceptInvite=()=>{this._performAction(r.default.sendAccept(this.props.conversationId,l.E2EEAcceptOrigin.Invitation),"acceptInvite")},this._acceptSwitch=()=>{this._performAction(r.default.sendAccept(this.props.conversationId,l.E2EEAcceptOrigin.DeviceSwitch),"acceptSwitch")},this._confirm=()=>{this._performAction(r.default.sendConfirm(this.props.conversationId),"confirm")},this._declineInvitation=()=>{this._performAction(r.default.sendReject(this.props.conversationId,l.E2EERejectionReason.InvitationDeclining),"declineInvitation",b.Secondary)},this._declineSwitch=()=>{this._performAction(r.default.sendReject(this.props.conversationId,l.E2EERejectionReason.DeviceSwitchDeclining),"declineSwitch",b.Secondary)}}_buildState(e,t){const s=this.props,i=C.default.getFullUserProfileByMri(a.default.getBuddyAddress(e.e2eeHandshake).mri),o={isUsingStackNavigationContext:p.default.isUsingStackNavigationContext(),buddyName:i.firstName||i.getDisplayName()};return t?(this._renderers[a.SecureHandshakeState.None]=this._renderConversationEnded,this._renderers[a.SecureHandshakeState.OtherEndpointInUse]=this._renderSwitch,this._renderers[a.SecureHandshakeState.SentInvite]=this._renderInviteSent,this._renderers[a.SecureHandshakeState.GotInvite]=this._renderAcceptInvite,this._renderers[a.SecureHandshakeState.SentAccept]=this._renderRejectAcceptance,this._renderers[a.SecureHandshakeState.GotAccept]=this._renderConfirmAcceptance,this._renderers[a.SecureHandshakeState.SentSwitch]=this._renderDeviceSwitched,this._renderers[a.SecureHandshakeState.GotSwitch]=this._renderAcceptSwitch,this._failureRenderers[a.SecureHandshakeState.None]=this._renderOutgoingInvitationFailed,this._failureRenderers[a.SecureHandshakeState.OtherEndpointInUse]=this._renderSwitchDeviceFailed,this._failureRenderers[a.SecureHandshakeState.GotInvite]=this._renderAcceptanceFailed,this._failureRenderers[a.SecureHandshakeState.GotAccept]=this._renderConfirmationFailed,this._failureRenderers[a.SecureHandshakeState.GotSwitch]=this._renderSwitchAcceptanceFailed,o.lastFailingAction=b.None,o.busyButton=b.None):s.e2eeHandshakeState!==e.e2eeHandshakeState&&(o.lastFailingAction=b.None,o.busyButton=b.None),o}componentDidMount(){super.componentDidMount();(()=>{this.isComponentMounted()&&this._initialComponent&&this._initialComponent.requestFocus()})()}render(){const e=[T.container];let t;return t=this._isExpired()?this.state.lastFailingAction===b.None?this._renderExpiredState:this._renderOutgoingInvitationFailed:this.state.lastFailingAction===b.None?this._renderers[this.props.e2eeHandshakeState]:this._failureRenderers[this.props.e2eeHandshakeState],this.state.isUsingStackNavigationContext||this._getContext().isPresentedInDesktopSubview||e.push(T.containerComposite),o.createElement(o.View,{key:"E2eeHandshakeControl",style:e},t())}_isExpired(){return this.props.e2eeHandshakeState!==a.SecureHandshakeState.None&&this.props.e2eeHandshakeState!==a.SecureHandshakeState.OtherEndpointInUse&&this.props.e2eeHandshakeState!==a.SecureHandshakeState.Completed&&Date.now()>Date.parse(this.props.e2eeHandshake.ValidTill)+6e4}_renderTextLine(e,t,s=!1){const i=t?_.RowTitle:_.Caption;return o.createElement(i,{key:e,ref:s?this._onInitialTitleRef:void 0,style:T.text,textThemeColor:_.TextThemeColor.Primary},h.getParts(e,{buddy:this._renderBuddyName()}))}_renderFocusableTextLine(e,t,s,i,n){return o.createElement(o.View,{key:"focused_"+e,ref:this._onInitialFocusedTitleRef,tabIndex:0,importantForAccessibility:o.Types.ImportantForAccessibility.Auto,accessibilityLabel:n||h.getString(i)},this._renderTextLine(e,t,s))}_renderStateWithTryAgainButton(e,t){return[this._renderTextLine(e,!0),o.createElement(S.default,Object.assign({},this._getPrimaryButtonConfig(),{key:"tryAgainButton",ref:this._onInitialButtonRef,onPress:t,title:h.getString("E2eeHandshakeControl.TryAgainButton"),buttonSize:n.SXButtonSize.Medium,showActivityIndicator:this.state.busyButton===b.Primary}))]}_getPrimaryButtonConfig(){return{buttonStyle:this._useDarkTheme()?n.SXButtonStyle.LightFill:n.SXButtonStyle.DarkFill,style:T.button}}_getSecondaryButtonConfig(){return{buttonStyle:n.SXButtonStyle.Custom,buttonConfig:this._useDarkTheme()?M.dark:M.light,style:[T.button,T.secondaryButton]}}_sendInvite(e,t){const s=a.default.getBuddyAddress(this.props.e2eeHandshake).mri;g.default.maybeAnnounceForAccessibility(h.getString("ContentToDisplayTransformerBase.E2eeInvitationSent",{BParty:this.state.buddyName})),this._performAction(r.default.sendInvite(s,e),t)}_performAction(e,t,s=b.Primary){this.setState({busyButton:s});let i=this.state.lastFailingAction;e.catch((e=>{d.warn(l.LogTraceArea.E2EEncryption,'Failed to perform "'+t+'". Error: '+m.default.errorAsString(e)),i=s})).finally((()=>{this.isComponentMounted()&&this.setState({busyButton:b.None,lastFailingAction:i})}))}}t.default=I},74822:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(71830),n=s(98278),r=s(31761),a=s(46096),l=s(91771),d=s(36237),c=s(33754),h=s(51072),u=s(71639),p=s(6658),g=s(95691),m=s(10541),S=s(22222),f=s(24576);class y extends f.default{constructor(){super(...arguments),this._onPress=()=>{d.track(new l.InviteMorePeopleButtonClickedEvent(this.props.origin));new r.default({convId:o.asSkypeThreadIdMaybe(this.props.conversationId),navigationOrigin:a.NavigationConversationOrigin.InviteMorePeopleAfterJoinButton,peopleType:m.PeopleType.AllExcludingBots,filterPeopleType:m.FilterType.GroupCapable,wizardSteps:[g.WizardSteps.setConvParticipants]}).start(this._getRootViewId())}}render(){let e=n.SXButtonSize.Medium;this.props.messageStreamFontSize!==p.MessageStreamFontSize.Normal&&(u.isFontLarge(this.props.messageStreamFontSize)?e=n.SXButtonSize.Large:u.isFontSmall(this.props.messageStreamFontSize)&&(e=n.SXButtonSize.Small));const t=i.createElement(S.default,{buttonStyle:n.SXButtonStyle.ColorFill,buttonSize:e,title:c.getString("MessageStream.InviteMorePeople"),onPress:void 0,importantForAccessibility:i.Types.ImportantForAccessibility.NoHideDescendants,tabIndex:-1,style:this.props.style});return i.createElement(h.default.View,{onPress:this._onPress,keepOriginalProps:!0,accessibilityLabel:c.getString("MessageStream.InviteMorePeople"),accessibilityTraits:i.Types.AccessibilityTrait.Button},t)}}t.default=y},31894:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(77605),n=s(75760),r=s(13944),a=s(15877),l=s(33754),d=s(89808),c=s(30124),h=s(81760),u=s(11828),p=s(60305),g=s(24576),m=(0,a.lazyProperties)({button:()=>i.Styles.createViewStyle({width:u.IconSize.size40,height:u.IconSize.size40,borderWidth:1,borderRadius:u.IconSize.size30,borderColor:h.Color.blackOverlay10,justifyContent:"center",alignItems:"center",opacity:.9,overflow:"visible"}),hovered:()=>i.Styles.createViewStyle({opacity:1}),container:()=>i.Styles.createViewStyle({position:"absolute",right:5,bottom:10,width:u.IconSize.default,height:u.IconSize.default,overflow:"visible"}),containerDesktop:()=>i.Styles.createViewStyle({bottom:0,right:13,width:u.IconSize.default,height:u.IconSize.default,alignItems:"center"}),badgeStyle:()=>i.Styles.createViewStyle({flex:0,position:"absolute",top:-6,bottom:-6,overflow:"visible",alignItems:"center",alignSelf:"flex-start"})});class S extends g.default{constructor(){super(...arguments),this._onPress=()=>{this.props.onPressCallback(this.state.unreadCount)}}_buildState(e,t){const s=n.default.getMessageCountsForConversation(e.conversationId);return{visible:!t&&this.state.visible,gradientColors:d.default.getSubtleGradientColors(),unreadCount:s.unreadCount,unreadCountOverflowed:s.unreadCountOverflowed,useColorBadge:!!s.highPriorityUnreadCount,useDesktopStyles:!c.default.isUsingStackNavigationContext()&&!p.default.useTabletUI()}}render(){if(!this.state.visible)return null;const e=[m.button,this._themeStyles.buttonBackgroundColorStyle],t=i.createElement(r.default,{style:e,hoverStyle:m.hovered,size:u.IconSize.size20,onPress:this._onPress,color:this._themeColors.headerIconColor,hoverColor:this._themeColors.headerIconColor,icon:u.SkypeIcon.DownChevron,title:l.getString("MessageStream.JumpToLast")});let s;if(this.state.unreadCount>0){let e=this.state.unreadCount.toString();this.state.unreadCountOverflowed&&(e=l.getString("Global.CountOverflow",{count:e}));const t=!this._useAccessibleTheme()&&this.state.useColorBadge?this.state.gradientColors:void 0;s=i.createElement(o.default,{count:e,rawCount:this.state.unreadCount,badgeSize:o.BadgeSize.Desktop,style:m.badgeStyle,gradientColors:t,fixedSize:!0})}const n=[m.container];return this.props.horizontalPadding&&this.props.horizontalPadding.right&&n.push(i.Styles.createViewStyle({right:this.props.horizontalPadding.right+5},!1)),this.state.useDesktopStyles&&n.push(m.containerDesktop),i.createElement(i.View,{style:n},t,s)}setVisible(e){this.isComponentMounted()&&this.state.visible!==e&&this.setState({visible:e})}}t.default=S},67806:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItem=void 0;const i=s(96486),o=s(16778),n=s(34828),r=s(89391),a=s(51077),l=s(71830),d=s(87399),c=s(39549),h=s(99686),u=s(86374),p=s(29206),g=s(63032),m=s(75043),S=s(50513),f=s(46929),y=s(18078),_=s(32226),v=s(29130),C=s(36150),b=s(73970),T=s(24576),M=s(18037),I=s(12770),w=s(77878);class P extends T.default{constructor(){super(...arguments),this.onToggleTranslation=()=>{this.setState({showTranslatedMessage:!this.state.showTranslatedMessage})},this._onStreamItemViewRef=e=>this._streamItemViewRef=e||void 0}_buildState(e,t){const{sendingLieMaxDuration:s,enableParsingHtmlMessages:i}=r.default.getS4LMessagingFeatures(),o=this.props;let n;(t||o.message!==e.message||this.state.parseHtmlMessages!==i)&&(this._decodedNode=u.decode(e.message),this._decodedNode=(0,w.transformUnicodeEmojis)(this._decodedNode));const b=e.message.isBookmark();if(b){const t=a.getBookmarkMetadata(e.message.properties);t&&(n=t.bookmarkSourceCreatorId)}const T=b&&n?y.default.isMyMri(n):!e.message.isEphemeral()&&y.default.isMyMri(e.message.creator),P=C.default.isMobileScreenReaderEnabled(),k=(0,c.default)().getConversation(e.message.conversationId),A=!!k&&k.isModerated()&&k.isAdmin(y.default.getSkypeMri()),E=this._getRootViewId(),R={skypeMessage:e.message,decodedNode:this._decodedNode,isReadOnly:e.isReadOnly,hasUnderlay:!1,containerMaxDimensions:e.containerInitialDimensions,layoutWidth:v.default.getWidth(E),isConversationAccepted:e.isConversationAccepted,isConversationBlocked:d.isConversationBlocked(e.message.conversationId),isConversationWithBot:l.isAgent(e.message.conversationId),postedByBot:l.isAgent(e.message.creator),postedByCurrentUser:T,isCurrentUserActive:h.default.isCurrentUserActive(),renderOrigin:e.renderOrigin,messageFirstInGroup:e.isFirstInGroup,messageLastInGroup:e.isLastInGroup,isLastMessage:e.isLastMessage,isLastPhotoByCurrentUser:e.isLastPhotoByCurrentUser,disableReactions:e.disableReactions,disableForward:e.disableForward,disableMarkUnread:e.disableMarkUnread,isReportEnabled:r.default.getS4LMessagingFeatures().enableReportMessage&&!e.disableReportMessage,isLocationCardOnDesktopEnabled:r.default.getS4LMessagingFeatures().enableLocationCardOnDesktop,isSelectMultipleMessagesEnabled:!e.disableSelectMultipleMessages,screenReaderEnabled:P,isModerator:A,isDisplayUrlPreviewsEnabled:f.default.getDisplayUrlPreviews(),themeStyles:this._themeStyles,themeColors:this._themeColors,colorTheme:this._currentTheme,flipBubbleColors:M.default.flipBubbleColors(),hasTranslation:e.isTranslatedConversation&&m.default.hasTranslatedMessage(e.message.conversationId,e.message.cuid)},L=p.getMessageRenderingOptions(R),{enableNoNetworkInfoOnSendingMessage:F}=r.default.getS4LMessagingFeatures();let x,O;if(e.searchStore){const t=e.searchStore.getSearchQuery();t&&(O=t.messageId,x=t.query)}const D={renderingOptions:L,isMobileScreenReaderEnabled:P,postedByCurrentUser:T,rawSearchQuery:x,enableNoNetworkInfoOnSendingMessage:F,isSelectedMessage:O===e.message.cuid,hasTranslation:!!R.hasTranslation,showTranslatedMessage:!y.default.isMyMri(e.message.creator),hasConnectivity:_.default.getConnectionStatus()!==_.ConnectionStatus.DisconnectedNoNetworkingReported,parseHtmlMessages:i},B=L.messageViewRenderingOptions.sendingStatus===g.MessageRenderSendingStatus.Sending;if(t){D.focusMessageViewForMobileScreenReader=!1,D.sendingLieTimerIsRunning=!1;const t=s-(Date.now()-e.message.createdTime);e.canPretendBeingSent&&B&&t>0&&(D.sendingLieTimerIsRunning=!0,this._sendingLieTimer=I.default.setTimeout((()=>{this._sendingLieTimer=void 0,this.isComponentMounted()&&this.setState({sendingLieTimerIsRunning:!1})}),t))}else!B&&this._sendingLieTimer&&(I.default.clearTimeout(this._sendingLieTimer),this._sendingLieTimer=void 0,D.sendingLieTimerIsRunning=!1);if(r.default.getS4LCMCFeatures().enableMessageTranslation&&D.hasTranslation&&a.hasQuote(e.message.content)){u.decode(e.message).getQuoteNodes().forEach((t=>{t&&t.cuid&&!m.default.hasTranslatedMessage(e.message.conversationId,t.cuid)&&S.default.maybeRequestTranslation(e.message.conversationId,t.cuid,void 0,t.children)}))}return D}componentDidMount(){super.componentDidMount(),this.props.onMountItem&&this.props.onMountItem(this,this.props.focusStreamItemForMobileScreenReader)}componentWillUnmount(){super.componentWillUnmount(),this._sendingLieTimer&&(I.default.clearTimeout(this._sendingLieTimer),this._sendingLieTimer=void 0)}focusItemForScreenReader(){this.isComponentMounted()&&this.setState({focusMessageViewForMobileScreenReader:!0})}render(){let e=this.state.renderingOptions.messageViewRenderingOptions;e.sendingStatus===g.MessageRenderSendingStatus.Sending&&(!this.state.hasConnectivity&&this.state.enableNoNetworkInfoOnSendingMessage?e=i.assign({},e,{sendingStatus:g.MessageRenderSendingStatus.NoNetwork}):this.state.sendingLieTimerIsRunning&&(e=i.assign({},e,{sendingStatus:g.MessageRenderSendingStatus.None})));let t=null;if(this.state.renderingOptions.renderOnlyUrlPreview||(t=o.createElement(n.Types.VirtualListCellContext.Consumer,null,(t=>o.createElement(b.StreamItemView,{key:"message-view"+this.props.message.cuid,ref:this._onStreamItemViewRef,message:this.props.message,rawSearchQuery:this.state.rawSearchQuery,isSelectedMessage:this.state.isSelectedMessage,decodedNode:this._decodedNode,postedByCurrentUser:this.state.postedByCurrentUser,renderOrigin:this.props.renderOrigin,ignoreProcessing:!1,screenReaderEnabled:this.state.isMobileScreenReaderEnabled,viewRenderingOptions:e,messageActions:this.state.renderingOptions.messageActions,suggestedTextHighlights:this.state.suggestedTextHighlights,onQuote:this.props.onQuote,onEdit:this.props.onEdit,onItemPress:this.props.onItemPress,onLayout:this.props.onLayout,onMarkAsUnread:this.props.onMarkAsUnread,onDisableScroll:this.props.onDisableScroll,onMountContent:this.props.onMountContent,onCopyContextMenu:this.props.onCopyContextMenu,onQuoteSelectionContextMenu:this.props.onQuoteSelectionContextMenu,isSelectMessagesModeActive:this.props.isSelectMessagesModeActive,shouldScreenReaderFocusItem:this.state.focusMessageViewForMobileScreenReader,getRootWindowComponent:this.props.getRootWindowComponent,messageStreamFontSize:this.props.messageStreamFontSize,linkedMessages:this.props.linkedMessages,hasTranslation:this.state.hasTranslation,onToggleTranslation:this.onToggleTranslation,showTranslatedMessage:this.state.showTranslatedMessage,searchStore:this.props.searchStore,onListItemDetails:t.onListItemDetails})))),!i.isEmpty(this.state.renderingOptions.urlPreviewRenderInformation)){const e=i.map(this.state.renderingOptions.urlPreviewRenderInformation,((e,t)=>{const s=e.urlPreviewData.url+t;return o.createElement(n.Types.VirtualListCellContext.Consumer,null,(t=>o.createElement(b.StreamItemView,{key:s,urlPreviewId:s,message:this.props.message,rawSearchQuery:this.state.rawSearchQuery,isSelectedMessage:this.state.isSelectedMessage,decodedNode:this._decodedNode,postedByCurrentUser:this.state.postedByCurrentUser,renderOrigin:this.props.renderOrigin,ignoreProcessing:!0,urlPreviewOnly:this.state.renderingOptions.renderOnlyUrlPreview,urlPreviewData:e.urlPreviewData,viewRenderingOptions:e.viewRenderOptions,messageActions:e.urlPreviewActions,suggestedTextHighlights:this.state.suggestedTextHighlights,screenReaderEnabled:this.state.isMobileScreenReaderEnabled,onQuote:this.props.onQuote,onEdit:this.props.onEdit,onItemPress:this.props.onItemPress,onLayout:this.props.onLayout,onMarkAsUnread:this.props.onMarkAsUnread,onDisableScroll:this.props.onDisableScroll,onMountContent:this.props.onMountContent,isSelectMessagesModeActive:this.props.isSelectMessagesModeActive,getRootWindowComponent:this.props.getRootWindowComponent,messageStreamFontSize:this.props.messageStreamFontSize,searchStore:this.props.searchStore,onListItemDetails:t.onListItemDetails})))}));t=o.createElement(o.View,null,t,e)}return t}copySelection(e){if(this._streamItemViewRef)return this._streamItemViewRef.copySelection(e)}quoteSelection(){if(this._streamItemViewRef)return this._streamItemViewRef.quoteSelection()}}t.StreamItem=P},76214:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItemAccessory=t.AccessoryWidth=void 0;const i=s(96486),o=s(16778),n=s(44770),r=s(89391),a=s(19061),l=s(51077),d=s(71830),c=s(62602),h=s(39285),u=s(13944),p=s(10117),g=s(15877),m=s(47662),S=s(33754),f=s(63032),y=s(18078),_=s(4735),v=s(72828),C=s(750),b=s(81760),T=s(11828),M=s(24576),I=s(72758);t.AccessoryWidth=44;const w=(0,g.lazyProperties)({sendingIndicator:()=>o.Styles.createViewStyle({height:20,width:20}),sendingIndicatorDark:()=>o.Styles.createViewStyle({opacity:.5}),statusItemContainer:()=>o.Styles.createViewStyle({flex:1,flexDirection:"row",alignSelf:"center",alignItems:"center",justifyContent:"flex-start",paddingHorizontal:8,width:t.AccessoryWidth}),statusItemContainerSender:()=>o.Styles.createViewStyle({justifyContent:"flex-end"}),outerButtonReceiver:()=>o.Styles.createViewStyle({paddingLeft:8,paddingRight:20,paddingBottom:4,paddingTop:2,width:t.AccessoryWidth}),outerButtonSender:()=>o.Styles.createViewStyle({paddingRight:8,paddingLeft:20}),outerButtonHeightSingle:()=>o.Styles.createViewStyle({height:39}),outerButtonContainer:()=>o.Styles.createViewStyle({alignItems:"flex-end"}),forwardButtonPaddingTopCorrection:()=>o.Styles.createViewStyle({paddingTop:8,marginTop:2}),forwardButtonAlignment:()=>o.Styles.createViewStyle({justifyContent:"flex-start"}),goToOriginalMessageButton:()=>o.Styles.createViewStyle({flexGrow:1,flexDirection:"column",minWidth:48}),goToOriginalMessageIcon:()=>o.Styles.createViewStyle({justifyContent:"flex-end",alignItems:"flex-end",alignSelf:"flex-end"}),flexGrow:()=>o.Styles.createViewStyle({flexGrow:1,alignItems:"stretch"})});class P extends M.default{constructor(){super(...arguments),this._onForwardKeyPress=e=>c.default.maybeHandleKeyPress(e,this._onForward),this._onForward=()=>{!this.props.disableActions&&this.props.onCommandSelected&&this.props.onCommandSelected(C.CommandTypes[C.CommandTypes.Forward])},this._onNavigateToBookmarkSource=()=>{_.default.navigateToBookmarkSource(this.props.message().properties)}}render(){const e=this._getMessageStatusView(),t=this.props.showOuterButtons?this._getOuterButtons(!!e):void 0;if(!e&&i.isUndefined(t))return null;const s=[w.outerButtonContainer,this.props.message().isBookmark()?w.flexGrow:void 0];return this.props.paddingStyle&&s.push(this.props.paddingStyle),o.createElement(o.Animated.View,{key:"accessoryContainer",style:[s,this.props.containerAnimationStyle]},t,e)}_getOuterButtons(e){const t=this._themeColors.secondaryTextColor,s=this.props.commands&&this.props.commands.indexOf(C.CommandTypes.AddReaction)>=0,i=y.default.isMyMri(this.props.creator);let n,l,d;if(!this.props.disableActions&&this.props.commands&&this.props.commands.indexOf(C.CommandTypes.Forward)>=0&&a.default.canForwardMessage()){let e=[w.outerButtonReceiver,w.outerButtonHeightSingle,w.forwardButtonAlignment,i?w.outerButtonSender:void 0];s&&e.push(w.forwardButtonPaddingTopCorrection);const{enableForwardItemIconForStreamItems:a}=r.default.getS4LMessagingFeaturesNoSubscription(),l=a?T.SkypeIcon.ForwardItem:T.SkypeIcon.Send;n=o.createElement(u.default,{key:"forward-button",color:t,hoverColor:t,icon:l,title:S.getString("StreamItem.ActionForward"),onPress:this._onForward,onKeyPress:this._onForwardKeyPress,size:T.IconSize.size16,style:e,flipIcon:this._getContext().isRTL,showHoverEffect:!0})}if(s){const s=[w.outerButtonReceiver,i?w.outerButtonSender:void 0];n||e||s.push(w.outerButtonHeightSingle),l=o.createElement(v.default,{key:"reaction-icon-button",message:this.props.message,isMessageKnownByServer:this.props.isMessageKnownByServer,colorOverride:t,sizeOverride:T.IconSize.size16,style:s,disableAction:this.props.disableActions,anchorOffset:-6})}return this.props.message().isBookmark()&&(d=o.createElement(u.default,{key:"chevron-button",color:t,hoverColor:t,icon:T.SkypeIcon.RightChevron,title:S.getString("BookmarksConversation.GoToOriginalMessageButtonTitle"),onPress:this._onNavigateToBookmarkSource,size:T.IconSize.size16,style:w.goToOriginalMessageButton,flipIcon:this._getContext().isRTL,showHoverEffect:!0,iconTextStyle:w.goToOriginalMessageIcon})),l||(n||d?o.createElement(o.View,{style:w.flexGrow},l,n,d):void 0)}_getMessageStatusView(){let e;const t=l.isMessageSms(this.props.messagetype),s=y.default.isMyMri(this.props.creator);if(this.props.showEditIcon||this.props.sendingStatus!==f.MessageRenderSendingStatus.None||t){let i,r;if(this.props.sendingStatus===f.MessageRenderSendingStatus.Failed)r=S.getString("StreamItem.MessageError"),this.props.isConversationAccepted||d.isPhoneMri(this.props.conversationId)||this.props.messagetype!==l.MessageTypes.Media_GenericFile||I.default.getFullUserProfileByMriAsync(this.props.conversationId).then((e=>{if(e){const t=m.getLocalizeParamForGender(e.gender);r=S.getString("StreamItem.FileMessageErrorBeforeFriendshipInvitation",{user:e.getShortName(),gender:t})}})),i=o.createElement(p.default,{icon:T.SkypeIcon.Error,size:T.IconSize.size16,color:b.Color.pink});else if(this.props.showEditIcon)i=o.createElement(p.default,{icon:T.SkypeIcon.Topic,size:T.IconSize.size16,color:b.Color.gray200}),r=S.getString("StreamItem.MessageEdited");else if(t&&s){let e=T.SkypeIcon.MobileSending,t=S.getString("SMSMessaging.SmsSendingStatus"),s=!1;this.props.smsDeliveryStatus&&(l.isSmsDeliveredSuccessfully(this.props.smsDeliveryStatus)?(e=T.SkypeIcon.MobileOk,t=S.getString("SMSMessaging.SmsOkStatus")):(e=T.SkypeIcon.MobileError,t=S.getString("SMSMessaging.SmsErrorStatus"),s=!0)),i=o.createElement(p.default,{icon:e,size:T.IconSize.size16,color:s?b.Color.red:b.Color.gray200}),r=t}else this.props.sendingStatus===f.MessageRenderSendingStatus.Sending?(i=o.createElement(o.Image,{style:[w.sendingIndicator,this._useDarkTheme()?w.sendingIndicatorDark:void 0],source:this._useDarkTheme()?n.Collection.SENDING_INDICATOR_DARK:n.Collection.SENDING_INDICATOR_LIGHT,resizeMode:"contain"}),r=S.getString("StreamItem.Sending")):this.props.sendingStatus===f.MessageRenderSendingStatus.NoNetwork&&(i=o.createElement(p.default,{icon:T.SkypeIcon.Recent,size:T.IconSize.size16,color:b.Color.gray200}),r=S.getString("StreamItem.SendingNoNetwork"));const a=[w.statusItemContainer,s?w.statusItemContainerSender:void 0];e=o.createElement(h.default,{key:"statusIcon",style:a,title:r},i)}return e}}t.StreamItemAccessory=P},46529:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItemCommandManager=void 0;const i=s(96486),o=s(81169),n=s(47204),r=s(33754),a=s(12056),l=s(3709),d=s(750),c=s(93194),h=c.default.menuId();t.StreamItemCommandManager=class{constructor(e){this._onCommandSelected=e}_getAllCommands(e){return i.keyBy(i.compact([l.addReaction(e),l.saveMedia(e),l.saveFileAs(e),l.saveMediaAs(e),l.viewInChat(e),l.editMessage(e),l.quoteMessage(e),l.quoteSelection(e),l.removeMessage(e),l.cancelSendMessage(e),l.cancelEditMessage(e),l.cancelFailedSend(e),l.retryFailedSend(e),l.copyLinkMessage(e),l.copyMessage(e),l.copyImage(e),l.copyLocationMessage(e),l.openFileLocation(e),l.openMediaLocation(e),l.markReadToHere(e),l.forwardMessage(e),l.translateMessage(e),l.bookmarkMessage(e),l.reportMessage(e),l.selectMessages(e),l.viewLink(e),l.cancelScheduledCall(e),l.editScheduledCall(e),l.showReportedMessage(e),l.cancelPoll(e),l.debugDumpMessage(e),l.debugDumpMessagePretty(e)]),(e=>e.command))}onActionMenuOptionSelected(e,t,s){const i=this._getAllCommands(e)[d.CommandTypes[t]];i&&i.onCommandSelected(s)}showActionMenu(e,t,s,n,l,u,p,g){const m=this._getAllCommands(e),S=(0,o.chain)(u,(0,o.sortBy)(i.identity),(0,o.map)((e=>m[e])),(0,o.filter)((e=>!!e&&(!e.isVisible||!!e.isVisible&&e.isVisible())))),f=(0,o.chain)(S,(0,o.map)((e=>e.command)),(0,o.findLastIndex)((e=>d.CommandTypes.Remove===e||d.CommandTypes.CancelFailedSend===e||d.CommandTypes.CancelSend===e||d.CommandTypes.Report===e||d.CommandTypes.CancelScheduledCall===e||d.CommandTypes.CancelPoll===e))),y=i.map(S,(e=>({text:r.getString(e.localizationKey),command:d.CommandTypes[e.command]})));if(!i.isEmpty(y)){const e={anchor:t,useTheme:!0};c.default.showWithOptions({id:h,config:e,getMenuItems:()=>y,handleMenuCommand:e=>this._onCommandSelected(e,{rootViewId:s},a.MessageActionOrigin.StreamItemActionMenu),menuTitle:l,onDismiss:g,destructiveButtonIndex:f,rootViewId:s,invokingEvent:p})}}getSXMenuItems(e,t){const s=this._getAllCommands(e);return(0,o.chain)(t,(0,o.sortBy)(i.identity),(0,o.map)((e=>s[e])),(0,o.filter)((e=>!!e&&(!e.isVisible||!!e.isVisible&&e.isVisible()))),(0,o.map)((e=>({text:r.getString(e.localizationKey,e.localizationKeyParameters?e.localizationKeyParameters:void 0),command:d.CommandTypes[e.command],icon:e.icon,disabled:e.disabled}))))}showSXPopup(e,t,s,i,o,n,r){const l=this.getSXMenuItems(e,t);if(0===l.length||!i())return!1;const d={anchor:i,useTheme:!0,positionPriorities:["bottom","right","left","top"],popupBeakSize:{width:0,height:0}};return c.default.showWithOptions({id:s,config:d,getMenuItems:()=>l,handleMenuCommand:e=>this._onCommandSelected(e,{rootViewId:o},a.MessageActionOrigin.StreamItemPopup),onDismiss:r,rootViewId:o,invokingEvent:n})}dismissSXPopup(e,t){n.default.dismissPopup(e,t)}}},64975:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItemContent=void 0;const i=s(96486),o=s(92407),n=s(16778),r=s(89391),a=s(47447),l=s(70891),d=s(86994),c=s(15877),h=s(83503),u=s(23752),p=s(63032),g=s(22929),m=s(71639),S=s(6658),f=s(38165),y=s(78735),_=s(29130),v=s(750),C=s(81760),b=s(11010),T=s(11828),M=s(80837),I=s(24576),w=(0,c.lazyProperties)({lightTextStyle:()=>n.Styles.createTextStyle({color:C.Color.white}),atMentionStyle:()=>n.Styles.createTextStyle({font:b.default.font.uiDisplayBold}),quoteSymbolDarkThemeStyle:()=>n.Styles.createTextStyle({color:C.Color.whiteOverlay50}),quoteSeparatorStyle:()=>n.Styles.createViewStyle({borderColor:C.Color.white,borderBottomWidth:1}),quoteAttributeStyle:()=>n.Styles.createTextStyle({fontSize:b.default.controlFontSize.messageStreamQuoteAttributeDesktop}),textStyle:()=>n.Styles.createTextStyle({font:b.default.font.uiDisplayRegular,overflow:"visible"}),textAlignCenter:()=>n.Styles.createTextStyle({textAlign:"center"}),translateLinkStyle:()=>n.Styles.createTextStyle({marginTop:6,opacity:.6})});class P extends I.default{constructor(){super(...arguments),this._onCopy=(e,t,s)=>{g.default.add(this.props.skypeMessage.conversationId,this.props.skypeMessage.mergePartialUpdate({content:s}),t,e)},this._onCopySelectionContainerRef=e=>{this._selectionContainerRef=e||void 0}}_buildState(e,t){return{isSmallOrTinyScreenSize:_.default.isSmallOrTinyScreenSize(this._getRootViewId()),enableMultiMessageQuoteOnKeyboard:d.copyAllowed(r.default.getS4LMessagingFeatures().enableMultiMessageQuoteOnKeyboard&&y.default.getUserPreferencesLocal().pasteAsQuotesEnabled,e.skypeMessage.messagetype)}}render(){const{messageTextOverrideColorStyle:e,quoteAttributeOverrideColorStyle:t,quoteColor:s}=this.props.viewRenderingOptions.viewColorProperties,r=i.compact([w.textStyle,e]),d=[w.textStyle,w.quoteAttributeStyle,t];let c,g,y={size:T.IconSize.size24,color:null!=s?s:C.Color.gray400},_=[],I=[w.translateLinkStyle,e];if(this.props.useLightText&&(c=w.quoteSeparatorStyle,y.color=C.Color.whiteOverlay50,r.push(w.lightTextStyle),d.push(w.lightTextStyle),I.push(w.lightTextStyle)),this.props.viewRenderingOptions.messageContentCentered&&r.push([b.default.fontStyle.caption,w.textAlignCenter,this._themeStyles.secondaryTextColorStyle]),this.props.messageStreamFontSize&&this.props.messageStreamFontSize!==S.MessageStreamFontSize.Normal){const e=b.default.controlFontSize.messageStreamItemDesktop,t=m.getStyle(e,this.props.messageStreamFontSize),s=m.getStyle(b.default.controlFontSize.messageStreamQuoteAttributeDesktop,this.props.messageStreamFontSize);r.push(t),_.push(t),d.push(s),g=m.getSize(e,this.props.messageStreamFontSize)}const P=this.props.viewRenderingOptions.sendingStatus,k={allowLargeEmoticons:!0,emoticonsOnlyEmoticonSize:this.props.emoticonsOnlyEmoticonSize,singleEmoticonSize:this.props.singleEmoticonSize,allowHugeEmoticons:this.props.allowHugeEmoticons,allowTextSelection:!this.props.disableTextSelection,disableActions:this.props.disableActions,isDraggingEnabled:this.props.viewRenderingOptions.isDraggingEnabled,onPressInterceptionCallback:this.props.onSelectMessageCallback,activeOpacityOverride:this.props.activeOpacityOverride,renderOrigin:this.props.renderOrigin,allowTextFallbackEmoticons:!0,mojiProps:{metadataAlign:this.props.postedByCurrentUser?l.MojiMetadataAlign.Left:l.MojiMetadataAlign.Right,size:this.state.isSmallOrTinyScreenSize||this._getContext().isPresentedInDesktopSubview?l.MojiSize.Medium:l.MojiSize.ExtraLarge,hideMetadata:!1},hideSendingIndicators:P!==p.MessageRenderSendingStatus.Sending,forceStaticAnimatedEmoticons:!this.props.viewRenderingOptions.shouldAnimateEmoticons,mojiBackgroundColor:this._themeColors.messageStreamBackgroundColor,renderLocation:this.props.viewRenderingOptions.showLocationCard,leftPaddingSwiftCarousel:this.props.leftPaddingForUserIcon,supportsCopy:a.UICapabilities.copyTextToClipboardSupported(),messageActions:this.props.messageActions,isRetryCommandSupported:h.isCommandSupported(this.props.messageActions,v.CommandTypes.RetryFailedSend),availableSpace:this.props.availableSpace,constrainedDimensions:this.props.constrainedDimensions,mediaPlaceholderIconColor:this._useDarkTheme()?this._themeColors.secondaryTextColor:this.props.postedByCurrentUser?void 0:this._themeColors.bubbleReactionColorOther,suggestedTextHighlights:this.props.suggestedTextHighlights,fontSize:g,textOverrideStyle:r,atMentionStyle:w.atMentionStyle,atMentionMeOverrideStyle:[w.atMentionStyle,M.default.defaultCursor],quoteAttributeStyle:d,quoteSeparatorStyle:c,quoteSymbolStyle:y,callMarkerStyle:_,translationLinkStyle:I,urlPreviewThumbnailRadiusStyle:this.props.viewRenderingOptions.urlPreviewThumbnailRadiusStyle,containerRadiusStyle:this.props.viewRenderingOptions.messageContainerRadiusStyle,linkStyle:this._themeStyles.linkTextColorStyle,urlPreviewData:this.props.urlPreviewData,urlPreviewOnly:this.props.urlPreviewOnly,obfuscateUrlPreview:this.props.viewRenderingOptions.obfuscateUrlPreview,overrideLongPressForLinks:this.props.viewRenderingOptions.overrideLongPressForLinks,onMountContent:this.props.onMountContent,onDisableScroll:this.props.onDisableScroll,onPress:this.props.onPress,onLongPressContent:this.props.onLongPressContent,onContextMenu:this.props.onContextMenu,onContentHorizontalScroll:this.props.onContentHorizontalScroll,onThumbnailLoaded:this.props.onThumbnailLoaded,onQuote:this.props.onQuote,onEdit:this.props.onEdit,isMessageInSendingState:f.isMessageInSendingState(this.props.skypeMessage,this.props.renderOrigin),onSelectableText:this.props.onSelectableText,maxContentSizeMultiplier:5,messagePadding:this.props.messagePadding,linkedMessages:this.props.linkedMessages,hasTranslation:this.props.hasTranslation,showTranslatedMessage:this.props.showTranslatedMessage,onToggleTranslation:this.props.onToggleTranslation},A=n.createElement(u.default,{message:this.props.skypeMessage,rawSearchQuery:this.props.rawSearchQuery,isSelectedMessage:this.props.isSelectedMessage,preDecodedMessage:this.props.decodedNode,options:k,renderAtMentionSymbol:this.props.viewRenderingOptions.showAtMentionIcon,atMentionSymbolStyle:r,disableActions:this.props.disableActions,searchStore:this.props.searchStore});return this.state.enableMultiMessageQuoteOnKeyboard?n.createElement(o.default,{ref:this._onCopySelectionContainerRef,onCopy:this._onCopy},A):A}copySelection(e){if(this._selectionContainerRef)return this._selectionContainerRef.copySelection(e)}quoteSelection(){if(this._selectionContainerRef)return this._selectionContainerRef.quoteSelection()}}t.StreamItemContent=P},4354:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItemFooter=void 0;const i=s(16778),o=s(88837),n=s(34339),r=s(15877),a=s(2989),l=s(81760),d=(0,r.lazyProperties)({reactionCountItem:()=>i.Styles.createViewStyle({marginTop:6}),reactionCountItemForOutsideFooter:()=>i.Styles.createViewStyle({borderColor:l.Color.gray100,borderWidth:1,borderStyle:"solid"}),reactionContainer:()=>i.Styles.createViewStyle({marginRight:5,flexDirection:"row",flexWrap:"wrap",alignSelf:"flex-start"}),reactionContainerOutside:()=>i.Styles.createViewStyle({marginTop:6,marginBottom:10})});class c extends o.ComponentBase{render(){const e=[d.reactionContainer];let t;return this.props.showReactionsOverlay?t=d.reactionCountItem:(t=d.reactionCountItemForOutsideFooter,e.push(d.reactionContainerOutside)),this.props.style&&e.push(this.props.style),i.createElement(a.default,{style:e,message:this.props.message,reactionSize:n.Size.Small,itemStyle:t,anchorPositionAnywhere:!0,disableAction:this.props.disableAction,suppressSingleCounts:this.props.suppressSingleCounts,showShadows:this.props.showShadows,constrainedWidth:this.props.constrainedWidth})}}t.StreamItemFooter=c},75068:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItemHeader=void 0;const i=s(15069),o=s(16778),n=s(89391),r=s(19061),a=s(71830),l=s(52262),d=s(1889),c=s(39285),h=s(10117),u=s(15877),p=s(33754),g=s(63032),m=s(71639),S=s(6658),f=s(18078),y=s(1118),_=s(4057),v=s(81760),C=s(11010),b=s(11828),T=s(80837),M=s(24576),I=s(2301),w=s(67977),P=(0,u.lazyProperties)({text:()=>o.Styles.createTextStyle({backgroundColor:v.Color.transparent,alignSelf:"center",paddingBottom:25,flex:1}),textMe:()=>o.Styles.createTextStyle({textAlign:"right",paddingBottom:2}),containerSpacingCarouselMe:()=>o.Styles.createViewStyle({paddingRight:10}),containerBottomPadding:()=>o.Styles.createViewStyle({paddingBottom:2}),userIconContainerSmallDevice:()=>o.Styles.createViewStyle({marginRight:8,overflow:"visible"}),userIconContainer:()=>o.Styles.createViewStyle({marginRight:10,overflow:"visible"}),headerContainer:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"flex-start"}),headerContainerMe:()=>o.Styles.createViewStyle({justifyContent:"flex-end"}),headerTextContainer:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),marginLeft:()=>o.Styles.createViewStyle({marginLeft:5}),groupIconStyles:()=>o.Styles.createViewStyle({marginLeft:3,alignSelf:"flex-start"}),bookmarkOverrideHeaderStyles:()=>o.Styles.createTextStyle({alignSelf:"flex-start",paddingBottom:0}),bookmarkHeaderContainerStyles:()=>o.Styles.createTextStyle({flexDirection:"row",flexShrink:1,paddingBottom:25})});class k extends M.default{constructor(){super(...arguments),this._userIconAnimatedOpacityValue=new o.Animated.Value(1),this._userIconAnimatedOpacityStyle=o.Styles.createAnimatedViewStyle({opacity:this._userIconAnimatedOpacityValue})}static getUserIconWidth(e){return e?w.UserIconSize.Size30+8:w.UserIconSize.Size40+10}_buildState(e,t){let s="";e.showSenderName&&(e.postedByCurrentUser?e.postedByCurrentUser&&(s=p.getString("DisplayInfoStore.ListMyName")):s=this._computeRemoteSenderShortName(e.conversationId,e.creatorMri));let i="";e.showMessageTimestamp&&e.sendingStatus!==g.MessageRenderSendingStatus.NoNetwork&&(i=e.sendingStatus===g.MessageRenderSendingStatus.Sending?p.getString("StreamItem.Sending"):e.displayDateTime||"");const o=a.isBookmarkConversation(e.conversationId);let r="";return r=s?p.getString("StreamItem.MessageHeader",{senderName:s,timestamp:i}).trim():i,{headerText:r,displayName:s,myUserSkypeMri:f.default.getSkypeMri(),isBookmarksThread:o,areBookmarksEnabled:n.default.getS4LMessagingFeatures().enableBookmarks}}_computeRemoteSenderShortName(e,t){return l.default.getMemberShortNameForConversation(e,t)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.props.isContentScrolledOverHeader!==e.isContentScrolledOverHeader&&this._animateUserIcon(this.props.isContentScrolledOverHeader)}render(){const e=[P.headerContainer];!this.props.postedByCurrentUser||this.props.alignLeft||this.state.isBookmarksThread||e.push(P.headerContainerMe),this.props.style&&e.push(this.props.style);const t=this._getUserIconElement(),s=this._getHeaderTextElement();if(!t&&!s)return null;const i=s&&this._getOptionalHeaderTextWrapped(s);return o.createElement(o.View,{style:e,importantForAccessibility:this.props.importantForAccessibility,accessibilityLabel:this.props.accessibilityLabel,accessibilityTraits:this.props.accessibilityTraits,accessibilityActions:this.props.accessibilityActions,onAccessibilityAction:this.props.onAccessibilityAction},t,i)}_getOptionalHeaderTextWrapped(e){const t=this._getBookmarkIconElement();return this.state.areBookmarksEnabled&&t?o.createElement(o.View,{style:P.headerTextContainer},e,t):e}_getBookmarkIconElement(){if(r.default.canBookmarkMessage()&&this.props.isBookmarkedMessage)return o.createElement(c.default,{title:p.getString("StreamItem.MessageBookmarked"),style:P.containerBottomPadding},o.createElement(h.default,{icon:b.SkypeIcon.Bookmarked,size:b.IconSize.size12,color:this._themeColors.secondaryTextColor,style:P.marginLeft}))}_getUserIconElement(){if(this.props.showUserIcon){let e,t;this.props.isSmallDevice?(t=P.userIconContainerSmallDevice,e=w.UserIconSize.Size30):(t=P.userIconContainer,e=w.UserIconSize.Size40);const s=void 0;return this.props.contentScrollEnabled?o.createElement(o.Animated.View,{style:[t,this._userIconAnimatedOpacityStyle],importantForAccessibility:s},o.createElement(I.UserIcon,{size:e,userMri:this.props.creatorMri,enableNavigation:!this.props.disableActions&&!this.props.postedByCurrentUser,conversationId:this.props.conversationId,showHoverEffect:!1,hideBlockedOverlay:r.default.allowGroupInteractionBetweenBlockedParticipants(this.state.myUserSkypeMri,this.props.creatorMri)})):o.createElement(I.UserIcon,{size:e,style:t,userMri:this.props.creatorMri,enableNavigation:!this.props.disableActions&&!this.props.postedByCurrentUser,importantForAccessibility:s,conversationId:this.props.conversationId,showHoverEffect:!1,hideBlockedOverlay:r.default.allowGroupInteractionBetweenBlockedParticipants(this.state.myUserSkypeMri,this.props.creatorMri)})}}_getTextToHighlight(){const e=_.default.deburrLowerCase(this.props.rawSearchQuery||"");return e&&y.nameContainsSearchQuery(this.state.displayName,e)?e:""}_animateUserIcon(e){o.Animated.timing(this._userIconAnimatedOpacityValue,{toValue:e?0:1,easing:e?o.Animated.Easing.Out():o.Animated.Easing.In(),duration:300,isInteraction:!1}).start()}_getHeaderTextElement(){if(this.state.headerText){const e=[P.text,C.default.fontStyle.caption,this._themeStyles.secondaryTextColorStyle],t=this.props.postedByCurrentUser&&!this.props.alignLeft;if(t&&e.push(P.textMe),this.state.areBookmarksEnabled&&(this.props.isBookmarkedMessage||this.state.isBookmarksThread)&&e.push(P.bookmarkOverrideHeaderStyles,P.containerBottomPadding),this.props.messageStreamFontSize&&this.props.messageStreamFontSize!==S.MessageStreamFontSize.Normal){const t=m.getStyleFromStyle(e,this.props.messageStreamFontSize);e.push(t)}const s=this._getTextToHighlight();return this._isCarouselOnNative(t)&&e.push(P.containerSpacingCarouselMe),s&&!this.props.isUsingStackNavigationContext?o.createElement(d.default,{selectable:!(i.default.isMobile()||this.props.disableActions),containerStyles:e,inlineTextStyle:[],displayText:this.state.headerText,textToHighlight:s,importantForAccessibility:o.Types.ImportantForAccessibility.NoHideDescendants}):this.state.areBookmarksEnabled&&this.state.isBookmarksThread&&this.props.bookmarkSourceConversationName?this._getBookmarkStreamItemHeader():o.createElement(o.Text,{selectable:!(i.default.isMobile()||this.props.disableActions),ellipsizeMode:"middle",style:e,numberOfLines:1,importantForAccessibility:o.Types.ImportantForAccessibility.NoHideDescendants},this.state.headerText)}}_getBookmarkStreamItemHeader(){let e;this.props.bookmarkSourceConversationName&&this.props.bookmarkSourceConversationId&&(e=a.isGroupConversation(this.props.bookmarkSourceConversationId)?o.createElement(h.default,{color:this._themeColors.secondaryTextColor,size:b.IconSize.size14,icon:b.SkypeIcon.ContactGroup,style:P.groupIconStyles}):void 0);const t=[C.default.fontStyle.caption,this._themeStyles.secondaryTextColorStyle],s=o.createElement(o.Text,{style:[P.marginLeft,T.default.flexOne,t],numberOfLines:1},this.props.bookmarkSourceConversationName);return o.createElement(o.View,{style:[P.bookmarkHeaderContainerStyles,P.containerBottomPadding],importantForAccessibility:o.Types.ImportantForAccessibility.NoHideDescendants},o.createElement(o.Text,{style:t},this.state.displayName+" >"),e,s,o.createElement(o.Text,{style:t},", "+this.props.displayDateTime))}_isCarouselOnNative(e){return!!(e&&this.props.isUsingStackNavigationContext&&this.props.isCarousel)}}t.StreamItemHeader=k},98812:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItemOptionsMenu=void 0;const i=s(16778),o=(s(89391),s(62602)),n=s(13944),r=s(10117),a=s(48638),l=s(15877),d=s(33754),c=s(6658),h=s(81760),u=s(11828),p=s(80837),g=s(24576),m=s(12770),S=(0,l.lazyProperties)({container:()=>i.Styles.createViewStyle({width:c.streamItemOptionsMenuWidth,paddingRight:22,alignItems:"flex-end",overflow:"visible"}),containerHeight:()=>i.Styles.createViewStyle({height:c.streamItemOptionsMenuHeight}),containerInDesktopSubview:()=>i.Styles.createViewStyle({width:c.streamItemOptionsMenuWidthInDesktopSubview,paddingRight:4}),buttonCentering:()=>i.Styles.createViewStyle({paddingLeft:c.streamItemOptionsMenuWidth}),buttonCenteringInDesktopSubview:()=>i.Styles.createViewStyle({paddingLeft:c.streamItemOptionsMenuWidthInDesktopSubview}),buttonStyle:()=>i.Styles.createButtonStyle({alignSelf:"flex-end",justifyContent:"center",alignItems:"center",width:24,height:24,borderRadius:12}),goToOriginalMessageButton:()=>i.Styles.createViewStyle({flexGrow:1,alignItems:"flex-end",marginTop:c.headerTextHeight}),bookmarkUIoverrides:()=>(0,l.lazyProperties)({container:()=>i.Styles.createViewStyle({width:2*c.streamItemOptionsMenuWidth,flexDirection:"row",justifyContent:"space-between",flexGrow:1,flexShrink:0,alignItems:"stretch"}),buttonStyle:()=>i.Styles.createButtonStyle({alignSelf:"flex-start",marginTop:15,marginLeft:5})})});class f extends g.default{constructor(){super(...arguments),this._onMoreButtonRef=e=>{this._moreButton=e||void 0},this._onMouseEnter=e=>{this._isMouseOver=!0,this.state.canShowButton||this._optionsButtonTimer||(this._optionsButtonTimer=m.default.setTimeout((()=>{this._optionsButtonTimer=void 0,this.isComponentMounted()&&this.setState({canShowButton:!0})}),200))},this._onMouseLeave=e=>{this._isMouseOver=!1,this._optionsButtonTimer&&(m.default.clearTimeout(this._optionsButtonTimer),this._optionsButtonTimer=void 0),this.state.canShowButton&&!i.UserInterface.isNavigatingWithKeyboard()&&this.setState({canShowButton:!1})},this._onPopupDismiss=()=>{this.isComponentMounted()&&this.setState({isShowingMenu:!1})},this._onOptionsButtonKeyPress=e=>o.default.maybeHandleKeyPress(e,(()=>{this._onOptionsButtonPress(e)})),this._onOptionsButtonPress=e=>{if(e.stopPropagation(),this.state.isShowingMenu)this.props.onButtonPress(e,!1,(()=>this._moreButton)),this.setState({isShowingMenu:!1});else{const t=!1,s=this.props.onButtonPress(e,!0,(()=>this._moreButton),t?void 0:this._onPopupDismiss);s&&!t&&this.setState({isShowingMenu:s})}}}_buildState(e,t){const s=a.default.isNavigatingWithKeyboard();let i={};return t?(i.canShowButton=s,i.isShowingMenu=!1):this.state&&(!this.state.canShowButton&&s?i.canShowButton=!0:!this.state.canShowButton||s||this._isMouseOver||(i.canShowButton=!1)),i}componentWillUnmount(){super.componentWillUnmount(),this._optionsButtonTimer&&(m.default.clearTimeout(this._optionsButtonTimer),this._optionsButtonTimer=void 0)}render(){const e=[this.props.style];return this.props.onSelect&&e.push(p.default.pointerCursor),this.props.messageContentCentered&&e.push(this._getContext().isPresentedInDesktopSubview?S.buttonCenteringInDesktopSubview:S.buttonCentering),i.createElement(i.View,{key:"options-menu"+this.props.id,style:e,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave,onPress:this.props.onSelect,onLayout:this.props.onLayout},this.props.children,this._renderOptionsButton())}_renderOptionsButton(){let e,t;const s=[S.container,this.props.useBookmarkUI?void 0:S.containerHeight];if(this._getContext().isPresentedInDesktopSubview&&s.push(S.containerInDesktopSubview),this.props.useBookmarkUI&&s.push(S.bookmarkUIoverrides.container),(this.state.isShowingMenu||this.state.canShowButton)&&this.props.renderOptionsButton){const s=[S.buttonStyle];let o=h.Color.white;this.props.useBookmarkUI&&s.push(S.bookmarkUIoverrides.buttonStyle),this.state.isShowingMenu?s.push(this._useAccessibleTheme()?this._themeStyles.primaryViewColorStyle:this._themeStyles.buttonBackgroundHoverColorStyle):o=this._themeColors.secondaryTextColor;const n=d.getString("Global.MoreOptions");e=i.createElement(i.Button,{ref:this._onMoreButtonRef,style:s,onPress:this._onOptionsButtonPress,onKeyPress:this._onOptionsButtonKeyPress,title:n,accessibilityTraits:[i.Types.AccessibilityTrait.Button,i.Types.AccessibilityTrait.HasPopup]},i.createElement(r.default,{icon:this.props.useBookmarkUI?u.SkypeIcon.More:u.SkypeIcon.MoreVertical,color:o,size:this.props.useBookmarkUI?u.IconSize.size16:u.IconSize.size12})),t=this._getOptionalGoToOriginalMessageButton()}return i.createElement(i.View,{style:s},e,t)}_getOptionalGoToOriginalMessageButton(){return this.props.useBookmarkUI?i.createElement(n.default,{icon:u.SkypeIcon.RightChevron,color:this._themeColors.secondaryTextColor,size:u.IconSize.size16,style:S.goToOriginalMessageButton,hoverColor:this._themeColors.iconHoverColor,onPress:this.props.onSecondaryButtonPress,title:d.getString("BookmarksConversation.GoToOriginalMessageButtonTitle")}):void 0}}t.StreamItemOptionsMenu=f},17795:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(47204),n=s(81760),r=s(79669),a=s(18037);t.default=class{constructor(e,t,s,i){this.dismissPopup=this._createDismissPopup(),this._onClose=this._createOnClose(t),this._anchor=e,this._rootViewId=s,this._rootViewType=i}show(){if(!this._anchor||!this._anchor())return!1;const e=a.default.useDarkThemeNoSubscription()?a.default.themeColorsNoSubscription().dividerColor:n.Color.black,t={getAnchor:()=>this._anchor&&this._anchor(),renderPopup:(t,s,o,a)=>i.createElement(r.default,{anchorPosition:t,anchorOffset:this._overrideAnchorOffset(s),offset:this._getOffset(),popupWidth:this._getPopupWidth(o),popupHeight:a,strokeColor:e,fillColor:n.Color.black,paddingInPopupCanvas:this._getPaddingInPopupCanvas(),popupAccessibilityTitle:this._getAccessibilityTitle(),borderRadius:10,containerStyle:this._getContainerStyle(),onOrientationChanged:this.dismissPopup},this._getPopupContent(t,s,o,a)),positionPriorities:["top","bottom"],onDismiss:()=>{this._onClose&&this._onClose()},dismissIfShown:!0,cacheable:this._isCacheable(),rootViewId:this._rootViewId,rootViewType:this._rootViewType,useScopedPopupId:!0};return o.default.showPopup(t,this._getPopupId())}_createOnClose(e){return()=>{e&&e(),this._anchor=void 0,this._onClose=void 0}}_createDismissPopup(){return()=>o.default.dismissPopup(this._getPopupId(),this._rootViewId,!0)}_getOffset(){}_overrideAnchorOffset(e){return e}_getPaddingInPopupCanvas(){}_isCacheable(){return!1}_getContainerStyle(){}_getPopupWidth(e){return e}}},35108:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(5531),n=s(16402),r=s(15877),a=s(33754),l=s(51072),d=s(18078),c=s(81760),h=s(11010),u=s(80837),p=s(19675),g=s(24576),m=s(18037),S=s(2301),f=s(67977),y=(0,r.lazyProperties)({itemContainer:()=>i.Styles.createViewStyle({flexDirection:"row",flex:1,backgroundColor:c.Color.transparent,alignItems:"center"}),textContainer:()=>i.Styles.createViewStyle({flex:1,flexDirection:"row"}),mainText:()=>i.Styles.createTextStyle({flex:-1,fontSize:h.default.fontSize.size17,fontFamily:h.default.fontFamily.uidDisplayRegular,color:c.Color.white,paddingLeft:10,paddingRight:10,alignSelf:"center"}),meText:()=>i.Styles.createTextStyle({color:c.Color.gray100,alignSelf:"center",paddingLeft:5}),timeStampStyle:()=>i.Styles.createTextStyle({alignSelf:"flex-end",paddingBottom:1}),accessibleTimeStampColor:()=>i.Styles.createTextStyle({color:c.Color.white})});class _ extends g.default{constructor(){super(...arguments),this._onPress=()=>{this.props.onItemPress(this.props.userMri)}}_buildState(e,t){return{isMe:d.default.isMyMri(e.userMri),accessibleTheme:m.default.useAccessibleTheme(),canAccessUserDetails:o.default.navigation().canAccessUserDetails}}render(){const e=[y.itemContainer,this.props.style],t=this.state.canAccessUserDetails&&!this.state.isMe;e.push(t?u.default.pointerCursor:u.default.defaultCursor);let s=this.props.buttonTitle;return this.props.timestamp&&(s+=", "+n.default.getDisplayDateTimeMixedString(this.props.timestamp)),i.createElement(l.default.View,{key:"item"+this.props.userMri,style:e,onPress:t?this._onPress:void 0,accessibilityTraits:t?i.Types.AccessibilityTrait.Button:i.Types.AccessibilityTrait.Summary,importantForAccessibility:t?i.Types.ImportantForAccessibility.Yes:i.Types.ImportantForAccessibility.No,accessibilityLabel:s,activeOpacity:t?.8:void 0},i.createElement(S.UserIcon,{userMri:this.props.userMri,size:f.UserIconSize.Size32,style:t?u.default.pointerCursor:u.default.defaultCursor}),this._getUserNameElement())}_getUserNameElement(){const e=i.createElement(i.Text,{style:y.mainText,numberOfLines:1},this.props.displayName);let t,s;if(this.props.timestamp){const e=[h.default.fontStyle.caption,y.timeStampStyle];this.state.accessibleTheme&&e.push(y.accessibleTimeStampColor),t=i.createElement(i.Text,{style:e,numberOfLines:1},n.default.getDisplayDateTimeMixedString(this.props.timestamp))}return this.props.showMeLabel&&this.state.isMe&&(s=i.createElement(p.BodyText,{size:p.BodyTextSize.SmallDeprecated,style:y.meText,numberOfLines:1},a.getString("ReactionSummaryListViewItem.MeLabel"))),i.createElement(i.View,{style:y.textContainer},e,s,t)}}t.default=_},51972:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItemQuotesGestureWrapper=void 0;const i=s(98356),o=s(16778),n=s(89391),r=s(12854),a=s(13944),l=s(15877),d=s(33754),c=s(11828),h=s(34528),u=s(24576),p=(0,l.lazyProperties)({quickQuotesStyleContainer:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"center",overflow:"visible"}),gestureContainerStyle:()=>o.Styles.createViewStyle({overflow:"visible",flex:1}),quoteMessageIconContainer:()=>o.Styles.createViewStyle({position:"absolute",width:150,flexDirection:"row",alignItems:"center"}),quoteIconPadding:()=>o.Styles.createTextStyle({paddingHorizontal:4})});class g extends u.default{constructor(){super(...arguments),this._quotesButtonOpacityValue=new o.Animated.Value(0),this._quotesButtonOpacityStyle=o.Styles.createAnimatedViewStyle({opacity:this._quotesButtonOpacityValue}),this._didDisableScrolling=!1,this._hapticFeedbackSent=!1,this._onPanViewQuickQuote=e=>{const t=e.pageX-e.initialPageX,s=Math.abs(t),i=t>=0;if(r.default.prepareFeedback(),!i)return void this._resetMessageContainerPosition();this.state.showQuickQuotesIcon||this.setState({showQuickQuotesIcon:!0}),this._disableScrolling(!0),this.props.onGestureStartStopCallback&&this.props.onGestureStartStopCallback(!0),t>20&&!this.state.showIconText?this.setState({showIconText:!0}):t<20&&this.state.showIconText&&this.setState({showIconText:!1}),this.props.positionToAnimateOnSwipe.setValue(this.props.initialPositionValue+t),s>50?this._quotesButtonOpacityValue.setValue(1):this._quotesButtonOpacityValue.setValue(s/50);const o=s>50;!this._hapticFeedbackSent&&o&&(this._hapticFeedbackSent=!0,r.default.triggerFeedback().then((()=>{r.default.unprepareFeedback()}))),e.isComplete&&(o&&(this.props.onQuotesCommandTrigger(),this._hapticFeedbackSent=!1),this._resetMessageContainerPosition())}}_buildState(e,t){let s={isReplyStringEnabled:n.default.getS4LMessagingFeatures().enableReply};return t&&(s.showQuickQuotesIcon=!1),s}render(){let e="";this.state.showIconText&&(e=this.state.isReplyStringEnabled?d.getString("StreamItem.ActionReply"):d.getString("StreamItem.ActionQuote"));const t=this.state.showQuickQuotesIcon?o.createElement(o.Animated.View,{style:[p.quoteMessageIconContainer,this._quotesButtonOpacityStyle]},o.createElement(a.default,{icon:this.state.isReplyStringEnabled?c.SkypeIcon.Reply:h.getQuoteSymbol(),color:this._themeColors.secondaryTextColor,hoverColor:this._themeColors.secondaryTextColor,size:c.IconSize.size20,style:p.quoteIconPadding}),o.createElement(o.Text,{style:[this._themeStyles.secondaryTextColorStyle,p.quoteIconPadding]},e)):void 0;return o.createElement(o.View,{style:p.quickQuotesStyleContainer},t,o.createElement(o.GestureView,{key:"streamViewGesture",onPanHorizontal:this._onPanViewQuickQuote,panPixelThreshold:20,preferredPan:o.Types.PreferredPanGesture.Horizontal,releaseOnRequest:!1,importantForAccessibility:o.Types.ImportantForAccessibility.No,style:p.gestureContainerStyle},this.props.children))}_resetMessageContainerPosition(){o.Animated.parallel([o.Animated.timing(this.props.positionToAnimateOnSwipe,{toValue:this.props.initialPositionValue,duration:i.Common.Duration.Default,easing:i.Easing.SkypeExpoInOut5,useNativeDriver:!0}),o.Animated.timing(this._quotesButtonOpacityValue,{toValue:0,duration:i.Common.Duration.Default,easing:i.Easing.SkypeExpoInOut5,useNativeDriver:!0})]).start((()=>{this._disableScrolling(!1),this.props.onGestureStartStopCallback&&this.props.onGestureStartStopCallback(!1),this.isComponentMounted()&&this.state.showQuickQuotesIcon&&this.setState({showQuickQuotesIcon:!1,showIconText:!1})}))}_disableScrolling(e){this.props.onDisableScroll&&(e?this._didDisableScrolling||(this.props.onDisableScroll(!0),this._didDisableScrolling=!0):this._didDisableScrolling&&(this.props.onDisableScroll(!1),this._didDisableScrolling=!1))}}t.StreamItemQuotesGestureWrapper=g},58774:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItemReadReceipts=void 0;const i=s(96486),o=s(16778),n=s(36237),r=s(15877),a=s(33754),l=s(6658),d=s(12056),c=s(70665),h=s(23281),u=s(44487),p=s(11010),g=s(19675),m=s(24576),S=s(2301),f=s(67977),y=(0,r.lazyProperties)({container:()=>o.Styles.createButtonStyle({flexDirection:"row",justifyContent:"flex-end",maxWidth:l.maxStreamContentWidth,marginHorizontal:10,alignItems:"center",alignSelf:"flex-end"}),containerComposite:()=>o.Styles.createButtonStyle({marginLeft:50,marginRight:50}),avatarStyle:()=>o.Styles.createViewStyle({marginLeft:4}),textView:()=>o.Styles.createTextStyle({marginLeft:4,lineHeight:p.default.controlFontSize.bodyBigDeprecated})}),_={};class v extends m.default{constructor(){super(...arguments),this._onContainerRef=e=>{e&&(this._containerButton=e)},this._getContainerButton=()=>this._containerButton,this._showPopup=()=>{this._readReceiptsPopup||(this._navDismissalRegistrationHandle=c.register({dismiss:this._onClosePopup}),this._readReceiptsPopup=new h.ReadReceiptsPopup(this.props.conversationId,this.props.readReceiptsSum,this._getContainerButton,this._onClosePopup,this._getRootViewId(),this._getRootViewType()),this._readReceiptsPopup.show(),n.track(new d.ReadReceiptsViewed(this.props.readReceiptsHeads.length,this.props.readReceiptsSum.length,this.props.conversationId)))},this._onClosePopup=()=>{this._readReceiptsPopup=void 0,this.isComponentMounted()&&this._containerButton&&this._containerButton.requestFocus&&this._containerButton.requestFocus(),this._navDismissalRegistrationHandle&&(c.unregister(this._navDismissalRegistrationHandle),this._navDismissalRegistrationHandle=void 0)}}_buildState(e,t){const s=this._getRootViewId();return{hideReadReceipts:u.default.isSelectMessagesModeActive(s)}}render(){const e=i.map(i.slice(this.props.readReceiptsHeads,0,3),(e=>o.createElement(S.UserIcon,{key:e.mri,size:f.UserIconSize.Size16,userMri:e.mri,style:y.avatarStyle,showTitleOnHover:!this.state.hideReadReceipts})));if(this.props.readReceiptsHeads.length>3){const t=this.state.hideReadReceipts?"":a.getString("StreamItem.ClickToSeeMoreReadReceiptsTitle");e.push(o.createElement(o.View,{key:"additionalCounter",title:t},o.createElement(g.Caption,{style:y.textView},"+"+(this.props.readReceiptsHeads.length-3))))}return o.createElement(o.Button,Object.assign({},this._getCommonContainerProps()),e)}componentWillUnmount(){super.componentWillUnmount(),this._readReceiptsPopup&&(this._readReceiptsPopup.dismissPopup(),this._readReceiptsPopup=void 0)}_getCommonContainerProps(){return{style:this._getContainerStyles(),onPress:this._showPopup,ref:this._onContainerRef,accessibilityLabel:a.getString("StreamItem.ReadByMarkerAccessibilityLabel",{count:this.props.readReceiptsSum.length}),importantForAccessibility:this.state.hideReadReceipts?o.Types.ImportantForAccessibility.NoHideDescendants:o.Types.ImportantForAccessibility.Yes,accessibilityTraits:this.state.hideReadReceipts?o.Types.AccessibilityTrait.None:void 0,disableTouchOpacityAnimation:this.state.hideReadReceipts,tabIndex:this.state.hideReadReceipts?-1:void 0,disabledOpacity:0,disabled:this.state.hideReadReceipts}}_getHeightStyle(e){return _[e]||(_[e]=o.Styles.createButtonStyle({height:e},!1)),_[e]}_getContainerStyles(){const e=[y.container,this._getHeightStyle(this.props.availableHeight)];return this._getContext().isPresentedInDesktopSubview||e.push(y.containerComposite),e}}t.StreamItemReadReceipts=v},93327:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItemTailAccessoryWrapper=void 0;const i=s(16778),o=s(88837),n=s(51077),r=s(15877),a=s(33754),l=s(80837),d=s(19675),c=(0,r.lazyProperties)({accessory:()=>(0,r.lazyProperties)({smsFailedText:()=>i.Styles.createTextStyle({flex:1,textAlign:"right",paddingBottom:4,paddingTop:1})})});class h extends o.ComponentBase{_shouldWrapWithSmsFailed(){return!!this.props.smsDeliveryStatus&&!n.isSmsDeliveredSuccessfully(this.props.smsDeliveryStatus)}_wrapWithSmsFailed(){return i.createElement(i.View,{style:l.default.flexOne},this.props.children,i.createElement(d.Caption,{style:c.accessory.smsFailedText,textThemeColor:d.TextThemeColor.Destructive},a.getString("SMSMessaging.SmsDeliveryFailed")))}render(){return this._shouldWrapWithSmsFailed()?this._wrapWithSmsFailed():this.props.children?i.Children.only(this.props.children):null}}t.StreamItemTailAccessoryWrapper=h},73970:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItemView=void 0;const i=s(96486),o=s(31844),n=s(31844),r=s(15069),a=s(38933),l=s(98356),d=s(16778),c=s(89391),h=s(51077),u=s(71830),p=(s(11930),s(984)),g=s(29791),m=s(16402),S=s(86374),f=s(73145),y=s(87134),_=s(70891),v=s(46096),C=s(17873),b=s(36237),T=s(61253),M=s(15877),I=s(74606),w=s(33754),P=s(82677),k=s(51072),A=s(18606),E=(s(83503),s(63032)),R=s(6658),L=s(12056),F=s(78735),x=s(45026),O=s(4735),D=s(30124),B=s(27357),V=s(45227),N=s(29130),U=(s(36150),s(44487)),H=s(76214),z=s(46529),W=s(750),j=s(64975),G=s(4354),K=s(75068),q=s(98812),Q=s(51972),X=s(93327),$=s(4057),J=s(93194),Y=s(81760),Z=s(40363),ee=s(78262),te=s(80837),se=s(60305),ie=s(11698),oe=s(24576),ne=s(18037),re=s(88523),ae=s(53374),le=s(12770),de=s(46200),ce=s(82433),he=s(86045),ue="stream-item-sx-popup",pe=W.CommandTypes.SelectMessages,ge=Z.default.isRTL()?35:-35,me=(0,M.lazyProperties)({innerStreamItemView:()=>(0,M.lazyProperties)({containerStyle:()=>d.Styles.createViewStyle({flex:-1,alignItems:"stretch"}),desktopContainerStyle:()=>d.Styles.createViewStyle({minHeight:R.streamItemOptionsMenuHeight}),desktopContainerShrinkStyle:()=>d.Styles.createViewStyle({flexGrow:0}),containerSpacing:()=>(0,M.lazyProperties)({paddingBottomRegular:()=>d.Styles.createViewStyle({paddingBottom:14}),paddingBottomSmall:()=>d.Styles.createViewStyle({paddingBottom:10}),paddingBottomComposite:()=>d.Styles.createViewStyle({paddingBottom:14}),paddingBottomCompositeSmall:()=>d.Styles.createViewStyle({paddingBottom:8}),paddingBottomWithReactions:()=>d.Styles.createViewStyle({paddingBottom:0}),paddingBottomWithReactionsOverlay:()=>d.Styles.createViewStyle({paddingBottom:24})}),footerSpacing:()=>(0,M.lazyProperties)({paddingLeftRegular:()=>d.Styles.createViewStyle({paddingLeft:14}),paddingLeftSmall:()=>d.Styles.createViewStyle({paddingLeft:10}),paddingLeftComposite:()=>d.Styles.createViewStyle({paddingLeft:15}),marginTop:()=>d.Styles.createViewStyle({top:-22,marginBottom:-22,paddingBottom:4}),marginTopRecorderVideos:()=>d.Styles.createViewStyle({top:-3,marginBottom:-3}),paddingBottomWithReactions:()=>d.Styles.createViewStyle({paddingBottom:25})}),messageContentSpacing:()=>(0,M.lazyProperties)({regular:()=>(0,M.lazyProperties)({WithBubble:()=>d.Styles.createViewStyle({paddingLeft:14,paddingRight:14,paddingTop:14})}),compact:()=>(0,M.lazyProperties)({WithBubble:()=>d.Styles.createViewStyle({paddingLeft:9,paddingRight:12,paddingTop:8})}),compositeRegular:()=>(0,M.lazyProperties)({WithBubble:()=>d.Styles.createViewStyle({paddingLeft:15,paddingRight:15,paddingTop:14})}),compositeCompact:()=>(0,M.lazyProperties)({WithBubble:()=>d.Styles.createViewStyle({paddingLeft:11,paddingRight:12,paddingTop:9})})})}),streamItemViewWithButtons:()=>(0,M.lazyProperties)({wrapper:()=>d.Styles.createViewStyle({flex:1,justifyContent:"flex-start",flexDirection:"row"}),wrapperCenter:()=>d.Styles.createViewStyle({justifyContent:"center"}),wrapperMe:()=>d.Styles.createViewStyle({justifyContent:"flex-end"})}),messageContainer:()=>d.Styles.createViewStyle({flexDirection:"row",alignSelf:"stretch"}),messageContainerPadding:()=>d.Styles.createViewStyle({paddingHorizontal:10}),marginTop:()=>(0,M.lazyProperties)({regular:()=>d.Styles.createViewStyle({marginTop:-23}),withBigFontSize:()=>d.Styles.createViewStyle({marginTop:-18})}),headerLeftPadding:()=>(0,M.lazyProperties)({smallDevice:()=>d.Styles.createViewStyle({paddingLeft:8}),regularDevice:()=>d.Styles.createViewStyle({paddingLeft:10}),desktop:()=>d.Styles.createViewStyle({paddingLeft:40})}),accessoryTopPadding:()=>d.Styles.createViewStyle({paddingTop:R.headerTextHeight}),messageSelection:()=>(0,M.lazyProperties)({messageSelectionContainer:()=>d.Styles.createViewStyle({flexDirection:"row",alignContent:"center",overflow:"visible"}),messageWithTimeStampContainer:()=>d.Styles.createViewStyle({marginTop:20}),selectionContainerPosition:()=>d.Styles.createViewStyle({position:"absolute",paddingLeft:10,alignSelf:"center"})})});let Se=800;n.default.getMaxViewSizeForTexture().then((e=>{Se=e}),(e=>{b.warn(v.LogTraceArea.StreamItem,"DeviceUtilities getMaxViewSizeForTexture failed: "+$.default.errorAsString(e))}));const fe={};class ye extends oe.default{constructor(){super(...arguments),this._innerMovingContainerXOffsetValue=new d.Animated.Value(0),this._innerMovingContainerXOffsetStyle=d.Styles.createAnimatedViewStyle({transform:[{translateX:this._innerMovingContainerXOffsetValue}]}),this._selectContainerOpacityValue=new d.Animated.Value(1),this._selectContainerXOffsetValue=new d.Animated.Value(0),this._selectionContainerXOffsetStyle=d.Styles.createAnimatedViewStyle({transform:[{translateX:this._selectContainerXOffsetValue}]}),this._selectionContainerOpacityStyle=d.Styles.createAnimatedViewStyle({opacity:this._selectContainerOpacityValue}),this._dimIconsOpacityValue=new d.Animated.Value(1),this._dimIconsOpacityStyle=d.Styles.createAnimatedViewStyle({opacity:this._dimIconsOpacityValue}),this._xBase=0,this._onTap=e=>{const t=new de.ReactionPickerTelemetry(this.props.message,de.ReactionOriginType.DoubleTap),s="yes";if(this._isDoubleTap(e)){this._cancelDoubleTapTimer(),this._lastTapEvent=void 0;const e=this.props.message.getReactions(),i=ce.default.getEmoticonTone(s),o=e.some((e=>e.key===P.updateReactionNameWithTone(s,i))),n={message:this.props.message,reactionAction:{reaction:s,reactionTone:i,reactionLevel:0,reactionAdded:!o,isCustomReaction:!1}};P.addRemoveReactionFromMessage(n,t,(e=>{this._onAddingReactionDone(e,s,!o)}))}else this._startDoubleTapTimer(e)},this._navigateToBookmarkSource=e=>{e&&e.stopPropagation(),O.default.navigateToBookmarkSource(this.props.message.properties)},this._addOrRemoveMessageCallback=e=>{e&&e.stopPropagation(),this._onSelectMessage()},this._onSelectMessagesStreamItemCommandCallback=e=>{U.default.activateSelectMessagesMode(this._getRootViewId()),this._onSelectMessage()},this._onSelectMessage=e=>{let t,s,o=[];this.props.message.isAlbum()&&(s=ae.default.newGuid(),t=A.default.getAllMediaMessagesForAlbum(this.props.message.getAlbumId()),i.each(t,(e=>{o.push({message:e,node:S.decode(e),actionMenuCommands:this.props.messageActions&&this.props.messageActions.actionMenuCommands,forwardAlbumId:s})})));const n={message:this.props.message,node:this.props.decodedNode,actionMenuCommands:this.props.messageActions&&this.props.messageActions.actionMenuCommands,urlPreviewId:this.props.urlPreviewId,forwardAlbumId:s};e||!this.state.isMessageSelected?(U.default.addOrUpdateSelectedMessage(n),i.each(o,(e=>U.default.addOrUpdateSelectedMessage(e)))):(U.default.removeSelectedMessage(n),i.each(o,(e=>U.default.removeSelectedMessage(e)))),e||this.setState({isMessageSelected:!this.state.isMessageSelected})},this._onLayout=e=>{if(this.isComponentMounted()){if(void 0!==this.state.availableSpace&&(b.debug((()=>["DIM_CALC - _onLayout: e: ",e," _availableSpace: ",this.state.availableSpace," renderOrigin: "+this.props.renderOrigin])),this.state.availableSpace&&this.state.availableSpace.width&&Math.abs(this.state.availableSpace.width-e.width)>25)){b.debug((()=>["DIM_CALC - _onLayout set state "]));const t={width:e.width,height:e.height};this.props.viewRenderingOptions.calcRenderDim?this.setState({availableSpace:t,dimensions:this.props.viewRenderingOptions.calcRenderDim(t,this.props.renderOrigin)}):this.setState({availableSpace:t})}this.props.onLayout&&this.props.onLayout(e)}},this._onHandleContextMenu=e=>{!this.state.isSelectMessagesModeActive&&this._hasActionMenuCommands()&&(J.default._menuTargetComponent=this._menuTargetComponent||this._streamItem||void 0,f.default.showContextMenu(e,this._getRootViewId(),{getMenuItems:this._getMenuItems,onItemSelected:this._onCommandSelectedInContextMenu,onDismiss:this._onContextMenuDismissed}))},this._streamItemViewRef=e=>{this._streamItem=e||void 0},this._menuTargetComponentRef=e=>{this._menuTargetComponent=e||void 0},this._onQuotesCommandTriggerFromSwipe=()=>{this.props.onQuote&&this.props.onQuote([this.props.message],ie.QuotesTriggerType.Swipe)},this._onHideStreamAccessories=e=>{this._dimIconsOpacityValue.setValue(e?0:1)},this._getMenuItems=()=>{const e=this._getCommandManagerOptions();return this.props.messageActions?this._commandManager.getSXMenuItems(e,this.props.messageActions.actionMenuCommands):[]},this._onAccessibilityAction=e=>{const t=e.nativeEvent;if(t&&!i.isEmpty(t.action)){const e=i.filter(this._getMenuItems(),(e=>(0,T.default)(e.text,t.action)));this._commandManager.onActionMenuOptionSelected(this._getCommandManagerOptions(),e[0].command,L.MessageActionOrigin.StreamItemDesktopContextMenu)}},this._onContentContainerRef=e=>{this._contentContainer=e},this._onStreamItemCommandSelected=(e,t,s)=>{this._onCommandSelected(e,s),e!==J.SXActionMenuCancel&&(this._contextMenuItemSelected=!0)},this._onCommandSelectedInStreamItemAccessory=e=>{this._onCommandSelected(e,L.MessageActionOrigin.StreamItemAccesory)},this._onCommandSelectedInContextMenu=e=>{this._onCommandSelected(e,L.MessageActionOrigin.StreamItemDesktopContextMenu),this._contextMenuItemSelected=!0},this._onCommandSelected=(e,t)=>{const s=this._getCommandManagerOptions();this._commandManager.onActionMenuOptionSelected(s,e,t)},this._onContextMenuDismissed=()=>{this._trackDismissActionMenuTelemetry()},this._onStreamItemContentRef=e=>{this._streamItemContentRef=e||void 0},this._onMountContent=(e,t,s)=>{this.props.onMountContent&&this.props.onMountContent(e,t,s,this.props.message)},this._onLongPress=(e,t)=>{},this._onActionMenuDismissed=()=>{this._focusContentContainer(),this._trackDismissActionMenuTelemetry()},this._focusContentContainer=()=>{this.isComponentMounted()&&this._contentContainer&&this._contentContainer.requestFocus()},this._onPress=e=>{C.default.potentiallyMarkItemViewed(this.props.message,this.props.renderOrigin),this.state.isSelectMessagesModeActive?this._addOrRemoveMessageCallback(e):this.props.onItemPress&&this.props.onItemPress(e,this.props.message)},this._onDesktopOptionsButtonPress=(e,t,s,i)=>{const o=this._getRootViewId();return t&&this._hasActionMenuCommands()?(this._trackSearchSuccessTelemetry(),this._commandManager.showSXPopup(this._getCommandManagerOptions(),this.props.messageActions.actionMenuCommands,ue,s,o,e,(()=>{i&&i(),this._onContextMenuDismissed()}))):(this._commandManager.dismissSXPopup(ue,o),!1)},this._onContentHorizontalScroll=e=>{this.isComponentMounted()&&this.setState({isContentScrolled:!!e})},this._getCurrentMessage=()=>this.props.message,this._getReactionMenuAnchor=()=>this._streamItem}_buildState(e,t){const s=c.default.getS4LMessagingFeatures(),i=this._getRootViewId(),n={};t&&(n.disableStylingForTallBubbleAndroid=!1,n.availableSpace=e.viewRenderingOptions.availableSpace,e.viewRenderingOptions.calcRenderDim&&(n.dimensions=e.viewRenderingOptions.calcRenderDim(n.availableSpace,e.renderOrigin),b.debug((()=>["DIM_CALC - dimensions set from viewRenderingOptions in initial build state"])))),n.useAccessibleTheme=ne.default.useAccessibleTheme(),n.isSmallDevice=N.default.isSmallDevice(i)||!!this._getContext().isPresentedInDesktopSubview,n.useCompactLayout=n.isSmallDevice||ne.default.useCompactLayout(),n.isUsingStackNavigationContext=D.default.isUsingStackNavigationContext(),n.userIconWidth=K.StreamItemHeader.getUserIconWidth(n.isSmallDevice),n.isContentScrolled=!1,n.singleEmoticonSize=s.singleEmoticonSize,n.emoticonsOnlyEmoticonSize=s.emoticonsOnlyEmoticonSize,n.allowHugeEmoticons=F.default.getUserPreferencesLocal().allowHugeEmoticons;const r=this._shouldShowSelectionOption(e)&&e.isSelectMessagesModeActive;if(n.isSelectMessagesModeActive=r,n.showSelectCheckbox=!!this.state&&!!this.state.isSelectMessagesModeActive&&!r,n.showReactionsOverlay=s.enableReactionOverlays&&e.viewRenderingOptions.showReactionsOnMessage&&e.viewRenderingOptions.overlayReactionsOnMessage,n.suppressSingleReactionCounts=s.enableReactionOverlays,n.isConversationAccepted=p.default.isConversationAccepted(e.message.conversationId),n.isBookmarkThread=u.isBookmarkConversation(e.message.conversationId),n.doubleTapReactionEnabled=s.enableDoubleTapReaction,this._commandManager||(this._commandManager=new z.StreamItemCommandManager(this._onStreamItemCommandSelected)),r||(n.isMessageSelected=!1),n.accessibilityTraits=g.toAccessibilityTraits(e.viewRenderingOptions.accessibilityLabelType),e.viewRenderingOptions.skipAccessibilityLabelForMessageView)n.importantForAccessibility=d.Types.ImportantForAccessibility.No;else{let t=g.toAccessibilityLabel(e.decodedNode,{message:e.message,messageAccessibilityType:e.viewRenderingOptions.accessibilityLabelType,includeReactionInformationInAccessibilityLabel:!0});0,n.accessibilityLabel=t,n.importantForAccessibility=d.Types.ImportantForAccessibility.Yes}return n.isTablet=se.default.isTabletNoSubscription(),n.isLandscape=N.default.getDeviceOrientation(i)===o.DeviceOrientation.Landscape,n.responsiveWidth=N.default.getResponsiveWidth(i),n}_getCommandManagerOptions(){const e=this._getRootViewId(),t=B.default.getActiveConversationId(e);return{message:this.props.message,decodedNode:this.props.decodedNode,urlPreviewData:this.props.urlPreviewData,url:this.props.urlPreviewData?this.props.urlPreviewData.url:"",getReactionMenuPopupAnchor:this._getReactionMenuAnchor,getRootWindowComponent:this.props.getRootWindowComponent,onEditCallback:this.props.onEdit,onQuoteCallback:this.props.onQuote,onTranslateCallback:this.props.onToggleTranslation,onSelectMessagesCommandCallback:this._onSelectMessagesStreamItemCommandCallback,screenReaderEnabled:this.props.screenReaderEnabled,onMarkAsUnread:this.props.onMarkAsUnread,renderOrigin:this.props.renderOrigin,contextConversationId:t,componentContext:this._getContext(),selectedText:"",showTranslatedMessage:this.props.showTranslatedMessage,hasTranslation:this.props.hasTranslation,onCopy:this.props.onCopyContextMenu,onQuoteSelection:this.props.onQuoteSelectionContextMenu}}componentDidMount(){if(super.componentDidMount(),this.state.isSelectMessagesModeActive&&(this._selectContainerXOffsetValue.setValue(ge),this._onHideStreamAccessories(!0),!this.state.isMessageSelected)){const e=U.default.isMessageSelected(this.props.message.cuid);e&&this.setState({isMessageSelected:e})}}componentDidUpdate(e,t,s){if(super.componentDidUpdate(e,t,s),this.props.shouldScreenReaderFocusItem&&!e.shouldScreenReaderFocusItem&&this._focusContentContainer(),this.state.isMessageSelected&&!(0,T.default)(e.message.content,this.props.message.content)&&this._onSelectMessage(!0),t.isSelectMessagesModeActive!==this.state.isSelectMessagesModeActive){let e=ge;const t=l.Common.Duration.Default;let s=1;this.state.isSelectMessagesModeActive||(e=0,s=0);const i=[x.default.timing(this._selectContainerXOffsetValue,{toValue:e,duration:t,easing:l.Easing.SkypeExpoOut5,useNativeDriver:!0}),x.default.timing(this._selectContainerOpacityValue,{toValue:s,duration:t,easing:l.Easing.SkypeExpoOut5,useNativeDriver:!0})];d.Animated.parallel(i).start((()=>{!this.state.isSelectMessagesModeActive&&this.isComponentMounted()&&this.setState({showSelectCheckbox:!1})})),this._onHideStreamAccessories(!!this.state.isSelectMessagesModeActive)}if(e.isSelectMessagesModeActive!==this.props.isSelectMessagesModeActive&&this.props.onListItemDetails){const e={};e.onKeyPress=this.props.isSelectMessagesModeActive?this._addOrRemoveMessageCallback:void 0,this.props.onListItemDetails(e)}}render(){const e=this._getMessageContentWithBackground(),t=this._addOuterContentToMessageView(e),s=[me.messageContainer,this.props.viewRenderingOptions.messageContainerStyle,void 0];let o;this.props.viewRenderingOptions.messageContentExpandedToAvailableArea||(this.state.isUsingStackNavigationContext||this.props.renderOrigin!==_.MessageRenderOrigin.ChatCanvas&&this.props.renderOrigin!==_.MessageRenderOrigin.CallCanvas)&&s.push(me.messageContainerPadding);const n=this.state.isSelectMessagesModeActive||this.state.showSelectCheckbox;if(n){const e=this.props.viewRenderingOptions.viewColorProperties.disableGradient?Y.Color.gray300:this.props.viewRenderingOptions.viewColorProperties.userPrimaryColor,t=w.getString("MessageStream.SelectionToggleOff"),s=w.getString("MessageStream.SelectionToggleOn"),i=!!this.state.isMessageSelected,n=i?s:t,r=V.getToggleSwitchItemLabel(n,i),a=[me.messageSelection.selectionContainerPosition,this._selectionContainerXOffsetStyle,this._selectionContainerOpacityStyle],l=void 0;o=d.createElement(d.View,{style:[me.messageSelection.messageSelectionContainer,this.props.viewRenderingOptions.showMessageTimestamp?me.messageSelection.messageWithTimeStampContainer:void 0]},d.createElement(d.Animated.View,{style:a,importantForAccessibility:l,accessibilityTraits:d.Types.AccessibilityTrait.Button,accessibilityLabel:r},d.createElement(I.default,{isOn:i,selectionColor:e,disableSelectionAnimation:!0})))}const r=this._isDesktopOrDesktopSubView();let a;if(r||this._isPresentedInDesktopSidebar()){const e=!!this.props.messageActions&&!i.isEmpty(this.props.messageActions.actionMenuCommands)&&!this.state.isSelectMessagesModeActive;a=d.createElement(q.StreamItemOptionsMenu,{id:this.props.message.cuid,ref:this._menuTargetComponentRef,style:s,renderOptionsButton:e,onButtonPress:this._onDesktopOptionsButtonPress,messageContentCentered:!!this.props.viewRenderingOptions.messageContentCentered,onSelect:this.state.isSelectMessagesModeActive?this._addOrRemoveMessageCallback:void 0,onLayout:this._onLayout,useBookmarkUI:this.props.message.isBookmark(),onSecondaryButtonPress:this.props.message.isBookmark()?this._navigateToBookmarkSource:void 0},t,o)}else{if(this.state.isSelectMessagesModeActive)return d.createElement(k.default.View,{style:s,onLayout:this._onLayout,onPress:n?this._addOrRemoveMessageCallback:void 0,activeOpacity:n?.8:void 0},t,o);{const e=this.state.isSelectMessagesModeActive&&!r?this._getAccessibilityProps():void 0;a=d.createElement(d.View,Object.assign({style:s,onLayout:this._onLayout,onPress:n?this._addOrRemoveMessageCallback:void 0,activeOpacity:n?.8:void 0,ref:this._streamItemViewRef},e),t,o)}}return this.props.viewRenderingOptions.showDivider&&(a=d.createElement(d.View,null,a,d.createElement(y.default,{marginTop:15,marginBottom:5,marginLeft:this._getBookmarkDividerLeftSpacing()}))),a}copySelection(e){if(this._streamItemContentRef)return this._streamItemContentRef.copySelection(e)}quoteSelection(){if(this._streamItemContentRef)return this._streamItemContentRef.quoteSelection()}_onAddingReactionDone(e,t,s){let i="ReactionsMenu.YouReactedError";i=e?s?"ReactionsMenu.YouReacted":"ReactionsMenu.YouRemovedReaction":s?"ReactionsMenu.YouReactedError":"ReactionsMenu.YouRemovedReactionError",he.default.maybeAnnounceForAccessibility(w.getString(i,{reaction:t}))}_isDoubleTap(e){if(!this._lastTapEvent)return!1;return this._getEventTimestamp(e)-this._getEventTimestamp(this._lastTapEvent)<=200}_startDoubleTapTimer(e){this._lastTapEvent=e,this._doubleTapTimer=le.default.setTimeout((()=>{this.isComponentMounted()&&(this._doubleTapTimer=void 0)}),200)}_cancelDoubleTapTimer(){this._doubleTapTimer&&(le.default.clearTimeout(this._doubleTapTimer),this._doubleTapTimer=void 0)}_getEventTimestamp(e){return e.timeStamp?e.timeStamp.valueOf():0}_getBookmarkDividerLeftSpacing(){return this.state.isUsingStackNavigationContext&&!this.state.isTablet?10:void 0}_isPresentedInDesktopSidebar(){return!(!this._getContext().isPresentedInDesktopLeftNav&&!this._getContext().isPresentedInDesktopRightNav)}_isDesktopOrDesktopSubView(){return this.props.viewRenderingOptions.showDesktopButton&&!this.state.isUsingStackNavigationContext&&!this._getContext().isPresentedInDesktopSubview}_shouldShowSelectionOption(e){return!!e.messageActions&&i.some(e.messageActions.actionMenuCommands,(e=>e===pe))}_trackDismissActionMenuTelemetry(){if(!this._contextMenuItemSelected){const e=new L.MessageActionTelemetry(this.props.message.conversationId,this.props.message,this.props.message.createdTime,L.MessageActionOrigin.StreamItem,L.MessageActionType.DismissActionMenu);b.track(e)}this._contextMenuItemSelected=!1}_trackSearchSuccessTelemetry(){re.messageActionDone(this.props.message.conversationId)}_getMessageContentWithBackground(){const e=this.props.viewRenderingOptions;let t;const s=e.messageContainerRadiusStyle,i=[me.innerStreamItemView.containerStyle,void 0,this._innerMovingContainerXOffsetStyle];s&&i.push(...s);const o=[],n=this._footerSpacingStyle(),r=[te.default.flexOne];this._shouldRenderBackground()&&(t=this._getGradientView(),t||i.push(e.viewColorProperties.backgroundColorStyle),this.state.isUsingStackNavigationContext?this.state.useCompactLayout?(o.push(me.innerStreamItemView.messageContentSpacing.compact.WithBubble),r.push(me.innerStreamItemView.containerSpacing.paddingBottomSmall)):(o.push(me.innerStreamItemView.messageContentSpacing.regular.WithBubble),r.push(me.innerStreamItemView.containerSpacing.paddingBottomRegular)):this.state.useCompactLayout?(o.push(me.innerStreamItemView.messageContentSpacing.compositeCompact.WithBubble),r.push(me.innerStreamItemView.containerSpacing.paddingBottomCompositeSmall)):(o.push(me.innerStreamItemView.messageContentSpacing.compositeRegular.WithBubble),r.push(me.innerStreamItemView.containerSpacing.paddingBottomComposite)),this.props.message.hasReactions()&&this.props.viewRenderingOptions.showReactionsOnMessage&&(this.state.showReactionsOverlay?r.push(me.innerStreamItemView.containerSpacing.paddingBottomWithReactionsOverlay):r.push(me.innerStreamItemView.containerSpacing.paddingBottomWithReactions))),e.includeCursor&&r.push(te.default.pointerCursor),e.messageContentSpacingStyle&&o.push(e.messageContentSpacingStyle);const a=this._contextMenuHandler(),l=[t,d.createElement(d.View,{key:"bubblecontent",style:r,activeOpacity:e.showTouchFeedbackOnPress?.8:1,importantForAccessibility:d.Types.ImportantForAccessibility.No,onLongPress:this.state.isSelectMessagesModeActive?void 0:a,onPress:this.state.doubleTapReactionEnabled?this._onTap:void 0,onContextMenu:this.state.isSelectMessagesModeActive?void 0:a},d.createElement(d.View,{style:o},this._getStreamItemContent()),this.state.showReactionsOverlay?void 0:this._getStreamItemFooter(n))];let c=d.createElement(d.Animated.View,{key:"contentContainer",style:i},l);return this._isQuickQuoteSupported()&&(c=d.createElement(Q.StreamItemQuotesGestureWrapper,{onDisableScroll:this.props.onDisableScroll,onQuotesCommandTrigger:this._onQuotesCommandTriggerFromSwipe,positionToAnimateOnSwipe:this._innerMovingContainerXOffsetValue,initialPositionValue:this._xBase,onGestureStartStopCallback:this._onHideStreamAccessories},c)),c}_footerSpacingStyle(){const e=[];return(this._shouldRenderBackground()||this.state.showReactionsOverlay)&&(this.state.isUsingStackNavigationContext?this.state.useCompactLayout?e.push(me.innerStreamItemView.footerSpacing.paddingLeftSmall):e.push(me.innerStreamItemView.footerSpacing.paddingLeftRegular):this.state.useCompactLayout?e.push(me.innerStreamItemView.footerSpacing.paddingLeftSmall):e.push(me.innerStreamItemView.footerSpacing.paddingLeftComposite)),e}_isQuickQuoteSupported(){return!1}_addOuterContentToMessageView(e){const t=[me.streamItemViewWithButtons.wrapper],s=this._isQuickQuoteSupported()?te.default.overflowVisible:void 0,i=[s],o=[te.default.noncollapsibleView,me.innerStreamItemView.containerStyle,this.props.viewRenderingOptions.outerWrapperOverideStyle,s];let n,r;if((this._isDesktopOrDesktopSubView()||this._isPresentedInDesktopSidebar())&&o.push(me.innerStreamItemView.desktopContainerStyle),this.props.viewRenderingOptions.showStreamItemAccessory&&(this.props.postedByCurrentUser&&!this.props.message.isBookmark()?(n=this._getStreamItemAccessory(),t.push(me.streamItemViewWithButtons.wrapperMe)):r=this._getStreamItemAccessory()),this.props.viewRenderingOptions.messageContentCentered)t.push(me.streamItemViewWithButtons.wrapperCenter);else if(this.props.viewRenderingOptions.messageContentExpandedToAvailableArea)this.props.viewRenderingOptions.messageContentExpandedToAvailableArea&&o.push(te.default.flexOne);else{const e=d.Styles.createViewStyle({marginLeft:this.state.userIconWidth},!1);this.props.viewRenderingOptions.showMessageSenderIcon?i.push(e):this.props.viewRenderingOptions.allowMarginForSenderIcon&&o.push(e)}(this.props.viewRenderingOptions.showMessageSenderIcon||this.props.renderOrigin===_.MessageRenderOrigin.CompositeGalleryCanvas)&&(this.props.messageStreamFontSize===R.MessageStreamFontSize.Large||this.props.messageStreamFontSize===R.MessageStreamFontSize.Larger?i.push(me.marginTop.withBigFontSize):i.push(me.marginTop.regular));const a=this._getSpacerStyle();let l;a&&t.push(a),l=this.state.isSelectMessagesModeActive&&!this._isDesktopOrDesktopSubView?{importantForAccessibility:d.Types.ImportantForAccessibility.NoHideDescendants}:this.props.viewRenderingOptions.includeAccessibilityPropertiesOnMessageHeader?void 0:this._getAccessibilityProps(),this.props.postedByCurrentUser&&t.push(this._selectionContainerXOffsetStyle);const c={ref:this._onContentContainerRef,style:o};let u;u=this.props.message.messagetype===h.MessageTypes.CastRecording?me.innerStreamItemView.footerSpacing.marginTopRecorderVideos:me.innerStreamItemView.footerSpacing.marginTop;const p=this.state.showReactionsOverlay?this._getStreamItemFooter([...this._footerSpacingStyle(),u]):void 0;this.props.message.isBookmark()&&t.push(me.innerStreamItemView.desktopContainerShrinkStyle);let g=d.createElement(d.Animated.View,{style:t},n,d.createElement(k.default.View,Object.assign({},l,c),this._getStreamItemHeader(),d.createElement(d.View,{style:i},e,p)),r);return this.props.viewRenderingOptions.smsDeliveryStatus&&(g=d.createElement(X.StreamItemTailAccessoryWrapper,{smsDeliveryStatus:this.props.viewRenderingOptions.smsDeliveryStatus},g)),g}_getSpacerWidth(){const e=this.props.viewRenderingOptions;if(e.removeMessageSpacer||e.messageContentCentered)return null;let t=0;return this._isDesktopSize()&&!this.state.isTablet?t=this._getDesktopSpacerWidth(t):this.state.isTablet?t=this._getTabletSpacerWidth():this.state.isUsingStackNavigationContext&&(t=40),this.props.postedByCurrentUser&&(t+=this.state.userIconWidth),(e.showOuterButtons||e.showEditIndicator||e.sendingStatus!==E.MessageRenderSendingStatus.None)&&(t-=H.AccessoryWidth),this.props.message.isBookmark()&&(t=10),t}_getDesktopSpacerWidth(e){let t=0;return t=this.state.responsiveWidth>=ee.ResponsiveWidth.Large?200:this.state.responsiveWidth<ee.ResponsiveWidth.Large&&this.state.responsiveWidth>ee.ResponsiveWidth.Small?120:80,t}_getTabletSpacerWidth(){return this.state.isLandscape&&this.props.renderOrigin!==_.MessageRenderOrigin.CallCanvas?120:40}_getSpacerStyle(){if(this.props.message.isBookmark())return;const e=this._getSpacerWidth();if(!e)return;const t=(this.props.postedByCurrentUser&&!this.props.message.isBookmark()?"left":"right")+e;return fe[t]||(fe[t]=this.props.postedByCurrentUser&&!this.props.message.isBookmark()?d.Styles.createViewStyle({paddingLeft:e}):d.Styles.createViewStyle({paddingRight:e})),fe[t]}_shouldRenderBackground(){return!!this.props.viewRenderingOptions.renderMessageBackground&&!this.state.disableStylingForTallBubbleAndroid}_getGradientView(){const e=this.props.viewRenderingOptions.viewColorProperties;if(e.disableGradient||!this._shouldRenderBackground())return;const t=[te.default.absoluteFill,this.props.viewRenderingOptions.messageContainerRadiusStyle];return 1===e.gradientColors.length?(t.push(d.Styles.createViewStyle({backgroundColor:e.gradientColors[0]},!1)),d.createElement(d.View,{key:"gradient",style:t})):d.createElement(a.GradientView,{key:"gradient",style:t,direction:e.gradientDirection,colors:e.gradientColors})}_contextMenuHandler(){return this._onHandleContextMenu}_getStreamItemContent(){const e=this.props.viewRenderingOptions;let t=0;e.messageContentExpandedToAvailableArea&&e.showMessageSenderIcon&&(t=this._isDesktopSize()?40:this.state.isSmallDevice?8:10);const s=this.state.disableStylingForTallBubbleAndroid?this._useDarkTheme():e.viewColorProperties.useLightText;let i=this._getSpacerWidth();return i&&(i+=20),b.debug((()=>["DIM_CALC - StreamItemContent dimensions: ",this.state.dimensions," messagetype: ",this.props.message.messagetype," cuid: ",this.props.message.cuid])),d.createElement(j.StreamItemContent,{ref:this._onStreamItemContentRef,key:"streamitemcontent",skypeMessage:this.props.message,viewRenderingOptions:e,rawSearchQuery:this.props.rawSearchQuery,isSelectedMessage:this.props.isSelectedMessage,decodedNode:this.props.decodedNode,useLightText:s,leftPaddingForUserIcon:this.state.userIconWidth+t,urlPreviewData:this.props.urlPreviewData,urlPreviewOnly:this.props.urlPreviewOnly,postedByCurrentUser:this.props.postedByCurrentUser,messageActions:this.props.messageActions,messagePadding:i||void 0,suggestedTextHighlights:this.props.suggestedTextHighlights,constrainedDimensions:this.state.dimensions,availableSpace:this.state.availableSpace,messageStreamFontSize:this.props.messageStreamFontSize,onContentHorizontalScroll:this._onContentHorizontalScroll,onPress:this._onPress,onLongPressContent:(this.state.isSelectMessagesModeActive,void 0),onContextMenu:this._onHandleContextMenu,onDisableScroll:this.props.onDisableScroll,onMountContent:this._onMountContent,onQuote:this.props.onQuote,onEdit:this.props.onEdit,renderOrigin:this.props.renderOrigin,emoticonsOnlyEmoticonSize:this.state.emoticonsOnlyEmoticonSize,singleEmoticonSize:this.state.singleEmoticonSize,allowHugeEmoticons:this.state.allowHugeEmoticons,disableTextSelection:r.default.isMobile()||this.state.isSelectMessagesModeActive,disableActions:this.state.isSelectMessagesModeActive,onSelectMessageCallback:this.state.isSelectMessagesModeActive?this._addOrRemoveMessageCallback:void 0,activeOpacityOverride:this.state.isSelectMessagesModeActive?.8:void 0,linkedMessages:this.props.linkedMessages,hasTranslation:this.props.hasTranslation,onToggleTranslation:this.props.onToggleTranslation,showTranslatedMessage:this.props.showTranslatedMessage,searchStore:this.props.searchStore})}_hasActionMenuCommands(){return!!this.props.messageActions&&!i.isEmpty(this.props.messageActions.actionMenuCommands)}_getStreamItemAccessory(){const e=this.props.viewRenderingOptions,t=[e.showMessageSender||e.showMessageTimestamp&&e.sendingStatus!==E.MessageRenderSendingStatus.NoNetwork?me.accessoryTopPadding:void 0];return this.state.showReactionsOverlay&&this.props.message.hasReactions()&&t.push(me.innerStreamItemView.footerSpacing.paddingBottomWithReactions),d.createElement(H.StreamItemAccessory,{paddingStyle:t,message:this._getCurrentMessage,isMessageKnownByServer:this.props.message.isAnyVersionKnownByServer(),messagetype:this.props.message.messagetype,creator:this.props.message.creator,conversationId:this.props.message.conversationId,isConversationAccepted:this.state.isConversationAccepted,showEditIcon:e.showEditIndicator,sendingStatus:e.sendingStatus,smsDeliveryStatus:e.smsDeliveryStatus,showOuterButtons:e.showOuterButtons,commands:this.props.messageActions?this.props.messageActions.outerButtonCommands:[],onCommandSelected:this._onCommandSelectedInStreamItemAccessory,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,containerAnimationStyle:this._dimIconsOpacityStyle,disableActions:this.state.isSelectMessagesModeActive})}_isDesktopSize(){return!this.state.isUsingStackNavigationContext&&!this._getContext().isPresentedInDesktopSubview}_getAccessibilityProps(){let e=this.state.accessibilityLabel,t=this.state.accessibilityTraits,s=d.Types.ImportantForAccessibility.Yes;if(this.state.isSelectMessagesModeActive){const t=!!this.state.isMessageSelected,s=w.getString("MessageStream.SelectionToggleOff"),i=w.getString("MessageStream.SelectionToggleOn"),o=e||(t?i:s);e=V.getToggleSwitchItemLabel(o,t)}let i;return{accessibilityLabel:e,importantForAccessibility:s,accessibilityTraits:t,accessibilityActions:i,onAccessibilityAction:void 0}}_getStreamItemHeader(){const e=this.props.viewRenderingOptions;let t;e.messageContentExpandedToAvailableArea&&(t=this._isDesktopSize()?me.headerLeftPadding.desktop:this.state.isSmallDevice?me.headerLeftPadding.smallDevice:me.headerLeftPadding.regularDevice);let s,i=this.state.isSelectMessagesModeActive&&!this._isDesktopOrDesktopSubView()||!e.includeAccessibilityPropertiesOnMessageHeader?void 0:this._getAccessibilityProps();if(this.props.message.isBookmark()){const e=h.getBookmarkMetadata(this.props.message.properties);e&&(s=e.bookmarkSourceCreatorId)}const o=s||this.props.message.creator;let n,r,a;if(e.showMessageTimestamp&&(n=m.default.getDisplayTimeString(this.props.message.createdTime),this.state.isBookmarkThread)){const e=h.getBookmarkMetadata(this.props.message.properties);e&&e.bookmarkSourceComposeTime&&(n=m.default.getDisplayDateStringDayMonthYearFormat(e.bookmarkSourceComposeTime)),a=e&&e.bookmarkSourceConversationId,a&&(r=e&&e.bookmarkSourceConversationName)}return d.createElement(K.StreamItemHeader,Object.assign({},i,{creatorMri:o,style:t,messageStreamFontSize:this.props.messageStreamFontSize,conversationId:this.props.message.conversationId,postedByCurrentUser:this.props.postedByCurrentUser,displayDateTime:n,showMessageTimestamp:!!e.showMessageTimestamp,showUserIcon:e.showMessageSenderIcon,showSenderName:e.showMessageSender,sendingStatus:e.sendingStatus,alignLeft:e.alignHeaderLeft,isSmallDevice:this.state.isSmallDevice,contentScrollEnabled:!!e.contentScrollEnabled,isContentScrolledOverHeader:!!e.contentScrollEnabled&&this.state.isContentScrolled,userIconBackgroundColor:e.viewColorProperties.userIconBackgroundColor,rawSearchQuery:this.props.rawSearchQuery,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,disableActions:this.state.isSelectMessagesModeActive,isCarousel:e.messageContentExpandedToAvailableArea,isBookmarkedMessage:this.props.message.isBookmarkSourceForCurrentUser(),bookmarkSourceConversationName:r,bookmarkSourceConversationId:a}))}_getStreamItemFooter(e){if(this.props.viewRenderingOptions.showReactionsOnMessage){b.debug((()=>["DIM_CALC - StreamItemFooter dimensions: ",this.state.dimensions," messagetype: ",this.props.message.messagetype," cuid: ",this.props.message.cuid]));const t=this.props.decodedNode.hasHtmlContent()?void 0:this.state.dimensions&&this.state.dimensions.width;return d.createElement(G.StreamItemFooter,{key:"streamitemfooter",style:e,message:i.isEmpty(this.props.message.getReactions())?void 0:this.props.message,showReactionsOverlay:this.state.showReactionsOverlay,constrainedWidth:t,disableAction:this.state.isSelectMessagesModeActive,suppressSingleCounts:this.state.suppressSingleReactionCounts,showShadows:this.state.showReactionsOverlay})}}}t.StreamItemView=ye},63328:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(31844),n=s(16778),r=s(15069),a=s(4736),l=s(90247),d=s(1706),c=s(19784),h=s(60),u=s(89391),p=s(41639),g=s(46549),m=s(49758),S=s(68734),f=s(47447),y=s(5531),_=s(22801),v=s(51077),C=s(71830),b=s(97775),T=s(11009),M=s(84994),I=s(98278),w=s(38386),P=s(984),k=s(81627),A=s(25728),E=s(20770),R=s(39549),L=s(85641),F=s(82261),x=s(88660),O=s(52262),D=s(87134),B=s(32808),V=s(3782),N=s(3291),U=s(14353),H=s(41706),z=s(25793),W=s(70891),j=s(46096),G=s(80469),K=s(97174),q=s(23944),Q=s(36237),X=s(93924),$=s(83843),J=s(10400),Y=s(15877),Z=s(33754),ee=s(18606),te=s(18743),se=s(65822),ie=s(68080),oe=s(64387),ne=s(54757),re=s(61428),ae=s(48443),le=s(22929),de=s(51470),ce=s(29308),he=s(6658),ue=s(12056),pe=s(12056),ge=s(9413),me=s(40897),Se=s(78735),fe=s(46929),ye=s(18078),_e=s(4735),ve=s(30124),Ce=s(27357),be=s(3415),Te=s(33348),Me=s(92210),Ie=s(74636),we=s(81736),Pe=s(10756),ke=s(58962),Ae=s(85207),Ee=s(29130),Re=s(14976),Le=s(81115),Fe=s(57946),xe=s(76817),Oe=s(83181),De=s(8420),Be=s(4057),Ve=s(40363),Ne=s(11828),Ue=s(78262),He=s(80837),ze=s(60305),We=s(11698),je=s(19675),Ge=s(24576),Ke=s(88523),qe=s(53374),Qe=s(19089),Xe=s(93486),$e=10,Je=[],Ye=(0,Y.lazyProperties)({contentOuterContainer:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),messageComposerOuterContainerVertical:()=>n.Styles.createViewStyle({flexDirection:"row",justifyContent:"center"}),messageComposerOuterContainerHorizontal:()=>n.Styles.createViewStyle({flex:-1,flexDirection:"row",justifyContent:"center"}),messageComposerContainerDesktop:()=>n.Styles.createViewStyle({marginTop:8,width:he.maxStreamContentWidth,alignSelf:"center"}),messageComposerInner:()=>n.Styles.createViewStyle({flex:-1,flexDirection:"row",maxWidth:he.maxStreamContentWidth,width:he.maxStreamContentWidth}),messageComposerHorizontalSpacer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignSelf:"flex-end",alignItems:"center"}),messageComposerHorizontalSpacerDesktop:()=>n.Styles.createViewStyle({height:60}),messageComposerHorizontalTinySpacer:()=>n.Styles.createViewStyle({minWidth:5}),messageComposerHorizontalSmallSpacer:()=>n.Styles.createViewStyle({minWidth:$e}),messageComposerHorizontalBigSpacer:()=>n.Styles.createViewStyle({minWidth:80}),defaultRightSpacerStyle:()=>n.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-end",alignItems:"center",paddingRight:13,minWidth:70}),defaultRightSpacerStyleForComposerWithPopup:()=>n.Styles.createViewStyle({minWidth:$e}),toggleLeftPanelButtonContainer:()=>n.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-start",alignItems:"center",paddingLeft:15,minWidth:80}),toggleLeftPanelButtonContainerSmallView:()=>n.Styles.createViewStyle({minWidth:60}),messagingUnavailableContainer:()=>n.Styles.createViewStyle({flex:-1,flexDirection:"row",width:he.maxStreamContentWidth,maxWidth:he.maxStreamContentWidth,paddingRight:10,height:60,alignItems:"center"}),messagingUnavailablePlaceholder:()=>n.Styles.createTextStyle({flex:-1,paddingHorizontal:16}),dividerShadow:()=>n.Styles.createViewStyle({left:0,right:0,height:1,marginTop:-1}),sidebarButton:()=>n.Styles.createViewStyle({height:Ne.IconSize.default,width:Ne.IconSize.default}),tabletMessageComposer:()=>n.Styles.createViewStyle({minHeight:M.default.tabBarHeight(I.TabBarHeight.Tablet),paddingBottom:1,alignItems:"flex-end"}),messageTextCompletion:()=>n.Styles.createViewStyle({marginBottom:-1}),hideComposer:()=>n.Styles.createViewStyle({height:0}),paddingMobileBrowser:()=>n.Styles.createViewStyle({paddingBottom:20})});class Ze extends Ge.default{constructor(){super(...arguments),this._shouldSendGreetingEvent=!1,this._mountedContentNodes={},this._botMessageTimerLimit=Date.now(),this._shouldFocusMessageComposer=!1,this._scrolledToTheBottom=!0,this._dividerOpacityValue=new n.Animated.Value(0),this._dividerOpacityStyle=n.Styles.createAnimatedViewStyle({opacity:this._dividerOpacityValue}),this._messageComposerOpacityValue=new n.Animated.Value(1),this._messageComposerOpacityStyle=n.Styles.createAnimatedViewStyle({opacity:this._messageComposerOpacityValue}),this._leftMessageStreamSpacerWidth=0,this._rightMessageStreamSpacerWidth=0,this._spacerWidthUpdated=!1,this._trackAddContactOnce=!1,this._trackSendMessageOnce=!1,this._canSendSearchFirstSuccessAction=!1,this._lastDeletedTimestamp=0,this._focusJoinCallButtonOnce=!1,this._showDirectShareConfirmationDialog=e=>{const t=O.default.getDisplayName(this.props.conversationId)||"",s=Z.getString("DirectShare.ConfirmationDialogTitle",{displayName:t}),i=[{text:Z.getString("Global.CancelLabel"),isCancel:!0},{text:Z.getString("Global.ConfirmLabel"),isSubmit:!0,onPress:()=>x.default.sendSharedFiles(e,this.props.conversationId)}];c.default.showWithOptions({title:"",dialogAccessibilityTitle:s,message:s,buttons:i,rootViewId:this._getRootViewId()})},this._storeConversationStyles=()=>{L.default.storeSpacerWidths({left:this._leftMessageStreamSpacerWidth,right:this._rightMessageStreamSpacerWidth})},this._onMessageStreamScreenReaderFocusUpdated=e=>{this._shouldFocusMessageComposer=!e&&!n.Modal.isDisplayed()&&!this._focusJoinCallButtonOnce,this._shouldFocusMessageComposer&&!this.state.isAnimationPending&&this._setComposerAccessibilityFocus(),this._focusJoinCallButtonOnce=!1},this._onShowOverflow=(e,t,s)=>{this._shouldFocusMessageComposer=!1,this.props.onShowOverflow&&this.props.onShowOverflow(e,t,s)},this._onConversationsStoreUpdate=()=>{if(this.isComponentMounted()){this._postCallerIdMessage();const e=(0,R.default)().getConversation(this.props.conversationId);this._considerNavigationAfterDeleteConversation(e),this._considerRefreshingContactsStore(e),this._considerInviteMessageCountReached(e)}},this._toggleDesktopFindPanel=()=>{this.props.onToggleFindPanel&&this.props.onToggleFindPanel(this._messageComposer?this._messageComposer.getDesktopOverflowConfig():void 0)},this._onComposerContainerRef=e=>{this._composerContainerRef=e||void 0,this._composerContainerRef&&this._composerContainerRef.setFocusLimited(!!this.props.isSelectMessagesModeActive)},this._onMessageComposerRef=e=>{this._messageComposer=e||void 0},this._onTextCompletionRef=e=>{this._textCompletion=e||void 0},this._divider=()=>this.props.showBottomDivider?n.createElement(n.Animated.View,{style:[Ye.dividerShadow,this._themeStyles.headerShadowColorStyle,this._dividerOpacityStyle]}):n.createElement(D.default,{marginLeft:0,marginRight:0,useLightTheme:!0}),this._onMessageStreamRef=e=>{this._messageStream=e},this._onMessageStreamLayout=e=>{const t=e.height,s=e.width,i=this.state.isBookmark?760:560,o=e.width<i;this.state.contentAreaHeight===t&&this.state.contentAreaWidth===s&&this.state.isRenderedIn4ColumnWidth===o||this.setState({contentAreaHeight:t,contentAreaWidth:s,isRenderedIn4ColumnWidth:o}),Qe.default.isPiPEnabled()&&ae.default.updateDimensions(e)},this._onInputTextChanged=(e,t)=>{this._textCompletion&&this._textCompletion.setInputText(e,t)},this._onNativeComposerMessageEmptyStateChanged=()=>{this._sendSearchFirstSuccessfulAction()},this._onKeyPress=e=>(this._sendSearchFirstSuccessfulAction(),!!this._textCompletion&&this._textCompletion.handleKeyDown(e)),this._onRecording=()=>{if(this.props.hasConnectedCalls)c.default.showOKAlert(Z.getString("MessageStream.AudioMessageNotAllowedTitle"),Z.getString("MessageStream.AudioMessageNotAllowedMessage"),this._getRootViewId());else switch(l.default.getRecordingStateNoSubscription()){case l.RecordingState.StartingMic:case l.RecordingState.Recording:c.default.showOKAlert(Z.getString("MessageStream.MultipleAudioMessagesNotAllowedTitle"),Z.getString("MessageStream.MultipleAudioMessagesNotAllowedMessage"),this._getRootViewId());break;default:this._toggleRecording(!0)}},this._onDoneRecording=()=>{this._toggleRecording(!1)},this._insertSearchResultsToComposer=(e,t,s)=>{this._messageComposer&&this._messageComposer.insertSearchResult(e,t,s)},this._onReplaceText=(e,t,s,i)=>{const o=i instanceof K.AtMentionEntity;o&&(t+=" "),this._messageComposer&&(this._messageComposer.replaceText(e,t,s,i),o&&n.Accessibility.announceForAccessibility(Z.getString("MessageComposer.MentionSuggestionConfirmed",{name:t})))},this._onTextReplacementCandidatesShown=e=>{this._messageComposer&&0===e&&this._messageComposer.abortTextAutoCompletion()},this._onPress=(e,t)=>{e.stopPropagation(),e.preventDefault();const s=qe.default.newCauseId();Q.log(j.LogTraceArea.Navigation,"MessagePanel: onItemPress,  causeId: "+s),this._openGallery(t,s)},this._onInitialRenderComplete=()=>{this._maybeOpenGallery(),this.props.onInitialRenderComplete&&this.props.onInitialRenderComplete()},this._maybeOpenGallery=()=>{if(this._messageStream){const e=this._messageStream.getSkypeMessages(),{focusedMessageCuid:t,scrollToTimestamp:s,conversationId:o}=this.props;let n=i.find(e,(({cuid:e,createdTime:i})=>e===t||i===s));if(!n&&t&&(n=ee.default.getAlbumMessageByConversation(o,t)),n){const e=qe.default.newCauseId();Q.log(j.LogTraceArea.Navigation,"MessagePanel: _maybeOpenGallery, causeId: "+e),this._openGallery(n,e)}}},this._openGallery=(e,t)=>{if(oe.default.isMediaItem(e)||e.isAlbum()){this.state.useMobileUI||_e.default.closeGalleryPanel(t,this._getContext()),Q.track(new ue.MessageContentClicked(e)),Ie.pictureViewerWillOpen();let s=new Me.default(Me.ScenarioName.ViewMediaIntent);s.start();let i=e;const o=i.getAlbumId();if(i.isAlbum()){const t=ee.default.getNotFailedMediaMessagesForAlbum(e.getAlbumId());i=t&&t[0]}if(o){const e=ee.default.getSelectedMediaForAlbum(o);e&&(i=e,ee.default.removeSelectedMediaForAlbum(o))}i&&ie.default.showWithMessageConfig({initialMessage:i,animateOpenClose:!0,reverseOrder:!1,rootViewId:this._getRootViewId(),viewMediaIntentScenario:s,getContentNode:e=>this._mountedContentNodes[e],origin:j.NavigationMediaViewerOrigin.MessageStream}),this._dismissKeyboard()}},this._onMountContent=(e,t,s,i)=>{s?this._mountedContentNodes[i.cuid]={type:e,component:t}:delete this._mountedContentNodes[i.cuid]},this._onKeyboardPaste=e=>{const t=le.default.get(e.nativeEvent);this._onQuoteMessage(t,We.QuotesTriggerType.KeyboardCopyPaste),t.length>0&&Q.track(new ue.KeyboardMessagesTelemetry(this.props.conversationId,{messagesCount:t.length,actionType:pe.KeyboardActionType.KeyboardPaste}))},this._onQuoteMessage=(e,t)=>{this._sendSearchFirstSuccessfulAction(),this.isComponentMounted()&&this.setState({quotedMessages:e,showTranslatedMessage:i.every(e,(e=>!ye.default.isMyMri(e.creator))),editedMessage:void 0,quotesTriggerType:t})},this._onQuoteSelectionContextMenu=e=>{this._onQuoteMessage(e,We.QuotesTriggerType.ActionMenu)},this._onSuggestedCardAction=(e,t)=>{this.isComponentMounted()&&(e.type=W.SwiftMessageTypes.carousel,this.state.suggestedCards&&this.state.suggestedCards===e||this.isComponentMounted()&&this.setState({suggestedCards:e,suggestedAction:t}))},this._onSuggestionClicked=()=>{this._messageComposer&&(n.Accessibility.announceForAccessibility(Z.getString("MessageComposer.MessageSentLabel")),this._messageComposer.setTextInputAccessibilityFocus())},this._onScrolledToTheBottom=e=>{this.props.showBottomDivider&&this._scrolledToTheBottom!==e&&(this._scrolledToTheBottom=e,this._showOrHideDivider(this.props,this.state))},this._onScrolledToTheTop=()=>{Ve.default.getPlatformType()===j.PlatformType.Android&&this._dismissKeyboard()},this._onClearQuote=(e=!1)=>{const{quotesTriggerType:t}=this.state;e&&this.state.quotedMessages&&!i.isUndefined(t)&&this.state.quotedMessages.map((e=>Q.track(new ue.QuotesEventTelemetry(this.props.conversationId,e,e.createdTime,ue.MessageActionOrigin.MessageComposer,ue.MessageActionType.ClearQuote,t)))),this.isComponentMounted()&&this.setState({quotedMessages:void 0})},this._onClearEdit=()=>{this.isComponentMounted()&&this.setState({editedMessage:void 0})},this._onMessageEdit=e=>{this._sendSearchFirstSuccessfulAction(),this.isComponentMounted()&&this.setState({editedMessage:e,quotedMessages:void 0})},this._onEditLastMessage=()=>{let e;if(!C.isAgent(this.props.conversationId)&&!C.isS4BBridgeMri(this.props.conversationId)&&!this.state.e2eeHandshake){const t=this._messageStream&&this._messageStream.getSkypeMessages();e=i.findLast(t,(e=>ye.default.isMyMri(e.creator)&&v.getMessageTypeGroup(e)===v.MessageTypeGroups.Text))}e&&e.isMessageLie()&&(e=void 0),this.state.editedMessage!==e&&this.isComponentMounted()&&this.setState({editedMessage:e,quotedMessages:void 0})},this._postEphemeralMessage=e=>{this.isComponentMounted()&&this._messageStream&&this._messageStream.feedEphemeralMessage(e)},this._onCardsSent=()=>{this.isComponentMounted()&&this.setState({suggestedCards:void 0})},this._onGreet=()=>{this.props.isNewConversation&&this._shouldSendGreetingEvent&&this._sendGreetingEvent(k.GreetActionType.Greet),Ae.default.postMessageFromInput(this.props.conversationId,j.PostSource.StartChattingCard,q.convertRawTextToInputEntities("(wave)",!1,!1),v.MessageTypes.RichText,{name:Me.ScenarioName.SayHi},void 0,this._getRootViewType()),this._sendAddContactTelemetry(k.AddContactOrigin.ChatWave),this._sendFirstMessageTelemetry()},this._onMessageSent=(e,t)=>{if(this.props.isNewConversation&&C.isAgent(this.props.conversationId)&&this._botMessageTimerLimit&&Date.now()-this._botMessageTimerLimit<=6e4){const e=d.default.getAgentDescriptionForMri(this.props.conversationId);this._botMessageTimerLimit=void 0,Q.track(new m.BotMessageInteraction(e.agentId,e.displayName))}if(this._sendFirstMessageTelemetry(),y.default.identity().canUseSlashCommands){const t=this._processSlashCommand(e);if(!i.isUndefined(t))return t}if(this.state.sendLegacyInvite&&!this.state.isConversationAccepted&&!this.state.isIncomingContactInvitePending){const t=q.getRawText(e);P.default.addContact(this.props.conversationId,k.AddContactOrigin.NewConversation,t)}if(this.state.editedMessage)return Ae.default.editMessageFromInput(this.state.editedMessage,j.PostSource.MessagePanel,e),this.isComponentMounted()&&this.setState({editedMessage:void 0}),!0;const s=1===e.length&&e[0]instanceof K.SmsEntity?v.MessageTypes.Sms:v.MessageTypes.RichText;this.props.isNewConversation&&this._shouldSendGreetingEvent&&this._sendGreetingEvent(k.GreetActionType.Message);const o={name:Me.ScenarioName.SendTextMessage,secondaryScenariosToSpawnAtCreation:[{name:Me.ScenarioName.SendTextMessageUI},{name:Me.ScenarioName.SendTextMessageTimeToAppearInChat,timeout:2500}]},n=this.state.enableHandlingHyperlinkOnPaste||this.state.enableHandlingHTMLonPaste?{messageComposerAction:t,contentType:i.some(e,(e=>e instanceof K.LinkEntity))?ue.MessageComposerSentContentType.Link:(0,re.getTextMessageTypeFromContent)(this._getPlainTextFromInputEntities(e))}:void 0;let r;const a=i.first(e);if(a instanceof K.QuoteEntity){const e=a;e.quotedMessage&&e.quotedMessage.properties&&v.isHtmlMessageType(e.quotedMessage.messagetype)&&(r=v.getForwardedTeamsProperties(e.quotedMessage.properties))}const l=F.createMessageInfo(this.props.conversationId,j.PostSource.MessagePanel,e,s,r);de.default.notifyMessageSubmittedToPostingService(l.messageForPosting.clientmessageid),Ae.default.postMessage(l,void 0,o,this._getRootViewType(),n);const c=(0,R.default)().getConversation(this.props.conversationId),h=C.ConversationProps.NewConnectionMessageId;if(!C.isAgent(this.props.conversationId)&&this.state.isOneOnOneConversation&&this.state.isNewConnectionMessageEnabled&&!this.state.isContact&&!c.getConversationProperty(h)){const e=l.messageForPosting.clientmessageid;_.default.setConversationProperty(this.props.conversationId,h,e)}return this._sendAddContactTelemetry(k.AddContactOrigin.NewConversation),this._reportUnacknowledgedMessageReadLie(c,l.messageForPosting),this.props.onMessageSent&&this.props.onMessageSent(),!0},this._reportUnacknowledgedMessageReadLie=(e,t)=>{const s=i.find(e.memberConsumptionHorizonsSorted,(e=>e.id===ye.default.getSkypeMri()));if(s&&!this.state.hasReadReceiptsEnabled&&this.state.allowedMessageReadLieMs){new Date(t.composetime).getTime()-s.consumptionHorizonUpdateTime<this.state.allowedMessageReadLieMs&&this._trackMessageReadLieDebounced(t)}},this._trackMessageReadLieDebounced=i.debounce((e=>{Q.track(new ue.MessageReadLie(e,this.props.conversationId))}),6e4,{leading:!0}),this._setShowDragAndDropOverlayStateFalse=()=>{this.isComponentMounted()&&this.setState({showDragAndDropOverlay:!1})},this._setShowDragAndDropOverlayStateTrue=()=>{this.isComponentMounted()&&this.setState({showDragAndDropOverlay:!0})},this._onContactInviteAccepted=()=>{this.isComponentMounted()&&this.setState({isConversationAccepted:!0,isContactInviteJustAccepted:!0,isIncomingContactInvitePending:!1,isSkypeInviteAccepted:!0}),this.state.isOneOnOneConversation&&this.state.isNewConnectionMessageEnabled&&!this.state.isContact&&_.default.setConversationProperty(this.props.conversationId,C.ConversationProps.NewConnectionMessageId,C.newConnectionAcceptedPropValue),this.state.isOneOnOneConversation&&k.ContactsTelemetryHelper.addContactSuccess(this.props.conversationId,k.AddContactOrigin.AcceptButton)},this._onJumpToEndPress=()=>{this._setComposerAccessibilityFocus()},this._resetOngoingDownloads=()=>{g.default.hasDownloadsOnQueue(this.props.conversationId)&&g.default.cancelDownloadsByTag(this.props.conversationId)}}componentDidMount(){super.componentDidMount(),this._appStateSubscription=h.default.subscribeForChanges("MessagePanel",(e=>{e===n.Types.AppActivationState.Background&&this.state.isRecording&&this._onDoneRecording()})),this._newConversationSetup(this.props,this.state)}_newConversationSetup(e,t){const s=(0,R.default)(),i=s.getConversation(e.conversationId);i&&(this._lastDeletedTimestamp=i.getDeletedTimestamp()),this._storeConversationStyles(),this._showOrHideDivider(e,t),e.isNewConversation&&!t.isIncomingContactInvitePending&&(this._shouldSendGreetingEvent=!0,this._trackSendMessageOnce=!1),this._conversationUpdatedSubscription=s.subscribe(this._onConversationsStoreUpdate,e.conversationId),this._considerInviteMessageCountReached(i),this._composerContainerRef&&!t.useMobileUI&&this._composerContainerRef.setFocusLimited(!!e.isSelectMessagesModeActive);const o=this._showContactInviteHeader(e,t)&&this._showWave(t);Q.log(j.LogTraceArea.MessageStream,"Show wave:"+o+" isNewContactConversation: "+t.isNewContactConversation+" enableGreetingCard:"+t.enableGreetingCard+" isContactInviteJustAccepted:"+t.isContactInviteJustAccepted+" e2eeHandshake:"+t.e2eeHandshake+" isAnyMessageInTheStream:"+t.isAnyMessageInTheStream+" isPSTNOrSMSConversation: "+t.isPSTNOrSMSConversation),this._focusJoinCallButtonOnce=!!e.focusJoinCallButton}componentWillUnmount(){super.componentWillUnmount(),this._appStateSubscription&&(this._appStateSubscription.unsubscribe(),this._appStateSubscription=void 0),this._directShareFilesToken&&(this._directShareFilesToken.unsubscribe(),this._directShareFilesToken=void 0),this._oldConversationCleanup(),E.default.commit(this.props.conversationId)}_oldConversationCleanup(){this.props.isNewConversation&&this._shouldSendGreetingEvent&&this._sendGreetingEvent(k.GreetActionType.None),this._conversationUpdatedSubscription&&((0,R.default)().unsubscribe(this._conversationUpdatedSubscription),this._conversationUpdatedSubscription=void 0),me.default.deactivatePicker(),this._toggleRecording(!1),this.state.enableAutoDownloadFiles&&this._resetOngoingDownloads()}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t),e.conversationId!==this.props.conversationId&&this.setState({isContactInviteJustAccepted:!1})}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),t.isInCall&&!t.enableAutoDownloadFilesInCall&&this._resetOngoingDownloads(),this.props.enableConversationSwitchWithoutRemount&&this.props.conversationId!==e.conversationId&&(this._oldConversationCleanup(),this._newConversationSetup(e,t))}componentDidUpdate(e,t,s){if(super.componentDidUpdate(e,t,s),t.isRecording&&!this.state.isRecording&&this._messageComposer&&this._messageComposer.focusSendButton(),t.isAnimationPending&&!this.state.isAnimationPending&&this._shouldFocusMessageComposer&&this._setComposerAccessibilityFocus(),t.e2eeHandshakeState!==this.state.e2eeHandshakeState&&this._showOrHideDivider(this.props,this.state),this._spacerWidthUpdated&&this._storeConversationStyles(),this.props.conversationId!==e.conversationId&&E.default.commit(e.conversationId),t.isSearchingPes&&!this.state.isSearchingPes&&t.deviceOrientation===o.DeviceOrientation.Portrait&&this.state.deviceOrientation===o.DeviceOrientation.Landscape){const e=qe.default.newCauseId();Q.log(j.LogTraceArea.Navigation,"MessagePanel: componentDidUpdate,  causeId: "+e),t.pesTabType!==ke.TabType.Gif&&_e.default.navigateToPesSearch({searchType:t.pesTabType||ke.TabType.Emoticon,conversationId:this.props.conversationId,onMessageSent:this._onMessageSent,clearEditInChatsComposer:this._onClearEdit,causeId:e},this._getContext())}this.props.isSelectMessagesModeActive!==e.isSelectMessagesModeActive&&(this._composerContainerRef&&!this.state.useMobileUI&&this._composerContainerRef.setFocusLimited(!!this.props.isSelectMessagesModeActive),!this.props.isSelectMessagesModeActive&&this._messageComposer&&this._setComposerAccessibilityFocus())}onNavigateAway(){this.blur(),se.default.stopActivePlayer()}_buildState(e,t){const s=(0,R.default)().getConversation(e.conversationId),n=this._getRootViewId(),r=u.default.getS4LContactsFeatures(),a=!!s&&P.default.isConversationAccepted(s.id),l=!!s&&A.default.isSendImCapable(s),d=u.default.getEngagementFeatures().conciergeBotSettings.enableVisibility&&C.isConciergeBotMri(e.conversationId),c=C.isReadOnlyConversation(e.conversationId)||d,h=u.default.getS4LMessagingFeatures(),p=ze.default.useTabletUI(),g=C.isPhoneMri(e.conversationId),m=ve.default.isUsingStackNavigationContext(),f=!!s&&void 0!==s.lastMessage,_=Se.default.getValueOfDoNotFormatPreferenceOrFalseIfDisabled(e.conversationId),v=u.default.getS4LCommerceFeatures().sendCredit.enabled&&!!s&&xe.isSupportedConversation(s,a),b=!ve.default.isUsingStackNavigationContext()&&Ce.default.isCallChatShowing(n),T=S.default.messageToShowInChat(e.conversationId),M={isUsingStackNavigationContext:m,readOnlyConversation:c,useTabletUI:p,useMobileUI:m||p,responsiveWidth:Ee.default.getResponsiveWidth(n),deviceOrientation:Ee.default.getDeviceOrientation(n),isSendImCapable:l,enableInviteFree:r.enableInviteFree,sendLegacyInvite:r.sendLegacyInvite||r.sendLegacyInviteSfB&&C.isS4BBridgeMri(e.conversationId),isAnyMessageInTheStream:f,showSendCredit:v,showAddinLauncher:l&&!c&&u.default.getS4LIntegrationsFeatures().enableDesktop&&!m&&!C.isEncryptedThread(e.conversationId)&&!e.selectedNumberForSMS&&!g&&y.default.addins().canUseAddins&&!e.isSelectMessagesModeActive,maximumContactInviteMessageCount:r.maxContactInviteMessageCount,isAnimationPending:Te.default.isAnimationPending(),keyboardHeight:J.default.getUpdateInfo().height,isPSTNOrSMSConversation:g,e2eeHandshakeState:s&&s.isEncryptedThread()?H.default.getHandshakeState(e.conversationId):void 0,e2eeHandshake:s&&s.isEncryptedThread()?s.getEncryptionHandshake():void 0,enableGreetingCard:h.enableGreetingCard,isBlockedPSTNMri:C.isBlockedPSTNMri(e.conversationId),isBookmark:C.isBookmarkConversation(e.conversationId),isSearchingPes:me.default.isInlineSearchActive(),pesTabType:me.default.getActiveTabType(),hasReadReceiptsEnabled:fe.default.getReadReceiptsEnabled(),allowedMessageReadLieMs:1e3*h.readReceiptsAllowedLieTime,enableAutoDownloadFiles:h.enableAutoDownloadFiles,enableAutoDownloadFilesInCall:h.enableAutoDownloadFilesInCall,isInCall:Oe.default.isInCall(),setOverflowMenuButtonToPlainColor:h.setOverflowMenuButtonToPlainColor,canUseSlashCommands:y.default.identity().canUseSlashCommands,enableInCallFindPanel:h.enableInCallFindPanel,showCallerIDMessageType:T,enableHandlingHTMLonPaste:!_&&h.enableHandlingHTMLonPaste,enableHandlingHyperlinkOnPaste:!_&&h.enableHandlingHyperlinkOnPaste,hideInviteHeader:Ee.default.getDeviceOrientation(n)===o.DeviceOrientation.Landscape&&ze.default.isTablet()&&J.default.isKeyboardSeen(),enableComposerWithPopUpMenu:h.enableDesktopComposerWithPopUpMenu,postSource:b?j.PostSource.CallStage:j.PostSource.MessagePanel,isChild:Xe.default.isChild(),maxRecordingTimeMs:h.audioMessageMaxRecordingTimeMs};t&&(M.contentAreaHeight=0,M.isContactInviteJustAccepted=!1);const I=this.props;if((t||e.conversationId!==I.conversationId||I.scrollToTimestamp!==e.scrollToTimestamp||I.focusedMessageCuid!==e.focusedMessageCuid||I.forceRefreshFocus!==e.forceRefreshFocus)&&(M.isMaximumContactInviteMessageCountReached=!1,M.isRecording=!1,M.isSkypeInviteAccepted=!1,M.showDragAndDropOverlay=!1,t||e.conversationId===I.conversationId||(M.editedMessage=void 0,M.quotedMessages=void 0)),(t||e.conversationId!==I.conversationId||e.isFromSearch!==I.isFromSearch)&&(this._canSendSearchFirstSuccessAction=!!e.isFromSearch),M.isConversationAccepted=!0,s&&(!s.isOneOnOne()&&r.enableGroupInviteFree||s.isOneOnOne()&&!C.isAgent(e.conversationId))){M.isConversationAccepted=a,M.isIncomingContactInvitePending=!s.isEncryptedThread()&&(P.default.isIncomingContactInvitePending(s.id)||!!e.inviteToken&&(t||!this.state.isSkypeInviteAccepted)&&e.otherPartyMri&&!P.default.isContact(e.otherPartyMri)),t||(!this.state.isConversationAccepted&&M.isConversationAccepted&&(M.isContactInviteJustAccepted=!0),M.isConversationAccepted||(M.isContactInviteJustAccepted=!1)),Q.log(j.LogTraceArea.MessageStream,`Conversation: [id: ${Re.mriOrId(s.id)}, isConversationAccepted: ${M.isConversationAccepted}, isIncomingContactInvitePending: ${M.isIncomingContactInvitePending}, isContactInviteJustAccepted: ${M.isContactInviteJustAccepted}]`);const i=s.isOneOnOne()?s.getOtherPartyMri():void 0;if(r.overrideWithAddressBookName&&i)M.recipientDisplayName=O.default.getShortDisplayName(i);else{const t=O.default.getDisplayableProfile(e.conversationId);M.recipientDisplayName=t.getShortName()}M.isConversationAccepted&&(M.isMaximumContactInviteMessageCountReached=!1)}M.isOneOnOneConversation=!!s&&s.isOneOnOne(),s&&M.isOneOnOneConversation&&!s.isEncryptedThread()&&e.otherPartyMri?M.isContact=P.default.isManuallyAddedContact(e.otherPartyMri):M.isContact=!1,M.isNewConnectionMessageEnabled=u.default.getS4LContactsFeatures().enableNewConnectionMessage;const w=E.default.getSavedMessageInput(e.conversationId),k=w?w.messages:null;if(k&&k.length>0&&w)switch(w.type){case Fe.SavedMessageType.Edited:M.editedMessage=i.first(k);break;case Fe.SavedMessageType.Quoted:M.quotedMessages=k}M.e2eeHandshakeState?(t||e.conversationId!==I.conversationId)&&(M.showInviteHeaderForEncryptedThread=!!s&&!s.getThreadProperty(C.ThreadProps.SecureHandshakeOnceEstablished)):M.showInviteHeaderForEncryptedThread=!1,M.isNewContactConversation=M.isSendImCapable&&!M.isIncomingContactInvitePending&&!M.readOnlyConversation&&!M.isConversationAccepted;const L=M.isConversationAccepted&&!M.e2eeHandshake&&!e.selectedNumberForSMS;return M.showPesCategorySwitcher=M.isSearchingPes?L:L&&ze.default.isTablet()&&me.default.isPickerActive(),M.initialInputEntities=w?w.inputEntities:Je,M.initialInputEntitiesDataVersion=w?w.inputEntitiesDataVersion:0,M}requestFocus(){this._messageComposer&&this._messageComposer.requestFocus()}blur(){this._messageComposer&&this._messageComposer.blur()}focusTextInputForAccessibility(){this._setComposerAccessibilityFocus()}_dismissKeyboard(){this._messageComposer&&this._messageComposer.blurIfFocused()}_setComposerAccessibilityFocus(){this._messageComposer&&this._messageComposer.setTextInputAccessibilityFocus()}_allowsUpload(){return!this.state.e2eeHandshake&&this.props.allowUploads}render(){return this.state.isBookmark?this._updateBookmarkStreamSpacers():this._updateMessageStreamSpacers(),n.createElement(n.View,{style:He.default.flexOne},this._getContactInviteHeader(),this._getMessageStream())}_updateMessageStreamSpacers(){this._leftMessageStreamSpacerWidth=0,this._rightMessageStreamSpacerWidth=0,this._spacerWidthUpdated=!1;const e=this._getContext().isPresentedInDesktopLeftNav||this._getContext().isPresentedInDesktopRightNav;!(!this._getContext().isPresentedInDesktopSubview||e&&this.state.enableInCallFindPanel)||this.state.useMobileUI||this.props.isHighlightCommentMode?this._getContext().isPresentedInDesktopSubview?(this._leftMessageStreamSpacerWidth=5,this._rightMessageStreamSpacerWidth=15,this._spacerWidthUpdated=!0):this.state.useTabletUI&&(this._leftMessageStreamSpacerWidth=$e,this._rightMessageStreamSpacerWidth=$e,this._spacerWidthUpdated=!0):(this.state.isRenderedIn4ColumnWidth?this._leftMessageStreamSpacerWidth=$e:(this._rightMessageStreamSpacerWidth=80-he.messageStreamOverflowWidth,this._leftMessageStreamSpacerWidth=80-he.messageStreamOverflowWidth),this._spacerWidthUpdated=!0)}_updateBookmarkStreamSpacers(){{const e=this.state.isRenderedIn4ColumnWidth?30:100;this._leftMessageStreamSpacerWidth=e,this._rightMessageStreamSpacerWidth=e}this._spacerWidthUpdated=!0}_getContactInviteHeader(){if(this.state.hideInviteHeader)return;let e;return this._hasPendingIncomingContactRequest()?this.state.isUsingStackNavigationContext||(e=n.createElement(w.default,{key:this.props.conversationId,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,isIncomingContactInvitePending:this.state.isIncomingContactInvitePending,onIncomingContactInviteAccepted:this._onContactInviteAccepted,inviteToken:this.props.inviteToken})):this._showContactInviteHeader(this.props,this.state)&&(e=n.createElement(w.default,{key:this.props.conversationId,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,isIncomingContactInvitePending:!1,isContactInviteJustAccepted:this.state.isContactInviteJustAccepted,isEncryptedConversationEstablished:this._isEncryptedConversationEstablished(),isAnyMessageInTheStream:this.state.isAnyMessageInTheStream,showWave:this._showWave(this.state),onGreet:this._onGreet})),e}_getMessageStream(){let e;const t=this._getContext().isPresentedByMobileStackNavigator;e=this.props.hasUnderlay?[He.default.flexOne,He.default.transparentBackground]:[He.default.flexOne,this._themeStyles.messageStreamBackgroundColorStyle],this.props.containerStyleOverride&&e.push(this.props.containerStyleOverride);let s=n.createElement(n.View,{style:[e,t?Ye.paddingMobileBrowser:void 0]},this._getNetworkConnectionAlert(),n.createElement(n.View,{style:Ye.contentOuterContainer},this._getContentArea(),this._getOptionalAutoSuggestionCompletion()),this._getMessageComposerArea(),this._getDragAndDropOverlay());return f.UICapabilities.dragAndDropSupported()&&this._allowsUpload()&&(s=n.createElement(V.default,{origin:te.FilePickerOrigin.DragAndDropToMessagePanel,style:e,conversationId:this.props.conversationId,onDragEnter:this._setShowDragAndDropOverlayStateTrue,onDragLeave:this._setShowDragAndDropOverlayStateFalse,onDropCompleted:this._setShowDragAndDropOverlayStateFalse,dropTargetSource:N.DropTargetOrigin.MessagePanel},s)),s}_getMessageComposerArea(){if(this.state.isBookmark)return;if(this._hasPendingIncomingContactRequest())return;if(this.props.isMessageSearchPanelVisible&&(this.state.useMobileUI||this.state.useTabletUI))return;const e=r.BrowserEnvironment.isMobile(),t=[Ye.messageComposerOuterContainerHorizontal,this._themeStyles.messageStreamBackgroundColorStyle];this.state.useMobileUI&&!e||t.push(Ye.messageComposerContainerDesktop);const s=[Ye.messageComposerHorizontalSpacer],i=[Ye.messageComposerHorizontalSpacer],o=Ye.messageComposerHorizontalSpacerDesktop;this.state.useMobileUI||(s.push(o),i.push(o));const a=this.state.responsiveWidth<=Ue.ResponsiveWidth.Tiny,l=this.state.responsiveWidth<=Ue.ResponsiveWidth.Small,d=this._getContext().isPresentedInDesktopLeftNav||this._getContext().isPresentedInDesktopRightNav;!(!this._getContext().isPresentedInDesktopSubview||d&&this.state.enableInCallFindPanel)||this.state.useMobileUI||this.props.isHighlightCommentMode?this._getContext().isPresentedInDesktopSubview?(s.push(Ye.messageComposerHorizontalTinySpacer),i.push(Ye.messageComposerHorizontalTinySpacer)):(this.state.useTabletUI||e)&&(s.push(Ye.messageComposerHorizontalSmallSpacer),i.push(Ye.messageComposerHorizontalSmallSpacer)):(s.push(Ye.defaultRightSpacerStyle),this.state.enableComposerWithPopUpMenu&&s.push(Ye.defaultRightSpacerStyleForComposerWithPopup),this.state.isRenderedIn4ColumnWidth?(this.state.showAddinLauncher||s.push(Ye.messageComposerHorizontalSmallSpacer),i.push(Ye.messageComposerHorizontalSmallSpacer)):(s.push(Ye.messageComposerHorizontalBigSpacer),i.push(Ye.messageComposerHorizontalBigSpacer))),a||this._getContext().isPresentedInDesktopSubview||this.state.useMobileUI||this.state.isRenderedIn4ColumnWidth||(i.push(Ye.toggleLeftPanelButtonContainer),l&&i.push(Ye.toggleLeftPanelButtonContainerSmallView));const c=[Ye.messageComposerOuterContainerVertical,this.state.useMobileUI?void 0:this._messageComposerOpacityStyle];let h;return this.state.isSearchingPes&&this.state.useMobileUI&&(c.push(Ye.hideComposer),h=n.Types.ImportantForAccessibility.NoHideDescendants),n.createElement(n.Animated.View,{key:"composer",ref:this._onComposerContainerRef,style:c,limitFocusWithin:n.Types.LimitFocusType.Limited,importantForAccessibility:h},n.createElement(n.View,{style:i}),n.createElement(n.View,{style:t},this._getMessageComposerInner()),n.createElement(n.View,{style:s},this._getToggleSideBarButton()))}_getToggleSideBarButton(){if(this.state.enableComposerWithPopUpMenu)return;let e;const t=this._getContext().isPresentedInDesktopLeftNav||this._getContext().isPresentedInDesktopRightNav;if((!this._getContext().isPresentedInDesktopSubview||t&&this.state.enableInCallFindPanel)&&!this.state.useMobileUI&&!this.props.isHighlightCommentMode&&this.state.showAddinLauncher&&!this.props.isSelectMessagesModeActive&&!this.state.isMaximumContactInviteMessageCountReached){const t=this.props.isFindPanelHidden?Z.getString("MessageComposerOverflow.AddTitle"):Z.getString("MessageComposerOverflow.CloseTitle");let s;if(this.state.setOverflowMenuButtonToPlainColor){const{buttonBackgroundColor:e,primaryTextColor:t}=this._themeColors;s={backgroundColor:e,iconColor:t}}e=n.createElement(b.default.ActionButton,Object.assign({coachMarkType:T.CoachMarkType.ChatPlus,onAnchorPress:this._toggleDesktopFindPanel,anchorAccessibilityLabel:t,size:a.ActionButtonSize.Small,title:t,accessibilityLabel:t,onPress:this._toggleDesktopFindPanel,style:Ye.sidebarButton,icon:this.props.isFindPanelHidden?Ne.SkypeIcon.Plus:Ne.SkypeIcon.ClosePanel,deselected:!this.props.isFindPanelHidden,hideBorder:!0,useSmallIcon:!0,disabled:this.props.isSelectMessagesModeActive},s))}return e}_getMessageComposerInner(){let e;return e=this._shouldShowHandshakeControl(this.state)?this._getE2eeHandshakeControl():this.state.isRecording?this._getAudioComposer():!this.state.isSendImCapable||this.state.readOnlyConversation||this.state.isMaximumContactInviteMessageCountReached||this.state.isBlockedPSTNMri?this._getDisabledComposer():this.state.isBookmark?void 0:this._getMessageComposer(),e}_getDisabledComposer(){const e=this.state.isMaximumContactInviteMessageCountReached?Z.getString("MessageStream.MaximumContactInviteMessagesWarning",{recipientDisplayName:this.state.recipientDisplayName}):Z.getString("MessageStream.MessagingUnavailable");return n.createElement(n.View,{style:Ye.messagingUnavailableContainer},n.createElement(je.BodyText,{size:je.BodyTextSize.SmallDeprecated,style:Ye.messagingUnavailablePlaceholder,textThemeColor:je.TextThemeColor.Disabled},e))}_getMessageComposer(){const e=[Ye.messageComposerInner];this.props.safeAreaHorizontalInsets&&Le.default.hasHorizontalSafeAreas(this.props.safeAreaHorizontalInsets)&&e.push(Le.default.horizontalPaddingStyle(this.props.safeAreaHorizontalInsets)),this.state.useTabletUI&&e.push(Ye.tabletMessageComposer);const t=!!this.state.e2eeHandshake,s=!this._allowsUpload();return n.createElement(n.View,{style:e},n.createElement(ne.default,{key:this.props.conversationId,ref:this._onMessageComposerRef,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,disableCopyPasteMedia:s,initialInputEntities:this.state.initialInputEntities,initialInputEntitiesDataVersion:this.state.initialInputEntitiesDataVersion,maxLength:this.state.isConversationAccepted?void 0:400,shouldAutoFocus:this.props.shouldAutoFocusInput,preventAccessibilityFocus:this.props.preventAccessibilityFocus||this.props.isSelectMessagesModeActive,availableWidth:this.props.availableWidth,hideMediaBar:this.props.hideMediaBar||this.props.isSelectMessagesModeActive,hideMojiPickerIcon:!this.state.isConversationAccepted||t,hideStickerPickerIcon:!this.state.isConversationAccepted||t,hideSendCreditIcon:!this.state.showSendCredit||t,hideFilePicker:!this.state.isConversationAccepted&&!t||t,hideScheduleCallIcon:C.isAgent(this.props.conversationId)||t,hidePollIcon:t,hideMediaPickerIcon:!0,hideLocationPickerIcon:this.state.isChild||t,hideContactPickerIcon:t,hideVideoMessageIcon:this._getContext().isPresentedByMobileStackNavigator,hideAudioMessage:t,headerHeightAndroid:this.props.headerHeightAndroid,quotedMessages:this.state.quotedMessages,quotesTriggerType:this.state.quotesTriggerType,editedMessage:this.state.editedMessage,suggestedCards:this.state.suggestedCards,suggestedAction:this.state.suggestedAction,showTranslatedMessage:this.state.showTranslatedMessage,onClearQuotedMessage:this._onClearQuote,onClearEdit:this._onClearEdit,onMessageSent:this._onMessageSent,onEditLastMessage:this._onEditLastMessage,onInputTextChanged:this._onInputTextChanged,onKeyPress:this._onKeyPress,onRecording:this._onRecording,onLaunchCamera:this.props.onLaunchCamera,onCardsSent:this._onCardsSent,onShowOverflow:this._onShowOverflow,onShowGestureHint:this.props.onShowGestureHint,onHandleOverflow:this.props.onHandleOverflow,onNativeComposerMessageEmptyStateChanged:this._onNativeComposerMessageEmptyStateChanged,onKeyboardPaste:this._onKeyboardPaste,hideContentInMessageComposer:this.props.isSelectMessagesModeActive,inlineSearchModeActive:this.state.isSearchingPes,explicitAccessibilityAnnoucement:!1,preventFocusOnMount:!!this.props.focusedMessageCuid,phoneNumberForSendingSms:this.props.selectedNumberForSMS,isInCall:this.state.isInCall,isInConversationBubbleMode:this.props.isInConversationBubbleMode}))}_getAudioComposer(){return n.createElement(n.View,{style:Ye.messageComposerInner},n.createElement(p.default,{key:this.props.conversationId,conversationId:this.props.conversationId,onDone:this._onDoneRecording,maxRecordingTimeMs:this.state.maxRecordingTimeMs}))}_getE2eeHandshakeControl(){return n.createElement(n.View,{style:Ye.messageComposerInner},n.createElement(U.default,{key:this.props.conversationId,conversationId:this.props.conversationId,e2eeHandshakeState:this.state.e2eeHandshakeState,e2eeHandshake:this.state.e2eeHandshake}))}_getContentArea(){const e={width:this.state.contentAreaWidth,height:this.state.contentAreaHeight};Q.debug((()=>["DIM_CALC - message panel - contentAreaWidth: ",this.state.contentAreaWidth," contentAreaHeight: ",this.state.contentAreaHeight]));const t=this._hasPendingIncomingContactRequest(),s=this._isComposingIndicatorDisabled(),i=this._isEncryptedConversationEstablished();return n.createElement(ce.default,{key:this.props.conversationId,ref:this._onMessageStreamRef,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,focusedMessageCuid:this.props.focusedMessageCuid,forceRefreshFocus:this.props.forceRefreshFocus,hasUnderlay:!!this.props.hasUnderlay,isHighlightCommentMode:this.props.isHighlightCommentMode,topInset:this.props.topInset,disableComposingIndicator:s,isConversationAccepted:this.state.isConversationAccepted,isIncomingContactInvitePending:this.state.isIncomingContactInvitePending,isContactInviteJustAccepted:this.state.isContactInviteJustAccepted,recipientDisplayName:this.state.recipientDisplayName,renderOrigin:this.props.renderOrigin,onItemPress:this._onPress,containerInitialDimensions:e,onUserScrolledToTheTop:this._onScrolledToTheTop,onScrolledToTheBottom:this._onScrolledToTheBottom,onGreet:this._onGreet,onQuoteMessage:this._onQuoteMessage,onQuoteSelectionContextMenu:this._onQuoteSelectionContextMenu,onMessageEdit:this._onMessageEdit,onCardSuggestionAction:this._onSuggestedCardAction,onSuggestionClicked:this._onSuggestionClicked,onMountContent:this._onMountContent,onMessageStreamLayout:this._onMessageStreamLayout,onMessageStreamScreenReaderFocusUpdated:this._onMessageStreamScreenReaderFocusUpdated,onContactInviteAccepted:this._onContactInviteAccepted,onJumpToEndPress:this._onJumpToEndPress,inviteToken:this.props.inviteToken,safeAreaHorizontalInsets:this.props.safeAreaHorizontalInsets,leftSpacerWidth:this._leftMessageStreamSpacerWidth,rightSpacerWidth:this._rightMessageStreamSpacerWidth,onInitialRenderComplete:this._onInitialRenderComplete,isInvisible:this.props.isInvisible,renderDivider:this._shouldRenderDivider()?this._divider:void 0,showInviteHeaderForEncryptedThread:this.state.showInviteHeaderForEncryptedThread,isEncryptedConversationEstablished:i,isSelectMessagesModeActive:this.props.isSelectMessagesModeActive,disableSelectMultipleMessages:this._getContext().isPresentedInDesktopSubview,disableForward:this.props.isHighlightCommentMode,disableReportMessage:this.props.disableReportMessage,disablePlugins:this.props.disablePlugins,hideSuggestions:t,isMessageSearchPanelVisible:this.props.isMessageSearchPanelVisible,preventAccessibilityFocus:this.props.preventAccessibilityFocus,isTranslatedConversation:this.props.isTranslatedConversation,searchStore:this.props.searchStore})}_isComposingIndicatorDisabled(){return!!this.state.e2eeHandshake&&this.state.e2eeHandshakeState!==z.SecureHandshakeState.Completed||this.state.isBookmark}_getOptionalAutoSuggestionCompletion(){if(this.state.isBookmark)return;let e;if(this.state.isSearchingPes&&this.state.useMobileUI)e=n.createElement(Pe.PesInlineSearchContainer,{conversationId:this.props.conversationId,insertSearchResultToComposer:this._insertSearchResultsToComposer,pesTabType:this.state.pesTabType,showPesCategorySwitcher:this.state.showPesCategorySwitcher,showInLandscape:this.state.useTabletUI,containerWidth:this.state.contentAreaWidth});else{const t=this._getAvailableHeight();if(t>0){const s=Math.max((this.state.contentAreaWidth-he.maxStreamContentWidth)/2,0),i=this.state.canUseSlashCommands&&!this.state.quotedMessages;e=n.createElement(ge.MessageTextCompletion,{ref:this._onTextCompletionRef,style:this.state.useMobileUI?Ye.messageTextCompletion:void 0,conversationId:this.props.conversationId,showSlashCommands:i,onReplaceText:this._onReplaceText,onTextReplacementCandidatesShown:this._onTextReplacementCandidatesShown,maxMenuHeight:t,leftOffset:s})}}return e}_getNetworkConnectionAlert(){let e;return this.state.isUsingStackNavigationContext&&(e=n.createElement(be.default,null)),e}_getDragAndDropOverlay(){if(this.state.isBookmark)return;let e;return this.state.showDragAndDropOverlay&&this._allowsUpload()&&(e=n.createElement(B.default,null)),e}_isEncryptedConversationEstablished(){return this.state.e2eeHandshakeState?this.state.e2eeHandshakeState===z.SecureHandshakeState.Completed:void 0}_hasPendingIncomingContactRequest(){return this.state.isSendImCapable&&this.state.isIncomingContactInvitePending&&!this.state.readOnlyConversation}_shouldRenderDivider(){return this.state.useMobileUI}_getAvailableHeight(){const e=(0,ce.useAltMsgView)()?this.state.contentAreaHeight:this.state.contentAreaHeight-this.state.keyboardHeight;return Math.max(0,e)}_considerNavigationAfterDeleteConversation(e){if(e&&this._lastDeletedTimestamp<e.getDeletedTimestamp()){const e=qe.default.newCauseId();Q.log(j.LogTraceArea.Navigation,"MessagePanel._onConversationsStoreUpdate causeId: "+e),_e.default.navigateAfterDeleteConversation(this.props.conversationId,e,this._getContext())}}_considerRefreshingContactsStore(e){e&&e.isOneOnOne()&&!C.isAgent(this.props.conversationId)&&e.getConversationStatus()===j.ConversationStatus.AcceptPendingSender&&P.default.isConversationAccepted(e.id)&&P.default.triggerContactsRefresh()}_considerInviteMessageCountReached(e){let t=this.state&&this.state.isConversationAccepted;if(t)return;const s=e&&e.getAcceptPendingMessageCount(),o=!i.isUndefined(s)&&s>=this.state.maximumContactInviteMessageCount,n=!t&&!C.isReadOnlyConversation(this.props.conversationId)&&!this.state.isPSTNOrSMSConversation&&o;this.isComponentMounted()&&this.setState({isMaximumContactInviteMessageCountReached:n,isConversationAccepted:t})}_toggleRecording(e){if(e&&!this.state.isRecording){if(this.isComponentMounted()){let e=Ue.PermissionPromptOptions.SkipPrePrompt;0,we.default.requestPermission(Ue.PermissionType.Microphone,e).then((e=>{e===X.PermissionStatus.Granted&&this.setState({isRecording:!0})}))}o.default.blockScreenLock().catch((e=>{Q.warn(j.LogTraceArea.MessageStream,"blockScreenLock failed: "+Be.default.errorAsString(e))}))}else!e&&this.state.isRecording&&(this.isComponentMounted()&&this.setState({isRecording:!1}),o.default.allowScreenLock().catch((e=>{Q.warn(j.LogTraceArea.MessageStream,"allowScreenLock failed: "+Be.default.errorAsString(e))})))}_shouldShowHandshakeControl(e){return e.e2eeHandshake&&e.e2eeHandshakeState&&e.e2eeHandshakeState!==z.SecureHandshakeState.Completed}_showOrHideDivider(e,t){if(!e.showBottomDivider)return;const s=this._shouldShowHandshakeControl(t)||!this._scrolledToTheBottom;this._dividerOpacityValue.setValue(s?1:0)}_postCallerIdMessage(){if(this.state.showCallerIDMessageType){const e=F.createCallerIdMessage(this.props.conversationId,this.state.showCallerIDMessageType);S.default.notifyMessageShown(this.props.conversationId),this._postEphemeralMessage(e),this.isComponentMounted()&&this.setState({showCallerIDMessageType:void 0})}}_processSlashCommand(e){const t=De.findSlashCommand(this.props.conversationId,e);switch(t.result){case De.FindResult.InvalidLooksLikeCommand:const s=Z.getString("MessageComposer.InvalidSlashCommand"),i=F.createMessageInfoFromEscapedText(this.props.conversationId,j.PostSource.SlashCommand,s);return this._postEphemeralMessage(i),!1;case De.FindResult.FoundCommand:Q.log(j.LogTraceArea.MessagePanel,`Running slashCommand ${t.command}`);const o=(0,G.get)(t,["command","action"]),n=(0,G.get)(t,["params"])||"";if(o){const t=o(n,this.props.conversationId,e,this._postEphemeralMessage);switch(t){case $.ActionResult.None:return!0;case $.ActionResult.InvalidParameters:const e=Z.getString("MessageComposer.InvalidSlashCommandParameters",{parameters:n}),s=F.createMessageInfoFromEscapedText(this.props.conversationId,j.PostSource.SlashCommand,e);return this._postEphemeralMessage(s),!1;default:qe.default.switchStatementExhaustiveChecking(t,"Missing case for SlashCommand.ActionResult")}}return!1;case De.FindResult.None:return;default:qe.default.switchStatementExhaustiveChecking(t.result,"Missing case for SlashCommand.FindResult")}}_sendAddContactTelemetry(e){this.state.isContact||C.isAgent(this.props.conversationId)||!this.state.isOneOnOneConversation||this._trackAddContactOnce||(this._trackAddContactOnce=!0,k.ContactsTelemetryHelper.addContactSuccess(this.props.conversationId,e))}_sendFirstMessageTelemetry(){this.props.isFromPeopleRecommendations&&!this._trackSendMessageOnce&&(this._trackSendMessageOnce=!0,Ke.messageSent(this.props.conversationId))}_sendGreetingEvent(e){k.ContactsTelemetryHelper.greetContact(this.props.conversationId,e),this._shouldSendGreetingEvent=!1}_showWave(e){return e.enableGreetingCard&&!e.isContactInviteJustAccepted&&!e.e2eeHandshake&&!e.isAnyMessageInTheStream&&!e.isPSTNOrSMSConversation}_showContactInviteHeader(e,t){return!t.isUsingStackNavigationContext&&(t.isNewContactConversation||t.showInviteHeaderForEncryptedThread||t.isContactInviteJustAccepted)&&!C.isPhoneMri(e.conversationId)}_sendSearchFirstSuccessfulAction(){this.props.isFromSearch&&this._canSendSearchFirstSuccessAction&&(Ke.messageTypingStarted(this.props.conversationId),this._canSendSearchFirstSuccessAction=!1)}_getPlainTextFromInputEntities(e){return this.state.enableHandlingHTMLonPaste||this.state.enableHandlingHyperlinkOnPaste?i.reduce(e,((e,t)=>(t instanceof K.UnhandledEntity&&(e+=t.text()),e)),""):""}}t.default=Ze},29308:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useAltMsgView=void 0;const i=s(74958),o=s(96486),n=s(6961),r=s(16778),a=(s(23095),s(89391)),l=s(20490),d=s(38438),c=s(5531),h=s(81169),u=s(22801),p=s(71908),g=s(51077),m=s(81697),S=s(71830),f=s(98278),y=s(63060),_=s(842),v=s(38386),C=s(75760),b=s(39549),T=s(82261),M=s(99686),I=s(16402),w=s(6217),P=s(77388),k=s(70891),A=s(46096),E=s(91771),R=s(49770),L=s(36237),F=s(74822),x=s(61253),O=s(31894),D=s(15877),B=s(47662),V=s(33754),N=s(18606),U=s(17589),H=s(14572),z=s(51470),W=s(6658),j=s(50353),G=s(12056),K=s(12056),q=s(10909),Q=s(57538),X=s(44972),$=s(93486),J=s(89808),Y=s(78735),Z=s(46929),ee=s(18078),te=s(4735),se=s(30124),ie=s(96285),oe=s(13847),ne=s(53172),re=s(85207),ae=s(43898),le=s(3404),de=s(29130),ce=s(14976),he=s(15963),ue=s(44487),pe=s(55585),ge=s(15761),me=s(65988),Se=s(99948),fe=s(44352),ye=s(80760),_e=s(52333),ve=s(67806),Ce=s(7698),be=s(67241),Te=s(58774),Me=s(30428),Ie=s(23802),we=s(15415),Pe=s(40363),ke=(s(80837),s(19675)),Ae=s(24576),Ee=s(12770),Re=s(2301),Le=s(67977),Fe=s(72758),xe=s(53374),Oe=s(69015),De=s(6977),Be=s(10996),Ve=s(69399);class Ne{constructor(e,t,s,i){this.key=e,this.skypeMessage=t,this.shouldItemFocusOnMobile=s,this.height=i,this.focusable=!0}}class Ue{constructor(e,t,s,i=24){this.key=e,this.readReceiptsHeads=t,this.readReceiptsSum=s,this.height=i,this.focusable=!0}}class He{constructor(e,t,s=36){this.key=e,this.dateOfMarker=t,this.height=s,this.focusable=!1}}class ze{constructor(e,t,s=be.ItemListKey.Composing,i=45){this.composingMris=e,this.conversationId=t,this.key=s,this.height=i,this.focusable=!1}}class We{constructor(e=be.ItemListKey.UnreadMarker,t=36,s=!1){this.key=e,this.height=t,this.focusItemOnMountOnMobile=s,this.focusable=!0}}class je{constructor(e=be.ItemListKey.NewConnection,t=32,s=!1){this.key=e,this.height=t,this.focusItemOnMount=s,this.focusable=!0}}class Ge{constructor(e,t=be.ItemListKey.ReadOnlyChatHeader,s=300){this.conversationId=e,this.key=t,this.height=s,this.focusable=!0}}class Ke{constructor(e=be.ItemListKey.ContactInviteHeaderItem,t,s,i,o,n,r){this.key=e,this.height=t,this.showWave=s,this.isContactInviteJustAccepted=i,this.isContactInvitePending=o,this.isEncryptedConversationEstablished=n,this.isAnyMessageInTheStream=r,this.focusable=!0}}class qe{constructor(e,t=be.ItemListKey.InviteMorePeople,s=60){this.conversationId=e,this.key=t,this.height=s,this.focusable=!0}}class Qe{constructor(e,t=be.ItemListKey.InviteMorePeople,s=480){this.conversationId=e,this.key=t,this.height=s,this.focusable=!0}}class Xe{constructor(e,t=be.ItemListKey.InviteMorePeople,s=480){this.conversationId=e,this.key=t,this.height=s,this.focusable=!0}}class $e{constructor(e,t=be.ItemListKey.SpeechConsent,s=480){this.conversationId=e,this.key=t,this.height=s,this.focusable=!0}}const Je=3e5,Ye=Number.MAX_VALUE,Ze=(0,D.lazyProperties)({contentOuterContainer:()=>r.Styles.createViewStyle({flex:1,alignSelf:"stretch",backgroundColor:"transparent"}),spinnerContainer:()=>r.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",justifyContent:"center"}),contactInviteUserIcon:()=>r.Styles.createViewStyle({alignSelf:"center",marginVertical:4}),composingIndicatorContainerMobile:()=>r.Styles.createViewStyle({marginHorizontal:10}),composingIndicatorContainerDesktop:()=>r.Styles.createViewStyle({marginHorizontal:0}),actionsDesktopContainer:()=>r.Styles.createViewStyle({flex:-1,flexDirection:"row",overflow:"visible"}),noMessagesContainer:()=>r.Styles.createViewStyle({position:"absolute",top:0,left:20,right:20,bottom:0,justifyContent:"center"}),contentAreaContainer:()=>r.Styles.createViewStyle({flex:1,height:200}),groupEngagementButtons:()=>r.Styles.createViewStyle({flex:0,flexDirection:"row",paddingHorizontal:25,alignSelf:"stretch",justifyContent:"center",flexWrap:"wrap",alignItems:"stretch"}),groupEngageButtonStyle:()=>r.Styles.createButtonStyle({marginHorizontal:5,marginVertical:10,minWidth:200}),newConnectionContainer:()=>r.Styles.createViewStyle({flex:1,alignItems:"center",height:32,paddingTop:5})}),et={};function tt(){return!1}t.useAltMsgView=tt;class st extends Ae.default{constructor(){super(...arguments),this._lockUpdatesToConsumptionHorizon=!1,this._topPartialViewIndex=-1,this._topWholeViewIndex=-1,this._bottomWholeViewIndex=-1,this._bottomPartialViewIndex=-1,this._lastViewIndex=0,this._lastReceivedMessageTimestamp=0,this._lastSentMessageTimestamp=0,this._lastMessageTimestamp=0,this._lastSentMessageTimestampInitial=0,this._skypeMessages=[],this._unreadMarkerShown=!1,this._unreadMarkerTimestamp=0,this._unreadMarkerMessageIndex=-1,this._unreadMarkerViewIndex=-1,this._isUserPresentInApp=!0,this._isUserScrolling=!1,this._readOnlyConversation=!1,this._oldConsumptionHorizonTimestamp=Ye,this._currentConsumptionHorizonTimestamp=Ye,this._composingMris=[],this._contentRendered=!1,this._disallowFetchingMoreMessagesFromStore=!1,this._isFocusInsideMessageStreamOnMount=!1,this._isMessageStreamFocusStatusNotified=!1,this._virtualMessageViewRefCount=0,this._openAnimationCompleted=!1,this._readReceiptsKeysCounter=0,this._firstUpdateCompleteForMutliSelect=!1,this._readReceiptsThrottleTimeout=a.default.getS4LMessagingFeaturesNoSubscription().messageReadEventTimeout,this._sendMessageReadEventThrottled=L.throttleTrack(this._readReceiptsThrottleTimeout),this._statusPillInstance=new fe.default,this._lastMessageFullyVisible=!1,this._shouldFocusLastMessage=!1,this._streamItemRefs={},this._speechConsentSuggestionSeenAt=-1,this._initialRenderCompleted=!1,this._instrumentationCallback=(e,t,s)=>{t&&t!==A.LogTraceArea.MessageStream&&t!==A.LogTraceArea.MessageStreamDebug&&t!==A.LogTraceArea.MessageStreamStore&&t!==A.LogTraceArea.MessageStreamStoreDebug&&t!==A.LogTraceArea.VirtualMessageView&&t!==A.LogTraceArea.VirtualMessageViewDebug&&t!==A.LogTraceArea.ConsumptionHorizon&&o.defer((()=>{if(this.isComponentMounted()){const n=e===i.LogLevel.Error?"Error":e===i.LogLevel.Warning?"Warning":e===i.LogLevel.Trace?A.LogTraceArea[t]:e===i.LogLevel.Debug1?"Info":e===i.LogLevel.Debug3?"Log":e===i.LogLevel.Debug4?"Debug":"Unknown",r=T.createMessageInfoFromEscapedText(S.SkonsoleMri,A.PostSource.EphemeralMessage,"["+n+"] "+o.map(s,(e=>e+"")).join(""));this._checkMessageStreamStoreAndUpdate(this.props,this.state.scrollRequest,"in defer call of _instrumentationCallback"),this.feedEphemeralMessage(r)}}))},this._onMessageStreamStoreTrigger=()=>this.isComponentMounted()&&!this.props.isInvisible?this._updateStreamItemsAndReturnNewState(this.props):{},this._applyModificationsDebounced=o.debounce(((e,t,s=this.props,i)=>{this.isComponentMounted()&&!this.props.isInvisible&&(this._checkMessageStreamStoreAndUpdate(s,i?{id:xe.default.newGuid(),messageTimestamp:i}:void 0,"in debounced call of _applyModificationsDebounced"),this._applyModifications(e,t,s,i))}),100),this._equalsItemInfo=(e,t)=>e instanceof Ne&&t instanceof Ne?e.key===t.key&&e.skypeMessage===t.skypeMessage:y.default.comparator(e,t),this._onMountItem=(e,t)=>{t&&(this._mountedItemToFocus=e)},this._onVisibleRangeChanged=(e,t,s,i)=>{if(!this.isComponentMounted()||this.props.isInvisible)return;const n=this._dataItemsInfo.getItemList();this._lastViewIndex=n.length-1;const r=this._topWholeViewIndex!==s,a=n[i>=0?i:t];a instanceof Ne&&this._reportRenderItemQoS(a.skypeMessage,!0),this._topPartialViewIndex=e,this._bottomPartialViewIndex=t,this._bottomWholeViewIndex=i,this._topWholeViewIndex=s,this._checkForConsumptionHorizonChange(),this._checkForReactionConsumptionHorizonChange();const l=this.state.scrollToItemViewIndex;if((this._scrollToMessage||this._scrollToUnreadMarker||this.props.isIncomingContactInvitePending)&&o.isNumber(l)){l<=t&&l>=e&&(this._scrollToMessage=!1,this._scrollToUnreadMarker=!1)}const d=0===s,c=i===this._lastViewIndex,h=!this._messageStreamStore.isLatestMessageTheEnd()||i<=this._lastViewIndex-5;if(this._lastMessageFullyVisible!==c&&this.state.canShowSuggestions&&(this._lastMessageFullyVisible=c,this._suggestionsListView&&this._suggestionsListView.animateSuggestions(c)),!this._isMessageStreamFocusStatusNotified){let e=!1;this._isFocusInsideMessageStreamOnMount&&(e=!0),this.props.onMessageStreamScreenReaderFocusUpdated&&this.props.onMessageStreamScreenReaderFocusUpdated(e),this._isMessageStreamFocusStatusNotified=!0}o.defer((()=>{if(this.isComponentMounted()&&!this.props.isInvisible){this._checkMessageStreamStoreAndUpdate(this.props,this.state.scrollRequest,"in defer call of _onVisibleRangeChanged");const s=this._convertViewIndexToMessage(this._topPartialViewIndex,!0);this._topVisibleItemInfo!==s&&(this._topVisibleItemInfo=s,this._topVisibleItemInfo&&this._topVisibleItemInfo.skypeMessage&&(this._statusPillInstance.setTopPartiallyVisibleMessage(this._topVisibleItemInfo.skypeMessage),this._statusPillInstance.setUnread(this._unreadMarkerShown&&this._topVisibleItemInfo.metadata.viewIndex>this._unreadMarkerViewIndex)));const i=-1!==e&&e<21;!d&&!i||this._messageStreamStore.isEarliestMessageTheBeginning()||this._messageStreamStore.cannotGetEarlierMessages()||this._disallowFetchingMoreMessagesFromStore?this.props.onUserScrolledToTheTop&&!o.isUndefined(this._currentScrollTop)&&d&&r&&(this._messageStreamStore.isEarliestMessageTheBeginning()||this._messageStreamStore.cannotGetEarlierMessages())&&this.props.onUserScrolledToTheTop():this._messageStreamStore.fetchEarlierMessages();const a=this._lastViewIndex-21,l=-1!==t&&t>a;let u=h;L.log(A.LogTraceArea.MessageStream,'Should show "jump to end" button',u),!c&&!l||this._messageStreamStore.isLatestMessageTheEnd()||this._disallowFetchingMoreMessagesFromStore?c&&this._messageStreamStore.isLatestMessageTheEnd()&&(L.log(A.LogTraceArea.MessageStream,'Do not show "jump to end" button because we are at the end of the stream'),this._onScrolledToTheBottom(!0),u=!1):this._messageStreamStore.fetchLaterMessages(),!u&&this._shouldFocusLastMessage&&this._listView&&this.state.lastMessage&&(this._listView.focusMessage(this.state.lastMessage.cuid),this._shouldFocusLastMessage=!1),this._jumpToEndButton&&this._jumpToEndButton.setVisible(u),this._maybeTrackMessageSearchPerformance(n)}}))},this._updateConsumptionHorizonToLastVisibleItem=()=>{this._lastVisibleItemForConsumptionHorizon&&(L.log(A.LogTraceArea.ConsumptionHorizon,"Actually updating consumption horizon to: "+this._lastVisibleItemForConsumptionHorizon.getConsumptionHorizonString()),this._consumptionHorizonUpdateDebounceTimer&&(Ee.default.clearTimeout(this._consumptionHorizonUpdateDebounceTimer),this._consumptionHorizonUpdateDebounceTimer=void 0),u.default.setConsumptionHorizonToMessage(this.props.conversationId,this._lastVisibleItemForConsumptionHorizon),this._lastVisibleItemForConsumptionHorizon=void 0)},this._checkForReactionConsumptionHorizonChange=()=>{this._reactionConsumptionHorizonUpdateDebounceTimer&&Ee.default.clearTimeout(this._reactionConsumptionHorizonUpdateDebounceTimer),this._reactionConsumptionHorizonUpdateDebounceTimer=Ee.default.setTimeout(this._updateReactionConsumptionHorizon,1500)},this._updateReactionConsumptionHorizon=()=>{let e=0;const t=this._dataItemsInfo.getItemList();for(let s=this._topWholeViewIndex;s<=this._bottomWholeViewIndex;s++){const i=t[s];let o;i instanceof Ne&&(o=i.skypeMessage),o&&(0,oe.isLastMessageUpdateReaction)(o)&&(p.markReactionsAsRead(o),e++)}L.log(A.LogTraceArea.ConsumptionHorizon,"MessageStream - Updating of reaction consumption horizon for messages in viewport. Updated "+e),this._reactionConsumptionHorizonUpdateDebounceTimer&&(Ee.default.clearTimeout(this._reactionConsumptionHorizonUpdateDebounceTimer),this._reactionConsumptionHorizonUpdateDebounceTimer=void 0)},this._onCopyContextMenu=()=>!!this._copyListenerRef&&this._copyListenerRef.triggerCopy(),this._onQuoteSelectionContextMenu=()=>{this.props.onQuoteSelectionContextMenu((0,h.chain)(o.map(this._streamItemRefs,(({ref:e,message:t})=>{const s=e.quoteSelection();return s?t.mergePartialUpdate({content:s}):void 0})),o.flatten,o.compact))},this._onCopy=e=>{const t=(0,h.chain)(o.map(this._streamItemRefs,(({ref:t})=>t.copySelection(e))),o.flatten,o.compact,o.size);t>0&&(q.default.scheduleTextMessage(V.getString("MessageStream.MessageCopied"),void 0,this._getRootViewId()),L.track(new G.KeyboardMessagesTelemetry(this.props.conversationId,{messagesCount:t,actionType:K.KeyboardActionType.KeyboardCopy})))},this._onOuterContainerLayout=e=>{e.height!==this.props.containerInitialDimensions.height&&this.setState({streamHeight:e.height})},this._onSuggestionsListViewRef=e=>{this._suggestionsListView=e||void 0,this._suggestionsListView&&this.state.canShowSuggestions&&this._suggestionsListView.animateSuggestions(this._lastMessageFullyVisible)},this._onInitialRenderComplete=()=>{this.props.onInitialRenderComplete&&this.props.onInitialRenderComplete(),this._markHub2StreamScenarioStepCompleted("InitialRenderComplete"),this.isComponentMounted()&&(this._initialRenderCompleted=!0),this._openAnimationCompleted&&te.default.finishScenario(this.props.conversationId),Se.default.messageStreamRendered()},this._openAnimationComplete=()=>{this._openAnimationCompleted=!0,this._initialRenderCompleted&&(this._markHub2StreamScenarioStepCompleted("WaitingForAnimationEnd"),te.default.finishScenario(this.props.conversationId))},this._updateStatusPill=o.throttle((()=>{this._statusPill&&this._statusPill.setEnabledForInfo(!0).touch()}),1e3),this._onScroll=(e,t)=>{this._lockUpdatesToConsumptionHorizon=!1,this._onScrollTimer&&(Ee.default.clearTimeout(this._onScrollTimer),this._onScrollTimer=void 0),this._onScrollTimer=Ee.default.setTimeout(this._onScrollStoppedDebounced,1500),this._isUserScrolling=!0,this._updateStatusPill();const s=this._bottomWholeViewIndex===this._lastViewIndex&&this._messageStreamStore.isLatestMessageTheEnd();this._onScrolledToTheBottom(s),this._currentScrollTop=e},this._onScrollStoppedDebounced=()=>{this._isUserScrolling=!1,this._onScrollTimer=void 0},this._onOverrideConsumptionHorizon=e=>{this._consumptionHorizonTimestampOverride=e},this._shouldUpdateItem=(e,t)=>e instanceof Ne&&t instanceof Ne?e.key!==t.key||e.skypeMessage!==t.skypeMessage||t.metadata.shouldUpdate:!(0,x.default)(e,t),this._renderItem=(e,t)=>{if(e instanceof Ge)return r.createElement(Re.UserIcon,{key:e.key,style:Ze.contactInviteUserIcon,userMri:e.conversationId,size:Le.UserIconSize.Size120,conversationId:this.props.conversationId});if(e instanceof Ke)return r.createElement(v.default,{key:e.key,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,isIncomingContactInvitePending:this.props.isIncomingContactInvitePending,isContactInviteJustAccepted:this.props.isContactInviteJustAccepted,onIncomingContactInviteAccepted:this.props.onContactInviteAccepted,inviteToken:this.props.inviteToken,isEncryptedConversationEstablished:this.props.isEncryptedConversationEstablished,isAnyMessageInTheStream:e.isAnyMessageInTheStream,showWave:e.showWave,onGreet:this.props.onGreet});if(e instanceof ze){const t=[];return this.state.isUsingStackNavigationContext?t.push(Ze.composingIndicatorContainerMobile):t.push(Ze.composingIndicatorContainerDesktop),r.createElement(r.View,{key:"-composingIndicator",style:t},r.createElement(Ce.default,{typingMris:e.composingMris,conversationId:e.conversationId,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext}))}if(e instanceof We){const t=S.isPhoneMri(this.props.conversationId)?V.getString("MessageStream.UnreadSmsMarkerDivider"):V.getString("MessageStream.UnreadMarkerDivider");return r.createElement(_e.default,{text:t,dividerTypeIsLastRead:!0,messageStreamFontSize:this.state.messageStreamFontSize,focusStreamItemTextForMobileScreenReader:e.focusItemOnMountOnMobile,onMountItem:this._onMountItem})}if(e instanceof He){const t=()=>w.default.getDisplayDateString(e.dateOfMarker);return r.createElement(_e.default,{textGetter:t,dividerTypeIsLastRead:!1,messageStreamFontSize:this.state.messageStreamFontSize})}if(e instanceof Ue)return r.createElement(Te.StreamItemReadReceipts,{key:e.key,conversationId:this.props.conversationId,readReceiptsHeads:e.readReceiptsHeads,readReceiptsSum:e.readReceiptsSum,availableHeight:e.height});if(e instanceof Ne)return z.default.notifyMessageRendered(e.skypeMessage.getOriginalClientMessageId(),se.default.isUsingStackNavigationContext()),L.debug((()=>["DIM_CALC - message stream containerInitialDimensions",this.props.containerInitialDimensions])),this._reportRenderItemQoS(e.skypeMessage,!1),r.createElement(ve.StreamItem,Object.assign({ref:this._onStreamItemRef(e.skypeMessage)},e.metadata.itemRenderInfo,{key:"stream-item-"+e.skypeMessage.cuid,message:e.skypeMessage,renderOrigin:this.props.renderOrigin||k.MessageRenderOrigin.ChatCanvas,isConversationAccepted:this.props.isConversationAccepted,isLastMessage:this.state.lastMessage===e.skypeMessage,containerInitialDimensions:this.props.containerInitialDimensions,disableForward:this.props.disableForward,disableMarkUnread:this.props.isHighlightCommentMode,disableReactions:this.props.isHighlightCommentMode,disableSelectMultipleMessages:this.props.disableSelectMultipleMessages,disableReportMessage:this.props.disableReportMessage,disablePlugins:this.props.disablePlugins,onDisableScroll:this._onDisableScroll,onMarkAsUnread:this._onOverrideConsumptionHorizon,onItemPress:this.props.onItemPress,onMountContent:this.props.onMountContent,onMountItem:this._onMountItem,onQuote:this.props.onQuoteMessage,onEdit:this.props.onMessageEdit,onCopyContextMenu:this.state.enableMultiMessageQuoteOnKeyboard?this._onCopyContextMenu:void 0,onQuoteSelectionContextMenu:this.state.enableMultiMessageQuoteOnKeyboard?this._onQuoteSelectionContextMenu:void 0,focusStreamItemForMobileScreenReader:e.shouldItemFocusOnMobile,isSelectMessagesModeActive:this.props.isSelectMessagesModeActive,getRootWindowComponent:this._getListView,messageStreamFontSize:this.state.messageStreamFontSize,linkedMessages:this._getLinkedMessages(e.skypeMessage),isTranslatedConversation:this.props.isTranslatedConversation,searchStore:this.props.searchStore}));if(e instanceof qe){const t=r.createElement(F.default,{conversationId:e.conversationId,style:Ze.groupEngageButtonStyle,origin:E.InviteMorePeopleButtonOrigin.MessageStream,messageStreamFontSize:this.state.messageStreamFontSize}),s=this.state.enableGroupShareButton?r.createElement(R.default,{conversationId:e.conversationId,useSXButton:!0,style:Ze.groupEngageButtonStyle,origin:E.ShareGroupButtonOrigin.MessageStream}):void 0;return r.createElement(r.View,{style:Ze.groupEngagementButtons},t,s)}return e instanceof je?r.createElement(r.View,{style:Ze.newConnectionContainer},r.createElement(ke.Caption,null,this._getNewConnectionString())):e instanceof Qe?r.createElement(ie.default,{conversationId:e.conversationId,memberCount:this._conversation.getMemberCount()}):e instanceof Xe?r.createElement(U.default,{threadId:e.conversationId,origin:Q.MeetNowOrigin.MessageStream}):e instanceof $e?r.createElement(ge.default,null):r.createElement(r.View,null)},this._onStreamItemRef=e=>t=>{const s=e.cuid;t?this._streamItemRefs[e.cuid]={ref:t,message:e}:delete this._streamItemRefs[s]},this._onCopyListenerRef=e=>this._copyListenerRef=e||void 0,this._getListView=()=>this._listView,this._getLinkedMessages=e=>e.isAlbum()?N.default.getNotFailedMediaMessagesForAlbum(e.getAlbumId()):[],this._getReadReceiptsSummary=e=>{let t=[];return o.eachRight(this._readReceiptsMarks,((s,i)=>(t.push(...s.readReceipts),i!==e.toString()))),t},this._onJumpToEndButtonRef=e=>{this._jumpToEndButton=e||void 0},this._onJumpToEndButtonPress=e=>{let t;this._shouldFocusLastMessage=!0,this._messageStreamStore.isLatestMessageTheEnd()?(t=this._lastViewIndex-this._bottomWholeViewIndex,this._scrollToBottom()):(this._scrollToBottomOfRefreshedStream(),L.log(A.LogTraceArea.MessageStreamDebug,"Refresh store reason: User jumped to end from a position where last messages were not loaded in view")),this.props.onJumpToEndPress&&this.props.onJumpToEndPress(),L.track(new G.JumpToEnd(this.props.conversationId,t,e))},this._onDisableScroll=e=>{this.setState({isScrollDisabled:e})},this._statusPillRef=e=>{this._statusPill=e||void 0},this._onListViewRef=e=>{this._listView=e||void 0}}componentDidMount(){super.componentDidMount(),this._postCreatedSubscriptionToken=re.default.postCreated.subscribe((e=>{this.isComponentMounted()&&this._contentRendered&&!e.editedMessageCuid&&o.includes(e.conversationIds,this.props.conversationId)&&this._messageStreamStore&&(this._checkMessageStreamStoreAndUpdate(this.props,this.state.scrollRequest,"in async call of PostingService.postCreated"),this._messageStreamStore.isLatestMessageTheEnd()?this._scrollToBottom():this._scrollToBottomOfRefreshedStream())}))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),e.isSelectMessagesModeActive!==this.props.isSelectMessagesModeActive&&(this._firstUpdateCompleteForMutliSelect=!0,this._viewItemsListDirty=!0,this._regenerateItemListIfDirty(this.props,this.state)),e.isTranslatedConversation!==this.props.isTranslatedConversation&&(this._viewItemsListDirty=!0,this._shouldUpdateForTranslationChange=!0,this._regenerateItemListIfDirty(this.props,this.state)),this._maybeAnimateScrollToPosition(t.scrollRequest,this.state.scrollRequest)}componentWillUnmount(){super.componentWillUnmount(),this._instrumentationSubscription&&(this._instrumentationSubscription.unsubscribe(),this._instrumentationSubscription=void 0),this._consumptionHorizonUpdateDebounceTimer&&(Ee.default.clearTimeout(this._consumptionHorizonUpdateDebounceTimer),this._consumptionHorizonUpdateDebounceTimer=void 0),this._lastVisibleItemForConsumptionHorizon&&this._updateConsumptionHorizonToLastVisibleItem(),this._onScrollTimer&&(Ee.default.clearTimeout(this._onScrollTimer),this._onScrollTimer=void 0),this._postCreatedSubscriptionToken&&this._postCreatedSubscriptionToken.unsubscribe(),this._statusPillInstance&&this._statusPillInstance.destroy(),this._sendMessageReadEventThrottled.flush(),this.state.showSpeechConsentSuggestion&&this.props.renderOrigin!==k.MessageRenderOrigin.CallCanvas&&pe.default.hideSpeechConsentSuggestion()}_buildState(e,t){var s,i,n,r,l;const d=a.default.getS4LMessagingFeatures(),c=a.default.getS4LContactsFeatures(),h=Y.default.getUserPreferencesLocal(),u=this.props;this._conversation=(0,b.default)().getConversation(e.conversationId);const p=C.default.getMessageCountsForConversation(e.conversationId),g=null===(s=this._conversation)||void 0===s?void 0:s.memberConsumptionHorizonsSorted,m=this._getRootViewId(),f=Me.default.canShowSuggestions(),y=se.default.isUsingStackNavigationContext();let v={useCompactLayout:de.default.isSmallDevice(m)||!!this._getContext().isPresentedInDesktopSubview,isUsingStackNavigationContext:y,readReceiptsEnabled:d.enableReadReceipts&&!S.isAgent(e.conversationId)&&Z.default.getReadReceiptsEnabled()&&e.isConversationAccepted,memberConsumptionHorizonsSorted:g,isOneOnOne:null===(i=this._conversation)||void 0===i?void 0:i.isOneOnOne(),enableGreetingCard:d.enableGreetingCard,enableGroupShareButton:c.enableGroupShareButtonInChat,enableMultiMessageQuoteOnKeyboard:d.enableMultiMessageQuoteOnKeyboard&&h.pasteAsQuotesEnabled,newConnectionMessageId:null===(n=this._conversation)||void 0===n?void 0:n.getConversationProperty(S.ConversationProps.NewConnectionMessageId),isNewConnectionMessageEnabled:c.enableNewConnectionMessage,canShowSuggestions:f,messageStreamFontSize:Y.default.getMessageStreamFontSize(),scrollRequest:d.enableUnifiedScrollToTimestamp&&e.searchStore?e.searchStore.getTimestamp():void 0,enableNewConversationCreation:d.enableNewConversationCreation,isBookmarksStreamFromTopEnabled:d.enableBookmarksStreamFromTop,isJoinEnabled:null===(r=this._conversation)||void 0===r?void 0:r.isJoinEnabled(),isRegularMemberInModeratedGroup:this._conversation&&(0,X.isRegularMemberInModeratedGroup)(this._conversation),showSpeechConsentSuggestion:pe.default.showSpeechConsentSuggestingInConversation(),isClearLeaveV2EnabledAndKeepInRecents:this._conversation&&(0,b.default)().isClearApplicableAndKeepInRecents(this._conversation.id),isConvCleared:this._conversation&&this._conversation.isDeleted(),isChild:$.default.isChild(),messageSearchLimit:d.inConversationMessageSearch.initialPageSize};t||this.state.messageStreamFontSize===v.messageStreamFontSize||this._virtualMessageViewRefCount++,e.isSelectMessagesModeActive!==u.isSelectMessagesModeActive&&(this._firstUpdateCompleteForMutliSelect=!1),this._isUserPresentInApp=M.default.isCurrentUserActive()&&(!se.default.isUsingSplitView()||this._getRootViewId()===De.default.splitViewInFocus()),this._oldConsumptionHorizonTimestamp=this._currentConsumptionHorizonTimestamp,this._currentConsumptionHorizonTimestamp=o.isNumber(p.consumptionHorizonTimestamp)?p.consumptionHorizonTimestamp:Ye;const T=!(!S.isReadOnlyConversation(e.conversationId)&&!(null===(l=this._conversation)||void 0===l?void 0:l.isEncryptedThread()))&&!e.isEncryptedConversationEstablished;T!==this._readOnlyConversation&&(L.log(A.LogTraceArea.MessageStreamDebug,"Conversation readonly state changed - need to regenerate list of items"),this._viewItemsListDirty=!0),this._readOnlyConversation=T;const I=_.default.getComposingUsers(e.conversationId);(0,x.default)(I,this._composingMris)||(L.log(A.LogTraceArea.MessageStreamDebug,"Composing MRIs changed - need to regenerate list of items"),this._viewItemsListDirty=!0),this._composingMris=I,this.state&&!(0,x.default)(g,this.state.memberConsumptionHorizonsSorted)&&(L.log(A.LogTraceArea.MessageStreamDebug,"Member consumption horizons changed - need to regenerate list of items"),this._viewItemsListDirty=!0),t||(0,x.default)(u.isContactInviteJustAccepted,e.isContactInviteJustAccepted)||(L.log(A.LogTraceArea.MessageStreamDebug,"isContactInviteJustAccepted changed - need to regenerate list of items"),this._viewItemsListDirty=!0),t||(0,x.default)(u.isEncryptedConversationEstablished,e.isEncryptedConversationEstablished)||(L.log(A.LogTraceArea.MessageStreamDebug,"isEncryptedConversationEstablished changed - need to regenerate list of items"),this._viewItemsListDirty=!0),(0,x.default)(u.isSelectMessagesModeActive,e.isSelectMessagesModeActive)||(L.log(A.LogTraceArea.MessageStreamDebug,"showCheckboxUiChange - need to regenerate list of items"),this._viewItemsListDirty=!0),t||!this.state||(0,x.default)(v.showSpeechConsentSuggestion,this.state.showSpeechConsentSuggestion)||(this._viewItemsListDirty=!0),this._messageReadDelay=d.messageReadDelay,L.log(A.LogTraceArea.MessageStreamDebug,"UnreadMessageDetails: CurrentConsumptionHorizonTimestamp:"+p.consumptionHorizonTimestamp+" UnreadCount:"+p.unreadCount),t&&(v.isScrollDisabled=!1);let w=!1;const P=this.state&&!o.isUndefined(v.scrollRequest)&&!(0,x.default)(this.state.scrollRequest,v.scrollRequest);let k=!1,E=-1;t||!P||o.isUndefined(v.scrollRequest)||(E=o.findIndex(this._dataItemsInfo.getItemList(),(e=>e instanceof Ne&&void 0!==v.scrollRequest&&e.skypeMessage.createdTime===v.scrollRequest.messageTimestamp)),k=E>-1);let R=this.state&&this.state.isClearLeaveV2EnabledAndKeepInRecents&&!this.state.isConvCleared&&v.isConvCleared,F=this._messageStreamStore&&this._messageStreamStore.isDestroyed();return(t||e.conversationId!==u.conversationId||P&&!k||u.focusedMessageCuid!==e.focusedMessageCuid||this.state&&v.readReceiptsEnabled!==this.state.readReceiptsEnabled||this.state&&v.canShowSuggestions!==this.state.canShowSuggestions||R||F)&&(w=!0,L.log(A.LogTraceArea.MessageStreamDebug,"Refresh store reason:  initialBuild:"+t+" ConversationId differs:"+(e.conversationId!==u.conversationId)+" ScrollToTimestamp differs:"+P+" NewTargetMessageIndex:"+E+" FocusMessageId differs:"+(e.focusedMessageCuid!==u.focusedMessageCuid)+" ReadReceipts settings differs:"+(this.state&&v.readReceiptsEnabled!==this.state.readReceiptsEnabled)+" ConversationCleared V2:"+R+" StoreWasDestroyed:"+F)),v.streamHeight=e.containerInitialDimensions.height,v=this._refreshConversationProperties(e,v,w,!1,p.unreadCount),!t&&this.state&&v.readReceiptsEnabled!==this.state.readReceiptsEnabled&&(this._lockUpdatesToConsumptionHorizon=!0),t||this._checkForConsumptionHorizonChange(),e.conversationId===S.SkonsoleMri?this._instrumentationSubscription||(this._instrumentationSubscription=L.output.subscribe(this._instrumentationCallback),o.defer((()=>{const e=L.getLogHistory();o.each(e,(e=>this._instrumentationCallback(e.level,e.traceArea,e.args)))}))):this._instrumentationSubscription&&(this._instrumentationSubscription.unsubscribe(),this._instrumentationSubscription=void 0),v}_refreshConversationProperties(e,t,s,i,o){let n=t||{};const r=o||C.default.getMessageCountsForConversation(e.conversationId).unreadCount;return s?(L.log(A.LogTraceArea.MessageStreamDebug,"Resetting properties for the conversationId:"+ce.mriOrId(e.conversationId)),this._hideUnreadMarker(),r>0&&!i&&this._showUnreadMarker(this._currentConsumptionHorizonTimestamp),n.isReactionDetailsOn=!1,this._scrollToMessage=!!n.scrollRequest&&!i,this._scrollToUnreadMarker=r>0&&!this._scrollToMessage&&!!this._currentConsumptionHorizonTimestamp&&!e.isIncomingContactInvitePending&&!i,this._highlightScrollToTarget=this._scrollToMessage,this._topPartialViewIndex=-1,this._bottomWholeViewIndex=-1,this._topWholeViewIndex=-1,this._bottomPartialViewIndex=-1,this._consumptionHorizonTimestampOverride=void 0,this._lockUpdatesToConsumptionHorizon=!1,this._lastReceivedMessageTimestamp=0,this._lastMessageTimestamp=0,this._lastViewIndex=0,this._skypeMessages=[],this._readReceiptsMarks={},this._virtualMessageViewRefCount++,this._contentRendered=!1,this._disallowFetchingMoreMessagesFromStore=!1,this._dataItemsInfo=new ne.default,this._updateMessageStreamStore(e,n.scrollRequest&&n.scrollRequest.messageTimestamp,i),t.isUsingStackNavigationContext?te.default.setStackNavigationCompleteCallback(this._openAnimationComplete):this._openAnimationCompleted=!0,this._markHub2StreamScenarioStepCompleted("InitialBuild"),this._updateStreamItemsAndReturnNewState(e,n)):(this._updateStreamIndexes(n,!0),n=this._regenerateItemListIfDirty(e,n),n)}_updateMessageStreamStore(e,t,s=!1){let i;this._messageStreamStore&&this._removeSubscription(this._messageStreamStoreSubscription),s?i=void 0:this._scrollToMessage?i=t:this._scrollToUnreadMarker&&(i=this._currentConsumptionHorizonTimestamp),this._messageStreamStore=j.default.cachedStoreFor(e.conversationId,i),this._messageStreamStoreSubscription={store:this._messageStreamStore,callbackBuildState:this._onMessageStreamStoreTrigger},this._addSubscription(this._messageStreamStoreSubscription)}_hideUnreadMarker(){this._unreadMarkerShown=!1,this._unreadMarkerTimestamp=-1,this._unreadMarkerMessageIndex=-1,this._unreadMarkerViewIndex=-1,this._viewItemsListDirty=!0}_showUnreadMarker(e){this._unreadMarkerShown=!0,this._unreadMarkerTimestamp=e,this._unreadMarkerMessageIndex=-1,this._unreadMarkerViewIndex=-1,this._viewItemsListDirty=!0}_updateStreamIndexes(e,t=!1){if(!(e.isInitialMessagesLoaded||this.state&&this.state.isInitialMessagesLoaded))return;const s=this._lastReceivedMessageTimestamp,i=this._lastMessageTimestamp,n=this._lastSentMessageTimestamp,r=this._skypeMessages.length-1;let a=!1,l=!1;this._lastSentMessageTimestamp=0,o.eachRight(this._skypeMessages,((e,t)=>(t===r&&(this._lastMessageTimestamp=e.createdTime),ee.default.isMyMri(e.creator)||g.isThreadActivityType(e.messagetype)||l||(this._lastReceivedMessageTimestamp=e.createdTime,l=!0),!ee.default.isMyMri(e.creator)||g.isThreadActivityType(e.messagetype)||a||(this._lastSentMessageTimestamp=e.createdTime,a=!0),!(l&&a))));const d=this._unreadMarkerViewIndex>0&&this._topPartialViewIndex>this._unreadMarkerViewIndex,c=this._unreadMarkerViewIndex>0&&this._bottomPartialViewIndex<this._unreadMarkerViewIndex,h=d||c,u=o.isUndefined(e.isLatestMessageTheEnd)?this.state.isLatestMessageTheEnd:e.isLatestMessageTheEnd,p=o.isUndefined(e.isEarliestMessageTheBeginning)?this.state.isEarliestMessageTheBeginning:e.isEarliestMessageTheBeginning,m=this._currentConsumptionHorizonTimestamp>=this._lastReceivedMessageTimestamp&&u,S=this._currentConsumptionHorizonTimestamp>=s&&u,f=i>0&&this._lastMessageTimestamp>i&&u,y=s>0&&this._lastReceivedMessageTimestamp>s&&u;0===this._lastSentMessageTimestampInitial&&this._lastSentMessageTimestamp&&u&&(this._lastSentMessageTimestampInitial=this._lastSentMessageTimestamp);const _=0===this._lastViewIndex||this._lastViewIndex===this._bottomPartialViewIndex,v=y&&!_,C=this._oldConsumptionHorizonTimestamp!==Ye&&this._currentConsumptionHorizonTimestamp<this._oldConsumptionHorizonTimestamp,b=this._consumptionHorizonTimestampOverride===this._currentConsumptionHorizonTimestamp;if(L.log(A.LogTraceArea.MessageStreamDebug,"_checkStreamIndexes:isUnreadMarkerOutsideViewport:"+h+";allMessagesRead:"+m+";allOldMessagesRead:"+S+";newMessagesInStream:"+f+";newReceivedMessagesInStream:"+y+";isUserActive:"+this._isUserActive()+";oldLastItemVisible:"+_+";consumptionHorizonMovedBackInTime:"+C+";consumptionHorizonSetManually:"+b),this._isUserActive()){if(this._unreadMarkerShown){m&&this._hideUnreadMarker();this._unreadMarkerTimestamp>0&&this._lastReceivedMessageTimestamp>0&&this._lastReceivedMessageTimestamp<=this._unreadMarkerTimestamp&&u&&this._hideUnreadMarker();const e=n>0&&this._lastSentMessageTimestamp>this._lastSentMessageTimestampInitial&&this._lastSentMessageTimestamp>n&&this._lastSentMessageTimestamp>this._lastReceivedMessageTimestamp&&u;L.log(A.LogTraceArea.MessageStreamDebug,"hideUnreadMarkernewSentMessagesInStream:"+e),e&&this._hideUnreadMarker(),h&&S&&(v?this._showUnreadMarker(this._currentConsumptionHorizonTimestamp):f&&this._hideUnreadMarker())}else v&&this._showUnreadMarker(this._currentConsumptionHorizonTimestamp);(C||b)&&(this._consumptionHorizonTimestampOverride=void 0,this._lockUpdatesToConsumptionHorizon=!0,this._showUnreadMarker(this._currentConsumptionHorizonTimestamp))}else y&&!this._unreadMarkerShown&&this._showUnreadMarker(this._currentConsumptionHorizonTimestamp);let T=!this._unreadMarkerShown,M=!1;this._unreadMarkerMessageIndex=-1,this._currentConsumptionHorizonItemIndex=-1,o.each(this._skypeMessages,((e,t)=>{0===t&&e.createdTime>this._unreadMarkerTimestamp&&!p&&(T=!0),this._unreadMarkerShown&&!T&&e.createdTime>this._unreadMarkerTimestamp&&e.countsForUnreadCounts()&&(this._unreadMarkerMessageIndex=t,this._viewItemsListDirty=!0,T=!0),!M&&e.isAnyVersionKnownByServer()&&(e.createdTime<=this._currentConsumptionHorizonTimestamp?this._currentConsumptionHorizonItemIndex=t:M=!0)})),this._updateReadReceipts(e,t)}_updateReadReceipts(e,t){if(o.isUndefined(e.readReceiptsEnabled)?!!this.state&&this.state.readReceiptsEnabled:e.readReceiptsEnabled){const s=e.isOneOnOne||!!this.state&&this.state.isOneOnOne,i=(e.memberConsumptionHorizonsSorted?e.memberConsumptionHorizonsSorted:this.state?this.state.memberConsumptionHorizonsSorted:void 0)||[],n=le.computeMarks(this._skypeMessages,i),r=o.map(this._readReceiptsMarks,(e=>o.pick(e,["mris"]))),a=o.map(n,(e=>o.pick(e,["mris"]))),l=o.keys(n);if(!(0,x.default)(o.keys(this._readReceiptsMarks),l)||!(0,x.default)(r,a)){o.each(this._readReceiptsMarks,((e,t)=>{if(n[t]&&!n[t].key)n[t].key=e.key;else{const t=o.find(n,(t=>(0,x.default)(t.readReceipts,e.readReceipts)));t&&(t.key=e.key)}})),o.each(n,(e=>{e.key||(e.key=be.ItemListKey.ReadReceiptPrefix+this._readReceiptsKeysCounter++)}));const e=l.length&&t&&s?this._skypeMessages[Number(l[0])]:void 0;if(e){const t=new G.MessageRead(e,this.props.conversationId);this._sendMessageReadEventThrottled(t)}this._readReceiptsMarks=n,L.log(A.LogTraceArea.ReadReceipts,"member CH: "+JSON.stringify(o.map(this._readReceiptsMarks,(e=>({mris:e.readReceipts.map((e=>ce.mriOrId(e.mri))),key:e.key})))))}}}_updateStreamItemsAndReturnNewState(e,t){const s=t||{};let i=d.default.updateCallEventMessages(this._messageStreamStore.getMessages());if(i=o.filter(i,(e=>{if(e.hasAlbumId()){const t=N.default.getNotFailedMediaMessagesForAlbum(e.getAlbumId());return e.isAlbum()?t.length>1:!!e.isSendRejected()||t.length<2}return!0})),void 0===s.enableGreetingCard&&(s.enableGreetingCard=this.state?this.state.enableGreetingCard:void 0),s.isLatestMessageTheEnd=this._messageStreamStore.isLatestMessageTheEnd(),s.lastMessage=o.last(i),o.isUndefined(this._wasLatestMessageTheEndPreviously)&&(this._wasLatestMessageTheEndPreviously=s.isLatestMessageTheEnd),s.isEarliestMessageTheBeginning=this._messageStreamStore.isEarliestMessageTheBeginning(),s.cannotGetEarlierMessages=this._messageStreamStore.cannotGetEarlierMessages(),s.lastMessage&&z.default.notifyMessagePickedFromMessageViewStoreIntoView(s.lastMessage.getOriginalClientMessageId()),this._scrollToUnreadMarker&&!s.isLatestMessageTheEnd){const e=o.findLast(i,(e=>e.countsForUnreadCounts())),t=e&&e.createdTime>this._currentConsumptionHorizonTimestamp;t||this._messageStreamStore.fetchLaterMessages(),s.isInitialMessagesLoaded=this._messageStreamStore.isInitialMessagesLoaded()&&t}else s.isInitialMessagesLoaded=this._messageStreamStore.isInitialMessagesLoaded();return this._skypeMessages=i,L.log(A.LogTraceArea.MessageStream,"Updated items from the store: isInitialMessagesLoaded: "+s.isInitialMessagesLoaded+", isLatestMessageTheEnd: "+s.isLatestMessageTheEnd+", skypeMessages.length: "+this._skypeMessages.length),e.onSkypeMessagesUpdated&&e.onSkypeMessagesUpdated(i),this._viewItemsListDirty=!0,this._updateStreamIndexes(s),this._regenerateItemListIfDirty(e,s)}_isInitialMessagesLoaded(e){return o.isUndefined(e.isInitialMessagesLoaded)?this.state&&this.state.isInitialMessagesLoaded:e.isInitialMessagesLoaded}_regenerateItemListIfDirty(e,t){var s;if(!this._viewItemsListDirty)return t;const i=this._skypeMessages.length,n=S.isGroupConversation(e.conversationId);let r=[];t.scrollToItemViewIndex=-1;let a=!1,l=!1;this._unreadMarkerViewIndex=-1;const d=this._unreadMarkerShown&&this._unreadMarkerMessageIndex>=0,h=o.isUndefined(t.isLatestMessageTheEnd)?!(!this.state||!this.state.isLatestMessageTheEnd):t.isLatestMessageTheEnd,u=o.isUndefined(t.isEarliestMessageTheBeginning)?this.state&&this.state.isEarliestMessageTheBeginning:t.isEarliestMessageTheBeginning,p=o.isUndefined(t.cannotGetEarlierMessages)?this.state&&this.state.cannotGetEarlierMessages:t.cannotGetEarlierMessages;this._isInitialMessagesLoaded(t)&&(e.isConversationAccepted&&!e.isContactInviteJustAccepted||!this._readOnlyConversation||e.showInviteHeaderForEncryptedThread||r.push(new Ge(e.conversationId)));let m=!1,f=!1;const y=this._shouldDisplayContactInviteViewItemInfo(e,t);let _=y?0:-1,v=-1,C=!1;const b=o.isUndefined(t.isNewConnectionMessageEnabled)?this.state&&this.state.isNewConnectionMessageEnabled:t.isNewConnectionMessageEnabled,T=o.isUndefined(t.newConnectionMessageId)?this.state&&this.state.newConnectionMessageId:t.newConnectionMessageId;b&&T===S.newConnectionAcceptedPropValue&&r.push(new je(be.ItemListKey.NewConnection,32));const M=o.isUndefined(t.scrollRequest)?this.state&&this.state.scrollRequest:t.scrollRequest;for(let s=0;s<i;s++){const i=this._skypeMessages[s],o=s>0?this._skypeMessages[s-1]:void 0;if(g.shouldServerMessageBeFilteredOut(i,this._conversation))continue;if(d&&!a&&this._unreadMarkerMessageIndex<=s&&!ee.default.isMyMri(i.creator)&&!e.isHighlightCommentMode&&(this._unreadMarkerViewIndex=r.length,this._scrollToUnreadMarker&&(L.log(A.LogTraceArea.MessageStreamDebug,"Scroll to unread indicator:"+s),t.scrollToItemViewIndex=r.length),r.push(new We(be.ItemListKey.UnreadMarker,36,f)),a=!0),!S.isBookmarkConversation(e.conversationId)){if((0===s&&(u||p||l||y)||o&&!I.default.isSameDay(i.createdTime,o.createdTime))&&!e.isHighlightCommentMode){const e=I.default.getMidnight(i.createdTime);r.push(new He(be.ItemListKey.DateMarkerPrefix+e,e))}}n&&H.isAddCurrentUserThreadActivity(i)&&(y?_=r.length:(v=r.length,C=!0)),v>=0&&C&&(g.isThreadActivityType(i.messagetype)?v++:C=!1);const c=M&&i.createdTime===M.messageTimestamp,h=(null==M?void 0:M.cuid)&&i.cuid===M.cuid,w=i.cuid===e.focusedMessageCuid,P=i.isAlbum()&&e.focusedMessageCuid&&N.default.albumContainsMessage(i.getAlbumId(),e.focusedMessageCuid);this._scrollToMessage&&(c||w||h||P)&&(M&&i.isAlbum()&&(M.messageTimestamp=i.createdTime),L.log(A.LogTraceArea.MessageStreamDebug,"Scroll to message index:"+s),t.scrollToItemViewIndex=r.length,t.shouldFocusScrolledMessageCell=!0,this._isFocusInsideMessageStreamOnMount=!0),r.push(new Ne(be.ItemListKey.MessagePrefix+i.cuid,i,m));const k=this._readReceiptsMarks[s];k&&r.push(new Ue(k.key,k.readReceipts,this._getReadReceiptsSummary(s))),b&&T===i.cuid&&r.push(new je(be.ItemListKey.NewConnection+i.cuid,32)),(m||f)&&(m=!1,f=!1,this._isFocusInsideMessageStreamOnMount=!0)}if(!l&&_>=0){0!==_||S.isEncryptedThread(e.conversationId)||(null===(s=this._conversation)||void 0===s?void 0:s.isSkypeSMSConversation())||(_=r.length);const o=t.enableGreetingCard&&!e.isIncomingContactInvitePending&&!S.isEncryptedThread(e.conversationId)&&!S.isPhoneMri(e.conversationId)&&!i;L.log(A.LogTraceArea.MessageStream,"Show wave:"+o+" enableGreetingCard:"+t.enableGreetingCard+" isIncomingContactInvitePending:"+e.isIncomingContactInvitePending+" isEncryptedThread:"+S.isEncryptedThread(e.conversationId)+" isPhoneMri:"+S.isPhoneMri(e.conversationId)+" skypeMessagesLength: "+i);const n=[new Ke(be.ItemListKey.ContactInviteHeaderItem,o?535:325,o,e.isContactInviteJustAccepted,e.isIncomingContactInvitePending,e.isEncryptedConversationEstablished,i>0)];r.splice(_,0,...n),this._scrollToMessage&&(t.scrollToItemViewIndex=_),l=!0}const{isJoinEnabled:w,isRegularMemberInModeratedGroup:P}=this.state||t;w?r.splice(-1===v?0:v,0,new Xe(e.conversationId)):v>=0&&c.default.contacts().canInvitePeople&&!P&&((this.state?this.state.enableNewConversationCreation:t.enableNewConversationCreation)?r.splice(v,0,new Qe(e.conversationId)):r.splice(v,0,new qe(e.conversationId))),this._shouldShowSpeechConsentItemInfo(this.state,t,r.length)&&r.push(new $e(e.conversationId));const k=o.filter(this._composingMris,(e=>!ee.default.isMyMri(e)));e.disableComposingIndicator?!e.disableComposingIndicator&&k.length>0&&r.push(new ze(this._composingMris,e.conversationId)):r.push(new ze(k,e.conversationId));const E=this.props;if(this._contentRendered&&(0,x.default)(E.isSelectMessagesModeActive,e.isSelectMessagesModeActive)?(this._disallowFetchingMoreMessagesFromStore=!0,this._applyModificationsDebounced(r,h,e,M&&M.messageTimestamp)):this._applyModifications(r,h,e,M&&M.messageTimestamp),this._viewItemsListDirty=!1,L.log(A.LogTraceArea.MessageStreamDebug," Unread marker:unreadMarkerShown:"+this._unreadMarkerShown+";unreadMarkerTimestamp:"+this._unreadMarkerTimestamp+";unreadMarkerMessageIndex:"+this._unreadMarkerMessageIndex+";unreadMarkerViewIndex:"+this._unreadMarkerViewIndex),this._scrollToMessage&&t.isInitialMessagesLoaded&&t.scrollToItemViewIndex<0){const t="Unable to find the scroll to message with cuid: "+e.focusedMessageCuid+". ScrollToTimestamp: "+(M&&M.messageTimestamp)+". Please let the dev team know.";L.warn(A.LogTraceArea.MessageStream,t)}return t}_shouldShowSpeechConsentItemInfo(e,t,s){if(t.isChild)return!1;const i=o.isUndefined(t)||o.isUndefined(t.showSpeechConsentSuggestion)?e.showSpeechConsentSuggestion:t.showSpeechConsentSuggestion;return i&&-1===this._speechConsentSuggestionSeenAt&&(this._speechConsentSuggestionSeenAt=s),i||(this._speechConsentSuggestionSeenAt=-1),i&&this._speechConsentSuggestionSeenAt===s}_shouldDisplayContactInviteViewItemInfo(e,t){const s=t.isUsingStackNavigationContext||void 0===t.isUsingStackNavigationContext&&this.state.isUsingStackNavigationContext,i=!this._readOnlyConversation&&(e.isIncomingContactInvitePending||!e.isConversationAccepted);return s&&(i||e.showInviteHeaderForEncryptedThread)||S.isPhoneMri(this.props.conversationId)}_applyModifications(e,t,s=this.props,i){this._disallowFetchingMoreMessagesFromStore=!1;const o=this._dataItemsInfo.getItemList(),n=P.default.calculateModifications(o,e,!0,!0,this._equalsItemInfo,this._canSubstituteItemsInfo),r=P.default.convertToListModifications(n);s.isSelectMessagesModeActive&&this._updateSelectedMessages(r),this._dataItemsInfo.applyMany(r,(e=>this._regenerateMetadata(e,s,i)),((e,t)=>this._setOptions(e,t))),this._wasLatestMessageTheEndPreviously=t,this._shouldUpdateForTranslationChange=!1}_setOptions(e,t){const s=this._wasLatestMessageTheEndPreviously;e.type===P.ListModificationType.AddItems&&e.insertIndex===t.length&&(e.options={animateFromBottom:s})}_updateSelectedMessages(e){if(o.some(e,(e=>e.type===P.ListModificationType.RemoveItems))){const e=ue.default.getSelectedMessages();o.each(e,(e=>{!o.some(this._skypeMessages,(t=>t.cuid===e.message.cuid))&&ue.default.removeSelectedMessage(e)}))}}_regenerateMetadata(e,t,s){let i=0;const n=[];let r;o.each(e,((e,t)=>{e instanceof Ne&&(e.metadata=o.assign(e.metadata,{streamItemIndex:i++,viewIndex:t}),n.push(e))})),o.eachRight(n,(e=>{const t=e.skypeMessage;return!(ee.default.isMyMri(t.creator)&&!t.isMessageLie()&&g.getMessageTypeGroup(t)===g.MessageTypeGroups.Picture)||(r=t.cuid,!1)})),o.each(n,((i,o)=>{const a=o>0?n[o-1]:void 0,l=a?a.skypeMessage:void 0,d=o+1<n.length?n[o+1]:void 0,c=d?d.skypeMessage:void 0,h=i.skypeMessage,u=ee.default.isMyMri(h.creator),p=l&&ee.default.isMyMri(l.creator);let m=0;const S=o>0&&e[i.metadata.viewIndex-1]instanceof Ue;let f=!(!a||S)&&i.metadata.viewIndex-a.metadata.viewIndex>1;const y=g.isThreadActivityType(h.messagetype);l&&(m=l.createdTime,f=f||y||g.getMessageTypeGroup(l)===g.MessageTypeGroups.Calling||l.isEmote());const _=h.createdTime-m>=Je,v=c&&c.createdTime-h.createdTime>=Je,C=!l||f||_||(u?!p:l.creator!==h.creator),b=o===n.length-1||v||!c||c.creator!==h.creator;let T=C&&!u,M=T,I=T||C&&u||C&&b;C&&(y||h.isEmote())&&(T=!1,M=!1,I=!1);const w=this._highlightScrollToTarget&&(s===h.createdTime||t.focusedMessageCuid===h.cuid);w&&(this._highlightScrollToTarget=!1);const P=!a||!a.skypeMessage.isMessageLie(),k=g.getMessageTypeGroup(i.skypeMessage)===g.MessageTypeGroups.Text&&(P||a.metadata.itemRenderInfo.canPretendBeingSent),A=this.props;let E=!1;if(t.isSelectMessagesModeActive!==A.isSelectMessagesModeActive||this._firstUpdateCompleteForMutliSelect){const e=i.metadata.viewIndex>this._topWholeViewIndex-3&&i.metadata.viewIndex<this._bottomWholeViewIndex+3;E=t.isSelectMessagesModeActive?e||this._firstUpdateCompleteForMutliSelect:!e&&!this._firstUpdateCompleteForMutliSelect}const R={isFirstInGroup:C,isLastInGroup:b,showUserIcon:M,showUserName:T,showTimestamp:I,isHighlighted:w,isReadOnly:this._readOnlyConversation,hasUnderlay:t.hasUnderlay,isLastPhotoByCurrentUser:!!r&&h.cuid===r,canPretendBeingSent:k,showSelectMessageCheckbox:E};i.metadata.shouldUpdate=!(0,x.default)(R,i.metadata.itemRenderInfo)||this._shouldUpdateForTranslationChange,i.metadata.itemRenderInfo=R}))}_canSubstituteItemsInfo(e,t){return e.key===t.key}_convertViewIndexToMessage(e,t){const s=this._dataItemsInfo.getItemList();if(!(e<0))if(t)for(;e<s.length;){const t=s[e];if(t instanceof Ne)return t;e++}else for(;e>=0;){const t=s[e];if(t instanceof Ne)return t;e--}}_maybeTrackMessageSearchPerformance(e){const t=this.state.scrollRequest;if(o.isUndefined(t))return;const s=o.filter(e,(e=>e instanceof Ne)),i=o.map(s,(e=>e.skypeMessage.createdTime));if(o.includes(i,t.messageTimestamp)){const e=t.id;if(this.state.lastTrackedScrollRequestId===e)return;this.setState({lastTrackedScrollRequestId:e});const s=!!t.zeroTermSearch;(0,Be.searchResultsRendered)(Ve.ScenarioSearchTypes.MessageInConversation,e,s,this.state.messageSearchLimit);const i={publicDirectory:!1,message:!1,indexedDb:!1,bots:!1,allPeople:!1,fastContacts:!1,messageInConversation:!0};(0,Be.compositeScenarioResultsRendered)(e,Ve.CompositeSearchOrigin.SearchInConversationPanel,void 0,s,i)}}_focusMountedItemOnMobile(){this._mountedItemToFocus?this._mountedItemToFocus.focusItemForScreenReader():L.warn(A.LogTraceArea.MessageStream,"Focus should be on message stream, but no item mounted")}_checkForConsumptionHorizonChange(){var e;if(L.log(A.LogTraceArea.ConsumptionHorizon,"MessageStream convId="+ce.mriOrId(this.props.conversationId)+" _checkForConsumptionHorizonChange"),this.props.conversationId===S.SkonsoleMri)return;if(0===this._dataItemsInfo.getItemList().length)return void L.log(A.LogTraceArea.ConsumptionHorizon,"MessageStream convId="+ce.mriOrId(this.props.conversationId)+" no messages displayed");if(!this._isUserActive())return void L.log(A.LogTraceArea.ConsumptionHorizon,"MessageStream convId="+ce.mriOrId(this.props.conversationId)+" user not active");if(this._lockUpdatesToConsumptionHorizon)return void L.log(A.LogTraceArea.ConsumptionHorizon,"MessageStream convId="+ce.mriOrId(this.props.conversationId)+" locked updates to CH");let t;for(let e=this._bottomPartialViewIndex;e>=0;e--){const s=this._convertViewIndexToMessage(e,!1);if(!s)continue;if(t=s.skypeMessage,s.metadata.streamItemIndex<=this._currentConsumptionHorizonItemIndex)break;const i=s.skypeMessage.isAlbumItem()&&1===N.default.getNotFailedMediaMessagesForAlbum(s.skypeMessage.getAlbumId()).length;if(s.skypeMessage.countsForUnreadCounts()||i)break}const s=null===(e=this._conversation)||void 0===e?void 0:e.getConsumptionHorizonTimestamp();t?(L.log(A.LogTraceArea.ConsumptionHorizon,"lastVisibleItem.createdTime:",t.createdTime,"chTimestamp:",s,"_lastVisibleItemForConsumptionHorizon.createdTime:",this._lastVisibleItemForConsumptionHorizon?this._lastVisibleItemForConsumptionHorizon.createdTime:"_lastVisibleItemForConsumptionHorizon is undefined"),t.createdTime>s&&(!this._lastVisibleItemForConsumptionHorizon||t.createdTime>this._lastVisibleItemForConsumptionHorizon.createdTime)&&(this._lastVisibleItemForConsumptionHorizon=t,L.log(A.LogTraceArea.ConsumptionHorizon,"MessageStream - scheduling update of consumption horizon to: "+t.getConsumptionHorizonString()+" convId="+ce.mriOrId(this.props.conversationId)+" CHindex="+this._currentConsumptionHorizonItemIndex+" BottomWholeViewIndex="+this._bottomWholeViewIndex+" ConsumptionHorizonTimestamp="+s+" current lastVisibleItem.createdTime="+(this._lastVisibleItemForConsumptionHorizon?this._lastVisibleItemForConsumptionHorizon.createdTime:null)+" new lastVisibleItem.createdTime="+t.createdTime),this._consumptionHorizonUpdateDebounceTimer&&Ee.default.clearTimeout(this._consumptionHorizonUpdateDebounceTimer),this._consumptionHorizonUpdateDebounceTimer=Ee.default.setTimeout(this._updateConsumptionHorizonToLastVisibleItem,this._messageReadDelay))):L.log(A.LogTraceArea.ConsumptionHorizon,"lastVisibleItem is undefined")}_renderOldConversationEmptyState(){return r.createElement(r.View,{style:Ze.noMessagesContainer},r.createElement(me.default,{conversationId:this.props.conversationId,displayName:this.props.recipientDisplayName,gender:Fe.default.getFullUserProfileByMriNoSubscription(this.props.conversationId).gender,onGreet:this.props.onGreet,showBorder:!1,alwaysForceEmoticon:!0}))}_renderBookmarkConversationEmptyState(){return r.createElement(l.default,{isUsingStackNavigationContext:this.state.isUsingStackNavigationContext})}render(){var e,t,s;let i,o=null,a=null;if(this.state.isInitialMessagesLoaded)if(this._conversation.isBookmarksThread()&&0===this._skypeMessages.length)o=this._renderBookmarkConversationEmptyState();else if(this.props.isConversationAccepted&&!this.props.isIncomingContactInvitePending&&!this._readOnlyConversation&&m.default.haveAllMessagesForConversation(this.props.conversationId)&&0===this._skypeMessages.length)o=S.isThread(this.props.conversationId)||S.isConversationWithPhoneNumber(this.props.conversationId)?null:this._renderOldConversationEmptyState();else{this.props.isHighlightCommentMode||this._conversation.isBookmarksThread()||(a=r.createElement(ye.StatusPillView,{statusPillInstance:this._statusPillInstance,messageStreamStore:this._messageStreamStore,ref:this._statusPillRef,conversationId:this.props.conversationId,messageStreamFontSize:this.state.messageStreamFontSize}));const e=this.state.scrollToItemViewIndex>=0?this.state.scrollToItemViewIndex:void 0;this._contentRendered||this._markHub2StreamScenarioStepCompleted("StartVMVRendering"),this._contentRendered=!0;const t=this.state.isBookmarksStreamFromTopEnabled&&this._conversation.isBookmarksThread()?this.state.streamHeight:void 0;o=r.createElement(Oe.VirtualMessageView,{key:this._virtualMessageViewRefCount,ref:this._onListViewRef,observableList:this._dataItemsInfo,renderItem:this._renderItem,shouldUpdateItem:this._shouldUpdateItem,contentMaxWidth:W.messageStreamMaxContentWidth,onVisibleRangeChanged:this._onVisibleRangeChanged,initialScrollIndex:e,shouldFocusInitialItem:this.state.shouldFocusScrolledMessageCell&&!this.props.isMessageSearchPanelVisible||this._conversation.isBookmarksThread(),isMessageSearchPanelVisible:this.props.isMessageSearchPanelVisible,allowKeyboardLayoutUpdates:this.props.isMessageSearchPanelVisible,onUserScroll:this._onScroll,onLayout:this.props.onMessageStreamLayout,onInitialRenderComplete:this._onInitialRenderComplete,keyboardShouldPersistTaps:!0,keyboardDismissMode:Pe.default.getPlatformType()===A.PlatformType.Android?"none":"on-drag",scrollsToTop:!this.state.isReactionDetailsOn,scrollEnabled:!this.state.isScrollDisabled,horizontalPadding:this.props.safeAreaHorizontalInsets,canShowSuggestions:this.state.canShowSuggestions,leftSpacerWidth:this.props.leftSpacerWidth,rightSpacerWidth:this.props.rightSpacerWidth,useWideLayout:!this.state.isUsingStackNavigationContext,startFromTop:this.state.isBookmarksStreamFromTopEnabled&&this._conversation.isBookmarksThread(),streamContainerHeight:t}),this.state.enableMultiMessageQuoteOnKeyboard&&(o=r.createElement(n.default,{ref:this._onCopyListenerRef,handler:this._onCopy},o))}else o=r.createElement(r.View,{style:Ze.spinnerContainer},r.createElement(we.default,{size:f.SXActivityIndicatorSize.Medium,tintColor:J.default.getPrimaryColorNoSubscription(),deferTimeMs:1e3}));const l=!(null===(e=this._conversation)||void 0===e?void 0:e.isSkypeSMSConversation())&&!(null===(t=this._conversation)||void 0===t?void 0:t.isEncryptedThread()),d=!this.props.hideSuggestions&&this.state.isLatestMessageTheEnd&&!!this.state.lastMessage&&l&&!(null===(s=this._conversation)||void 0===s?void 0:s.isBookmarksThread()),c=this.state.isUsingStackNavigationContext&&this.props.isMessageSearchPanelVisible;this._initialRenderCompleted&&d&&this.state.lastMessage&&(i=r.createElement(Ie.default,{key:"SwiftQuickReplyListView",conversationId:this.props.conversationId,lastMessage:this.state.lastMessage,useCompactLayout:this.state.useCompactLayout,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,onCardSuggestionAction:this.props.onCardSuggestionAction,disableQuickReply:this.props.isSelectMessagesModeActive||c,onSuggestionClicked:this.props.onSuggestionClicked,ref:this._onSuggestionsListViewRef}),this.state.isUsingStackNavigationContext||(i=r.createElement(r.View,{style:Ze.actionsDesktopContainer},r.createElement(r.View,{style:this._getSpacerStyle(this.props.leftSpacerWidth)}),i,r.createElement(r.View,{style:this._getSpacerStyle(this.props.rightSpacerWidth)}))));let h,u=[Ze.contentAreaContainer];this.props.isSelectMessagesModeActive||(h=r.createElement(O.default,{key:"jumpToEndButton",ref:this._onJumpToEndButtonRef,onPressCallback:this._onJumpToEndButtonPress,conversationId:this.props.conversationId,horizontalPadding:this.props.safeAreaHorizontalInsets}));const p=this.props.renderDivider?this.props.renderDivider():void 0,g=this.props.preventAccessibilityFocus?r.Types.ImportantForAccessibility.NoHideDescendants:void 0;return r.createElement(r.View,{style:Ze.contentOuterContainer,importantForAccessibility:g,onLayout:this._onOuterContainerLayout},r.createElement(r.View,{style:u},o,a,h),p,i)}_getSpacerStyle(e){return et[e]||(et[e]=r.Styles.createViewStyle({flex:1,minWidth:e})),et[e]}_onScrolledToTheBottom(e){this.props.onScrolledToTheBottom&&this.props.onScrolledToTheBottom(e)}_scrollToBottomOfRefreshedStream(){const e=this._refreshConversationProperties(this.props,this.state,!0,!0);this.setState(e)}_reportRenderItemQoS(e,t){const s=ae.default.getTelemetryScenarioForMessage(e.conversationId,e.cuid);if(!s)return;const i=s.getSecondaryScenario(he.ScenarioName.SendTextMessageTimeToAppearInChat);i&&(t?(i.markStepCompleted("AnimationCompleted"),i.finish()):i.isStepMarked("Render")||i.markStepCompleted("Render"));const o=e.isMessageLie();let n=s.getSecondaryScenario(he.ScenarioName.SendTextMessageUI);if(n||(n=s.getSecondaryScenario(he.ScenarioName.SendPictureUI)),!n)return;const r="Visible"+(o?"Lie":"Real")+"ItemRender";o?n.isStepMarked(r)||n.markStepCompleted(r,void 0,void 0,!0):n.markPerfTargetStepCompleted(r),o||n.finish()}_scrollToBottom(){this._listView&&this._listView.scrollToBottom(),this._lockUpdatesToConsumptionHorizon=!1}_markHub2StreamScenarioStepCompleted(e){this._getContext().isPresentedInDesktopSubview||te.default.markScenarioStepCompleted(this.props.conversationId,e)}_getNewConnectionString(){const e=Fe.default.getFullUserProfileByMri(this.props.conversationId),t=B.getLocalizeParamForGender(e.gender);return V.getString("NewConnectionIndicator.UserAddedToContactList",{user:e.getShortName(),gender:t})}getSkypeMessages(){return this._skypeMessages}feedEphemeralMessage(e){this._messageStreamStore&&this._messageStreamStore.feedEphemeralMessage(e)}_checkMessageStreamStoreAndUpdate(e,t,s){this._messageStreamStore&&t&&this._messageStreamStore.isDestroyed()&&(this._updateMessageStreamStore(e,t.messageTimestamp,!1),L.log(A.LogTraceArea.MessageStreamDebug,"Update MessageStreamStore object reason: "+s))}_isUserActive(){return this._isUserPresentInApp||this._isUserScrolling}_maybeAnimateScrollToPosition(e,t){if(!(0,x.default)(e,t)&&!o.isUndefined(t)&&t.messageTimestamp){const e=o.findIndex(this._dataItemsInfo.getItemList(),(e=>e instanceof Ne&&e.skypeMessage.createdTime===t.messageTimestamp));if(e>-1&&this._listView){const t=this._dataItemsInfo.getItemList()[e].key;this._listView.scrollToPosition(e,t,!0)}}}}t.default=st},96285:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(22801),n=s(71830),r=s(69840),a=s(98278),l=s(39549),d=s(31761),c=s(12381),h=s(37490),u=s(52262),p=s(46096),g=s(10117),m=s(36237),S=s(15877),f=s(33754),y=s(6658),_=s(18078),v=s(4735),C=s(95691),b=s(29130),T=s(10541),M=s(22222),I=s(81760),w=s(11828),P=s(80837),k=s(19675),A=s(24576),E=s(88523),R=s(2301),L=s(67977),F=s(53374),x=(0,S.lazyProperties)({container:()=>i.Styles.createViewStyle({paddingTop:20,paddingBottom:60}),avatar:()=>i.Styles.createViewStyle({marginBottom:10}),headerStyles:()=>i.Styles.createTextStyle({marginBottom:10}),participantsContainer:()=>i.Styles.createViewStyle({flexDirection:"row",marginBottom:20}),participantsIcon:()=>i.Styles.createViewStyle({marginRight:10}),actionsContainer:()=>i.Styles.createViewStyle({alignItems:"center",borderRadius:8,paddingTop:30,paddingBottom:15,paddingHorizontal:40,marginTop:75}),actionCaption:()=>i.Styles.createTextStyle({color:I.Color.gray400,marginBottom:20}),link:()=>i.Styles.createTextStyle({color:I.Color.blueDark,marginBottom:20}),linkButtonMinWidth:()=>i.Styles.createViewStyle({marginTop:10})});class O extends A.default{constructor(){super(...arguments),this._shareLinkToGroup=()=>{const e=F.default.newCauseId();m.log(p.LogTraceArea.MessageStream,"NewConversationLanding._shareLinkToGroup causeId: "+e),this._hasLink()&&this.state.inviteLink&&this.state.myDisplayName?(c.default.shareToClipboard(this.state.inviteLink),this.setState({isCopied:!0})):m.error(p.LogTraceArea.MessageStream,"NewConversationLanding._shareLinkToGroup inviteLink: "+!!this.state.inviteLink+" myDisplayName: "+!!this.state.myDisplayName)},this._onGroupSettingsPress=()=>{const e=F.default.newCauseId();m.log(p.LogTraceArea.MessageStream,"NewConversationLanding._onGroupSettingsPress causeId: "+e),h.dismissAll(),v.default.showDetailsPanelWithParams({mri:this.props.conversationId,showConversationSettings:!0,rootViewId:this._getRootViewId(),causeId:e})},this._onSharePress=()=>{const e=F.default.newCauseId();m.log(p.LogTraceArea.MessageStream,"NewConversationLanding._onSharePress causeId: "+e),h.dismissAll(),n.isThread(this.props.conversationId)&&(this.state.isJoinEnabled?this._shareLinkToGroup():(this.setState({isCreatingJoinLink:!0}),o.default.setJoinEnabled(this.props.conversationId,!this.state.isJoinEnabled)))},this._onAddPress=()=>{const e=F.default.newCauseId();m.log(p.LogTraceArea.MessageStream,"NewConversationLanding._onAddPress causeId: "+e),h.dismissAll(),E.contactAdded(this.props.conversationId);new d.default({convId:n.asSkypeThreadIdMaybe(this.props.conversationId),navigationOrigin:p.NavigationConversationOrigin.NewChat,peopleType:T.PeopleType.All,filterPeopleType:T.FilterType.GroupCapable,wizardSteps:[C.WizardSteps.setConvParticipants]}).start(this._getRootViewId())}}_buildState(e,t){const s=(0,l.default)().getConversation(e.conversationId),i=_.default.getSkypeMri();return{conversationName:u.default.getDisplayName(e.conversationId),myDisplayName:u.default.getDisplayName(i),isJoinEnabled:s&&s.isJoinEnabled(),inviteLink:s&&r.default.getLink(s.id),isCreatingJoinLink:!t&&this.state.isCreatingJoinLink,isMinWidth:b.default.isMobileScreenSize(this._getRootViewId())}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.isCreatingJoinLink&&this._hasLink()&&t.isJoinEnabled!==this.state.isJoinEnabled&&(this._shareLinkToGroup(),this.setState({isCreatingJoinLink:!1}))}render(){const e=this.state.conversationName?i.createElement(k.Header,{size:a.HeaderSize.h5,style:x.headerStyles},this.state.conversationName):void 0,t=this._useDarkTheme()?i.Styles.createViewStyle({borderColor:I.Color.gray400,borderWidth:1},!1):i.Styles.createViewStyle({backgroundColor:I.Color.gray50Overlay50},!1),s=f.getString("ContentPanelHeaderTitle.ParticipantsLowercase",{count:this.props.memberCount}),o=this.state.isCopied?f.getString("InviteShare.ShareCopiedButtonLabel"):f.getString("MessageStream.NewConversationLandingShareGroupLink"),n=i.Styles.createViewStyle({alignSelf:"stretch",flexDirection:this.state.isMinWidth?"column":"row"},!1),r=this._hasLink()?i.createElement(k.BodyText,{style:[x.link,this._useAccessibleTheme()?this._themeStyles.primaryTextColorStyle:void 0],selectable:!0},this.state.inviteLink):void 0;return i.createElement(i.View,{style:[x.container,P.default.alignItemsCenter]},i.createElement(R.default,{style:x.avatar,size:L.UserIconSize.Size100,userMri:this.props.conversationId}),e,i.createElement(i.View,{style:x.participantsContainer},i.createElement(g.default,{icon:w.SkypeIcon.ContactGroup,size:w.IconSize.size16,color:this._themeColors.primaryTextColor,style:x.participantsIcon}),i.createElement(k.Caption,{messageStreamFontSize:y.MessageStreamFontSize.Large},s)),i.createElement(M.default,{icon:w.SkypeIcon.Topic,iconPositon:a.SXButtonIconPosition.End,buttonSize:a.SXButtonSize.Medium,buttonStyle:a.SXButtonStyle.ThemeNoBackground,title:f.getString("MessageStream.NewConversationLandingGroupSettingsLink"),onPress:this._onGroupSettingsPress}),i.createElement(i.View,{style:[x.actionsContainer,t]},r,i.createElement(k.BodyText,{style:x.actionCaption,textThemeColor:a.TextThemeColor.Primary},f.getString("MessageStream.NewConversationLandingActionsCaption")),i.createElement(i.View,{style:n},i.createElement(M.default,{buttonSize:a.SXButtonSize.Medium,buttonStyle:a.SXButtonStyle.ColorFill,title:f.getString("MessageStream.NewConversationLandingAddPeopleButton"),onPress:this._onAddPress}),i.createElement(M.default,{style:this.state.isMinWidth?x.linkButtonMinWidth:void 0,buttonSize:a.SXButtonSize.Medium,buttonStyle:a.SXButtonStyle.ThemeNoBackground,title:o,onPress:this._onSharePress,disabled:this.state.isCreatingJoinLink}))))}_hasLink(){return this.state.isJoinEnabled&&this.state.inviteLink}}t.default=O},94060:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(37490),n=s(70891),r=s(90120),a=s(10400),l=s(15877),d=s(19089),c=s(43512),h=s(48443),u=s(29130),p=s(81760),g=s(80837),m=s(24576),S=s(33820),f=10,y=(0,l.lazyProperties)({wrapperFullscreen:()=>i.Styles.createViewStyle({backgroundColor:p.Color.black,justifyContent:"center"}),container:()=>i.Styles.createViewStyle({position:"absolute"})}),_={};class v extends m.default{constructor(){super(...arguments),this._currentTopValue=f,this._currentLeftValue=f,this._animatedTopValue=new i.Animated.Value(this._currentTopValue),this._animatedLeftValue=new i.Animated.Value(this._currentTopValue),this._animatedStyle=i.Styles.createAnimatedViewStyle({top:this._animatedTopValue,left:this._animatedLeftValue}),this._onClose=e=>{this._telemetryScenario&&this.state.contentProps&&(this._telemetryScenario.finish(this.state.contentProps,e),this._telemetryScenario=void 0),d.default.setContentProps(void 0)},this._onFullScreen=()=>{this.setState({isFullScreen:!this._shouldPlayFullScreen()})},this._onPan=e=>{const t=e.pageY-(this._lastPageY||e.initialPageY),s=e.pageX-(this._lastPageX||e.initialPageX);this._lastPageY=e.pageY,this._lastPageX=e.pageX;const o=this._currentTopValue+t,n=this._currentLeftValue+s,r=this._getContainerHeight(),a=this._getContainerWidth();if(this._currentTopValue=Math.min(Math.max(-r/2,o),this.state.draggableArea.height-r/2),this._currentLeftValue=Math.min(Math.max(-a/2,n),this.state.draggableArea.width-a/2),e.isComplete){this._lastPageX=void 0,this._lastPageY=void 0;const e=this._currentTopValue<this.state.draggableArea.height/2-r/2?f:this.state.draggableArea.height-f-r;i.Animated.parallel([i.Animated.timing(this._animatedTopValue,{toValue:e,easing:i.Animated.Easing.Out(),duration:150}),i.Animated.timing(this._animatedLeftValue,{toValue:f,easing:i.Animated.Easing.Out(),duration:150})]).start((()=>{this.isComponentMounted()&&(this._currentLeftValue=f,this._currentTopValue=e)}))}else this._animatedTopValue.setValue(this._currentTopValue),this._animatedLeftValue.setValue(this._currentLeftValue)}}_buildState(e,t){const s=this._getRootViewId(),i={viewWidth:u.default.getWidth(s),viewHeight:u.default.getHeight(s)+a.default.getUpdateInfo().height,isLandscape:u.default.getDeviceOrientation(s)===r.DeviceOrientation.Landscape,draggableArea:h.default.getDraggableArea(),contentProps:d.default.getContentProps()};return!i.contentProps||!t&&this.state.contentProps||(this._telemetryScenario=new c.default(i.contentProps)),i}_shouldPlayFullScreen(){return this.state.isFullScreen||this.state.isLandscape}_getContainerWidth(){return this._shouldPlayFullScreen()?this.state.viewWidth:this.state.draggableArea.width-20}_getContainerHeight(){return this.state.isLandscape?this.state.viewHeight:Math.round(this._getContainerWidth()*(this.state.viewWidth/this.state.viewHeight))}componentWillUnmount(){super.componentWillUnmount(),this._onClose(c.FinishReason.PipDestroyed)}UNSAFE_componentWillUpdate(e,t,s){if(super.UNSAFE_componentWillUpdate(e,t,s),this.state.draggableArea.height!==t.draggableArea.height&&this._currentTopValue!==f){const e=t.draggableArea.height-f-this._getContainerHeight();i.Animated.timing(this._animatedTopValue,{toValue:e,easing:i.Animated.Easing.Out(),duration:150}).start((()=>{this.isComponentMounted()&&(this._currentTopValue=e)}))}const n=this.state.isLandscape!==t.isLandscape||this.state.isFullScreen!==t.isFullScreen;this._telemetryScenario&&n&&t.contentProps&&this._telemetryScenario.markViewModeChanged(t.contentProps,{isLandscape:t.isLandscape,wasLandscape:this.state.isLandscape,isFullScreen:t.isFullScreen,wasFullScreen:this.state.isFullScreen});const r=!this.state.isLandscape&&t.isLandscape,a=!this.state.isFullScreen&&t.isFullScreen;t.contentProps&&(a||r)&&o.dismissAll()}_getDraggableAreaStyle(){const e=Object.assign({},this.state.draggableArea),t=`${e.width}x${e.height}x${e.x}x${e.y}`;return _[t]||(_[t]=i.Styles.createViewStyle({position:"absolute",overflow:"hidden",top:e.y,left:e.x,width:e.width,height:e.height,backgroundColor:p.Color.transparent})),_[t]}render(){const e=this._renderContent();if(!e)return null;const t=this._shouldPlayFullScreen(),s=t?[g.default.absoluteFill,y.wrapperFullscreen]:this._getDraggableAreaStyle(),o=[g.default.dimensionsStyle({width:this._getContainerWidth(),height:this._getContainerHeight()})];return t||o.push(y.container,this._animatedStyle),i.createElement(i.View,{style:s,ignorePointerEvents:!t},i.createElement(i.Animated.View,{style:o},i.createElement(i.GestureView,{onPan:t?void 0:this._onPan,style:g.default.flexOne},e)))}_renderContent(){if(this.state.contentProps&&this._telemetryScenario)return this.state.contentProps.contentType===n.PipContentType.Youtube?i.createElement(S.default,Object.assign({containerWidth:this._getContainerWidth(),onClose:this._onClose,onFullScreen:this._onFullScreen,isLandscape:this.state.isLandscape,isFullScreen:this.state.isFullScreen,viewportWidth:this.state.viewWidth,viewportHeight:this.state.viewHeight,telemetryScenario:this._telemetryScenario},this.state.contentProps)):void 0}}t.default=v},33820:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(38933),n=s(16778),r=s(98278),a=s(13944),l=s(15877),d=s(33754),c=s(43512),h=s(51070),u=s(4057),p=s(15415),g=s(81760),m=s(11010),S=s(11828),f=s(59433),y=s(80837),_=s(24576),v=s(12770),C=s(26712),b=s(16718),T=s(54288),M=s(20481),I=s(72090),w=(0,l.lazyProperties)({controlsWrapper:()=>n.Styles.createViewStyle({flexDirection:"column",alignSelf:"stretch",backgroundColor:g.Color.transparent}),controlsHeader:()=>n.Styles.createViewStyle({flexDirection:"row",flex:0,height:45}),headerButton:()=>n.Styles.createButtonStyle({width:35,height:35}),videoControlContainer:()=>n.Styles.createViewStyle({flex:1,justifyContent:"center",alignItems:"center",overflow:"visible"}),openInNativeAppLink:()=>n.Styles.createLinkStyle({backgroundColor:g.Color.blackOverlay50,padding:10,width:250,color:g.Color.white,fontSize:m.default.fontSize.size20,textAlign:"center"}),videoControlButton:()=>n.Styles.createButtonStyle({borderRadius:40,width:80,height:80,flex:-1,justifyContent:"center",alignItems:"center"}),videoControlButtonProtection:()=>n.Styles.createViewStyle({width:80,height:80,backgroundColor:g.Color.blackOverlay50,borderRadius:40})}),P={};class k extends _.default{constructor(){super(...arguments),this._onOpenInNativeAppPress=()=>{this._openInNativeApp(c.FinishReason.UserOpenedApp)},this._onErrorMessagePress=()=>{this._openInNativeApp(c.FinishReason.RestrictedVideoOpenedInApp)},this._onFullScreenPressed=()=>{this._showControls(),this.props.onFullScreen()},this._onClosePressed=()=>{this.props.onClose(c.FinishReason.UserClosed)},this._getCurrentTime=()=>{this._webView&&this._webView.postMessage(JSON.stringify({type:I.MessageType.GetCurrentTime}))},this._onMediaButton=()=>{this._webView&&this._webView.postMessage(JSON.stringify({type:this.state.playbackState===M.PlaybackState.Playing?I.MessageType.Pause:I.MessageType.Play}))},this._onMessage=e=>{if(!this.isComponentMounted())return;const t=u.default.parseJsonErrorable(e.data);if(!i.isError(t))switch(t.type){case I.MessageType.PlayerStateChanged:const e=t;e.state===M.PlaybackState.Paused||e.state===M.PlaybackState.Ended?this._showControls(!0):this._scheduleHideControls(),this.props.telemetryScenario.markPlaybackStateChanged(this.props,{newState:M.PlaybackState[e.state],oldState:M.PlaybackState[this.state.playbackState]}),this._videoViewerControlsStore&&(this._videoViewerControlsStore.setVideoPlayState(e.state===M.PlaybackState.Playing?T.VideoPlayState.Playing:T.VideoPlayState.Paused),this._videoViewerControlsStore.setVideoPlayProgress({current:e.currentTime,duration:e.duration})),this.setState({playbackState:e.state,videoDuration:e.duration});break;case I.MessageType.CurrentTime:const s=t;this.state.videoDuration&&this._videoViewerControlsStore&&this._videoViewerControlsStore.setVideoPlayProgress({current:s.currentTime,duration:this.state.videoDuration});break;case I.MessageType.VideoError:this.props.telemetryScenario.markContentFailedToLoad(this.props),this.setState({hasError:!0})}},this._onControlsProtectionPress=()=>{this._showControls()},this._onSeekTo=(e,t)=>{this._webView&&this.state.videoDuration&&this._videoViewerControlsStore&&(t?(this._showControls(!0),this._clearScrubberUpdateInterval()):(this._scheduleHideControls(),this._startScrubberUpdateInterval()),this._webView.postMessage(JSON.stringify({type:I.MessageType.SeekTo,seekTo:e*this.state.videoDuration,isDragging:t})),this._videoViewerControlsStore.setVideoPlayProgress({current:e*this.state.videoDuration,duration:this.state.videoDuration}))},this._scheduleHideControls=()=>{this._hideControlsTimeout=v.default.setTimeout((()=>{this.isComponentMounted()&&(this.setState({showControls:!1}),(this.props.isFullScreen||this.props.isLandscape)&&this._disableScrubber())}),3e3)},this._onWebViewRef=e=>{this._webView=e||void 0}}_buildState(e,t){const s=this.props,i={};return t?(i.playbackState=M.PlaybackState.Unstarted,i.showControls=!0):s.videoUrl!==e.videoUrl&&(this._clearHideControlsTimeout(),e.telemetryScenario.markContentChanged(e),i.playbackState=M.PlaybackState.Unstarted,i.showControls=!0,i.hasError=!1,i.videoDuration=void 0),i.leftInset=h.default.horizontalInsets().left,i}componentDidMount(){super.componentDidMount(),(this.props.isFullScreen||this.props.isLandscape)&&this._enableScrubber()}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t),!this.props.isFullScreen&&e.isFullScreen||!this.props.isLandscape&&e.isLandscape?this._enableScrubber():(this.props.isFullScreen&&!e.isFullScreen||this.props.isLandscape&&!e.isLandscape)&&this._disableScrubber()}componentWillUnmount(){super.componentWillUnmount(),this._clearScrubberUpdateInterval()}render(){const e=this.props.isLandscape?this.props.viewportWidth:this.props.viewportHeight,t=this.props.isLandscape?this.props.viewportHeight:this.props.viewportWidth,s=[];return this.props.isLandscape?s.push(y.default.flexOne):s.push(y.default.dimensionsStyle({width:e,height:t}),this._getTransformScaleStyle(e,t)),this.state.leftInset&&s.push(n.Styles.createViewStyle({marginLeft:-this.state.leftInset},!1)),n.createElement(n.View,{style:y.default.flexOne},n.createElement(n.View,{style:s},n.createElement(M.default,{key:"player",width:e,height:t,videoId:encodeURIComponent(this.props.videoId),videoPreviewUrl:C.default.isUrlValid(this.props.videoPreviewUrl)?this.props.videoPreviewUrl:void 0,onMessage:this._onMessage,onWebViewRef:this._onWebViewRef})),this._getControls())}_getTransformScaleStyle(e,t){const s=`${e}x${t}x${this.props.containerWidth}`;if(!P[s]){const i=this.props.containerWidth/e;P[s]=n.Styles.createViewStyle({transform:[{translateY:-t/2},{translateX:-e/2},{scale:i},{translateY:t/2},{translateX:e/2}]})}return P[s]}_getControls(){const e=[];if(this.state.showControls){const t=[n.createElement(a.default,{key:"cancel",size:S.IconSize.size20,color:g.Color.white,hoverColor:g.Color.gray400overlay95,icon:S.SkypeIcon.ClosePanel,onPress:this._onClosePressed,title:d.getString("Global.CloseButtonTitle"),accessibilityLabel:d.getString("Global.CloseButtonTitle"),style:w.headerButton})];this.props.isLandscape||t.push(n.createElement(a.default,{key:"fullscreen",size:S.IconSize.size14,color:g.Color.white,hoverColor:g.Color.gray400overlay95,icon:this.props.isFullScreen?S.SkypeIcon.Contract:S.SkypeIcon.Expand,onPress:this._onFullScreenPressed,title:d.getString("CallPanel.FullScreenButton"),accessibilityLabel:d.getString("CallPanel.FullScreenButton"),style:w.headerButton})),t.push(n.createElement(n.View,{key:"spacer",style:y.default.flexOne})),t.push(n.createElement(a.default,{key:"openInApp",size:S.IconSize.size16,color:g.Color.white,hoverColor:g.Color.gray400overlay95,icon:S.SkypeIcon.OpenOutside,onPress:this._onOpenInNativeAppPress,title:d.getString("MediaViewer.OpenInYouTubeApp"),accessibilityLabel:d.getString("MediaViewer.OpenInYouTubeApp"),style:w.headerButton}));const s=this._videoViewerControlsStore?n.createElement(b.VideoViewerControls,{controlsStore:this._videoViewerControlsStore,onPlayOrPause:i.noop,useCompactLayout:!0}):void 0;e.push(n.createElement(o.GradientView,{key:"controlsHeader",style:w.controlsHeader,direction:o.GradientDirection.BOTTOM,colors:[g.Color.blackOverlay60,g.Color.blackOverlay40,g.Color.transparent]},t),n.createElement(n.View,{key:"videoControls",style:w.videoControlContainer},this._getVideoControl()),n.createElement(n.View,{key:"controlsFooter",style:w.controlsHeader},s))}return n.createElement(n.View,{key:"controlsProtection",style:[w.controlsWrapper,y.default.absoluteFill],onPress:this._onControlsProtectionPress,disableTouchOpacityAnimation:!0},e)}_openInNativeApp(e){n.Linking.openUrl(this.props.videoUrl),this.props.onClose(e)}_getVideoControl(){if(this.state.hasError)return n.createElement(f.default,{url:this.props.videoUrl,onPress:this._onErrorMessagePress,style:w.openInNativeAppLink},"This video cannot be watched outside YouTube. Click here to open YouTube.");if(this.state.playbackState===M.PlaybackState.Unstarted)return n.createElement(n.View,{style:w.videoControlButtonProtection},n.createElement(p.default,{size:r.SXActivityIndicatorSize.Large,tintColor:g.Color.white}));return this.state.playbackState>=M.PlaybackState.Ended&&this.state.playbackState<=M.PlaybackState.Paused?n.createElement(n.View,{style:w.videoControlButtonProtection},n.createElement(a.default,{icon:this.state.playbackState===M.PlaybackState.Playing?S.SkypeIcon.Pause:S.SkypeIcon.Play,size:S.IconSize.size40,color:g.Color.white,hoverColor:g.Color.whiteOverlay90,onPress:this._onMediaButton,style:w.videoControlButton})):void 0}_enableScrubber(){this._videoViewerControlsStore||(this._videoViewerControlsStore=new T.VideoViewerControlsStore,this._videoViewerControlsStore.registerViewerCallbacks({onPlay:i.noop,onPause:i.noop,onSeekTo:this._onSeekTo}),this._videoViewerControlsStore.setScrubberControlsVisibility(!0),this._getCurrentTime(),this._startScrubberUpdateInterval())}_disableScrubber(){this._videoViewerControlsStore&&(this._videoViewerControlsStore=void 0,this._clearScrubberUpdateInterval())}_startScrubberUpdateInterval(){this._scrubberUpdateTimeout||(this._scrubberUpdateTimeout=v.default.setInterval(this._getCurrentTime,1e3))}_clearScrubberUpdateInterval(){this._scrubberUpdateTimeout&&(v.default.clearInterval(this._scrubberUpdateTimeout),this._scrubberUpdateTimeout=void 0)}_clearHideControlsTimeout(){this._hideControlsTimeout&&(v.default.clearTimeout(this._hideControlsTimeout),this._hideControlsTimeout=void 0)}_showControls(e=!1){this._clearHideControlsTimeout(),(this.props.isFullScreen||this.props.isLandscape)&&this._enableScrubber(),this.state.showControls||this.setState({showControls:!0}),e||this._scheduleHideControls()}}t.default=k},20481:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PlaybackState=void 0;const i=s(16778),o=s(15877),n=s(33754),r=s(81760),a=s(24576),l=s(72090);!function(e){e[e.Unstarted=-1]="Unstarted",e[e.Ended=0]="Ended",e[e.Playing=1]="Playing",e[e.Paused=2]="Paused",e[e.Buffering=3]="Buffering",e[e.Cued=5]="Cued"}(t.PlaybackState||(t.PlaybackState={}));const d=(0,o.lazyProperties)({webview:()=>i.Styles.createViewStyle({backgroundColor:r.Color.black,flex:1})});class c extends a.default{shouldComponentUpdate(e,t,s){return super.shouldComponentUpdate(e,t,s),e.videoId!==this.props.videoId}render(){return i.createElement(i.WebView,{key:this.props.videoId,ref:this.props.onWebViewRef,mediaPlaybackRequiresUserAction:!1,allowsInlineMediaPlayback:!0,onMessage:this.props.onMessage,source:(0,l.default)({videoId:this.props.videoId,width:this.props.width,height:this.props.height,locale:(0,n.getLocale)(),videoPreviewUrl:this.props.videoPreviewUrl}),javaScriptEnabled:!0,style:d.webview})}}t.default=c},72090:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageType=void 0;const i=s(53374);var o;!function(e){e[e.VideoError=0]="VideoError",e[e.PlayerStateChanged=1]="PlayerStateChanged",e[e.Play=2]="Play",e[e.Pause=3]="Pause",e[e.GetCurrentTime=4]="GetCurrentTime",e[e.CurrentTime=5]="CurrentTime",e[e.SeekTo=6]="SeekTo"}(o=t.MessageType||(t.MessageType={}));t.default=function(e){const t=i.default.newCauseId(),s=(e=>`\nbase-uri 'self' https:;\ndefault-src 'self' https:;\nscript-src 'nonce-${e}' https://s.ytimg.com https://www.youtube.com 'report-sample' 'unsafe-inline';\nconnect-src 'self' https://www.youtube.com;\nchild-src https://s.ytimg.com https://www.youtube.com;\nreport-uri https://edge.skype.com/r/c;\n`)(t);return{html:`\n<!DOCTYPE html>\n<html>\n<head>\n<style>\n    iframe, html, body {\n        margin: 0;\n        padding: 0;\n        background-color: black;\n        width: ${e.width}px;\n        height: ${e.height}px;\n    }\n\n    .fillAbsolute {\n        position: absolute;\n        left: 0;\n        top: 0;\n        width: ${e.width}px;\n        height: ${e.height}px;\n    }\n</style>\n<meta http-equiv="X-Content-Security-Policy" content="${s}">\n<meta http-equiv="Content-Security-Policy" content="${s}">\n<meta name="viewport" content="width=device-width, initial-scale=1">\n</head>\n<body>\n    <div id="player"></div>\n    ${e.videoPreviewUrl?'<img id="cover" class="fillAbsolute" src="'+e.videoPreviewUrl+'"/>':""}\n\n    <script nonce="${t}">\n    var tag = document.createElement('script');\n    tag.src = "https://www.youtube.com/iframe_api";\n    var firstScriptTag = document.getElementsByTagName('script')[0];\n    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n\n    var player;\n    var coverRemoved = ${!e.videoPreviewUrl};\n    function onYouTubeIframeAPIReady() {\n        player = new YT.Player('player', {\n        height: '${e.height}',\n        width: '${e.width}',\n        videoId: '${e.videoId}',\n        playerVars: {\n            'playsinline': 1,\n            'enablejsapi': 1,\n            'fs': 0,\n            'hl': '${e.locale}',\n            'iv_load_policy': 3,\n            'modestbranding': 1,\n            'controls': 0,\n            'rel': 0,\n        },\n        events: {\n            'onReady': onPlayerReady,\n            'onStateChange': onPlayerStateChange,\n            'onError': onError,\n        }\n        });\n    }\n\n    function onPlayerReady(event) {\n        event.target.playVideo();\n\n        document.addEventListener('message', function (event) {\n            var data = JSON.parse(event.data);\n\n            switch (data.type) {\n                case ${o.Play}:\n                    player.playVideo();\n                    break;\n                case ${o.Pause}:\n                    player.pauseVideo();\n                    break;\n                case ${o.GetCurrentTime}:\n                    window.postMessage(JSON.stringify({\n                        type: ${o.CurrentTime},\n                        currentTime: player.getCurrentTime(),\n                    }));\n                    break;\n                case ${o.SeekTo}:\n                    player.seekTo(data.seekTo, !data.isDragging);\n                    break;\n            }\n        });\n    }\n\n    function onError() {\n        window.postMessage(JSON.stringify({type: ${o.VideoError}}));\n    }\n\n    function onPlayerStateChange(event) {\n        if (event.data === 1 && !coverRemoved) {\n            var cover = document.getElementById('cover');\n\n            if (cover) {\n                cover.parentNode.removeChild(cover);\n                coverRemoved = true;\n            }\n        }\n\n        // there are some states, but we want to keep them covered, so report state only after cover is removed (so video starts playing)\n        if (coverRemoved) {\n            window.postMessage(JSON.stringify({\n                type: ${o.PlayerStateChanged},\n                state: event.data,\n                duration: player.getDuration(),\n                currentTime: player.getCurrentTime(),\n            }));\n        }\n    }\n    <\/script>\n</body>\n</html>\n            `}}},18644:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(10117),n=s(36237),r=s(15877),a=s(89808),l=s(4735),d=s(82677),c=s(46200),h=s(81760),u=s(11828),p=s(24576),g=(0,r.lazyProperties)({custumReactioButton:()=>i.Styles.createViewStyle({padding:5,borderRadius:15})});class m extends p.default{constructor(){super(...arguments),this._openCustomReactionPanel=()=>{l.default.navigateToCustomReactionsPanel(this.props.origin,this._getRootViewId()),n.track(new c.CustomReactionsManipulationTelemetry(c.CustomReactionsManipulationAction.CustomReactionsPanelOpened,{customReactionsType:this.props.origin}))}}render(){var e;const t=i.Styles.createButtonStyle({backgroundColor:this._useAccessibleTheme()?h.Color.white:a.default.getPrimaryColorNoSubscription()},!1);return i.createElement(i.Button,{style:[this.props.styles,t,g.custumReactioButton],onPress:this.props.onPress||this._openCustomReactionPanel,title:d.getCustomReactionsStore(this.props.origin).getCustomReactionsModalTitle()},i.createElement(o.default,{size:null!==(e=this.props.iconSize)&&void 0!==e?e:u.IconSize.size20,color:this._useAccessibleTheme()?h.Color.gray300:h.Color.white,icon:u.SkypeIcon.Topic}))}}t.default=m},24112:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(89391),r=s(18603),a=s(32949),l=s(46096),d=s(36237),c=s(15877),h=s(33754),u=s(79348),p=s(82677),g=s(29130),m=s(23528),S=s(11010),f=s(11828),y=s(19675),_=s(24576),v=s(18037),C=s(97634),b=(0,c.lazyProperties)({customReactionContainer:()=>o.Styles.createViewStyle({flex:1,borderBottomWidth:1}),customReactionsPickerMobile:()=>o.Styles.createViewStyle({paddingTop:4,paddingHorizontal:4,height:212}),customReactionsPickerMobileLandscape:()=>o.Styles.createViewStyle({height:118}),emptyState:()=>(0,c.lazyProperties)({sectionTitleText:()=>o.Styles.createViewStyle({marginTop:0,marginBottom:4,marginRight:4,marginLeft:12,paddingTop:4}),sectionTitleTextDestop:()=>o.Styles.createTextStyle({paddingTop:14,marginLeft:16}),sectionContent:()=>o.Styles.createTextStyle({textAlign:"center",marginTop:50})}),horizontalSpaces:()=>o.Styles.createViewStyle({paddingHorizontal:5}),searchResultTitle:()=>o.Styles.createTextStyle({marginTop:14,marginBottom:4,marginRight:4,marginLeft:16}),pesPickerSearchContainer:()=>o.Styles.createViewStyle({flexShrink:1,height:30,borderRadius:5,margin:10})});class T extends _.default{constructor(){super(...arguments),this._searchData={toggledFromSearchCount:0,searchAttemptsCount:0},this._getPesPickerPopupRef=()=>this._getPesPickerPopup,this._onPesPickerPopupRef=e=>{this._getPesPickerPopup=e||void 0},this._getContainerControlRef=()=>this._getContainerControl,this._onContainerControlRef=e=>{this._getContainerControl=e||void 0},this._onRemoveReaction=(e,t,s)=>{var o;const n=null===(o=e.decode())||void 0===o?void 0:o.encodedAttr(),r=p.updateReactionNameWithTone(s,null==n?void 0:n.tone);this._reactionsStore.removeReactions([r]),d.log(l.LogTraceArea.CustomReactionRemovedFromSet,"Reaction from Custom Reactions set is removed, custom reactions left ",i.size(this.state.selectedReactions))},this._onToggleReaction=(e,t,s)=>{var n;const r=null===(n=e.decode())||void 0===n?void 0:n.encodedAttr(),a=p.updateReactionNameWithTone(s,null==r?void 0:r.tone);this._reactionsStore.isLocalReaction(a)?this._reactionsStore.removeReactions([a]):this._reactionsStore.addReactions([a]),d.log(l.LogTraceArea.CustomReactionsToggleFromModal,"Toggle reactions from Custom Reactions modal, number of currently selected reactions ",i.size(this.state.selectedReactions)),this.state.searchQuery&&this.props.updateTelemetryData({toggledEmoticonCount:++this._searchData.toggledFromSearchCount,searchInitiatedCount:this._searchData.searchAttemptsCount}),this.state.selectedReactions.length>this.state.maxSelectedReactions&&o.Accessibility.announceForAccessibility(h.getString("ReactionsPanel.ExceededCustomReactionsLimit",{name:s}))},this._onSearchQueryChange=e=>{if(!this.isComponentMounted())return;const t=e.trim();t!==this.state.searchQuery&&(this.setState({searchQuery:t}),this.state.searchQuery&&this.props.updateTelemetryData({toggledEmoticonCount:this._searchData.toggledFromSearchCount,searchInitiatedCount:++this._searchData.searchAttemptsCount}))},this._onSearchQueryChangeDebounced=i.debounce(this._onSearchQueryChange,n.default.getS4LSearchFeatures().searchHeaderDebounceWait)}_buildState(e,t){return this._reactionsStore=this._getReactionsStore(e.origin),{selectedReactions:this._reactionsStore.getCurrentReactions(),maxSelectedReactions:this._reactionsStore.getCustomReactionsCount()}}_getReactionsStore(e){return p.getCustomReactionsStore(e)}render(){g.default.getWidthNoSubscription(this._getRootViewId()),g.default.getHeightNoSubscription(this._getRootViewId());let e=[];e=[o.Styles.createViewStyle({height:this._getPickerHeight()})];const t=o.createElement(m.default,{inputText:this.state.searchQuery,style:[b.pesPickerSearchContainer,this._themeStyles.searchBorderModernizeColorStyle],searchInputControlStyle:b.horizontalSpaces,placeholderText:h.getString("SearchInputControl.PlaceHolderTextShort"),accessibilityLabel:h.getString("SearchInputControl.PlaceHolderTextShort"),clearSearchIconSize:f.IconSize.size14,clearSearchIconColor:this._themeColors.primaryIconColor,inputStyle:[b.horizontalSpaces,S.default.fontStyle.caption],showSearchIcon:!0,hideBackground:!0,doNotAutoFocusOnMount:!0,onInputTextChange:this._onSearchQueryChangeDebounced}),s=o.createElement(o.View,{style:e},this._hasSelectedReactions()?this._renderCustomReactionsPicker():this._renderPlaceholder()),i=!!this.state.searchQuery&&o.createElement(o.Text,{style:[S.default.fontStyle.caption,b.searchResultTitle,this._themeStyles.pesPickerCategoryColorStyle]},h.getString("SearchInputControl.SearchResults")),n=o.createElement(a.default,{isCustomReactions:!1,doNotRenderPreview:!0,doNotRenderTabIndicator:!1,parentRef:this._getContainerControlRef,pesPickerPopupRef:this._getPesPickerPopupRef,onPesSelected:this._onToggleReaction,ref:void 0,renderMobileInterface:!1,filter:this.state.searchQuery,searchMode:!!this.state.searchQuery,showingInNarrowView:!0,overrideUseSmallEmoticonSizeMobile:!0,darkTheme:this._isDarkTheme(),renderWithToggleIcons:!0,selectedEmoticons:this.state.selectedReactions,hideDiverseIndicatior:!1,hideSearchDelete:!0,initialTabId:this._reactionsStore.getInitialTabId()});return o.createElement(o.View,{style:[b.customReactionContainer,this._themeStyles.headerShadowBorderColorStyle],ref:this._onContainerControlRef},t,s,i,n,o.createElement(u.PesPickerPopup,{ref:this._onPesPickerPopupRef,renderMobileInterface:!1}))}_getPickerHeight(){let e;return e=this.state.maxSelectedReactions<12?82:this.state.maxSelectedReactions<24?121:168,e}_renderPlaceholder(){const e=[S.default.fontStyle.caption,b.emptyState.sectionTitleText];return e.push(b.emptyState.sectionTitleTextDestop),o.createElement(o.View,null,o.createElement(o.Text,{style:e},this._getEmptyStateTitle()),o.createElement(y.BodyText,{style:b.emptyState.sectionContent,textThemeColor:y.TextThemeColor.Secondary},h.getString("ReactionsPanel.NoReactionsSelectedMessage")))}_getEmptyStateTitle(){return h.getString("ReactionsPanel.ReactionsSelectedCounter",{count:0,maximum:this.state.maxSelectedReactions})}_renderCustomReactionsPicker(){return o.createElement(r.CustomReactionsPicker,{isCustomReactions:!0,doNotRenderPreview:!0,doNotRenderTabIndicator:!0,pesPickerPopupRef:this._getPesPickerPopupRef,renderMobileInterface:!1,ref:void 0,onPesSelected:this._onRemoveReaction,searchMode:!1,showingInNarrowView:!0,overrideUseSmallEmoticonSizeMobile:!0,darkTheme:this._isDarkTheme(),renderWithToggleIcons:!0,selectedEmoticons:this.state.selectedReactions,hideDiverseIndicatior:!0,autoFocusFirstItem:!0,customReactionOrigin:this.props.origin})}_hasSelectedReactions(){var e;return!!(null===(e=this.state.selectedReactions)||void 0===e?void 0:e.length)}_isDarkTheme(){return C.isDarkTheme(v.default.colorThemeNoSubscription())}}t.default=T},18603:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CustomReactionsPicker=void 0;const i=s(32949),o=s(33754),n=s(58962),r=s(82677),a=s(11828);class l extends i.default{_buildState(e,t){this.selectedReactions=r.getCustomReactionsStore(e.customReactionOrigin).getCurrentReactions(),this.selectedReactionsCount=this.selectedReactions.length,this.maxNumberOfCustomReactions=r.getCustomReactionsStore(e.customReactionOrigin).getCustomReactionsCount();const s=super._buildState(Object.assign({},e),t);return Object.assign({},s)}_getTabs(e,t){return[{id:"customReactions",packs:[{id:"custom",items:this.selectedReactions,title:this._getTitle()}],tabType:0,iconUrlOrAssetID:""}]}_getInitialPagedTabIndex(){return 0}_getTitle(){return o.getString("ReactionsPanel.ReactionsSelectedCounter",{count:this.selectedReactionsCount,maximum:this.maxNumberOfCustomReactions})}_getErrorSymbol(){return a.SkypeIcon.Blank}_supportsRenderTabsWithoutPaging(){return!1}_getPackAccessibilityLabel(e){return o.getString("PesPicker.CustomReactionsPackHeaderAccessibilityLabel",{count:this.selectedReactionsCount,maximum:this.maxNumberOfCustomReactions})}_getNumberOfItemsPerLine(){const e=n.frameHeights.emoticons.Size40+6;return this.state.availableWidth?Math.floor(this.state.availableWidth/e):void 0}}t.CustomReactionsPicker=l},34102:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionButton=t.ReactionButtonSelectionState=void 0;const i=s(98356),o=s(16778),n=s(88837),r=s(34339),a=s(15877),l=s(82677),d=s(80837);var c;!function(e){e[e.NotSelected=0]="NotSelected",e[e.Selected=1]="Selected"}(c=t.ReactionButtonSelectionState||(t.ReactionButtonSelectionState={}));const h=(0,a.lazyProperties)({button:()=>o.Styles.createButtonStyle({flex:1,alignSelf:"stretch"})});class u extends n.ComponentBase{constructor(){super(...arguments),this._buttonScaleValue=new o.Animated.Value(1),this._buttonScaleAndTranslateStyle=o.Styles.createAnimatedViewStyle({transform:[{scale:this._buttonScaleValue}]}),this._onPress=e=>{e.stopPropagation(),this.props.onPress(e,l.updateReactionNameWithTone(this.props.reactionName,this.props.tone))},this._onLongPress=e=>{e.stopPropagation(),this.props.onLongPress&&this.props.onLongPress(e,l.updateReactionNameWithTone(this.props.reactionName,this.props.tone))},this._onHoverStart=e=>{this.props.onHoverStart&&this.props.onHoverStart(e,l.updateReactionNameWithTone(this.props.reactionName,this.props.tone))},this._onHoverEnd=e=>{this.props.onHoverEnd&&this.props.onHoverEnd(e,l.updateReactionNameWithTone(this.props.reactionName,this.props.tone))}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.props.selectionState!==e.selectionState&&this._startAnimation(this.props.selectionState===c.Selected?1.35:1)}componentWillUnmount(){super.componentWillUnmount(),this._cancelAnimations()}render(){return o.createElement(o.View,{style:[d.default.overflowVisible,this.props.style]},o.createElement(o.Animated.View,{style:[d.default.overflowVisible,this._buttonScaleAndTranslateStyle]},o.createElement(r.AnimatedEmoticon,{size:this.props.size,renderSize:this.props.renderSize,innerText:this.props.title,emoticonName:this.props.reactionName,showPlaceHolder:!0,isStatic:!this.props.animateEmoticon,importantForAccessibility:o.Types.ImportantForAccessibility.NoHideDescendants,zoomHint:this.state.zoomHint,preventSelectable:!0,tone:this.props.tone}),o.createElement(o.View,{style:d.default.absoluteFill},o.createElement(o.Button,{style:h.button,title:this.props.title,accessibilityLabel:this.props.accessibilityLabel,accessibilityTraits:this.props.accessibilityTraits,onHoverStart:this._onHoverStart,onHoverEnd:this._onHoverEnd,onPress:this._onPress,onLongPress:this.props.onLongPress?this._onLongPress:void 0,tabIndex:0,disableTouchOpacityAnimation:!0}))))}_cancelAnimations(){this._pendingAnimation&&this._pendingAnimation.stop()}_startAnimation(e,t){this._cancelAnimations(),this.setState({zoomHint:e}),this._pendingAnimation=o.Animated.parallel([o.Animated.timing(this._buttonScaleValue,{toValue:e,duration:i.Common.Duration.Short,easing:i.Easing.SkypeExpoInOut5,useNativeDriver:!0})]),this._pendingAnimation.start((()=>{this._pendingAnimation=void 0,this.isComponentMounted()&&t&&t()}))}animatePress(e){let t=()=>{e&&e()};this.isComponentMounted()?this._startAnimation(1.35,(()=>{this.isComponentMounted()?this._startAnimation(1,(()=>{t()})):t()})):t()}}t.ReactionButton=u},17459:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionCountButton=void 0;const i=s(96486),o=s(16778),n=s(34339),r=s(89391),a=s(71908),l=s(62602),d=s(29791),c=s(77381),h=s(82433),u=s(46096),p=s(36237),g=s(15877),m=s(33754),S=s(18078),f=s(58962),y=s(25765),_=s(46200),v=s(82677),C=s(15963),b=s(81760),T=s(94050),M=s(19675),I=s(12770),w=s(53374),P=(0,g.lazyProperties)({countContainerView:()=>o.Styles.createButtonStyle({flexDirection:"row",alignItems:"center",justifyContent:"center"}),desktopTransform:()=>o.Styles.createViewStyle({transform:[{rotateZ:"0"}]}),countContainerOuterView:()=>o.Styles.createButtonStyle({backgroundColor:b.Color.white}),countContainer:()=>o.Styles.createButtonStyle({padding:5}),countText:()=>o.Styles.createTextStyle({color:b.Color.gray300,alignSelf:"center",marginLeft:6})});class k extends c.default{constructor(){super(...arguments),this._onLayout=e=>{this._height=e.height},this._onIconButtonRef=e=>{this._iconButton=e||void 0},this._onHoverStart=e=>{if(this.state.enableReactionsHoverSummary&&!o.UserInterface.isNavigatingWithKeyboard()){const e=w.default.newCauseId();p.log(u.LogTraceArea.ReactionsCountButton,"_onHoverStart, causeId: "+e),this._popupDismissTimeout&&I.default.clearTimeout(this._popupDismissTimeout),this._hoverTimeout&&I.default.clearTimeout(this._hoverTimeout),this._hoverTimeout=I.default.setTimeout((()=>{this.state.isHovering&&(this._onHandleShowPopup(e),this._hoverTimeout=void 0)}),200)}this.state.isHovering||this.setState({isHovering:!0})},this._onHoverEnd=e=>{this._popupDismissTimeout&&I.default.clearTimeout(this._popupDismissTimeout),this._popupDismissTimeout=I.default.setTimeout((()=>{this.state.isPopupHovered?this._popupDismissTimeout=void 0:this._closePopup()}),150)},this._closePopup=()=>{this._reactionsSummaryPopup&&this.state.enableReactionsHoverSummary&&(this._reactionsSummaryPopup.dismissPopup(),this._reactionsSummaryPopup=void 0),this._hoverTimeout&&(I.default.clearTimeout(this._hoverTimeout),this._hoverTimeout=void 0),this.state.isHovering?this.setState({isHovering:!1,isPopupHovered:!1}):this.setState({isPopupHovered:!1})},this._onKeyPress=e=>l.default.maybeHandleKeyPress(e,(()=>{this._onPress(e)})),this._onPress=e=>{const t=w.default.newCauseId();p.log(u.LogTraceArea.ReactionsCountButton,"_onPress, causeId: "+t),this.state.popupOn||this._onHandleShowPopup(t),this._reactionsSummaryPopup=void 0,e.stopPropagation()},this._onClosePopup=()=>{this.isComponentMounted()&&(this._iconButton&&this._iconButton.requestFocus&&this._iconButton.requestFocus(),this.setState({popupOn:!1}),this.props.onClose&&this.props.onClose())},this._onPopupMouseEnter=()=>{this.setState({isPopupHovered:!0})},this._onPopupMouseLeave=()=>{this._closePopup()}}_buildState(e,t){const s=h.default.getEmoticonByName(e.reaction.key);let i={reactionEmoticonName:s&&s.description||e.reaction.key,enableReactionsHoverSummary:r.default.getS4LMessagingFeatures().enableReactionsHoverSummary,isPopupHovered:!1};return t&&(i.popupOn=!1,i.isHovering=!1),i.accessibilityLabel=d.getAccessibilityLabelForReaction(e.message.conversationId,e.reaction),i}render(){let e=[P.countContainer,P.countContainerView,P.countContainerOuterView,this.props.style];const t=f.getFrameHeight(this.props.reactionSize||n.Size.Small)+10,s=o.Styles.createViewStyle({height:t,borderRadius:t/2},!1);e.push(s);const r=m.getString("ReactionsDetailsOverlayPanel.ReactionButtonTitle",{reactionName:this.state.reactionEmoticonName});let a,l;if(this.props.reaction.users.length>99?a=m.getString("ReactionsDetailsOverlayPanel.ReactionCountOverflow",{countText:99}):(this.props.reaction.users.length>1||!this.props.suppressSingleCounts)&&(a=this.props.reaction.users.length.toString()),a){const e=i.some(this.props.reaction.users,(e=>S.default.isMyMri(e.mri)));l=o.createElement(M.Caption,{selected:e,style:[P.countText,this.props.textStyle]},a)}let d=P.countContainerView;d=[d,P.desktopTransform];const{reactionTone:c,reactionNameWithoutTone:h}=v.separateReactionNameAndTone(this.props.reaction.key);return o.createElement(o.Button,{ref:this._onIconButtonRef,style:e,title:r,onHoverStart:this._onHoverStart,onHoverEnd:this._onHoverEnd,onPress:this._onPress,onKeyPress:this._onKeyPress,activeOpacity:.8,accessibilityLabel:this.state.accessibilityLabel,disabled:this.props.disableAction,disabledOpacity:1},o.createElement(o.View,{style:d,onLayout:this._onLayout},o.createElement(n.AnimatedEmoticon,{size:this.props.reactionSize||n.Size.Small,innerText:r,emoticonName:h,isStatic:!(this.state.isHovering&&!this.state.popupOn),allowTextFallback:!0,standaloneAnimation:!0,preventSelectable:!0,tone:c}),l))}_onHandleShowPopup(e){if(p.log(u.LogTraceArea.ReactionsCountButton,"_onHandleShowPopup, causeId: "+e),!this.state.popupOn){this.setState({popupOn:!0});this._showReactionSummaryPopup(e)&&(p.track(new _.ReactionsSummaryClickTelemetry(this.props.reaction.key,this.props.message,this.props.reaction.users.length)),this._markReactionsRead(this.props.message),this.props.onOpen&&this.props.onOpen())}}_showReactionSummaryPopup(e){p.log(u.LogTraceArea.ReactionsCountButton,"_showReactionSummaryPopup, causeId: "+e);let t=this.state.popupOn?void 0:new T.default(C.ScenarioName.ReactionsSummary);return t&&t.start(),this._reactionsSummaryPopup=new y.ReactionsSummaryPopup(this.props.message.conversationId,t,this.props.reaction,(()=>this._iconButton),this._getRootViewId(),this._getRootViewType(),this._onClosePopup,this._height,this.props.anchorPositionAnywhere,this._onPopupMouseEnter,this._onPopupMouseLeave),this._reactionsSummaryPopup.show()}_markReactionsRead(e){!e.isReactionRead()&&S.default.isMyMri(e.creator)&&a.markReactionsAsRead(e)}}t.ReactionCountButton=k},2989:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(88837),r=s(15877),a=s(17459),l=s(80837),d=(0,r.lazyProperties)({listContainer:()=>o.Styles.createViewStyle({flexDirection:"row",marginLeft:-5}),countContainerSpacing:()=>o.Styles.createViewStyle({marginLeft:5,marginBottom:2})});class c extends n.ComponentBase{_buildState(e,t){let s={};t&&(s.postedByCurrentUser=!1);const i=this.props;return e.message?!t&&i.message&&e.message.properties===i.message.properties||(s.reactions=e.message.getReactions()):s.reactions=void 0,s}render(){if(!this.state.reactions||0===this.state.reactions.length||!this.props.message)return null;const e=[d.listContainer,this.props.style],t=this.props.message,s=i.map(this.state.reactions,(e=>{const s=[];return this.props.showShadows&&s.push(l.default.shadowLightStyle),this.props.itemStyle&&s.push(this.props.itemStyle),this.props.countItemSpacing?s.push(this.props.countItemSpacing):s.push(d.countContainerSpacing),o.createElement(a.ReactionCountButton,{style:s,message:t,key:e.key,reaction:e,reactionSize:this.props.reactionSize,textStyle:this.props.itemTextStyle,onOpen:this.props.onOpen,onClose:this.props.onClose,anchorPositionAnywhere:this.props.anchorPositionAnywhere,disableAction:this.props.disableAction,suppressSingleCounts:this.props.suppressSingleCounts})}));let n;if(i.isNumber(this.props.constrainedWidth)){let t;n=o.Styles.createViewStyle({maxWidth:this.props.constrainedWidth},!1),t=o.Styles.createViewStyle({minWidth:this.props.constrainedWidth-5,maxWidth:this.props.constrainedWidth-5},!1),e.push(t)}return o.createElement(o.View,{style:[n,...e]},s)}}t.default=c},72828:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(97775),n=s(62602),r=s(77381),a=s(46096),l=s(13944),d=s(36237),c=s(15877),h=s(33754),u=s(32226),p=s(44390),g=s(46122),m=s(15963),S=s(86045),f=s(81760),y=s(11828),_=s(94050),v=s(88523),C=(0,c.lazyProperties)({reactionButton:()=>i.Styles.createViewStyle({paddingVertical:5,paddingHorizontal:5,width:30,alignItems:"center",justifyContent:"flex-start"})});class b extends r.default{constructor(){super(...arguments),this._onIconButtonRef=e=>{this._iconButton=e||void 0},this._onReactKeyPress=e=>n.default.maybeHandleKeyPress(e,(()=>{this._onReactClick(e)})),this._onReactClick=e=>{const t=()=>this._iconButton,s=this.props.message();let i;if(S.default.isMobileScreenReaderEnabled()){let e=new _.default(m.ScenarioName.ShowReactionsMenu);e.start(),d.log(a.LogTraceArea.ReactionIconButton,"_onReactClick - showing accessability menu.");new p.default(s).showReactionActionSheet(t,this._getRootViewId()),i=!0,e.finish()}else{let e=this.state.popupOn?void 0:new _.default(m.ScenarioName.ShowReactionsMenu);e&&e.start(),d.log(a.LogTraceArea.ReactionIconButton,"_onReactClick - showing normal menu.");i=new g.ReactionsMenuPopup(s,e,t,this._getRootViewId(),this._getRootViewType(),this._onClosePopup,this.props.onReactionSelected,this.props.keepOpenAfterReactionSelected,this.props.hideAlternateReactionPacks,this.props.anchorOffset).show()}i&&(this.setState({popupOn:!0}),this.props.onOpen&&this.props.onOpen()),this._trackSearchSuccessTelemetry(),e.stopPropagation()},this._onClosePopup=()=>{d.log(a.LogTraceArea.ReactionIconButton,"_onClosePopup"),this.isComponentMounted()&&(this.setState({popupOn:!1}),this._iconButton&&this._iconButton.requestFocus&&this._iconButton.requestFocus(),this.props.onClose&&this.props.onClose())}}_buildState(e,t){let s={isConnected:u.default.isConnected()};return t&&(s.popupOn=!1),s}render(){const e=this.props.colorOverride||f.Color.gray300,t=this.props.sizeOverride||y.IconSize.size20,s=!this.state.isConnected||!this.props.isMessageKnownByServer;s&&(this.state.isConnected?this.props.isMessageKnownByServer?d.log(a.LogTraceArea.ReactionIconButton,"ReactionButton disabled due to other reasons."):d.log(a.LogTraceArea.ReactionIconButton,"ReactionButton disabled due to version unknown by server."):d.log(a.LogTraceArea.ReactionIconButton,"ReactionButton disabled due to unavailable network."));const n=[C.reactionButton,this.props.style],r={ref:this._onIconButtonRef,style:n,title:h.getString("StreamItem.ReactButtonTitle"),key:"reactionsIcon",onPress:this.props.disableAction?void 0:this._onReactClick,onKeyPress:this.props.disableAction?void 0:this._onReactKeyPress,size:t,color:e,hoverColor:e,icon:y.SkypeIcon.EmoticonStroke,disabled:s,tabIndex:0,showHoverEffect:!0,importantForAccessibility:this.props.importantForAccessibility};return this.props.coachMarkType?i.createElement(o.default.IconButton,Object.assign({},r,{coachMarkType:this.props.coachMarkType,anchorAccessibilityLabel:h.getString("StreamItem.ReactButtonTitle")})):i.createElement(l.default,Object.assign({},r))}_trackSearchSuccessTelemetry(){v.messageActionDone(this.props.message().conversationId)}}t.default=b},44390:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(89391),n=s(82433),r=s(46096),a=s(36237),l=s(33754),d=s(18078),c=s(82677),h=s(17219),u=s(46200),p=s(86045),g=s(93194),m="more",S="previous";t.default=class{constructor(e){if(this._currentUserReactions=[],this._onActionButtonPress=(e,t,s)=>{const i=()=>{const t=e();t&&t.requestFocus&&t.requestFocus()};switch(s){case m:this._currentPackIndex++,this._showActionMenu(e,t);break;case S:this._currentPackIndex--,this._showActionMenu(e,t);break;case g.SXActionMenuCancel:case"cancel":a.track(this._reactionMenu),i();break;default:this._addOrRemoveReaction(s),i()}},this._message=e,this._reactionPack=o.default.getS4LMessagingFeatures().reactionPacks,i.isEmpty(this._reactionPack))return void a.warn(r.LogTraceArea.ReactionsActionSheet,"ReactionPack is empty");const t=d.default.getSkypeMri();this._currentUserReactions=i.filter(e.getReactions(),(e=>i.some(e.users,(e=>e.mri===t)))),this._currentPackIndex=0}showReactionActionSheet(e,t){this._showActionMenu(e,t),this._reactionMenu=new u.ReactionPickerTelemetry(this._message,u.ReactionOriginType.ReactionsActionSheet)}_showActionMenu(e,t){const s=[];i.each(this._reactionPack[this._currentPackIndex],(e=>{s.push({text:this._getEmoticonName(e),command:e})})),0!==this._currentPackIndex&&s.push({text:l.getString("Global.PreviousButtonTitle"),command:S}),this._currentPackIndex!==this._reactionPack.length-1&&s.push({text:l.getString("Global.MoreButtonTitle"),command:m}),g.default.showWithActionMenuConfig({options:{anchor:e,buttons:s},callback:s=>this._onActionButtonPress(e,t,s),rootViewId:t,invokingEvent:void 0})}_getEmoticonName(e){const t=n.default.getEmoticonByNameNoSubscription(e);return t&&t.description||e}_addOrRemoveReaction(e){const t={message:this._message,reactionAction:{reaction:e,reactionLevel:this._currentPackIndex,reactionAdded:!1,isCustomReaction:(0,h.default)().isCustomReaction(e)}},s=this._getEmoticonName(e);i.some(this._currentUserReactions,(t=>t.key===e))?(a.log(r.LogTraceArea.ReactionsActionSheet,"Removing the selected reaction",e),c.addRemoveReactionFromMessage(t,this._reactionMenu,(e=>{const t=e?"ReactionsMenu.YouRemovedReaction":"ReactionsMenu.YouRemovedReactionError";p.default.maybeAnnounceForAccessibility(l.getString(t,{reactionName:s}))}))):(a.log(r.LogTraceArea.ReactionsActionSheet,"Adding the selected reaction",e),t.reactionAction.reactionAdded=!0,c.addRemoveReactionFromMessage(t,this._reactionMenu,(e=>{const t=e?"ReactionsMenu.YouReacted":"ReactionsMenu.YouReactedError";p.default.maybeAnnounceForAccessibility(l.getString(t,{reactionName:s}))})))}}},46122:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionsMenuPopup=void 0;const i=s(16778),o=s(89391),n=s(33754),r=s(48133),a=s(17795),l=s(40363);class d extends a.default{constructor(e,t,s,i,o,n,r,a,l,c=0){super(s,(()=>{n&&n(),this._hidden=!0}),i,o),this._message=e,this._scenario=t,this._onReactionSelected=r,this._keepOpenAfterReactionSelected=a,this._hideAlternateReactionPacks=l,this._anchorOffsetOverride=c,this._hidden=!1,this._instanceId=d._instanceCounter++}_overrideAnchorOffset(e){return e+(this._anchorOffsetOverride||0)*(l.default.isRTL()?-1:1)}_getPopupId(){return d.popupId}_getAccessibilityTitle(){return n.getString("AccessibilityLabel.Reactions")}_isCacheable(){return o.default.getS4LMessagingFeaturesNoSubscription().enableCacheableReactionPopup}_getContainerStyle(){return i.Styles.createViewStyle({marginRight:4},!1)}_getPopupWidth(e){return e-4}_getPopupContent(e,t,s,o){return i.createElement(r.ReactionsPopupMenu,{message:this._message,scenario:this._scenario,onClose:this.dismissPopup,keepOpenAfterReactionSelected:this._keepOpenAfterReactionSelected,hideAlternateReactionPacks:this._hideAlternateReactionPacks,onReactionSelected:this._onReactionSelected,hidden:this._hidden,instanceId:this._instanceId,rootViewId:this._rootViewId})}}t.ReactionsMenuPopup=d,d._instanceCounter=0,d.popupId="reactionsMenuPopup"},48133:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionsPopupMenu=void 0;const i=s(96486),o=s(31844),n=s(16778),r=s(15069),a=s(34339),l=s(62033),d=s(18644),c=s(84912),h=s(82433),u=s(46096),p=(s(12854),s(13944)),g=s(36237),m=s(61253),S=s(72490),f=s(15877),y=s(33754),_=s(6250),v=s(18078),C=s(45087),b=s(34102),T=s(82677),M=s(17219),I=s(46200),w=s(29130),P=s(51070),k=s(86045),A=s(81760),E=s(11828),R=s(80837),L=s(24576),F=a.Size.Large,x=a.Size.Medium,O=(0,f.lazyProperties)({panel:()=>n.Styles.createViewStyle({alignSelf:"center",alignItems:"stretch",justifyContent:"center",backgroundColor:A.Color.transparent,marginHorizontal:4,maxWidth:420,overflow:"visible"}),panelNavigation:()=>n.Styles.createViewStyle({overflow:"hidden"}),scrollPanel:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"flex-end",overflow:"visible"}),viewContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"stretch",justifyContent:"center",overflow:"hidden",alignSelf:"stretch"}),emoticonContainer:()=>n.Styles.createViewStyle({flex:0,flexDirection:"row",alignItems:"stretch",justifyContent:"space-around",overflow:"visible"}),emoticonContainerNavigation:()=>n.Styles.createViewStyle({justifyContent:"flex-start",alignContent:"center"}),scrollContainer:()=>n.Styles.createViewStyle({flex:0,overflow:"hidden",alignSelf:"center",alignContent:"center"}),panelMargin:()=>n.Styles.createViewStyle({marginHorizontal:30}),emoticon:()=>n.Styles.createViewStyle({flex:0,height:80,width:56,alignItems:"center",justifyContent:"center",overflow:"visible"}),defaultEmoticonForRN:()=>n.Styles.createViewStyle({width:53}),smallEmoticonForRN:()=>n.Styles.createViewStyle({height:64,width:44}),emoticonStyle:()=>n.Styles.createViewStyle({paddingTop:11,paddingBottom:5}),emoticonSelectedPlaceholder:()=>n.Styles.createViewStyle({alignSelf:"center",width:6,height:6}),emoticonSelected:()=>n.Styles.createViewStyle({backgroundColor:A.Color.blue,borderRadius:6}),navigationButtonContainer:()=>n.Styles.createViewStyle({flex:0,overflow:"visible",position:"absolute",top:0,bottom:0,justifyContent:"center"}),viewPageIndicator:()=>n.Styles.createViewStyle({flexDirection:"column",justifyContent:"space-around",alignItems:"stretch",paddingBottom:10}),nextButton:()=>n.Styles.createButtonStyle({right:10}),prevButton:()=>n.Styles.createButtonStyle({left:10}),scrollViewRTL:()=>n.Styles.createViewStyle({flexDirection:"row-reverse",transform:[{scaleX:-1}]}),customReactionsPanelButton:()=>n.Styles.createButtonStyle({position:"absolute",right:-8,bottom:-10,padding:5,borderRadius:15})});class D extends L.default{constructor(){super(...arguments),this._mountedRefsMap=new _.default,this._scrollViewFiredInitialLayout=!1,this._eventTracked=!1,this._isInitialized=!1,this._lastInstanceId=0,this._onClick=(e,t)=>{g.log(u.LogTraceArea.ReactionsPopupMenu,"_onClick - selectedReaction",t),this.state.isAnimatingPress||this.setState({isAnimatingPress:!0,selectedReactionKey:t})},this._onHoverStart=(e,t)=>{this.setState({hoverItem:t})},this._onHoverEnd=(e,t)=>{this.setState({hoverItem:void 0})},this._onScrollViewRef=e=>{this._scrollView=e||void 0},this._onScrollViewLayout=e=>{this._scrollViewFiredInitialLayout||(this._scrollViewFiredInitialLayout=!0,this._scrollView&&void 0!==this._scrollViewPendingScrollAmount&&(this._scrollView.setScrollLeft(this._scrollViewPendingScrollAmount,!1),this._scrollViewPendingScrollAmount=void 0))},this._onScroll=(e,t)=>{var s;const o=i.clamp(Math.ceil(Math.floor(t)/this._reactionContainerWidth),0,this.state.reactionPacks.length-1);o!==this.state.currentPack&&(this.setState({currentPack:o}),this._scrollingDueToArrowClick?this._scrollingDueToArrowClick=!1:null===(s=this._openReactionMenuTelemetry)||void 0===s||s.recordUserAction(I.ReactionNavigationAction.Swipe))},this._isEmoticonFake=e=>!e,this._showPrevious=()=>{this._onNextButtonPress(!1)},this._showNext=()=>{this._onNextButtonPress(!0)},this._onBack=()=>(this._close(),g.log(u.LogTraceArea.HardwareBackButton,"goBack: true componentId: ReactionsPopupMenu"),!0),this._onEscape=()=>(this._close(),!0),this._setInitialScroll=e=>{this._scrollView&&this._scrollViewFiredInitialLayout?this._scrollView.setScrollLeft(e,!1):this._scrollViewPendingScrollAmount=e},this._reactionsToPackages=e=>{const t=e.length%6;if(t){const s=i.fill(Array(6-t),"");e=i.concat(e,s)}return i.chunk(e,6)}}_buildState(e,t){const s={},a=this._getRootViewId();if(e.hidden&&!t)return s;if(this._isInitialized&&e.instanceId!==this._lastInstanceId&&this._uninitialize(),this._lastInstanceId=e.instanceId,s.width=w.default.getWidth(a),s.deviceOrientation=w.default.getDeviceOrientation(a),s.isMobileScreenSize=w.default.isMobileScreenSize(a),s.reactionPacks=this._reactionsToPackages((0,M.default)().getCustomReactions()),s.shouldAdjustScrollPosition=P.default.hasNonZeroSafeAreaInsets(),s.emoticonWidth=56,this._reactionContainerStyle=[O.panel],r.default.isMobile()){let e=53*s.reactionPacks[0].length;if(s.emoticonWidth=s.width-8<e?44:53,s.isMobileScreenSize&&s.deviceOrientation===o.DeviceOrientation.Portrait){const e=s.width-8,t=n.Styles.createViewStyle({maxWidth:e},!1);this._reactionContainerStyle.push(t)}this._reactionContainerStyle.push(O.panelNavigation)}if(t||!this._isInitialized){s.currentPack=0,s.selectedReactionKey="";const o=e.message.getReactions(),n=v.default.getSkypeMri();if(s.userReactions=i.filter(o,(e=>i.some(e.users,(e=>e.mri===n)))),s.userReactions.length>0)for(let e=0;e<s.reactionPacks.length;e++){const t=s.reactionPacks[e],i=T.getReactionName(s.userReactions[0].key);if(t.indexOf(i)>=0){s.currentPack=e;break}}e.hidden||(e.scenario&&e.scenario.markStepCompleted("BuiltSate",void 0,void 0,!0),t||this._initialize(e,i.merge(this.state,s)))}return g.log(u.LogTraceArea.ReactionsPopupMenu,"Built state with reactionPacks: "+JSON.stringify(s.reactionPacks)+" currentPack: "+s.currentPack),s}_getEmoticonName(e){const t=h.default.getEmoticonByNameNoSubscription(e);return t&&t.description||e}_onRemovingReactionDone(e,t){let s="ReactionsMenu.YouRemovedReactionError";const o=this._getEmoticonName(t);if(e&&(s="ReactionsMenu.YouRemovedReaction",this.isComponentMounted())){const e=i.filter(this.state.userReactions,(e=>e.key!==t));this.setState({userReactions:e})}k.default.maybeAnnounceForAccessibility(y.getString(s,{reactionName:o}))}_onAddingReactionDone(e,t){let s="ReactionsMenu.YouReactedError";const i=this._getEmoticonName(t);if(e&&(s="ReactionsMenu.YouReacted",this.isComponentMounted())){const e=[...this.state.userReactions,{key:t,users:[{mri:v.default.getSkypeMri(),time:Date.now()}]}];this.props.onReactionSelected&&this.props.onReactionSelected(t),this.setState({userReactions:e})}k.default.maybeAnnounceForAccessibility(y.getString(s,{reactionName:i}))}_completeClick(e){const t=T.separateReactionNameAndTone(e),s={message:this.props.message,reactionAction:{reaction:t.reactionNameWithoutTone,reactionLevel:this.state.currentPack,reactionAdded:!1,isCustomReaction:(0,M.default)().isCustomReaction(e),reactionTone:t.reactionTone}};this._eventTracked=!0,i.some(this.state.userReactions,(t=>t.key===e))?(g.log(u.LogTraceArea.ReactionsPopupMenu,"Removing the selected reaction",e),T.addRemoveReactionFromMessage(s,this._openReactionMenuTelemetry,(t=>this._onRemovingReactionDone(t,e)))):(g.log(u.LogTraceArea.ReactionsPopupMenu,"Adding the selected reaction",e),s.reactionAction.reactionAdded=!0,T.addRemoveReactionFromMessage(s,this._openReactionMenuTelemetry,(t=>this._onAddingReactionDone(t,e)))),this.setState({isAnimatingPress:!1}),this.props.keepOpenAfterReactionSelected||this._close()}_renderReactionContainer(){let e,t,s,o=[];this.state.reactionPacks.length>0&&(this._numberOfReactionsPerPack=this.state.reactionPacks[0].length);for(let e=0;e<this.state.reactionPacks.length;e++){const t=this._getEmoticonReactionsForPack(this.state.reactionPacks[e],e);o=o.concat(t)}this._numberOfReactions=o.length,this._reactionContainerWidth=this._numberOfReactionsPerPack*this.state.emoticonWidth;let a=[O.viewContainer];const l=[O.emoticonContainer,O.emoticonContainerNavigation];let d=this.state.emoticonWidth*this._numberOfReactions;const c=r.default.isMobile(),h=!c;h&&(d+=30),l.push(n.Styles.createViewStyle({width:d},!1));const u=this._getContext().isRTL;if(h){const e=u?E.SkypeIcon.NavigationForward:E.SkypeIcon.NavigationBack,i=u?E.SkypeIcon.NavigationBack:E.SkypeIcon.NavigationForward;t=n.createElement(n.Animated.View,{key:"mouseControlsLeft",style:[O.navigationButtonContainer,O.prevButton],onPress:this._showPrevious},n.createElement(p.default,{size:20,onPress:this._showPrevious,color:A.Color.gray300,hoverColor:A.Color.gray100,icon:e,title:y.getString("Global.PreviousButtonTitle"),disabled:0===this.state.currentPack})),s=n.createElement(n.Animated.View,{key:"mouseControlsRight",style:[O.navigationButtonContainer,O.nextButton],onPress:this._showNext},n.createElement(p.default,{size:20,onPress:this._showNext,color:A.Color.gray300,hoverColor:A.Color.gray100,icon:i,title:y.getString("Global.NextButtonTitle"),disabled:this.state.currentPack===this.state.reactionPacks.length-1}))}else{let t=0;const s=i.map(this.state.reactionPacks,(e=>({uid:(t++).toString()})));e=n.createElement(C.default,{currentPage:this.state.currentPack,pages:s,indicatorDotSize:10,indicatorMargin:1,maxIndicators:10}),a.push(O.viewPageIndicator)}const g=n.Styles.createViewStyle({width:c?this._reactionContainerWidth:this._reactionContainerWidth+30},!1),m=[O.scrollContainer,g];this._reverseLayout()&&m.push(O.scrollViewRTL);let S=n.createElement(n.ScrollView,{ref:this._onScrollViewRef,style:m,pagingEnabled:!0,horizontal:c,showsHorizontalScrollIndicator:!1,showsVerticalScrollIndicator:!1,keyboardShouldPersistTaps:!0,vertical:!1,onScroll:this._onScroll,scrollEnabled:c,onLayout:this._onScrollViewLayout,ignoreRTL:!0},n.createElement(n.View,{style:l},o));return h&&(S=n.createElement(n.View,{style:[O.scrollPanel,O.panelMargin]},S)),n.createElement(n.View,{style:a},t,S,s,e)}_reverseLayout(){return!1}_onNextButtonPress(e){var t;this._scrollingDueToArrowClick=!0,null===(t=this._openReactionMenuTelemetry)||void 0===t||t.recordUserAction(I.ReactionNavigationAction.ArrowNavigation);const s=e?1:-1,i=(this.state.currentPack+s)*this._reactionContainerWidth;this._scrollView&&i>=0&&i<this._numberOfReactions*this.state.emoticonWidth&&this._scrollView.setScrollLeft(i,!0)}_getEmoticonReactionsForPack(e,t){return i.map(e,((e,s)=>{const o=e,l=T.separateReactionNameAndTone(o),d=i.some(this.state.userReactions,(e=>o===e.key)),c=[O.emoticonSelectedPlaceholder];d&&c.push(O.emoticonSelected);let h=b.ReactionButtonSelectionState.NotSelected;this.state.hoverItem&&this.state.hoverItem===o&&(h=b.ReactionButtonSelectionState.Selected);const u=h===b.ReactionButtonSelectionState.Selected;let p=[O.emoticon],g=F;r.default.isMobile()&&(p.push(O.defaultEmoticonForRN),this.state.emoticonWidth<53&&(p.push(O.smallEmoticonForRN),g=x));const m=this._getEmoticonName(l.reactionNameWithoutTone);let S=m;d&&(S+=", "+y.getString("Global.SelectedAccessibilityLabel"));const f=r.default.isMobile()?a.Size.Large:a.Size.ExtraLarge;return n.createElement(n.View,{key:"reactionButton"+t.toString()+s.toString(),style:p,ignorePointerEvents:!0},!this._isEmoticonFake(o)&&n.createElement(b.ReactionButton,{ref:this._mountedRefsMap.onComponentRef(o),title:m,animateEmoticon:u||d,size:f,renderSize:g,reactionName:l.reactionNameWithoutTone,style:O.emoticonStyle,onPress:this._onClick,onHoverStart:this._onHoverStart,onHoverEnd:this._onHoverEnd,selectionState:h,accessibilityLabel:S,tone:l.reactionTone}),n.createElement(n.View,{style:c}))}))}_close(){this.props.onClose&&this.props.onClose()}_initialize(e,t){if(l.default.subscribe(this._onBack),S.default.addEscapeHandler(this._onEscape),this._scrollView){const e=t.currentPack*this._reactionContainerWidth;t.shouldAdjustScrollPosition?i.delay(this._setInitialScroll,100,e):t.currentPack>0&&i.defer(this._setInitialScroll,e)}this._openReactionMenuTelemetry=new I.ReactionPickerTelemetry(e.message,I.ReactionOriginType.ReactionsPopupMenu),e.scenario&&!e.scenario.isResolved()&&e.scenario.finish(),this._isInitialized=!0}_uninitialize(){l.default.unsubscribe(this._onBack),S.default.removeEscapeHandler(this._onEscape),this._eventTracked||g.track(this._openReactionMenuTelemetry),this._isInitialized=!1}componentDidMount(){super.componentDidMount(),this.props.hidden||this._initialize(this.props,this.state)}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),(0,m.default)(this.state.deviceOrientation,t.deviceOrientation)||(g.log(u.LogTraceArea.ReactionsPopupMenu,"Closing due to orientation change"),this._close())}componentDidUpdate(e,t,s){if(super.componentDidUpdate(e,t,s),this.props.hidden&&this._isInitialized&&(this._uninitialize(),i.defer(this._setInitialScroll,0)),!t.isAnimatingPress&&this.state.isAnimatingPress){const e=this.state.selectedReactionKey;let t=this._mountedRefsMap.ref(e);t&&this.state.hoverItem!==e?t.animatePress((()=>{this._completeClick(e)})):this._completeClick(e)}}componentWillUnmount(){super.componentWillUnmount(),this._isInitialized&&this._uninitialize()}render(){return n.createElement(n.View,{style:R.default.overflowVisible},n.createElement(n.View,{style:this._reactionContainerStyle},this._renderReactionContainer()),n.createElement(d.default,{styles:O.customReactionsPanelButton,origin:c.CustomReactionsType.Message}))}}t.ReactionsPopupMenu=D,t.default=D},60160:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionsPopupSummary=t.EmoticonHeight=void 0;const i=s(96486),o=(s(31844),s(34828)),n=s(16778),r=s(34339),a=s(62033),l=s(81169),d=s(77381),c=s(52262),h=s(46096),u=s(36237),p=s(61253),g=s(72490),m=s(15877),S=s(33754),f=s(18078),y=s(4735),_=s(58962),v=s(46200),C=s(82677),b=s(29130),T=s(14976),M=s(35108),I=s(81760),w=s(80837),P=(s(12770),s(53374)),k=s(73877);t.EmoticonHeight=_.frameHeights.emoticons.Size80;const A=12,E=(0,m.lazyProperties)({panel:()=>n.Styles.createViewStyle({alignSelf:"center",alignItems:"stretch",justifyContent:"center",backgroundColor:I.Color.transparent,borderRadius:10,height:t.EmoticonHeight,marginHorizontal:4,maxWidth:420,overflow:"hidden"}),emoticonHeaderTop:()=>n.Styles.createViewStyle({top:0}),emoticonHeaderBottom:()=>n.Styles.createViewStyle({bottom:0}),emoticonHeader:()=>n.Styles.createViewStyle({justifyContent:"center",alignItems:"center",height:_.frameHeights.emoticons.Size80,position:"absolute",left:0,right:0}),virtualListContainer:()=>n.Styles.createViewStyle({paddingTop:A,paddingHorizontal:A,paddingBottom:A,flex:1,overflow:"hidden"}),virtualListContainerTop:()=>n.Styles.createViewStyle({paddingTop:t.EmoticonHeight}),virtualListContainerBottom:()=>n.Styles.createViewStyle({paddingBottom:t.EmoticonHeight})});class R extends d.default{constructor(){super(...arguments),this._animatedOpacityValue=new n.Animated.Value(0),this._animatedOpacityStyle=n.Styles.createAnimatedViewStyle({opacity:this._animatedOpacityValue}),this._onBack=()=>{const e=this._close();return u.log(h.LogTraceArea.HardwareBackButton,"goBack: "+e+" componentId: ReactionsPopupSummary"),e},this._onEscape=()=>(this._close(),!0),this._renderItem=e=>{let t,s="";return f.default.isMyMri(e.key)||(t=w.default.pointerCursor,s=e.displayName),n.createElement(M.default,{conversationId:this.props.conversationId,displayName:e.displayName,style:t,userMri:e.key,showMeLabel:!0,onItemPress:this._onPress,buttonTitle:s})},this._onVirtualListViewRef=e=>{this._virtualListView=e||void 0},this._onSummaryHeaderRef=e=>{this._summaryHeader=e||void 0},this._onPress=e=>{const t=P.default.newCauseId();u.log(h.LogTraceArea.ReactionsPopupSummary,"_onPress - mri: "+T.mriOrId(e)+" causeId: "+t),f.default.isMyMri(e)||(this._close(),u.track(new v.ReactionPanelListItem(this.props.reaction.key,this.props.conversationId,this.props.reaction.users.length)),y.default.showDetailsPanelWithParams({mri:e,causeId:t,rootViewId:this._getRootViewId()}))}}_buildState(e,t){let s={};const o=this._getRootViewId();s.width=Math.min(b.default.getWidth(o),300),s.maxHeight=402.3,s.deviceOrientation=b.default.getDeviceOrientation(o),s.isMobileScreenSize=b.default.isMobileScreenSize(o);const r=this.props;if(t||e.reaction!==r.reaction){let o=[];if(e.reaction.users.length>0){let t=(0,l.chain)(e.reaction.users,(0,l.map)((t=>({mri:t.mri,displayName:c.default.getMemberShortNameForConversation(e.conversationId,t.mri)}))),(0,l.sortBy)((e=>e.displayName)),(0,l.compact)());i.each(t,(e=>{o.push({key:e.mri,displayName:e.displayName,height:44,template:"convo",accessibilityTrait:n.Types.AccessibilityTrait.Button})}))}s.virtualListViewItemInfo=o,t&&e.scenario&&e.scenario.markStepCompleted("BuildSate",void 0,void 0,!0)}return s}_close(){return this.props.onClose&&this.props.onClose(),!0}componentDidMount(){super.componentDidMount(),a.default.subscribe(this._onBack),g.default.addEscapeHandler(this._onEscape),this._summaryHeader&&this._summaryHeader.requestFocus(),this.state.virtualListViewItemInfo.length&&this._maybeScrollToTop(),this.props.scenario&&this.props.scenario.finish()}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),(0,p.default)(this.state.virtualListViewItemInfo,t.virtualListViewItemInfo)||this._maybeScrollToTop()}componentWillUnmount(){super.componentWillUnmount(),a.default.unsubscribe(this._onBack),g.default.removeEscapeHandler(this._onEscape)}render(){const e=[E.panel];let t=this._computeHeight();e.push(n.Styles.createViewStyle({width:this.state.width,height:t},!1));let s=[E.emoticonHeader],i=[E.virtualListContainer,this._animatedOpacityStyle];"top"===this.props.anchorPosition?(i.push(E.virtualListContainerTop),s.push(E.emoticonHeaderTop)):(s.push(E.emoticonHeaderBottom),i.push(E.virtualListContainerBottom));const{reactionTone:a,reactionNameWithoutTone:l}=C.separateReactionNameAndTone(this.props.reaction.key),d=S.getString("AccessibilityLabel.ReactionsSummary",{reactionName:l});return n.createElement(n.View,{style:e,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave},n.createElement(n.View,{style:s,ref:this._onSummaryHeaderRef,tabIndex:-1,importantForAccessibility:n.Types.ImportantForAccessibility.Yes,accessibilityLabel:d},n.createElement(r.AnimatedEmoticon,{key:l,size:r.Size.ExtraLarge,innerText:l,emoticonName:l,isStatic:!1,standaloneAnimation:!0,tone:a})),n.createElement(n.Animated.View,{style:i},n.createElement(o.VirtualListView,{ref:this._onVirtualListViewRef,itemList:this.state.virtualListViewItemInfo,renderItem:this._renderItem,animateChanges:!1,keyboardDismissMode:"on-drag",keyboardShouldPersistTaps:!0,accessibilityLabel:d})))}_computeHeight(){let e,s=44*this.props.reaction.users.length+10+t.EmoticonHeight+A;if(s>this.state.maxHeight)e=this.state.maxHeight;else{const i=k.default.measureWindow(this._getRootViewId()).height-t.EmoticonHeight-this.props.anchorHeight;s>i&&(e=i)}if(e){return 44*(Math.floor((e-t.EmoticonHeight-A)/44)+.45)+t.EmoticonHeight+A}return s}_maybeScrollToTop(){this._animatedOpacityValue.setValue(1)}}t.ReactionsPopupSummary=R,t.default=R},25765:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionsSummaryPopup=void 0;const i=s(16778),o=s(33754),n=s(60160),r=s(17795);class a extends r.default{constructor(e,t,s,i,o,n,r,a,l,d,c){super(i,r,o,n),this._conversationId=e,this._scenario=t,this._reaction=s,this._callerHeight=a,this._anchorPositionAnywhere=l,this._onMouseEnter=d,this._onMouseLeave=c}_getPaddingInPopupCanvas(){return n.EmoticonHeight/2}_getPopupId(){return a.popupId}_getAccessibilityTitle(){return o.getString("AccessibilityLabel.ReactionsSummary",{reactionName:this._reaction.key})}_getPopupContent(e,t,s,o){return i.createElement(n.ReactionsPopupSummary,{conversationId:this._conversationId,scenario:this._scenario,reaction:this._reaction,onClose:this.dismissPopup,anchorPosition:e,anchorHeight:this._callerHeight,anchorPositionAnywhere:this._anchorPositionAnywhere,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave})}}t.ReactionsSummaryPopup=a,a.popupId="reactionsSummaryPopup"},23281:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReadReceiptsPopup=void 0;const i=s(16778),o=s(33754),n=s(59526),r=s(17795);class a extends r.default{constructor(e,t,s,i,o,n){super(s,i,o,n),this._conversationId=e,this._readReceiptsSum=t}_getPopupId(){return a.popupId}_getAccessibilityTitle(){return o.getString("StreamItem.ReadByPopupAccessibilityTitle")}_getPopupContent(e,t,s,o){return i.createElement(n.default,{conversationId:this._conversationId,readReceiptsSum:this._readReceiptsSum,onClose:this.dismissPopup,anchorPosition:e})}}t.ReadReceiptsPopup=a,a.popupId="readReceiptsPopup"},59526:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});s(31844);const i=s(34828),o=s(16778),n=s(62033),r=s(71830),a=s(77381),l=s(52262),d=s(46096),c=s(36237),h=s(61253),u=s(72490),p=s(15877),g=s(33754),m=s(4735),S=s(29130),f=s(35108),y=s(81760),_=s(19675),v=s(53374),C=s(73877),b=(0,p.lazyProperties)({container:()=>o.Styles.createViewStyle({alignSelf:"center",alignItems:"stretch",justifyContent:"center",backgroundColor:y.Color.transparent,padding:12,overflow:"hidden"}),headlineText:()=>o.Styles.createTextStyle({color:y.Color.white,paddingBottom:18,height:33}),virtualList:()=>o.Styles.createViewStyle({flex:1,overflow:"hidden"})});class T extends a.default{constructor(){super(...arguments),this._onBack=()=>{const e=this._close();return c.log(d.LogTraceArea.HardwareBackButton,"goBack: "+e+" componentId: ReadReceiptsSummary"),e},this._onEscape=()=>(this._close(),!0),this._renderItem=e=>o.createElement(f.default,{displayName:e.displayName,userMri:e.key,timestamp:e.timestamp,buttonTitle:e.displayName,onItemPress:this._onPress}),this._onPress=e=>{const t=v.default.newCauseId();c.log(d.LogTraceArea.Navigation,"ReadReceiptsSummary._onPress, causeId: "+t),m.default.showDetailsPanelWithParams({mri:e,causeId:t,rootViewId:this._getRootViewId()})},this._onSummaryHeaderRef=e=>{this._summaryHeader=e||void 0}}_buildState(e,t){const s={},i=this._getRootViewId();s.width=Math.min(S.default.getWidth(i),300),s.maxHeight=387,s.deviceOrientation=S.default.getDeviceOrientation(i),s.isMobileScreenSize=S.default.isMobileScreenSize(i);const o=this.props;return!t&&(0,h.default)(e.readReceiptsSum,o.readReceiptsSum)||(s.virtualListViewItemInfo=e.readReceiptsSum.map((t=>({key:t.mri,displayName:l.default.getMemberShortNameForConversation(e.conversationId,t.mri),height:44,template:"convo",timestamp:t.timestamp}))).sort(((e,t)=>e.displayName.localeCompare(t.displayName)))),s}_close(){return this.props.onClose&&this.props.onClose(),!0}componentDidMount(){super.componentDidMount(),n.default.subscribe(this._onBack),u.default.addEscapeHandler(this._onEscape),this._summaryHeader&&this._summaryHeader.requestFocus()}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s)}componentWillUnmount(){super.componentWillUnmount(),n.default.unsubscribe(this._onBack),u.default.removeEscapeHandler(this._onEscape)}render(){const e=[b.container];let t=this._computeHeight();e.push(o.Styles.createViewStyle({width:this.state.width,height:t},!1));const s=r.isOneOnOneConversation(this.props.conversationId)?g.getString("StreamItem.ReadByCount"):g.getString("StreamItem.ReadByGroupCount",{count:this.props.readReceiptsSum.length});return o.createElement(o.View,{style:e},o.createElement(o.View,{ref:this._onSummaryHeaderRef,importantForAccessibility:o.Types.ImportantForAccessibility.Yes,accessibilityLabel:s},o.createElement(_.Subtitle,{style:b.headlineText},s)),o.createElement(i.VirtualListView,{style:b.virtualList,itemList:this.state.virtualListViewItemInfo,renderItem:this._renderItem,animateChanges:!1,keyboardDismissMode:"on-drag",keyboardShouldPersistTaps:!0}))}_computeHeight(){let e=57+44*this.props.readReceiptsSum.length;if(e>this.state.maxHeight)return this.state.maxHeight;const t=C.default.measureWindow(this._getRootViewId()).height;if(e>t){return 44*(Math.floor((t-57)/44)+.5)+57}return e}}t.default=T},97639:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});s(96486);const i=s(16778),o=s(77605),n=s(94655),r=s(71830),a=s(47204),l=s(98278),d=s(29951),c=s(10117),h=s(36237),u=s(15877),p=s(33754),g=s(89808),m=s(4735),S=s(69417),f=s(27683),y=s(86045),_=(s(49769),s(22543)),v=s(68675),C=s(74342),b=s(95358),T=s(15415),M=s(81760),I=s(11828),w=s(79669),P=s(19675),k=s(24576),A=(0,u.lazyProperties)({container:()=>i.Styles.createViewStyle({flex:1,justifyContent:"space-between",marginBottom:10}),containerMobile:()=>i.Styles.createViewStyle({marginBottom:5,marginTop:5,marginHorizontal:10}),row:()=>i.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),creditIcon:()=>i.Styles.createViewStyle({paddingLeft:15,paddingRight:5}),activityStyle:()=>i.Styles.createViewStyle({height:14}),recipientNumberRow:()=>i.Styles.createViewStyle({flexShrink:1,paddingRight:10,flexWrap:"wrap"}),smsButton:()=>i.Styles.createViewStyle({flexDirection:"row",backgroundColor:M.Color.transparent})}),E="overflowPopupId";class R extends k.default{constructor(){super(...arguments),this._oldFragments=0,this._telemetryEvent=new S.SmsLineSwitcherShown,this._onRateInfoPress=()=>{this.canSendSMS()||(this.props.isSmsFailureScreenEnabled?m.default.navigateToSmsFailurePrompt(this.props.conversationId,this.props.phoneNumbers.length>0?this.props.phoneNumbers[0].number:"",!0):n.default.open(this._getRootViewId()))},this._onNumberPickerRef=e=>{this._numberPickerRef=e||void 0},this._getPopupAnchor=()=>this._numberPickerRef,this._onSwitcherPressed=()=>{this._showOverflowPopup()},this._showOverflowPopup=()=>{const e={getAnchor:this._getPopupAnchor,renderPopup:(e,t,s,o)=>i.createElement(w.default,{anchorPosition:e,anchorOffset:t,popupWidth:s,popupHeight:o,fillColor:this._themeColors.popoverBackgroundColor,strokeColor:this._useDarkTheme()?this._themeColors.popupBorderColor:void 0,skipPopupAutoFocus:!0},i.createElement(v.default,{phoneNumbers:this.props.phoneNumbers,onOptionSelected:this._onOptionSelected})),positionPriorities:["top"],dismissIfShown:!0,rootViewId:this._getRootViewId()};a.default.showPopup(e,E)},this._onOptionSelected=e=>{this.props.onPhoneNumberSelected(e),a.default.dismissPopup(E,this._getRootViewId())}}_buildState(e,t){e.selectedPhoneNumber||(this._oldFragments=0);const s={primaryColor:g.default.getPrimaryColor()};return e.selectedPhoneNumber&&(s.smsPriceInfo=C.default.getSmsRateByPhoneNumber(e.selectedPhoneNumber.number)),s}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this.props.selectedPhoneNumber&&this._telemetryEvent.setSwitchedToSmsMode(!0)}componentWillUnmount(){super.componentWillUnmount(),this._telemetryEvent&&h.track(this._telemetryEvent)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this._scheduleAccessibilityAnnouncement&&(this._announceSmsInfoChangeInScreenReader(),this._scheduleAccessibilityAnnouncement=!1),e.selectedPhoneNumber&&!this.props.selectedPhoneNumber&&this._telemetryEvent.setSwitchedToSkype(!0),!e.selectedPhoneNumber&&this.props.selectedPhoneNumber&&this._telemetryEvent.setSwitchedToSmsMode(!0)}getTelemetryEvent(){return this._telemetryEvent}requestFocus(){this._numberPickerRef&&this._numberPickerRef.requestFocus()}canSendSMS(){if(!this.state.smsPriceInfo)return!0;if(this.state.smsPriceInfo.failureReason===_.FailureReason.InsufficientFunds)return!1;const{fragments:e}=b.calculateSmsFragments(this.props.rawTextInput),t=this.props.creditEntitlement&&this.props.creditEntitlement.balance||0;return!(this.state.smsPriceInfo.rate&&this.state.smsPriceInfo.rate*e>t)}render(){const e=r.isPhoneMri(this.props.conversationId);let t;e||(t=this._renderTargetSwitcher());const s=[],o=i.createElement(i.View,{key:"rateAndCreditSection",style:A.row},this._renderRateSection(),this._renderCreditSection());e?s.push(this._renderRecipientNumberSection(),o):this.props.selectedPhoneNumber&&s.push(o);const n=[A.container,A.row];this.props.useMobileLayout&&n.push(A.containerMobile);const a=this.props.preventAccessibilityFocus?i.Types.ImportantForAccessibility.NoHideDescendants:void 0;return i.createElement(i.View,{style:n,importantForAccessibility:a},t,s)}_renderRecipientNumberSection(){const e=r.getPhoneNumberFromMri(this.props.conversationId);if(e){const t=f.default.parseAndFormat(e,f.PhoneNumberFormat.INTERNATIONAL)||e;return i.createElement(P.Caption,{style:A.recipientNumberRow,textThemeColor:P.TextThemeColor.Primary,key:"recipientNumberSection"},p.getString("SMSMessaging.SendSmsToNumberViaSkype",{phoneNumber:t}))}}_renderRateSection(){const{fragments:e,charactersRemaining:t}=b.calculateSmsFragments(this.props.rawTextInput);let s;if(this.state.smsPriceInfo){if(this.state.smsPriceInfo.failureReason)this.state.smsPriceInfo.failureReason===_.FailureReason.InsufficientFunds?this._accessibilityLabelForRateSection=p.getString("SMSMessaging.SmsCharactersLabel",{charactersRemaining:t}):this._accessibilityLabelForRateSection=p.getString("SMSMessaging.SmsPriceFetchFailure");else if(this.state.smsPriceInfo.rate&&this.state.smsPriceInfo.currency){const i=this.state.smsPriceInfo.rate*e;s=d.getFormattedRate(i,this.state.smsPriceInfo.currency,3),this._accessibilityLabelForRateSection=p.getString("SMSMessaging.SmsRateAndCharactersLabel",{charactersRemaining:t,formattedPrice:s})}this._oldFragments!==e&&(this._scheduleAccessibilityAnnouncement=!0,this._oldFragments=e)}const n=this.state.smsPriceInfo?void 0:i.createElement(T.default,{size:l.SXActivityIndicatorSize.ExtraSmall,tintColor:M.Color.blue,style:A.activityStyle}),r=i.createElement(i.View,{style:A.row},i.createElement(P.Caption,{textThemeColor:P.TextThemeColor.Primary},t,s&&" | ",s),n),a=i.createElement(i.View,{key:"rateSection",title:1===e?this._accessibilityLabelForRateSection:void 0,importantForAccessibility:1===e?i.Types.ImportantForAccessibility.Yes:i.Types.ImportantForAccessibility.NoHideDescendants},r);if(1===e)return a;const c=i.Styles.createTextStyle({backgroundColor:this.state.primaryColor,marginRight:5},!1);return this._accessibilityLabelForRateSection=p.getString("SMSMessaging.SmsCount",{fragments:e})+this._accessibilityLabelForRateSection,i.createElement(i.View,{key:"rateSectionWithBadge",style:A.row,title:this._accessibilityLabelForRateSection,importantForAccessibility:i.Types.ImportantForAccessibility.Yes},i.createElement(o.default,{count:e.toString(),rawCount:e,isHighPriority:!0,style:c,badgeSize:o.BadgeSize.Desktop}),a)}_renderCreditSection(){if(!this.props.creditEntitlement)return;const e=this.props.creditEntitlement.balanceFormatted,t=i.createElement(i.View,{style:A.row},i.createElement(c.default,{icon:I.SkypeIcon.SkypeCredit,color:M.Color.yellow,style:A.creditIcon,size:I.IconSize.size16}),i.createElement(P.Caption,{textThemeColor:P.TextThemeColor.Primary},e)),s={key:"creditSection",importantForAccessibility:i.Types.ImportantForAccessibility.Yes,title:p.getString("SMSMessaging.CreditTitle",{balance:e||0}),children:t};return this.canSendSMS()?i.createElement(i.View,Object.assign({},s)):i.createElement(i.Button,Object.assign({},s,{onPress:this._onRateInfoPress}))}_renderTargetSwitcher(){const e=i.Styles.createTextStyle({color:this.state.primaryColor},!1),t=this.props.selectedPhoneNumber?f.default.parseAndFormat(this.props.selectedPhoneNumber.number,f.PhoneNumberFormat.INTERNATIONAL)||"":p.getString("SMSMessaging.SendViaSkypeStatic"),s=this.props.selectedPhoneNumber?"SMSMessaging.SendSmsToNumber":"SMSMessaging.SendViaSkype",o=i.createElement(P.Caption,{key:"label",style:e},t),n=i.createElement(c.default,{icon:I.SkypeIcon.DownChevron,color:this.state.primaryColor,size:I.IconSize.size20}),r=this.props.selectedPhoneNumber?p.getString("SMSMessaging.SmsSelectorPhoneOptionAccessibilityTitle",{phoneNumber:this.props.selectedPhoneNumber.number}):p.getString("SMSMessaging.SmsSelectorSkypeOptionAccessibilityTitle");return i.createElement(i.Button,{ref:this._onNumberPickerRef,style:A.smsButton,title:r,disabled:this.props.disabled,onPress:this._onSwitcherPressed},i.createElement(P.Caption,{textThemeColor:P.TextThemeColor.Primary},p.getParts(s,{target:o})),n)}_setFocusToSwitcher(){this._numberPickerRef&&y.default.isMobileScreenReaderEnabled()&&this._numberPickerRef.requestFocus()}_announceSmsInfoChangeInScreenReader(){this._accessibilityLabelForRateSection&&y.default.maybeAnnounceForAccessibility(this._accessibilityLabelForRateSection)}}t.default=R},95420:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(98278),n=s(15877),r=s(33754),a=s(27683),l=s(22222),d=s(11828),c=s(24576),h=(0,n.lazyProperties)({option:()=>i.Styles.createButtonStyle({flexDirection:"row",alignItems:"stretch",marginVertical:5,paddingHorizontal:15,justifyContent:"flex-start"})});class u extends c.default{constructor(){super(...arguments),this._onPress=()=>{this.props.onOptionSelected(this.props.phoneNumber)}}render(){let e,t,s;if(this.props.phoneNumber){let i=a.default.parseAndFormat(this.props.phoneNumber.number,a.PhoneNumberFormat.INTERNATIONAL);i||(i=this.props.phoneNumber.number),e=r.getString("SMSMessaging.SmsSelectorPhoneOptionAccessibilityTitle",{phoneNumber:i}),t=r.getString("SMSMessaging.SmsPhoneOption",{type:a.default.getStringForPhoneType(this.props.phoneNumber.type),phoneNumber:i}),s=d.SkypeIcon.MobileSmsNew}else e=r.getString("SMSMessaging.SmsSelectorSkypeOptionAccessibilityTitle"),t=r.getString("SMSMessaging.SendViaSkype",{target:r.getString("SMSMessaging.SendViaSkypeStatic"),chevron:""}),s=d.SkypeIcon.Message;return i.createElement(l.default,{style:h.option,buttonStyle:o.SXButtonStyle.ThemeNoBackground,buttonSize:o.SXButtonSize.Small,icon:s,title:t,onPress:this._onPress,accessibilityLabel:e})}}t.default=u},68675:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(87134),n=s(15877),r=s(33754),a=s(95420),l=s(19675),d=s(24576),c=(0,n.lazyProperties)({container:()=>i.Styles.createViewStyle({minWidth:280,paddingBottom:10}),sendToSmsLabel:()=>i.Styles.createViewStyle({paddingHorizontal:15})});class h extends d.default{render(){return i.createElement(i.View,{style:c.container},this._renderSkypeOption(),i.createElement(o.default,{useLightTheme:!this._useDarkTheme(),marginBottom:5,marginLeft:7,marginRight:7}),i.createElement(l.Caption,{style:c.sendToSmsLabel},r.getString("SMSMessaging.SendSmsToLabel")),this._renderPhoneOptions())}_renderPhoneOptions(){return this.props.phoneNumbers.map((e=>i.createElement(a.default,{key:e.type+"_"+e.number,phoneNumber:e,onOptionSelected:this.props.onOptionSelected})))}_renderSkypeOption(){return i.createElement(a.default,{key:"skype",onOptionSelected:this.props.onOptionSelected})}}t.default=h},88361:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=(s(31844),s(98356)),n=s(16778),r=s(19061),a=s(49748),l=s(39549),d=s(85641),c=s(57102),h=s(19596),u=s(13944),p=s(10117),g=s(36237),m=s(15877),S=s(33754),f=s(42036),y=s(6658),_=s(12056),v=s(45026),C=s(29130),b=s(51070),T=s(81115),M=s(86045),I=s(44487),w=s(750),P=s(11010),k=s(11828),A=s(80837),E=s(60305),R=s(11698),L=s(19675),F=s(24576),x=(0,m.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:0,flexDirection:"row",alignItems:"center",justifyContent:"space-between",position:"absolute",left:0,right:0}),containerLandscape:()=>n.Styles.createViewStyle({paddingHorizontal:34}),containerBottom:()=>n.Styles.createViewStyle({alignContent:"center",borderBottomWidth:0,borderLeftWidth:0,borderRightWidth:0,justifyContent:"center",bottom:0}),containerHeader:()=>n.Styles.createViewStyle({borderTopWidth:0,borderLeftWidth:0,borderRightWidth:0,height:a.HeaderHeightModernizeChatSmallHeader,paddingTop:8,paddingBottom:8}),leftChildren:()=>n.Styles.createViewStyle({flex:-1,alignItems:"flex-start",flexDirection:"row"}),centerChildrenColumn:()=>n.Styles.createViewStyle({flex:1,alignItems:"flex-start",flexDirection:"column",justifyContent:"flex-start"}),selectMessagesTitleHeader:()=>n.Styles.createViewStyle({justifyContent:"flex-start"}),modernizeHeaderConversationTypeTitleHeader:()=>(0,m.lazyProperties)({base:()=>n.Styles.createTextStyle({marginHorizontal:4}),desktop:()=>n.Styles.createTextStyle({fontSize:P.default.controlFontSize.caption}),mobile:()=>n.Styles.createTextStyle({fontSize:P.default.controlFontSize.caption})}),centerChildrenRow:()=>n.Styles.createViewStyle({marginVertical:5,alignItems:"center",justifyContent:"flex-start",flexDirection:"row"}),rightChildren:()=>n.Styles.createViewStyle({flex:-1,alignItems:"flex-end",flexDirection:"row",paddingHorizontal:20}),centerChildrenAction:()=>n.Styles.createViewStyle({flex:-1,justifyContent:"center",alignItems:"center"}),centerChildrenActionSpacing:()=>n.Styles.createViewStyle({flex:1,paddingBottom:5}),buttonStyles:()=>n.Styles.createButtonStyle({padding:6}),iconContainer:()=>n.Styles.createViewStyle({flex:0,alignItems:"center"}),iconContainerWidthDesktop:()=>n.Styles.createViewStyle({width:80}),iconContainerWidthMobile:()=>n.Styles.createViewStyle({width:64}),iconContainerActionsMobileBottom:()=>n.Styles.createViewStyle({flex:1,alignItems:"center"}),spacerDesktop:()=>n.Styles.createViewStyle({width:80,height:k.IconSize.default}),spacerMobile:()=>n.Styles.createViewStyle({width:64,height:k.IconSize.default}),horizontalSpacer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignSelf:"flex-end",marginBottom:20,alignItems:"center"}),desktopContentContainer:()=>n.Styles.createViewStyle({width:y.messageStreamMaxContentWidth,alignSelf:"center",flex:-1,flexDirection:"row",justifyContent:"center"}),desktopContentContainerActions:()=>n.Styles.createViewStyle({justifyContent:"flex-end"}),closeButtonLandscape:()=>n.Styles.createButtonStyle({height:a.LandscapeButtonHeight,alignItems:"flex-start"}),closeButtonDesktop:()=>n.Styles.createButtonStyle({alignItems:"flex-start",paddingRight:38}),iconPadding:()=>n.Styles.createViewStyle({padding:1})});class O extends F.default{constructor(){super(...arguments),this._iconSize=k.IconSize.size24,this._onCancelButtonRef=e=>{this._cancelButton=e||void 0},this._onCancelMultipleMessages=e=>{this.cancelMultipleMessages()},this._onForwardMultipleMessages=e=>{this._actionTaken=R.SelectedMessagesActionType.Forward,h.forwardMessages(this.state.selectedMessages,_.MessageActionOrigin.StreamItemMultipleMessages,this.props.contextConversationId,this._onCancelOrComplete,this._getContext())},this._onRemoveMultipleMessages=e=>{this._actionTaken=R.SelectedMessagesActionType.Remove;const t=i.map(this.state.selectedMessages,(e=>e.message));f.default.deleteMultipleMessages(t,this._getRootViewId(),(()=>{this._onCancelOrComplete(),M.default.maybeAnnounceForAccessibility(S.getString("Global.RemoveMultipleMessages",{count:t.length}))}))},this._onCopyMultipleMessages=e=>{this._actionTaken=R.SelectedMessagesActionType.Copy,f.default.copyMultipleMessages(this.state.selectedMessages,this._getRootViewId()),this._onCancelOrComplete()},this._onCancelOrComplete=e=>{const t=!e,s=!!e&&e.length>0;if(t||s){this.props.onClosePanel(this._headerInitialPosition,this._actionsInitialPosition),I.default.deactivateSelectMessagesMode();const t=new _.SelectedMessagesTelemetry(this.props.conversationId,e?e.length:void 0,this.state.selectedMessages,this._actionTaken,this.state.commands);g.track(t)}}}_buildState(e,t){const s=E.default.useTabletUI(),o=this._getRootViewId(),r=(C.default.getDeviceOrientation(o),!1),c=I.default.getSelectedMessages();let h,u={leavePaddingForStatusBar:n.StatusBar.isOverlay()&&!1,statusBarHeight:b.default.statusBarHeight(),isLandscapeMobile:r,commands:{disabledCopy:!1,disabledForward:!1,disabledRemove:!1},selectedMessages:c,usePrimaryBackgroundColor:e.mobileUi||s,currentConversation:(0,l.default)().getConversation(e.conversationId)};if(c.length>0&&u&&u.commands?i.each(c,(e=>{const t=this._isCommandDisabled([w.CommandTypes.Forward],e.actionMenuCommands),s=this._isCommandDisabled([w.CommandTypes.Remove],e.actionMenuCommands),i=this._isCommandDisabled([w.CommandTypes.Copy,w.CommandTypes.CopyLink,w.CommandTypes.CopyLocation,w.CommandTypes.CopyImage],e.actionMenuCommands);u.commands.disabledForward=u.commands.disabledForward||t,u.commands.disabledRemove=u.commands.disabledRemove||s,u.commands.disabledCopy=u.commands.disabledCopy||i})):(u.commands.disabledForward=!0,u.commands.disabledRemove=!0,u.commands.disabledCopy=!0),h=e.renderHeader?s?60:a.HeaderHeightCompositeBase:s?57:80,e.mobileUi&&!s){const t=70;h=e.renderHeader?t:void 0}if(this._containerHeightStyles=n.Styles.createViewStyle({height:h},!1),t&&(e.mobileUi?(this._headerInitialPosition=u.leavePaddingForStatusBar&&u.statusBarHeight>0?-70-u.statusBarHeight:-70,this._actionsInitialPosition=70+(e.bottomPadding||0)):(this._headerInitialPosition=-a.HeaderHeightCompositeExtended,this._actionsInitialPosition=(s?57:80)+(e.bottomPadding||0)),this._initialPosition=e.renderHeader?this._headerInitialPosition:this._actionsInitialPosition,e.panelAnimatedValue.setValue(this._initialPosition),this._innerMovingContainerYOffsetStyle=n.Styles.createAnimatedViewStyle({transform:[{translateY:e.panelAnimatedValue}]})),!e.mobileUi){const{left:e,right:t}=d.default.getSpacerWidths();u.leftDesktopSpacerWidth=e,u.rightDesktopSpacerWidth=t}return u}componentDidMount(){super.componentDidMount(),v.default.timing(this.props.panelAnimatedValue,{toValue:0,duration:o.Common.Duration.Default,easing:o.Easing.SkypeExpoOut5,useNativeDriver:!0}).start();const e=()=>{this.props.renderHeader&&this._cancelButton&&this._cancelButton.requestFocus()};i.delay(e,500)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);const i=this._countSelectedMessages(t.selectedMessages),o=this._countSelectedMessages(this.state.selectedMessages);this.props.renderHeader&&i!==o&&n.Accessibility.announceForAccessibility(S.getString("MessageStream.MessagesSelected",{count:o}))}_isCommandDisabled(e,t){return!!i.isUndefined(t)||i.intersection(e,t).length<=0}_countSelectedMessages(e){return i.filter(e,(e=>!e.forwardAlbumId||e.message.isAlbum())).length}render(){const e=this._countSelectedMessages(this.state.selectedMessages),t=S.getString("MessageStream.MessagesSelected",{count:e}),s=!this.props.mobileUi&&this.props.renderHeader;let i;0===e&&(i=S.getString("MessageStream.DisabledButtonNoSelection"));const o=S.getString("Global.ForwardButton"),a=S.getString("Global.RemoveLabel"),l=S.getString("MessageActionMenu.ShareMenuCopy"),d=S.getString("Global.CancelLabel"),h=i||(this.state.commands.disabledForward?S.getString("MessageStream.DisabledForward"):o),u=i||(this.state.commands.disabledRemove?S.getString("MessageStream.DisabledRemove"):a),g=i||(this.state.commands.disabledCopy?S.getString("MessageStream.DisabledCopy"):l),m=this._getButtonView(d,S.getString("Global.CancelLabel"),k.SkypeIcon.Cancel,this._onCancelMultipleMessages,void 0,!0),f=[x.container,this._containerHeightStyles,this._themeStyles.viewBorderStyle,this.state.usePrimaryBackgroundColor?this._themeStyles.primaryBackgroundColorStyle:this._themeStyles.buttonBackgroundColorStyle,this._innerMovingContainerYOffsetStyle,this.state.isLandscapeMobile?x.containerLandscape:void 0];let y=[x.rightChildren];this.props.renderActions&&(f.push(x.containerBottom),y.push(x.centerChildrenAction),this.props.mobileUi&&y.push(x.centerChildrenActionSpacing)),this.props.renderHeader&&(this.state.leavePaddingForStatusBar&&this.state.statusBarHeight&&f.push(T.default.marginTopStyle(this.state.statusBarHeight)),f.push(x.containerHeader));const _=n.createElement(n.View,{style:x.leftChildren},m),v=P.default.modernizeSmallPanelHeaderFontStyle(),C=x.modernizeHeaderConversationTypeTitleHeader,b=[x.modernizeHeaderConversationTypeTitleHeader.base,this.props.mobileUi?C.mobile:C.desktop,this._themeStyles.secondaryTextColorStyle],M=this.state.currentConversation&&this.state.currentConversation.isOneOnOne()?this.state.currentConversation.getOtherPartyMri():void 0,I=c.ConversationUtils.getConversationTitleForSelection({mri:this.props.conversationId,otherPartyMri:M}),w=n.createElement(n.View,{style:[x.centerChildrenColumn,s?x.selectMessagesTitleHeader:void 0],accessibilityTraits:n.Types.AccessibilityTrait.Header,importantForAccessibility:n.Types.ImportantForAccessibility.Yes},n.createElement(n.Text,{style:[A.default.flexNegativeOne,v,this._themeStyles.primaryTextColorStyle],numberOfLines:1},t),n.createElement(n.View,{style:x.centerChildrenRow},n.createElement(p.default,{icon:c.ConversationUtils.getIconForConversation(this.state.currentConversation),color:this._themeColors.secondaryTextColor,size:k.IconSize.size14,style:x.iconPadding}),n.createElement(n.Text,{style:b},I)));let E;if(this.props.renderHeader)E=n.createElement(n.View,{style:this.props.mobileUi?x.spacerDesktop:x.spacerMobile});else{let e=r.default.canForwardMessage()?this._getButtonView(o,h,k.SkypeIcon.ForwardItem,this._onForwardMultipleMessages,this.state.commands.disabledForward):void 0;const t=this._getButtonView(l,g,k.SkypeIcon.Copy,this._onCopyMultipleMessages,this.state.commands.disabledCopy),s=this._getButtonView(a,u,k.SkypeIcon.Delete,this._onRemoveMultipleMessages,this.state.commands.disabledRemove),i=this.props.bottomPadding?[y,T.default.paddingBottomStyle(this.props.bottomPadding)]:y;E=n.createElement(n.View,{style:i},t,e,s)}if(!this.props.mobileUi){const e=n.Styles.createViewStyle({minWidth:this.state.leftDesktopSpacerWidth},!1),t=n.Styles.createViewStyle({minWidth:this.state.rightDesktopSpacerWidth},!1);return n.createElement(n.Animated.View,{style:f},n.createElement(n.View,{style:[x.horizontalSpacer,e]}),n.createElement(n.View,{style:[x.desktopContentContainer,this.props.renderActions?x.desktopContentContainerActions:void 0]},this.props.renderHeader?w:E,this.props.renderHeader?_:void 0),n.createElement(n.View,{style:[x.horizontalSpacer,t]}))}return n.createElement(n.Animated.View,{style:f},this.props.renderHeader?_:void 0,this.props.renderHeader?w:void 0,E)}_getButtonView(e,t,s,i,o,r){const a=this._themeColors.primaryIconColor,l=this._themeColors.iconHoverColor,d=n.createElement(u.default,{ref:r?this._onCancelButtonRef:void 0,icon:s,color:a,hoverColor:l,title:t,size:this._iconSize,onPress:i,style:x.buttonStyles,disabledOpacity:.2,disabled:o});let c=this.props.mobileUi?x.iconContainerWidthMobile:x.iconContainerWidthDesktop;const h=[this.props.renderActions?x.iconContainerActionsMobileBottom:x.iconContainer,c];let p;return r?(this.state.isLandscapeMobile&&h.push(x.closeButtonLandscape),this.props.mobileUi||(h.push(x.closeButtonDesktop),c=void 0)):p=n.createElement(L.Caption,{small:!this.state.isLandscapeMobile,style:A.default.flexNegativeOne,numberOfLines:1,accessibilityHidden:!0,textThemeColor:o?L.TextThemeColor.Disabled:L.TextThemeColor.Primary},e),n.createElement(n.View,{style:h},d,p)}cancelMultipleMessages(){this._actionTaken=R.SelectedMessagesActionType.Cancel,this._onCancelOrComplete()}}t.default=O},15761:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(44770),n=s(98278),r=s(87134),a=s(13944),l=s(15877),d=s(33754),c=s(4735),h=s(55585),u=s(22222),p=s(81760),g=s(11010),m=s(11828),S=s(24576),f=s(53374),y=(0,l.lazyProperties)({container:()=>i.Styles.createViewStyle({flexDirection:"column",justifyContent:"center",alignItems:"center",paddingHorizontal:50,paddingTop:20}),contentContainer:()=>i.Styles.createViewStyle({padding:20,borderRadius:10,marginTop:15,flexShrink:void 0}),closeButton:()=>i.Styles.createViewStyle({alignSelf:"flex-end",paddingTop:16}),buttonsWrapper:()=>i.Styles.createViewStyle({alignSelf:"center",alignItems:"center",flexDirection:"row",justifyContent:"center",paddingTop:10}),button:()=>i.Styles.createViewStyle({margin:10,minWidth:175}),image:()=>i.Styles.createViewStyle({height:122,width:160,marginBottom:20,alignSelf:"center"}),header:()=>i.Styles.createTextStyle({textAlign:"center"}),body:()=>i.Styles.createTextStyle({maxWidth:450,paddingTop:10})});class _ extends S.default{constructor(){super(...arguments),this._removeSpeechConsentSuggestion=()=>{h.default.hideSpeechConsentSuggestion()},this._onTellMeMorePress=e=>{c.default.showSpeechConsentPanel({causeId:f.default.newCauseId(),rootViewId:this._getRootViewId()}),this._removeSpeechConsentSuggestion()},this._getContainerStyles=()=>{const e=[y.contentContainer];return this._useAccessibleTheme()&&e.push(i.Styles.createViewStyle({borderColor:this._useDarkTheme()?p.Color.white:p.Color.black,borderWidth:2},!0)),e}}_renderButtons(){return i.createElement(i.View,{style:y.buttonsWrapper},i.createElement(u.default,{style:y.button,buttonStyle:n.SXButtonStyle.ColorStroke,buttonSize:n.SXButtonSize.Medium,title:d.getString("SpeechConsentPanel.TellMeButton"),onPress:this._onTellMeMorePress}),i.createElement(u.default,{style:y.button,buttonStyle:n.SXButtonStyle.ColorStroke,buttonSize:n.SXButtonSize.Medium,title:this._getLabelForDismissSuggestionButton(),onPress:this._removeSpeechConsentSuggestion}))}_getLabelForDismissSuggestionButton(){return h.default.lastTimeShowingSuggestion()?d.getString("SpeechConsentPanel.DontShowAgain"):d.getString("SpeechConsentPanel.MayBeLaterButton")}_getCloseButton(){return i.createElement(a.default,{onPress:this._removeSpeechConsentSuggestion,icon:m.SkypeIcon.ClosePanel,size:m.IconSize.size14,color:this._themeColors.secondaryTextColor,hoverColor:this._themeColors.secondaryTextColor,showHoverEffect:!0,style:y.closeButton,title:d.getString("Global.CloseButtonTitle")})}render(){return i.createElement(i.View,{style:y.container},i.createElement(r.default,{marginLeft:0,marginRight:0}),this._getCloseButton(),i.createElement(i.View,{style:this._getContainerStyles()},i.createElement(i.Image,{source:o.Collection.SPEECH_CONSENT_PROMPT,style:y.image,resizeMode:"contain"}),i.createElement(i.Text,{style:[y.header,g.default.panelHeaderFontStyle()]},d.getString("SpeechConsentPanel.ConversationHeader")),i.createElement(i.Text,{style:[y.header,y.body,g.default.bodyFontStyle()]},d.getString("SpeechConsentPanel.ConversationBody")),this._renderButtons()))}}t.default=_},52333:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(11930),n=s(15877),r=s(89808),a=s(30124),l=s(80837),d=s(60305),c=s(19675),h=s(24576),u=(0,n.lazyProperties)({container:()=>i.Styles.createViewStyle({flex:1,alignSelf:"stretch",flexDirection:"row",alignItems:"center",justifyContent:"center",marginLeft:10,marginRight:10,paddingTop:10,paddingRight:0,paddingBottom:0,paddingLeft:0}),containerDesktop:()=>i.Styles.createViewStyle({marginLeft:50,marginRight:50}),containerTablet:()=>i.Styles.createViewStyle({marginLeft:50,marginRight:0}),whisker:()=>i.Styles.createViewStyle({flex:1,marginTop:5,marginBottom:5,marginLeft:0,marginRight:0,height:1,flexDirection:"row",opacity:.4}),whiskerLeft:()=>i.Styles.createViewStyle({marginRight:5}),whiskerRight:()=>i.Styles.createViewStyle({marginLeft:5}),whiskerAccessible:()=>i.Styles.createViewStyle({opacity:1}),thickerWhisker:()=>i.Styles.createViewStyle({height:2,opacity:.8}),text:()=>i.Styles.createTextStyle({paddingHorizontal:10,paddingVertical:5,alignSelf:"center"})});class p extends h.default{constructor(){super(...arguments),this._onComponentRef=e=>{this._componentRef=e||void 0}}_buildState(e,t){return{isUsingStackNavigationContext:a.default.isUsingStackNavigationContext(),useTabletUI:d.default.useTabletUI(),text:e.textGetter?e.textGetter():e.text}}componentDidMount(){super.componentDidMount(),this.props.onMountItem&&this.props.onMountItem(this,this.props.focusStreamItemTextForMobileScreenReader)}focusItemForScreenReader(){this.isComponentMounted()&&this._componentRef&&this._componentRef.requestFocus()}render(){const e=[u.text,l.default.noWrap];this.props.dividerTypeIsLastRead&&!this._useAccessibleTheme()&&e.push(r.default.getTextColorStyleNoSubscription());const t=[u.container];this.state.isUsingStackNavigationContext||this._getContext().isPresentedInDesktopSubview||t.push(this.state.useTabletUI?u.containerTablet:u.containerDesktop);const s=o.default.headerAccessibilityInfo(this.state.text);return i.createElement(i.View,{style:t,ref:this._onComponentRef,tabIndex:-1,accessibilityLabel:s.accessibilityLabel,accessibilityTraits:s.accessibilityTraits,importantForAccessibility:i.Types.ImportantForAccessibility.Yes},this._whisker(u.whiskerLeft),i.createElement(c.Caption,{style:e,selectable:!1,messageStreamFontSize:this.props.messageStreamFontSize,accessibilityHidden:!0},this.state.text),this._whisker(u.whiskerRight))}_whisker(e){if(this.props.dividerTypeIsLastRead){const t=[u.whisker,u.thickerWhisker,e];return this._useAccessibleTheme()?t.push(i.Styles.createViewStyle({backgroundColor:this._themeColors.primaryTextColor},!1)):t.push(r.default.getBackgroundColorStyleNoSubscription()),i.createElement(i.View,{style:t})}{const t=[u.whisker,this._themeStyles.secondaryViewColorStyle,e];return this._useAccessibleTheme()&&t.push(u.whiskerAccessible),i.createElement(i.View,{style:t})}}}t.default=p},7698:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(52262),r=s(15877),a=s(33754),l=s(29130),d=s(88237),c=s(19675),h=s(24576),u=(0,r.lazyProperties)({streamItemContainer:()=>o.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"flex-start",overflow:"hidden",marginLeft:50,marginTop:8}),streamItemContainerComposite:()=>o.Styles.createViewStyle({marginLeft:50}),userNameText:()=>o.Styles.createTextStyle({flex:-1,marginRight:5})});class p extends h.default{_buildState(e,t){const s=i.compact(e.typingMris);let o={compactedTypingMris:s,firstPersonTyping:void 0,secondPersonTyping:void 0,streamItemContainerHeight:Math.ceil(18*l.default.getContentSizeMultiplier())};return s.length>0&&(o.firstPersonTyping=n.default.getMemberShortNameForConversation(e.conversationId,s[0]),2===e.typingMris.length&&(o.secondPersonTyping=n.default.getMemberShortNameForConversation(e.conversationId,s[1]))),o}componentDidMount(){super.componentDidMount(),this.state.compactedTypingMris.length&&o.Accessibility.announceForAccessibility(a.getString("TypingIndicator.TypingAnnouncement"))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.compactedTypingMris.length&&!t.compactedTypingMris.length&&o.Accessibility.announceForAccessibility(a.getString("TypingIndicator.TypingAnnouncement"))}render(){const e=[u.streamItemContainer,o.Styles.createViewStyle({height:this.state.streamItemContainerHeight},!1)];return this.props.isUsingStackNavigationContext||e.push(u.streamItemContainerComposite),o.createElement(o.View,{style:e},this._renderOptionalTypingIndicator())}_renderOptionalTypingIndicator(){if(this.state.compactedTypingMris.length)return[o.createElement(c.Caption,{key:"caption",style:u.userNameText,numberOfLines:1},this._getTypingText()),o.createElement(d.default,{key:"typingIndicator"})]}_getTypingText(){return 1===this.state.compactedTypingMris.length&&this.state.firstPersonTyping?a.getString("TypingIndicator.OnePersonTyping",{typer:this.state.firstPersonTyping}):2===this.state.compactedTypingMris.length&&this.state.firstPersonTyping&&this.state.secondPersonTyping?a.getString("TypingIndicator.PeopleTyping",{peopleTyping:this.props.typingMris.length,firstTyper:this.state.firstPersonTyping,secondTyper:this.state.secondPersonTyping}):this.state.compactedTypingMris.length>2?a.getString("TypingIndicator.PeopleTyping",{peopleTyping:this.props.typingMris.length}):""}}t.default=p},88237:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(44770),n=s(15877),r=s(24576);var a;!function(e){e[e.None=0]="None",e[e.Loop=1]="Loop"}(a||(a={}));const l=(0,n.lazyProperties)({newIndicatorImage:()=>i.Styles.createImageStyle({width:30,height:15,top:1,opacity:.8})});class d extends r.default{_buildState(e,t){let s={};return t&&(s.currentAnimationStep=a.None),s}componentDidMount(){super.componentDidMount(),this.setState({currentAnimationStep:a.Loop})}render(){if(this.state.currentAnimationStep===a.None)return null;let e;e=this._useAccessibleTheme()?this._useDarkTheme()?o.Collection.TYPING_INDICATOR_NEXT_HIGHCONTRAST_DARK:o.Collection.TYPING_INDICATOR_NEXT_HIGHCONTRAST_LIGHT:this._useDarkTheme()?o.Collection.TYPING_INDICATOR_NEXT_DARK:o.Collection.TYPING_INDICATOR_NEXT_LIGHT;const t=i.Styles.createViewStyle({width:75,height:15,overflow:"visible"},!1);return i.createElement(i.View,{style:t},i.createElement(i.Image,{style:l.newIndicatorImage,source:e,resizeMode:"contain"}))}}t.default=d},71308:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureButton=t.CaptureButtonSize=void 0;const i=s(96486),o=s(48184),n=s(98356),r=s(16778),a=s(88837),l=s(44770),d=s(46096),c=s(12854),h=s(10117),u=s(36237),p=s(15877),g=s(33754),m=s(78780),S=s(81760),f=s(11828),y=s(80837),_=s(12770);t.CaptureButtonSize=80;const v=(0,p.lazyProperties)({captureButtonContainer:()=>r.Styles.createButtonStyle({width:t.CaptureButtonSize,height:t.CaptureButtonSize,overflow:"visible",alignSelf:"flex-start",alignItems:"center"}),captureContainerAccessibleRecord:()=>r.Styles.createViewStyle({width:t.CaptureButtonSize,height:2*t.CaptureButtonSize}),captureContainerAccessibleRecordLandscape:()=>r.Styles.createViewStyle({width:2*t.CaptureButtonSize,height:t.CaptureButtonSize,alignSelf:"flex-end",flexDirection:"row"}),captureButton:()=>r.Styles.createButtonStyle({width:t.CaptureButtonSize,height:t.CaptureButtonSize,overflow:"visible"}),shutterButtonImage:()=>r.Styles.createButtonStyle({width:59,height:59,position:"absolute"}),buttonActive:()=>r.Styles.createButtonStyle({backgroundColor:S.Color.white,width:59,height:59,position:"absolute",borderRadius:30}),recordButtonActive:()=>r.Styles.createImageStyle({backgroundColor:S.Color.red,borderWidth:2,borderColor:S.Color.white}),captureButtonOuterView:()=>r.Styles.createViewStyle({width:t.CaptureButtonSize,height:t.CaptureButtonSize,overflow:"visible",alignItems:"center",justifyContent:"center"}),captureButtonViewDisabled:()=>r.Styles.createViewStyle({opacity:1}),innerContainer:()=>r.Styles.createViewStyle({alignItems:"center",justifyContent:"center",overflow:"visible"}),accessibleRecordButton:()=>r.Styles.createViewStyle({height:t.CaptureButtonSize,width:t.CaptureButtonSize,alignItems:"center"}),accessibleRecordButtonIcon:()=>r.Styles.createViewStyle({position:"absolute"})});class C extends a.ComponentBase{constructor(){super(...arguments),this._pressed=!1,this._accessibleRecordButtonPressed=!1,this._panning=!1,this._captureButtonAnimatedOpacityValue=new r.Animated.Value(1),this._captureButtonAnimatedScaleValue=new r.Animated.Value(1),this._captureButtonAnimatedStyle=r.Styles.createAnimatedViewStyle({opacity:this._captureButtonAnimatedOpacityValue,transform:[{scale:this._captureButtonAnimatedScaleValue}]}),this._onShutterAnimationViewRef=e=>{this._shutterAnimationView=e||void 0},this._onRecordingAnimationViewRef=e=>{this._recordingAnimationView=e||void 0,i.delay((()=>{this.isComponentMounted()&&this._recordingAnimationView&&this._recordingAnimationView.reset()}),500)},this._onCaptureButtonPressIn=()=>{u.log(d.LogTraceArea.Capture,"CaptureButton _onCaptureButtonPressIn disabled: "+this.props.disabled+" _onPressIn hidden: "+this.props.hidden+" props.onPressIn: "+(this.props.onPressIn?"ok":"null")),this.props.disabled||this.props.hidden||(this._pressed=!0,this._updateButton(!0,!0,200,this._onStartRecording),this.props.onPressIn&&this.props.onPressIn(),c.default.triggerFeedback().then((()=>{c.default.unprepareFeedback()})))},this._onAccessibleRecordButtonPress=()=>{u.log(d.LogTraceArea.Capture,"CaptureButton_onAccessibleRecordButtonPress disabled: "+this.props.disabled+" props.onPressIn: "+(this.props.onPressIn?"ok":"null")),this._accessibleRecordButtonPressed=!0,this.props.isRecording?this._onCaptureButtonPressOut():this._onCaptureButtonPressIn()},this._onCaptureButtonPressOut=()=>{u.log(d.LogTraceArea.Capture,"CaptureButton _onCaptureButtonPressOut disabled: "+this.props.disabled+" panning: "+this._panning+" props.onPressOut: "+(this.props.onPressOut?"ok":"null")),this._panning||this.props.disabled||(this._pressed=!1,this._updateButton(!1,!0),this.props.onPressOut&&this.props.onPressOut())},this._onStartRecording=()=>{u.log(d.LogTraceArea.Capture,"CaptureButton _onStartRecording _pressed: "+this._pressed+" props.captureMode: "+this.props.captureMode),this._pressed&&this.props.captureMode!==d.CaptureMode.PhotoOnly&&(this._recordingAnimationView&&this._recordingAnimationView.play(),this.props.onStartRecording())},this._onPress=e=>{u.log(d.LogTraceArea.Capture,"CaptureButton _onPress disabled: "+this.props.disabled+" _onPress hidden: "+this.props.hidden+" props.onPress: "+(this.props.onPress?"ok":"null")),this.props.disabled||this.props.hidden||(this.props.captureMode===d.CaptureMode.VideoOnly||this.props.isRecording||this._updateButton(!1,!1),this._shutterAnimationView&&this._shutterAnimationView.play(),this.props.onPress&&this.props.onPress(e.timeStamp))},this._onPan=e=>{e.isComplete?(u.log(d.LogTraceArea.Capture,"CaptureButton _onPan complete"),this._panning=!1,this._onCaptureButtonPressOut()):this._panning||(this._panning=!0)},this._onPanDisabled=e=>{e.isComplete&&(u.log(d.LogTraceArea.Capture,"CaptureButton _onPanDisabled complete"),this._panning=!1)},this._onButtonRef=e=>{this._button=e||void 0}}componentWillUnmount(){super.componentWillUnmount(),c.default.unprepareFeedback()}componentDidMount(){super.componentDidMount(),this._accessibleRecordButtonPressed=!1,this._updateButton(this.props.isRecording,!0)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.props.isRecording!==e.isRecording&&(u.log(d.LogTraceArea.Capture,"CaptureButton componentDidUpdate isRecording "+e.isRecording+" -> "+this.props.isRecording),this._updateButton(this.props.isRecording,!0))}requestFocus(){this._button&&this._button.requestFocus()}_updateButton(e,t=!1,s=0,i){const o=e&&!this._accessibleRecordButtonPressed?1.5:1;!e&&this._recordingAnimationView&&this._recordingAnimationView.reset();const a=this.props.hidden?0:1;this._recordingTimeout&&(_.default.clearTimeout(this._recordingTimeout),this._recordingTimeout=void 0),t?this.props.captureMode!==d.CaptureMode.PhotoOnly&&this.props.isRecording?(r.Animated.parallel([n.timing.easeOut({value:this._captureButtonAnimatedOpacityValue,toValue:a,duration:n.Common.Duration.Short,useNativeDriver:!0}),n.timing.easeOut({value:this._captureButtonAnimatedScaleValue,toValue:o,duration:n.Common.Duration.Short,useNativeDriver:!0})]).start(),i&&(this._recordingTimeout=_.default.setTimeout((()=>{this.isComponentMounted()&&i()}),200+s))):n.timing.easeOut({value:this._captureButtonAnimatedOpacityValue,toValue:a,duration:n.Common.Duration.Short,useNativeDriver:!0}).start(i):(this.props.captureMode===d.CaptureMode.PhotoOnly&&this._captureButtonAnimatedOpacityValue.setValue(a),i&&i())}render(){const e=[v.captureButtonOuterView];let t,s;this.props.disabled&&e.push(v.captureButtonViewDisabled),this.props.isRecording&&(s=r.createElement(r.View,{style:[v.buttonActive,v.recordButtonActive]}));const n=[v.captureButtonContainer,y.default.absoluteFill,v.innerContainer];if(this.props.enableCameraPortraitLock){const e=r.Styles.createViewStyle({transform:[{rotate:this.props.rotate+"deg"}]},!1);n.push(e)}t=r.createElement(r.Animated.View,{key:"captureButton",style:[y.default.absoluteFill,v.innerContainer,this._captureButtonAnimatedStyle],blockPointerEvents:!0},r.createElement(o.default,{key:"recordProgressIndicator",ref:this._onRecordingAnimationViewRef,style:n,source:m.default.CAPTURE_RECORD_PROGRESS_60_SECONDS.source,speed:59800/this.props.recordingDuration}),r.createElement(r.View,{style:[y.default.absoluteFill,v.innerContainer]},r.createElement(r.Image,{style:[v.shutterButtonImage],source:l.Collection.CAPTURE_SHUTTER_BUTTON})),r.createElement(o.default,{ref:this._onShutterAnimationViewRef,style:[y.default.absoluteFill,v.innerContainer],source:m.default.CAPTURE_PHOTO.source}),r.createElement(r.View,{style:[y.default.absoluteFill,v.innerContainer]},s));let a=this.props.enableAccessibleRecordButton?r.createElement(r.Button,{onPress:this._onAccessibleRecordButtonPress,style:v.accessibleRecordButton,accessibilityLabel:g.getString("CapturePreview.StartAndStopRecordingButton")},r.createElement(h.default,{icon:f.SkypeIcon.CallRecordDot,size:f.IconSize.size30,color:S.Color.red}),r.createElement(h.default,{icon:f.SkypeIcon.CallRecordStroke,size:f.IconSize.size30,color:S.Color.white,style:[v.accessibleRecordButtonIcon,y.default.shadowStyle]})):void 0;const d=[v.captureButtonContainer];this.props.enableAccessibleRecordButton&&(d.push(v.captureContainerAccessibleRecord),this.props.isLandscape&&d.push(v.captureContainerAccessibleRecordLandscape));const c=this._accessibleRecordButtonPressed?r.Types.ImportantForAccessibility.NoHideDescendants:void 0;return r.createElement(r.GestureView,{style:d,onPan:this.props.disabled?this._onPanDisabled:this._onPan,importantForAccessibility:r.Types.ImportantForAccessibility.No},r.createElement(r.Button,{ref:this._onButtonRef,style:v.captureButton,onPress:this._onPress,onPressIn:this._onCaptureButtonPressIn,onPressOut:this._onCaptureButtonPressOut,onLongPress:i.noop,disableTouchOpacityAnimation:!0,accessibilityLabel:this.props.captureAccessibilityLabel,importantForAccessibility:c},r.createElement(r.View,{style:e},t)),a)}}t.CaptureButton=C,t.default=C},70857:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureCoachmarksGestureView=t.CaptureCoachmarksBase=void 0;s(7159);const i=s(16778),o=s(88837),n=s(15877),r=s(81760),a=(0,n.lazyProperties)({container:()=>i.Styles.createViewStyle({position:"absolute",top:0,left:0,bottom:0,right:0,alignItems:"center",justifyContent:"center",overflow:"visible",backgroundColor:r.Color.transparent}),innerContainer:()=>i.Styles.createViewStyle({position:"absolute",top:0,left:0,bottom:0,right:0,overflow:"visible"}),overlayIOS:()=>i.Styles.createViewStyle({opacity:1}),overlay:()=>i.Styles.createViewStyle({backgroundColor:r.Color.blackOverlay50}),coachmarksGestureView:()=>i.Styles.createViewStyle({position:"absolute",bottom:0,right:0,left:0,top:0,backgroundColor:r.Color.transparent})});class l extends o.ComponentBase{constructor(){super(...arguments),this._hasBeenDismissed=!1,this._backgroundAnimatedOpacityValue=new i.Animated.Value(1),this._backgroundAnimatedOpacityStyle=i.Styles.createAnimatedViewStyle({opacity:this._backgroundAnimatedOpacityValue}),this._onDismiss=()=>{this.props.onDismiss&&this.props.onDismiss()},this._onContainerLayout=e=>{}}componentDidMount(){super.componentDidMount(),i.Animated.timing(this._backgroundAnimatedOpacityValue,{toValue:1,duration:500,easing:i.Animated.Easing.InOut()}).start()}dismiss(){this._hasBeenDismissed||(this.isComponentMounted()?i.Animated.timing(this._backgroundAnimatedOpacityValue,{toValue:0,duration:500,easing:i.Animated.Easing.InOut()}).start(this._onDismiss):this._onDismiss(),this._hasBeenDismissed=!0)}render(){let e;return this.props.hideOverlay||(e=i.createElement(i.View,{style:[a.innerContainer,a.overlay]})),i.createElement(i.Animated.View,{style:[a.container,this._backgroundAnimatedOpacityStyle],onLayout:this._onContainerLayout,ignorePointerEvents:!0},e,this._renderCoachmarks())}}t.CaptureCoachmarksBase=l;class d extends o.ComponentBase{constructor(){super(...arguments),this._isDismissed=!1,this._onDismiss=()=>{this._isDismissed||(this.props.onDismiss(),this._isDismissed=!0)}}render(){return i.createElement(i.GestureView,{style:a.coachmarksGestureView,onTap:this._onDismiss,onPan:this._onDismiss,releaseOnRequest:!0})}}t.CaptureCoachmarksGestureView=d,t.default=l},65159:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureComboView=t.PresentationAnimationType=void 0;const i=s(96486),o=s(31844),n=s(2604),r=s(16778),a=s(96074),l=s(94224),d=s(25854),c=s(23303),h=s(14980),u=s(59037),p=s(69198),g=s(3056),m=s(46096),S=s(36237),f=s(15877),y=s(72071),_=s(81157),v=s(6286),C=s(45026),b=s(81736),T=s(29130),M=s(49603),I=s(12187),w=s(81760),P=s(78262),k=s(80837),A=s(12770),E=s(53374),R=s(73877);var L;!function(e){e[e.Fade=1]="Fade"}(L=t.PresentationAnimationType||(t.PresentationAnimationType={}));const F=(0,f.lazyProperties)({container:()=>r.Styles.createViewStyle({flex:1,backgroundColor:w.Color.black}),captureView:()=>r.Styles.createViewStyle({flex:1,backgroundColor:w.Color.black,overflow:"visible"}),mediaPickerWrapper:()=>k.default.absoluteFill});class x extends a.default{constructor(){super(...arguments),this._animatedPresentationOpacityValue=new r.Animated.Value(0),this._animatedPresentationStyle=r.Styles.createAnimatedViewStyle({opacity:this._animatedPresentationOpacityValue}),this._animatedOpacityValue=new r.Animated.Value(0),this._animatedOpacityStyle=r.Styles.createAnimatedViewStyle({opacity:this._animatedOpacityValue}),this._onBackPressed=()=>{const e=E.default.newCauseId();S.log(m.LogTraceArea.Capture,"CaptureComboView._onBackPressed, causeId: "+e);const t=()=>{this.props.onBackPressed&&this.props.onBackPressed()||h.closeCaptureCombo(e,this._getContext())};return this.props.presentationAnimationType===L.Fade?C.default.timing(this._animatedPresentationOpacityValue,{toValue:0,duration:100,easing:r.Animated.Easing.Out(),useNativeDriver:!0}).start(t):t(),!0},this._onHandleMediaEditorParams=e=>{const t=E.default.newCauseId();return S.log(m.LogTraceArea.Capture,"CaptureComboView._onHandleMediaEditorParams, causeId: "+t),this.props.onHandleEditMediaSelection?this.props.onHandleEditMediaSelection(e):this.isComponentMounted()&&this.setState({previewParams:e,cameraMode:void 0,preventAccessibilityFocusMediaPicker:!0}),!0},this._onHandleCaptureParams=(e,t)=>(this.isComponentMounted()&&this.setState({previewParams:[e],cameraMode:t}),!0),this._onHandleMediaPicker=e=>(this.props.onWillShowMediaPicker&&this.props.onWillShowMediaPicker(),this.state.shouldRenderMediaPicker?this._mediaPickerPanel&&(this._mediaPickerPanel.expandOrCollapse(!0),this.setState({preventAccessibilityFocusCapture:!0})):this.setState({shouldRenderMediaPicker:!0},(()=>{this._mediaPickerPanel&&this._mediaPickerPanel.expandOrCollapse(!0)})),!0),this._onMediaPickerExpanded=e=>{if(r.StatusBar.isOverlay()){const t=I.default.createHiddenStyle(!e);this._updateStatusBarStyle(t)}if(this.state.shouldRenderMediaPicker&&this.props.onFocusOnCameraOrMediaPicker){const t=this._shouldRenderPreview()||e;this.props.onFocusOnCameraOrMediaPicker(t)}},this._onPreviewReject=e=>{const t=i.isUndefined(e)?this.state.previewParams&&!!this.state.previewParams[0].mediaSelection:e===m.PostSource.MediaPicker;this.setState({previewParams:[],preventAccessibilityFocusMediaPicker:!1,discardCameraTempFiles:!0},(()=>{t&&this._mediaPickerPanel&&this._mediaPickerPanel.expandOrCollapse(!0),this._onFocusOnCamera(!1)}))},this._onMediaPickerPanelRef=e=>{this._mediaPickerPanel=e||void 0},this._onCapturePanelRef=e=>{this._capturePanel=e||void 0},this._onCapturePreviewRef=e=>{this._capturePreview=e||void 0},this._onCaptureMultiPreviewRef=e=>{this._captureMultiPreview=e||void 0},this._goBack=e=>(S.log(m.LogTraceArea.Capture,"CaptureComboView._goBack, causeId: "+e),!(!this._capturePreview||!this._capturePreview.handleBackAction())||(!(!this._captureMultiPreview||!this._captureMultiPreview.handleBackAction())||(this._shouldRenderPreview()?(this._onPreviewReject(),!0):!(!this._mediaPickerPanel||!this._mediaPickerPanel.handleBackAction())||(!(!this._capturePanel||!this._capturePanel.handleBackAction())||(this.props.isInline?_.default.hideProcessingDialog(!1):this._onBackPressed()))))),this._mediaPickerClosed=()=>{this.setState({preventAccessibilityFocusCapture:!1})},this._onSendFlowComplete=()=>{this.props.onSendFlowWillComplete&&this.props.onSendFlowWillComplete(),this._intOnSendFlowComplete()},this._onFocusOnCamera=e=>{this.isComponentMounted()&&this.state.focusOnCamera!==e&&this.setState({focusOnCamera:e}),this.props.onFocusOnCameraOrMediaPicker&&this.props.onFocusOnCameraOrMediaPicker(this._shouldRenderPreview()||e)}}_buildState(e,t){const s=this._getRootViewId();let i={isLandscape:T.default.getDeviceOrientation(s)===o.DeviceOrientation.Landscape,isConnectedToCall:l.default.CallingStore.hasConnectedCalls(),hasMediaPickerPermissions:b.default.permissionStatus(P.PermissionType.CameraRoll)===n.PermissionStatus.Granted};return t&&(i.cameraMode=void 0,i.previewParams=[],i.shouldRenderMediaPicker=!!e.isInline&&!!e.isVisible&&i.hasMediaPickerPermissions,i.focusOnCamera=!1,i.sendingPhoto=!1,i.discardCameraTempFiles=!1),i}componentDidMount(){if(super.componentDidMount(),!this.props.isInline){const e=I.default.mergeStyles([I.default.createBackgroundColorStyle(w.Color.black),I.default.createBarStyle(M.BarStyleTheme.Light)]),t=r.StatusBar.isOverlay()&&!this.props.mediaPickerOnly?I.default.mergeStyles([I.default.createHiddenStyle(!0),e]):e;this._updateStatusBarStyle(t),A.default.setTimeout((()=>{this.isComponentMounted()&&this.setState({shouldRenderMediaPicker:!0})}),400)}this.props.presentationAnimationType===L.Fade&&C.default.timing(this._animatedPresentationOpacityValue,{toValue:1,duration:100,easing:r.Animated.Easing.Out(),useNativeDriver:!0}).start(),(this.props.mediaPickerShouldCollapseFully||this.props.disableMediaPicker)&&this._animatedOpacityValue.setValue(1)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.shouldRenderMediaPicker&&!t.shouldRenderMediaPicker&&r.Animated.timing(this._animatedOpacityValue,{toValue:1,duration:200,easing:r.Animated.Easing.Out()}).start(),this.props.isInline&&e.isVisible!==this.props.isVisible&&(this.props.isVisible?this.setState({shouldRenderMediaPicker:this.state.hasMediaPickerPermissions}):(this._removeStatusBarStyle(),this.setState({shouldRenderMediaPicker:!1}))),this.props.onFocusOnCameraOrMediaPicker&&this.props.onFocusOnCameraOrMediaPicker(this._shouldRenderPreview())}_componentId(){return"CaptureComboView"}_intOnSendFlowComplete(){const e=E.default.newCauseId();S.log(m.LogTraceArea.Capture,"CaptureComboView._intOnSendFlowComplete, causeId: "+e),this.isComponentMounted()&&!this.props.willDismissOnSend&&this.setState({previewParams:[],sendingPhoto:!1}),this.props.onSendFlowComplete?this.props.onSendFlowComplete():h.closeCaptureCombo(e,this._getContext())}_shouldRenderPreview(e){return(e||this.state).previewParams.length>0}_shouldShowCamera(e,t){return!e.mediaPickerOnly&&!this._shouldRenderPreview(t)}render(){const e=i.isUndefined(this.props.isVisible)||this.props.isVisible,t=!this.props.disableMediaPicker&&(!this.props.isInline||e),s=this.props.opacityStyle||(this.props.isInline?void 0:this._animatedOpacityStyle),o=this.props.mediaPickerShouldCollapseFully||this.props.disableMediaPicker?0:this.state.isLandscape?-60:R.default.measureWindow(this._getRootViewId()).width/4*1.2;let n;t&&(n=r.createElement(r.View,{key:"mediapicker",style:F.mediaPickerWrapper,ignorePointerEvents:!0},r.createElement(y.default,{ref:this._onMediaPickerPanelRef,conversationId:this.props.reactionsConversationId||this.props.conversationId,allowVideo:this.props.allowVideo,mediaPickerMode:this.props.mediaPickerOnly?d.MediaPickerMode.Inline:d.MediaPickerMode.InlinePeekaboo,allowMultiple:this.props.allowMultiple,defaultToAlbums:this.props.mediaPickerOnly&&this.props.defaultToAlbums,pauseLoading:!this.state.shouldRenderMediaPicker,capturedContentHandler:this.props.capturedContentHandler,thumbnailPeek:o,hidden:this.state.focusOnCamera||!this.props.mediaPickerOnly&&!this.state.shouldRenderMediaPicker||this._shouldRenderPreview(),overrideStatusBar:this.props.isInline,onExpanded:this._onMediaPickerExpanded,onHandleEditMediaSelection:this._onHandleMediaEditorParams,onSendFlowComplete:this._onSendFlowComplete,onBackPressed:this._onBackPressed,onClose:this._mediaPickerClosed,screenChangeOnSelection:!(this.props.mediaPickerOnly&&this.props.allowMultiple),preventAccessibilityFocus:this.state.preventAccessibilityFocusMediaPicker})));const a=this._shouldShowCamera(this.props,this.state);let l;a&&(l=[F.captureView]);const h=a?r.createElement(u.default,{ref:this._onCapturePanelRef,key:"capture",style:l,captureMode:this.props.captureMode||m.CaptureMode.Default,capturedContentHandler:this.props.capturedContentHandler,conversationId:this.props.conversationId,reactionsConversationId:this.props.reactionsConversationId,isFocussedCamera:i.isUndefined(this.props.isFocussedCamera)||this.props.isFocussedCamera,isVisible:e,disableMediaPicker:this.props.disableMediaPicker,bottomControlsInset:Math.max(o,0),disableBackgroundCameraRelease:this.props.disableBackgroundCameraRelease,skipShareWithPanel:this.props.skipShareWithPanel||!!this.props.conversationId,showCoachmarksIfNeeded:this.props.showCoachmarksIfNeeded,isConnectedToCall:this.state.isConnectedToCall,adjustLayoutForDeviceOrientation:i.isUndefined(this.props.adjustLayoutForDeviceOrientation)||this.props.adjustLayoutForDeviceOrientation,opacityStyle:s,secondaryOpacityStyle:this.props.secondaryOpacityStyle,closeInsteadOfBackButton:!this.props.useBackArrow,preventAccessibilityFocus:this.state.preventAccessibilityFocusCapture,ignoreBottomSafeArea:this.props.ignoreBottomSafeArea,discardTempFilesFromPreviousSession:this.state.discardCameraTempFiles,onHandleCapture:this._onHandleCaptureParams,onHandleMediaPicker:this._onHandleMediaPicker,onCaptureFlowComplete:this._onSendFlowComplete,onFocusOnCamera:this._onFocusOnCamera,onBackPressed:this._onBackPressed,onTap:this.props.onCameraTapped}):void 0;let S;if(1===this.state.previewParams.length){const e=this.state.previewParams[0];S=r.createElement(p.default,{ref:this._onCapturePreviewRef,fileSize:e.fileSize,mediaWidth:e.width||0,mediaHeight:e.height||0,localMediaIsVideo:e.localMediaIsVideo,localMediaThumbnailUri:e.localMediaThumbnailUri,localMediaObjectUri:e.localMediaObjectUri,skipShareWithPanel:e.skipShareWithPanel,performMarkupOnly:this.props.performMarkupOnly,onCaptureFlowComplete:e.onCaptureFlowComplete,conversationId:e.conversationId,parentConversationId:this.props.conversationId,callId:e.callId,mediaSelection:e.mediaSelection,cameraMode:this.state.cameraMode,unlockOrientation:!0,disableCoachmarks:!0,capturedContentHandler:e.capturedContentHandler,captureSessionTelemetry:e.captureSessionTelemetry,entryPoint:e.mediaSelection?m.PostSource.MediaPicker:m.PostSource.Capture,markupEnabled:!this.props.disableMarkup,useCompactControls:this.props.useCompactSendControls,centerCompactControls:this.state.isLandscape,inlinePreview:!0,onReject:this._onPreviewReject,opacityStyle:s,isAvatarPreview:this.props.showAvatarOverlay,ignoreBottomSafeArea:this.props.ignoreBottomSafeArea,showCoachmarksIfNeeded:this.props.showCoachmarksIfNeeded,orientationLockKey:e.orientationLockKey})}this.state.previewParams.length>1&&this.props.conversationId&&v.default.isMediaPreviewEnabled(this.props.conversationId)&&(S=r.createElement(c.default,{ref:this._onCaptureMultiPreviewRef,mediaPreviews:this.state.previewParams,conversationId:this.props.conversationId,onReject:this._onPreviewReject}));let f=[F.container,this.props.style];return this.props.presentationAnimationType&&f.push(this._animatedPresentationStyle),r.createElement(g.default,{goBack:this._goBack},r.createElement(r.Animated.View,{style:f},h,S,n))}}t.CaptureComboView=x,t.default=x},32827:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(47204),n=s(98278),r=s(73865),a=s(65159),l="captureComboView";class d{static show(e,t,s){const n=e.onSendFlowComplete?d._sendFlowComplete(e.onSendFlowComplete):d.close,c=i.createElement(r.default,{onDismiss:s},i.createElement(a.default,{key:"captureCombo",capturedContentHandler:e.capturedContentHandler,conversationId:e.conversationId,allowVideo:e.allowVideo,mediaPickerOnly:e.mediaPickerOnly,allowMultiple:e.allowMultiple,defaultToAlbums:e.defaultToAlbums,willDismissOnSend:e.willDismissOnSend,disableMarkup:e.disableMarkup,mediaPickerShouldCollapseFully:e.mediaPickerShouldCollapseFully,showCoachmarksIfNeeded:e.showCoachmarksIfNeeded,presentationAnimationType:a.PresentationAnimationType.Fade,disableBackgroundCameraRelease:e.disableBackgroundCameraRelease,captureMode:e.captureMode,showAvatarOverlay:e.showAvatarOverlay,performMarkupOnly:e.performMarkupOnly,disableMediaPicker:e.disableMediaPicker,onSendFlowComplete:n,onBackPressed:d.close}));o.default.showModal(c,l,t)}static _sendFlowComplete(e){return()=>{e(),d.close()}}}t.default=d,d.close=()=>(o.default.dismissModal(l,n.MainRootViewId),!0)},15354:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(74958),o=s(20283),n=s(16778),r=s(72675),a=s(51885),l=s(46096),d=s(36237);class c extends a.CaptureOverlayView{constructor(){super(...arguments),this._onRenderTime=e=>{d.log(l.LogTraceArea.Capture,"CaptureFilterOverlayView._onRenderTime "+e),d.track(new r.ColorFilterRenderDurationEvent(e))},this._onFailure=e=>{d.log(l.LogTraceArea.Capture,"CaptureFilterOverlayView._onFailure "+i.pii.Omit(e)),d.track(new r.ColorFilterFailureEvent(e))}}_renderContent(){if(!this.props.captureOverlayType)return;const e=this.props.captureOverlayType.parameters;return n.createElement(o.default,{source:this.props.sourceImageUri,filter:e.filterName,filterDimension:64,style:this._imageStyle(),onFailure:this._onFailure,onRenderTime:this._onRenderTime})}_imageStyle(){return n.Styles.createViewStyle({position:"absolute",top:this.props.topOffset?Math.min(0,this.props.topOffset):0,left:0,right:0,bottom:0},!1)}}t.default=c},81547:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureMarkupColorControl=void 0;const i=s(96486),o=s(16426),n=s(16778),r=s(88837),a=s(75080),l=s(15877),d=s(33754),c=s(86045),h=s(81760),u=s(40363),p=s(53374),g=[{id:"White",value:h.Color.white,stringKey:"Color.White"},{id:"Black",value:h.Color.black,stringKey:"Color.Black"},{id:"Red",value:h.Color.markupRed,stringKey:"Color.Red"},{id:"Redorange",value:h.Color.markupRedOrange,stringKey:"Color.Redorange"},{id:"Orange",value:h.Color.markupOrange,stringKey:"Color.Orange"},{id:"Yelloworange",value:h.Color.markupYellowOrange,stringKey:"Color.Yelloworange"},{id:"Yellow",value:h.Color.markupYellow,stringKey:"Color.Yellow"},{id:"Yellowgreen",value:h.Color.markupYellowGreen,stringKey:"Color.Yellowgreen"},{id:"Green",value:h.Color.markupGreen,stringKey:"Color.Green"},{id:"Bluegreen",value:h.Color.markupBlueGreen,stringKey:"Color.Bluegreen"},{id:"Blue",value:h.Color.markupBlue,stringKey:"Color.Blue"},{id:"Blueviolet",value:h.Color.markupBlueViolet,stringKey:"Color.Blueviolet"},{id:"Violet",value:h.Color.markupViolet,stringKey:"Color.Violet"},{id:"Redviolet",value:h.Color.markupRedViolet,stringKey:"Color.Redviolet"}],m=8.5,S=i.map(g,(e=>a.colorStringToRgb(e.value))),f=(0,l.lazyProperties)({innerContainer:()=>n.Styles.createViewStyle({flex:1,alignItems:"flex-start",backgroundColor:h.Color.transparent,overflow:"visible"}),gestureView:()=>n.Styles.createViewStyle({position:"absolute",top:0,left:0,bottom:0,right:0,backgroundColor:h.Color.transparent}),topBorderStyle:()=>n.Styles.createViewStyle({borderTopRightRadius:4,borderTopLeftRadius:4}),bottomBorderStyle:()=>n.Styles.createViewStyle({borderBottomRightRadius:4,borderBottomLeftRadius:4}),strokePreviewSwatchBeakStyle:()=>n.Styles.createViewStyle({position:"absolute",top:8,right:-11.5,backgroundColor:h.Color.transparent})});class y extends r.ComponentBase{constructor(){super(...arguments),this._strokePreviewAnimatedTopValue=new n.Animated.Value(0),this._strokePreviewAnimatedStyle=n.Styles.createAnimatedViewStyle({top:this._strokePreviewAnimatedTopValue}),this._onLayoutChange=e=>{this.setState({viewDimensions:{width:e.width,height:e.height}})},this._onTap=e=>{const t=this._getColorAtPosition(e.pageY);this._updateColor(t.color,0===t.index)},this._onPan=e=>{const t=e.pageY-this.props.gestureRect.y;if((t<0||t>this.state.viewDimensions.height)&&!e.isComplete)return;const s=this._getColorAtPosition(e.pageY);if(this.props.colorOnly)this._updateColor(s.color,s.index<=0),this._updateStrokePreview(!e.isComplete,t-19.5);else{const i=this._getStrokeWidthAtPosition(e.pageX-this.props.gestureRect.x);this._updateColorAndStroke(s.color,s.index<=0,i),this._updateStrokePreview(!e.isComplete,t-i/2)}}}_buildState(e,t){let s={};return t&&(s.viewDimensions={width:0,height:0},s.showStrokePreview=!1,s.selectedColor=g[0],s.strokeWidth=5),s}_updateColor(e,t){this._announceForAccessibilityIfNeeded(e),e!==this.state.selectedColor&&(this.props.onColorSelected(e,t),this.setState({selectedColor:e}))}_updateColorAndStroke(e,t,s){this._announceForAccessibilityIfNeeded(e),e===this.state.selectedColor&&s===this.state.strokeWidth||(this.props.onColorSelected(e,t,s),this.setState({selectedColor:e,strokeWidth:s}))}_announceForAccessibilityIfNeeded(e){if(c.default.shouldAnnounceForAccessibility()&&this.state.selectedColor.id!==e.id){const t=d.getString(e.stringKey),s=d.getString("CapturePreview.PenColorChange",{color:t});n.Accessibility.announceForAccessibility(s)}}_renderColorPicker(){const e=i.map(g,((e,t)=>{const s=d.getString("CapturePreview.PenColorChange",{color:d.getString(e.stringKey)});return n.createElement(n.Button,{key:e.value,importantForAccessibility:n.Types.ImportantForAccessibility.Yes,accessibilityLabel:s,style:[this._getColorStyle(e.value),0===t?f.topBorderStyle:void 0,t===g.length-1?f.bottomBorderStyle:void 0]})}));return n.createElement(n.View,{onLayout:this._onLayoutChange,style:f.innerContainer},e,n.createElement(n.GestureView,{style:f.gestureView,onPan:this._onPan,onTap:this._onTap,importantForAccessibility:n.Types.ImportantForAccessibility.No}))}_getColorStyle(e){return n.Styles.createViewStyle({flex:1,width:16,marginLeft:4,marginVertical:-1,backgroundColor:e},!1)}_getColorAtPosition(e){const t=e-this.props.gestureRect.y,s=this.state.viewDimensions.height/S.length;let o=Math.floor(t/s);o<0&&(o=0),o>=S.length&&(o=S.length-1);let n=(t-o*s)/s;n=i.clamp(n,0,1);let r,l=S[o],d=l;return n<.5?(d=0===o?l:S[o-1],r=a.colorBetween(d,l,n+.5)):n>=.5&&(d=o>=S.length-1?l:S[o+1],r=a.colorBetween(l,d,n-.5)),{color:{id:g[o].id,value:r?a.rgbToHex(r):h.Color.white,stringKey:g[o].stringKey},index:o}}_getStrokeWidthAtPosition(e){const t=u.default.isRTL();return p.default.mapValue(e/this.props.gestureRect.width,t?5:40,t?40:5)}_getStrokePreviewStyle(){const e=[];return e.push(n.Styles.createViewStyle({position:"absolute",overflow:"visible",width:39,height:39,borderWidth:3,borderRadius:8,borderColor:h.Color.white,left:-65,backgroundColor:this.state.selectedColor.value},!1)),e.push(this._strokePreviewAnimatedStyle),e}_updateStrokePreview(e,t){this.state.showStrokePreview!==e&&this.setState({showStrokePreview:e}),e&&this._strokePreviewAnimatedTopValue.setValue(t)}render(){const e=this.state.showStrokePreview?n.createElement(n.Animated.View,{style:this._getStrokePreviewStyle()},n.createElement(o.ImageSvg,{viewBox:"0 0 8.5 17",width:m,height:17,style:f.strokePreviewSwatchBeakStyle},n.createElement(o.SvgPath,{d:"M 0 0 L 8.5 8.5 L 0 17 L 0 0",fillColor:h.Color.white}))):void 0;return n.createElement(n.View,{style:this.props.style},this._renderColorPicker(),e)}}t.CaptureMarkupColorControl=y},11208:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(88837),r=s(89391),a=s(46096),l=s(36237),d=s(15877),c=s(33754),h=s(58962),u=s(4057),p=s(81760),g=s(40363),m=s(75865),S=10,f=(0,d.lazyProperties)({container:()=>o.Styles.createViewStyle({position:"absolute",overflow:"visible",backgroundColor:p.Color.transparent}),innerContainer:()=>o.Styles.createViewStyle({flex:1,padding:S,alignItems:"center",justifyContent:"center",overflow:"visible",backgroundColor:p.Color.transparent}),imageViewContainer:()=>o.Styles.createViewStyle({height:80,width:80,overflow:"visible",backgroundColor:p.Color.transparent}),imageViewInner:()=>o.Styles.createViewStyle({position:"absolute",top:-10,left:-10,height:100,width:100,overflow:"visible"}),gestureView:()=>o.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,backgroundColor:p.Color.transparent})});class y extends n.ComponentBase{constructor(){super(...arguments),this._currentBottomValue=0,this._currentLeftValue=0,this._currentRotation=0,this._currentScale=1.7,this._animatedBottomValue=new o.Animated.Value(0),this._animatedLeftValue=new o.Animated.Value(0),this._animatedOpacityValue=new o.Animated.Value(1),this._baseAnimatedStyle=o.Styles.createAnimatedViewStyle({bottom:this._animatedBottomValue,opacity:this._animatedOpacityValue}),this._animatedStyleLTR=o.Styles.createAnimatedViewStyle({left:this._animatedLeftValue}),this._animatedStyleRTL=o.Styles.createAnimatedViewStyle({right:this._animatedLeftValue}),this._animatedRotationValue=new o.Animated.Value(0),this._animatedRotationStyle=o.Styles.createAnimatedViewStyle({transform:[{rotate:this._animatedRotationValue.interpolate({inputRange:[0,360],outputRange:["0deg","360deg"]})}]}),this._animatedScaleValue=new o.Animated.Value(1.7),this._animatedScaleStyle=o.Styles.createAnimatedViewStyle({transform:[{scale:this._animatedScaleValue}]}),this._onRotate=e=>{const t=e.angle-e.initialAngle;this._animatedRotationValue.setValue(this._currentRotation+t),e.isComplete&&(this._currentRotation+=t)},this._onPinchZoom=e=>{const t=e.distance/e.initialDistance,s=e.centerPageY-e.initialCenterPageY,o=e.centerPageX-e.initialCenterPageX,n={x:e.centerPageX,y:e.centerPageY};i.isUndefined(this._prePinchZoomScale)&&(this._prePinchZoomScale=this._currentScale);let r=this._prePinchZoomScale*t;r=Math.min(5.5,r),r=Math.max(.7,r),this._animatedBottomValue.setValue(this._currentBottomValue-s),this._animatedLeftValue.setValue(this._currentLeftValue+o),this._animatedScaleValue.setValue(r),this._currentScale=r,e.isComplete&&(this._prePinchZoomScale=void 0,this._currentBottomValue-=s,this._currentLeftValue+=o),this._onDrag(n,e.isComplete)},this._onPan=e=>{const t=e.pageY-e.initialPageY,s=e.pageX-e.initialPageX,i={x:e.pageX,y:e.pageY};this._animatedBottomValue.setValue(this._currentBottomValue-t),this._animatedLeftValue.setValue(this._currentLeftValue+s),e.isComplete&&(this._currentBottomValue-=t,this._currentLeftValue+=s),this._onDrag(i,e.isComplete)},this._onPanAvatar=e=>{let t=e.pageY-e.initialPageY,s=e.pageX-e.initialPageX;const i=this.props.sticker&&this.props.sticker.width?this.props.sticker.width:0,o=this.props.sticker&&this.props.sticker.height?this.props.sticker.height:0,n=this.props.sticker&&this.props.sticker.avatarSquareSize?this.props.sticker.avatarSquareSize:0;let r=this._currentLeftValue+s+S,a=this._currentLeftValue+s+S-n+i,l=this._currentBottomValue-t+S,d=this._currentBottomValue-t+S-n+o;r>=0&&s>=0?(this._animatedLeftValue.setValue(-10),this._currentLeftValue=-10,s=0):a<=0&&s<=0&&(this._animatedLeftValue.setValue(n-i-S),this._currentLeftValue=n-i-S,s=0),l>=0&&t<=0?(this._animatedBottomValue.setValue(-10),this._currentBottomValue=-10,t=0):d<=0&&t>=0&&(this._animatedBottomValue.setValue(n-o-S),this._currentBottomValue=n-o-S,t=0),this._animatedBottomValue.setValue(this._currentBottomValue-t),this._animatedLeftValue.setValue(this._currentLeftValue+s),e.isComplete&&(this._currentBottomValue-=t,this._currentLeftValue+=s)},this._onDoubleTap=e=>{this._removeSticker()},this._onImageLoaded=()=>{l.log(a.LogTraceArea.Capture,"CaptureMarkupSticker load success: "+this.props.stickerKey)},this._onImageError=e=>{l.log(a.LogTraceArea.Capture,"CaptureMarkupSticker load error: "+this.props.stickerKey+": "+u.default.errorAsString(e))}}_buildState(e,t){const{rewriteRules:s}=r.default.getConfigSettings().pes;let i=e.sticker?e.sticker.fullUrl:void 0;if(!i&&e.sticker&&e.sticker.baseUrl){const t=`${h.rewriteUrl(e.sticker.baseUrl,s)}/views/large?etag=${e.sticker.etag?e.sticker.etag:"v1"}`;i=m.default.getAuthenticatedUrl(t)}return{stickerUrl:i}}componentDidMount(){super.componentDidMount();const e=this.props.sticker&&this.props.sticker.width?this.props.sticker.width:h.frameHeights.emoticons.Size80,t=this.props.sticker&&this.props.sticker.height?this.props.sticker.height:h.frameHeights.emoticons.Size80,s=(this.props.gestureRect.width-e)/2-S,i=(this.props.gestureRect.height-t)/2-S;this._currentBottomValue=i,this._currentLeftValue=s,this._animatedBottomValue.setValue(i),this._animatedLeftValue.setValue(s),this.props.sticker&&(this.props.sticker.width||this.props.sticker.height)&&(this._currentScale=1,this._animatedScaleValue.setValue(this._currentScale))}_removeSticker(){this.props.onRemove&&this.props.onRemove(this.props.viewKey)}_onDrag(e,t=!1){if(this.props.onDragView){let s=1;this.props.onDragView(!t,e)&&(t?this._removeSticker():s=.5),this._animatedOpacityValue.setValue(s)}}render(){let e;this.props.allowsSelection&&(e=this.props.sticker&&this.props.sticker.isAvatar?o.createElement(o.GestureView,{style:f.gestureView,onPan:this._onPanAvatar,releaseOnRequest:!1,accessibilityLabel:c.getString("CapturePreview.ImageTitle")}):o.createElement(o.GestureView,{style:f.gestureView,onPan:this._onPan,onPinchZoom:this._onPinchZoom,onRotate:this._onRotate,onDoubleTap:this._onDoubleTap,releaseOnRequest:!1}));const t=[f.container,this._baseAnimatedStyle,this._animatedScaleStyle,g.default.isRTL()?this._animatedStyleRTL:this._animatedStyleLTR],s=this.props.sticker&&(this.props.sticker.height||this.props.sticker.width)?o.Styles.createViewStyle({height:this.props.sticker.height,width:this.props.sticker.width,top:0,left:0},!1):void 0,i=[f.imageViewContainer],n=[f.imageViewInner];s&&(i.push(s),n.push(s));const r=this.state.stickerUrl?o.createElement(o.View,{style:i,blockPointerEvents:!0},o.createElement(o.Image,{style:n,source:this.state.stickerUrl,onError:this._onImageError,onLoad:this._onImageLoaded})):void 0;return o.createElement(o.Animated.View,{style:t,blockPointerEvents:!this.props.allowsSelection},o.createElement(o.Animated.View,{style:[f.innerContainer,this._animatedRotationStyle]},r,e))}}t.default=y},39225:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(48404),n=s(16778),r=s(11930),a=s(98278),l=s(77381),d=s(46096),c=s(10117),h=s(36237),u=s(15877),p=s(33754),g=s(6250),m=s(96168),S=s(17707),f=s(75821),y=s(31234),_=s(51070),v=s(81115),C=s(22538),b=s(2544),T=s(13130),M=s(15415),I=s(81760),w=s(40363),P=s(11828),k=s(80837),A=s(19675),E=s(53374),R=s(73877);o.PesListView;o.PesTabView;const L=o.PesTabView,F=o.PesListView,x=(0,u.lazyProperties)({paddingStyle:()=>n.Styles.createViewStyle({paddingHorizontal:5}),pesScrollContainerBase:()=>n.Styles.createViewStyle({backgroundColor:I.Color.blackOverlay70,alignSelf:"stretch"}),pesScrollContainerMobile:()=>n.Styles.createViewStyle({flex:1,backgroundColor:I.Color.transparent}),sectionTitle:()=>n.Styles.createViewStyle({alignSelf:"stretch",backgroundColor:I.Color.transparent,marginBottom:4}),sectionTitleText:()=>n.Styles.createTextStyle({color:I.Color.white,margin:4}),centeredContainer:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch",backgroundColor:I.Color.transparent,alignItems:"center",justifyContent:"center",position:"absolute",top:0,bottom:0,left:0,right:0}),errorIconContainer:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center",paddingBottom:30}),errorTextStyle:()=>n.Styles.createTextStyle({color:I.Color.white,textAlign:"center"}),messageContainer:()=>n.Styles.createViewStyle({flex:1,justifyContent:"center",alignItems:"center"}),messageText:()=>n.Styles.createTextStyle({color:I.Color.white,textAlign:"center",marginHorizontal:40}),container:()=>n.Styles.createViewStyle({backgroundColor:I.Color.blackOverlay50}),flippedView:()=>n.Styles.createViewStyle({transform:[{scaleX:-1}]})});class O extends l.default{constructor(){super(...arguments),this._headerRefsMap=new g.default,this._cachedDimensions={},this._setTabViewRef=e=>{this._tabView=e||void 0},this._setTabIndicatorRef=e=>{this._tabIndicator=e||void 0},this._renderTabContent=e=>{const t=this._reverseLayout();if(e.id===y.default.recentTabId&&0===e.packs.length){const e=[x.messageContainer];return t&&e.push(x.flippedView),n.createElement(n.View,{style:e},n.createElement(n.Text,{style:x.messageText},this._getEmptyRecentMessage()))}const s=[x.pesScrollContainerBase,x.pesScrollContainerMobile,x.paddingStyle],o=k.default.flexOne;t&&s.push(x.flippedView),v.default.hasHorizontalSafeAreas(this.state.safeAreaHorizontalInsets)&&s.push(v.default.horizontalPaddingStyle(this.state.safeAreaHorizontalInsets));let r={};i.each(e.packs,(e=>(r[e.id]=i.filter(e.items,(e=>!!this.state.items[e])),r)));const a=this._getItemHeight(),l=this._getNumberOfColumns();return n.createElement(n.View,{style:s},n.createElement(F,{packs:r,renderPackHeader:this._renderPackHeader,renderPackItem:this._renderPesItem,style:o,itemHeight:a,numberOfColumns:l}))},this._renderPackHeader=e=>{const t=this.state.packs[e],s=r.default.headerAccessibilityInfo(t.title);return n.createElement(n.View,{key:"sectionTitle",ref:this._headerRefsMap.onComponentRef(e),style:x.sectionTitle,accessibilityTraits:s.accessibilityTraits,accessibilityLabel:s.accessibilityLabel,importantForAccessibility:n.Types.ImportantForAccessibility.Yes},n.createElement(A.Subtitle,{style:x.sectionTitleText,numberOfLines:1},t.title))},this._renderPesItem=e=>{const t=this.state.items[e];if(!t)return h.warn(d.LogTraceArea.Pes,`Sticker with id ${e} not found`),null;const s=this._getItemDimension(),i=!!this.state.hoverItem&&this.state.hoverItem.id===t.id;return n.createElement(b.StickerItem,{key:t.id,id:t.id,info:t,isSelected:i,renderMobileInterface:!0,onHover:this._onPesHover,onSelected:this._onSelected,dimension:s,showPlaceholder:!0,numberInGroupAccessibilityLabel:!0})},this._onSelected=e=>{this.props.onStickerSelected&&this.props.onStickerSelected(e,{tabTitle:this._currentTabTitle,stickerName:e.name}),this.props.onClose&&this.props.onClose()},this._onPesHover=e=>{this.setState({hoverItem:e})},this._onTabSelected=e=>{this._currentTabTitle=e.title;const t=i.findIndex(this.state.tabs,(t=>t.id===e.id));this._tabView&&this._tabView.showTab(this.state.tabs[t]),this._tabIndicator&&this._tabIndicator.onPageSelected({position:t});const s=e.packs.length>0?e.packs[0].id:void 0;s&&i.defer((()=>{if(!this.isComponentMounted())return;const e=this._headerRefsMap.ref(s);e&&e.requestFocus()}))}}_buildState(e,t){let s=m.default.getCaptureStickerTabs();const o=m.default.getLoadingStatus();s.unshift(y.default.getRecentStickerInCaptureTabInfo()),this._reverseLayout()&&i.reverse(s);const n={},r={};i.each(s,(e=>{i.each(e.packs,(e=>{n[e.id]=e,i.each(e.items,(e=>{const t=this._getPesItem(e);t&&(i.isUndefined(t.visible)||t.visible)&&(r[t.id]=t)}))}))}));const l=_.default.horizontalInsets(a.HorizontalInsetDefault),d=R.default.measureWindow(this._getRootViewId()).width-l.left-l.right-16;return{tabs:s,packs:n,items:r,loadingStatus:o,safeAreaHorizontalInsets:l,bottomSafeAreaInset:_.default.bottomSafeAreaInset(a.BottomInsetDefault),availableWidth:d}}componentDidMount(){super.componentDidMount();const e=E.default.newCauseId();this.state.loadingStatus===m.PesConfigLoadingStatus.NotStarted?C.EnsureStarted(S.default).then((()=>S.default.refreshConfig(e))):this.state.loadingStatus===m.PesConfigLoadingStatus.Loading&&S.default.refreshConfig(e)}render(){const e=[x.container,this.props.style];if(i.isEmpty(this.state.tabs)){let t;return this.state.loadingStatus===m.PesConfigLoadingStatus.Loading?(e.push(x.centeredContainer),t=n.createElement(M.default,{size:a.SXActivityIndicatorSize.Large,tintColor:I.Color.white,useRXIndicator:!0})):t=this._getPickerErrorScreen(),n.createElement(n.View,{style:e},t)}const t=this._reverseLayout(),s=[];return this.state.safeAreaHorizontalPaddingStyle&&s.push(this.state.safeAreaHorizontalPaddingStyle),this.state.bottomSafeAreaInset&&s.push(v.default.paddingBottomStyle(this.state.bottomSafeAreaInset)),n.createElement(n.View,{key:"PesPickerContainer",style:e},n.createElement(L,{style:t?x.flippedView:void 0,initialTab:this._getInitialTab(),ref:this._setTabViewRef,tabs:this.state.tabs,renderTab:this._renderTabContent,onTabSelected:this._onTabSelected,tabOrderReversed:t,removeHiddenItems:!1}),n.createElement(f.default,{style:s,transparentTheme:!0,initialTab:this._getInitialTab(),ref:this._setTabIndicatorRef,tabs:this.state.tabs,reversed:t,onTabSelected:this._onTabSelected}))}_reverseLayout(){return this._getContext().isRTL&&w.default.getPlatformType()===d.PlatformType.Android}_getItemDimension(){const e=this.state.availableWidth;if(this._cachedDimensions[e])return this._cachedDimensions[e];const t=Math.round(e/106),s=Math.max(3,t);return this._cachedDimensions[e]=Math.ceil(e/s)-1-6,this._cachedDimensions[e]}_getItemHeight(){return this._getItemDimension()}_getNumberOfColumns(){const e=this._getItemDimension();return Math.floor(this.state.availableWidth/e)}_getInitialTab(){if(this.state.tabs&&this.state.tabs.length>=2){const e=this.state.tabs[1];return this._currentTabTitle=e.title,e}}_getEmptyRecentMessage(){return p.getString("PesPicker.EmptyRecentStickers")}_getPickerErrorScreen(){const e=[x.centeredContainer];return e.push(x.paddingStyle),n.createElement(n.View,{style:e},n.createElement(n.View,{style:x.errorIconContainer},n.createElement(c.default,{icon:P.SkypeIcon.MojiDeleted,size:P.IconSize.size60,color:I.Color.white})),n.createElement(A.BodyText,{style:x.errorTextStyle},p.getString("MediaBar.StickerPickerErrorText")))}_getPesItem(e){return T.default.getSticker(e)}}t.default=O},28580:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(88837),r=s(39285),a=s(10400),l=s(15877),d=s(33754),c=s(81760),h=s(40363),u=s(11010),p=u.default.controlFontSize.h2,g=u.default.controlFontSize.captureMarkupText,m=(0,l.lazyProperties)({container:()=>o.Styles.createViewStyle({position:"absolute",flexDirection:"row",overflow:"visible"}),innerContainer:()=>o.Styles.createViewStyle({flex:1,overflow:"visible"}),gestureView:()=>o.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,backgroundColor:c.Color.transparent}),gestureViewIOSLarge:()=>o.Styles.createViewStyle({bottom:74}),textInputAbsolute:()=>o.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,flex:1,flexDirection:"row",overflow:"visible"}),textInputAndMirrorShared:()=>o.Styles.createTextInputStyle({paddingVertical:0,paddingHorizontal:0,font:u.default.font.uiDisplayRegular,fontSize:g,wordBreak:"break-word",color:c.Color.white,textAlign:"center",backgroundColor:c.Color.transparent,overflow:"visible"}),textInputAndMirrorSharedIOS:()=>o.Styles.createTextInputStyle({paddingVertical:4}),textInputAndMirrorSharedLarge:()=>o.Styles.createTextInputStyle({fontSize:p,font:u.default.font.uiDisplayBold}),textInput:()=>o.Styles.createTextInputStyle({position:"absolute",top:0,left:0,right:0,bottom:0,flexDirection:"row"}),mirrorText:()=>o.Styles.createTextInputStyle({paddingVertical:4,opacity:0}),mirrorTextIOS:()=>o.Styles.createTextInputStyle({paddingTop:4,marginTop:-14,paddingBottom:18}),compositionArea:()=>o.Styles.createViewStyle({flex:1,overflow:"visible"}),compositionAreaIOSLarge:()=>o.Styles.createViewStyle({paddingVertical:16,marginBottom:-74})});class S extends n.ComponentBase{constructor(){super(...arguments),this._backgroundDimensions={height:0,width:0},this._focusChanging=!1,this._currentBottomValue=0,this._currentLeftValue=0,this._currentScale=1,this._currentRotation=0,this._animatedBottomValue=new o.Animated.Value(0),this._animatedLeftValue=new o.Animated.Value(0),this._animatedOpacityValue=new o.Animated.Value(1),this._baseAnimatedStyle=o.Styles.createAnimatedViewStyle({bottom:this._animatedBottomValue,opacity:this._animatedOpacityValue}),this._animatedStyleLTR=o.Styles.createAnimatedViewStyle({left:this._animatedLeftValue}),this._animatedStyleRTL=o.Styles.createAnimatedViewStyle({right:this._animatedLeftValue}),this._animatedRotationValue=new o.Animated.Value(0),this._animatedRotationStyle=o.Styles.createAnimatedViewStyle({transform:[{rotate:this._animatedRotationValue.interpolate({inputRange:[0,360],outputRange:["0deg","360deg"]})}]}),this._animatedScaleValue=new o.Animated.Value(1),this._animatedScaleStyle=o.Styles.createAnimatedViewStyle({transform:[{scale:this._animatedScaleValue}]}),this._onFocus=e=>{this._focusChanging=!1,this.setState({hasFocus:!0})},this._onBlur=()=>{this._focusChanging=!1,this.setState({hasFocus:!1})},this._onInput=e=>{this.setState({text:e}),this.props.onTextInput&&this.props.onTextInput(e)},this._onRotate=e=>{const t=e.angle-e.initialAngle,s=this._selectedRotation||0;this._animatedRotationValue.setValue(s+t),e.isComplete&&(this._currentRotation+=t,this._selectedRotation=this._currentRotation)},this._onPinchZoom=e=>{const t=e.distance/e.initialDistance,s=e.centerPageY-e.initialCenterPageY,o=e.centerPageX-e.initialCenterPageX,n={x:e.centerPageX,y:e.centerPageY},r=this._currentBottomValue-s,a=this._currentLeftValue+o;this._animatedBottomValue.setValue(r),this._animatedLeftValue.setValue(a),i.isUndefined(this._prePinchZoomScale)&&(this._prePinchZoomScale=this._currentScale);const l=this._prePinchZoomScale||1;let d=Math.min(3,l*t);this._animatedScaleValue.setValue(d),this._currentScale=d,e.isComplete&&(this._currentBottomValue=r,this._currentLeftValue=a,this._selectedBottomValue=this._currentBottomValue,this._selectedLeftValue=this._currentLeftValue,this._selectedScale=this._currentScale,this._prePinchZoomScale=void 0),this._onDrag(n,e.isComplete)},this._onPan=e=>{const t=e.pageY-e.initialPageY,s=e.pageX-e.initialPageX,i={x:e.pageX,y:e.pageY},o=this._currentBottomValue-t,n=this._currentLeftValue+s;this._animatedBottomValue.setValue(o),this._animatedLeftValue.setValue(n),e.isComplete&&(this._currentBottomValue=o,this._currentLeftValue=n,this._selectedBottomValue=this._currentBottomValue,this._selectedLeftValue=this._currentLeftValue),this._onDrag(i,e.isComplete)},this._onTap=e=>{this.state.hasFocus||this.requestFocus()},this._onTextInputRef=e=>{this._textInput=e||void 0}}_buildState(e,t){let s={resizeMode:a.default.getResizeMode(),keyboardUpdateInfo:a.default.getUpdateInfo()};return t&&(s.hasFocus=!1,s.text="",s.selectedColor=void 0),s}UNSAFE_componentWillUpdate(e,t,s){if(super.UNSAFE_componentWillUpdate(e,t,s),this.props.onFocusChanged&&t.hasFocus!==this.state.hasFocus&&this.props.onFocusChanged(t.hasFocus),!this._focusChanging){let e,s,o,n;0!==t.keyboardUpdateInfo.height?(e=t.keyboardUpdateInfo.height+(this.props.bottomOffset||0),s=0,o=1,n=0):(e=i.isUndefined(this._selectedBottomValue)?this._currentBottomValue:this._selectedBottomValue,e=this._clampBottomValue(e),s=i.isUndefined(this._selectedLeftValue)?this._currentLeftValue:this._selectedLeftValue,o=i.isUndefined(this._selectedScale)?this._currentScale:this._selectedScale,n=i.isUndefined(this._selectedRotation)?this._currentRotation:this._selectedRotation),this._currentBottomValue=e,this._currentLeftValue=s,this._currentScale=o,this._currentRotation=n,this._animatedBottomValue.setValue(e),this._animatedLeftValue.setValue(s),this._animatedScaleValue.setValue(o),this._animatedRotationValue.setValue(n)}if(this.props.onHasText){const e=this._hasText(t);if(e!==this._hasText(this.state)||t.hasFocus!==this.state.hasFocus){const s=!e&&!t.hasFocus;this.props.onHasText(e,s)}}0===t.keyboardUpdateInfo.height&&this.state.keyboardUpdateInfo.height!==t.keyboardUpdateInfo.height&&this.blur()}requestFocus(){this._textInput&&!this.state.hasFocus&&(this._focusChanging=!0,this._textInput.requestFocus())}blur(){this._textInput&&this.state.hasFocus&&(this._focusChanging=!0,this._textInput.blur())}resetPosition(){this._selectedScale=void 0,this._selectedBottomValue=void 0,this._selectedLeftValue=void 0,this._selectedRotation=void 0}setColor(e){this.state.selectedColor!==e&&this.setState({selectedColor:e})}_hasText(e){return!(!e||!e.text)&&e.text.length>0}_onDrag(e,t=!1){if(this.props.onDragView){let s=1;if(this.props.onDragView(!t,e))t?(this.setState({text:void 0}),this.props.onHasText&&this.props.onHasText(!1,!0)):s=.5;else if(t){const e=this._clampBottomValue(this._currentBottomValue);e!==this._currentBottomValue&&(this._currentBottomValue=e,this._selectedBottomValue=this._currentBottomValue,o.Animated.timing(this._animatedBottomValue,{toValue:this._currentBottomValue,duration:150,easing:o.Animated.Easing.OutBack()}).start())}this._animatedOpacityValue.setValue(s)}}_clampBottomValue(e){const t=this.props.gestureRect.height-this._backgroundDimensions.height;return this._currentBottomValue<0?0:this._currentBottomValue>t?t:e}_colorStyle(){const e=this.state.selectedColor?this.state.selectedColor:c.Color.white;return o.Styles.createTextInputStyle({color:e},!1)}_widthStyle(){return o.Styles.createViewStyle({width:this.props.gestureRect.width,paddingHorizontal:(this.props.horizontalInset||0)+10},!1)}render(){let e=[m.textInputAndMirrorShared],t=[m.textInputAndMirrorShared];e.push(m.textInputAndMirrorSharedLarge,m.textInput,this._colorStyle()),t.push(m.textInputAndMirrorSharedLarge,m.mirrorText);const s=[m.gestureView],i=[m.compositionArea];const n=o.createElement(o.View,{style:m.textInputAbsolute,ignorePointerEvents:!0},o.createElement(o.TextInput,{accessibilityLabel:d.getString("CapturePreview.CaptionTextInputAccessibilityLabel"),ref:this._onTextInputRef,style:e,autoCorrect:!1,spellCheck:!1,value:this.state.text,multiline:!0,onChangeText:this._onInput,onFocus:this._onFocus,onBlur:this._onBlur,placeholder:"",keyboardAppearance:"dark",editable:this.props.allowsSelection,blurOnSubmit:!0,returnKeyType:"done",disableFullscreenUI:!0,maxLength:80,clearButtonMode:"never"})),a=o.createElement(o.Text,{key:"mirror"},this.state.text,"\n"),l=!this.state.hasFocus&&this.props.allowsSelection?o.createElement(o.GestureView,{style:s,onPan:this._onPan,onPinchZoom:this._onPinchZoom,onRotate:this._onRotate,onTap:this._onTap,releaseOnRequest:!1,importantForAccessibility:o.Types.ImportantForAccessibility.NoHideDescendants}):void 0,c=[m.container,this._widthStyle(),this._baseAnimatedStyle,this._animatedScaleStyle,h.default.isRTL()?this._animatedStyleRTL:this._animatedStyleLTR];return o.createElement(o.Animated.View,{style:c,ignorePointerEvents:this.props.allowsSelection,blockPointerEvents:!this.props.allowsSelection},o.createElement(o.Animated.View,{style:[m.innerContainer,this._animatedRotationStyle],ignorePointerEvents:!0},o.createElement(o.View,{style:i,ignorePointerEvents:!0},o.createElement(r.HiddenText,{style:t},a),n,l)))}}t.default=S},83666:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureMarkupView=t.CaptureMarkupMode=void 0;const i=s(96486),o=s(67451),n=s(58108),r=s(16778),a=s(97691),l=s(11208),d=s(28580),c=s(39003),h=s(62602),u=s(77381),p=s(46096),g=s(13944),m=s(36237),S=s(61253),f=s(10400),y=s(15877),_=s(33754),v=s(36150),C=s(4057),b=s(81760),T=s(11828),M=s(73877),I=(0,y.lazyProperties)({innerContainer:()=>r.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"center",overflow:"visible"}),gestureSurface:()=>r.Styles.createViewStyle({position:"absolute",top:0,left:0,backgroundColor:b.Color.transparent}),shimBase:()=>r.Styles.createViewStyle({position:"absolute",top:0,left:0}),shimBaseColor:()=>r.Styles.createViewStyle({backgroundColor:b.Color.blackOverlay70}),androidAdditionalShimBaseColor:()=>r.Styles.createViewStyle({backgroundColor:b.Color.black}),backgroundGestureView:()=>r.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:b.Color.transparent}),textShim:()=>r.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:b.Color.blackOverlay50}),avatarBackground:()=>r.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,backgroundColor:b.Color.white}),rnSurfaceStyle:()=>r.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:b.Color.transparent}),accessibilityButtonsContainer:()=>r.Styles.createViewStyle({alignSelf:"stretch",justifyContent:"center",position:"absolute",left:0,right:0,top:0,bottom:0}),nextButton:()=>r.Styles.createViewStyle({position:"absolute",right:0,paddingVertical:10,paddingRight:14,paddingLeft:0,backgroundColor:b.Color.blackOverlay50}),previousButton:()=>r.Styles.createViewStyle({position:"absolute",left:0,paddingVertical:10,paddingRight:0,paddingLeft:14,backgroundColor:b.Color.blackOverlay50})});var w;!function(e){e[e.None=0]="None",e[e.Ink=1]="Ink",e[e.Text=2]="Text",e[e.Stickers=3]="Stickers",e[e.Filters=4]="Filters"}(w=t.CaptureMarkupMode||(t.CaptureMarkupMode={}));class P extends u.default{constructor(){super(...arguments),this._stickerCount=0,this._selectedInkColor=b.Color.white,this._strokeWidth=5,this._controlsAnimatedOpacityValue=new r.Animated.Value(1),this._controlsAnimatedOpacityStyle=r.Styles.createAnimatedViewStyle({opacity:this._controlsAnimatedOpacityValue}),this._pathCount=0,this._isDrawing=!1,this._lift=!1,this._shouldRenderChildren=!1,this._gestureOffset={x:0,y:0},this._horizontalOffset=0,this._verticalOffset=0,this._stickerNames={},this._onCaptureMarkupPathRef=e=>{this._captureMarkupPath=e||void 0},this._onCaptureMarkupTextRef=e=>{this._captureMarkupText=e||void 0},this._onCaptureOverlayPagerRef=e=>{this._captureOverlayPager=e||void 0},this._onPan=e=>{if(this.props.markupMode===w.Ink){if(this._captureMarkupPath){const t=this._offsetPoint({x:e.pageX,y:e.pageY});this._captureMarkupPath.addPoint({x:t.x,y:t.y})}this._setIsDrawing(!0),e.isComplete&&this._onPathEnd(!0)}},this._onTap=e=>{switch(this.props.markupMode){case w.None:e.pageY>80&&this.props.onTextFocusChanged&&!this.state.isMobileScreenReaderEnabled&&this.props.onTextFocusChanged(!0);break;case w.Ink:if(this._captureMarkupPath){const t=this._offsetPoint({x:e.pageX,y:e.pageY});this._captureMarkupPath.addTap({x:t.x,y:t.y})}this._onPathEnd(!1);break;case w.Text:this._captureMarkupText&&this._captureMarkupText.blur()}},this._onRemoveSticker=e=>{delete this._stickerNames[e];let t=i.clone(this.state.stickers);t=i.remove(t,(t=>t.key!==e)),this.setState({stickers:t})},this._onContainerLayout=e=>{if(this.isComponentMounted()){const t=this._getSurfaceDimensions(e);h.default.measureLayoutRelativeToWindow((()=>this)).then((s=>{this._gestureOffset={x:s.x+(e.width-t.width)/2,y:s.y+(e.height-t.height)/2}}),(e=>{m.warn(p.LogTraceArea.Capture,"Capture markup component not measured: "+C.default.errorAsString(e))})),this._shouldRenderChildren=!0,this.setState({surfaceDimensions:t,viewDimensions:e,shouldRenderOverlays:!0})}},this._onHasText=e=>{if(this.state.hasText!==e){const t={};t.hasText=e,this.setState(t)}this.props.onHasText&&this.props.onHasText(e)},this._onAdvance=e=>{this._captureOverlayPager&&this._captureOverlayPager.onAdvance(e)},this._renderPath=(e,t,s,i)=>{const n=i>=this.state.pathRenderInfo.length-1-(e?1:0),a=i===this.state.pathRenderInfo.length-1;let l=o.CaptureMarkupPathRenderType.Dormant;return this._shouldRenderChildren?l=o.CaptureMarkupPathRenderType.All:n&&(l=o.CaptureMarkupPathRenderType.Current),r.createElement(o.CaptureMarkupPath,{key:s.key,id:s.key,style:I.rnSurfaceStyle,ref:a?this._onCaptureMarkupPathRef:void 0,renderType:l,surfaceDimensions:this.state.surfaceDimensions,initialColor:this._selectedInkColor,initialStrokeWidth:this._strokeWidth,levelsOfUndo:this.props.levelsOfUndo,onDraw:this.props.onHasMarkup,onCanUndo:this.props.onCanUndo})},this._optionalShimContainer=e=>{if(this.state.surfaceDimensions.width&&this.state.surfaceDimensions.height)return r.createElement(r.View,{style:this._shimsContainerStyle(),blockPointerEvents:!0},r.createElement(r.View,{style:[I.shimBase,e,this._leftShimStyle()]}),r.createElement(r.View,{style:this._middleShimContainerStyle()},r.createElement(r.View,{style:[I.shimBase,e,this._bottomShimStyle()]}),r.createElement(r.View,{style:[I.shimBase,e,this._topShimStyle()]})),r.createElement(r.View,{style:[I.shimBase,e,this._rightShimStyle()]}))}}_buildState(e,t){let s={resizeMode:f.default.getResizeMode(),keyboardUpdateInfo:f.default.getUpdateInfo(),isMobileScreenReaderEnabled:v.default.isMobileScreenReaderEnabled()};return t&&(s.viewDimensions={height:0,width:0},s.surfaceDimensions={height:0,width:0},s.pathRenderInfo=[],s.stickers=[],s.hasText=!1),s}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),f.default.setResizeMode(n.KeyboardAwareResizeMode.None)}componentWillUnmount(){super.componentWillUnmount(),f.default.setResizeMode(n.KeyboardAwareResizeMode.Default)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this._lift=!1,this._shouldRenderChildren=!1,this._captureMarkupText&&this.props.markupMode!==e.markupMode&&(this.props.markupMode===w.Text?this._captureMarkupText.requestFocus():e.markupMode===w.Text&&this._captureMarkupText.blur()),this.state.stickers.length!==t.stickers.length&&this.props.onHasStickers&&this.props.onHasStickers(this.state.stickers.length>0);const o=i.map(this.state.stickers,(e=>e.sticker?e.sticker.id:void 0)),n=i.map(t.stickers,(e=>e.sticker?e.sticker.id:void 0));(0,S.default)(o,n)||(this.props.stickerIds&&this.props.stickerIds(i.compact(o)),this.props.stickerNames&&this.props.stickerNames(i.compact(i.values(this._stickerNames)))),this.props.markupMode===w.Ink&&i.isEmpty(this.state.pathRenderInfo)&&this.setState({pathRenderInfo:[this._newPathRenderInfo()]})}prepareForSnapshot(){this._controlsAnimatedOpacityValue.setValue(0),this._captureOverlayPager&&this._captureOverlayPager.prepareForSnapshot();let e=a.Defer();return i.delay((()=>e.resolve(void 0)),100),e.promise()}restoreAfterSnapshot(){this._controlsAnimatedOpacityValue.setValue(1),this._captureOverlayPager&&this._captureOverlayPager.restoreAfterSnapshot()}selectColor(e){this.props.markupMode!==w.Ink&&this.props.markupMode!==w.Text||(this._selectedInkColor=e,this._captureMarkupPath&&this._captureMarkupPath.setColor(e),this.props.markupMode===w.Text&&this._captureMarkupText&&this._captureMarkupText.setColor(e))}setStrokeWidth(e){this._strokeWidth=e,this._captureMarkupPath&&this._captureMarkupPath.setStrokeWidth(e)}resetTextPosition(){this._captureMarkupText&&this._captureMarkupText.resetPosition()}addSticker(e,t,s){const o=this._stickerKey();s&&(this._stickerNames[o]=s);const n=i.clone(this.state.stickers);n.push({stickerKey:o,key:o,sticker:e,isLocalMedia:t}),this.setState({stickers:n})}undoDrawing(){this.setState({pathRenderInfo:[this._newPathRenderInfo()]}),this.props.onHasMarkup&&this.props.onHasMarkup(!1)}undoLast(){this._captureMarkupPath&&this._captureMarkupPath.undoLast()}_stickerKey(){return this._stickerCount++,"sticker"+this._stickerCount}_offsetPoint(e){return{x:e.x-this._gestureOffset.x,y:e.y-this._gestureOffset.y}}_getSurfaceDimensions(e){let t,s;if(this.props.mediaDimensions){const i=this.props.mediaDimensions;if(i.width>i.height){const o=i.height/i.width;t=e.width,s=o*t}else{const o=i.width/i.height;s=e.height,t=o*s}}else t=e.width,s=e.height;return{height:s,width:t}}_setIsDrawing(e){this._isDrawing!==e&&(r.Animated.timing(this._controlsAnimatedOpacityValue,{toValue:e?0:1,duration:300,delay:e?1e3:100,easing:r.Animated.Easing.Linear()}).start(),this.props.onDrawing&&this.props.onDrawing(e),this._isDrawing=e)}_onPathEnd(e){this._lift=e,e&&this._captureMarkupPath&&this._captureMarkupPath.flushPoints(),this._setIsDrawing(!1)}_surfaceContainerStyle(){return r.Styles.createViewStyle({width:this.state.surfaceDimensions.width,height:this.state.surfaceDimensions.height},!1)}_shimsContainerStyle(){const e=this._getRootViewId(),t=M.default.measureWindow(e);return r.Styles.createViewStyle({position:"absolute",top:-1*this._verticalOffset,left:-1*this._horizontalOffset,right:this.state.surfaceDimensions.width+this._horizontalOffset,bottom:this.state.surfaceDimensions.height+this._verticalOffset,height:t.height,width:t.width,flexDirection:"row"},!1)}_leftShimStyle(){const e=M.default.measureWindow(this._getRootViewId());return r.Styles.createViewStyle({top:0,left:0,height:e.height,width:this._horizontalOffset},!1)}_middleShimContainerStyle(){const e=M.default.measureWindow(this._getRootViewId());return r.Styles.createViewStyle({top:0,left:this._horizontalOffset,width:this.state.surfaceDimensions.width,height:e.height},!1)}_rightShimStyle(){const e=M.default.measureWindow(this._getRootViewId());return r.Styles.createViewStyle({top:0,left:this.state.surfaceDimensions.width+this._horizontalOffset,height:e.height,width:this._horizontalOffset},!1)}_bottomShimStyle(){return r.Styles.createViewStyle({top:this.state.surfaceDimensions.height+this._verticalOffset,left:0,width:this.state.surfaceDimensions.width,height:this._verticalOffset},!1)}_topShimStyle(){return r.Styles.createViewStyle({top:0,left:0,width:this.state.surfaceDimensions.width,height:this._verticalOffset},!1)}_pagerStyle(){return r.Styles.createViewStyle({bottom:this.props.offset?Math.max(0,-1*this.props.offset.y):0},!1)}_newPathRenderInfo(){return{key:"path"+this._pathCount++}}_renderStickers(e){const t=[],s=[];return i.each(this.state.stickers,(i=>{const o=this._renderSticker(i,e);i.isLocalMedia?t.push(o):s.push(o)})),{localMediaStickers:t,stickers:s}}_allowStickerSelection(){return this.props.markupMode!==w.Ink&&this.props.markupMode!==w.Text&&(this.props.markupMode!==w.Filters||this.props.effectsEnabled)}_renderSticker(e,t){const s=this._allowStickerSelection();return r.createElement(l.default,{key:e.key,viewKey:e.key,stickerKey:e.stickerKey,sticker:e.sticker,gestureRect:t,allowsSelection:s,onRemove:this._onRemoveSticker,onDragView:this.props.onDragView})}render(){const e=this.state.surfaceDimensions,t=e.height>0&&e.width>0,s=t?r.createElement(r.View,{style:this._surfaceContainerStyle(),blockPointerEvents:!0},i.map(this.state.pathRenderInfo,i.partial(this._renderPath,this._lift,this._shouldRenderChildren))):void 0,o=t?r.createElement(r.GestureView,{style:[I.gestureSurface,this._surfaceContainerStyle()],onPan:this._onPan,onTap:this._onTap}):void 0,n=this.props.markupMode===w.Text||this.state.hasText,a={x:this.props.offset?this.props.offset.x:0,y:this.props.offset?this.props.offset.y:0,height:this.state.viewDimensions.height,width:this.state.viewDimensions.width},l=this.props.markupMode!==w.Ink&&(this.props.markupMode!==w.Filters||this.props.effectsEnabled),h=t&&n?r.createElement(d.default,{ref:this._onCaptureMarkupTextRef,gestureRect:a,allowsSelection:l,bottomOffset:this.props.offset?-1*this.props.offset.y:void 0,horizontalInset:this.props.offset?Math.max(0,-1*this.props.offset.x):0,onHasText:this._onHasText,onFocusChanged:this.props.onTextFocusChanged,onDragView:this.props.onDragView,onTextInput:this.props.onTextInput}):void 0,u=this.props.markupMode===w.Text?r.createElement(r.View,{style:I.textShim}):void 0,p=this.props.enableOverlays?r.createElement(c.default,{ref:this._onCaptureOverlayPagerRef,style:this._pagerStyle(),enabled:this.props.markupMode===w.Filters,mediaId:this.props.mediaId,fileSize:this.props.fileSize,localMediaObjectUri:this.props.localMediaObjectUri,localMediaIsVideo:this.props.localMediaIsVideo,mediaDimensions:this.props.mediaDimensions,offset:this.props.offset,hidePageControl:this.props.hidePageControl,onOverlaySelected:this.props.onOverlaySelected,onOverlayProgress:this.props.onOverlayProgress,onTap:this._onTap,onPagerUpdated:this.props.onPagerUpdated,advanceToFirstOverlay:this.props.advanceToFirstOverlay}):void 0;let m,S;if(0!==this.state.viewDimensions.height&&0!==this.state.viewDimensions.width){const e={x:0,y:0,height:this.state.viewDimensions.height,width:this.state.viewDimensions.width};m=this._renderStickers(e),S=this.props.isAvatarPreview?r.createElement(r.View,{style:[I.avatarBackground]}):void 0}const f=M.default.measureWindow(this._getRootViewId());this._horizontalOffset=(f.width-this.state.surfaceDimensions.width)/2,this._verticalOffset=(f.height-this.state.surfaceDimensions.height)/2;let y,v;return this.state.isMobileScreenReaderEnabled||(y=r.createElement(r.GestureView,{style:I.backgroundGestureView,releaseOnRequest:!1})),this.props.markupMode===w.Filters&&this.state.isMobileScreenReaderEnabled&&(v=r.createElement(r.Animated.View,{style:[I.accessibilityButtonsContainer,this._controlsAnimatedOpacityStyle],ignorePointerEvents:!0},r.createElement(g.default,{size:T.IconSize.size40,style:I.previousButton,onPress:()=>this._onAdvance(!1),color:b.Color.white,hoverColor:b.Color.whiteOverlay70,icon:T.SkypeIcon.NavigationBack,title:_.getString("CameraEffects.PreviousButtonTitle")}),r.createElement(g.default,{size:T.IconSize.size40,style:I.nextButton,onPress:()=>this._onAdvance(!0),color:b.Color.white,hoverColor:b.Color.whiteOverlay70,icon:T.SkypeIcon.NavigationForward,title:_.getString("CameraEffects.NextButtonTitle")}))),r.createElement(r.View,{style:this.props.style,onLayout:this._onContainerLayout},S,r.createElement(r.View,{style:I.innerContainer},y,m?m.localMediaStickers:void 0,this.state.shouldRenderOverlays?p:void 0,v,undefined,s,m?m.stickers:void 0,u,this.props.markupMode===w.Text?o:null,h,this.props.markupMode===w.Ink?o:null,this._optionalShimContainer(I.shimBaseColor)))}}t.CaptureMarkupView=P,t.default=P},67538:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(38933),o=s(98356),n=s(16778),r=s(88837),a=s(15877),l=s(81760),d=s(80837),c=(0,a.lazyProperties)({buttonContainer:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center",backgroundColor:l.Color.blackOverlay50}),buttonContainerSelected:()=>n.Styles.createViewStyle({backgroundColor:l.Color.blue,borderColor:l.Color.transparent}),absolutePosition:()=>n.Styles.createViewStyle({position:"absolute"}),mediaPickerThumbnail:()=>n.Styles.createViewStyle({width:35,height:35,borderWidth:1.5,borderColor:l.Color.white,borderRadius:8,alignSelf:"center"}),mediaPickerThumbnailImage:()=>n.Styles.createViewStyle({width:32,height:32,borderRadius:8}),recentAssetNotification:()=>n.Styles.createViewStyle({width:11,height:11,borderWidth:1.5,borderColor:l.Color.white,backgroundColor:l.Color.red,position:"absolute",top:9,right:9,borderRadius:6}),size:()=>n.Styles.createViewStyle({width:60,height:60,borderRadius:30,justifyContent:"center"})});class h extends r.ComponentBase{constructor(){super(...arguments),this._buttonAnimatedOpacityValue=new n.Animated.Value(1),this._buttonAnimatedScaleValue=new n.Animated.Value(1),this._buttonAnimatedStyle=n.Styles.createAnimatedViewStyle({opacity:this._buttonAnimatedOpacityValue,transform:[{scale:this._buttonAnimatedScaleValue}]}),this._rotationValue=new n.Animated.Value(0),this._rotationStyle=n.Styles.createAnimatedViewStyle({transform:[{rotate:this._rotationValue.interpolate({inputRange:[0,360],outputRange:["0deg","360deg"]})}]}),this._onPressIn=()=>{this._updateButton(!0)},this._onPressOut=()=>{this._updateButton(!1)}}componentDidMount(){super.componentDidMount(),this._buttonAnimatedOpacityValue.setValue(this._fullOpacity(this.props)),this.props.enableCameraPortraitLock&&this._rotationValue.setValue(this.props.rotate||0)}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),this.props.hidden===e.hidden&&this.props.disabled===e.disabled||this._buttonAnimatedOpacityValue.setValue(this._fullOpacity(e)),this.props.enableCameraPortraitLock&&this.props.rotate!==e.rotate&&o.timing.easeOut({value:this._rotationValue,toValue:e.rotate||0,useNativeDriver:!0}).start()}_fullOpacity(e){return e.hidden?0:e.disabled?.4:1}fadeInOrOut(e,t=0){const s=e?0:this._fullOpacity(this.props);this._internalUpdateButton(s,1,200,t)}_updateButton(e,t=0,s=!0){const i=this.props.hidden?0:e?.8:this._fullOpacity(this.props),o=e?.92:1;this._internalUpdateButton(i,o,350,t,s)}_internalUpdateButton(e,t,s,i=0,o=!0){o?n.Animated.parallel([n.Animated.timing(this._buttonAnimatedOpacityValue,{toValue:e,duration:s,delay:i,easing:n.Animated.Easing.InOut(),useNativeDriver:!0}),n.Animated.timing(this._buttonAnimatedScaleValue,{toValue:t,duration:s,delay:i,easing:n.Animated.Easing.OutBack(),useNativeDriver:!0})]).start():(this._buttonAnimatedOpacityValue.setValue(e),this._buttonAnimatedScaleValue.setValue(t))}render(){let e=[c.buttonContainer];this.props.selected&&e.push(c.buttonContainerSelected),e.push([c.size,this._buttonAnimatedStyle]),e.push(this.props.backgroundStyle);const t=this.props.backgroundColors?n.createElement(i.GradientView,{style:[c.absolutePosition,c.size],colors:this.props.backgroundColors,direction:i.GradientDirection.BOTTOM_RIGHT}):void 0;let s;e.push(this.props.style),this.props.showRecentAssetNotification&&(s=n.createElement(n.View,{key:"recentAssetNotification",style:c.recentAssetNotification}));let o=[c.mediaPickerThumbnailImage];return n.createElement(n.Animated.View,{style:e},t,n.createElement(n.Button,{style:[d.default.absoluteFill,c.size],onPress:this.props.disabled?this.props.onDisabledPress:this.props.onPress,onPressIn:!this.props.disabled||this.props.onDisabledPress?this._onPressIn:void 0,onPressOut:!this.props.disabled||this.props.onDisabledPress?this._onPressOut:void 0,disableTouchOpacityAnimation:!0,accessibilityLabel:this.props.accessibilityLabel,importantForAccessibility:this.props.importantForAccessibility},n.createElement(n.Animated.View,{style:[this.props.enableCameraPortraitLock?this._rotationStyle:void 0,c.size]},n.createElement(n.View,{style:c.mediaPickerThumbnail},n.createElement(n.Image,{key:"recentAssetThumbnail_"+this.props.recentAssetTimestamp,style:o,source:this.props.recentAssetThumbnailUrl,resizeMode:"cover"})),s)))}}t.default=h},23303:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(31844),n=s(16778),r=(s(44770),s(97691)),a=s(4736),l=s(96074),d=s(92681),c=s(69198),h=s(3056),u=s(98278),p=s(52262),g=s(46096),m=s(74313),S=s(53559),f=s(13944),y=s(10117),_=s(8681),v=s(36237),C=s(15877),b=s(33754),T=s(31772),M=s(6286),I=s(26594),w=s(45026),P=s(4735),k=s(29130),A=s(51070),E=s(81115),R=s(15963),L=s(49603),F=s(12187),x=s(81760),O=s(11828),D=s(34528),B=s(80837),V=s(24576),N=s(53374),U=70,H=(0,C.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,backgroundColor:x.Color.black,alignItems:"center"}),sendButton:()=>n.Styles.createButtonStyle({position:"absolute",bottom:92,right:10}),headerButton:()=>n.Styles.createButtonStyle({flexDirection:"row",alignSelf:"stretch",alignItems:"center",justifyContent:"center",height:O.IconSize.default,paddingHorizontal:8,backgroundColor:x.Color.transparent}),topControls:()=>n.Styles.createViewStyle({paddingTop:4,paddingHorizontal:10,flexDirection:"row",alignSelf:"stretch",justifyContent:"space-between",overflow:"visible",position:"absolute",left:0,right:0,top:0,height:64}),previewsContainerStyles:()=>n.Styles.createScrollViewStyle({backgroundColor:x.Color.blackOverlay70,paddingVertical:6}),previewsWrapper:()=>n.Styles.createViewStyle({position:"absolute",left:0,right:0,bottom:0}),previewsStyles:()=>n.Styles.createViewStyle({flexDirection:"row",marginHorizontal:6}),plusContainer:()=>n.Styles.createViewStyle({height:U,width:40,borderRadius:3,justifyContent:"center",alignItems:"center",backgroundColor:x.Color.whiteOverlay20}),playButtonWrapperBg:()=>n.Styles.createViewStyle({backgroundColor:x.Color.blackOverlay20,alignItems:"center",justifyContent:"center"}),playButtonWrapper:()=>n.Styles.createViewStyle({backgroundColor:x.Color.blackOverlay10,borderRadius:O.IconSize.size40/2,borderStyle:"solid",borderWidth:2,borderColor:x.Color.white,alignItems:"center",justifyContent:"center",width:O.IconSize.size40,height:O.IconSize.size40}),progressBarStyle:()=>n.Styles.createViewStyle({bottom:92,right:60,left:10,height:40,margin:0,padding:0}),imageContainerStyle:()=>n.Styles.createViewStyle({marginRight:6,borderRadius:3}),imageStyle:()=>n.Styles.createViewStyle({width:U,height:U,borderRadius:3,borderWidth:2,borderColor:x.Color.transparent,overflow:"visible"}),imageStyleSelected:()=>n.Styles.createViewStyle({borderColor:x.Color.blue}),previewSlide:()=>n.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"center"}),previewScrollContainerStyles:()=>n.Styles.createViewStyle({flexDirection:"row"}),topControlsShimContainer:()=>n.Styles.createImageStyle({position:"absolute",top:0,right:0,left:0,backgroundColor:x.Color.transparent,opacity:.8,height:64}),controlsShimInnerView:()=>n.Styles.createImageStyle({opacity:.9})});class z extends V.default{render(){const{preview:e}=this.props;return n.createElement(n.View,{style:this.props.containerStyle},e.localMediaIsVideo?n.createElement(T.default,{videoUrl:e.localMediaObjectUri,thumbnailUrl:e.localMediaThumbnailUri||"",style:this.props.style,progressBarStyle:H.progressBarStyle}):n.createElement(m.default,{origin:"CaptureMultiPreview",style:this.props.style,containerStyle:this.props.style,resizeMode:"contain",source:e.localMediaObjectUri}))}}class W extends V.default{render(){return n.createElement(n.View,{style:H.previewScrollContainerStyles},this.props.previews.map((e=>n.createElement(z,{key:e.localMediaObjectUri,preview:e,style:this.props.style,containerStyle:this.props.containerStyle}))))}}class j extends l.default{constructor(){super(...arguments),this._animatedPresentationOpacityValue=new n.Animated.Value(0),this._scrollingIndex=0,this._isSendingPreviews=!1,this._renderPreviewCarousel=()=>{let e=[H.container,B.default.absoluteFill];this.state.safeAreaInsets.top&&e.push(E.default.marginTopStyle(this.state.safeAreaInsets.top)),this.state.safeAreaInsets.bottom&&e.push(E.default.marginBottomStyle(this.state.safeAreaInsets.bottom)),(this.state.safeAreaInsets.left||this.state.safeAreaInsets.right)&&e.push(E.default.horizontalMarginStyle(this.state.safeAreaInsets));const t=this.state.conversationName?b.getString("CapturePreview.SendToAccessibilityLabel",{displayName:this.state.conversationName}):b.getString("CapturePreview.SendTitle");return n.createElement(n.View,{style:e},this.state.renderEmptyPreviews?void 0:this._renderPreview(),n.createElement(a.default,{title:b.getString("Global.SendButtonTitle"),style:H.sendButton,icon:O.SkypeIcon.Send,onPress:this._sendPreview,accessibilityLabel:t,size:a.ActionButtonSize.Small,backgroundColor:x.Color.blue,disabled:this._isSendingPreviews}),this._renderHeader(),this._renderThumbnailPreviews())},this._renderPreviewThumbnail=(e,t)=>{const s=[H.imageStyle],{currentPreviewIndex:i,previews:o}=this.state;i===t&&s.push(H.imageStyleSelected);const r=b.getString("Global.CountOfTotal",{count:t+1,total:o.length});return n.createElement(n.Button,{key:t,onPress:()=>this._setCurrentPreviewIndex(t,!0),accessibilityLabel:r},n.createElement(m.default,{origin:"CapturePreview",style:s,containerStyle:H.imageContainerStyle,source:e.localMediaObjectUri,resizeMode:"cover"}),e.localMediaIsVideo?this._renderPlayVideoIcon():void 0)},this._goBack=()=>this._onBackPressed(),this._getDimensions=()=>{const e=this.state.previews[this.state.currentPreviewIndex],t=e.width/this.state.viewRect.width,s=e.height/this.state.viewRect.height,i=Math.max(t,s),o=e.width/i,n=e.height/i;return{height:Math.ceil(n),width:Math.ceil(o)}},this._onBackPressed=()=>{const e=N.default.newCauseId();return v.log(g.LogTraceArea.Capture,"CaptureMultiPreview._onBackPressed, causeId: "+e),this.props.onReject(),!0},this._renderAddMoreButton=()=>n.createElement(n.Button,{style:H.plusContainer,onPress:this._onBackPressed,accessibilityLabel:b.getString("MediaBar.MediaPickerTitle")},n.createElement(y.default,{icon:O.SkypeIcon.Plus,size:O.IconSize.size16,color:x.Color.white})),this._onPreviewReject=()=>{this.isComponentMounted()&&this.setState({showCapturePreview:!1},(()=>this._scrollToItem(!0,!1)))},this._onMarkupComplete=(e,t,s,o)=>{if(!this.isComponentMounted())return;const n=this.props.mediaPreviews[this.state.currentPreviewIndex];let r=i.cloneDeep(this.state.previews);const a={localMediaObjectUri:e,height:o,width:s,fileSize:t,hasChanged:!0};r.splice(this.state.currentPreviewIndex,1,Object.assign(Object.assign({},n),a)),this.setState({previews:r,showCapturePreview:!1},(()=>this._scrollToItem(!0,!1)))},this._capturedContentHandler=new d.CapturedContentHandlerForMarkupOnly(this._onMarkupComplete),this._getFileForImage=e=>{const t=e.localMediaObjectUri,s=e.mediaSelection&&e.mediaSelection.fileName||"",{width:i,height:o,fileSize:n}=e;return _.default.downsizeImageIfNeeded(t,s,i,o,n)},this._sendPreview=()=>{const e=N.default.newCauseId();v.log(g.LogTraceArea.GenericUnsafe,"CaptureMultiPreview._sendPreview, causeId: "+e),this._isSendingPreviews||this.state.renderEmptyPreviews||(this._isSendingPreviews=!0,this._previewScrollRef?(this._previewHasUnmountedDeferred=r.Defer(),this.setState({renderEmptyPreviews:!0}),this._previewHasUnmountedDeferred.promise().then((()=>{this._sendPreviewInner(e)}))):this._sendPreviewInner(e))},this._onEditPress=()=>{this.setState({showCapturePreview:!0})},this._onPreviewScrollViewRef=e=>{if(this._previewScrollRef=e||void 0,!e&&this._previewHasUnmountedDeferred){const e=this._previewHasUnmountedDeferred;this._previewHasUnmountedDeferred=void 0,e.resolve(void 0)}},this._onThumbnailScrollViewRef=e=>{this._thumbnailScrollRef=e||void 0},this._onPreviewScrollViewScrollEnd=()=>{i.delay((()=>{this._setCurrentPreviewIndex(this._scrollingIndex,!1)}),300)},this._onPreviewScrollViewScroll=(e,t)=>{let s=Math.round(t/this.state.viewRect.width);const o=i.clamp(s,0,this.state.previews.length-1);this._scrollingIndex=o},this._onScrollViewLayout=e=>{this.setState({viewRect:e},(()=>{this._scrollToItem(!0,!1)}))},this._scrollToItem=(e,t=!0)=>{const{width:s}=this.state.viewRect;e&&this._previewScrollRef&&this._previewScrollRef.setScrollLeft(this._scrollingIndex*s,t),this._thumbnailScrollRef&&(76*this._scrollingIndex-35>s/2?this._thumbnailScrollRef.setScrollLeft(76*this._scrollingIndex-s/2+35,t):this._thumbnailScrollRef.setScrollLeft(0,t))},this._setCurrentPreviewIndex=(e,t)=>{this._scrollingIndex!==e&&(this._scrollingIndex=e),this.setState({currentPreviewIndex:e},(()=>this._scrollToItem(t)))}}_buildState(e,t){const s=this._getRootViewId(),i=A.default.statusBarHeight(),n=A.default.bottomSafeAreaInset(u.BottomInsetDefault),r=A.default.horizontalInsets(u.HorizontalInsetDefault),a=k.default.getWidth(s),l=k.default.getHeight(s);let d={isLandscape:k.default.getDeviceOrientation(s)===o.DeviceOrientation.Landscape,safeAreaInsets:Object.assign(Object.assign({},r),{top:i,bottom:n}),viewRect:t?{x:0,y:0,width:a,height:l}:this.state.viewRect};return t&&(d.renderEmptyPreviews=!1,d.previews=e.mediaPreviews,d.currentPreviewIndex=0,d.showCapturePreview=!1,d.conversationName=e.conversationId&&p.default.getDisplayName(e.conversationId)),d}componentDidMount(){super.componentDidMount();const e=F.default.mergeStyles([F.default.createBackgroundColorStyle(x.Color.black),F.default.createBarStyle(L.BarStyleTheme.Light)]),t=n.StatusBar.isOverlay()?F.default.mergeStyles([F.default.createHiddenStyle(!0),e]):e;this._updateStatusBarStyle(t),w.default.timing(this._animatedPresentationOpacityValue,{toValue:1,duration:100,easing:n.Animated.Easing.Out(),useNativeDriver:!0}).start()}handleBackAction(){return this._onBackPressed(),!0}render(){return n.createElement(h.default,{goBack:this._goBack},this.state.showCapturePreview?this._renderEditPreview():this._renderPreviewCarousel())}_renderPreview(){const e=this._getDimensions(),t=n.Styles.createViewStyle({width:this.state.viewRect.width,height:this.state.viewRect.height},!1),s=[H.previewSlide,t];return n.createElement(n.View,{style:[H.previewsWrapper,B.default.absoluteFill]},n.createElement(n.ScrollView,{ref:this._onPreviewScrollViewRef,onScroll:this._onPreviewScrollViewScroll,onScrollEndDrag:this._onPreviewScrollViewScrollEnd,onLayout:this._onScrollViewLayout,horizontal:!0,pagingEnabled:!0,scrollEventThrottle:16,style:H.previewsContainerStyles},n.createElement(W,{previews:this.state.previews,style:e,containerStyle:s})))}_renderPlayVideoIcon(){return n.createElement(n.View,{style:[B.default.absoluteFill,H.playButtonWrapperBg]},n.createElement(n.View,{style:H.playButtonWrapper},n.createElement(y.default,{icon:O.SkypeIcon.Play,size:O.IconSize.size16,color:x.Color.white})))}_renderEditPreview(){const e=this.state.previews[this.state.currentPreviewIndex];return n.createElement(c.default,{fileSize:e.fileSize,mediaWidth:e.width||0,mediaHeight:e.height||0,localMediaIsVideo:e.localMediaIsVideo,localMediaThumbnailUri:e.localMediaThumbnailUri,localMediaObjectUri:e.localMediaObjectUri,skipShareWithPanel:!0,performMarkupOnly:!0,capturedContentHandler:this._capturedContentHandler,callId:e.callId,mediaSelection:e.mediaSelection,unlockOrientation:!0,disableCoachmarks:!0,captureSessionTelemetry:e.captureSessionTelemetry,entryPoint:e.mediaSelection?g.PostSource.MediaPicker:g.PostSource.Capture,markupEnabled:!0,useCompactControls:!1,centerCompactControls:this.state.isLandscape,inlinePreview:!0,onReject:this._onPreviewReject,ignoreBottomSafeArea:!1,orientationLockKey:e.orientationLockKey,showSendButtonOnTop:!0,alwaysShowSaveButton:!0})}_renderHeader(){const e=this.state.previews[this.state.currentPreviewIndex],t=n.createElement(f.default,{title:b.getString("Global.CancelLabel"),style:H.headerButton,size:O.IconSize.size24,color:x.Color.white,hoverColor:x.Color.gray300,icon:D.backIcon(),showShadow:!0,onPress:this._onBackPressed,accessibilityLabel:b.getString("CapturePreview.BackAccessibilityLabel")}),s=e.localMediaIsVideo?n.Types.ImportantForAccessibility.Yes:n.Types.ImportantForAccessibility.No,i=e.localMediaIsVideo?b.getString("AvatarPickerDialog.EditPictureButtonTitle"):void 0,o=n.createElement(f.default,{style:H.headerButton,size:O.IconSize.size24,color:x.Color.white,hoverColor:x.Color.gray300,showShadow:!0,icon:O.SkypeIcon.Topic,onPress:this._onEditPress,accessibilityLabel:i,importantForAccessibility:s,disabled:e.localMediaIsVideo}),r=this._renderOptionalTopControlsShim();return n.createElement(n.View,{style:H.topControls,ignorePointerEvents:!0},r,t,o)}_renderOptionalTopControlsShim(){}_renderThumbnailPreviews(){return n.createElement(n.View,{style:H.previewsWrapper},n.createElement(n.ScrollView,{ref:this._onThumbnailScrollViewRef,horizontal:!0,style:H.previewsContainerStyles},n.createElement(n.View,{style:H.previewsStyles},this.state.previews.map(this._renderPreviewThumbnail),this.state.previews.length<10?this._renderAddMoreButton():void 0)))}_componentId(){return"CaptureMultiPreview"}_sendPreviewInner(e){v.log(g.LogTraceArea.GenericUnsafe,"CaptureMultiPreview._sendPreviewInner, causeId: "+e);const t=this.state.previews.map((t=>!t.hasChanged&&t.mediaSelection?r.Resolved({mediaSelection:t.mediaSelection,extension:S.default.extractFileExtension(t.mediaSelection.fileName||S.default.extractFileName(t.mediaSelection.node.node.image.uri)),scenario:{name:t.localMediaIsVideo?R.ScenarioName.SendVideo:R.ScenarioName.SendPicture},captureSessionTelemetry:t.captureSessionTelemetry,causeId:e}):this._getFileForImage(t)));r.all(t).then((e=>M.default.sendPreviewsWithData(this.props.conversationId,e,void 0))).then((()=>{const t=i.sumBy(this.state.previews,(e=>e.localMediaIsVideo?1:0)),s=this.state.previews.length;return v.track(new I.MediaPreviewTelemetryMobileEvent({imageCount:s-t,videoCount:t,totalCount:s})),v.log(g.LogTraceArea.GenericUnsafe,"CaptureMultiPreview._sendPreview, media sent, causeId: "+e),P.default.navigateToConversation({convId:this.props.conversationId,origin:g.NavigationConversationOrigin.MediaPicker,causeId:e})})).finally((()=>{this._isSendingPreviews=!1}))}}t.default=j},86817:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(38933),o=s(98356),n=s(16778),r=s(88837),a=s(13944),l=(s(10117),s(15877)),d=s(81760),c=s(11828),h=(0,l.lazyProperties)({buttonContainer:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center",backgroundColor:d.Color.blackOverlay50}),buttonContainerSelected:()=>n.Styles.createViewStyle({backgroundColor:d.Color.blue,borderColor:d.Color.transparent}),buttonInnerStyle:()=>n.Styles.createButtonStyle({flex:1,paddingHorizontal:8,backgroundColor:d.Color.transparent}),absolutePosition:()=>n.Styles.createViewStyle({position:"absolute"}),justifyCenter:()=>n.Styles.createViewStyle({justifyContent:"center"}),alignCenter:()=>n.Styles.createViewStyle({alignSelf:"center"})});class u extends r.ComponentBase{constructor(){super(...arguments),this._buttonAnimatedOpacityValue=new n.Animated.Value(1),this._buttonAnimatedOpacityStyle=n.Styles.createAnimatedViewStyle({opacity:this._buttonAnimatedOpacityValue}),this._buttonAnimatedScaleValue=new n.Animated.Value(1),this._buttonAnimatedScaleStyle=n.Styles.createAnimatedViewStyle({transform:[{scale:this._buttonAnimatedScaleValue}]}),this._rotationValue=new n.Animated.Value(0),this._rotationStyle=n.Styles.createAnimatedViewStyle({transform:[{rotate:this._rotationValue.interpolate({inputRange:[0,360],outputRange:["0deg","360deg"]})}]}),this._onPressIn=()=>{this._updateButton(!0)},this._onPressOut=()=>{this._updateButton(!1)}}componentDidMount(){super.componentDidMount(),this._buttonAnimatedOpacityValue.setValue(this._fullOpacity(this.props)),this._rotationValue.setValue(this.props.rotate||0)}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),this.props.hidden===e.hidden&&this.props.disabled===e.disabled||this._buttonAnimatedOpacityValue.setValue(this._fullOpacity(e)),this.props.rotate!==e.rotate&&o.timing.easeOut({value:this._rotationValue,toValue:e.rotate||0,useNativeDriver:!0}).start()}_fullOpacity(e){return e.hidden?0:e.disabled?.4:1}fadeInOrOut(e,t=0){const s=e?0:this._fullOpacity(this.props);this._internalUpdateButton(s,1,200,t)}_updateButton(e,t=0,s=!0){const i=this.props.hidden?0:e?.8:this._fullOpacity(this.props),o=e?.92:1;this._internalUpdateButton(i,o,350,t,s)}_internalUpdateButton(e,t,s,i=0,o=!0){o?n.Animated.parallel([n.Animated.timing(this._buttonAnimatedOpacityValue,{toValue:e,duration:s,delay:i,easing:n.Animated.Easing.InOut()}),n.Animated.timing(this._buttonAnimatedScaleValue,{toValue:t,duration:s,delay:i,easing:n.Animated.Easing.OutBack()})]).start():(this._buttonAnimatedOpacityValue.setValue(e),this._buttonAnimatedScaleValue.setValue(t))}_getSizeStyle(e){return n.Styles.createViewStyle({width:e,height:e,borderRadius:e/2},!1)}render(){const e=this.props.size||56,t=this._getSizeStyle(e);let s=[h.buttonContainer];this.props.selected&&s.push(h.buttonContainerSelected),s.push([t,this._buttonAnimatedOpacityStyle,this._buttonAnimatedScaleStyle]),s.push(this.props.backgroundStyle);const o=this.props.backgroundColors?n.createElement(i.GradientView,{style:[h.absolutePosition,t],colors:this.props.backgroundColors,direction:i.GradientDirection.BOTTOM_RIGHT}):void 0;return s.push(this.props.style),n.createElement(n.Animated.View,{style:s},n.createElement(n.Animated.View,{style:[this._rotationStyle,t]},o,n.createElement(a.default,{style:h.buttonInnerStyle,title:this.props.title,iconTextStyle:this.props.textStyle,onPress:this.props.disabled?this.props.onDisabledPress:this.props.onPress,onPressIn:!this.props.disabled||this.props.onDisabledPress?this._onPressIn:void 0,onPressOut:!this.props.disabled||this.props.onDisabledPress?this._onPressOut:void 0,size:c.IconSize.size24,color:this.props.iconColor||d.Color.white,hoverColor:this.props.iconColor||d.Color.white,icon:this.props.icon,disableTouchOpacityAnimation:!0,showShadow:this.props.showShadow,accessibilityLabel:this.props.accessibilityLabel,importantForAccessibility:this.props.importantForAccessibility})))}}t.default=u},16093:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureOverlayPageIndicator=void 0;const i=s(96486),o=s(16778),n=s(89391),r=s(77381),a=s(15877),l=s(45087),d=s(29130),c=(0,a.lazyProperties)({syncIndicatorImage:()=>o.Styles.createViewStyle({height:10,width:10,transform:[{scale:.9}]}),syncIndicator:()=>o.Styles.createViewStyle({height:10,width:10,transform:[{scale:.7}],opacity:.7,marginLeft:3}),innerViewStyle:()=>o.Styles.createViewStyle({flexDirection:"row"}),innerViewStyleRTL:()=>o.Styles.createViewStyle({flexDirection:"row-reverse"})});class h extends r.default{_buildState(e,t){const s=this._getRootViewId();let i={maxPageIndicators:d.default.isSmallDevice(s)?7:15,enableGifCaptureLoadingIndicator:n.default.getS4LCMCFeatures().enableGifCaptureLoadingIndicator||!n.default.getS4LUiFeatures().jsonAnimationEnabled};return t&&(i.currentPage=0,i.totalPages=0),i}update(e,t){this.setState({currentPage:e,totalPages:t})}render(){if(!this.state.totalPages||this.props.hidden)return null;const e=this._getContext().isRTL?this.state.totalPages-1:0,t=i.times(this.state.totalPages,(t=>({uid:"page"+t,minOpacity:.33,indicatorFillStyle:t===e?l.PageIndicatorFillStyle.Unfilled:l.PageIndicatorFillStyle.Filled}))),s=this._getContext().isRTL;return o.createElement(o.View,{style:this.props.style},o.createElement(o.View,{style:s?c.innerViewStyleRTL:c.innerViewStyle},o.createElement(l.default,{currentPage:this.state.currentPage,pages:t,reverseOrder:s,indicatorDotSize:9,indicatorMargin:5,maxIndicators:this.state.maxPageIndicators,blockPointerEvents:!0,minIndicatorScale:1})))}}t.CaptureOverlayPageIndicator=h,t.default=h},39003:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureOverlayPager=void 0;const i=s(96486),o=s(16778),n=s(88837),r=s(27028),a=s(15354),l=s(10666),d=s(51885),c=s(16184),h=s(46096),u=s(36237),p=s(61253),g=s(15877),m=s(81760),S=s(40363),f=s(80837),y=s(53374),_=(0,g.lazyProperties)({overlayContainer:()=>o.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,bottom:0,alignItems:"center",justifyContent:"flex-end"}),stageContainer:()=>o.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,bottom:0,overflow:"visible"}),gestureView:()=>f.default.absoluteFill,overlay:()=>o.Styles.createViewStyle({flex:1,backgroundColor:m.Color.transparent})});class v extends n.ComponentBase{constructor(){super(...arguments),this._sendProgressEvents=!1,this._stageContainerXOffsetValue=new o.Animated.Value(0),this._stageContainerXOffsetStyle=o.Styles.createAnimatedViewStyle({transform:[{translateX:this._stageContainerXOffsetValue}]}),this._onLayoutChanged=e=>{const t={height:e.height,width:e.width};this.setState({viewDimensions:t})},this._onStageLayoutChanged=e=>{if(this.props.onOverlayProgress&&this._sendProgressEvents){const t=this._getCurrentOverlayType();if(this.state.viewDimensions.width){const s=e.x/this.state.viewDimensions.width;this._updateProgress(t,s)}else this.props.onOverlayProgress({leftOverlay:t,rightOverlay:t,progress:0})}},this._onPanHorizontal=e=>{if(!this.props.enabled)return;const t=e.pageX-e.initialPageX,s=Math.abs(t);if(this._stageContainerXOffsetValue.setValue(t),e.isComplete){const i=Math.min(this.state.viewDimensions.width/2,300),n=Math.abs(e.velocityX)>.35,r=s>i/2;let a=!0;if(r&&!n)a=!this.onAdvance(t<0);else if(n&&!r)a=!this.onAdvance(e.velocityX<0,!0);else{const s=t<0;s===e.velocityX<0&&(a=!this.onAdvance(s,!0))}a&&o.Animated.parallel([o.Animated.timing(this._stageContainerXOffsetValue,{toValue:0,duration:250,easing:n?o.Animated.Easing.Out():o.Animated.Easing.InOut()})]).start()}else this._sendProgressEvents=!0},this.onAdvance=(e,t=!1)=>{const s=e?1:-1;if(!i.find(this.state.overlayViewInfos,(e=>e.visualIndex===s)))return!1;const n=this.state.viewDimensions.width;return o.Animated.parallel([o.Animated.timing(this._stageContainerXOffsetValue,{toValue:e?-n:n,duration:250,easing:t?o.Animated.Easing.Out():o.Animated.Easing.InOut()})]).start((()=>{if(this.isComponentMounted()){this._sendProgressEvents=!1;let t=[];const s=e?-1:1;if(i.each(this.state.overlayViewInfos,(e=>{e.visualIndex+=s,e.xOffsetValue.setValue(e.visualIndex*this.state.viewDimensions.width),e.visualIndex>=-1&&e.visualIndex<=1&&t.push(e)})),t=i.sortBy(t,(e=>e.visualIndex)),e){const e=i.last(t);if(e){const s=this._getNextOverlayType(e.type);s&&t.push(v._overlayInfo(s,e.visualIndex+1,this.state.viewDimensions.width))}}else{const e=i.head(t);if(e){const s=this._getPreviousOverlayType(e.type);s&&t.push(v._overlayInfo(s,e.visualIndex-1,this.state.viewDimensions.width))}}const o=this._getCurrentOverlayType(t);this._updateProgress(o,0),this._stageContainerXOffsetValue.setValue(0),this.setState({overlayViewInfos:t})}})),!0}}_buildState(e,t){let s={overlayTypes:(S.default.isRTL()?i.reverse:i.identity)(l.default.getOverlays(e.localMediaIsVideo))};return t&&(s.viewDimensions={height:0,width:0},s.overlayViewInfos=[],s.prepareForSnapshot=!1),s}componentDidMount(){super.componentDidMount(),this._currentOverlay=this._getCurrentOverlayType(),this.props.onPagerUpdated&&this.props.onPagerUpdated(this._currentPage(this.props,this.state),this.state.overlayTypes.length)}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),this.props.onPagerUpdated&&this.props.onPagerUpdated(this._currentPage(e,t),t.overlayTypes.length)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.viewDimensions!==t.viewDimensions&&i.each(this.state.overlayViewInfos,(e=>{e.xOffsetValue.setValue(e.visualIndex*this.state.viewDimensions.width)})),(!(0,p.default)(this.state.overlayTypes,t.overlayTypes)||0===this.state.overlayViewInfos.length&&this.state.overlayTypes.length>0)&&this._loadInitialOverlays(this._getCurrentOverlayType());const o=this._getCurrentOverlayType();o!==this._currentOverlay&&(this.props.onOverlaySelected&&this.props.onOverlaySelected(o),this._currentOverlay=o),!this.props.enabled&&e.enabled&&this._loadInitialOverlays()}prepareForSnapshot(){this.setState({prepareForSnapshot:!0})}restoreAfterSnapshot(){this.setState({prepareForSnapshot:!1})}_updateProgress(e,t){const s=t<0?e:this._getPreviousOverlayType(e),i=t>=0?e:this._getNextOverlayType(e);let o=t;o<0&&(o+=1),this.props.onOverlayProgress&&this.props.onOverlayProgress({leftOverlay:s,rightOverlay:i,progress:o})}_loadInitialOverlays(e){if(!this.isComponentMounted()||i.isEmpty(this.state.overlayTypes))return;let t=e||this.state.overlayTypes[0];if(-1===i.findIndex(this.state.overlayTypes,t)&&(t=this.state.overlayTypes[0]),this.props.advanceToFirstOverlay&&t.overlayType===r.OverlayType.None){const e=this._getNextOverlayType(t);e.overlayType!==r.OverlayType.None&&(t=e)}const s=[v._overlayInfo(t,0,this.state.viewDimensions.width)];let o=t,n=t;for(let e=1;e<=1;e++)o&&(o=this._getNextOverlayType(o),o&&s.push(v._overlayInfo(o,e,this.state.viewDimensions.width))),n&&(n=this._getPreviousOverlayType(n),n&&s.push(v._overlayInfo(n,-e,this.state.viewDimensions.width)));i.intersectionBy(this.state.overlayViewInfos,s,(e=>e.type.overlayType===r.OverlayType.None?e.type.overlayType:e.overlayId?e.overlayId:e.type.overlayType)).length!==s.length&&this.setState({overlayViewInfos:s})}_keyForOverlayType(e){if(e)switch(e.overlayType){case r.OverlayType.None:return"none";case r.OverlayType.Filter:return"filter_"+e.parameters.filterName}}_getCurrentOverlayType(e){const t=e||this.state.overlayViewInfos;let s=i.find(t,(e=>0===e.visualIndex));return s?s.type:{overlayType:r.OverlayType.None}}_getPreviousOverlayType(e){const t=this._keyForOverlayType(e),s=i.findIndex(this.state.overlayTypes,(e=>this._keyForOverlayType(e)===t)),o=s>0?s-1:this.state.overlayTypes.length-1;return this.state.overlayTypes[o]}_getNextOverlayType(e){const t=this._keyForOverlayType(e),s=i.findIndex(this.state.overlayTypes,(e=>this._keyForOverlayType(e)===t)),o=s<this.state.overlayTypes.length-1?s+1:0;return this.state.overlayTypes[o]}_renderOverlay(e){if(e.type)switch(e.type.overlayType){case r.OverlayType.None:return o.createElement(d.BasicCaptureOverlayView,{style:_.overlay,onPanHorizontal:this.props.enabled?this._onPanHorizontal:void 0,onTap:this.props.onTap,topOffset:this.props.offset?this.props.offset.y:0});case r.OverlayType.Filter:return o.createElement(a.default,{style:_.overlay,captureOverlayType:e.type,onPanHorizontal:this.props.enabled?this._onPanHorizontal:void 0,topOffset:this.props.offset?this.props.offset.y:0,mediaDimensions:this.props.mediaDimensions,sourceImageUri:this.props.localMediaObjectUri});default:return o.createElement(c.default,{style:_.overlay,onPanHorizontal:this.props.enabled?this._onPanHorizontal:void 0,topOffset:this.props.offset?this.props.offset.y:0})}else u.log(h.LogTraceArea.Capture,"CaptureOverlayPager: _renderOverlay with no type "+JSON.stringify(e))}_currentPage(e,t){const s=this._getCurrentOverlayType(t.overlayViewInfos),o=this._keyForOverlayType(s);return i.findIndex(t.overlayTypes,(e=>this._keyForOverlayType(e)===o))}render(){const e=o.Styles.createViewStyle({width:this.state.viewDimensions.width,height:this.state.viewDimensions.height},!1),t=i.map(this.state.overlayViewInfos,(t=>{if(!t||!t.type)return u.log(h.LogTraceArea.Capture,"CaptureOverlayPager: render with no type "+JSON.stringify(t)),null;const s="overlay"+this._keyForOverlayType(t.type)+t.overlayId;let i=this._renderOverlay(t);return this.state.prepareForSnapshot&&0!==t.visualIndex&&(i=o.createElement(o.View,null)),o.createElement(o.Animated.View,{style:[_.stageContainer,t.xOffsetStyle],key:s},o.createElement(o.View,{style:e,key:"container"},i))})),s=this._getCurrentOverlayType(),n=this._keyForOverlayType(s);u.log(h.LogTraceArea.Capture,"CaptureOverlayPager render "+n);const r=this.props.onTap?o.createElement(o.GestureView,{style:_.gestureView,onTap:this.props.onTap,importantForAccessibility:o.Types.ImportantForAccessibility.No}):void 0;let a=[_.overlayContainer];S.default.getPlatformType()===h.PlatformType.Android&&a.push(f.default.overflowVisible),a.push(this.props.style);const l=[_.stageContainer,this._stageContainerXOffsetStyle];return o.createElement(o.View,{style:a,onLayout:this._onLayoutChanged},r,o.createElement(o.Animated.View,{style:l,onLayout:this._onStageLayoutChanged},t))}static _overlayInfo(e,t,s){let i=new o.Animated.Value(t*s),n=o.Styles.createAnimatedViewStyle({transform:[{translateX:i}]}),r=y.default.newGuid();const a=e.parameters;return a&&(r=a.filterName),{overlayId:r,type:e,visualIndex:t,xOffsetValue:i,xOffsetStyle:n}}}t.CaptureOverlayPager=v,t.default=v},51885:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BasicCaptureOverlayView=t.CaptureOverlayView=void 0;const i=s(16778),o=s(77381);class n extends o.default{_renderContent(){}render(){return i.createElement(i.GestureView,{style:this.props.style,onPanHorizontal:this.props.onPanHorizontal,onTap:this.props.onTap,releaseOnRequest:!1,importantForAccessibility:i.Types.ImportantForAccessibility.No},this._renderContent())}}t.CaptureOverlayView=n;t.BasicCaptureOverlayView=class extends n{},t.default=n},59037:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CapturePanel=void 0;const i=s(74958),o=s(96486),n=s(63297),r=s(45961),a=s(31844),l=s(2604),d=s(16778),c=(s(44770),s(97691)),h=s(19784),u=s(60),p=s(89391),g=s(38566),m=s(94224),S=s(72675),f=s(71308),y=s(67538),_=s(25854),v=s(86817),C=s(24779),b=s(51267),T=s(11009),M=s(98278),I=s(77381),w=s(46096),P=s(46096),k=s(45381),A=s(39285),E=s(36237),R=s(15877),L=s(33754),F=s(71349),x=s(10909),O=s(99201),D=s(46929),B=s(4735),V=s(30124),N=s(92210),U=s(69399),H=s(81736),z=s(64956),W=s(96345),j=s(91635),G=s(88378),K=s(29130),q=s(51070),Q=s(81115),X=s(36150),$=s(86045),J=s(4057),Y=s(81760),Z=s(11828),ee=s(78262),te=s(80837),se=s(19675),ie=s(12770),oe=s(53374);var ne,re,ae;!function(e){e[e.Camera=0]="Camera",e[e.Video=1]="Video"}(ne||(ne={})),function(e){e[e.Ready=0]="Ready",e[e.WaitingForCapture=1]="WaitingForCapture",e[e.TransitioningToPreview=2]="TransitioningToPreview"}(re||(re={})),function(e){e[e.Capture=0]="Capture",e[e.Camera=1]="Camera",e[e.MediaPicker=2]="MediaPicker"}(ae||(ae={}));const le=(0,R.lazyProperties)({permissionHelpView:()=>d.Styles.createViewStyle({flex:1,justifyContent:"center",alignItems:"center",backgroundColor:Y.Color.black,padding:20}),helpText:()=>d.Styles.createTextStyle({color:Y.Color.white,textAlign:"center"}),permissionButton:()=>d.Styles.createViewStyle({margin:20,borderColor:Y.Color.blue,borderStyle:"solid",borderWidth:1}),bottomControlsContainer:()=>d.Styles.createViewStyle({justifyContent:"center",alignItems:"center",position:"absolute",bottom:0,left:0,right:0,overflow:"visible"}),bottomControlsContainerLandscape:()=>d.Styles.createViewStyle({alignItems:"center",position:"absolute",bottom:0,right:0,top:0,overflow:"visible",flexDirection:"row"}),bottomControls:()=>d.Styles.createViewStyle({justifyContent:"space-between",alignItems:"flex-end",alignSelf:"stretch",overflow:"visible"}),bottomControlsPortrait:()=>d.Styles.createViewStyle({height:2*f.CaptureButtonSize,flexDirection:"row"}),bottomControlsLandscape:()=>d.Styles.createViewStyle({width:2*f.CaptureButtonSize}),photoShimLight:()=>d.Styles.createViewStyle({position:"absolute",top:0,right:0,left:0,height:64,opacity:.8,backgroundColor:Y.Color.transparent}),photoShimLandscape:()=>d.Styles.createViewStyle({height:100}),photoShimBottom:()=>d.Styles.createViewStyle({position:"absolute",bottom:0,right:0,left:0,height:100,opacity:.8,backgroundColor:Y.Color.transparent,transform:[{scaleY:-1}]}),focusContainer:()=>d.Styles.createViewStyle({flex:1,backgroundColor:Y.Color.transparent}),cameraPlaceholder:()=>d.Styles.createViewStyle({flex:1,justifyContent:"center",alignItems:"center"}),transparentButton:()=>d.Styles.createViewStyle({backgroundColor:Y.Color.transparent}),coachmarksStringContainer:()=>d.Styles.createViewStyle({backgroundColor:Y.Color.transparent,justifyContent:"center",alignItems:"center",position:"absolute",bottom:f.CaptureButtonSize,left:0,right:0,overflow:"visible"}),coachmarksStringText:()=>d.Styles.createTextStyle({color:Y.Color.white,backgroundColor:Y.Color.transparent,textAlign:"center"}),coachmarksError:()=>d.Styles.createTextStyle({backgroundColor:Y.Color.red,borderRadius:5,padding:5}),galleryButtonWrapperForAccessibility:()=>d.Styles.createViewStyle({justifyContent:"center",alignItems:"center",height:f.CaptureButtonSize,width:f.CaptureButtonSize,overflow:"visible"}),galleryButtonWrapperForAccessibilityPortrait:()=>d.Styles.createViewStyle({height:f.CaptureButtonSize}),textShadowStyle:()=>d.Styles.createViewStyle({shadowRadius:4,shadowOffset:{height:0,width:0},shadowOpacity:.5}),headerStyle:()=>d.Styles.createViewStyle({top:0})});class de extends I.default{constructor(){super(...arguments),this._isVisible=!1,this._appIsActive=!1,this._audioManagerClient=new g.default(g.AudioManagerSource.CapturePanel),this._shimAnimatedOpacity=new d.Animated.Value(1),this._shimAnimatedOpacityStyle=d.Styles.createAnimatedViewStyle({opacity:this._shimAnimatedOpacity}),this._innerControlsAnimatedOpacityValue=new d.Animated.Value(1),this._innerControlsAnimatedOpacityStyle=d.Styles.createAnimatedViewStyle({opacity:this._innerControlsAnimatedOpacityValue}),this._capturePanelId=o.uniqueId("CapturePanel"),this._shownCoachMarkString=!1,this._keepOrientationLockedOnTransition=!1,this._orientationLockKey=o.uniqueId("Camera"),this._coachMarkContext={coachMarkArea:T.CoachMarkAreaType.Camera},this._onCameraRef=e=>{this._camera=e||void 0,this._camera&&b.default.updateSettings(this._camera)},this._onAppStateChange=e=>{const t=oe.default.newCauseId();E.log(P.LogTraceArea.Capture,"CapturePanel._onAppStateChange "+e+" causeId: "+t),this._appIsActive=e===d.Types.AppActivationState.Active,this._updateVisibility(this.props.isVisible,!1,t)},this._onStartRecording=()=>{this.state.currentCaptureStep===re.Ready&&(this.props.isConnectedToCall?h.default.showOKAlert(L.getString("CapturePanel.VideoMessageNotAllowedTitle"),L.getString("CapturePanel.VideoMessageNotAllowedMessage"),this._getRootViewId()):this.state.microphonePermissionStatus===l.PermissionStatus.Granted?this.isComponentMounted()&&this.setState({currentMode:ne.Video}):this.state.microphonePermissionStatus===l.PermissionStatus.Unknown?H.default.requestPermission(ee.PermissionType.Microphone,ee.PermissionPromptOptions.SkipPrePrompt):this.state.microphonePermissionStatus===l.PermissionStatus.Denied&&z.default.showDeniedPromptWithSettingsOption(ee.PermissionType.Microphone,this._getRootViewId()))},this._onStopRecording=()=>{if(this.state.currentCaptureStep!==re.Ready)return void E.log(P.LogTraceArea.Capture,"CapturePanel _onStopRecording: not Ready");const e=oe.default.newCauseId();E.log(P.LogTraceArea.Capture,"CapturePanel _onStopRecording recordingInProgress: "+this.state.recordingInProgress+" camera: "+!!this._camera+" causeId: "+e),this.state.recordingInProgress?(this._camera&&(E.log(P.LogTraceArea.Capture,"CapturePanel _onStopRecording finishRecording causeId: "+e),this._camera.finishRecording()),this._initCaptureTelemetry(!0),this._keepOrientationLockedOnTransition=!0,this._setCaptureStep(re.TransitioningToPreview)):(this._camera&&(E.log(P.LogTraceArea.Capture,"CapturePanel _onStopRecording cancelRecording causeId: "+e),this._camera.cancelRecording()),this.isComponentMounted()&&this.setState({currentMode:ne.Camera}),this._animateButtonsIn())},this._onRecordError=e=>{const t=oe.default.newCauseId();E.error(P.LogTraceArea.Capture,J.default.errorAsString(e)),E.log(P.LogTraceArea.Capture,"CapturePanel had recording error causeId: "+t),this.isComponentMounted()&&(this._resetRecordingTimeout("error"),this.setState({recordingInProgress:!1}),this._setCaptureStep(re.Ready)),this._audioManagerClient.release(t)},this._onCameraTap=e=>{this._camera&&this._camera.focusTap(e.pageX,e.pageY),this.props.onTap&&this.props.onTap(e)},this._onCameraDoubleTap=()=>{this._onToggleCameraPress()},this._onPinchZoom=e=>{if(this._camera&&!(this.state.maxZoom<=1)&&(this._camera.zoom(e.isComplete,e.distance,e.initialDistance),this.state.isZooming!==!e.isComplete&&this.setState({isZooming:!e.isComplete}),b.default.hasBackTelephotoCamera())){const t=e.distance/e.initialDistance;let s=this.state.currentZoomLevel*t;s<1?s=1:s>this.state.maxZoom&&(s=this.state.maxZoom),e.isComplete&&(b.default.setZoomLevel(s),this.setState({currentZoomLevel:s}))}},this._onCapture=e=>{const t=oe.default.newCauseId();let s;if(this.state.currentCaptureStep!==re.Ready||!this._camera)return void E.log(P.LogTraceArea.Capture," not ready for capture (step: "+this.state.currentCaptureStep+" camera: "+(this._camera?"ok":"none")+") causeId: "+t);this._keepOrientationLockedOnTransition=!0,this._initCaptureTelemetry(!1);const i=Date.now();E.log(P.LogTraceArea.Capture," _onCapture freeze: true");let o=new N.default(N.ScenarioName.PreviewSnappedPhoto);o.start(void 0,e),o.markStepCompleted("_onCapture"),b.default.setPerfScenario(N.ScenarioName.PreviewSnappedPhoto,o),s=this._camera?c.fromThenable(this._camera.capture(true)):void 0;const n=c.Defer(),r=ie.default.setTimeout((()=>{E.log(P.LogTraceArea.Capture," timeout"),n.reject("Capture timeout")}),5e3);s&&(s.then((()=>{E.track(new U.PerfCameraPhoto(Date.now()-i,V.default.isUsingStackNavigationContext()))})),c.race([s,n.promise()]).then((e=>{E.log(P.LogTraceArea.Capture,"Camera returned response of size "+e.fileSize);const t={localMediaObjectUri:e.uri,fileSize:e.fileSize,width:e.width||0,height:e.height||0,conversationId:this.props.reactionsConversationId||this.props.conversationId,parentConversationId:this.props.conversationId,skipShareWithPanel:this.props.skipShareWithPanel,onCaptureFlowComplete:this._onCaptureFlowComplete,capturedContentHandler:this.props.capturedContentHandler,captureSessionTelemetry:this._captureSessionTelemetry,entryPoint:w.PostSource.Capture,orientationLockKey:this._orientationLockKey};this.props.onHandleCapture&&this.props.onHandleCapture(t,this.state.cameraMode)?this._setCaptureStep(re.Ready):(B.default.navigateToCapturePreview(t),this._setCaptureStepDelayed(re.Ready,500))})).catch((e=>{E.error(P.LogTraceArea.Capture,J.default.errorAsString(e)),E.log(P.LogTraceArea.Capture," photo capture failed"),this._camera&&this._camera.enterPreview(),this._setCaptureStepDelayed(re.Ready,500)})).always((()=>{ie.default.clearTimeout(r)})),this._setCaptureStep(re.WaitingForCapture))},this._onCaptureFlowComplete=()=>{this.props.onCaptureFlowComplete&&this.props.onCaptureFlowComplete(),this._focusOnTab(!1,!1)},this._onCaptureButtonPressIn=()=>{this.setState({toolTipInfo:void 0}),d.Animated.timing(this._innerControlsAnimatedOpacityValue,{toValue:0,duration:200,easing:d.Animated.Easing.Out(),delay:200,useNativeDriver:!0}).start()},this._onCaptureButtonPressOut=()=>{E.log(P.LogTraceArea.Capture," _onCaptureButtonPressOut Video mode: "+(this.state.currentMode===ne.Video)),this.state.currentMode===ne.Video?this._onStopRecording():this._animateButtonsIn()},this._animateButtonsIn=()=>{E.log(P.LogTraceArea.Capture," _animateButtonsIn"),d.Animated.timing(this._innerControlsAnimatedOpacityValue,{toValue:1,duration:200,easing:d.Animated.Easing.Out(),delay:100,useNativeDriver:!0}).start()},this._onCameraPermissionPressed=e=>{e.stopPropagation(),H.default.requestPermission(ee.PermissionType.Camera,ee.PermissionPromptOptions.SkipPrePrompt,l.PermissionOrigin.CapturePanel)},this._onCaptureButtonRef=e=>{this._captureButton=e,this.state.enableAccessibleRecordButton||this._captureButton&&o.delay((()=>{if(!this.isComponentMounted())return;const e=L.getString("CapturePanel.CaptureButtonTooltip"),t={getElement:()=>this._captureButton,positions:[T.PopupAnchorPositon.Top,T.PopupAnchorPositon.Bottom],title:e,durationMs:3e3,anchorAccessibilityLabel:e,instanceId:"capturebuttonephermeraltext",rootViewId:this._getRootViewId()};this.setState({toolTipInfo:t})}),1e3)},this._onCameraFailure=e=>{E.log(P.LogTraceArea.Capture,"CapturePanel._onCameraFailure "+i.pii.Omit(e.failure)+" from "+e.source),E.track(new S.CameraFailureEvent(e.failure,e.source,e.details))},this._onFirstFrame=e=>{E.log(P.LogTraceArea.Capture,"CapturePanel._onFirstFrame from "+e.source),this._isVisibleTimeMs?E.track(new S.CameraFirstFrame(this._isVisibleTimeMs,e.source)):E.warn(P.LogTraceArea.Capture,"CapturePanel._onFirstFrame with no visible time!")},this._onQRCodeDetect=e=>{if(this.props.captureMode!==w.CaptureMode.QR)return;const{nativeEvent:t}=e,s=t.string;E.log(P.LogTraceArea.Capture,"CapturePanel._onQRCodeDetect "+i.pii.Omit(s)),(0,j.openJoinLink)(s,!0,this._getRootViewId())},this._onRecordingChange=e=>{const t=e.nativeEvent.isRecording;this.state.recordingInProgress&&!t&&this.state.currentMode===ne.Video&&this._setCaptureStep(re.TransitioningToPreview),t||this._resetRecordingTimeout("onRecordingChange"),this.isComponentMounted()&&this.setState({recordingInProgress:t,recordingStartTime:t?Date.now():0})},this._resetRecordingTimeout=e=>{this._recordingTimeout&&(E.log(P.LogTraceArea.Capture,": clearing recording timeout "+e),ie.default.clearTimeout(this._recordingTimeout),this._recordingTimeout=void 0)},this._onToggleCameraPress=()=>{const e=oe.default.newCauseId();E.log(P.LogTraceArea.Capture,"CapturePanel._onToggleCameraPress causeId: "+e),b.default.toggleCamera(),b.default.setZoomLevel(1),$.default.maybeAnnounceForAccessibility(this.state.cameraMode===b.CameraMode.Front?L.getString("CapturePanel.SwitchedCameraToFrontAccessibilityLabel"):L.getString("CapturePanel.SwitchedCameraToBackAccessibilityLabel"),100)},this._onMediaPickerPress=()=>{G.default.markAsWatched(),this.props.onHandleMediaPicker&&this.props.onHandleMediaPicker(this.props.conversationId)?E.log(P.LogTraceArea.Capture,"CapturePanel._onMediaPickerPress : onHandleMediaPicker "):(E.log(P.LogTraceArea.Capture,"CapturePanel._onMediaPickerPress"),B.default.navigateToMediaPickerPanelWithParams({capturedContentHandler:this.props.capturedContentHandler,conversationId:this.props.conversationId,onSendFlowComplete:this._onMediaPickerSendFlowComplete}))},this._onMediaPickerSendFlowComplete=()=>{const e=oe.default.newCauseId();E.log(P.LogTraceArea.Capture,"CapturePanel._onMediaPickerSendFlowComplete, causeId: "+e),this.props.onCaptureFlowComplete&&this.props.onCaptureFlowComplete(),this.props.conversationId?B.default.navigateToConversation({convId:this.props.conversationId,causeId:e,origin:P.NavigationConversationOrigin.CapturePanel}):B.default.navigateToRecentsTab()},this._headerBackPress=()=>{E.log(P.LogTraceArea.Capture,"CapturePanel._headerBackPress"),this.props.onBackPressed&&this.props.onBackPressed()},this._headerZoomPress=()=>{E.log(P.LogTraceArea.Capture,"CapturePanel._headerZoomPress"),this._camera&&(1===this.state.currentZoomLevel?(this._camera.setZoomFactor(2),b.default.setZoomLevel(2)):(this._camera.setZoomFactor(1),b.default.setZoomLevel(1)))},this._toolTipAnimationConfig={presentOffset:{x:0,y:15},dismissOffset:{x:0,y:0},duration:250,easing:d.Animated.Easing.OutBack()},this._onDismissTooltip=()=>{this._shownCoachMarkString=!0}}_buildState(e,t){const s=p.default.getS4LCMCFeatures(),i=q.default.bottomSafeAreaInset(M.BottomInsetDefault),o=q.default.horizontalInsets(M.HorizontalInsetDefault),n=this._getRootViewId(),r=b.default.getSupportedCameras();let l={flashMode:b.default.getCurrentFlashMode(),cameraMode:b.default.getCurrentCameraMode(),currentZoomLevel:b.default.getCurrentZoomLevel(),maxZoom:b.default.maxZoom(),cameraPermissionStatus:H.default.permissionStatus(ee.PermissionType.Camera),microphonePermissionStatus:H.default.permissionStatus(ee.PermissionType.Microphone),supportedCameras:r,inCallSelectedCameraId:undefined,inCallSelectedCameraPosition:undefined,bottomControlsInset:e.bottomControlsInset?Math.max(0,e.bottomControlsInset):0,horizontalSafeAreaInsets:o,bottomSafeAreaInset:i,cameraOverride:!b.default.isCameraAvailable(),localPreviewAndroidV2:m.default.CallingStore.isLocalPreviewAndroidV2Enabled(),enableAccessibleRecordButton:s.enableAccessibleRecordButton||X.default.isMobileScreenReaderEnabled(),enableCameraPortraitLock:s.enableCameraPortraitLock};if(t){let t=p.default.getOnboardingFeatures();l.forceCameraPermissionPrompt=t.enableInContextCameraPermission,l.currentMode=ne.Camera,l.recordingInProgress=!1,l.recordingStartTime=0,l.recordingTime="",l.currentCaptureStep=re.Ready,l.isZooming=!1,l.hideHeader=!1,l.deviceOrientation=e.adjustLayoutForDeviceOrientation?K.default.getDeviceOrientation(n):a.DeviceOrientation.Portrait,l.maxRecordingMs=s.maxRecordingMs,l.videoWidth=s.videoWidth,l.videoHeight=s.videoHeight,l.videoBitrate=s.videoBitrate,l.enableEnhancedPhotoExposure=s.enableEnhancedPhotoExposure,l.enableAdaptiveCameraContentScale=s.enableAdaptiveCameraContentScale,l.videoProfile=s.videoProfile,l.enableVideoBFrame=s.enableVideoBFrame,l.cameraVersion=s.cameraVersion}const d=[];let c=_.CaptureFirstRunLevel.All;d.push({type:ae.MediaPicker,hidden:e.disableMediaPicker}),d.push({type:ae.Capture,hidden:e.captureMode===w.CaptureMode.QR}),d.push({type:ae.Camera,hidden:r<=1||e.captureMode===w.CaptureMode.QR}),l.buttonRenderInfo=d,l.coachmarksLevel=c;const h=D.default.getCaptureFirstRunLevel()||_.CaptureFirstRunLevel.None;return l.showCoachmarks=e.showCoachmarksIfNeeded&&h<c,l.recentAssetTimestamp=G.default.getRecentAssetTimestamp(),l.showRecentAssetNotification=G.default.hasRecentAsset(),l.recentAssetThumbnailUrl=G.default.getRecentAssetThumbnail(),l}componentDidMount(){super.componentDidMount();const e=oe.default.newCauseId();E.log(P.LogTraceArea.Capture,"CapturePanel: componentDidMount with isVisible = "+this.props.isVisible+" causeId: "+e),this._appIsActive=!0,this._updateVisibility(this.props.isVisible,!0,e),this.state.enableCameraPortraitLock||this._startOrStopOrientationListener(),this.props.isVisible&&this.props.isFocussedCamera&&!this.state.bottomControlsInset&&x.default.addOrUpdateBottomMargin(this._capturePanelId,f.CaptureButtonSize),this._appStateSubscription=u.default.subscribeForChanges("CapturePanel",this._onAppStateChange),this._camera&&this.props.discardTempFilesFromPreviousSession&&r.CameraView.discardTempFiles(),this.state.forceCameraPermissionPrompt&&this.state.cameraPermissionStatus===l.PermissionStatus.Unknown&&H.default.requestPermission(ee.PermissionType.Camera,ee.PermissionPromptOptions.SkipPrePrompt,l.PermissionOrigin.CapturePanel),this.state.enableCameraPortraitLock&&(this.setState({deviceOrientation:a.DeviceOrientation.Portrait}),O.default.addOrUpdateOrientationLock(this._orientationLockKey,a.DeviceOrientation.Portrait,!0).then((()=>{E.log(P.LogTraceArea.Capture,"CapturePanel lock orientation portrait"),this._startOrStopOrientationListener(),a.default.currentOrientationInSpace().then((e=>{E.log(P.LogTraceArea.Capture,"CapturePanel orientationInSpace",e),this.isComponentMounted()&&this.setState({deviceOrientationInSpace:e})}))}),(e=>{E.warn(P.LogTraceArea.Capture,"CapturePanel lockOrientation failed: "+J.default.errorAsString(e))})))}componentWillUnmount(){super.componentWillUnmount();const e=oe.default.newCauseId();E.log(P.LogTraceArea.Capture,"CapturePanel.componentWillUnmount causeId: "+e),this._updateVisibility(!1,!1,e),this._audioManagerClient.release(e),this._deviceOrientationKey&&(a.default.removeOrientationEventListener(this._deviceOrientationKey),this._deviceOrientationKey=void 0),x.default.removeBottomMargin(this._capturePanelId),this._appStateSubscription&&this._appStateSubscription.unsubscribe(),b.default.setZoomLevel(1),this.state.enableCameraPortraitLock&&!this._keepOrientationLockedOnTransition&&(O.default.removeOrientationLock(this._orientationLockKey),E.log(P.LogTraceArea.Capture,"CapturePanel remove orientation lock"))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);const i=oe.default.newCauseId();E.log(P.LogTraceArea.Capture,"CapturePanel.componentDidUpdate causeId: "+i);let n=b.default.maybeGetAndClearPerfScenario(N.ScenarioName.ShowCameraViewfinder);n&&(n.markStepCompleted("componentDidUpdate"),o.defer((()=>{n&&(n.markStepCompleted("backOnJSThread"),n.finish())}))),this.state.currentMode!==t.currentMode&&(E.log(P.LogTraceArea.Capture,"CapturePanel currentMode "+t.currentMode+" -> "+this.state.currentMode+" causeId: "+i),this.state.currentMode!==ne.Video&&this._audioManagerClient.release(i),this._focusOnTab(this.state.currentMode!==ne.Camera,this.state.currentMode===ne.Video),this.state.enableCameraPortraitLock||(this.state.currentMode===ne.Video?a.default.lockOrientation().then(o.noop,(e=>{E.warn(P.LogTraceArea.Capture,"CapturePanel lockOrientation failed: "+J.default.errorAsString(e))})):a.default.unlockOrientation().then(o.noop,(e=>{E.warn(P.LogTraceArea.Capture,"CapturePanel unlockOrientation failed: "+J.default.errorAsString(e))})))),this.state.isZooming!==t.isZooming&&this._focusOnTab(this.state.isZooming,this.state.isZooming),this.state.currentCaptureStep!==t.currentCaptureStep&&(E.log(P.LogTraceArea.Capture,"CapturePanel currentCaptureStep "+t.currentCaptureStep+" -> "+this.state.currentCaptureStep+" causeId: "+i),this.state.currentCaptureStep===re.Ready&&this.setState({currentMode:ne.Camera})),this.state.currentMode===ne.Video&&t.currentMode!==ne.Video&&(E.log(P.LogTraceArea.Capture,"CapturePanel currentMode Video causeId: "+i),this._requestAudioRecord(i).then((()=>{if(this.state.currentMode!==ne.Video||!this._camera)return void this._audioManagerClient.release(i);let e=c.fromThenable(this._camera.startRecording());const t=c.Defer();this._recordingTimeout=ie.default.setTimeout((()=>{E.log(P.LogTraceArea.Capture,"CapturePanel timeout"),t.reject("Capture timeout")}),this.state.maxRecordingMs+5e3),c.race([e,t.promise()]).then((e=>{E.log(P.LogTraceArea.Capture,"CapturePanel got recording response");const t={localMediaObjectUri:e.uri,localMediaThumbnailUri:e.thumbnailUri,localMediaIsVideo:!0,fileSize:e.fileSize,width:e.width||0,height:e.height||0,conversationId:this.props.reactionsConversationId||this.props.conversationId,parentConversationId:this.props.conversationId,skipShareWithPanel:this.props.skipShareWithPanel,onCaptureFlowComplete:this._onCaptureFlowComplete,capturedContentHandler:this.props.capturedContentHandler,captureSessionTelemetry:this._captureSessionTelemetry,entryPoint:w.PostSource.Capture,orientationLockKey:this._orientationLockKey};this.props.onHandleCapture&&this.props.onHandleCapture(t,this.state.cameraMode)?this._setCaptureStep(re.Ready):(B.default.navigateToCapturePreview(t),this._setCaptureStepDelayed(re.Ready,500)),this._resetRecordingTimeout("success")})).catch(this._onRecordError)})).fail(this._onRecordError));const r=this._updateVisibility(this.props.isVisible,!1,i);if(this.props.adjustLayoutForDeviceOrientation!==e.adjustLayoutForDeviceOrientation&&this._startOrStopOrientationListener(),this.state.deviceOrientationInSpace===t.deviceOrientationInSpace||this.state.deviceOrientationInSpace!==a.DeviceOrientationInSpace.LandscapeLeft&&this.state.deviceOrientationInSpace!==a.DeviceOrientationInSpace.LandscapeRight||this.setState({toolTipInfo:void 0}),this.state.enableCameraPortraitLock&&this.state.deviceOrientation===a.DeviceOrientation.Portrait||!this.state.enableCameraPortraitLock){const e=q.default.statusBarHeight();this.setState({topControlsInset:e>24?e:0})}(r||this.props.isFocussedCamera!==e.isFocussedCamera||this.state.bottomControlsInset!==t.bottomControlsInset)&&(this._isVisible&&this.props.isFocussedCamera?x.default.addOrUpdateBottomMargin(this._capturePanelId,this.state.bottomControlsInset?0:f.CaptureButtonSize):x.default.removeBottomMargin(this._capturePanelId))}_updateVisibility(e,t,s){e=this._appIsActive&&e;const i=()=>{this._captureButton&&e&&this.isComponentMounted()&&this._captureButton.requestFocus()};return t&&o.delay((()=>{i()}),200),e!==this._isVisible&&(i(),E.log(P.LogTraceArea.Capture,"CapturePanel._updateVisibility changed from "+this._isVisible+" to "+e),e?this._isVisibleTimeMs=Date.now():this._isVisibleTimeMs&&(E.track(new S.CameraVisibleTime(this._isVisibleTimeMs,Date.now())),this._isVisibleTimeMs=void 0),b.default.setAsyncCaptureStatus(this._capturePanelId,e),e||(this._audioManagerClient.release(s),W.default.reset()),this._isVisible=e,!0)}handleBackAction(){return this.state.recordingInProgress}_startOrStopOrientationListener(){this.props.adjustLayoutForDeviceOrientation?this._deviceOrientationKey||(this._deviceOrientationKey=o.uniqueId("CaptureOrientation"),this.state.enableCameraPortraitLock?a.default.addOrientationEventListener(this._deviceOrientationKey,((e,t)=>{E.log(P.LogTraceArea.Capture,"CapturePanel _startOrStopOrientationListener deviceOrientation:",e,"deviceOrientationInSpace: ",t),this.isComponentMounted()&&this.state.deviceOrientation!==e&&this.setState({deviceOrientation:e}),this.isComponentMounted()&&this.state.currentMode!==ne.Video&&this.state.deviceOrientationInSpace!==t&&this.setState({deviceOrientationInSpace:t})})):a.default.addOrientationEventListener(this._deviceOrientationKey,(e=>{this.isComponentMounted()&&this.state.deviceOrientation!==e&&this.setState({deviceOrientation:e})}))):this._deviceOrientationKey&&(a.default.removeOrientationEventListener(this._deviceOrientationKey),this._deviceOrientationKey=void 0)}_requestAudioRecord(e){return E.log(P.LogTraceArea.Capture,"CapturePanel _requestAudioRecord: causeId: "+e),this._audioManagerClient.hasToken()?c.Resolved(void 0):this._audioManagerClient.requestMode(n.AudioModes.Capture,e).then((e=>c.Resolved()))}_focusOnTab(e,t){d.Animated.timing(this._shimAnimatedOpacity,{toValue:t?0:1,duration:200,easing:d.Animated.Easing.Linear()}).start(),this.props.onFocusOnCamera&&this.props.onFocusOnCamera(e),this.isComponentMounted()&&this.setState({hideHeader:!!t})}_clearCaptureStepTimer(){this._captureStepTimer&&(ie.default.clearTimeout(this._captureStepTimer),this._captureStepTimer=void 0)}_setCaptureStep(e,t={}){this._clearCaptureStepTimer(),this.isComponentMounted()&&(E.log(P.LogTraceArea.Capture," setting capture step: "+e),t.currentCaptureStep=e,this.setState(t))}_setCaptureStepDelayed(e,t){this._clearCaptureStepTimer(),t>0?(E.log(P.LogTraceArea.Capture," setting capture step: "+e+" delayed: "+t),this._captureStepTimer=ie.default.setTimeout((()=>{this._captureStepTimer=void 0,this.isComponentMounted()&&this.setState({currentCaptureStep:e})}),t)):this._setCaptureStep(e)}_deviceOrientationInSpaceCompensation(e){return e===a.DeviceOrientationInSpace.LandscapeLeft?90:e===a.DeviceOrientationInSpace.LandscapeRight?-90:0}_renderHeader(e){let t=[le.headerStyle,te.default.absoluteFill];return this.state.deviceOrientation===a.DeviceOrientation.Landscape&&this.state.horizontalSafeAreaInsets.left&&t.push(d.Styles.createViewStyle({left:this.state.horizontalSafeAreaInsets.left},!1)),t.push(d.Styles.createViewStyle({top:this.state.topControlsInset},!1)),this.state.hideHeader?void 0:d.createElement(C.default,{style:t,closeInsteadOfBackButton:this.props.closeInsteadOfBackButton,deviceOrientation:this.state.deviceOrientation,backButtonOnly:e,onBackPressed:this._headerBackPress,onZoomPressed:this._headerZoomPress,rotateIcons:this.state.enableCameraPortraitLock?this._deviceOrientationInSpaceCompensation(this.state.deviceOrientationInSpace):0,enableCameraPortraitLock:this.state.enableCameraPortraitLock})}_renderPermissionsStatusView(){let e,t;this.state.forceCameraPermissionPrompt||this.state.cameraPermissionStatus!==l.PermissionStatus.Unknown?this.state.cameraPermissionStatus===l.PermissionStatus.Denied&&(t=z.default.getDeniedPrompt(ee.PermissionType.Camera)):(t=z.default.getPrePrompt(ee.PermissionType.Camera),e=d.createElement(v.default,{backgroundStyle:le.permissionButton,key:"cameraPermission",title:L.getString("CapturePanel.CameraPermissionTitle"),onPress:this._onCameraPermissionPressed,icon:Z.SkypeIcon.Ok,orientationIsLandscape:this.state.deviceOrientation===a.DeviceOrientation.Landscape}));const s=[le.helpText];return Q.default.hasHorizontalSafeAreas(this.state.horizontalSafeAreaInsets)&&s.push(Q.default.horizontalMarginStyle(this.state.horizontalSafeAreaInsets)),d.createElement(d.View,{style:this.props.style},d.createElement(d.GestureView,{style:le.permissionHelpView,releaseOnRequest:!0},d.createElement(se.BodyText,{size:se.BodyTextSize.BigDeprecated,style:s},t),e,this._renderHeader(!0)))}_initCaptureTelemetry(e){const t=new F.CaptureSession(w.PostSource.Capture);t.setIsVideo(e),t.setCameraMode(b.CameraMode[this.state.cameraMode]),t.setDeviceOrientation(this.state.deviceOrientation),this._captureSessionTelemetry=t}render(){const e=this.state.deviceOrientation===a.DeviceOrientation.Landscape;if(this.state.cameraPermissionStatus!==l.PermissionStatus.Granted)return d.createElement(T.CoachMarkContext.Provider,{value:this._coachMarkContext},this._renderPermissionsStatusView());let t;if(this.state.cameraOverride||!this.props.isFocussedCamera&&!this.state.recordingInProgress){let e;if(this.state.cameraOverride){const t=[le.helpText];Q.default.hasHorizontalSafeAreas(this.state.horizontalSafeAreaInsets)&&t.push(Q.default.horizontalMarginStyle(this.state.horizontalSafeAreaInsets)),e=d.createElement(se.BodyText,{size:se.BodyTextSize.BigDeprecated,style:t},L.getString("CapturePanel.SplitScreenWarningLabel"))}t=d.createElement(d.View,{style:le.cameraPlaceholder},e)}else t=d.createElement(r.CameraView,{ref:this._onCameraRef,style:te.default.flexOne,sessionActive:this.props.isVisible,cameraMode:b.default.convertCameraModeEnumToString(this.state.cameraMode),flashMode:b.default.convertFlashModeEnumToString(this.state.flashMode),useShutterAnimation:!1,onRecordingChange:this._onRecordingChange,onCameraFailure:this._onCameraFailure,onQRCodeDetect:this._onQRCodeDetect,onFirstFrame:this._onFirstFrame,releaseOnBackground:!this.props.disableBackgroundCameraRelease,videoThumbnailMaxDimension:360,videoThumbnailCompressionRate:70,maxRecordingMs:this.state.maxRecordingMs,videoWidth:this.state.videoWidth,videoHeight:this.state.videoHeight,videoBitrate:this.state.videoBitrate,enableEnhancedPhotoExposure:this.state.enableEnhancedPhotoExposure,adaptiveContentScale:this.state.enableAdaptiveCameraContentScale,fillContentMode:!0,useSensorOrientation:this.state.enableCameraPortraitLock});t&&!this.state.cameraOverride&&(t=d.createElement(d.GestureView,{importantForAccessibility:d.Types.ImportantForAccessibility.No,key:"camera",style:le.focusContainer,onTap:this._onCameraTap,onDoubleTap:this._onCameraDoubleTap,onPinchZoom:this._onPinchZoom,releaseOnRequest:!this.state.isZooming},t));const s=e?[le.bottomControlsContainerLandscape]:[le.bottomControlsContainer];this.state.bottomControlsInset&&this.state.deviceOrientation!==a.DeviceOrientation.Landscape&&s.push(d.Styles.createViewStyle({bottom:this.state.bottomControlsInset},!1)),this.state.horizontalSafeAreaInsets.right&&this.state.deviceOrientation===a.DeviceOrientation.Landscape&&s.push(d.Styles.createViewStyle({right:this.state.horizontalSafeAreaInsets.right},!1));const i=e?this.state.buttonRenderInfo.slice(0).reverse():this.state.buttonRenderInfo,n=o.map(i,(t=>{E.log(P.LogTraceArea.Capture," ButtonType: "+t.type+" hidden: "+t.hidden+" disabled: "+t.disabled);let s=[le.galleryButtonWrapperForAccessibility];this.state.deviceOrientation===a.DeviceOrientation.Portrait&&s.push(le.galleryButtonWrapperForAccessibilityPortrait);const i=this.state.enableCameraPortraitLock?this._deviceOrientationInSpaceCompensation(this.state.deviceOrientationInSpace):void 0;switch(t.type){case ae.MediaPicker:const o=L.getString("CapturePanel.MediaPickerAccessibilityLabel");let n;return n=this.state.recentAssetThumbnailUrl?d.createElement(y.default,{key:"mediaPickerButton",title:L.getString("CapturePanel.MediaPickerTitle"),onPress:t.disabled||t.hidden?void 0:this._onMediaPickerPress,hidden:t.hidden,selected:t.selected,disabled:t.disabled,backgroundStyle:le.transparentButton,showShadow:!0,accessibilityLabel:o,importantForAccessibility:t.hidden?d.Types.ImportantForAccessibility.NoHideDescendants:void 0,orientationIsLandscape:this.state.deviceOrientation===a.DeviceOrientation.Landscape,recentAssetThumbnailUrl:this.state.recentAssetThumbnailUrl,recentAssetTimestamp:this.state.recentAssetTimestamp,showRecentAssetNotification:this.state.showRecentAssetNotification,textStyle:le.textShadowStyle,rotate:i,enableCameraPortraitLock:this.state.enableCameraPortraitLock}):d.createElement(v.default,{key:"mediaPickerButton",title:L.getString("CapturePanel.MediaPickerTitle"),onPress:t.disabled||t.hidden?void 0:this._onMediaPickerPress,icon:Z.SkypeIcon.Picture,hidden:t.hidden,selected:t.selected,disabled:t.disabled,backgroundStyle:le.transparentButton,showShadow:!0,accessibilityLabel:o,importantForAccessibility:t.hidden?d.Types.ImportantForAccessibility.NoHideDescendants:void 0,orientationIsLandscape:this.state.deviceOrientation===a.DeviceOrientation.Landscape,size:60,rotate:i}),d.createElement(d.Animated.View,{key:"mediaPickerButtonWrapper",style:[s,this._innerControlsAnimatedOpacityStyle],ignorePointerEvents:!0},d.createElement(T.CoachMarkContext.Provider,{value:this._coachMarkContext},n));case ae.Camera:const r=b.default.getCameraToggleMode();let l;return t.disabled||t.hidden||r===b.CameraMode.None||(l=r===b.CameraMode.Front?L.getString("CapturePanel.SwitchCameraToFrontAccessibilityLabel"):L.getString("CapturePanel.SwitchCameraToBackAccessibilityLabel")),d.createElement(d.Animated.View,{key:"cameraButtonWrapper",style:[s,this._innerControlsAnimatedOpacityStyle],ignorePointerEvents:!0},d.createElement(T.CoachMarkContext.Provider,{value:this._coachMarkContext},d.createElement(v.default,{key:"cameraButton",title:L.getString("CapturePanel.SwitchCameraButtonTitle"),onPress:t.disabled||t.hidden?void 0:this._onToggleCameraPress,icon:Z.SkypeIcon.RotateOrientation,hidden:t.hidden,selected:t.selected,disabled:t.disabled,backgroundStyle:le.transparentButton,showShadow:!0,accessibilityLabel:l,importantForAccessibility:t.hidden?d.Types.ImportantForAccessibility.NoHideDescendants:void 0,size:60,textStyle:le.textShadowStyle,orientationIsLandscape:this.state.deviceOrientation===a.DeviceOrientation.Landscape,rotate:i})));case ae.Capture:let c;const h=(this.props.captureMode===w.CaptureMode.Default||this.props.captureMode===w.CaptureMode.VideoOnly)&&this.state.enableAccessibleRecordButton;let u=h?L.getString("CapturePanel.CapturePhotoButtonAccessibilityLabel"):L.getString("CapturePanel.CaptureButtonAccessibilityLabel");switch(this.props.captureMode){case w.CaptureMode.Default:c=this.state.currentMode===ne.Camera?this._onCapture:this._onStopRecording;break;case w.CaptureMode.PhotoOnly:c=this.state.currentMode===ne.Camera?this._onCapture:void 0,u=L.getString("CapturePanel.CapturePhotoButtonAccessibilityLabel");break;case w.CaptureMode.VideoOnly:c=this.state.currentMode===ne.Camera?this._onStartRecording:this._onStopRecording}return d.createElement(T.CoachMarkContext.Provider,{value:this._coachMarkContext},d.createElement(f.default,{key:"captureButton",ref:this._onCaptureButtonRef,captureMode:this.props.captureMode,bottomInset:this.state.bottomControlsInset,onPress:c,onPressIn:this._onCaptureButtonPressIn,onPressOut:this._onCaptureButtonPressOut,onStartRecording:this._onStartRecording,isRecording:this.state.currentMode===ne.Video,isLandscape:e,disabled:this.state.currentCaptureStep!==re.Ready||t.disabled,recordingDuration:this.state.maxRecordingMs,captureAccessibilityLabel:u,enableAccessibleRecordButton:h,rotate:i,enableCameraPortraitLock:this.state.enableCameraPortraitLock}))}})),c=[le.bottomControls];e?c.push(le.bottomControlsLandscape):c.push(le.bottomControlsPortrait);let h=d.createElement(d.View,{key:"innerControls",style:c,ignorePointerEvents:!0},n);this.props.secondaryOpacityStyle&&(h=d.createElement(d.Animated.View,{style:[te.default.overflowVisible,this.props.secondaryOpacityStyle],ignorePointerEvents:!0},h));const u=d.createElement(d.View,{key:"bottomControls"+this.state.deviceOrientation,style:s,ignorePointerEvents:!0},h),p=this.props.captureMode===w.CaptureMode.Default&&this.state.deviceOrientation!==a.DeviceOrientation.Landscape&&this.state.currentMode===ne.Camera&&this.props.isVisible;let g;const m=[le.coachmarksStringContainer],S=[le.coachmarksStringText];let _;if(p){this.state.bottomControlsInset&&m.push(d.Styles.createViewStyle({bottom:this.state.bottomControlsInset+f.CaptureButtonSize+30},!1));let e="";this.state.coachmarksErrorText?(e=this.state.coachmarksErrorText,S.push(le.coachmarksError)):(!this._shownCoachMarkString&&!this.state.enableCameraPortraitLock||this.state.enableCameraPortraitLock&&this.state.deviceOrientationInSpace===a.DeviceOrientationInSpace.Portrait)&&(_=d.createElement(k.default,{toolTipInfo:this.state.toolTipInfo,animateDismissal:!0,onDismiss:this._onDismissTooltip,animationConfig:this._toolTipAnimationConfig,containerOffsetY:14,textMarginHorizontal:14,textMarginVertical:10,backgroundColor:Y.Color.black,backgroundColorOpacity:.5,strokeColorOpacity:.5})),g=d.createElement(A.default,{key:"coachmarkstring",style:m},d.createElement(se.BodyText,{size:se.BodyTextSize.BigDeprecated,style:S},e))}const C=[le.photoShimLight,this._shimAnimatedOpacityStyle];e&&C.push(le.photoShimLandscape);return d.createElement(d.View,{style:this.props.style,importantForAccessibility:this.props.preventAccessibilityFocus?d.Types.ImportantForAccessibility.NoHideDescendants:void 0},d.createElement(T.CoachMarkContext.Provider,{value:this._coachMarkContext},t,undefined,undefined,this.state.cameraOverride?void 0:g,this.state.cameraOverride?void 0:_,this.state.cameraOverride?void 0:u,this._renderHeader(this.state.cameraOverride)))}}t.CapturePanel=de,t.default=de},24779:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CapturePanelHeader=void 0;const i=s(96486),o=s(31844),n=s(2604),r=s(98356),a=s(16778),l=s(88837),d=s(51267),c=s(46096),h=s(13944),u=s(36237),p=s(15877),g=s(33754),m=s(81736),S=s(86045),f=s(81760),y=s(11828),_=s(34528),v=s(78262),C=(0,p.lazyProperties)({header:()=>a.Styles.createViewStyle({alignItems:"center",alignSelf:"stretch",backgroundColor:f.Color.transparent,justifyContent:"space-between",overflow:"visible",margin:10}),headerPortrait:()=>a.Styles.createViewStyle({height:y.IconSize.default,flexDirection:"row"}),headerLandscape:()=>a.Styles.createViewStyle({width:y.IconSize.default,flexDirection:"column"}),button:()=>a.Styles.createButtonStyle({justifyContent:"center",alignItems:"center",width:y.IconSize.default,height:y.IconSize.default,borderRadius:y.IconSize.default/2,overflow:"visible"}),leftControls:()=>a.Styles.createViewStyle({flexDirection:"row"}),rightControls:()=>a.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-end"}),rightBarButtons:()=>a.Styles.createViewStyle({flexDirection:"row"}),rightBarButtonsLandscape:()=>a.Styles.createViewStyle({flexDirection:"column"}),zoomButtonCircle:()=>a.Styles.createViewStyle({borderWidth:1.5,borderColor:f.Color.white,width:y.IconSize.size32,height:y.IconSize.size32,shadowColor:f.Color.black,shadowOpacity:.7,shadowRadius:2,shadowOffset:{height:0,width:0},overflow:"visible"}),zoomRatio:()=>a.Styles.createTextStyle({color:f.Color.white,fontSize:11})});class b extends l.ComponentBase{constructor(){super(...arguments),this._rotationValue=new a.Animated.Value(0),this._rotationStyle=a.Styles.createAnimatedViewStyle({transform:[{rotate:this._rotationValue.interpolate({inputRange:[0,360],outputRange:["0deg","360deg"]})}]}),this._onToggleFlash=()=>{u.log(c.LogTraceArea.Capture,"CapturePanelHeader._onToggleFlash"),d.default.toggleFlash(),S.default.maybeAnnounceForAccessibility(g.getString(this.state.currentFlashMode===d.FlashMode.Off?"CapturePanel.ToggleFlashOnAccessibilityLabel":"CapturePanel.ToggleFlashOffAccessibilityLabel"))}}_buildState(e,t){return{hasFlash:d.default.hasFlash(),currentFlashMode:d.default.getCurrentFlashMode(),currentCameraMode:d.default.getCurrentCameraMode(),cameraPermissionStatus:m.default.permissionStatus(v.PermissionType.Camera),zoomRatio:d.default.getCurrentZoomLevel(),showTelephotoButton:d.default.getCurrentCameraMode()===d.CameraMode.Back&&d.default.hasBackTelephotoCamera()}}componentDidMount(){super.componentDidMount(),this.props.enableCameraPortraitLock&&this._rotationValue.setValue(this.props.rotateIcons||0)}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),this.props.enableCameraPortraitLock&&this.props.rotateIcons!==e.rotateIcons&&r.timing.easeOut({value:this._rotationValue,toValue:e.rotateIcons||0,useNativeDriver:!0}).start()}render(){const e=this.props.closeInsteadOfBackButton?g.getString("CapturePanel.CloseCapturePanelAccessibilityLabel"):g.getString("Global.BackButtonTitle");let t,s,r=a.createElement(a.Animated.View,{style:[this.props.enableCameraPortraitLock?this._rotationStyle:void 0,C.button]},a.createElement(h.default,{style:C.button,size:y.IconSize.size24,onPress:this.props.onBackPressed,color:f.Color.white,hoverColor:f.Color.whiteOverlay70,icon:this.props.closeInsteadOfBackButton?_.closeIcon():_.backIcon(),title:e,showShadow:!0}));if(t=a.createElement(a.View,{style:C.leftControls},r),!this.props.backButtonOnly&&this.state.cameraPermissionStatus===n.PermissionStatus.Granted){const e=[],t=i.round(this.state.zoomRatio,1);this.state.showTelephotoButton&&e.push(a.createElement(a.Animated.View,{key:"zoomInfoIconButton",style:[this.props.enableCameraPortraitLock?this._rotationStyle:void 0,C.button]},a.createElement(a.Button,{style:C.button,onPress:this.props.onZoomPressed,title:g.getString("CapturePanel.ZoomInfoAccessibilityLabel",{zoomFactor:t})},a.createElement(a.View,{style:[C.button,C.zoomButtonCircle]},a.createElement(a.Text,{style:C.zoomRatio,numberOfLines:1},g.getString("CapturePanel.ZoomInfo",{zoomFactor:t}))))));this.state.hasFlash&&this.state.currentCameraMode!==d.CameraMode.Front&&e.push(a.createElement(a.Animated.View,{key:"flashbutton",style:[this.props.enableCameraPortraitLock?this._rotationStyle:void 0,C.button]},a.createElement(h.default,{style:C.button,size:y.IconSize.size24,onPress:this._onToggleFlash,color:f.Color.white,hoverColor:f.Color.gray100,icon:this.state.currentFlashMode===d.FlashMode.Off?y.SkypeIcon.FlashOff:y.SkypeIcon.FlashOn,title:this.state.currentFlashMode===d.FlashMode.Off?g.getString("CapturePanel.ToggleFlashOnAccessibilityLabel"):g.getString("CapturePanel.ToggleFlashOffAccessibilityLabel"),showShadow:!0}))),s=a.createElement(a.View,{style:this.props.deviceOrientation===o.DeviceOrientation.Landscape?C.rightBarButtonsLandscape:C.rightBarButtons,key:"rightbuttons"},e)}let l=[C.rightControls];const c=a.createElement(a.View,{style:l},s);let u=[C.header,this.props.deviceOrientation===o.DeviceOrientation.Landscape?C.headerLandscape:C.headerPortrait,this.props.style];return a.createElement(a.Animated.View,{style:u},t,c)}}t.CapturePanelHeader=b,t.default=b},69198:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(74958),o=s(96486),n=s(63297),r=s(11041),a=s(76667),l=s(31844),d=s(58108),c=s(16778),h=s(44770),u=s(97691),p=s(4736),g=s(89391),m=s(38566),S=s(96074),f=s(2278),y=s(27028),_=s(72675),v=s(70857),C=(s(92681),s(81547)),b=s(39225),T=s(83666),M=s(25854),I=s(86817),w=s(16093),P=s(10666),k=s(45887),A=s(51267),E=s(11930),R=s(98278),L=s(62602),F=s(52262),x=s(70891),O=s(21444),D=s(46096),B=s(74313),V=s(53559),N=s(28719),U=s(13944),H=s(36237),z=s(10400),W=s(15877),j=s(33754),G=s(18743),K=s(10909),q=s(99201),Q=s(89808),X=s(46929),$=s(18078),J=s(45026),Y=s(4735),Z=s(99097),ee=s(31234),te=s(29130),se=s(14976),ie=s(51070),oe=s(81115),ne=s(15963),re=s(86045),ae=s(49603),le=s(12187),de=s(4057),ce=s(15415),he=s(81760),ue=s(11010),pe=s(11828),ge=s(34528),me=s(80837),Se=s(82176),fe=s(12770),ye=s(53374),_e=s(60634),ve=s(53332),Ce=s(3729);var be;!function(e){e[e.None=0]="None",e[e.Loading=1]="Loading",e[e.Indicator=2]="Indicator"}(be||(be={}));const Te=pe.IconSize.default,Me="swipeToast",Ie=(0,W.lazyProperties)({container:()=>c.Styles.createViewStyle({flex:1,justifyContent:"space-between",alignItems:"center",backgroundColor:he.Color.black,overflow:"visible"}),containerFill:()=>c.Styles.createViewStyle({flex:1,backgroundColor:he.Color.black}),markupView:()=>c.Styles.createImageStyle({position:"absolute",left:0,right:0,top:0,bottom:0,overflow:"visible"}),markupViewHidden:()=>c.Styles.createImageStyle({position:"absolute",left:0,right:0,top:0,bottom:0,overflow:"visible",opacity:0}),image:()=>c.Styles.createImageStyle({position:"absolute",left:0,right:0,top:0,bottom:0,backgroundColor:he.Color.black}),videoContainer:()=>me.default.absoluteFill,bottomControls:()=>c.Styles.createViewStyle({position:"absolute",bottom:10,left:0,right:10,flexDirection:"row",alignSelf:"stretch",justifyContent:"space-between",alignItems:"flex-end",overflow:"visible"}),bottomControlsSingle:()=>c.Styles.createViewStyle({justifyContent:"flex-end"}),bottomControlsNoLabel:()=>c.Styles.createViewStyle({right:10}),bottomControlsCompactCenter:()=>c.Styles.createViewStyle({alignItems:"center",justifyContent:"center"}),topControls:()=>c.Styles.createViewStyle({paddingTop:4,paddingHorizontal:10,flexDirection:"row",alignSelf:"stretch",justifyContent:"space-between",overflow:"visible"}),topInnerControls:()=>c.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center"}),iconButton:()=>c.Styles.createButtonStyle({alignItems:"center",justifyContent:"center",height:Te,width:Te,borderRadius:Te/2,backgroundColor:he.Color.transparent}),iconButtonBackground:()=>c.Styles.createButtonStyle({backgroundColor:he.Color.blackOverlay50}),undoButtonContainer:()=>c.Styles.createViewStyle({position:"absolute",right:100,left:100,padding:20,alignItems:"center",justifyContent:"center"}),markupIconButton:()=>c.Styles.createButtonStyle({marginLeft:10}),spinner:()=>c.Styles.createViewStyle({position:"absolute",top:0,right:0,bottom:0,left:0,backgroundColor:he.Color.transparent,justifyContent:"center",alignItems:"center",alignSelf:"stretch"}),palette:()=>c.Styles.createViewStyle({position:"absolute",top:80,width:44,right:0,overflow:"visible"}),colorControls:()=>c.Styles.createViewStyle({position:"absolute",top:0,bottom:0,right:0,left:0,overflow:"visible"}),stickerMenu:()=>c.Styles.createViewStyle({position:"absolute",top:0,bottom:0,right:0,left:0,overflow:"hidden",paddingTop:60}),sendButtonWithLabelWrapper:()=>c.Styles.createViewStyle({width:pe.IconSize.default,alignItems:"center",backgroundColor:he.Color.transparent,overflow:"visible",marginRight:10}),sendButtonLabel:()=>c.Styles.createTextStyle({position:"absolute",top:-18,right:0,width:200,color:he.Color.white,fontSize:ue.default.controlFontSize.actionButtonLabel,textAlign:"right",backgroundColor:he.Color.transparent}),leftButtonContainer:()=>c.Styles.createViewStyle({flexDirection:"row"}),cancelButton:()=>c.Styles.createViewStyle({marginLeft:10}),backButton:()=>c.Styles.createButtonStyle({flexDirection:"row",alignSelf:"stretch",alignItems:"center",justifyContent:"center",height:Te,paddingHorizontal:8,backgroundColor:he.Color.transparent}),icon:()=>c.Styles.createTextStyle({fontSize:pe.IconSize.size24,height:pe.IconSize.size24,backgroundColor:he.Color.transparent}),iconDark:()=>c.Styles.createTextStyle({color:he.Color.gray400}),topControlsShimContainer:()=>c.Styles.createImageStyle({position:"absolute",top:0,right:0,left:0,height:64,backgroundColor:he.Color.transparent,opacity:.8}),bottomControlsShimContainer:()=>c.Styles.createViewStyle({position:"absolute",bottom:0,right:0,left:0,height:100,opacity:.8,backgroundColor:he.Color.transparent,transform:[{scaleY:-1}]}),controlsShimInnerView:()=>c.Styles.createImageStyle({opacity:.9}),shadow:()=>c.Styles.createViewStyle({shadowColor:he.Color.black,shadowOpacity:.5,shadowRadius:1,shadowOffset:{height:0,width:0},overflow:"visible"}),avatarOverlay:()=>me.default.absoluteFill,avatarOverlayRow:()=>c.Styles.createViewStyle({flex:1,backgroundColor:he.Color.blackOverlay50}),avatarOverlayMaskRow:()=>c.Styles.createViewStyle({flex:0,flexDirection:"row"}),avatarOverlayColumn:()=>c.Styles.createViewStyle({flex:1,backgroundColor:he.Color.blackOverlay50}),avatarOverlayMask:()=>c.Styles.createImageStyle({height:250,width:250}),avatarOverlayMaskLarge:()=>c.Styles.createImageStyle({height:500,width:500}),pageIndicator:()=>c.Styles.createViewStyle({position:"absolute",right:0,left:0,bottom:10,height:pe.IconSize.default,alignItems:"center",justifyContent:"center"}),buttonWrapperForAccessibility:()=>c.Styles.createViewStyle({height:80,justifyContent:"flex-end"}),textShadowStyle:()=>c.Styles.createViewStyle({shadowRadius:4,shadowOffset:{height:0,width:0},shadowOpacity:.5}),paletteOffset:()=>c.Styles.createViewStyle({top:80}),paletteOffsetLandscape:()=>c.Styles.createViewStyle({top:60})});function we(e){const t=(0,N.parseFileUri)(e.uri),s=t?V.default.extractFileNameWithExtension(t.path):"";return{file:{uri:e.uri,name:s,size:e.size,type:e.type},extension:V.default.extractFileExtension(s),dimensions:{width:e.width,height:e.height}}}class Pe extends S.default{constructor(){super(...arguments),this._mediaSaved=!1,this._audioManagerClient=new m.default(m.AudioManagerSource.CapturePreview),this._isNativeMobile=!1,this._controlsAnimatedOpacityValue=new c.Animated.Value(0),this._controlsAnimatedOpacityStyle=c.Styles.createAnimatedViewStyle({opacity:this._controlsAnimatedOpacityValue}),this._controlsAnimatedScaleValue=new c.Animated.Value(0),this._controlsAnimatedScaleStyle=c.Styles.createAnimatedViewStyle({transform:[{scale:this._controlsAnimatedScaleValue}]}),this._markupControlsAnimatedScaleValue=new c.Animated.Value(0),this._markupControlsAnimatedOpacityValue=new c.Animated.Value(0),this._markupControlsAnimatedStyle=c.Styles.createAnimatedViewStyle({opacity:this._markupControlsAnimatedOpacityValue,transform:[{scale:this._markupControlsAnimatedScaleValue}]}),this._colorPaletteAnimatedTransformValue=new c.Animated.Value(44),this._colorPaletteAnimatedTransformStyle=c.Styles.createAnimatedViewStyle({transform:[{translateX:this._colorPaletteAnimatedTransformValue}]}),this._undoAnimatedBottomValue=new c.Animated.Value(-100),this._undoAnimatedOpacityValue=new c.Animated.Value(0),this._undoAnimatedPositionStyle=c.Styles.createAnimatedViewStyle({bottom:this._undoAnimatedBottomValue}),this._undoAnimatedOpacityStyle=c.Styles.createAnimatedViewStyle({opacity:this._undoAnimatedOpacityValue}),this._addStickersClickCount=0,this._stickerNames=[],this._onImageLoaded=e=>{if(this.props.entryPoint!==D.PostSource.Capture)return;let t=A.default.maybeGetAndClearPerfScenario(ne.ScenarioName.PreviewSnappedPhoto);t&&(t.markStepCompleted("_onImageLoaded"),o.defer((()=>{t&&(t.markStepCompleted("backOnJSThread"),t.finish())})))},this._onMarkupColorSelected=(e,t=!1,s)=>{this._markupView&&(this._markupView.selectColor(e.value),s&&this._markupView.setStrokeWidth(s)),this.isComponentMounted()&&this.state.selectedColor!==e&&this.setState({selectedColor:e,isLightColor:t})},this._onMarkupUndo=()=>{this._markupView&&(this._undoLastSupported()?this._markupView.undoLast():this._markupView.undoDrawing())},this._onContainerLayout=e=>{if(this.isComponentMounted()){const t=ye.default.newCauseId(),s=this._getSnapshotRect(e);this.setState({viewRect:e,snapShotRect:s}),H.log(D.LogTraceArea.Capture,"CapturePreview _onContainerLayout "+s.width+" "+s.height+" causeId: "+t),L.default.measureLayoutRelativeToWindow((()=>this)).then((e=>{if(this.isComponentMounted()){const t={x:e.x,y:e.y};this.setState({gestureOffset:t})}}),(e=>{H.warn(D.LogTraceArea.Capture,"Capture preview component not measured: "+de.default.errorAsString(e))}))}},this._onCoachmarksDismiss=()=>{this._dismissCoachmarks()},this._coachmarksViewed=()=>{X.default.setMediaEditorFirstRunLevel(this.state.coachmarksLevel)},this._onAddTextPressed=()=>{this.state.markupMode!==T.CaptureMarkupMode.Text?this.setState({markupMode:T.CaptureMarkupMode.Text,showColorPalette:!0}):this.setState({markupMode:T.CaptureMarkupMode.None})},this._enableEffects=()=>{const e=ye.default.newCauseId(),t=this.state.markupMode!==T.CaptureMarkupMode.Filters;H.log(D.LogTraceArea.Capture,"CapturePreview _enableEffects "+t+" causeId: "+e),this.setState({markupMode:t?T.CaptureMarkupMode.Filters:this._getDefaultMarkupMode(this.state),hasRequestedEffects:!0,overlayMode:this.state.hasRequestedEffects?be.Indicator:be.Loading}),t&&fe.default.setTimeout((()=>{this.isComponentMounted()&&(H.log(D.LogTraceArea.Capture,"CapturePreview _enableEffects show causeId:"+e),this.setState({overlayMode:this.state.effectsFailed?be.None:be.Indicator}))}),5e3)},this._onAddStickerPressed=()=>{const e=this.state.markupMode!==T.CaptureMarkupMode.Stickers;H.log(D.LogTraceArea.Capture,"CapturePreview _onAddStickerPressed "+e),e?this._addStickersClickCount++:o.delay((()=>{this._stickerButton&&this._stickerButton.requestFocus()}),100),this.setState({markupMode:e?T.CaptureMarkupMode.Stickers:this._getDefaultMarkupMode(this.state)}),X.default.setCaptureMarkupTooltipDismissed(!0)},this._onDrawButtonPressed=()=>{const e=this.state.markupMode!==T.CaptureMarkupMode.Ink,t={markupMode:e?T.CaptureMarkupMode.Ink:this._getDefaultMarkupMode(this.state),showColorPalette:e||this.state.showColorPalette};this.setState(t)},this._onStickerSelected=(e,t)=>{this._markupView&&this._markupView.addSticker(e,!1,t)},this._onStickerMenuClose=()=>{H.log(D.LogTraceArea.Capture,"CapturePreview sticker menu closed"),this.setState({markupMode:this._getDefaultMarkupMode(this.state)})},this._onMarkupDrawing=e=>{this._showOrHideControls(!e,e?300:100)},this._onHasMarkup=e=>{this.setState({hasMarkup:e})},this._onCanUndo=e=>{this.setState({canUndo:e})},this._onHasText=e=>{this.setState({hasText:e})},this._onHasStickers=e=>{this.setState({hasStickers:e})},this._onStickerIds=e=>{this.setState({stickerIds:e})},this._onStickerNames=e=>{this._stickerNames=e},this._onOverlaySelected=e=>{const t=e&&e.overlayType!==y.OverlayType.None;let s="CameraEffects.OriginalFilterAccessibilityLabel";t&&this._captureSessionTelemetry&&this._captureSessionTelemetry.setOverlayType(e.overlayType);const i=e.overlayType===y.OverlayType.Filter;if(i){const t=this._captureSessionTelemetry;if(t){const i=e.parameters;t.setFilterName(i.filterName),t.recordOverlayViewed("Filter_"+i.filterName),s=i.accessibilityLabelTextPath}}const o={hasOverlay:t,hasFilter:i};this.setState(o),this.state.shouldReadOverlayEffectType&&re.default.maybeAnnounceForAccessibility(j.getString(s))},this._onOverlayProgress=e=>{this.state.shouldReadOverlayEffectType||this.setState({shouldReadOverlayEffectType:!0})},this._onTextFocusChanged=e=>{e&&this.state.markupMode!==T.CaptureMarkupMode.Text?this.setState({markupMode:T.CaptureMarkupMode.Text,showColorPalette:!0}):e||this.state.markupMode!==T.CaptureMarkupMode.Text||this.setState({markupMode:this._getDefaultMarkupMode(this.state)})},this._onTextInput=e=>{const t=this.state.deviceOrientation===l.DeviceOrientation.Landscape?12:6;e.length>t&&(this._showOrHideColorPalette(!1),this._debouncedShowColorPalette())},this._debouncedShowColorPalette=o.debounce((()=>{this.isComponentMounted()&&(this.setState({showColorPalette:!0}),this._showOrHideColorPalette(!0))}),2e3),this._onDragView=(e,t)=>{this.state.showDeleteButton!==e&&(this.setState({showDeleteButton:e}),this._showOrHideControls(!e));const s=Te+40,i=(this.state.viewRect.width-s)/2,o=this.state.viewRect.height+this.state.safeAreaInsets.top-s,n=s,r=s;return t.x>i&&t.x<i+r&&t.y>o&&t.y<o+n},this._onCaptureMarkupView=e=>{if(this._markupView=e,this._markupView&&this.props.isAvatarPreview){const e={height:this.props.mediaHeight,width:this.props.mediaWidth},t=this._getProjectedDimensions(e,this.state.snapShotRect,!0);this._markupView.addSticker({id:"avatarImage",fullUrl:this.props.localMediaObjectUri,height:t.height,width:t.width,isAvatar:!0,avatarSquareSize:this.state.snapShotRect.width},!0)}},this._onStickerButtonRef=e=>{this._stickerButton=e||void 0},this._onSnapshotRef=e=>{this._snapShotView=e},this._onVideoRef=e=>{if(this._video=e||void 0,!e&&this._videoHasUnmountedDeferred){const e=this._videoHasUnmountedDeferred;this._videoHasUnmountedDeferred=void 0,e.resolve(void 0)}},this._onCoachmarksRef=e=>{this._coachmarks=e||void 0},this._onCaptureOverlayPageIndicatorRef=e=>{this._captureOverlayPageIndicator=e},this._onSendButtonRef=e=>{this._sendButton=e,o.delay((()=>{this._sendButton&&this.setState({shouldAnnouncePhotoVideoCaptured:!1})}),500)},this._onCaptureOverlayPageUpdated=(e,t)=>{this.setState({totalOverlayPages:t}),this.setState({overlayMode:be.Indicator}),this._captureOverlayPageIndicator&&this._captureOverlayPageIndicator.update(e,t)},this._onGetAnchorRect=e=>{let t;switch(e){case k.CapturePreviewButtonId.Send:case k.CapturePreviewButtonId.HubSend:t=this._sendButton}return t?L.default.measureLayoutRelativeToWindow((()=>t)):u.Rejected("CapturePreview: View not found "+e)},this._onVideoCanPlay=()=>{this.isComponentMounted()&&this.setState({mediaReady:!0})},this._onAudioManagerError=e=>{const t=ye.default.newCauseId();H.log(D.LogTraceArea.Capture,"CapturePreview had and AudioManager error causeId: "+t),this._audioManagerClient.release(t),H.error(D.LogTraceArea.Capture,de.default.errorAsString(e))},this._onAccept=e=>{const t=ye.default.newCauseId();H.log(D.LogTraceArea.Capture,"CapturePreview _onAccept sendEnabled:"+this.state.sendEnabled+" causeId:"+t),this.state.sendEnabled&&(this._video?(this._videoHasUnmountedDeferred=u.Defer(),this.setState({noRenderVideo:!0}),this._videoHasUnmountedDeferred.promise().then((()=>{this._onAcceptInner(t)}))):this._onAcceptInner(t))},this._onCancelPressed=e=>{if(!0===this._mediaSaved&&this._completeCaptureSession(),this.state.markupMode!==this._getDefaultMarkupMode(this.state))this.setState({markupMode:this._getDefaultMarkupMode(this.state)});else{if(this._captureSessionTelemetry&&(this._captureSessionTelemetry.setIsCanceled(!0),H.track(this._captureSessionTelemetry),delete this._captureSessionTelemetry),!this.props.inlinePreview){const e=ye.default.newCauseId();H.log(D.LogTraceArea.Navigation,"CapturePreview._onCancelPressed, causeId: "+e),Y.default.goBack(e,this._getContext())}this.props.onReject&&this.props.onReject(this.props.entryPoint)}return!0},this._onCaptureFlowComplete=()=>{this.props.onCaptureFlowComplete&&this.props.onCaptureFlowComplete()},this._onLensSnapshotError=()=>{this._imageWithLensPromise&&this._imageWithLensPromise.reject()},this._onLensSnapshotLoaded=()=>{fe.default.setTimeout((()=>{this._imageWithLensPromise&&this._imageWithLensPromise.resolve(void 0)}),200)},this._onSavePressed=()=>{const e=ye.default.newCauseId();H.log(D.LogTraceArea.Capture,"CapturePreview._onSavePressed causeId:"+e),this._mediaSaved=!0;(this.props.localMediaIsVideo?this._saveVideoToCameraRoll(e):this._savePhotoToCameraRoll(e)).then((()=>{H.log(D.LogTraceArea.Capture,"CapturePreview._onSavePressed success causeId:"+e)}),(t=>{H.log(D.LogTraceArea.Capture,"CapturePreview._onSavePressed error: "+de.default.errorAsString(t)+" causeId:"+e)}))},this._renderSendButton=()=>{let e=this.props.isAvatarPreview?j.getString("MyProfilePanel.UploadPhoto"):j.getString("CapturePreview.SendTitle");if(this.state.sendButtonLabel&&(e=j.getString("CapturePreview.SendToAccessibilityLabel",{displayName:this.state.sendButtonLabel})),this.state.shouldAnnouncePhotoVideoCaptured&&void 0===this.props.mediaSelection){const t=this.props.localMediaIsVideo?"CapturePreview.VideoCaptured":"CapturePreview.PhotoCaptured",s=j.getString(t);e=E.default.combinedAccessibilityLabel(s,e,". ")}this.props.showSendButtonOnTop&&(e=j.getString("Global.DoneButtonTitle"));const t=this.props.performMarkupOnly?pe.SkypeIcon.Ok:pe.SkypeIcon.Send;return c.createElement(p.default,{key:"send",ref:this._onSendButtonRef,title:j.getString("CapturePreview.SendTitle"),accessibilityLabel:e,onPress:this._onAccept,icon:t,importantForAccessibility:c.Types.ImportantForAccessibility.Yes,flipIcon:this._getContext().isRTL&&t!==pe.SkypeIcon.Ok,size:p.ActionButtonSize.Small,backgroundColor:this.props.showSendButtonOnTop?he.Color.blue:he.Color.whiteOverlay20,autoFocus:!0})}}_buildState(e,t){t&&(this._mediaId=ye.default.newGuid(),this._captureSessionTelemetry=e.captureSessionTelemetry);let s=M.MediaEditorFirstRunLevel.None,i=M.MediaEditorFirstRunLevel.None;e.performMarkupOnly||e.useCompactControls||e.disableCoachmarks||(s=e.conversationId?M.MediaEditorFirstRunLevel.Conversation:M.MediaEditorFirstRunLevel.Hub,i=X.default.getMediaEditorFirstRunLevel()||M.MediaEditorFirstRunLevel.None);const o=g.default.getS4LCMCFeatures(),n=this._getRootViewId(),r=ie.default.keepStatusBarVisible()?ie.default.statusBarPadding():0,a=e.ignoreBottomSafeArea?0:ie.default.bottomSafeAreaInset(R.BottomInsetDefault),l=ie.default.horizontalInsets(R.HorizontalInsetDefault);let d={keyboardUpdateInfo:z.default.getUpdateInfo(),keyboardResizeMode:z.default.getResizeMode(),showCoachmarks:e.showCoachmarksIfNeeded&&s>i&&O.default.isEngagementContentEnabled(),coachmarksLevel:s,sendButtonLabel:e.sendButtonLabel||(!e.callId&&e.conversationId?F.default.getDisplayName(e.conversationId):void 0),deviceOrientation:te.default.getDeviceOrientation(n),gradientColors:Q.default.getGradientColors(),primaryColorStyle:Q.default.getPrimaryBackgroundColorStyle(),effectsEnabled:!e.isAvatarPreview&&!(this.state&&this.state.effectsFailed)&&P.default.effectsEnabled(!!e.localMediaIsVideo,e.mediaWidth,e.mediaHeight)&&!e.callId&&!this._isMediaSelectionGif(),safeAreaInsets:Object.assign(Object.assign({},l),{top:r,bottom:a}),mySkypeId:$.default.getSkypeId(),showOverlayEffectsCoachmark:P.default.hasOverlays(e.localMediaIsVideo)&&O.default.isEngagementContentEnabled(),alwaysEnableVideoMarkup:!1,sendOverlayAsMetadata:!1,enableCameraPortraitLock:o.enableCameraPortraitLock};return t&&(d.noRenderVideo=!1,d.mediaReady=!e.localMediaIsVideo,d.isMuted=!1,d.lensSnapshot=void 0,d.markupMode=T.CaptureMarkupMode.None,d.hasRequestedEffects=!1,d.markupEnabled=!1,d.overlayMode=be.None,d.viewRect={x:0,y:0,height:0,width:0},d.snapShotRect={x:0,y:0,height:0,width:0},d.hasMarkup=!1,d.canUndo=!1,d.hasText=!1,d.hasStickers=!1,d.hasOverlay=!1,d.stickerIds=[],d.selectedColor={id:"White",value:he.Color.white,stringKey:"Color.White"},d.isLightColor=!0,d.showColorPalette=!1,d.showDeleteButton=!1,d.hasFilter=!1,d.sendEnabled=!0,d.videoMarkupFXEnabled=!1,d.readyForTooltips=!1,d.videoProcessingInProgress=!1,d.gestureOffset={x:0,y:0},d.showOverlayEffectsCoachmark=!1,d.shouldReadOverlayEffectType=!1,d.shouldAnnouncePhotoVideoCaptured=!0),d}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount();const e=ye.default.newCauseId();if(H.log(D.LogTraceArea.Capture,"CapturePreview.UNSAFE_componentWillMount causeId: "+e),c.StatusBar.isOverlay()){const e=le.default.mergeStyles([le.default.createHiddenStyle(!0),le.default.createBarStyle(ae.BarStyleTheme.Light)]);this._updateStatusBarStyle(e)}J.default.markAnimatedValue(this._controlsAnimatedScaleValue,0)}componentWillUnmount(){super.componentWillUnmount();const e=ye.default.newCauseId();H.log(D.LogTraceArea.Capture,"CapturePreview.componentWillUnmount causeId: "+e),K.default.removeBottomMargin("CapturePreview"),K.default.removeToastMessage(Me),this.state.enableCameraPortraitLock||void 0===this._previousOrientation||(H.log(D.LogTraceArea.Capture,"CapturePreview unlockOrientation causeId:"+e),l.default.unlockOrientation().then(o.noop,(t=>{H.warn(D.LogTraceArea.Capture,"CapturePreview unlockOrientation failed: "+de.default.errorAsString(t)+" causeId:"+e)}))),this.state.enableCameraPortraitLock&&this.props.orientationLockKey&&(H.log(D.LogTraceArea.Capture,"CapturePreview remove orientation lock"),q.default.removeOrientationLock(this.props.orientationLockKey)),this._audioManagerClient.release(e)}componentDidMount(){super.componentDidMount();const e=ye.default.newCauseId();H.log(D.LogTraceArea.Capture,"CapturePreview this.props.localMediaObjectUri "+i.pii.Omit(this.props.localMediaObjectUri)+" ("+this.props.mediaWidth+"x"+this.props.mediaHeight+") causeId:"+e),H.log(D.LogTraceArea.Capture,"CapturePreview this.props.localMediaThumbnailUri "+(this.props.localMediaThumbnailUri?i.pii.Omit(this.props.localMediaThumbnailUri):"undefined")+" causeId:"+e);const t=this._desiredOrientation();if(this.props.unlockOrientation||H.warn(D.LogTraceArea.Capture,"CapturePreview.componentWillMount ignoring props.unlockOrientation causeId:"+e),this._lockOrientation(t,!0,e),this.props.entryPoint===D.PostSource.Capture){let e=A.default.getPerfScenario(ne.ScenarioName.PreviewSnappedPhoto);e&&e.markStepCompleted("componentDidMount")}K.default.addOrUpdateBottomMargin("CapturePreview",90),o.delay((()=>{this.isComponentMounted()&&(H.log(D.LogTraceArea.Capture,"CapturePreview show controls causeId:"+e),c.Animated.parallel([J.default.timing(this._controlsAnimatedScaleValue,{toValue:1,duration:400,easing:c.Animated.Easing.OutBack(),useNativeDriver:!0}),c.Animated.timing(this._controlsAnimatedOpacityValue,{toValue:1,duration:100,easing:c.Animated.Easing.In()})]).start((e=>{fe.default.setTimeout((()=>{this.isComponentMounted()&&this.setState({readyForTooltips:!0})}),100)})),this.state.effectsEnabled&&(H.log(D.LogTraceArea.Capture,"CapturePreview.componentDidMount forceEffects causeId: "+e),this._enableEffects()))}),200),this.props.markupEnabled&&!this._isMediaSelectionGif()&&this._enableMarkupDeferred(e)}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),!t.markupEnabled&&this.state.markupEnabled&&H.warn(D.LogTraceArea.Capture,"CapturePreview UNSAFE_componentWillUpdate: setting markupEnabled true -> false may cause unexpected behavior")}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);const i=ye.default.newCauseId();H.log(D.LogTraceArea.Capture,"CapturePreview componentDidUpdate causeId:"+i),t.isMuted!==this.state.isMuted&&this._video&&this._video.mute(this.state.isMuted),this.state.mediaReady&&!t.mediaReady&&o.delay((()=>{this._requestPlayback().then((()=>{this.isComponentMounted()&&this._video&&this._video.play()})).fail(this._onAudioManagerError)}),200),!e.markupEnabled&&this.props.markupEnabled&&this._enableMarkupDeferred(i),!t.markupEnabled&&this.state.markupEnabled&&c.Animated.parallel([J.default.timing(this._markupControlsAnimatedScaleValue,{toValue:1,duration:400,easing:c.Animated.Easing.OutBack(),useNativeDriver:!0}),J.default.timing(this._markupControlsAnimatedOpacityValue,{toValue:1,duration:100,easing:c.Animated.Easing.Linear(),useNativeDriver:!0})]).start(),t.markupMode!==this.state.markupMode&&(this._shouldShowColorPalette(this.state)?this._showOrHideColorPalette(!0):this._showOrHideColorPalette(!1,0,!0));const n=this._showUndoButton(this.state);if(this._showUndoButton(t)!==n){const e=n?200:0,t=n?this.state.safeAreaInsets.bottom-10:-100,s=[c.Animated.timing(this._undoAnimatedBottomValue,{toValue:t,duration:200,delay:e,easing:n?c.Animated.Easing.OutBack():c.Animated.Easing.In()}),c.Animated.timing(this._undoAnimatedOpacityValue,{toValue:n?1:0,duration:200,delay:e,easing:c.Animated.Easing.Out()})];c.Animated.parallel(s).start()}t.sendEnabled!==this.state.sendEnabled&&(H.log(D.LogTraceArea.Capture,"CapturePreview sendEnabled "+t.sendEnabled+" -> "+this.state.sendEnabled),this.state.sendEnabled||fe.default.setTimeout((()=>{this.isComponentMounted()&&this.setState({sendEnabled:!0})}),2e3)),void 0===this._previousOrientation&&this._hasMarkup(this.state)&&!this._hasMarkup(t)&&this._lockOrientation(void 0,!1,i),this.state.effectsEnabled&&this.state.showOverlayEffectsCoachmark&&!t.showOverlayEffectsCoachmark&&!re.default.shouldAnnounceForAccessibility()&&K.default.scheduleTextMessage(j.getString("CapturePreview.SwipeToSeeEffects"),Me,this._getRootViewId())}_lockOrientation(e,t,s){H.log(D.LogTraceArea.Capture,"CapturePreview _lockOrientation desiredOrientation:"+e+" requiresMatch:"+t+" causeId:"+s),this.state.enableCameraPortraitLock||l.default.currentOrientation().then((i=>{const n=void 0!==e?e:i;t&&i!==n?H.log(D.LogTraceArea.Capture,"CapturePreview _lockOrientation noop causeId:"+s):(H.log(D.LogTraceArea.Capture,"CapturePreview _lockOrientation orientation:"+n+" causeId:"+s),this._previousOrientation=i,l.default.lockOrientation(n).then(o.noop,(e=>{H.warn(D.LogTraceArea.Capture,"CapturePreview lockOrientation failed: "+de.default.errorAsString(e)+" causeId:"+s)})))})).catch((e=>{H.warn(D.LogTraceArea.Capture,"CapturePreview currentOrientation failed: "+de.default.errorAsString(e)+" causeId:"+s)}))}_desiredOrientation(){return this.props.mediaWidth>this.props.mediaHeight?l.DeviceOrientation.Landscape:l.DeviceOrientation.Portrait}_requestPlayback(){const e=ye.default.newCauseId();return H.log(D.LogTraceArea.Capture,"CapturePreview._requestPlayback causeId: "+e),this._audioManagerClient.hasToken()?u.Resolved(void 0):this._audioManagerClient.requestMode(n.AudioModes.VideoPlayback,e).then((e=>u.Resolved()))}_enableMarkupDeferred(e){fe.default.setTimeout((()=>{this.isComponentMounted()&&(H.log(D.LogTraceArea.Capture,"CapturePreview _enableMarkupDeferred causeId:"+e),this.setState({markupEnabled:!0}))}),500)}_showUndoButton(e){return e.showDeleteButton||e.canUndo&&e.markupMode===T.CaptureMarkupMode.Ink}render(){const e=[Ie.containerFill,me.default.absoluteFill];this.state.safeAreaInsets.top&&e.push(oe.default.marginTopStyle(this.state.safeAreaInsets.top));const t=this.state.noRenderVideo,s=this.state.markupMode===T.CaptureMarkupMode.Ink,i=this.state.markupMode===T.CaptureMarkupMode.Stickers,o=this.state.markupMode===T.CaptureMarkupMode.Text,n=this._getSnapshotContainerStyle();let r,d;if(!t&&this.props.localMediaIsVideo&&this.props.localMediaObjectUri){const e=!1;r=c.createElement(Ce.default,{origin:"CaptureVideoPreview",ref:this._onVideoRef,style:e?Ie.videoContainer:n,loop:!0,source:this.props.localMediaObjectUri,resizeMode:e?"stretch":void 0,onCanPlay:this._onVideoCanPlay,accessibilityLabel:j.getString("CapturePreview.VideoTitle"),mediaProvider:x.MediaProvider.Preview}),e&&(r=c.createElement(c.View,{style:n},r))}this._mediaDimensions={width:this.props.mediaWidth,height:this.props.mediaHeight},this.props.localMediaIsVideo||this.props.isAvatarPreview||!this.props.localMediaObjectUri||(d=c.createElement(c.Image,{style:Ie.image,source:this.props.localMediaObjectUri,onLoad:this._onImageLoaded,resizeMode:"stretch",accessibilityLabel:j.getString("CapturePreview.ImageTitle")}));const u=this.state.lensSnapshot&&!this.props.isAvatarPreview?c.createElement(B.default,{origin:"CapturePreview",style:Ie.image,containerStyle:Ie.image,source:this.state.lensSnapshot,resizeMode:"stretch",onError:this._onLensSnapshotError,onLoad:this._onLensSnapshotLoaded,key:"imageWithLensSnapshot"}):void 0,p=this.state.showDeleteButton||this.state.markupMode===T.CaptureMarkupMode.Ink||this.state.markupMode===T.CaptureMarkupMode.Stickers,g=this.props.isAvatarPreview?{height:this._avatarOverlayHeight(this.state.viewRect),width:this._avatarOverlayWidth(this.state.viewRect)}:this._mediaDimensions,m=this.state.overlayMode===be.Loading&&0===this.state.totalOverlayPages,S=this.state.markupEnabled&&this.props.localMediaObjectUri&&(!this.props.localMediaIsVideo||this._videoMarkupSupported())?c.createElement(T.CaptureMarkupView,{key:"markupView",markupMode:this.state.markupMode,ref:this._onCaptureMarkupView,style:m?Ie.markupViewHidden:Ie.markupView,mediaId:this._mediaId,localMediaObjectUri:this.props.localMediaObjectUri,localMediaIsVideo:!!this.props.localMediaIsVideo,fileSize:this.props.fileSize,enableOverlays:!this.props.isAvatarPreview&&!this.state.effectsFailed&&!this.props.localMediaIsVideo,mediaDimensions:g,levelsOfUndo:this._levelsOfUndo(),hidePageControl:p,offset:this.state.snapShotRect,isAvatarPreview:this.props.isAvatarPreview,advanceToFirstOverlay:!this.state.effectsEnabled,effectsEnabled:this.state.effectsEnabled,onDrawing:this._onMarkupDrawing,onHasMarkup:this._onHasMarkup,onCanUndo:this._onCanUndo,onHasText:this._onHasText,onHasStickers:this._onHasStickers,stickerIds:this._onStickerIds,stickerNames:this._onStickerNames,onOverlaySelected:this._onOverlaySelected,onOverlayProgress:this._onOverlayProgress,onTextFocusChanged:this._onTextFocusChanged,onDragView:this._onDragView,onPagerUpdated:this._onCaptureOverlayPageUpdated,onTextInput:this._onTextInput}):void 0,f=this.state.deviceOrientation===l.DeviceOrientation.Landscape,y=this._getKeyboardInset()>0?this._getKeyboardInset()+20:f?90:120,_={x:this.state.gestureOffset.x,y:this.state.gestureOffset.y+(f?60:80),height:this.state.viewRect.height-y,width:this.state.viewRect.width},M=j.getString("CapturePreview.PenColorPickerWithColorAccessibilityLabel",{color:j.getString(this.state.selectedColor.stringKey)}),P=c.createElement(C.CaptureMarkupColorControl,{style:Ie.colorControls,onColorSelected:this._onMarkupColorSelected,gestureRect:_,colorOnly:!0}),A=this.state.markupEnabled&&this.state.showColorPalette?c.createElement(c.Animated.View,{key:"colorControl",style:this._getColorPaletteStyle(y),importantForAccessibility:c.Types.ImportantForAccessibility.Yes,accessibilityLabel:M},P):void 0,E=[Ie.iconButton,Ie.markupIconButton],L=Ie.textShadowStyle,F=this.props.useCompactControls||this.props.performMarkupOnly&&!this.props.alwaysShowSaveButton||this.state.markupMode===T.CaptureMarkupMode.Text||this._shouldSendOriginalMedia()&&this.props.mediaSelection?void 0:c.createElement(c.Animated.View,{key:"save",style:[this._controlsAnimatedScaleStyle,Ie.buttonWrapperForAccessibility],ignorePointerEvents:!0,importantForAccessibility:c.Types.ImportantForAccessibility.Yes,accessibilityTraits:c.Types.AccessibilityTrait.Button},c.createElement(U.default,{style:E,size:pe.IconSize.size24,onPress:this._onSavePressed,color:he.Color.white,hoverColor:he.Color.gray300,icon:pe.SkypeIcon.Download,title:j.getString("CapturePreview.SaveTitle"),iconTextStyle:L,showShadow:!0,accessibilityLabel:j.getString("CapturePreview.SaveAccessibilityLabel")}));let O;if(this.state.markupEnabled&&(!this.props.localMediaIsVideo||this._videoMarkupSupported())){const e=[Ie.iconButton,Ie.markupIconButton],t=[Ie.icon,Ie.textShadowStyle];s&&(e.push(this._getColorStyle(this.state.selectedColor.value)),this.state.isLightColor&&t.push(Ie.iconDark));const n=[Ie.iconButton,Ie.markupIconButton],r=L;i&&n.push(this.state.primaryColorStyle);const a=[Ie.iconButton,Ie.markupIconButton],l=L;o&&a.push(this.state.primaryColorStyle);let d=s?j.getString("CapturePreview.CloseDrawAccessibilityLabel"):j.getString("CapturePreview.DrawAccessibilityLabel");d+=", "+j.getString(this.state.selectedColor.stringKey);const h=this.props.showSendButtonOnTop&&c.createElement(c.Animated.View,{style:[this._markupControlsAnimatedStyle,Ie.markupIconButton],key:"send"},this._renderSendButton());O=c.createElement(c.View,{style:Ie.topInnerControls},c.createElement(c.Animated.View,{style:this._markupControlsAnimatedStyle,key:"text"},c.createElement(U.default,{style:a,size:Te,onPress:this._onAddTextPressed,color:he.Color.white,hoverColor:he.Color.gray300,icon:pe.SkypeIcon.AddText,title:j.getString("CapturePreview.TextTitle"),iconTextStyle:l,showShadow:!o,accessibilityLabel:o?j.getString("CapturePreview.DoneAddingTextAccessibilityLabel"):j.getString("CapturePreview.AddTextAccessibilityLabel")})),c.createElement(c.Animated.View,{style:this._markupControlsAnimatedStyle,key:"stickers"},c.createElement(U.default,{ref:this._onStickerButtonRef,style:n,size:Te,onPress:this._onAddStickerPressed,color:he.Color.white,hoverColor:he.Color.gray300,icon:pe.SkypeIcon.StickersCamera,title:j.getString("CapturePreview.AddStickersTitle"),iconTextStyle:r,showShadow:!i,accessibilityLabel:i?j.getString("CapturePreview.CloseAddStickersAccessibilityLabel"):j.getString("CapturePreview.AddStickersAccessibilityLabel")})),c.createElement(c.Animated.View,{style:this._markupControlsAnimatedStyle,key:"draw"},c.createElement(U.default,{style:e,size:Te,onPress:this._onDrawButtonPressed,color:he.Color.white,hoverColor:he.Color.gray300,icon:pe.SkypeIcon.InfoStroke,title:j.getString("CapturePreview.DrawTitle"),iconTextStyle:t,showShadow:!s,accessibilityLabel:d})),h)}const D=[Ie.undoButtonContainer,this._undoAnimatedPositionStyle];this.state.markupMode===T.CaptureMarkupMode.Ink&&D.push(this._controlsAnimatedOpacityStyle);const V=c.createElement(c.Animated.View,{key:"undoContainer",style:D,ignorePointerEvents:!0},c.createElement(c.Animated.View,{style:this._undoAnimatedOpacityStyle,ignorePointerEvents:!0},c.createElement(U.default,{style:[Ie.iconButton,Ie.iconButtonBackground],size:Te,onPress:this.state.hasMarkup?this._onMarkupUndo:void 0,color:he.Color.white,hoverColor:he.Color.gray300,icon:this.state.markupMode===T.CaptureMarkupMode.Ink?pe.SkypeIcon.Undo:pe.SkypeIcon.Delete,title:j.getString("CapturePreview.UndoTitle"),iconTextStyle:L,showShadow:!0,flipIcon:this.state.markupMode===T.CaptureMarkupMode.Ink&&this._getContext().isRTL,key:"undo"})));let N;if(this.props.useCompactControls&&this.state.markupMode===T.CaptureMarkupMode.None)this.props.markupEnabled&&(N=c.createElement(c.View,{style:Ie.backButton}));else{const e=f?pe.IconSize.size20:pe.IconSize.size24;N=c.createElement(c.Animated.View,{key:"cancel",style:this._controlsAnimatedScaleStyle},c.createElement(U.default,{title:j.getString("Global.CancelLabel"),style:Ie.backButton,size:e,color:he.Color.white,hoverColor:he.Color.gray300,icon:this.props.iconForClose||ge.backIcon(),showShadow:!0,onPress:this._onCancelPressed,accessibilityLabel:j.getString("CapturePreview.BackAccessibilityLabel")}))}let H=this.props.useCompactControls?c.createElement(I.default,{key:"cancel",style:Ie.cancelButton,title:j.getString("Global.CancelLabel"),size:60,onPress:this._onCancelPressed,icon:pe.SkypeIcon.Undo,orientationIsLandscape:this.state.deviceOrientation===l.DeviceOrientation.Landscape}):void 0;const z=!F&&!H,W=[Ie.bottomControls];let G;if(this.state.sendButtonLabel||W.push(Ie.bottomControlsNoLabel),z&&W.push(Ie.bottomControlsSingle),this.props.useCompactControls&&this.props.centerCompactControls&&W.push(Ie.bottomControlsCompactCenter),this.state.safeAreaInsets.bottom&&W.push(oe.default.paddingBottomStyle(this.state.safeAreaInsets.bottom-10)),(this.state.safeAreaInsets.left||this.state.safeAreaInsets.right)&&W.push(oe.default.horizontalPaddingStyle(this.state.safeAreaInsets)),W.push(this._controlsAnimatedOpacityStyle),this.state.videoProcessingInProgress||this.state.overlayMode===be.Loading&&0===this.state.totalOverlayPages){let e;G=c.createElement(ce.default,{size:R.SXActivityIndicatorSize.Medium,tintColor:he.Color.white}),G=this.state.videoProcessingInProgress?c.createElement(c.Button,{style:Ie.spinner},G,e):c.createElement(c.View,{style:Ie.spinner},G,e)}let K,q=!this.props.showSendButtonOnTop&&this._renderSendButton();if(this.state.sendButtonLabel&&(q=c.createElement(c.View,{style:Ie.sendButtonWithLabelWrapper,ignorePointerEvents:!0,importantForAccessibility:c.Types.ImportantForAccessibility.No},c.createElement(c.Text,{style:[Ie.sendButtonLabel,Ie.shadow],numberOfLines:1,importantForAccessibility:c.Types.ImportantForAccessibility.No},this.state.sendButtonLabel),q)),this.props.opacityStyle&&(q=c.createElement(c.Animated.View,{style:[me.default.overflowVisible,this.props.opacityStyle]},q),H&&(H=c.createElement(c.Animated.View,{style:[this.props.opacityStyle,Ie.buttonWrapperForAccessibility],ignorePointerEvents:!0,importantForAccessibility:c.Types.ImportantForAccessibility.Yes},H))),F||H){const e=[Ie.leftButtonContainer];K=c.createElement(c.View,{style:e,ignorePointerEvents:!0},F,H)}const Q=[Ie.topControls,this._controlsAnimatedOpacityStyle];(this.state.safeAreaInsets.left||this.state.safeAreaInsets.right)&&Q.push(oe.default.horizontalPaddingStyle(this.state.safeAreaInsets));const X=N||O?c.createElement(c.Animated.View,{key:"topControls",style:Q,ignorePointerEvents:!0},undefined,N,O,undefined):void 0,$=[Ie.controlsShimInnerView,me.default.absoluteFill],J=[Ie.bottomControlsShimContainer,this._controlsAnimatedOpacityStyle];this.state.safeAreaInsets.bottom&&J.push(c.Styles.createViewStyle({height:100+this.state.safeAreaInsets.bottom},!1));const Y=c.createElement(c.Animated.View,{style:J,blockPointerEvents:!0},c.createElement(c.Image,{style:$,resizeMode:"stretch",source:h.Collection.PHOTO_SHIM})),Z=this.state.markupMode!==T.CaptureMarkupMode.Stickers?c.createElement(c.Animated.View,{key:"buttonsContainer",style:W,ignorePointerEvents:!0},K,q):void 0;let ee;if(this.state.markupMode===T.CaptureMarkupMode.Stickers){const e=[Ie.stickerMenu];this.state.safeAreaInsets.top&&e.push(c.Styles.createViewStyle({top:-1*this.state.safeAreaInsets.top,paddingTop:this.state.safeAreaInsets.top+60},!1)),ee=c.createElement(b.default,{style:e,onStickerSelected:this._onStickerSelected,onClose:this._onStickerMenuClose})}const te=this.state.showCoachmarks?c.createElement(k.CapturePreviewCoachmarks,{ref:this._onCoachmarksRef,getAnchorRect:this._onGetAnchorRect,supportedButtons:this._coachmarksButtonIds(),onDismiss:this._coachmarksViewed}):void 0,se=this.state.showCoachmarks?c.createElement(v.CaptureCoachmarksGestureView,{onDismiss:this._onCoachmarksDismiss}):void 0,ie=this.props.isAvatarPreview?c.createElement(c.View,{style:Ie.avatarOverlay,blockPointerEvents:!0},c.createElement(c.View,{style:Ie.avatarOverlayRow}),c.createElement(c.View,{style:Ie.avatarOverlayMaskRow},c.createElement(c.View,{style:Ie.avatarOverlayColumn}),c.createElement(c.Image,{style:this._useLargeAvatarOverlay(this.state.viewRect)?Ie.avatarOverlayMaskLarge:Ie.avatarOverlayMask,source:h.Collection.AVATAR_ROUND_MASK}),c.createElement(c.View,{style:Ie.avatarOverlayColumn})),c.createElement(c.View,{style:Ie.avatarOverlayRow})):void 0;let ne;if(!this.state.effectsFailed){const e=[Ie.pageIndicator];this.state.safeAreaInsets.bottom&&e.push(c.Styles.createViewStyle({bottom:this.state.safeAreaInsets.bottom},!1));const t=this.state.markupMode!==T.CaptureMarkupMode.Filters||this.state.overlayMode!==be.Indicator&&0===this.state.totalOverlayPages;ne=c.createElement(w.default,{ref:this._onCaptureOverlayPageIndicatorRef,style:e,hidden:t})}return c.createElement(c.View,{style:e},c.createElement(c.View,{style:Ie.container,onLayout:this._onContainerLayout},r,c.createElement(a.CaptureSnapshotView,{key:"snapshot",ref:this._onSnapshotRef,style:n,importantForAccessibility:this.state.markupMode===T.CaptureMarkupMode.Stickers?c.Types.ImportantForAccessibility.NoHideDescendants:void 0},d,u,S),ie,te,Y,ne,Z,V,ee,X,A,undefined,se,G))}_levelsOfUndo(){return this._undoLastSupported()?10:1}_getKeyboardInset(){return this.state.keyboardResizeMode===d.KeyboardAwareResizeMode.None?this.state.keyboardUpdateInfo.height:0}_getColorPaletteStyle(e){const t=[Ie.palette,this._colorPaletteAnimatedTransformStyle];return t.push(c.Styles.createViewStyle({bottom:e},!1)),t.push(this.state.deviceOrientation===l.DeviceOrientation.Landscape?Ie.paletteOffsetLandscape:Ie.paletteOffset),t}_getColorStyle(e){return c.Styles.createViewStyle({backgroundColor:e},!1)}_shouldShowColorPalette(e){return e.markupMode===T.CaptureMarkupMode.Ink||e.markupMode===T.CaptureMarkupMode.Text}_showOrHideControls(e,t=0){c.Animated.timing(this._controlsAnimatedOpacityValue,{toValue:e?1:0,duration:300,delay:t,easing:c.Animated.Easing.Linear()}).start(),this._showOrHideColorPalette(e,t)}_showOrHideColorPalette(e,t,s){e?c.Animated.timing(this._colorPaletteAnimatedTransformValue,{toValue:0+(this.state.safeAreaInsets.right>10?10-this.state.safeAreaInsets.right:0),duration:300,delay:t||0,easing:c.Animated.Easing.InOutBack(),useNativeDriver:!0}).start():c.Animated.timing(this._colorPaletteAnimatedTransformValue,{toValue:44,duration:200,delay:t||0,easing:c.Animated.Easing.Out(),useNativeDriver:!0}).start((e=>{this.isComponentMounted()&&s&&this.setState({showColorPalette:!1})}))}_dismissCoachmarks(){this._coachmarks&&this._coachmarks.dismiss()}_onAcceptInner(e){H.log(D.LogTraceArea.Capture,"CapturePreview _onAcceptInner causeId:"+e),K.default.removeToastMessage(Me),this.props.performMarkupOnly?this.props.localMediaIsVideo?this._saveVideo(!1,e).then((e=>{if(e.uri){const t=we({uri:e.uri,size:e.fileSize||this._nonNullFileSize(),type:"video",width:this.props.mediaWidth,height:this.props.mediaHeight});this.props.capturedContentHandler.handleCapturedContent([t],this.props.entryPoint,this.props.cameraMode)}this._onCaptureFlowComplete()}),(e=>{H.error(D.LogTraceArea.Capture,de.default.errorAsString(e)),this._onCaptureFlowComplete()})):this._snapShotImage().then((e=>{const t=we({uri:e,size:this._nonNullFileSize(),type:"image",width:this.props.mediaWidth,height:this.props.mediaHeight});this.props.capturedContentHandler.handleCapturedContent([t],this.props.entryPoint,this.props.cameraMode),this._onCaptureFlowComplete()}),(e=>{H.error(D.LogTraceArea.Capture,de.default.errorAsString(e)),this._onCaptureFlowComplete()})):this.props.skipShareWithPanel?this.props.conversationId&&this._postToConversation(this.props.conversationId,e):this._shouldSendOriginalMedia()&&this.props.mediaSelection?this.props.capturedContentHandler.handleMediaSelection(this.props.mediaSelection,!this.props.mediaSelection.node.node.isPhoto,e):this.props.localMediaIsVideo?this._saveVideo(!1,e).then((e=>{H.log(D.LogTraceArea.Capture,"CapturePreview video result "+i.pii.Omit(e.uri)+" "+(e.thumbnailUri?i.pii.Omit(e.thumbnailUri):"undefined"));const t=we({uri:e.uri,size:e.fileSize||this._nonNullFileSize(),type:"video",width:this.props.mediaWidth,height:this.props.mediaHeight});if(e.thumbnailUri){const s=(0,N.parseFileUri)(e.thumbnailUri),i=s?V.default.extractFileNameWithExtension(s.path):"";t.thumbnail={file:{uri:e.thumbnailUri,name:i,size:void 0,type:"image"},extension:V.default.extractFileExtension(i)}}this.props.capturedContentHandler.handleCapturedContent([t],this.props.entryPoint,this.props.cameraMode)}),(e=>H.error(D.LogTraceArea.Capture,de.default.errorAsString(e)))):this._snapShotImage().then((e=>{const t=we({uri:e,size:this.props.fileSize,type:"image",width:this.props.mediaWidth,height:this.props.mediaHeight});if(this.props.localMediaThumbnailUri){const e=(0,N.parseFileUri)(this.props.localMediaThumbnailUri),s=e?V.default.extractFileNameWithExtension(e.path):"";t.thumbnail={file:{uri:this.props.localMediaThumbnailUri,name:s,size:void 0,type:"image"},extension:V.default.extractFileExtension(s)}}this.props.capturedContentHandler.handleCapturedContent([t],this.props.entryPoint,this.props.cameraMode)}),(e=>H.error(D.LogTraceArea.Capture,de.default.errorAsString(e)))),this.setState({sendEnabled:!1})}handleBackAction(){return this._onCancelPressed()}_postToConversation(e,t){let s;H.log(D.LogTraceArea.Capture,"CapturePreview_postToConversation, conversationId: "+se.mriOrId(e)),s=this.props.localMediaIsVideo?this._sendCapturedVideo(e,t):this._sendCapturedPhoto(e,t),s.then((()=>{this._onCaptureFlowComplete()})).catch(o.noop)}_sendCapturedPhoto(e,t){if(e){if(H.log(D.LogTraceArea.Capture,"CapturePreview sending captured photo, conversationId: "+se.mriOrId(e)+" callId: "+this.props.callId+" causeId: "+t),this._shouldSendOriginalMedia()&&this.props.mediaSelection){const e=this._captureSessionTelemetry;return delete this._captureSessionTelemetry,this.props.capturedContentHandler.handleMediaSelection(this.props.mediaSelection,!1,t,e)}return this._snapShotImage().then((e=>{const s=we({uri:e,size:this.props.fileSize,type:"image",width:this.props.mediaWidth,height:this.props.mediaHeight});this.props.capturedContentHandler.handleCapturedContent([s],this.props.entryPoint,this.props.cameraMode),this._onAfterImagePosted(s.extension,t)}))}return H.log(D.LogTraceArea.Capture,"CapturePreview not sending captured photo (no conversation)"),u.Resolved()}_onAfterImagePosted(e,t){if(this.props.entryPoint!==D.PostSource.MessageComposer){const t=this.props.entryPoint===D.PostSource.MediaPicker?G.FilePickerOrigin.MediaPickerItem:G.FilePickerOrigin.CapturePreview;H.track(new G.FilesSentViaPicker(t,0,!1,[Se.default.changeExtensionForTelemetry(e)]))}this.props.callId?f.default.updateCallTelemetry(this.props.callId,t,(e=>e.postPhotoReaction())):(this._mediaSaved=!0,this._completeCaptureSession())}_sendCapturedVideo(e,t){if(e){if(this.props.mediaSelection&&this._shouldSendOriginalMedia()){const e=this._captureSessionTelemetry;return delete this._captureSessionTelemetry,this.props.capturedContentHandler.handleMediaSelection(this.props.mediaSelection,!0,t,e)}return this._saveVideo(this.state.sendOverlayAsMetadata,t).then((e=>{const t=e.uri;if(!t)return;if(!e.thumbnailUri)return;H.log(D.LogTraceArea.Capture,"CapturePreview sending video "+i.pii.Omit(t)+" thumbnail uri "+(e.thumbnailUri?i.pii.Omit(e.thumbnailUri):"undefined"));let s=this.props.mediaSelection&&this.props.mediaSelection.fileName;if(!s){const e=(0,N.parseFileUri)(t);s=e?V.default.extractFileNameWithExtension(e.path):""}const o={file:{uri:t,name:s,size:e.fileSize?e.fileSize:this.props.fileSize,type:"video/mp4"},extension:V.default.extractFileExtension(s),dimensions:{width:this.props.mediaWidth,height:this.props.mediaHeight},thumbnail:{file:{uri:e.thumbnailUri,name:V.default.extractFileName(s)+"-thumbnail.jpg",size:void 0,type:"image/jpg"},extension:"jpg",dimensions:{width:this.props.mediaWidth,height:this.props.mediaHeight}}};this.props.capturedContentHandler.handleCapturedContent([o],this.props.entryPoint,this.props.cameraMode,e.overlayUri);const n=this.props.entryPoint===D.PostSource.MediaPicker?G.FilePickerOrigin.MediaPickerItem:G.FilePickerOrigin.CapturePreview;H.track(new G.FilesSentViaPicker(n,0,!1,[Se.default.changeExtensionForTelemetry(o.extension)])),this._mediaSaved=!0,this._completeCaptureSession()}))}return H.log(D.LogTraceArea.Capture,"CapturePreview not sending captured video (no conversation)"),u.Resolved()}_savePhotoToCameraRoll(e){return H.log(D.LogTraceArea.Capture,"CapturePreview._savePhotoToCameraRoll causeId:"+e),this._shouldSendOriginalMedia()&&this.props.mediaSelection?(H.log(D.LogTraceArea.Capture,"CapturePreview._savePhotoToCameraRoll save original causeId:"+e),u.Resolved()):Z.default.requestCameraRollPermission().then((t=>(H.log(D.LogTraceArea.Capture,"CapturePreview._savePhotoToCameraRoll: Access allowed?",t?"yes":"no causeId:"+e),t?this._snapShotImage().then((e=>r.default.saveToCameraRoll(e))).then((()=>{H.log(D.LogTraceArea.Capture,"CapturePreview._savePhotoToCameraRoll toast causeId:"+e),K.default.scheduleTextMessage(j.getString("CapturePreview.PhotoSavedNotification"),void 0,this._getRootViewId())})):void 0)))}_saveVideoToCameraRoll(e){return H.log(D.LogTraceArea.Capture,"CapturePreview._saveVideoToCameraRoll causeId:"+e),this._shouldSendOriginalMedia()&&this.props.mediaSelection?(H.log(D.LogTraceArea.Capture,"CapturePreview._saveVideoToCameraRoll save original causeId:"+e),u.Resolved()):Z.default.requestCameraRollPermission().then((t=>(H.log(D.LogTraceArea.Capture,"CapturePreview._saveVideoToCameraRoll: Access allowed?",t?"yes":"no causeId:"+e),t?this._saveVideo(!1,e).then((t=>(H.log(D.LogTraceArea.Capture,"CapturePreview._saveVideoToCameraRoll result:"+(t.uri?"yes":"no")+" causeId:"+e),t.uri?r.default.saveToCameraRoll(t.uri):u.Rejected("no uri")))).then((()=>{H.log(D.LogTraceArea.Capture,"CapturePreview._saveVideoToCameraRoll toast causeId:"+e),K.default.scheduleTextMessage(j.getString("CapturePreview.VideoSavedNotification"),void 0,this._getRootViewId())})):void 0)))}_hasMarkup(e){return e.hasMarkup||e.hasText||e.hasStickers||e.hasOverlay}_shouldSendOriginalMedia(){return!(this.props.isRemotePicture||this.state.hasMarkup||this.state.hasText||this.state.hasStickers||this.state.hasOverlay||this.state.hasFilter)}_snapShotImage(){if(this._shouldSendOriginalMedia())return u.Resolved(this.props.localMediaObjectUri);return H.track(new _.MarkupAdded(this.props.entryPoint,this.state.hasMarkup,this.state.hasText,this.state.hasStickers,this.state.hasOverlay,this.state.hasFilter,this.state.stickerIds)),this._setCaptureSessionMarkupInfo(),ee.default.registerStickersInCapture(this.state.stickerIds),H.log(D.LogTraceArea.Capture,"CapturePreview snapshotting markup view"),this._imageWithLensPromise=u.Defer(),this._markupView.prepareForSnapshot().then((()=>this._snapShotView.takeSnapshot(this.props.localMediaObjectUri,{format:"jpeg",quality:.7}))).then((e=>(this._markupView&&(H.log(D.LogTraceArea.Capture,"CapturePreview restoring markup view"),this._markupView.restoreAfterSnapshot()),this._setLensSnapshot(void 0),this._imageWithLensPromise=void 0,e))).fail((e=>{H.error(D.LogTraceArea.Capture,de.default.errorAsString(e)),H.log(D.LogTraceArea.Capture,"CapturePreview snapshot failed"),this._markupView&&(H.log(D.LogTraceArea.Capture,"CapturePreview restoring markup view"),this._markupView.restoreAfterSnapshot()),this._setLensSnapshot(void 0),this._imageWithLensPromise=void 0}))}_snapShotVideoMarkup(){return this._hasMarkup(this.state)?(H.log(D.LogTraceArea.Capture,"CapturePreview snapshotting markup for video"),this._setCaptureSessionMarkupInfo(),ee.default.registerStickersInCapture(this.state.stickerIds),this._markupView.prepareForSnapshot().then((()=>this._snapShotView.takeSnapshot(void 0,{format:"png"}))).then((e=>(this._markupView&&(H.log(D.LogTraceArea.Capture,"CapturePreview restoring markup view"),this._markupView.restoreAfterSnapshot()),e)))):u.Resolved(this.props.localMediaObjectUri)}_setCaptureSessionMarkupInfo(){const e=this._captureSessionTelemetry;e&&(e.clearMarkup(),e.setInk(this.state.hasMarkup),e.setText(this.state.hasText),e.setStickers(this.state.hasStickers),e.setOverlay(this.state.hasOverlay),e.setFilter(this.state.hasFilter),e.setStickerIds(this.state.stickerIds),this._setCaptureSessionStickerNames())}_setCaptureSessionStickerNames(){const e=this._captureSessionTelemetry;if(e){let t=[],s=[];o.each(this._stickerNames,(e=>{e.tabTitle&&t.push(e.tabTitle.toLowerCase()),e.stickerName&&s.push(e.stickerName.toLowerCase())})),e.setTabNames(t),e.setStickerNames(s)}}_completeCaptureSession(){const e=this._captureSessionTelemetry;e&&(e.setMediaSentStatus(this._mediaSaved),e.setAddStickersClickCount(this._addStickersClickCount),H.track(e),delete this._captureSessionTelemetry),this._mediaSaved=!1}_saveVideo(e,t){if(this._shouldSendOriginalMedia()||!this._videoMarkupSupported())return u.Resolved({uri:this.props.localMediaObjectUri,thumbnailUri:this.props.localMediaThumbnailUri});return this.setState({videoProcessingInProgress:!0}),this._snapShotVideoMarkup().then((s=>e?u.Resolved({uri:this.props.localMediaObjectUri,thumbnailUri:this.props.localMediaThumbnailUri,overlayUri:s}):_e.default.saveVideoWithoutView(this.props.localMediaObjectUri,s,ve.default.reencodeOptions(),t,undefined).manipulationPromise)).then((e=>(this.setState({videoProcessingInProgress:!1}),e))).catch((e=>(H.error(D.LogTraceArea.Capture,de.default.errorAsString(e)),H.log(D.LogTraceArea.Capture,`CapturePreview saveVideo error causeId: ${t}`),this.setState({videoProcessingInProgress:!1}),u.Resolved({uri:this.props.localMediaObjectUri,thumbnailUri:this.props.localMediaThumbnailUri}))))}_setLensSnapshot(e){this.isComponentMounted()&&this.setState({lensSnapshot:e})}_useLargeAvatarOverlay(e){return e.width>500&&e.height>500}_avatarOverlayHeight(e){return this._useLargeAvatarOverlay(e)?500:250}_avatarOverlayWidth(e){return this._useLargeAvatarOverlay(e)?500:250}_getSnapshotRect(e){let t;t=this.props.isAvatarPreview?{height:this._avatarOverlayHeight(e),width:this._avatarOverlayWidth(e)}:this._getProjectedDimensions({width:this.props.mediaWidth,height:this.props.mediaHeight},e);let s=(e.height-t.height)/2;return!this.props.isAvatarPreview&&e.height-t.height<=150&&s>0&&(s=0),{height:t.height,width:t.width,x:(e.width-t.width)/2,y:s}}_getProjectedDimensions(e,t,s){const i=e.width/t.width,o=e.height/t.height,n=s?Math.min(i,o):Math.max(i,o),r=e.width/n,a=e.height/n;return{height:this.props.isAvatarPreview?a:Math.ceil(a),width:this.props.isAvatarPreview?r:Math.ceil(r)}}_getSnapshotContainerStyle(){return c.Styles.createViewStyle({position:"absolute",height:this.state.snapShotRect.height,width:this.state.snapShotRect.width,top:this.state.snapShotRect.y,left:this.state.snapShotRect.x,overflow:"visible"},!1)}_coachmarksButtonIds(){return this.props.conversationId?[k.CapturePreviewButtonId.Send]:[k.CapturePreviewButtonId.HubSend]}_videoMarkupSupported(){return!!this.state.alwaysEnableVideoMarkup||this._isNativeMobile&&!this.props.performMarkupOnly&&this.state.videoMarkupFXEnabled&&this.props.entryPoint===D.PostSource.Capture}_undoLastSupported(){return this._isNativeMobile}_isMediaSelectionGif(){return this.props.fileExtension&&V.default.isGifImageExtension(this.props.fileExtension)||!!this.props.mediaSelection&&!!this.props.mediaSelection.node.node.image&&V.default.getFileContentType(this.props.mediaSelection.node.node.image.uri)===V.default.imageContentTypes.gif}_getDefaultMarkupMode(e){return e.effectsEnabled?T.CaptureMarkupMode.Filters:T.CaptureMarkupMode.None}_nonNullFileSize(){return this.props.fileSize}}t.default=Pe},45887:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CapturePreviewCoachmarks=t.CapturePreviewButtonId=void 0;const i=s(96486),o=s(16778),n=s(70857),r=s(2860),a=s(33754);var l;!function(e){e[e.Send=0]="Send",e[e.HubSend=1]="HubSend"}(l=t.CapturePreviewButtonId||(t.CapturePreviewButtonId={}));class d extends n.CaptureCoachmarksBase{constructor(){super(...arguments),this._onContainerLayout=e=>{const t={width:e.width,height:e.height};this.setState({viewDimensions:t})}}_buildState(e,t){let s={};return t&&(s.viewDimensions={width:0,height:0}),s}_renderCoachmarks(){return i.map(this.props.supportedButtons,(e=>this._renderCoachmark(e)))}_renderCoachmark(e){let t,s,i=r.CoachmarkAlignment.Center;const n=this.state.viewDimensions.width>this.state.viewDimensions.height;switch(e){case l.Send:t=a.getString("CapturePreview.SendButtonTooltip"),s=80,i=r.CoachmarkAlignment.Right;break;case l.HubSend:t=a.getString("CapturePreview.HubSendButtonTooltip"),s=n?80:140,i=r.CoachmarkAlignment.Right}return o.createElement(r.Coachmark,{key:"coachmark"+e,alignment:i,direction:r.CoachmarkDirection.Down,displayText:t,height:s,viewDimensions:this.state.viewDimensions,getAnchorRect:this.props.getAnchorRect?()=>this.props.getAnchorRect(e):void 0})}}t.CapturePreviewCoachmarks=d,t.default=d},16184:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(51885);class n extends o.CaptureOverlayView{_renderContent(){}_imageStyle(){return i.Styles.createViewStyle({position:"absolute",top:this.props.topOffset?Math.min(0,this.props.topOffset):0,left:0,right:0,bottom:0},!1)}}t.default=n},2860:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Coachmark=t.CoachmarkAlignment=t.CoachmarkDirection=void 0;const i=s(16778),o=s(88837),n=s(46096),r=s(36237),a=s(61253),l=s(15877),d=s(4057),c=s(81760),h=s(40363),u=s(80837),p=s(19675),g=s(12770);var m,S;!function(e){e[e.Down=0]="Down",e[e.Up=1]="Up",e[e.Left=2]="Left",e[e.Right=3]="Right"}(m=t.CoachmarkDirection||(t.CoachmarkDirection={})),function(e){e[e.Center=0]="Center",e[e.Left=1]="Left",e[e.Right=2]="Right"}(S=t.CoachmarkAlignment||(t.CoachmarkAlignment={}));const f=300,y=100,_=(0,l.lazyProperties)({verticalLine:()=>i.Styles.createViewStyle({flex:1,width:1,backgroundColor:c.Color.white}),horizontalLine:()=>i.Styles.createViewStyle({flex:1,height:1,backgroundColor:c.Color.white}),dimmedBack:()=>i.Styles.createViewStyle({opacity:.55}),alignItemsLeft:()=>i.Styles.createViewStyle({alignItems:"flex-start"}),alignItemsRight:()=>i.Styles.createViewStyle({alignItems:"flex-end"}),textAlignLeft:()=>i.Styles.createTextStyle({textAlign:"left"}),textAlignRight:()=>i.Styles.createTextStyle({textAlign:"right"}),textAlignCenter:()=>i.Styles.createTextStyle({textAlign:"center"})});class v extends o.ComponentBase{constructor(){super(...arguments),this._animatedOpacityValue=new i.Animated.Value(0),this._animatedOpacityStyle=i.Styles.createAnimatedViewStyle({opacity:this._animatedOpacityValue})}_buildState(e,t){return{}}componentDidMount(){super.componentDidMount(),this._animatedOpacityValue.setValue(this.state.anchorPoint?1:0),this._updateAnchorPoint()}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),(0,a.default)(e.viewDimensions,this.props.viewDimensions)||this._updateAnchorPoint(),(0,a.default)(t.anchorPoint,this.state.anchorPoint)||i.Animated.timing(this._animatedOpacityValue,{toValue:this.state.anchorPoint?1:0,duration:this.state.anchorPoint?350:0,easing:i.Animated.Easing.Linear()}).start()}_updateAnchorPoint(){this._clearAnchorPoint(),g.default.setTimeout((()=>{this.isComponentMounted()&&this.props.getAnchorRect&&this.props.getAnchorRect().then((e=>{if(!this.isComponentMounted())return;let t;this._isHorizontal(this.props.direction)?(t={x:e.x,y:e.y+e.height/2},this.props.direction===m.Left&&(t.x+=e.width)):(t={x:e.x+e.width/2,y:e.y},this.props.direction===m.Up&&(t.y+=e.height)),this.setState({anchorPoint:t})}),(e=>r.error(n.LogTraceArea.Capture,d.default.errorAsString(e))))}),this.props.presentationDelay||500)}_clearAnchorPoint(){this.setState({anchorPoint:void 0})}_renderCoachmark(){const e=i.createElement(p.BodyText,{bold:!0,size:p.BodyTextSize.SmallDeprecated,style:this._coachmarkTextStyle()},this.props.displayText),t=i.createElement(i.View,{style:this._isHorizontal(this.props.direction)?_.horizontalLine:_.verticalLine}),s=this.props.direction===m.Up||this.props.direction===m.Left;return i.createElement(i.View,{style:this._coachmarkStyle()},s?t:e,s?e:t)}_containerStyle(){if(!this.state.anchorPoint)return;const e=h.default.isRTL();if(this._isHorizontal(this.props.direction)){const t=this.state.anchorPoint.y-50;let s=this.state.anchorPoint.x;const o=this.props.anchorPadding||6;return this.props.direction!==m.Right||e?s+=o:s-=(this.props.height||f)+o+160,e?i.Styles.createViewStyle({position:"absolute",right:s,top:t,overflow:"visible"},!1):i.Styles.createViewStyle({position:"absolute",left:s,top:t,overflow:"visible"},!1)}let t=this.state.anchorPoint.x;this.props.alignment===S.Center?t-=(this.props.width||f)/2:this.props.alignment!==S.Right||e||(t-=this.props.width||f);let s=this.state.anchorPoint.y;const o=this.props.anchorPadding||6;return this.props.direction===m.Down?s-=(this.props.height||y)+o:s+=o,e?i.Styles.createViewStyle({position:"absolute",right:t,top:s,overflow:"visible"},!1):i.Styles.createViewStyle({position:"absolute",left:t,top:s,overflow:"visible"},!1)}_coachmarkStyle(){return this._isHorizontal(this.props.direction)?[i.Styles.createViewStyle({height:y,width:(this.props.height||f)+160,flexDirection:"row",overflow:"visible"},!1),this._getAlignItemsStyle()]:[i.Styles.createViewStyle({width:this.props.width||f,height:this.props.height||y,overflow:"visible"},!1),this._getAlignItemsStyle()]}_coachmarkTextStyle(){const e=this._isHorizontal(this.props.direction);return[i.Styles.createTextStyle({color:c.Color.white,width:e?160:this.props.width||250,paddingVertical:e?0:8,paddingHorizontal:e?8:0,backgroundColor:c.Color.transparent},!1),this._getTextAlignStyle()]}_getTextAlignStyle(){if(this._isHorizontal(this.props.direction))return this.props.direction===m.Right?_.textAlignRight:_.textAlignLeft;switch(this.props.alignment){case S.Center:return _.textAlignCenter;case S.Left:return _.textAlignLeft;case S.Right:return _.textAlignRight}}_getAlignItemsStyle(){if(this._isHorizontal(this.props.direction))return u.default.alignItemsCenter;switch(this.props.alignment){case S.Center:return u.default.alignItemsCenter;case S.Left:return _.alignItemsLeft;case S.Right:return _.alignItemsRight}}_isHorizontal(e){return e===m.Left||e===m.Right}render(){if(!this.state.anchorPoint)return null;const e=[],t=this._containerStyle();return t&&e.push(t),this.props.dimmedBack&&e.push(_.dimmedBack),i.createElement(i.View,{style:e},i.createElement(i.Animated.View,{style:[u.default.overflowVisible,this._animatedOpacityStyle]},this._renderCoachmark()))}}t.Coachmark=v,t.default=v},30886:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(67930),n=s(95359),r=s(74470),a=s(46096),l=s(11375),d=s(36237),c=s(4735),h=s(53374);var u;!function(e){e[e.Capture=0]="Capture",e[e.Preview=1]="Preview"}(u||(u={}));class p extends o.default{constructor(){super(...arguments),this._closePanelAndCleanTempFile=()=>{this._closePanel()},this._closePanel=()=>{const e=h.default.newCauseId();d.log(a.LogTraceArea.Capture,"DesktopCaptureComboView._closePanel causeId: "+e),c.default.goBack(e,this._getContext())},this._onRecordingCompleted=(e,t,s,i)=>{this.setState({mode:u.Preview,previewUrl:e,previewBlob:t,videoDuration:s,transactionId:i})},this._recordAgain=()=>{this.setState({mode:u.Capture})}}_buildState(e,t){let s={};return t&&(s.mode=u.Capture),s}_getHeaderText(e){}render(){switch(this.state.mode){case u.Capture:return i.createElement(n.default,{conversationId:this.props.conversationId,onCloseButtonPress:this._closePanelAndCleanTempFile,onRecordingCompleted:this._onRecordingCompleted});case u.Preview:return i.createElement(r.default,{conversationId:this.props.conversationId,previewUrl:this.state.previewUrl,blob:this.state.previewBlob,duration:this.state.videoDuration,closePanel:this._closePanel,recordAgain:this._recordAgain,transactionId:this.state.transactionId,onShareComplete:this.props.onShareComplete});default:return null}}componentWillUnmount(){super.componentWillUnmount(),l.setFocusWithDelay(l.FocusEvent.VideoMessageClosed,250)}}t.default=p},95359:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(74958),o=s(96486),n=s(45961),r=s(62897),a=s(16778),l=s(44770),d=s(19784),c=s(89391),h=s(67930),u=s(72675),p=s(11009),g=s(16402),m=s(80814),S=s(84817),f=s(52262),y=s(70891),_=s(46096),v=s(45381),C=s(13944),b=s(36237),T=s(15877),M=s(33754),I=s(86045),w=s(4057),P=s(81760),k=s(40363),A=s(11010),E=s(11828),R=s(80837),L=s(19675),F=s(12770),x=s(53374),O=s(3729),D=s(3230),B=(0,T.lazyProperties)({cameraContainer:()=>a.Styles.createViewStyle({flex:1,alignSelf:"stretch",backgroundColor:P.Color.black}),flippedView:()=>a.Styles.createViewStyle({flex:1,alignSelf:"stretch",transform:[{rotateY:"-180"}]}),overlayContainer:()=>a.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:P.Color.transparent}),controlsContainer:()=>a.Styles.createViewStyle({flex:1,alignItems:"flex-end",justifyContent:"center",flexDirection:"row",paddingHorizontal:20,paddingBottom:40}),headerRow:()=>a.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"flex-start",alignContent:"center",flexDirection:"row"}),closeButton:()=>a.Styles.createScrollViewStyle({paddingRight:20}),headerContainer:()=>a.Styles.createViewStyle({top:0,left:0,right:0,paddingVertical:20,paddingLeft:20}),conversationNameTextStyle:()=>a.Styles.createTextStyle({color:P.Color.white,overflow:"hidden",flex:1}),durationTextStyle:()=>a.Styles.createTextStyle({color:P.Color.whiteOverlay50,paddingLeft:46}),noPreviewContainer:()=>a.Styles.createViewStyle({backgroundColor:P.Color.black}),noPreviewTextContainer:()=>a.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,flexDirection:"row",alignItems:"center",alignContent:"center",justifyContent:"center"}),noPreviewTextStyle:()=>a.Styles.createTextStyle({fontSize:A.default.controlFontSize.headerSizeSmall,fontFamily:A.default.fontFamily.uidDisplayRegular,color:P.Color.white,overflow:"hidden",textAlign:"center",flex:1})});class V extends h.default{constructor(){super(...arguments),this._onCameraFailure=e=>{b.error(_.LogTraceArea.Capture,"DesktopCapturePanel._onCameraFailure "+i.pii.Omit(e.failure)),b.track(new u.CameraFailureEvent(e.failure,"Desktop",e.details)),e.failure!==n.CameraPreviewFailureErrorOnStart&&e.failure!==n.CameraPreviewFailureNoCamera||(this.state.isVisible&&d.default.showOKAlert(M.getString("CapturePreview.UnableToOpenCamera"),M.getString("CapturePreview.UnableToOpenCameraDescription"),this._getRootViewId()),this._closePanel())},this._toolTipAnimationConfig={presentOffset:{x:0,y:15},dismissOffset:{x:0,y:5},duration:250,easing:a.Animated.Easing.OutBack()},this._previewCallback=(e,t)=>{if(this.isComponentMounted()){if(!e&&!t)return void this._onCameraFailure({source:"VimService.startPreview",failure:n.CameraPreviewFailureErrorOnStart});this.setState({previewUrl:e,previewStream:t,isInitializingDevice:!1,startPreviewOnMount:!0})}},this._onRecordButtonRef=e=>{this._recordButton=e||void 0,this._recordButton&&o.delay((()=>{if(!this.isComponentMounted())return;const e=M.getString("CapturePreview.ReadyToRecord"),t={getElement:()=>this._recordButton,positions:[p.PopupAnchorPositon.Top,p.PopupAnchorPositon.Bottom],title:e,durationMs:3e3,anchorAccessibilityLabel:e,instanceId:"recordbutton",rootViewId:this._getRootViewId()};this.setState({toolTipInfo:t})}),1e3)},this._onCloseButtonPress=e=>{e.stopPropagation(),this._closePanel()},this._onRef=e=>{this._videoRef=e||void 0,this._videoRef&&this.state.startPreviewOnMount&&(this._videoRef.play(),this._videoRef.mute(!0))},this._onRecordButtonPress=e=>{if(this.state.isRecording)this._stopRecording();else{this.setState({isRecording:!0}),this._videoRecordingStartTime=Date.now(),this._startRecordingTimer();try{r.default.startRecording()}catch(e){b.error(_.LogTraceArea.Capture,"Desktop VIM unable to start recording.",w.default.errorAsString(e))}}},this._recordBlobCallback=(e,t)=>{this._recordUrl=t,b.log(_.LogTraceArea.Capture,"Desktop captured blob "+(this._recordUrl?i.pii.Omit(this._recordUrl):"undefined")),this._videoRef?this._videoRef.stop():b.warn(_.LogTraceArea.Capture,"Desktop record callback with undefined video reference."),this.isComponentMounted()&&this.setState({previewUrl:void 0,previewStream:void 0,isProcessingVideo:!1});const s=Date.now()-this._videoRecordingStartTime,o=new D.RecordEvent(s,e.size);if(this._recordUrl){const t=x.default.newGuid();o.setStatus(!0,t),b.track(o),this.props.onRecordingCompleted(this._recordUrl,e,s,t)}else{const e="Desktop record callback with undefined recording URL.";b.warn(_.LogTraceArea.Capture,e),o.setStatus(!1,void 0,e),b.track(o),this.setState({failedToRecord:!0})}}}_buildState(e,t){let s={};const i=c.default.getS4LCMCFeatures();if(t){s.isInitializingDevice=!0,s.cameraLabel=S.default.getSelectedCameraID(),s.microphoneLabel=S.default.getSelectedMicID(),s.videoProfile=i.videoProfile,s.maxRecordingMs=i.maxRecordingMs;try{r.default.startPreview(this._previewCallback,s.cameraLabel,s.microphoneLabel),s.startPreviewOnMount=!0}catch(e){b.error(_.LogTraceArea.Capture,"Desktop VIM unable to start camera preview.",w.default.errorAsString(e)),s.startPreviewOnMount=!1}s.isRecording=!1,s.recordedVideoDuration=0,s.isVisible=!1,e.conversationId&&(s.conversationName=f.default.getDisplayName(e.conversationId)),s.toolTipInfo=void 0,s.failedToRecord=!1,s.isProcessingVideo=!1}return s}_getHeaderText(e){}componentWillUnmount(){super.componentWillUnmount(),this.setState({isVisible:!1}),this._stopRecordingTimer(),r.default.stopPreview(),this._videoRef&&this._videoRef.stop()}componentDidMount(){super.componentDidMount(),this.setState({isVisible:!0})}render(){const e=this.state.isRecording||this.state.isProcessingVideo?void 0:a.createElement(v.default,{toolTipInfo:this.state.toolTipInfo,animateDismissal:!0,animationConfig:this._toolTipAnimationConfig,containerOffsetY:7});if(this.state.previewUrl||this.state.previewStream){const t=a.createElement(O.default,{origin:"desktop-capture-panel",ref:this._onRef,source:this.state.previewUrl,sourceObj:this.state.previewStream,style:B.cameraContainer,resizeMode:"cover",mediaProvider:y.MediaProvider.Capture,ariaHidden:!0});return a.createElement(a.View,{style:B.overlayContainer},a.createElement(a.View,{style:B.flippedView},t),a.createElement(a.View,{style:R.default.absoluteFill},this._getCapturePanelHeader(),this._getCapturePanelControls()),e)}return this.state.isInitializingDevice?null:a.createElement(a.View,{style:[B.overlayContainer,B.noPreviewContainer]},a.createElement(a.View,{style:B.noPreviewTextContainer},a.createElement(a.Text,{style:B.noPreviewTextStyle,numberOfLines:1},M.getString(this.state.failedToRecord?"CapturePreview.UnableToRecord":"CapturePreview.NoWebCamAvailable"))),this._getCapturePanelHeader())}_closePanel(){this.setState({isVisible:!1}),r.default.stopPreview(),this.props.onCloseButtonPress()}_getCapturePanelHeader(){const e=c.default.getS4LUiFeaturesNoSubscription().enableWindowRightClose&&k.default.isWindowCloseOnRight();let t,s,i=a.createElement(C.default,{onPress:this._onCloseButtonPress,style:B.closeButton,size:E.IconSize.size24,color:P.Color.whiteOverlay90,hoverColor:P.Color.white,icon:E.SkypeIcon.ClosePanel,title:M.getString("Global.CloseButtonTitle"),importantForAccessibility:a.Types.ImportantForAccessibility.Yes});return this.state.conversationName&&(t=a.createElement(a.Text,{style:[A.default.fontStyle.messagingHeader,B.conversationNameTextStyle],numberOfLines:1},this.state.conversationName)),this.state.isRecording&&this.state.recordedVideoDuration&&(s=a.createElement(L.Subtitle,{style:B.durationTextStyle},g.default.getElapsedTimeStringFromMs(this.state.recordedVideoDuration))),a.createElement(a.View,{style:B.headerContainer},a.createElement(a.Image,{style:B.overlayContainer,resizeMode:"stretch",source:l.Collection.PHOTO_SHIM}),a.createElement(a.View,{style:B.headerRow},e?void 0:i,t,e?i:void 0),s)}_getCapturePanelControls(){const e=this.state.isRecording&&this.state.recordedVideoDuration?this.state.recordedVideoDuration/this.state.maxRecordingMs:void 0,t=a.createElement(m.default,{ref:this._onRecordButtonRef,showProgressIndicator:this.state.isRecording,progress:e,onPress:this._onRecordButtonPress});return a.createElement(a.View,{style:B.controlsContainer},t)}_startRecordingTimer(){this._timerToken||(this._timerToken=F.default.setInterval((()=>{const e=Date.now()-this._videoRecordingStartTime;e>=this.state.maxRecordingMs&&this._stopRecording(),this.setState({recordedVideoDuration:e})}),1e3))}_stopRecordingTimer(){this._timerToken&&(F.default.clearInterval(this._timerToken),this._timerToken=void 0)}_stopRecording(){I.default.maybeAnnounceForAccessibility("CapturePreview.RecordingSuccessful"),r.default.stopRecording((e=>{this._recordUrl=r.default.getRecordedVideoBlob(this._recordBlobCallback)})),r.default.stopPreview(),this._stopRecordingTimer(),this.setState({isRecording:!1,isProcessingVideo:!0})}}t.default=V},5805:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DesktopCapturePreview=void 0;const i=s(96486),o=s(16778),n=s(4736),r=s(67930),a=s(11009),l=s(52262),d=s(45381),c=s(15877),h=s(33754),u=s(81760),p=s(11828),g=(0,c.lazyProperties)({controlsContainer:()=>o.Styles.createViewStyle({flex:1,alignItems:"flex-end",justifyContent:"center",flexDirection:"row",paddingHorizontal:20,paddingBottom:40}),overlayContainer:()=>o.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:u.Color.black})});class m extends r.default{constructor(){super(...arguments),this._toolTipAnimationConfig={presentOffset:{x:0,y:15},dismissOffset:{x:0,y:5},duration:250,easing:o.Animated.Easing.OutBack()},this._onSendButtonRef=e=>{this._sendButton=e||void 0,this._sendButton&&i.delay((()=>{if(!this.isComponentMounted())return;const e=h.getString("CapturePreview.SendTitle"),t={getElement:()=>this._sendButton,positions:[a.PopupAnchorPositon.Top,a.PopupAnchorPositon.Bottom],title:e,durationMs:3e3,anchorAccessibilityLabel:e,instanceId:"sendbutton",rootViewId:this._getRootViewId()};this.setState({toolTipInfo:t})}),1e3)},this._triggerOnSendButtonPress=()=>{this._onSendButtonPress()},this._triggerOnCloseButtonPress=()=>{this._onCloseButtonPress()}}_buildState(e,t){let s={};return e.conversationId&&t&&(s.conversationName=l.default.getDisplayName(e.conversationId)),s.toolTipInfo=void 0,s}render(){const e=o.createElement(d.default,{toolTipInfo:this.state.toolTipInfo,animateDismissal:!0,animationConfig:this._toolTipAnimationConfig,containerOffsetY:7});return o.createElement(o.View,{style:g.overlayContainer},this.renderCapturedMediaContent(),this.renderCapturedMediaControls(),e)}renderCapturePreviewDefaultControls(){const e=o.createElement(n.default,{ref:this._onSendButtonRef,size:n.ActionButtonSize.Default,title:h.getString("CapturePreview.SendTitle"),onPress:this._triggerOnSendButtonPress,icon:p.SkypeIcon.Send,autoFocus:!0,importantForAccessibility:o.Types.ImportantForAccessibility.Yes});return o.createElement(o.View,{style:g.controlsContainer},e)}}t.DesktopCapturePreview=m},80814:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(88837),n=s(15877),r=s(33754),a=s(11397),l=s(81760),d=s(11828),c=d.IconSize.size60,h=d.IconSize.size24,u=(0,n.lazyProperties)({outerContainerCircle:()=>i.Styles.createViewStyle({width:c,height:c,borderRadius:c/2,backgroundColor:l.Color.white}),innerContainerCircle:()=>i.Styles.createViewStyle({width:h,height:h,borderRadius:h/2,borderColor:l.Color.white,borderWidth:2,backgroundColor:l.Color.red}),outerContainerCircleRecording:()=>i.Styles.createViewStyle({width:c,height:c,borderRadius:c/2,backgroundColor:l.Color.red}),innerContainerCircleRecording:()=>i.Styles.createViewStyle({width:h,height:h,borderRadius:h/3,borderColor:l.Color.white,borderWidth:2,backgroundColor:l.Color.white}),innerContainerAbsolute:()=>i.Styles.createViewStyle({position:"absolute",top:(c-h)/2,left:(c-h)/2}),progessIndicator:()=>i.Styles.createImageStyle({position:"absolute",width:c,height:c,backgroundColor:l.Color.transparent})});class p extends o.ComponentBase{render(){let e=null,t=u.outerContainerCircle,s=u.innerContainerCircle;if(this.props.showProgressIndicator&&this.props.progress&&this.props.progress>0){const o={fillOpacity:0,strokeOpacity:1,strokeColor:l.Color.whiteOverlay90,fillColor:l.Color.transparent,strokeWidth:2};e=i.createElement(a.default,{style:u.progessIndicator,progress:this.props.progress,size:c,progressStrokeProperties:o}),t=u.outerContainerCircleRecording,s=u.innerContainerCircleRecording}return i.createElement(i.Button,{style:t,onPress:this.props.onPress,autoFocus:!0,title:r.getString("CapturePreview.StartAndStopRecordingButton"),importantForAccessibility:i.Types.ImportantForAccessibility.Yes},e,i.createElement(i.View,{style:[u.innerContainerAbsolute,s]}))}}t.default=p},74470:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(74958),o=s(96486),n=s(33010),r=s(62520),a=s(16778),l=s(44770),d=s(89391),c=s(5805),h=s(70891),u=s(46096),p=s(53559),g=s(13944),m=s(10117),S=s(36237),f=s(61253),y=s(15877),_=s(33754),v=s(85207),C=s(15963),b=s(86045),T=s(10265),M=s(81760),I=s(40363),w=s(11010),P=s(11828),k=s(34528),A=s(3729),E=s(3230),R=P.IconSize.size60,L=(0,y.lazyProperties)({playButtonborderStyle:()=>a.Styles.createViewStyle({position:"absolute",alignItems:"center",justifyContent:"center",borderRadius:R/2,borderStyle:"solid",borderWidth:2,borderColor:M.Color.white,width:R,height:R,backgroundColor:M.Color.blackOverlay20}),cameraContainer:()=>a.Styles.createViewStyle({position:"absolute",flex:1,alignSelf:"stretch"}),overlayContainer:()=>a.Styles.createViewStyle({position:"absolute",alignItems:"center",justifyContent:"center",top:0,left:0,right:0,bottom:0}),headerContainer:()=>a.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,paddingVertical:20,paddingLeft:20}),conversationNameTextStyle:()=>a.Styles.createTextStyle({color:M.Color.white,overflow:"hidden",flex:1}),controls:()=>a.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),topControls:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"flex-start",justifyContent:"center"}),centerControls:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",justifyContent:"center",overflow:"visible"}),bottomControls:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"flex-end",justifyContent:"center"}),playButtonContainer:()=>a.Styles.createViewStyle({marginTop:50}),closeButton:()=>a.Styles.createScrollViewStyle({paddingRight:20}),headerRow:()=>a.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"flex-start",alignContent:"center",flexDirection:"row"})});class F extends c.DesktopCapturePreview{constructor(){super(...arguments),this._onContainerLayout=e=>{this.isComponentMounted()&&!(0,f.default)(e,this.state.viewRect)&&this.setState({viewRect:e})},this._closePanelAndCleanTempFile=()=>{this.props.closePanel()},this._closeConfirmCancelDialog=()=>{this.isComponentMounted()&&this.setState({showConfirmCancelDialog:!1})},this._onPlayPausePress=()=>{this._videoRef&&(S.log(u.LogTraceArea.Capture,"DesktopCaptureVideoPreview play/pause pressed"),this.state.videoPlaying?(this.setState({videoPlaying:!1}),this._videoRef.pause()):(this.setState({videoPlaying:!0}),this._videoRef.play()))},this._onPlayEnd=()=>{this._videoRef&&this.isComponentMounted()&&this.setState({videoPlaying:!1})},this._announceForAccessibilityForMessageSent=()=>{b.default.maybeAnnounceForAccessibility(_.getString("MessageComposer.MessageSentLabel"),0)},this._onRef=e=>{this._videoRef=e||void 0}}_buildState(e,t){let s=Object.assign({},super._buildState(e,t));return t&&(s.videoPlaying=!1,s.showConfirmCancelDialog=!1,s.viewRect={x:0,y:0,height:0,width:0}),s}renderCapturedMediaContent(){return this.props.previewUrl?a.createElement(a.View,{style:[L.overlayContainer],onLayout:this._onContainerLayout},a.createElement(A.default,{origin:"desktop-capture-panel",ref:this._onRef,onEnded:this._onPlayEnd,source:this.props.previewUrl,style:L.cameraContainer,resizeMode:"cover",mediaProvider:h.MediaProvider.Preview})):null}_getHeaderText(e){}renderCapturedMediaControls(){const e=this.state.videoPlaying?P.SkypeIcon.Pause:P.SkypeIcon.Play,t=this.state.videoPlaying?_.getString("MediaViewer.Pause"):_.getString("MediaViewer.Play"),s=a.createElement(a.Button,{style:[L.playButtonborderStyle,L.playButtonContainer],onPress:this._onPlayPausePress,accessibilityLabel:t,importantForAccessibility:a.Types.ImportantForAccessibility.Yes},a.createElement(m.default,{icon:e,size:P.IconSize.size24,color:M.Color.white})),i=this.renderHeader(),o=this.renderCapturePreviewDefaultControls();let n=a.createElement(a.View,{style:L.controls},a.createElement(a.View,{style:L.topControls},i),a.createElement(a.View,{style:L.centerControls},s),a.createElement(a.View,{style:L.bottomControls},o));return this.state.showConfirmCancelDialog&&(n=this._renderConfirmCancelDialog()),a.createElement(a.View,{style:L.overlayContainer},n)}_renderConfirmCancelDialog(){let e=_.getString("CapturePreview.DiscardVideoMessageTitle"),t=_.getString("CapturePreview.DiscardVideoMessageText");const s=[{text:_.getString("CapturePreview.KeepVideoMessage"),isCancel:!0,onPress:this._closeConfirmCancelDialog},{text:_.getString("CapturePreview.CancelVideoMessage"),onPress:this._closePanelAndCleanTempFile},{text:_.getString("CapturePreview.RerecordVideoMessage"),isSubmit:!0,onPress:this.props.recordAgain}];return a.createElement(T.default,{dialogId:"confirmCancelDialog",closeOnClickOutside:!1,text:e,simpleContent:t,buttons:s,accessibilityLabel:t})}componentWillUnmount(){super.componentWillUnmount(),this._videoRef&&this._videoRef.stop()}renderHeader(){const e=d.default.getS4LUiFeaturesNoSubscription().enableWindowRightClose&&I.default.isWindowCloseOnRight();let t=a.createElement(g.default,{onPress:this._triggerOnCloseButtonPress,style:L.closeButton,size:P.IconSize.size24,color:M.Color.whiteOverlay90,hoverColor:M.Color.white,icon:k.closeIcon(),title:_.getString("Global.CloseButtonTitle"),importantForAccessibility:a.Types.ImportantForAccessibility.Yes});return this.state.conversationName?a.createElement(a.View,{style:L.headerContainer},a.createElement(a.Image,{style:L.overlayContainer,resizeMode:"stretch",source:l.Collection.PHOTO_SHIM}),a.createElement(a.View,{style:L.headerRow},e?void 0:t,a.createElement(a.Text,{style:[w.default.fontStyle.messagingHeader,L.conversationNameTextStyle],numberOfLines:1},this.state.conversationName),e?t:void 0)):null}_onSendButtonPress(){if(!this.props.previewUrl)return void this.props.closePanel();let e=p.default.extractFileNameWithExtension(this.props.previewUrl);d.default.getS4LCMCFeatures().desktopVIMAppendExtensionOnUpload&&(r.extname(e)||(e+=".mp4"));const t={name:C.ScenarioName.SendVideo,transactionId:this.props.transactionId};if(this.props.blob){const s=this.props.blob;let r=new File([s],e);const a={file:r,extension:"mp4"};n.default.captureFrameFromVideo(URL.createObjectURL(r),.5).then((n=>{const l=new E.UploadEvent(this.props.duration,s.size);if(n){let s=n.blob;const d=e+"-thumbnail."+n.extension;if(o.attempt((()=>s.name=d)),o.attempt((()=>s.lastModifiedDate=new Date(r.lastModified))),a.thumbnail={file:s,extension:n.extension},n.width>=0&&n.height>=0){const e={width:n.width,height:n.height};a.dimensions=e,a.thumbnail.dimensions=e}S.log(u.LogTraceArea.Capture,"DesktopCaptureVideoPreview thumbnail generated ",d," ",n),S.log(u.LogTraceArea.Capture,"DesktopCaptureVideoPreview uriWrapper ",i.pii.Omit(a.file.name)),this.props.conversationId&&(v.default.postVideoWithThumbnail([this.props.conversationId],a,u.PostSource.CapturePreview,!0,t),l.setStatus(!0,this.props.transactionId),this._announceForAccessibilityForMessageSent())}else l.setStatus(!1,"Unable to capture thumbnail frame from captured video.");S.track(l)}))}this.props.closePanel(),this.props.onShareComplete&&this.props.onShareComplete()}_onCloseButtonPress(){this.setState({showConfirmCancelDialog:!0})}}t.default=F},46507:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BookmarksPanelHeader=void 0;const i=s(16778),o=s(92758),n=s(46096),r=s(13944),a=s(10117),l=s(15877),d=s(33754),c=s(4735),h=s(30124),u=s(27357),p=s(11010),g=s(11828),m=s(24576),S=s(53374),f=(0,l.lazyProperties)({container:()=>i.Styles.createViewStyle({flexDirection:"row",flex:1}),titleContainer:()=>i.Styles.createViewStyle({flexDirection:"row",flex:1,alignContent:"center",alignItems:"center"}),mobileTitleContainer:()=>i.Styles.createViewStyle({justifyContent:"center"}),title:()=>i.Styles.createTextStyle({font:p.default.font.uiDisplayBold,fontSize:p.default.controlFontSize.headerSizeSmall,flexShrink:1,paddingLeft:10}),mobileTitle:()=>i.Styles.createTextStyle({fontSize:p.default.controlFontSize.panelHeader,paddingLeft:3}),closeButton:()=>i.Styles.createButtonStyle({marginRight:12}),mobileCloseButton:()=>i.Styles.createViewStyle({marginLeft:10,marginRight:0}),spacer:()=>i.Styles.createViewStyle({width:32}),splitViewStyle:()=>i.Styles.createViewStyle({paddingLeft:20})});class y extends m.default{constructor(){super(...arguments),this._onClose=()=>{const e=S.default.newGuid();i.Accessibility.announceForAccessibility(d.getString("BookmarksConversation.BookmarksClosedAnnouncementText")),this.state.isUsingStackNavigationContext?c.default.goBack(e,this._getContext()):this.state.lastVisitedConversationId?c.default.navigateToConversation({causeId:e,convId:this.state.lastVisitedConversationId,origin:n.NavigationConversationOrigin.Search}):c.default.navigateToWelcomeScreen(e)}}_buildState(e,t){return{isUsingStackNavigationContext:h.default.isUsingStackNavigationContext(),lastVisitedConversationId:o.default.getLastVisitedConversationId(),isLeftPanelHiddenOnDesktop:u.default.isDesktopSplitNavStackCollapsedForRootViewId(this._getRootViewId())}}render(){const e=this._getCloseButton(),t=this._getTitleElement(),s=i.createElement(i.View,{style:f.spacer});return this.state.isUsingStackNavigationContext?i.createElement(i.View,{style:f.container},e,t,s):i.createElement(i.View,{style:f.container},t,e)}_getTitleElement(){const e=[f.title,this._themeStyles.primaryTextColorStyle],t=[f.titleContainer];return this.state.isUsingStackNavigationContext&&(e.push(f.mobileTitle),t.push(f.mobileTitleContainer)),this.state.isLeftPanelHiddenOnDesktop&&t.push(f.splitViewStyle),i.createElement(i.View,{style:t},i.createElement(a.default,{icon:g.SkypeIcon.Bookmarked,size:this.state.isUsingStackNavigationContext?g.IconSize.size18:g.IconSize.size28,color:this._themeColors.primaryTextColor,importantForAccessibility:i.Types.ImportantForAccessibility.No}),i.createElement(i.Text,{style:e},d.getString("BookmarksConversation.BookmarksChatTitle")))}_getCloseButton(){if(h.default.isUsingSplitViewNoSubscription())return;let e=[f.closeButton];return this.state.isUsingStackNavigationContext&&e.push(f.mobileCloseButton),i.createElement(r.default,{icon:g.SkypeIcon.ClosePanel,size:this.state.isUsingStackNavigationContext?g.IconSize.size24:g.IconSize.size32,color:this._themeColors.primaryTextColor,hoverColor:this._themeColors.iconHoverColor,style:e,onPress:this._onClose,title:d.getString("BookmarksConversation.CloseButtonLabel"),autoFocus:!0})}}t.BookmarksPanelHeader=y,t.default=y},49748:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContentPanelHeader=t.LandscapeButtonHeight=t.HeaderHeightModernizeChatSmallHeader=t.HeaderHeightMobileLandscape=t.PanelHeightMobileSmall=t.HeaderHeightMobile=t.HeaderHeightCompositeExtended=t.HeaderHeightCompositeBase=void 0;const i=s(96486),o=s(31844),n=s(25465),r=s(16778),a=s(89391),l=s(46507),d=s(98925),c=s(80200),h=s(5531),u=s(81697),p=s(71830),g=s(97775),m=s(11009),S=s(98278),f=s(984),y=s(20373),_=s(30963),v=s(89888),C=s(39549),b=s(46172),T=s(37490),M=s(52262),I=s(46096),w=s(13944),P=s(5581),k=s(36237),A=s(10400),E=s(15877),R=s(33754),L=s(66127),F=s(23422),x=s(46929),O=s(18078),D=s(4735),B=s(30124),V=s(27357),N=s(29130),U=s(51070),H=s(81115),z=s(84299),W=s(77914),j=s(71987),G=s(70919),K=s(81760),q=s(11828),Q=s(34528),X=s(80837),$=s(60305),J=s(24576),Y=s(16383),Z=s(88523),ee=s(67977),te=s(66526),se=s(72758),ie=s(53374),oe=s(67024),ne=s(15963);t.HeaderHeightCompositeBase=97,t.HeaderHeightCompositeExtended=88,t.HeaderHeightMobile=70,t.PanelHeightMobileSmall=60,t.HeaderHeightMobileLandscape=44,t.HeaderHeightModernizeChatSmallHeader=56;t.LandscapeButtonHeight=32;const re=(0,E.lazyProperties)({contentPanelHeader:()=>r.Styles.createViewStyle({flexDirection:"row",alignItems:"center",alignSelf:"stretch",justifyContent:"space-between",height:t.HeaderHeightMobile,overflow:"visible"}),contentPanelHeaderSmall:()=>r.Styles.createViewStyle({height:t.PanelHeightMobileSmall}),contentPanelGuestHeader:()=>r.Styles.createViewStyle({paddingLeft:16}),contentPanelHeaderLandscape:()=>r.Styles.createViewStyle({height:t.HeaderHeightMobileLandscape}),backButton:()=>r.Styles.createButtonStyle({flexDirection:"row",justifyContent:"center",alignItems:"center",backgroundColor:K.Color.transparent}),backButtonLandscapeNormalView:()=>r.Styles.createButtonStyle({height:52,paddingLeft:16,paddingRight:16}),backButtonModernizeSmallHeader:()=>r.Styles.createButtonStyle({height:t.HeaderHeightModernizeChatSmallHeader,paddingLeft:18,paddingRight:18}),headerControlsContainer:()=>r.Styles.createButtonStyle({flex:-1,alignSelf:"stretch",alignItems:"center",flexDirection:"row"}),headerButtonContainer:()=>r.Styles.createViewStyle({flex:1,overflow:"hidden",height:q.IconSize.default}),headerButtonInnerContainer:()=>r.Styles.createViewStyle({alignItems:"stretch",justifyContent:"center"}),headerButtonContainerLandscape:()=>r.Styles.createViewStyle({height:t.LandscapeButtonHeight}),leftControls:()=>r.Styles.createViewStyle({width:56,flexDirection:"row"}),userIconWrapper:()=>r.Styles.createButtonStyle({paddingRight:12}),tablet:()=>(0,E.lazyProperties)({contentPanelHeader:()=>r.Styles.createViewStyle({paddingLeft:20,paddingRight:5}),contentPanelHeaderAndroid:()=>r.Styles.createViewStyle({height:t.PanelHeightMobileSmall+1}),contentPanelHeaderWithIcon:()=>r.Styles.createViewStyle({paddingLeft:10}),headerButtonInnerContainer:()=>r.Styles.createViewStyle({alignSelf:"flex-start",overflow:"visible",height:q.IconSize.default}),conversationSwitcherIPad:()=>r.Styles.createViewStyle({height:G.SearchInputHeight.iOS}),conversationSwitcher:()=>r.Styles.createViewStyle({marginTop:-1})}),compositeNav:()=>(0,E.lazyProperties)({contentPanelHeader:()=>r.Styles.createViewStyle({paddingLeft:20,paddingRight:15,height:t.HeaderHeightCompositeBase}),contentPanelHeaderWithBackButton:()=>r.Styles.createViewStyle({paddingLeft:0}),contentPanelHeaderExperimental:()=>r.Styles.createViewStyle({height:t.HeaderHeightCompositeExtended}),headerButton:()=>r.Styles.createButtonStyle({alignSelf:"center",marginRight:10})}),modernizeSmallHeader:()=>(0,E.lazyProperties)({contentPanelHeader:()=>r.Styles.createViewStyle({paddingLeft:20,paddingRight:20}),contentPanelModernizedHeader:()=>r.Styles.createViewStyle({height:t.HeaderHeightModernizeChatSmallHeader}),smallPaddingControl:()=>r.Styles.createViewStyle({paddingRight:12}),headerButton:()=>r.Styles.createButtonStyle({alignSelf:"center",marginRight:10}),userIconWrapper:()=>r.Styles.createButtonStyle({paddingRight:12})})});class ae extends J.default{constructor(){super(...arguments),this._onContentPanelHeaderContainerRef=e=>{this._contentPanelHeaderContainerRef=e||void 0},this._anchorNavigateToDetailsPanel=()=>{const e=ie.default.newCauseId();k.log(I.LogTraceArea.Navigation,"ContentPanelHeader._anchorNavigateToDetailsPanel, causeId: "+e),this._intNavigateToDetailsPanel(e)},this._navigateToDetailsPanel=e=>{e&&e.stopPropagation();const t=ie.default.newCauseId();k.log(I.LogTraceArea.Navigation,"ContentPanelHeader._navigateToDetailsPanel, causeId: "+t),this._intNavigateToDetailsPanel(t)},this._onOpenMainWindowClick=()=>{const e=ie.default.newCauseId();k.log(I.LogTraceArea.Navigation,"ContentPanelHeader._openMainWindow, causeId: "+e);const t=this._getRootViewId();t!==S.MainRootViewId&&D.default.openMainWindow(!0,t,e)},this._onBackButtonClick=e=>{e.stopPropagation(),A.default.immediatelyResetUpdateInfo();const t=ie.default.newCauseId();oe.default.createTrackerAndMarkPressTime(t,ne.ScenarioName.ResponsivenessGoBackFromConversation,e),k.log(I.LogTraceArea.Navigation,"ContentPanelHeader._handleBackButtonClick, causeId: "+t),D.default.goBack(t,this._getContext()),oe.default.markActionDoneAndRemoveTracker(t)}}_buildState(e,t){const s=this._getRootViewId(),i=a.default.getS4LMessagingFeatures(),n=a.default.getS4LCMCFeatures(),l=(0,C.default)().getConversation(e.conversationId),c=B.default.isUsingStackNavigationContext(),u=p.isEncryptedThread(e.conversationId),g=$.default.useTabletUI(),m=g?o.DeviceOrientation.Portrait:N.default.getDeviceOrientation(s),y=m===o.DeviceOrientation.Landscape,_=c||g||N.default.isTinyScreenSizeNoSubscription(s),v=l&&l.isEncryptedThread()?l.getOtherPartyMriOrConvId():e.conversationId,T=se.default.getConversationOwner(v),I=f.default.isConversationAccepted(T),w=l&&l.isOneOnOne()&&(p.isMriWithUserMetadata(T)||e.otherPartyMri&&p.isMriWithUserMetadata(e.otherPartyMri))&&(I||e.otherPartyMri&&p.isS4BBridgeMri(e.otherPartyMri)),k=p.isPhoneMri(e.conversationId)&&p.isOneOnOneConversation(e.conversationId),A=n.enableShowCallRateInPSTNCallWindow&&k,E=O.default.isGuestUser(),R=p.isGalleryInConversationSupported(e.conversationId)&&(w&&!p.isS4BBridgeMri(e.conversationId)||!e.otherPartyMri),F=!0===e.isInConversationBubbleMode,x=!E&&!F&&(this._getContext().isPresentedByMobileStackNavigator||this._getRootViewType()===S.RootViewType.SplitViewContent||b.default.collapseDesktopStackNavContext()&&V.default.isDesktopSplitNavStackCollapsedForRootViewId(this._getRootViewId()));return Object.assign(Object.assign({conversationOwnerMri:T,conversationName:l?M.default.getDisplayName(l.id):"",isMinDesktopWidth:N.default.isMinDesktopWidth(s),uiOrientation:m,leavePaddingForStatusBar:r.StatusBar.isOverlay()&&(m===o.DeviceOrientation.Portrait||!c),statusBarHeight:U.default.statusBarHeight(),useMobileUI:_,showConversationIcon:g&&!x,useTabletUI:g,isEncryptedThread:u,isGalleryEnabled:R,shouldShowUserPresence:w,shouldShowCallRate:A,showBackButton:x,showConversationSwitcher:i.enableGroupedConversations,hideBotCoachMarks:p.getMriNamespace(e.conversationId)===p.Namespaces.Bot,isGuestUser:E,isLandscape:y},ae._getScheduledCallState(e.conversationId,y,_)),{isTranslationFeatureEnabled:n.enableMessageTranslation,isTranslatorBotDeprecationEnabled:n.enableTranslatorBotDeprecation,translatorBotDeprecationDate:n.translatorBotDeprecationDate,canAccessConversationDetails:h.default.navigation().canAccessConversationDetails&&!F,translationState:P.default.getConversationTranslationState(e.conversationId)||d.TranslationState.Disabled,isThreadWithTranslatorBot:l&&l.hasSpecificAgentMember(n.translatorAgentId),isModernizeChatHeaderMobile:L.default.modernizeChatHeaderMobileVersion()})}componentDidMount(){super.componentDidMount(),this._newConversationSetup(),this._contentPanelHeaderContainerRef&&this._contentPanelHeaderContainerRef.setFocusLimited(!!this.props.preventAccessibilityFocus)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),e.conversationId!==this.props.conversationId&&(this._oldConversationCleanup(),this._newConversationSetup()),this.props.preventAccessibilityFocus!==e.preventAccessibilityFocus&&this._contentPanelHeaderContainerRef&&this._contentPanelHeaderContainerRef.setFocusLimited(!!this.props.preventAccessibilityFocus)}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s)}componentWillUnmount(){super.componentWillUnmount(),this._oldConversationCleanup()}_oldConversationCleanup(){this._finishedSyncingSubscriptionToken&&(this._finishedSyncingSubscriptionToken.unsubscribe(),this._finishedSyncingSubscriptionToken=void 0)}_newConversationSetup(){u.default.forceThreadDetailsFetchIfNeeded(this.props.conversationId),this._finishedSyncingSubscriptionToken=u.default.finishedSyncingConversation.subscribe((e=>{e===this.props.conversationId&&u.default.forceThreadDetailsFetchIfNeeded(this.props.conversationId)}))}_getLeftIcon(e=!1){let t,s,i,o,n=[re.backButton];return this.state.isModernizeChatHeaderMobile?e?(n=[...n,re.backButtonModernizeSmallHeader],o=q.IconSize.size20):(n=[...n,re.backButtonLandscapeNormalView],o=q.IconSize.size24):(n=[...n,re.backButtonModernizeSmallHeader],o=q.IconSize.size16),this._getRootViewType()===S.RootViewType.SplitViewContent?(t=q.SkypeIcon.Menu,s=R.getString("CallPanel.OpenRecentsButtonTitle"),i=this._onOpenMainWindowClick):(t=this.props.contextConversationId?Q.closeIcon():Q.backIcon(),s=R.getString("Global.BackButtonTitle"),i=this._onBackButtonClick),r.createElement(w.default,{style:n,size:o,onPress:i,color:this._themeColors.headerIconColor,hoverColor:this._themeColors.iconHoverColor,icon:t,title:s})}_getLeftControls(e){return r.createElement(r.View,{key:"leftcontrols"},this._getLeftIcon(e))}_getHeaderStyles(e){let s=[re.contentPanelHeader,this.props.style,this._themeStyles.messageStreamBackgroundColorStyle];if(this.state.useMobileUI)this.state.useTabletUI?(s.push(re.tablet.contentPanelHeader),this.state.showConversationIcon&&s.push(re.tablet.contentPanelHeaderWithIcon)):this.state.isGuestUser&&s.push(re.contentPanelGuestHeader),e?s.push(re.contentPanelHeaderLandscape):s.push(re.contentPanelHeaderSmall),s.push(re.modernizeSmallHeader.smallPaddingControl),this.state.leavePaddingForStatusBar&&this.state.statusBarHeight&&s.push(H.default.marginTopStyle(this.state.statusBarHeight)),this.props.safeAreaHorizontalInsets&&H.default.hasHorizontalSafeAreas(this.props.safeAreaHorizontalInsets)&&s.push(H.default.horizontalPaddingStyle(this.props.safeAreaHorizontalInsets));else{s.push([re.modernizeSmallHeader.contentPanelHeader,this.state.showBackButton?re.compositeNav.contentPanelHeaderWithBackButton:void 0]),s.push(re.compositeNav.contentPanelHeaderExperimental);let e=0;this.state.leavePaddingForStatusBar&&this.state.statusBarHeight&&(e+=this.state.statusBarHeight,s.push(H.default.heightStyle(t.HeaderHeightCompositeExtended+this.state.statusBarHeight))),this.state.useTabletUI&&(e+=10),e&&s.push(H.default.paddingTopStyle(e)),this.props.safeAreaHorizontalInsets&&H.default.hasHorizontalSafeAreas(this.props.safeAreaHorizontalInsets)&&s.push(H.default.horizontalPaddingStyle(this.props.safeAreaHorizontalInsets))}return s.push(re.modernizeSmallHeader.contentPanelModernizedHeader),{headerStyles:s,headerWrapperStyle:[]}}_getChatIcon(){const e=this.state.canAccessConversationDetails;return r.createElement(r.Button,{key:"leftcontrols-chaticon",style:re.modernizeSmallHeader.userIconWrapper,onPress:e?this._navigateToDetailsPanel:void 0,importantForAccessibility:r.Types.ImportantForAccessibility.NoHideDescendants},r.createElement(te.default,{mri:this.props.otherPartyMri||this.props.conversationId,isOneOnOne:!!this.props.otherPartyMri,size:ee.AvatarIconSize.Size40,showStatus:!1,statusBorderColor:this._themeColors.primaryBackgroundColor}))}_getControlsContent(e,t){let s;const o=this._getChatIcon();if(this.state.useMobileUI){const n=[re.headerButtonContainer];t&&n.push(re.headerButtonContainerLandscape);const a=[re.headerButtonInnerContainer];this.state.useTabletUI?a.push(re.tablet.headerButtonInnerContainer):a.push(...n);const l=t,d=this.state.canAccessConversationDetails,c=r.createElement(r.View,{key:"centercontrols",style:n},r.createElement(r.View,{style:a},r.createElement(F.default,{conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,colorThemeOverride:this._currentTheme,hideSecondRow:l,deviceOrientation:this.state.uiOrientation,shouldShowUserPresence:this.state.shouldShowUserPresence,shouldShowCallRate:this.state.shouldShowCallRate,hidePresenceIndicator:this.state.showConversationIcon,onTitlePress:d?this._navigateToDetailsPanel:void 0,conversationOwnerMri:this.state.conversationOwnerMri,isModernizeSmallHeaderMobile:this.state.isModernizeChatHeaderMobile})));s=i.compact([e,o,c])}else s=r.createElement(r.View,{key:"controlscontent",style:re.headerControlsContainer},e,o,this.state.hideBotCoachMarks?this._renderPanelHeader():this._renderCoachMarkPanelHeader());return s}_renderOptionalGroupSwitcher(){return this._shouldRenderTabSwitcher()&&this.props.otherPartyMri?r.createElement(v.default,{style:this.state.useTabletUI?re.tablet.conversationSwitcher:void 0,heightStyle:void 0,mri:this.props.otherPartyMri,currentConversationId:this.props.conversationId,safeAreaHorizontalInsets:this.props.safeAreaHorizontalInsets,preventAccessibilityFocus:this.props.preventAccessibilityFocus}):void 0}_renderOptionalScheduledCallBanner(){return this.state.scheduledCall&&this.state.shouldRenderScheduledCallBanner?r.createElement(z.default.ScheduledCallConversationBanner,{scheduledCall:this.state.scheduledCall}):void 0}_renderOptionalTranslationBanner(){return this.state.isTranslationFeatureEnabled&&this.state.translationState!==d.TranslationState.Disabled?r.createElement(Y.default,{conversationId:this.props.conversationId,conversationName:this.state.conversationName}):void 0}_renderOptionalDeprecationTranslationBanner(){return this.state.isTranslatorBotDeprecationEnabled&&this.state.isThreadWithTranslatorBot?r.createElement(Y.default,{conversationId:this.props.conversationId,conversationName:this.state.conversationName,translatorBotDeprecationDate:this.state.translatorBotDeprecationDate,isDeprecated:!0}):void 0}_renderCallControlButtons(){return this.props.isInConversationBubbleMode&&this.props.activeCallStatus!==c.ActiveCallStatus.Connected?void 0:r.createElement(y.default,{conversationOwnerMri:this.state.conversationOwnerMri,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,activeCallId:this.props.activeCallId,activeCallStatus:this.props.activeCallStatus,hasActiveCall:this.props.hasActiveCall,onCallStartedAnsweredOrJoined:this.props.onCallStartedAnsweredOrJoined,preventAccessibilityFocus:this.props.preventAccessibilityFocus,localAddressBookPhones:this.props.localAddressBookPhones,isGalleryEnabled:this.state.isGalleryEnabled,isMessageSearchPanelEnabled:this.props.isMessageSearchPanelEnabled,onToggleMessageSearchPanel:this.props.onToggleMessageSearchPanel,onGalleryPressed:this.props.onGalleryPressed})}render(){const e=this.props.preventAccessibilityFocus?r.Types.ImportantForAccessibility.NoHideDescendants:void 0,t=this._getHeaderStyles(this.state.isLandscape),s=this.state.showBackButton?this._getLeftControls(this.state.isLandscape):void 0;if(p.isBookmarkConversation(this.props.conversationId)){const e=this.state.useMobileUI?void 0:this._themeStyles.secondaryBackgroundColorStyle;return r.createElement(r.View,{style:[t.headerWrapperStyle,e]},r.createElement(r.View,{style:[t.headerStyles,e]},r.createElement(l.BookmarksPanelHeader,null)))}const i=this.props.isInConversationBubbleMode?[t.headerWrapperStyle,re.contentPanelGuestHeader]:t.headerWrapperStyle;return r.createElement(r.View,{style:i,ref:this._onContentPanelHeaderContainerRef,onLayout:this.props.onLayout,limitFocusWithin:r.Types.LimitFocusType.Limited},r.createElement(r.View,{style:t.headerStyles,importantForAccessibility:e},this._getControlsContent(s,this.state.isLandscape),this._renderCallControlButtons()),this._renderOptionalGroupSwitcher(),this._renderOptionalScheduledCallBanner(),this._renderOptionalTranslationBanner(),this._renderOptionalDeprecationTranslationBanner())}_renderCoachMarkPanelHeader(){let e=R.getString("ContentPanelHeader.ProfileButtonAccessibilityLabel",{conversationName:this.state.conversationName});this.state.isEncryptedThread&&(e+=","+R.getString("ContentPanelHeader.PrivateConversationLabel"));const t={coachMarkType:m.CoachMarkType.ChatProfile,onAnchorPress:this._anchorNavigateToDetailsPanel,anchorAccessibilityLabel:e},s=[re.headerControlsContainer,re.compositeNav.headerButton,X.default.pointerCursor];return this.state.isMinDesktopWidth&&s.push(X.default.flexOne),r.createElement(g.default.View,Object.assign({key:"centercontrols",style:s,disableTouchOpacityAnimation:!0},t),this._renderPanelHeader())}_renderPanelHeader(){const e=this.state.canAccessConversationDetails;return r.createElement(r.View,{key:"centercontrols",style:X.default.flexOne},r.createElement(_.default,{onPress:e?this._navigateToDetailsPanel:void 0,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,useTabletUI:this.state.useTabletUI,shouldShowUserPresence:this.state.shouldShowUserPresence,shouldShowCallRate:this.state.shouldShowCallRate,hidePresenceIndicator:this.state.showConversationIcon,hideSecondRow:!1,preventAccessibilityFocus:!e||this.props.preventAccessibilityFocus,colorThemeOverride:this._currentTheme,onToggleMessageSearchPanel:this.props.onToggleMessageSearchPanel,onGalleryPressed:this.props.onGalleryPressed,isMessageSearchPanelEnabled:this.props.isMessageSearchPanelEnabled,conversationOwnerMri:this.state.conversationOwnerMri}))}_shouldRenderTabSwitcher(){return this.state.showConversationSwitcher&&!!this.props.otherPartyMri&&!this.props.hideConversationSwitcher}_intNavigateToDetailsPanel(e){k.log(I.LogTraceArea.Navigation,"ContentPanelHeader._intNavigateToDetailsPanel, causeId: "+e),n.default.isSupported()&&T.dismissAll(),Z.userProfileViewed(this.props.conversationId),this.props.onOpenDropdown?this.props.onOpenDropdown():D.default.showDetailsPanelWithParams({mri:this.props.conversationId,showConversationSettings:!0,rootViewId:this._getRootViewId(),causeId:e})}static _getScheduledCallState(e,t,s){const o=W.default.getUpcomingScheduledCallsByConversationId(e);let n,r=!1;if(o){const e=x.default.getScheduledCallsBannerDismissStates()||{};n=i.find(o,(i=>{const o=e[i.id];return r=j.default.shouldRenderScheduledCallBanner(t,s,W.ExpirationGracePeriodMs,i,o)}))}return{scheduledCall:n,shouldRenderScheduledCallBanner:r}}}t.ContentPanelHeader=ae,t.default=ae},20373:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContentPanelHeaderButtons=t.LandscapeButtonHeight=t.HeaderHeightCompositeExtended=t.HeaderHeightCompositeBase=void 0;const i=s(31844),o=s(38933),n=s(16778),r=s(96486),a=s(48540),l=s(1706),d=s(19784),c=s(89391),h=s(4736),u=s(94224),p=s(98925),g=s(37034),m=s(9520),S=s(80200),f=s(5531),y=s(71830),_=s(98278),v=s(25739),C=s(39549),b=s(57102),T=s(31761),M=s(37490),I=s(29565),w=s(41706),P=s(25793),k=s(59799),A=s(46096),E=s(11375),R=s(13944),L=s(36237),F=s(15877),x=s(33754),O=s(36699),D=s(64723),B=s(12462),V=s(44972),N=s(89808),U=s(78735),H=s(4735),z=s(30124),W=s(95691),j=s(29130),G=s(72425),K=s(10541),q=s(22222),Q=s(81760),X=s(40363),$=s(11828),J=s(11010),Y=s(60305),Z=s(24576),ee=s(88523),te=s(18078),se=s(53374),ie=s(57139),oe=s(64245);var ne;!function(e){e[e.Selected=0]="Selected",e[e.Unselected=1]="Unselected",e[e.Disabled=2]="Disabled"}(ne||(ne={}));const re=$.IconSize.size40,ae=$.IconSize.size24;t.HeaderHeightCompositeBase=97,t.HeaderHeightCompositeExtended=100,t.LandscapeButtonHeight=32;const le=(0,F.lazyProperties)({modernizeIconContainer:()=>n.Styles.createViewStyle({width:re,height:re,borderRadius:re/2}),controls:()=>n.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-end"}),rightIconMargin:()=>n.Styles.createViewStyle({marginRight:8}),leftIconMargin:()=>n.Styles.createViewStyle({marginLeft:8}),leftIconMarginControl:()=>n.Styles.createViewStyle({marginLeft:4}),backgroundStyle:()=>({paddingLeft:15,paddingRight:20}),modernizedBackgroundStyle:()=>({paddingLeft:10,paddingRight:14}),modernizedDisabledButton:()=>n.Styles.createViewStyle({backgroundColor:Q.Color.gray300}),modernizeMoreOptionsIconButton:()=>n.Styles.createViewStyle({width:$.IconSize.size20,marginLeft:8,marginRight:0}),compositeNav:()=>(0,F.lazyProperties)({controlsContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",overflow:"visible"}),headerButtonHover:()=>n.Styles.createViewStyle({opacity:.8}),gradientViewStyle:()=>n.Styles.createViewStyle({borderRadius:re/2}),leftIconMargin:()=>n.Styles.createViewStyle({marginLeft:10})}),unsubscribeSubscribeButton:()=>n.Styles.createTextStyle({fontSize:J.default.controlFontSize.smallButton,fontFamily:J.default.fontFamily.uidDisplayRegular})});class de extends Z.default{constructor(){super(...arguments),this._ignoreDisposingCallObserving=!1,this.handleFocusEvent=e=>(L.log(A.LogTraceArea.ContentPanel,"ContentPanelHeaderButton.handleFocusEvent: "+e),!(e!==E.FocusEvent.OpenGoLiveNotification||!this._joinButton)&&(this._joinButton.requestFocus(),!0)),this._onJoinButtonRef=e=>{this._joinButton=e||void 0},this._onMoreOptionsButtonPress=()=>{if(!this._moreOptionsButtonRef)return;const e=this._getRootViewId(),t=se.default.newCauseId();ie.default.showWithContent({rootViewId:e,anchor:()=>this._moreOptionsButtonRef,content:n.createElement(oe.default,{onRowPress:()=>ie.default.close(e,t),descriptors:this._getExtendedChatControlsDescriptors()}),menuId:"more_options_header_menu",menuWidth:210,borderRadius:10,togglable:!0},t)},this._onMoreOptionsButtonRef=e=>this._moreOptionsButtonRef=e||void 0,this._getAudioCallIcon=()=>this.state.multipleAudioCallOptionsAvailable?$.SkypeIcon.CallOptions:y.isPhoneMri(this.props.conversationId)?$.SkypeIcon.SkypeOut:$.SkypeIcon.CallStart,this._onJoinOrStartAudioCall=()=>this._onStartCall(!1),this._onStartVideoCall=()=>this._onStartCall(!0),this._onAddContact=()=>{if(M.dismissAll(),ee.contactAdded(this.props.conversationId),this.props.otherPartyMri){const e=this.state.skypeUserOwnerMri?[this.state.skypeUserOwnerMri]:[this.props.otherPartyMri];new T.default({peopleType:K.PeopleType.All,filterPeopleType:K.FilterType.GroupCapable,navigationOrigin:A.NavigationConversationOrigin.HeaderButtonNewGroupWithUser,invitedUsersMris:e,wizardSteps:[W.WizardSteps.setConvParticipants]}).start(this._getRootViewId())}else{new T.default({convId:y.asSkypeThreadIdMaybe(this.props.conversationId),navigationOrigin:A.NavigationConversationOrigin.HeaderButtonAddUserToGroup,peopleType:K.PeopleType.All,filterPeopleType:K.FilterType.GroupCapable,wizardSteps:[W.WizardSteps.setConvParticipants]}).start(this._getRootViewId())}},this._onUnsubscribePress=()=>{d.default.showConfirmationAlert(x.getString("UserSettingsPanel.UnsubscribeEngagementBotTitle"),x.getString("UserSettingsPanel.UnsubscribeEngagementBotDescription"),x.getString("Global.Unsubscribe"),(()=>{I.default.archiveEngagementBot(this.props.conversationId,this._getRootViewId(),A.ArchiveConversationOrigin.ConversationHeader),U.default.setUserPreferencesLocal({enableInAppEngagementNotifications:!1,enablePushEngagementNotifications:!1})}),this._getRootViewId())},this._onSubscribePress=()=>{I.default.unarchiveEngagementBot(this.props.conversationId,z.default.isUsingStackNavigationContext(),this._getContext(),A.UnarchiveConversationOrigin.ConversationHeader),U.default.setUserPreferencesLocal({enableInAppEngagementNotifications:!0,enablePushEngagementNotifications:!0})},this._onMeetNowPress=()=>{L.log(A.LogTraceArea.JoinLink,"ContentPanelHeader._onMeetNowPress"),this.state.showTwinCam||O.default.beginTrackingJoinMeetNow(D.MeetNowOrigin.CallPanel),H.default.navigateToCallPreviewView({conversationMri:this.props.conversationId,callOrigin:A.NavigationCallOrigin.MeetNow,activeCallId:u.default.ActiveCallUIHelper.getActiveCallId(this.props.conversationId),isGoLive:!0})},this._onDontStartCall=()=>L.log(A.LogTraceArea.ContentPanel,"ContentPanelHeader call button disabled"),this._onCallButtonRef=e=>{this._callButton=e||void 0},this._getCallButtonRef=()=>this._callButton}_buildState(e){const t=(0,C.default)(),s=t.getConversation(e.conversationId),o=z.default.isUsingStackNavigationContext(),n=y.isEncryptedThread(e.conversationId),r=Y.default.useTabletUI(),a=r?i.DeviceOrientation.Portrait:j.default.getDeviceOrientation(this._getRootViewId()),d=!!e.activeCallId&&u.default.CallingStore.isCallIncoming(e.activeCallId),h=e.conversationOwnerMri&&y.isSkypeIdMri(e.conversationOwnerMri)?e.conversationOwnerMri:void 0,g=h&&b.ConversationUtils.hasMultipleAudioCallOptions(h),m=c.default.getS4LCMCFeatures(),S={isMinDesktopWidth:j.default.isSmallOrTinyScreenSize(this._getRootViewId()),uiOrientation:a,userColor:N.default.getPrimaryColor(),isUserBlocked:t.isConversationBlocked(s),isUserCreator:(null==s?void 0:s.creator())===te.default.getSkypeMri(),isBlockedPSTNMri:y.isBlockedPSTNMri(e.conversationId),isOutgoingVideoDisabled:u.default.CallingFeaturesHelper.isOutgoingVideoDisabled(),showActiveCall:!d,useMobileUI:o,useTabletUI:r,isEncryptedThread:n,canInvitePeople:f.default.contacts().canInvitePeople,isCallIncoming:d,multipleAudioCallOptionsAvailable:g,enableJoinerCallPreview:m.enableJoinerCallPreview&&y.isGroupConversation(e.conversationId),hasActiveGoLive:!!s&&s.hasGoLive(),isPSTNGroup:b.ConversationUtils.isPSTNGroup(s),skypeUserOwnerMri:h,alwaysNavigateToLobby:m.redesignedLobbiesEnabled&&(null==s?void 0:s.isGroupConversation()),isGroupConversation:null==s?void 0:s.isGroupConversation(),isRegularMemberInModeratedGroup:s&&(0,V.isRegularMemberInModeratedGroup)(s),isConciergeBot:y.isConciergeBotMri(e.conversationId),enableInAppEngagementNotifications:!!U.default.getUserPreferencesLocal().enableInAppEngagementNotifications,enableObservingCall:m.enableObservingCall,callState:e.activeCallId?u.default.CallingStore.getCallState(e.activeCallId):void 0,showTwinCam:!!e.activeCallId&&(m.twinCamEnabled&&u.default.CallingStore.getConnectedEndpoints(e.activeCallId).length>0)},_=y.isAgent(e.conversationId);S.isCallingCapable=!!s&&(!_||!s||l.default.isCallingCapable(s.id));const v=S.useMobileUI||!h&&!!y.isPhoneMri(e.conversationId)||y.isS4BBridgeMri(e.conversationId);S.canAddParticipant=!v&&(!_||!s||l.default.isGroupCapable(s.id));const T=n&&w.default.getHandshakeState(e.conversationId)!==P.SecureHandshakeState.Completed,M=S.skypeUserOwnerMri?S.skypeUserOwnerMri:e.conversationId;return S.skypeUserOwnerMri?S.isOutgoingCallingDisabled=!u.default.CallNavigationHelper.isOutgoingCallingAllowed(M):S.isOutgoingCallingDisabled=T||!u.default.CallNavigationHelper.isOutgoingCallingAllowed(M),S.isCallingDisabled=!u.default.CallNavigationHelper.isCallingAllowed(M),S.isOutgoingCallingDisabled?(S.outgoingCallingDisabledReason=u.default.CallNavigationHelper.whyOutgoingCallingIsNotAllowed(M),!S.outgoingCallingDisabledReason&&T&&(S.outgoingCallingDisabledReason=p.CallValidationFailureReason.E2eeHandshakeIncomplete)):S.outgoingCallingDisabledReason=void 0,S.isCallingDisabled&&(S.callingDisabledReason=u.default.CallNavigationHelper.whyCallingIsNotAllowed(M)),S.noCameraFound=!u.default.DeviceStore.hasCameras(),S}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.isOutgoingCallingDisabled===t.isOutgoingCallingDisabled&&this.props.conversationId===e.conversationId||L.log(A.LogTraceArea.ContentPanel,"ContentPanelHeader calling changed to "+(this.state.isOutgoingCallingDisabled?"disabled ":"allowed")+(this.state.isOutgoingCallingDisabled?" reason: "+this.state.outgoingCallingDisabledReason:"")),this.state.noCameraFound!==t.noCameraFound&&L.log(A.LogTraceArea.Calling,"ContentPanelHeaderButtons: noCamerasFound changed to: "+this.state.noCameraFound)}componentDidMount(){super.componentDidMount();const e=se.default.newCauseId();L.log(A.LogTraceArea.ContentPanel,"ContentPanelHeader calling "+(this.state.isOutgoingCallingDisabled?"disabled ":"allowed")+(this.state.isOutgoingCallingDisabled?" reason: "+this.state.outgoingCallingDisabledReason:"")+"causeId: "+e),L.log(A.LogTraceArea.Calling,"ContentPanelHeaderButtons: noCamerasFound: "+this.state.noCameraFound),this._joinButton&&E.register(E.FocusEvent.OpenGoLiveNotification,this),this.state.enableObservingCall&&this.props.activeCallId&&this.state.callState===a.CallState.None&&u.default.CallingStore.subscribeToCall(this.props.conversationId,this.props.activeCallId,A.NavigationCallOrigin.ConversationHeader,e).then((()=>{L.log(A.LogTraceArea.Calling,"ContentPanel: subscribed to call: "+this.props.activeCallId),this.isComponentMounted()||this.state.callState!==a.CallState.Observing||u.default.CallingStore.disposeObservingCalls(e)}))}componentWillUnmount(){super.componentWillUnmount();const e=se.default.newCauseId();this.state.enableObservingCall&&this.props.activeCallId&&!this._ignoreDisposingCallObserving&&u.default.CallingStore.disposeObservingCalls(e),this._ignoreDisposingCallObserving=!1}_getAudioAndVideoCallStatus(){if(this.state.alwaysNavigateToLobby)return{audioCallStatus:ne.Selected,videoCallStatus:this.state.noCameraFound?ne.Disabled:ne.Selected};let e,t;return this.state.isCallIncoming||this.state.isOutgoingCallingDisabled?(e=ne.Disabled,t=ne.Disabled):this.props.hasActiveCall?(e=ne.Selected,t=this.state.noCameraFound?ne.Disabled:ne.Selected):(e=ne.Unselected,t=ne.Unselected),{audioCallStatus:e,videoCallStatus:t}}_getVideoCallButtonInfo(e){if((!this.props.hasActiveCall||this.props.hasActiveCall&&this.state.isCallIncoming)&&(!this.state.isOutgoingCallingDisabled||!this.state.useMobileUI)&&this.props.conversationId!==X.default.getEchoMri()&&(!y.isPhoneMri(this.props.conversationId)||this.state.skypeUserOwnerMri)&&(!this.state.isEncryptedThread||this.state.skypeUserOwnerMri)&&(!this.state.isPSTNGroup||this.state.skypeUserOwnerMri)&&!this.state.hasActiveGoLive){let t;t=this.state.isOutgoingCallingDisabled?v.default.callingDisabledTooltip(this.state.outgoingCallingDisabledReason):this.state.noCameraFound?x.getString("ContentPanelHeader.NoCameraVideoCallButtonTitle"):x.getString("ContentPanelHeader.VideoCallButtonTitle");const s=e!==ne.Disabled?this._onStartVideoCall:this._onDontStartCall;return{icon:$.SkypeIcon.Video,iconSize:this.state.useMobileUI?ae:$.IconSize.size20,title:t,accessibilityLabel:t||x.getString("ContentPanelHeader.VideoCallButtonTitle"),onPress:s,status:e}}}_getJoinCallButtonInfo(){let e,t="callbutton";const s=this.state.alwaysNavigateToLobby||!this.state.isCallingDisabled?ne.Selected:ne.Disabled;switch(this.props.activeCallStatus){case S.ActiveCallStatus.Connected:e=x.getString("CallBanner.GoToCallMessage"),t+="_connected";break;case S.ActiveCallStatus.OnHold:e=x.getString("CallBanner.ResumeLiveCallMessage"),t+="_onhold";break;default:e=x.getString("CallBanner.JoinLiveCallMessage")}let i=e;s===ne.Disabled&&(i=v.default.callingDisabledTooltip(this.state.callingDisabledReason));const o=s!==ne.Disabled?this._onJoinOrStartAudioCall:this._onDontStartCall;return{key:t,title:i,accessibilityLabel:i||x.getString("ContentPanelHeader.CallButtonTitle"),onPress:o,ref:this._onJoinButtonRef,status:s,color:Q.Color.green,buttonText:e,iconSize:ae,isWideButton:!0,iconHorizontalMargin:4,icon:B.default.getMeetNowIcon()}}_getAudioCallButtonInfo(e){let t=this.state.isEncryptedThread?x.getString("ContentPanelHeader.PrivateCallButtonTitle"):x.getString("ContentPanelHeader.CallButtonTitle");this.state.isOutgoingCallingDisabled&&(t=v.default.callingDisabledTooltip(this.state.outgoingCallingDisabledReason));const s=e!==ne.Disabled?this._onJoinOrStartAudioCall:this._onDontStartCall;return{key:"callbutton",title:t,accessibilityLabel:t||x.getString("ContentPanelHeader.CallButtonTitle"),onPress:s,ref:this._onCallButtonRef,icon:this._getAudioCallIcon(),iconSize:this.state.useMobileUI?ae:$.IconSize.size20,accessibilityTraits:this.state.multipleAudioCallOptionsAvailable?[n.Types.AccessibilityTrait.Button,n.Types.AccessibilityTrait.HasPopup]:void 0,status:e}}_getMoreOptionsButtonInfo(){if(!this._shouldUnfoldExtendedControlButtons())return{ref:this._onMoreOptionsButtonRef,style:[le.modernizeMoreOptionsIconButton],title:x.getString("ContentPanelHeaderTitle.MoreOptionsButtonTitle"),icon:$.SkypeIcon.MoreVertical,onPress:this._onMoreOptionsButtonPress,color:Q.Color.transparent,noBackgroundIcon:!0,iconSize:ae}}_shouldShowJoinCallButton(){return this.props.hasActiveCall&&this.state.showActiveCall}_shouldShowStartCallButton(){return this.state.isGroupConversation&&!this.props.hasActiveCall}_getStartCallButtonInfo(){var e;let t=x.getString("MeetNow.StartCall"),s=ne.Unselected;return(this.state.isUserCreator&&this.state.isOutgoingCallingDisabled||this.state.isRegularMemberInModeratedGroup)&&(t=null!==(e=v.default.callingDisabledTooltip(this.state.outgoingCallingDisabledReason))&&void 0!==e?e:t,s=ne.Disabled),{title:t,status:s,icon:B.default.getMeetNowIcon(),buttonText:this._shouldUnfoldExtendedControlButtons()?x.getString("MeetNow.StartCall"):void 0,accessibilityLabel:x.getString("MeetNow.StartCall"),onPress:this._onMeetNowPress,iconSize:ae,iconHorizontalMargin:4}}_getFindButton(){return{title:x.getString("ContentPanelHeaderTitle.FindButtonTitle"),icon:$.SkypeIcon.Search,onPress:this.props.onToggleMessageSearchPanel,color:Q.Color.transparent,noBackgroundIcon:!0,iconSize:ae}}_getGalleryButton(){return{title:x.getString("ContentPanelHeaderTitle.GalleryButtonTitle"),icon:$.SkypeIcon.Gallery1,onPress:this.props.onGalleryPressed,color:Q.Color.transparent,noBackgroundIcon:!0,iconSize:ae}}_getModernizedAddContactsButton(){if(!this.state.canAddParticipant||this.props.hideAddContactButton)return;const e=this.state.isUserBlocked||this.state.isBlockedPSTNMri?ne.Disabled:ne.Unselected,t=this.props.otherPartyMri?x.getString("SetConversationParticipantsPanel.CreateNewGroupTitle"):x.getString("SetConversationParticipantsPanel.AddPeopleTitle");return{title:this.state.isUserBlocked?void 0:t,icon:$.SkypeIcon.ContactAdd,onPress:this._onAddContact,color:Q.Color.transparent,status:e,noBackgroundIcon:!0,iconSize:ae}}_getUnsubscribeButton(){const e=ne.Unselected,t=this.state.enableInAppEngagementNotifications,s=t?x.getString("Global.Unsubscribe"):x.getString("Global.Subscribe"),i=t?$.SkypeIcon.MailOff:$.SkypeIcon.Mail,o=this.state.enableInAppEngagementNotifications?this._onUnsubscribePress:this._onSubscribePress;return{title:s,icon:i,buttonText:s,buttonTextStyle:[le.unsubscribeSubscribeButton,this._themeStyles.buttonTextColorStyle],onPress:o,color:Q.Color.transparent,status:e,noBackgroundIcon:!0,iconSize:$.IconSize.size18,iconHorizontalMargin:4}}_getButtonDescriptors(){const e=this._getBarButtonInfo(),t=this._getExtendedChatControlsDescriptors();return[...this._shouldUnfoldExtendedControlButtons()?t:[],...e,!this.state.useMobileUI&&r.compact(t).length>0?this._getMoreOptionsButtonInfo():void 0]}_getBarButtonInfo(){const e=[];if(this.state.isConciergeBot)return[this._getUnsubscribeButton()];if(this.state.isCallingCapable)if(this._shouldShowStartCallButton())e.push(this._getStartCallButtonInfo());else{const t=this._getAudioAndVideoCallStatus();if(!this.state.isOutgoingVideoDisabled){const s=this._getVideoCallButtonInfo(t.videoCallStatus);s&&e.push(s)}const s=this._shouldShowJoinCallButton()?this._getJoinCallButtonInfo():this._getAudioCallButtonInfo(t.audioCallStatus);s&&e.push(s)}return e}_getExtendedChatControlsDescriptors(){const e=[this.props.isMessageSearchPanelEnabled?this._getFindButton():void 0,this.props.isGalleryEnabled?this._getGalleryButton():void 0];return this._showAddContactButton()&&e.push(this._getModernizedAddContactsButton()),e}_shouldUnfoldExtendedControlButtons(){return!this.state.useMobileUI&&!this.state.isMinDesktopWidth}_showAddContactButton(){return this.state.canInvitePeople&&!this.state.isRegularMemberInModeratedGroup}render(){const e=[le.controls],t=this.props.preventAccessibilityFocus?n.Types.ImportantForAccessibility.NoHideDescendants:void 0,s=this.props.preventAccessibilityFocus?-1:void 0,i=this._getButtonDescriptors(),o=null==i?void 0:i.reduce(((e,i,o)=>{if(!i)return e;i.color=this._adjustButtonColor(i);const{buttonStyle:n,textColor:r,hoverStyle:a}=this._getBarButtonStyles(i,0===o),l=this._renderBarButton(i,r,n,a,t,s,o);return l?(e.push(l),e):e}),[]);return n.createElement(n.View,{key:"rightcontrols",style:this.state.useMobileUI?e:le.compositeNav.controlsContainer},o)}_getBarButtonStyles(e,t){return{buttonStyle:this._getModernizedButtonStyle(e,t),textColor:this._getTextColor(e),hoverStyle:this._getHoverStyle(e)}}_getModernizedButtonStyle(e,t){if(e.buttonText)return[t?le.leftIconMargin:le.leftIconMarginControl];const s=e.status===ne.Disabled,i=[le.modernizeIconContainer,e.noBackgroundIcon?le.rightIconMargin:le.leftIconMargin];return s&&i.push(le.modernizedDisabledButton),i}_getTextColor(e){return e.status===ne.Selected?this.state.useMobileUI?this.state.userColor:Q.Color.white:e.status===ne.Disabled?Q.Color.white:this._themeColors.headerIconColor}_getHoverStyle(e){if(!this.state.useMobileUI)return e.color?le.compositeNav.headerButtonHover:this._themeStyles.buttonBackgroundHoverColorStyle}_renderBarButton(e,t,s,i,o,n,r){return e.buttonText?this._renderTextButton(e,t,s,r):e.icon?this._renderIconButton(e,t,s,i,o,n,r):void 0}_renderTextButton(e,t,s,i){const r=e.status===ne.Disabled,a={style:s,disabled:r,buttonConfig:this._getButtonConfig(e.color,t,r),backgroundStyle:e.icon?le.modernizedBackgroundStyle:this.state.useMobileUI?void 0:le.backgroundStyle,textStyleOverride:[J.default.fontStyle.body],buttonStyle:e.color||e.status===ne.Disabled?_.SXButtonStyle.Custom:_.SXButtonStyle.GradientFill,textStyleDeprecated:e.buttonTextStyle,buttonSize:_.SXButtonSize.Medium,iconSize:e.iconSize,key:e.key||`rightButton${i}`,icon:e.icon,gradientDirection:o.GradientDirection.BOTTOM_RIGHT,reverseGradientColor:!0,showGradientHover:!0,iconHorizontalMargin:e.iconHorizontalMargin,title:e.buttonText,hoverText:e.title,accessibilityLabel:e.accessibilityLabel||e.buttonText,accessibilityTraits:e.accessibilityTraits,allowTextWrap:!1,onPress:e.onPress,renderAccessoryView:e.renderAccessoryView};return n.createElement(q.default,Object.assign({},a,{ref:e.ref}))}_renderIconButton(e,t,s,i,o,r,a){var l;const d=e.noBackgroundIcon?this._themeColors.iconHoverColor:Q.Color.white,c={key:e.key||`rightButton${a}`,style:[...s,...e.style||[]],title:e.title,icon:e.icon,onPress:e.onPress,accessibilityLabel:e.accessibilityLabel,accessibilityTraits:e.accessibilityTraits,disabled:e.status===ne.Disabled,importantForAccessibility:o,tabIndex:r};return!e.noBackgroundIcon&&e.status!==ne.Disabled?n.createElement(h.default,Object.assign({ref:e.ref},c,{iconSize:e.iconSize,size:h.ActionButtonSize.Small,reverseGradientColor:!0})):n.createElement(R.default,Object.assign({ref:e.ref},c,{hoverStyle:i,size:null!==(l=e.iconSize)&&void 0!==l?l:$.IconSize.size20,color:t,hoverColor:d,toolTip:e.title}))}_getButtonConfig(e,t,s){if(e)return e?{backgroundColor:e,textColor:this.state.isConciergeBot?this._themeColors.buttonTextColor:Q.Color.white}:{backgroundColor:this._themeColors.buttonBackgroundColor,hoverBackgroundColor:s?void 0:this._themeColors.buttonBackgroundHoverColor,textColor:t}}_onStartCall(e){const t=se.default.newCauseId();L.log(A.LogTraceArea.ContentPanel,"ContentPanelHeader._onStartCall("+e+") "+t);const s=()=>{ee.callStarted(this.props.conversationId,e),this.state.isGroupConversation&&!this.state.showTwinCam&&O.default.beginTrackingJoinMeetNow(D.MeetNowOrigin.CallPanel),this.props.hasActiveCall&&this.props.activeCallStatus===S.ActiveCallStatus.Connected&&L.track(new m.FullChatUXTelemetryEvent(m.FullChatUXNavigation.Leave,this.props.conversationId,this.props.activeCallId||""));const s=A.NavigationCallOrigin.ConversationHeader;!G.default.shouldShowInterstitial(this.props.conversationId,e)||this.props.activeCallId?(z.default.isMobileSplitView()&&H.default.closeFindPanel(t,this._getContext()),this._ignoreDisposingCallObserving=!0,g.default.startCallOrMaybePrompt(this._getCallButtonRef,this._getRootViewId(),{skypeMri:this.state.skypeUserOwnerMri?this.state.skypeUserOwnerMri:this.props.conversationId,initiatingConversation:this.props.conversationId,onCallStartedAnsweredOrJoined:this.props.onCallStartedAnsweredOrJoined,userIntent:e?p.StartCallOrMaybePromptUserIntent.Video:p.StartCallOrMaybePromptUserIntent.Audio,phones:this.props.localAddressBookPhones,callOrigin:s,inviteOrigin:A.ContactInviteOrigin.ConversationHeader,showCallPreview:this.state.enableJoinerCallPreview,showTwinCam:this.state.showTwinCam},t,!1,this._getCallButtonRef)):G.default.maybeShowRinglessCallInterstitial(this.props.conversationId,e,s,t)};y.isPhoneMri(this.props.conversationId)&&k.default.shouldRequestAcknowledgementNoSubscription()?H.default.navigateToE911AcknowledgementPanel(t,this._getRootViewId(),s):s()}_adjustButtonColor(e){return e.status===ne.Disabled?Q.Color.gray300:e.color}}t.ContentPanelHeaderButtons=de,t.default=de},7788:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContentPanelHeaderDropdown=void 0;const i=s(96486),o=s(31844),n=s(16778),r=s(89391),a=s(62033),l=s(63413),d=s(76621),c=s(71830),h=s(96418),u=s(25739),p=s(57102),g=s(31761),m=s(20076),S=s(46096),f=s(76242),y=s(91771),_=s(49770),v=s(39285),C=s(36237),b=s(61253),T=s(15877),M=s(33754),I=s(45026),w=s(4735),P=s(95691),k=s(32226),A=s(93818),E=s(29130),R=s(10541),L=s(39182),F=s(15301),x=s(6262),O=s(49769),D=s(4057),B=s(81760),V=s(11828),N=s(80837),U=s(24576),H=s(72758),z=s(53374),W=s(73877);var j;!function(e){e[e.Visible=0]="Visible",e[e.Hiding=1]="Hiding",e[e.Hidden=2]="Hidden"}(j||(j={}));const G=(0,T.lazyProperties)({container:()=>n.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,bottom:0,backgroundColor:B.Color.transparent}),content:()=>n.Styles.createViewStyle({minHeight:50,alignSelf:"stretch",borderBottomLeftRadius:3,borderBottomRightRadius:3,flexDirection:"row"}),contentStacked:()=>n.Styles.createViewStyle({flexDirection:"column"}),background:()=>n.Styles.createViewStyle({flex:1,backgroundColor:B.Color.blackOverlay50}),rowStyle:()=>n.Styles.createViewStyle({paddingLeft:20}),menuSection:()=>n.Styles.createViewStyle({flex:1,flexBasis:0}),stackedSection:()=>n.Styles.createViewStyle({alignSelf:"stretch"}),gallerySection:()=>n.Styles.createViewStyle({flex:1,flexBasis:0,marginRight:15}),stackedGallerySection:()=>n.Styles.createViewStyle({alignSelf:"stretch",paddingHorizontal:20}),galleryButtonHeader:()=>n.Styles.createViewStyle({height:60}),galleryStacked:()=>n.Styles.createViewStyle({marginBottom:15}),hiddenContent:()=>n.Styles.createViewStyle({opacity:0})});class K extends U.default{constructor(){super(...arguments),this._isDragging=!1,this._contentTransform=0,this._contentContainerTransformValue=new n.Animated.Value(-200),this._contentContainerTransformStyle=n.Styles.createAnimatedViewStyle({transform:[{translateY:this._contentContainerTransformValue}]}),this._backgroundOpacityValue=new n.Animated.Value(0),this._backgroundOpacityStyle=n.Styles.createAnimatedViewStyle({opacity:this._backgroundOpacityValue}),this._onBackButtonPressed=()=>(this._dismiss(),!0),this._onLayoutChanged=e=>{const t={height:e.height,width:e.width};(0,b.default)(this.state.viewDimensions,t)||this.setState({viewDimensions:t})},this._dismiss=()=>{this.showOrHide()},this._onHasGalleryItems=e=>{this.isComponentMounted()&&this.state.hasGalleryItems!==e&&this.setState({hasGalleryItems:e})},this._onPanVertical=e=>{const t=e.pageY-e.initialPageY;let s=this._contentTransform+t;if(s>0&&(s=0),this._contentContainerTransformValue.setValue(s),this._isDragging||(this._isDragging=!0),e.isComplete){this._contentTransform+=t;const s=this.state.viewDimensions.height/2;let i=!1;i=!(e.velocityY<-.1)&&this._contentTransform>s,i?this._presentContent(!0):this.showOrHide()}},this._renderMenuItem=(e,t)=>{if(e===u.MenuItem.ShareLink)return n.createElement(_.default,{key:"item"+e,style:t||G.rowStyle,conversationId:this.props.conversationId,hideDivider:!0,origin:y.ShareGroupButtonOrigin.ConversationHeader});let s,i,o,r,a=!1;switch(e){case u.MenuItem.NewGroup:s=V.SkypeIcon.ContactGroupTwoPersonas;const t=this.state.firstName||this.state.displayName;i=t?M.getString("UserSettingsPanel.CreateNewGroupWithUser",{userName:t}):M.getString("SetConversationParticipantsPanel.CreateNewGroupTitle"),o=this._onCreateNewGroupWithUser;break;case u.MenuItem.PrivateConversation:s=V.SkypeIcon.PrivateChatFill,i=M.getString("DetailsPanelHeader.StartPrivateConversationButtonTitle"),o=this._onStartPrivateConversation;break;case u.MenuItem.SendSMS:s=V.SkypeIcon.MobileSmsNew,i=M.getString("SMSMessaging.ContactOptionsPopupSendSMSLabel"),o=this._onPressSMSMessageButton,r=this._onSmsButtonRef;break;case u.MenuItem.Translate:s=V.SkypeIcon.SkypeTranslator,i=M.getString("UserSettingsPanel.CreateNewTranslatedChatWithUser"),a=this.state.creatingTranslatedChat,o=this._onCreateNewTranslatorGroupWithUser;break;case u.MenuItem.Settings:s=V.SkypeIcon.Info,i=M.getString("ConversationDropDown.SettingsTitle"),o=this._onNavigateToSettings;break;case u.MenuItem.Gallery:s=V.SkypeIcon.Gallery1,i=M.getString("GalleryPanel.DesktopPanelTitle"),o=this._onNavigateToGallery;break;case u.MenuItem.AddParticipants:s=V.SkypeIcon.ContactAdd,i=M.getString("GroupProfilePanel.AddToGroupTitle"),o=this._onNavigateToAddPeople,a=!this.state.isConnected;break;default:s=z.default.switchStatementExhaustiveChecking(e)}return n.createElement(L.default,{key:"item"+e,ref:r,style:t||G.rowStyle,icon:s,title:i,disabled:a,hideDivider:!0,onPress:o})},this._onCreateNewGroupWithUser=()=>{if(this._dismiss(),!this.props.otherPartyMri)return;new g.default({peopleType:R.PeopleType.All,filterPeopleType:R.FilterType.GroupCapable,invitedUsersMris:[this.props.otherPartyMri],navigationOrigin:S.NavigationConversationOrigin.UserProfileNewGroupWithUser,wizardSteps:[P.WizardSteps.setConvParticipants]}).start(this._getRootViewId())},this._onStartPrivateConversation=()=>{this._dismiss(),this.props.otherPartyMri&&m.createAndNavigateToPrivateConversation(this.props.otherPartyMri,S.E2EEInviteOrigin.UserProfile,this._getContext())},this._onPressSMSMessageButton=()=>{if(!this.props.otherPartyMri)return void this._dismiss();const e=z.default.newCauseId();C.log(S.LogTraceArea.Navigation,"UserProfileContent._onPressSMSMessageButton causeId: "+e),O.default.getPhoneNumberToNavigateTo(this.props.otherPartyMri,(()=>this._smsButtonRef),this._getRootViewId()).then((t=>{this._dismiss(),t&&this.props.otherPartyMri&&d.default.ensureConversationLoadedOrFaked(this.props.otherPartyMri,S.ConversationFakedOrigin.SmsMessageButton).then((s=>{F.default.setFlowId(F.SmsFlowId.UserProfile),F.default.setNextFlowId(F.SmsFlowId.UserProfile),w.default.navigateToConversation({convId:this.props.otherPartyMri,origin:S.NavigationConversationOrigin.UserProfile,isNewConversation:s,causeId:e,selectedNumberForSMS:t})}))})).catch(i.noop)},this._onCreateNewTranslatorGroupWithUser=()=>{if(!this.props.otherPartyMri)return;this.setState({creatingTranslatedChat:!0});const e=z.default.newCauseId();C.log(S.LogTraceArea.Navigation,"UserProfileContent._onCreateNewTranslatorGroupWithUser causeId: "+e),p.ConversationUtils.getTranslatedChatWithUser(this.props.otherPartyMri,this.state.firstName||this.state.displayName||"",this.state.translatorAgentId).then((t=>{d.default.ensureConversationLoadedOrFaked(t.conversationId,S.ConversationFakedOrigin.TranslatedChat).then((()=>(this._dismiss(),this.isComponentMounted()&&this.setState({creatingTranslatedChat:!1}),w.default.navigateToConversation({causeId:e,convId:t.conversationId,origin:S.NavigationConversationOrigin.LinkForNewGroupWithUserAndBot,isNewConversation:t.isNewConversation}))))})).fail((e=>{C.error(S.LogTraceArea.Profile,"Failed to get translated chat with user",D.default.errorAsString(e)),this.isComponentMounted()&&this.setState({creatingTranslatedChat:!1})})),C.track(new A.CreateTranslatedChatWithUserClicked)},this._onNavigateToSettings=()=>{this._dismiss();const e=z.default.newCauseId();C.log(S.LogTraceArea.Navigation,"ContentPanelHeaderDropDown._onNavigateToSettings, causeId: "+e),w.default.showDetailsPanelWithParams({mri:this.props.conversationId,showConversationSettings:!0,rootViewId:this._getRootViewId(),causeId:e})},this._onNavigateToGallery=()=>{this._dismiss(),w.default.toggleGallery(this.props.conversationId,this._getContext())},this._onSmsButtonRef=e=>{this._smsButtonRef=e||void 0},this._onNavigateToAddPeople=()=>{if(this.state.isConnected){this._dismiss();new g.default({convId:this.props.conversationId,peopleType:R.PeopleType.AllExcludingBots,filterPeopleType:R.FilterType.GroupCapable,navigationOrigin:S.NavigationConversationOrigin.GroupProfile,wizardSteps:[P.WizardSteps.setConvParticipants]}).start(this._getRootViewId())}}}_buildState(e,t){const s=r.default.getS4LCMCFeatures(),i=e.otherPartyMri?H.default.getFullUserProfileByMri(e.otherPartyMri):void 0,o=this._getRootViewId(),n={isMriBlocked:e.otherPartyMri&&(l.default.isMriBlocked(e.otherPartyMri)||c.isBlockedPSTNMri(e.otherPartyMri)),deviceOrientation:E.default.getDeviceOrientation(o),canShowSmsEntryPoint:x.default.isPaidUser(),isEncryptedThread:c.isEncryptedThread(e.conversationId),createTranslatedChatEnabled:s.createTranslatedChatEnabled,translatorAgentId:s.translatorAgentId,isTranslatorMriBlocked:void 0!==s.translatorAgentId&&l.default.isMriBlocked(s.translatorAgentId),displayName:i?i.getDisplayName():void 0,firstName:i?i.firstName:void 0,isConnected:k.default.isConnected()};if(t){n.shouldRenderContent=!1,n.visibility=j.Hidden;const e=W.default.measureWindow(this._getRootViewId());n.viewDimensions={height:200,width:e.width},n.creatingTranslatedChat=!1,n.hasGalleryItems=!1}return n.menuItems=u.default.getMenuItems({isMriBlocked:n.isMriBlocked,isEncryptedThread:n.isEncryptedThread,createTranslatedChatEnabled:n.createTranslatedChatEnabled,hasTranslatorAgentId:!!n.translatorAgentId,isTranslatorMriBlocked:n.isTranslatorMriBlocked,canShowSmsEntryPoint:n.canShowSmsEntryPoint,otherPartyMri:e.otherPartyMri}),n}showOrHide(e){if(this.isComponentMounted()){let t;this.state.visibility===j.Visible?(t=j.Hiding,h.default.setCoachMarkEnabled(!0)):(t=j.Visible,h.default.setCoachMarkEnabled(!1),this._contentContainerTransformValue.setValue(-1*this.state.viewDimensions.height));const s=this.state.shouldRenderContent||t===j.Visible;this.setState({shouldRenderContent:s,visibility:t},e)}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.visibility!==t.visibility&&(this.state.visibility===j.Hiding?(this._dismissContent(!0),a.default.unsubscribe(this._onBackButtonPressed)):this.state.visibility===j.Visible&&(this._presentContent(!0),a.default.subscribe(this._onBackButtonPressed)))}_presentContent(e){this._expandOrCollapse(!0,e)}_dismissContent(e){this._expandOrCollapse(!1,e,(()=>{this.isComponentMounted()&&this.state.visibility===j.Hiding&&this.setState({visibility:j.Hidden})}))}_expandOrCollapse(e,t=!0,s){if(0===this.state.viewDimensions.height)return;const i=e?0:-1*this.state.viewDimensions.height,o=e?1:0,r=()=>{s&&s(),this._isDragging=!1};if(this._animation&&(this._animation.stop(),this._animation=void 0),t){const e=200;this._animation=n.Animated.parallel([I.default.timing(this._backgroundOpacityValue,{toValue:o,duration:e,easing:n.Animated.Easing.Out(),useNativeDriver:!0}),I.default.timing(this._contentContainerTransformValue,{toValue:i,duration:e,easing:n.Animated.Easing.Out(),useNativeDriver:!0})]),this._animation.start(r)}else this._backgroundOpacityValue.setValue(o),this._contentContainerTransformValue.setValue(i),r();this._contentTransform=i}_renderMenu(){const e=i.map(this.state.menuItems,(e=>this._renderMenuItem(e)));return n.createElement(n.View,null,e)}render(){if(!this.state.shouldRenderContent)return null;const e=this.state.visibility===j.Hidden,t=[G.content,this._themeStyles.primaryBackgroundColorStyle],s=this.state.deviceOrientation===o.DeviceOrientation.Portrait;s&&t.push(G.contentStacked);const i=n.createElement(n.GestureView,{onPanVertical:this._onPanVertical,panPixelThreshold:20,releaseOnRequest:!1,importantForAccessibility:n.Types.ImportantForAccessibility.No},n.createElement(n.View,{style:t,onLayout:this._onLayoutChanged},n.createElement(n.View,{style:s?G.stackedSection:G.menuSection},this._renderMenu()),n.createElement(n.View,{style:s?G.stackedGallerySection:G.gallerySection},this.state.hasGalleryItems?this._renderMenuItem(u.MenuItem.Gallery,G.galleryButtonHeader):void 0,n.createElement(f.default,{style:G.galleryStacked,conversationId:this.props.conversationId,usePortraitLayout:!0,useRoundedCorners:!0,hideWhenEmpty:!0,onItemPress:this._dismiss,onHasItems:this._onHasGalleryItems})))),r=[N.default.absoluteFill,this._contentContainerTransformStyle],a=[G.container];e&&a.push(G.hiddenContent);const l=e?void 0:n.createElement(v.default,{style:N.default.absoluteFill,onPress:this._dismiss,disableTouchOpacityAnimation:!0},n.createElement(n.Animated.View,{style:[G.background,this._backgroundOpacityStyle]}));return n.createElement(n.Animated.View,{style:a,importantForAccessibility:e?n.Types.ImportantForAccessibility.NoHideDescendants:n.Types.ImportantForAccessibility.No,blockPointerEvents:e},l,n.createElement(n.Animated.View,{style:r,ignorePointerEvents:!0},i))}}t.ContentPanelHeaderDropdown=K,t.default=K},64245:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(44228),n=s(53211),r=(0,s(15877).lazyProperties)({rowStyle:()=>i.Styles.createViewStyle({minHeight:44})});class a extends o.default{_buildRows(e){const{descriptors:t,onRowPress:s}=e;return null==t?void 0:t.reduce(((e,t)=>{if(!t)return e;const{icon:i,iconSize:o,key:a,onPress:l,title:d}=t;return e.push({props:{key:a,icon:i,iconSize:o,titleText:d,onRowPress:()=>{null==l||l(),s()},style:[r.rowStyle],hideBorder:!0},builder:n.default.buildRow}),e}),[])}}t.default=a},30963:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(78045),n=s(16778),r=s(89391),a=s(94224),l=s(44279),d=s(47447),c=s(1706),h=s(71830),u=s(34196),p=s(25739),g=s(81632),m=s(3871),S=s(75049),f=s(39549),y=s(86374),_=s(52262),v=s(70891),C=s(11375),b=s(36400),T=s(10117),M=s(5581),I=s(23944),w=s(61253),P=s(58666),k=s(15877),A=s(33754),E=s(53703),R=s(80622),L=s(30124),F=s(27357),x=s(27683),O=s(54565),D=s(81760),B=s(11010),V=s(11828),N=s(96755),U=s(24576),H=s(12770),z=s(88117),W=s(21788),j=s(72758),G=(0,k.lazyProperties)({titleContainer:()=>n.Styles.createViewStyle({flex:1,paddingHorizontal:0,alignItems:"stretch",justifyContent:"center"}),headerContainer:()=>n.Styles.createViewStyle({flex:1,justifyContent:"center"}),firstRow:()=>n.Styles.createButtonStyle({justifyContent:"flex-start",flexDirection:"row"}),secondRow:()=>n.Styles.createViewStyle({flex:-1,justifyContent:"flex-start",flexDirection:"row"}),secondRowHeight:()=>n.Styles.createViewStyle({height:25}),secondRowDivider:()=>n.Styles.createViewStyle({marginLeft:7,marginRight:3}),secondRowDividerRN:()=>n.Styles.createViewStyle({marginHorizontal:0}),secondRowTextStyles:()=>n.Styles.createTextStyle({flex:-1,lineHeight:25,height:25}),conversationNameText:()=>n.Styles.createTextStyle({color:D.Color.black,font:B.default.font.uiDisplayBold,fontSize:B.default.controlFontSize.headerSizeSmall,flexShrink:1}),textTruncation:()=>n.Styles.createViewStyle({flexShrink:1}),userPresenceIndicator:()=>n.Styles.createViewStyle({width:8,height:8,borderRadius:4,marginRight:4,alignSelf:"center",bottom:0}),lockIcon:()=>n.Styles.createViewStyle({paddingRight:6,paddingTop:2}),conversationName:()=>n.Styles.createViewStyle({bottom:0,alignItems:"center",flexDirection:"row",flexShrink:1}),buttonIcon:()=>n.Styles.createTextStyle({minWidth:V.IconSize.size16,textAlign:"center",marginRight:3}),button:()=>n.Styles.createViewStyle({flexShrink:0,flexDirection:"row",alignItems:"center",paddingLeft:4,marginRight:7}),translatorButtonIcon:()=>n.Styles.createViewStyle({minWidth:V.IconSize.size16,marginRight:3}),translatorButton:()=>n.Styles.createViewStyle({flexShrink:0,flexDirection:"row",alignItems:"center",paddingLeft:4,marginRight:7}),noPaddingRightStyle:()=>n.Styles.createViewStyle({paddingRight:0}),manageGroupWrapper:()=>n.Styles.createViewStyle({height:20,width:23}),manageGroupIcon:()=>n.Styles.createTextStyle({paddingLeft:3,paddingTop:0,paddingRight:0,marginRight:0,lineHeight:20})});class K extends U.default{constructor(){super(...arguments),this.handleFocusEvent=e=>!(e!==C.FocusEvent.MessageSearchClosed||!this._findButtonRef)&&(this._findButtonRef.requestFocus(),!0),this._onFirstRowButtonPress=e=>{this.props.onPress&&this.props.onPress(e)},this._onTranslatorPress=e=>{e.stopPropagation(),this._onFirstRowButtonPress(e)}}_buildState(e,t){const s=(0,f.default)().getConversation(e.conversationId);let i=_.default.getDisplayName(e.conversationOwnerMri);const o=h.isAgent(e.conversationId);i&&s&&!s.isThread()&&!o&&x.default.isPossiblyPhoneNumber(i)&&x.default.isPossibleNumber(i)&&(i=x.default.parseAndFormat(i,x.PhoneNumberFormat.INTERNATIONAL)||i);const n=r.default.getS4LMessagingFeatures();let d={conversationName:i,isEncryptedThread:h.isEncryptedThread(e.conversationId),memberCount:s?Math.max(s.getMemberCount(),0):0,groupedConversationsEnabled:n.enableGroupedConversations,moodReact:void 0,moodRawText:void 0,callRateText:void 0,theme:void 0,isGalleryShowing:F.default.isGalleryShowing(this._getRootViewId()),isOneOnOne:!!s&&s.isOneOnOne(),isTranslatedConversation:a.default.InCallBotUtils.isCallTranslatorBotTranslationEnabled(e.conversationId)&&M.default.isConversationTranslated(e.conversationId),translatorLocale:M.default.getLocalCallTranslatorBotSpokenLanguageLocale(),isTrustedAgent:o&&c.default.isTrustedAgent(e.conversationId)};const u=e.conversationOwnerMri;if(e.shouldShowUserPresence&&u){const e=j.default.getFullUserProfileByMri(u);if(d.gender=e&&e.gender,d.userPresence=W.default.getCachedUserPresence(u),d.isUserActive=W.default.isActiveUser(u),e.mood){d.theme=this._currentTheme;const s=y.decodeFromContent(e.mood),i=g.toEntities(s,{supportEmoticons:!0});if(d.moodRawText=i?I.getRawText(i):void 0,d.moodLabel=R.getAccessibilityTitle(e.mood),t||!(0,w.default)(d.moodRawText,this.state.moodRawText)||d.theme!==this.state.theme){const e=this._themeColors,t=this._themeStyles,i=this._getSecondLineStyle(t.secondaryTextColorStyle),o={processing:{emoticons:v.ProcessingLevel.Full,quotes:v.ProcessingLevel.None,wikiMarkup:v.ProcessingLevel.Stripped,links:v.ProcessingLevel.Full,atMentions:v.ProcessingLevel.Stripped},renderMedia:!1,mediaPlaceholderIconColor:e.primaryTextColor,allowLargeEmoticons:!1,numberOfLines:1,textOverrideStyle:i,boldTextStyle:i,regularTextStyle:i,linkStyle:t.linkTextColorStyle};d.moodReact=(0,m.renderReact)(s,o).value}else d.moodReact=this.state.moodReact}}else e.shouldShowCallRate&&e.otherPartyMri&&(d.callRateText=l.default.getCallRateByMri(e.otherPartyMri));return d}componentDidMount(){super.componentDidMount(),this._updateLastSeenTextTimer=H.default.setInterval((()=>{this.state.userPresence&&this.state.userPresence.lastSeenAtUtc&&this.isComponentMounted()&&this.forceUpdate()}),6e4),C.register(C.FocusEvent.MessageSearchClosed,this),this._fetchUserPresence(this.props)}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t);this.props.conversationId!==e.conversationId&&this._fetchUserPresence(e)}componentWillUnmount(){super.componentWillUnmount(),i.isUndefined(this._updateLastSeenTextTimer)||H.default.clearInterval(this._updateLastSeenTextTimer),C.unregister(C.FocusEvent.MessageSearchClosed,this)}componentDidUpdate(e,t,s){if(super.componentDidUpdate(e,t,s),L.default.isUsingSplitView()&&this.state.conversationName&&this.state.conversationName!==t.conversationName){const e=S.default.rootViewIdForConversationMri(this.props.conversationId);o.default.setTitle(e,this.state.conversationName)}}_fetchUserPresence(e){const t=e.conversationOwnerMri;e.shouldShowUserPresence&&t&&O.default.forceFetchPresence(t)}_renderSecondRowText(e,t,s,i=this.props.onPress){const o=this._getSecondLineStyle(this._themeStyles.secondaryTextColorStyle),r=n.createElement(n.Text,{key:"secondRowText",style:o,numberOfLines:1},e);return this._renderSecondRowItems(r,void 0,t,s,i)}_renderSecondRowItems(e,t,s,i,o=this.props.onPress){return n.createElement(n.View,{style:G.secondRow},n.createElement(b.HoverableButton,{onPress:o,style:G.secondRow,title:i,importantForAccessibility:n.Types.ImportantForAccessibility.NoHideDescendants,tabIndex:-1,disableHoverOpacityStyles:!o,disableCursor:!o},t,e),this._renderTranslatorButton())}_renderTranslatorButton(){if(this.state.isTranslatedConversation&&this.state.translatorLocale){const e=A.getString("ContentPanelHeaderTitle.TranslatedToTitle",{language:this._getLanguageTitle(this.state.translatorLocale)});return[this._renderDivider("translatorDivider"),n.createElement(b.HoverableButton,{key:"translator-button",onPress:this._onTranslatorPress,style:G.translatorButton,title:A.getString("ContentPanelHeaderTitle.TranslatorButtonTitle"),importantForAccessibility:n.Types.ImportantForAccessibility.Yes},n.createElement(T.default,{icon:V.SkypeIcon.SkypeTranslator,style:G.translatorButtonIcon,color:this._themeColors.secondaryTextColor,size:V.IconSize.size12}),n.createElement(n.Text,{style:this._getSecondLineStyle(this._themeStyles.secondaryTextColorStyle),numberOfLines:1},e))]}}_renderDivider(e){const t=this._getSecondLineStyle(this._themeStyles.secondaryTextColorStyle),s=d.UICapabilities.inlineTextFormattingSupported()?[G.secondRowDivider,t]:[G.secondRowDividerRN,t];return n.createElement(N.default,{style:s,key:e})}render(){const e=[B.default.fontStyle.messagingStreamChatHeader,G.textTruncation,this._themeStyles.headerTextColorStyle],t=this.props.preventAccessibilityFocus?n.Types.ImportantForAccessibility.NoHideDescendants:void 0,s=this.props.preventAccessibilityFocus?-1:void 0,i=this.state.isEncryptedThread&&!this.state.groupedConversationsEnabled?n.createElement(T.default,{key:"lockIcon",icon:V.SkypeIcon.Lock,size:V.IconSize.size20,color:this._themeColors.headerTextColor,style:G.lockIcon}):void 0,o=p.default.accessibilityLabel(this.state,!!this.props.hideSecondRow,!!this.props.shouldShowUserPresence,!!this.props.shouldShowCallRate),r=this.props.hideSecondRow?void 0:this._renderSecondRow(),a=this.state.isTrustedAgent?this._getOptionalCertifiedIcon():void 0,l=!this.state.isTrustedAgent&&this.props.onPress?this._getOptionalGroupManageIcon():void 0,d=n.createElement(n.View,{style:G.headerContainer},n.createElement(n.View,{style:G.firstRow},n.createElement(b.HoverableButton,{onPress:this.props.onPress?this._onFirstRowButtonPress:void 0,title:this.state.conversationName,style:G.textTruncation,accessibilityLabel:o,importantForAccessibility:t,tabIndex:s,activeOpacity:this.props.activeOpacity,disableHoverOpacityStyles:!this.props.onPress,disableCursor:!this.props.onPress},n.createElement(n.View,{style:G.conversationName},i,n.createElement(n.Text,{style:e,numberOfLines:1,ellipsizeMode:"tail"},this.state.conversationName?this.state.conversationName.split("\n",1):""),a,l))),r);return n.createElement(n.View,{style:G.titleContainer},d)}_getOptionalCertifiedIcon(){return n.createElement(u.default,{botMri:this.props.conversationId})}_getOptionalGroupManageIcon(){return n.createElement(n.View,{style:G.manageGroupWrapper},n.createElement(E.default,{key:`manageGroupButton-${this.props.conversationId}`,iconColorOverride:this._themeColors.iconHoverColor,onPress:this.props.onPress,accessibilityLabel:A.getString("CallPanel.ManageGroupAccessibilityLabel"),isCompact:!1,style:G.manageGroupIcon,iconSize:V.IconSize.size20,hoverColor:this._themeColors.headerIconColor,disableHoverOpacityStyles:!0}))}_renderSecondRow(){const e=this._getSecondLineStyle(this._themeStyles.secondaryTextColorStyle),t=h.isS4BBridgeMri(this.props.conversationId);if(this.props.shouldShowUserPresence&&!t){const t=h.getLastSeenPresenceText(this.state.userPresence,!1,this.state.gender,this.state.isUserActive);let s;const i=h.getHoverTitle(this.state.userPresence,this.state.gender);if(!this.props.hidePresenceIndicator&&this.state.userPresence&&this.state.userPresence.status&&(s=z.default.getPresenceIcon(p.default.getPresenceStatusForIcon(this.state.isUserActive,this.state.userPresence),G.userPresenceIndicator,V.IconSize.size8,void 0,i)),s||t||this.state.moodReact){const i=this.state.moodLabel?A.getString("ContentPanelHeaderTitle.MoodMessageWrapper",{moodMessage:this.state.moodLabel}):void 0,o=this.state.moodReact||n.createElement(n.Text,{key:"userPresenceText",style:e,numberOfLines:1},t);return this._renderSecondRowItems(o,s,i,this.state.moodRawText||t)}}else{if(!this.props.otherPartyMri){const e=A.getString("ContentPanelHeaderTitle.ParticipantsLowercase",{count:this.state.memberCount});return this._renderSecondRowText(e,e,e)}if(this.props.shouldShowCallRate)return n.createElement(n.Text,{style:e},this.state.callRateText);if(t)return n.createElement(n.Text,{style:e},A.getString("ContentPanelHeaderTitle.TeamsInteropSubtitle"))}}_getSecondLineStyle(e){return[B.default.fontStyle.messagingStreamChatSubHeader,e]}_getLanguageTitle(e){const t=P.getShortLanguageTitle(e);return i.isEmpty(t)?e:t}}t.default=K},89888:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=(s(31844),s(16778)),n=s(89391),r=s(77605),a=s(71830),l=s(75760),d=s(31751),c=s(62340),h=s(20770),u=s(39549),p=s(78118),g=s(57102),m=s(57139),S=s(46096),f=s(13944),y=s(36237),_=s(47126),v=s(15877),C=s(33754),b=s(17999),T=s(6250),M=s(34537),I=s(66127),w=s(78735),P=s(4735),k=s(30124),A=s(29130),E=s(81115),R=s(26978),L=s(81760),F=s(11828),x=s(80837),O=s(60305),D=s(24576),B=s(12770),V=s(53374),N=(0,v.lazyProperties)({wrapper:()=>o.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-start"}),wrapperStackNav:()=>o.Styles.createViewStyle({paddingTop:10}),hiddenTabsDropdownButtonContainer:()=>o.Styles.createViewStyle({width:50,flexDirection:"row",alignItems:"center",justifyContent:"center",paddingBottom:8}),hiddenTabsDropdownBadge:()=>o.Styles.createViewStyle({marginLeft:6}),hiddenTabsDropdownWithCounterContainer:()=>o.Styles.createViewStyle({width:62}),desktopTabContainer:()=>o.Styles.createViewStyle({minWidth:148}),hiddenTabContainer:()=>o.Styles.createViewStyle({height:40,paddingVertical:10,justifyContent:"flex-start",borderBottomWidth:0})});class U extends D.default{constructor(){super(...arguments),this._mountedRefsMap=new T.default,this._overflowTelemetrySent=!1,this._visitedConversations=[],this._renderConversationTab=(e,t,s)=>{let i;const n=this.state.conversationIds&&this.state.conversationIds.length||0;this.state.counts&&this.state.counts[e]&&this.state.counts[e].unreadCount&&(i=this.state.counts[e].unreadCount);const r=[];let a,l;return this.state.isSmallScreen||r.push(N.desktopTabContainer),(this.state.isSmallScreen||this.state.enableConversationTabsDropdown&&this.state.tabsConfiguration.hiddenConversations.length)&&r.push(x.default.flexOne),s&&this.state.enableConversationTabsDropdown&&(a=this._themeStyles.rowHoverViewStyle,l=this._themeStyles.rowHoverViewStyle,r.push(x.default.flexOne,N.hiddenTabContainer),t<this.state.conversationIds.length-1&&r.push(o.Styles.createViewStyle({borderColor:this._themeColors.secondaryBackgroundColor,borderBottomWidth:1},!1))),o.createElement(c.default,{key:e,ref:this._mountedRefsMap.onComponentRef(e),convId:e,icon:g.ConversationUtils.getIconForConversationMri(e),tabPosition:t,totalTabs:n,tabContainerStyle:r,tabContainerHoverStyle:a,tabContainerSelectedStyle:l,selected:this.props.currentConversationId===e,focused:this.state.focusedConversationId===e,shouldUpdateOnFocus:this.state.hasFocus,badgeCount:i,onShowActionMenu:this._showActionMenu,onNavigateToConversation:this._navigateToConversation,preventAccessibilityFocus:this.props.preventAccessibilityFocus,hasMultipleSmsTabs:this._hasMultipleSmsTabs()})},this._onHiddenTabsDropdownButtonRef=e=>{this._hiddenTabsDropdownButtonRef=e||void 0},this._onHiddenTabsDropdownButtonPress=()=>{const e=V.default.newCauseId();y.log(S.LogTraceArea.Navigation,"ConversationGroupSwitcher._onHiddenTabsDropdownButtonPress isHiddenTabsDropdownVisible: "+this._isHiddenTabsDropdownVisible+" causeId: "+e),this._isHiddenTabsDropdownVisible?this._hideHiddenTabsDropdown(e):this._showHiddenTabsDropdown(this.state.tabsConfiguration.hiddenConversations,e)},this._navigateToConversation=e=>{const t=V.default.newCauseId();let s;y.log(S.LogTraceArea.Navigation,"ConversationGroupSwitcher._navigateToConversation, causeId: "+t),s=()=>{w.default.setLastOpenedTabForUser(this.props.mri,e),P.default.navigateToConversation({causeId:t,convId:e,shouldReplaceCurrentContext:!0,origin:S.NavigationConversationOrigin.TabSwitcher})},this.state.enableConversationTabsDropdown?this.setState({headTabId:e},s):s()},this._showActionMenu=(e,t)=>{p.default.open(e,t,(()=>this._mountedRefsMap.ref(t)),this._getContext())},this._onKeyPress=e=>{if(!this.isComponentMounted())return;const t=this.state.conversationIds;let s=i.findIndex(t,(e=>e===this.state.focusedConversationId));e.keyCode!==_.default.DOWN&&e.keyCode!==_.default.LEFT||(s-=1),e.keyCode!==_.default.UP&&e.keyCode!==_.default.RIGHT||(s+=1),s<0?s=t.length-1:s>=t.length&&(s=0),this.setState({focusedConversationId:t[s]})},this._onBlur=()=>{this._focusResetTimeout&&B.default.clearTimeout(this._focusResetTimeout),this._focusResetTimeout=B.default.setTimeout((()=>{this.isComponentMounted()&&this.state.focusedConversationId!==this.props.currentConversationId&&this.setState({hasFocus:!1,focusedConversationId:this.props.currentConversationId})}),250)},this._onFocus=()=>{this.isComponentMounted()&&!this.state.hasFocus&&this.setState({hasFocus:!0}),this._focusResetTimeout&&(B.default.clearTimeout(this._focusResetTimeout),this._focusResetTimeout=void 0)}}_buildState(e,t){const s=(0,u.default)().getConversation(e.currentConversationId),o=a.isOneOnOneConversation(e.mri)?d.default.getDisplayableConversationsForUser(e.currentConversationId):[],r=a.isOneOnOneConversation(e.mri)?d.default.getAllSiblingConversations(e.currentConversationId):[],c=n.default.getS4LMessagingFeaturesNoSubscription().enableConversationTabsDropdown;s&&!i.includes(this._visitedConversations,s)&&i.includes(r,s)&&!i.includes(o,s)&&this._visitedConversations.push(s);const p=h.default.getConversationsWithDraft(),m=i.intersection(p,r);let S=i.intersection(this._visitedConversations,r);S.length||(this._visitedConversations=[]);let f=i.uniqBy(o.concat(S,m),"id"),y=g.ConversationUtils.getOrderedConversationIds(f,s);const _=this._getRootViewId(),v=k.default.isUsingStackNavigationContext(),C=A.default.getWidth(_),b=e.currentConversationId,T=C<=750,w=T?0:R.default.getWidth(R.SideBar.Left),P=I.default.canModernizeConversationList(),E={conversationIds:y,isSmallScreen:T,isStackNav:v,width:C,badgeColorStyle:M.default.getBadgeColorStyle(P,this._currentTheme),focusedConversationId:b,enableConversationTabsDropdown:c,isSmallDevice:A.default.isSmallDevice(_)};return this._hasMultipleConversations(E)?E.counts=i.reduce(y,((e,t)=>(e[t]=l.default.getMessageCountsForConversation(t),e)),{}):E.counts=void 0,t&&(E.hasFocus=!1),c&&(E.tabsConfiguration=this._getTabsConfiguration(y,E.width||0,w)),E}UNSAFE_componentWillUpdate(e,t,s){if(super.UNSAFE_componentWillUpdate(e,t,s),this.state.enableConversationTabsDropdown&&this.state.tabsConfiguration.hiddenConversations.length!==t.tabsConfiguration.hiddenConversations.length){const e=V.default.newCauseId();y.log(S.LogTraceArea.Navigation,"ConversationGroupSwitcher.UNSAFE_componentWillUpdate, causeId: "+e),this._hideHiddenTabsDropdown(e)}}_hasMultipleConversations(e=this.state){return!!e.conversationIds&&e.conversationIds.length>1}_hasMultipleSmsTabs(e=this.state){return!!e.conversationIds&&e.conversationIds.filter((e=>a.isPhoneMri(e))).length>1}_renderTabsDropdownContainer(){if(!this.state.enableConversationTabsDropdown)return;if(!this.state.tabsConfiguration.hiddenConversations.length)return;const e=this.state.tabsConfiguration.hiddenConversations.map((e=>this.state.counts&&this.state.counts[e]&&this.state.counts[e].unreadCount||0)).reduce(((e,t)=>t+e)),t=e&&!this.state.isSmallDevice?o.createElement(r.default,{count:e.toString(),rawCount:e,badgeSize:r.BadgeSize.Desktop,isHighPriority:!0,colorStyle:this.state.badgeColorStyle,style:N.hiddenTabsDropdownBadge}):null,s=[N.hiddenTabsDropdownButtonContainer];e&&s.push(N.hiddenTabsDropdownWithCounterContainer);const i=this.props.preventAccessibilityFocus?o.Types.ImportantForAccessibility.NoHideDescendants:void 0;return o.createElement(o.View,{style:s,importantForAccessibility:i},o.createElement(f.default,{ref:this._onHiddenTabsDropdownButtonRef,icon:F.SkypeIcon.DownChevron,title:C.getString("Global.MoreButtonTitle"),color:L.Color.gray300,hoverColor:this._themeColors.iconHoverColor,size:F.IconSize.size15,onPress:this._onHiddenTabsDropdownButtonPress}),t)}render(){const{tabsConfiguration:e,conversationIds:t}=this.state,s=this._hasMultipleConversations(),n=[N.wrapper,this._themeStyles.messageStreamBackgroundColorStyle];this.props.safeAreaHorizontalInsets&&E.default.hasHorizontalSafeAreas(this.props.safeAreaHorizontalInsets)&&n.push(E.default.horizontalPaddingStyle(this.props.safeAreaHorizontalInsets)),this.props.style&&n.push(this.props.style),this.state.isStackNav&&s&&n.push(N.wrapperStackNav),s&&this.props.heightStyle&&n.push(this.props.heightStyle);let r=[];return r=this.state.enableConversationTabsDropdown?s?i.map(e.visibleConversations,((e,t)=>this._renderConversationTab(e,t,!1))):void 0:s?i.map(t,((e,t)=>this._renderConversationTab(e,t,!1))):void 0,r?o.createElement(o.View,{style:n,importantForAccessibility:o.Types.ImportantForAccessibility.Yes,accessibilityTraits:o.Types.AccessibilityTrait.TabList,onKeyPress:this._onKeyPress,onFocus:this._onFocus,onBlur:this._onBlur},r,this._renderTabsDropdownContainer()):o.createElement(o.View,{style:n})}_hideHiddenTabsDropdown(e){y.log(S.LogTraceArea.Navigation,"ConversationGroupSwitcher._hideHiddenTabsDropdown, causeId: "+e),m.default.close(this._getRootViewId(),e)}_showHiddenTabsDropdown(e,t){y.log(S.LogTraceArea.Navigation,"ConversationGroupSwitcher._showHiddenTabsDropdown, causeId: "+t);const s=e.map(((e,t)=>{const s=this._renderConversationTab(e,t,!0);return{builder:()=>s,props:{key:e+t,rowHeight:40}}}));this._isHiddenTabsDropdownVisible=!0,m.default.showWithBuilders({builders:s,anchor:()=>this._hiddenTabsDropdownButtonRef,rootViewId:this._getRootViewId(),getTitle:()=>{},onCloseMenu:e=>{y.log(S.LogTraceArea.Navigation,"ConversationGroupSwitcher.onCloseMenu, causeId: "+e),this._isHiddenTabsDropdownVisible=!1},staticContent:!0,useDesktopPopup:!0,menuId:"HiddenTabsMenu"})}_getTabsConfiguration(e,t,s){const o={hiddenConversations:[],visibleConversations:[]},n=t-s,r=A.default.isSmallDevice(this._getRootViewId());O.default.isTablet();let a=3;a=r?2:(n-62)/148;const l=Math.min(a,e.length),d=[...e];if(o.visibleConversations=d.splice(0,l),o.hiddenConversations=d,this.state&&void 0!==this.state.headTabId){const e=i.remove(o.hiddenConversations,(e=>e===this.state.headTabId));if(e.length){const t=o.visibleConversations.splice(-1,1,e[0]);o.hiddenConversations.unshift(t[0])}}return o.hiddenConversations.length&&!this._overflowTelemetrySent&&(this._overflowTelemetrySent=!0,y.track(new b.MessagingTabsHiddenEvent(o.visibleConversations.length,o.hiddenConversations.length))),o}}t.default=U},62340:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(77605),n=s(71830),r=s(11930),a=s(62602),l=s(39549),d=s(57102),c=s(15877),h=s(33754),u=s(34537),p=s(66127),g=s(27683),m=s(81760),S=s(80837),f=s(19675),y=s(24576),_=m.Color.gray300Overlay80,v=(0,c.lazyProperties)({conversationTitle:()=>i.Styles.createTextStyle({textAlign:"center",marginHorizontal:6,color:_}),conversationItem:()=>i.Styles.createViewStyle({paddingBottom:8,borderBottomWidth:2,borderStyle:"solid",borderColor:m.Color.transparent,flexDirection:"row",justifyContent:"center",alignItems:"center"}),conversationItemDesktop:()=>i.Styles.createViewStyle({paddingHorizontal:10}),conversationItemMobile:()=>i.Styles.createViewStyle({paddingHorizontal:8}),hoverBorder:()=>i.Styles.createViewStyle({borderColor:_})});class C extends y.default{constructor(){super(...arguments),this._onShowActionMenu=e=>{e.stopPropagation(),e.preventDefault(),this.props.onShowActionMenu(e,this.props.convId)},this._onPress=e=>{e.stopPropagation(),e.preventDefault(),this.props.onNavigateToConversation(this.props.convId)},this._onTabKeyPress=e=>a.default.maybeHandleKeyPress(e,(()=>{this.props.onNavigateToConversation(this.props.convId)})),this._onComponentRef=e=>{this._componentRef=e||void 0},this._onHoverStart=()=>{this.isComponentMounted()&&this.setState({isHovering:!0})},this._onHoverEnd=()=>{this.isComponentMounted()&&this.setState({isHovering:!1})}}_buildState(e,t){const s=(0,l.default)().getConversation(e.convId),i=s&&s.getOtherPartyMri()||"",o=p.default.canModernizeConversationList();return{badgeColorStyle:u.default.getBadgeColorStyle(o,this._currentTheme),otherPartyMri:i}}requestFocus(){this._componentRef&&this._componentRef.requestFocus()}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t),e.shouldUpdateOnFocus&&e.focused&&!this.props.focused&&this._componentRef&&this._componentRef.requestFocus&&this._componentRef.requestFocus()}render(){const e=[v.conversationItem,S.default.noncollapsibleView,S.default.pointerCursor],t=[v.conversationTitle];let s,a;const l=!!this.props.selected,c=d.ConversationUtils.getConversationNameForTab(this.props.convId,this.state.otherPartyMri,this.props.hasMultipleSmsTabs);let u=r.default.applyMoreOptionsAccessibilityHint(l?h.getString("ContentPanelHeader.CurrentConversationTab",{conversationType:c}):h.getString("ContentPanelHeader.SwitchToConversation",{conversationType:c}));if(this.props.badgeCount){u+=", "+h.getString("ContentPanelHeader.UnreadMessageCount",{count:this.props.badgeCount})}l?(a=this.props.tabContainerSelectedStyle,t.push(this._themeStyles.primaryTextColorStyle),e.push(i.Styles.createViewStyle({borderColor:this._themeColors.primaryTextColor},!1))):this.state.isHovering&&(s=this.props.tabContainerHoverStyle,e.push(v.hoverBorder)),this._useAccessibleTheme()&&t.push(this._themeStyles.primaryTextColorStyle),this.props.useMobileTabs?e.push(v.conversationItemMobile):e.push(v.conversationItemDesktop);const p=this.props.badgeCount&&!l?i.createElement(o.default,{count:this.props.badgeCount.toString(),rawCount:this.props.badgeCount,badgeSize:o.BadgeSize.Desktop,isHighPriority:!0,colorStyle:this.state.badgeColorStyle}):void 0,m=r.default.tabAccessibilityLabel(u,this.props.tabPosition,this.props.totalTabs,!1),y=r.default.tabAccessibilityTraits(l),_=this.props.preventAccessibilityFocus?i.Types.ImportantForAccessibility.NoHideDescendants:i.Types.ImportantForAccessibility.Yes;let C;if(n.isConversationWithPhoneNumber(this.props.convId)){const e=n.stripMriNamespace(this.state.otherPartyMri);C=g.default.parseAndFormat(e,g.PhoneNumberFormat.INTERNATIONAL)||e}return i.createElement(i.View,{ref:this._onComponentRef,style:[e,this.props.tabContainerStyle,s,a],tabIndex:this.props.focused?0:-1,onPress:this._onPress,onKeyPress:this._onTabKeyPress,onLongPress:this._onShowActionMenu,onContextMenu:this._onShowActionMenu,importantForAccessibility:_,accessibilityTraits:y,accessibilityLabel:m,onMouseEnter:this._onHoverStart,onMouseLeave:this._onHoverEnd,title:C},i.createElement(f.BodyText,{style:t,numberOfLines:1},c),p)}}t.default=C},96060:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SelectMessagesUIState=void 0;const i=s(98356),o=s(16778),n=s(1706),r=s(89391),a=s(7499),l=s(53338),d=s(94224),c=s(47447),h=s(5531),u=s(14920),p=s(14980),g=s(71908),m=s(71830),S=s(11009),f=s(47204),y=s(49748),_=s(7788),v=s(87399),C=s(75760),b=s(29241),T=s(39549),M=s(31761),I=s(43368),w=s(37490),P=s(46096),k=s(45381),A=s(11375),E=s(58481),R=s(9112),L=s(5581),F=s(66649),x=s(36237),O=s(10400),D=s(72490),B=s(15877),V=s(18460),N=s(33754),U=s(6286),H=s(3088),z=s(73319),W=s(63328),j=s(23005),G=s(53189),K=s(26378),q=s(35762),Q=s(44972),X=s(58660),$=s(45026),J=s(4735),Y=s(95691),Z=s(27357),ee=s(60621),te=s(29130),se=s(14976),ie=s(51070),oe=s(81115),ne=s(86045),re=s(70919),ae=s(10541),le=s(88361),de=s(44487),ce=s(26978),he=s(81760),ue=s(80837),pe=s(60305),ge=s(24576),me=s(63066),Se=s(67096),fe=s(53374),ye=s(73877),_e="gifPreviewDialog";var ve;!function(e){e[e.Active=0]="Active",e[e.Closing=1]="Closing",e[e.Deactive=2]="Deactive"}(ve=t.SelectMessagesUIState||(t.SelectMessagesUIState={}));const Ce=(0,B.lazyProperties)({headerWrapper:()=>o.Styles.createViewStyle({borderBottomWidth:1,borderStyle:"solid",borderColor:he.Color.transparent}),containerHorizontal:()=>o.Styles.createViewStyle({flexDirection:"row"}),contentPanel:()=>o.Styles.createViewStyle({flex:1,alignItems:"center"}),contentPanelContents:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),contentPanelLowerContents:()=>o.Styles.createViewStyle({flex:1,flexDirection:"row",alignSelf:"stretch",paddingBottom:20}),contentPanelLowerContentsNoPadding:()=>o.Styles.createViewStyle({paddingBottom:0})});class be extends ge.default{constructor(){super(...arguments),this._virtualStreamRefCount=0,this._innerMovingContainerSelectMessagesHeader=new o.Animated.Value(0),this._innerMovingContainerSelectMessagesActions=new o.Animated.Value(0),this._searchStore=new b.default,this._coachMarkContext={coachMarkArea:S.CoachMarkAreaType.Conversation},this._onMessagePanelRef=e=>{this._messagePanel=e||void 0},this._onDropDownRef=e=>{this._dropdownRef=e||void 0},this._onSelectedMessagesHeaderRef=e=>{this._selectedMessagesHeaderRef=e||void 0},this._onMessageSearchPanelRef=e=>{this._messageSearchPanel=e||void 0},this._onMessageSent=()=>{if(this.state.isSearchShowing){const e=fe.default.newCauseId();x.log(P.LogTraceArea.ContentPanel,"DesktopContentPanel._onMessageSent, causeId: "+e),J.default.closeSearchPanel(e,this._getContext(),!0)}},this._onMojiPreviewClosed=()=>{this.isComponentMounted()&&this.setState({mojiPreview:void 0})},this._onMojiPreviewOpened=e=>{this.setState({mojiPreview:e})},this._onGifPreviewClosed=()=>{this.isComponentMounted()&&(this.setState({gifPreview:void 0}),f.default.dismissModal(_e,this._getRootViewId()))},this._onGifPreviewOpened=e=>{if(this.setState({gifPreview:e}),this._shouldShowPreview()){const t=o.createElement(E.GifPreview,{key:this.props.navContext.state.conversationId,gif:e,onClose:this._onGifPreviewClosePressed,onSend:this._onGifSend,useTransparentDarkTheme:!0,showSendButton:!0,sendButtonTitle:N.getString("PesPicker.GifPreviewSendButtonAccessibility")});f.default.dismissModal(_e,this._getRootViewId()),f.default.showModal(t,_e,{rootViewId:this._getRootViewId()})}},this._onMojiPreviewClosePressed=()=>{ee.MojiPreviewService.closePesPreview()},this._onMojiSend=()=>{this.state.mojiPreview&&ee.MojiPreviewService.sendPes(this.state.mojiPreview),ee.MojiPreviewService.closePesPreview()},this._onGifPreviewClosePressed=()=>{ee.GifPreviewService.closePesPreview()},this._onGifSend=()=>{this.state.gifPreview&&ee.GifPreviewService.sendPes(this.state.gifPreview),ee.GifPreviewService.closePesPreview()},this._handleLaunchCamera=()=>{if(!c.UICapabilities.cameraSupported())return;w.dismissAll();const e=this.props.navContext;p.navigateToCaptureComboModalWithParams({capturedContentHandler:new u.CapturedContentHandlerForPosting(e.state.conversationId),conversationId:e.state.conversationId,allowVideo:!0,mediaPickerShouldCollapseFully:!0,showCoachmarksIfNeeded:!0,allowOfficeLens:!0},this._getContext())},this._onToggleFindPanelWithOverflowConfig=e=>{const t=fe.default.newCauseId();if(x.log(P.LogTraceArea.ContentPanel,"DesktopContentPanel._onToggleFindPanelWithOverflowConfig, causeId: "+t),this.state.isFindPanelShowing)x.track(new z.MessageOverflowEvent(z.MessageOverflowAction.MessageOverflowCloseButtonClicked)),J.default.closeFindPanel(t,this._getContext());else{const s=this.props.navContext.state.conversationId;s&&(x.track(new z.MessageOverflowEvent(z.MessageOverflowAction.MessageOverflowOpenButtonClicked)),J.default.navigateToFindPanel(s,e,this._getContext(),t,this.state.useTabletUI?this._onCloseFindPanel:void 0),ne.default.maybeAnnounceForAccessibility(N.getString("FindPanel.FindPanelOpenedAccessibilityLabel")))}return!0},this._onCloseFindPanel=()=>{const e=fe.default.newCauseId();x.log(P.LogTraceArea.ContentPanel,"DesktopContentPanel._onCloseFindPanel, causeId: "+e),J.default.closeFindPanel(e,this._getContext())},this._onToggleFindPanel=e=>{this._onToggleFindPanelWithOverflowConfig(e),I.default.close(this._getRootViewId())},this._onCallStartedAnsweredOrJoinedViaHeader=()=>{this.blurStream()},this._onOpenDropdown=()=>{this._dropdownRef&&this._dropdownRef.showOrHide()},this._onShowGestureHint=e=>{this.isComponentMounted()&&this.setState({toolTipInfo:e})},this._onDismissPopup=()=>{this.isComponentMounted()&&this.state.toolTipInfo&&this.setState({toolTipInfo:void 0})},this._onEscape=()=>(this._selectedMessagesHeaderRef&&this._selectedMessagesHeaderRef.cancelMultipleMessages(),!0),this._onCloseSelectMessagesPanel=(e,t)=>{if(!this.isComponentMounted())return;this.setState({currentSelectMessagesUIState:ve.Closing});const s=[$.default.timing(this._innerMovingContainerSelectMessagesHeader,{toValue:e,duration:i.Common.Duration.Default,easing:i.Easing.SkypeExpoIn5,useNativeDriver:!0}),$.default.timing(this._innerMovingContainerSelectMessagesActions,{toValue:t,duration:i.Common.Duration.Default,easing:i.Easing.SkypeExpoIn5,useNativeDriver:!0})];o.Animated.parallel(s).start((e=>{e.finished&&this.isComponentMounted()&&this.setState({currentSelectMessagesUIState:ve.Deactive})}))},this._trackSearchClosed=e=>{this._messageSearchPanel&&(x.track(new q.ClosedSearch(e,this._messageSearchPanel.didUserSearch(),this._messageSearchPanel.getLastSearchResultsCount(),this._messageSearchPanel.getNumberOfRequests())),this._messageSearchPanel.resetTelemetryParams())},this._startVideoCall=(e,t)=>{if(t!==this._getRootViewId()||this.state.isBookmarksThread)return!1;const s=this.props.navContext.state.conversationId;if(s&&d.default.CallNavigationHelper.isOutgoingCallingAllowed(s)){const e=fe.default.newCauseId();x.log(P.LogTraceArea.Calling,"DesktopContentPanel._startVideoCall KeyboardShortcut"+e),d.default.CallNavigationHelper.startCall({conversationMri:s,withVideo:!0,origin:P.NavigationCallOrigin.DesktopContentPanel},e).then((()=>{ne.default.maybeAnnounceForAccessibility(N.getString("CallOrInviteMenu.StartVideoCallKeyboardShortcutAccessibilityLabel"))}))}return!0},this._startAudioCall=(e,t)=>{if(t!==this._getRootViewId()||this.state.isBookmarksThread)return!1;const s=this.props.navContext.state.conversationId;if(s&&d.default.CallNavigationHelper.isOutgoingCallingAllowed(s)){const e=fe.default.newCauseId();x.log(P.LogTraceArea.Calling,"DesktopContentPanel._startAudioCall KeyboardShortcut"+e),d.default.CallNavigationHelper.startCall({conversationMri:s,withVideo:!1,origin:P.NavigationCallOrigin.DesktopContentPanel},e).then((()=>{ne.default.maybeAnnounceForAccessibility(N.getString("CallOrInviteMenu.StartAudioCallKeyboardShortcutAccessibilityLabel"))}))}return!0},this._showConversationProfile=(e,t)=>{if(t!==this._getRootViewId()||this.state.isBookmarksThread)return!1;const s=fe.default.newCauseId();x.log(P.LogTraceArea.ContentPanel,"DesktopContentPanel._showConversationProfile, causeId: "+s);const i=this.props.navContext.state.conversationId;return J.default.closeGenericDesktopModal(s,this._getRootViewId()),i&&J.default.showDetailsPanelWithParams({mri:i,showConversationSettings:!0,rootViewId:this._getRootViewId(),causeId:s}),!0},this._addPeopleToConversation=(e,t)=>{if(t!==this._getRootViewId()||this.state.isBookmarksThread||this.state.isS4BConversation)return!1;const s=fe.default.newCauseId();x.log(P.LogTraceArea.ContentPanel,"DesktopContentPanel._addPeopleToConversation, causeId: "+s);const i=this.props.navContext.state.conversationId;if(J.default.closeGenericDesktopModal(s,this._getRootViewId()),m.isGroupConversation(i)){new M.default({convId:m.asSkypeThreadIdMaybe(i),navigationOrigin:P.NavigationConversationOrigin.KeyboardShortcutAddPeopleToGroup,peopleType:ae.PeopleType.AllExcludingBots,filterPeopleType:ae.FilterType.GroupCapable,wizardSteps:[Y.WizardSteps.setConvParticipants]}).start(this._getRootViewId())}else{new M.default({peopleType:ae.PeopleType.AllExcludingBots,filterPeopleType:ae.FilterType.GroupCapable,navigationOrigin:P.NavigationConversationOrigin.KeyboardShortcutNewGroupWithUser,invitedUsersMris:[i],wizardSteps:[Y.WizardSteps.setConvParticipants]}).start(this._getRootViewId())}return!0},this._markAsUnread=(e,t)=>{if(t!==this._getRootViewId()||this.state.isBookmarksThread)return!1;const s=this.props.navContext.state.conversationId;return s&&this.state.unreadCount<1&&g.markMessageUnread(s),o.Accessibility.announceForAccessibility(N.getString("ConversationsListItem.MarkUnreadAnnouncement")),!0},this._enableMultipleMessagesMode=(e,t)=>t===this._getRootViewId()&&!this.state.isBookmarksThread&&(de.default.activateSelectMessagesMode(t),!0),this._onGalleryPress=e=>{e&&(e.stopPropagation(),e.preventDefault());const t=Z.default.isGalleryShowing(this._getRootViewId());J.default.toggleGallery(this.props.navContext.state.conversationId,this._getContext()),t?ne.default.maybeAnnounceForAccessibility(N.getString("AccessibilityLabel.GalleryClosed")):ne.default.maybeAnnounceForAccessibility(N.getString("AccessibilityLabel.GalleryOpened"))},this._onToggleMessageSearchPanel=e=>!!this.state.isMessageSearchPanelEnabled&&(this.state.isMessageSearchPanelVisible?(this._searchStore.cancelSearch(),this._trackSearchClosed(e),this._messageSearchPanelOpenOrigin===re.MessageSearchToggleOrigin.HeaderIcon&&o.UserInterface.isNavigatingWithKeyboard()?A.setFocus(A.FocusEvent.MessageSearchClosed):this._focusMessageComposer(),this._messageSearchPanelOpenOrigin=void 0):(this.blurStream(),this._searchStore.resetSearch(),this._messageSearchPanelOpenOrigin=e,x.track(new q.OpenedSearch(e))),!0),this._onToggleSearchByShortcut=(e,t)=>!(!this.state.isMessageSearchPanelEnabled||t!==this._getRootViewId()||this.state.isBookmarksThread||this.state.isS4BConversation)&&(this._onToggleMessageSearchPanel(re.MessageSearchToggleOrigin.KeyboardShortcut),!0),this._onToggleSearchByHeaderIcon=()=>{this._onToggleMessageSearchPanel(re.MessageSearchToggleOrigin.HeaderIcon)},this._archiveConversation=(e,t)=>{if(t!==this._getRootViewId()||this.state.isBookmarksThread)return!1;const s=this.props.navContext.state.conversationId,i=(0,T.default)().getConversation(s),o=this._getContext();return!i||i.isArchived()||d.default.ActiveCallUIHelper.hasActiveCall(s)||a.default.showIfRequired(this._getRootViewId()).then((()=>{const e=fe.default.newCauseId();x.log(P.LogTraceArea.ContentPanel,"[DesktopContentPanel] - _archiveConversation causeId: "+e),l.default.archiveConversation(s,P.ArchiveConversationOrigin.KeyboardShortcut,this._getRootViewId()),J.default.navigateAfterArchivingConversation(s,e,o)})),!0},this._focusMessageComposer=()=>{this._messagePanel&&this._messagePanel.focusTextInputForAccessibility()}}_buildState(e,t){let s={bottomSafeAreaInset:ie.default.bottomSafeAreaInset(4),isKeyboardShown:O.default.isKeyboardSeen()};const i=this.props,o=this._getRootViewId(),a=e.navContext.state.conversationId,l=(0,T.default)().getConversation(a);s.otherPartyMri=l&&l.isOneOnOne()?l.getOtherPartyMri():void 0;const c=v.isConversationBlocked(a);return s.responsiveWidth=te.default.getResponsiveWidth(o),s.isFileUploadCapable=!F.default.isUsingGogoNetwork()&&a&&(!m.isAgent(a)||n.default.hasCapability(a,"file.send"))&&!c&&!(l&&l.isLogicalOneOnOneSmsConversation())&&!m.isS4BBridgeMri(a)&&!e.navContext.state.selectedNumberForSMS,s.hasConnectedCalls=d.default.CallingStore.hasConnectedCalls(),s.isConversationBlocked=c,s.localAddressBookContact=a&&m.isOneOnOneConversation(a)?V.default.getContactByCorrespondingMri(a):void 0,s.activeCallId=d.default.ActiveCallUIHelper.getActiveCallId(a),s.hasActiveCall=d.default.ActiveCallUIHelper.hasActiveCall(a),s.activeCallStatus=d.default.ActiveCallUIHelper.activeCallStatus(a),s.unreadCount=a?C.default.getMessageCountsForConversation(a).unreadCount:0,s.useTabletUI=pe.default.useTabletUI(),s.useDropdown=!!s.otherPartyMri&&s.useTabletUI&&r.default.getS4LUiFeatures().tabletConversationDetailsEnabled,s.isSearchShowing=Z.default.isSearchShowing(o),s.isFindPanelShowing=Z.default.isFindPanelShowing(o),s.isSelectMessagesModeActive=de.default.isSelectMessagesModeActive(o),s.isSelectMessagesModeActive?s.currentSelectMessagesUIState=ve.Active:!t&&K.shouldCancelMessageSelection(i.navContext.state.conversationId,e.navContext.state.conversationId)?s.currentSelectMessagesUIState=ve.Deactive:s.currentSelectMessagesUIState=this.state?this.state.currentSelectMessagesUIState:ve.Deactive,s.canSeeGuestUpsell=h.default.identity().canSeeGuestUpsell,s.isTranslatedConversation=L.default.isConversationTranslated(a),s.isMessageSearchPanelEnabled=m.isSearchInConversationSupported(a)&&!s.isTranslatedConversation,s.isUnifiedScrollToTimestampEnabled=r.default.getS4LMessagingFeatures().enableUnifiedScrollToTimestamp,s.isMessageSearchPanelVisible=s.isMessageSearchPanelEnabled&&!!this._searchStore.getSearchQuery(),s.isBookmarksThread=m.isBookmarkConversation(a),s.isS4BConversation=m.isS4BBridgeMri(a),s}blurStream(){this._messagePanel&&this._messagePanel.blur()}_componentId(){return"DesktopContentPanel"}componentDidMount(){super.componentDidMount();const e=fe.default.newCauseId();x.log(P.LogTraceArea.ContentPanel,"[DesktopContentPanel] - componentDidMount causeId: "+e),this._newConversationSetup(this.props.navContext,e),this._mojiPreviewOpenSubscriptionToken=ee.MojiPreviewService.onPesPreviewOpened(this._onMojiPreviewOpened),this._mojiPreviewCloseSubscriptionToken=ee.MojiPreviewService.onPesPreviewClosed(this._onMojiPreviewClosed),this._gifPreviewOpenSubscriptionToken=ee.GifPreviewService.onPesPreviewOpened(this._onGifPreviewOpened),this._gifPreviewCloseSubscriptionToken=ee.GifPreviewService.onPesPreviewClosed(this._onGifPreviewClosed),this._registerKeyboardHandlers();const{scrollToTimestamp:t}=this.props.navContext.state;if(t&&this.state.isUnifiedScrollToTimestampEnabled){const e=`[DesktopContentPanel] - componentDidMount, searchStore.setTimestamp: ${t}`;x.log(P.LogTraceArea.ContentPanel,e),this._searchStore.setTimestamp(t)}}UNSAFE_componentWillReceiveProps(e,t){const s=this.props.navContext,i=e.navContext,o=i.state.conversationId,n=o!==s.state.conversationId,r=fe.default.newCauseId();x.log(P.LogTraceArea.ContentPanel,"[DesktopContentPanel] - UNSAFE_componentWillReceiveProps causeId: "+r,"Conversation id differs = "+n),n?(this.props.enableConversationSwitchWithoutRemount?this._oldConversationCleanup():this._virtualStreamRefCount++,this._searchStore.cancelSearch(),this._newConversationSetup(i,r)):U.default.isMediaPreviewEnabled(o)&&!this.props.navContext.state.selectedNumberForSMS&&e.navContext.state.selectedNumberForSMS&&H.default.destroy(o);const a=i.state.scrollToTimestamp;if(a&&this.state.isUnifiedScrollToTimestampEnabled){const e=`DesktopContentPanel, searchStore.setTimestamp: ${a}, causeId: ${r}`;x.log(P.LogTraceArea.ContentPanel,e),this._searchStore.setTimestamp(a,void 0,i.state.causeId)}super.UNSAFE_componentWillReceiveProps(e,t)}componentWillUnmount(){super.componentWillUnmount(),this._mojiPreviewOpenSubscriptionToken&&this._mojiPreviewOpenSubscriptionToken.unsubscribe(),this._mojiPreviewCloseSubscriptionToken&&this._mojiPreviewCloseSubscriptionToken.unsubscribe(),this._gifPreviewOpenSubscriptionToken&&this._gifPreviewOpenSubscriptionToken.unsubscribe(),this._gifPreviewCloseSubscriptionToken&&this._gifPreviewCloseSubscriptionToken.unsubscribe(),this._unregisterKeyboardHandlers(),D.default.removeEscapeHandler(this._onEscape),this._oldConversationCleanup(!0)}_newConversationSetup(e,t){const s=e.state.conversationId;s&&(x.log(P.LogTraceArea.ContentPanel,"[DesktopContentPanel] - maybePreheatCall for conversation, id: "+se.mriOrId(s)+" causeId: "+t),d.default.CallPreheatHelper.maybePreheatCall(s,t)),e.state.origin===P.NavigationConversationOrigin.GoLiveNotification&&A.setFocus(A.FocusEvent.OpenGoLiveNotification)}_oldConversationCleanup(e=!1){const t=this.props.navContext,s=[me.Scenarios.SearchToConversation,me.Scenarios.RecommendationFromRecentsToConversation,me.Scenarios.RecommendationFromContactsToConversation];Se.default.interruptScenarios(t.state.conversationId,s),de.default.isSelectMessagesModeActive(this._getRootViewId())&&de.default.deactivateSelectMessagesMode(),this.state.isMessageSearchPanelVisible&&this._trackSearchClosed(re.MessageSearchToggleOrigin.NavigationOut)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),t.isSelectMessagesModeActive!==this.state.isSelectMessagesModeActive&&(this.state.isSelectMessagesModeActive?D.default.addEscapeHandler(this._onEscape):D.default.removeEscapeHandler(this._onEscape))}render(){const e=ce.default.getWidthNoSubscription(),t=this.props.navContext,s=this.state.mojiPreview&&this._shouldShowPreview()?o.createElement(X.MojiPreview,{key:t.state.conversationId,moji:this.state.mojiPreview,onClose:this._onMojiPreviewClosePressed,onSend:this._onMojiSend}):void 0,i=this.state.toolTipInfo?o.createElement(k.default,{toolTipInfo:this.state.toolTipInfo,onDismiss:this._onDismissPopup,containerOffsetX:e}):void 0,n=this.state.useDropdown?o.createElement(_.default,{key:t.state.conversationId,ref:this._onDropDownRef,conversationId:t.state.conversationId,otherPartyMri:this.state.otherPartyMri}):void 0,r=[Ce.containerHorizontal,this._themeStyles.primaryBackgroundColorStyle];this.props.enableConversationSwitchWithoutRemount?r.push(ue.default.flexOne):r.push(ue.default.absoluteFill);const a=ye.WindowDimensionUtils.measureWindow(this._getRootViewId()).width-e;let l,d;this.state.currentSelectMessagesUIState!==ve.Deactive&&(l=o.createElement(le.default,{ref:this._onSelectedMessagesHeaderRef,renderHeader:!0,conversationId:t.state.conversationId,mobileUi:this.state.useTabletUI,panelAnimatedValue:this._innerMovingContainerSelectMessagesHeader,onClosePanel:this._onCloseSelectMessagesPanel}),d=o.createElement(le.default,{renderActions:!0,conversationId:t.state.conversationId,panelAnimatedValue:this._innerMovingContainerSelectMessagesActions,onClosePanel:this._onCloseSelectMessagesPanel}));const c=this.state.canSeeGuestUpsell?o.createElement(R.default,null):void 0,h=this.state.isSelectMessagesModeActive||this.state.isMessageSearchPanelVisible&&this.state.useTabletUI,u=o.createElement(y.ContentPanelHeader,{conversationId:t.state.conversationId,otherPartyMri:this.state.otherPartyMri,activeCallId:this.state.activeCallId,hasActiveCall:this.state.hasActiveCall,activeCallStatus:this.state.activeCallStatus,localAddressBookPhones:this.state.localAddressBookContact?this.state.localAddressBookContact.phones:void 0,onCallStartedAnsweredOrJoined:this._onCallStartedAnsweredOrJoinedViaHeader,onOpenDropdown:this.state.useDropdown?this._onOpenDropdown:void 0,preventAccessibilityFocus:h,hideConversationSwitcher:this.state.isSelectMessagesModeActive,onToggleMessageSearchPanel:this._onToggleSearchByHeaderIcon,isMessageSearchPanelVisible:this.state.isMessageSearchPanelVisible,isMessageSearchPanelEnabled:this.state.isMessageSearchPanelEnabled,onGalleryPressed:this._onGalleryPress}),p=o.createElement(j.MessageSearchPanelAnimatedWrapper,{conversationId:t.state.conversationId,onCancel:this._onToggleMessageSearchPanel,ref:this._onMessageSearchPanelRef,isMessageSearchPanelVisible:this.state.isMessageSearchPanelVisible,useMobileUI:this.state.useTabletUI,searchStore:this._searchStore}),g=this.state.useTabletUI?o.createElement(G.MobileSearchNavigationPanel,{useMobileUI:!0,searchStore:this._searchStore}):void 0,m=[Ce.contentPanelLowerContents,this._themeStyles.messageStreamBackgroundColorStyle,this.state.isBookmarksThread?Ce.contentPanelLowerContentsNoPadding:void 0];this.state.bottomSafeAreaInset&&!this.state.isKeyboardShown&&m.push(oe.default.paddingBottomStyle(this.state.bottomSafeAreaInset));const f=this.state.isUnifiedScrollToTimestampEnabled?void 0:t.state.scrollToTimestamp;return o.createElement(o.View,{style:r},o.createElement(S.CoachMarkContext.Provider,{value:this._coachMarkContext},o.createElement(o.View,{style:ue.default.flexOne},o.createElement(o.View,{style:[Ce.headerWrapper,this._themeStyles.headerShadowBorderColorStyle]},u,p),l,c,o.createElement(o.View,{style:Ce.contentPanel},o.createElement(o.View,{style:Ce.contentPanelContents},o.createElement(o.View,{style:m},o.createElement(W.default,{key:this.props.enableConversationSwitchWithoutRemount?void 0:this._virtualStreamRefCount,ref:this._onMessagePanelRef,enableConversationSwitchWithoutRemount:this.props.enableConversationSwitchWithoutRemount,conversationId:t.state.conversationId,otherPartyMri:this.state.otherPartyMri,scrollToTimestamp:f,focusedMessageCuid:t.state.focusedMessageCuid,forceRefreshFocus:t.state.forceRefreshFocus,allowUploads:this.state.isFileUploadCapable,isNewConversation:t.state.isNewConversation,isFindPanelHidden:!this.state.isFindPanelShowing,availableWidth:a,hasConnectedCalls:this.state.hasConnectedCalls,selectedNumberForSMS:t.state.selectedNumberForSMS,inviteToken:t.state.inviteToken,showBottomDivider:this.state.useTabletUI,onLaunchCamera:this._handleLaunchCamera,onToggleFindPanel:this._onToggleFindPanel,onHandleOverflow:this._onToggleFindPanelWithOverflowConfig,onInitialRenderComplete:this.props.onInitialRenderComplete,isInvisible:this.props.isInvisible,onMessageSent:this._onMessageSent,onShowGestureHint:this._onShowGestureHint,isSelectMessagesModeActive:this.state.isSelectMessagesModeActive,isFromSearch:this.state.isSearchShowing,isFromPeopleRecommendations:t.state.isFromPeopleRecommendations,isMessageSearchPanelVisible:this.state.isMessageSearchPanelVisible,focusJoinCallButton:this.props.navContext.state.origin===P.NavigationConversationOrigin.GoLiveNotification,directShareEventData:this.props.navContext.state.directShareEventData,isTranslatedConversation:this.state.isTranslatedConversation,searchStore:this._searchStore}))),n),d,g),s,i))}_shouldShowPreview(){return!1}_registerKeyboardHandlers(){const e=this.props.navContext.state.conversationId,t=(0,T.default)().getConversation(e);(0,Q.isRegularMemberInModeratedGroup)(t)||(D.default.addHandler(P.KeyboardShortcut.StartVideoCall,this._startVideoCall),D.default.addHandler(P.KeyboardShortcut.StartAudioCall,this._startAudioCall),D.default.addHandler(P.KeyboardShortcut.AddPeopleToConversation,this._addPeopleToConversation)),D.default.addHandler(P.KeyboardShortcut.ShowConversationProfile,this._showConversationProfile),D.default.addHandler(P.KeyboardShortcut.MarkAsUnread,this._markAsUnread),D.default.addHandler(P.KeyboardShortcut.EnableMultipleSelectMessages,this._enableMultipleMessagesMode),D.default.addHandler(P.KeyboardShortcut.ArchiveConversation,this._archiveConversation),D.default.addHandler(P.KeyboardShortcut.SearchInConversation,this._onToggleSearchByShortcut)}_unregisterKeyboardHandlers(){const e=this.props.navContext.state.conversationId,t=(0,T.default)().getConversation(e);(0,Q.isRegularMemberInModeratedGroup)(t)||(D.default.removeHandler(P.KeyboardShortcut.StartVideoCall,this._startVideoCall),D.default.removeHandler(P.KeyboardShortcut.StartAudioCall,this._startAudioCall),D.default.removeHandler(P.KeyboardShortcut.AddPeopleToConversation,this._addPeopleToConversation)),D.default.removeHandler(P.KeyboardShortcut.ShowConversationProfile,this._showConversationProfile),D.default.removeHandler(P.KeyboardShortcut.MarkAsUnread,this._markAsUnread),D.default.removeHandler(P.KeyboardShortcut.EnableMultipleSelectMessages,this._enableMultipleMessagesMode),D.default.removeHandler(P.KeyboardShortcut.ArchiveConversation,this._archiveConversation),D.default.removeHandler(P.KeyboardShortcut.SearchInConversation,this._onToggleSearchByShortcut)}}t.default=be},91707:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(60),r=s(89391),a=s(96074),l=s(96060),d=s(36237),c=s(15877),h=s(20022),u=s(3088),p=s(26594),g=s(44487),m=s(80837),S=s(12770),f=s(81571),y=(0,c.lazyProperties)({container:()=>m.default.flexOne});class _ extends a.default{constructor(){super(...arguments),this._refCounter=0,this._onAppExitCallback=()=>u.default.markSavedAsDraft(this.props.navContext.state.conversationId),this._onInitialRenderComplete=()=>{this._forceTimer&&(S.default.clearTimeout(this._forceTimer),this._forceTimer=void 0),this.setState({viewRendered:!0});const e=this._refCounter;i.delay((()=>{this.isComponentMounted()&&this.state.oldProps&&e===this._refCounter&&this.setState({oldProps:void 0})}),100)}}_buildState(e,t){const s={},i=this.props,o=e.navContext.state,n=i.navContext.state;return o.conversationId===n.conversationId&&o.scrollToTimestamp===n.scrollToTimestamp&&o.focusedMessageCuid===n.focusedMessageCuid&&o.forceRefreshFocus===n.forceRefreshFocus||(this._refCounter++,s.oldProps=i,s.viewRendered=!1),s.enableConversationSwitchWithoutRemount=r.default.getS4LMessagingFeatures().enableConversationSwitchWithoutRemount,s}componentDidMount(){super.componentDidMount(),r.default.getS4LMessagingFeaturesNoSubscription().enableMediaPreviewDraftsPersistentStorage&&(h.default.addObserver(h.LifecycleEventType.ON_EXIT,this._onAppExitCallback),this._appStateSubscription=n.default.subscribeForChanges("DesktopContentPanelManager",(e=>{i.includes([o.Types.AppActivationState.Inactive,o.Types.AppActivationState.Background],e)&&u.default.markSavedAsDraft(this.props.navContext.state.conversationId).then((()=>{const e=u.default.getConversationsWithMediaDraft().length;e>0&&d.track(new p.MediaPreviewAppExitWithDraftsEvent(e))})).catch(i.noop)})))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);this.props.navContext.id!==e.navContext.id&&(f.default.clear(e.navContext.state.conversationId),r.default.getS4LMessagingFeaturesNoSubscription().enableMediaPreviewDrafts?u.default.markSavedAsDraft(e.navContext.state.conversationId):u.default.destroy(e.navContext.state.conversationId,!0),g.default.isSelectMessagesModeActive(this._getRootViewId())&&g.default.deactivateSelectMessagesMode())}componentWillUnmount(){super.componentWillUnmount(),this._appStateSubscription&&(this._appStateSubscription.unsubscribe(),this._appStateSubscription=void 0),h.default.removeObserver(h.LifecycleEventType.ON_EXIT,this._onAppExitCallback),f.default.clear(this.props.navContext.state.conversationId),r.default.getS4LMessagingFeaturesNoSubscription().enableMediaPreviewDrafts?u.default.markSavedAsDraft(this.props.navContext.state.conversationId):u.default.destroy(this.props.navContext.state.conversationId,!0)}_renderContentPanelSwitch(){let e=null;this.state.oldProps&&(e=o.createElement(l.default,{key:this._refCounter-1,navContext:this.state.oldProps.navContext,isInvisible:!0}),this._setForceShowPanelTimer());const t=o.createElement(l.default,{key:this._refCounter,navContext:this.props.navContext,onInitialRenderComplete:this.state.oldProps?this._onInitialRenderComplete:void 0}),s=this.state.viewRendered?t:e;return[this.state.viewRendered?e:t,s]}render(){return this.state.enableConversationSwitchWithoutRemount?o.createElement(l.default,{navContext:this.props.navContext,enableConversationSwitchWithoutRemount:this.state.enableConversationSwitchWithoutRemount}):o.createElement(o.View,{style:y.container},this._renderContentPanelSwitch())}_setForceShowPanelTimer(){const e=this._refCounter;this._forceTimer=S.default.setTimeout((()=>{this.isComponentMounted()&&this.state.oldProps&&e===this._refCounter&&this.setState({oldProps:void 0})}),r.default.getS4LMessagingFeaturesNoSubscription().oldContentPanelForceHideTimeout)}}t.default=_},46239:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GalleryButton=void 0;const i=s(16778),o=s(36400),n=s(10117),r=s(15877),a=s(33754),l=s(11828),d=s(24576),c=(0,r.lazyProperties)({icon:()=>i.Styles.createViewStyle({minWidth:l.IconSize.size16,marginRight:3}),galleryButton:()=>i.Styles.createViewStyle({flexShrink:0,flexDirection:"row",paddingLeft:4,paddingRight:4,alignItems:"center"})});class h extends d.default{constructor(){super(...arguments),this._onRef=e=>{this._button=e||void 0}}requestFocus(){this._button&&this._button.requestFocus()}render(){var e;const t=this.props.preventAccessibilityFocus?i.Types.ImportantForAccessibility.NoHideDescendants:void 0,s=this.props.preventAccessibilityFocus?-1:void 0,r=a.getString("ContentPanelHeaderTitle.GalleryButtonTitle"),d=this.props.iconColorOverride?this.props.iconColorOverride:this._themeColors.secondaryTextColor;return i.createElement(o.HoverableButton,{ref:this._onRef,style:[c.galleryButton,this.props.style],title:r,accessibilityLabel:this.props.accessibilityLabel?this.props.accessibilityLabel:r,onPress:this.props.onPress,importantForAccessibility:t,tabIndex:s,disabled:this.props.disabled},i.createElement(n.default,{icon:l.SkypeIcon.Gallery1,style:c.icon,color:d,size:null!==(e=this.props.iconSize)&&void 0!==e?e:l.IconSize.size12}),this.props.hideIconText?void 0:this._getIconText())}_getIconText(){return i.createElement(i.Text,{style:this.props.textStyle,numberOfLines:1},a.getString("ContentPanelHeaderTitle.Gallery"))}}t.GalleryButton=h,t.default=h},53703:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(13944),n=s(15877),r=s(33754),a=s(11828),l=s(24576),d=(0,n.lazyProperties)({manageGroupButton:()=>i.Styles.createViewStyle({flexShrink:0,flexDirection:"row",paddingLeft:4,paddingRight:8,alignItems:"center",minWidth:a.IconSize.size16,marginRight:3})});class c extends l.default{requestFocus(){this._button&&this._button.requestFocus()}render(){var e,t;const s=this.props.preventAccessibilityFocus?i.Types.ImportantForAccessibility.NoHideDescendants:void 0,n=this.props.preventAccessibilityFocus?-1:void 0,l=r.getString("ConversationsListItem.ChatGroupManageLabel"),c=this.props.iconColorOverride?this.props.iconColorOverride:this._themeColors.secondaryTextColor,h=null!==(e=this.props.hoverColor)&&void 0!==e?e:this._themeColors.iconHoverColor,u=this.props.isCompact?a.IconSize.size12:null!==(t=this.props.iconSize)&&void 0!==t?t:a.IconSize.size18;return i.createElement(o.default,{style:[d.manageGroupButton,this.props.style],title:l,accessibilityLabel:this.props.accessibilityLabel?this.props.accessibilityLabel:l,onPress:this.props.onPress,importantForAccessibility:s,tabIndex:n,disabled:this.props.disabled,icon:a.SkypeIcon.Settings,color:c,size:u,hoverColor:h})}}t.default=c},23005:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageSearchPanelAnimatedWrapper=t.MessageSearchPanel=void 0;const i=s(96486),o=s(98356),n=s(16778),r=s(89391),a=s(53026),l=s(15877),d=s(33754),c=s(53189),h=s(98469),u=s(4735),p=s(51070),g=s(70919),m=s(24576),S=s(30124),f=s(10996),y=s(69399),_=s(53374),v=s(17791),C=s(59405);class b extends m.default{constructor(){super(...arguments),this._didSearch=!1,this._lastSearchResultsCount=0,this._numberOfRequests=0,this.didUserSearch=()=>this._didSearch,this.getLastSearchResultsCount=()=>this._lastSearchResultsCount,this.getNumberOfRequests=()=>this._numberOfRequests,this.resetTelemetryParams=()=>{this._didSearch=!1,this._lastSearchResultsCount=0,this._numberOfRequests=0},this._onViewRef=e=>{this._viewRef=e||void 0},this._onCancelButtonPress=()=>{this._onCancel(g.MessageSearchToggleOrigin.CancelButton)},this._onCancel=e=>{this._performSearchDebounced.cancel(),this.props.onCancel(e)},this._clearSearch=()=>{this._performSearchDebounced.cancel(),this.props.searchStore.resetSearch(),this.setState({searchQuery:""},(()=>this.requestFocus()))},this._onQueryTextChange=e=>{this.props.searchStore.getSearchQuery()&&(this.setState({searchQuery:e}),this._performSearchDebounced(e,this.props.conversationId))},this._performSearch=(e,t,s,i,o)=>{this._zeroTermSearch=0===e.length,this._scenarioID=i||_.default.newCauseId();const n=this._scenarioID;(0,f.willSearch)(y.ScenarioSearchTypes.MessageInConversation,n);const r=null!=o?o:this.state.messageSearchLimit;(0,f.searchCallSent)(y.ScenarioSearchTypes.MessageInConversation,n,this._zeroTermSearch,r),this.props.searchStore.findQuery({query:e},t,n).then((e=>{(0,f.searchResultsReceived)(y.ScenarioSearchTypes.MessageInConversation,n,this._zeroTermSearch,r),s&&this.props.searchStore.focusMessage(s),this._announceResultsFound(e)})).catch((e=>{const t=v.default.isNetworkingAvailable();(0,f.searchResultsNotReceived)(y.ScenarioSearchTypes.MessageInConversation,n,this._zeroTermSearch,-1,"",t,r)})),this._numberOfRequests++,this._didSearch=!0},this._performSearchDebounced=i.debounce(this._performSearch,300),this._onScrollToMessageFromSearch=i.debounce((()=>{const{results:e,currentMessageIndex:t}=this.state,{conversationId:s}=this.props;e.length&&e[t]&&(0,C.getMessageTimestamp)(e[t],s).then((e=>{s===this.props.conversationId&&(this.state.isUnifiedScrollToTimestampEnabled?this.props.searchStore.setTimestamp(null==e?void 0:e.timestamp,null==e?void 0:e.cuid,this._scenarioID,this._zeroTermSearch):u.default.navigateToMessageFromSearchMessagePanel(null==e?void 0:e.timestamp,s,this._getRootViewId()))}))}),300),this._announceResultsFound=i.debounce((e=>{const t=d.getString("ContentPanelHeader.SearchInConversationResultsFoundAnnouncement",{count:e});n.Accessibility.announceForAccessibility(t)}),300)}_buildState(e,t){let s={};const i=r.default.getS4LMessagingFeatures();s.isUnifiedScrollToTimestampEnabled=i.enableUnifiedScrollToTimestamp,s.currentMessageIndex=e.searchStore.getFocusedMessageIndex(),s.results=e.searchStore.getResults(),s.isLoading=e.searchStore.isLoadingResults(),s.messageSearchLimit=i.inConversationMessageSearch.initialPageSize;const o=a.default.getSearchQuery();return o&&e.conversationId===o.conversationId?(this._performSearch(o.query,o.conversationId,o.messageId,o.sessionId,s.messageSearchLimit),s.searchQuery=o.query,a.default.resetSearchQuery()):t&&(s.searchQuery=""),s}componentDidUpdate(e,t,s){var i,o,n,r;super.componentDidUpdate(e,t,s);(null===(o=null===(i=t.results)||void 0===i?void 0:i[t.currentMessageIndex])||void 0===o?void 0:o.ClientMessageId)!==(null===(r=null===(n=this.state.results)||void 0===n?void 0:n[this.state.currentMessageIndex])||void 0===r?void 0:r.ClientMessageId)&&this._onScrollToMessageFromSearch(),!1===this.props.isMessageSearchPanelVisible&&!0===e.isMessageSearchPanelVisible&&this.setState({searchQuery:""})}requestFocus(){this._viewRef&&this._viewRef.requestFocus()}render(){const e=this.props.useMobileUI&&!S.default.isMobileSplitView()?void 0:n.createElement(c.MessageSearchPanelNavigation,{useMobileUI:this.props.useMobileUI,searchStore:this.props.searchStore});return n.createElement(h.default,{onCancel:this._onCancel,onChangeText:this._onQueryTextChange,onClearPress:this._clearSearch,ref:this._onViewRef,clearSearch:this._clearSearch,onCancelButtonPress:this._onCancelButtonPress,isLoading:this.state.isLoading,searchQuery:this.state.searchQuery,navigationComponent:e,disableUi:!this.props.isMessageSearchPanelVisible,searchStore:this.props.searchStore})}}t.MessageSearchPanel=b;const T=(0,l.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",position:"absolute",left:0,right:0,height:70})});class M extends m.default{constructor(e){super(e),this._animatedHeightValue=new n.Animated.Value(0),this._animatedOpacityValue=new n.Animated.Value(0),this._animatedPositionValueStackNav=new n.Animated.Value(-70),this._animatedMenuStyleStackNav=n.Styles.createAnimatedViewStyle({top:this._animatedPositionValueStackNav}),this._animatedMenuStyle=n.Styles.createAnimatedViewStyle({height:this._animatedHeightValue,opacity:this._animatedOpacityValue}),this.didUserSearch=()=>!!this._messageSearchRef&&this._messageSearchRef.didUserSearch(),this.getLastSearchResultsCount=()=>this._messageSearchRef?this._messageSearchRef.getLastSearchResultsCount():0,this.getNumberOfRequests=()=>this._messageSearchRef?this._messageSearchRef.getNumberOfRequests():0,this.resetTelemetryParams=()=>this._messageSearchRef&&this._messageSearchRef.resetTelemetryParams(),this._onMessageSearchRef=e=>{this._messageSearchRef=e||void 0},this._animatedHeightValue.setValue(e.isMessageSearchPanelVisible?61:0),this._animatedOpacityValue.setValue(e.isMessageSearchPanelVisible?1:0)}_buildState(e,t){const s={leavePaddingForStatusBar:n.StatusBar.isOverlay(),statusBarHeight:p.default.statusBarHeight()};return t&&this._animatedPositionValueStackNav.setValue(e.isMessageSearchPanelVisible?M._zeroPosition(s):-70),s}componentDidMount(){super.componentDidMount(),this._animate(this.props.isMessageSearchPanelVisible)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.props.isMessageSearchPanelVisible!==e.isMessageSearchPanelVisible&&this._animate(this.props.isMessageSearchPanelVisible)}_animate(e){if(this.isComponentMounted()){if(this._animation&&this._animation.stop(),this.props.useMobileUI)this._animation=n.Animated.timing(this._animatedPositionValueStackNav,{toValue:e?M._zeroPosition(this.state):-70,duration:o.Common.Duration.Default,easing:o.Easing.SkypeExpoInOut5});else{const t=n.Animated.timing(this._animatedHeightValue,{toValue:e?61:0,duration:500,easing:o.Easing.SkypeExpoInOut5}),s=n.Animated.timing(this._animatedOpacityValue,{toValue:e?1:0,duration:300,easing:o.Easing.Linear,delay:e?200:100});this._animation=n.Animated.parallel([t,s])}this._animation.start((()=>{this._animation=void 0})),this._messageSearchRef&&e&&this._messageSearchRef.requestFocus()}}render(){const e=this.props.isMessageSearchPanelVisible?this.props.importantForAccessibility:n.Types.ImportantForAccessibility.NoHideDescendants,t=this.props.useMobileUI?[T.container,this._themeStyles.primaryBackgroundColorStyle,this._animatedMenuStyleStackNav]:this._animatedMenuStyle;return n.createElement(n.Animated.View,{style:t,importantForAccessibility:e},n.createElement(b,Object.assign({},this.props,{ref:this._onMessageSearchRef})))}static _zeroPosition(e){return(e.leavePaddingForStatusBar?e.statusBarHeight:0)||0}}t.MessageSearchPanelAnimatedWrapper=M},53189:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MobileSearchNavigationPanel=t.MessageSearchPanelNavigation=void 0;const i=s(96486),o=s(98356),n=s(16778),r=s(13944),a=s(15877),l=s(33754),d=s(86045),c=s(81760),h=s(11010),u=s(11828),p=s(19675),g=s(24576),m=(0,a.lazyProperties)({rowCenterContainer:()=>n.Styles.createViewStyle({backgroundColor:c.Color.transparent,flexDirection:"row",alignItems:"center"}),buttonsContainer:()=>n.Styles.createViewStyle({flexDirection:"row"}),buttonStyle:()=>n.Styles.createViewStyle({padding:0,alignItems:"center",justifyContent:"center",width:20,height:20,borderRadius:10,marginRight:8}),results:()=>n.Styles.createViewStyle({marginRight:16}),stackNavigationOverrides:()=>(0,a.lazyProperties)({rowCenterContainer:()=>n.Styles.createViewStyle({height:50,borderTopWidth:1}),buttonsContainer:()=>n.Styles.createViewStyle({paddingLeft:10,paddingRight:10,width:88}),spacerStyle:()=>n.Styles.createViewStyle({width:88}),buttonStyle:()=>n.Styles.createViewStyle({marginRight:20}),results:()=>n.Styles.createTextStyle({fontSize:h.default.fontSize.size18,textAlign:"center",flexDirection:"row",flexGrow:1})})});class S extends g.default{constructor(){super(...arguments),this._onPrevButtonRef=e=>{this._prevButtonRef=e},this._onNextButtonRef=e=>{this._nextButtonRef=e},this._onChangeDirectionUp=()=>{this.props.searchStore.focusPreviousMessage(),this.props.searchStore.isFocusingPreviousDisabled()&&this._nextButtonRef&&this._nextButtonRef.requestFocus()},this._onChangeDirectionDown=()=>{this.props.searchStore.focusNextMessage(),this.props.searchStore.isFocusingNextDisabled()&&this._prevButtonRef&&this._prevButtonRef.requestFocus()}}_buildState(e,t){return{results:e.searchStore.getResults(),currentMessageIndex:e.searchStore.getFocusedMessageIndex(),isMovingUpDisabled:e.searchStore.isFocusingPreviousDisabled(),isMovingDownDisabled:e.searchStore.isFocusingNextDisabled()}}UNSAFE_componentWillUpdate(e,t,s){if(super.UNSAFE_componentWillUpdate(e,t,s),d.default.shouldAnnounceForAccessibility()&&t.currentMessageIndex!==this.state.currentMessageIndex){const e=l.getString("MessageSearchNavigation.NumberOfResults",{currentIndex:t.currentMessageIndex+1,totalNumberOfResults:this.state.results.length});n.Accessibility.announceForAccessibility(e)}}render(){let e=[m.rowCenterContainer];return this.props.useMobileUI&&(e.push(m.stackNavigationOverrides.rowCenterContainer),e.push(this._themeStyles.headerShadowBorderColorStyle),e.push(this._themeStyles.primaryBackgroundColorStyle)),n.createElement(n.View,{style:e},this.props.useMobileUI?[this._getButtons(),this._getCaption()]:[this._getCaption(),this._getButtons()],this._getOptionalSpacer())}_getCaption(){return this.props.useMobileUI?n.createElement(n.Text,{key:"caption",style:[m.stackNavigationOverrides.results,this._themeStyles.primaryTextColorStyle]},l.getString("MessageSearchNavigation.NumberOfResults",{currentIndex:this.state.currentMessageIndex+1,totalNumberOfResults:this.state.results.length})):n.createElement(p.Caption,{key:"caption",style:m.results,textThemeColor:p.TextThemeColor.Primary},i.isEmpty(this.state.results)?0:this.state.currentMessageIndex+1," / ",this.state.results.length)}_getButtons(){const e=[m.buttonsContainer];this.props.useMobileUI&&e.push(m.stackNavigationOverrides.buttonsContainer);const t=[this.props.useMobileUI?m.stackNavigationOverrides.buttonStyle:m.buttonStyle,this.props.useMobileUI?void 0:this._themeStyles.buttonBackgroundColorStyle],s=this.props.useMobileUI?u.IconSize.size24:u.IconSize.size10,i=this.props.useMobileUI&&!this.state.isMovingUpDisabled?c.Color.blueDark:this._themeColors.primaryTextColor,o=this.props.useMobileUI&&!this.state.isMovingDownDisabled?c.Color.blueDark:this._themeColors.primaryTextColor;return n.createElement(n.View,{key:"buttons",style:e},n.createElement(r.default,{disabled:this.state.isMovingUpDisabled,onPress:this._onChangeDirectionUp,icon:u.SkypeIcon.UpChevron,disabledOpacity:.4,size:s,color:i,hoverColor:this._themeColors.primaryTextColor,hoverStyle:this._themeStyles.buttonBackgroundHoverColorStyle,style:t,title:l.getString("ContentPanelHeader.SearchInConversationPreviousResultTitle"),ref:this._onPrevButtonRef}),n.createElement(r.default,{disabled:this.state.isMovingDownDisabled,onPress:this._onChangeDirectionDown,icon:u.SkypeIcon.DownChevron,disabledOpacity:.4,size:s,color:o,hoverColor:this._themeColors.primaryTextColor,hoverStyle:this._themeStyles.buttonBackgroundHoverColorStyle,style:t,title:l.getString("ContentPanelHeader.SearchInConversationNextResultTitle"),ref:this._onNextButtonRef}))}_getOptionalSpacer(){if(this.props.useMobileUI)return n.createElement(n.View,{style:m.stackNavigationOverrides.spacerStyle})}}t.MessageSearchPanelNavigation=S;const f=(0,a.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,height:50,position:"absolute",left:0,right:0})});class y extends g.default{constructor(){super(...arguments),this._animatedPositionValue=new n.Animated.Value(-50),this._animatedNavStyle=n.Styles.createAnimatedViewStyle({bottom:this._animatedPositionValue})}componentDidMount(){super.componentDidMount(),this._animate(this.state.isMessageSearchPanelVisible)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.isMessageSearchPanelVisible!==t.isMessageSearchPanelVisible&&this._animate(this.state.isMessageSearchPanelVisible)}_buildState(e,t){let s={isMessageSearchPanelVisible:!!e.searchStore.getSearchQuery()};return t&&this._animatedPositionValue.setValue(this._bottomPosition(s.isMessageSearchPanelVisible)),s}_animate(e){this.isComponentMounted()&&(this._animation&&this._animation.stop(),this._animation=n.Animated.timing(this._animatedPositionValue,{toValue:this._bottomPosition(e),duration:o.Common.Duration.Default,easing:o.Easing.SkypeExpoInOut5}),this._animation.start((()=>{this._animation=void 0})))}_bottomPosition(e){return e?0:-50}render(){return n.createElement(n.Animated.View,{style:[f.container,this._animatedNavStyle,this.props.style]},n.createElement(S,Object.assign({},this.props)))}}t.MobileSearchNavigationPanel=y},98469:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(98278),n=s(85641),r=s(36400),a=s(13944),l=s(10117),d=s(47126),c=s(15877),h=s(33754),u=s(6658),p=s(30124),g=s(70919),m=s(15415),S=s(81760),f=s(11010),y=s(11828),_=s(60305),v=s(19675),C=s(24576),b={},T=(0,c.lazyProperties)({container:()=>i.Styles.createViewStyle({paddingVertical:0,paddingHorizontal:0,flex:1,flexDirection:"row",overflow:"hidden"}),rightContainerStyle:()=>i.Styles.createViewStyle({borderLeftWidth:1,borderStyle:"solid",alignItems:"stretch"}),centerContainer:()=>i.Styles.createViewStyle({overflow:"hidden",backgroundColor:S.Color.transparent,flexGrow:0,flexShrink:1,flexDirection:"row",alignSelf:"flex-end",marginBottom:11,height:38,width:u.maxStreamContentWidth}),innerContainer:()=>i.Styles.createViewStyle({borderRadius:5,borderWidth:1,flex:1,flexDirection:"row"}),rowCenterContainer:()=>i.Styles.createViewStyle({backgroundColor:S.Color.transparent,flexDirection:"row",alignItems:"center"}),searchInput:()=>i.Styles.createTextInputStyle({flex:1,fontSize:f.default.controlFontSize.caption,backgroundColor:S.Color.transparent,height:20}),searchInputContainer:()=>i.Styles.createViewStyle({padding:8,flex:1,flexDirection:"row",alignItems:"center"}),searchInputIcon:()=>i.Styles.createViewStyle({marginRight:8}),closeButton:()=>i.Styles.createViewStyle({backgroundColor:S.Color.transparent,marginLeft:20}),loadingContainer:()=>i.Styles.createViewStyle({alignItems:"center",justifyContent:"center",marginHorizontal:10}),loader:()=>i.Styles.createViewStyle({padding:0}),cancelBtn:()=>i.Styles.createViewStyle({paddingHorizontal:20}),innerContainerRight:()=>i.Styles.createButtonStyle({paddingLeft:20}),stackNavigationOverrides:()=>(0,c.lazyProperties)({container:()=>i.Styles.createViewStyle({flex:1,flexDirection:"row",overflow:"hidden",alignItems:"stretch"}),leftSpacer:()=>i.Styles.createViewStyle({width:10}),rightSpacer:()=>i.Styles.createViewStyle({width:10}),centerContainer:()=>i.Styles.createViewStyle({overflow:"hidden",flexGrow:1,flexDirection:"row",alignSelf:"center",height:30}),searchInput:()=>i.Styles.createTextInputStyle({fontSize:f.default.controlFontSize.body}),innerContainer:()=>i.Styles.createViewStyle({borderRadius:15}),cancelBtn:()=>i.Styles.createViewStyle({paddingLeft:10})})});class M extends C.default{constructor(){super(...arguments),this._renderCancelButton=()=>this.state.useMobileUI?i.createElement(i.Button,{onPress:this.props.onCancelButtonPress,style:T.stackNavigationOverrides.cancelBtn},i.createElement(v.BodyText,{style:this._themeStyles.primaryTextColorStyle},h.getString("Global.CancelLabel"))):i.createElement(r.HoverableButton,{onPress:this.props.onCancelButtonPress,style:T.cancelBtn,disabled:this.props.disableUi},i.createElement(v.Caption,{textThemeColor:v.TextThemeColor.Primary},h.getString("Global.CancelLabel"))),this._renderLoading=()=>{if(this.props.isLoading)return i.createElement(i.View,{style:T.loadingContainer},i.createElement(m.default,{size:o.SXActivityIndicatorSize.ExtraSmall,tintColor:this._themeColors.primaryIconColor,style:T.loader,useRXIndicator:!0}))},this._renderNavigationComponent=()=>this.props.navigationComponent,this._renderSearchInput=()=>{const e=[T.searchInput,this.state.useMobileUI?T.stackNavigationOverrides.searchInput:void 0,this._themeStyles.primaryTextColorStyle],t=this.state.useMobileUI?h.getString("ContentPanelHeader.SearchConversationPlaceholderMobile"):h.getString("ContentPanelHeader.SearchConversationPlaceholder");return i.createElement(i.View,{style:T.searchInputContainer},i.createElement(l.default,{icon:y.SkypeIcon.Search,size:y.IconSize.size15,color:this._themeColors.secondaryTextColor,style:T.searchInputIcon}),i.createElement(i.TextInput,{ref:this._onSearchInputRef,style:e,onChangeText:this.props.onChangeText,value:this.props.searchQuery,placeholder:t,placeholderTextColor:this._themeColors.primaryTextColor,onKeyPress:this._onKeyPress,clearButtonMode:"never",importantForAccessibility:i.Types.ImportantForAccessibility.No,editable:!this.props.disableUi}),this._renderClearButton(),this._renderLoading())},this._renderClearButton=()=>{if(!this.props.isLoading&&""!==this.props.searchQuery)return i.createElement(a.default,{onPress:this.props.onClearPress,icon:y.SkypeIcon.ClosePanel,size:y.IconSize.size14,color:this._themeColors.secondaryTextColor,hoverColor:this._themeColors.secondaryTextColor,style:T.closeButton,showHoverEffect:!0,title:h.getString("ContentPanelHeader.SearchInConversationClearTitle")})},this._onSearchInputRef=e=>{this._searchInputRef=e||void 0},this._onKeyPress=e=>{e.keyCode===d.default.ENTER?(!0===e.shiftKey?this.props.searchStore.focusNextMessage():this.props.searchStore.focusPreviousMessage(),this.requestFocus()):e.keyCode===d.default.ESCAPE&&(""!==this.props.searchQuery?this.props.clearSearch():this.props.onCancel(g.MessageSearchToggleOrigin.EscapeKey))}}_buildState(e,t){let s={};t&&(s={leftSpacerWidth:10,rightSpacerWidth:10});const{left:i,right:o}=n.default.getSpacerWidths();return s.leftSpacerWidth=_.default.isTablet()?i:i+u.messageStreamOverflowWidth,s.rightSpacerWidth=_.default.isTablet()?o:o+u.messageStreamOverflowWidth,s.useMobileUI=(p.default.isUsingStackNavigationContext()||_.default.isTablet())&&!0,s}_getSpacerStyle(e){return b[e]||(b[e]=i.Styles.createViewStyle({flex:1,minWidth:e})),b[e]}render(){const e=[T.innerContainer,this.state.useMobileUI?T.stackNavigationOverrides.innerContainer:void 0,this._themeStyles.dividerBorderColorStyle],t=[T.rowCenterContainer,T.rightContainerStyle,this._themeStyles.dividerBorderColorStyle],s=this.state.useMobileUI?T.stackNavigationOverrides.leftSpacer:this._getSpacerStyle(this.state.leftSpacerWidth),o=this.state.useMobileUI?T.stackNavigationOverrides.rightSpacer:this._getSpacerStyle(this.state.rightSpacerWidth);let n;this.state.useMobileUI||(n=i.createElement(i.View,{style:t},i.createElement(i.View,{style:[T.rowCenterContainer,T.innerContainerRight]},this._renderNavigationComponent()),this._renderCancelButton()));const r=this.state.useMobileUI?T.stackNavigationOverrides.centerContainer:T.centerContainer;let a=this.state.useMobileUI?T.stackNavigationOverrides.container:T.container;return i.createElement(i.View,{style:a},i.createElement(i.View,{style:s}),i.createElement(i.View,{style:r},i.createElement(i.View,{style:e},this._renderSearchInput(),n),this.state.useMobileUI?this._renderCancelButton():void 0),i.createElement(i.View,{style:o}))}requestFocus(){this._searchInputRef&&this._searchInputRef.requestFocus()}}t.default=M},23422:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(89391),n=s(1706),r=s(71830),a=s(97775),l=s(11009),d=s(34196),c=s(25739),h=s(3871),u=s(39549),p=s(86374),g=s(52262),m=s(70891),S=s(10117),f=s(61253),y=s(15877),_=s(33754),v=s(53703),C=s(80622),b=s(54565),T=s(11010),M=s(11828),I=s(19675),w=s(24576),P=s(12770),k=s(88117),A=s(21788),E=s(72758),R=M.IconSize.size15+5,L=M.IconSize.size15,F=(0,y.lazyProperties)({titleContainerNewComposer:()=>i.Styles.createViewStyle({alignItems:"stretch",justifyContent:"center"}),secondRowNewComposer:()=>i.Styles.createViewStyle({flexDirection:"row",marginTop:1,alignItems:"center",overflow:"visible"}),secondRowTextNewComposer:()=>i.Styles.createTextStyle({flex:-1,lineHeight:20}),moodText:()=>i.Styles.createTextStyle({overflow:"visible"}),userPresenceIndicator:()=>i.Styles.createViewStyle({width:8,height:8,borderRadius:4,marginRight:3}),placeholderContainerStyle:()=>i.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-start",width:24,height:18}),chatNameIconWrapper:()=>i.Styles.createViewStyle({width:R,height:L}),certifiedIconWrapper:()=>i.Styles.createViewStyle({position:"relative",top:2}),textTruncation:()=>i.Styles.createViewStyle({flexShrink:1}),manageGroupIconWrapper:()=>i.Styles.createViewStyle({width:23,height:20,flexShrink:0}),manageGroupIcon:()=>i.Styles.createTextStyle({paddingLeft:3,paddingTop:2,paddingRight:0,marginRight:0,lineHeight:20,width:23,height:20}),conversationName:()=>i.Styles.createViewStyle({flexShrink:1,flexDirection:"row",marginRight:20})});class x extends w.default{_buildState(e,t){const s=(0,u.default)().getConversation(e.conversationId),i=o.default.getS4LMessagingFeatures(),a=r.isAgent(e.conversationId);let l={conversationName:g.default.getDisplayName(E.default.getConversationOwner(e.conversationId)),isEncryptedThread:r.isEncryptedThread(e.conversationId),memberCount:s?Math.max(s.getMemberCount(),0):0,hideBotCoachMark:r.getMriNamespace(e.conversationId)===r.Namespaces.Bot,groupedConversationsEnabled:i.enableGroupedConversations,theme:void 0,isOneOnOne:!!s&&s.isOneOnOne(),isAgent:a,isTrustedAgent:a&&n.default.isTrustedAgent(e.conversationId)};const d=e.conversationOwnerMri;if(e.shouldShowUserPresence&&d){const s=E.default.getFullUserProfileByMri(d);if(l.gender=s&&s.gender,l.userPresence=A.default.getCachedUserPresence(d),l.isUserActive=A.default.isActiveUser(d),s.mood&&!e.hideSecondRow){l.theme=this._currentTheme;const e=p.decodeFromContent(s.mood);if(l.moodRawText=s.mood,l.moodLabel=C.getAccessibilityTitle(s.mood),t||!(0,f.default)(l.moodRawText,this.state.moodRawText)||l.theme!==this.state.theme){const t=this._themeColors,s=this._themeStyles,i=[T.default.captionFontStyle(),F.secondRowTextNewComposer,F.moodText],o={processing:{emoticons:m.ProcessingLevel.Full,quotes:m.ProcessingLevel.None,wikiMarkup:m.ProcessingLevel.Stripped,links:m.ProcessingLevel.Full,atMentions:m.ProcessingLevel.Stripped},renderMedia:!1,mediaPlaceholderIconColor:t.primaryTextColor,allowLargeEmoticons:!1,numberOfLines:1,textOverrideStyle:i,boldTextStyle:i,regularTextStyle:i,linkStyle:s.linkTextColorStyle};l.moodReact=(0,h.renderReact)(e,o).value}else l.moodReact=this.state.moodReact}else l.moodReact=void 0,l.moodRawText=void 0}else l.moodReact=void 0,l.moodRawText=void 0;return l}componentDidMount(){super.componentDidMount(),this._updateLastSeenTextTimer=P.default.setInterval((()=>{this.state.userPresence&&this.state.userPresence.lastSeenAtUtc&&this.isComponentMounted()&&this.forceUpdate()}),6e4),this._fetchUserPresence(this.props)}componentWillUnmount(){super.componentWillUnmount(),this._updateLastSeenTextTimer&&P.default.clearInterval(this._updateLastSeenTextTimer)}_fetchUserPresence(e){e.shouldShowUserPresence&&e.conversationOwnerMri&&b.default.forceFetchPresence(e.conversationOwnerMri)}_userPresenceText(){let e;if(r.isS4BBridgeMri(this.props.conversationId))e=_.getString("ContentPanelHeaderTitle.TeamsInteropSubtitleShort");else{const t=r.isPhoneMri(this.props.conversationId)&&r.isSkypeId(this.props.conversationOwnerMri)||!r.isPhoneMri(this.props.conversationId);e=this.state.userPresence&&!this.state.isAgent&&t?r.getLastSeenPresenceText(this.state.userPresence,!1,this.state.gender,this.state.isUserActive):""}return e}_memberCountText(){return _.getString("ContentPanelHeaderTitle.ParticipantsLowercase",{count:this.state.memberCount})}render(){const e=[F.titleContainerNewComposer,this.props.style];return this.state.hideBotCoachMark?this._renderWrapperPanelHeader(e):this._renderCoachMarkPanelHeader(e)}_renderSecondRowElement(){let e,t;if(!this.props.hidePresenceIndicator&&this.state.userPresence&&this.state.userPresence.status&&(t=k.default.getPresenceIcon(c.default.getPresenceStatusForIcon(this.state.isUserActive,this.state.userPresence),F.userPresenceIndicator,M.IconSize.size8,void 0,void 0)),this.state.moodReact)e=this.state.moodReact;else if(this.props.shouldShowCallRate)this.props.hideSecondRow||this.props.otherPartyMri&&(e=i.createElement(I.Caption,{style:[F.secondRowTextNewComposer,T.default.fontStyle.messagingStreamChatSubHeader,this.props.isModernizeSmallHeaderMobile?T.default.fontStyle.messagingStreamChatSubHeaderMobile:void 0],numberOfLines:1},this.state.callRateText));else{const t=this.props.hideSecondRow?void 0:this.props.otherPartyMri?this._userPresenceText():this._memberCountText();e=t?i.createElement(I.Caption,{style:[F.secondRowTextNewComposer,T.default.fontStyle.messagingStreamChatSubHeader,this.props.isModernizeSmallHeaderMobile?T.default.fontStyle.messagingStreamChatSubHeaderMobile:void 0],numberOfLines:1},t):void 0}return e||t?i.createElement(i.View,{style:F.secondRowNewComposer},t,e):void 0}_renderPanelHeader(){const e=this.props.isModernizeSmallHeaderMobile?[T.default.modernizeSmallHeaderMobileFontStyle(this._currentTheme),F.textTruncation]:[T.default.modernizeSmallPanelHeaderFontStyle(this._currentTheme),F.textTruncation],t=this.state.isEncryptedThread&&!this.state.groupedConversationsEnabled?i.createElement(i.View,{style:F.placeholderContainerStyle},i.createElement(S.default,{icon:M.SkypeIcon.Lock,size:M.IconSize.size24,color:this._themeColors.primaryIconColor})):void 0,s=this.state.isTrustedAgent?this._getOptionalCertifiedIcon():void 0,o=this.props.isModernizeSmallHeaderMobile||this.state.isTrustedAgent?void 0:this._getOptionalGroupManageIcon();return i.createElement(i.View,{style:F.conversationName},t,i.createElement(i.Text,{style:e,numberOfLines:1,ellipsizeMode:"tail"},this.state.conversationName),s,o)}_getOptionalGroupManageIcon(){return i.createElement(i.View,{style:F.manageGroupIconWrapper},i.createElement(v.default,{key:`manageGroupButton-${this.props.conversationId}`,iconColorOverride:this._themeColors.iconHoverColor,onPress:this.props.onTitlePress,accessibilityLabel:_.getString("CallPanel.ManageGroupAccessibilityLabel"),isCompact:!1,iconSize:M.IconSize.size20,style:F.manageGroupIcon,hoverColor:this._themeColors.headerIconColor,disableHoverOpacityStyles:!0}))}_getOptionalCertifiedIcon(){const e=[F.chatNameIconWrapper,F.certifiedIconWrapper];return i.createElement(d.default,{botMri:this.props.conversationId,style:e})}_renderWrapperPanelHeader(e){return i.createElement(i.Button,{onPress:this.props.onTitlePress,style:e},this._renderPanelHeader(),this.props.hideSecondRow?void 0:this._renderSecondRowElement())}_renderCoachMarkPanelHeader(e){const t=c.default.accessibilityLabel(this.state,!!this.props.hideSecondRow,!!this.props.shouldShowUserPresence,!!this.props.shouldShowCallRate),s={coachMarkType:l.CoachMarkType.ChatProfile,onAnchorPress:this.props.onTitlePress,anchorAccessibilityLabel:t};return i.createElement(a.default.Button,Object.assign({style:e,onPress:this.props.onTitlePress,title:t},s),this._renderPanelHeader(),this.props.hideSecondRow?void 0:this._renderSecondRowElement())}}t.default=x},58481:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GifPreview=void 0;const i=s(31844),o=s(16778),n=s(35566),r=s(23790),a=s(39285),l=s(18192),d=s(15877),c=s(26424),h=s(83294),u=s(29130),p=s(60305),g=s(19675),m=(0,d.lazyProperties)({gifContainer:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center"}),gifContainerPortrait:()=>o.Styles.createViewStyle({marginTop:30,flexDirection:"column"}),metadataContainer:()=>o.Styles.createViewStyle({marginTop:8,marginHorizontal:8,flex:-1})});class S extends l.KeyboardPreviewPanel{_buildState(e,t){const s=this._getRootViewId();return Object.assign(Object.assign({},super._buildState(e,t)),{availableWidth:u.default.getWidth(s),useTabletUI:p.default.useTabletUI()})}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),e.gif!==this.props.gif&&this.props.onGifUpdated&&this.props.onGifUpdated()}componentDidMount(){super.componentDidMount()}_renderElement(){const e=this._getDeviceOrientation()===i.DeviceOrientation.Landscape,t=e?10:100,s=n.default.fitToContainer({width:this.props.gif.full.width,height:this.props.gif.full.height},{width:this.state.availableWidth-50,height:this._getAvailableHeight()-t}),l=[m.gifContainer];this.state.useTabletUI||e||(l.push(this._themeStyles.primaryBackgroundColorStyle),l.push(m.gifContainerPortrait));const d=o.createElement(r.GifItem,{key:this.props.gif.id,id:this.props.gif.id,autoFocus:!0,info:this.props.gif,src:this.props.gif.asmImageProxy,isSelected:!0,isUsedForPreview:!0,renderMobileInterface:!0,onSelected:this.props.onSend,width:s.width,height:s.height,showPlaceholder:!0}),c=h.getGifAttribution(),u=o.createElement(a.default,{style:m.metadataContainer},o.createElement(g.Subtitle,{selectable:!0},c));return o.createElement(o.View,{style:l},d,u)}_getPesInlineSearchTotalHeight(){return c.GifInlineSearchTotalHeight}}t.GifPreview=S,t.default=S},18192:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.KeyboardPreviewPanel=void 0;const i=s(31844),o=s(16778),n=s(4736),r=s(62033),a=s(98278),l=s(46096),d=s(13944),c=s(36237),h=s(10400),u=s(72490),p=s(15877),g=s(33754),m=(s(40897),s(30124)),S=(s(26424),s(29130)),f=s(51070),y=s(81760),_=s(11828),v=s(34528),C=s(80837),b=s(24576),T=(0,p.lazyProperties)({overlayInner:()=>o.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,bottom:0,flex:1,alignItems:"center",justifyContent:"center"}),containerButton:()=>o.Styles.createButtonStyle({flex:1,alignSelf:"stretch",justifyContent:"center",alignItems:"center"}),closeButton:()=>o.Styles.createViewStyle({position:"absolute",alignItems:"flex-end",top:0,left:0,paddingVertical:12,paddingHorizontal:12}),bottomControlsSingle:()=>o.Styles.createViewStyle({justifyContent:"flex-start",position:"absolute",alignItems:"flex-start",bottom:0,right:0,paddingVertical:12,paddingHorizontal:12}),mojiContainerTransparentDarkTheme:()=>o.Styles.createViewStyle({backgroundColor:y.Color.blackOverlay80})});class M extends b.default{constructor(){super(...arguments),this.backgroundColor=y.Color.transparent,this._opacityAnimationValue=new o.Animated.Value(0),this._opacityAnimationStyle=o.Styles.createAnimatedViewStyle({opacity:this._opacityAnimationValue}),this._onPress=e=>{e.stopPropagation(),this._closePanel()},this._onClose=e=>{e.stopPropagation(),this._closePanel()},this._onBack=()=>(this._closePanel(),c.log(l.LogTraceArea.HardwareBackButton,"goBack: true componentId: KeyboardPreviewPanel"),!0),this._onEscape=()=>(this._closePanel(),!0)}_buildState(e,t){const s=this._getRootViewId(),i=S.default.getDeviceOrientation(s),o=(m.default.isUsingStackNavigationContext(),h.default.getUpdateInfo());let n;n=e.useFullScreen?0:o.height;let r=f.default.statusBarPadding();r&&(r+=10);const l=Object.assign({top:r,bottom:f.default.bottomSafeAreaInset(a.BottomInsetDefault)},f.default.horizontalInsets(a.HorizontalInsetDefault));return{keyboardHeight:n,nativeKeyboardHeight:o.height,windowHeight:S.default.getHeight(s),deviceOrientation:i,safeAreaIsets:l}}_closePanel(){this.props.onClose&&this.props.onClose()}_getDeviceOrientation(){return this.state.deviceOrientation}_getAvailableHeight(){let e=this.state.windowHeight-this.state.keyboardHeight;return this.state.safeAreaIsets.top&&!this.props.useFullScreen&&(e-=this.state.safeAreaIsets.top),e}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this.backgroundColor=this.props.useTransparentDarkTheme?y.Color.transparent:this._themeColors.primaryBackgroundColor}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),t.deviceOrientation!==this.state.deviceOrientation&&this._closePanel()}componentDidMount(){super.componentDidMount(),r.default.subscribe(this._onBack),u.default.addEscapeHandler(this._onEscape),o.Animated.timing(this._opacityAnimationValue,{toValue:1,duration:100,easing:o.Animated.Easing.Linear()}).start()}componentWillUnmount(){super.componentWillUnmount(),r.default.unsubscribe(this._onBack),u.default.removeEscapeHandler(this._onEscape),o.Animated.timing(this._opacityAnimationValue,{toValue:0,duration:100,easing:o.Animated.Easing.Linear()}).start()}render(){let e=[T.overlayInner,this._themeStyles.primaryBackgroundColorStyle,this.props.style];e.push(this._opacityAnimationStyle);const t=this.state.deviceOrientation===i.DeviceOrientation.Landscape?_.IconSize.size20:_.IconSize.size24;let s;if(this.props.showSendButton){const e=[T.bottomControlsSingle];(this.state.safeAreaIsets.right||this.state.safeAreaIsets.right)&&e.push(o.Styles.createViewStyle({bottom:this.state.safeAreaIsets.bottom,right:this.state.safeAreaIsets.right},!1));const t=o.createElement(n.default,{title:this.props.sendButtonTitle,onPress:this.props.onSend,icon:_.SkypeIcon.Send,importantForAccessibility:o.Types.ImportantForAccessibility.Yes});s=o.createElement(o.View,{key:"buttonsContainer",style:e,ignorePointerEvents:!0},t)}let r=v.closeIcon();this.props.useTransparentDarkTheme?(this.backgroundColor=y.Color.transparent,e.push(T.mojiContainerTransparentDarkTheme),r=v.closeIcon()):this.backgroundColor=this._themeColors.primaryBackgroundColor;const a=[T.closeButton];return(this.state.safeAreaIsets.top||this.state.safeAreaIsets.left)&&a.push(o.Styles.createViewStyle({top:this.state.safeAreaIsets.top,left:this.state.safeAreaIsets.left},!1)),o.createElement(o.Animated.View,{style:e},o.createElement(o.Button,{key:"tapTarget",style:[T.containerButton,C.default.defaultCursor],onPress:this._onPress,importantForAccessibility:o.Types.ImportantForAccessibility.No},this._renderElement()),o.createElement(d.default,{style:a,size:t,onPress:this._onClose,color:this.props.useTransparentDarkTheme?y.Color.gray50:this._themeColors.headerIconColor,hoverColor:this.props.useTransparentDarkTheme?y.Color.gray300:this._themeColors.iconHoverColor,icon:r,title:g.getString("Global.CloseButtonTitle")}),s)}}t.KeyboardPreviewPanel=M,t.default=M},58660:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MojiPreview=void 0;const i=s(31844),o=s(16778),n=s(70891),r=s(18192),a=s(15877),l=s(76093),d=s(26424),c=s(58962),h=(0,a.lazyProperties)({mojiContainer:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center"})});class u extends r.KeyboardPreviewPanel{UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),e.moji!==this.props.moji&&this.props.onMojiUpdated&&this.props.onMojiUpdated()}_renderElement(){const e=this._getDeviceOrientation()===i.DeviceOrientation.Landscape,t=this._getOptimalMojiSize(e);return o.createElement(o.View,{style:h.mojiContainer},o.createElement(l.default,{key:this.props.moji.id,borderColor:this.props.borderColor||this.backgroundColor,src:this.props.moji.baseUrl,metadataPosition:e?n.MojiMetadataAlign.Right:n.MojiMetadataAlign.Bottom,size:t,isPreviewModeOn:!0,onSend:this.props.onSend,pesID:this.props.moji.id,useTransparentDarkTheme:this.props.useTransparentDarkTheme||this._useDarkTheme(),showReplayButtonAfterPlay:this.props.showReplayOnMojiAfterPlay,autoPlay:!0,setAccessibilityFocusOnMoji:this.props.setAccessibilityFocusOnMoji}))}_getPesInlineSearchTotalHeight(){return d.MojiInlineSearchTotalHeight}_getOptimalMojiSize(e){let t=n.MojiSize.Large;const s=e?this._getAvailableHeight():this._getAvailableHeight()-d.MojiPreviewMetadataHeight;return s<=c.frameHeights.moji.Size80?t=n.MojiSize.Small:s<=c.frameHeights.moji.Size108?t=n.MojiSize.MediumSmall:s<=c.frameHeights.moji.Size200&&(t=n.MojiSize.Medium),t}}t.MojiPreview=u,t.default=u},44720:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(97691),n=s(38173),r=s(49758),a=s(76621),l=s(71908),d=s(71830),c=s(39549),h=s(57102),u=s(52262),p=s(46096),g=s(36237),m=s(33754),S=s(93194),f=s(35370),y="learnMore";class _{constructor(e,t,s,_){if(this._conversationIds=e,this._getAnchor=t,this._rootViewId=s,this._deletionSource=_,this._isBot=!1,this._getDeleteChatMenuItems=e=>{let t=[{text:e?m.getString("InfoPanel.ClearGroupConfirmationConfirmButtonTitle"):m.getString("ConfirmationDialog.DeleteLabel"),command:"deleteChat"}];return e&&t.push({text:m.getString("Global.LearnMore"),command:y}),{items:t,destructiveIndex:0}},this._deleteBotChat=()=>{if(!this._otherPartyMri)return o.Resolved();const e=d.stripMriNamespace(this._otherPartyMri);return g.track(new r.BotContactInteraction(p.BotsInteraction.DeleteBot,e,u.default.getDisplayName(this._conversationIds[0])||"")),n.default.removeAgentFromContacts(e)},this._deleteChat=()=>{const e=i.map(this._conversationIds,(e=>a.default.ensureConversationLoaded(e).then((()=>{if((0,c.default)().isConversationKnown(e)){const t=f.getConversationTypeForTelemetry(e);l.deleteConversationAsync(e,this._deletionSource,t)}}))));return o.all(e)},this._deleteConversation=()=>this._isBot?this._deleteBotChat().then(this._deleteChat):this._deleteChat(),this._onHandleDeleteChatMenuCommand=e=>{e===S.SXActionMenuCancel||this._handled||(e!==y?(this._handled=!0,this._deleteConversation().then((()=>{this._deffered.resolve(!0)})).catch((e=>{this._deffered.reject(e)}))):h.ConversationUtils.openClearLeaveConversationLearnMore())},this._onHandleCancelCommand=()=>{this._handled||(this._handled=!0,this._deffered.resolve(!1))},this._deffered=o.Defer(),this._handled=!1,1===e.length){const t=(0,c.default)().getConversation(e[0]);this._isGroupConv=!(!t||!d.isGroupConversation(t.id));const s=t&&t.isOneOnOne()?t.getOtherPartyMri():void 0;s&&(this._otherPartyMri=s,this._isBot=d.isAgent(s))}}open(){const e=this._isBot?m.getString("UserProfilePanel.DeleteBotConfirmationContent"):h.ConversationUtils.getDeleteConfirmationTitle(this._conversationIds);let t;t=this._isBot?m.getString("UserProfilePanel.DeleteBotConfirmationDialogContent"):this._conversationIds.length>1?m.getString("InfoPanel.DeleteConfirmationDialogContentGroup",{name:u.default.getShortDisplayName(this._conversationIds[0])||""}):this._isGroupConv?m.getString("InfoPanel.ClearGroupConfirmationDialogContent"):m.getString("InfoPanel.DeleteConfirmationDialogContent");const s=this._getDeleteChatMenuItems(this._isGroupConv),i={anchor:this._getAnchor,buttons:s.items,cancelButtonPosition:S.CancelButtonPosition.End,title:e,message:t,dialogAccessibilityTitle:t,destructiveButtonIndex:s.destructiveIndex};S.default.showWithActionMenuConfig({options:i,callback:this._onHandleDeleteChatMenuCommand,onCancel:this._onHandleCancelCommand,useAlertForDesktop:!0,useAlertForMobile:!1,rootViewId:this._rootViewId,invokingEvent:void 0})}getPromise(){return this._deffered.promise()}}t.default=_,_.showDialog=(e,t,s,i)=>{const o=new _(e,t,s,i);return o.open(),o.getPromise()}},78118:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(61375),o=s(71830),n=s(78364),r=s(57102),a=s(41706),l=s(25793),d=s(33754),c=s(21090),h=s(69413),u=s(93194),p="delete",g="clear",m="endPrivate",S="safeCode";class f{constructor(e,t,s){this._convId=e,this._anchor=t,this._context=s,this._getOverflowMenuItems=()=>{const e=[];if(o.isEncryptedThread(this._convId)){const t=a.default.getHandshakeState(this._convId);t===l.SecureHandshakeState.Completed&&e.push({text:d.getString("InfoPanel.SafeCodeLabel"),command:S}),t!==l.SecureHandshakeState.None&&e.push({text:d.getString("InfoPanel.EndConversationLabel"),command:m})}return o.isOneOnOneConversation(this._convId)?e.push({text:r.ConversationUtils.getDeleteConfirmationTitle([this._convId]),command:p}):e.push({text:d.getString("InfoPanel.ClearGroupConfirmationDialogTitle"),command:g}),e},this._selectOverflowMenuItem=(e,t)=>{switch(u.default.dismiss(f.MenuId,t),e){case p:(0,n.deleteConversation)(this._convId,this._anchor,this._context,"ConversationTabActionMenu",i.DeleteConversationSource.TabSwitcher);break;case m:(0,h.endPrivateConversation)(this._convId,t);break;case S:(0,h.showPrivateConversationSafeCode)(this._convId,t)}},this._actionMenuConfig={anchor:t,useTheme:!0,positionPriorities:["bottom","top"],popupBeakSize:{height:0,width:0}}}show(e){const t=c.rootViewIdForComponentContext(this._context);u.default.showWithOptions({id:f.MenuId,config:this._actionMenuConfig,getMenuItems:this._getOverflowMenuItems,handleMenuCommand:e=>this._selectOverflowMenuItem(e,t),rootViewId:t,invokingEvent:e})}static open(e,t,s,i){new f(t,s,i).show(e)}}t.default=f,f.MenuId="ConversationActionMenuId"},65752:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(96074),n=s(98278),r=s(15877),a=s(89808),l=s(15415),d=s(19675),c=s(12770),h=(0,r.lazyProperties)({container:()=>i.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",flexDirection:"column",paddingHorizontal:40,paddingBottom:40,justifyContent:"center"}),message:()=>i.Styles.createTextStyle({alignSelf:"center",textAlign:"center",marginVertical:20})});class u extends o.default{constructor(){super(...arguments),this._announceA11y=()=>{this.isComponentMounted()&&this._isComponentVisible()&&this._a11yTimer&&(c.default.clearTimeout(this._a11yTimer),this._a11yTimer=void 0,i.Accessibility.announceForAccessibility(this.props.message))}}componentDidMount(){super.componentDidMount(),this._a11yTimer=c.default.setTimeout(this._announceA11y,500)}componentWillUnmount(){super.componentWillUnmount(),this._a11yTimer&&c.default.clearTimeout(this._a11yTimer)}render(){return i.createElement(i.View,{style:h.container},i.createElement(l.default,{size:n.SXActivityIndicatorSize.Large,tintColor:a.default.getPrimaryColorNoSubscription()}),i.createElement(d.BodyText,{bold:!0,style:h.message},this.props.message))}}t.default=u},31714:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NewChatMenuItem=void 0;const i=s(16778),o=s(98278),n=s(13944),r=s(15877),a=s(11010),l=s(11828),d=s(24576),c=(0,r.lazyProperties)({row:()=>i.Styles.createViewStyle({flex:1,justifyContent:"flex-start",flexDirection:"row",alignItems:"center",paddingVertical:o.NewChatMenuItemSizes.paddingVertical}),icon:()=>i.Styles.createViewStyle({width:l.IconSize.size20,height:l.IconSize.size20,marginHorizontal:20,justifyContent:"center"}),title:()=>i.Styles.createViewStyle({alignSelf:"center"})});class h extends d.default{constructor(){super(...arguments),this._onItemRef=e=>{this._itemRef=e||void 0},this._onPress=e=>{this.props.onPressItem(this.props.info.command,(()=>this._itemRef),this._getRootViewId(),e.shiftKey||e.metaKey)}}render(){const e=a.default.rowTitleFontStyle(this._currentTheme);return i.createElement(i.View,{style:c.row,importantForAccessibility:i.Types.ImportantForAccessibility.Yes,accessibilityLabel:this.props.info.title,onPress:this._onPress,ref:this._onItemRef},i.createElement(n.default,{style:c.icon,icon:this.props.info.icon,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.primaryIconColor,size:l.IconSize.size20}),i.createElement(i.Text,{style:[c.title,e]},this.props.info.title))}}t.NewChatMenuItem=h,t.default=h},9341:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(34828),n=s(16778),r=s(98278),a=s(90070),l=s(66649),d=s(15877),c=s(33754),h=s(12462),u=s(31714),p=s(11828),g=s(80837),m=s(24576),S=(0,d.lazyProperties)({panel:()=>n.Styles.createViewStyle({flex:1,justifyContent:"flex-start",alignContent:"flex-start",alignSelf:"stretch",marginTop:10}),itemDivider:()=>n.Styles.createViewStyle({height:1,marginHorizontal:10})});class f extends m.default{constructor(){super(...arguments),this._renderItem=(e,t)=>[n.createElement(u.NewChatMenuItem,{key:e.key,onPressItem:this._onHandleCommand,info:e}),n.createElement(n.View,{key:"itemDivider",style:[S.itemDivider,this._themeStyles.dividerColorStyle]})],this._onHandleCommand=(e,t,s,i)=>{a.default.handleAddMenuCommand(e,t,s,!0,i)}}_buildState({commands:e},t){const s={isUsingGogoNetwork:l.default.isUsingGogoNetwork()};return{menuItems:this._generateMenuItems(e,s)}}render(){return n.createElement(n.View,{style:g.default.flexOne},n.createElement(o.VirtualListView,{style:S.panel,itemList:this.state.menuItems,renderItem:this._renderItem,clickOnEnterPress:!0,accessibilityTrait:n.Types.AccessibilityTrait.None,animateChanges:!1,skipRenderIfItemUnchanged:!0,keyboardDismissMode:"on-drag",keyboardShouldPersistTaps:!0,hoveredItemStyle:this._themeStyles.rowHoverViewStyle,showOverflow:!1,onInitialRenderComplete:this.props.onInitialRenderComplete,restoreFocusAfterUpdate:!0,disableScrolling:!0}))}_generateMenuItems(e,t){return i.compact(i.map(e,(e=>this._menuItemForHubCommand(e,t))))}static calculateHeight(e){return e*r.NewChatMenuItemSizes.height+65}_menuItemForHubCommand(e,t){switch(e){case a.HubCommands.AddConversationGroupCommand:return{key:e,command:e,height:r.NewChatMenuItemSizes.height,template:e,icon:p.SkypeIcon.ContactGroupAdd,title:c.getString("Hub.NewGroupChatLabel")};case a.HubCommands.AddConversationModeratedGroupCommand:return{key:e,command:e,height:r.NewChatMenuItemSizes.height,template:e,icon:p.SkypeIcon.ContactGroup,title:c.getString("Hub.NewModeratedGroupChatShortLabel")};case a.HubCommands.AddConversationPrivateCommand:return{key:e,command:e,height:r.NewChatMenuItemSizes.height,template:e,icon:p.SkypeIcon.Privacy,title:c.getString("Hub.NewPrivateChatShortLabel")};case a.HubCommands.AddBotCommand:return{key:e,command:e,height:r.NewChatMenuItemSizes.height,template:e,icon:p.SkypeIcon.BotAdd,title:c.getString("Hub.FindBotLabel")};case a.HubCommands.NewGroupCallCommand:return{key:e,command:e,height:r.NewChatMenuItemSizes.height,template:e,icon:p.SkypeIcon.CallAdd,title:c.getString("Hub.NewCallLabel"),disabled:t.isUsingGogoNetwork};case a.HubCommands.NewCellularSmsConversationCommand:return{key:e,command:e,height:r.NewChatMenuItemSizes.height,template:e,icon:p.SkypeIcon.MobileSmsNew,title:c.getString("Hub.NewCellularSmsChatLabel")};case a.HubCommands.NewMeetNowCommand:return{key:e,command:e,height:r.NewChatMenuItemSizes.height,template:e,icon:h.default.getMeetNowIcon(),title:c.getString("MeetNow.FeatureName")}}}}t.default=f},85677:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(97691),n=s(57102),r=s(52262),a=s(33754),l=s(93194),d="deleteChat",c="deleteAll",h="__DELIMITER__";class u{constructor(e,t,s){this._convIds=e,this._getAnchor=t,this._rootViewId=s,this._getDeleteChatMenuItems=()=>{let e=[];return i.each(this._convIds,(t=>{e.push({text:n.ConversationUtils.getConversationTitleForSelection(t),command:"deleteChat__DELIMITER__"+t.mri})})),e.push({text:a.getString("InfoPanel.DeleteAll"),command:c}),{items:e,destructiveIndex:e.length-1}},this._handleCommand=e=>{const[t,s]=e.split(h);switch(t){case d:this._deffered.resolve([s]);break;case c:this._deffered.resolve(this._convIds.map((e=>e.mri)));break;case l.SXActionMenuCancel:this._deffered.resolve(void 0)}},this._deffered=o.Defer()}open(){const e=this._getDeleteChatMenuItems(),t=a.getString("InfoPanel.WhichConversationToDelete",{name:r.default.getShortDisplayName(this._convIds[0].mri)||""}),s={anchor:this._getAnchor,buttons:e.items,cancelButtonPosition:l.CancelButtonPosition.End,title:a.getString("InfoPanel.DeleteConfirmationDialogTitle"),message:t,dialogAccessibilityTitle:t,destructiveButtonIndex:e.destructiveIndex};l.default.showWithActionMenuConfig({options:s,callback:this._handleCommand,useAlertForDesktop:!0,rootViewId:this._rootViewId,invokingEvent:void 0,suppressModalDismissalEvents:!0})}getPromise(){return this._deffered.promise()}}t.default=u,u.showDialog=(e,t,s)=>{const i=new u(e,t,s);return i.open(),i.getPromise()}},38931:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(10117),n=s(15877),r=s(33754),a=s(6658),l=s(51070),d=s(81115),c=s(11828),h=s(80837),u=s(19675),p=s(24576),g=s(87331),m=(0,n.lazyProperties)({container:()=>i.Styles.createViewStyle({flexDirection:"row",paddingHorizontal:20,paddingVertical:15}),textContainer:()=>i.Styles.createViewStyle({paddingHorizontal:10}),heading:()=>i.Styles.createTextStyle({marginBottom:10})});class S extends p.default{constructor(){super(...arguments),this.onToggle=(e,t)=>{this.props.onChange(t)}}_buildState(e){return{bottomSafeAreaInset:l.default.bottomSafeAreaInset()}}render(){const e=this.state.bottomSafeAreaInset?d.default.paddingBottomStyle(this.state.bottomSafeAreaInset):void 0;return i.createElement(i.View,{style:[m.container,e,this.props.style]},i.createElement(o.default,{icon:c.SkypeIcon.Link,size:c.IconSize.size20,color:this._themeColors.primaryIconColor}),i.createElement(i.View,{style:[m.textContainer,h.default.flexOne]},i.createElement(u.BodyText,{style:m.heading},r.getString("SetConversationParticipantsPanel.ShareLinkFooterHeading")),i.createElement(u.Caption,{messageStreamFontSize:a.MessageStreamFontSize.Large},r.getString("SetConversationParticipantsPanel.ShareLinkFooterCaption"))),i.createElement(g.default,{isOn:this.props.shareLink,onChange:this.onToggle}))}}t.default=S},32749:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(96074),n=s(16760),r=s(46096),a=s(36237),l=s(15877),d=s(33754),c=s(4735),h=s(30124),u=s(90631),p=s(80837),g=s(53374),m=(0,l.lazyProperties)({locationPanel:()=>i.Styles.createViewStyle({flex:1,alignItems:"stretch"})});class S extends o.default{constructor(){super(...arguments),this._onCloseButtonRef=e=>{this._closeButtonRef=e||void 0},this._onClose=()=>{const e=g.default.newCauseId(),t=this._getContext();a.log(r.LogTraceArea.Navigation,"DesktopLocationPanel._onCloseButtonClick,  causeId: "+e),this.props.displayInModal?c.default.closeGenericDesktopModal(e,this._getRootViewId()):c.default.closeFindPanel(e,t)}}static getHeaderText(){return d.getString("LocationPicker.SendLocation")}componentDidMount(){h.default.isMobileSplitView(),super.componentDidMount(),this._closeButtonRef&&this._closeButtonRef.requestFocus()}render(){let e={setButtonRef:this._onCloseButtonRef};e.closeButtonType=u.CloseButtonType.Close,e.onPress=this._onClose;const t=i.createElement(u.SimplePanelHeader,{panelName:S.getHeaderText(),leftButton:e,useCenteredControls:!0});return i.createElement(i.View,{style:[m.locationPanel,this._themeStyles.primaryBackgroundColorStyle]},t,this._renderPanelContent())}_renderPanelContent(){return i.createElement(n.default,{style:[p.default.flexOne,p.default.overflowVisible],conversationId:this.props.conversationId,displayInPopUp:!1,displayInModal:!!this.props.displayInModal})}_componentId(){return"LocationPanel"}}t.default=S},16760:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(96073),n=s(28293),r=s(16778),a=s(96074),l=s(51077),d=s(98278),c=s(9143),h=s(4336),u=s(41444),p=s(46096),g=s(46096),m=s(39285),S=s(97174),f=s(36237),y=s(15877),_=s(33754),v=s(62523),C=s(46634),b=s(46705),T=s(51176),M=s(24897),I=s(89808),w=s(18078),P=s(4735),k=s(13168),A=s(85207),E=s(29130),R=s(15963),L=s(15415),F=s(78262),x=s(80837),O=s(53374),D=700,B=450,V=(0,y.lazyProperties)({container:()=>r.Styles.createViewStyle({width:322,flexDirection:"column",borderRadius:3}),containerPopUp:()=>r.Styles.createViewStyle({width:D,height:B,flexDirection:"row",borderRadius:3}),containerModal:()=>r.Styles.createViewStyle({width:h.DefaultWidth,flexDirection:"column",borderRadius:3}),centerContent:()=>r.Styles.createViewStyle({justifyContent:"center",alignItems:"center",position:"absolute",top:0,bottom:0,right:0,left:0}),mobileSize:()=>(0,y.lazyProperties)({containerPopUp:()=>r.Styles.createViewStyle({width:320,height:B,flexDirection:"column",borderRadius:3}),placesContainerPopUp:()=>r.Styles.createViewStyle({width:320,height:B-180})}),map:()=>r.Styles.createViewStyle({justifyContent:"center",minHeight:280,flexBasis:1}),places:()=>(0,y.lazyProperties)({container:()=>r.Styles.createViewStyle({width:-78,height:700}),containerPopUp:()=>r.Styles.createViewStyle({width:D-400,height:B}),containerModal:()=>r.Styles.createViewStyle({width:h.DefaultWidth,flexBasis:1})})});class N extends a.default{constructor(){super(...arguments),this._setMapRef=e=>{this._map=e||void 0},this._onMapLoaded=()=>{this.isComponentMounted()&&this.setState({mapLoaded:!0})},this._onCurrentLocationChanged=e=>{this.isComponentMounted()&&this.setState({currentSelectedLocation:{latitude:e.latitude,longitude:e.longitude,latitudeDelta:v.LatitudeDelta,longitudeDelta:v.LongitudeDelta},selectedPlace:e,locationType:F.LocationType.Custom})},this._setSearchInputControlRef=e=>{this._searchInputControl=e||void 0},this._onInputTextChange=e=>{if(!this.isComponentMounted())return;const t=e.trim();this.setState({rawSearchQuery:e}),this._setSearchQuery(t)},this._setSearchQuery=i.throttle((e=>{this.isComponentMounted()&&this.setState({searchQuery:e})})),this._onCancelSearchPress=()=>{this.state.isSearchingPlaceActive&&(f.track(new b.LocationPickerSearchCancel(this.state.locationType)),this._blurSearchInput(),this.isComponentMounted()&&this.setState({rawSearchQuery:"",isSearchingPlaceActive:!1}))},this._onSetInitialLocation=e=>{this.isComponentMounted()&&this.setState({currentSelectedLocation:{latitude:e.latitude,longitude:e.longitude,latitudeDelta:v.LatitudeDelta,longitudeDelta:v.LongitudeDelta}})},this._onNearByPlaceFromSearchSelected=e=>{this._onNearByPlaceSetState(e,F.LocationType.Search),f.track(new b.LocationPickerNearbyClicked(F.LocationType.Search))},this._onSendPress=e=>{let t;const s=e.name,i=e.address;if(t=s===i?i:_.getString("LocationPicker.FullAddress",{addressFriendlyName:s,address:i}),t||(t=_.getString("LocationPicker.LocationSharedFallback")),!this.props.conversationId)return;const{latitude:n,longitude:r}=e,a=new S.LinkEntity(t,T.default.getBingMapsLocationUrl({latitude:n,latitudeDelta:v.LatitudeDelta,longitude:r,longitudeDelta:v.LongitudeDelta},s)),d=new S.GeoLocationEntity(this.state.locationType===F.LocationType.Current,w.default.getSkypeMri(),n,r,void 0,(new Date).getTime(),o.default.getDefaultId(),void 0,_.getLocale(),_.getLanguageFromLocale(),t,void 0,void 0,s,i,[a]);A.default.postMessageFromInput(this.props.conversationId,p.PostSource.LocationPicker,[d],l.MessageTypes.Location,{name:R.ScenarioName.SendLocation}),f.track(new b.LocationPickerSend(this.state.locationType));const c=O.default.newCauseId(),h=this._getContext();f.log(g.LogTraceArea.Navigation,"DesktopLocationWidget._onSendPress,  causeId: "+c),this.props.displayInPopUp?M.default.dismissPopup(this._getRootViewId()):this.props.displayInModal?P.default.closeGenericDesktopModal(c,this._getRootViewId()):P.default.closeFindPanel(c,h)}}_buildState(e,t){const s=this._getRootViewId(),i={isMobileScreenSize:E.default.isMobileScreenSize(s)||E.default.isMinDesktopWidth(s),locationType:t?F.LocationType.None:this.state.locationType,rawSearchQuery:t?"":this.state.rawSearchQuery},o=C.default.getLocationForBing();return t&&o&&(i.currentSelectedLocation={latitude:o.coords.latitude,longitude:o.coords.longitude,latitudeDelta:v.LatitudeDelta,longitudeDelta:v.LongitudeDelta}),i}componentDidMount(){super.componentDidMount(),f.track(new b.LocationPickerNavigationOpen(this.state.locationType))}componentWillUnmount(){super.componentWillUnmount(),f.track(new b.LocationPickerNavigationClose(this.state.locationType))}render(){let e,t;e=this.props.displayInPopUp?this.state.isMobileScreenSize?V.mobileSize.containerPopUp:V.containerPopUp:this.props.displayInModal?[V.containerModal,x.default.flexOne]:V.container,this.state.mapLoaded||(t=r.createElement(r.View,{style:[e,V.centerContent,this._themeStyles.primaryBackgroundColorStyle]},r.createElement(L.default,{size:d.SXActivityIndicatorSize.Large,tintColor:I.default.getPrimaryColorNoSubscription()})));const s=r.createElement(m.default,{style:[x.default.flexOne,this.props.displayInPopUp?void 0:V.map]},r.createElement(c.DesktopBingMap,{ref:this._setMapRef,onCurrentLocationChanged:this._onCurrentLocationChanged,onLocationSend:this._onSendPress,onSetInitialLocation:this._onSetInitialLocation,onMapLoaded:this._onMapLoaded}));let i;i=this.props.displayInPopUp?this.state.isMobileScreenSize?V.mobileSize.placesContainerPopUp:V.places.containerPopUp:this.props.displayInModal?V.places.containerModal:V.places.container;const o=r.createElement(r.View,{style:[this.props.displayInPopUp?void 0:x.default.flexOne,i]},r.createElement(r.View,null,r.createElement(u.default,{ref:this._setSearchInputControlRef,blurOnSubmit:!0,autoFocus:!0,searchInputSmallMode:!0,hideCloseButton:!0,rawSearchQuery:this.state.rawSearchQuery,onInputTextChange:this._onInputTextChange,cancelSearch:this._onCancelSearchPress})),r.createElement(r.View,{style:x.default.flexOne},r.createElement(k.default,{locationType:this.state.locationType,style:x.default.flexOne,query:this.state.searchQuery,searchModeOn:!0,latitude:this.state.currentSelectedLocation&&this.state.currentSelectedLocation.latitude,longitude:this.state.currentSelectedLocation&&this.state.currentSelectedLocation.longitude,sendItem:this._onSendPress,onItemSelected:this._onNearByPlaceFromSearchSelected})));return r.createElement(r.View,{style:e},s,o,t)}_blurSearchInput(){this._searchInputControl&&this._searchInputControl.blurInput()}_onNearByPlaceSetState(e,t){this._blurSearchInput(),this._map&&this._map.sendCommand({type:n.Commands.SetNearbyLocation,location:{address:e.address,name:e.name,region:{center:{latitude:e.latitude,longitude:e.longitude},width:v.LatitudeDelta,height:v.LongitudeDelta}}})}}t.default=N},42683:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(34828),n=s(16778),r=s(11930),a=s(98278),l=s(984),d=s(23293),c=s(82146),h=s(16402),u=s(70891),p=s(46096),g=s(80115),m=s(44949),S=s(15877),f=s(33754),y=s(68080),_=s(64387),v=s(17093),C=s(32226),b=s(74636),T=s(85207),M=s(67806),I=s(15415),w=s(81760),P=s(19675),k=s(24576),A="bottomSpacer",E="g_",R="d_",L="activityIndicator",F=(0,S.lazyProperties)({panel:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),dateHeaderText:()=>n.Styles.createTextStyle({marginLeft:10,marginTop:16}),bottomSpacer:()=>n.Styles.createViewStyle({height:20,flex:0,backgroundColor:w.Color.transparent}),activityIndicator:()=>n.Styles.createViewStyle({flex:1,height:100,paddingVertical:20,alignContent:"center",alignItems:"center",justifyContent:"center"})});class x extends k.default{constructor(){super(...arguments),this._lastScrollTop=0,this._hasRenderedLastItem=!1,this._postedItemsIds=[],this._onListViewRef=e=>{this._listView=e||void 0},this._onScroll=(e,t)=>{if(e>=this._lastScrollTop&&this._hasRenderedLastItem){let e=c.RetrievalMask.All;switch(this.props.viewMode){case v.GalleryViewMode.Media:e=c.RetrievalMask.Media;break;case v.GalleryViewMode.Files:e=c.RetrievalMask.Files;break;case v.GalleryViewMode.Links:e=c.RetrievalMask.Links}c.default.fetchMoreMessages(this.props.conversationId,e)}this._lastScrollTop=e},this._renderItem=(e,t)=>{if(i.isUndefined(e.index))return[];if(this._hasRenderedLastItem=e.index>=this.state.galleryItemResults.length-20,e.key===A)return n.createElement(n.View,{style:F.bottomSpacer});if(e.key===L)return n.createElement(n.View,{style:F.activityIndicator},n.createElement(I.default,{size:a.SXActivityIndicatorSize.Large,tintColor:this.state.primaryColor}));const s=e.key.substr(0,2);if(s===E){const t=this.state.galleryItemResults[e.index];return n.createElement(M.StreamItem,{message:t,isFirstInGroup:!0,isLastInGroup:!0,isLastMessage:!0,isReadOnly:!1,isLastPhotoByCurrentUser:!1,renderOrigin:u.MessageRenderOrigin.CompositeGalleryCanvas,isConversationAccepted:this.state.isConversationAccepted,disableReactions:!0,disableSelectMultipleMessages:!0,onItemPress:this._onItemPress,getRootWindowComponent:this._getListView})}if(s===R){const t=h.default.getDisplayDateString(parseInt(e.key.substr(2),10)),s=r.default.headerAccessibilityInfo(t);return n.createElement(n.View,{accessibilityLabel:s.accessibilityLabel,accessibilityTraits:s.accessibilityTraits,importantForAccessibility:n.Types.ImportantForAccessibility.Yes},n.createElement(P.Subtitle,{style:F.dateHeaderText,accessibilityHidden:!0},t))}return n.createElement(n.View,null)},this._getListView=()=>this._listView,this._onItemPress=(e,t)=>{e.preventDefault(),e.stopPropagation(),_.default.isMediaItem(t)&&(b.pictureViewerWillOpen(),y.default.showWithMessageConfig({initialMessage:t,animateOpenClose:!0,reverseOrder:!1,rootViewId:this._getRootViewId(),origin:p.NavigationMediaViewerOrigin.Gallery}))}}_buildState(e,t){return Object.assign(Object.assign({isConnectedToNetwork:C.default.isConnected(),isConversationAccepted:l.default.isConversationAccepted(e.conversationId)},this._buildResults(e,!i.isEmpty(this._postedItemsIds),t)),{primaryColor:d.default.getPrimaryColor(e.conversationId)})}_buildResults(e,t,s=!1){let n,r=[],a=[],l=c.RetrievalState.None;switch(e.viewMode){case v.GalleryViewMode.None:r=[],l=c.RetrievalState.None;break;case v.GalleryViewMode.All:r=c.default.getCombinedItemsForConversation(e.conversationId,Date.now(),10,s,!0),l=c.default.getCombinedRetrievalState(e.conversationId);break;case v.GalleryViewMode.Media:r=c.default.getMediaForConversation(e.conversationId,Date.now(),10,s,!0),l=c.default.getMediaRetrievalState(e.conversationId);break;case v.GalleryViewMode.Files:r=c.default.getFilesForConversation(e.conversationId,Date.now(),10,s,!0),l=c.default.getFilesRetrievalState(e.conversationId);break;case v.GalleryViewMode.Links:r=c.default.getLinksForConversation(e.conversationId,Date.now(),10,s,!0),l=c.default.getLinksRetrievalState(e.conversationId)}return t&&a.push({key:L,height:100,template:"activityIndicator",isNavigable:!1,index:0}),i.each(r,((e,t)=>{n&&h.default.isSameDay(n,e.createdTime)||(n=e.createdTime,a.push({key:R+n,height:36,index:t,template:"dgcl_dateItem",isNavigable:!1,accessibilityGroup:o.Types.AccessibilityGroupMarker.Begin,accessibilityGroupLabel:h.default.getDisplayDateString(n)})),a.push({key:E+e.cuid,height:200,template:"dgcl_galleryItem",index:t,measureHeight:!0})})),r.length>0&&a.push({key:A,height:20,template:"dgcl_spacer",isNavigable:!1}),{galleryItemResults:r,galleryItemList:a,retrievalState:l}}componentDidMount(){super.componentDidMount(),this._telemetryScenarioSingleton=m.GalleryTelemetryScenario.getInstance(!0),this._postCreatedSubscriptionToken=T.default.postCreated.subscribe((e=>{i.isEmpty(e.amsUploads)||(this._postedItemsIds.push(e.postTime),this.isComponentMounted()&&!e.editedMessageCuid&&i.includes(e.conversationIds,this.props.conversationId)&&this.setState(this._buildResults(this.props,!0)))})),this._postUpdatedSubscriptionToken=T.default.postUpdated.subscribe((e=>{if(!i.isEmpty(e.amsUploads)){const t=this._postedItemsIds.indexOf(e.postTime);e.isFinished&&t>-1&&this._postedItemsIds.splice(t,1),0===this._postedItemsIds.length&&this.setState(this._buildResults(this.props,!1))}}))}shouldComponentUpdate(e,t,s){return e.viewMode!==v.GalleryViewMode.None&&super.shouldComponentUpdate(e,t,s)}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),this._telemetryScenarioSingleton&&(e.conversationId!==this.props.conversationId?(this._telemetryScenarioSingleton.markStep(m.GalleryScenarioStep.ConversationChanged),this._telemetryScenarioSingleton=m.GalleryTelemetryScenario.getInstance(!0)):e.viewMode!==this.props.viewMode&&this._telemetryScenarioSingleton.markChangedViewMode(e.viewMode))}componentWillUnmount(){super.componentWillUnmount(),this._telemetryScenarioSingleton.markStep(m.GalleryScenarioStep.GalleryClosed),m.GalleryTelemetryScenario.destroyInstance(),this._postCreatedSubscriptionToken&&(this._postCreatedSubscriptionToken.unsubscribe(),this._postCreatedSubscriptionToken=void 0),this._postUpdatedSubscriptionToken&&(this._postUpdatedSubscriptionToken.unsubscribe(),this._postUpdatedSubscriptionToken=void 0)}render(){const e=this._renderStatus(),t=e?null:n.createElement(o.VirtualListView,{key:"gallery"+this.props.viewMode,ref:this._onListViewRef,style:F.panel,itemList:this.state.galleryItemList,renderItem:this._renderItem,animateChanges:!1,keyboardDismissMode:"on-drag",keyboardShouldPersistTaps:!0,clickOnEnterPress:!0,onScroll:this._onScroll,accessibilityLabel:f.getString("ContentPanelHeaderTitle.Gallery")});return e||t}_renderStatus(){if(!this.state.isConnectedToNetwork){if(this.state.galleryItemResults.length)return;{let e;switch(this.props.viewMode){case v.GalleryViewMode.Media:e=f.getString("GalleryMediaPanel.NoConnectionMedia");break;case v.GalleryViewMode.Files:e=f.getString("GalleryMediaPanel.NoConnectionFiles");break;case v.GalleryViewMode.Links:e=f.getString("GalleryMediaPanel.NoConnectionLinks")}return g.default.renderStatus(f.getString("GalleryMediaPanel.NoConnection"),e,this._currentTheme)}}if(this.state.retrievalState===c.RetrievalState.Failed)return g.default.renderStatus(f.getString("GalleryMediaPanel.FailureTopStatus"),f.getString("GalleryMediaPanel.FailureBottomStatus"),this._currentTheme);if(0===this.state.galleryItemResults.length){let e;switch(this.props.viewMode){case v.GalleryViewMode.Media:e=f.getString("GalleryMediaPanel.NoMediaStatus");break;case v.GalleryViewMode.Files:e=f.getString("GalleryMediaPanel.NoFilesStatus");break;case v.GalleryViewMode.Links:e=f.getString("GalleryMediaPanel.NoLinksStatus")}return g.default.renderStatus(f.getString("GalleryMediaPanel.NoContentStatus"),e,this._currentTheme)}}}t.default=x},90625:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(71830),r=s(11930),a=s(98278),l=s(65110),d=s(81511),c=s(36237),h=s(15877),u=s(33754),p=s(4735),g=s(17093),m=s(93194),S=s(80837),f=s(24576),y=(0,h.lazyProperties)({filterPicker:()=>o.Styles.createButtonStyle({flexDirection:"row",marginHorizontal:10,alignItems:"center"}),chevronStyle:()=>o.Styles.createTextStyle({marginLeft:8,marginTop:0})}),_="all",v="media",C="links",b="files";class T extends f.default{constructor(){super(...arguments),this._onFilterPickerButtonRef=e=>{this._filterPickerButton=e||void 0},this._onFilterPickerClick=e=>{e.stopPropagation();const t={anchor:()=>this._filterPickerButton,useTheme:!0,popupBeakSize:{height:0,width:0},popupOffset:{x:0,y:10},positionPriorities:["bottom"],colorThemeOverride:this.props.colorThemeOverride};m.default.showWithOptions({id:"galleryFilterId",config:t,getMenuItems:n.isEncryptedThread(this.props.conversationId)?this._getFilterMenuItemsForPrivateConversations:this._getFilterMenuItems,handleMenuCommand:this._onHandleMenuCommand,rootViewId:this._getRootViewId(),invokingEvent:e})},this._getFilterMenuItems=()=>[{text:u.getString("DesktopGalleryFilter.All"),command:_,selected:this.state.viewMode===g.GalleryViewMode.All,selectableType:a.SXMenuItemSelectableType.Checkbox},{text:u.getString("DesktopGalleryFilter.Media"),command:v,selected:this.state.viewMode===g.GalleryViewMode.Media,selectableType:a.SXMenuItemSelectableType.Checkbox},{text:u.getString("DesktopGalleryFilter.Links"),command:C,selected:this.state.viewMode===g.GalleryViewMode.Links,selectableType:a.SXMenuItemSelectableType.Checkbox},{text:u.getString("DesktopGalleryFilter.Files"),command:b,selected:this.state.viewMode===g.GalleryViewMode.Files,selectableType:a.SXMenuItemSelectableType.Checkbox}],this._getFilterMenuItemsForPrivateConversations=()=>[{text:u.getString("DesktopGalleryFilter.All"),command:_,selected:this.state.viewMode===g.GalleryViewMode.All,selectableType:a.SXMenuItemSelectableType.Checkbox},{text:u.getString("DesktopGalleryFilter.Links"),command:C,selected:this.state.viewMode===g.GalleryViewMode.Links,selectableType:a.SXMenuItemSelectableType.Checkbox},{text:u.getString("DesktopGalleryFilter.Files"),command:b,selected:this.state.viewMode===g.GalleryViewMode.Files,selectableType:a.SXMenuItemSelectableType.Checkbox}],this._onHandleMenuCommand=e=>{if(e===m.SXActionMenuCancel||!this.isComponentMounted())return;const t=this._getGalleryViewModeFromCommand(e);c.track(new d.GalleryFilterSwitchedEvent(this.props.conversationId,this.state.viewMode,t)),this.isComponentMounted()&&this.setState({viewMode:t},(()=>{i.defer((()=>{p.default.setDesktopGalleryViewMode(this.props.conversationId,t,this._getContext(),!0)}))}))}}_buildState(e,t){return{viewMode:e.viewMode}}render(){const e=r.default.combinedAccessibilityLabel(u.getString("DesktopGalleryFilter.MenuTitle"),this._currentMenuItemLabel());return o.createElement(l.default,{ref:this._onFilterPickerButtonRef,style:[y.filterPicker,S.default.noncollapsibleView,this.props.style],accessibilityLabel:e,label:this._currentMenuItemLabel(),labelColor:this.props.rightClose?this._themeColors.headerIconColor:void 0,overrideIconColor:this.props.rightClose?this._themeColors.headerIconColor:void 0,onPress:this._onFilterPickerClick,chevronStyle:this.props.rightClose?y.chevronStyle:void 0})}_getGalleryViewModeFromCommand(e){switch(e){case _:return g.GalleryViewMode.All;case v:return g.GalleryViewMode.Media;case C:return g.GalleryViewMode.Links;case b:return g.GalleryViewMode.Files;default:return g.GalleryViewMode.All}}_currentMenuItemLabel(){switch(this.state.viewMode){case g.GalleryViewMode.All:return u.getString("DesktopGalleryFilter.All");case g.GalleryViewMode.Media:return u.getString("DesktopGalleryFilter.Media");case g.GalleryViewMode.Links:return u.getString("DesktopGalleryFilter.Links");case g.GalleryViewMode.Files:return u.getString("DesktopGalleryFilter.Files")}return""}}t.default=T},35697:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(89391),n=s(90625),r=s(15877),a=s(33754),l=s(40363),d=s(90631),c=s(81760),h=s(11828),u=s(60305),p=s(24576),g=(0,r.lazyProperties)({galleryPanelHeader:()=>i.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"space-between"}),filterButtonWrapper:()=>i.Styles.createViewStyle({alignItems:"center",justifyContent:"center",flexDirection:"row",backgroundColor:c.Color.transparent,marginTop:5}),tabletFilterButton:()=>i.Styles.createViewStyle({minHeight:h.IconSize.default,alignItems:"center",justifyContent:"center"}),verticalLine:()=>i.Styles.createViewStyle({width:1,height:24,backgroundColor:c.Color.rightCloseSeparator,marginHorizontal:8}),rightCloseControl:()=>i.Styles.createViewStyle({paddingHorizontal:10})});class m extends p.default{constructor(){super(...arguments),this._onCloseButtonRef=e=>{this._closeButtonRef=e||void 0}}_buildState(e,t){return{useTabletUI:u.default.useTabletUI(),rightClose:o.default.getS4LUiFeaturesNoSubscription().enableWindowRightClose&&l.default.isWindowCloseOnRight()}}componentDidMount(){super.componentDidMount(),this._closeButtonRef&&this._closeButtonRef.requestFocus()}render(){const e=[g.galleryPanelHeader,this._themeStyles.primaryBackgroundColorStyle];let t;if(this.state.rightClose&&e.push(g.rightCloseControl),!this.props.hideDesktopGalleryFilter){const e=[g.filterButtonWrapper];t=i.createElement(i.View,{style:e},i.createElement(n.default,{style:this.state.useTabletUI?g.tabletFilterButton:void 0,conversationId:this.props.conversationId,viewMode:this.props.viewMode,colorThemeOverride:this.props.colorThemeOverride,rightClose:this.state.rightClose}),this.state.rightClose&&i.createElement(i.View,{style:g.verticalLine,ignorePointerEvents:!0}))}const s={closeButtonType:d.CloseButtonType.Close,onPress:this.props.onClose,setButtonRef:this._onCloseButtonRef,title:a.getString("MediaViewer.CloseSharingPromptConfirmButtonLabel")};return i.createElement(d.SimplePanelHeader,{style:e,useCenteredControls:!this.state.rightClose,panelName:a.getString("GalleryPanel.DesktopPanelTitle"),leftButton:s,colorThemeOverride:this.props.colorThemeOverride,hideBottomBorder:!0,leavePaddingForStatusBar:i.StatusBar.isOverlay()&&this._isPresentedInTabletRightNav(),rightButtons:{customButtonComponent:t}})}}t.default=m},75942:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(1706),n=s(96074),r=s(98172),a=s(2278),l=s(47447),d=(s(14920),s(14980),s(71830)),c=s(9709),h=s(3056),u=s(98278),p=s(87399),g=s(39549),m=s(42683),S=s(35697),f=(s(37490),s(3782)),y=s(3291),_=s(46096),v=s(61317),C=s(53559),b=s(81511),T=s(36400),M=s(10117),I=s(66649),w=s(36237),P=s(15877),k=s(33754),A=s(18743),E=s(4735),R=s(85207),L=s(15963),F=s(86045),x=s(81760),O=s(11828),D=s(19675),B=s(53374),V=(0,P.lazyProperties)({galleryPanel:()=>i.Styles.createViewStyle({flex:1,alignItems:"stretch"}),dragAndDropContainer:()=>i.Styles.createViewStyle({marginHorizontal:10,marginVertical:5,height:60}),dragAndDropContainerExpanded:()=>i.Styles.createViewStyle({height:300}),dragAndDropDefault:()=>i.Styles.createButtonStyle({flex:1,alignSelf:"stretch",borderRadius:10,paddingLeft:15,paddingRight:10,backgroundColor:x.Color.black,flexDirection:"row",alignItems:"center",justifyContent:"space-between"}),dragAndDropDefaultWrapper:()=>i.Styles.createViewStyle({position:"absolute",height:60,left:0,right:0}),dropAndDropText:()=>i.Styles.createTextStyle({flexShrink:1}),dragAndDropInline:()=>i.Styles.createViewStyle({height:60,borderRadius:10,paddingLeft:15,paddingRight:10,marginHorizontal:10,marginVertical:5,backgroundColor:x.Color.black,flexDirection:"row",alignItems:"center",justifyContent:"space-between"}),failedFileShareContainer:()=>i.Styles.createViewStyle({flexDirection:"row",paddingTop:10}),failedFileShareTextContainer:()=>i.Styles.createViewStyle({flex:1,flexWrap:"wrap"}),errorIconPadding:()=>i.Styles.createViewStyle({paddingLeft:15,paddingRight:10})});class N extends n.default{constructor(){super(...arguments),this._showFilePicker=e=>{if(w.track(new b.GalleryAddItemPanelOpenedEvent(this.props.conversationId)),l.UICapabilities.desktopFilePickerSupported()){const t=e=>{if(C.default.isImageExtension(C.default.extractFileExtension(e.file.name))){const t={name:L.ScenarioName.SendPicture},s=this.props.callId;if(s){const i={callId:s,scenarioInfo:t,properties:this.props.parentConversationId?r.default.getReactionsThreadPostParams(this.props.parentConversationId):void 0};R.default.postUpload([this.props.conversationId],e,_.PostSource.Gallery,!1,i).then((()=>{a.default.updateCallTelemetry(s,"MediaPicker",(e=>e.postMediaPickerPhotoReaction()))})).then((()=>{F.default.maybeAnnounceForAccessibility(k.getString("MessageComposer.FileSentLabel"))}))}else R.default.postUpload([this.props.conversationId],e,_.PostSource.Gallery,!1,{scenarioInfo:t}).then((()=>{F.default.maybeAnnounceForAccessibility(k.getString("MessageComposer.FileSentLabel"))}))}else if(C.default.isVideoExtension(C.default.extractFileExtension(e.file.name))){const t={name:L.ScenarioName.SendVideo};R.default.postVideoWithThumbnail([this.props.conversationId],e,_.PostSource.Gallery,!1,t).then((()=>{F.default.maybeAnnounceForAccessibility(k.getString("MessageComposer.FileSentLabel"))}))}else{const t={name:L.ScenarioName.SendFile};R.default.postUpload([this.props.conversationId],e,_.PostSource.Gallery,!1,{scenarioInfo:t}).then((()=>{F.default.maybeAnnounceForAccessibility(k.getString("MessageComposer.FileSentLabel"))}))}};v.FilePickerUtils.showMultiFilesPicker(t,A.FilePickerOrigin.DesktopGalleryPanel,void 0,this._getRootViewId(),e)}else 0},this._setShowOverlayStateFalse=()=>{this.isComponentMounted()&&this.setState({showOverlay:!1})},this._setShowOverlayStateTrue=()=>{this.isComponentMounted()&&this.setState({showOverlay:!0})},this._onCloseButtonClick=()=>{const e=B.default.newCauseId();w.log(_.LogTraceArea.Navigation,"DesktopGalleryPanel._onCloseButtonClick,  causeId: "+e),this.props.onClose?this.props.onClose(e):E.default.closeGalleryPanel(e,this._getContext())},this._goBack=e=>(w.log(_.LogTraceArea.Navigation,"DesktopGalleryPanel._goBack,  causeId: "+e),this._isPresentedInTabletRightNav()?(this._onCloseButtonClick(),!0):super._goBack(e))}_buildState(e,t){const s=d.isOneOnOneConversation(e.conversationId)&&d.isAgent(e.conversationId)&&o.default.hasCapability(e.conversationId,"file.send"),i=p.isConversationBlocked(e.conversationId),n=I.default.isUsingGogoNetwork(),r=(0,g.default)().getConversation(e.conversationId);let a={hasFileSendCapability:(s||!i)&&!n,e2eeHandshake:r&&r.isEncryptedThread()?r.getEncryptionHandshake():void 0};return t&&(a.showOverlay=!1),a}componentDidMount(){super.componentDidMount(),w.track(new b.GalleryOpenedEvent(this.props.conversationId))}_renderOptionalDragAndDropArea(){if(!this.state.hasFileSendCapability)return;const e=this._getDragDropLabel(),t=[i.createElement(D.BodyText,{key:"label",textThemeColor:u.TextThemeColor.Secondary,style:V.dropAndDropText},e),i.createElement(M.default,{key:"icon",icon:O.SkypeIcon.Plus,color:this._themeColors.headerIconColor,size:O.IconSize.size24})];let s;{const o=[V.dragAndDropDefault];this._useDarkTheme()||o.push(this._themeStyles.secondaryBackgroundColorStyle),s=i.createElement(i.View,{style:V.dragAndDropDefaultWrapper},i.createElement(T.HoverableButton,{style:o,onPress:this._showFilePicker,accessibilityLabel:e,accessibilityTraits:i.Types.AccessibilityTrait.Button},t))}if(l.UICapabilities.dragAndDropSupported()&&this._allowsUpload()){const e=[V.dragAndDropContainer];let t;return this.state.showOverlay&&(e.push(V.dragAndDropContainerExpanded),t=i.createElement(c.default,{conversationId:this.props.conversationId,label:this._getDragDropLabel()})),i.createElement(f.default,{origin:A.FilePickerOrigin.DragAndDropToGallery,style:e,conversationId:this.props.conversationId,onDragEnter:this._setShowOverlayStateTrue,onDragLeave:this._setShowOverlayStateFalse,onDropCompleted:this._setShowOverlayStateFalse,callId:this.props.callId,parentConversationId:this.props.parentConversationId,dropTargetSource:y.DropTargetOrigin.DesktopGalleryPanel},s,t)}}_getDragDropLabel(){let e;return e=l.UICapabilities.dragAndDropSupported()?"DesktopFindPanelDragAndDrop.DropFilesDraggedOver":"CallReactionsBar.PhotoButtonTitle",k.getString(e)}render(){return i.createElement(h.default,{goBack:this._goBack},i.createElement(i.View,{style:[V.galleryPanel,this._themeStyles.primaryBackgroundColorStyle]},i.createElement(S.default,{conversationId:this.props.conversationId,viewMode:this.props.viewMode,hideDesktopGalleryFilter:!1,onClose:this._onCloseButtonClick}),this._renderOptionalDragAndDropArea(),i.createElement(m.default,{conversationId:this.props.conversationId,viewMode:this.props.viewMode})))}_allowsUpload(){return!this.state.e2eeHandshake}}t.default=N},76242:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(31844),n=s(16778),r=s(89391),a=s(984),l=s(81959),d=s(77381),c=s(82146),h=s(86374),u=s(70891),p=s(46096),g=s(74313),m=s(85609),S=s(52115),f=s(53559),y=s(80115),_=s(10117),v=s(47126),C=s(15877),b=s(33754),T=s(23284),M=s(64387),I=s(12762),w=s(6250),P=s(4735),k=s(17093),A=s(32226),E=s(29130),R=s(81760),L=s(40363),F=s(11010),x=s(11828),O=s(80837),D=s(212),B=s(19675),V=s(63841);var N;!function(e){e[e.Small=0]="Small",e[e.Medium=1]="Medium",e[e.Large=2]="Large",e[e.ExtraLarge=3]="ExtraLarge"}(N||(N={}));const U=150,H=.5,z=1.5,W="mediaitem",j=(0,C.lazyProperties)({rowView:()=>n.Styles.createViewStyle({flexDirection:"row"}),container:()=>n.Styles.createViewStyle({height:U,marginTop:10,marginBottom:10,marginLeft:10,marginRight:10}),containerRounded:()=>n.Styles.createViewStyle({marginTop:0,marginBottom:0,marginLeft:0,marginRight:0}),tile:()=>n.Styles.createViewStyle({flex:1,flexDirection:"column",alignItems:"center",justifyContent:"center",backgroundColor:R.Color.gray300}),tileIcon:()=>n.Styles.createViewStyle({flex:1,flexDirection:"column",alignItems:"center",justifyContent:"center",backgroundColor:R.Color.transparent}),tileTextContainer:()=>n.Styles.createViewStyle({flex:-1,flexDirection:"column",backgroundColor:R.Color.transparent}),tileText:()=>n.Styles.createTextStyle({color:R.Color.white}),errorTitle:()=>n.Styles.createTextStyle({color:R.Color.white,textAlign:"center",marginBottom:10}),errorMessage:()=>n.Styles.createTextStyle({color:R.Color.white,textAlign:"center",paddingHorizontal:40}),errorTextContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"column",alignItems:"center",justifyContent:"center",height:U}),galleryTileContainer:()=>n.Styles.createViewStyle({marginTop:H,marginBottom:H,marginLeft:H,marginRight:H}),galleryTileContainerRounded:()=>n.Styles.createViewStyle({borderRadius:10,marginTop:z,marginBottom:z,marginLeft:z,marginRight:z}),galleryPanel:()=>n.Styles.createViewStyle({alignSelf:"stretch",backgroundColor:R.Color.transparent,flexDirection:"row"}),loadingStatusContainer:()=>n.Styles.createViewStyle({flex:1,alignItems:"center",paddingTop:50,backgroundColor:R.Color.darkThemeBackground}),overlayContainer:()=>O.default.absoluteFill,lightBlackOverlay:()=>n.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:R.Color.blackOverlay20})});class G extends d.default{constructor(){super(...arguments),this._maxGifFileSizeForIOs=r.default.getConfigSettings().urlPreview.gifSizeLimitInBytes,this._mountedRefsMap=new w.default,this._onLayout=e=>{this.isComponentMounted()&&this.setState({galleryWidth:e.width})},this._onMediaItemClick=()=>{this.props.onItemPress&&this.props.onItemPress(),this._navigateToGallery(k.GalleryViewMode.Media)},this._onLinkItemClick=()=>{this.props.onItemPress&&this.props.onItemPress(),this._navigateToGallery(k.GalleryViewMode.Links)},this._onFileItemClick=()=>{this.props.onItemPress&&this.props.onItemPress(),this._navigateToGallery(k.GalleryViewMode.Files)},this._onKeyPress=e=>{let t=this.state.focusedIndex;e.keyCode!==v.default.UP&&e.keyCode!==v.default.LEFT||(t-=1),e.keyCode!==v.default.DOWN&&e.keyCode!==v.default.RIGHT||(t+=1),t<0||t>=this.state.itemResults.length||this.isComponentMounted()&&this.setState({focusedIndex:t})}}_buildState(e,t){let s={};t&&(s.isRetrievingItems=!1,s.itemCount=0,s.fileItemInfo={},s.itemResults=[],s.itemsRetrievalFailed=!1,s.itemUrls={},s.urlPreviewInfo={},s.swiftMessageInfo={},s.galleryWidth=0,s.focusedIndex=0);const i=this._getRootViewId(),n=e.usePortraitLayout?o.DeviceOrientation.Portrait:E.default.getDeviceOrientation(i);s.deviceOrientation=n,s.isConversationAccepted=a.default.isConversationAccepted(e.conversationId);const r=this._getNumberOfItemsToShow(s.deviceOrientation),l=c.default.getCombinedItemsForConversation(e.conversationId,Date.now(),r,t,!0),d=c.default.getMediaRetrievalState(e.conversationId),h=c.default.getFilesRetrievalState(e.conversationId),u=c.default.getLinksRetrievalState(e.conversationId);s.isConnectedToNetwork=A.default.isConnected(),s.isRetrievingItems=d===c.RetrievalState.Retrieving||h===c.RetrievalState.Retrieving||u===c.RetrievalState.Retrieving,s.itemCount=l.length,s.itemsRetrievalFailed=d===c.RetrievalState.Failed||h===c.RetrievalState.Failed||u===c.RetrievalState.Failed,s.itemResults=l.slice(0,r),s.fileItemInfo=this._getInfoForFiles(s.itemResults);const p=this._getUrlsInfo(s.itemResults);return s.itemUrls=p.urls,s.urlPreviewInfo=p.urlPreviewInfo,s.swiftMessageInfo=this._getSwiftMessageInfo(s.itemResults),s}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.focusedIndex!==t.focusedIndex&&this.focusItem(this.state.focusedIndex)}focusItem(e=0){if(!(e<0||e>this.state.itemResults.length-1))if(this.state.focusedIndex===e){const t=this._mountedRefsMap.ref(W+e);t&&t.requestFocus()}else this.setState({focusedIndex:e})}componentDidMount(){if(super.componentDidMount(),this.props.onHasItems){const e=!i.isEmpty(this.state.itemResults);this.props.onHasItems(e)}}UNSAFE_componentWillUpdate(e,t,s){if(super.UNSAFE_componentWillUpdate(e,t,s),this.props.onHasItems){const e=!i.isEmpty(this.state.itemResults),s=!i.isEmpty(t.itemResults);s!==e&&this.props.onHasItems(s)}}_getInfoForFiles(e){let t=this.state&&!i.isEmpty(this.state.fileItemInfo)?this.state.fileItemInfo:{};return i.each(e,(e=>{if(M.default.isFile(e)){const s=h.decode(e),i=s?s.getFirstUriObjectChild(I.UriObjectFileNode):null;if(i){const s=i.getNameForUI(),o=i.getSizeInBytes(),n=S.default.formatFileSize(o,1);t[e.cuid]={displayFilename:s,fileSize:n?n.formattedString:""}}}})),t}_getUrlsInfo(e){let t={},s={};return i.each(e,(e=>{if(M.default.isLink(e)){const o=h.decode(e),n=i.first(o.getWebLinks()),r=n&&e.hasUrlPreviewMetadata()?e.getUrlPreviewMetadata(n):void 0;n&&(t[e.cuid]=n),r&&(s[e.cuid]=r)}})),{urlPreviewInfo:s,urls:t}}_getSwiftMessageInfo(e){let t={};return i.each(e,(e=>{if(M.default.isSwiftCard(e)){const s=h.decode(e);if(M.default.isDecodedRootNodeASwiftCardWithLink(s)){const i=s.getFirstUriObjectChild(I.SwiftUriObjectNode);i&&i.swiftChild&&(t[e.cuid]=i.swiftChild.swiftMessage)}}})),t}_getNumberOfItemsToShow(e){return 5}render(){if(this.props.hideWhenEmpty&&i.isEmpty(this.state.itemResults))return null;const e=[j.container];return this.props.useRoundedCorners?e.push(j.containerRounded):e.push(O.default.flexOne),this.props.style&&e.push(this.props.style),n.createElement(n.View,{style:e,onLayout:this._onLayout},this._getGalleryView())}_getGalleryView(){if(i.isEmpty(this.state.itemResults))return this.state.isConnectedToNetwork?this.state.itemsRetrievalFailed?this._getErrorView(b.getString("GalleryMediaPanel.FailureTopStatus"),b.getString("GalleryMediaPanel.FailureBottomStatus")):this.state.isRetrievingItems?y.default.renderLoadingStatus(j.loadingStatusContainer):this._getErrorView(b.getString("GalleryPanel.NoContentTitle"),b.getString("GalleryPanel.NoContentStatus")):this._getErrorView(b.getString("GalleryMediaPanel.NoConnectionTitle"),b.getString("GalleryMediaPanel.NoConnectionAll"));{const e=[j.galleryPanel];return this.props.useRoundedCorners||e.push(O.default.flexOne),n.createElement(n.View,{style:e,onKeyPress:this._onKeyPress},this._getGalleryItemView())}}_getErrorView(e,t){return n.createElement(n.View,{style:D.default.themeStylesForTheme(V.Theme.ColorfulDark).primaryBackgroundColorStyle},n.createElement(n.View,{style:j.errorTextContainer},n.createElement(B.PanelHeader,{style:j.errorTitle},e),n.createElement(B.BodyText,{style:j.errorMessage},t)))}_getGalleryItemView(){const e=this.state.itemResults.length;return this.state.deviceOrientation===o.DeviceOrientation.Landscape||e<=2?this._getViewForSingleItems():3===e?this._getViewForThreeItemsInPortrait():4===e?this._getViewForFourItemsInPortrait():this._getViewForFiveItemsInPortrait()}_getViewForSingleItems(){return i.map(this.state.itemResults,((e,t)=>this._getGalleryItem(t)))}_getViewForThreeItemsInPortrait(){let e=[];return e.push(this._getGalleryItem(0)),e.push(n.createElement(n.View,{key:"Item1Item2"},this._getGalleryItem(1),this._getGalleryItem(2))),e}_getViewForFourItemsInPortrait(){let e=[];return e.push(this._getGalleryItem(0)),e.push(n.createElement(n.View,{key:"Item1Item2Item3"},this._getGalleryItem(1),n.createElement(n.View,{style:j.rowView,key:"Item2Item3"},this._getGalleryItem(2),this._getGalleryItem(3)))),e}_getViewForFiveItemsInPortrait(){let e=[];return e.push(this._getGalleryItem(0)),e.push(n.createElement(n.View,{key:"Item1Item2"},this._getGalleryItem(1),this._getGalleryItem(3))),e.push(n.createElement(n.View,{key:"Item3Item4"},this._getGalleryItem(2),this._getGalleryItem(4))),e}_getGalleryItem(e){const t=this.state.itemResults[e],s=this._getItemDimensions(e);let i;if(M.default.isMediaItem(t)){let o=this.props.accessibilityPrefix||"";o+=", "+b.getString("GalleryMediaPanel.MediaAccessibilityLabel",{currentItemIndex:e+1,numberOfItems:this.state.itemResults.length}),i=n.createElement(T.default,{ref:this._mountedRefsMap.onComponentRef(W+e),tabIndex:this.state.focusedIndex===e?0:-1,key:t.cuid,message:t,height:s.height,width:s.width,onThumbnailPress:this._onMediaItemClick,thumbnailIconsSize:this._getItemIconSize(s.tileSize),showVideoMediaTypeIcon:!0,showCreator:!1,accessibilityLabel:o,renderOrigin:u.MessageRenderOrigin.StackGalleryCanvas})}else i=this._getFileOrLinkGalleryTile(e,t,s);const o=[j.galleryTileContainer];return this.props.useRoundedCorners&&o.push(j.galleryTileContainerRounded),n.createElement(n.View,{style:o,key:t.cuid},i)}_getFileOrLinkGalleryTile(e,t,s){const o=n.Styles.createViewStyle({height:s.height,width:s.width},!1),r=[j.tile,o],a=n.createElement(n.View,{style:D.default.themeStylesForTheme(V.Theme.ColorfulDark).primaryBackgroundColorStyle});let d,c,h,u;if(M.default.isFile(t)){const e=this.state.fileItemInfo[t.cuid];if(e){const t=m.FileIconHelper.getFileIconGlyph(e.displayFilename),i=m.FileIconHelper.getFileIconColor(e.displayFilename);r.push(n.Styles.createViewStyle({backgroundColor:i},!1)),h=this._getItemIcon(t,R.Color.white,s.tileSize),s.tileSize!==N.Small&&this.state.isConversationAccepted&&(u=this._getItemText(e.displayFilename,e.fileSize,s))}}else if(M.default.isSwiftCard(t)){const e=this.state.swiftMessageInfo?this.state.swiftMessageInfo[t.cuid]:void 0,o=e?i.find(e.attachments,(e=>M.default.isSwiftCardAttachmentALink(e))):void 0;let r="";o&&o.content&&(o.content.image?r=o.content.image.url:o.content.images&&(r=o.content.images[0].url)),r&&this.state.isConversationAccepted?(d=n.createElement(g.default,{origin:"GalleryCombinedListTitleBackgroundFromFile",altView:a,containerStyle:j.overlayContainer,errorView:a,resizeMode:"cover",source:r,style:j.overlayContainer}),c=n.createElement(n.View,{style:j.lightBlackOverlay})):d=a,h=this._getItemIcon(x.SkypeIcon.Link,R.Color.white,s.tileSize),s.tileSize!==N.Small&&o&&o.content&&o.content.title&&this.state.isConversationAccepted&&(u=this._getItemText(l.renderText(o.content.title),o.content.subtitle?l.renderText(o.content.subtitle):"",s))}else{const e=this.state.itemUrls&&this.state.itemUrls[t.cuid]?this.state.itemUrls[t.cuid]:"",i=this.state.urlPreviewInfo?this.state.urlPreviewInfo[t.cuid]:void 0,o=i&&L.default.getPlatformType()===p.PlatformType.iOS&&i.content_type===f.default.imageContentTypes.gif&&i.size&&i.size>this._maxGifFileSizeForIOs;i&&i.thumbnail&&!o&&this.state.isConversationAccepted?(d=n.createElement(g.default,{origin:"GalleryCombinedListTitleBackgroundFromURLP",altView:a,containerStyle:j.overlayContainer,errorView:a,resizeMode:"cover",source:i.thumbnail,style:j.overlayContainer}),c=n.createElement(n.View,{style:j.lightBlackOverlay})):d=a,h=this._getItemIcon(x.SkypeIcon.Link,R.Color.white,s.tileSize),s.tileSize!==N.Small&&this.state.isConversationAccepted&&(u=this._getItemText(i&&i.title?i.title:e||"",i&&i.site?i.site:"",s))}const S=M.default.isFile(t)?"GalleryMediaPanel.FileAccessibilityLabel":"GalleryMediaPanel.LinkAccessibilityLabel";return n.createElement(n.Button,{ref:this._mountedRefsMap.onComponentRef(W+e),tabIndex:this.state.focusedIndex===e?0:-1,onPress:M.default.isFile(t)?this._onFileItemClick:this._onLinkItemClick,activeOpacity:.8,style:r,title:b.getString(S,{currentItemIndex:e+1,numberOfItems:this.state.itemResults.length})},d,c,h,u)}_getTileSize(e,t){let s=N.Small;return 1===e?s=N.ExtraLarge:2===e?s=N.Large:3===e?s=0===t?N.Large:N.Medium:4===e?0===t?s=N.Large:1===t&&(s=N.Medium):0===t&&(s=N.Large),s}_getItemDimensions(e){const t=this._itemMargin(),s=this.state.itemResults.length,i=this.state.galleryWidth-20;let n=this._getTileSize(s,e);if(s<=2||this.state.deviceOrientation===o.DeviceOrientation.Landscape){return{height:3===s&&e>0?75:U,width:(i-2*s*t)/s,tileSize:n}}if(3===s){const s=75-t;return{height:e>0?s:U,width:2*((i-8*t)/4)+2*t,tileSize:n}}if(4===s){const s=(i-4*t)/4,o=75-t;return{height:e>0?o:U,width:e>1?s:2*s+2*t,tileSize:n}}{const s=(i-4*t)/4,o=75-t;return{height:0===e?U:o,width:0===e?2*s:s,tileSize:n}}}_getItemIconSize(e){let t=x.IconSize.size24;return e!==N.ExtraLarge&&e!==N.Large||(t=x.IconSize.size48),t}_getItemTitleStyle(e){return e===N.ExtraLarge?[F.default.fontStyle.panelHeader,j.tileText]:[F.default.fontStyle.bodyBold,j.tileText]}_getItemSubtitleStyle(e){return e===N.ExtraLarge?[F.default.fontStyle.body,j.tileText]:[F.default.fontStyle.caption,j.tileText]}_getItemIcon(e,t,s){return n.createElement(n.View,{style:j.tileIcon},n.createElement(_.default,{icon:e,size:this._getItemIconSize(s),color:t}))}_getItemText(e,t,s){const i=this._getItemTitleStyle(s.tileSize),o=this._getItemSubtitleStyle(s.tileSize),r=n.Styles.createViewStyle({paddingHorizontal:10,paddingBottom:10,width:s.width},!1);return n.createElement(n.View,{style:[j.tileTextContainer,r]},n.createElement(n.Text,{style:i,numberOfLines:1},e),n.createElement(n.Text,{style:o,numberOfLines:1},t))}_itemMargin(){return this.props.useRoundedCorners?z:H}_navigateToGallery(e){P.default.navigateToGallery(this.props.conversationId,e,this._getContext())}}t.default=G},80115:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(98278),n=s(15877),r=s(15415),a=s(22222),l=s(81760),d=s(212),c=s(19675),h=s(63841),u=s(97634),p=(0,n.lazyProperties)({statusContainer:()=>i.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"center"}),statusTextTop:()=>i.Styles.createTextStyle({color:l.Color.white,marginBottom:12,backgroundColor:l.Color.transparent}),statusTextBottom:()=>i.Styles.createTextStyle({color:l.Color.white,backgroundColor:l.Color.transparent,textAlign:"center",marginHorizontal:44}),button:()=>i.Styles.createButtonStyle({flex:0,alignSelf:"stretch",marginBottom:20,marginHorizontal:35})});t.default=class{static renderStatus(e,t,s){const o=d.default.themeStylesForTheme(s||h.Theme.ColorfulDark);return i.createElement(i.View,{style:[p.statusContainer,o.primaryBackgroundColorStyle]},i.createElement(c.PanelHeader,{style:[p.statusTextTop,o.primaryTextColorStyle]},e),i.createElement(c.BodyText,{style:[p.statusTextBottom,o.primaryTextColorStyle]},t))}static renderStatusWithButton(e,t,s,n){const r=n||h.Theme.ColorfulDark,l=d.default.themeStylesForTheme(r);return i.createElement(i.View,{style:[p.statusContainer,l.primaryBackgroundColorStyle]},i.createElement(a.default,{style:p.button,onPress:t,title:e,buttonStyle:u.isDarkTheme(r)?o.SXButtonStyle.LightFill:o.SXButtonStyle.DarkFill}),i.createElement(c.BodyText,{style:[p.statusTextBottom,l.primaryTextColorStyle]},s))}static renderLoadingStatus(e){const t=e||p.statusContainer;return i.createElement(i.View,{style:t},i.createElement(r.default,{tintColor:l.Color.gray300,size:o.SXActivityIndicatorSize.Medium,useRXIndicator:!0}))}}},97647:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(34828),n=s(16778),r=s(71830),a=s(984),l=s(82146),d=s(16402),c=s(70891),h=s(80115),u=s(72759),p=s(15877),g=s(33754),m=s(17093),S=s(32226),f=s(36150),y=s(67806),_=s(81760),v=s(19675),C=s(24576),b="spacerForTabBar",T="bottomSpacer",M="g_",I="d_",w=(0,p.lazyProperties)({panel:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),pannelPadding:()=>n.Styles.createViewStyle({paddingTop:90}),dateHeaderText:()=>n.Styles.createTextStyle({marginLeft:10,marginTop:16}),dateHeaderTextCompositeNav:()=>n.Styles.createTextStyle({marginLeft:4}),topSpacer:()=>n.Styles.createViewStyle({height:80,flex:0,backgroundColor:_.Color.transparent}),bottomSpacer:()=>n.Styles.createViewStyle({height:20,flex:0,backgroundColor:_.Color.transparent})});class P extends C.default{constructor(){super(...arguments),this._lastScrollTop=0,this._hasRenderedLastItem=!1,this._getListView=()=>this._listView,this._onListViewRef=e=>{this._listView=e||void 0},this._onScroll=(e,t)=>{if(e>=this._lastScrollTop&&this._hasRenderedLastItem){let e=l.RetrievalMask.All;switch(this.props.viewMode){case m.GalleryViewMode.Media:e=l.RetrievalMask.Media;break;case m.GalleryViewMode.Files:e=l.RetrievalMask.Files;break;case m.GalleryViewMode.Links:e=l.RetrievalMask.Links}l.default.fetchMoreMessages(this.props.conversationId,e)}const s=this._lastScrollTop>1;this.isComponentMounted()&&this.state.scrolled!==s&&this.setState({scrolled:s}),this._lastScrollTop=e},this._renderItem=(e,t)=>{if(i.isUndefined(e.index))return[];if(this._hasRenderedLastItem=e.index>=this.state.galleryItemResults.length-10,e.key===b)return n.createElement(n.View,{style:w.topSpacer});if(e.key===T)return n.createElement(n.View,{style:w.bottomSpacer});const s=e.key.substr(0,2);if(s===M){const t=this.state.galleryItemResults[e.index];return n.createElement(y.StreamItem,{message:t,isFirstInGroup:!0,isLastInGroup:!0,isLastMessage:!0,isReadOnly:!1,isLastPhotoByCurrentUser:!1,renderOrigin:c.MessageRenderOrigin.StackGalleryCanvas,isConversationAccepted:this.state.isConversationAccepted,disableSelectMultipleMessages:!0,disableReactions:!0,getRootWindowComponent:this._getListView})}if(s===I){const t=[w.dateHeaderText];return this.props.isUsingStackNavigationContext||t.push(w.dateHeaderTextCompositeNav),n.createElement(v.Subtitle,{style:t},d.default.getDisplayDateString(parseInt(e.key.substr(2),10)))}return n.createElement(n.View,null)}}_buildState(e,t){let s={};s.is1on1Conversation=!r.isThread(e.conversationId),s.isConnectedToNetwork=S.default.isConnected(),s.isConversationAccepted=a.default.isConversationAccepted(e.conversationId),s.isMobileScreenReaderEnabled=e.isUsingStackNavigationContext&&f.default.isMobileScreenReaderEnabled();let o,c=[],h=[],u=l.RetrievalState.None,p=200;switch(e.viewMode){case m.GalleryViewMode.Media:break;case m.GalleryViewMode.Files:h=l.default.getFilesForConversation(e.conversationId,Date.now(),10,t,!0),u=l.default.getFilesRetrievalState(e.conversationId),p=200;break;case m.GalleryViewMode.Links:h=l.default.getLinksForConversation(e.conversationId,Date.now(),10,t,!0),u=l.default.getLinksRetrievalState(e.conversationId),p=200}return e.displayTabBar&&!s.isMobileScreenReaderEnabled&&c.push({key:b,height:80,template:"gil_spacer",isNavigable:!1}),i.each(h,((e,t)=>{o&&d.default.isSameDay(o,e.createdTime)||(o=e.createdTime,c.push({key:I+o,height:36,index:t,template:"gil_dateItem",isNavigable:!1})),c.push({key:M+e.cuid,height:p,template:"gil_media",index:t,measureHeight:!0,accessibilityTrait:n.Types.AccessibilityTrait.Button})})),h.length>0&&c.push({key:T,height:20,template:"gil_spacer",isNavigable:!1}),s.galleryItemList=c,s.galleryItemResults=h,s.retrievalState=u,t&&(s.scrolled=!1),s}render(){const e=this._renderStatus(),t=e?null:n.createElement(o.VirtualListView,{key:"gallery"+this.props.viewMode,ref:this._onListViewRef,style:w.panel,itemList:this.state.galleryItemList,renderItem:this._renderItem,animateChanges:!1,keyboardDismissMode:"on-drag",keyboardShouldPersistTaps:!0,clickOnEnterPress:!1,horizontalPadding:this.props.safeAreaHorizontalInsets,onScroll:this._onScroll});if(this.props.displayTabBar){const s=[w.panel];return this.state.isMobileScreenReaderEnabled&&s.push(w.pannelPadding),n.createElement(n.View,{style:s},e||t,n.createElement(u.default,{viewMode:this.props.viewMode,onTabSelected:this.props.onTabSelected,scrolled:this.state.scrolled}))}return e||t}_renderStatus(){if(!this.state.isConnectedToNetwork){if(this.state.galleryItemResults.length)return;{let e;switch(this.props.viewMode){case m.GalleryViewMode.Media:break;case m.GalleryViewMode.Files:e=g.getString("GalleryMediaPanel.NoConnectionFiles");break;case m.GalleryViewMode.Links:e=g.getString("GalleryMediaPanel.NoConnectionLinks")}return h.default.renderStatus(g.getString("GalleryMediaPanel.NoConnection"),e,this._currentTheme)}}if(this.state.retrievalState===l.RetrievalState.Retrieving&&this.props.isUsingStackNavigationContext)return h.default.renderLoadingStatus();if(this.state.retrievalState===l.RetrievalState.Failed)return h.default.renderStatus(g.getString("GalleryMediaPanel.FailureTopStatus"),g.getString("GalleryMediaPanel.FailureBottomStatus"),this._currentTheme);if(0===this.state.galleryItemResults.length){let e;switch(this.props.viewMode){case m.GalleryViewMode.Media:break;case m.GalleryViewMode.Files:e=g.getString("GalleryMediaPanel.NoFilesStatus");break;case m.GalleryViewMode.Links:e=g.getString("GalleryMediaPanel.NoLinksStatus")}return h.default.renderStatus(g.getString("GalleryMediaPanel.NoContentStatus"),e,this._currentTheme)}}}t.default=P},7044:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(47447),r=(s(14920),s(14980),s(82146)),a=s(70891),l=s(46096),d=s(61317),c=s(53559),h=s(80115),u=s(72759),p=s(17873),g=s(85433),m=s(66649),S=s(15877),f=s(33754),y=s(18743),_=s(68080),v=s(18078),C=s(32226),b=s(85207),T=s(81115),M=s(15963),I=s(36150),w=s(86045),P=s(750),k=s(81760),A=s(24576),E=(0,S.lazyProperties)({container:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"stretch",backgroundColor:k.Color.transparent}),gridStackNav:()=>o.Styles.createViewStyle({paddingTop:90}),gridCompositeNav:()=>o.Styles.createViewStyle({paddingHorizontal:10}),gridCompositeNavWithTabBar:()=>o.Styles.createViewStyle({paddingTop:90})});class R extends A.default{constructor(){super(...arguments),this._lastScrollTop=0,this._onGridViewRef=e=>{this._gridView=e||void 0},this._onScroll=(e,t)=>{e>=this._lastScrollTop&&r.default.fetchMoreMessages(this.props.conversationId,r.RetrievalMask.Media),this.isComponentMounted()&&this.setState({scrolled:this._lastScrollTop>1}),this._lastScrollTop=e},this._onSharePhotoButtonPress=e=>{n.UICapabilities.desktopFilePickerSupported()&&d.FilePickerUtils.showMultiFilesPicker((e=>{const t=c.default.extractFileExtension(e.file.name);let s;if(c.default.isVideoExtension(t)){const t={name:M.ScenarioName.SendVideo};s=b.default.postVideoWithThumbnail([this.props.conversationId],e,l.PostSource.Gallery,!1,t)}else if(c.default.isImageExtension(t)){const t={name:M.ScenarioName.SendPicture};s=b.default.postUpload([this.props.conversationId],e,l.PostSource.Gallery,!1,{scenarioInfo:t})}else{const t={name:M.ScenarioName.SendFile};s=b.default.postUpload([this.props.conversationId],e,l.PostSource.Gallery,!1,{scenarioInfo:t})}s.then((()=>{w.default.maybeAnnounceForAccessibility(f.getString("MessageComposer.FileSentLabel"))}))}),y.FilePickerOrigin.GalleryMediaList,void 0,this._getRootViewId(),e)},this._onMediaItemPress=e=>{let t={};i.each(this.state.mediaResultsAsMessages,(e=>{const s=this._getMediaNode(e.cuid);s&&(t[e.cuid]={component:s})})),p.default.potentiallyMarkItemViewed(e,a.MessageRenderOrigin.StackGalleryCanvas),_.default.showWithMessageConfig({initialMessage:e,animateOpenClose:!0,reverseOrder:!1,rootViewId:this._getRootViewId(),onClose:()=>{this.isComponentMounted()&&this.forceUpdate()},getContentNode:e=>{const t=this._getMediaNode(e);return t?{component:t}:void 0},origin:l.NavigationMediaViewerOrigin.Gallery})},this._getMessageActions=e=>{const t=[P.CommandTypes.Forward,P.CommandTypes.SaveMedia,P.CommandTypes.ViewInChat];return v.default.isMyMri(e.creator)&&t.push(P.CommandTypes.Remove),{actionMenuCommands:t,outerButtonCommands:[]}}}_buildState(e,t){return{mediaResultsAsMessages:r.default.getMediaForConversation(e.conversationId,Date.now(),15,t,!0),retrievalState:r.default.getMediaRetrievalState(e.conversationId),isConnectedToNetwork:C.default.isConnected(),disableHighBandwidthOperations:m.default.isUsingGogoNetwork(),isMobileScreenReaderEnabled:I.default.isMobileScreenReaderEnabled(),scrolled:!1}}render(){const e=this._renderStatus(),t=[];if(this.props.isUsingStackNavigationContext)this.props.displayTabBar&&!this.state.isMobileScreenReaderEnabled&&t.push(E.gridStackNav);else{const e=[E.gridCompositeNav];this.props.displayTabBar&&e.push(E.gridCompositeNavWithTabBar),t.push(e)}this.props.safeAreaHorizontalInsets&&T.default.hasHorizontalSafeAreas(this.props.safeAreaHorizontalInsets)&&t.push(T.default.horizontalPaddingStyle(this.props.safeAreaHorizontalInsets));const s=e?void 0:o.createElement(g.default,{ref:this._onGridViewRef,contentStyles:t,mediaMessages:this.state.mediaResultsAsMessages,showCreatorOnThumbnails:!0,showVideoMediaTypeIcon:!0,onGridItemPress:this._onMediaItemPress,thumbnailsPerRow:this.props.isUsingStackNavigationContext?3:4,itemBorderRadius:0,thumbnailPadding:0,showThumbnailOverlay:!0,thumbnailIconsSize:40,getMessageActions:this._getMessageActions,onScroll:this._onScroll,renderOrigin:a.MessageRenderOrigin.StackGalleryCanvas});if(this.props.displayTabBar){const t=[E.container];return this.state.isMobileScreenReaderEnabled&&t.push(E.gridStackNav),o.createElement(o.View,{style:t},e||s,o.createElement(u.default,{viewMode:this.props.viewMode,onTabSelected:this.props.onTabSelected,scrolled:this.state.scrolled}))}return o.createElement(o.View,{style:E.container},e||s)}_renderStatus(){return this.state.isConnectedToNetwork?this.state.retrievalState===r.RetrievalState.Retrieving&&this.props.isUsingStackNavigationContext?h.default.renderLoadingStatus():this.state.retrievalState===r.RetrievalState.Failed?h.default.renderStatus(f.getString("GalleryMediaPanel.FailureTopStatus"),f.getString("GalleryMediaPanel.FailureBottomStatus"),this._currentTheme):0===this.state.mediaResultsAsMessages.length?this.state.disableHighBandwidthOperations?h.default.renderStatus(f.getString("GalleryMediaPanel.NoContentStatus"),f.getString("GalleryMediaPanel.NoMediaStatus"),this._currentTheme):h.default.renderStatusWithButton(f.getString("GalleryMediaPanel.NoMediaButtonLabel"),this._onSharePhotoButtonPress,f.getString("GalleryMediaPanel.NoMediaStatus")):void 0:this.state.mediaResultsAsMessages.length?void 0:h.default.renderStatus(f.getString("GalleryMediaPanel.NoConnection"),f.getString("GalleryMediaPanel.NoConnectionMedia"),this._currentTheme)}_getMediaNode(e){if(this._gridView)return this._gridView.getMediaNode(e)}}t.default=R},72759:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(88837),n=s(31652),r=s(15877),a=s(33754),l=s(17093),d=s(81760),c=s(11828),h=s(19675),u=(0,r.lazyProperties)({tabBar:()=>i.Styles.createViewStyle({flex:0,height:80,position:"absolute",top:10,left:0,right:0,backgroundColor:d.Color.transparent,flexDirection:"row",justifyContent:"center",alignItems:"center"}),tabBarLabel:()=>i.Styles.createTextStyle({textAlign:"center",marginTop:1}),tabLabelScrolled:()=>i.Styles.createTextStyle({opacity:0})});class p extends o.ComponentBase{constructor(){super(...arguments),this._onMediaTabPress=e=>{e.stopPropagation(),this.props.viewMode!==l.GalleryViewMode.Media&&this.props.onTabSelected&&this.props.onTabSelected(l.GalleryViewMode.Media)},this._onFilesTabPress=e=>{e.stopPropagation(),this.props.viewMode!==l.GalleryViewMode.Files&&this.props.onTabSelected&&this.props.onTabSelected(l.GalleryViewMode.Files)},this._onLinksTabPress=e=>{e.stopPropagation(),this.props.viewMode!==l.GalleryViewMode.Links&&this.props.onTabSelected&&this.props.onTabSelected(l.GalleryViewMode.Links)}}render(){const e=i.createElement(n.default,{icon:c.SkypeIcon.Media,label:a.getString("GalleryTabBar.MediaTabButtonLabel"),selected:this.props.viewMode===l.GalleryViewMode.Media,onTabButtonPress:this._onMediaTabPress,tabPosition:0,totalTabs:3}),t=i.createElement(n.default,{icon:c.SkypeIcon.Link,label:a.getString("GalleryTabBar.LinksTabButtonLabel"),selected:this.props.viewMode===l.GalleryViewMode.Links,onTabButtonPress:this._onLinksTabPress,tabPosition:1,totalTabs:3}),s=i.createElement(n.default,{icon:c.SkypeIcon.FileMultiple,label:a.getString("GalleryTabBar.FilesTabButtonLabel"),selected:this.props.viewMode===l.GalleryViewMode.Files,onTabButtonPress:this._onFilesTabPress,tabPosition:2,totalTabs:3}),o=[u.tabBarLabel];this.props.scrolled&&o.push(u.tabLabelScrolled);const r=i.createElement(h.Caption,{style:o,selected:this.props.viewMode===l.GalleryViewMode.Media},a.getString("GalleryTabBar.MediaTabButtonLabel")),d=i.createElement(h.Caption,{style:o,selected:this.props.viewMode===l.GalleryViewMode.Links},a.getString("GalleryTabBar.LinksTabButtonLabel")),p=i.createElement(h.Caption,{style:o,selected:this.props.viewMode===l.GalleryViewMode.Files},a.getString("GalleryTabBar.FilesTabButtonLabel"));return i.createElement(i.View,{style:u.tabBar},i.createElement(i.View,null,e,r),i.createElement(i.View,null,t,d),i.createElement(i.View,null,s,p))}}t.default=p},31652:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(88837),n=s(4736),r=s(11930),a=(0,s(15877).lazyProperties)({button:()=>i.Styles.createButtonStyle({marginHorizontal:5})});class l extends o.ComponentBase{constructor(){super(...arguments),this._onClickButton=e=>{this.props.onTabButtonPress&&this.props.onTabButtonPress(e)}}render(){const e=r.default.tabAccessibilityLabel(this.props.label,this.props.tabPosition,this.props.totalTabs),t=r.default.tabAccessibilityTraits(this.props.selected);return i.createElement(n.default,{style:a.button,icon:this.props.icon,title:this.props.label,deselected:!this.props.selected,accessibilityLabel:e,accessibilityTraits:t,onPress:this._onClickButton})}}t.default=l},41639:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(63297),n=s(2604),r=s(16778),a=s(4736),l=s(38566),d=s(20948),c=s(90247),h=s(16402),u=s(46096),p=s(13944),g=s(36237),m=s(15877),S=s(33754),f=s(18743),y=s(65822),_=s(89808),v=s(81736),C=s(64956),b=s(15963),T=s(86045),M=s(62232),I=s(81760),w=s(11010),P=s(11828),k=s(78262),A=s(80837),E=s(24576),R=s(53374),L=(0,m.lazyProperties)({container:()=>r.Styles.createViewStyle({height:89,alignItems:"center",flex:1}),progress:()=>r.Styles.createViewStyle({alignSelf:"stretch",height:8,backgroundColor:I.Color.gray100Overlay30}),progressBar:()=>A.default.absoluteFill,messageWrapper:()=>r.Styles.createViewStyle({flexDirection:"column",justifyContent:"flex-start",flex:1}),message:()=>r.Styles.createTextStyle({flexDirection:"column",justifyContent:"flex-start",font:w.default.font.uiDisplayRegular,fontSize:w.default.fontSize.size17,flex:1,paddingHorizontal:16,paddingVertical:12}),messageTimeMaxedOut:()=>r.Styles.createTextStyle({color:I.Color.blue}),innerContainer:()=>r.Styles.createViewStyle({paddingRight:16,paddingLeft:4,flexDirection:"row",alignSelf:"stretch",alignItems:"center",flex:1,justifyContent:"space-between"}),cancelButton:()=>r.Styles.createViewStyle({height:P.IconSize.default,width:P.IconSize.size32}),sendButton:()=>r.Styles.createButtonStyle({borderRadius:P.IconSize.default/2,height:P.IconSize.default,width:P.IconSize.default}),desktopOverrides:()=>(0,m.lazyProperties)({container:()=>r.Styles.createViewStyle({height:50,alignItems:"center",flex:1,flexDirection:"row"}),innerContainer:()=>r.Styles.createViewStyle({borderRadius:25,paddingRight:10,paddingLeft:6}),progress:()=>r.Styles.createViewStyle({marginRight:8,marginLeft:6,flexShrink:0,flexGrow:1,alignSelf:"center",backgroundColor:I.Color.gray300Overlay70}),messageWrapper:()=>r.Styles.createViewStyle({flexGrow:0}),message:()=>r.Styles.createTextStyle({paddingHorizontal:10,fontSize:w.default.controlFontSize.tabHeader}),sendButton:()=>r.Styles.createButtonStyle({marginLeft:5,width:40,height:40}),cancelButton:()=>r.Styles.createViewStyle({width:40,height:40,borderRadius:20})})});class F extends E.default{constructor(){super(...arguments),this._progressBarWidth=0,this._progressBarAnimatedValue=new r.Animated.Value(0),this._progressBarAnimatedStyle=r.Styles.createAnimatedViewStyle({width:this._progressBarAnimatedValue}),this._audioManagerClient=new l.default(l.AudioManagerSource.AudioMessageComposer),this._onLayoutChanges=e=>{this._progressBarWidth=e.width},this._onCancelRecording=()=>{T.default.maybeAnnounceForAccessibility(S.getString("AudioMessageComposer.AudioMessageCancelled")),this.props.onDone(),g.track(new f.AudioMessageCancelEvent)},this._onSendRecording=()=>{const e=R.default.newCauseId();switch(g.log(u.LogTraceArea.AudioMessageComposer,"_onSendRecording causeId: "+e),c.default.getRecordingStateNoSubscription()){case c.RecordingState.StartingMic:case c.RecordingState.Recording:c.default.stopRecording();break;case c.RecordingState.None:return void g.error(u.LogTraceArea.AudioMessageComposer,"Cannot send audio message: not recording audio")}d.postAudio(this.props.conversationId,b.ScenarioName.SendAudioMessage).then((()=>{c.default.reset(),T.default.maybeAnnounceForAccessibility(S.getString("AudioMessageComposer.AudioMessageSent")),T.default.isMobileScreenReaderEnabled()?(M.default.SkypeMessageSent.playOnce(e),i.delay((()=>this.props.onDone()),1500)):this.props.onDone()}))},this._resetRecording=e=>{c.default.reset(),this._audioManagerClient.release(e)},this._startRecording=e=>{if(this._playerToken=y.default.registerAsPlayer(),this.state.microphonePermissionStatus===n.PermissionStatus.Granted){const t=T.default.isMobileScreenReaderEnabled()?o.AudioModes.CallPreferSpeaker:o.AudioModes.RecordAudioMessage;this._audioManagerClient.requestMode(t,e).then((e=>{e&&this.isComponentMounted()&&(y.default.setAsActive(this._playerToken),c.default.startRecording(250))}))}else this.state.microphonePermissionStatus===n.PermissionStatus.Unknown&&v.default.requestPermission(k.PermissionType.Microphone,k.PermissionPromptOptions.SkipPrePrompt).then((e=>{e===n.PermissionStatus.Granted&&(this.setState({microphonePermissionStatus:e}),c.default.startRecording(250))}))}}_buildState(e,t){const s=c.default.getRecordingState();return{elapsedRecordingTimeMs:c.default.getElapsedTimeMs(),recordingError:c.default.getRecordingError(),microphonePermissionStatus:v.default.permissionStatus(k.PermissionType.Microphone),sendDisabled:!i.includes([c.RecordingState.Recording,c.RecordingState.HasAudio],s),isRecording:s===c.RecordingState.Recording,isStartingMic:s===c.RecordingState.StartingMic}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);const i=R.default.newCauseId();g.log(u.LogTraceArea.AudioMessageComposer,"componentDidUpdate causeId:",i);const o=c.default.getRecordingState(),n=c.default.getRecordingError();if(o===c.RecordingState.Recording)if(this.state.elapsedRecordingTimeMs>=this.props.maxRecordingTimeMs){c.default.stopRecording(),this._progressBarAnimatedValue.setValue(this._progressBarWidth);const e=S.getString("AudioMessageComposer.RecordingFinishedAccessibiltyAnnouncement");T.default.maybeAnnounceForAccessibility(e)}else{const e=this.state.elapsedRecordingTimeMs/this.props.maxRecordingTimeMs;this._progressBarAnimatedValue.setValue(Math.abs(this._progressBarWidth*e))}else n!==c.RecordingError.StartFailed&&n!==c.RecordingError.StopFailed||this._audioManagerClient.release(i)}componentDidMount(){super.componentDidMount();const e=R.default.newCauseId();g.log(u.LogTraceArea.AudioMessageComposer,"componentDidMount causeId:",e),this._startRecording(e)}componentWillUnmount(){super.componentWillUnmount();const e=R.default.newCauseId();g.log(u.LogTraceArea.AudioMessageComposer,"componentWillUnmount causeId:",e),this._resetRecording(e)}render(){let e;if(this.state.microphonePermissionStatus!==n.PermissionStatus.Granted)this.state.microphonePermissionStatus===n.PermissionStatus.Denied&&C.default.showDeniedPromptWithSettingsOption(k.PermissionType.Microphone,this._getRootViewId()),e=S.getString("AudioMessageComposer.NoMicrophoneAccess");else switch(this.state.recordingError){case c.RecordingError.None:break;case c.RecordingError.StartFailed:case c.RecordingError.StopFailed:e=S.getString("AudioMessageComposer.RecordingFailed");break;default:g.error(u.LogTraceArea.AudioMessageComposer,"Unhandled recording error case"+this.state.recordingError)}{const t=[L.innerContainer,L.desktopOverrides.innerContainer];return this._themeStyles.messageComposerBackgroundStyle&&t.push(this._themeStyles.messageComposerBackgroundStyle),r.createElement(r.View,{style:L.desktopOverrides.container},r.createElement(r.View,{style:t},this._getCancelButton(),this._getProgressBar(),this._getTimerElement(e)),this._getSendButton(e))}}_getSendButton(e){const t=[L.sendButton];return t.push(L.desktopOverrides.sendButton),r.createElement(a.default,{size:a.ActionButtonSize.Small,title:S.getString("AudioMessageComposer.SendButtonTitle"),onPress:this._onSendRecording,style:t,icon:P.SkypeIcon.Send,disabled:!i.isEmpty(e)||this.state.sendDisabled,flipIcon:this._getContext().isRTL,autoFocus:!0})}_getTimerElement(e){let t=e;if(!t){const e=Math.round(this.state.elapsedRecordingTimeMs/1e3),s=h.default.getElapsedTimePartsFromS(e);t=S.getString("AccessibilityLabel.NumberOfMinutesSecondsRecorded",{minuteCount:s.minutes,secondCount:s.seconds})}const s=[L.message,this._themeStyles.primaryTextColorStyle];return s.push(L.desktopOverrides.message),this.state.elapsedRecordingTimeMs>=this.props.maxRecordingTimeMs&&s.push(L.messageTimeMaxedOut),r.createElement(r.View,{accessibilityLabel:t,importantForAccessibility:r.Types.ImportantForAccessibility.Yes,style:L.desktopOverrides.messageWrapper},r.createElement(r.Text,{style:s,numberOfLines:2,importantForAccessibility:r.Types.ImportantForAccessibility.No},e||h.default.getElapsedTimeStringFromMs(this.state.elapsedRecordingTimeMs)))}_getCancelButton(){const e=[L.cancelButton];return e.push(L.desktopOverrides.cancelButton),r.createElement(p.default,{title:S.getString("AudioMessageComposer.CancelButtonTitle"),disabled:this.state.isStartingMic,onPress:this._onCancelRecording,size:P.IconSize.size20,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,hoverStyle:this._themeStyles.buttonBackgroundHoverColorStyle,style:e,icon:P.SkypeIcon.Cancel})}_getProgressBar(){const e=[L.progress];return e.push(L.desktopOverrides.progress),r.createElement(r.View,{style:e,onLayout:this._onLayoutChanges},r.createElement(r.Animated.View,{style:[L.progressBar,this._progressBarAnimatedStyle,_.default.getBackgroundColorStyleNoSubscription()]}))}}t.default=F},20490:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(44770),n=s(15877),r=s(33754),a=s(24576),l=(0,n.lazyProperties)({container:()=>i.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"center",paddingHorizontal:30}),image:()=>i.Styles.createImageStyle({width:142,height:132}),paragraph:()=>i.Styles.createTextStyle({marginTop:40,marginBottom:20}),paragraphCommon:()=>i.Styles.createTextStyle({textAlign:"center"})});class d extends a.default{render(){const e=this.props.isUsingStackNavigationContext?r.getString("BookmarksConversation.SecondParagraphMobile"):r.getString("BookmarksConversation.SecondParagraphDesktop");return i.createElement(i.View,{style:l.container},i.createElement(i.Image,{style:l.image,source:o.Collection.BOOKMARKS_EMPTY_STATE}),i.createElement(i.Text,{style:[this._themeStyles.secondaryTextColorStyle,l.paragraph,l.paragraphCommon]},r.getString("BookmarksConversation.FirstParagraph")),i.createElement(i.Text,{style:[this._themeStyles.secondaryTextColorStyle,l.paragraphCommon]},e))}}t.default=d},54549:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(71830),r=s(47204),a=s(984),l=s(39549),d=s(65947),c=s(13944),h=s(28234),u=s(4794),p=s(52461),g=s(7705),m=s(26448),S=s(15877),f=s(33754),y=s(98401),_=s(78735),v=s(81760),C=s(11828),b=s(79669),T=s(24576),M=(0,S.lazyProperties)({popupInnerView:()=>o.Styles.createViewStyle({minWidth:210}),buttonWithBackground:()=>o.Styles.createViewStyle({borderRadius:20,width:40,height:40,marginLeft:4}),redDot:()=>o.Styles.createViewStyle({width:10,height:10,borderRadius:5,backgroundColor:v.Color.red,position:"absolute",right:0,top:0})});class I extends T.default{constructor(){super(...arguments),this._onMoreButtonPress=e=>{this._openMorePopup(),this.state.shouldShowRedDot&&(_.default.setUserPreferencesLocal({showComposerPopupMenuIndicator:!1}),this.setState({shouldShowRedDot:!1})),this.props.onOverflowButtonPress&&this.props.onOverflowButtonPress(e)},this._onMoreButtonRef=e=>{this._moreButtonRef=e||void 0},this._openMorePopup=()=>{const e=g.default.filterIntegrations(i.values(this.state.allIntegrations),this._getIntegrationFilters()),t={getAnchor:()=>this._moreButtonRef,renderPopup:(t,s,i,n)=>o.createElement(b.default,{anchorPosition:t,anchorOffset:s,popupWidth:i,popupHeight:n,fillColor:this._themeColors.popoverBackgroundColor,strokeColor:this._useDarkTheme()?this._themeColors.popupBorderColor:void 0,skipPopupAutoFocus:!0,borderRadius:10},o.createElement(o.View,{style:M.popupInnerView},o.createElement(u.default,{conversationId:this.props.conversationId,hideAddInsTitle:!0,isInline:!0,onIntegrationPress:this._onIntegrationPress,overflowActionConfig:this.props.overflowConfig,otherPartyMri:this.props.otherPartyMri,filteredIntegrations:e}))),positionPriorities:["top","bottom"],dismissIfShown:!0,rootViewId:this._getRootViewId(),onDismiss:this._onPopupDismiss};r.default.showPopup(t,"composerPopup"),this.setState({isPopupOpened:!0})},this._onPopupDismiss=()=>{this.setState({isPopupOpened:!1})},this._onIntegrationPress=e=>{d.default.openIntegration(e,this.props.conversationId,this._getContext(),void 0,void 0,void 0)},this._filterBing=e=>e.id!==h.IntegrationIds.Bing,this._filterHidden=e=>!e.hideInFindPanel,this._filterConnectors=e=>!m.default.isConnectorIntegration(e)||n.isGroupConversation(this.props.conversationId)}_buildState(e,t){const s=g.default.getProxiedIntegrations(i.compact(p.default.getIntegrations()));let o={};i.each(s,(e=>{o[e.id]=e}));let n={shouldShowRedDot:_.default.getUserPreferencesLocal().showComposerPopupMenuIndicator&&y.default.isAnyMediaBarItemNew(e.overflowConfig.mediaBarItems),allIntegrations:o};const r=(0,l.default)().getConversation(e.conversationId);return r&&(n.conversation=r,n.isConversationAccepted=!!r&&a.default.isConversationAccepted(r.id)),n}render(){const e=g.default.filterIntegrations(i.values(this.state.allIntegrations),this._getIntegrationFilters());if(i.isEmpty(this.props.overflowConfig.mediaBarItems)&&i.isEmpty(e))return null;let t=[M.buttonWithBackground,this._themeStyles.buttonBackgroundColorStyle];const s=this.state.shouldShowRedDot?o.createElement(o.View,{style:M.redDot}):void 0;return this.state.isPopupOpened&&t.push(this._themeStyles.buttonBackgroundHoverColorStyle),o.createElement(o.View,null,o.createElement(c.default,{color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,icon:C.SkypeIcon.More,size:C.IconSize.size20,style:t,hoverStyle:this._themeStyles.buttonBackgroundHoverColorStyle,accessibilityLabel:f.getString("Global.MoreOptions"),onPress:this._onMoreButtonPress,ref:this._onMoreButtonRef}),s)}_getIntegrationFilters(){return[this._filterBing,this._filterConnectors,this._filterHidden]}}t.default=I},3326:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(11930),n=s(74313),r=s(15877),a=s(81760),l=s(11828),d=s(24576),c=l.IconSize.size20,h=(0,r.lazyProperties)({button:()=>i.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"flex-start",minHeight:44}),iconAltView:()=>i.Styles.createViewStyle({height:c,width:c,borderRadius:10,backgroundColor:a.Color.gray100}),icon:()=>i.Styles.createImageStyle({height:c,width:c,borderRadius:10,justifyContent:"center",alignItems:"center"}),iconContainer:()=>i.Styles.createButtonStyle({height:c,width:c,justifyContent:"center",alignItems:"center",marginHorizontal:12}),buttonTitle:()=>i.Styles.createTextStyle({width:150,lineHeight:18,overflow:"visible"})});class u extends d.default{constructor(){super(...arguments),this._onHoverStart=()=>{this.isComponentMounted&&this.setState({isHovering:!0})},this._onHoverEnd=()=>{this.isComponentMounted&&this.setState({isHovering:!1})},this._onPress=()=>{this.props.onIntegrationPress(this.props.integration)}}_buildState(e,t){let s={};return t&&(s.isHovering=!1),s}render(){const e=i.createElement(i.View,{style:h.iconAltView});let t=i.createElement(n.default,{origin:"IntegrationsView",altView:e,style:h.icon,containerStyle:h.iconContainer,source:this.props.integration.icon,resizeMode:"cover"}),s=[h.button];this.state.isHovering&&s.push(this._themeStyles.rowHoverViewStyle);const r=this.props.integration.name,a=this.props.integration.description;return i.createElement(i.Button,{accessibilityLabel:o.default.combinedAccessibilityLabel(r,a),style:s,onPress:this._onPress,onHoverStart:this._onHoverStart,onHoverEnd:this._onHoverEnd},t,i.createElement(i.Text,{style:[this._themeStyles.primaryTextColorStyle,h.buttonTitle]},r))}}t.default=u},94814:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(11930),n=s(15877),r=s(98401),a=s(39320),l=s(80837),d=s(24576),c=(0,n.lazyProperties)({button:()=>i.Styles.combine(i.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"flex-start",minHeight:44}),l.default.pointerCursor),buttonTitle:()=>i.Styles.createTextStyle({width:150,lineHeight:18,overflow:"visible"}),buttonTitleWithLabel:()=>i.Styles.createTextStyle({width:138,paddingRight:5}),mediaBarIconContainer:()=>i.Styles.createButtonStyle({marginHorizontal:4}),newLabel:()=>i.Styles.createButtonStyle({flex:1,marginRight:15})});class h extends d.default{constructor(){super(...arguments),this._onHoverStart=()=>{this.isComponentMounted&&this.setState({isHovering:!0})},this._onHoverEnd=()=>{this.isComponentMounted&&this.setState({isHovering:!1})},this._onFocus=()=>{this.isComponentMounted&&this.setState({isFocused:!0})},this._onBlur=()=>{this.isComponentMounted&&this.setState({isFocused:!1})},this._onMediaBarPress=(e,t)=>{this.props.onMediaBarItemPress(e,t)},this._onMediaBarKeyPress=(e,t)=>{this.props.onMediaBarItemKeyPress(e,t)}}_buildState(e,t){let s={};return t&&(s.isHovering=!1,s.isFocused=!1,s.isNewItem=r.default.isMediaBarItemNew(e.mediaBarItem.id)),s}componentWillUnmount(){super.componentWillUnmount(),this.state.isNewItem&&r.default.setMediaBarItemAsSeen(this.props.mediaBarItem.id)}render(){const e=this.props.mediaBarItem.render(this.props.mediaBarItemProps),t=r.default.getMediaBarItemTitle(this.props.mediaBarItem.id),s=r.default.getMediaBarItemDescription(this.props.mediaBarItem.id),n=[c.button];(this.state.isHovering||this.state.isFocused)&&n.push(this._themeStyles.rowHoverViewStyle);const l=[this._themeStyles.primaryTextColorStyle,c.buttonTitle];return this.state.isNewItem&&l.push(c.buttonTitleWithLabel),i.createElement(i.View,{accessibilityLabel:o.default.combinedAccessibilityLabel(t,s),importantForAccessibility:i.Types.ImportantForAccessibility.Yes,accessibilityTraits:i.Types.AccessibilityTrait.Button,onPress:e=>this._onMediaBarPress(e,this.props.mediaBarItem),onKeyPress:e=>this._onMediaBarKeyPress(e,this.props.mediaBarItem),tabIndex:0,style:n,onMouseEnter:this._onHoverStart,onMouseLeave:this._onHoverEnd,onFocus:this._onFocus,onBlur:this._onBlur},i.createElement(i.View,{style:c.mediaBarIconContainer},e),i.createElement(i.Text,{style:l},t),this.state.isNewItem&&i.createElement(a.default,{style:c.newLabel})||void 0)}}t.default=h},38386:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(74958),o=s(96486),n=s(31844),r=s(16778),a=s(44770),l=s(34339),d=s(89391),c=s(39119),h=s(63413),u=s(44279),p=s(71830),g=s(98278),m=s(984),S=s(23293),f=s(39549),y=s(52262),_=s(4604),v=s(46096),C=s(10117),b=s(36237),T=s(76391),M=s(15877),I=s(50556),w=s(47662),P=s(33754),k=s(4735),A=s(30124),E=s(53154),R=s(92210),L=s(16819),F=s(29130),x=s(14976),O=s(20486),D=s(38985),B=s(65988),V=s(4057),N=s(15415),U=s(22222),H=s(81760),z=s(11010),W=s(11828),j=s(59433),G=s(78262),K=s(80837),q=s(60305),Q=s(94050),X=s(19675),$=s(24576),J=s(82415),Y=s(2301),Z=s(67977),ee=s(72758),te="processingInviteLink",se=(0,M.lazyProperties)({contactInviteHeaderContainer:()=>r.Styles.createViewStyle({flex:1,alignItems:"center",borderBottomWidth:1,paddingBottom:20}),contactInviteHeaderContainerDesktop:()=>r.Styles.createViewStyle({justifyContent:"flex-start",flex:0}),userIcon:()=>r.Styles.createViewStyle({marginTop:20}),confirmationText:()=>r.Styles.createTextStyle({marginHorizontal:24,textAlign:"center"}),buttonContainer:()=>r.Styles.createViewStyle({flexDirection:"row",flex:0,alignSelf:"stretch",marginTop:20,marginHorizontal:24,justifyContent:"center"}),contactInviteButton:()=>r.Styles.createButtonStyle({height:60,flex:1,maxWidth:200}),contactInviteButtonHalfWidth:()=>r.Styles.createButtonStyle({flexBasis:0}),contactInviteButtonSpacer:()=>r.Styles.createButtonStyle({marginLeft:10}),annotationContainer:()=>r.Styles.createViewStyle({flex:0,flexDirection:"row",alignSelf:"stretch",marginHorizontal:16,marginTop:18,marginBottom:4,justifyContent:"center"}),annotationContainerColumn:()=>r.Styles.createViewStyle({alignSelf:"center",alignItems:"center",flexDirection:"column"}),annotationContainerColumnDesktop:()=>r.Styles.createViewStyle({alignSelf:"flex-start",alignItems:"flex-start",marginLeft:0}),annotationPart:()=>r.Styles.createViewStyle({flexDirection:"row",flex:-1,maxWidth:250}),annotationText:()=>r.Styles.createTextStyle({paddingLeft:4,flex:-1}),divider:()=>r.Styles.createViewStyle({flex:0,width:1,height:20,marginHorizontal:8}),pstnHeaderText:()=>r.Styles.createTextStyle({fontSize:z.default.controlFontSize.bodySmallDeprecated}),pstnImage:()=>r.Styles.createImageStyle({height:250,width:250}),pstnCtaButton:()=>r.Styles.createButtonStyle({minWidth:200,marginVertical:5,marginHorizontal:15}),pstnCtaButtonsContainer:()=>r.Styles.createViewStyle({justifyContent:"center"}),pstnCtaExplanationText:()=>r.Styles.createTextStyle({fontSize:z.default.controlFontSize.bodySmallDeprecated,marginVertical:5}),pstnCtaSeparatorText:()=>r.Styles.createTextStyle({marginVertical:10}),confirmationTextSmallViewSpacing:()=>r.Styles.createViewStyle({paddingTop:20}),experimentalInviteContainerDesktop:()=>r.Styles.createViewStyle({borderBottomWidth:1}),experimentalInviteBoxSection:()=>r.Styles.createViewStyle({marginTop:40,marginBottom:20,paddingVertical:15,paddingHorizontal:20,alignItems:"center",borderRadius:8}),experimentalInviteBoxSectionDesktop:()=>r.Styles.createViewStyle({width:360}),experimentalCommonMarginTop:()=>r.Styles.createViewStyle({marginTop:20}),experimentalInviteBoxSectionWide:()=>r.Styles.createViewStyle({width:440}),experimentalInviteBoxSectionMobile:()=>r.Styles.createViewStyle({marginTop:20,flex:1,alignSelf:"stretch",marginHorizontal:10}),experimentalInviteButton:()=>r.Styles.createViewStyle({minWidth:150,marginHorizontal:50,marginTop:20}),experimentalInviteButtonMobile:()=>r.Styles.createViewStyle({minWidth:100,alignSelf:"stretch"}),experimentalIncomingInviteButton:()=>r.Styles.createViewStyle({marginHorizontal:10,maxWidth:250}),experimentalInviteEmoticonContainer:()=>r.Styles.createViewStyle({marginBottom:20}),experimentalInviteText:()=>r.Styles.createTextStyle({paddingHorizontal:20,textAlign:"center"}),experimentalInviteAnnotationDivider:()=>r.Styles.createViewStyle({height:10}),experimentalInviteHeader:()=>r.Styles.createTextStyle({fontSize:20,textAlign:"center",flexShrink:1}),experimentalInviteButtonContainer:()=>r.Styles.createTextStyle({flexDirection:"row",flexWrap:"wrap",alignSelf:"stretch",justifyContent:"center"}),experimentalHeaderContainer:()=>r.Styles.createViewStyle({alignSelf:"stretch",justifyContent:"center",flex:1}),experimentalHeaderContainerDesktop:()=>r.Styles.createViewStyle({flexDirection:"row",overflow:"hidden",marginHorizontal:20}),experimentalHeaderTextDesktop:()=>r.Styles.createViewStyle({justifyContent:"center",flexShrink:1,alignItems:"flex-start",flexWrap:"wrap"}),experimentalHeaderTextContainerDesktop:()=>r.Styles.createViewStyle({flexShrink:0,flexGrow:0,flexDirection:"row",alignItems:"flex-start",overflow:"hidden"}),experimentalUserIconDesktop:()=>r.Styles.createViewStyle({marginRight:20}),experimentalUserIconMobile:()=>r.Styles.createViewStyle({alignSelf:"center"})});class ie extends $.default{constructor(){super(...arguments),this._onInviteButtonRef=e=>{this._inviteButtonRef=e||void 0},this._onInvite=()=>{p.getPhoneNumberFromMri(this.props.conversationId)&&D.default.initiateJoinLinkInvite({target:new D.ShareSheetInvite,origin:v.ContactInviteOrigin.PstnChatWindow,showLoadingModalWhileGettingJoinLink:!0,recipientName:this.state.userShortDisplayName,anchor:()=>this._inviteButtonRef,rootViewId:this._getRootViewId()})},this._onAddCredit=()=>{k.default.navigateToBalanceStatePanel("ContactInviteHeader.fromCTA",this._getRootViewId())},this._onAcceptInvite=e=>{b.log(v.LogTraceArea.Contacts,"ContactInviteHeader._onAcceptInvite"),this.props.inviteToken?(this._inviteAcceptanceScenario&&this._inviteAcceptanceScenario.markStepCompleted("AcceptButtonClicked"),I.LoadingDialog.show({dialogId:te,dialogText:P.getString("UrlConverter.ProcessingInviteLinkMessage"),showActivityIndicator:!0,showCancelButton:!1},this._getRootViewId()),T.default.autoBuddy(this.props.inviteToken).then((e=>(b.log(v.LogTraceArea.AutoBuddy,`handleAutoBuddyInviteLink: autoBuddy [${e.Buddied}, ${i.pii.Omit(e.Uri)}]`),e.Buddied&&this._inviteAcceptanceScenario&&(this._inviteAcceptanceScenario.markStepCompleted("AutobuddySucceed"),this._inviteAcceptanceScenario.isResolved()||(this._inviteAcceptanceScenario.finish(),this._inviteAcceptanceScenario=void 0)),e.Buddied||(b.warn(v.LogTraceArea.AutoBuddy,`Failed to autobuddy ${i.pii.Omit(this.props.inviteToken||"")}`),this._inviteAcceptanceScenario&&(this._inviteAcceptanceScenario.markStepCompleted("AutobuddyFailed"),this._inviteAcceptanceScenario.isResolved()||(this._inviteAcceptanceScenario.fail("Failed to autobuddy"),this._inviteAcceptanceScenario=void 0))),this._acceptInvite()))).finally((()=>{I.LoadingDialog.dismiss(te,this._getRootViewId())}))):this._acceptInvite()},this._onBlockInviter=e=>{const t={mriToBlock:this.state.inviterMri,rootViewId:this._getRootViewId(),reportContext:v.ReportContextListOptions.ContactRequest,isBlockingDialog:!0},s={navigateAway:!0,declineInvite:!0};if(this.state.isOneOnOneConversation){this.props.inviteToken&&this._inviteAcceptanceScenario&&(this._inviteAcceptanceScenario.markStepCompleted("BlockInviterClicked"),this._inviteAcceptanceScenario.finish(),this._inviteAcceptanceScenario=void 0),h.default.isMriBlocked(this.state.inviterMri)?(0,J.unblockContact)(this.state.inviterMri):k.default.navigateToReportConcernModal(t,s)}else t.groupConversationId=this.props.conversationId,k.default.navigateToReportConcernModal(t,s)}}_buildState(e,t){const s=p.isOneOnOneConversation(e.conversationId);let i;if(s)i=e.otherPartyMri;else{const t=(0,f.default)().getConversation(e.conversationId);i=t?t.getAddedBy():void 0}const o=i?ee.default.getFullUserProfileByMri(i):void 0,r=!!this._isPSTNConversationAndSmsAllowed()&&u.default.isPhoneMriTollFree(e.conversationId),a=_.default.getCreditEntitlement(),l=!!c.getPositiveCreditBalance(a)||_.default.userHasSubscriptions(),h=this._getRootViewId(),g=!!i&&!p.isPhoneMri(i),v=d.default.getOnboardingFeatures().contactInviteHeaderVariant,C=v!==E.ContactInviteHeaderVariant.Old;let b=!1;return p.isOneOnOneConversation(e.conversationId)&&!p.isEncryptedThread(e.conversationId)&&(b=!m.default.isManuallyAddedContact(ee.default.getConversationOwner(e.conversationId))),{isUsingStackNavigationContext:A.default.isUsingStackNavigationContext(),isSmallDevice:F.default.isSmallDevice(h),isSmallHeightView:F.default.isSmallDesktopHeightView(h),isMediumHeightView:F.default.isHeightSmallerThanThreshold(768,h),isLandscape:F.default.getDeviceOrientation(h)===n.DeviceOrientation.Landscape&&A.default.isUsingStackNavigationContext(),useTabletUI:q.default.useTabletUI(),inviterMri:i,isOneOnOneConversation:s,isTollFreeNumber:r,isPayingUser:l,userFullDisplayName:i?y.default.getDisplayName(i):P.getString("Notifications.UnknownUserShort"),userShortDisplayName:i?y.default.getShortDisplayName(i):P.getString("Notifications.UnknownUserShort"),gender:o?o.gender:void 0,gradientColors:i&&g?S.default.getGradientColors(i):void 0,primaryColor:i&&g?S.default.getPrimaryColor(i):void 0,isSearchingSkypeGraph:!1,showBlockPSTNUser:b,isPairedToSkypeUser:!!e.otherPartyMri&&ee.default.getConversationOwner(e.otherPartyMri)!==e.otherPartyMri,showExperimentalInvite:C,emoticonVariant:v}}_getLocationFromSkypeGraphResult(e){return e.nodeProfileData.city&&e.nodeProfileData.state?P.getString("ContactInviteResponder.LocationCityState",{city:e.nodeProfileData.city,state:e.nodeProfileData.state}):e.nodeProfileData.city&&e.nodeProfileData.country?P.getString("ContactInviteResponder.LocationCityCountry",{city:e.nodeProfileData.city,country:e.nodeProfileData.country}):e.nodeProfileData.state&&e.nodeProfileData.country?P.getString("ContactInviteResponder.LocationStateCountry",{state:e.nodeProfileData.state,country:e.nodeProfileData.country}):e.nodeProfileData.city||e.nodeProfileData.state||e.nodeProfileData.country||""}componentDidMount(){if(super.componentDidMount(),!this.state.inviterMri)return;const e=p.getSkypeIdFromMri(this.state.inviterMri);e&&(O.default.searchPeopleAsync(e,Date.now().toString()).then((t=>{const s=t&&t.results?t.results:[];if(this.isComponentMounted()){const t=o.find(s,(t=>t.nodeProfileData&&t.nodeProfileData.skypeId===e));t?this.setState({location:this._getLocationFromSkypeGraphResult(t),numberOfMutualContacts:t.nodeConnectionData?t.nodeConnectionData.mutualFriendCount:0,isSearchingSkypeGraph:!1}):(b.warn(v.LogTraceArea.Contacts,"The Skype Graph did not return any data for SkypeID: "+x.mriOrId(e)),this.setState({location:void 0,numberOfMutualContacts:void 0,isSearchingSkypeGraph:!1}))}})).fail((t=>{b.error(v.LogTraceArea.Contacts,"Fetching loc and mutual contact data for ("+x.mriOrId(e)+") from the Skype Graph failed with: "+V.default.errorAsString(t))})),this.setState({isSearchingSkypeGraph:!0})),this.props.inviteToken&&(this._inviteAcceptanceScenario=new Q.default(R.ScenarioName.InviteAcceptance),this._inviteAcceptanceScenario.start(),this._inviteAcceptanceScenario.markStepCompleted("AcceptInviteUIshown"))}componentWillUnmount(){super.componentWillUnmount(),this.props.inviteToken&&this._inviteAcceptanceScenario&&!this._inviteAcceptanceScenario.isResolved()&&(this._inviteAcceptanceScenario.invalidate(),this._inviteAcceptanceScenario=void 0)}render(){if(this.state.showExperimentalInvite&&this.state.isOneOnOneConversation&&!this._isPSTNConversationAndSmsAllowed()&&!p.isEncryptedThread(this.props.conversationId))return this._renderExperimentalInvite();const e=this.state.isSmallDevice?44:60,t=this.state.isUsingStackNavigationContext?void 0:this.state.gradientColors;let s,i,o;if(this.state.isUsingStackNavigationContext||(s=[se.contactInviteHeaderContainerDesktop,this._themeStyles.messageStreamBackgroundColorStyle]),this.props.showWave&&this.props.onGreet&&(i=r.createElement(B.default,{conversationId:this.props.conversationId,displayName:this.state.userShortDisplayName,gender:this.state.gender,onGreet:this.props.onGreet})),!this.state.isSmallHeightView){const s=this.state.isUsingStackNavigationContext&&!this.props.isIncomingContactInvitePending;o=r.createElement(L.default,{backgroundHeight:s?Z.UserIconSize.Size120+e:Z.UserIconSize.Size120,paddingTop:s?e:0,gradientColors:t},this._renderPstnOrNonPstnConversationView(),this._renderPstnOptionsButtons())}return r.createElement(r.View,{style:s},r.createElement(r.View,{style:[se.contactInviteHeaderContainer,this.props.style,this._themeStyles.dividerBorderColorStyle]},o,this._renderOptionalConfirmationText(),this._renderAnnotationContainer(),this._renderOptionalButtonsContainer(),this._renderBlockUnWantedPSTNUserText(),this._renderBlockPSTNHyperLink()),i)}_isPSTNConversationAndSmsAllowed(){return p.isPhoneMri(this.props.conversationId)}_renderBlockPSTNHyperLink(){if(!this.state.showBlockPSTNUser||!this.state.inviterMri)return;const e=P.getString("PSTNConversation.BlockPSTNNumber",{PSTNNumber:p.stripMriNamespace(this.state.inviterMri)});return r.createElement(r.Button,{onPress:this._onBlockInviter,accessibilityLabel:e},r.createElement(j.default,{url:"#",key:"blockPSTNHyperLink",blue:!0,onPress:this._onBlockInviter},e))}_renderBlockUnWantedPSTNUserText(){if(!this.state.showBlockPSTNUser)return;const e=[z.default.messagingHeaderFontStyle(!1,F.default.isSmallDeviceNoSubscription(this._getRootViewId()),this._currentTheme,!0),se.confirmationText,this._isPSTNConversationAndSmsAllowed()?se.pstnCtaExplanationText:void 0];return r.createElement(r.Text,{style:e},P.getString("PSTNConversation.BlockUnWantedPSTNUser"))}_showInviteToSkypeOption(){return this._isPSTNConversationAndSmsAllowed()&&!this.state.isTollFreeNumber&&!this.state.isPairedToSkypeUser}_showAddCreditOption(){return this._showInviteToSkypeOption()&&!this.state.isPayingUser}_getInviteToSkypeButtonConfig(){return{buttonStyle:this.state.isPayingUser?g.SXButtonStyle.DarkFill:g.SXButtonStyle.ThemeStroke,style:se.pstnCtaButton}}_getAddCreditButtonConfig(){return{buttonStyle:this.state.isPayingUser?g.SXButtonStyle.ThemeStroke:g.SXButtonStyle.DarkFill,style:se.pstnCtaButton}}_renderPstnOrNonPstnConversationView(){return this.state.isTollFreeNumber?r.createElement(r.Image,{source:a.Collection.PSTN_PHONE,style:se.pstnImage}):!this._isPSTNConversationAndSmsAllowed()||this.state.isTollFreeNumber||this.state.isPairedToSkypeUser?r.createElement(Y.UserIcon,{userMri:this.props.conversationId,size:Z.UserIconSize.Size120,style:se.userIcon,importantForAccessibility:r.Types.ImportantForAccessibility.NoHideDescendants}):this.state.isPayingUser?r.createElement(r.Image,{source:a.Collection.PSTN_CLUSTER,style:se.pstnImage}):r.createElement(r.Image,{source:a.Collection.PSTN_PHONE,style:se.pstnImage})}_renderOptionalConfirmationText(){if(this._isPSTNConversationAndSmsAllowed())return;const e=[z.default.messagingHeaderFontStyle(!1,this.state.isSmallDevice,this._currentTheme,!0),se.confirmationText,this._isPSTNConversationAndSmsAllowed()?se.pstnHeaderText:void 0];return this.state.isSmallHeightView&&e.push(se.confirmationTextSmallViewSpacing),r.createElement(X.PanelHeader,{style:e},this._getConfirmationTextString())}_renderPstnOptionsButtons(){const e=[z.default.messagingHeaderFontStyle(!1,this.state.isSmallDevice,this._currentTheme,!0),se.confirmationText,this._isPSTNConversationAndSmsAllowed()?se.pstnCtaExplanationText:void 0];return this._showAddCreditOption()?r.createElement(r.View,{style:se.pstnCtaButtonsContainer},r.createElement(U.default,Object.assign({},this._getInviteToSkypeButtonConfig(),{key:"invite",ref:this._onInviteButtonRef,buttonSize:g.SXButtonSize.Medium,onPress:this._onInvite,title:P.getString("PSTNConversation.InviteButtonLabel")})),r.createElement(X.PanelHeader,{style:e},P.getString("PSTNConversation.InviteLabel")),r.createElement(X.PanelHeader,{style:[e,se.pstnCtaSeparatorText]},P.getString("PSTNConversation.InviteButtonAndAddCreditButtonsSeperatorLabel")),r.createElement(U.default,Object.assign({},this._getAddCreditButtonConfig(),{key:"addCredit",buttonSize:g.SXButtonSize.Medium,onPress:this._onAddCredit,title:P.getString("PSTNConversation.AddCreditButtonLabel")})),r.createElement(X.PanelHeader,{style:e},P.getString("PSTNConversation.UseSkypeCreditToCallLabel"))):this._showInviteToSkypeOption()?r.createElement(r.View,{style:se.pstnCtaButtonsContainer},r.createElement(U.default,Object.assign({},this._getInviteToSkypeButtonConfig(),{key:"invite",ref:this._onInviteButtonRef,buttonSize:g.SXButtonSize.Medium,onPress:this._onInvite,title:P.getString("PSTNConversation.InviteButtonLabel")})),r.createElement(X.PanelHeader,{style:e},P.getString("PSTNConversation.InviteLabel"))):void 0}_renderExperimentalInvite(){let e,t,s=[se.experimentalInviteBoxSection,this._themeStyles.secondaryBackgroundColorStyle],i=[K.default.alignItemsCenter,this._themeStyles.dividerBorderColorStyle];const o=!this.state.isMediumHeightView,n=this._getConfirmationTextString();if(i.push(se.experimentalInviteContainerDesktop),s.push(se.experimentalInviteBoxSectionDesktop),this.state.isMediumHeightView&&s.push(se.experimentalCommonMarginTop),this.props.isIncomingContactInvitePending&&this.state.inviterMri){let i=[se.experimentalInviteButton,se.experimentalIncomingInviteButton,K.default.flexOne];if(o){let e;switch(this.state.emoticonVariant){case E.ContactInviteHeaderVariant.V2_smileys1:e="hi";break;case E.ContactInviteHeaderVariant.V2_smileys2:e="highfive";break;case E.ContactInviteHeaderVariant.V2_smileys3:e="star"}e&&(t=r.createElement(r.View,{style:se.experimentalInviteEmoticonContainer},r.createElement(l.AnimatedEmoticon,{size:l.Size.Large,innerText:e,emoticonName:e,showPlaceHolder:!0,standaloneAnimation:!0,placeholderBackgroundColor:this._themeColors.secondaryBackgroundColor})))}s.push(se.experimentalInviteBoxSectionWide),e=r.createElement(r.View,{style:s},t,r.createElement(X.BodyText,{style:se.experimentalInviteText,numberOfLines:2,ellipsizeMode:"tail"},n),r.createElement(r.View,{style:se.experimentalInviteButtonContainer},r.createElement(U.default,{key:"declineContactInvite",title:P.getString("ContactInviteResponder.DeclineButtonText"),onPress:this._onBlockInviter,style:i,buttonStyle:this._useDarkTheme()?g.SXButtonStyle.ThemeStroke:g.SXButtonStyle.LightFill,buttonSize:g.SXButtonSize.Medium,disabled:this.state.isAcceptingContact}),r.createElement(U.default,{key:"acceptContactInvite",title:P.getString("ContactInviteResponder.AcceptButtonText"),onPress:this._onAcceptInvite,style:i,buttonStyle:g.SXButtonStyle.ColorFill,buttonSize:g.SXButtonSize.Medium,showActivityIndicator:this.state.isAcceptingContact})))}else if(this.props.showWave&&this.props.onGreet)o&&(t=r.createElement(r.View,{style:se.experimentalInviteEmoticonContainer},r.createElement(l.AnimatedEmoticon,{size:l.Size.Large,innerText:"hi",emoticonName:"hi",showPlaceHolder:!0,standaloneAnimation:!0,placeholderBackgroundColor:this._themeColors.secondaryBackgroundColor}))),e=r.createElement(r.View,{style:s},t,r.createElement(X.BodyText,{style:se.experimentalInviteText,numberOfLines:3,ellipsizeMode:"tail"},n),r.createElement(U.default,{style:se.experimentalInviteButton,buttonStyle:g.SXButtonStyle.ColorFill,buttonSize:g.SXButtonSize.Medium,title:P.getString("MessageStream.SayHiButton"),allowTextWrap:!1,onPress:this.props.onGreet}));else{if(o){let e;if(this.props.isContactInviteJustAccepted&&!p.isEncryptedThread(this.props.conversationId)||this.props.isEncryptedConversationEstablished)switch(this.state.emoticonVariant){case E.ContactInviteHeaderVariant.V2_smileys1:e="clap";break;case E.ContactInviteHeaderVariant.V2_smileys2:e="highfive";break;case E.ContactInviteHeaderVariant.V2_smileys3:e="star"}else if(this.props.isAnyMessageInTheStream)switch(this.state.emoticonVariant){case E.ContactInviteHeaderVariant.V2_smileys1:e="holdon";break;case E.ContactInviteHeaderVariant.V2_smileys2:e="wait";break;case E.ContactInviteHeaderVariant.V2_smileys3:e="sleepy"}e&&(t=r.createElement(r.View,{style:se.experimentalInviteEmoticonContainer},r.createElement(l.AnimatedEmoticon,{size:l.Size.Large,innerText:e,emoticonName:e,showPlaceHolder:!0,standaloneAnimation:!0,placeholderBackgroundColor:this._themeColors.secondaryBackgroundColor})))}e=r.createElement(r.View,{style:s},t,r.createElement(X.BodyText,{style:se.experimentalInviteText,numberOfLines:2,ellipsizeMode:"tail"},n))}let a=[se.userIcon],d=[se.experimentalHeaderContainer],c=[se.experimentalCommonMarginTop],h=[];d.push(se.experimentalHeaderContainerDesktop),c.push(se.experimentalHeaderTextDesktop),h.push(se.experimentalHeaderTextContainerDesktop),a.push(se.experimentalUserIconDesktop);const u=this.state.isSmallDevice||this.state.isSmallHeightView?Z.UserIconSize.Size60:Z.UserIconSize.Size100;return r.createElement(r.View,{style:i,accessibilityLabel:n,accessibilityLiveRegion:r.Types.AccessibilityLiveRegion.Polite},r.createElement(r.View,{style:d},r.createElement(Y.UserIcon,{userMri:this.props.conversationId,size:u,style:a,importantForAccessibility:r.Types.ImportantForAccessibility.NoHideDescendants}),r.createElement(r.View,{style:c},r.createElement(X.PanelHeader,{style:[h,se.experimentalInviteHeader],numberOfLines:1,ellipsizeMode:"tail"},this.state.userFullDisplayName),this._renderAnnotationContainer(!0))),e)}_getConfirmationTextString(){if(this.props.isIncomingContactInvitePending){let e;return e=this.state.isOneOnOneConversation?"ContactInviteResponder.ConfirmationTextShort":"ContactInviteResponder.GroupConfirmationText",P.getString(e,{userName:this.state.userShortDisplayName})}if(this.props.isContactInviteJustAccepted&&!p.isEncryptedThread(this.props.conversationId)||this.props.isEncryptedConversationEstablished)return P.getString("MessageStream.SkypeFriendshipConfirmation");if(this._isPSTNConversationAndSmsAllowed())return P.getString("MessageStream.CallOrSendSMS");if(p.isEncryptedThread(this.props.conversationId))return P.getString("MessageStream.PrivateConversationHeaderFirstLine",{buddy:this.state.userShortDisplayName});const e=w.getLocalizeParamForGender(this.state.gender||G.eGender.Unspecified);return this.props.isAnyMessageInTheStream?P.getString("MessageStream.SkypeBeforeFriendshipConfirmation",{userName:this.state.userShortDisplayName,gender:e}):P.getString("MessageStream.GreetWithWaveActionLabel",{name:this.state.userShortDisplayName,gender:e})}_renderAnnotationContainer(e=!1){if(this.state.isSearchingSkypeGraph)return r.createElement(N.default,{size:g.SXActivityIndicatorSize.Small,tintColor:this.state.primaryColor||H.Color.blue});{let t,s,i;this.state.location&&(t=r.createElement(r.View,{style:se.annotationPart},r.createElement(C.default,{icon:W.SkypeIcon.Location,size:W.IconSize.size15,color:this._themeColors.primaryTextColor}),r.createElement(X.BodyText,{style:se.annotationText,numberOfLines:1,ellipsizeMode:"tail"},this.state.location))),!o.isUndefined(this.state.numberOfMutualContacts)&&this.state.numberOfMutualContacts>=0&&(s=r.createElement(r.View,{style:se.annotationPart},r.createElement(C.default,{icon:W.SkypeIcon.ContactGroupTwoPersonas,size:W.IconSize.size15,color:this._themeColors.primaryTextColor}),r.createElement(X.BodyText,{style:se.annotationText,numberOfLines:1,ellipsizeMode:"tail"},P.getString("ContactInviteResponder.MutualContactsCount",{count:this.state.numberOfMutualContacts})))),t&&s&&(i=e?r.createElement(r.View,{style:se.experimentalInviteAnnotationDivider}):r.createElement(r.View,{style:[se.divider,this._themeStyles.dividerColorStyle]}));let n=[se.annotationContainer];return e&&(n.push(se.annotationContainerColumn),n.push(se.annotationContainerColumnDesktop)),r.createElement(r.View,{style:n},t,i,s)}}_renderOptionalButtonsContainer(){if(this.props.isIncomingContactInvitePending&&this.state.inviterMri){const e=P.getString("ContactInviteResponder.DeclineButtonText"),t=P.getString("ContactInviteResponder.AcceptButtonText"),s=Math.abs(e.length-t.length)<=3,i=[se.contactInviteButton];return s&&i.push(se.contactInviteButtonHalfWidth),r.createElement(r.View,{style:se.buttonContainer},r.createElement(U.default,{key:"declineContactInvite",title:e,style:i,onPress:this._onBlockInviter,buttonStyle:g.SXButtonStyle.ThemeStroke,disabled:this.state.isAcceptingContact}),r.createElement(U.default,{key:"acceptContactInvite",title:t,style:o.concat(i,se.contactInviteButtonSpacer),onPress:this._onAcceptInvite,buttonStyle:g.SXButtonStyle.ColorFill,showActivityIndicator:this.state.isAcceptingContact}))}}_acceptInvite(){b.log(v.LogTraceArea.Contacts,"ContactInviteHeader._acceptInvite"),this.setState({isAcceptingContact:!0});return(this.state.isOneOnOneConversation?m.default.acceptContactInvite(this.state.inviterMri):m.default.acceptGroupConversationInvite(this.props.conversationId,this.state.inviterMri)).then((()=>{var e,t;this.isComponentMounted()&&(this.setState({isAcceptingContact:!1}),null===(t=(e=this.props).onIncomingContactInviteAccepted)||void 0===t||t.call(e)),b.log(v.LogTraceArea.Contacts,"ContactInviteHeader._acceptInvite: finished successfully")}))}}t.default=ie},66988:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AudioMessageItem=void 0;const i=s(33754),o=s(24897),n=s(11828);class r extends o.MediaBarItem{constructor(){super(...arguments),this._onPress=e=>{this.props.onPress&&this.props.onPress()}}isNavigatingAwayOnPress(){return!0}getIconMetadata(){return{icon:n.SkypeIcon.Microphone,title:i.getString("MessageComposer.RecordButtonTitle"),onPress:this._onPress}}}t.AudioMessageItem=r,t.default=r},78723:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BingSearchItem=void 0;const i=s(33754),o=s(24897),n=s(11828),r=s(78262);class a extends o.default{constructor(){super(...arguments),this._onItemPress=e=>{this.props.isMobileInterface&&(this.props.onBlur&&this.props.onBlur(),this.props.onCustomAction&&this.props.onCustomAction(r.MediaBarCustomAction.LaunchSearch))}}isNavigatingAwayOnPress(){return!0}getIconMetadata(){return{icon:n.SkypeIcon.Bing,size:this.props.presentedInOverflowMenu?18:void 0,title:i.getString("MediaBar.SearchButtonTitle"),onPress:this._onItemPress}}}t.BingSearchItem=a,t.default=a},48649:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CameraItem=void 0;const i=s(47447),o=s(11930),n=s(11375),r=s(33754),a=s(24897),l=s(11828),d=s(78262);class c extends a.default{constructor(){super(...arguments),this._onItemPress=e=>{i.UICapabilities.cameraSupported()&&(this.props.onBlur&&this.props.onBlur(),this.props.onCustomAction&&(o.default.registerMobileFocusHandler(n.FocusEvent.CloseMobileModal,(()=>this.isComponentMounted()?this:void 0)),this.props.onCustomAction(d.MediaBarCustomAction.LaunchCamera)))}}isNavigatingAwayOnPress(){return!0}getIconMetadata(){return{icon:l.SkypeIcon.Camera,title:r.getString("MediaBar.CameraButtonTitle"),onPress:this._onItemPress}}}t.CameraItem=c,t.default=c},8223:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContactPickerItem=void 0;const i=s(46096),o=s(81020),n=s(36237),r=s(33754),a=s(24897),l=s(4735),d=s(11828),c=s(53374);class h extends a.default{constructor(){super(...arguments),this._onPress=e=>{const t=c.default.newCauseId();n.log(i.LogTraceArea.Navigation,"ContactPickerItem._onPress causeId: "+t),l.default.navigateToShareContactsToConversationPanel({panelTitle:r.getString("DetailsPanelHeader.ShareContactToConversationTitle"),causeId:t,entryPoint:o.ShareContactOrigin.MessageComposer,conversationId:this.props.conversationId,onShareComplete:this._onShareComplete},this._getRootViewId())}}isNavigatingAwayOnPress(){return!0}getVirtualKeyboard(e){}getIconMetadata(){return{icon:d.SkypeIcon.ContactCard,title:r.getString("MediaBar.ContactPickerTitle"),onPress:this._onPress}}}t.ContactPickerItem=h,t.default=h},30757:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EmoticonPickerItem=void 0;const i=s(96486),o=s(25465),n=s(16778),r=s(32949),a=s(33754),l=s(80372),d=s(24897),c=s(63584),h=s(11828);class u extends d.MediaBarItemVirtualWidthKeyboard{constructor(){super(...arguments),this._onKeyboardButtonClick=e=>{o.default.showNativeKeyboard(),this.props.onFocus&&this.props.onFocus()},this._onPesPickerButtonClick=e=>{this.props.onBlur&&this.props.onBlur()}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),e.active!==this.props.active&&(this.props.active?c.EmoticonPickerTelemetry.open():c.EmoticonPickerTelemetry.closed())}_showSystemKeyboardIcon(){return!1}getId(){return this._showSystemKeyboardIcon()?l.SystemKeyboardId:this.props.id}getAccessibilityLabel(){return a.getString("MediaBar.EmoticonPicker")}getVirtualKeyboard(e){return u.getVirtualKeyboard(e,this._useDarkTheme())}getIcon(){if(this.props.isMobileInterface||this.props.canRender)return super.getIcon()}getIconMetadata(){return this._showSystemKeyboardIcon()?{icon:h.SkypeIcon.AddText,title:a.getString("MediaBar.SystemKeyboard"),iconColor:this._themeColors.primaryIconColor,onPress:this._onKeyboardButtonClick}:{icon:h.SkypeIcon.EmoticonStroke,title:a.getString("MediaBar.EmoticonPickerTitle"),onPress:this._onPesPickerButtonClick}}static getVirtualKeyboard(e,t){return n.createElement(r.default,{ref:e.onKeyboardItemRef,onPesDeleteButtonPress:e.onEmoticonBackspacePress,renderMobileInterface:!!e.isMobileInterface,darkTheme:t,onPesSelected:e.onEmoticonSelected||i.noop,availableWidth:e.availableWidth||0,conversationId:e.conversationId,showCategorySwitcher:e.showCategorySwitcher,onMessageSent:e.onMessageSent,onCloseSearch:e.onCloseSearch,preventAutoFocusOnCategory:e.preventAutoFocusOnCategory,clearEditInChatsComposer:e.clearEditInChatsComposer,onCustomAction:e.onCustomAction,pesPickerPopupRef:e.pesPickerPopupRef})}}t.EmoticonPickerItem=u,t.default=u},1014:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExpressionPickerItem=void 0;const i=s(25465),o=s(16778),n=s(89391),r=s(11009),a=s(15877),l=s(33754),d=s(80372),c=s(24897),h=s(40897),u=s(63584),p=s(58962),g=s(11828),m=s(10400),S=s(43368),f=(0,a.lazyProperties)({desktopUnifiedExpressionPickerActiveIcon:()=>o.Styles.createButtonStyle({justifyContent:"flex-start",paddingTop:14,paddingHorizontal:10}),desktopUnifiedExpressionPickerActiveIconOverride:()=>o.Styles.createButtonStyle({paddingHorizontal:11,paddingTop:10,minHeight:40})});class y extends c.default{constructor(){super(...arguments),this._onKeyboardButtonClick=()=>{var e,t;i.default.showNativeKeyboard(),null===(t=(e=this.props).onFocus)||void 0===t||t.call(e)},this._onPesPickerButtonClick=()=>{var e,t;null===(t=(e=this.props).onBlur)||void 0===t||t.call(e),this.state.isDesktopUnifiedExpressionPickerActive&&S.default.close(this._getRootViewId())}}_buildState(e){return{isDesktopUnifiedExpressionPickerActive:!e.isMobileInterface&&e.active,isComposerWithPopupEnabled:n.default.getS4LMessagingFeatures().enableDesktopComposerWithPopUpMenu,keyboardSeen:m.default.isKeyboardSeen()}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),e.active!==this.props.active&&(this.props.active?(u.EmoticonPickerTelemetry.startOpenScenario(),u.EmoticonPickerTelemetry.open(),h.default.activatePicker(p.TabType.Emoticon)):(h.default.deactivatePicker(),u.EmoticonPickerTelemetry.closed(),u.EmoticonPickerTelemetry.finishOpenScenario(),u.MojiPickerTelemetry.closed(),u.StickerPickerTelemetry.closed(),u.GifPickerTelemetry.closed(),this.requestFocus())),this.props.active&&t.keyboardSeen!==this.state.keyboardSeen&&this.state.keyboardSeen&&u.EmoticonPickerTelemetry.markKeyboardSeen()}_showSystemKeyboardIcon(){return!1}getId(){return this._showSystemKeyboardIcon()?d.SystemKeyboardId:this.props.id}getIconStyle(){return this.state.isDesktopUnifiedExpressionPickerActive?[f.desktopUnifiedExpressionPickerActiveIcon,this.state.isComposerWithPopupEnabled?f.desktopUnifiedExpressionPickerActiveIconOverride:void 0]:super.getIconStyle()}getIconMetadata(){const e={title:l.getString("MediaBar.ExpressionPickerTitle"),selectedTitle:l.getString("MediaBar.ExpressionPickerSelectedTitle"),scale:this.props.active?1:void 0,coachMarkType:r.CoachMarkType.ExpressionPicker,onPress:this._showSystemKeyboardIcon()?this._onKeyboardButtonClick:this._onPesPickerButtonClick};return this.state.isDesktopUnifiedExpressionPickerActive?(e.icon=g.SkypeIcon.DownChevron,e.selectedIconColor=this._themeColors.secondaryTextColor,e.showSelectedBackground=!1,e.showActiveIconHoverColor=!0,e.size=g.IconSize.size18):(e.icon=g.SkypeIcon.EmoticonStroke,e.selectedIconColor=this._themeColors.buttonBackgroundColor,e.showSelectedBackground=!0,e.showActiveIconHoverColor=!0,this.state.isComposerWithPopupEnabled&&(e.size=g.IconSize.size24,e.iconColor=this._themeColors.primaryIconColor,e.iconStyle=this._themeStyles.pillBorderColorStyle)),e}}t.ExpressionPickerItem=y,t.default=y},29245:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FilePickerItem=t.AcceptedFileTypes=void 0;const i=s(47447),o=s(14920),n=s(14980),r=s(11930),a=s(46096),l=s(61317),d=s(53559),c=s(11375),h=s(33754),u=s(24897),p=s(9748),g=s(18743),m=s(6286),S=s(3088),f=s(17252),y=s(85207),_=s(15963),v=s(86045),C=s(11828),b=s(60305);var T;!function(e){e[e.MediaOnly=0]="MediaOnly",e[e.All=1]="All"}(T=t.AcceptedFileTypes||(t.AcceptedFileTypes={}));class M extends u.MediaBarItem{constructor(){super(...arguments),this._onIconPress=e=>{const t={capturedContentHandler:new o.CapturedContentHandlerForPosting(this.props.conversationId),conversationId:this.props.conversationId,allowVideo:!0,mediaPickerOnly:!0,mediaPickerShouldCollapseFully:!0,allowMultiple:!0,willDismissOnSend:!0,allowOfficeLens:!0},s=e=>{const t=d.default.extractFileExtension(e.file.name),s=e.thumbnail&&d.default.isVideoExtension(t),i=d.default.isImageExtension(t);if(m.default.isMediaPreviewEnabled(this.props.conversationId))return m.default.addPreviews([e],this.props.conversationId,a.PostSource.MediaPicker),this._onShareComplete();const o=this._getRootViewType();if(s){const t={name:_.ScenarioName.SendVideo};y.default.postVideoWithThumbnail([this.props.conversationId],e,a.PostSource.MediaPicker,!1,t,void 0,void 0,void 0,o).then(this._onFileSent)}else if(i){const t={name:_.ScenarioName.SendPicture};y.default.postUpload([this.props.conversationId],e,a.PostSource.MediaPicker,!1,{scenarioInfo:t},o).then(this._onFileSent)}else{const t={name:_.ScenarioName.SendFile};y.default.postUpload([this.props.conversationId],e,this.props.acceptedFileTypes===T.MediaOnly?a.PostSource.MediaPicker:a.PostSource.FilePicker,!1,{scenarioInfo:t},o).then(this._onFileSent)}this.props.onFocus&&this.props.onFocus(),this.props.onActive&&this.props.onActive(""),this.props.announceForAccessibilityForMessageSent&&this.props.announceForAccessibilityForMessageSent()};i.UICapabilities.desktopFilePickerSupported()?l.FilePickerUtils.isDocumentPickerSupported()?(this.props.onBlur&&this.props.onBlur(),l.FilePickerUtils.showDocumentPicker(s,this._getRootViewId())):l.FilePickerUtils.showMultiFilesPicker(s,this.props.acceptedFileTypes===T.MediaOnly?g.FilePickerOrigin.MediaPickerItem:g.FilePickerOrigin.FilePickerItem,void 0,this._getRootViewId(),e,S.default.getPreviews(this.props.conversationId).length):b.default.useTabletUINoSubscription()&&(this.props.onBlur&&this.props.onBlur(),r.default.registerMobileFocusHandler(c.FocusEvent.CloseMobileModal,(()=>this.isComponentMounted()?this:void 0)),t.allowOfficeLens&&f.isOfficeLensAvailable()?this._launchOfficeLensInGalleryMode(t.capturedContentHandler):n.navigateToCaptureComboModalWithParams(t,this._getContext()))},this._onFileSent=()=>{this._announceForAccessibility(h.getString("MessageComposer.FileSentLabel")),this._onShareComplete()}}getId(){return this.props.acceptedFileTypes===T.MediaOnly?p.MediaBarItemKeys.MediaPicker:p.MediaBarItemKeys.FilePicker}getIconMetadata(){let e,t;return e=this.props.acceptedFileTypes===T.MediaOnly?C.SkypeIcon.Picture:C.SkypeIcon.Media,this.props.acceptedFileTypes===T.MediaOnly?(this.props.active,t=h.getString("MediaBar.MediaPickerTitle")):(this.props.active,t=h.getString("MediaBar.FilePickerTitle")),{icon:e,title:t,onPress:this._onIconPress}}isNavigatingAwayOnPress(){return!!this.props.presentedInOverflowMenu||!0}_launchOfficeLensInGalleryMode(e){f.launchInGalleryMode(e,this._getRootViewId()).then((e=>{e&&this._announceForAccessibility(h.getString("MessageComposer.FileSentLabel"))}))}_announceForAccessibility(e){this.props.announceForAccessibilityForMessageSent||v.default.maybeAnnounceForAccessibility(e)}componentWillUnmount(){super.componentWillUnmount(),l.FilePickerUtils.cleanUp(this._getRootViewId())}}t.FilePickerItem=M,t.default=M},30387:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GifPickerItem=void 0;const i=s(96486),o=s(16778),n=s(1720),r=s(33754),a=s(24897),l=s(63584),d=s(11828);class c extends a.MediaBarItemVirtualWidthKeyboard{constructor(){super(...arguments),this._onPesPickerButtonClick=e=>{this.props.onBlur&&this.props.onBlur()}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),e.active!==this.props.active&&(this.props.active?l.GifPickerTelemetry.open():l.GifPickerTelemetry.closed())}getAccessibilityLabel(){return r.getString("MediaBar.GifPicker")}getId(){return this.props.id}getVirtualKeyboard(e){return c.getVirtualKeyboard(e,this._useDarkTheme())}getIconMetadata(){const e=this.props.active?r.getString("MediaBar.GifPickerActiveTitle"):r.getString("MediaBar.GifPickerTitle");return{icon:d.SkypeIcon.Moji,title:e,onPress:this._onPesPickerButtonClick}}static getVirtualKeyboard(e,t){return o.createElement(n.default,{ref:e.onKeyboardItemRef,renderMobileInterface:!!e.isMobileInterface,darkTheme:t,onPesSelected:e.onGifSelected||i.noop,availableWidth:e.availableWidth||0,conversationId:e.conversationId,showCategorySwitcher:e.showCategorySwitcher,preventAutoFocusOnCategory:e.preventAutoFocusOnCategory,onCustomAction:e.onCustomAction})}}t.GifPickerItem=c,t.default=c},88824:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(70570),n=(s(11930),s(16760)),r=s(46096),a=(s(11375),s(33754)),l=s(46634),d=s(24897),c=s(38915),h=s(4735),u=s(11828);class p extends d.default{constructor(){super(...arguments),this._onLocationItemPress=e=>{this.props.origin===c.MediaBarItemOrigin.MessageOverflow&&(l.default.bingLocationConsentAndPermissionGranted()?(l.default.updateLocation(r.LocationUpdateReason.LocationPicker,!0),h.default.navigateToLocationPicker(this.props.conversationId,this._getContext())):o.default.displayModal(this._getRootViewId(),{onSureButtonClick:()=>{l.default.updateLocation(r.LocationUpdateReason.LocationPicker,!0),super._renderPopup()},onModalClosed:()=>this.requestFocus()}))}}isNavigatingAwayOnPress(){return this.props.origin===c.MediaBarItemOrigin.MessageOverflow}getVirtualKeyboard(e){return i.createElement(n.default,{conversationId:e.conversationId,displayInPopUp:!0})}getAccessibilityLabel(){return a.getString("MediaBar.LocationTitle")}_renderPopup(){return l.default.bingLocationConsentAndPermissionGranted()?(l.default.updateLocation(r.LocationUpdateReason.LocationPicker,!0),h.default.navigateToLocationPicker(this.props.conversationId,this._getContext()),!0):(o.default.displayModal(this._getRootViewId(),{onSureButtonClick:()=>{l.default.updateLocation(r.LocationUpdateReason.LocationPicker,!0),h.default.navigateToLocationPicker(this.props.conversationId,this._getContext())},onModalClosed:()=>this.requestFocus()}),!0)}getIconMetadata(){return{icon:u.SkypeIcon.Location,title:a.getString("MediaBar.LocationPickerTitle"),onPress:this._onLocationItemPress}}}t.default=p},45532:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MojiPickerItem=void 0;const i=s(96486),o=s(16778),n=s(33754),r=s(24897),a=s(1117),l=s(63584),d=s(11828);class c extends r.MediaBarItemVirtualWidthKeyboard{constructor(){super(...arguments),this._onPesPickerButtonClick=e=>{this.props.onBlur&&this.props.onBlur()}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),e.active!==this.props.active&&(this.props.active?l.MojiPickerTelemetry.open():l.MojiPickerTelemetry.closed())}getAccessibilityLabel(){return n.getString("MediaBar.MojiPicker")}getId(){return this.props.id}getVirtualKeyboard(e){return c.getVirtualKeyboard(e,this._useDarkTheme())}getIconMetadata(){const e=this.props.active?n.getString("MediaBar.MojiPickerActiveTitle"):n.getString("MediaBar.MojiPickerTitle");return{icon:d.SkypeIcon.Moji,title:e,onPress:this._onPesPickerButtonClick}}static getVirtualKeyboard(e,t){return o.createElement(a.default,{ref:e.onKeyboardItemRef,renderMobileInterface:!!e.isMobileInterface,darkTheme:t,onPesSelected:e.onMojiSelected||i.noop,availableWidth:e.availableWidth||0,conversationId:e.conversationId,showCategorySwitcher:e.showCategorySwitcher,preventAutoFocusOnCategory:e.preventAutoFocusOnCategory,onCustomAction:e.onCustomAction})}}t.MojiPickerItem=c,t.default=c},43501:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PeopleItem=void 0;const i=s(71830),o=s(31761),n=s(46096),r=s(33754),a=s(24897),l=s(95691),d=s(10541),c=s(11828);class h extends a.MediaBarItemVirtualWidthKeyboard{constructor(){super(...arguments),this._onPress=e=>{if(this.props.otherPartyMri){new o.default({peopleType:d.PeopleType.All,filterPeopleType:d.FilterType.GroupCapable,navigationOrigin:n.NavigationConversationOrigin.MediaBar,invitedUsersMris:[this.props.otherPartyMri],wizardSteps:[l.WizardSteps.setConvParticipants]}).start(this._getRootViewId())}else if(this.props.conversationId){new o.default({convId:i.asSkypeThreadIdMaybe(this.props.conversationId),navigationOrigin:n.NavigationConversationOrigin.MediaBar,peopleType:d.PeopleType.All,filterPeopleType:d.FilterType.GroupCapable,wizardSteps:[l.WizardSteps.setConvParticipants]}).start(this._getRootViewId())}}}getIconMetadata(){return{icon:c.SkypeIcon.ContactAdd,title:r.getString("MediaBar.PeopleTitle"),onPress:this._onPress}}isNavigatingAwayOnPress(){return!!this.props.presentedInOverflowMenu}getVirtualKeyboard(e){}}t.PeopleItem=h},99070:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PollItem=void 0;const i=s(36237),o=s(33754),n=s(24897),r=s(62393),a=s(71926),l=s(11828);class d extends n.default{constructor(){super(...arguments),this._onButtonClick=e=>{i.track(new a.PollLaunchedEvent(a.LaunchOrigin.MediaBarItem)),r.default.NavigationActions.navigateToPollCreationPanel({conversationId:this.props.conversationId},this._getRootViewId())}}isNavigatingAwayOnPress(){return!0}getIconMetadata(){return{icon:l.SkypeIcon.Poll,title:o.getString("MediaBar.PollTitle"),onPress:this._onButtonClick}}}t.PollItem=d,t.default=d},42759:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RichtextEditorItem=void 0;const i=s(11009),o=s(33754),n=s(24897),r=s(11828),a=s(81571);class l extends n.default{constructor(){super(...arguments),this._onRichtextPickerButtonClick=()=>{a.default.setVisibility(this.props.conversationId,!this.state.isOpened)}}_buildState(e){return{isOpened:a.default.panelOpened(e.conversationId)}}getIconMetadata(){const e={title:o.getString("MediaBar.RichtextEditorPickerTitle"),selectedTitle:o.getString("MediaBar.RichtextEditorPickerCloseTitle"),coachMarkType:i.CoachMarkType.RichtextEditor,onPress:this._onRichtextPickerButtonClick,size:r.IconSize.size18,showActiveIconHoverColor:!0};return e.icon=this.state.isOpened?r.SkypeIcon.DownChevron:r.SkypeIcon.Format,e}}t.RichtextEditorItem=l,t.default=l},20360:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ScheduleCallItem=void 0;const i=s(33754),o=s(24897),n=s(34273),r=s(79829),a=s(11828);class l extends o.default{constructor(){super(...arguments),this._onButtonClick=e=>{n.default.NavigationActions.navigateToScheduleCallCreationPanel({conversationId:this.props.conversationId,entryPoint:r.ScheduleCallEntryPoint.MediaBar},this._getRootViewId())}}isNavigatingAwayOnPress(){return!0}getIconMetadata(){return{icon:a.SkypeIcon.Schedule,title:i.getString("MediaBar.ScheduleCallTitle"),onPress:this._onButtonClick}}}t.ScheduleCallItem=l,t.default=l},37589:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SendCreditItem=void 0;const i=s(96486),o=s(71830),n=s(36237),r=s(33754),a=s(46096),l=s(24897),d=s(4735),c=s(23175),h=s(14976),u=s(4455),p=s(11828);class g extends l.default{constructor(){super(...arguments),this._onPress=()=>{const e=o.getSkypeIdFromMri(this.props.conversationId);i.isUndefined(e)?n.error(a.LogTraceArea.Navigation,"Conversation is not eligible for sending Skype Credit. Conversation ID: "+h.mriOrId(this.props.conversationId)):(u.default.resetValuesNoTrigger(),u.default.setBeneficiary(e),d.default.navigateToSendCreditPanel(this._getRootViewId()),n.track(new c.SendCreditEvent(c.SendCreditStep.ChatClick)))}}isNavigatingAwayOnPress(){return!0}getIconMetadata(){return{icon:p.SkypeIcon.SkypeCredit,title:r.getString("MediaBar.SendCreditTitle"),onPress:this._onPress}}}t.SendCreditItem=g,t.default=g},63080:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SmsItem=void 0;const i=s(33754),o=s(24897),n=s(11828);class r extends o.default{getIconMetadata(){return{icon:n.SkypeIcon.MobileSmsNew,title:i.getString("SMSMessaging.SendSmsButtonTitle")}}}t.SmsItem=r,t.default=r},95960:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StickerPickerItem=void 0;const i=s(96486),o=s(16778),n=s(33754),r=s(24897),a=s(63584),l=s(63110),d=s(11828);class c extends r.MediaBarItemVirtualWidthKeyboard{constructor(){super(...arguments),this._onPesPickerButtonClick=e=>{this.props.onBlur&&this.props.onBlur()}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),e.active!==this.props.active&&(this.props.active?a.StickerPickerTelemetry.open():a.StickerPickerTelemetry.closed())}getId(){return this.props.id}getVirtualKeyboard(e){return c.getVirtualKeyboard(e,this._useDarkTheme())}getIconMetadata(){const e=this.props.active?n.getString("MediaBar.StickerPickerActiveTitle"):n.getString("MediaBar.StickerPickerTitle");return{icon:d.SkypeIcon.Sticker,title:e,onPress:this._onPesPickerButtonClick}}static getVirtualKeyboard(e,t){return o.createElement(l.default,{ref:e.onKeyboardItemRef,renderMobileInterface:!!e.isMobileInterface,darkTheme:t,onPesSelected:e.onStickerSelected||i.noop,availableWidth:e.availableWidth||0,conversationId:e.conversationId,showCategorySwitcher:e.showCategorySwitcher,preventAutoFocusOnCategory:e.preventAutoFocusOnCategory,onCustomAction:e.onCustomAction})}}t.StickerPickerItem=c,t.default=c},56503:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(2604),o=s(89391),n=s(94224),r=s(46096),a=s(36237),l=s(33754),d=s(24897),c=s(4735),h=s(81736),u=s(11828),p=s(78262);class g extends d.MediaBarItem{constructor(){super(...arguments),this._onVideMessageItemPress=e=>{o.default.isDesktopVIMEnabled()?(n.default.AugmentedPermissionsPromptHelper.subscribeToAugmentedPermissionEvents(),h.default.requestPermission(p.PermissionType.MicrophoneAndCamera,p.PermissionPromptOptions.SkipPrePrompt,i.PermissionOrigin.VideoMessageItem).then((e=>{a.log(r.LogTraceArea.Navigation,"VideoMessageItem browser permissionStatus:",i.PermissionStatus[e]),e===i.PermissionStatus.Granted&&c.default.navigateToDesktopCaptureComboModal(this.props.conversationId,this._onShareComplete,this._getContext()),n.default.AugmentedPermissionsPromptHelper.unsubscribeFromAugmentedPermissionEvents()}))):a.log(r.LogTraceArea.Navigation,"Unexpected code path location selector only works with desktop/electron")}}isNavigatingAwayOnPress(){return!0}getIconMetadata(){return{icon:o.default.getS4LMessagingFeaturesNoSubscription().useNewVideoMessageIcon?u.SkypeIcon.MessageVideo:u.SkypeIcon.Videomail,title:l.getString("MediaBar.VideoMessageTitle"),onPress:this._onVideMessageItemPress}}}t.default=g},22763:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.KeyboardHost=void 0;const i=s(58108),o=s(16778),n=s(88837),r=s(10400);class a extends n.ComponentBase{constructor(e){super(e)}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),r.default.setResizeMode(i.KeyboardAwareResizeMode.Default)}shouldComponentUpdate(e){return!1}componentWillUnmount(){super.componentWillUnmount(),r.default.setResizeMode(i.KeyboardAwareResizeMode.Default)}render(){return o.createElement(o.View,null,this.props.children)}}t.KeyboardHost=a},80372:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MediaBar=t.SystemKeyboardId=void 0;const i=s(96486),o=s(25465),n=s(16778),r=s(89391),a=s(37490),l=(s(22763),s(15877)),d=s(38915),c=s(6250),h=s(29130),u=s(78262),p=s(80837),g=s(60305),m=s(24576),S=s(73877),f="VirtualKeyboard",y=(0,l.lazyProperties)({container:()=>n.Styles.createViewStyle({flexDirection:"column",overflow:"visible"}),listIconsContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"space-between",overflow:"visible",height:50}),listIconsContainerVerticalAlignment:()=>p.default.alignItemsCenter,virtualKeyboardStyle:()=>n.Styles.createViewStyle({height:0,overflow:"hidden"}),nonVirtualKeyboardStyle:()=>n.Styles.createViewStyle({height:216,overflow:"hidden"})});function _(e){return e!==t.SystemKeyboardId&&""!==e}t.SystemKeyboardId="SystemKeyboard";class v extends m.default{constructor(){super(...arguments),this._keyboardRefsMap=new c.default,this._iconRefsMap=new c.default,this._itemRefsMap=new c.default,this._onSelectedCallback=e=>{this.props.onItemSelected&&this.props.onItemSelected(e)},this._onHandleCustomAction=(e,t)=>{switch(e){case u.MediaBarCustomAction.LaunchKeyboard:const s=this.getItemById(t.id);s?s.selectItem():this.props.onCustomAction&&this.props.onCustomAction(e,t);break;case u.MediaBarCustomAction.CloseKeyboard:this.props.onBlur();break;default:this.props.onCustomAction&&this.props.onCustomAction(e,t)}}}_buildState(e,t){const s={};t&&(s.keyboardSerial=++v._keyboardSerial);const i=this.props;(t||e.activeId!==i.activeId)&&(""===e.activeId||e.activeId);const o=this._getRootViewId(),n=h.default.getWidth(o);return s.availableWidth=g.default.isTablet()?S.default.measureScreen(this._getRootViewId()).width:n,s.isComposerWithPopUpEnabled=r.default.getS4LMessagingFeatures().enableDesktopComposerWithPopUpMenu,s}_getHeight(){return _(this.props.activeId)&&this.props.customKeyboardHeight>10?this.props.customKeyboardHeight:0}_showCustomKeyboard(e){return i.defer((()=>{e?(this.props.onFocus&&this.props.onFocus(),e.show(),this.props.focusCustomKeyboardWhenShown&&this._focusKeyboard()):(this.props.onCustomKeyboardClose&&this.props.onCustomKeyboardClose(),o.default.dismiss())}))}componentDidUpdate(e,t,s){if(super.componentDidUpdate(e,t,s),o.default.isSupported()&&this.props.activeId!==e.activeId){const e=this._keyboardRefsMap.ref(this._getLocalKeyboardId(this.props.activeId)+f);this._showCustomKeyboard(e)}}_focusKeyboard(){const e=this._itemRefsMap.ref(this.props.activeId);e&&e.requestFocus()}componentDidMount(){if(super.componentDidMount(),this.props.autoFocusFirstItem&&this.props.itemDescriptors.length>0){let e=0;for(;e<this.props.itemDescriptors.length;){const t=this.getItemById(this.props.itemDescriptors[e].id);if(t&&t.requestFocus())break;e++}}this._keyboardDismissRegistrationHandle=a.register(this)}componentWillUnmount(){super.componentWillUnmount(),o.default.isSupported()&&o.default.dismiss(),a.unregister(this._keyboardDismissRegistrationHandle)}_getLocalKeyboardId(e){return`${e}-${this.state.keyboardSerial}`}getItemById(e){return this._iconRefsMap.ref(e)}render(){const e={};let t;if(this.props.showIcons){const s=i.map(this.props.itemDescriptors,((t,s)=>{const o=this._getMediaBarItemProps(t,s,this.props.itemDescriptors.length),n=i.extend({},o,t.propOverrides),r=t.render(n),a=t.getVirtualKeyboard&&t.getVirtualKeyboard(n,this._useDarkTheme());return a&&(e[this._getLocalKeyboardId(t.id)]={keyboard:a,height:t.keyboardHeight}),r})),o=this.props.preventAccessibilityFocus?n.Types.ImportantForAccessibility.NoHideDescendants:void 0,r=[y.listIconsContainer,this.state.isComposerWithPopUpEnabled?y.listIconsContainerVerticalAlignment:void 0];t=n.createElement(n.View,{key:"mediabar",style:r,importantForAccessibility:o},s)}else i.each(this.props.itemDescriptors,((t,s)=>{const o=this._getMediaBarItemProps(t,s,this.props.itemDescriptors.length),n=i.extend({},o,t.propOverrides),r=t.getVirtualKeyboard&&t.getVirtualKeyboard(n,this._useDarkTheme());r&&(e[this._getLocalKeyboardId(t.id)]={keyboard:r,height:t.keyboardHeight})}));let s,r=[];if(this.props.isMobileInterface)if(o.default.isSupported())i.each(e,((e,t)=>{const s=t+f;let i=e.keyboard;r.push(n.createElement(o.default,{key:s,ref:this._keyboardRefsMap.onComponentRef(s),virtualKeyboardKey:s,retainOnDismiss:!1,style:y.virtualKeyboardStyle,height:e.height},i))}));else if(_(this.props.activeId)){const{keyboard:t}=e[this._getLocalKeyboardId(this.props.activeId)];t&&r.push(n.createElement(n.View,{key:f,style:y.nonVirtualKeyboardStyle},t))}return s=r,n.createElement(n.View,{style:y.container},t,s)}dismissKeyboard(){this._isComponentVisible()&&o.default.dismiss()}_getMediaBarItemProps(e,t,s){let i=this.props.colorOverride;return i||(i=this._themeColors.secondaryTextColor),{id:e.id,key:e.id,ref:this._iconRefsMap.onComponentRef(e.id),onKeyboardItemRef:this._itemRefsMap.onComponentRef(e.id),listIndex:t,numberItems:s,onActive:this._onSelectedCallback,isMobileInterface:this.props.isMobileInterface,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,active:this.props.activeId===e.id,onFocus:this.props.onFocus,onBlur:this.props.onBlur,onInputChange:this.props.onInputChange,availableWidth:this.state.availableWidth,onEmoticonBackspacePress:this.props.onBackspace,onCustomAction:this._onHandleCustomAction,onMessageSent:this.props.onMessageSent,onCloseSearch:this.props.onCloseSearch,colorOverride:i,hoverColorOverride:this._themeColors.primaryTextColor,clearEditInChatsComposer:this.props.clearEditInChatsComposer,disabled:this.props.disableActionOnMediaBar||e.disabled,announceForAccessibilityForMessageSent:this.props.announceForAccessibilityForMessageSent,origin:d.MediaBarItemOrigin.MessageComposer}}}t.MediaBar=v,v._nonVirtualKeyboardHeight=216,v._keyboardSerial=0,t.default=v},24897:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MediaBarItemVirtualWidthKeyboard=t.MediaBarItem=t.MediaBarPopup=void 0;const i=s(96486),o=s(25465),n=s(38933),r=s(16778),a=s(89391),l=s(97775),d=s(11009),c=s(47204),h=s(46096),u=s(13944),p=s(36237),g=s(15877),m=s(18743),S=s(89808),f=s(4735),y=s(33348),_=s(81760),v=s(11828),C=s(79669),b=s(24576),T=s(53374);t.MediaBarPopup="mediaBarPopup";const M=(0,g.lazyProperties)({iconMobileVerticalPadding:()=>r.Styles.createButtonStyle({marginTop:8,paddingBottom:8,paddingLeft:12,paddingRight:12}),iconMobileHorizontalPaddingFirst:()=>r.Styles.createButtonStyle({paddingLeft:4}),iconMobileHorizontalPaddingLast:()=>r.Styles.createButtonStyle({paddingRight:4}),iconDesktop:()=>r.Styles.createButtonStyle({padding:8}),selectedIcon:()=>r.Styles.createViewStyle({height:v.IconSize.size20,width:v.IconSize.size20,borderRadius:v.IconSize.size20/2}),selectedIconContainer:()=>r.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,alignItems:"center",justifyContent:"center"}),selectionIndicator:()=>r.Styles.createViewStyle({position:"absolute",left:2,right:2,bottom:0,height:2}),selectedIconWithBackgroundContainer:()=>r.Styles.createViewStyle({justifyContent:"center"}),buttonWithBackground:()=>r.Styles.createViewStyle({borderRadius:20,width:40,height:40,marginLeft:4,marginRight:4})});class I extends b.default{constructor(){super(...arguments),this._customOnPress=e=>{if(p.log(h.LogTraceArea.MediaBarItem,"onPress callback"),y.default.isAnimationPending())return void p.log(h.LogTraceArea.MediaBarItem,"returning because of PendingAnimationStore.isAnimationPending() == true");const t=this.getIconMetadata();if(this.isNavigatingAwayOnPress())p.log(h.LogTraceArea.MediaBarItem,"this.isNavigatingAwayOnPress() == true"),i.isUndefined(t.onPress)||(p.log(h.LogTraceArea.MediaBarItem,"calling metadata.onPress"),t.onPress(e));else{if(this._renderPopup()&&this.props.onActive){const e=this.getId();p.log(h.LogTraceArea.MediaBarItem,"calling this.props.onActive with id "+e),this.props.onActive(e)}i.isUndefined(t.onPress)||(p.log(h.LogTraceArea.MediaBarItem,"calling metadata.onPress"),t.onPress(e)),o.default.isSupported()&&!this.hasVirtualKeyboard()&&(p.log(h.LogTraceArea.MediaBarItem,"dismissing keyboard"),o.default.dismiss())}p.track(new m.MediaBarItemPressed(this.getId(),this.props.active,this.props.conversationId,this.props.origin)),e&&e.stopPropagation()},this._onIconRefChanged=e=>{this._iconButton=e||void 0},this._getIconRef=()=>this._iconButton,this._onShareComplete=()=>{if(this._getContext().isPresentedInDesktopRightNav){const e=T.default.newCauseId();p.log(h.LogTraceArea.MediaBarItem,"_onShareComplete, causeId: "+e),f.default.maybeCloseRightPanel(e,this._getContext())}}}static dismissPopup(e){c.default.dismissPopup(t.MediaBarPopup,e)}hasVirtualKeyboard(){return!1}isNavigatingAwayOnPress(){return!1}getVirtualKeyboard(e){return I.getVirtualKeyboard(e,this._useDarkTheme())}static getVirtualKeyboard(e,t){}getId(){return this.props.id}componentDidMount(){super.componentDidMount()}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s)}selectItem(){this._customOnPress()}requestFocus(){return!(!this._iconButton||!this._iconButton.requestFocus)&&(this._iconButton.requestFocus(),!0)}getAccessibilityLabel(){}getIconStyle(){let e=[M.iconDesktop];return this.props.isMobileInterface&&(e=[M.iconMobileVerticalPadding],0===this.props.listIndex&&e.push(M.iconMobileHorizontalPaddingFirst),this.props.listIndex===(this.props.numberItems?this.props.numberItems-1:0)&&e.push(M.iconMobileHorizontalPaddingLast)),e}getIcon(){const e=a.default.getS4LMessagingFeaturesNoSubscription().enableDesktopComposerWithPopUpMenu,t=this.getIconMetadata();let s,i=[this.props.iconStyleOverride||t.iconStyle||this.getIconStyle()],o=this.props.colorOverride||t.iconColor||this._themeColors.primaryIconColor||_.Color.transparent,c=this.props.active&&!t.showActiveIconHoverColor?o:this.props.hoverColorOverride||this._themeColors.iconHoverColor||o;e&&!this.props.presentedInOverflowMenu&&(i.push(this._themeStyles.buttonBackgroundColorStyle),i.push(M.buttonWithBackground),s=this._themeStyles.buttonBackgroundHoverColorStyle,o=this._themeColors.primaryIconColor,c=this._themeColors.iconHoverColor),this.props.active&&!e&&(o=t.selectedIconColor?t.selectedIconColor:this._useAccessibleTheme()?this._themeColors.primaryTextColor:S.default.getPrimaryColorNoSubscription());const h=t.size||(e?v.IconSize.size20:v.IconSize.size24),p=this.props.active&&!this.props.isMobileInterface&&this._useAccessibleTheme()?r.createElement(r.View,{style:[M.selectionIndicator,this._themeStyles.primaryViewColorStyle]}):void 0;let g,m=t.title;this.props.active&&t.selectedTitle&&(m=t.selectedTitle);const f={key:this.props.id,icon:t.icon||v.SkypeIcon.Blank,size:h,color:o,title:m,hoverColor:c,style:i,hoverStyle:s,onPress:this._customOnPress,disabled:this.props.disabled,accessoryView:p,importantForAccessibility:this.props.preventAccessibilityFocus?r.Types.ImportantForAccessibility.NoHideDescendants:void 0,tabIndex:this.props.preventAccessibilityFocus?-1:void 0};if(g=t.coachMarkType?r.createElement(l.default.IconButton,Object.assign({anchorRef:this._onIconRefChanged,anchorAccessibilityLabel:m,coachMarkType:t.coachMarkType,onAnchorPress:this._customOnPress,positions:[d.PopupAnchorPositon.Top]},f)):r.createElement(u.default,Object.assign({ref:this._onIconRefChanged},f)),this.props.active&&t.showSelectedBackground){const e=t.selectedIconSize?r.Styles.createViewStyle({width:t.selectedIconSize,height:t.selectedIconSize,borderRadius:t.selectedIconSize/2},!1):M.selectedIcon;let s;s=this._useAccessibleTheme()?r.createElement(r.View,{style:[e,this._themeStyles.primaryViewColorStyle]}):r.createElement(n.GradientView,{style:e,colors:S.default.getGradientColorsNoSubscription(),direction:n.GradientDirection.BOTTOM_RIGHT});let o=[M.selectedIconWithBackgroundContainer];return t.scale&&o.push({transform:[{scale:t.scale}]}),r.createElement(r.View,{style:o},r.createElement(r.View,{style:M.selectedIconContainer},r.createElement(r.Animated.View,{style:i},s)),g)}return g}render(){return this.getIcon()||null}_renderPopup(){if(this._shouldRenderPopup()){const e=this.getVirtualKeyboard(this.props);if(e){const s={getAnchor:()=>this._iconButton,renderPopup:(t,s,i,o)=>r.createElement(C.default,{anchorPosition:t,anchorOffset:s,popupWidth:i,popupHeight:o,contentStretchAcrossWidth:!0,fillColor:this._themeColors.primaryBackgroundColor,strokeColor:this._useDarkTheme()?this._themeColors.dividerColor:void 0,skipPopupAutoFocus:!0,popupAccessibilityTitle:this.getAccessibilityLabel()},e),positionPriorities:["top","bottom"],onDismiss:()=>{this.isComponentMounted()&&(this.props.onActive&&this.props.onActive(void 0),this.requestFocus())},dismissIfShown:!0,rootViewId:this._getRootViewId()};return c.default.showPopup(s,t.MediaBarPopup)}}return!0}_shouldRenderPopup(){return!this.props.isMobileInterface}}t.MediaBarItem=I;t.MediaBarItemVirtualWidthKeyboard=class extends I{hasVirtualKeyboard(){return!0}},t.default=I},19243:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(18369),n=s(85609),r=s(52115),a=s(53559),l=s(13944),d=s(10117),c=s(15877),h=s(33754),u=s(81760),p=s(11010),g=s(11828),m=s(78262),S=s(80837),f=s(19675),y=s(24576),_=135,v=u.Color.white,C=(0,c.lazyProperties)({previewInfoWithThumbnail:()=>i.Styles.createViewStyle({width:_}),fileSizeCaption:()=>i.Styles.createTextStyle({marginBottom:2}),itemContainer:()=>i.Styles.createViewStyle({height:_,width:_,borderRadius:6,padding:10,justifyContent:"flex-end",marginRight:10,marginBottom:10}),noPadding:()=>i.Styles.createViewStyle({padding:0}),removeIconWrapper:()=>i.Styles.createViewStyle({position:"absolute",top:0,right:0,marginTop:6,marginRight:18,backgroundColor:u.Color.blackOverlay35,borderRadius:g.IconSize.size18/2,borderStyle:"solid",borderWidth:1,borderColor:v,alignItems:"center",justifyContent:"center",width:g.IconSize.size18,height:g.IconSize.size18}),cardTitle:()=>i.Styles.createTextStyle({width:120,height:38,marginBottom:8,marginTop:14,justifyContent:"flex-start",fontSize:p.default.controlFontSize.body}),playButtonWrapperBg:()=>i.Styles.createViewStyle({backgroundColor:u.Color.blackOverlay20,alignItems:"center",justifyContent:"center"}),playButtonWrapper:()=>i.Styles.createViewStyle({backgroundColor:u.Color.blackOverlay10,borderRadius:g.IconSize.size60/2,borderStyle:"solid",borderWidth:2,borderColor:u.Color.white,alignItems:"center",justifyContent:"center",width:g.IconSize.size60,height:g.IconSize.size60}),fileContainer:()=>i.Styles.createViewStyle({flexDirection:"column",alignContent:"flex-end"})});class b extends y.default{constructor(){super(...arguments),this._onItemPress=e=>{e.stopPropagation(),this.props.onItemPress(this.props.preview)},this._onItemRemoved=e=>{e.stopPropagation(),this.props.onItemRemoved(this.state.uid)},this._onPreviewItemRef=e=>{this._previewItemRef=e}}_buildState(e,t){const{data:s,uid:i,thumbnailUrl:o}=e.preview;return{uid:i,fileData:s,fileType:a.default.getFileType(s.extension),fileName:a.default.extractFileNameForKnownFileTypes(s.file.name),thumbnailUrl:o}}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t),e.isNavigatingWithKeyboard&&!this.props.isNavigatingWithKeyboard&&this._previewItemRef.requestFocus()}render(){let e,t,s=C.previewInfoWithThumbnail,o=!0,a="";switch(this.state.fileType){case m.UploadFileType.Video:t=this._renderPlayVideoIcon(),e=this.state.thumbnailUrl?this._renderThumbnailsPreview(this.state.thumbnailUrl):void 0,a=h.getString("VideoNode.OpenVideoTitle")+this.state.fileData.file.name;break;case m.UploadFileType.Picture:e=this.state.thumbnailUrl?this._renderThumbnailsPreview(this.state.thumbnailUrl):void 0,a=h.getString("FileTransfer.ImageOpenWithFileName",{fileName:this.state.fileData.file.name});break;default:a=this.state.fileData.file.name;const l=this.state.fileData.file.size?r.default.formatFileSize(this.state.fileData.file.size,2).formattedString:void 0;o=!1;const c=i.createElement(f.Caption,{numberOfLines:1,ellipsizeMode:"tail",style:C.fileSizeCaption},l),u=n.FileIconHelper.getIconFromFileType(this.state.fileName,this.state.fileType),S=i.createElement(d.default,{icon:u.icon,size:s?p.default.controlFontSize.panelHeaderLarge:g.IconSize.size24,color:this._themeColors.secondaryTextColor,style:s});e=i.createElement(i.View,{style:C.fileContainer},S,i.createElement(f.CardTitle,{numberOfLines:1,ellipsizeMode:"tail",style:C.cardTitle},this.state.fileName),c)}let c=[C.itemContainer,this._themeStyles.primaryBackgroundColorStyle];return o&&c.push(C.noPadding,S.default.pointerCursor),i.createElement(i.View,null,i.createElement(i.Button,{ref:this._onPreviewItemRef,key:this.state.uid,style:c,onPress:o?this._onItemPress:void 0,importantForAccessibility:o?void 0:i.Types.ImportantForAccessibility.NoHideDescendants,accessibilityLabel:a,accessibilityTraits:i.Types.AccessibilityTrait.Button,tabIndex:o?0:-1},e,t),i.createElement(i.View,{style:C.removeIconWrapper},i.createElement(l.default,{key:"remove"+this.state.uid,icon:g.SkypeIcon.ClosePanel,color:v,hoverColor:v,size:g.IconSize.size12,onPress:this._onItemRemoved,title:h.getString("MediaPreview.RemoveItem",{fileName:this.state.fileData.file.name})})))}_renderPlayVideoIcon(){return i.createElement(i.View,{style:[S.default.absoluteFill,C.playButtonWrapperBg]},i.createElement(i.View,{style:C.playButtonWrapper},i.createElement(d.default,{icon:g.SkypeIcon.Play,size:g.IconSize.size24,color:u.Color.white})))}_renderThumbnailsPreview(e){return i.createElement(o.ImagePreview,{imagePreviewHeight:_,imagePreviewWidth:_,urlThumbnail:e,borderRadius:6})}}t.default=b},64862:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(89391),r=s(47447),a=s(14920),l=s(14980),d=s(11930),c=s(46096),h=s(35933),u=s(61317),p=s(53559),g=s(11375),m=s(10117),S=s(48638),f=s(15877),y=s(33754),_=s(18743),v=s(19243),C=s(6286),b=s(3088),T=s(45983),M=s(68080),I=s(22669),w=s(81760),P=s(11828),k=s(80837),A=s(60305),E=s(24576),R=s(18037),L=s(48790),F=(0,f.lazyProperties)({mediaPreviewItems:()=>o.Styles.createViewStyle({flexDirection:"row",flex:1,flexWrap:"wrap",overflow:"visible"}),mediaPreview:()=>o.Styles.createViewStyle({flex:1,paddingLeft:10,paddingRight:10,paddingTop:10}),plusContainer:()=>o.Styles.createViewStyle({height:135,width:60,borderRadius:6,justifyContent:"center",alignItems:"center"})});class x extends E.default{constructor(){super(...arguments),this._createGalleryPreviews=e=>i.reduce(e,((e,t)=>{const{thumbnailUrl:s,videoThumbnailUrl:i,data:o,uid:n}=t,r=p.default.isVideoExtension(o.extension);if(p.default.isImageExtension(o.extension)){const t={id:n,mediaType:I.PictureViewer.MediaType,thumbnailUrl:s,displayResolutionUrl:s,fullResolutionUrl:s};e.push(t)}else if(r&&i){const t={id:n,mediaType:L.VideoViewer.MediaType,thumbnailUrl:s,videoUrl:i,resumeVideo:!0,loop:!1,useGlobalMute:!0};e.push(t)}return e}),[]),this._showGallery=e=>{const t=i.find(this.state.galleryPreviews,(t=>t.id===e.uid));t&&this._showMediaViewer(t)},this._showMediaViewer=e=>{b.default.increaseOpenGalleryCount(this.props.conversationId),M.default.showWithConfig({initialMedia:e,totalMedia:this.state.galleryPreviews.length,rootViewId:this._getRootViewId(),controller:{getOptions:this._getControllerOptions,getNextMedia:this._getControllerNextMedia,getPreviousMedia:this._getControllerPreviousMedia}})},this._getControllerOptions=()=>({dismissAnimationType:T.DismissAnimationType.Vertical,animateOpenClose:!0}),this._getControllerNextMedia=e=>{const t=i.findIndex(this.state.galleryPreviews,(t=>t.id===e.id));return-1===t||t+1>=this.state.galleryPreviews.length?void 0:this.state.galleryPreviews[t+1]},this._getControllerPreviousMedia=e=>{const t=i.findIndex(this.state.galleryPreviews,(t=>t.id===e.id));return t<=0?void 0:this.state.galleryPreviews[t-1]},this._renderPreview=(e,t)=>o.createElement(v.default,{key:"key"+e.uid,preview:e,index:t,onItemPress:this._showGallery,onItemRemoved:this._onRemoveItem,isNavigatingWithKeyboard:this.state.isNavigatingWithKeyboard}),this._onRemoveItem=e=>{b.default.removePreview(this.props.conversationId,e)},this._shouldRenderComponent=()=>!i.isEmpty(this.state.previews)&&this.state.isMediaPreviewEnabled,this._onAddMoreIconPress=e=>{const t={capturedContentHandler:new a.CapturedContentHandlerForPosting(this.props.conversationId),conversationId:this.props.conversationId,allowVideo:!0,mediaPickerOnly:!0,mediaPickerShouldCollapseFully:!0,allowMultiple:!0,willDismissOnSend:!0},s=e=>{if(C.default.isMediaPreviewEnabled(this.props.conversationId))return C.default.addPreviews([e],this.props.conversationId,c.PostSource.MediaPreview)};r.UICapabilities.desktopFilePickerSupported()?u.FilePickerUtils.isDocumentPickerSupported()?u.FilePickerUtils.showDocumentPicker(s,this._getRootViewId(),this.state.previews.length):u.FilePickerUtils.showMultiFilesPicker(s,_.FilePickerOrigin.MediaPreview,void 0,this._getRootViewId(),e,this.state.previews.length):A.default.useTabletUINoSubscription()&&(d.default.registerMobileFocusHandler(g.FocusEvent.CloseMobileModal,(()=>this.isComponentMounted()?this._iconButton:void 0)),l.navigateToCaptureComboModalWithParams(t,this._getContext()))},this._onIconRef=e=>{this._iconButton=e||void 0},this._getIconRef=()=>this._iconButton,this._onLayoutChange=e=>{if(!this.isComponentMounted())return;e.x,e.y,e.width;const t=e.height;t>this.state.previewHeight?this.setState({previewHeight:189}):t<this.state.previewHeight&&this.setState({previewHeight:156})},this._showFileLimitAlert=()=>{h.show(this._getRootViewId())}}_buildState(e,t){const s=b.default.getPreviews(e.conversationId);return{previews:s,galleryPreviews:this._createGalleryPreviews(s),isMediaPreviewEnabled:C.default.isMediaPreviewEnabled(e.conversationId),previewHeight:156,usesDarkTheme:R.default.useDarkTheme(),isNavigatingWithKeyboard:S.default.isNavigatingWithKeyboard(),fileLimit:n.default.getS4LMessagingFeatures().limitForFilePicker}}componentDidMount(){super.componentDidMount(),this._previewLimitSubscription=b.default.previewLimitExceeded.subscribe(this._showFileLimitAlert)}componentDidUpdate(e,t,s){if(super.componentDidUpdate(e,t,s),t.previews.length<this.state.previews.length){const e=this.state.previews.length-t.previews.length||0,s=y.getString("MediaPreview.AddedItem",{count:e});o.Accessibility.announceForAccessibility(s)}}componentWillUnmount(){super.componentWillUnmount(),this._previewLimitSubscription&&(this._previewLimitSubscription.unsubscribe(),this._previewLimitSubscription=void 0)}_renderAddMoreButton(){const e=o.Styles.createViewStyle({backgroundColor:this.state.usesDarkTheme?w.Color.whiteOverlay20:this._themeColors.secondaryTextColor},!1);return o.createElement(o.Button,{style:[F.plusContainer,e],onPress:this._onAddMoreIconPress,ref:this._onIconRef,title:y.getString("MediaPreview.AttachMoreFilesButton")},o.createElement(m.default,{icon:P.SkypeIcon.Plus,size:P.IconSize.size24,color:w.Color.white}))}UNSAFE_componentWillReceiveProps(e,t){this.props.conversationId!==e.conversationId&&(n.default.getS4LMessagingFeaturesNoSubscription().enableMediaPreviewDrafts?b.default.markSavedAsDraft(this.props.conversationId):b.default.destroy(this.props.conversationId,!0)),super.UNSAFE_componentWillReceiveProps(e,t)}render(){if(!this._shouldRenderComponent())return null;const e=this.state.previews.length<this.state.fileLimit?this._renderAddMoreButton():void 0,t=o.Styles.createScrollViewStyle({height:this.state.previewHeight},!1),s=o.Styles.createViewStyle({borderBottomWidth:1,borderColor:this._themeColors.secondaryTextColor,borderStyle:"solid"},!1);return o.createElement(o.View,{style:[F.mediaPreview,t]},o.createElement(o.View,{style:[s,k.default.flexOne]},o.createElement(o.ScrollView,{style:k.default.flexOne},o.createElement(o.View,{style:F.mediaPreviewItems,onLayout:this._onLayoutChange},this.state.previews.map(this._renderPreview),e))))}}t.default=x},54757:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(15069),o=s(96486),n=s(16778),r=s(97691),a=s(89391),l=s(46096),d=s(11375),c=s(36237),h=s(8145),u=s(71540),p=s(64642),g=s(24576),m=[d.FocusEvent.CloseRightPanel,d.FocusEvent.RefreshConversation,d.FocusEvent.DeclineCallFromCallBanner,d.FocusEvent.ClosePurchaseDialog,d.FocusEvent.VideoMessageClosed,d.FocusEvent.CloseUnansweredCallPanel];d.FocusEvent.CloseRightPanel,d.FocusEvent.CloseUnansweredCallPanel,d.FocusEvent.CloseMobileSearchInConversation;class S extends g.default{constructor(){super(...arguments),this.handleFocusEvent=e=>(c.log(l.LogTraceArea.GenericUnsafe,"MessageComposer.handleFocusEvent"),!(!o.includes(m,e)||!this._child)&&(e===d.FocusEvent.VideoMessageClosed?this._child.focusVideoButton():this._child.requestFocus(),!0)),this._onChildRef=e=>{this._child=e||void 0}}_shouldUseComposerForAndroidBrowser(){return a.default.getS4LMessagingFeatures().enableComposerForAndroidBrowser&&i.BrowserEnvironment.isAndroid()}_buildState(e,t){let s={useMessageComposerWithPopup:a.default.getS4LMessagingFeatures().enableDesktopComposerWithPopUpMenu&&!0,useMessageComposerForAndroidBrowser:this._shouldUseComposerForAndroidBrowser()};return c.log(l.LogTraceArea.MessageComposer,"MessageComposer version: "+(s.useMessageComposerWithPopup?"DesktopComposerWithPopup":"V2")),s}componentDidMount(){super.componentDidMount(),d.register(m,this)}componentWillUnmount(){super.componentWillUnmount(),d.unregister(m,this)}blur(){this._child&&this._child.blur()}blurIfFocused(){this._child&&this._child.blurIfFocused()}requestFocus(){this._child&&this._child.requestFocus()}focusVideoButton(){this._child&&this._child.focusVideoButton&&this._child.focusVideoButton()}focusSendButton(){this._child&&this._child.focusSendButton&&this._child.focusSendButton()}focusOverflowButton(){this._child&&this._child.focusOverflowButton&&this._child.focusOverflowButton()}isFocused(){return!!this._child&&this._child.isFocused()}setTextInputAccessibilityFocus(){this._child&&this._child.setTextInputAccessibilityFocus()}getInputEntities(){return this._child?this._child.getInputEntities():r.Resolved([])}autoReplaceText(e,t,s){this._child&&this._child.autoReplaceText(e,t,s)}insertSearchResult(e,t,s){this._child&&this._child.insertSearchResult(e,t,s)}replaceText(e,t,s,i){this._child&&this._child.replaceText(e,t,s,i)}abortTextAutoCompletion(){this._child&&this._child.abortTextAutoCompletion()}getDesktopOverflowConfig(){return this._child?this._child.getDesktopOverflowConfig():void 0}render(){return this.state.useMessageComposerForAndroidBrowser?n.createElement(p.default,Object.assign({ref:this._onChildRef},this.props)):this.state.useMessageComposerWithPopup?n.createElement(u.default,Object.assign({ref:this._onChildRef},this.props)):n.createElement(h.default,Object.assign({ref:this._onChildRef},this.props))}}t.default=S},64642:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(15069),n=s(62698),r=s(25465),a=s(79737),l=s(16778),d=s(97691),c=s(4736),h=s(89391),u=s(80843),p=s(68894),g=s(66988),m=s(39119),S=s(78723),f=s(94655),y=s(16625),_=s(48649),v=s(47447),C=s(5531),b=s(51267),T=s(71908),M=s(51077),I=s(71830),w=s(96418),P=s(11009),k=s(98278),A=s(54549),E=s(8223),R=s(81632),L=s(17677),F=s(20770),x=s(39549),O=s(86374),D=s(84817),B=s(43368),V=s(10547),N=s(37490),U=s(52262),H=s(30757),z=s(82433),W=s(70891),j=s(4604),G=s(46096),K=s(1014),q=s(29245),Q=s(61317),X=s(53559),$=s(80469),J=s(30387),Y=s(13944),Z=s(66649),ee=s(97174),te=s(23944),se=s(36237),ie=s(61253),oe=s(72490),ne=s(47126),re=s(15877),ae=s(33754),le=s(88824),de=s(80372),ce=s(24897),he=s(38915),ue=s(9748),pe=s(18743),ge=s(64862),me=s(6286),Se=s(3088),fe=s(47193),ye=s(61428),_e=s(23752),ve=s(22929),Ce=s(71639),be=s(6658),Te=s(12056),Me=s(40897),Ie=s(44972),we=s(45532),Pe=s(89808),ke=s(78735),Ae=s(4735),Ee=s(17252),Re=s(33348),Le=s(43501),Fe=s(79348),xe=s(63584),Oe=s(99070),De=s(85207),Be=s(29130),Ve=s(57946),Ne=s(15963),Ue=s(20360),He=s(86045),ze=s(37589),We=s(15301),je=s(49769),Ge=s(97639),Ke=s(63080),qe=s(95960),Qe=s(50795),Xe=s(81760),$e=s(40363),Je=s(11010),Ye=s(11828),Ze=s(78262),et=s(80837),tt=s(24576),st=s(26712),it=s(73096),ot=s(72758),nt=s(53374),rt=s(56503),at=/^[,.;:?!'].*/;var lt;!function(e){e[e.OverflowButton=0]="OverflowButton",e[e.OverflowButtonCoachMark=1]="OverflowButtonCoachMark"}(lt||(lt={}));const dt=(0,re.lazyProperties)({composerArea:()=>l.Styles.createViewStyle({flex:1,flexDirection:"row"}),compositionAreaContainer:()=>l.Styles.createViewStyle({position:"absolute",flexDirection:"row",left:0,right:0,bottom:0}),compositionArea:()=>l.Styles.createViewStyle({paddingLeft:8,flex:1,justifyContent:"center"}),inputArea:()=>l.Styles.createViewStyle({flexDirection:"row"}),expandableArea:()=>l.Styles.createViewStyle({flex:1,maxHeight:96,backgroundColor:Xe.Color.transparent}),expandableAreaWithQuote:()=>l.Styles.createViewStyle({flex:1,maxHeight:48}),composerInner:()=>l.Styles.createViewStyle({flex:1,flexDirection:"row",marginVertical:9,marginHorizontal:13}),rightControlContainer:()=>l.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),quoteArea:()=>l.Styles.createViewStyle({flex:1,paddingTop:6,paddingLeft:12}),multiQuoteArea:()=>l.Styles.createViewStyle({flex:1,flexDirection:"row",marginTop:15,marginBottom:0,marginLeft:20,marginRight:20}),multiQuoteAreaMessages:()=>l.Styles.createViewStyle({flex:1,flexDirection:"row",maxHeight:126,paddingBottom:15,borderBottomWidth:1,borderStyle:"solid"}),multiQuoteAreaMessage:()=>l.Styles.createViewStyle({marginBottom:12}),multiQuoteAreaLastMessage:()=>l.Styles.createViewStyle({marginBottom:0}),multiQuoteAreaClearButton:()=>l.Styles.createButtonStyle({alignSelf:"flex-start"}),quoteTextStyle:()=>l.Styles.createTextStyle({fontStyle:"italic"}),quoteAttributeStyle:()=>l.Styles.createTextStyle({fontSize:Je.default.controlFontSize.messageStreamQuoteAttributeDesktop,marginTop:0,marginBottom:0}),sendButton:()=>l.Styles.createViewStyle({height:50}),actionButtonWithBackground:()=>l.Styles.createViewStyle({height:40,width:40,borderRadius:20}),actionButtonVerticalCenter:()=>l.Styles.createViewStyle({alignSelf:"center"}),skypeMessageTextInput:()=>l.Styles.createTextStyle({font:Je.default.font.uiDisplayRegular,fontSize:Je.default.controlFontSize.messageComposerDesktop,minHeight:23,backgroundColor:Xe.Color.transparent}),textInputFocusButton:()=>l.Styles.createButtonStyle({position:"absolute",top:0,bottom:0,left:0,right:0,backgroundColor:Xe.Color.transparent}),linkStyle:()=>l.Styles.createTextStyle({fontSize:Je.default.controlFontSize.body,lineHeight:18,color:Xe.Color.gray400,fontFamily:Je.default.fontFamily.uidDisplayRegular,textDecorationLine:"underline"}),emoteAuthor:()=>(0,re.lazyProperties)({text:()=>l.Styles.createTextStyle({fontSize:Je.default.controlFontSize.messageComposerDesktop,marginTop:7,fontStyle:"italic"}),textDesktop:()=>l.Styles.createTextStyle({marginTop:5,marginBottom:3})}),desktopOverrides:()=>(0,re.lazyProperties)({messageComposer:()=>l.Styles.createViewStyle({minHeight:48,justifyContent:"center",borderColor:Xe.Color.transparent,borderStyle:"solid",borderWidth:3}),doNotFormatLightTheme:()=>l.Styles.createViewStyle({borderColor:Xe.Color.gray100}),doNotFormatDarkTheme:()=>l.Styles.createViewStyle({borderColor:Xe.Color.gray300}),messageComposerAllRoundCorners:()=>l.Styles.createViewStyle({borderRadius:24}),messageComposerTopFlatCorners:()=>l.Styles.createViewStyle({borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:24,borderBottomRightRadius:24}),compositionAreaContainer:()=>l.Styles.createViewStyle({flexDirection:"column"}),quoteArea:()=>l.Styles.createViewStyle({flex:1,paddingTop:15,paddingBottom:0,paddingLeft:20,paddingRight:20}),compositionArea:()=>l.Styles.createViewStyle({paddingLeft:12,paddingRight:12}),expandableArea:()=>l.Styles.createViewStyle({maxHeight:175}),expandableAreaWithQuote:()=>l.Styles.createViewStyle({maxHeight:133}),expandableAreaSmallView:()=>l.Styles.createViewStyle({maxHeight:133}),expandableAreaWithQuoteSmallView:()=>l.Styles.createViewStyle({maxHeight:91}),composerInner:()=>l.Styles.createViewStyle({marginVertical:2,marginLeft:-1,marginRight:9}),rightControlContainer:()=>l.Styles.createViewStyle({minHeight:48,marginLeft:4,alignItems:"flex-end"}),composerInnerIconWrapper:()=>l.Styles.createViewStyle({alignSelf:"flex-end",height:40,justifyContent:"center"})}),mediaBarWrapper:()=>l.Styles.createViewStyle({flexDirection:"row",height:50,alignItems:"center"}),mirrorText:()=>l.Styles.createTextStyle({color:Xe.Color.transparent}),sharedInputAndMirror:()=>l.Styles.createTextInputStyle({paddingVertical:0,paddingHorizontal:0,margin:0,fontSize:Je.default.controlFontSize.messageComposerDesktop,font:Je.default.font.uiDisplayRegular,wordBreak:"break-word",backgroundColor:Xe.Color.transparent,minHeight:22}),textInputContainer:()=>l.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,flexDirection:"row"}),textInput:()=>l.Styles.createTextInputStyle({flex:1,flexDirection:"row"}),entityText:()=>l.Styles.createTextStyle({flexDirection:"row",alignSelf:"center"}),atMentionText:()=>l.Styles.createTextStyle({borderRadius:4,backgroundColor:Xe.Color.blueOverlay10}),atMentionTextDark:()=>l.Styles.createTextStyle({borderRadius:4,backgroundColor:Xe.Color.blueOverlay30})});let ct=45;class ht extends tt.default{constructor(){super(...arguments),this._isPostingMessage=!1,this._isComposing=!1,this._inputAreaText="",this._currentSelectionStart=0,this._currentSelectionEnd=0,this._inputTextBeforeInsertion="",this._gotInitialInputAreaHeight=!1,this._inputAreaHeight=ct,this._inputAreaTargetHeight=this._inputAreaHeight,this._inputAreaHeightValue=new l.Animated.Value(this._inputAreaHeight),this._inputAreaHeightStyle=l.Styles.createAnimatedViewStyle({height:this._inputAreaHeightValue}),this._onEmoticonSelected=e=>{this.autoReplaceText(e.text(),"Emoticon",e)},this._onMojiSelected=e=>{this.props.conversationId&&(De.default.postMessageFromInput(this.props.conversationId,G.PostSource.MediaPicker,[e],M.MessageTypes.Media_FlikMsg,{name:Ne.ScenarioName.SendMoji},void 0,this._getRootViewType()),this._announceForAccessibilityForMessageSent()),this._closePesPickerAndFocusTextInput()},this._onStickerSelected=e=>{this.props.conversationId&&(De.default.postMessageFromInput(this.props.conversationId,G.PostSource.MediaPicker,[e],M.MessageTypes.RichText,{name:Ne.ScenarioName.SendSticker},void 0,this._getRootViewType()),this._announceForAccessibilityForMessageSent()),this._closePesPickerAndFocusTextInput()},this._onGifSelected=e=>{this.props.conversationId&&(De.default.postMessageFromInput(this.props.conversationId,G.PostSource.MediaPicker,[e],M.MessageTypes.RichText,{name:Ne.ScenarioName.SendGif},void 0,this._getRootViewType()),this._announceForAccessibilityForMessageSent()),this._closePesPickerAndFocusTextInput()},this._closePesPickerAndFocusTextInput=()=>{this._closeUnifiedPesPickerDesktop(),this.setTextInputAccessibilityFocus()},this._onSMSInfoLineRef=e=>{this._smsInfoLineRef=e||void 0},this._onClearQuoteButtonPress=()=>{this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(!0)},this._onPhoneNumberForSmsSelected=e=>{const t=nt.default.newCauseId();se.log(G.LogTraceArea.MessageComposer,"MessageComposer._onPhoneNumberForSmsSelected causeId: "+t),this.state.useThreadsFor2way&&this.state.twoWaySMSCapable?e&&Ae.default.navigateToConversation({convId:I.getMriFromPhoneNumber(e),origin:G.NavigationConversationOrigin.SMSNumberSwitch,selectedNumberForSMS:e,causeId:t}):Ae.default.navigateToConversation({convId:this.props.conversationId,origin:G.NavigationConversationOrigin.SMSNumberSwitch,selectedNumberForSMS:e,causeId:t})},this._debounceNewTextBeforeInsertionChanged=i.debounce(((e,t)=>{if(this.isComponentMounted()&&this.props.onInputTextChanged){const s=!(i.isEmpty(t)||i.last(t)instanceof ee.UnhandledEntity);this._inputTextBeforeInsertion!==e&&(this._inputTextBeforeInsertion=e,this.props.onInputTextChanged(e,s))}}),100),this._stopComposingDebounced=i.debounce(this._stopComposing,5e3),this._startComposingThrottled=i.throttle((()=>{this._isComposing=!0,it.default.setComposingState(!0,this.props.conversationId)}),1e4,{leading:!0}),this._onScroll=(e,t)=>{this.isComponentMounted()&&this.setState({offsetTop:t})},this._onSelectionChanged=(e,t)=>{if(this._textInputRef&&(this._currentSelectionStart=e,this._currentSelectionEnd=t,e===t)){let t=this._inputAreaText.substr(0,e);this._debounceNewTextBeforeInsertionChanged(t,this.state.inputEntities)}},this._onKeyPress=e=>{if(this.props.onKeyPress&&this.props.onKeyPress(e))return e.stopPropagation(),void e.preventDefault();if(e.keyCode!==ne.default.ENTER&&i.defer((()=>{const e=this._textInputRef;if(e){let t=e.getSelectionRange(),s=t.start===t.end?this._inputAreaText.substr(0,t.start):"";this._debounceNewTextBeforeInsertionChanged(s,this.state.inputEntities)}})),e.keyCode===ne.default.ENTER)this._handleEnterCombinations(e);else if(e.keyCode===ne.default.UP&&0===this.state.inputEntities.length)this.props.onEditLastMessage&&(se.log(G.LogTraceArea.MessageComposer,"onEditLastMessage"),this.props.onEditLastMessage()),e.stopPropagation(),e.preventDefault();else if(e.keyCode===ne.default.ESCAPE){if(this.state.selectedMediaBarItem===ue.MediaBarItemKeys.Emoticon||this.state.isShowingUnifiedPesPickerDesktop)return;this.props.quotedMessages&&this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(!0),this.props.editedMessage&&this.props.onClearEdit&&this._clearTextInput()}else e.keyCode===ne.default.DELETE&&(0===this.state.inputEntities.length||1===this.state.inputEntities.length&&this.state.inputEntities[0]instanceof ee.EmoteEntity)&&(this.props.quotedMessages&&this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(!0),this.props.editedMessage&&this.props.onClearEdit&&this.props.onClearEdit(),F.default.clearMessageInput(this.props.conversationId))},this._onInput=e=>{if(i.defer((()=>{this.isComponentMounted()&&this._afterNextOnInput&&(this._afterNextOnInput(),this._afterNextOnInput=void 0)})),this._inputAreaText===e)return;this._inputAreaText=e;const t=this._textInputRef;if(!t)return;let s=this._updateInputEntities(this.state.inputEntities,e);const o=te.getRawText(s.newEntities);if(o!==e||s.insertionAdjustment){const e=t.getSelectionRange().end+s.insertionAdjustment;i.defer((()=>{this.isComponentMounted()&&(t.setValue(o),t.selectRange(e,e))}))}this._debounceNewTextBeforeInsertionChanged(o.substr(0,t.getSelectionRange().end),s.newEntities),this.isComponentMounted()&&this.setState({inputEntities:s.newEntities});0!==e.length&&t.isFocused()?(this._stopComposingDebounced.cancel(),this._startComposingThrottled()):this._stopComposingDebounced()},this._shouldDefaultPaste=e=>!(this.state.enableMultiMessageQuote&&this.state.pasteAsQuotePreference&&ve.default.hasContent(e)),this._saveMessage=e=>{if(e&&e.length>0||this._hasQuotes()||this.props.editedMessage){let t,s=Ve.SavedMessageType.None;this.props.editedMessage?(t=[this.props.editedMessage],s=Ve.SavedMessageType.Edited):this.props.quotedMessages&&(t=this.props.quotedMessages,s=Ve.SavedMessageType.Quoted),F.default.saveMessageInput(this.props.conversationId,{messages:t,type:s,inputEntities:e,inputEntitiesDataVersion:this.state.inputEntitiesDataVersion,timestamp:Date.now()})}else F.default.clearMessageInput(this.props.conversationId)},this._onCancelPesSearch=(e,t)=>{e&&F.default.clearMessageInput(this.props.conversationId);const s=F.default.getSavedMessageInput(this.props.conversationId);(!s||s&&i.isEmpty(s.messages))&&(this.props.quotedMessages&&this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(),this.props.editedMessage&&this.props.onClearEdit&&this.props.onClearEdit());const o=s?s.inputEntities:[];this._setInputEntityStateDownstream(o,t),this.isComponentMounted()&&this.setState({selectedMediaBarItem:""})},this._onTextInputRef=e=>{this._textInputRef=e||void 0},this._onClearEditMessageQuote=()=>{this.isComponentMounted()&&this.setState({inputEntities:this.state.inputEntities.slice(1,this.state.inputEntities.length)})},this._renderEmoticonPickerItem=e=>l.createElement(H.EmoticonPickerItem,Object.assign({},e)),this._renderMojiPickerItem=e=>l.createElement(we.MojiPickerItem,Object.assign({},e)),this._renderGifPickerItem=e=>l.createElement(J.GifPickerItem,Object.assign({},e)),this._renderStickerPickerItem=e=>l.createElement(qe.StickerPickerItem,Object.assign({},e)),this._renderSmsItem=e=>l.createElement(Ke.SmsItem,Object.assign({},e)),this._renderMediaPickerItem=e=>l.createElement(q.default,Object.assign({acceptedFileTypes:q.AcceptedFileTypes.MediaOnly},e)),this._renderFilePickerItem=e=>l.createElement(q.default,Object.assign({acceptedFileTypes:q.AcceptedFileTypes.All},e)),this._renderCameraItem=e=>l.createElement(_.CameraItem,Object.assign({},e)),this._renderScheduleCallItem=e=>l.createElement(Ue.ScheduleCallItem,Object.assign({},e)),this._renderPollItem=e=>l.createElement(Oe.PollItem,Object.assign({},e)),this._renderLocationPickerItem=e=>l.createElement(le.default,Object.assign({},e)),this._renderContactPickerItem=e=>l.createElement(E.ContactPickerItem,Object.assign({},e)),this._renderBingSearchItem=e=>l.createElement(S.BingSearchItem,Object.assign({},e)),this._renderVideoMessageItem=e=>l.createElement(rt.default,Object.assign({},e)),this._renderPeopleItem=e=>l.createElement(Le.PeopleItem,Object.assign({},e)),this._renderAudioMessageItem=e=>l.createElement(g.AudioMessageItem,Object.assign({},e)),this._renderSendCreditItem=e=>l.createElement(ze.SendCreditItem,Object.assign({},e)),this._onMediaBarRef=e=>{this._mediaBarRef=e||void 0},this._renderPesPickerPopup=()=>l.createElement(Fe.PesPickerPopup,{ref:this._onPesPickerPopupRef,renderMobileInterface:!1}),this._onPesPickerPopupRef=e=>{this._pesPickerPopup=e||void 0},this._getPesPickerPopupRef=()=>this._pesPickerPopup,this._onCustomKeyboardClose=()=>{this._pesPickerPopup&&this._pesPickerPopup.hide()},this._onLayoutInputArea=e=>{const t=Math.ceil(e.height);this._gotInitialInputAreaHeight?(this._inputAreaTargetHeight=t,this._animateInputAreaToTargetHeight()):(this._inputAreaTargetHeight=t,this._inputAreaHeight=t,this._inputAreaHeightValue.setValue(t),ct=t,this._gotInitialInputAreaHeight=!0)},this._onHandleCustomAction=(e,t)=>{switch(e){case Ze.MediaBarCustomAction.LaunchCamera:this.props.onLaunchCamera&&this.props.onLaunchCamera();break;case Ze.MediaBarCustomAction.LaunchEmoticon:xe.EmoticonPickerTelemetry.startOpenScenario(),xe.EmoticonPickerTelemetry.open(),this._onPickerActive(ue.MediaBarItemKeys.Emoticon);break;case Ze.MediaBarCustomAction.LaunchMoji:xe.MojiPickerTelemetry.open(),this._onPickerActive(ue.MediaBarItemKeys.Moji);break;case Ze.MediaBarCustomAction.LaunchSticker:xe.StickerPickerTelemetry.open(),this._onPickerActive(ue.MediaBarItemKeys.Sticker);break;case Ze.MediaBarCustomAction.LaunchGif:xe.GifPickerTelemetry.open(),this._onPickerActive(ue.MediaBarItemKeys.Gif);break;default:se.log(G.LogTraceArea.MessageComposer,"_onHandleCustomAction unhandled action: "+e)}},this._onComposerOverflowPress=()=>{se.track(new pe.MediaBarItemPressed(lt[lt.OverflowButton],!0,this.props.conversationId,he.MediaBarItemOrigin.MessageComposer))},this._onDismissMediaPicker=()=>{r.default.showNativeKeyboard(),this.isComponentMounted()&&this.setState({selectedMediaBarItem:""})},this._onUnifiedPesPickerDesktopPress=()=>{this.state.isShowingUnifiedPesPickerDesktop||(xe.EmoticonPickerTelemetry.startOpenScenario(),B.default.open(this._getRootViewId()))},this._closeUnifiedPesPickerDesktop=()=>{this.state.isShowingUnifiedPesPickerDesktop&&B.default.close(this._getRootViewId())},this._onPickerActive=e=>{this.isComponentMounted()&&this.setState({selectedMediaBarItem:e})},this._onMediaBarItemSelected=e=>{this.state.selectedMediaBarItem!==e&&(this.isComponentMounted()&&this.setState({selectedMediaBarItem:e===ue.MediaBarItemKeys.Sms?"":e}),this.props.onMediaItemSelected&&this.props.onMediaItemSelected()),e===ue.MediaBarItemKeys.Sms&&(1===this.state.phoneNumbers.length?this._toggleSmsSending(!0,this.state.phoneNumbers[0]):je.default.showNumberSelectionPopup((()=>this._smsInfoLineRef),this._getRootViewId(),this.props.conversationId,this.state.phoneNumbers,!1).then((e=>{this._toggleSmsSending(!0,e)})).catch(i.noop))},this._onCancelEditClick=e=>{e.stopPropagation(),ht._announceForAccessibility(ae.getString("MessageComposer.MessageEditingCanceledLabel")),this._handleAfterPostMessage(this.props.conversationId)},this._onSendButtonClick=e=>{e.stopPropagation(),this._sendMessage()},this._onInputButtonRef=e=>{this._inputButton=e||void 0},this.insertSearchResult=(e,t,s)=>{if(this._announceForAccessibility(e),this._textInputRef){let e=[];const t=F.default.getSavedMessageInput(this.props.conversationId);t&&t.inputEntities&&(e=t.inputEntities),this._appendEntityToList(e,s);const i=te.getRawText(e);this._textInputRef.setValue(i),this._inputAreaText=i,this.isComponentMounted()&&this.setState({inputEntities:e})}Me.default.deactivateInlineSearch()},this.autoReplaceText=(e,t,s)=>{let i=0;const o=this._textInputRef;if(o){let e=o.getSelectionRange();i=e.end-e.start}l.UserInterface.isNavigatingWithKeyboard()&&this.state.selectedMediaBarItem&&ce.MediaBarItem.dismissPopup(this._getRootViewId()),this._announceForAccessibility(e),this.replaceText(i,e,t,s)},this._onPartiallyEnteredMsgStoreUpdated=e=>{if(e===this.props.conversationId){const t=F.default.getSavedMessageInput(e);t&&t.inputEntitiesDataVersion===this.state.inputEntitiesDataVersion&&this._setInputEntityStateUpstream(t.inputEntities)}},this._onCompositionAreaPress=e=>{this.state.hasFocus||this._hasQuotes()||this.requestFocus()},this._onCompositionAreaKeyPress=e=>{e.keyCode===ne.default.ESCAPE&&this.isComponentMounted()&&this._moreButton&&this._moreButton.requestFocus()},this._onFocus=()=>{let e={hasFocus:!0};this.isComponentMounted()&&this.setState(e)},this._onBlur=()=>{const e={hasFocus:!1};this.isComponentMounted()&&this.setState(e),this.props.onBlur&&this.props.onBlur()},this._onPaste=e=>{if(!this._shouldDefaultPaste(e.nativeEvent)&&this.props.onKeyboardPaste)return void this.props.onKeyboardPaste(e);const t=e.nativeEvent;this.props.disableCopyPasteMedia||i.isEmpty((0,$.get)(t,["clipboardData","items"]))||i.some(t.clipboardData.items,(e=>"text/plain"===e.type))||(i.each(t.clipboardData.items,(t=>{if("image/png"===t.type){e.stopPropagation(),e.preventDefault();const s=new FileReader;let o=t.getAsFile();if(o instanceof e.nativeEvent.target.ownerDocument.defaultView.Blob){const e="image_"+(new Date).toISOString().replace(/[:\.\-]/g,"_")+".png",t=i.attempt((t=>new File([t],e,{type:t.type})),o);i.isError(t)||(o=t),s.onload=()=>{if(o&&o.size>0){let e={file:o,extension:X.default.extractFileExtension(o.name)};this._sendFileWithDimensions(e)}},s.readAsDataURL(o)}}})),ht._announceForAccessibility(ae.getString("MessageComposer.FilesSentLabel")))},this._getQuoteEntity=e=>{const t=U.default.getDisplayName(e.creator,!0),s=L.quoteMessage(e,t);return new ee.QuoteEntity(s,t,e,this.props.quotesTriggerType)},this._announceForAccessibilityForMessageSent=()=>{i.defer((()=>{this.isComponentMounted()&&ht._announceForAccessibility(ae.getString("MessageComposer.MessageSentLabel"))}))},this._handleEmoticonBackspacePress=e=>{const t=this._textInputRef;if(t){const s=this._inputAreaText;if(s.length>0){let i="";i=this._currentSelectionStart!==this._currentSelectionEnd?s.substring(0,this._currentSelectionStart)+s.substring(this._currentSelectionEnd,s.length):this._currentSelectionEnd!==s.length?s.substring(0,this._currentSelectionEnd-1)+s.substring(this._currentSelectionEnd,s.length):e?s.substring(0,s.lastIndexOf(" ")):s.substring(0,this._currentSelectionEnd-1);const o=this._updateInputEntities(this.state.inputEntities,i);this._inputAreaText=i,t.setValue(i),this.isComponentMounted()&&this.setState({inputEntities:o.newEntities})}}},this._showFilePicker=(e,t)=>{if(t!==this._getRootViewId())return!1;if(this.state.editable&&v.UICapabilities.desktopFilePickerSupported()&&!I.isPhoneMri(this.props.conversationId)&&!I.isS4BBridgeMri(this.props.conversationId)){const t=e=>{const t=X.default.extractFileExtension(e.file.name),s=this._getRootViewType();if(X.default.isVideoExtension(t)){const t={name:Ne.ScenarioName.SendVideo};De.default.postVideoWithThumbnail([this.props.conversationId],e,G.PostSource.MediaPicker,!1,t,void 0,void 0,void 0,s).then((()=>{ht._announceForAccessibility(ae.getString("MessageComposer.FileSentLabel"))}))}else if(X.default.isImageExtension(t)){const t={name:Ne.ScenarioName.SendPicture};De.default.postUpload([this.props.conversationId],e,G.PostSource.MediaPicker,!1,{scenarioInfo:t},s).then((()=>{ht._announceForAccessibility(ae.getString("MessageComposer.FileSentLabel"))}))}else{const t={name:Ne.ScenarioName.SendFile};De.default.postUpload([this.props.conversationId],e,G.PostSource.MediaPicker,!1,{scenarioInfo:t},s).then((()=>{ht._announceForAccessibility(ae.getString("MessageComposer.FileSentLabel"))}))}this.requestFocus()};Q.FilePickerUtils.isDocumentPickerSupported()?Q.FilePickerUtils.showDocumentPicker(t,this._getRootViewId()):Q.FilePickerUtils.showMultiFilesPicker(t,pe.FilePickerOrigin.MessageComposer,void 0,this._getRootViewId(),e)}return!0},this._editLastMessageKeyboardShortcut=(e,t)=>t===this._getRootViewId()&&(this._editLastMessage(),!0),this._focusKeyboardShortcut=(e,t)=>t===this._getRootViewId()&&(this.requestFocus(),!0),this._editLastMessage=()=>{this.props.onEditLastMessage&&this.props.onEditLastMessage()},this.requestFocus=()=>{this._textInputRef&&(o.BrowserEnvironment.isEngineEdgeHTML()&&document.activeElement&&document.activeElement.blur(),this._textInputRef.requestFocus())},this.blur=()=>{this._textInputRef&&this._textInputRef.blur()},this.focusVideoButton=()=>{const e=this._mediaBarRef?this._mediaBarRef.getItemById(ue.MediaBarItemKeys.VideoMessage):void 0;e&&e.requestFocus()},this.focusSendButton=()=>{this._inputButton&&this._inputButton.requestFocus()},this.focusOverflowButton=()=>{},this.setTextInputAccessibilityFocus=()=>{this._textInputRef&&(this.state.isSmallOrTinyScreen||this._textInputRef.setAccessibilityFocus(),this.props.explicitAccessibilityAnnoucement&&l.Accessibility.announceForAccessibility(this._placeholderText))}}_buildState(e,t){var s;const i=ke.default.getUserPreferencesLocal(),n={},r=this.props,l=this._getRootViewId(),d=h.default.getS4LMessagingFeatures(),c=h.default.getS4LCommerceFeatures();t&&(n.inputEntities=e.initialInputEntities||[],n.inputEntitiesDataVersion=e.initialInputEntitiesDataVersion||0,n.hasFocus=!1,n.selectedMediaBarItem="",n.offsetTop=0,n.currentNumberOfIconsInMediaBar=this._getContext().isPresentedInDesktopLeftNav||this._getContext().isPresentedInDesktopRightNav?1:3,n.pesPickerKeyboardHeight=276,n.messageComposerPastedContentType=a.PastedTextType.None,e.editedMessage&&(this._inputTextBeforeInsertion=te.getRawText(n.inputEntities),n.rawEditedMessage=this._inputTextBeforeInsertion)),n.delayedTriggersWaitTime=d.composerAutoCompletionDelay,n.enablePollExtensionEntryPoint=d.enablePollExtensionEntryPoint,n.enableMultiMessageQuote=d.enableMultiMessageQuoteOnKeyboard,n.mediaBarMenuOrder=d.mediaBarMenuOrder,n.enableInCallFindPanel=d.enableInCallFindPanel,n.useThreadsFor2way=d.useSmsThreadsFor2way,n.isConversationWithPhoneNumber=I.isConversationWithPhoneNumber(e.conversationId),n.doNotFormat=ke.default.getValueOfDoNotFormatPreferenceOrFalseIfDisabled(e.conversationId)&&!n.isConversationWithPhoneNumber,n.enableHandlingHTMLonPaste=!n.doNotFormat&&d.enableHandlingHTMLonPaste,n.enableHandlingHyperlinkOnPaste=!n.doNotFormat&&d.enableHandlingHyperlinkOnPaste,n.isSmallOrTinyScreen=Be.default.isSmallOrTinyScreenSize(l)||h.default.getS4LUiFeatures().enableResponsiveDesign&&o.EnvironmentInfo.isMobile(),n.editable=!Re.default.isAnimationPending()&&!e.disableActionOnMessageComposer,n.isSmallHeightView=Be.default.isSmallDesktopHeightView(l),n.viewportWidth=e.availableWidth||Be.default.getWidth(l),n.showAdditionalMediaBarItems=n.viewportWidth>=360,n.gradientColors=Pe.default.getGradientColors(),n.emoticons=z.default.getEmoticons(),n.isShowingUnifiedPesPickerDesktop=!e.hideMediaBar&&B.default.shouldShow(l),n.messageStreamFontSize=ke.default.getMessageStreamFontSize(),n.canUseAddins=C.default.addins().canUseAddins,n.editableEntities=fe.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives(n.inputEntities||[],n.emoticons);const{selectedTabType:u,searchQuery:p}=B.default.getPickerSearchProps();n.selectedTabType=u,n.searchQuery=p,n.isEncryptedThreadThread=I.isEncryptedThread(e.conversationId),n.showLocationPicker=!e.hideLocationPickerIcon&&d.enableLocationSharingOnDesktopAndWeb&&!$e.default.isFireOS(),n.showContactPicker=!e.hideContactPickerIcon&&d.enableContactShare&&C.default.contacts().canInvitePeople,n.showStickerPicker=!e.hideStickerPickerIcon&&!1,n.showGifPicker=!e.hideGifPickerIcon&&!1,n.showVideoMessageIcon=!e.hideVideoMessageIcon&&!n.isEncryptedThreadThread&&h.default.isDesktopVIMEnabled()&&(D.default.isAVDeviceReady()||o.BrowserEnvironment.isChrome()),n.phoneNumbers=e.otherPartyMri&&ot.default.getFullUserProfileByMri(e.otherPartyMri).phones||[];const g=I.isPhoneMri(e.conversationId);n.creditEntitlement=j.default.getCreditEntitlement(),n.enableOnewaySms=(g||c.smsPromo.unpaidUserEnabled||!!m.getPositiveCreditBalance(n.creditEntitlement)||j.default.userHasSubscriptions())&&(g||I.isOneOnOneConversation(e.conversationId))&&n.phoneNumbers.length>0&&!e.editedMessage&&!e.hideSmsIcon&&!I.isEncryptedThread(e.conversationId),n.quoteTextForSms=this._getQuotedTextForSms(r.quotedMessages,e.quotedMessages),n.disableHighBandwidthOperations=Z.default.isUsingGogoNetwork(),n.isCameraAvailable=v.UICapabilities.cameraSupported()&&b.default.isCameraAvailable(),n.sendMessageWithEnter=i.sendMessageWithEnter,n.pasteAsQuotePreference=i.pasteAsQuotesEnabled,n.twoWaySMSCapable=!!(null===(s=y.default.getCallerIdPrimaryNumber())||void 0===s?void 0:s.smsCapable);let S=e.phoneNumberForSendingSms;if(!S&&I.isPhoneMri(e.conversationId)){const t=I.getPhoneNumberFromMri(e.conversationId);t&&(S={number:t,type:Ze.PhoneNumberTypes.Other})}n.phoneNumberForSendingSms=S,n.isMediaPreviewEnabled=me.default.isMediaPreviewEnabled(e.conversationId),n.hasMediaPreviews=n.isMediaPreviewEnabled&&Se.default.getPreviews(e.conversationId).length>0,n.isSmsFailureScreenEnabled=n.enableOnewaySms&&c.callFailure.smsFailurePrompt.enabled,n.isOfficeLensAvailable=Ee.isOfficeLensAvailable();const f=(0,x.default)().getConversation(e.conversationId);return n.isRegularMemberInModeratedGroup=f&&(0,Ie.isRegularMemberInModeratedGroup)(f),n.sendMessageWithEnterEnabled=!!i.sendMessageWithEnter,t&&(We.default.setDefault(),We.default.commitNextFlowId(),this._checkForOutgoingSmsMessagesInConversation(n)),n}componentDidMount(){super.componentDidMount(),l.Modal.isDisplayed()||!this._shouldAutoFocusInput()&&!this.props.shouldAutoFocus||this.props.preventFocusOnMount||this.requestFocus(),this.state.overrideEditable&&this.setState({overrideEditable:void 0});const e=this._getContext().componentVisibilityStatus;e&&(this._visibilitySubscriptionToken=e.isVisibleEvent().subscribe((e=>{!e&&r.default.isSupported()&&r.default.dismiss()}))),oe.default.addHandler(G.KeyboardShortcut.SendFile,this._showFilePicker),oe.default.addHandler(G.KeyboardShortcut.EditMessage,this._editLastMessageKeyboardShortcut),oe.default.addHandler(G.KeyboardShortcut.FocusMessageComposer,this._focusKeyboardShortcut),this._keyboardDismissRegistrationHandle=N.register(this),F.default.onInputEntitiesUpdatedEvent.subscribe(this._onPartiallyEnteredMsgStoreUpdated)}_checkForOutgoingSmsMessagesInConversation(e){e.enableOnewaySms&&T.didUserSendSmsInLast30Days(this.props.conversationId).then((e=>{this.isComponentMounted()&&this.setState({hasOutgoingSmsInConversation:e})}))}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t);let s=!1,i={};this.props.conversationId&&e.conversationId&&this.props.conversationId===e.conversationId||(s=!0,i.inputEntities=this.props.initialInputEntities||[],i.inputEntitiesDataVersion=this.state.inputEntitiesDataVersion+1,i.hasOutgoingSmsInConversation=!1,i.phoneNumberForSendingSms=void 0,this._checkForOutgoingSmsMessagesInConversation(this.state),this._inputTextBeforeInsertion="");let o=[];if(e.initialInputEntities&&e.initialInputEntities!==this.props.initialInputEntities&&(s=!0,o=e.initialInputEntities),e.editedMessage&&e.editedMessage!==this.props.editedMessage){let t=O.decode(e.editedMessage);o=R.toEntities(t,{supportEmoticons:!0,supportLinkEntity:this.state.enableHandlingHyperlinkOnPaste}),s=!0,i.phoneNumberForSendingSms=void 0,this._inputTextBeforeInsertion=te.getRawText(this.state.inputEntities),i.rawEditedMessage=te.getRawText(o)}else e.editedMessage||(i.rawEditedMessage=void 0);this.props.editedMessage&&!e.editedMessage&&(s=!0,i.phoneNumberForSendingSms=void 0,this.state.inputEntities.length&&this.state.inputEntities[0]instanceof ee.EmoteEntity&&(o=[])),s&&(this._setInputEntityStateDownstream(o),this.setState(i))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);let o=this.state.selectedMediaBarItem,n=!1;e&&e.conversationId&&this.props.conversationId&&e.conversationId===this.props.conversationId||(n=this._shouldAutoFocusInput());const r=this._hasQuotes()&&!(0,ie.default)(this.props.quotedMessages,e.quotedMessages),a=this.props.editedMessage&&!(0,ie.default)(this.props.editedMessage,e.editedMessage),l=this.state.hasMediaPreviews&&this.state.hasMediaPreviews!==t.hasMediaPreviews;(0,ie.default)(this.props.quotedMessages,e.quotedMessages)&&(0,ie.default)(this.props.editedMessage,e.editedMessage)&&(0,ie.default)(t.inputEntities,this.state.inputEntities)||this._saveMessage(this.state.inputEntities),n=r||a||l,this._inputAreaText=te.getRawText(this.state.inputEntities),a&&(this._inputAreaText=te.getRawText(this.state.inputEntities)),!e.inlineSearchModeActive&&this.props.inlineSearchModeActive&&(o=""),n&&this.requestFocus(),!t.enableOnewaySms&&this.state.enableOnewaySms&&this._checkForOutgoingSmsMessagesInConversation(this.state),this.state.hasFocus&&!i.isEmpty(this.state.inputEntities)&&w.default.hideCurrentCoachMark(),this.setState({selectedMediaBarItem:o})}componentWillUnmount(){super.componentWillUnmount(),this._appStateSubscription&&(this._appStateSubscription.unsubscribe(),this._appStateSubscription=void 0),this._dataUpdateSubscription&&(this._dataUpdateSubscription.unsubscribe(),this._dataUpdateSubscription=void 0),F.default.commit(this.props.conversationId),h.default.getS4LMessagingFeaturesNoSubscription().enableDraftMessagesPersistentStorage&&F.default.storeSavedMessage(this.props.conversationId),this._customKeyboardDidHideListener&&(this._customKeyboardDidHideListener.remove(),this._customKeyboardDidHideListener=void 0),this._nativeKeyboardDidHideListener&&(this._nativeKeyboardDidHideListener.remove(),this._nativeKeyboardDidHideListener=void 0),this._customKeyboardSeenListener&&(this._customKeyboardSeenListener.remove(),this._customKeyboardSeenListener=void 0),this._visibilitySubscriptionToken&&(this._visibilitySubscriptionToken.unsubscribe(),this._visibilitySubscriptionToken=void 0),this._stopComposing(),r.default.isSupported()&&r.default.dismiss(),oe.default.removeHandler(G.KeyboardShortcut.SendFile,this._showFilePicker),oe.default.removeHandler(G.KeyboardShortcut.EditMessage,this._editLastMessageKeyboardShortcut),oe.default.removeHandler(G.KeyboardShortcut.FocusMessageComposer,this._focusKeyboardShortcut),N.unregister(this._keyboardDismissRegistrationHandle),F.default.onInputEntitiesUpdatedEvent.unsubscribe(this._onPartiallyEnteredMsgStoreUpdated),u.default.disableTooltip(p.EngagementTooltipType.ExpressionPicker)}_overflowActions(){return{onItemSelected:this._onMediaBarItemSelected,onCustomAction:this._onHandleCustomAction,mediaBarItems:this._getOverflowItemDescriptors(),onFocus:this.requestFocus,onBlur:this.blur}}render(){return this._renderDesktopComposer()}dismissKeyboard(){}_getQuotedTextForSms(e,t){return t&&e!==t?i.join(t.map((e=>this._getQuoteEntity(e).textForSMS()))):""}_renderQuote(){if(this.props.hideContentInMessageComposer)return;const{enableMultiMessageQuote:e}=this.state;let t,s=this.props.quotedMessages,o=this._onClearQuoteButtonPress;if(i.isEmpty(s)&&this.props.editedMessage){const e=i.first(this.state.inputEntities);e instanceof ee.QuoteEntity&&(s=[this.props.editedMessage],t=te.decodeFromInput([e],!1,!1,!1),o=this._onClearEditMessageQuote)}if(s&&s.length>0){const i=Je.default.font.uiDisplayBold,n=this.props.showTranslatedMessage||!1,r={onClearQuote:e?void 0:o,linkStyle:this._useDarkTheme()?l.Styles.combine(dt.linkStyle,this._themeStyles.linkTextColorStyle||this._themeStyles.primaryTextColorStyle):dt.linkStyle,disableActions:this.props.disableActionOnMessageComposer,quoteSymbolStyle:{size:Ye.IconSize.size20,color:this._themeColors.primaryTextColor},quotedTextStyle:dt.quoteTextStyle,atMentionStyle:i,atMentionMeOverrideStyle:i,showTranslatedMessage:n,hasTranslation:n,renderOrigin:W.MessageRenderOrigin.MessageComposerCanvas};if(r.textOverrideStyle=[this._themeStyles.primaryTextColorStyle],r.quoteAttributeStyle=[dt.quoteAttributeStyle,this._themeStyles.secondaryTextColorStyle],this.state.messageStreamFontSize!==be.MessageStreamFontSize.Normal){const e=Je.default.controlFontSize.messageStreamItemDesktop,t=Ce.getStyle(e,this.state.messageStreamFontSize),s=Ce.getStyle(Je.default.controlFontSize.messageStreamQuoteAttributeDesktop,this.state.messageStreamFontSize);r.textOverrideStyle.push(t),r.quoteAttributeStyle.push(s),r.fontSize=Ce.getSize(e,this.state.messageStreamFontSize)}const a=s.length-1;let d;if(e){const e=s.map(((e,s)=>l.createElement(l.View,{style:s===a?dt.multiQuoteAreaLastMessage:dt.multiQuoteAreaMessage,key:`quote-${s}`},l.createElement(_e.default,{message:e,preDecodedMessage:t,wrapInQuote:!t,options:r}))));d=l.createElement(l.View,{style:dt.multiQuoteArea},l.createElement(l.View,{style:[dt.multiQuoteAreaMessages,this._themeStyles.secondaryDividerBorderStyle]},l.createElement(l.ScrollView,{style:et.default.flexOne},e)),l.createElement(Y.default,{key:"clearbutton",title:ae.getString("MessageComposer.RemoveQuoteButtonTitle"),style:dt.multiQuoteAreaClearButton,onPress:o,size:Ye.IconSize.size16,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,icon:Ye.SkypeIcon.Cancel,disabled:this.props.disableActionOnMessageComposer}))}else d=l.createElement(l.View,{style:[dt.quoteArea,dt.desktopOverrides.quoteArea]},l.createElement(_e.default,{message:s[0],preDecodedMessage:t,wrapInQuote:!t,options:r}));return{component:d,onClearQuoteHandler:o}}}_getDoNotFormatStyle(){return this._useDarkTheme()?dt.desktopOverrides.doNotFormatDarkTheme:dt.desktopOverrides.doNotFormatLightTheme}_renderDesktopComposer(){const e=[dt.composerInner,dt.desktopOverrides.composerInner];let t;t=this.state.isSmallHeightView?this.props.quotedMessages?[dt.expandableAreaWithQuote,dt.desktopOverrides.expandableAreaWithQuoteSmallView]:[dt.expandableArea,dt.desktopOverrides.expandableAreaSmallView]:this.props.quotedMessages?[dt.expandableAreaWithQuote,dt.desktopOverrides.expandableAreaWithQuote]:[dt.expandableArea,dt.desktopOverrides.expandableArea];const s=[et.default.flexOne,dt.desktopOverrides.messageComposer];this._themeStyles.messageComposerBackgroundStyle&&s.push(this._themeStyles.messageComposerBackgroundStyle),this.state.isShowingUnifiedPesPickerDesktop?s.push(dt.desktopOverrides.messageComposerTopFlatCorners):s.push(dt.desktopOverrides.messageComposerAllRoundCorners),this.state.doNotFormat&&s.push(this._getDoNotFormatStyle());const i=this._renderQuote(),n=this.props.hideContentInMessageComposer?void 0:this._renderTextInput(t,!!i),r=this._getRightIcon()||this._getMediaBar(!0),a=[dt.rightControlContainer,dt.desktopOverrides.rightControlContainer],d=!($e.default.getPlatformType()===o.PlatformType.OSX);let c=l.createElement(l.View,{style:s,importantForAccessibility:l.Types.ImportantForAccessibility.No,onPress:this._onCompositionAreaPress,onKeyPress:this._onCompositionAreaKeyPress,disableTouchOpacityAnimation:!0},l.createElement(l.Animated.View,{style:this._inputAreaHeightStyle},l.createElement(l.View,{style:[dt.compositionAreaContainer,dt.desktopOverrides.compositionAreaContainer],onLayout:this._onLayoutInputArea,key:"composition"},i&&i.component,this._getMediaPreviewPanel(),l.createElement(l.View,{style:e},this._getEmoticonPickerItem(),l.createElement(l.View,{style:[dt.compositionArea,dt.desktopOverrides.compositionArea],importantForLayout:d},this._renderEmoteAuthor(),n)))));return l.createElement(l.View,{style:dt.composerArea},l.createElement(l.View,{style:et.default.flexOne},this._renderSmsInfoLine(),this._renderPesPicker(),c),l.createElement(l.View,{style:a},r))}_getRightIcon(){const e=Ye.IconSize.size20;let t;if(this._canCancelEdit(this.state,this.state.rawEditedMessage)){const s=[dt.actionButtonWithBackground,dt.actionButtonVerticalCenter,this._themeStyles.buttonBackgroundColorStyle];return t=this._themeStyles.buttonBackgroundHoverColorStyle,l.createElement(Y.default,{title:ae.getString("MessageComposer.CancelEditButtonTitle"),ref:this._onInputButtonRef,onPress:this._onCancelEditClick,size:e,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,style:s,hoverStyle:t,icon:Ye.SkypeIcon.Cancel})}if(this._sendControlEnabled(this.props,this.state,this._hasQuotes())){const t=this.props.disableActionOnMessageComposer||!!this.state.phoneNumberForSendingSms&&i.isEmpty(this.state.inputEntities);return l.createElement(c.default,{title:ae.getString(this.props.editedMessage?"MessageComposer.EditButtonTitle":"MessageComposer.SendButtonTitle"),ref:this._onInputButtonRef,onPress:this._onSendButtonClick,size:c.ActionButtonSize.Small,iconSize:e,style:dt.sendButton,icon:Ye.SkypeIcon.Send,flipIcon:this._getContext().isRTL,disabled:t})}}_getMediaPreviewPanel(){if(this.state.isMediaPreviewEnabled)return l.createElement(ge.default,{conversationId:this.props.conversationId})}_renderPesPicker(){if(!this.state.isShowingUnifiedPesPickerDesktop)return;const e=this._isMojiCategoryEnabled()||this._isStickerCategoryEnabled()||this._isGifCategoryEnabled();return l.createElement(l.View,null,l.createElement(V.default,{showCategorySwitcher:e,availableWidth:this.props.availableWidth,pesPickerPopupRef:this._getPesPickerPopupRef,onEmoticonSelected:this._onEmoticonSelected,onMojiSelected:this._onMojiSelected,onStickerSelected:this._onStickerSelected,onGifSelected:this._onGifSelected,onClose:this._closeUnifiedPesPickerDesktop,selectedTabType:this.state.selectedTabType,searchQuery:this.state.searchQuery}),this._renderPesPickerPopup())}_getTextForSms(e){return`${this.state.quoteTextForSms}${te.getRawText(e)}`}_renderSmsInfoLine(){if(this.state.enableOnewaySms)return l.createElement(Ge.default,{rawTextInput:this._getTextForSms(this.state.inputEntities),conversationId:this.props.conversationId,phoneNumbers:this.state.phoneNumbers,onPhoneNumberSelected:this._onPhoneNumberForSmsSelected,selectedPhoneNumber:this.state.phoneNumberForSendingSms,creditEntitlement:this.state.creditEntitlement,ref:this._onSMSInfoLineRef,disabled:this.props.disableActionOnMessageComposer,preventAccessibilityFocus:this.props.preventAccessibilityFocus,isSmsFailureScreenEnabled:this.state.isSmsFailureScreenEnabled})}_isMojiCategoryEnabled(){return!this.props.hideMojiPickerIcon&&!this.state.phoneNumberForSendingSms}_isStickerCategoryEnabled(){return this.state.showStickerPicker&&!this.state.phoneNumberForSendingSms}_isGifCategoryEnabled(){return this.state.showGifPicker&&!this.state.phoneNumberForSendingSms}_renderEmoteAuthor(){const e=i.head(this.state.inputEntities);if(this.props.editedMessage&&e&&e instanceof ee.EmoteEntity){let t=[dt.emoteAuthor.text];t.push(dt.emoteAuthor.textDesktop),t.push(this._themeStyles.primaryTextColorStyle);const s=e.fallbackText.trim();return l.createElement(l.View,null,l.createElement(l.Text,{style:t},s+"…"))}}_getDefaultPlaceholderText(){return this.state.phoneNumberForSendingSms?ae.getString("MessageComposer.SmsMessagePlaceholderText"):ae.getString("MessageComposer.MessagePlaceholderShortText")}_renderTextInput(e,t=!1){const s=[dt.sharedInputAndMirror,this._themeStyles.primaryTextColorStyle],i=[dt.sharedInputAndMirror,this._themeStyles.primaryTextColorStyle],o=[te.renderReact(this.state.inputEntities,{defaultStyle:dt.entityText,atMentionStyle:this._useDarkTheme()?dt.atMentionTextDark:dt.atMentionText}),l.createElement(l.Text,{key:"break"}," ")];if(i.push(dt.mirrorText),i.push(l.Styles.createViewStyle({top:-this.state.offsetTop},!1)),s.push(dt.textInput),this.state.messageStreamFontSize!==be.MessageStreamFontSize.Normal){const e=Ce.getStyleFromStyle(s,this.state.messageStreamFontSize);s.push(e),i.push(e)}const n=this.state.selectedMediaBarItem===ue.MediaBarItemKeys.MediaPicker||this.state.selectedMediaBarItem===ue.MediaBarItemKeys.Moji||this.state.selectedMediaBarItem===ue.MediaBarItemKeys.Emoticon||this.state.selectedMediaBarItem===ue.MediaBarItemKeys.Gif||this.state.selectedMediaBarItem===ue.MediaBarItemKeys.Sticker?l.createElement(l.Button,{style:dt.textInputFocusButton,onPress:this._onDismissMediaPicker,importantForAccessibility:l.Types.ImportantForAccessibility.No}):void 0;this._placeholderText=t?"":this._getDefaultPlaceholderText();const r=[dt.textInputContainer],a=l.createElement(l.View,{style:r},l.createElement(l.TextInput,{ref:this._onTextInputRef,autoCorrect:!0,style:s,value:te.getRawText(this.state.inputEntities),maxLength:this.props.maxLength&&this.props.maxLength<=25e3?this.props.maxLength:25e3,multiline:!0,onChangeText:this._onInput,onKeyPress:this._onKeyPress,onSelectionChange:this._onSelectionChanged,onFocus:this._onFocus,onBlur:this._onBlur,onScroll:this._onScroll,onPaste:this._onPaste,placeholder:this._placeholderText,placeholderTextColor:this._themeColors.secondaryTextColor,keyboardAppearance:this._useDarkTheme()?"dark":"default",autoCapitalize:"sentences",editable:void 0!==this.state.overrideEditable?this.state.overrideEditable:this.state.editable,clearButtonMode:"never"}),n);return l.createElement(l.View,{style:dt.inputArea},l.createElement(l.Animated.View,{style:[...e]},l.createElement(l.View,{style:et.default.flexOne},l.createElement(l.Text,{style:i,importantForAccessibility:l.Types.ImportantForAccessibility.NoHideDescendants,textBreakStrategy:"simple"},o),a)))}_stopComposing(){this._startComposingThrottled.cancel(),this._stopComposingDebounced.cancel(),this._isComposing&&(this._isComposing=!1,it.default.setComposingState(!1,this.props.conversationId))}_clearTextInput(e=!0){this.props.editedMessage&&this.props.onClearEdit&&this.props.onClearEdit(),e&&F.default.clearMessageInput(this.props.conversationId),this._stopComposing(),this._debounceNewTextBeforeInsertionChanged("",[]),this.isComponentMounted()&&this.setState({inputEntities:[]})}_handleEnterCombinations(e){const t=e.ctrlKey||e.altKey||e.shiftKey;this.state.sendMessageWithEnterEnabled?t?e.shiftKey||this._startNewLine():(e.stopPropagation(),e.preventDefault(),this._sendMessage()):t&&(e.stopPropagation(),e.preventDefault(),this._sendMessage())}_startNewLine(){const e=this._textInputRef;if(e){const t=e.getSelectionRange();this.replaceText(t.end-t.start,"\n","",new ee.UnhandledEntity("\n"))}}_updateInputEntities(e,t,s=-1,o){let n=[],r=0,a=0,l=0,d=t;for(s>=0&&(d=d.substr(0,s));l<e.length;){let t=e[l];const s=t.text();if(0===d.indexOf(s))this._appendEntityToList(n,i.cloneDeep(t)),d=d.substr(s.length),r+=s.length,l++;else{let t=!1,s=this._shortenAtMentionEntity(e,l,d);if(s)this._appendEntityToList(n,s.shortenedEntity),d=s.remainingText,a=-s.shortenAmount,t=!0,l++;else{let s=l;for(;s<e.length;){let i=te.getRawText(e,{startIndex:s}),o=d.indexOf(i);if(o>=0){o>0&&(this._appendEntityToList(n,new ee.UnhandledEntity(d.substr(0,o))),r+=o,d=d.substr(o)),t=!0,l=s;break}s++}}if(!t)break}}if(d&&(this._appendEntityToList(n,new ee.UnhandledEntity(d)),r+=d.length),r===s&&(o&&(n.push(o),r+=o.text().length),d=t.substr(r),d)){for(;l<e.length;){let t=te.getRawText(e,{startIndex:l}),s=d.indexOf(t);if(0===s){this._appendEntityToList(n,e[l]);const t=e[l].text().length;r+=t,d=d.substr(t),l++}else{if(!(s>0))break;this._appendEntityToList(n,new ee.UnhandledEntity(d.substr(0,s))),r+=s,d=d.substr(s)}}d&&this._appendEntityToList(n,new ee.UnhandledEntity(d))}return{newEntities:n,insertionAdjustment:a}}_appendEntityToList(e,t){const s=i.last(e);if(s instanceof ee.UnhandledEntity&&t instanceof ee.UnhandledEntity){const i=t.text(),o=e.length>1&&e[e.length-2]instanceof ee.AtMentionEntity;" "===s.text()&&o&&at.test(i)?e.splice(e.length-1,1,t):s.appendText(i)}else e.push(t)}_shortenAtMentionEntity(e,t,s){let i=0,o=s;if(!(e[t]instanceof ee.AtMentionEntity))return;const n=e[t];if(!n.shortName||!n.displayName)return;if(e[t].text().length<n.displayName.length)return;let r=s.length;if(t<e.length-1){let i=te.getRawText(e,{startIndex:t+1});if(r=s.indexOf(i),r<0)return;if(o=s.substr(0,r),o.length>=n.displayName.length)return}if(0===o.indexOf(n.shortName)){i=r-n.shortName.length;return{shortenedEntity:n.clone(n.shortName),remainingText:s.substr(o.length),shortenAmount:i}}}_getEmoticonPickerItem(){if(this.props.hideEmoticonKeyboardIcon||I.isPhoneMri(this.props.conversationId)||I.isS4BBridgeMri(this.props.conversationId))return;const e=this.state.isShowingUnifiedPesPickerDesktop,t=this._onUnifiedPesPickerDesktopPress,s={id:ue.MediaBarItemKeys.Emoticon,key:"emoticonPicker",active:e,onActive:t,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,onFocus:this.requestFocus,onBlur:this.blur,onInputChange:this.autoReplaceText,onEmoticonSelected:this._onEmoticonSelected,onEmoticonBackspacePress:this._handleEmoticonBackspacePress,pesPickerPopupRef:this._getPesPickerPopupRef,preventAccessibilityFocus:this.props.preventAccessibilityFocus,colorOverride:this._themeColors.primaryTextColor,hoverColorOverride:this._themeColors.secondaryTextColor,iconStyleOverride:void 0,showCategorySwitcher:!1,disabled:this.props.disableActionOnMessageComposer,origin:he.MediaBarItemOrigin.MessageComposer,ref:e=>{u.default.setAnchor(p.EngagementTooltipType.ExpressionPicker,e)}};return l.createElement(l.View,{style:dt.desktopOverrides.composerInnerIconWrapper},l.createElement(K.ExpressionPickerItem,Object.assign({},s)))}_hasQuotes(){return!i.isEmpty(this.props.quotedMessages)}_mediaBarItemDescriptor(e){switch(e){case ue.MediaBarItemKeys.Emoticon:const t={onEmoticonSelected:this._onEmoticonSelected,pesPickerPopupRef:this._getPesPickerPopupRef,showCategorySwitcher:!1};return{id:e,render:this._renderEmoticonPickerItem,propOverrides:t};case ue.MediaBarItemKeys.Moji:const s={onMojiSelected:this._onMojiSelected,showCategorySwitcher:!1};return{id:e,render:this._renderMojiPickerItem,getVirtualKeyboard:we.MojiPickerItem.getVirtualKeyboard,propOverrides:s};case ue.MediaBarItemKeys.Gif:const i={onGifSelected:this._onGifSelected,showCategorySwitcher:!1};return{id:e,render:this._renderGifPickerItem,propOverrides:i};case ue.MediaBarItemKeys.Sticker:const o={onStickerSelected:this._onStickerSelected,showCategorySwitcher:!1};return{id:e,render:this._renderStickerPickerItem,propOverrides:o};case ue.MediaBarItemKeys.Sms:return{id:e,render:this._renderSmsItem};case ue.MediaBarItemKeys.MediaPicker:return{id:e,render:this._renderMediaPickerItem,disabled:this.state.disableHighBandwidthOperations};case ue.MediaBarItemKeys.FilePicker:return{id:e,render:this._renderFilePickerItem,disabled:this.state.disableHighBandwidthOperations};case ue.MediaBarItemKeys.Camera:return{id:e,render:this._renderCameraItem,disabled:this.state.disableHighBandwidthOperations};case ue.MediaBarItemKeys.ScheduleCall:return{id:e,render:this._renderScheduleCallItem};case ue.MediaBarItemKeys.Poll:return{id:e,render:this._renderPollItem};case ue.MediaBarItemKeys.Location:return{id:e,render:this._renderLocationPickerItem,disabled:this.state.disableHighBandwidthOperations};case ue.MediaBarItemKeys.Contact:return{id:e,render:this._renderContactPickerItem};case ue.MediaBarItemKeys.Bing:const n={onBlur:this._onBlur};return{id:e,render:this._renderBingSearchItem,propOverrides:n};case ue.MediaBarItemKeys.VideoMessage:return{id:e,render:this._renderVideoMessageItem,disabled:this.state.disableHighBandwidthOperations};case ue.MediaBarItemKeys.People:return{id:e,render:this._renderPeopleItem};case ue.MediaBarItemKeys.Audio:const r={onPress:this.props.onRecording};return{id:e,render:this._renderAudioMessageItem,propOverrides:r};case ue.MediaBarItemKeys.SendCredit:return{id:e,render:this._renderSendCreditItem,getVirtualKeyboard:ze.SendCreditItem.getVirtualKeyboard}}se.warn(G.LogTraceArea.MessageComposer,"No media bar descriptor for "+e)}_canShowSmsIcon(){return!1}_canShowEmoticonIcon(){return!this.props.hideEmoticonKeyboardIcon}_getItemDescriptors(e,t=!1){const s=t&&this.state.disableHighBandwidthOperations,o=i.map(e,(e=>{switch(e){case ue.MediaBarItemKeys.Bing:return this._mediaBarItemDescriptor(e);case ue.MediaBarItemKeys.Camera:if(!this.props.hideMediaPickerIcon&&this.state.isCameraAvailable)return this._mediaBarItemDescriptor(e);break;case ue.MediaBarItemKeys.Sms:if(this._canShowSmsIcon())return this._mediaBarItemDescriptor(e);break;case ue.MediaBarItemKeys.Emoticon:if(this._canShowEmoticonIcon())return this._mediaBarItemDescriptor(e);break;case ue.MediaBarItemKeys.Location:if(this.state.showLocationPicker&&!s&&t)return this._mediaBarItemDescriptor(e);break;case ue.MediaBarItemKeys.Contact:if(this.state.showContactPicker)return this._mediaBarItemDescriptor(e);break;case ue.MediaBarItemKeys.MediaPicker:if(!this.props.hideMediaPickerIcon&&!s&&t)return this._mediaBarItemDescriptor(e);break;case ue.MediaBarItemKeys.FilePicker:if(!this.props.hideFilePicker&&!s)return this._mediaBarItemDescriptor(e);break;case ue.MediaBarItemKeys.Moji:if(this._isMojiCategoryEnabled()&&!t)return this._mediaBarItemDescriptor(e);break;case ue.MediaBarItemKeys.Sticker:if(this._isStickerCategoryEnabled()&&(!t||!this.props.hideStickerPickerIcon))return this._mediaBarItemDescriptor(e);break;case ue.MediaBarItemKeys.Gif:if(this._isGifCategoryEnabled())return this._mediaBarItemDescriptor(e);break;case ue.MediaBarItemKeys.ScheduleCall:if(!this.props.hideScheduleCallIcon&&!s&&!this.state.isRegularMemberInModeratedGroup)return this._mediaBarItemDescriptor(e);break;case ue.MediaBarItemKeys.Poll:if(!this.props.hidePollIcon&&this.state.enablePollExtensionEntryPoint)return this._mediaBarItemDescriptor(e);break;case ue.MediaBarItemKeys.People:return this._mediaBarItemDescriptor(e);case ue.MediaBarItemKeys.VideoMessage:if(this.state.showVideoMessageIcon&&!s)return this._mediaBarItemDescriptor(e);break;case ue.MediaBarItemKeys.Audio:if(this._canShowMicButton(this.props,this.state))return this._mediaBarItemDescriptor(e);break;case ue.MediaBarItemKeys.SendCredit:if(!this.props.hideSendCreditIcon&&!s)return this._mediaBarItemDescriptor(e)}}));return i.compact(o)}_canShowMicButton(e,t){return!(e.hideAudioMessage||!e.onRecording||t.phoneNumberForSendingSms||this._isPresentedInSidebar()||t.disableHighBandwidthOperations)}_getOverflowItemDescriptors(){let e=i.map(this.state.mediaBarMenuOrder,(e=>e));const t=this._getItemDescriptors(i.flatten(e),!0);return i.slice(t,this.state.currentNumberOfIconsInMediaBar)}_getMediaBarItemDescriptors(){if(this.props.hideMediaBar||this._isMediabarDisabled())return[];const e=this._getItemDescriptors(this.state.mediaBarMenuOrder,!0);return i.slice(e,0,this.state.currentNumberOfIconsInMediaBar)}_getMediaBar(e=!0){if(this._getRightIcon()||this.state.isShowingUnifiedPesPickerDesktop)return;const t=this._getMediaBarItemDescriptors();let s;if(this.state.isEncryptedThreadThread||(s=l.createElement(A.default,{overflowConfig:this.getDesktopOverflowConfig(),otherPartyMri:this.props.otherPartyMri,conversationId:this.props.conversationId,onOverflowButtonPress:this._onComposerOverflowPress})),t.length>0){const i=!1;return l.createElement(l.View,{style:dt.mediaBarWrapper},l.createElement(de.MediaBar,{ref:this._onMediaBarRef,activeId:this.state.selectedMediaBarItem,itemDescriptors:t,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,isMobileInterface:!1,showIcons:e,onInputChange:this.autoReplaceText,onItemSelected:this._onMediaBarItemSelected,onFocus:this.requestFocus,onBlur:this.blur,onCustomKeyboardClose:this._onCustomKeyboardClose,onBackspace:this._handleEmoticonBackspacePress,onCustomAction:this._onHandleCustomAction,preventAccessibilityFocus:this.props.preventAccessibilityFocus,onMessageSent:this.props.onMessageSent,onCloseSearch:this._onCancelPesSearch,clearEditInChatsComposer:this.props.onClearEdit,autoFocusFirstItem:i,disableActionOnMediaBar:this.props.disableActionOnMessageComposer,focusCustomKeyboardWhenShown:!0,announceForAccessibilityForMessageSent:this._announceForAccessibilityForMessageSent,customKeyboardHeight:this.state.pesPickerKeyboardHeight}),s)}}_animateInputAreaToTargetHeight(){this._inputAreaAnimation||this._inputAreaTargetHeight===this._inputAreaHeight||(this._inputAreaHeight=this._inputAreaTargetHeight,this._inputAreaAnimation=Qe.default.easeOut({value:this._inputAreaHeightValue,toValue:this._inputAreaTargetHeight}),this._inputAreaAnimation.start((()=>{this._inputAreaAnimation=void 0,this.isComponentMounted()?this._animateInputAreaToTargetHeight():w.default.updateAnchor(P.CoachMarkType.ExpressionPicker)})))}_toggleSmsSending(e,t){this._onPhoneNumberForSmsSelected(t),this.isComponentMounted()&&this.setState({smsToggledOn:e})}_sendControlEnabled(e,t,s){return e.showSendControlWhenEmpty||!i.isEmpty(t.inputEntities)||s||!!t.phoneNumberForSendingSms||t.hasMediaPreviews}_canCancelEdit(e,t){return!!t&&(t===this._inputAreaText||i.isEmpty(e.inputEntities))}replaceText(e,t,s,o){const n=this._textInputRef;if(n){const s=n.getSelectionRange(),r=this._inputAreaText;let a=r.substr(0,s.end-e)+t;s.end<r.length&&(a+=r.substr(s.end));let l=this._updateInputEntities(this.state.inputEntities,a,s.end-e,o);this._inputAreaText=a,n.setValue(a);const d=s.end+t.length-e+l.insertionAdjustment;this.isComponentMounted()&&this.setState({inputEntities:l.newEntities}),n.requestFocus(),this._currentSelectionStart!==d&&(this._afterNextOnInput=()=>{this._currentSelectionStart=d,this._currentSelectionEnd=d,n.selectRange(d,d)}),i.defer(this._debounceNewTextBeforeInsertionChanged,"",l.newEntities)}}abortTextAutoCompletion(){this._cancelAutoCompletionIfActive()}_cancelAutoCompletionIfActive(){this._pendingMessageTextCompletionPromise&&(this._pendingMessageTextCompletionPromise.reject(),this._pendingMessageTextCompletionPromise=void 0),this.props.onInputTextChanged&&this.props.onInputTextChanged("",!0)}_setInputEntityStateUpstream(e){const t=fe.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives(e,this.state.emoticons);this.isComponentMounted()&&this.setState({inputEntities:e,editableEntities:t})}_setInputEntityStateDownstream(e,t){const s=this.state.inputEntitiesDataVersion+1,i=fe.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives(e,this.state.emoticons);this.isComponentMounted()&&this.setState({inputEntities:e,inputEntitiesDataVersion:s,editableEntities:i},t)}_sendFileWithDimensions(e){let t=st.default.getFileUrl(e);n.default.getImageSize(t).then((t=>{if(t&&(e.dimensions=t),this.state.isMediaPreviewEnabled)return me.default.addPreviews([e],this.props.conversationId,G.PostSource.MessageComposer);const s={name:Ne.ScenarioName.SendPicture};De.default.postUpload([this.props.conversationId],e,G.PostSource.MessageComposer,!1,{scenarioInfo:s},this._getRootViewType())}))}_preventSendingSMSMessage(e){return!(!(1===e.length&&e[0]instanceof ee.SmsEntity&&this._smsInfoLineRef)||this._smsInfoLineRef.canSendSMS())&&(this.state.isSmsFailureScreenEnabled?Ae.default.navigateToSmsFailurePrompt(this.props.conversationId,this.state.phoneNumberForSendingSms?this.state.phoneNumberForSendingSms.number:"",!1):f.default.open(this._getRootViewId()),!0)}_sendMessage(){if(se.log(G.LogTraceArea.MessageComposer,"sendMessage isPostingMessage: "+this._isPostingMessage),this._isPostingMessage)return;this._isPostingMessage=!0;const e=nt.default.newCauseId();se.log(G.LogTraceArea.MessageComposer,"sendMessage causeId: "+e);let t=[],s=0;if(this.props.quotedMessages&&(t=t.concat(this.props.quotedMessages.map(this._getQuoteEntity)),s=t.length),this.state.inputEntities.length>0&&(t=t.concat(this.state.inputEntities)),this.state.enableOnewaySms&&this.state.phoneNumberForSendingSms&&!i.isEmpty(this.state.inputEntities)&&(t=[new ee.SmsEntity(this._getTextForSms(this.state.inputEntities),this.state.phoneNumberForSendingSms.number)],this._preventSendingSMSMessage(t)))return se.log(G.LogTraceArea.MessageComposer,"sendMessage Message prevented from being send."),void(this._isPostingMessage=!1);me.default.sendPreviews(this.props.conversationId,e).then((()=>{s>1?d.all(t.map((e=>this._sendTextMessagePromise([e])))).finally((()=>{this._isPostingMessage=!1})):this._sendTextMessagePromise(t).finally((()=>{this._isPostingMessage=!1}))})).finally((()=>{this._isPostingMessage=!1,this.state.hasFocus||this.requestFocus()}))}_sendTextMessagePromise(e){const t={conversationId:this.props.conversationId,editedMessage:this.props.editedMessage,inputEntities:e,onMessageSent:this.props.onMessageSent,phoneNumberForSendingSms:this.state.phoneNumberForSendingSms,smsInfoLineRef:this._smsInfoLineRef,enableHandlingHTMLonPaste:this.state.enableHandlingHTMLonPaste,enableHandlingHyperlinkOnPaste:this.state.enableHandlingHyperlinkOnPaste,messageComposerPastedContentType:this.state.messageComposerPastedContentType};return ht._sendTextMessage(t).then((e=>{if(e){if(this._handleAfterPostMessage(t.conversationId),se.log(G.LogTraceArea.MessageComposer,"sendMessage Message sent."),t.smsInfoLineRef){const e=t.smsInfoLineRef.getTelemetryEvent();e&&(this.state.phoneNumberForSendingSms?e.setSmsWasSent(!0):e.setSkypeMessageSent(!0))}}else se.log(G.LogTraceArea.MessageComposer,"sendMessage Message not sent.")}))}static _sendTextMessage(e){if(i.every(e.inputEntities,(e=>e instanceof ee.UnhandledEntity&&!i.trim(e.text()))))return e.inputEntities.length?se.log(G.LogTraceArea.MessageComposer,"sendMessage User pressed enter with only whitespace message content."):se.log(G.LogTraceArea.MessageComposer,"sendMessage User pressed enter without entering any message content."),d.Resolved(!1);if(e.onMessageSent(e.inputEntities,e.enableHandlingHTMLonPaste||e.enableHandlingHyperlinkOnPaste?ye.convertPastedTextTypeToTelemetry(e.messageComposerPastedContentType):Te.MessageComposerAction.NoPaste)){const t=e.editedMessage?ae.getString("MessageComposer.MessageEditedLabel"):ae.getString("MessageComposer.MessageSentLabel");return ht._announceForAccessibility(t),d.Resolved(!0)}return d.Resolved(!1)}static _announceForAccessibility(e){He.default.maybeAnnounceForAccessibility(e,0)}_handleAfterPostMessage(e){if(F.default.getSavedMessageInput(e)&&(0,x.default)().fakeConversationTime(e,Date.now()),F.default.clearMessageInput(e),this.props.conversationId===e){this.state.hasFocus||this.requestFocus(),this._stopComposing(),this._inputAreaText="",this.setTextInputAccessibilityFocus(),this._setInputEntityStateDownstream([]),this._cancelAutoCompletionIfActive(),this.isComponentMounted()&&this.setState({selectedMediaBarItem:""}),this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(),this.props.onClearEdit&&this.props.onClearEdit();const e=this._getRootViewId();ce.MediaBarItem.dismissPopup(e),B.default.close(e)}this._isPostingMessage=!1}_shouldAutoFocusInput(){return!(this.state.isSmallOrTinyScreen&&this._getRootViewId()===k.MainRootViewId)}_isMediabarDisabled(){return I.isS4BBridgeMri(this.props.conversationId)||!!this.state.phoneNumberForSendingSms||!!this.state.isConversationWithPhoneNumber}_isPresentedInSidebar(){return this._getContext().isPresentedInDesktopLeftNav||this._getContext().isPresentedInDesktopRightNav}_announceForAccessibility(e){He.default.maybeAnnounceForAccessibility(e,0)}isFocused(){return this.state.hasFocus}blurIfFocused(){this.state.hasFocus&&this.blur()}getInputEntities(){return d.Resolved(this.state.inputEntities)}getDesktopOverflowConfig(){return this._overflowActions()}}t.default=ht},57236:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageComposerOverflow=void 0;const i=s(96486),o=s(16778),n=s(89391),r=s(62033),a=s(3110),l=s(96418),d=s(3056),c=s(98278),h=s(87134),u=s(46096),p=s(21063),g=s(65947),m=s(36237),S=s(26448),f=s(15877),y=s(33754),_=s(9748),v=s(59680),C=s(67339),b=s(73319),T=s(72997),M=s(51070),I=(s(36150),s(90631)),w=s(50795),P=s(81760),k=s(11828),A=s(78262),E=s(80837),R=s(24576),L=s(73877);var F;!function(e){e[e.Yes=0]="Yes",e[e.No=1]="No",e[e.Maybe=2]="Maybe"}(F||(F={}));const x=(0,f.lazyProperties)({container:()=>o.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,backgroundColor:P.Color.transparent}),containerStaticHeight:()=>o.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,bottom:0,backgroundColor:P.Color.transparent}),containerHidden:()=>o.Styles.createViewStyle({opacity:0}),contentContainer:()=>o.Styles.createViewStyle({position:"absolute",left:0,right:0,bottom:0,top:0,borderTopLeftRadius:c.CustomActionSheetBorderRadius,borderTopRightRadius:c.CustomActionSheetBorderRadius,flexDirection:"column-reverse"}),contentContainerStaticHeight:()=>o.Styles.createViewStyle({position:"absolute",left:0,right:0,bottom:0,borderTopLeftRadius:c.CustomActionSheetBorderRadius,borderTopRightRadius:c.CustomActionSheetBorderRadius,flexDirection:"column-reverse"}),backgroundContainer:()=>E.default.absoluteFill,background:()=>o.Styles.createViewStyle({flex:1,backgroundColor:P.Color.blackOverlay50}),scrollView:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),content:()=>o.Styles.createViewStyle({alignSelf:"stretch",paddingTop:0}),divider:()=>o.Styles.createViewStyle({marginBottom:5}),headerShadow:()=>o.Styles.createViewStyle({left:0,right:0,height:1,marginBottom:-1})});class O extends R.default{constructor(){super(...arguments),this._gestureInterest=F.Maybe,this._isDragging=!1,this._contentTransform=0,this._headerOpacityValue=new o.Animated.Value(0),this._headerOpacityStyle=o.Styles.createAnimatedViewStyle({opacity:this._headerOpacityValue}),this._backgroundOpacityValue=new o.Animated.Value(0),this._backgroundOpacityStyle=o.Styles.createAnimatedViewStyle({opacity:this._backgroundOpacityValue}),this._contentContainerTransformValue=new o.Animated.Value(o.UserInterface.measureWindow().height),this._contentContainerTransformStyle=o.Styles.createAnimatedViewStyle({transform:[{translateY:this._contentContainerTransformValue}]}),this._headerTopValue=new o.Animated.Value(0),this._headerTopStyle=o.Styles.createAnimatedViewStyle({height:this._headerTopValue}),this._containerHeightValue=new o.Animated.Value(0),this._containerHeightStyle=o.Styles.createAnimatedViewStyle({height:this._containerHeightValue}),this._onHeaderRef=e=>{this._headerView=e||void 0},this._onBackButtonPressed=()=>(this._handleOnDismissCallback(),m.log(u.LogTraceArea.HardwareBackButton,"goBack: true componentId: MessageComposerOverflow"),!0),this._onLayoutChanged=e=>{const t=L.default.measureWindow(this._getRootViewId()),s=i.clone(t);this.state.viewDimensions.height===s.height&&this.state.viewDimensions.width===s.width||this.setState({viewDimensions:s,responsiveWidth:T.default.responsiveWidthForSize(t.width)})},this._onScroll=(e,t)=>{if(!this.isComponentMounted())return;const s=e<=1;s!==this.state.isScrolledToTop&&this.setState({isScrolledToTop:s})},this._onPan=e=>{this._gestureInterest=F.No,e.isComplete&&(this._gestureInterest=F.Maybe,this._isDragging=!1)},this._onPanVertical=e=>{this._gestureInterest===F.Maybe&&(this._gestureInterest=F.Yes);let t=0;if(this._gestureInterest===F.Yes){t=e.pageY-e.initialPageY;let s=this._contentTransform+t;if(s<0&&(s=0),this._contentContainerTransformValue.setValue(s),this.state.statusBarPadding){const e=s/(this.state.viewDimensions.height*this._sheetOffset()),t=this._mapVal(e,this.state.statusBarPadding,0);this._headerTopValue.setValue(t)}this._isDragging||(this._isDragging=!0)}if(e.isComplete){this._contentTransform+=t,this._gestureInterest=F.Maybe;const s=this.state.viewDimensions.height*this._sheetOffset();if(e.velocityY>.1&&this._contentTransform>=s&&this._onDismissCallback)this._handleOnDismissCallback();else{let t=!1;e.velocityY<-.1?t=this.state.expandEnabled:e.velocityY<.1&&(t=this.state.expandEnabled&&this._contentTransform<s),this._expandOrCollapse(t)}}},this._onBlur=()=>{this.state.config&&this.state.config.onBlur&&this.state.config.onBlur(),this._handleOnDismissCallback()},this._onFindComplete=()=>{this.props.onFindComplete&&this.props.onFindComplete(),this._handleOnDismissCallback(),this.props.findPerfScenario&&this.props.findPerfScenario.hasStarted()&&!this.props.findPerfScenario.isResolved()&&this.props.findPerfScenario.finish()},this._onWebViewClose=()=>{this.props.onWebViewClose&&this.props.onWebViewClose(),this._handleOnDismissCallback()},this._onCloseButtonClick=()=>{m.track(new b.MessageOverflowEvent(b.MessageOverflowAction.MessageOverflowCloseButtonClicked)),this._handleOnDismissCallback()},this._onCustomAction=(e,t)=>{if(e===A.MediaBarCustomAction.LaunchSearch){const e=a.default.getSearch();if(e){const t=S.default.transform(e,"");g.default.openIntegration(t,this.props.conversationId,this._getContext(),this._onFindComplete,this._onWebViewClose,void 0)}}else this.state.config&&this.state.config.onCustomAction&&this.state.config.onCustomAction(e,t)},this._onMoveShouldSetResponder=e=>(e.preventDefault(),e.stopPropagation(),!1),this._onScrollViewRef=e=>{this._scrollView=e||void 0}}_buildState(e,t){const s=n.default.getS4LIntegrationsFeatures().findPanelLayout,i={statusBarPadding:M.default.statusBarPadding(),bingSearch:a.default.getSearch(),expandEnabled:!1,safeAreaHorizontalPaddingStyle:M.default.horizontalPaddingStyle(),safeAreaHorizontalInsets:M.default.horizontalInsets(),useOverflowMenuGrid:n.default.getS4LMessagingFeatures().enableOverflowMenuGrid,includeOverflowMenuInFindPanel:s&&s.isFlatList&&s.includeMediaBarItemsInFlatList};if(t){i.hidden=!0,i.isHiding=!1,i.isExpanded=!1,i.isScrolledToTop=!0;const e=L.default.measureWindow(this._getRootViewId());i.viewDimensions={height:e.height,width:e.width},i.responsiveWidth=T.default.responsiveWidthForSize(e.width),i.config=void 0,i.shouldRenderFindPanel=!1}return i}componentDidMount(){super.componentDidMount(),this._containerHeightValue.setValue(this.state.viewDimensions.height)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.hidden!==t.hidden&&(this.state.hidden?(this._dismissContent(!0),r.default.unsubscribe(this._onBackButtonPressed)):(this._presentContent(!0),r.default.subscribe(this._onBackButtonPressed))),this.state.viewDimensions.height===t.viewDimensions.height&&this.state.statusBarPadding===t.statusBarPadding||(this._containerHeightValue.setValue(this.state.viewDimensions.height),this.state.hidden||this._expandOrCollapse(this.state.isExpanded,!0)),this.state.isScrolledToTop!==t.isScrolledToTop&&w.default.easeOut({value:this._headerOpacityValue,toValue:this.state.isScrolledToTop?0:1,useNativeDriver:!0}).start()}showOrHide(e,t,s,i){if(this._onDismissCallback=s,this.isComponentMounted()){const s=!e;this.state.hidden!==s&&(l.default.setCoachMarkEnabled(s),this.setState({hidden:s,config:t,isHiding:s},i))}}_mapVal(e,t,s){return t+(s-t)*e}_presentContent(e){this._expandOrCollapse(!1,e,(()=>{this.isComponentMounted()&&(this._headerView&&this._headerView.requestFocus(),this.setState({shouldRenderFindPanel:!0}))}))}_dismissContent(e){const t=()=>{this._scrollView&&this._scrollView.setScrollTop(0,!1),this.isComponentMounted()&&this.state.hidden&&this.state.isHiding&&this.setState({isHiding:!1,isScrolledToTop:!0,shouldRenderFindPanel:this.state.shouldRenderFindPanel})},s=this.state.expandEnabled?this.state.viewDimensions.height:this.state.viewDimensions.height*(1-this._sheetOffset());e?o.Animated.parallel([w.default.easeOut({value:this._backgroundOpacityValue,toValue:0,useNativeDriver:!0}),w.default.easeOut({value:this._contentContainerTransformValue,toValue:s,useNativeDriver:!0})]).start(t):(this._backgroundOpacityValue.setValue(0),this._contentContainerTransformValue.setValue(s),this._headerTopValue.setValue(0),t())}_expandOrCollapse(e,t=!0,s){if(0===this.state.viewDimensions.height)return;const i=e||!this.state.expandEnabled?0:this.state.viewDimensions.height*this._sheetOffset(),n=e?this.state.statusBarPadding:0,r=()=>{this.isComponentMounted()&&this.setState({isExpanded:e,shouldRenderFindPanel:!0}),s&&s(),this._isDragging=!1};t?(o.Animated.parallel([w.default.easeOut({value:this._backgroundOpacityValue,toValue:1,useNativeDriver:!0}),w.default.easeOut({value:this._contentContainerTransformValue,toValue:i,useNativeDriver:!0})]).start(r),w.default.easeOut({value:this._headerTopValue,toValue:n}).start()):(this._backgroundOpacityValue.setValue(1),this._contentContainerTransformValue.setValue(i),this._headerTopValue.setValue(n),r()),this._contentTransform=i}_sheetOffset(){let e=.5;return this.state.viewDimensions.width>this.state.viewDimensions.height?e=.9:this.state.expandEnabled?this.state.useOverflowMenuGrid&&(e=.6):e=.7,1-e}_handleOnDismissCallback(){this._onDismissCallback&&!this.state.hidden&&this._onDismissCallback()}_renderOverflowItems(){if(!this.state.viewDimensions.width||!this.state.config||this.state.includeOverflowMenuInFindPanel)return;const e=i.filter(this.state.config.mediaBarItems,(e=>e.id!==_.MediaBarItemKeys.Bing||!!this.state.bingSearch)),t={height:this.state.viewDimensions.height,width:this.state.viewDimensions.width-this.state.safeAreaHorizontalInsets.left-this.state.safeAreaHorizontalInsets.right},s={menuItems:e,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,responsiveWidth:this.state.responsiveWidth,onItemSelected:this.state.config.onItemSelected,onCustomAction:this._onCustomAction,onFocus:this.state.config.onFocus,onBlur:this._onBlur,viewDimensions:t};return this.state.useOverflowMenuGrid?o.createElement(C.default,Object.assign({},s)):o.createElement(v.default,Object.assign({},s))}render(){const e=this.state.hidden&&!this.state.isHiding,t=this.state.shouldRenderFindPanel?o.createElement(p.default,{conversationId:this.props.conversationId,isActive:!e,isInline:!0,hideAddInsTitle:!0,perfScenario:this.props.findPerfScenario,onFindComplete:this._onFindComplete,onWebViewClose:this._onWebViewClose,overflowActionConfig:this.state.config}):void 0,s=[x.content];this.state.safeAreaHorizontalPaddingStyle&&s.push(this.state.safeAreaHorizontalPaddingStyle);const i=this._renderOverflowItems(),n=this.state.includeOverflowMenuInFindPanel?void 0:o.createElement(h.default,{style:x.divider,marginLeft:20,marginRight:20}),r={ref:this._onScrollViewRef,style:x.scrollView,scrollEventThrottle:32,scrollEnabled:!this.state.expandEnabled||this.state.isExpanded,bounces:!1,onScroll:this._onScroll,onMoveShouldSetResponder:this._onMoveShouldSetResponder},a=o.createElement(o.ScrollView,Object.assign({},r),o.createElement(o.GestureView,{style:s,onPanVertical:!this.state.expandEnabled||this.state.isExpanded&&!this.state.isScrolledToTop?this._onPan:this._onPanVertical,panPixelThreshold:20,releaseOnRequest:!1,importantForAccessibility:o.Types.ImportantForAccessibility.No},i,n,t)),l={icon:k.SkypeIcon.ClosePanel,onPress:this._onCloseButtonClick,title:y.getString("Global.CloseButtonTitle")},c=o.createElement(o.GestureView,{onPanVertical:this._onPanVertical,panPixelThreshold:20,releaseOnRequest:!1,importantForAccessibility:o.Types.ImportantForAccessibility.No},o.createElement(I.SimplePanelHeader,{ref:this._onHeaderRef,panelName:y.getString("MessageComposerOverflow.AddTitle"),leftButton:l,hideBottomBorder:!0,dontFocusOnMount:!0})),u=[this.state.expandEnabled?x.contentContainer:x.contentContainerStaticHeight,this._contentContainerTransformStyle,this._themeStyles.primaryBackgroundColorStyle];let g;this.state.expandEnabled||u.push(o.Styles.createViewStyle({height:this.state.viewDimensions.height*(1-this._sheetOffset())},!1)),g=e?[x.containerHidden]:this.state.expandEnabled?[x.container,this._containerHeightStyle]:[x.containerStaticHeight];const m=e?o.Types.ImportantForAccessibility.NoHideDescendants:o.Types.ImportantForAccessibility.No,S=e?void 0:o.createElement(o.Button,{style:x.backgroundContainer,onPress:this._onDismissCallback,disableTouchOpacityAnimation:!0,importantForAccessibility:o.Types.ImportantForAccessibility.NoHideDescendants},o.createElement(o.Animated.View,{style:[x.background,this._backgroundOpacityStyle]}));return o.createElement(d.default,{isPresentedInMobileSheet:!0},o.createElement(o.Animated.View,{style:g,blockPointerEvents:e,importantForAccessibility:m,onLayout:this._onLayoutChanged},S,o.createElement(o.Animated.View,{style:u},a,o.createElement(o.Animated.View,{style:[x.headerShadow,this._themeStyles.headerShadowColorStyle,this._headerOpacityStyle]}),c,o.createElement(o.Animated.View,{style:this._headerTopStyle}))))}}t.MessageComposerOverflow=O,t.default=O},59680:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageComposerOverflowCarousel=void 0;const i=s(96486),o=s(16778),n=s(47409),r=s(65947),a=s(15877),l=s(90284),d=s(98401),c=(0,a.lazyProperties)({overflowMenu:()=>o.Styles.createViewStyle({flexDirection:"row",alignSelf:"stretch",marginBottom:5}),overflowMenuRTL:()=>o.Styles.createViewStyle({flexDirection:"row-reverse",transform:[{scaleX:-1}]})});class h extends n.default{_elementCount(){return this.props.menuItems.length}_height(){}_renderElements(e){if(!this.props.viewDimensions.width)return;const t=this.props.menuItems.length,s=r.default.columnWidthInfo(this.props.responsiveWidth,this.props.viewDimensions.width,0,0),n=t>s.columnCount,a=n?o.Styles.createViewStyle({width:Math.max(this.props.viewDimensions.width/(s.columnCount+.5),l.OverflowItemSizeInGridOrCarousel)},!1):s.columnWidthStyle;let h=i.map(this.props.menuItems,(e=>d.default.overflowItemForDescriptor(e,this.props,this._themeStyles,a)));const u=[c.overflowMenu];return n&&e&&(u.push(c.overflowMenuRTL),h=i.reverse(h)),{elements:o.createElement(o.View,{style:u},h),useStaticContainer:!n}}}t.MessageComposerOverflowCarousel=h,t.default=h},67339:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageComposerOverflowGrid=void 0;const i=s(96486),o=s(16778),n=s(65947),r=s(15877),a=s(98401),l=s(24576),d=(0,r.lazyProperties)({overflowMenu:()=>o.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap",alignSelf:"stretch"})});class c extends l.default{render(){if(!this.props.viewDimensions.width)return;const e=n.default.columnWidthInfo(this.props.responsiveWidth,this.props.viewDimensions.width,0,0).columnWidthStyle;let t=i.map(this.props.menuItems,(t=>a.default.overflowItemForDescriptor(t,this.props,this._themeStyles,e)));return o.createElement(o.View,{style:d.overflowMenu},t)}}t.MessageComposerOverflowGrid=c,t.default=c},8145:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(31844),n=s(15069),r=s(62698),a=s(25465),l=s(79737),d=s(16778),c=s(97691),h=s(4736),u=s(60),p=s(89391),g=s(39119),m=s(80843),S=s(68894),f=s(78723),y=s(94655),_=s(16625),v=s(48649),C=s(47447),b=s(5531),T=(s(14920),s(14980),s(51267)),M=s(71908),I=s(51077),w=s(71830),P=s(97775),k=s(96418),A=s(11009),E=(s(11930),s(47204)),R=s(8223),L=s(81632),F=s(17677),x=s(20770),O=s(39549),D=s(86374),B=s(84817),V=s(43368),N=s(10547),U=s(37490),H=s(52262),z=s(92069),W=s(30757),j=s(82433),G=s(70891),K=s(4604),q=s(46096),Q=s(1014),X=s(29245),$=s(61317),J=s(53559),Y=s(30387),Z=s(13944),ee=s(66649),te=s(97174),se=s(23944),ie=s(36237),oe=s(61253),ne=s(10400),re=s(72490),ae=s(47126),le=s(15877),de=s(20022),ce=s(33754),he=s(88824),ue=s(80372),pe=s(24897),ge=s(38915),me=s(9748),Se=s(18743),fe=s(64862),ye=s(6286),_e=s(3088),ve=s(47193),Ce=s(61428),be=s(23752),Te=s(71639),Me=s(6658),Ie=s(12056),we=s(40897),Pe=s(44972),ke=s(45532),Ae=s(89808),Ee=s(78735),Re=s(4735),Le=s(30124),Fe=s(17252),xe=s(33348),Oe=s(43501),De=s(69399),Be=s(79348),Ve=s(63584),Ne=s(58962),Ue=s(99070),He=s(85207),ze=s(29130),We=s(57946),je=s(15963),Ge=s(20360),Ke=s(86045),qe=s(37589),Qe=s(15301),Xe=s(49769),$e=s(97639),Je=s(63080),Ye=s(95960),Ze=s(50795),et=s(81760),tt=s(40363),st=s(11010),it=s(11828),ot=s(78262),nt=s(80837),rt=s(60305),at=s(24576),lt=s(12770),dt=s(26712),ct=s(73096),ht=s(72758),ut=s(53374),pt=s(56503),gt=s(67024),mt=et.Color.darkMessageComposerContentBackground,St=et.Color.gray400Overlay10,ft=it.IconSize.default,yt=it.IconSize.default,_t=yt-4,vt=l.unicodeLetterRegex,Ct={instantTriggers:[`^(@[${vt}-]{0,16} ?[${vt}-]{0,16})$`,`.*\\W(@[${vt}]{0,16} ?[${vt}]{0,16})$`,"^(/\\w{0,16})$",".*(\\([a-zA-Z:]{2,16})$",".*(\\([a-zA-Z:]{2,16}:[1-6]?)$"],delayedTriggers:[".*\\b([A-Z][A-Za-z]{2,31})$"]};var bt;!function(e){e[e.OverflowButton=0]="OverflowButton",e[e.OverflowButtonCoachMark=1]="OverflowButtonCoachMark"}(bt||(bt={}));const Tt=(0,le.lazyProperties)({messageComposerNewComposer:()=>d.Styles.createViewStyle({marginBottom:5,paddingLeft:8}),messageComposerNewComposerSmallDevice:()=>d.Styles.createViewStyle({paddingLeft:2}),doNotFormatLightTheme:()=>d.Styles.createViewStyle({borderColor:et.Color.gray100}),doNotFormatDarkTheme:()=>d.Styles.createViewStyle({borderColor:et.Color.gray300}),sendButton:()=>d.Styles.createViewStyle({borderRadius:ft/2,height:ft,width:ft}),micButton:()=>d.Styles.createViewStyle({borderRadius:ft/2,height:ft,width:ft,paddingLeft:6}),sendButtonHover:()=>d.Styles.createButtonStyle({backgroundColor:et.Color.blueOverlay70}),compositionAreaContainer:()=>d.Styles.createViewStyle({position:"absolute",flexDirection:"row",left:0,right:0,bottom:0}),compositionArea:()=>d.Styles.createViewStyle({paddingLeft:8,flex:1,justifyContent:"center"}),compositionAreaNewComposer:()=>d.Styles.createViewStyle({paddingLeft:15,justifyContent:"flex-end",overflow:"visible"}),inputArea:()=>d.Styles.createViewStyle({flexDirection:"row"}),expandableArea:()=>d.Styles.createViewStyle({flex:1,maxHeight:96,backgroundColor:et.Color.transparent}),expandableAreaNewComposer:()=>d.Styles.createViewStyle({maxHeight:110}),expandableAreaWithQuote:()=>d.Styles.createViewStyle({flex:1,maxHeight:48}),expandableAreaWithQuoteNewComposer:()=>d.Styles.createViewStyle({maxHeight:80}),expandableAreaLandscapeMaxHeight:()=>d.Styles.createViewStyle({maxHeight:48}),composerInner:()=>d.Styles.createViewStyle({flex:1,flexDirection:"row",marginVertical:9,marginHorizontal:13}),composerOuter:()=>d.Styles.createViewStyle({flex:1,flexDirection:"row",borderColor:et.Color.transparent,borderStyle:"solid",borderWidth:3}),composerInnerMobile:()=>d.Styles.createViewStyle({marginTop:5,marginBottom:0,marginHorizontal:4}),composerInnerMobileNewComposer:()=>d.Styles.createViewStyle({marginTop:5,marginHorizontal:0}),composerInnerMobileNewComposerExtraPadding:()=>d.Styles.createViewStyle({marginLeft:3}),composerInnerLandscape:()=>d.Styles.createViewStyle({marginTop:4,marginBottom:2}),innerContainerNewComposer:()=>d.Styles.createViewStyle({alignItems:"flex-end"}),innerWrapperNewComposer:()=>d.Styles.createViewStyle({borderRadius:_t/2,minHeight:_t,alignItems:"center",marginBottom:2,marginHorizontal:3,overflow:"visible"}),innerWrapperNewComposerSmallDevice:()=>d.Styles.createViewStyle({marginHorizontal:0}),rightControlContainer:()=>d.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),quoteArea:()=>d.Styles.createViewStyle({flex:1,paddingTop:6,paddingLeft:12}),quoteAreaNewComposer:()=>d.Styles.createViewStyle({paddingLeft:0,borderBottomWidth:1,marginBottom:5}),quoteTextStyle:()=>d.Styles.createTextStyle({fontStyle:"italic"}),quoteAttributeStyle:()=>d.Styles.createTextStyle({fontSize:st.default.controlFontSize.messageStreamQuoteAttributeMobile}),attachmentButton:()=>d.Styles.createViewStyle({paddingLeft:12,alignItems:"flex-end"}),cameraButton:()=>d.Styles.createViewStyle({height:ft,width:ft}),overflowButton:()=>d.Styles.createViewStyle({height:ft,width:ft}),moreButton:()=>d.Styles.createViewStyle({paddingRight:8,alignItems:"flex-end",height:50}),skypeMessageTextInput:()=>d.Styles.createTextStyle({font:st.default.font.uiDisplayRegular,fontSize:st.default.controlFontSize.messageComposerDesktop,minHeight:23,backgroundColor:et.Color.transparent}),textInputFocusButton:()=>d.Styles.createButtonStyle({position:"absolute",top:0,bottom:0,left:0,right:0,backgroundColor:et.Color.transparent}),linkStyle:()=>d.Styles.createTextStyle({fontSize:st.default.controlFontSize.body,lineHeight:18,color:et.Color.gray400,fontFamily:st.default.fontFamily.uidDisplayRegular,textDecorationLine:"underline"}),emoticonIconNewComposer:()=>d.Styles.createButtonStyle({paddingTop:8,paddingLeft:0,paddingRight:8,paddingBottom:8}),emoticonIconWrapper:()=>d.Styles.createViewStyle({alignSelf:"flex-end"}),rightIconContainer:()=>d.Styles.createViewStyle({alignSelf:"stretch",justifyContent:"space-between"}),clearQuoteNewComposer:()=>d.Styles.createButtonStyle({alignSelf:"flex-start",marginTop:6,marginBottom:10,paddingLeft:0,paddingRight:8}),emoteAuthor:()=>(0,le.lazyProperties)({text:()=>d.Styles.createTextStyle({fontSize:st.default.controlFontSize.messageComposerDesktop,marginTop:7,fontStyle:"italic"}),textDesktop:()=>d.Styles.createTextStyle({marginTop:5,marginBottom:3})}),mediaBarMargins:()=>d.Styles.createViewStyle({marginHorizontal:10}),desktopOverrides:()=>(0,le.lazyProperties)({messageComposer:()=>d.Styles.createViewStyle({minHeight:60,justifyContent:"center",borderColor:et.Color.transparent,borderStyle:"solid",borderWidth:3}),messageComposerAllRoundCorners:()=>d.Styles.createViewStyle({borderRadius:10}),messageComposerTopFlatCorners:()=>d.Styles.createViewStyle({borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:10,borderBottomRightRadius:10}),compositionAreaContainer:()=>d.Styles.createViewStyle({flexDirection:"column"}),compositionArea:()=>d.Styles.createViewStyle({paddingLeft:12,paddingRight:12}),expandableArea:()=>d.Styles.createViewStyle({maxHeight:175}),expandableAreaWithQuote:()=>d.Styles.createViewStyle({maxHeight:133}),expandableAreaSmallView:()=>d.Styles.createViewStyle({maxHeight:133}),expandableAreaWithQuoteSmallView:()=>d.Styles.createViewStyle({maxHeight:91}),composerInner:()=>d.Styles.createViewStyle({marginVertical:2,marginHorizontal:9}),rightControlContainer:()=>d.Styles.createViewStyle({minHeight:50,marginLeft:15})})});let Mt=45;const It=!1;class wt extends at.default{constructor(){super(...arguments),this._isPostingMessage=!1,this._gotInitialInputAreaHeight=!1,this._inputAreaHeight=Mt,this._inputAreaTargetHeight=this._inputAreaHeight,this._inputAreaHeightValue=new d.Animated.Value(this._inputAreaHeight),this._inputAreaHeightStyle=d.Styles.createAnimatedViewStyle({height:this._inputAreaHeightValue}),this._rightControlsWidthValue=new d.Animated.Value(2*yt),this._rightControlsWidthStyle=d.Styles.createAnimatedViewStyle({width:this._rightControlsWidthValue}),this._rightControlsOpacityValue=new d.Animated.Value(1),this._rightControlsOpacityStyle=d.Styles.createAnimatedViewStyle({opacity:this._rightControlsOpacityValue}),this.insertSearchResult=(e,t,s)=>{wt._announceForAccessibility(e),this.autoReplaceText(e,t,s),we.default.deactivateInlineSearch()},this.autoReplaceText=(e,t,s)=>{if(d.UserInterface.isNavigatingWithKeyboard()&&this.state.selectedMediaBarItem&&pe.MediaBarItem.dismissPopup(this._getRootViewId()),"Emoticon"===t){const e=ce.getString("MessageComposer.AccessibilityAnnouncement_EmoticonInserted");wt._announceForAccessibility(e)}else wt._announceForAccessibility(e);if(this._textInputRef){const e=ve.getEditableEntityFromInputEntityAndConsiderAlternatives(s,this.state.emoticons);this._textInputRef.insertContent(e),this._textInputRef.requestFocus(),this._textInputRef.getContent().then((e=>{this.isComponentMounted()&&this._consumeNewUserInput(e)}))}},this.requestFocus=()=>{this._textInputRef&&(n.BrowserEnvironment.isEngineEdgeHTML()&&document.activeElement&&document.activeElement.blur(),this._textInputRef.requestFocus())},this.blur=()=>{this._textInputRef&&this._textInputRef.blur()},this.focusOverflowButton=()=>{this._overflowButtonRef&&this._overflowButtonRef.requestFocus()},this.focusVideoButton=()=>{const e=this._mediaBarRef?this._mediaBarRef.getItemById(me.MediaBarItemKeys.VideoMessage):void 0;e&&e.requestFocus()},this.focusSendButton=()=>{this._inputButton&&this._inputButton.requestFocus()},this.setTextInputAccessibilityFocus=()=>{this._textInputRef&&(this._textInputRef.setAccessibilityFocus(),this.props.explicitAccessibilityAnnoucement&&d.Accessibility.announceForAccessibility(this._placeholderText))},this._handleCustomKeyboardHiddenEvent=()=>{this._resetSelectedKeyboard()},this._resetSelectedKeyboard=()=>{this._trimTextInputIfEmpty()},this._onEmoticonSelected=e=>{this.autoReplaceText(e.text(),"Emoticon",e)},this._onMojiSelected=e=>{this.props.conversationId&&(He.default.postMessageFromInput(this.props.conversationId,q.PostSource.MediaPicker,[e],I.MessageTypes.Media_FlikMsg,{name:je.ScenarioName.SendMoji},void 0,this._getRootViewType()),this._announceForAccessibilityForMessageSent()),this._closePesPickerAndFocusTextInput()},this._onStickerSelected=e=>{this.props.conversationId&&(He.default.postMessageFromInput(this.props.conversationId,q.PostSource.MediaPicker,[e],I.MessageTypes.RichText,{name:je.ScenarioName.SendSticker},void 0,this._getRootViewType()),this._announceForAccessibilityForMessageSent()),this._closePesPickerAndFocusTextInput()},this._onGifSelected=e=>{this.props.conversationId&&(He.default.postMessageFromInput(this.props.conversationId,q.PostSource.MediaPicker,[e],I.MessageTypes.RichText,{name:je.ScenarioName.SendGif},void 0,this._getRootViewType()),this._announceForAccessibilityForMessageSent()),this._closePesPickerAndFocusTextInput()},this._closePesPickerAndFocusTextInput=()=>{this.state.useMobileUI?this.isComponentMounted()&&this.setState({selectedMediaBarItem:""}):this._closeUnifiedPesPickerDesktop(),this.setTextInputAccessibilityFocus()},this._onSMSInfoLineRef=e=>{this._smsInfoLineRef=e||void 0},this._onClearQuoteButtonPress=()=>{this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(!0)},this._onPhoneNumberForSmsSelected=e=>{const t=ut.default.newCauseId();ie.log(q.LogTraceArea.MessageComposer,"MessageComposer._onPhoneNumberForSmsSelected causeId: "+t),this.state.useThreadsFor2way&&this.state.twoWaySMSCapable?e&&Re.default.navigateToConversation({convId:w.getMriFromPhoneNumber(e),origin:q.NavigationConversationOrigin.SMSNumberSwitch,selectedNumberForSMS:e,causeId:t}):Re.default.navigateToConversation({convId:this.props.conversationId,origin:q.NavigationConversationOrigin.SMSNumberSwitch,selectedNumberForSMS:e,causeId:t})},this._saveMessage=e=>{if(e&&e.length>0||this._hasQuotes()||this.props.editedMessage){let t,s=We.SavedMessageType.None;this.props.editedMessage?(t=[this.props.editedMessage],s=We.SavedMessageType.Edited):this.props.quotedMessages&&(t=this.props.quotedMessages,s=We.SavedMessageType.Quoted),x.default.saveMessageInput(this.props.conversationId,{messages:t,type:s,inputEntities:e,inputEntitiesDataVersion:this.state.inputEntitiesDataVersion,timestamp:Date.now()})}else x.default.clearMessageInput(this.props.conversationId)},this._onCancelPesSearch=(e,t)=>{e&&x.default.clearMessageInput(this.props.conversationId);const s=x.default.getSavedMessageInput(this.props.conversationId);(!s||s&&!s.messages)&&(this.props.quotedMessages&&this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(),this.props.editedMessage&&this.props.onClearEdit&&this.props.onClearEdit());const i=s?s.inputEntities:[];this._setInputEntityStateDownstream(i,t),this.isComponentMounted()&&this.setState({selectedMediaBarItem:""})},this._onAnimatedViewRef=e=>{this._animatedViewRef=e||void 0},this._onTextInputRef=e=>{this._textInputRef=e||void 0},this._onClearEditMessageQuote=()=>{const e=i.head(this.state.inputEntities);this._textInputRef&&e instanceof te.QuoteEntity&&this._textInputRef.getContent().then((e=>{const t=this._consumeNewUserInput(e)||this.state.inputEntities;this._setInputEntityStateDownstream(t.slice(1,t.length))}))},this._renderEmoticonPickerItem=e=>d.createElement(W.EmoticonPickerItem,Object.assign({},e)),this._renderMojiPickerItem=e=>d.createElement(ke.MojiPickerItem,Object.assign({},e)),this._renderGifPickerItem=e=>d.createElement(Y.GifPickerItem,Object.assign({},e)),this._renderStickerPickerItem=e=>d.createElement(Ye.StickerPickerItem,Object.assign({},e)),this._renderSmsItem=e=>d.createElement(Je.SmsItem,Object.assign({},e)),this._renderMediaPickerItem=e=>d.createElement(X.default,Object.assign({acceptedFileTypes:X.AcceptedFileTypes.MediaOnly},e)),this._renderFilePickerItem=e=>d.createElement(X.default,Object.assign({acceptedFileTypes:X.AcceptedFileTypes.All},e)),this._renderCameraItem=e=>d.createElement(v.CameraItem,Object.assign({},e)),this._renderScheduleCallItem=e=>d.createElement(Ge.ScheduleCallItem,Object.assign({},e)),this._renderPollItem=e=>d.createElement(Ue.PollItem,Object.assign({},e)),this._renderLocationPickerItem=e=>d.createElement(he.default,Object.assign({},e)),this._renderContactPickerItem=e=>d.createElement(R.ContactPickerItem,Object.assign({},e)),this._renderBingSearchItem=e=>d.createElement(f.BingSearchItem,Object.assign({},e)),this._renderVideoMessageItem=e=>d.createElement(pt.default,Object.assign({},e)),this._renderPeopleItem=e=>d.createElement(Oe.PeopleItem,Object.assign({},e)),this._renderSendCreditItem=e=>d.createElement(qe.SendCreditItem,Object.assign({},e)),this._onOverflowButtonRef=e=>{this._overflowButtonRef=e||void 0},this._onMediaBarRef=e=>{this._mediaBarRef=e||void 0},this._onLaunchCameraFromComposer=()=>{ie.track(new Se.MediaBarItemPressed(me.MediaBarItemKeys.ComposerCamera,!0,this.props.conversationId,ge.MediaBarItemOrigin.MessageComposer)),this.props.onLaunchCamera&&(this._textInputRef&&this._textInputRef.dismissKeyboard(),this.props.onLaunchCamera())},this._getEmoticonPickerKeyboard=(e,t)=>{const s=this._keyboardHeight(),i=[nt.default.overflowVisible];return s?i.push(d.Styles.createViewStyle({height:s},!1)):i.push(nt.default.flexOne),d.createElement(d.View,{style:i},W.EmoticonPickerItem.getVirtualKeyboard(e,t),this._renderPesPickerPopup())},this._renderPesPickerPopup=()=>d.createElement(Be.PesPickerPopup,{ref:this._onPesPickerPopupRef,renderMobileInterface:It}),this._onPesPickerPopupRef=e=>{this._pesPickerPopup=e||void 0},this._getPesPickerPopupRef=()=>this._pesPickerPopup,this._onCustomKeyboardClose=()=>{this._pesPickerPopup&&this._pesPickerPopup.hide()},this._onLayoutInputArea=e=>{const t=Math.ceil(e.height);if(this._gotInitialInputAreaHeight?(this._inputAreaTargetHeight=t,this._animateInputAreaToTargetHeight()):(this._inputAreaTargetHeight=t,this._inputAreaHeight=t,this._inputAreaHeightValue.setValue(t),Mt=t,this._gotInitialInputAreaHeight=!0),this._lastReceivedInputAreaWidth!==e.width){let t=0;const s=this._getMediaBarItemDescriptors();if(this._lastReceivedInputAreaWidth=e.width,!i.isUndefined(s)){t=40*s.length}const o=e.width-t<230;this.setState({isMediaBarCollapsable:o,isCollapsableMediaBarExpanded:!o})}},this._onHandleCustomAction=(e,t)=>{switch(e){case ot.MediaBarCustomAction.LaunchCamera:this.props.onLaunchCamera&&this.props.onLaunchCamera();break;case ot.MediaBarCustomAction.LaunchEmoticon:Ve.EmoticonPickerTelemetry.startOpenScenario(),Ve.EmoticonPickerTelemetry.open(),we.default.activatePicker(Ne.TabType.Emoticon),this._onPickerActive(me.MediaBarItemKeys.Emoticon);break;case ot.MediaBarCustomAction.LaunchMoji:Ve.MojiPickerTelemetry.open(),we.default.activatePicker(Ne.TabType.Moji),this._onPickerActive(me.MediaBarItemKeys.Moji);break;case ot.MediaBarCustomAction.LaunchSticker:Ve.StickerPickerTelemetry.open(),we.default.activatePicker(Ne.TabType.ChatSticker),this._onPickerActive(me.MediaBarItemKeys.Sticker);break;case ot.MediaBarCustomAction.LaunchGif:Ve.GifPickerTelemetry.open(),we.default.activatePicker(Ne.TabType.Gif),this._onPickerActive(me.MediaBarItemKeys.Gif);break;default:ie.log(q.LogTraceArea.MessageComposer,"_onHandleCustomAction unhandled action: "+e)}},this._onComposerOverflowPress=()=>{ie.track(new Se.MediaBarItemPressed(bt[bt.OverflowButton],!0,this.props.conversationId,ge.MediaBarItemOrigin.MessageComposer)),this._onToggleOverflowMenu()},this._onComposerOverflowCoachMarkPress=()=>{ie.track(new Se.MediaBarItemPressed(bt[bt.OverflowButtonCoachMark],!0,this.props.conversationId,ge.MediaBarItemOrigin.MessageComposer)),this._onToggleOverflowMenu()},this._onToggleOverflowMenu=()=>{if(this.isComponentMounted()){let e=!1;if(this.props.onHandleOverflow&&(e=this.props.onHandleOverflow(this._overflowActions())),!e){const e=!this.state.showOverflowMenu;e&&(a.default.dismiss(),this._textInputRef&&this._textInputRef.dismissKeyboard()),this.isComponentMounted()&&this.setState({showOverflowMenu:e,selectedMediaBarItem:e?"":this.state.selectedMediaBarItem})}}},this._onDismissMediaPicker=()=>{a.default.showNativeKeyboard(),this.isComponentMounted()&&this.setState({selectedMediaBarItem:""})},this._onMoreButtonClick=e=>{this.isComponentMounted()&&this.setState({isCollapsableMediaBarExpanded:!this.state.isCollapsableMediaBarExpanded}),e.stopPropagation()},this._onUnifiedPesPickerDesktopPress=()=>{this.state.isShowingUnifiedPesPickerDesktop||(Ve.EmoticonPickerTelemetry.startOpenScenario(),V.default.open(this._getRootViewId()))},this._closeUnifiedPesPickerDesktop=()=>{this.state.isShowingUnifiedPesPickerDesktop&&V.default.close(this._getRootViewId())},this._onPickerActive=e=>{this._textInputRef&&this._textInputRef.getContent().then(this._consumeNewUserInput),this.isComponentMounted()&&this.setState({selectedMediaBarItem:e,isCollapsableMediaBarExpanded:!this.state.isMediaBarCollapsable,showOverflowMenu:!1})},this._onMediaBarItemSelected=e=>{(this.state.isCollapsableMediaBarExpanded||this.state.selectedMediaBarItem!==e)&&(this.isComponentMounted()&&this.setState({selectedMediaBarItem:e===me.MediaBarItemKeys.Sms?"":e,isCollapsableMediaBarExpanded:!0,showOverflowMenu:!1}),this.props.onMediaItemSelected&&this.props.onMediaItemSelected()),e===me.MediaBarItemKeys.Sms&&(1===this.state.phoneNumbers.length?this._toggleSmsSending(!0,this.state.phoneNumbers[0]):Xe.default.showNumberSelectionPopup((()=>this._smsInfoLineRef),this._getRootViewId(),this.props.conversationId,this.state.phoneNumbers,!1).then((e=>{this._toggleSmsSending(!0,e)})).catch(i.noop))},this._onCancelEditClick=e=>{e.stopPropagation();const t=ut.default.newCauseId();gt.default.createOneShotTrackerAndMarkPressTime(t,je.ScenarioName.ResponsivenessCancelEditMessage,e),wt._announceForAccessibility(ce.getString("MessageComposer.MessageEditingCanceledLabel")),this._handleAfterPostMessage(this.props.conversationId)},this._onSendButtonClick=e=>{e.stopPropagation();const t=ut.default.newCauseId();gt.default.createOneShotTrackerAndMarkPressTime(t,je.ScenarioName.ResponsivenessSendEditMessage,e),this._textInputRef&&this._textInputRef.getContent().then((e=>{const t=this._consumeNewUserInput(e);t?this._sendMessage(t):this._setInputEntityStateDownstream(this.state.inputEntities)}))},this._onRecordButtonClick=e=>{e.stopPropagation();const t=ut.default.newCauseId();gt.default.createTrackerAndMarkPressTime(t,je.ScenarioName.ResponsivenessRecordAudio,e),ie.track(new Se.MediaBarItemPressed(me.MediaBarItemKeys.Audio,!0,this.props.conversationId,ge.MediaBarItemOrigin.MessageComposer)),this.props.onRecording&&this.props.onRecording(),gt.default.markActionDoneAndRemoveTracker(t)},this._onInputButtonRef=e=>{this._inputButton=e||void 0},this._onMoreButtonRef=e=>{this._moreButton=e||void 0},this._trimTextInputIfEmpty=()=>{this.isComponentMounted()&&!se.getRawText(this.state.inputEntities).match(/\S|^$/)&&this._setInputEntityStateDownstream([])},this._onAutoCompletionRequested=(e,t)=>(this._pendingMessageTextCompletionPromise&&(this._pendingMessageTextCompletionPromise.reject(),this._pendingMessageTextCompletionPromise=void 0),this.props.onInputTextChanged&&this._wasRegexTriggered(t)&&(this._pendingMessageTextCompletionPromise=c.Defer(),this.props.onInputTextChanged(e,!1)),this._pendingMessageTextCompletionPromise?this._pendingMessageTextCompletionPromise.promise():c.Rejected()),this._onAutoCompletionRequestAborted=()=>{this._cancelAutoCompletionIfActive()},this._onAutoCompletionNavigationKey=e=>{if(this.props.onKeyPress&&this.props.onKeyPress(e),e.keyCode===ae.default.ESCAPE)this._cancelAutoCompletionIfActive()},this._onUserInputActive=()=>{ct.default.setComposingState(!0,this.props.conversationId)},this._onUserInputInactive=()=>{ct.default.setComposingState(!1,this.props.conversationId)},this._onUserInputCommitted=e=>{const t=this._consumeNewUserInput(e);t&&(ct.default.setComposingState(!1,this.props.conversationId),this._sendMessage(t))},this._onPastingText=e=>{this.isComponentMounted()&&this.setState({messageComposerPastedContentType:e})},this._setComposingStateInactiveDebounced=i.debounce((()=>{ct.default.setComposingState(!1,this.props.conversationId)}),300,{leading:!0,trailing:!0}),this._onUserInputAborted=()=>{this.state.selectedMediaBarItem===me.MediaBarItemKeys.Emoticon||this.state.isShowingUnifiedPesPickerDesktop||(this._setComposingStateInactiveDebounced(),this._hasQuotes()&&this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(!0),this.props.editedMessage&&(this.props.onClearEdit&&this.props.onClearEdit(),x.default.clearMessageInput(this.props.conversationId)),this._cancelAutoCompletionIfActive())},this._onUserInputEmptyIndicationChanged=e=>{this.isComponentMounted()&&this.setState({userInputIsEmpty:e}),this.props.onNativeComposerMessageEmptyStateChanged&&this.props.onNativeComposerMessageEmptyStateChanged()},this._onUserInputUncommittedChangesIndicationChanged=e=>{this.isComponentMounted()&&this.setState({hasUncommittedUserInput:e})},this._onEqualsInitialContentIndicationChanged=e=>{this.isComponentMounted()&&this.setState({equalsInitialContent:e})},this._onUserInputBackspacePressedAtHeadPos=()=>{this._hasQuotes()&&this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(!0),this.state.userInputIsEmpty&&this.props.editedMessage&&this.props.onClearEdit&&this.props.onClearEdit()},this._onAccessibilityAnnouncementRequested=e=>{if(e===l.AccessibilityAnnouncement.NewLineAdded)d.Accessibility.announceForAccessibility(ce.getString("MessageComposer.AccessibilityAnnouncement_NewlineAdded"))},this._onEmoticonLoadCompleted=e=>{ie.track(new De.ComposerEmoticonLoaded(e,Le.default.isUsingStackNavigationContext()))},this._onPartiallyEnteredMsgStoreUpdated=e=>{if(e===this.props.conversationId){const t=x.default.getSavedMessageInput(e);t&&t.inputEntitiesDataVersion===this.state.inputEntitiesDataVersion&&this._setInputEntityStateUpstream(t.inputEntities)}},this._consumeNewUserInput=e=>{let t;return e.downStreamDataVersion>=this.state.inputEntitiesDataVersion&&(t=se.applyEditableContentToInputEntities(e,this.state.inputEntities),this._setInputEntityStateUpstream(t)),t},this._onCompositionAreaPress=e=>{this.state.hasFocus||this._hasQuotes()||this.requestFocus()},this._onCompositionAreaKeyPress=e=>{this.state.isCollapsableMediaBarExpanded&&e.keyCode===ae.default.ESCAPE&&this.isComponentMounted()&&this.setState({isCollapsableMediaBarExpanded:!this.state.isMediaBarCollapsable},(()=>{this._moreButton&&this._moreButton.requestFocus()}))},this._onFocus=()=>{let e={hasFocus:!0,isCollapsableMediaBarExpanded:!this.state.isMediaBarCollapsable,showOverflowMenu:!1};this.isComponentMounted()&&this.setState(e)},this._onBlur=()=>{const e={hasFocus:!1};this.isComponentMounted()&&this.setState(e),this.props.onBlur&&this.props.onBlur()},this._onPaste=e=>{let t=e.nativeEvent;!this.props.disableCopyPasteMedia&&t.clipboardData&&t.clipboardData.items&&0!==t.clipboardData.items.length&&(i.some(t.clipboardData.items,(e=>"text/plain"===e.type))||(i.each(t.clipboardData.items,(t=>{if("image/png"===t.type){e.stopPropagation(),e.preventDefault();const s=new FileReader;let o=t.getAsFile();if(o instanceof e.nativeEvent.target.ownerDocument.defaultView.Blob){const e="image_"+(new Date).toISOString().replace(/[:\.\-]/g,"_")+".png",t=i.attempt((t=>new File([t],e,{type:t.type})),o);i.isError(t)||(o=t),s.onload=()=>{if(o&&o.size>0){let e={file:o,extension:J.default.extractFileExtension(o.name)};this._sendFileWithDimensions(e)}},s.readAsDataURL(o)}}})),wt._announceForAccessibility(ce.getString("MessageComposer.FilesSentLabel"))))},this._onPastePreviewInCaptureComplete=()=>{const e=ut.default.newCauseId();ie.log(q.LogTraceArea.MessageComposer,"MessageComposer._onPastePreviewInCaptureComplete",e),this._pastePreviewCompletionHelper(!1)},this._onPastePreviewInCaptureCancel=()=>{const e=ut.default.newCauseId();ie.log(q.LogTraceArea.MessageComposer,"MessageComposer._onPastePreviewInCaptureCancel",e),this._pastePreviewCompletionHelper(!0)},this._announceForAccessibilityForMessageSent=()=>{i.defer((()=>{this.isComponentMounted()&&wt._announceForAccessibility(ce.getString("MessageComposer.MessageSentLabel"))}))},this._handleEmoticonBackspacePress=e=>{this._textInputRef&&this._textInputRef.notifyBackspacePressedExternally()},this._showFilePicker=(e,t)=>{if(t!==this._getRootViewId())return!1;if(this.state.editable&&C.UICapabilities.desktopFilePickerSupported()&&!w.isPhoneMri(this.props.conversationId)&&!w.isS4BBridgeMri(this.props.conversationId)){const t=e=>{const t=J.default.extractFileExtension(e.file.name),s=this._getRootViewType();if(J.default.isVideoExtension(t)){const t={name:je.ScenarioName.SendVideo};He.default.postVideoWithThumbnail([this.props.conversationId],e,q.PostSource.MediaPicker,!1,t,void 0,void 0,void 0,s).then((()=>{wt._announceForAccessibility(ce.getString("MessageComposer.FileSentLabel"))}))}else if(J.default.isImageExtension(t)){const t={name:je.ScenarioName.SendPicture};He.default.postUpload([this.props.conversationId],e,q.PostSource.MediaPicker,!1,{scenarioInfo:t},s).then((()=>{wt._announceForAccessibility(ce.getString("MessageComposer.FileSentLabel"))}))}else{const t={name:je.ScenarioName.SendFile};He.default.postUpload([this.props.conversationId],e,q.PostSource.MediaPicker,!1,{scenarioInfo:t},s).then((()=>{wt._announceForAccessibility(ce.getString("MessageComposer.FileSentLabel"))}))}this.requestFocus()};$.FilePickerUtils.isDocumentPickerSupported()?$.FilePickerUtils.showDocumentPicker(t,this._getRootViewId()):$.FilePickerUtils.showMultiFilesPicker(t,Se.FilePickerOrigin.MessageComposer,void 0,this._getRootViewId(),e)}return!0},this._editLastMessageKeyboardShortcut=(e,t)=>t===this._getRootViewId()&&(this._editLastMessage(),!0),this._focusKeyboardShortcut=(e,t)=>t===this._getRootViewId()&&(this.requestFocus(),!0),this._editLastMessage=()=>{this.props.onEditLastMessage&&this.props.onEditLastMessage()},this._updateAndStoreDraftInputEntitiesFromContent=e=>(ie.log(q.LogTraceArea.MessageComposer,"MessageComposer._updateAndStoreDraftInputEntitiesFromContent causeId: "+e),this._textInputRef?this._textInputRef.getContent().then((e=>x.default.updateInputEntitiesFromContent(this.props.conversationId,e).commit(this.props.conversationId).storeSavedMessage(this.props.conversationId))):c.Resolved()),this._validateUrl=e=>dt.default.isUrlValid(e)}_buildState(e,t){var s;const o={},r=this.props,a=this._getRootViewId(),d=p.default.getS4LMessagingFeatures(),c=p.default.getS4LCommerceFeatures();t&&(o.inputEntities=e.initialInputEntities||[],o.inputEntitiesDataVersion=e.initialInputEntitiesDataVersion||0,o.hasFocus=!1,o.isCollapsableMediaBarExpanded=!1,o.isMediaBarCollapsable=It,o.selectedMediaBarItem="",o.offsetTop=0,o.showOverflowMenu=!1,o.userInputIsEmpty=i.isEmpty(o.inputEntities),o.hasUncommittedUserInput=!1,o.equalsInitialContent=!0,o.currentNumberOfIconsInMediaBar=o.maxNumberOfIconsInMediaBarForWidth,o.pesPickerKeyboardHeight=276,o.messageComposerPastedContentType=l.PastedTextType.None);const h=Le.default.isUsingStackNavigationContext();o.useTabletUI=rt.default.useTabletUI(),o.isKeyboardSeen=ne.default.isKeyboardSeen(),o.deviceOrientation=ze.default.getDeviceOrientation(a),o.isSmallOrTinyScreen=ze.default.isSmallOrTinyScreenSize(a),o.useMobileUI=h||o.useTabletUI,o.editable=!xe.default.isAnimationPending()&&!e.disableActionOnMessageComposer,o.isSmallHeightView=ze.default.isSmallDesktopHeightView(a),o.viewportWidth=e.availableWidth||ze.default.getWidth(a),o.showAdditionalMediaBarItems=o.viewportWidth>=360,o.gradientColors=Ae.default.getGradientColors(),o.delayedTriggersWaitTime=d.composerAutoCompletionDelay,o.emoticons=j.default.getEmoticons(),o.isUsingStackNavigationContext=h,o.isShowingUnifiedPesPickerDesktop=!e.hideMediaBar&&V.default.shouldShow(a),o.enablePollExtensionEntryPoint=d.enablePollExtensionEntryPoint,o.messageStreamFontSize=Ee.default.getMessageStreamFontSize(),o.canUseAddins=b.default.addins().canUseAddins,o.isMediaPickerInRightControlsForMobile=d.showMediaPickerInRightControlsForMobile,o.editableEntities=ve.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives(o.inputEntities||[],o.emoticons);const{selectedTabType:u,searchQuery:m}=V.default.getPickerSearchProps();o.selectedTabType=u,o.searchQuery=m,t&&!o.editable&&(o.overrideEditable=!0),o.showLocationPicker=!e.hideLocationPickerIcon&&d.enableLocationSharingOnDesktopAndWeb&&!tt.default.isFireOS(),o.showContactPicker=!e.hideContactPickerIcon&&d.enableContactShare&&b.default.contacts().canInvitePeople,o.showStickerPicker=!e.hideStickerPickerIcon&&!1,o.showGifPicker=!e.hideGifPickerIcon&&!1,o.showVideoMessageIcon=!e.hideVideoMessageIcon&&!w.isEncryptedThread(e.conversationId)&&p.default.isDesktopVIMEnabled()&&(B.default.isAVDeviceReady()||n.BrowserEnvironment.isChrome()),o.overflowMenuOrderForMobileUI=o.useMobileUI?d.overflowMenuOrder:[],o.mediaBarMenuOrder=d.mediaBarMenuOrder,o.isSmallDevice=ze.default.isSmallDevice(a),o.useCompactLayout=o.useMobileUI||o.isSmallDevice,o.phoneNumbers=e.otherPartyMri&&ht.default.getFullUserProfileByMri(e.otherPartyMri).phones||[];const S=w.isPhoneMri(e.conversationId);o.creditEntitlement=K.default.getCreditEntitlement(),o.enableOnewaySms=(S||c.smsPromo.unpaidUserEnabled||!!g.getPositiveCreditBalance(o.creditEntitlement)||K.default.userHasSubscriptions())&&(S||w.isOneOnOneConversation(e.conversationId))&&o.phoneNumbers.length>0&&!e.editedMessage&&!e.hideSmsIcon&&!w.isEncryptedThread(e.conversationId),o.quoteTextForSms=this._getQuotedTextForSms(r.quotedMessages,e.quotedMessages),o.disableHighBandwidthOperations=ee.default.isUsingGogoNetwork(),o.isCameraAvailable=C.UICapabilities.cameraSupported()&&T.default.isCameraAvailable(),o.isConversationWithPhoneNumber=w.isConversationWithPhoneNumber(e.conversationId),o.sendMessageWithEnter=!!Ee.default.getUserPreferencesLocal().sendMessageWithEnter,o.enableInCallFindPanel=d.enableInCallFindPanel,o.enableImagePasteMobile=d.enableImagePasteMobile,o.useThreadsFor2way=d.useSmsThreadsFor2way,o.twoWaySMSCapable=!!(null===(s=_.default.getCallerIdPrimaryNumber())||void 0===s?void 0:s.smsCapable);let f=e.phoneNumberForSendingSms;if(!f&&w.isPhoneMri(e.conversationId)){const t=w.getPhoneNumberFromMri(e.conversationId);t&&(f={number:t,type:ot.PhoneNumberTypes.Other})}o.phoneNumberForSendingSms=f,o.isMobilePesPickerActive=we.default.isPickerActive(),o.isMediaPreviewEnabled=ye.default.isMediaPreviewEnabled(e.conversationId),o.hasMediaPreviews=o.isMediaPreviewEnabled&&_e.default.getPreviews(e.conversationId).length>0,o.doNotFormat=Ee.default.getValueOfDoNotFormatPreferenceOrFalseIfDisabled(e.conversationId)&&!o.isConversationWithPhoneNumber,o.enableHandlingHTMLonPaste=!o.doNotFormat&&d.enableHandlingHTMLonPaste,o.enableHandlingHyperlinkOnPaste=!o.doNotFormat&&d.enableHandlingHyperlinkOnPaste,o.isSmsFailureScreenEnabled=o.enableOnewaySms&&c.callFailure.smsFailurePrompt.enabled,o.isOfficeLensAvailable=Fe.isOfficeLensAvailable();const y=(0,O.default)().getConversation(e.conversationId);if(o.isRegularMemberInModeratedGroup=y&&(0,Pe.isRegularMemberInModeratedGroup)(y),t){Qe.default.setDefault(),Qe.default.commitNextFlowId();const t=this._rightControlsLayoutInfo(e,o);this._rightControlsWidthValue.setValue(t.width),this._rightControlsOpacityValue.setValue(t.opacity),this._checkForOutgoingSmsMessagesInConversation(o)}return o}componentDidMount(){super.componentDidMount(),this._dataUpdateSubscription=l.dataUpdateReceivedEvent.subscribe((({forCustomContext:e,newContent:t})=>{e===this.props.conversationId&&this._consumeNewUserInput(t)})),p.default.getS4LMessagingFeaturesNoSubscription().enableDraftMessagesPersistentStorage&&(de.default.addObserver(de.LifecycleEventType.ON_EXIT,this._updateAndStoreDraftInputEntitiesFromContent),this._appStateSubscription=u.default.subscribeForChanges("MessageComposerV2",(e=>{if((!this._textInputRef||this._textInputRef.hasUncommittedChanges())&&i.includes([d.Types.AppActivationState.Inactive,d.Types.AppActivationState.Background],e)){const e=ut.default.newCauseId();ie.log(q.LogTraceArea.MessageComposer,"MessageComposer._appStateSubscription causeId: "+e),this._updateAndStoreDraftInputEntitiesFromContent(e).then((()=>{const e=x.default.getConversationsNumber();e>0&&ie.track(new z.DraftMessageAppExitWithDrafts(e))})).catch(i.noop)}}))),d.Modal.isDisplayed()||!this._shouldAutoFocusInput()&&!this.props.shouldAutoFocus||this.props.preventFocusOnMount||this.requestFocus(),this.state.overrideEditable&&this.setState({overrideEditable:void 0}),this._textInputRef&&this.setState({userInputIsEmpty:this._textInputRef.isEmpty(),hasUncommittedUserInput:this._textInputRef.hasUncommittedChanges(),equalsInitialContent:this._textInputRef.equalsInitialContent()});const e=this._getContext().componentVisibilityStatus;e&&(this._visibilitySubscriptionToken=e.isVisibleEvent().subscribe((e=>{!e&&a.default.isSupported()&&a.default.dismiss()}))),re.default.addHandler(q.KeyboardShortcut.SendFile,this._showFilePicker),re.default.addHandler(q.KeyboardShortcut.EditMessage,this._editLastMessageKeyboardShortcut),re.default.addHandler(q.KeyboardShortcut.FocusMessageComposer,this._focusKeyboardShortcut),this._setAndroidCustomKeyboardHeight(),this._keyboardDismissRegistrationHandle=U.register(this),x.default.onInputEntitiesUpdatedEvent.subscribe(this._onPartiallyEnteredMsgStoreUpdated)}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t);let s=!1,i={};this.props.conversationId&&e.conversationId&&this.props.conversationId===e.conversationId||(s=!0,i.inputEntities=this.props.initialInputEntities||[],i.inputEntitiesDataVersion=this.state.inputEntitiesDataVersion+1,i.hasOutgoingSmsInConversation=!1,i.phoneNumberForSendingSms=void 0,this._checkForOutgoingSmsMessagesInConversation(this.state));let o=[];if(e.editedMessage&&e.editedMessage!==this.props.editedMessage){let t=D.decode(e.editedMessage);o=L.toEntities(t,{supportEmoticons:!0,supportLinkEntity:this.state.enableHandlingHyperlinkOnPaste}),s=!0,i.phoneNumberForSendingSms=void 0}if(this.props.editedMessage&&!e.editedMessage&&(s=!0,i.phoneNumberForSendingSms=void 0,this.state.inputEntities.length&&this.state.inputEntities[0]instanceof te.EmoteEntity&&(o=[])),e.initialInputEntities&&e.initialInputEntities[0]){const t=this.props.initialInputEntities&&this.props.initialInputEntities[0]?this.props.initialInputEntities[0].text:"";e.initialInputEntities[0].text()!==t&&this._setInputEntityStateDownstream(e.initialInputEntities)}s&&(this._setInputEntityStateDownstream(o),this.setState(i))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);let i=this.state.selectedMediaBarItem,o=this.state.showOverflowMenu,n=!1;e&&e.conversationId&&this.props.conversationId&&e.conversationId===this.props.conversationId||(n=this._shouldAutoFocusInput());const r=this._hasQuotes()&&!(0,oe.default)(this.props.quotedMessages,e.quotedMessages),a=this.props.editedMessage&&!(0,oe.default)(this.props.editedMessage,e.editedMessage),l=this.state.hasMediaPreviews&&this.state.hasMediaPreviews!==t.hasMediaPreviews;if((0,oe.default)(this.props.quotedMessages,e.quotedMessages)&&(0,oe.default)(this.props.editedMessage,e.editedMessage)&&(0,oe.default)(t.inputEntities,this.state.inputEntities)||this._saveMessage(this.state.inputEntities),n=r||a||l,!e.inlineSearchModeActive&&this.props.inlineSearchModeActive&&(i=""),n&&this.requestFocus(),!t.enableOnewaySms&&this.state.enableOnewaySms&&this._checkForOutgoingSmsMessagesInConversation(this.state),this.state.userInputIsEmpty&&this.state.hasUncommittedUserInput){const e=x.default.getSavedMessageInput(this.props.conversationId);e&&e.type===We.SavedMessageType.None&&(ie.track(new z.DraftMessageDeleted(e.timestamp)),x.default.clearMessageInput(this.props.conversationId))}if(this.state.useMobileUI){this.props.onShowOverflow&&this.state.showOverflowMenu!==t.showOverflowMenu&&this.props.onShowOverflow(!!this.state.showOverflowMenu,this._overflowActions(),this._onToggleOverflowMenu);const s=this._rightControlsLayoutInfo(this.props,this.state),i=this._rightControlsLayoutInfo(e,t);(0,oe.default)(s,i)||(this._rightControlsWidthValue.setValue(s.width),this._rightControlsOpacityValue.setValue(s.opacity),k.default.updateAnchor(A.CoachMarkType.ExpressionPicker),!s.isShowing&&this.state.showOverflowMenu&&(o=!1))}this.state.hasFocus&&!this.state.userInputIsEmpty&&k.default.hideCurrentCoachMark(),this.state.deviceOrientation===t.deviceOrientation&&this.props.headerHeightAndroid===e.headerHeightAndroid||(this._setAndroidCustomKeyboardHeight(),this._pesPickerPopup&&this._pesPickerPopup.hide()),e.conversationId!==this.props.conversationId&&this._updateAndStoreDraftInputEntitiesFromContent(ut.default.newCauseId()),this.setState({showOverflowMenu:o,selectedMediaBarItem:i})}componentWillUnmount(){super.componentWillUnmount(),this._appStateSubscription&&(this._appStateSubscription.unsubscribe(),this._appStateSubscription=void 0),this._dataUpdateSubscription&&(this._dataUpdateSubscription.unsubscribe(),this._dataUpdateSubscription=void 0),x.default.commit(this.props.conversationId),p.default.getS4LMessagingFeaturesNoSubscription().enableDraftMessagesPersistentStorage&&x.default.storeSavedMessage(this.props.conversationId),de.default.removeObserver(de.LifecycleEventType.ON_EXIT,this._updateAndStoreDraftInputEntitiesFromContent),this._customKeyboardDidHideListener&&(this._customKeyboardDidHideListener.remove(),this._customKeyboardDidHideListener=void 0),this._nativeKeyboardDidHideListener&&(this._nativeKeyboardDidHideListener.remove(),this._nativeKeyboardDidHideListener=void 0),this._customKeyboardSeenListener&&(this._customKeyboardSeenListener.remove(),this._customKeyboardSeenListener=void 0),this._visibilitySubscriptionToken&&(this._visibilitySubscriptionToken.unsubscribe(),this._visibilitySubscriptionToken=void 0),a.default.isSupported()&&a.default.dismiss(),this._textInputRef&&this._textInputRef.dismissKeyboard(),ne.default.setCustomKeyboardFixHeightAndroid(0),re.default.removeHandler(q.KeyboardShortcut.SendFile,this._showFilePicker),re.default.removeHandler(q.KeyboardShortcut.EditMessage,this._editLastMessageKeyboardShortcut),re.default.removeHandler(q.KeyboardShortcut.FocusMessageComposer,this._focusKeyboardShortcut),U.unregister(this._keyboardDismissRegistrationHandle),x.default.onInputEntitiesUpdatedEvent.unsubscribe(this._onPartiallyEnteredMsgStoreUpdated),m.default.disableTooltip(S.EngagementTooltipType.ExpressionPicker)}render(){return this._renderDesktopComposer()}dismissKeyboard(){this._textInputRef&&this._textInputRef.dismissKeyboard()}replaceText(e,t,s,i){if(this.requestFocus(),this._pendingMessageTextCompletionPromise){const e=ve.getEditableEntityFromInputEntityAndConsiderAlternatives(i,this.state.emoticons);this._pendingMessageTextCompletionPromise.resolve(e),this._pendingMessageTextCompletionPromise=void 0}this._cancelAutoCompletionIfActive()}abortTextAutoCompletion(){this._cancelAutoCompletionIfActive()}isFocused(){return this.state.hasFocus}blurIfFocused(){this.state.hasFocus&&this.blur()}getInputEntities(){return this._textInputRef?this._textInputRef.getContent().then((e=>this._consumeNewUserInput(e)||this.state.inputEntities)):c.Resolved(this.state.inputEntities)}getDesktopOverflowConfig(){return this._overflowActions()}_getQuotedTextForSms(e,t){return t&&e!==t?i.join(t.map((e=>this._getQuoteEntity(e).textForSMS()))):""}_hasQuotes(){return!i.isEmpty(this.props.quotedMessages)}_checkForOutgoingSmsMessagesInConversation(e){e.enableOnewaySms&&M.didUserSendSmsInLast30Days(this.props.conversationId).then((e=>{this.isComponentMounted()&&this.setState({hasOutgoingSmsInConversation:e})}))}_setAndroidCustomKeyboardHeight(){}_overflowActions(){return{onItemSelected:this._onMediaBarItemSelected,onCustomAction:this._onHandleCustomAction,mediaBarItems:this._getOverflowItemDescriptors(),onFocus:this.requestFocus,onBlur:this.blur}}_renderQuote(){if(this.props.hideContentInMessageComposer)return;let e,t=i.first(this.props.quotedMessages),s=this._onClearQuoteButtonPress;if(!t&&this.props.editedMessage){const o=i.head(this.state.inputEntities);o instanceof te.QuoteEntity&&(t=this.props.editedMessage,e=se.decodeFromInput([o],!1,!1,!1),s=this._onClearEditMessageQuote)}if(t){const i={onClearQuote:this.state.useMobileUI?void 0:s,linkStyle:Tt.linkStyle,disableActions:this.props.disableActionOnMessageComposer,renderOrigin:G.MessageRenderOrigin.MessageComposerCanvas},o=[Tt.quoteArea],n=[this._themeStyles.primaryTextColorStyle],r=st.default.font.uiDisplayBold;return this._useDarkTheme()&&(i.linkStyle=d.Styles.combine(Tt.linkStyle,this._themeStyles.linkTextColorStyle||this._themeStyles.primaryTextColorStyle)),i.quoteAttributeStyle=[Tt.quoteAttributeStyle,this._themeStyles.secondaryTextColorStyle],i.quoteSymbolStyle={size:it.IconSize.size20,color:this._themeColors.primaryTextColor},i.quotedTextStyle=Tt.quoteTextStyle,i.textOverrideStyle=n,i.atMentionMeOverrideStyle=r,i.atMentionStyle=r,i.showTranslatedMessage=!!this.props.showTranslatedMessage,this.state.useMobileUI&&o.push([Tt.quoteAreaNewComposer,this._themeStyles.secondaryDividerBorderStyle]),{component:d.createElement(d.View,{style:o},d.createElement(be.default,{message:t,preDecodedMessage:e,wrapInQuote:!e,options:i})),onClearQuoteHandler:s}}}_renderDesktopComposer(){const e=[Tt.composerInner,Tt.desktopOverrides.composerInner];let t;const s=[Tt.skypeMessageTextInput,this._themeStyles.primaryTextColorStyle],i=this._hasQuotes();this.state.isSmallHeightView?(t=i?[Tt.expandableAreaWithQuote,Tt.desktopOverrides.expandableAreaWithQuoteSmallView]:[Tt.expandableArea,Tt.desktopOverrides.expandableAreaSmallView],s.push(i?Tt.desktopOverrides.expandableAreaWithQuoteSmallView:Tt.desktopOverrides.expandableAreaSmallView)):(t=i?[Tt.expandableAreaWithQuote,Tt.desktopOverrides.expandableAreaWithQuote]:[Tt.expandableArea,Tt.desktopOverrides.expandableArea],s.push(i?Tt.desktopOverrides.expandableAreaWithQuote:Tt.desktopOverrides.expandableArea));const o=[nt.default.flexOne,Tt.desktopOverrides.messageComposer];if(this._themeStyles.messageComposerBackgroundStyle&&o.push(this._themeStyles.messageComposerBackgroundStyle),this.state.isShowingUnifiedPesPickerDesktop?o.push(Tt.desktopOverrides.messageComposerTopFlatCorners):o.push(Tt.desktopOverrides.messageComposerAllRoundCorners),this.state.doNotFormat&&o.push(this._getDoNotFormatStyle()),this.state.messageStreamFontSize!==Me.MessageStreamFontSize.Normal){const e=Te.getStyleFromStyle(s,this.state.messageStreamFontSize);s.push(e)}const n=this._getEmoticonPickerItem(!1),r=this._renderQuote(),a=this.props.hideContentInMessageComposer?void 0:this._renderTextInput(t,s,!!r),l=[Tt.rightControlContainer,Tt.desktopOverrides.rightControlContainer];let c=this._getRightIcon();c||(c=this._getMediaBar(!1,!0),c&&l.push(Tt.mediaBarMargins));let h=d.createElement(d.View,{style:o,importantForAccessibility:d.Types.ImportantForAccessibility.No,onPress:this._onCompositionAreaPress,onKeyPress:this._onCompositionAreaKeyPress,disableTouchOpacityAnimation:!0},d.createElement(d.Animated.View,{style:this._inputAreaHeightStyle},d.createElement(d.View,{style:[Tt.compositionAreaContainer,Tt.desktopOverrides.compositionAreaContainer],onLayout:this._onLayoutInputArea,key:"composition"},r&&r.component,this._getMediaPreviewPanel(),d.createElement(d.View,{style:e},n,d.createElement(d.View,{style:[Tt.compositionArea,Tt.desktopOverrides.compositionArea],importantForLayout:!0},this._renderEmoteAuthor(),a),d.createElement(d.View,{style:l},c)))));return d.createElement(d.View,{style:nt.default.flexOne},this._renderSmsInfoLine(),this._renderPesPicker(),h)}_getRightIcon(){const e=Tt.moreButton,t=it.IconSize.size24;if(this._canCancelEdit(this.state,this.props.editedMessage))return d.createElement(Z.default,{title:ce.getString("MessageComposer.CancelEditButtonTitle"),ref:this._onInputButtonRef,onPress:this._onCancelEditClick,size:t,color:this._themeColors.secondaryTextColor,hoverColor:this._themeColors.primaryTextColor,style:e,icon:it.SkypeIcon.Cancel});return this._sendControlEnabled(this.props,this.state,this._hasQuotes())?d.createElement(Z.default,{title:ce.getString(this.props.editedMessage?"MessageComposer.EditButtonTitle":"MessageComposer.SendButtonTitle"),ref:this._onInputButtonRef,onPress:this._onSendButtonClick,size:t,color:this._themeColors.secondaryTextColor,hoverColor:this._themeColors.primaryTextColor,style:e,icon:it.SkypeIcon.Send,flipIcon:this._getContext().isRTL,disabled:this.props.disableActionOnMessageComposer||!!this.state.phoneNumberForSendingSms&&this.state.userInputIsEmpty}):this._getMediaBarItemDescriptors().length&&this.state.isMediaBarCollapsable&&!this.state.isCollapsableMediaBarExpanded?d.createElement(Z.default,{key:"moreButton",ref:this._onMoreButtonRef,title:ce.getString("Global.MoreButtonTitle"),onPress:this._onMoreButtonClick,size:t,color:this._themeColors.secondaryTextColor,hoverColor:this._themeColors.primaryTextColor,style:e,icon:it.SkypeIcon.More}):void 0}_getMediaPreviewPanel(){if(this.state.isMediaPreviewEnabled)return d.createElement(fe.default,{conversationId:this.props.conversationId})}_getDoNotFormatStyle(){return this._useDarkTheme()?Tt.doNotFormatDarkTheme:Tt.doNotFormatLightTheme}_renderMobileComposer(){const e=[Tt.composerInner,Tt.composerInnerMobile],t=[Tt.composerOuter],s=[nt.default.flexOne],n=[this._hasQuotes()?Tt.expandableAreaWithQuote:Tt.expandableArea];this.state.useMobileUI&&(s.push(Tt.messageComposerNewComposer),e.push(Tt.innerContainerNewComposer),t.push([Tt.innerWrapperNewComposer,this._themeStyles.buttonBackgroundColorStyle]),this.state.useCompactLayout&&(s.push(Tt.messageComposerNewComposerSmallDevice),t.push(Tt.innerWrapperNewComposerSmallDevice)),n.push(this._hasQuotes()?Tt.expandableAreaWithQuoteNewComposer:Tt.expandableAreaNewComposer),this.state.doNotFormat&&t.push(this._getDoNotFormatStyle()));const r=this.state.deviceOrientation===o.DeviceOrientation.Landscape&&this.state.isUsingStackNavigationContext&&this.state.useMobileUI;r&&(n.push(Tt.expandableAreaLandscapeMaxHeight),e.push(Tt.composerInnerLandscape)),this.state.useMobileUI&&e.push(Tt.composerInnerMobileNewComposer);const a=this._sendControlEnabled(this.props,this.state,this._hasQuotes()),l=this._canCancelEdit(this.state,this.props.editedMessage);let c,u,p,g,m,S,f;if(r){if(this.state.useMobileUI){const e=a||l||this.state.disableHighBandwidthOperations||this.props.disableActionOnMessageComposer;c=this.state.isMediaPickerInRightControlsForMobile?i.compact([this._getMediaPickerButton(!0,e),this._getCameraButton(e),this._getLocationPickerButton(!0,e)]):i.compact([this._getCameraButton(e),this._getMediaPickerButton(!0,e),this._getLocationPickerButton(!0,e)]);const t=this._showRightControls(this.props,this.state,a);p=this._getOverflowMenuButton(t&&!this.state.isKeyboardSeen)}else c=this._getEmoticonPickerItem(!0);this.state.useMobileUI?g=this._getEmoticonPickerItem(!0):p=d.createElement(Z.default,{key:"attachmentButton",title:ce.getString("MessageComposer.AttachementButton"),onPress:this._onMoreButtonClick,size:it.IconSize.size24,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,style:Tt.attachmentButton,icon:this.state.isCollapsableMediaBarExpanded?it.SkypeIcon.Cancel:it.SkypeIcon.Clippy,disabled:this.props.disableActionOnMessageComposer}),u=this._getMediaBar(!0,!this.state.useMobileUI&&this.state.isCollapsableMediaBarExpanded)}else{if(this.state.useMobileUI){g=this._getEmoticonPickerItem(!0);const e=a||l||!!this.state.phoneNumberForSendingSms||this.state.disableHighBandwidthOperations||this.props.disableActionOnMessageComposer;c=this.state.isMediaPickerInRightControlsForMobile?i.compact([this._getMediaPickerButton(!0,e),this._getCameraButton(e),this._getLocationPickerButton(!0,e)]):i.compact([this._getCameraButton(e),this._getMediaPickerButton(!0,e),this._getLocationPickerButton(!0,e)]);const t=this._showRightControls(this.props,this.state,a);p=this._getOverflowMenuButton(t&&!this.state.isKeyboardSeen)}u=this._getMediaBar(!0,!this.state.useMobileUI)}let y,_=it.SkypeIcon.Blank,v=!!this.props.disableActionOnMessageComposer,C=!1,b=!1;l?(m=ce.getString("MessageComposer.CancelEditButtonTitle"),f=this._onCancelEditClick,_=it.SkypeIcon.Cancel):a?(m=ce.getString(this.props.editedMessage?"MessageComposer.EditButtonTitle":"MessageComposer.SendButtonTitle"),f=this._onSendButtonClick,_=it.SkypeIcon.Send,v=this.state.userInputIsEmpty&&(!!this.state.phoneNumberForSendingSms||w.isS4BBridgeMri(this.props.conversationId)),C=this._getContext().isRTL,b=!0):this._showMicButton(this.props,this.state)&&(m=ce.getString("MessageComposer.RecordButtonTitle"),S=void 0,f=this._onRecordButtonClick,_=it.SkypeIcon.Microphone);const T=this.props.preventAccessibilityFocus?d.Types.ImportantForAccessibility.NoHideDescendants:void 0;m?y=this.state.useMobileUI&&b?d.createElement(h.default,{size:this.state.useCompactLayout?h.ActionButtonSize.Tiny:h.ActionButtonSize.Small,title:m,accessibilityLabel:S||m,ref:this._onInputButtonRef,onPress:f,style:Tt.sendButton,icon:_,disabled:v,importantForAccessibility:T,flipIcon:C,hideBorder:!0,useSmallIcon:!0}):d.createElement(Z.default,{title:m,accessibilityLabel:S||m,ref:this._onInputButtonRef,onPress:f,size:it.IconSize.size24,color:a?this._themeColors.headerIconColor:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,style:Tt.micButton,hoverStyle:Tt.sendButtonHover,icon:_,disabled:v,importantForAccessibility:T,flipIcon:C}):this.state.useMobileUI||(y=d.createElement(d.View,{style:Tt.sendButton}));const M=this._renderQuote(),I=M&&this.state.useMobileUI?d.createElement(Z.default,{key:"clearbutton",style:Tt.clearQuoteNewComposer,title:ce.getString("MessageComposer.RemoveQuoteButtonTitle"),onPress:M.onClearQuoteHandler,size:it.IconSize.size16,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,icon:it.SkypeIcon.Cancel,disabled:this.props.disableActionOnMessageComposer}):void 0,P=g&&I?d.createElement(d.View,{style:Tt.rightIconContainer,key:"rightIconContainer"},I,g):g||I,k=[Tt.compositionArea];this.state.useMobileUI&&k.push(Tt.compositionAreaNewComposer);const A=[Tt.skypeMessageTextInput,this._themeStyles.primaryTextColorStyle];let E;A.push(r?Tt.expandableAreaLandscapeMaxHeight:this._hasQuotes()?Tt.expandableAreaWithQuoteNewComposer:Tt.expandableAreaNewComposer);const R=this.props.hideContentInMessageComposer?void 0:this._renderTextInput(n,A,!!M);if(this.state.useMobileUI){const s=[Tt.rightControlContainer,this._rightControlsWidthStyle];p||e.push(Tt.composerInnerMobileNewComposerExtraPadding),E=d.createElement(d.View,{style:e},p,d.createElement(d.View,{style:t},d.createElement(d.View,{style:k,importantForAccessibility:T},M&&M.component,this._renderEmoteAuthor(),R),P),d.createElement(d.Animated.View,{style:s},y,c))}else E=d.createElement(d.View,{style:e},p,d.createElement(d.View,{style:k,importantForAccessibility:T},M&&M.component,R),I,g,d.createElement(d.View,{style:Tt.rightControlContainer},c,y));return d.createElement(d.View,{style:nt.default.flexOne,importantForAccessibility:d.Types.ImportantForAccessibility.No},d.createElement(d.View,{style:s},this._renderSmsInfoLine(!0),d.createElement(d.Animated.View,{style:this._inputAreaHeightStyle,ref:this._onAnimatedViewRef},d.createElement(d.View,{key:"composition",style:Tt.compositionAreaContainer,onLayout:this._onLayoutInputArea},E))),u)}_renderPesPicker(){if(!this.state.isShowingUnifiedPesPickerDesktop)return;const e=this._isMojiCategoryEnabled()||this._isStickerCategoryEnabled()||this._isGifCategoryEnabled();return d.createElement(d.View,null,d.createElement(N.default,{showCategorySwitcher:e,availableWidth:this.props.availableWidth,pesPickerPopupRef:this._getPesPickerPopupRef,onEmoticonSelected:this._onEmoticonSelected,onMojiSelected:this._onMojiSelected,onStickerSelected:this._onStickerSelected,onGifSelected:this._onGifSelected,onClose:this._closeUnifiedPesPickerDesktop,selectedTabType:this.state.selectedTabType,searchQuery:this.state.searchQuery}),this._renderPesPickerPopup())}_getTextForSms(e){return`${this.state.quoteTextForSms}${se.getRawText(e)}`}_renderSmsInfoLine(e=!1){const t=!!this.state.phoneNumberForSendingSms||!!this.state.hasOutgoingSmsInConversation||!!this.state.smsToggledOn;if(this.state.enableOnewaySms&&(!e||t))return d.createElement($e.default,{rawTextInput:this._getTextForSms(this.state.inputEntities),conversationId:this.props.conversationId,phoneNumbers:this.state.phoneNumbers,onPhoneNumberSelected:this._onPhoneNumberForSmsSelected,selectedPhoneNumber:this.state.phoneNumberForSendingSms,useMobileLayout:e,creditEntitlement:this.state.creditEntitlement,ref:this._onSMSInfoLineRef,disabled:this.props.disableActionOnMessageComposer,preventAccessibilityFocus:this.props.preventAccessibilityFocus,isSmsFailureScreenEnabled:this.state.isSmsFailureScreenEnabled})}_isMojiCategoryEnabled(){return!this.props.hideMojiPickerIcon&&!this.state.phoneNumberForSendingSms}_isStickerCategoryEnabled(){return this.state.showStickerPicker&&!this.state.phoneNumberForSendingSms}_isGifCategoryEnabled(){return this.state.showGifPicker&&!this.state.phoneNumberForSendingSms}_renderEmoteAuthor(){const e=i.head(this.state.inputEntities);if(this.props.editedMessage&&e&&e instanceof te.EmoteEntity){let t=[Tt.emoteAuthor.text];t.push(Tt.emoteAuthor.textDesktop),t.push(this._themeStyles.primaryTextColorStyle);const s=e.fallbackText.trim();return d.createElement(d.View,null,d.createElement(d.Text,{style:t},s+"…"))}}_getDefaultPlaceholderText(){return this.state.useMobileUI?this.state.phoneNumberForSendingSms?ce.getString("MessageComposer.SmsMessagePlaceholderShortText"):ce.getString("MessageComposer.MessagePlaceholderShortText"):this.state.phoneNumberForSendingSms?ce.getString("MessageComposer.SmsMessagePlaceholderText"):ce.getString("MessageComposer.MessagePlaceholderText")}_renderTextInput(e,t,s=!1){const o=this.state.selectedMediaBarItem===me.MediaBarItemKeys.MediaPicker||this.state.selectedMediaBarItem===me.MediaBarItemKeys.Moji||this.state.selectedMediaBarItem===me.MediaBarItemKeys.Emoticon||this.state.selectedMediaBarItem===me.MediaBarItemKeys.Gif||this.state.selectedMediaBarItem===me.MediaBarItemKeys.Sticker?d.createElement(d.Button,{style:Tt.textInputFocusButton,onPress:this._onDismissMediaPicker,importantForAccessibility:d.Types.ImportantForAccessibility.No}):void 0;this._placeholderText=s?"":this._getDefaultPlaceholderText();let n=st.default.controlFontSize.messageComposerDesktop;this.state.messageStreamFontSize!==Me.MessageStreamFontSize.Normal&&(n=Te.getSize(n,this.state.messageStreamFontSize));const r=this.props.disableCopyPasteMedia;return d.createElement(d.View,{style:Tt.inputArea},d.createElement(d.Animated.View,{style:[...e]},d.createElement(l.default,{ref:this._onTextInputRef,importantForAccessibility:"yes",accessibilityLabel:this._getDefaultPlaceholderText(),style:t,agnosticContentBackgroundColor:this._useDarkTheme()?mt:St,atMentionBackgroundColor:this._useDarkTheme()?et.Color.blueOverlay30:et.Color.blueOverlay10,linkTextColor:this._themeColors.primaryTextColor,lineHeight:Math.round(1.2*n),maxLength:this.props.maxLength&&this.props.maxLength<=25e3?this.props.maxLength:25e3,onFocus:this._onFocus,onBlur:this._onBlur,onPaste:this._onPaste,placeholder:this._placeholderText,placeholderTextColor:this._themeColors.secondaryTextColor,keyboardAppearance:this._useDarkTheme()?"dark":"default",useGraphicalEmoticons:!0,enterKeyOnExtKeyboardSendsMessage:this.state.sendMessageWithEnter,editable:void 0!==this.state.overrideEditable?this.state.overrideEditable:this.state.editable,initialContent:ve.getEditableContentFromEditableEntities(this.state.editableEntities,this.state.inputEntitiesDataVersion),customContext:this.props.conversationId,intermediateContentUpdatedEventInterval:void 0,onNewContentCommitted:this._onUserInputCommitted,onNewContentAborted:this._onUserInputAborted,onEmptyIndicationChanged:this._onUserInputEmptyIndicationChanged,onUncommittedChangesIndicationChanged:this._onUserInputUncommittedChangesIndicationChanged,onEqualsInitialContentChanged:this._onEqualsInitialContentIndicationChanged,onEditLastMessageRequested:this._editLastMessage,onAccessibilityAnnouncementRequested:this._onAccessibilityAnnouncementRequested,onComposingActive:this._onUserInputActive,onComposingInactive:this._onUserInputInactive,onBackspacePressedAtHeadPosition:this._onUserInputBackspacePressedAtHeadPos,onEmoticonLoadCompleted:this._onEmoticonLoadCompleted,autoCompletionTriggers:Ct,onAutoCompletionRequested:this._onAutoCompletionRequested,onAutoCompletionRequestAborted:this._onAutoCompletionRequestAborted,onAutoCompletionNavigationKey:this._onAutoCompletionNavigationKey,delayedTriggersWaitTime:this.state.delayedTriggersWaitTime,convenienceSpaceReplacingChars:",.;:?!'",disableCopyPasteMedia:r,enableHandlingHTMLonPaste:this.state.enableHandlingHTMLonPaste,onPastingText:this.state.enableHandlingHTMLonPaste||this.state.enableHandlingHyperlinkOnPaste?this._onPastingText:void 0,enableHandlingHyperlinkOnPaste:this.state.enableHandlingHyperlinkOnPaste,validateUrl:this._validateUrl,shouldDefaultPaste:i.constant(!0)}),o))}_getEmoticonPickerItem(e){if(this.props.hideEmoticonKeyboardIcon||this.state.useMobileUI&&this.props.hideMediaBar||w.isPhoneMri(this.props.conversationId)||w.isS4BBridgeMri(this.props.conversationId))return;const t=this.state.isShowingUnifiedPesPickerDesktop,s=this._onUnifiedPesPickerDesktopPress,i={id:me.MediaBarItemKeys.Emoticon,key:"emoticonPicker",active:t,onActive:s,isMobileInterface:e,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,onFocus:this.requestFocus,onBlur:this.blur,onInputChange:this.autoReplaceText,onEmoticonSelected:this._onEmoticonSelected,onEmoticonBackspacePress:this._handleEmoticonBackspacePress,pesPickerPopupRef:this._getPesPickerPopupRef,preventAccessibilityFocus:this.props.preventAccessibilityFocus,colorOverride:this._themeColors.secondaryTextColor,hoverColorOverride:this._themeColors.primaryTextColor,iconStyleOverride:this.state.useMobileUI?Tt.emoticonIconNewComposer:void 0,showCategorySwitcher:this.state.useMobileUI&&(this._isMojiCategoryEnabled()||this._isStickerCategoryEnabled()),disabled:this.props.disableActionOnMessageComposer,origin:ge.MediaBarItemOrigin.MessageComposer,ref:e=>{m.default.setAnchor(S.EngagementTooltipType.ExpressionPicker,e)}},o=[Tt.emoticonIconWrapper];return this.state.useMobileUI?d.createElement(d.View,{style:o},d.createElement(Q.ExpressionPickerItem,Object.assign({},i))):d.createElement(Q.ExpressionPickerItem,Object.assign({},i))}_keyboardHeight(){return this.state.isSmallDevice?void 0:(this.state.isUsingStackNavigationContext,this.state.pesPickerKeyboardHeight)}_mediaBarItemDescriptor(e){const t=this._keyboardHeight();switch(e){case me.MediaBarItemKeys.Emoticon:const s={onEmoticonSelected:this._onEmoticonSelected,pesPickerPopupRef:this._getPesPickerPopupRef,showCategorySwitcher:this.state.useMobileUI&&(this._isMojiCategoryEnabled()||this._isStickerCategoryEnabled())};return{id:e,render:this._renderEmoticonPickerItem,getVirtualKeyboard:this._getEmoticonPickerKeyboard,propOverrides:s,keyboardHeight:t};case me.MediaBarItemKeys.Moji:const i={onMojiSelected:this._onMojiSelected,showCategorySwitcher:this.state.useMobileUI&&(!this.props.hideEmoticonKeyboardIcon||this._isStickerCategoryEnabled())};return{id:e,render:this._renderMojiPickerItem,getVirtualKeyboard:ke.MojiPickerItem.getVirtualKeyboard,propOverrides:i,keyboardHeight:t};case me.MediaBarItemKeys.Gif:const o={onGifSelected:this._onGifSelected,showCategorySwitcher:this.state.useMobileUI&&(!this.props.hideEmoticonKeyboardIcon||this._isGifCategoryEnabled())};return{id:e,render:this._renderGifPickerItem,getVirtualKeyboard:Y.GifPickerItem.getVirtualKeyboard,propOverrides:o,keyboardHeight:t};case me.MediaBarItemKeys.Sticker:const n={onStickerSelected:this._onStickerSelected,showCategorySwitcher:this.state.useMobileUI&&(!this.props.hideEmoticonKeyboardIcon||this._isMojiCategoryEnabled())};return{id:e,render:this._renderStickerPickerItem,getVirtualKeyboard:Ye.StickerPickerItem.getVirtualKeyboard,propOverrides:n,keyboardHeight:t};case me.MediaBarItemKeys.Sms:return{id:e,render:this._renderSmsItem,getVirtualKeyboard:Je.SmsItem.getVirtualKeyboard};case me.MediaBarItemKeys.MediaPicker:return{id:e,render:this._renderMediaPickerItem,getVirtualKeyboard:X.default.getVirtualKeyboard,disabled:this.state.disableHighBandwidthOperations};case me.MediaBarItemKeys.FilePicker:return{id:e,render:this._renderFilePickerItem,getVirtualKeyboard:X.default.getVirtualKeyboard,disabled:this.state.disableHighBandwidthOperations};case me.MediaBarItemKeys.Camera:return{id:e,render:this._renderCameraItem,getVirtualKeyboard:v.CameraItem.getVirtualKeyboard,disabled:this.state.disableHighBandwidthOperations};case me.MediaBarItemKeys.ScheduleCall:return{id:e,render:this._renderScheduleCallItem,getVirtualKeyboard:Ge.ScheduleCallItem.getVirtualKeyboard};case me.MediaBarItemKeys.Poll:return{id:e,render:this._renderPollItem,getVirtualKeyboard:Ue.PollItem.getVirtualKeyboard};case me.MediaBarItemKeys.Location:return{id:e,render:this._renderLocationPickerItem,getVirtualKeyboard:he.default.getVirtualKeyboard,disabled:this.state.disableHighBandwidthOperations};case me.MediaBarItemKeys.Contact:return{id:e,render:this._renderContactPickerItem,getVirtualKeyboard:R.ContactPickerItem.getVirtualKeyboard};case me.MediaBarItemKeys.Bing:const r={onBlur:this._onBlur};return{id:e,render:this._renderBingSearchItem,getVirtualKeyboard:f.BingSearchItem.getVirtualKeyboard,propOverrides:r};case me.MediaBarItemKeys.VideoMessage:return{id:e,render:this._renderVideoMessageItem,getVirtualKeyboard:pt.default.getVirtualKeyboard,disabled:this.state.disableHighBandwidthOperations};case me.MediaBarItemKeys.People:return{id:e,render:this._renderPeopleItem,getVirtualKeyboard:Oe.PeopleItem.getVirtualKeyboard};case me.MediaBarItemKeys.SendCredit:return{id:e,render:this._renderSendCreditItem,getVirtualKeyboard:qe.SendCreditItem.getVirtualKeyboard}}ie.warn(q.LogTraceArea.MessageComposer,"No media bar descriptor for "+e)}_canShowSmsIcon(){return!this.props.hideSmsIcon&&this.state.enableOnewaySms&&this.state.phoneNumbers.length>0&&this.state.useMobileUI}_getItemDescriptors(e,t=!1){const s=t&&this.state.disableHighBandwidthOperations,o=i.map(e,(e=>{switch(e){case me.MediaBarItemKeys.Bing:return this._mediaBarItemDescriptor(e);case me.MediaBarItemKeys.Camera:if(!this.props.hideMediaPickerIcon&&this.state.isCameraAvailable)return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.Sms:if(this._canShowSmsIcon())return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.Emoticon:if(!this.props.hideEmoticonKeyboardIcon)return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.Location:if(this.state.showLocationPicker&&!s&&(t||!this.state.useTabletUI||this.state.useTabletUI&&this.props.isInCall))return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.Contact:if(this.state.showContactPicker)return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.MediaPicker:if(this._shouldShowMediaItem(s,t))return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.FilePicker:if(!this.props.hideFilePicker&&!s)return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.Moji:if(this._isMojiCategoryEnabled()&&!t)return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.Sticker:if(this._isStickerCategoryEnabled()&&(!t||!this.props.hideStickerPickerIcon))return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.Gif:if(this._isGifCategoryEnabled())return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.ScheduleCall:if(!(this.props.hideScheduleCallIcon||s||this._isPresentedInSidebar()||this.state.isRegularMemberInModeratedGroup))return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.Poll:if(!this.props.hidePollIcon&&this.state.enablePollExtensionEntryPoint&&!this._isPresentedInSidebar())return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.People:return this._mediaBarItemDescriptor(e);case me.MediaBarItemKeys.VideoMessage:if(this.state.showVideoMessageIcon&&!s)return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.SendCredit:if(!this.props.hideSendCreditIcon&&!s)return this._mediaBarItemDescriptor(e)}}));return i.compact(o)}_shouldShowMediaItem(e,t=!1){return!this.props.hideMediaPickerIcon&&!e&&(t||!this.state.isMediaPickerInRightControlsForMobile||this.state.isSmallDevice||this.state.useTabletUI&&this.props.isInCall)}_getOverflowItemDescriptors(){let e=i.map(this.state.overflowMenuOrderForMobileUI,(e=>e));return Le.default.isMobileSplitView()&&(e=i.filter(e,(e=>e!==me.MediaBarItemKeys.Sms))),this._getItemDescriptors(i.flatten(e))}_getMediaBarItemDescriptors(){return this.props.hideMediaBar||this._isMediabarDisabled()?[]:this._getItemDescriptors(this.state.mediaBarMenuOrder,!0)}_getOverflowMenuButton(e=!0){if(this.props.hideOverflowMenu||this.props.hideMediaBar||this.state.phoneNumberForSendingSms||w.isS4BBridgeMri(this.props.conversationId)||this.state.disableHighBandwidthOperations||!this.state.canUseAddins)return;const t=this.props.preventAccessibilityFocus?d.Types.ImportantForAccessibility.NoHideDescendants:void 0,s={size:this.state.useCompactLayout?h.ActionButtonSize.Tiny:h.ActionButtonSize.Small,title:ce.getString("MessageComposerOverflow.AddTitle"),accessibilityLabel:ce.getString("MessageComposerOverflow.AddTitle"),onPress:this._onComposerOverflowPress,style:Tt.overflowButton,icon:it.SkypeIcon.Plus,deselected:!e,hideBorder:!0,useSmallIcon:!0,disabled:this.props.disableActionOnMessageComposer,importantForAccessibility:t};return this.state.useMobileUI?d.createElement(P.default.ActionButton,Object.assign({},s,{positions:[A.PopupAnchorPositon.Top,A.PopupAnchorPositon.Right],coachMarkType:A.CoachMarkType.ChatPlus,anchorAccessibilityLabel:ce.getString("MessageComposerOverflow.AddTitle"),onAnchorPress:this._onComposerOverflowCoachMarkPress,anchorRef:this._onOverflowButtonRef})):d.createElement(h.default,Object.assign({},s,{ref:this._onOverflowButtonRef}))}_getCameraButton(e=!1){const t=this.props.preventAccessibilityFocus?d.Types.ImportantForAccessibility.NoHideDescendants:void 0;return this._showCameraButton(this.props,this.state)?d.createElement(d.Animated.View,{key:me.MediaBarItemKeys.Camera,style:this._rightControlsOpacityStyle},d.createElement(Z.default,{title:ce.getString("MediaBar.CameraButtonTitle"),onPress:this._onLaunchCameraFromComposer,size:it.IconSize.size24,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,style:Tt.cameraButton,icon:it.SkypeIcon.Camera,disabled:e,importantForAccessibility:t})):void 0}_getMediaPickerButton(e,t=!1){if(!this._showMediaPickerButton(this.props,this.state))return;const s=this.props.preventAccessibilityFocus?d.Types.ImportantForAccessibility.NoHideDescendants:void 0,i={id:me.MediaBarItemKeys.MediaPicker,active:this.state.selectedMediaBarItem===me.MediaBarItemKeys.MediaPicker,onActive:this._onPickerActive,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,preventAccessibilityFocus:this.props.preventAccessibilityFocus,isMobileInterface:e,isMediaPickerInRightControlsForMobile:this.state.isMediaPickerInRightControlsForMobile,onFocus:this.requestFocus,onBlur:this.blur,onCustomAction:this._onHandleCustomAction,origin:ge.MediaBarItemOrigin.MessageComposer};return d.createElement(d.Animated.View,{key:me.MediaBarItemKeys.MediaPicker,style:this._rightControlsOpacityStyle,importantForAccessibility:s},d.createElement(d.View,{style:Tt.emoticonIconWrapper},d.createElement(X.default,Object.assign({acceptedFileTypes:X.AcceptedFileTypes.All},i))))}_getLocationPickerButton(e,t=!1){if(!this._showLocationButton(this.props,this.state))return;const s=this.props.preventAccessibilityFocus?d.Types.ImportantForAccessibility.NoHideDescendants:void 0,i={id:me.MediaBarItemKeys.Location,active:this.state.selectedMediaBarItem===me.MediaBarItemKeys.Location,onActive:this._onPickerActive,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,preventAccessibilityFocus:this.props.preventAccessibilityFocus,isMobileInterface:e,onFocus:this.requestFocus,onBlur:this.blur,onCustomAction:this._onHandleCustomAction,origin:ge.MediaBarItemOrigin.MessageComposer};return d.createElement(d.Animated.View,{key:me.MediaBarItemKeys.Location,style:this._rightControlsOpacityStyle,importantForAccessibility:s},d.createElement(he.default,Object.assign({},i)))}_getMediaBar(e,t=!0){const s=this._getMediaBarItemDescriptors();if(s.length>0){const i=!d.Modal.isDisplayed()&&!!this._textInputRef&&!e&&!this.state.hasFocus&&this.state.isMediaBarCollapsable&&this.state.isCollapsableMediaBarExpanded;return d.createElement(ue.MediaBar,{ref:this._onMediaBarRef,activeId:this.state.selectedMediaBarItem,itemDescriptors:s,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,isMobileInterface:e,showIcons:t,onInputChange:this.autoReplaceText,onItemSelected:this._onMediaBarItemSelected,onFocus:this.requestFocus,onBlur:this.blur,onCustomKeyboardClose:this._onCustomKeyboardClose,onBackspace:this._handleEmoticonBackspacePress,onCustomAction:this._onHandleCustomAction,preventAccessibilityFocus:this.props.preventAccessibilityFocus,onMessageSent:this.props.onMessageSent,onCloseSearch:this._onCancelPesSearch,clearEditInChatsComposer:this.props.onClearEdit,autoFocusFirstItem:i,disableActionOnMediaBar:this.props.disableActionOnMessageComposer,focusCustomKeyboardWhenShown:!0,announceForAccessibilityForMessageSent:this._announceForAccessibilityForMessageSent,customKeyboardHeight:this.state.pesPickerKeyboardHeight})}}_animateInputAreaToTargetHeight(){this._inputAreaAnimation||this._inputAreaTargetHeight===this._inputAreaHeight||(this._inputAreaHeight=this._inputAreaTargetHeight,this._inputAreaAnimation=Ze.default.easeOut({value:this._inputAreaHeightValue,toValue:this._inputAreaTargetHeight}),this._inputAreaAnimation.start((()=>{this._inputAreaAnimation=void 0,this.isComponentMounted()?this._animateInputAreaToTargetHeight():k.default.updateAnchor(A.CoachMarkType.ExpressionPicker)})))}_toggleSmsSending(e,t){this._onPhoneNumberForSmsSelected(t),this.isComponentMounted()&&this.setState({smsToggledOn:e})}_rightControlsLayoutInfo(e,t){const s=this._showRightControls(e,t,void 0);let i,o=0;return s&&!this._showMicButton(e,t)||(o=1),s&&(this._showCameraButton(e,t)&&o++,this._showMediaPickerButton(e,t)&&o++,this._showLocationButton(e,t)&&o++),i=o?s?yt*o:yt+(t.useCompactLayout?0:5):5,{width:i,opacity:s?1:0,isShowing:s}}_showMicButton(e,t){return!(!e.onRecording||t.phoneNumberForSendingSms||this._isPresentedInSidebar()||t.disableHighBandwidthOperations||w.isS4BBridgeMri(e.conversationId))}_showCameraButton(e,t){return t.isCameraAvailable&&this._showCameraOrMediaButtonCommon(e,t)}_showMediaPickerButton(e,t){return t.showAdditionalMediaBarItems&&(!t.isUsingStackNavigationContext||t.isMediaPickerInRightControlsForMobile)&&this._showCameraOrMediaButtonCommon(e,t)}_showCameraOrMediaButtonCommon(e,t){return!(e.hideMediaPickerIcon||e.hideMediaBar||t.phoneNumberForSendingSms||this._isPresentedInSidebar()||t.disableHighBandwidthOperations||w.isS4BBridgeMri(e.conversationId))}_showLocationButton(e,t){return!t.isUsingStackNavigationContext&&t.showAdditionalMediaBarItems&&!e.hideLocationPickerIcon&&!e.hideMediaBar&&!t.phoneNumberForSendingSms&&!this._isPresentedInSidebar()&&!t.disableHighBandwidthOperations&&!w.isS4BBridgeMri(e.conversationId)&&!tt.default.isFireOS()}_showRightControls(e,t,s){const o=i.isUndefined(s)?this._sendControlEnabled(e,t,!!e.quotedMessages):s,n=this._canCancelEdit(t,e.editedMessage);return!o&&!n&&!t.phoneNumberForSendingSms}_sendControlEnabled(e,t,s){return e.showSendControlWhenEmpty||!t.userInputIsEmpty||s||!!t.phoneNumberForSendingSms||t.hasMediaPreviews||w.isS4BBridgeMri(e.conversationId)}_canCancelEdit(e,t){return!!t&&(!e.hasUncommittedUserInput||e.userInputIsEmpty||e.equalsInitialContent)}_wasRegexTriggered(e){return i.includes(Ct.instantTriggers,e)||i.includes(Ct.delayedTriggers,e)}_cancelAutoCompletionIfActive(){this._pendingMessageTextCompletionPromise&&(this._pendingMessageTextCompletionPromise.reject(),this._pendingMessageTextCompletionPromise=void 0),this.props.onInputTextChanged&&this.props.onInputTextChanged("",!0)}_setInputEntityStateUpstream(e){const t=ve.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives(e,this.state.emoticons);this.isComponentMounted()&&this.setState({inputEntities:e,editableEntities:t})}_setInputEntityStateDownstream(e,t){const s=this.state.inputEntitiesDataVersion+1,i=ve.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives(e,this.state.emoticons);this._textInputRef&&this._textInputRef.setContent(ve.getEditableContentFromEditableEntities(i,s)),this.isComponentMounted()&&this.setState({inputEntities:e,inputEntitiesDataVersion:s,editableEntities:i},t)}_pastePreviewCompletionHelper(e){E.default.dismissModal("PastePreviewModal",this._getRootViewId()),ie.track(new Ie.MessageComposerTelemetry(this.props.conversationId,e,Ie.MessageComposerAction.Paste))}_sendFileWithDimensions(e){let t=dt.default.getFileUrl(e);r.default.getImageSize(t).then((t=>{if(t&&(e.dimensions=t),this.state.isMediaPreviewEnabled)return ye.default.addPreviews([e],this.props.conversationId,q.PostSource.MessageComposer);const s={name:je.ScenarioName.SendPicture};He.default.postUpload([this.props.conversationId],e,q.PostSource.MessageComposer,!1,{scenarioInfo:s},this._getRootViewType())}))}_preventSendingSMSMessage(e){return!(!(1===e.length&&e[0]instanceof te.SmsEntity&&this._smsInfoLineRef)||this._smsInfoLineRef.canSendSMS())&&(this.state.isSmsFailureScreenEnabled?Re.default.navigateToSmsFailurePrompt(this.props.conversationId,this.state.phoneNumberForSendingSms?this.state.phoneNumberForSendingSms.number:"",!1):y.default.open(this._getRootViewId()),!0)}_getQuoteEntity(e){const t=H.default.getDisplayName(e.creator,!0),s=F.quoteMessage(e,t);return new te.QuoteEntity(s,t,e,this.props.quotesTriggerType)}_sendMessage(e){if(ie.log(q.LogTraceArea.MessageComposer,"sendMessage isPostingMessage: "+this._isPostingMessage),this._isPostingMessage)return;this._isPostingMessage=!0;const t=ut.default.newCauseId();ie.log(q.LogTraceArea.MessageComposer,"sendMessage causeId: "+t);let s=[];if(this.props.quotedMessages&&this.props.quotedMessages.map((e=>s.push(this._getQuoteEntity(e)))),e.length>0&&(s=s.concat(e)),this.state.enableOnewaySms&&this.state.phoneNumberForSendingSms&&!this.state.userInputIsEmpty&&(s=[new te.SmsEntity(this._getTextForSms(e),this.state.phoneNumberForSendingSms.number)],this._preventSendingSMSMessage(s)))return ie.log(q.LogTraceArea.MessageComposer,"sendMessage Message prevented from being send."),void(this._isPostingMessage=!1);const i={conversationId:this.props.conversationId,editedMessage:this.props.editedMessage,inputEntities:s,onMessageSent:this.props.onMessageSent,phoneNumberForSendingSms:this.state.phoneNumberForSendingSms,smsInfoLineRef:this._smsInfoLineRef,textInputRef:this._textInputRef,enableHandlingHTMLonPaste:this.state.enableHandlingHTMLonPaste,enableHandlingHyperlinkOnPaste:this.state.enableHandlingHyperlinkOnPaste,messageComposerPastedContentType:this.state.messageComposerPastedContentType};ye.default.sendPreviews(this.props.conversationId,t).then((()=>wt._sendTextMessage(i).then((e=>{if(e){if(this._handleAfterPostMessage(i.conversationId),ie.log(q.LogTraceArea.MessageComposer,"sendMessage Message sent."),i.smsInfoLineRef){const e=i.smsInfoLineRef.getTelemetryEvent();e&&(this.state.phoneNumberForSendingSms?e.setSmsWasSent(!0):e.setSkypeMessageSent(!0))}}else ie.log(q.LogTraceArea.MessageComposer,"sendMessage Message not sent.")})).finally((()=>{this._isPostingMessage=!1})))).finally((()=>{this.state.hasFocus||this.requestFocus()}))}static _sendTextMessage(e){if(i.every(e.inputEntities,(e=>e instanceof te.UnhandledEntity&&!i.trim(e.text()))))return e.inputEntities.length?ie.log(q.LogTraceArea.MessageComposer,"sendMessage User pressed enter with only whitespace message content."):ie.log(q.LogTraceArea.MessageComposer,"sendMessage User pressed enter without entering any message content."),c.Resolved(!1);if(e.onMessageSent(e.inputEntities,e.enableHandlingHTMLonPaste||e.enableHandlingHyperlinkOnPaste?Ce.convertPastedTextTypeToTelemetry(e.messageComposerPastedContentType):Ie.MessageComposerAction.NoPaste)){const t=x.default.getSavedMessageInput(e.conversationId);if(t){const s=e.textInputRef&&!e.textInputRef.equalsInitialContent()||!1;ie.track(new z.DraftMessageWasSent(s,t.timestamp))}const s=e.editedMessage?ce.getString("MessageComposer.MessageEditedLabel"):ce.getString("MessageComposer.MessageSentLabel");return wt._announceForAccessibility(s),Ke.default.isMobileScreenReaderEnabled()?lt.default.sleep(1e3).then((()=>!0)):c.Resolved(!0)}return c.Resolved(!1)}static _announceForAccessibility(e){Ke.default.maybeAnnounceForAccessibility(e,0)}_handleAfterPostMessage(e){if(x.default.getSavedMessageInput(e)&&(0,O.default)().fakeConversationTime(e,Date.now()),x.default.clearMessageInput(e),this.props.conversationId===e){this.state.hasFocus||this.requestFocus(),this.setTextInputAccessibilityFocus(),this._setInputEntityStateDownstream([]),this._cancelAutoCompletionIfActive(),this.isComponentMounted()&&this.setState({selectedMediaBarItem:""}),this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(),this.props.onClearEdit&&this.props.onClearEdit();const e=this._getRootViewId();pe.MediaBarItem.dismissPopup(e),V.default.close(e)}this._isPostingMessage=!1}_shouldAutoFocusInput(){return!this.state.isSmallOrTinyScreen}_isMediabarDisabled(){return w.isS4BBridgeMri(this.props.conversationId)||!!this.state.phoneNumberForSendingSms||!!this.state.isConversationWithPhoneNumber}_isPresentedInSidebar(){return this._getContext().isPresentedInDesktopLeftNav||this._getContext().isPresentedInDesktopRightNav}}t.default=wt},71540:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(15069),n=s(62698),r=s(25465),a=s(79737),l=s(16778),d=s(97691),c=s(4736),h=s(60),u=s(89391),p=s(80843),g=s(68894),m=s(66988),S=s(39119),f=s(78723),y=s(94655),_=s(16625),v=s(48649),C=s(47447),b=s(5531),T=s(51267),M=s(71908),I=s(51077),w=s(71830),P=s(96418),k=s(11009),A=s(98278),E=s(54549),R=s(8223),L=s(81632),F=s(17677),x=s(20770),O=s(39549),D=s(86374),B=s(84817),V=s(43368),N=s(10547),U=s(37490),H=s(52262),z=s(92069),W=s(30757),j=s(82433),G=s(70891),K=s(4604),q=s(46096),Q=s(1014),X=s(29245),$=s(61317),J=s(53559),Y=s(80469),Z=s(30387),ee=s(13944),te=s(66649),se=s(97174),ie=s(23944),oe=s(36237),ne=s(61253),re=s(72490),ae=s(47126),le=s(15877),de=s(20022),ce=s(33754),he=s(88824),ue=s(80372),pe=s(24897),ge=s(38915),me=s(9748),Se=s(18743),fe=s(64862),ye=s(6286),_e=s(3088),ve=s(47193),Ce=s(61428),be=s(23752),Te=s(22929),Me=s(71639),Ie=s(6658),we=s(12056),Pe=s(44972),ke=s(45532),Ae=s(89808),Ee=s(78735),Re=s(4735),Le=s(30124),Fe=s(17252),xe=s(33348),Oe=s(43501),De=s(69399),Be=s(79348),Ve=s(63584),Ne=s(99070),Ue=s(85207),He=s(29130),ze=s(81571),We=s(57946),je=s(15963),Ge=s(20360),Ke=s(86045),qe=s(37589),Qe=s(15301),Xe=s(49769),$e=s(97639),Je=s(63080),Ye=s(95960),Ze=s(50795),et=s(81760),tt=s(40363),st=s(11010),it=s(11828),ot=s(78262),nt=s(42759),rt=s(80837),at=s(24576),lt=s(26712),dt=s(73096),ct=s(72758),ht=s(53374),ut=s(56503),pt=s(23474),gt=s(50488),mt=et.Color.darkMessageComposerContentBackground,St=et.Color.gray400Overlay10,ft=a.unicodeLetterRegex,yt={instantTriggers:[`^(@[${ft}-]{0,16} ?[${ft}-]{0,16})$`,`.*\\W(@[${ft}]{0,16} ?[${ft}]{0,16})$`,"^(/\\w{0,16})$",".*(\\([a-zA-Z:]{2,16})$",".*(\\([a-zA-Z:]{2,16}:[1-6]?)$"],delayedTriggers:[".*\\b([A-Z][A-Za-z]{2,31})$"]};var _t;!function(e){e[e.OverflowButton=0]="OverflowButton",e[e.OverflowButtonCoachMark=1]="OverflowButtonCoachMark"}(_t||(_t={}));const vt=(0,le.lazyProperties)({composerArea:()=>l.Styles.createViewStyle({flex:1,flexDirection:"row"}),compositionAreaContainer:()=>l.Styles.createViewStyle({position:"absolute",flexDirection:"row",left:0,right:0,bottom:0}),compositionArea:()=>l.Styles.createViewStyle({flex:1,justifyContent:"center"}),inputArea:()=>l.Styles.createViewStyle({flexDirection:"row"}),expandableArea:()=>l.Styles.createViewStyle({flex:1,maxHeight:96,backgroundColor:et.Color.transparent}),expandableAreaWithQuote:()=>l.Styles.createViewStyle({flex:1,maxHeight:48}),composerInner:()=>l.Styles.createViewStyle({flex:1,flexDirection:"row",marginVertical:9,marginHorizontal:13}),rightControlContainer:()=>l.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),quoteArea:()=>l.Styles.createViewStyle({flex:1,paddingTop:6,paddingLeft:12}),multiQuoteArea:()=>l.Styles.createViewStyle({flex:1,flexDirection:"row",marginTop:15,marginBottom:0,marginLeft:20,marginRight:20}),multiQuoteAreaMessages:()=>l.Styles.createViewStyle({flex:1,flexDirection:"row",maxHeight:126,paddingBottom:15,borderBottomWidth:1,borderStyle:"solid"}),multiQuoteAreaMessage:()=>l.Styles.createViewStyle({marginBottom:12}),multiQuoteAreaLastMessage:()=>l.Styles.createViewStyle({marginBottom:0}),multiQuoteAreaClearButton:()=>l.Styles.createButtonStyle({alignSelf:"flex-start"}),quoteTextStyle:()=>l.Styles.createTextStyle({fontStyle:"italic"}),quoteAttributeStyle:()=>l.Styles.createTextStyle({fontSize:st.default.controlFontSize.messageStreamQuoteAttributeDesktop,marginTop:0,marginBottom:0}),sendButton:()=>l.Styles.createViewStyle({height:50}),actionButtonWithBackground:()=>l.Styles.createViewStyle({height:40,width:40,borderRadius:20}),actionButtonVerticalCenter:()=>l.Styles.createViewStyle({alignSelf:"center"}),skypeMessageTextInput:()=>l.Styles.createTextStyle({font:st.default.font.uiDisplayRegular,fontSize:st.default.controlFontSize.messageComposerDesktop,minHeight:23,backgroundColor:et.Color.transparent}),textInputFocusButton:()=>l.Styles.createButtonStyle({position:"absolute",top:0,bottom:0,left:0,right:0,backgroundColor:et.Color.transparent}),linkStyle:()=>l.Styles.createTextStyle({fontSize:st.default.controlFontSize.body,lineHeight:18,color:et.Color.gray400,fontFamily:st.default.fontFamily.uidDisplayRegular,textDecorationLine:"underline"}),emoteAuthor:()=>(0,le.lazyProperties)({text:()=>l.Styles.createTextStyle({fontSize:st.default.controlFontSize.messageComposerDesktop,marginTop:7,fontStyle:"italic"}),textDesktop:()=>l.Styles.createTextStyle({marginTop:5,marginBottom:3})}),desktopOverrides:()=>(0,le.lazyProperties)({messageComposer:()=>l.Styles.createViewStyle({minHeight:48,justifyContent:"center",borderColor:et.Color.transparent,borderStyle:"solid",borderWidth:3}),doNotFormatLightTheme:()=>l.Styles.createViewStyle({borderColor:et.Color.gray100}),doNotFormatDarkTheme:()=>l.Styles.createViewStyle({borderColor:et.Color.gray300}),messageComposerAllRoundCorners:()=>l.Styles.createViewStyle({borderRadius:24}),messageComposerTopFlatCorners:()=>l.Styles.createViewStyle({borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:24,borderBottomRightRadius:24}),compositionAreaContainer:()=>l.Styles.createViewStyle({flexDirection:"column"}),quoteArea:()=>l.Styles.createViewStyle({flex:1,paddingTop:15,paddingBottom:0,paddingLeft:20,paddingRight:20}),compositionAreaNoPesPicker:()=>l.Styles.createViewStyle({paddingLeft:21}),compositionAreaNoRichTextEditor:()=>l.Styles.createViewStyle({paddingRight:21}),expandableArea:()=>l.Styles.createViewStyle({maxHeight:175}),expandableAreaWithQuote:()=>l.Styles.createViewStyle({maxHeight:133}),expandableAreaSmallView:()=>l.Styles.createViewStyle({maxHeight:133}),expandableAreaWithQuoteSmallView:()=>l.Styles.createViewStyle({maxHeight:91}),composerInner:()=>l.Styles.createViewStyle({marginVertical:2,marginHorizontal:-1}),rightControlContainer:()=>l.Styles.createViewStyle({minHeight:48,marginLeft:4,alignItems:"flex-end"}),composerInnerIconWrapper:()=>l.Styles.createViewStyle({alignSelf:"flex-end",height:40,justifyContent:"center"})}),mediaBarWrapper:()=>l.Styles.createViewStyle({flexDirection:"row",height:50,alignItems:"center"})});let Ct=45;class bt extends at.default{constructor(){super(...arguments),this._isPostingMessage=!1,this._gotInitialInputAreaHeight=!1,this._inputAreaHeight=Ct,this._inputAreaTargetHeight=this._inputAreaHeight,this._inputAreaHeightValue=new l.Animated.Value(this._inputAreaHeight),this._inputAreaHeightStyle=l.Styles.createAnimatedViewStyle({height:this._inputAreaHeightValue}),this._onEmoticonSelected=e=>{this.autoReplaceText(e.text(),"Emoticon",e)},this._onMojiSelected=e=>{this.props.conversationId&&(Ue.default.postMessageFromInput(this.props.conversationId,q.PostSource.MediaPicker,[e],I.MessageTypes.Media_FlikMsg,{name:je.ScenarioName.SendMoji},void 0,this._getRootViewType()),this._announceForAccessibilityForMessageSent()),this._closePesPickerAndFocusTextInput()},this._onStickerSelected=e=>{this.props.conversationId&&(Ue.default.postMessageFromInput(this.props.conversationId,q.PostSource.MediaPicker,[e],I.MessageTypes.RichText,{name:je.ScenarioName.SendSticker},void 0,this._getRootViewType()),this._announceForAccessibilityForMessageSent()),this._closePesPickerAndFocusTextInput()},this._onGifSelected=e=>{this.props.conversationId&&(Ue.default.postMessageFromInput(this.props.conversationId,q.PostSource.MediaPicker,[e],I.MessageTypes.RichText,{name:je.ScenarioName.SendGif},void 0,this._getRootViewType()),this._announceForAccessibilityForMessageSent()),this._closePesPickerAndFocusTextInput()},this._closePesPickerAndFocusTextInput=()=>{this._closeUnifiedPesPickerDesktop(),this.setTextInputAccessibilityFocus()},this._onSMSInfoLineRef=e=>{this._smsInfoLineRef=e||void 0},this._onClearQuoteButtonPress=()=>{this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(!0)},this._onPhoneNumberForSmsSelected=e=>{const t=ht.default.newCauseId();oe.log(q.LogTraceArea.MessageComposer,"MessageComposer._onPhoneNumberForSmsSelected causeId: "+t),this.state.useThreadsFor2way&&this.state.twoWaySMSCapable?e&&Re.default.navigateToConversation({convId:w.getMriFromPhoneNumber(e),origin:q.NavigationConversationOrigin.SMSNumberSwitch,selectedNumberForSMS:e,causeId:t}):Re.default.navigateToConversation({convId:this.props.conversationId,origin:q.NavigationConversationOrigin.SMSNumberSwitch,selectedNumberForSMS:e,causeId:t})},this._onVisibleSelectionRect=e=>{this.state.richTextEditorExp===gt.RichtextEditorExperience.Popup&&ze.default.setPopupPosition(this.props.conversationId,e)},this._shouldDefaultPaste=e=>!(this.state.enableMultiMessageQuote&&this.state.pasteAsQuotePreference&&Te.default.hasContent(e)),this._saveMessage=e=>{if(e&&e.length>0||this._hasQuotes()||this.props.editedMessage){let t,s=We.SavedMessageType.None;this.props.editedMessage?(t=[this.props.editedMessage],s=We.SavedMessageType.Edited):this.props.quotedMessages&&(t=this.props.quotedMessages,s=We.SavedMessageType.Quoted),x.default.saveMessageInput(this.props.conversationId,{messages:t,type:s,inputEntities:e,inputEntitiesDataVersion:this.state.inputEntitiesDataVersion,timestamp:Date.now()})}else x.default.clearMessageInput(this.props.conversationId)},this._onCancelPesSearch=(e,t)=>{e&&x.default.clearMessageInput(this.props.conversationId);const s=x.default.getSavedMessageInput(this.props.conversationId);(!s||s&&i.isEmpty(s.messages))&&(this.props.quotedMessages&&this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(),this.props.editedMessage&&this.props.onClearEdit&&this.props.onClearEdit());const o=s?s.inputEntities:[];this._setInputEntityStateDownstream(o,t),this.isComponentMounted()&&this.setState({selectedMediaBarItem:""})},this._onTextInputRef=e=>{this._textInputRef=e||void 0},this._onClearEditMessageQuote=()=>{const e=i.head(this.state.inputEntities);this._textInputRef&&e instanceof se.QuoteEntity&&this._textInputRef.getContent().then((e=>{const t=this._consumeNewUserInput(e)||this.state.inputEntities;this._setInputEntityStateDownstream(t.slice(1,t.length))}))},this._renderEmoticonPickerItem=e=>l.createElement(W.EmoticonPickerItem,Object.assign({},e)),this._renderMojiPickerItem=e=>l.createElement(ke.MojiPickerItem,Object.assign({},e)),this._renderGifPickerItem=e=>l.createElement(Z.GifPickerItem,Object.assign({},e)),this._renderStickerPickerItem=e=>l.createElement(Ye.StickerPickerItem,Object.assign({},e)),this._renderSmsItem=e=>l.createElement(Je.SmsItem,Object.assign({},e)),this._renderMediaPickerItem=e=>l.createElement(X.default,Object.assign({acceptedFileTypes:X.AcceptedFileTypes.MediaOnly},e)),this._renderFilePickerItem=e=>l.createElement(X.default,Object.assign({acceptedFileTypes:X.AcceptedFileTypes.All},e)),this._renderCameraItem=e=>l.createElement(v.CameraItem,Object.assign({},e)),this._renderScheduleCallItem=e=>l.createElement(Ge.ScheduleCallItem,Object.assign({},e)),this._renderPollItem=e=>l.createElement(Ne.PollItem,Object.assign({},e)),this._renderLocationPickerItem=e=>l.createElement(he.default,Object.assign({},e)),this._renderContactPickerItem=e=>l.createElement(R.ContactPickerItem,Object.assign({},e)),this._renderBingSearchItem=e=>l.createElement(f.BingSearchItem,Object.assign({},e)),this._renderVideoMessageItem=e=>l.createElement(ut.default,Object.assign({},e)),this._renderPeopleItem=e=>l.createElement(Oe.PeopleItem,Object.assign({},e)),this._renderAudioMessageItem=e=>l.createElement(m.AudioMessageItem,Object.assign({},e)),this._renderSendCreditItem=e=>l.createElement(qe.SendCreditItem,Object.assign({},e)),this._onMediaBarRef=e=>{this._mediaBarRef=e||void 0},this._renderPesPickerPopup=()=>l.createElement(Be.PesPickerPopup,{ref:this._onPesPickerPopupRef,renderMobileInterface:!1}),this._onPesPickerPopupRef=e=>{this._pesPickerPopup=e||void 0},this._getPesPickerPopupRef=()=>this._pesPickerPopup,this._onCustomKeyboardClose=()=>{this._pesPickerPopup&&this._pesPickerPopup.hide()},this._onLayoutInputArea=e=>{const t=Math.ceil(e.height);this._gotInitialInputAreaHeight?(this._inputAreaTargetHeight=t,this._animateInputAreaToTargetHeight()):(this._inputAreaTargetHeight=t,this._inputAreaHeight=t,this._inputAreaHeightValue.setValue(t),Ct=t,this._gotInitialInputAreaHeight=!0)},this._onHandleCustomAction=(e,t)=>{switch(e){case ot.MediaBarCustomAction.LaunchCamera:this.props.onLaunchCamera&&this.props.onLaunchCamera();break;case ot.MediaBarCustomAction.LaunchEmoticon:Ve.EmoticonPickerTelemetry.startOpenScenario(),Ve.EmoticonPickerTelemetry.open(),this._onPickerActive(me.MediaBarItemKeys.Emoticon);break;case ot.MediaBarCustomAction.LaunchMoji:Ve.MojiPickerTelemetry.open(),this._onPickerActive(me.MediaBarItemKeys.Moji);break;case ot.MediaBarCustomAction.LaunchSticker:Ve.StickerPickerTelemetry.open(),this._onPickerActive(me.MediaBarItemKeys.Sticker);break;case ot.MediaBarCustomAction.LaunchGif:Ve.GifPickerTelemetry.open(),this._onPickerActive(me.MediaBarItemKeys.Gif);break;default:oe.log(q.LogTraceArea.MessageComposer,"_onHandleCustomAction unhandled action: "+e)}},this._onComposerOverflowPress=()=>{oe.track(new Se.MediaBarItemPressed(_t[_t.OverflowButton],!0,this.props.conversationId,ge.MediaBarItemOrigin.MessageComposer))},this._onDismissMediaPicker=()=>{r.default.showNativeKeyboard(),this.isComponentMounted()&&this.setState({selectedMediaBarItem:""})},this._onUnifiedPesPickerDesktopPress=()=>{this.state.isShowingUnifiedPesPickerDesktop||(Ve.EmoticonPickerTelemetry.startOpenScenario(),V.default.open(this._getRootViewId()))},this._closeUnifiedPesPickerDesktop=()=>{this.state.isShowingUnifiedPesPickerDesktop&&V.default.close(this._getRootViewId())},this._onPickerActive=e=>{this._textInputRef&&this._textInputRef.getContent().then(this._consumeNewUserInput),this.isComponentMounted()&&this.setState({selectedMediaBarItem:e})},this._onEditorActive=()=>{this._textInputRef&&this._textInputRef.getContent().then(this._consumeNewUserInput),this.isComponentMounted()&&ze.default.setVisibility(this.props.conversationId,!1)},this._onMediaBarItemSelected=e=>{this.state.selectedMediaBarItem!==e&&(this.isComponentMounted()&&this.setState({selectedMediaBarItem:e===me.MediaBarItemKeys.Sms?"":e}),this.props.onMediaItemSelected&&this.props.onMediaItemSelected()),e===me.MediaBarItemKeys.Sms&&(1===this.state.phoneNumbers.length?this._toggleSmsSending(!0,this.state.phoneNumbers[0]):Xe.default.showNumberSelectionPopup((()=>this._smsInfoLineRef),this._getRootViewId(),this.props.conversationId,this.state.phoneNumbers,!1).then((e=>{this._toggleSmsSending(!0,e)})).catch(i.noop))},this._onCancelEditClick=e=>{e.stopPropagation(),bt._announceForAccessibility(ce.getString("MessageComposer.MessageEditingCanceledLabel")),this._handleAfterPostMessage(this.props.conversationId)},this._onSendButtonClick=e=>{e.stopPropagation(),this._textInputRef&&this._textInputRef.getContent().then((e=>{const t=this._consumeNewUserInput(e);t?this._sendMessage(t):this._setInputEntityStateDownstream(this.state.inputEntities)}))},this._onInputButtonRef=e=>{this._inputButton=e||void 0},this.insertSearchResult=(e,t,s)=>{bt._announceForAccessibility(e),this.autoReplaceText(e,t,s)},this.autoReplaceText=(e,t,s)=>{if(l.UserInterface.isNavigatingWithKeyboard()&&this.state.selectedMediaBarItem&&pe.MediaBarItem.dismissPopup(this._getRootViewId()),"Emoticon"===t){const e=ce.getString("MessageComposer.AccessibilityAnnouncement_EmoticonInserted");bt._announceForAccessibility(e)}else bt._announceForAccessibility(e);if(this._textInputRef){const e=ve.getEditableEntityFromInputEntityAndConsiderAlternatives(s,this.state.emoticons);this._textInputRef.insertContent(e),this._textInputRef.requestFocus(),this._textInputRef.getContent().then((e=>{this.isComponentMounted()&&this._consumeNewUserInput(e)}))}},this._onAutoCompletionRequested=(e,t)=>(this._pendingMessageTextCompletionPromise&&(this._pendingMessageTextCompletionPromise.reject(),this._pendingMessageTextCompletionPromise=void 0),this.props.onInputTextChanged&&this._wasRegexTriggered(t)&&(this._pendingMessageTextCompletionPromise=d.Defer(),this.props.onInputTextChanged(e,!1)),this._pendingMessageTextCompletionPromise?this._pendingMessageTextCompletionPromise.promise():d.Rejected()),this._onAutoCompletionRequestAborted=()=>{this._cancelAutoCompletionIfActive()},this._onAutoCompletionNavigationKey=e=>{if(this.props.onKeyPress&&this.props.onKeyPress(e),e.keyCode===ae.default.ESCAPE)this._cancelAutoCompletionIfActive()},this._onUserInputActive=()=>{dt.default.setComposingState(!0,this.props.conversationId)},this._onUserInputInactive=()=>{dt.default.setComposingState(!1,this.props.conversationId)},this._onUserInputCommitted=e=>{const t=this._consumeNewUserInput(e);t&&(dt.default.setComposingState(!1,this.props.conversationId),this._sendMessage(t))},this._onPastingText=e=>{this.isComponentMounted()&&this.setState({messageComposerPastedContentType:e})},this._setComposingStateInactiveDebounced=i.debounce((()=>{dt.default.setComposingState(!1,this.props.conversationId)}),300,{leading:!0,trailing:!0}),this._onUserInputAborted=()=>{this.state.selectedMediaBarItem===me.MediaBarItemKeys.Emoticon||this.state.isShowingUnifiedPesPickerDesktop||(this._setComposingStateInactiveDebounced(),this._hasQuotes()&&this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(!0),this.props.editedMessage&&(this.props.onClearEdit&&this.props.onClearEdit(),x.default.clearMessageInput(this.props.conversationId)),this._cancelAutoCompletionIfActive())},this._onUserInputEmptyIndicationChanged=e=>{this.isComponentMounted()&&this.setState({userInputIsEmpty:e}),this.props.onNativeComposerMessageEmptyStateChanged&&this.props.onNativeComposerMessageEmptyStateChanged()},this._onUserInputUncommittedChangesIndicationChanged=e=>{this.isComponentMounted()&&this.setState({hasUncommittedUserInput:e})},this._onEqualsInitialContentIndicationChanged=e=>{this.isComponentMounted()&&this.setState({equalsInitialContent:e})},this._onUserInputBackspacePressedAtHeadPos=()=>{this._hasQuotes()&&this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(!0),this.state.userInputIsEmpty&&this.props.editedMessage&&this.props.onClearEdit&&this.props.onClearEdit()},this._onAccessibilityAnnouncementRequested=e=>{if(e===a.AccessibilityAnnouncement.NewLineAdded)l.Accessibility.announceForAccessibility(ce.getString("MessageComposer.AccessibilityAnnouncement_NewlineAdded"))},this._onEmoticonLoadCompleted=e=>{oe.track(new De.ComposerEmoticonLoaded(e,Le.default.isUsingStackNavigationContext()))},this._onPartiallyEnteredMsgStoreUpdated=e=>{if(e===this.props.conversationId){const t=x.default.getSavedMessageInput(e);t&&t.inputEntitiesDataVersion===this.state.inputEntitiesDataVersion&&this._setInputEntityStateUpstream(t.inputEntities)}},this._consumeNewUserInput=e=>{let t;return e.downStreamDataVersion===this.state.inputEntitiesDataVersion&&(t=ie.applyEditableContentToInputEntities(e,this.state.inputEntities),this._setInputEntityStateUpstream(t)),t},this._onCompositionAreaPress=e=>{this.state.hasFocus||this._hasQuotes()||this.requestFocus()},this._onCompositionAreaKeyPress=e=>{e.keyCode===ae.default.ESCAPE&&this.isComponentMounted()&&this._moreButton&&this._moreButton.requestFocus()},this._onFocus=()=>{let e={hasFocus:!0};this.isComponentMounted()&&this.setState(e)},this._onBlur=()=>{const e={hasFocus:!1};this.isComponentMounted()&&this.setState(e),this.props.onBlur&&this.props.onBlur()},this._onPaste=e=>{if(!this._shouldDefaultPaste(e.nativeEvent)&&this.props.onKeyboardPaste)return void this.props.onKeyboardPaste(e);const t=e.nativeEvent;this.props.disableCopyPasteMedia||i.isEmpty((0,Y.get)(t,["clipboardData","items"]))||i.some(t.clipboardData.items,(e=>"text/plain"===e.type))||(i.each(t.clipboardData.items,(t=>{if("image/png"===t.type){e.stopPropagation(),e.preventDefault();const s=new FileReader;let o=t.getAsFile();if(o instanceof e.nativeEvent.target.ownerDocument.defaultView.Blob){const e="image_"+(new Date).toISOString().replace(/[:\.\-]/g,"_")+".png",t=i.attempt((t=>new File([t],e,{type:t.type})),o);i.isError(t)||(o=t),s.onload=()=>{if(o&&o.size>0){let e={file:o,extension:J.default.extractFileExtension(o.name)};this._sendFileWithDimensions(e)}},s.readAsDataURL(o)}}})),bt._announceForAccessibility(ce.getString("MessageComposer.FilesSentLabel")))},this._getQuoteEntity=e=>{const t=H.default.getDisplayName(e.creator,!0),s=F.quoteMessage(e,t);return new se.QuoteEntity(s,t,e,this.props.quotesTriggerType)},this._announceForAccessibilityForMessageSent=()=>{i.defer((()=>{this.isComponentMounted()&&bt._announceForAccessibility(ce.getString("MessageComposer.MessageSentLabel"))}))},this._handleEmoticonBackspacePress=e=>{this._textInputRef&&this._textInputRef.notifyBackspacePressedExternally()},this._showFilePicker=(e,t)=>{if(t!==this._getRootViewId())return!1;if(this.state.editable&&C.UICapabilities.desktopFilePickerSupported()&&!w.isPhoneMri(this.props.conversationId)&&!w.isS4BBridgeMri(this.props.conversationId)){const t=e=>{const t=J.default.extractFileExtension(e.file.name),s=this._getRootViewType();if(J.default.isVideoExtension(t)){const t={name:je.ScenarioName.SendVideo};Ue.default.postVideoWithThumbnail([this.props.conversationId],e,q.PostSource.MediaPicker,!1,t,void 0,void 0,void 0,s).then((()=>{bt._announceForAccessibility(ce.getString("MessageComposer.FileSentLabel"))}))}else if(J.default.isImageExtension(t)){const t={name:je.ScenarioName.SendPicture};Ue.default.postUpload([this.props.conversationId],e,q.PostSource.MediaPicker,!1,{scenarioInfo:t},s).then((()=>{bt._announceForAccessibility(ce.getString("MessageComposer.FileSentLabel"))}))}else{const t={name:je.ScenarioName.SendFile};Ue.default.postUpload([this.props.conversationId],e,q.PostSource.MediaPicker,!1,{scenarioInfo:t},s).then((()=>{bt._announceForAccessibility(ce.getString("MessageComposer.FileSentLabel"))}))}this.requestFocus()};$.FilePickerUtils.isDocumentPickerSupported()?$.FilePickerUtils.showDocumentPicker(t,this._getRootViewId()):$.FilePickerUtils.showMultiFilesPicker(t,Se.FilePickerOrigin.MessageComposer,void 0,this._getRootViewId(),e)}return!0},this._editLastMessageKeyboardShortcut=(e,t)=>t===this._getRootViewId()&&(this._editLastMessage(),!0),this._focusKeyboardShortcut=(e,t)=>t===this._getRootViewId()&&(this.requestFocus(),!0),this._editLastMessage=()=>{this.props.onEditLastMessage&&this.props.onEditLastMessage()},this._updateAndStoreDraftInputEntitiesFromContent=e=>(oe.log(q.LogTraceArea.MessageComposer,"MessageComposer._updateAndStoreDraftInputEntitiesFromContent causeId: "+e),this._textInputRef?this._textInputRef.getContent().then((e=>x.default.updateInputEntitiesFromContent(this.props.conversationId,e).commit(this.props.conversationId).storeSavedMessage(this.props.conversationId))):d.Resolved()),this._validateUrl=e=>lt.default.isUrlValid(e),this.requestFocus=()=>{this._textInputRef&&(o.BrowserEnvironment.isEngineEdgeHTML()&&document.activeElement&&document.activeElement.blur(),this._textInputRef.requestFocus())},this.blur=()=>{this._textInputRef&&this._textInputRef.blur()},this.focusVideoButton=()=>{const e=this._mediaBarRef?this._mediaBarRef.getItemById(me.MediaBarItemKeys.VideoMessage):void 0;e&&e.requestFocus()},this.focusSendButton=()=>{this._inputButton&&this._inputButton.requestFocus()},this.focusOverflowButton=()=>{},this.setTextInputAccessibilityFocus=()=>{this._textInputRef&&(this.state.isSmallOrTinyScreen||this._textInputRef.setAccessibilityFocus(),this.props.explicitAccessibilityAnnoucement&&l.Accessibility.announceForAccessibility(this._placeholderText))}}_buildState(e,t){var s;const n=Ee.default.getUserPreferencesLocal(),r={},l=this.props,d=this._getRootViewId(),c=u.default.getS4LMessagingFeatures(),h=u.default.getS4LCommerceFeatures();t&&(r.inputEntities=e.initialInputEntities||[],r.inputEntitiesDataVersion=e.initialInputEntitiesDataVersion||0,r.hasFocus=!1,r.selectedMediaBarItem="",r.offsetTop=0,r.userInputIsEmpty=i.isEmpty(r.inputEntities),r.hasUncommittedUserInput=!1,r.equalsInitialContent=!0,r.currentNumberOfIconsInMediaBar=this._getContext().isPresentedInDesktopLeftNav||this._getContext().isPresentedInDesktopRightNav?1:3,r.pesPickerKeyboardHeight=276,r.messageComposerPastedContentType=a.PastedTextType.None),r.delayedTriggersWaitTime=c.composerAutoCompletionDelay,r.enablePollExtensionEntryPoint=c.enablePollExtensionEntryPoint,r.enableMultiMessageQuote=c.enableMultiMessageQuoteOnKeyboard,r.mediaBarMenuOrder=c.mediaBarMenuOrder,r.enableInCallFindPanel=c.enableInCallFindPanel,r.useThreadsFor2way=c.useSmsThreadsFor2way,r.isConversationWithPhoneNumber=w.isConversationWithPhoneNumber(e.conversationId),r.doNotFormat=Ee.default.getValueOfDoNotFormatPreferenceOrFalseIfDisabled(e.conversationId)&&!r.isConversationWithPhoneNumber,r.enableHandlingHTMLonPaste=!r.doNotFormat&&c.enableHandlingHTMLonPaste,r.enableHandlingHyperlinkOnPaste=!r.doNotFormat&&c.enableHandlingHyperlinkOnPaste,r.isSmallOrTinyScreen=He.default.isSmallOrTinyScreenSize(d)||u.default.getS4LUiFeatures().enableResponsiveDesign&&o.EnvironmentInfo.isMobile(),r.editable=!xe.default.isAnimationPending()&&!e.disableActionOnMessageComposer,r.isSmallHeightView=He.default.isSmallDesktopHeightView(d),r.viewportWidth=e.availableWidth||He.default.getWidth(d),r.showAdditionalMediaBarItems=r.viewportWidth>=360,r.gradientColors=Ae.default.getGradientColors(),r.emoticons=j.default.getEmoticons(),r.isShowingUnifiedPesPickerDesktop=!e.hideMediaBar&&V.default.shouldShow(d),r.messageStreamFontSize=Ee.default.getMessageStreamFontSize(),r.canUseAddins=b.default.addins().canUseAddins,r.editableEntities=ve.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives(r.inputEntities||[],r.emoticons);const{selectedTabType:p,searchQuery:g}=V.default.getPickerSearchProps();r.selectedTabType=p,r.searchQuery=g,r.isEncryptedThreadThread=w.isEncryptedThread(e.conversationId),r.showLocationPicker=!e.hideLocationPickerIcon&&c.enableLocationSharingOnDesktopAndWeb&&!tt.default.isFireOS(),r.showContactPicker=!e.hideContactPickerIcon&&c.enableContactShare&&b.default.contacts().canInvitePeople,r.showStickerPicker=!e.hideStickerPickerIcon&&!1,r.showGifPicker=!e.hideGifPickerIcon&&!1,r.showVideoMessageIcon=!e.hideVideoMessageIcon&&!r.isEncryptedThreadThread&&u.default.isDesktopVIMEnabled()&&(B.default.isAVDeviceReady()||o.BrowserEnvironment.isChrome()),r.phoneNumbers=e.otherPartyMri&&ct.default.getFullUserProfileByMri(e.otherPartyMri).phones||[];const m=w.isPhoneMri(e.conversationId);r.creditEntitlement=K.default.getCreditEntitlement(),r.enableOnewaySms=(m||h.smsPromo.unpaidUserEnabled||!!S.getPositiveCreditBalance(r.creditEntitlement)||K.default.userHasSubscriptions())&&(m||w.isOneOnOneConversation(e.conversationId))&&r.phoneNumbers.length>0&&!e.editedMessage&&!e.hideSmsIcon&&!w.isEncryptedThread(e.conversationId),r.quoteTextForSms=this._getQuotedTextForSms(l.quotedMessages,e.quotedMessages),r.disableHighBandwidthOperations=te.default.isUsingGogoNetwork(),r.isCameraAvailable=C.UICapabilities.cameraSupported()&&T.default.isCameraAvailable(),r.sendMessageWithEnter=n.sendMessageWithEnter,r.pasteAsQuotePreference=n.pasteAsQuotesEnabled,r.twoWaySMSCapable=!!(null===(s=_.default.getCallerIdPrimaryNumber())||void 0===s?void 0:s.smsCapable);let f=e.phoneNumberForSendingSms;if(!f&&w.isPhoneMri(e.conversationId)){const t=w.getPhoneNumberFromMri(e.conversationId);t&&(f={number:t,type:ot.PhoneNumberTypes.Other})}r.phoneNumberForSendingSms=f,r.isMediaPreviewEnabled=ye.default.isMediaPreviewEnabled(e.conversationId),r.hasMediaPreviews=r.isMediaPreviewEnabled&&_e.default.getPreviews(e.conversationId).length>0,r.isSmsFailureScreenEnabled=r.enableOnewaySms&&h.callFailure.smsFailurePrompt.enabled,r.isOfficeLensAvailable=Fe.isOfficeLensAvailable();const y=(0,O.default)().getConversation(e.conversationId);r.isRegularMemberInModeratedGroup=y&&(0,Pe.isRegularMemberInModeratedGroup)(y);const v=ze.default.panelOpened(e.conversationId),M=ze.default.popupOpened(e.conversationId);return r.richTextEditorVisible=v||M,r.richTextEditorExp=ze.default.getExperience(),t&&(Qe.default.setDefault(),Qe.default.commitNextFlowId(),this._checkForOutgoingSmsMessagesInConversation(r)),r}componentDidMount(){super.componentDidMount(),this._dataUpdateSubscription=a.dataUpdateReceivedEvent.subscribe((({forCustomContext:e,newContent:t})=>{e===this.props.conversationId&&this._consumeNewUserInput(t)})),u.default.getS4LMessagingFeaturesNoSubscription().enableDraftMessagesPersistentStorage&&(de.default.addObserver(de.LifecycleEventType.ON_EXIT,this._updateAndStoreDraftInputEntitiesFromContent),this._appStateSubscription=h.default.subscribeForChanges("MessageComposerWithPopup",(e=>{if((!this._textInputRef||this._textInputRef.hasUncommittedChanges())&&i.includes([l.Types.AppActivationState.Inactive,l.Types.AppActivationState.Background],e)){const e=ht.default.newCauseId();oe.log(q.LogTraceArea.MessageComposer,"MessageComposer._appStateSubscription causeId: "+e),this._updateAndStoreDraftInputEntitiesFromContent(e).then((()=>{const e=x.default.getConversationsNumber();e>0&&oe.track(new z.DraftMessageAppExitWithDrafts(e))})).catch(i.noop)}}))),l.Modal.isDisplayed()||!this._shouldAutoFocusInput()&&!this.props.shouldAutoFocus||this.props.preventFocusOnMount||this.requestFocus(),this.state.overrideEditable&&this.setState({overrideEditable:void 0}),this._textInputRef&&this.setState({userInputIsEmpty:this._textInputRef.isEmpty(),hasUncommittedUserInput:this._textInputRef.hasUncommittedChanges(),equalsInitialContent:this._textInputRef.equalsInitialContent()});const e=this._getContext().componentVisibilityStatus;e&&(this._visibilitySubscriptionToken=e.isVisibleEvent().subscribe((e=>{!e&&r.default.isSupported()&&r.default.dismiss()}))),re.default.addHandler(q.KeyboardShortcut.SendFile,this._showFilePicker),re.default.addHandler(q.KeyboardShortcut.EditMessage,this._editLastMessageKeyboardShortcut),re.default.addHandler(q.KeyboardShortcut.FocusMessageComposer,this._focusKeyboardShortcut),this._keyboardDismissRegistrationHandle=U.register(this),x.default.onInputEntitiesUpdatedEvent.subscribe(this._onPartiallyEnteredMsgStoreUpdated)}_checkForOutgoingSmsMessagesInConversation(e){e.enableOnewaySms&&M.didUserSendSmsInLast30Days(this.props.conversationId).then((e=>{this.isComponentMounted()&&this.setState({hasOutgoingSmsInConversation:e})}))}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t);let s=!1,i={};this.props.conversationId&&e.conversationId&&this.props.conversationId===e.conversationId||(s=!0,i.inputEntities=this.props.initialInputEntities||[],i.inputEntitiesDataVersion=this.state.inputEntitiesDataVersion+1,i.hasOutgoingSmsInConversation=!1,i.phoneNumberForSendingSms=void 0,this._checkForOutgoingSmsMessagesInConversation(this.state));let o=[];if(e.initialInputEntities&&e.initialInputEntities!==this.props.initialInputEntities&&(s=!0,o=e.initialInputEntities),e.editedMessage&&e.editedMessage!==this.props.editedMessage){let t=D.decode(e.editedMessage);o=L.toEntities(t,{supportEmoticons:!0,supportLinkEntity:this.state.enableHandlingHyperlinkOnPaste}),s=!0,i.phoneNumberForSendingSms=void 0}this.props.editedMessage&&!e.editedMessage&&(s=!0,i.phoneNumberForSendingSms=void 0,this.state.inputEntities.length&&this.state.inputEntities[0]instanceof se.EmoteEntity&&(o=[])),s&&(this._setInputEntityStateDownstream(o),this.setState(i))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);let i=this.state.selectedMediaBarItem,o=!1;e&&e.conversationId&&this.props.conversationId&&e.conversationId===this.props.conversationId||(o=this._shouldAutoFocusInput());const n=this._hasQuotes()&&!(0,ne.default)(this.props.quotedMessages,e.quotedMessages),r=this.props.editedMessage&&!(0,ne.default)(this.props.editedMessage,e.editedMessage),a=this.state.hasMediaPreviews&&this.state.hasMediaPreviews!==t.hasMediaPreviews;if((0,ne.default)(this.props.quotedMessages,e.quotedMessages)&&(0,ne.default)(this.props.editedMessage,e.editedMessage)&&(0,ne.default)(t.inputEntities,this.state.inputEntities)||this._saveMessage(this.state.inputEntities),o=n||r||a,!e.inlineSearchModeActive&&this.props.inlineSearchModeActive&&(i=""),o&&this.requestFocus(),!t.enableOnewaySms&&this.state.enableOnewaySms&&this._checkForOutgoingSmsMessagesInConversation(this.state),this.state.userInputIsEmpty&&this.state.hasUncommittedUserInput){const e=x.default.getSavedMessageInput(this.props.conversationId);e&&e.type===We.SavedMessageType.None&&(oe.track(new z.DraftMessageDeleted(e.timestamp)),x.default.clearMessageInput(this.props.conversationId))}this.state.hasFocus&&!this.state.userInputIsEmpty&&P.default.hideCurrentCoachMark(),this.setState({selectedMediaBarItem:i}),e.conversationId!==this.props.conversationId&&this._updateAndStoreDraftInputEntitiesFromContent(ht.default.newCauseId())}componentWillUnmount(){super.componentWillUnmount(),this._appStateSubscription&&(this._appStateSubscription.unsubscribe(),this._appStateSubscription=void 0),this._dataUpdateSubscription&&(this._dataUpdateSubscription.unsubscribe(),this._dataUpdateSubscription=void 0),x.default.commit(this.props.conversationId),u.default.getS4LMessagingFeaturesNoSubscription().enableDraftMessagesPersistentStorage&&x.default.storeSavedMessage(this.props.conversationId),de.default.removeObserver(de.LifecycleEventType.ON_EXIT,this._updateAndStoreDraftInputEntitiesFromContent),this._customKeyboardDidHideListener&&(this._customKeyboardDidHideListener.remove(),this._customKeyboardDidHideListener=void 0),this._nativeKeyboardDidHideListener&&(this._nativeKeyboardDidHideListener.remove(),this._nativeKeyboardDidHideListener=void 0),this._customKeyboardSeenListener&&(this._customKeyboardSeenListener.remove(),this._customKeyboardSeenListener=void 0),this._visibilitySubscriptionToken&&(this._visibilitySubscriptionToken.unsubscribe(),this._visibilitySubscriptionToken=void 0),r.default.isSupported()&&r.default.dismiss(),this._textInputRef&&this._textInputRef.dismissKeyboard(),re.default.removeHandler(q.KeyboardShortcut.SendFile,this._showFilePicker),re.default.removeHandler(q.KeyboardShortcut.EditMessage,this._editLastMessageKeyboardShortcut),re.default.removeHandler(q.KeyboardShortcut.FocusMessageComposer,this._focusKeyboardShortcut),U.unregister(this._keyboardDismissRegistrationHandle),x.default.onInputEntitiesUpdatedEvent.unsubscribe(this._onPartiallyEnteredMsgStoreUpdated),p.default.disableTooltip(g.EngagementTooltipType.ExpressionPicker)}_overflowActions(){return{onItemSelected:this._onMediaBarItemSelected,onCustomAction:this._onHandleCustomAction,mediaBarItems:this._getOverflowItemDescriptors(),onFocus:this.requestFocus,onBlur:this.blur}}render(){return this._renderDesktopComposer()}dismissKeyboard(){this._textInputRef&&this._textInputRef.dismissKeyboard()}_getQuotedTextForSms(e,t){return t&&e!==t?i.join(t.map((e=>this._getQuoteEntity(e).textForSMS()))):""}_renderQuote(){if(this.props.hideContentInMessageComposer)return;const{enableMultiMessageQuote:e}=this.state;let t,s=this.props.quotedMessages,o=this._onClearQuoteButtonPress;if(i.isEmpty(s)&&this.props.editedMessage){const e=i.first(this.state.inputEntities);e instanceof se.QuoteEntity&&(s=[this.props.editedMessage],t=ie.decodeFromInput([e],!1,!1,!1),o=this._onClearEditMessageQuote)}if(s&&s.length>0){const i=st.default.font.uiDisplayBold,n=this.props.showTranslatedMessage||!1,r={onClearQuote:e?void 0:o,linkStyle:this._useDarkTheme()?l.Styles.combine(vt.linkStyle,this._themeStyles.linkTextColorStyle||this._themeStyles.primaryTextColorStyle):vt.linkStyle,disableActions:this.props.disableActionOnMessageComposer,quoteSymbolStyle:{size:it.IconSize.size20,color:this._themeColors.primaryTextColor},quotedTextStyle:vt.quoteTextStyle,atMentionStyle:i,atMentionMeOverrideStyle:i,showTranslatedMessage:n,hasTranslation:n,renderOrigin:G.MessageRenderOrigin.MessageComposerCanvas};if(r.textOverrideStyle=[this._themeStyles.primaryTextColorStyle],r.quoteAttributeStyle=[vt.quoteAttributeStyle,this._themeStyles.secondaryTextColorStyle],this.state.messageStreamFontSize!==Ie.MessageStreamFontSize.Normal){const e=st.default.controlFontSize.messageStreamItemDesktop,t=Me.getStyle(e,this.state.messageStreamFontSize),s=Me.getStyle(st.default.controlFontSize.messageStreamQuoteAttributeDesktop,this.state.messageStreamFontSize);r.textOverrideStyle.push(t),r.quoteAttributeStyle.push(s),r.fontSize=Me.getSize(e,this.state.messageStreamFontSize)}const a=s.length-1;let d;if(e){const e=s.map(((e,s)=>l.createElement(l.View,{style:s===a?vt.multiQuoteAreaLastMessage:vt.multiQuoteAreaMessage,key:`quote-${s}`},l.createElement(be.default,{message:e,preDecodedMessage:t,wrapInQuote:!t,options:r}))));d=l.createElement(l.View,{style:vt.multiQuoteArea},l.createElement(l.View,{style:[vt.multiQuoteAreaMessages,this._themeStyles.secondaryDividerBorderStyle]},l.createElement(l.ScrollView,{style:rt.default.flexOne},e)),l.createElement(ee.default,{key:"clearbutton",title:ce.getString("MessageComposer.RemoveQuoteButtonTitle"),style:vt.multiQuoteAreaClearButton,onPress:o,size:it.IconSize.size16,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,icon:it.SkypeIcon.Cancel,disabled:this.props.disableActionOnMessageComposer}))}else d=l.createElement(l.View,{style:[vt.quoteArea,vt.desktopOverrides.quoteArea]},l.createElement(be.default,{message:s[0],preDecodedMessage:t,wrapInQuote:!t,options:r}));return{component:d,onClearQuoteHandler:o}}}_getDoNotFormatStyle(){return this._useDarkTheme()?vt.desktopOverrides.doNotFormatDarkTheme:vt.desktopOverrides.doNotFormatLightTheme}_renderDesktopComposer(){const e=[vt.composerInner,vt.desktopOverrides.composerInner];let t;const s=[vt.skypeMessageTextInput,this._themeStyles.primaryTextColorStyle];this.state.isSmallHeightView?(t=this.props.quotedMessages?[vt.expandableAreaWithQuote,vt.desktopOverrides.expandableAreaWithQuoteSmallView]:[vt.expandableArea,vt.desktopOverrides.expandableAreaSmallView],s.push(this.props.quotedMessages?vt.desktopOverrides.expandableAreaWithQuoteSmallView:vt.desktopOverrides.expandableAreaSmallView)):(t=this.props.quotedMessages?[vt.expandableAreaWithQuote,vt.desktopOverrides.expandableAreaWithQuote]:[vt.expandableArea,vt.desktopOverrides.expandableArea],s.push(this.props.quotedMessages?vt.desktopOverrides.expandableAreaWithQuote:vt.desktopOverrides.expandableArea));const i=[rt.default.flexOne,vt.desktopOverrides.messageComposer];if(this._themeStyles.messageComposerBackgroundStyle&&i.push(this._themeStyles.messageComposerBackgroundStyle),this.state.isShowingUnifiedPesPickerDesktop?i.push(vt.desktopOverrides.messageComposerTopFlatCorners):i.push(vt.desktopOverrides.messageComposerAllRoundCorners),this.state.doNotFormat&&i.push(this._getDoNotFormatStyle()),this.state.messageStreamFontSize!==Ie.MessageStreamFontSize.Normal){const e=Me.getStyleFromStyle(s,this.state.messageStreamFontSize);s.push(e)}const n=this._renderQuote(),r=this.props.hideContentInMessageComposer?void 0:this._renderTextInput(t,s,!!n),a=this._getRightIcon()||this._getMediaBar(!0),d=[vt.rightControlContainer,vt.desktopOverrides.rightControlContainer],c=!(tt.default.getPlatformType()===o.PlatformType.OSX),h=this._getEmoticonPickerItem(),u=this._getContext().isPresentedByMobileStackNavigator?void 0:this._getRichtextEditorItem(),p=[vt.compositionArea,h?void 0:vt.desktopOverrides.compositionAreaNoPesPicker,u?void 0:vt.desktopOverrides.compositionAreaNoRichTextEditor],g=l.createElement(l.View,{style:p,importantForLayout:c},this._renderEmoteAuthor(),r),m=l.createElement(l.View,{style:i,importantForAccessibility:l.Types.ImportantForAccessibility.No,onPress:this._onCompositionAreaPress,onKeyPress:this._onCompositionAreaKeyPress,disableTouchOpacityAnimation:!0},l.createElement(l.Animated.View,{style:this._inputAreaHeightStyle},l.createElement(l.View,{style:[vt.compositionAreaContainer,vt.desktopOverrides.compositionAreaContainer],onLayout:this._onLayoutInputArea,key:"composition"},this._renderRichtextEditor(),n&&n.component,this._getMediaPreviewPanel(),l.createElement(l.View,{style:e},h,g,u))));return l.createElement(l.View,{style:vt.composerArea},l.createElement(l.View,{style:rt.default.flexOne},this._renderSmsInfoLine(),this._renderPesPicker(),m),l.createElement(l.View,{style:d},a))}_getRightIcon(){const e=it.IconSize.size20;let t;if(this._canCancelEdit(this.state,this.props.editedMessage)){const s=[vt.actionButtonWithBackground,vt.actionButtonVerticalCenter,this._themeStyles.buttonBackgroundColorStyle];return t=this._themeStyles.buttonBackgroundHoverColorStyle,l.createElement(ee.default,{title:ce.getString("MessageComposer.CancelEditButtonTitle"),ref:this._onInputButtonRef,onPress:this._onCancelEditClick,size:e,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,style:s,hoverStyle:t,icon:it.SkypeIcon.Cancel})}if(this._sendControlEnabled(this.props,this.state,this._hasQuotes())){const t=this.props.disableActionOnMessageComposer||!!this.state.phoneNumberForSendingSms&&this.state.userInputIsEmpty;return l.createElement(c.default,{title:ce.getString(this.props.editedMessage?"MessageComposer.EditButtonTitle":"MessageComposer.SendButtonTitle"),ref:this._onInputButtonRef,onPress:this._onSendButtonClick,size:c.ActionButtonSize.Small,iconSize:e,style:vt.sendButton,icon:it.SkypeIcon.Send,flipIcon:this._getContext().isRTL,disabled:t})}}_getMediaPreviewPanel(){if(this.state.isMediaPreviewEnabled)return l.createElement(fe.default,{conversationId:this.props.conversationId})}_renderPesPicker(){if(!this.state.isShowingUnifiedPesPickerDesktop)return;const e=this._isMojiCategoryEnabled()||this._isStickerCategoryEnabled()||this._isGifCategoryEnabled();return l.createElement(l.View,null,l.createElement(N.default,{showCategorySwitcher:e,availableWidth:this.props.availableWidth,pesPickerPopupRef:this._getPesPickerPopupRef,onEmoticonSelected:this._onEmoticonSelected,onMojiSelected:this._onMojiSelected,onStickerSelected:this._onStickerSelected,onGifSelected:this._onGifSelected,onClose:this._closeUnifiedPesPickerDesktop,selectedTabType:this.state.selectedTabType,searchQuery:this.state.searchQuery}),this._renderPesPickerPopup())}_renderRichtextEditor(){return this.state.richTextEditorVisible?l.createElement(pt.default,{conversationId:this.props.conversationId,textInputRef:this._textInputRef,isTopPanel:!this.state.isShowingUnifiedPesPickerDesktop}):void 0}_getTextForSms(e){return`${this.state.quoteTextForSms}${ie.getRawText(e)}`}_renderSmsInfoLine(){if(this.state.enableOnewaySms)return l.createElement($e.default,{rawTextInput:this._getTextForSms(this.state.inputEntities),conversationId:this.props.conversationId,phoneNumbers:this.state.phoneNumbers,onPhoneNumberSelected:this._onPhoneNumberForSmsSelected,selectedPhoneNumber:this.state.phoneNumberForSendingSms,creditEntitlement:this.state.creditEntitlement,ref:this._onSMSInfoLineRef,disabled:this.props.disableActionOnMessageComposer,preventAccessibilityFocus:this.props.preventAccessibilityFocus,isSmsFailureScreenEnabled:this.state.isSmsFailureScreenEnabled})}_isMojiCategoryEnabled(){return!this.props.hideMojiPickerIcon&&!this.state.phoneNumberForSendingSms}_isStickerCategoryEnabled(){return this.state.showStickerPicker&&!this.state.phoneNumberForSendingSms}_isGifCategoryEnabled(){return this.state.showGifPicker&&!this.state.phoneNumberForSendingSms}_renderEmoteAuthor(){const e=i.head(this.state.inputEntities);if(this.props.editedMessage&&e instanceof se.EmoteEntity){const t=[vt.emoteAuthor.text,vt.emoteAuthor.textDesktop,this._themeStyles.primaryTextColorStyle],s=e.fallbackText.trim();return l.createElement(l.View,null,l.createElement(l.Text,{style:t},s+"…"))}}_getDefaultPlaceholderText(){return this.state.phoneNumberForSendingSms?ce.getString("MessageComposer.SmsMessagePlaceholderText"):ce.getString("MessageComposer.MessagePlaceholderShortText")}_renderTextInput(e,t,s=!1){const i=this.state.selectedMediaBarItem===me.MediaBarItemKeys.MediaPicker||this.state.selectedMediaBarItem===me.MediaBarItemKeys.Moji||this.state.selectedMediaBarItem===me.MediaBarItemKeys.Emoticon||this.state.selectedMediaBarItem===me.MediaBarItemKeys.Gif||this.state.selectedMediaBarItem===me.MediaBarItemKeys.Sticker||this.state.selectedMediaBarItem===me.MediaBarItemKeys.Richtext?l.createElement(l.Button,{style:vt.textInputFocusButton,onPress:this._onDismissMediaPicker,importantForAccessibility:l.Types.ImportantForAccessibility.No}):void 0;this._placeholderText=s?"":this._getDefaultPlaceholderText();let o=st.default.controlFontSize.messageComposerDesktop;return this.state.messageStreamFontSize!==Ie.MessageStreamFontSize.Normal&&(o=Me.getSize(o,this.state.messageStreamFontSize)),l.createElement(l.View,{style:vt.inputArea},l.createElement(l.Animated.View,{style:[...e]},l.createElement(a.default,{ref:this._onTextInputRef,importantForAccessibility:"yes",onVisibleSelectionRect:this._onVisibleSelectionRect,accessibilityLabel:this._getDefaultPlaceholderText(),style:t,agnosticContentBackgroundColor:this._useDarkTheme()?mt:St,atMentionBackgroundColor:this._useDarkTheme()?et.Color.blueOverlay30:et.Color.blueOverlay10,linkTextColor:this._themeColors.primaryTextColor,lineHeight:Math.round(1.2*o),maxLength:this.props.maxLength&&this.props.maxLength<=25e3?this.props.maxLength:25e3,onFocus:this._onFocus,onBlur:this._onBlur,onPaste:this._onPaste,placeholder:this._placeholderText,placeholderTextColor:this._themeColors.secondaryTextColor,keyboardAppearance:this._useDarkTheme()?"dark":"default",useGraphicalEmoticons:!0,enterKeyOnExtKeyboardSendsMessage:this.state.sendMessageWithEnter,editable:void 0!==this.state.overrideEditable?this.state.overrideEditable:this.state.editable,initialContent:ve.getEditableContentFromEditableEntities(this.state.editableEntities,this.state.inputEntitiesDataVersion),customContext:this.props.conversationId,intermediateContentUpdatedEventInterval:this.state.phoneNumberForSendingSms?500:void 0,onNewContentCommitted:this._onUserInputCommitted,onNewContentAborted:this._onUserInputAborted,onEmptyIndicationChanged:this._onUserInputEmptyIndicationChanged,onUncommittedChangesIndicationChanged:this._onUserInputUncommittedChangesIndicationChanged,onEqualsInitialContentChanged:this._onEqualsInitialContentIndicationChanged,onEditLastMessageRequested:this._editLastMessage,onAccessibilityAnnouncementRequested:this._onAccessibilityAnnouncementRequested,onComposingActive:this._onUserInputActive,onComposingInactive:this._onUserInputInactive,onBackspacePressedAtHeadPosition:this._onUserInputBackspacePressedAtHeadPos,onEmoticonLoadCompleted:this._onEmoticonLoadCompleted,autoCompletionTriggers:yt,onAutoCompletionRequested:this._onAutoCompletionRequested,onAutoCompletionRequestAborted:this._onAutoCompletionRequestAborted,onAutoCompletionNavigationKey:this._onAutoCompletionNavigationKey,delayedTriggersWaitTime:this.state.delayedTriggersWaitTime,convenienceSpaceReplacingChars:",.;:?!'",disableCopyPasteMedia:this.props.disableCopyPasteMedia,enableHandlingHTMLonPaste:this.state.enableHandlingHTMLonPaste,onPastingText:this.state.enableHandlingHTMLonPaste||this.state.enableHandlingHyperlinkOnPaste?this._onPastingText:void 0,enableHandlingHyperlinkOnPaste:this.state.enableHandlingHyperlinkOnPaste,validateUrl:this._validateUrl,shouldDefaultPaste:this._shouldDefaultPaste}),i))}_getEmoticonPickerItem(){if(this.props.hideEmoticonKeyboardIcon||w.isPhoneMri(this.props.conversationId)||w.isS4BBridgeMri(this.props.conversationId))return;const e=this.state.isShowingUnifiedPesPickerDesktop,t=this._onUnifiedPesPickerDesktopPress,s={id:me.MediaBarItemKeys.Emoticon,key:"emoticonPicker",active:e,onActive:t,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,onFocus:this.requestFocus,onBlur:this.blur,onInputChange:this.autoReplaceText,onEmoticonSelected:this._onEmoticonSelected,onEmoticonBackspacePress:this._handleEmoticonBackspacePress,pesPickerPopupRef:this._getPesPickerPopupRef,preventAccessibilityFocus:this.props.preventAccessibilityFocus,colorOverride:this._themeColors.primaryTextColor,hoverColorOverride:this._themeColors.secondaryTextColor,iconStyleOverride:void 0,showCategorySwitcher:!1,disabled:this.props.disableActionOnMessageComposer,origin:ge.MediaBarItemOrigin.MessageComposer,ref:e=>{p.default.setAnchor(g.EngagementTooltipType.ExpressionPicker,e)}};return l.createElement(l.View,{style:vt.desktopOverrides.composerInnerIconWrapper},l.createElement(Q.ExpressionPickerItem,Object.assign({},s)))}_getRichtextEditorItem(){if(this.state.richTextEditorExp!==gt.RichtextEditorExperience.Panel||w.isPhoneMri(this.props.conversationId)||w.isS4BBridgeMri(this.props.conversationId))return;const e=this.state.selectedMediaBarItem===me.MediaBarItemKeys.Richtext,t=this._onEditorActive,s={id:me.MediaBarItemKeys.Richtext,key:"richtextPicker",active:e,onActive:t,onFocus:this.requestFocus,onBlur:this.blur,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,origin:ge.MediaBarItemOrigin.MessageComposer};return l.createElement(l.View,{style:vt.desktopOverrides.composerInnerIconWrapper},l.createElement(nt.RichtextEditorItem,Object.assign({},s)))}_hasQuotes(){return!i.isEmpty(this.props.quotedMessages)}_mediaBarItemDescriptor(e){switch(e){case me.MediaBarItemKeys.Emoticon:const t={onEmoticonSelected:this._onEmoticonSelected,pesPickerPopupRef:this._getPesPickerPopupRef,showCategorySwitcher:!1};return{id:e,render:this._renderEmoticonPickerItem,propOverrides:t};case me.MediaBarItemKeys.Moji:const s={onMojiSelected:this._onMojiSelected,showCategorySwitcher:!1};return{id:e,render:this._renderMojiPickerItem,getVirtualKeyboard:ke.MojiPickerItem.getVirtualKeyboard,propOverrides:s};case me.MediaBarItemKeys.Gif:const i={onGifSelected:this._onGifSelected,showCategorySwitcher:!1};return{id:e,render:this._renderGifPickerItem,propOverrides:i};case me.MediaBarItemKeys.Sticker:const o={onStickerSelected:this._onStickerSelected,showCategorySwitcher:!1};return{id:e,render:this._renderStickerPickerItem,propOverrides:o};case me.MediaBarItemKeys.Sms:return{id:e,render:this._renderSmsItem};case me.MediaBarItemKeys.MediaPicker:return{id:e,render:this._renderMediaPickerItem,disabled:this.state.disableHighBandwidthOperations};case me.MediaBarItemKeys.FilePicker:return{id:e,render:this._renderFilePickerItem,disabled:this.state.disableHighBandwidthOperations};case me.MediaBarItemKeys.Camera:return{id:e,render:this._renderCameraItem,disabled:this.state.disableHighBandwidthOperations};case me.MediaBarItemKeys.ScheduleCall:return{id:e,render:this._renderScheduleCallItem};case me.MediaBarItemKeys.Poll:return{id:e,render:this._renderPollItem};case me.MediaBarItemKeys.Location:return{id:e,render:this._renderLocationPickerItem,disabled:this.state.disableHighBandwidthOperations};case me.MediaBarItemKeys.Contact:return{id:e,render:this._renderContactPickerItem};case me.MediaBarItemKeys.Bing:const n={onBlur:this._onBlur};return{id:e,render:this._renderBingSearchItem,propOverrides:n};case me.MediaBarItemKeys.VideoMessage:return{id:e,render:this._renderVideoMessageItem,disabled:this.state.disableHighBandwidthOperations};case me.MediaBarItemKeys.People:return{id:e,render:this._renderPeopleItem};case me.MediaBarItemKeys.Audio:const r={onPress:this.props.onRecording};return{id:e,render:this._renderAudioMessageItem,propOverrides:r};case me.MediaBarItemKeys.SendCredit:return{id:e,render:this._renderSendCreditItem,getVirtualKeyboard:qe.SendCreditItem.getVirtualKeyboard}}oe.warn(q.LogTraceArea.MessageComposer,"No media bar descriptor for "+e)}_canShowSmsIcon(){return!1}_canShowEmoticonIcon(){return!this.props.hideEmoticonKeyboardIcon}_getItemDescriptors(e,t=!1){const s=t&&this.state.disableHighBandwidthOperations,o=i.map(e,(e=>{switch(e){case me.MediaBarItemKeys.Bing:return this._mediaBarItemDescriptor(e);case me.MediaBarItemKeys.Camera:if(!this.props.hideMediaPickerIcon&&this.state.isCameraAvailable)return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.Sms:if(this._canShowSmsIcon())return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.Emoticon:if(this._canShowEmoticonIcon())return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.Location:if(this.state.showLocationPicker&&!s&&t)return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.Contact:if(this.state.showContactPicker)return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.MediaPicker:if(!this.props.hideMediaPickerIcon&&!s&&t)return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.FilePicker:if(!this.props.hideFilePicker&&!s)return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.Moji:if(this._isMojiCategoryEnabled()&&!t)return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.Sticker:if(this._isStickerCategoryEnabled()&&(!t||!this.props.hideStickerPickerIcon))return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.Gif:if(this._isGifCategoryEnabled())return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.ScheduleCall:if(!this.props.hideScheduleCallIcon&&!s&&!this.state.isRegularMemberInModeratedGroup)return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.Poll:if(!this.props.hidePollIcon&&this.state.enablePollExtensionEntryPoint)return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.People:return this._mediaBarItemDescriptor(e);case me.MediaBarItemKeys.VideoMessage:if(this.state.showVideoMessageIcon&&!s)return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.Audio:if(this._canShowMicButton(this.props,this.state))return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.SendCredit:if(!this.props.hideSendCreditIcon&&!s)return this._mediaBarItemDescriptor(e)}}));return i.compact(o)}_canShowMicButton(e,t){return!(e.hideAudioMessage||!e.onRecording||t.phoneNumberForSendingSms||this._isPresentedInSidebar()||t.disableHighBandwidthOperations)}_getOverflowItemDescriptors(){let e=i.map(this.state.mediaBarMenuOrder,(e=>e));const t=this._getItemDescriptors(i.flatten(e),!0);return i.slice(t,this.state.currentNumberOfIconsInMediaBar)}_getMediaBarItemDescriptors(){if(this.props.hideMediaBar||this._isMediabarDisabled())return[];const e=this._getItemDescriptors(this.state.mediaBarMenuOrder,!0);return i.slice(e,0,this.state.currentNumberOfIconsInMediaBar)}_getMediaBar(e=!0){if(this._getRightIcon()||this.state.isShowingUnifiedPesPickerDesktop)return;const t=this._getMediaBarItemDescriptors();let s;if(this.state.isEncryptedThreadThread||(s=l.createElement(E.default,{overflowConfig:this.getDesktopOverflowConfig(),otherPartyMri:this.props.otherPartyMri,conversationId:this.props.conversationId,onOverflowButtonPress:this._onComposerOverflowPress})),t.length>0){const i=!1;return l.createElement(l.View,{style:vt.mediaBarWrapper},l.createElement(ue.MediaBar,{ref:this._onMediaBarRef,activeId:this.state.selectedMediaBarItem,itemDescriptors:t,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,isMobileInterface:!1,showIcons:e,onInputChange:this.autoReplaceText,onItemSelected:this._onMediaBarItemSelected,onFocus:this.requestFocus,onBlur:this.blur,onCustomKeyboardClose:this._onCustomKeyboardClose,onBackspace:this._handleEmoticonBackspacePress,onCustomAction:this._onHandleCustomAction,preventAccessibilityFocus:this.props.preventAccessibilityFocus,onMessageSent:this.props.onMessageSent,onCloseSearch:this._onCancelPesSearch,clearEditInChatsComposer:this.props.onClearEdit,autoFocusFirstItem:i,disableActionOnMediaBar:this.props.disableActionOnMessageComposer,focusCustomKeyboardWhenShown:!0,announceForAccessibilityForMessageSent:this._announceForAccessibilityForMessageSent,customKeyboardHeight:this.state.pesPickerKeyboardHeight}),s)}}_animateInputAreaToTargetHeight(){this._inputAreaAnimation||this._inputAreaTargetHeight===this._inputAreaHeight||(this._inputAreaHeight=this._inputAreaTargetHeight,this._inputAreaAnimation=Ze.default.easeOut({value:this._inputAreaHeightValue,toValue:this._inputAreaTargetHeight}),this._inputAreaAnimation.start((()=>{this._inputAreaAnimation=void 0,this.isComponentMounted()?this._animateInputAreaToTargetHeight():P.default.updateAnchor(k.CoachMarkType.ExpressionPicker)})))}_toggleSmsSending(e,t){this._onPhoneNumberForSmsSelected(t),this.isComponentMounted()&&this.setState({smsToggledOn:e})}_sendControlEnabled(e,t,s){return e.showSendControlWhenEmpty||!t.userInputIsEmpty||s||!!t.phoneNumberForSendingSms||t.hasMediaPreviews}_canCancelEdit(e,t){return!!t&&(!e.hasUncommittedUserInput||e.userInputIsEmpty||e.equalsInitialContent)}replaceText(e,t,s,i){if(this.requestFocus(),this._pendingMessageTextCompletionPromise){const e=ve.getEditableEntityFromInputEntityAndConsiderAlternatives(i,this.state.emoticons);this._pendingMessageTextCompletionPromise.resolve(e),this._pendingMessageTextCompletionPromise=void 0}this._cancelAutoCompletionIfActive()}abortTextAutoCompletion(){this._cancelAutoCompletionIfActive()}_wasRegexTriggered(e){return i.includes(yt.instantTriggers,e)||i.includes(yt.delayedTriggers,e)}_cancelAutoCompletionIfActive(){this._pendingMessageTextCompletionPromise&&(this._pendingMessageTextCompletionPromise.reject(),this._pendingMessageTextCompletionPromise=void 0),this.props.onInputTextChanged&&this.props.onInputTextChanged("",!0)}_setInputEntityStateUpstream(e){const t=ve.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives(e,this.state.emoticons);this.isComponentMounted()&&this.setState({inputEntities:e,editableEntities:t})}_setInputEntityStateDownstream(e,t){const s=this.state.inputEntitiesDataVersion+1,i=ve.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives(e,this.state.emoticons);this._textInputRef&&this._textInputRef.setContent(ve.getEditableContentFromEditableEntities(i,s)),this.isComponentMounted()&&this.setState({inputEntities:e,inputEntitiesDataVersion:s,editableEntities:i},t)}_sendFileWithDimensions(e){let t=lt.default.getFileUrl(e);n.default.getImageSize(t).then((t=>{if(t&&(e.dimensions=t),this.state.isMediaPreviewEnabled)return ye.default.addPreviews([e],this.props.conversationId,q.PostSource.MessageComposer);const s={name:je.ScenarioName.SendPicture};Ue.default.postUpload([this.props.conversationId],e,q.PostSource.MessageComposer,!1,{scenarioInfo:s},this._getRootViewType())}))}_preventSendingSMSMessage(e){return!(!(1===e.length&&e[0]instanceof se.SmsEntity&&this._smsInfoLineRef)||this._smsInfoLineRef.canSendSMS())&&(this.state.isSmsFailureScreenEnabled?Re.default.navigateToSmsFailurePrompt(this.props.conversationId,this.state.phoneNumberForSendingSms?this.state.phoneNumberForSendingSms.number:"",!1):y.default.open(this._getRootViewId()),!0)}_sendMessage(e){if(oe.log(q.LogTraceArea.MessageComposer,"sendMessage isPostingMessage: "+this._isPostingMessage),this._isPostingMessage)return;this._isPostingMessage=!0;const t=ht.default.newCauseId();oe.log(q.LogTraceArea.MessageComposer,"sendMessage causeId: "+t);let s=[],i=0;if(this.props.quotedMessages&&(s=s.concat(this.props.quotedMessages.map(this._getQuoteEntity)),i=s.length),e.length>0&&(s=s.concat(e)),this.state.enableOnewaySms&&this.state.phoneNumberForSendingSms&&!this.state.userInputIsEmpty&&(s=[new se.SmsEntity(this._getTextForSms(e),this.state.phoneNumberForSendingSms.number)],this._preventSendingSMSMessage(s)))return oe.log(q.LogTraceArea.MessageComposer,"sendMessage Message prevented from being send."),void(this._isPostingMessage=!1);ye.default.sendPreviews(this.props.conversationId,t).then((()=>{i>1?d.all(s.map((e=>this._sendTextMessagePromise([e])))).finally((()=>{this._isPostingMessage=!1})):this._sendTextMessagePromise(s).finally((()=>{this._isPostingMessage=!1}))})).finally((()=>{this._isPostingMessage=!1,this.state.hasFocus||this.requestFocus()}))}_sendTextMessagePromise(e){const t={conversationId:this.props.conversationId,editedMessage:this.props.editedMessage,inputEntities:e,onMessageSent:this.props.onMessageSent,phoneNumberForSendingSms:this.state.phoneNumberForSendingSms,smsInfoLineRef:this._smsInfoLineRef,textInputRef:this._textInputRef,enableHandlingHTMLonPaste:this.state.enableHandlingHTMLonPaste,enableHandlingHyperlinkOnPaste:this.state.enableHandlingHyperlinkOnPaste,messageComposerPastedContentType:this.state.messageComposerPastedContentType};return bt._sendTextMessage(t).then((e=>{if(e){if(this._handleAfterPostMessage(t.conversationId),oe.log(q.LogTraceArea.MessageComposer,"sendMessage Message sent."),t.smsInfoLineRef){const e=t.smsInfoLineRef.getTelemetryEvent();e&&(this.state.phoneNumberForSendingSms?e.setSmsWasSent(!0):e.setSkypeMessageSent(!0))}}else oe.log(q.LogTraceArea.MessageComposer,"sendMessage Message not sent.")}))}static _sendTextMessage(e){if(i.every(e.inputEntities,(e=>e instanceof se.UnhandledEntity&&!i.trim(e.text()))))return e.inputEntities.length?oe.log(q.LogTraceArea.MessageComposer,"sendMessage User pressed enter with only whitespace message content."):oe.log(q.LogTraceArea.MessageComposer,"sendMessage User pressed enter without entering any message content."),d.Resolved(!1);if(e.onMessageSent(e.inputEntities,e.enableHandlingHTMLonPaste||e.enableHandlingHyperlinkOnPaste?Ce.convertPastedTextTypeToTelemetry(e.messageComposerPastedContentType):we.MessageComposerAction.NoPaste)){const t=e.editedMessage?ce.getString("MessageComposer.MessageEditedLabel"):ce.getString("MessageComposer.MessageSentLabel");bt._announceForAccessibility(t);const s=x.default.getSavedMessageInput(e.conversationId);if(s){const t=e.textInputRef&&!e.textInputRef.equalsInitialContent()||!1;oe.track(new z.DraftMessageWasSent(t,s.timestamp))}return d.Resolved(!0)}return d.Resolved(!1)}static _announceForAccessibility(e){Ke.default.maybeAnnounceForAccessibility(e,0)}_handleAfterPostMessage(e){if(x.default.getSavedMessageInput(e)&&(0,O.default)().fakeConversationTime(e,Date.now()),x.default.clearMessageInput(e),this.props.conversationId===e){this.state.hasFocus||this.requestFocus(),this.setTextInputAccessibilityFocus(),this._setInputEntityStateDownstream([]),this._cancelAutoCompletionIfActive(),this.isComponentMounted()&&this.setState({selectedMediaBarItem:""}),this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(),this.props.onClearEdit&&this.props.onClearEdit();const e=this._getRootViewId();pe.MediaBarItem.dismissPopup(e),V.default.close(e)}this._isPostingMessage=!1}_shouldAutoFocusInput(){return!(this.state.isSmallOrTinyScreen&&this._getRootViewId()===A.MainRootViewId)}_isMediabarDisabled(){return w.isS4BBridgeMri(this.props.conversationId)||!!this.state.phoneNumberForSendingSms||!!this.state.isConversationWithPhoneNumber}_isPresentedInSidebar(){return this._getContext().isPresentedInDesktopLeftNav||this._getContext().isPresentedInDesktopRightNav}isFocused(){return this.state.hasFocus}blurIfFocused(){this.state.hasFocus&&this.blur()}getInputEntities(){return this._textInputRef?this._textInputRef.getContent().then((e=>this._consumeNewUserInput(e)||this.state.inputEntities)):d.Resolved(this.state.inputEntities)}getDesktopOverflowConfig(){return this._overflowActions()}}t.default=bt},9413:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageTextCompletion=void 0;const i=s(96486),o=s(16778),n=s(34339),r=s(71830),a=s(39549),l=s(52262),d=s(82433),c=s(10117),h=s(97174),u=s(15877),p=s(33754),g=s(53743),m=s(18078),S=s(8420),f=s(4057),y=s(81760),_=s(11010),v=s(11828),C=s(82481),b=s(19675),T=s(24576),M=s(2301),I=s(67977),w=_.default.fontSize.size13Deprecated,P=v.IconSize.size20,k=I.UserIconSize.Size24,A=(0,u.lazyProperties)({textCompletionMenuItem:()=>o.Styles.createTextStyle({fontSize:w,font:_.default.font.uiDisplayRegular}),textCompletionMenuItemSelected:()=>o.Styles.createTextStyle({color:y.Color.blue}),atMentionMenu:()=>(0,u.lazyProperties)({container:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),iconContainer:()=>o.Styles.createViewStyle({flexDirection:"row",marginRight:8}),name:()=>o.Styles.createTextStyle({fontSize:w,font:_.default.font.uiDisplayRegular}),nameDimmed:()=>o.Styles.createTextStyle({fontSize:w,font:_.default.font.uiDisplayRegular}),nameSelected:()=>o.Styles.createTextStyle({color:y.Color.blue}),nameDimmedSelected:()=>o.Styles.createTextStyle({color:y.Color.blueOverlay70}),allIcon:()=>o.Styles.createViewStyle({marginRight:8,padding:2})}),slashCommandMenu:()=>(0,u.lazyProperties)({container:()=>o.Styles.createTextStyle({alignItems:"center"}),commandName:()=>o.Styles.createTextStyle({fontSize:w,font:_.default.font.uiDisplayBold}),usageHint:()=>o.Styles.createTextStyle({fontSize:_.default.fontSize.size13Deprecated,font:_.default.font.uiDisplayRegular}),textSelected:()=>o.Styles.createTextStyle({color:y.Color.blue}),descriptionSelected:()=>o.Styles.createTextStyle({color:y.Color.blueOverlay70})}),emoticonMenuItem:()=>(0,u.lazyProperties)({container:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),emoticonContainer:()=>o.Styles.createViewStyle({flexDirection:"row",marginRight:8})})});class E extends T.default{constructor(){super(...arguments),this._preventDoubleTextReplacement=!1,this._onEntityDeectors=()=>this._entityDetectors,this._onReplaceText=(e,t,s,i)=>{this._preventDoubleTextReplacement||(this.props.onReplaceText(e,t,s,i),this._preventDoubleTextReplacement=!0)},this._onTextCompletionRef=e=>{this._textCompletion=e||void 0}}_buildState(e,t){let s={};const i=(0,a.default)().getConversation(e.conversationId);s.userAtMentionInfo=this._buildAtMentionInfo(i),this._entityDetectors=this._getEntityDetectors(i);const o=this.props,n=t||o.conversationId!==e.conversationId;return(n||o.showSlashCommands!==e.showSlashCommands)&&e.showSlashCommands&&n&&(s.slashCommands=S.getVisibleCommands(e.conversationId)),t&&(s.inputText=""),s}setInputText(e,t){this.setState({inputText:e,forceHide:t}),this._preventDoubleTextReplacement=!1}render(){const e=this.state.forceHide?"":this.state.inputText;return o.createElement(C.TextCompletion,{ref:this._onTextCompletionRef,style:this.props.style,entityDetectors:this._onEntityDeectors,inputText:e,onReplaceText:this._onReplaceText,onTextReplacementCandidatesShown:this.props.onTextReplacementCandidatesShown,candidatesToDisplay:8,maxMenuHeight:this.props.maxMenuHeight,leftOffset:this.props.leftOffset})}_buildAtMentionInfo(e){let t={};if(!e||!e.isThread()&&!r.isSkypeIdMri(e.id)||e.isEncryptedThread())return t;let s={},o=e?i.map(e.getThreadMembers(),(e=>e.id)):[];if(r.isSkypeIdMri(e.id)){const t=e.getOtherPartyMri();t&&(o=[t])}return i.each(o,(e=>{if(m.default.isMyMri(e))return;const i=l.default.getDisplayableProfile(e);if(!t[e]){const o=i.getDisplayName(void 0,!0),n=i.getShortName(!0),a=n?f.default.deburrLowerCase(n):void 0;t[e]={shortName:n,shortNameNormalized:a,displayName:o,displayNameNormalized:o?f.default.deburrLowerCase(o):void 0,sharesShortName:!1,isAgent:r.isAgent(e)},n&&a&&(s[a]?(t[s[a]].sharesShortName=!0,t[e].sharesShortName=!0):s[a]=e)}})),t}_escapeForRegExp(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}_getEntityDetectors(e){const t="(("+this._escapeForRegExp(i.values(d.default.getEmoticonFirstLetterMap()).join(" ")).split(" ").join("|")+")"+d.default.getValidEmoticonCharactersPattern()+"{2,})$",s=[{entityType:"@Mention",match:/\B@([^@?!\n[\]{}|\/<>]*)$/i,search:(e,t,s)=>{let i=e.toLowerCase(),o=this._getCandidatesForAtMention(e,!1,1,!1);const n=(0,a.default)().getConversation(this.props.conversationId);if(n&&!n.isOneOnOne()){let t=p.getString("MessageComposer.QouteAll");0===t.indexOf(i)&&o.splice(0,0,{entity:new h.AtMentionEntity(t,"*"),charsToReplace:e.length+1,replacementText:t,priority:1})}return o},render:(e,t)=>this._renderAtMentionMenuItem(e.entity,t),createAccessibilityLabel:(e,t,s)=>this._createSuggestionItemAccessibilityLabel("MessageComposer.MentionSuggestion",e.entity?e.entity.text():"",t,s),maxPopupWidth:250},{entityType:"@Mention",match:/([^?!\n[\]{}|\/<>]{3,})$/i,search:(e,t,s)=>this._getCandidatesForAtMention(e,t,0,!0),render:(e,t)=>this._renderAtMentionMenuItem(e.entity,t),createAccessibilityLabel:(e,t,s)=>this._createSuggestionItemAccessibilityLabel("MessageComposer.MentionSuggestion",e.entity?e.entity.text():"",t,s),maxPopupWidth:250},{entityType:"SlashCommand",match:/^\/(\w*)$/i,search:(e,t,s)=>{let o=[];if(this.props.showSlashCommands){let t=i.filter(this.state.slashCommands,(t=>0===t.command.indexOf(e)));i.each(t,(t=>{let s=new h.CommandEntity("/"+t.command+" ",t.command,t.usageHint||"",t.description);o.push({entity:s,charsToReplace:e.length+1,replacementText:"/"+t.command+" "})}))}return o},render:(e,t)=>this._renderSlashCommandMenuItem(e.entity,t),createAccessibilityLabel:(e,t,s)=>this._createSuggestionItemAccessibilityLabel("MessageComposer.CommandSuggestion",e.entity?e.entity.text():"",t,s),maxPopupWidth:400},{entityType:"Emoticon",match:new RegExp(t,"i"),search:(e,t,s)=>(0,g.GetEmoticonSuggestions)(e,t,s),render:(e,t)=>this._renderEmoticonMenuItem(e.entity,t),createAccessibilityLabel:(e,t,s)=>this._createSuggestionItemAccessibilityLabel("MessageComposer.EmoticonSuggestion",e.entity?e.entity.text():"",t,s),maxPopupWidth:170}];return e&&i.find(e.getThreadMembers(),(e=>"28:dd02eb70-197a-4dbc-8591-e4e88a5093a0"===e.id))&&s.push({entityType:"@Mention",match:/(zo)$/i,search:(e,t,s)=>this._getCandidatesForAtMention(e,t,0,!0,2),render:(e,t)=>this._renderAtMentionMenuItem(e.entity,t),createAccessibilityLabel:(e,t,s)=>this._createSuggestionItemAccessibilityLabel("MessageComposer.MentionSuggestion",e.entity?e.entity.text():"",t,s),maxPopupWidth:250}),s}_getCandidatesForAtMention(e,t,s,o,n=3){let r=[],a=f.default.deburr(e),l=[];if(o){let e=a.split(" "),s=1,i=t?0:1;for(let t=e.length-1;t>=i&&s<=4;t--){let i=e.slice(t,t+s).join(" "),o=i.toLowerCase();i.length>=n&&i[0]!==o[0]&&l.push(o),s++}}else l.push(a.toLowerCase());return l.length>0&&i.each(this.state.userAtMentionInfo,((e,t)=>{i.each(l,(o=>{const n=e.shortNameNormalized&&e.shortNameNormalized.length>=o.length&&e.shortNameNormalized.substr(0,o.length)===o,a=e.displayNameNormalized&&e.displayNameNormalized.length>=o.length&&e.displayNameNormalized.substr(0,o.length)===o;if(n||a){let l=e.shortName;(!n||e.sharesShortName||e.isAgent)&&(l=e.displayName);let d={entity:new h.AtMentionEntity(l,t,e.shortName,e.displayName),charsToReplace:o.length+s,replacementText:l,uniqueKey:t,priority:n||e.sharesShortName&&a?2:3},c=i.findIndex(r,(e=>e.uniqueKey===t));if(c>=0){const e=r[c].priority||0;d.priority<e&&r.splice(c,1,d)}else r.push(d)}}))})),r}_renderAtMentionMenuItem(e,t){const s=e.text();let n,a;if(s===e.shortName&&i.startsWith(e.displayName,s)){const i=[A.atMentionMenu.nameDimmed,this._themeStyles.secondaryTextColorStyle];t&&i.push(A.atMentionMenu.nameDimmedSelected),n=o.createElement(o.Text,{style:i,numberOfLines:1},e.displayName.substr(s.length))}e.userMri&&(a="*"===e.userMri?o.createElement(c.default,{icon:v.SkypeIcon.ContactGroup,size:P,color:t?y.Color.blue:y.Color.gray300,style:A.atMentionMenu.allIcon}):o.createElement(o.View,{style:A.atMentionMenu.iconContainer},o.createElement(M.UserIcon,{userMri:r.sanitizeMri(e.userMri,r.Namespaces.SkypeId),size:k})));const l=[A.atMentionMenu.name,this._themeStyles.primaryTextColorStyle];return t&&l.push(A.atMentionMenu.nameSelected),o.createElement(o.View,{style:A.atMentionMenu.container},a,o.createElement(o.Text,{style:l,numberOfLines:1},s),n)}_renderSlashCommandMenuItem(e,t){let s;const i=[A.slashCommandMenu.commandName,this._themeStyles.primaryTextColorStyle],n=[A.slashCommandMenu.usageHint,this._themeStyles.primaryTextColorStyle];let r=t?A.slashCommandMenu.textSelected:void 0;if(r&&(i.push(r),n.push(r)),e.description){const i=[this._themeStyles.tertiaryTextColorStyle];let n=t?A.slashCommandMenu.descriptionSelected:void 0;n&&i.push(n),s=o.createElement(b.Caption,{style:i,numberOfLines:1},e.description)}return o.createElement(o.View,null,o.createElement(o.Text,{style:A.slashCommandMenu.container,numberOfLines:1},o.createElement(o.Text,{style:i,numberOfLines:1},e.commandName),o.createElement(o.Text,{style:n,numberOfLines:1}," "+e.usageHint)),s)}_renderEmoticonMenuItem(e,t){const s=[A.textCompletionMenuItem,this._themeStyles.primaryTextColorStyle];return t&&s.push(A.textCompletionMenuItemSelected),o.createElement(o.View,{style:A.emoticonMenuItem.container},o.createElement(o.View,{style:A.emoticonMenuItem.emoticonContainer},o.createElement(n.AnimatedEmoticon,{innerText:e.text(),emoticonName:e.emoticonName,size:n.Size.Small,isStatic:!1,tone:e.tone})),o.createElement(o.Text,{style:s,numberOfLines:1},"  "+e.text()))}_createSuggestionItemAccessibilityLabel(e,t,s,i){return p.getString(e,{name:t,itemIndex:s,itemsCount:i})}handleKeyDown(e){return!!this._textCompletion&&this._textCompletion.handleKeyDown(e)}}t.MessageTextCompletion=E,t.default=E},10756:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PesInlineSearchContainer=void 0;const i=s(96486),o=s(16778),n=s(4736),r=s(43106),a=s(15877),l=s(33754),d=s(40897),c=s(26424),h=s(79096),u=s(60621),p=s(2295),g=s(58962),m=s(81760),S=s(11010),f=s(11828),y=s(24576),_=f.IconSize.default,v=_-4,C=(0,a.lazyProperties)({searchTextInput:()=>o.Styles.createTextInputStyle({flex:1,borderWidth:0,fontSize:S.default.controlFontSize.messageComposerMobile,font:S.default.font.uiDisplayRegular,backgroundColor:m.Color.transparent,minHeight:25}),container:()=>o.Styles.createViewStyle({flex:0,paddingVertical:5}),cancelButton:()=>o.Styles.createViewStyle({height:_,width:_}),textInputContainer:()=>o.Styles.createViewStyle({flexDirection:"row"}),innerWrapper:()=>o.Styles.createViewStyle({flex:1,flexDirection:"row",borderRadius:v/2,minHeight:v,alignItems:"center",marginBottom:2,marginHorizontal:3,overflow:"visible",paddingLeft:15})});class b extends y.default{constructor(){super(...arguments),this._switchPesSearchTabType=e=>{d.default.setInlineSearchType(e)},this._onClearSearchPress=()=>{d.default.deactivateInlineSearch(),u.MojiPreviewService.closePesPreview(),u.GifPreviewService.closePesPreview(),r.default.setSearchParams("")},this._insertSearchResult=(e,t,s,i)=>{this.props.insertSearchResultToComposer(t,s,i)},this._onSearchInputRef=e=>{this._searchInputRef=e||void 0},this._onSearchResultsRef=e=>{this._searchResults=e||void 0},this._onInputTextChange=e=>{this.isComponentMounted()&&(""===e?(u.MojiPreviewService.closePesPreview(),u.GifPreviewService.closePesPreview()):this.props.pesTabType===g.TabType.Gif&&e.length<c.GifMinSearchChars&&this.state.lastInputText&&this.state.lastInputText.length>e.length&&u.GifPreviewService.closePesPreview(),this.setState({lastInputText:e})),this._searchResults&&(this.props.pesTabType===g.TabType.Gif?this._debounceGifSearchResultsInput(e):this._debounceSearchResultsInput(e))},this._debounceSearchResultsInput=i.debounce((e=>{this._setSearchResultInput(e)}),100),this._debounceGifSearchResultsInput=i.debounce((e=>{this._setSearchResultInput(e)}),c.GifSearchDebounceMs)}_buildState(e,t){if(t){return{lastInputText:d.default.getInitialSearch()||""}}return{}}componentDidMount(){super.componentDidMount(),i.defer((()=>{this._searchInputRef&&this._searchInputRef.requestFocus()}))}componentWillUnmount(){super.componentWillUnmount(),d.default.deactivateInlineSearch()}render(){const e=this._getPesSearchResultsCarousal(),t=[C.searchTextInput,this._themeStyles.primaryTextColorStyle],s=[C.innerWrapper,this._themeStyles.buttonBackgroundColorStyle],i=this._getOptionalPlaceHolder(),n=o.createElement(o.TextInput,{style:t,accessibilityTraits:[o.Types.AccessibilityTrait.Search],accessibilityLabel:i,ref:this._onSearchInputRef,value:this.state.lastInputText,onChangeText:this._onInputTextChange,returnKeyType:"search",placeholder:i,placeholderTextColor:this._themeColors.secondaryTextColor,disableFullscreenUI:!0,editable:!0,allowFontScaling:!1,keyboardAppearance:this._useDarkTheme()?"dark":void 0,autoFocus:!0,clearButtonMode:"never",blurOnSubmit:!0}),r=this._getCancelSearchButton(),a=this._getOptionalCategorySwitcher();return o.createElement(o.View,{style:C.container},e,o.createElement(o.View,{style:C.textInputContainer},r,o.createElement(o.View,{style:s},n)),a)}_getPesSearchResultsCarousal(){return o.createElement(p.default,{ref:this._onSearchResultsRef,conversationId:this.props.conversationId,onReplaceText:this._insertSearchResult,containerWidth:this.props.containerWidth})}_getCancelSearchButton(){return o.createElement(n.default,{size:n.ActionButtonSize.Tiny,title:l.getString("MessageComposerOverflow.CloseSearch"),accessibilityLabel:l.getString("MessageComposerOverflow.CloseSearch"),onPress:this._onClearSearchPress,style:C.cancelButton,icon:f.SkypeIcon.Cancel,hideBorder:!0,useSmallIcon:!1,deselected:!0})}_getOptionalCategorySwitcher(){if(this.props.showPesCategorySwitcher)return o.createElement(h.default,{currentTabType:this.props.pesTabType||g.TabType.Emoticon,onSwitchPesTabType:this._switchPesSearchTabType,showInLandscape:this.props.showInLandscape})}_setSearchResultInput(e){this._searchResults&&this._searchResults.setInputText(e)}_getOptionalPlaceHolder(){switch(this.props.pesTabType){case g.TabType.ChatSticker:return l.getString("MessageComposer.SearchStickersPlaceholder");case g.TabType.Moji:return l.getString("MessageComposer.SearchMojisPlaceholder");case g.TabType.Emoticon:return l.getString("MessageComposer.SearchEmoticonsPlaceholder");case g.TabType.Gif:return l.getString("MessageComposer.SearchGifsPlaceholder");case void 0:return}}}t.PesInlineSearchContainer=b},15521:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GifInlineSearchPreview=t.EmoticonInlineSearchPreview=t.MojiInlineSearchPreview=t.StickerInlineSearchPreview=void 0;const i=s(96486),o=s(16778),n=s(34339),r=s(89391),a=s(51077),l=s(46096),d=s(23790),c=s(97174),h=s(15877),u=s(40897),p=s(31298),g=s(83294),m=s(58962),S=s(85207),f=s(31847),y=s(11828),_=s(24576),v=(0,h.lazyProperties)({suggestionButton:()=>o.Styles.createButtonStyle({height:y.IconSize.size60,width:y.IconSize.size60,borderRadius:10,alignItems:"center",marginHorizontal:5}),gifPreviewButton:()=>o.Styles.createViewStyle({marginHorizontal:3,padding:0})});class C extends _.default{_buildState(e,t){}_getButtonStyle(){return v.suggestionButton}render(){return o.createElement(o.Button,{style:[this._getButtonStyle(),this._themeStyles.buttonBackgroundColorStyle],onPress:this.onPress},this.renderPreview())}}t.StickerInlineSearchPreview=class extends C{constructor(){super(...arguments),this._abstractSearchType=m.TabType.ChatSticker,this.onPress=()=>{const e=new c.StickerEntity(this.props.entity.id,this.props.entity.baseUrl,this.props.entity.baseUrl,this.props.entity.name);S.default.postMessageFromInput(this.props.conversationId,l.PostSource.StickerSearch,[e],a.MessageTypes.RichText),u.default.deactivateInlineSearch(),this.props.onPressPreview&&this.props.onPressPreview(this.props.entity.id,!0,1)}}renderPreview(){return o.createElement(f.default,{key:this.props.entity.id,src:this.props.entity.baseUrl,etag:this.props.entity.etag,showPlaceholder:!0,dimension:m.frameHeights.stickers.Size50,name:this.props.entity.name})}};t.MojiInlineSearchPreview=class extends C{constructor(){super(...arguments),this._abstractSearchType=m.TabType.Moji,this.onPress=()=>{const e=r.default.getConfigSettings().pes,t=e.xmmFallbackUrl+e.xmmFallbackUrlParams+this.props.entity.id,s=new c.MojiEntity(this.props.entity.id,this.props.entity.baseUrl,this.props.entity.baseUrl+"/views/thumbnail","Video.1/Flik.1",t,"","Moji",this.props.entity.description||"");S.default.postMessageFromInput(this.props.conversationId,l.PostSource.MojiSearch,[s],a.MessageTypes.Media_FlikMsg),u.default.deactivateInlineSearch(),this.props.onPressPreview&&this.props.onPressPreview(this.props.entity.id,!0,1)}}renderPreview(){return o.createElement(p.MojiItem,{key:this.props.entity.id,id:this.props.entity.id,info:this.props.entity,isSelected:!1,renderMobileInterface:!0,onSelected:this.onPress,dimension:60,showPlaceholder:!0,showMojiPreviewAsFullScreenModal:!1,hideTitle:!0,sendOnFirstTapIfScreenReaderActive:!0})}};t.EmoticonInlineSearchPreview=class extends C{constructor(){super(...arguments),this._abstractSearchType=m.TabType.Emoticon,this.onPress=()=>{const e=i.head(this.props.entity.shortcuts),t=new c.EmoticonEntity(e,this.props.entity.id,this.props.entity.tone);this.props.onReplaceText(0,i.head(this.props.entity.shortcuts),"Emoticon",t),this.props.onPressPreview&&this.props.onPressPreview(this.props.entity.id,!1,1)}}renderPreview(){return o.createElement(n.AnimatedEmoticon,{innerText:i.head(this.props.entity.shortcuts),description:this.props.entity.description,emoticonName:this.props.entity.id,size:n.Size.Medium,isStatic:!1,tone:this.props.entity.tone})}};t.GifInlineSearchPreview=class extends C{constructor(){super(...arguments),this._abstractSearchType=m.TabType.Gif,this.onPress=()=>{const e=g.getGifSwiftMessage(this.props.entity),t=new c.SwiftUriObjectEntity(e,this.props.conversationId,!0);S.default.postMessageFromInput(this.props.conversationId,l.PostSource.GifSearch,[t],a.MessageTypes.Media_Card),u.default.deactivateInlineSearch(),this.props.onPressPreview&&this.props.onPressPreview(this.props.entity.id,!0,1)}}_getButtonStyle(){return v.gifPreviewButton}renderPreview(){const e=g.getInlineSearchPreviewDimensions(this.props.deviceOrientation,this.props.isUsingStackNavigation);return o.createElement(d.GifItem,{key:this.props.entity.id,id:this.props.entity.id,info:this.props.entity,src:this.props.entity.asmImageProxySmall,isSelected:!1,renderMobileInterface:!0,width:e,height:e,showPlaceholder:!0,onSelected:this.onPress,isUsedForSearch:!0})}}},2295:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PesSearchResultsCarousel=void 0;const i=s(96486),o=s(31844),n=s(16778),r=s(89391),a=s(47409),l=s(98278),d=s(77381),c=s(82433),h=s(43106),u=s(15877),p=s(33754),g=s(40897),m=s(72666),S=s(30124),f=s(15521),y=s(43855),_=s(26424),v=s(96168),C=s(41067),b=s(83294),T=s(17707),M=s(58962),I=s(29130),w=s(51070),P=s(13130),k=s(4057),A=s(24576),E=s(53374),R=(0,u.lazyProperties)({buttonContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignSelf:"stretch",paddingBottom:5}),gifScrollViewContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",height:_.PesCarouselGifSizePortrait})});class L extends a.CarouselScrollViewBase{constructor(){super(...arguments),this._keyboardShouldPersistTaps=!0,this._maxNumCarouselItems=20}_height(){return 80}_elementCount(){return i.isEmpty(this.props.items)?0:i.isUndefined(this._maxNumCarouselItems)?this.props.items.length:Math.max(this.props.items.length,this._maxNumCarouselItems)}_renderElements(e){const t=i.isUndefined(this._maxNumCarouselItems)?i.map(this.props.items,this.props.renderItem):i.slice(this.props.items,0,this._maxNumCarouselItems).map(this.props.renderItem);return{elements:n.createElement(n.View,{style:R.buttonContainer},t)}}_renderEmptyStateElement(){return n.createElement(n.Text,{style:this._themeStyles.secondaryTextColorStyle},this.props.getEmptyStateLabel())}}class F extends L{constructor(){super(...arguments),this._maxNumCarouselItems=void 0,this._onScroll=(e,t)=>{if(this._scrollTop=e,this._scrollLeft=t,this.props.nextBatchThreshold&&t>this.props.nextBatchThreshold&&!h.default.isSearching())return this.props.onGetNextBatch()}}_height(){return this.props.isUsingStackNavigation&&this.props.deviceOrientation===o.DeviceOrientation.Landscape?_.PesCarouselGifSizeLandscape:_.PesCarouselGifSizePortrait}_marginTop(){return 0}_enableOnScroll(){return!0}render(){return 0===this.props.nextOffset&&this.props.isSearching?n.createElement(n.View,{style:R.gifScrollViewContainer},n.createElement(y.default,null)):super.render()}}class x extends A.default{_buildState(e,t){const s={},i=this.getTabs();return t&&(s.items=this._getItems(e.input,i)),s.tabs=i,s}componentDidUpdate(e,t,s){if(super.componentDidUpdate(e,t,s),i.isUndefined(this.state.tabs)||e.input===this.props.input&&e.activeTabType===this.props.activeTabType)return;const o=this._getItems(this.props.input,this.state.tabs);0===o.length&&e.input!==this.props.input&&this.props.onNoResults&&this.props.onNoResults(),this._announceSearchResults(o.length),this.setState({items:o})}componentDidMount(){super.componentDidMount(),this._announceSearchResults(this.state.items.length)}_announceSearchResults(e){const t=b.getSearchResultsAnnouncementKey(this.props.activeTabType),s=p.getString(t,{count:e});n.Accessibility.announceForAccessibility(s)}_getItems(e,t){if(i.isEmpty(e))return[];const s=[],o={},n=this.getFilteredPesItemsFromTabs(t,e);return i.each(n,(e=>{i.each(e.packs,(e=>{i.each(e.items,(e=>{const t=this.getPesItem(e);t&&(o[t.id]=t)}))}))})),i.each(o,(e=>{s.push(e)})),s}render(){return n.createElement(L,{items:this.state.items,renderItem:this.renderItem,getEmptyStateLabel:this.getEmptyStateLabel,preventBubblingOnSwipe:!1})}}class O extends x{constructor(){super(...arguments),this.renderItem=e=>n.createElement(f.StickerInlineSearchPreview,Object.assign({key:e.id,entity:e},this.props)),this.getEmptyStateLabel=()=>p.getString("PesSearch.StickerPickerNoResultsSearchText")}getPesItem(e){return P.default.getSticker(e)}getTabs(){return v.default.getChatStickerTabs()}getFilteredPesItemsFromTabs(e,t){return b.searchInPackDescriptionAndItemMetadata(e,t)}}class D extends x{constructor(){super(...arguments),this.renderItem=e=>n.createElement(f.MojiInlineSearchPreview,Object.assign({key:e.id,entity:e},this.props)),this.getEmptyStateLabel=()=>p.getString("PesSearch.MojiPickerNoResultsSearchText")}getPesItem(e){return m.default.getMoji(e)}getTabs(){return v.default.getMojiTabs()}getFilteredPesItemsFromTabs(e,t){return b.searchInPackTitleAndDescription(e,t)}}class B extends x{constructor(){super(...arguments),this.renderItem=e=>n.createElement(f.EmoticonInlineSearchPreview,Object.assign({key:e.id,entity:e},this.props)),this.getEmptyStateLabel=()=>p.getString("PesSearch.EmoticonPickerNoResultsSearchText")}getPesItem(e){return c.default.getEmoticonByName(e)}getTabs(){return v.default.getEmoticonTabs()}getFilteredPesItemsFromTabs(e,t){return b.searchInPackTitleAndItemKeyword(e,t)}}class V extends d.default{constructor(){super(...arguments),this._renderItem=e=>n.createElement(f.GifInlineSearchPreview,Object.assign({key:e.id,entity:e,deviceOrientation:this.state.deviceOrientation,isUsingStackNavigation:this.state.isUsingStackNavigation},this.props)),this._getEmptyStateLabel=()=>p.getString("PesSearch.GifPickerNoResultsSearchText"),this._onGetNextBatch=()=>{const e=_.GifSearchMaxResultsCount,t=this._numberOfGifsToRequest();this.state.nextOffset<=e-t&&T.default.getGifsForSearchTerm(this.props.input,t,this.state.nextOffset)}}_numberOfGifsToRequest(e=!1){const t=e?o.DeviceOrientation.Landscape:this.state.deviceOrientation,s=b.getInlineSearchPreviewDimensions(t,this.state.isUsingStackNavigation);if(e){const e=this.state.deviceOrientation===o.DeviceOrientation.Landscape?this.props.containerWidth:2*this.props.containerWidth;return Math.round(e/s)+1}{const e=Math.round(this.props.containerWidth/s);return e>10?10:e}}_getThreshold(e,t){let s;return i.isEmpty(e)||(s=.5*(this._scrollWidth(e,t)-this.props.containerWidth)),s}_scrollWidth(e,t){let s=0;return i.isEmpty(e)||(i.each(e,(e=>{s+=b.getInlineSearchPreviewDimensions(t,this.state.isUsingStackNavigation)})),s+=2*e.length*_.PesCarouselGifHorizontalMarginWidth),s}_buildState(e,t){const s=this._getRootViewId(),o=I.default.getDeviceOrientation(s),n=r.default.getS4LMessagingFeatures().enablePesGifPagination,a=h.default.getGifsForSearch(),l=h.default.isSearching();let d=n&&(t||i.isUndefined(a.nextOffset))?[]:a.gifItems;const c=t?0:this._getThreshold(d,o);let u=a.nextOffset;return!t&&n&&a.searchQuery!==e.input&&(d=[],u=0),{items:d,nextBatchThreshold:c,nextOffset:u,deviceOrientation:o,isSearching:l,isUsingStackNavigation:S.default.isUsingStackNavigationContext()}}componentDidMount(){super.componentDidMount(),this.props.input&&T.default.getGifsForSearchTerm(this.props.input,this._numberOfGifsToRequest(!0))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),e.input!==this.props.input?T.default.getGifsForSearchTerm(this.props.input,this._numberOfGifsToRequest(!0)):h.default.setSearchParams("")}componentWillUnmount(){super.componentWillUnmount(),h.default.resetSearchGifs(),h.default.setSearchParams("")}render(){return n.createElement(F,{items:this.state.items,renderItem:this._renderItem,getEmptyStateLabel:this._getEmptyStateLabel,onGetNextBatch:this._onGetNextBatch,nextBatchThreshold:this.state.nextBatchThreshold,nextOffset:this.state.nextOffset,deviceOrientation:this.state.deviceOrientation,isSearching:this.state.isSearching,preventBubblingOnSwipe:!1,isUsingStackNavigation:this.state.isUsingStackNavigation})}}class N extends A.default{constructor(){super(...arguments),this._onPesItemPressed=(e,t,s)=>{this._pesSearchSession&&(this._pesSearchSession.sendSuccessTelemetryEvent(e,this._getQueryLength(),t,s),this._pesSearchSession=void 0)},this._onEmptySearchResultsReturned=()=>{this._pesSearchSession&&this._pesSearchSession.trackNoResultsInSearch()}}_buildState(e,t){let s={};return t&&(s={inputText:g.default.getInitialSearch()}),s.activeTabType=g.default.getActiveTabType(),s.safeAreaHorizontalPaddingStyle=w.default.horizontalPaddingStyle(l.HorizontalInsetDefault),this._pesSearchSession||(this._pesSearchSession=new C.default(!0,s.activeTabType)),s}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),t.inputText===this.state.inputText&&t.activeTabType===this.state.activeTabType||this._pesSearchSession&&(i.isUndefined(this.state.activeTabType)||t.activeTabType===this.state.activeTabType||(this._pesSearchSession.cancelSessionTelemetryEvent(this._getQueryLength(),!0),this._pesSearchSession=new C.default(!0,this.state.activeTabType)))}render(){if(!this.state.inputText||this.state.activeTabType===M.TabType.Gif&&this.state.inputText.length<_.GifMinSearchChars)return null;let e;const t=Object.assign({input:this.state.inputText||"",activeTabType:this.state.activeTabType,onPressPreview:this._onPesItemPressed,onNoResults:this._onEmptySearchResultsReturned},this.props);switch(this.state.activeTabType){case M.TabType.Emoticon:e=n.createElement(B,Object.assign({},t));break;case M.TabType.Moji:e=n.createElement(D,Object.assign({},t));break;case M.TabType.ChatSticker:e=n.createElement(O,Object.assign({},t));break;case M.TabType.Gif:e=n.createElement(V,Object.assign({},t));break;default:E.default.switchStatementExhaustiveChecking(this.state.activeTabType)}return n.createElement(n.Animated.View,{style:this.state.safeAreaHorizontalPaddingStyle},e)}setInputText(e){if(this.isComponentMounted()){const t=k.default.deburrLowerCase(e.trim());this.setState({inputText:t})}}setSearchType(e){this.isComponentMounted()&&this.setState({activeTabType:e})}componentWillUnmount(){super.componentWillUnmount(),this._pesSearchSession&&(this._pesSearchSession.cancelSessionTelemetryEvent(this._getQueryLength(),!1),this._pesSearchSession=void 0)}_getQueryLength(){return i.isUndefined(this.state.inputText)?0:this.state.inputText.length}}t.PesSearchResultsCarousel=N,t.default=N},23474:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(79737),r=s(13944),a=s(15877),l=s(33754),d=s(24576),c=s(11828),h=s(81760),u=s(26712),p=s(10265),g=s(47204),m=s(98278),S=s(47126),f=s(81571),y=s(90631),_=s(80837),v=s(87134),C=s(24067),b=s(50488),T=o.Styles.createViewStyle({zIndex:9999,position:"fixed"}),M={popupWidth:5*c.IconSize.size32+20,popupHeight:c.IconSize.size32+20,linkModalWidth:345},I=(0,a.lazyProperties)({linkModal:()=>(0,a.lazyProperties)({container:()=>o.Styles.createViewStyle({flex:1,flexDirection:"column"}),textInput:()=>o.Styles.createTextInputStyle({flex:1,paddingVertical:19,lineHeight:22,backgroundColor:h.Color.transparent}),contentContainer:()=>o.Styles.createViewStyle({flexGrow:1,marginHorizontal:20})}),container:()=>o.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"flex-start",padding:10,borderLeftWidth:1,borderRightWidth:1}),containerRoundedCorners:()=>o.Styles.createViewStyle({borderLeftWidth:1,borderRightWidth:1,borderTopWidth:1,borderTopLeftRadius:24,borderTopRightRadius:24}),iconButton:()=>o.Styles.createButtonStyle({width:c.IconSize.size32,height:c.IconSize.size32,alignSelf:"center"})});class w extends d.default{constructor(){super(...arguments),this._onPress=e=>{e.preventDefault(),this.props.onDone({textToDisplay:this.state.textToDisplay||this.state.linkHref,linkHref:this.state.linkHref}),this._dismissDialog()},this._dismissDialog=()=>{g.default.dismissModal("linkModal",this._getRootViewId())},this._onTextInputRef=e=>{this._textInputRef=e||void 0},this._onLinkInputRef=e=>{this._linkInputRef=e||void 0},this.requestTextInputFocus=()=>{var e;null===(e=this._textInputRef)||void 0===e||e.requestFocus()},this.requestLinkInputFocus=()=>{var e;null===(e=this._linkInputRef)||void 0===e||e.requestFocus()},this._onKeyDown=e=>!(e.keyCode!==S.default.ENTER||!u.default.isUrlValid(this.state.linkHref))&&(this._onPress(e),!0),this._dismissModal=()=>{g.default.dismissModal("linkModal",this._getRootViewId())}}_buildState(e,t){if(t){const t=u.default.isUrlValid(e.initialSelection);return{textToDisplay:t?"":e.initialSelection,linkHref:t?e.initialSelection:""}}return{}}componentDidMount(){super.componentDidMount(),o.Input.keyDownEvent.subscribe(this._onKeyDown),this.state.textToDisplay?this.requestLinkInputFocus():this.requestTextInputFocus()}componentWillUnmount(){super.componentWillUnmount(),o.Input.keyDownEvent.unsubscribe(this._onKeyDown)}render(){const e={text:l.getString("LinkCreation.DialogConfirmationButton"),onPress:this._onPress,disabled:!u.default.isUrlValid(this.state.linkHref)},t=o.Styles.createTextInputStyle({color:this._useDarkTheme()?h.Color.white:h.Color.black},!1);return o.createElement(p.default,{dialogId:"linkModal",closeOnClickOutside:!0,maxWidth:M.linkModalWidth,fullScreen:!1,useFullSizeContainer:!0,containerStyle:this._themeStyles.primaryBackgroundColorStyle},o.createElement(y.SimplePanelHeader,{panelName:l.getString("LinkCreation.Header"),leftButton:{closeButtonType:y.CloseButtonType.Close,onPress:this._dismissModal},useCenteredControls:!0}),o.createElement(o.View,{style:I.linkModal.container},o.createElement(o.View,{style:[_.default.flexOne]},o.createElement(o.View,{style:I.linkModal.contentContainer},o.createElement(o.TextInput,{style:[I.linkModal.textInput,t],placeholder:l.getString("LinkCreation.TextToDisplayPlaceholder"),value:this.state.textToDisplay,onChangeText:e=>this.setState({textToDisplay:e}),ref:this._onTextInputRef}),o.createElement(v.default,null),o.createElement(o.TextInput,{style:[I.linkModal.textInput,t],placeholder:l.getString("LinkCreation.LinkAddressPlaceholder"),value:this.state.linkHref,onChangeText:e=>this.setState({linkHref:e}),ref:this._onLinkInputRef}),o.createElement(v.default,null)))),o.createElement(C.default,{button:e}))}}class P extends d.default{constructor(){super(...arguments),this._makeLink=e=>({type:n.EditableEntityType.PlainText,displayText:`[${null==e?void 0:e.textToDisplay}](${null==e?void 0:e.linkHref})`}),this._getSelectedText=()=>{let e="";if(this.props.textInputRef){const t=this.props.textInputRef.getEditorState(),s=t.getSelection(),i=t.getCurrentContent().getPlainText(),o=s.getAnchorOffset(),n=s.getFocusOffset();e=i.substring(o,n)}return e},this._createEntityType=(e,t)=>{if(this.props.textInputRef){const s=this.props.textInputRef.getEditorState().getSelection(),o=this._getSelectedText(),r=e===b.FormatterTypes.Link?this._makeLink(t):{type:n.EditableEntityType.PlainText,displayText:`${e}${o}${e}`};if(this.props.textInputRef.insertContent(r,s),0===o.length&&e!==b.FormatterTypes.Link){const t=this._getCaretPosition();if(i.isUndefined(t))return;const s=t+e.length;i.defer((()=>{this.props.textInputRef&&this.props.textInputRef.setCaretPosition(s)}))}}},this._renderBoldButton=()=>o.createElement(r.default,{style:I.iconButton,icon:c.SkypeIcon.Bold,size:c.IconSize.size16,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,title:l.getString("Formatting.Bold"),onPress:this._onBoldButtonClick}),this._onBoldButtonClick=()=>{this._createEntityType(b.FormatterTypes.Bold)},this._renderItalicButton=()=>o.createElement(r.default,{style:I.iconButton,icon:c.SkypeIcon.Italic,size:c.IconSize.size16,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,title:l.getString("Formatting.Italic"),onPress:this._onItalicButtonClick}),this._onItalicButtonClick=()=>{this._createEntityType(b.FormatterTypes.Italic)},this._renderStrikeButton=()=>o.createElement(r.default,{style:I.iconButton,icon:c.SkypeIcon.Strikethrough,size:c.IconSize.size16,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,title:l.getString("Formatting.StrikeThrough"),onPress:this._onStrikeButtonClick}),this._onStrikeButtonClick=()=>{this._createEntityType(b.FormatterTypes.StrikeThrough)},this._renderCodeButton=()=>o.createElement(r.default,{style:I.iconButton,icon:c.SkypeIcon.CodeSnippet,size:c.IconSize.size16,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,title:l.getString("Formatting.Code"),onPress:this._onCodeButtonClick}),this._onCodeButtonClick=()=>{this._createEntityType(b.FormatterTypes.Code)},this._renderHyperlinkButton=()=>o.createElement(r.default,{style:I.iconButton,icon:c.SkypeIcon.Link,size:c.IconSize.size16,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,title:l.getString("Formatting.Hyperlink"),onPress:this._onHyperlinkButtonClick}),this._onHyperlinkButtonClick=()=>{const e=o.createElement(w,{initialSelection:this._getSelectedText(),onDone:e=>{this._createEntityType(b.FormatterTypes.Link,e)}});g.default.showModal(e,"linkModal",{rootViewId:m.MainRootViewId})}}_buildState(e){return{popupPosition:f.default.getPopupPosition(e.conversationId),popupOpened:f.default.popupOpened(e.conversationId),experience:f.default.getExperience()}}_getCaretPosition(){if(this.props.textInputRef){return this.props.textInputRef.getEditorState().getSelection().getAnchorOffset()}}render(){const e=o.Styles.createViewStyle({backgroundColor:this._useDarkTheme()?h.Color.darkThemeSecondaryBackground:h.Color.white,borderColor:this._useDarkTheme()?h.Color.darkMessageComposerContentBackground:h.Color.gray400Overlay10},!1);let t=[I.container,e];if(this.props.isTopPanel&&P&&this.state.experience===b.RichtextEditorExperience.Panel&&t.push(I.containerRoundedCorners),this.state.popupOpened){const{left:e=0,top:s=0,width:i=0}=this.state.popupPosition,n=o.Styles.createViewStyle({shadowColor:h.Color.blackOverlay40,shadowOffset:{width:0,height:0},shadowOpacity:.4,shadowRadius:20,width:M.popupWidth,left:e-M.popupWidth/2+i/2,top:s-M.popupHeight-10,borderRadius:24,borderWidth:0},!1);t=[...t,T,n]}return o.createElement(o.View,{style:t},this._renderBoldButton(),this._renderItalicButton(),this._renderStrikeButton(),this._renderCodeButton(),this._renderHyperlinkButton())}}t.default=P},65988:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(34339),n=s(98278),r=s(15877),a=s(33754),l=s(29130),d=s(22222),c=s(24576),h=(0,r.lazyProperties)({container:()=>i.Styles.createViewStyle({alignItems:"center",padding:20,marginTop:15,marginRight:15,marginLeft:15,marginBottom:5,borderStyle:"solid",borderBottomWidth:1}),row:()=>i.Styles.createViewStyle({marginBottom:20}),noBorder:()=>i.Styles.createViewStyle({borderTopWidth:0,borderBottomWidth:0})});class u extends c.default{_buildState(e,t){let s=!0;{const t=this._getRootViewId(),i=l.default.getHeight(t),o=l.default.getWidth(t);(i<700||o<1e3)&&(s=!!e.alwaysForceEmoticon)}return{showEmoticon:s}}render(){if(!this.props.displayName)return null;const e=void 0===this.props.showBorder||this.props.showBorder;let t;return this.state.showEmoticon&&(t=i.createElement(i.View,{style:h.row},i.createElement(o.AnimatedEmoticon,{size:o.Size.ExtraLarge,emoticonName:"hi"}))),i.createElement(i.View,{style:[this._themeStyles.dividerBorderColorStyle,h.container,e?{}:h.noBorder]},t,i.createElement(i.View,null,i.createElement(d.default,{buttonStyle:n.SXButtonStyle.ColorFill,buttonSize:n.SXButtonSize.Small,title:a.getString("MessageStream.WaveButton"),allowTextWrap:!1,onPress:this.props.onGreet})))}}t.default=u},42036:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(11041),n=s(33010),r=s(76964),a=s(97691),l=s(19784),d=s(89391),c=s(20603),h=s(25638),u=s(65976),p=s(71908),g=s(51077),m=s(97297),S=s(81959),f=s(82261),y=s(16402),_=s(37490),v=s(52262),C=s(6452),b=s(70891),T=s(46096),M=s(7234),I=s(73439),w=s(69382),P=s(11276),k=s(36237),A=s(33754),E=s(18606),R=s(14597),L=s(64387),F=s(12762),x=s(50353),O=s(12056),D=s(10909),B=s(4735),V=s(22669),N=s(80457),U=s(85207),H=s(99097),z=s(46096),W=s(14976),j=s(33825),G=s(4057),K=(s(26712),s(451));t.default=new class{deleteMessage(e,t,s,i){const o=L.default.isMediaItem(e);let n=s?s.title:"",r=s?s.body:"";if(!s){let t="Global.RemoveMessage",s="Global.RemoveMessageContent";const i=g.getMessageTypeGroup(e);i===g.MessageTypeGroups.Picture?(t="Global.RemovePhoto",s="Global.RemoveMessagePhotoContent"):i===g.MessageTypeGroups.Video?(t="Global.RemoveVideo",s="Global.RemoveMessageVideoContent"):(o||e.isAlbum())&&(t="Global.RemoveMedia",s="Global.RemoveMessageMediaContent"),n=A.getString(t),r=A.getString(s)}const a=[{text:A.getString("Global.CancelLabel"),isCancel:!0},{text:A.getString("Global.RemoveLabel"),onPress:()=>this._delete(e,i),style:"destructive",isSubmit:!0}];l.default.showWithOptions({title:n,dialogAccessibilityTitle:r,message:r,buttons:a,rootViewId:t})}deleteMultipleMessages(e,t,s){const o=A.getString("Global.RemoveMultipleMessages",{count:e.length}),n=A.getString("Global.RemoveMultipleMessagesContent",{count:e.length}),r=[{text:A.getString("Global.CancelLabel"),isCancel:!0},{text:A.getString("Global.RemoveLabel"),onPress:()=>{i.each(e,(e=>{this._delete(e)})),s()},style:"destructive",isSubmit:!0}];l.default.showWithOptions({title:o,dialogAccessibilityTitle:n,message:n,buttons:r,rootViewId:t})}cancelFailedSend(e){const{conversationId:t,createdTime:s}=e;U.default.cancelFailedPost(e);const i=new O.MessageActionTelemetry(t,e,s,O.MessageActionOrigin.StreamItem,O.MessageActionType.CancelRejected);k.track(i)}retryFailedSend(e){const t=e.getSendRetryInfo();if(t&&U.default.canRetry(t)){const s=this._getDocId(e);U.default.retry(t,s);const i=new O.MessageActionTelemetry(e.conversationId,e,e.createdTime,O.MessageActionOrigin.StreamItem,O.MessageActionType.RetryFailed,s);k.track(i)}else k.warn(T.LogTraceArea.MessageOptionsHelper,"StreamItem: Cannot retry failed send with this info, but we gave the option to retry")}_getDocId(e){const t=e.getSendRetryInfo();if(t&&t.kind===N.PostUploadInfoKind)return i.first(t.messagesForPosting[e.conversationId].amsreferences)}_delete(e,t){e.hasAlbumId()?this._deleteAlbumMessage(e):U.default.deleteMessage(e,T.PostSource.MessageOptionsDelete),t&&t()}_deleteAlbumMessage(e){const t=e.getAlbumId();if(e.isAlbum())return void this._deleteAlbum(e);const s=E.default.getAlbumMessage(t);s&&1===E.default.getAllMediaMessagesForAlbum(t).length?this._deleteAlbum(s):U.default.deleteMessage(e,T.PostSource.MessageOptionsDelete)}_deleteAlbum(e){const t=e.getAlbumId(),s=E.default.getAllMediaMessagesForAlbum(t);U.default.deleteMessage(e,T.PostSource.MessageOptionsDelete),i.each(s,(e=>U.default.deleteMessage(e,T.PostSource.MessageOptionsDelete)))}cancelMessageSend(e,t){if(L.default.isVideo(e)){const s=A.getString("VideoNode.CancelSendTitle"),i=A.getString("VideoNode.CancelSendBody"),o=[{text:A.getString("Global.YesLabel"),onPress:()=>this._cancelMessageSend(e,O.MessageActionOrigin.StreamItem),style:"destructive",isSubmit:!0},{text:A.getString("Global.NoLabel"),isCancel:!0}];l.default.showWithOptions({title:s,dialogAccessibilityTitle:i,message:i,buttons:o,rootViewId:t})}else this._cancelMessageSend(e,O.MessageActionOrigin.StreamItem)}_cancelMessageSend(e,t){const s=e,{conversationId:o,createdTime:n}=s;i.each(s.getUnacknowledgedClientMessageIds(),(e=>{U.default.cancelPostMessage(o,e)}));const r=this._getDocId(e),a=new O.MessageActionTelemetry(o,s,n,t,O.MessageActionType.Cancel,r);k.track(a)}_getReportContextForMessage(e){switch(g.getMessageTypeGroup(e)){case g.MessageTypeGroups.UriFile:return z.ReportContextListOptions.FileMessage;case g.MessageTypeGroups.Picture:return z.ReportContextListOptions.PictureMessage;case g.MessageTypeGroups.Audio:return z.ReportContextListOptions.AudioMessage;case g.MessageTypeGroups.Video:return z.ReportContextListOptions.VideoMessage;default:return z.ReportContextListOptions.Message}}reportMessage(e,t){_.dismissAll();const s={mriToBlock:e.creator,rootViewId:t,content:e,reportContext:this._getReportContextForMessage(e),isBlockingDialog:!1};B.default.navigateToReportConcernModal(s)}showReportedMessage(e){p.markMessageReported(e,!1);const{conversationId:t,createdTime:s}=e,i=new O.MessageActionTelemetry(t,e,s,O.MessageActionOrigin.StreamItem,O.MessageActionType.ShowReportedMessage);k.track(i)}_copyTextToClipboard(e,t,s){let i,o;s?i=s:j.isTextSelected()?i=j.getSelectedText():(i=S.renderText(t,{message:e,processing:b.ProcessingDefaults.Stripped}),t.hasHtmlContent()&&(o=m.renderHtml(t))),o?r.default.setHtml(o,i):i&&K.default.writeText(i)}copyMultipleMessages(e,t){let s="";i.each(e,(e=>{const t=v.default.getMemberShortNameForConversation(e.message.conversationId,e.message.creator),i=y.default.getDisplayTimeString(e.message.createdTime),o=A.getString("MessageStream.CopyMetadata",{displayName:t,time:i}),n=S.renderText(e.node,{message:e.message,processing:b.ProcessingDefaults.Stripped})+"\r\r";s=s+o+"\r"+n})),s&&K.default.writeText(s.trim()),D.default.scheduleTextMessage(A.getString("MessageStream.MessageCopied"),void 0,t)}copyMessage(e,t,s,i){this._copyTextToClipboard(e,t,i);const o=new O.MessageActionTelemetry(e.conversationId,e,e.createdTime,O.MessageActionOrigin.StreamItem,O.MessageActionType.Copy);D.default.scheduleTextMessage(A.getString("MessageStream.MessageCopied"),void 0,s),k.track(o)}copyLinkMessage(e,t){K.default.writeText(e);const s=new O.MessageActionTelemetry(t.conversationId,t,t.createdTime,O.MessageActionOrigin.StreamItem,O.MessageActionType.CopyLink);k.track(s)}copyLocationMessage(e,t){this._copyTextToClipboard(e,t,void 0);const s=new O.MessageActionTelemetry(e.conversationId,e,e.createdTime,O.MessageActionOrigin.StreamItem,O.MessageActionType.Copy);k.track(s)}viewLink(e,t){e&&l.default.showOKAlert("",e,t,!0)}copyImageFromMessage(e){const t=L.default.getMediaDescriptorForItem(e);if(t&&t.mediaType===V.PictureViewer.MediaType){this.copyImage(t.fullResolutionUrl);const s=new O.MessageActionTelemetry(e.conversationId,e,e.createdTime,O.MessageActionOrigin.StreamItem,O.MessageActionType.Copy);k.track(s)}else k.warn(T.LogTraceArea.MessageOptionsHelper,"Trying to copy message that is not an image as an image.")}copyImage(e){P.copyImageToClipboard(e)}markMessageUnread(e,t){const{conversationId:s,createdTime:i}=e,o=new O.MessageActionTelemetry(s,e,i,O.MessageActionOrigin.StreamItem,O.MessageActionType.MarkMessageUnread);k.track(o),p.markMessageUnreadFromGivenMessage(e).then((e=>{t&&t(e)})).catch((e=>{k.warn(T.LogTraceArea.MessageOptionsHelper,"StreamItem could not set consumption horizon")}))}openOnDesktop(e,t,s,i,o,n){return!1}openMediaLocationOnDesktop(e){this._openFileLocation(u.getFileCacheKeyMedia(e,!0))}openFileLocationOnDesktop(e){const t=e.getFirstUriObjectChild(F.UriObjectFileNode);if(!t)return;const s=new h.default(t.getFileContentUrlSanitized()).getDocumentId();s&&this._openFileLocation(s)}_openFileLocation(e){const t=I.default.getLocalUri(e);t&&w.openFileLocation(t)}_trackDownload(e,t,s,i,o){const n=C.default.downloadUpdated.subscribe((r=>{if(r.key!==e||!r.isFinished)return;const a=r.amsGetStatusTransfer&&r.amsGetStatusTransfer.success,l=r.downloadTransfer&&r.downloadTransfer.success;(a||l)&&r.downloadTempLocalUri?o?o(e,r.downloadTempLocalUri):this._downloadSuccess(e,r.downloadTempLocalUri,t,s,i):(i&&s.hasAlbumId()&&E.default.markAlbumMessageDownloadCompleted(s.getAlbumId(),s.cuid),D.default.scheduleTextMessage(A.getString("MediaViewer.SaveFailure"),void 0,t)),D.default.removeToastMessage(`${e}-downloading`),n.unsubscribe()}));i&&s.hasAlbumId()&&!E.default.isDownloadingAlbum(s.getAlbumId())&&E.default.startAlbumDownload(s.getAlbumId()),this._showDownloadingToast(`${e}-downloading`,t)}_downloadSuccess(e,t,s,i,o){let n=A.getString("MediaViewer.SaveSuccess");if(o&&i.hasAlbumId()){const e=i.getAlbumId();if(E.default.markAlbumMessageDownloadCompleted(e,i.cuid),E.default.isDownloadingAlbum(e))return;E.default.getAllMediaMessagesForAlbum(e).length>1&&(n=A.getString("MediaViewer.SaveAllSuccess"))}D.default.scheduleMessage({key:e,textMessage:n,onPress:()=>w.openFile(t),rootViewId:s})}_handleFileFromCache(e,t){if(M.default.isLocalCacheSupported()&&M.default.isKnown(e)){const s=M.default.getLocalUri(e);if(s)return t(s),!0}return!1}saveToDesktop(e,t,s,o,r,l,d){{const o=g.getMessageTypeGroup(e);i.isEmpty(s)&&(o===g.MessageTypeGroups.Picture?s=A.getString("StreamItem.SavePictureFileName"):o===g.MessageTypeGroups.Video&&(s=A.getString("StreamItem.SaveVideoFileName"))),n.default.saveFile(t,s)}return this._checkFileStatusAvailabilityAsync(t).then((()=>!0)).fail((e=>(k.error(T.LogTraceArea.MessageOptionsHelper,`saveToDesktop failed: ${G.default.errorAsString(e)}`),D.default.scheduleTextMessage(A.getString("MediaViewer.SaveFailure"),void 0,l),a.Resolved(!1))))}desktopSaveAs(e,t,s,i,o,n,r){}_checkFileStatusAvailabilityAsync(e){const t=new h.default(e),s=t.getDocumentId(),i=t.getViewId();return s&&i?c.default.getStatusAsync(s,i).then((e=>e?a.Resolved():a.Rejected(`Check file status availability async failed. StatusInfo:  ${G.default.errorAsString(e)}`))):a.Rejected("Check file status availability async failed, amsObjectId missing.")}downloadToCameraRoll(e,t,s,i,o,n,r){const a=u.getFileCacheKeyMedia(e,!0);this.saveToDesktop(e,t,s,a,i,o,n).then((a=>{if(a)return;const l=u.getFileCacheKeyMedia(e,!0),d=M.default.getLocalUri(l);d?this.saveToCameraRoll(e,d,o,n,r):R.default.isQueued(l)||H.default.requestCameraRollPermission().then((a=>{if(k.log(T.LogTraceArea.MessageOptionsHelper,"downloadToCameraRoll: Access allowed?",a?"yes":"no"),a){const a=new R.QueueItem(l,t,s,"streamItem",Date.now()+36e5,M.CacheEvictionKind.UserInvolved,Date.now());R.default.add(a,i).then((s=>{s.cancelled?k.log(T.LogTraceArea.StreamItem,"Media prefetching cancelled for: ",W.dev_unknownOmit(l),W.dev_unknownOmit(t)):this.saveToCameraRoll(e,s.url,o,n,r)})).catch((e=>{k.error(T.LogTraceArea.MessageOptionsHelper,"Something went wrong in prefetching media to cache: ",l,W.dev_unknownOmit(t),G.default.errorAsString(e))}))}}))}))}saveToCameraRoll(e,t,s,i,n){const r="downloading";H.default.requestCameraRollPermission().then((a=>{if(k.log(T.LogTraceArea.MessageOptionsHelper,"CameraRoll: Access allowed?",a?"yes":"no"),a){const a=g.getMessageTypeGroup(e);let l="photo";a===g.MessageTypeGroups.Video?l="video":a===g.MessageTypeGroups.Audio&&(l="audio");let c="audio"===l?void 0:l;i&&e.hasAlbumId()?E.default.isDownloadingAlbum(e.getAlbumId())||(E.default.startAlbumDownload(e.getAlbumId()),this._showDownloadingToast(r,s)):this._showDownloadingToast(r,s),o.default.saveToCameraRoll(t,c).then((o=>{k.log(T.LogTraceArea.MessageOptionsHelper,"Saved successfully to the CameraRoll",W.dev_unknownOmit(t));d.default.getS4LMessagingFeaturesNoSubscription().addMediaToSkypeAlbum?w.addMediaToSkypeAlbum(o).fail((()=>{k.warn(T.LogTraceArea.MessageOptionsHelper,"CameraRoll: failed to add media to Skype album")})).always((()=>{this._onCameraRollSave(l,s,e.getAlbumId(),i)})):this._onCameraRollSave(l,s,e.getAlbumId(),i),n&&n(!0)})).catch((e=>{let t;k.error(T.LogTraceArea.MessageOptionsHelper,"Error saving to the CameraRoll.",G.default.errorAsString(e)),t="photo"===l?A.getString("MessageActionMenu.PhotoSaveFailNotification"):"audio"===l?A.getString("MessageActionMenu.AudioSaveFailNotification"):A.getString("MessageActionMenu.VideoSaveFailNotification"),t&&D.default.scheduleTextMessage(t,void 0,s),n&&n(!1)})).finally((()=>{i&&e.hasAlbumId()&&(E.default.markAlbumMessageDownloadCompleted(e.getAlbumId(),e.cuid),E.default.isDownloadingAlbum(e.getAlbumId()))||D.default.removeToastMessage(r)}))}}))}_onCameraRollSave(e,t,s,i){let o;switch(e){case"photo":o=A.getString("MessageActionMenu.PhotoSavedNotification");break;case"audio":o=A.getString("MessageActionMenu.AudioSavedNotification");break;case"video":o=A.getString("MessageActionMenu.VideoSavedNotification");break;default:o=A.getString("MediaViewer.SaveAsSuccess")}if(i&&s){if(E.default.isDownloadingAlbum(s))return;E.default.getAllMediaMessagesForAlbum(s).length>1&&(o=A.getString("MediaViewer.SaveAllSuccess"))}D.default.scheduleTextMessage(o,void 0,t)}_showDownloadingToast(e,t){D.default.scheduleMessage({key:e,duration:3e5,textMessage:A.getString("MediaViewer.Downloading"),rootViewId:t})}dumpMessage(e,t){const s=JSON.stringify(e,null,t?4:void 0),i=f.createMessageInfoFromEscapedText(e.conversationId,T.PostSource.StreamItemCommand,s);x.default.cachedStoreFor(e.conversationId,void 0).feedEphemeralMessage(i)}}},80760:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StatusPillView=void 0;const i=s(96486),o=s(16778),n=s(46096),r=s(39285),a=s(36237),l=s(15877),d=s(33754),c=s(86045),h=s(44352),u=s(50795),p=s(81760),g=s(80837),m=s(19675),S=s(24576),f=s(12770),y=(0,l.lazyProperties)({stickyStreamDividerContainer:()=>o.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,flexDirection:"row",height:37,justifyContent:"center",alignItems:"flex-end",overflow:"hidden"}),textStyle:()=>(0,l.lazyProperties)({default:()=>o.Styles.createTextStyle({color:p.Color.gray400}),white:()=>o.Styles.createTextStyle({color:p.Color.white})}),pill:()=>o.Styles.createViewStyle({alignItems:"center",justifyContent:"center",minHeight:30,borderRadius:15,paddingHorizontal:25,backgroundColor:p.Color.gray100Overlay80}),pillStyle:()=>(0,l.lazyProperties)({default:()=>o.Styles.createViewStyle({backgroundColor:p.Color.gray100Overlay80}),darkGreyBg:()=>o.Styles.createViewStyle({backgroundColor:p.Color.gray300}),blackBg:()=>o.Styles.createViewStyle({backgroundColor:p.Color.black}),blueBg:()=>o.Styles.createViewStyle({backgroundColor:p.Color.blue})}),relativePosition:()=>o.Styles.createViewStyle({position:"relative"})}),_=e=>{a.log(n.LogTraceArea.ConnectivityStatusBar,e)},v=e=>i.isUndefined(e.status)?void 0:h.PillStatus[e.status];class C extends S.default{constructor(){super(...arguments),this._verticalAnimatedValue=new o.Animated.Value(-40.7),this._verticalAnimatedStyle=o.Styles.createAnimatedViewStyle({transform:[{translateY:this._verticalAnimatedValue}]}),this.touch=()=>{this.state.content?(this._hiding&&this._animation&&(_("touch: currently hiding, stopping animation"),this._animation.stop()),this.state.shown||this._showing||(_("touch: hidden, start the animation"),this._animation=u.default.easeOut({value:this._verticalAnimatedValue,toValue:0}),this._showing=!0,this._animation.start((()=>{_("touch: show animation finished"),this.isComponentMounted()&&(this._showing=!1,this.setState({shown:!0}),this._scheduleHide())}))),this._hideTimeout&&(_("touch: hide timer exists, cleaning and scheduling new one"),f.default.clearTimeout(this._hideTimeout),this._hideTimeout=void 0,this._scheduleHide())):_("touch: returning, no content")},this._scheduleHide=()=>{this._shouldAutoHide(this.state)?(_("scheduleHide: scheduling hide"),this._hideTimeout=f.default.setTimeout(this._dangerouslyHideWithoutTimer,1500)):_("scheduleHide: early return, _shouldAutoHide returned false. NOT scheduling timer")},this._dangerouslyHideWithoutTimer=()=>{!this._hiding&&this.state.shown&&(this._hideTimeout&&(f.default.clearTimeout(this._hideTimeout),this._hideTimeout=void 0),this._animation=u.default.easeOut({value:this._verticalAnimatedValue,toValue:-40.7}),this._hiding=!0,_("scheduleHide: starting hide animation"),this._animation.start((()=>{_("scheduleHide: hide animation finished"),this.isComponentMounted()&&(this._hiding=!1,this.setState({shown:!1}))})))},this._onPress=e=>{e.stopPropagation(),this._dangerouslyHideWithoutTimer()}}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this.props.statusPillInstance.setMessageStreamStore(this.props.messageStreamStore)}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t),this.props.statusPillInstance.setMessageStreamStore(e.messageStreamStore)}_shouldAutoHide(e){return!i.includes([h.PillStatus.NO_CONNECTION,h.PillStatus.CONNECTING,h.PillStatus.UPDATING],e.status)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.content!==t.content&&(_(`The content changed: ${v(t)} -> ${v(this.state)}, calling touch().`),this.touch(),this._announceUpdatedStateForA11y(this.state,t)),!this._shouldAutoHide(t)&&this._shouldAutoHide(this.state)&&(_("ShouldAutoHide changed from false to true, calling _scheduleHide()."),this._scheduleHide())}componentWillUnmount(){super.componentWillUnmount(),this.props.statusPillInstance.setMessageStreamStore(void 0),this._hideTimeout&&(f.default.clearTimeout(this._hideTimeout),this._hideTimeout=void 0)}componentDidMount(){super.componentDidMount(),this._shouldAutoHide(this.state)||(_(`Just mounted, displaying content that shouldn't be auto hidden: ${v(this.state)} `),this.touch())}_buildState(e,t){const s=void 0!==e.connectionStatusOnly&&e.connectionStatusOnly,i=e.statusPillInstance.getPillStatus();let o={showAsUnread:e.statusPillInstance.showAsUnread(),content:e.statusPillInstance.getContent(s,e.conversationId),status:i};return t&&(o.shown=!1,o.enabledForInfo=!1),o}_getPillStyle(){return{[h.PillStatus.NO_CONNECTION]:[y.pillStyle.blackBg,y.textStyle.white],[h.PillStatus.CAPTIVE_PORTAL]:[y.pillStyle.blackBg,y.textStyle.white],[h.PillStatus.CONNECTING]:[y.pillStyle.darkGreyBg,y.textStyle.white],[h.PillStatus.UPDATING]:[y.pillStyle.blueBg,y.textStyle.white],[h.PillStatus.INFO]:this.state.showAsUnread?[y.pillStyle.blueBg,y.textStyle.white]:[y.pillStyle.default,y.textStyle.default]}[this.state.status]||[y.pillStyle.default,y.textStyle.default]}render(){if(!this.state.content)return _("rendering empty content, returning null"),null;if(this.state.status===h.PillStatus.INFO&&!this.state.enabledForInfo)return null;if(this.state.status===h.PillStatus.CAPTIVE_PORTAL||this.state.status===h.PillStatus.NO_CONNECTION)return null;const[e,t]=this._getPillStyle(),s=[y.pill,this._verticalAnimatedStyle,e],i=[y.stickyStreamDividerContainer,g.default.noncollapsibleView];return this.props.disableAbsolutePosition&&i.push(y.relativePosition),o.createElement(r.default,{key:"statusPill",ignorePointerEvents:!0,style:i},o.createElement(o.Animated.View,{style:s,ignorePointerEvents:!0},o.createElement(o.Button,{onPress:this._onPress,disabled:this._shouldAutoHide(this.state),disabledOpacity:1},o.createElement(m.Caption,{style:t,numberOfLines:1,messageStreamFontSize:this.props.messageStreamFontSize},this.state.content))))}_announceUpdatedStateForA11y(e,t){if(c.default.shouldAnnounceForAccessibility())return t.status===h.PillStatus.CONNECTING&&e.status!==h.PillStatus.CONNECTING?o.Accessibility.announceForAccessibility(d.getString("ConnectivityStatusBar.Connected")):e.status===h.PillStatus.CONNECTING?o.Accessibility.announceForAccessibility(d.getString("ConnectivityStatusBar.Connecting")):e.status===h.PillStatus.UPDATING?o.Accessibility.announceForAccessibility(d.getString("ConnectivityStatusBar.UpdatingConversation")):void 0}setEnabledForInfo(e){return this.isComponentMounted()&&this.setState({enabledForInfo:e}),this}}t.StatusPillView=C},63979:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallGalleryEmptyViewer=void 0;const i=s(16778),o=s(97691),n=s(98278),r=s(46096),a=s(36237),l=s(15877),d=s(33754),c=s(7580),h=s(45983),u=s(51070),p=s(22222),g=s(81760),m=s(19675),S=(0,l.lazyProperties)({container:()=>i.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center"}),bodyContainer:()=>i.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,bottom:0,alignItems:"center",justifyContent:"center",backgroundColor:g.Color.black}),bodyTextStyle:()=>i.Styles.createTextStyle({color:g.Color.white,backgroundColor:g.Color.transparent,marginHorizontal:16,marginBottom:30,textAlign:"center"}),buttonStyle:()=>i.Styles.createViewStyle({alignSelf:"stretch",marginHorizontal:20})});class f extends c.MediaViewer{constructor(){super(...arguments),this._contentAnimatedOpacityValue=new i.Animated.Value(0),this._contentAnimatedStyle=i.Styles.createAnimatedViewStyle({opacity:this._contentAnimatedOpacityValue}),this._showContent=()=>{i.Animated.timing(this._contentAnimatedOpacityValue,{toValue:1,duration:300,delay:500,easing:i.Animated.Easing.Out()}).start()}}_buildState(e,t){return{safeAreaHorizontalPaddingStyle:u.default.horizontalPaddingStyle({left:10,right:10})}}render(){const e=d.getString("CallPanel.GalleryEmptyTitle"),t=d.getString("QuickCapturePanel.CaptureTitle"),s=[S.bodyContainer,this._contentAnimatedStyle];return this.state.safeAreaHorizontalPaddingStyle&&s.push(this.state.safeAreaHorizontalPaddingStyle),i.createElement(i.View,{style:S.container},i.createElement(i.Animated.View,{style:s},i.createElement(m.BodyText,{bold:!0,style:S.bodyTextStyle},e),i.createElement(p.default,{style:S.buttonStyle,buttonStyle:n.SXButtonStyle.LightFill,title:t,onPress:this.props.media.launchCamera})))}animateOpen(e){return super.animateOpen(e).then(this._showContent)}animateClose(e){return o.Resolved()}presentMedia(e,t,s,i){super.presentMedia(e,t,s,i),this._showContent()}getCloseButtonAccLabel(){return d.getString("Global.CloseButtonTitle")}_handleCaching(e,t){super._handleCaching(e,t),a.log(r.LogTraceArea.PictureViewer,"CallGalleryEmptyViewer.handleCaching, causeId: "+t)}}t.CallGalleryEmptyViewer=f,f.MediaType=h.MediaViewerTypes.CallGalleryEmpty},31772:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(63297),n=s(31844),r=s(16778),a=s(60),l=s(38566),d=s(46096),c=s(36237),h=s(15877),u=s(33754),p=s(65822),g=s(45983),m=s(4057),S=s(81760),f=s(80837),y=s(24576),_=s(53374),v=s(16718),C=s(54288),b=s(3729),T=(0,h.lazyProperties)({viewerContainer:()=>r.Styles.createViewStyle({flex:1,alignSelf:"center",alignItems:"center",justifyContent:"center"}),playerContainer:()=>r.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"center"}),overlayContainerBackground:()=>r.Styles.createViewStyle({backgroundColor:S.Color.blackOverlay10})});class M extends y.default{constructor(){super(...arguments),this._audioManagerClient=new l.default(l.AudioManagerSource.VideoViewer),this._videoPausedBeforeLoad=!1,this._showControls=!0,this._onAppStateChange=e=>{0},this._onVideoPlayerRef=e=>{this._videoPlayerRef=e||void 0},this._toggleVideoControls=e=>{this._showControls=e,this._controlsStore.setPlayPauseButtonState(e),this._controlsStore.setScrubberControlsVisibility(e)},this._playOrPauseVideo=()=>{this._controlsStore.getVideoPlayState()===C.VideoPlayState.Playing?this._controlsStore.pause():this._controlsStore.play()},this._onEnded=()=>{this.isComponentMounted()&&(c.log(d.LogTraceArea.LocalVideoViewer,`LocalVideoViewer(${this._id}).onEnded`),this._toggleVideoControls(!0),this.setState({isPlaying:!1}))},this._onLoadedData=e=>{this.isComponentMounted()&&e.duration&&(c.log(d.LogTraceArea.LocalVideoViewer,`LocalVideoViewer(${this._id}).onLoadedData duration=${e.duration}`),this.setState({videoDuration:e.duration}))},this._onProgress=e=>{this._controlsStore.setVideoPlayProgress({current:e.currentTime,duration:this.state.videoDuration})},this._onSeek=e=>{this._controlsStore&&!this._videoPausedBeforeLoad&&this._controlsStore.setVideoPlayProgress({current:e.currentTime,duration:this.state.videoDuration})}}_buildState(e,t){let s={};t&&(this._id=_.default.newCauseId(),s.isPlaying=!1,s.videoDuration=0,this._controlsStore=new C.VideoViewerControlsStore(!1),this._controlsStore.registerViewerCallbacks({onPlay:()=>{this.setState({isPlaying:!0})},onPause:()=>{this.setState({isPlaying:!1})},onSeekTo:e=>{this._onSeekTo(e)},onMute:e=>{this._muteVideo(e)}}));const i=p.default.getActivePlayerToken();return!t&&this._playerToken!==i&&this.state.isPlaying&&(s.isPlaying=!1),s}componentDidMount(){super.componentDidMount(),this._playerToken=p.default.registerAsPlayer(),this._activationSubToken=a.default.subscribeForChanges("LocalVideoViewer",this._onAppStateChange),this._playVideo(),i.delay((()=>{this._toggleVideoControls(!0)}),300),c.log(d.LogTraceArea.LocalVideoViewer,`LocalVideoViewer(${this._id}).componentDidMount`)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);const i=_.default.newCauseId();c.log(d.LogTraceArea.LocalVideoViewer,`LocalVideoViewer(${this._id}).componentDidUpdate causeId:${i}`),!t.isPlaying&&this.state.isPlaying?this._audioManagerClient.requestMode(o.AudioModes.VideoPlayback,i).then((e=>{e&&this.isComponentMounted()&&(p.default.setAsActive(this._playerToken),this._playVideo())})):t.isPlaying&&!this.state.isPlaying&&(this._pauseVideo(),this._audioManagerClient.release(i)),this._controlsStore.setVideoPlayState(this.state.isPlaying?C.VideoPlayState.Playing:C.VideoPlayState.Paused)}componentWillUnmount(){super.componentWillUnmount();const e=_.default.newCauseId();c.log(d.LogTraceArea.LocalVideoViewer,"LocalVideoViewer("+this._id+").componentWillUnmount causeId: "+e),this._audioManagerClient.release(e),this._toggleVideoControls(!1),this._onToggleAllowScreenLock(!0),this._activationSubToken.unsubscribe()}render(){const e=this.state.isPlaying?u.getString("MediaViewer.Pause"):u.getString("MediaViewer.Play");return r.createElement(r.GestureView,{style:[f.default.absoluteFill,T.viewerContainer],accessibilityLabel:e,accessibilityTraits:r.Types.AccessibilityTrait.Button,onTap:()=>this._toggleVideoControls(!this._showControls)},r.createElement(r.View,{style:[T.playerContainer,this.props.style]},r.createElement(r.View,{style:[T.overlayContainerBackground,f.default.absoluteFill]}),r.createElement(b.default,{origin:"LocalVideoViewer",key:"local-video-player",ref:this._onVideoPlayerRef,style:this.props.style,source:this.props.videoUrl,loop:!1,onEnded:this._onEnded,onLoadedData:this._onLoadedData,onProgress:this._onProgress,onSeek:this._onSeek,resizeMode:"contain",shouldRedirectForAndroidHLS:!1,resumeAfterForeground:!0})),r.createElement(v.VideoViewerControls,{controlsStore:this._controlsStore,onPlayOrPause:this._playOrPauseVideo,progressBarStyle:this.props.progressBarStyle}))}_onToggleAllowScreenLock(e){e?n.default.allowScreenLock().catch((e=>{c.warn(d.LogTraceArea.LocalVideoViewer,`LocalVideoViewer(${this._id}) allowScreenLock failed: ${m.default.errorAsString(e)}`)})):n.default.blockScreenLock().catch((e=>{c.warn(d.LogTraceArea.LocalVideoViewer,`LocalVideoViewer(${this._id}) blockScreenLock failed: ${m.default.errorAsString(e)}`)}))}_playVideo(){this._videoPlayerRef&&(this._videoPlayerRef.play(),this._onToggleAllowScreenLock(!1),this.setState({isPlaying:!0}),r.Accessibility.announceForAccessibility(u.getString("MediaViewer.PlayingVideo")))}_pauseVideo(){this._videoPlayerRef&&(this._videoPlayerRef.pause(),this._onToggleAllowScreenLock(!0),this.setState({isPlaying:!1}),r.Accessibility.announceForAccessibility(u.getString("MediaViewer.VideoPaused")))}_onSeekTo(e){this._videoPlayerRef&&this._videoPlayerRef.seekPercent(e)}_muteVideo(e){this._videoPlayerRef&&this._videoPlayerRef.mute(e)}}M.MediaType=g.MediaViewerTypes.Video,t.default=M},7580:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MediaViewer=t.AnimationDuration=void 0;const i=s(16778),o=s(97691),n=s(77381),r=s(46096),a=s(7234),l=s(36237),d=s(61253),c=s(14597),h=s(45983),u=s(14976),p=s(53374);t.AnimationDuration=250;class g extends n.default{constructor(){super(...arguments),this._containerWidth=0,this._containerHeight=0,this._nonZoomModeTranslateX=0,this._nonZoomModeTranslateY=0,this._currentTranslateX=0,this._currentTranslateY=0,this._currentScale=1,this._defaultScale=1,this._viewerBounds={width:0,height:0},this._viewerHasFocus=!1,this._slowDownFactor=1,this._openCloseAnimationDuration=t.AnimationDuration*this._slowDownFactor,this._fadeToFullSizeDuration=t.AnimationDuration*this._slowDownFactor,this._containerAnimatedWidthValue=new i.Animated.Value(0),this._containerAnimatedHeightValue=new i.Animated.Value(0),this._containerAnimatedOpacityValue=new i.Animated.Value(0),this._containerAnimatedTranslateXValue=new i.Animated.Value(0),this._containerAnimatedXStyle=i.Styles.createAnimatedViewStyle({width:this._containerAnimatedWidthValue,height:this._containerAnimatedHeightValue,opacity:this._containerAnimatedOpacityValue,transform:[{translateX:this._containerAnimatedTranslateXValue}]}),this._containerAnimatedTranslateYValue=new i.Animated.Value(0),this._containerAnimatedYStyle=i.Styles.createAnimatedViewStyle({transform:[{translateY:this._containerAnimatedTranslateYValue}]}),this._containerAnimatedScaleValue=new i.Animated.Value(1),this._containerAnimatedStyle=i.Styles.createAnimatedViewStyle({transform:[{scale:this._containerAnimatedScaleValue}]}),this._animate=()=>{this._completeOpenAnimation&&this._completeOpenAnimation()}}_buildState(e,t){}_animateZoom(e,t,s,o,n){this._currentScale=s,this._currentTranslateX=e,this._currentTranslateY=t;const r=o||i.Animated.Easing.InOut();i.Animated.parallel([i.Animated.timing(this._containerAnimatedTranslateXValue,{toValue:e,duration:this._openCloseAnimationDuration,easing:r}),i.Animated.timing(this._containerAnimatedTranslateYValue,{toValue:t,duration:this._openCloseAnimationDuration,easing:r}),i.Animated.timing(this._containerAnimatedScaleValue,{toValue:s,duration:this._openCloseAnimationDuration,easing:r}),i.Animated.timing(this.props.backgroundOpacityValue,{toValue:1,duration:this._openCloseAnimationDuration,easing:i.Animated.Easing.Linear()})]).start(n)}_calcAnimateFromLocation(e){return e}_getDestinationDimensions(){return this._viewerBounds}_fitToContainerSafe(e){return e}_onCompleteOpen(){}_handleCaching(e,t){l.log(r.LogTraceArea.MediaViewer,"MediaViewer.handleCaching, hasFocus:"+e+" causeId: "+t)}_onFocusChanged(e,t){l.log(r.LogTraceArea.MediaViewer,"onFocusChanged, hasFocus:"+e+" causeId: "+t)}presentMedia(e,t,s,i){l.log(r.LogTraceArea.MediaViewer,"presentMedia, causeId: "+i),this._handleCaching(t,i),this._viewerHasFocus!==t&&(this._onFocusChanged(t,i),t?(this.props.onPauseAutoAdvance(),this.props.controller.onHideMedia&&this.props.controller.onHideMedia(this.props.media)):this.props.controller.onShowMedia&&this.props.controller.onShowMedia(this.props.media)),(0,d.default)(this._viewerBounds,e)||(this._currentScale=this._defaultScale,this._viewerBounds=e,this._currentTranslateX=0,this._currentTranslateY=0,this._nonZoomModeTranslateX=0,this._nonZoomModeTranslateY=0,this._containerAnimatedWidthValue.setValue(this._viewerBounds.width),this._containerAnimatedHeightValue.setValue(this._viewerBounds.height),this._containerWidth=this._viewerBounds.width,this._containerHeight=this._viewerBounds.height,this._containerAnimatedTranslateXValue.setValue(0),this._containerAnimatedTranslateYValue.setValue(0),this._containerAnimatedScaleValue.setValue(this._defaultScale)),this._containerAnimatedOpacityValue.setValue(1),this.props.backgroundOpacityValue.setValue(1),s&&this._onCompleteOpen()}canAnimateOpenClose(){return!1}animateOpen(e){const t=o.Defer();this._viewerBounds={width:e.width,height:e.height},this._viewerHasFocus=!0,this.props.onPauseAutoAdvance();const s=this._fitToContainerSafe(this._viewerBounds);this._containerAnimatedWidthValue.setValue(this._viewerBounds.width),this._containerAnimatedHeightValue.setValue(this._viewerBounds.height),this._containerWidth=this._viewerBounds.width,this._containerHeight=this._viewerBounds.height,this._currentScale=this._defaultScale,this._currentTranslateX=0,this._currentTranslateY=0,this._nonZoomModeTranslateX=0,this._nonZoomModeTranslateY=0;let n=o.Resolved(void 0);return this.props.controller.getInitFromComponentPosition?n=this.props.controller.getInitFromComponentPosition():this.props.controller.getMediaLocationInWindow&&(n=this.props.controller.getMediaLocationInWindow(this.props.media)),n.then((e=>{let o=this._calcAnimateFromLocation(e);const n=o.width?o.width/s.width:this._currentScale,r=o.x?o.x-(1-n)*this._viewerBounds.width/2-n*(this._viewerBounds.width-s.width)/2:this._currentTranslateX,a=o.y?o.y-(1-n)*this._viewerBounds.height/2-n*(this._viewerBounds.height-s.height)/2:this._currentTranslateY;this._containerAnimatedScaleValue.setValue(n),this._containerAnimatedTranslateXValue.setValue(r),this._containerAnimatedTranslateYValue.setValue(a),this._containerAnimatedOpacityValue.setValue(1),this.props.backgroundOpacityValue.setValue(0),this._completeOpenAnimation=()=>{this.props.controller.onHideMedia&&this.props.controller.onHideMedia(this.props.media),this._animateZoom(0,0,this._defaultScale,i.Animated.Easing.Out(),(()=>{this._onCompleteOpen(),t.resolve(void 0)})),this._completeOpenAnimation=void 0},this._animate()})).fail((()=>{this._containerAnimatedScaleValue.setValue(this._defaultScale),this._containerAnimatedTranslateXValue.setValue(0),this._containerAnimatedTranslateYValue.setValue(0),this._containerAnimatedOpacityValue.setValue(1),this._onCompleteOpen(),t.resolve(void 0)})),t.promise()}animateClose(e,t){let s=o.Defer();if(this.canAnimateOpenClose()){this._viewerBounds||(this._viewerBounds={width:0,height:0});let o=[i.Animated.timing(this.props.backgroundOpacityValue,{toValue:0,duration:this._openCloseAnimationDuration,easing:i.Animated.Easing.Linear()})];if(e){let t=this._calcAnimateFromLocation(e);const s=this._fitToContainerSafe(this._viewerBounds),n=t.width?t.width/s.width:this._currentScale,r=t.x-(1-n)*this._viewerBounds.width/2-n*(this._viewerBounds.width-s.width)/2,a=t.y-(1-n)*this._viewerBounds.height/2-n*(this._viewerBounds.height-s.height)/2;o.push(i.Animated.timing(this._containerAnimatedScaleValue,{toValue:n,duration:this._openCloseAnimationDuration,easing:i.Animated.Easing.In()})),o.push(i.Animated.timing(this._containerAnimatedTranslateXValue,{toValue:r,duration:this._openCloseAnimationDuration,easing:i.Animated.Easing.In()})),o.push(i.Animated.timing(this._containerAnimatedTranslateYValue,{toValue:a,duration:this._openCloseAnimationDuration,easing:i.Animated.Easing.In()}))}else t===h.DismissAnimationType.Vertical?o.push(i.Animated.timing(this._containerAnimatedTranslateYValue,{toValue:this._viewerBounds.height,duration:this._openCloseAnimationDuration,easing:i.Animated.Easing.Out()})):t===h.DismissAnimationType.Horizontal&&o.push(i.Animated.timing(this._containerAnimatedTranslateXValue,{toValue:-1*this._viewerBounds.width,duration:this._openCloseAnimationDuration,easing:i.Animated.Easing.Out()}));i.Animated.parallel(o).start((()=>{this.isComponentMounted()&&this.props.controller.onShowMedia&&this.props.controller.onShowMedia(this.props.media),s.resolve(void 0)}))}else this.close(),s.resolve(void 0);return s.promise()}close(){this.props.backgroundOpacityValue.setValue(0),this.props.controller.onShowMedia&&this.props.controller.onShowMedia(this.props.media)}prefetchMediaToCacheIfSupported(e,t,s,i){const n=p.default.newCauseId();if(l.log(r.LogTraceArea.MediaViewer,"prefetchMediaToCacheIfSupported, causeId: "+n),a.default.isLocalCacheSupported()){let d=Date.now()+i;const h=a.default.getLocalUri(e);if(h||!s)return o.Resolved(h||t);const p=new c.QueueItem(e,t,s,"mediaViewer",d,a.CacheEvictionKind.Preview,Date.now());return c.default.add(p,n).then((s=>{if(!s.cancelled)return s.url;l.log(r.LogTraceArea.MediaViewer,"Media prefetching cancelled for:",e,u.dev_unknownOmit(t))})).catch((s=>{l.error(r.LogTraceArea.MediaViewer,"Something went wrong in prefetching media to cache: "+e+" "+u.dev_unknownOmit(t))}))}return o.Resolved(t)}cancelPrefetchIfPending(e,t){a.default.isLocalCacheSupported()&&e&&c.default.resetTag("mediaViewer",e,t)}}t.MediaViewer=g},49636:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MediaViewerFactory=void 0;const i=s(16778),o=s(63979),n=s(22669),r=s(48790),a=s(54288);t.MediaViewerFactory=class{static allocateMediaViewerControlsStore(e){switch(e.mediaType){case n.PictureViewer.MediaType:return null;case r.VideoViewer.MediaType:const t=e;return new a.VideoViewerControlsStore(t.useGlobalMute);default:return null}}static renderViewer(e,t){switch(e.mediaType){case n.PictureViewer.MediaType:return i.createElement(n.PictureViewer,Object.assign({media:e},t));case r.VideoViewer.MediaType:return i.createElement(r.VideoViewer,Object.assign({media:e},t));case o.CallGalleryEmptyViewer.MediaType:return i.createElement(o.CallGalleryEmptyViewer,Object.assign({media:e},t));default:return null}}}},42653:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FooterContainerSize=void 0;const i=s(96486),o=s(16778),n=s(34339),r=s(97775),a=s(77381),l=s(87399),d=s(13944),c=s(15877),h=s(33754),u=s(70561),p=s(18078),g=s(99097),m=s(2989),S=s(72828),f=s(81760),y=s(11828),_=s(34528);t.FooterContainerSize=48;const v=(0,c.lazyProperties)({footerContainer:()=>o.Styles.createViewStyle({flex:1,flexDirection:"row"}),share:()=>(0,c.lazyProperties)({container:()=>o.Styles.createViewStyle({height:t.FooterContainerSize,width:t.FooterContainerSize,alignItems:"center",justifyContent:"center"}),button:()=>o.Styles.createTextStyle({height:t.FooterContainerSize,width:t.FooterContainerSize})}),centerControl:()=>(0,c.lazyProperties)({wrapper:()=>o.Styles.createViewStyle({flex:1,height:t.FooterContainerSize,paddingHorizontal:10}),container:()=>o.Styles.createViewStyle({paddingVertical:10,flexDirection:"row",alignItems:"flex-end"}),containerRTL:()=>o.Styles.createViewStyle({flexDirection:"row-reverse"})}),react:()=>(0,c.lazyProperties)({container:()=>o.Styles.createViewStyle({height:t.FooterContainerSize,flexDirection:"row",alignItems:"center",justifyContent:"center"}),button:()=>o.Styles.createTextStyle({height:t.FooterContainerSize,width:t.FooterContainerSize,justifyContent:"center"})}),scrollViewRTL:()=>o.Styles.createViewStyle({flexDirection:"row-reverse",transform:[{scaleX:-1}]}),flippedView:()=>o.Styles.createViewStyle({transform:[{scaleX:-1}]})});class C extends a.default{constructor(){super(...arguments),this._androidFileToBeDeletedOnUnmount=[],this._onMediaViewerOptionComplete=(e,t,s)=>{t===u.MenuOptions.Delete&&this.props.onDelete&&this.props.onDelete(),s&&this._androidFileToBeDeletedOnUnmount.push(s)},this._onActionMenuPress=e=>{let t;u.default.showWithConfig({message:this.props.message,mediaDescriptor:this.props.mediaDescriptor,componentContext:this._getContext(),anchor:()=>this._actionMenuButton,onComplete:this._onMediaViewerOptionComplete,onDownloadDelay:t,invokingEvent:e})},this._getCurrentMessage=()=>this.props.message,this._showSpinnerDelayShare=e=>{this.props.onShowSpinnerDelayShare&&this.props.onShowSpinnerDelayShare(e)},this._onActionMenuButtonRef=e=>{this._actionMenuButton=e||void 0}}_buildState(e,t){return{isMriBlocked:l.isConversationBlocked(e.message.conversationId)}}_renderLeftButton(){let e;if(!this.props.hideLeftButton){const t=this.props.leftButton&&this.props.leftButton.coachMarkType?o.createElement(r.default.IconButton,{anchorRef:this._onActionMenuButtonRef,size:y.IconSize.size24,style:v.share.button,onPress:this.props.leftButton.onPress,color:f.Color.white,hoverColor:f.Color.gray300,icon:this.props.leftButton.icon,title:this.props.leftButton.title,coachMarkType:this.props.leftButton.coachMarkType,anchorAccessibilityLabel:this.props.leftButton.title}):o.createElement(d.default,{ref:this._onActionMenuButtonRef,size:y.IconSize.size24,style:v.share.button,onPress:this.props.leftButton?this.props.leftButton.onPress:this._onActionMenuPress,color:f.Color.white,hoverColor:f.Color.gray300,icon:this.props.leftButton?this.props.leftButton.icon:_.shareIcon(),title:this.props.leftButton?this.props.leftButton.title:h.getString("MediaViewer.ShareButtonTitle")});e=o.createElement(o.View,{style:v.share.container},t)}return e}_renderCenterControl(){let e;if(!this.props.hideReactionPills&&!this.state.isMriBlocked)if(this.props.middleComponent)e=this.props.middleComponent;else if(!i.isEmpty(this.props.message.getReactions())){const t=this._getContext().isRTL;e=o.createElement(o.ScrollView,{key:this.props.message?this.props.message.cuid:void 0,style:t?v.scrollViewRTL:void 0,horizontal:!0,vertical:!1,showsHorizontalScrollIndicator:!1,showsVerticalScrollIndicator:!1},o.createElement(m.default,{style:[v.centerControl.container,t?v.centerControl.containerRTL:void 0],message:this.props.message,reactionSize:n.Size.Small,itemStyle:t?v.flippedView:void 0}))}return o.createElement(o.View,{style:v.centerControl.wrapper},e)}_renderRightButton(){let e,t,s;if(this.props.hideRightReactionButton||p.default.isMyMri(this.props.message.creator)||this.state.isMriBlocked||(t=o.createElement(S.default,{message:this._getCurrentMessage,isMessageKnownByServer:this.props.message.isAnyVersionKnownByServer(),style:v.react.button,colorOverride:f.Color.white,sizeOverride:y.IconSize.size24,hideAlternateReactionPacks:this.props.hideAlternateReactionPacks,keepOpenAfterReactionSelected:this.props.keepOpenAfterReactionSelected,onReactionSelected:this.props.onReactionSelected,coachMarkType:this.props.reactionButtonCoachmarkType})),this.props.additionalRightButton){const e={size:y.IconSize.size24,style:v.react.button,onPress:this.props.additionalRightButton.onPress,color:f.Color.white,hoverColor:f.Color.gray300,icon:this.props.additionalRightButton.icon,title:this.props.additionalRightButton.title};s=this.props.additionalRightButton.coachMarkType?o.createElement(r.default.IconButton,Object.assign({},e,{coachMarkType:this.props.additionalRightButton.coachMarkType,anchorAccessibilityLabel:this.props.additionalRightButton.title})):o.createElement(d.default,Object.assign({},e))}return(t||s)&&(e=o.createElement(o.View,{style:v.react.container},t,s)),e}componentWillUnmount(){super.componentWillUnmount(),this._androidFileToBeDeletedOnUnmount.length>0&&i.each(this._androidFileToBeDeletedOnUnmount,(e=>{g.default.androidRemoveFromPublicFolder(e).finally((()=>{this._androidFileToBeDeletedOnUnmount=[]}))}))}render(){const e=this._renderLeftButton(),t=this._renderCenterControl(),s=this._renderRightButton();return o.createElement(o.View,{style:v.footerContainer},e,t,s)}}t.default=C},70561:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MenuOptions=void 0;const i=s(74377),o=s(62520),n=s(19784),r=s(89391),a=s(65976),l=s(71830),d=s(47204),c=s(98278),h=s(86374),u=s(66957),p=(s(6452),s(46096)),g=s(7234),m=s(53559),S=s(19596),f=s(66649),y=s(36237),_=s(33754),v=s(87946),C=(s(14597),s(83503)),b=s(64387),T=s(42036),M=s(12056),I=s(10909),w=s(78735),P=s(18078),k=s(4735),A=s(22669),E=(s(99097),s(4057)),R=s(93194),L=s(40363),F=(s(26712),s(53374)),x=s(48790);var O;!function(e){e[e.Save=0]="Save",e[e.SaveAs=1]="SaveAs",e[e.Open=2]="Open",e[e.OpenMediaLocation=3]="OpenMediaLocation",e[e.Copy=4]="Copy",e[e.Share=5]="Share",e[e.Delete=6]="Delete",e[e.Report=7]="Report",e[e.ViewProfile=8]="ViewProfile",e[e.Unfollow=9]="Unfollow",e[e.Forward=10]="Forward",e[e.Hide=11]="Hide"}(O=t.MenuOptions||(t.MenuOptions={}));const D=R.default.menuId();t.default=new class{showWithConfig(e){this._show(e.message,e.componentContext,e.invokingEvent,e.mediaDescriptor,e.onComplete,e.deleteConfirmationDialogTitle,e.deleteConfirmationDialogContent,e.onDownloadDelay,e.anchor,e.reportContextType,e.hideConfirmationDialogTitle,e.hideConfirmationDialogContent)}_show(e,t,s,i,o,n,r,a,l,d,c,h){const u=this.getMediaViewerOptions(e,i);if(!u.length)return;const p=this.createMenuCallback(e,t,i,o,n,r,a,d,c,h),g={anchor:()=>l?l():void 0,useTheme:!0,popupDisableContextMenu:!0,positionPriorities:["bottom","left","right","top"],popupBeakSize:{height:0,width:0}};R.default.showWithOptions({id:D,config:g,getMenuItems:()=>u,handleMenuCommand:p,delay:1,maintainAnchor:!0,rootViewId:t.rootViewId,invokingEvent:s})}getMediaViewerOptions(e,t){const s=P.default.isMyMri(e.creator);let i=[];return f.default.isUsingGogoNetwork()||i.push({text:C.getSaveToDirectoryLocalizationString(e),command:O[O.Save],icon:c.SXMenuIcon.SaveTo}),t||(i.push({text:_.getString("MessageActionMenu.ShareMenuForward"),command:O[O.Forward],icon:c.SXMenuIcon.Forward}),s&&!l.isBookmarkConversation(e.conversationId)&&i.push({text:_.getString("MessageActionMenu.ShareMenuRemove"),command:O[O.Delete],icon:c.SXMenuIcon.Delete})),i}createMenuCallbackWithConfig(e){return this.createMenuCallback(e.message,e.componentContext,e.mediaDescriptor,e.onComplete,e.deleteConfirmationDialogTitle,e.deleteConfirmationDialogContent,e.onDownloadDelay,e.reportContextType,e.hideConfirmationDialogTitle,e.hideConfirmationDialogContent,e.view)}createMenuCallback(e,t,s,i,o,n,r,a,l,d,c){return h=>this._onActionPressCommand(e,h,t,o,n,i,r,s,a,l,d,c)}_onActionPressCommand(e,t,s,i,o,n=((e,t,s)=>{}),r=(e=>{}),a,l,c,g,m){const f=F.default.newCauseId();y.log(p.LogTraceArea.MessageActionMenu,"onActionPressCommand, causeId: "+f),d.default.dismissPopup(D,s.rootViewId);const _=O[t];if(t&&"cancel"===t.toLowerCase())n&&n(!0,_);else switch(_){case O.Delete:let t;i&&o&&(t={title:i,body:o}),T.default.deleteMessage(e,s.rootViewId,t,(()=>n&&n(!0,_)));break;case O.Copy:this._copyImage(e,a);break;case O.SaveAs:this._saveAs(e,a,f,m,s.rootViewId);break;case O.OpenMediaLocation:this._openMediaLocation(e);break;case O.Open:case O.Save:case O.Share:this._downloadFileAndHandleCommand(e,a,_,s.rootViewId,f,n,r);break;case O.Report:const d={mriToBlock:e.creator,rootViewId:s.rootViewId,content:e,reportContext:l,isBlockingDialog:!1};k.default.navigateToReportConcernModal(d);break;case O.ViewProfile:const p=u.DetailsPanelOrigin.Unknown;k.default.showDetailsPanelWithParams({mri:e.creator,rootViewId:s.rootViewId,origin:p,causeId:f});break;case O.Forward:const y={message:e,node:h.decode(e)};S.forwardMessages([y],M.MessageActionOrigin.StreamItemDesktopContextMenu,e.conversationId,void 0,s);break;case O.Hide:this._hideConfirmationAlert(e,s.rootViewId,c,g,n);break;default:n&&n(!0,_)}}_hideConfirmationAlert(e,t,s,i,o){let r=s||"",a=i||"";const l=[{text:_.getString("Global.CancelLabel"),isCancel:!0},{text:_.getString("Global.HideLabel"),isSubmit:!0}];n.default.showWithOptions({title:r,dialogAccessibilityTitle:a||r,message:a,buttons:l,rootViewId:t})}_downloadFileAndHandleCommand(e,t,s,i,o,n,r){let l="",d="";const c=t&&t.id||a.getFileCacheKeyMedia(e,!0);switch((t=t||b.default.getMediaDescriptorForItem(e))&&t.mediaType){case A.PictureViewer.MediaType:l=t.downloadFileName,d=t.fullResolutionUrl;break;case x.VideoViewer.MediaType:l=t.downloadFileName,d=t.videoUrl;break;default:return}l&&this._handleUri(e,s,d,l,c,i,o,n)}_openMediaLocation(e){T.default.openMediaLocationOnDesktop(e)}_saveAs(e,t,s,i,o){let n="",r="";switch((t=t||b.default.getMediaDescriptorForItem(e))&&t.mediaType){case A.PictureViewer.MediaType:n=t.downloadFileName,r=t.fullResolutionUrl;break;case x.VideoViewer.MediaType:n=t.downloadFileName,r=t.videoUrl;break;default:return}const l=a.getFileCacheKeyMedia(e,!0);T.default.desktopSaveAs(l,n,r,s,e,o,i),t&&t.mediaType===A.PictureViewer.MediaType&&y.track(new v.MediaDownloadTelemetryEvent(e,v.MediaDownloadActionOrigin.MediaViewer,v.MediaDownloadReason.SaveAs,m.default.extractFileExtension(n)))}_copyImage(e,t){t||b.default.getMediaDescriptorForItem(e)}_handleUri(e,t,s,i,n,a,l,d){if(t===O.Save){const t=r.default.getS4LMessagingFeaturesNoSubscription().enableCustomFileDownloadLocation,d=w.default.getUserPreferencesLocal(),c=t&&d.fileDownloadPathDesktop?o.join(d.fileDownloadPathDesktop,i):i;T.default.saveToDesktop(e,s,c,n,l,a,!1),y.track(new v.MediaDownloadTelemetryEvent(e,v.MediaDownloadActionOrigin.MediaViewer,v.MediaDownloadReason.SaveToDownloads,m.default.extractFileExtension(i)))}else O.Open,0}_share(e,t,s){let o={url:e,action:L.default.getPlatformType()===p.PlatformType.Android?"send":void 0};i.default.show(o,(e=>{y.error(p.LogTraceArea.MessageActionMenu,E.default.errorAsString(e)),s&&s(!1,t)}),((e,i)=>{y.log(p.LogTraceArea.MessageActionMenu,"Succesfully share to "+i),s&&s(e,t)}))}_onFileDownloadUpdate(e,t,s,i,o,n,r,a,l,d,c){if(i.isFinished&&o===i.key){if(i.isCached){const e=g.default.getLocalUri(o);if(!e)return void y.warn(p.LogTraceArea.MessageActionMenu,"The file finish downloading but the localURI is not valid.",o);this._handleUri(t,s,e,r,o,n,l,d)}else this._showToastOnError(s,a),y.error(p.LogTraceArea.MessageActionMenu,"The file download finish with an error.");c&&c(!1),e.unsubscribe()}}_showToastOnError(e,t){let s;e===O.Save?s=t===A.PictureViewer.MediaType?"MessageActionMenu.PhotoSaveFailNotification":"MessageActionMenu.VideoSaveFailNotification":e===O.Share&&(s=t===A.PictureViewer.MediaType?"MessageActionMenu.PhotoShareFailNotification":"MessageActionMenu.VideoShareFailNotification"),s&&I.default.scheduleTextMessage(_.getString(s),void 0,c.MainRootViewId)}}},5795:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(44770),r=s(97691),a=s(89391),l=s(51577),d=s(96074),c=s(51077),h=s(3056),u=s(98278),p=s(73145),g=s(46096),m=s(7234),S=s(13944),f=s(36237),y=s(61253),_=s(72490),v=s(47126),C=s(15877),b=s(33754),T=s(7580),M=s(49636),I=s(45983),w=s(70561),P=s(6250),k=s(30124),A=s(51070),E=s(81115),R=s(36150),L=s(49603),F=s(12187),x=s(81760),O=s(40363),D=s(11828),B=s(34528),V=s(60305),N=s(12770),U=s(53374),H=s(48790),z="viewerPaused",W="advanceMedia",j="optionalPanel",G=T.AnimationDuration,K="viewer-",q=1e4,Q=D.IconSize.default,X=(0,C.lazyProperties)({viewerContainer:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch",justifyContent:"flex-start",alignItems:"center",overflow:"visible"}),viewerBackground:()=>o.Styles.createViewStyle({position:"absolute",left:-1e4,right:-1e4,top:-1e4,bottom:-1e4,overflow:"visible",backgroundColor:x.Color.black,alignItems:"center",justifyContent:"center"}),viewerBackgroundDesktop:()=>o.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,bottom:0,backgroundColor:x.Color.black,alignItems:"center",justifyContent:"center"}),stageContainer:()=>o.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,bottom:0,overflow:"visible"}),controlBarContainer:()=>o.Styles.createViewStyle({position:"absolute",left:0,right:0,flexDirection:"row",alignItems:"center",justifyContent:"flex-start"}),previousButtonContainer:()=>o.Styles.createViewStyle({position:"absolute",left:-Q,top:0,bottom:0,justifyContent:"center",overflow:"visible"}),navigationButtonBase:()=>o.Styles.createViewStyle({paddingVertical:35,backgroundColor:x.Color.blackOverlay65}),previousButton:()=>o.Styles.createViewStyle({left:Q,paddingLeft:14}),nextButtonContainer:()=>o.Styles.createViewStyle({position:"absolute",right:-Q,top:0,bottom:0,justifyContent:"center",overflow:"visible"}),nextButton:()=>o.Styles.createViewStyle({right:Q,paddingRight:14}),gradientImage:()=>o.Styles.createImageStyle({position:"absolute",top:0,bottom:0,right:0,left:0,backgroundColor:x.Color.transparent}),gradientImageFlipped:()=>o.Styles.createImageStyle({transform:[{scaleY:-1}]}),overlayControlsContainer:()=>o.Styles.createViewStyle({bottom:0}),customHeaderContainer:()=>o.Styles.createViewStyle({flex:1,flexDirection:"row",alignSelf:"stretch",alignItems:"flex-start"}),customHeaderIconFontContainer:()=>o.Styles.createButtonStyle({width:48,height:48}),mobilePreviousButtonContainer:()=>o.Styles.createViewStyle({position:"absolute",left:0,top:0,bottom:0,justifyContent:"center",overflow:"visible"}),mobileNextButtonContainer:()=>o.Styles.createViewStyle({position:"absolute",right:0,top:0,bottom:0,justifyContent:"center",overflow:"visible"}),mobileNextButton:()=>o.Styles.createViewStyle({right:0,paddingVertical:10,paddingRight:14,paddingLeft:0,backgroundColor:x.Color.blackOverlay50}),mobilePreviousButton:()=>o.Styles.createViewStyle({left:0,paddingVertical:10,paddingRight:0,paddingLeft:14,backgroundColor:x.Color.blackOverlay50})});class $ extends d.default{constructor(e){super(e),this._isFirstLayout=!0,this._controlsShown=!1,this._headerFooterShown=!1,this._isClosing=!1,this._currentTranslateY=0,this._isAnimatingOpen=!0,this._shouldDismissOverlay=!1,this._overlayShown=!1,this._showControlsOnMobile=!0,this._autoHideHeaderFooter=!1,this._overrideShowMouseControls=!1,this._disableGestureForContextMenu=!1,this._isClosingOnSwipeDown=!1,this._advanceToNext=!1,this._advanceToPrevious=!1,this._pauseAutoAdvanceReasons={},this._backgroundOpacityAnimatedValue=new o.Animated.Value(0),this._backgroundOpacityAnimatedStyle=o.Styles.createAnimatedViewStyle({opacity:this._backgroundOpacityAnimatedValue}),this._stageContainerXOffsetValue=new o.Animated.Value(0),this._stageContainerXOffsetStyle=o.Styles.createAnimatedViewStyle({transform:[{translateX:this._stageContainerXOffsetValue}]}),this._mouseControlsOpacityLeftValue=new o.Animated.Value(0),this._mouseControlsOpacityLeftStyle=o.Styles.createAnimatedViewStyle({opacity:this._mouseControlsOpacityLeftValue}),this._mouseControlsOpacityRightValue=new o.Animated.Value(0),this._mouseControlsOpacityRightStyle=o.Styles.createAnimatedViewStyle({opacity:this._mouseControlsOpacityRightValue}),this._topControlBarAnimatedOpacityValue=new o.Animated.Value(0),this._topControlBarAnimatedStyle=o.Styles.createAnimatedViewStyle({opacity:this._topControlBarAnimatedOpacityValue}),this._bottomControlBarAnimatedOpacityValue=new o.Animated.Value(0),this._bottomControlBarAnimatedStyle=o.Styles.createAnimatedViewStyle({opacity:this._bottomControlBarAnimatedOpacityValue}),this._mediaViewerRefsMap=new P.default,this._containerRefsMap=new P.default,this._contextMenuRefsMap=new P.default,this._onCloseIconButtonRef=e=>{this._closeIconButton=e||void 0},this._onPreviousIconButtonRef=e=>{this._previousIconButton=e||void 0},this._onNextIconButtonRef=e=>{this._nextIconButton=e||void 0},this._onMainViewRef=e=>{this._mainView=e||void 0},this._setOverrideShowMouseControls=e=>{this._overrideShowMouseControls=!!e,e||this._startAutoHideControlsTimer()},this._toggleAllControlsOnMobileOnTap=e=>{this._isMobileOrTablet()&&(this._showControlsOnMobile=void 0!==e?e:!this._showControlsOnMobile,this._showHideScrubberControlForVideo(this._showControlsOnMobile),this._maybeToggleHeaderFooter(this._showControlsOnMobile),this._clearAutoHideControlsTimer(),this._showControlsOnMobile&&this._autoHideHeaderFooter&&this._startAutoHideControlsTimer())},this._onVideoEnded=()=>{const e=this._getVideoViewer();this._syncControlsVisibility(),this._onShowHideControls(!0),e&&e.setPauseButtonVisibility(!0)},this._autoHideHeaderFooterControls=e=>{this._autoHideHeaderFooter=e,e?this._showControlsOnMobile&&this._startAutoHideControlsTimer():this._clearAutoHideControlsTimer()},this._keyboardNavigationStateChanged=e=>{this._onShowHideControls(e),this._onShowHideHeaderFooter(e)},this._getCloseButtonAccessibilityLabel=()=>{const e=this._getCurrentViewer();return e?e.getCloseButtonAccLabel():""},this._invalidateCache=()=>{const e=this._getCurrentMediaInfo();if(1!==this.state.viewers.length||!e||0!==e.visualIndex){let t=[];t.push(e);let s=this.props.controller.getNextMedia?this.props.controller.getNextMedia(e.mediaDescriptor):void 0;s&&t.push($._allocateMediaViewerInfo(s,e.visualIndex+1,this._viewerBounds.width));let i=this.props.controller.getPreviousMedia?this.props.controller.getPreviousMedia(e.mediaDescriptor):void 0;i&&t.push($._allocateMediaViewerInfo(i,e.visualIndex-1,this._viewerBounds.width)),this._stageContainerXOffsetValue.setValue(0),this._clearAllPauseAutoAdvanceReasons(),this.setState({viewers:t})}let t=i.find(this.state.viewers,(e=>0===e.visualIndex));t&&this.props.controller.onMediaIsInFocus&&this.props.controller.onMediaIsInFocus(t.mediaDescriptor)},this._onMouseMove=e=>{this._controlsShown?this._previousMousePosition=void 0:(this._previousMousePosition&&(Math.abs(this._previousMousePosition.x-e.pageX)>2||Math.abs(this._previousMousePosition.y-e.pageY)>2)&&this._showControls(),this._previousMousePosition={x:e.pageX,y:e.pageY})},this.showPrevious=()=>{this._setPauseAutoAdvanceReason(W),this._onAdvanceMedia(!1)},this.showNext=()=>{this._setPauseAutoAdvanceReason(W),this._onAdvanceMedia(!0)},this._onKeyUp=e=>{if(!this.props.controller.getOptions().disableSwipeLeftRight){if(!0===e.ctrlKey||!0===e.altKey||!0===e.metaKey)return!1;if(e.keyCode===v.default.LEFT)return this.showPrevious(),!0;if(e.keyCode===v.default.RIGHT)return this.showNext(),!0}return!1},this._onEscape=()=>(this._close(),!0),this._onLayoutViewer=e=>{let t=this._viewerBounds&&(this._viewerBounds.width!==e.width||this._viewerBounds.height!==e.height);this._viewerBounds={width:e.width,height:e.height};const s=U.default.newCauseId();f.log(g.LogTraceArea.MediaViewer,"_onLayoutViewer, causeId: "+s),i.each(this.state.viewers,(t=>{this._updateViewerXOffset(t);let i=this._mediaViewerRefsMap.ref(K+t.mediaDescriptor.id);this._isFirstLayout&&this._canAnimateOpenClose()?i?i.animateOpen(e).then(this._performPostMediaOpenTasks):this._performPostMediaOpenTasks():(i&&i.presentMedia(this._viewerBounds,0===t.visualIndex,this._isFirstLayout,s),this._isFirstLayout&&this._performPostMediaOpenTasks())})),this._isFirstLayout=!1,t&&!this._isClosing&&this.isComponentMounted()&&this.forceUpdate()},this._performPostMediaOpenTasks=()=>{const e=U.default.newCauseId();f.log(g.LogTraceArea.MediaViewerPanel,"_performPostMediaOpenTasks, causeId: "+e),this._isAnimatingOpen=!1,this.props.onOpen&&this.props.onOpen(),this._maybeToggleHeaderFooter(!1,!0),this._showControls(),this._loadPreviousAndNext(),this._presentMediaForAllViewers(!0,e),this.isComponentMounted()&&this.forceUpdate(),this._onViewerRendered()},this._onShowHideControls=e=>{this._controlsShown!==e&&this._toggleControls()},this._onShowHideHeaderFooter=e=>{this._headerFooterShown!==e&&this._maybeToggleHeaderFooter()},this._maybeToggleHeaderFooter=(e=!1,t=!1)=>{this.props.disableHeaderFooterAutoDismiss&&!t||this._animateHeaderFooter(e)},this._animateHeaderFooter=e=>{this._headerFooterAnimation&&this._headerFooterAnimation.stop(),this._headerFooterShown=!!this.state.isMobileScreenReaderEnabled||(e||!this._headerFooterShown),this._addRemoveHeaderFooterFromView(!0);let t=this._headerFooterShown?1:0;this._headerFooterAnimation=o.Animated.parallel([o.Animated.timing(this._topControlBarAnimatedOpacityValue,{toValue:t,duration:G,easing:o.Animated.Easing.InOut()}),o.Animated.timing(this._bottomControlBarAnimatedOpacityValue,{toValue:t,duration:G,easing:o.Animated.Easing.InOut()})]),this._headerFooterAnimation.start((e=>{e.finished&&this.isComponentMounted()&&(this._headerFooterAnimation=void 0),this._addRemoveHeaderFooterFromView(this._headerFooterShown)}))},this._toggleControls=()=>{if(this.isComponentMounted()){this._controlsAnimation&&this._controlsAnimation.stop(),this._controlsShown=!this._controlsShown;let e=this._controlsShown?1:0;this._controlsAnimation=o.Animated.parallel([o.Animated.timing(this._mouseControlsOpacityLeftValue,{toValue:e,duration:500,easing:o.Animated.Easing.InOut()}),o.Animated.timing(this._mouseControlsOpacityRightValue,{toValue:e,duration:500,easing:o.Animated.Easing.InOut()})]);const t=this._getVideoViewer();this._isMobileOrTablet()||(this._maybeToggleHeaderFooter(this._controlsShown),t&&t.setScrubberControlsVisibility(this._controlsShown)),this._isClosingOnSwipeDown?t&&t.setPauseButtonVisibility(this._controlsShown):this._controlsAnimation.start((e=>{e.finished&&this.isComponentMounted()&&(this._controlsAnimation=void 0,t&&t.setPauseButtonVisibility(this._controlsShown))})),this._clearAutoHideControlsTimer(),this._controlsShown&&this._startAutoHideControlsTimer()}},this._isMediaVideo=()=>{const e=this.getCurrentMediaDescriptor();return(null==e?void 0:e.mediaType)===H.VideoViewer.MediaType},this._onPauseAutoAdvance=()=>{this._setPauseAutoAdvanceReason(z),this._autoAdvanceTimer&&(N.default.clearTimeout(this._autoAdvanceTimer),this._autoAdvanceTimer=void 0)},this._onResumeAutoAdvance=e=>{this._clearPauseAutoAdvanceReason(z,e)},this._onViewerRendered=()=>{N.default.setTimeout((()=>{this._closeIconButton&&this._closeIconButton.requestFocus()}),1e3)},this._onTap=e=>{if(this.props.controller.onTap&&(this._overlayShown=this.props.controller.onTap(e)===I.AnimateOverlayState.ShowOverlay,this._overlayShown))return this.props.controller.animateOverlayPanel&&this.props.controller.animateOverlayPanel(),void(this._overlayShown=!1)},this._onContextMenu=(e,t)=>{const s=this._contextMenuRefsMap.ref(e);this._disableGestureForContextMenu=!0,s&&s.showOnTap(t)},this._syncControlsVisibility=()=>{this._isMobileOrTablet()&&(this._showHideScrubberControlForVideo(this._showControlsOnMobile),this._autoHideHeaderFooterControls(!0))},this._onPanHorizontal=e=>{if(this._currentTranslateY<0)return;if(e.isComplete&&this._disableGestureForContextMenu)return void(this._disableGestureForContextMenu=!1);const t=e.pageX-e.initialPageX,s=Math.abs(t);if(this._stageContainerXOffsetValue.setValue(t),this._setPauseAutoAdvanceReason(W),this.props.controller.getOptions().animateOpenClose&&this.props.closeOnLastItemSwipe)if(t<0){if(!i.find(this.state.viewers,(e=>1===e.visualIndex))){const e=Math.min(this._viewerBounds.width/2,300),t=Math.max(e-s,0)/e;this._backgroundOpacityAnimatedValue.setValue(t),this._onShowHideHeaderFooter(!1)}}else this._backgroundOpacityAnimatedValue.setValue(1),this._onShowHideHeaderFooter(!0);if(e.isComplete){this.props.controller.onPanHorizontalComplete&&this.props.controller.onPanHorizontalComplete();const i=Math.min(this._viewerBounds.width/2,300),n=Math.abs(e.velocityX)>.1,r=s>i/2;this._clearPauseAutoAdvanceReason(W);let a=!0;if(r&&!n)a=!this._onAdvanceMedia(t<0);else if(n&&!r)a=!this._onAdvanceMedia(e.velocityX<0,!0);else{const s=t<0;s===e.velocityX<0&&(a=!this._onAdvanceMedia(s,!0))}a&&(this._onShowHideHeaderFooter(!0),o.Animated.parallel([o.Animated.timing(this._stageContainerXOffsetValue,{toValue:0,duration:T.AnimationDuration,easing:n?o.Animated.Easing.Out():o.Animated.Easing.InOut()})]).start())}},this._onPanVertical=e=>{if(this._isClosing)return;if(e.isComplete&&this._disableGestureForContextMenu)return void(this._disableGestureForContextMenu=!1);const t=this._getCurrentMediaInfo();let s=e.pageY-e.initialPageY,i=!1;this._onPauseAutoAdvance(),this._setPauseAutoAdvanceReason(j);const n=s<0&&this.props.controller.getOptions().showOverlayPanel;let r=!1;if(n&&(!this._autoHideHeaderFooter||this._controlsShown)){const e=this.props.controller.animateOverlayPanel?this.props.controller.animateOverlayPanel(s):void 0;this._shouldDismissOverlay=this._shouldDismissOverlay||e===I.AnimateOverlayState.HideOverlay,this._overlayShown=e!==I.AnimateOverlayState.ShowOverlay,r=e!==I.AnimateOverlayState.None}!r&&s>0&&!this._shouldDismissOverlay&&(this._isClosingOnSwipeDown=!0,this._onShowHideControls(!1),this._onShowHideHeaderFooter(!1),t.yOffsetValue.setValue(this._currentTranslateY+s));const a=Math.abs(s),l=Math.min(this._viewerBounds.height/2,300),d=n?1:Math.max(l-s,0)/l;this.props.controller.getOptions().animateOpenClose&&this._backgroundOpacityAnimatedValue.setValue(d),i=!!this.props.onDidClose&&(a>l/2||Math.abs(e.velocityY)>.35),e.isComplete&&(i&&s>0&&!this._shouldDismissOverlay?(this.props.controller.getOptions().animateOpenClose&&o.Animated.timing(t.yOffsetValue,{toValue:0,duration:T.AnimationDuration,easing:o.Animated.Easing.InOut()}).start(),this._isClosingOnSwipeDown=!0,this._close()):(this._isClosingOnSwipeDown=!1,this.setState({isAnimatingViewers:!0}),this._onResumeAutoAdvance(!1),this._clearPauseAutoAdvanceReason(j),this._currentTranslateY=0,this._onShowHideHeaderFooter(!0),this._onShowHideControls(!0),o.Animated.sequence([o.Animated.timing(t.yOffsetValue,{toValue:0,duration:T.AnimationDuration,easing:o.Animated.Easing.InOut()}),o.Animated.timing(this._backgroundOpacityAnimatedValue,{toValue:1,duration:T.AnimationDuration,easing:o.Animated.Easing.InOut()})]).start((()=>{this.isComponentMounted()&&this.setState({isAnimatingViewers:!1})}))),this._shouldDismissOverlay=!1)},this._onAdvanceMedia=(e,t=!1)=>{var s;const n=e?1:-1,r=i.find(this.state.viewers,(e=>e.visualIndex===n));if(f.log(g.LogTraceArea.MediaViewerPanel,"_onAdvanceMedia() mediaIndexToShow: "+n+" mediaToShow: "+(r&&r.mediaDescriptor?r.mediaDescriptor.id:"none")),!r){let e=!1;return 1===n?(this.props.closeOnLastItemSwipe&&(e=!0,this.close(I.DismissAnimationType.Horizontal)),this.props.onRightBoundSwipe&&(e=!0,this.props.onRightBoundSwipe())):-1===n&&this.props.onLeftBoundSwipe&&(e=!0,this.props.onLeftBoundSwipe()),e}const a=r;if(this.state.isAnimatingViewers)return!1;this.setState({isAnimatingViewers:!0});const l=(null===(s=a.mediaDescriptor)||void 0===s?void 0:s.mediaType)===H.VideoViewer.MediaType;e?o.Accessibility.announceForAccessibility(b.getString(l?"MediaViewer.OpeningNextVideo":"MediaViewer.OpeningNextImage")):o.Accessibility.announceForAccessibility(b.getString(l?"MediaViewer.OpeningPreviousVideo":"MediaViewer.OpeningPreviouseImage"));const d=this._viewerBounds.width+20;return o.Animated.parallel([o.Animated.timing(this._stageContainerXOffsetValue,{toValue:e?-d:d,duration:T.AnimationDuration,easing:t?o.Animated.Easing.Out():o.Animated.Easing.InOut()})]).start((()=>{if(this.isComponentMounted()){let t=[];const s=e?-1:1;if(i.each(this.state.viewers,(e=>{e.visualIndex+=s,this._updateViewerXOffset(e),e.visualIndex>=-1&&e.visualIndex<=1&&t.push(e)})),t=i.sortBy(t,(e=>e.visualIndex)),e){const e=i.last(t);if(!this.props.controller.getOptions().disableSwipeLeftRight&&this.props.controller.getNextMedia){const s=this._advanceToNext?void 0:this.props.controller.getNextMedia(e.mediaDescriptor);s?(this._advanceToNext=!1,this._advanceToPrevious=!1,t.push($._allocateMediaViewerInfo(s,e.visualIndex+1,this._viewerBounds.width))):(f.log(g.LogTraceArea.MediaViewerPanel,"_onAdvanceMedia() no media to advance to next"),i.delay((()=>{this._previousIconButton&&this._previousIconButton.requestFocus()}),700))}}else{const e=i.head(t);if(!this.props.controller.getOptions().disableSwipeLeftRight&&this.props.controller.getPreviousMedia){const s=this._advanceToPrevious?void 0:this.props.controller.getPreviousMedia(e.mediaDescriptor);s?(this._advanceToPrevious=!1,this._advanceToNext=!1,t.push($._allocateMediaViewerInfo(s,e.visualIndex-1,this._viewerBounds.width))):(f.log(g.LogTraceArea.MediaViewerPanel,"_onAdvanceMedia() no media to advance to previous"),i.delay((()=>{this._nextIconButton&&this._nextIconButton.requestFocus()}),700))}}this._stageContainerXOffsetValue.setValue(0),this._clearAllPauseAutoAdvanceReasons(),this.props.controller.onMediaIsInFocus&&this.props.controller.onMediaIsInFocus(a.mediaDescriptor),this.setState({viewers:t,isAnimatingViewers:!1})}})),!0},this._goBack=e=>(f.log(g.LogTraceArea.MediaViewerPanel,"MediaViewerPanel._goBack,  causeId: "+e),!this._getContext().isPresentedInDesktopContentPanel&&this._showCloseIcon()?(this._closeViewer(),!0):super._goBack(e)),this._close=()=>{this.props.onClose?this.props.onClose():this.close()},this.close=(e=I.DismissAnimationType.Default)=>!!this.props.onDidClose&&(this._closeViewer(!1,e),!0),this.showSpinnerForDelayShare=e=>{this.isComponentMounted()&&this.setState({showSpinner:e})},this._viewerBounds={width:q,height:q}}_buildState(e,t){let s={};const i=A.default.keepStatusBarVisible()?A.default.statusBarPadding():0,o=A.default.bottomSafeAreaInset(u.BottomInsetDefault),n=A.default.horizontalInsets(u.HorizontalInsetDefault);s.safeAreaInsets=Object.assign(Object.assign({},n),{top:i,bottom:o}),s.isUsingStackNavigationContext=k.default.isUsingStackNavigationContext(),s.streamVideo=a.default.getS4LCMCFeatures().enableStreamVideo,s.isMobileScreenReaderEnabled=R.default.isMobileScreenReaderEnabled(),s.isTablet=V.default.isTablet(),t&&(s.isAnimatingViewers=!1,s.showHeaderFooter=!0);const r=this.props;return(t||r.initialMedia&&e.initialMedia.id!==r.initialMedia.id)&&(f.log(g.LogTraceArea.MediaViewerPanel,"_buildState updating initialMedia "+e.initialMedia.id),s.viewers=[$._allocateMediaViewerInfo(e.initialMedia,0,q)]),s}componentDidMount(){super.componentDidMount();const e=U.default.newCauseId();f.log(g.LogTraceArea.MediaViewerPanel,"componentDidMount causeId: "+e),o.Input.keyUpEvent.subscribe(this._onKeyUp),_.default.addEscapeHandler(this._onEscape);const t=F.default.mergeStyles([o.StatusBar.isOverlay()?F.default.createHiddenStyle(!0):F.default.createBackgroundColorStyle(x.Color.black),F.default.createBarStyle(L.BarStyleTheme.Light)]);this._updateStatusBarStyle(t),o.UserInterface.keyboardNavigationEvent.subscribe(this._keyboardNavigationStateChanged),this.props.controller.onMediaViewerMounted&&this.props.controller.onMediaViewerMounted()}componentWillUnmount(){super.componentWillUnmount();const e=U.default.newCauseId();f.log(g.LogTraceArea.MediaViewerPanel,"componentWillUnmount causeId: "+e),o.Input.keyUpEvent.unsubscribe(this._onKeyUp),_.default.removeEscapeHandler(this._onEscape),o.UserInterface.keyboardNavigationEvent.unsubscribe(this._keyboardNavigationStateChanged),this._autoAdvanceTimer&&(N.default.clearTimeout(this._autoAdvanceTimer),this._autoAdvanceTimer=void 0),this._clearAutoHideControlsTimer(),this._closeViewer(!0)}componentDidUpdate(e,t,s){if(super.componentDidUpdate(e,t,s),!this._isAnimatingOpen){this.props.totalMedia===e.totalMedia&&(0,y.default)(e.initialMedia,this.props.initialMedia)||this._loadPreviousAndNext();const s=U.default.newCauseId();f.log(g.LogTraceArea.MediaViewer,"componentDidUpdate, causeId: "+s),this._presentMediaForAllViewers(!(0,y.default)(e.initialMedia,this.props.initialMedia),s),this._advanceToNext&&(f.log(g.LogTraceArea.MediaViewerPanel,"componentDidUpdate() Advancing to next"),this._onAdvanceMedia(!0,!0)),this._advanceToPrevious&&(f.log(g.LogTraceArea.MediaViewerPanel,"componentDidUpdate() Advancing to previous"),this._onAdvanceMedia(!1,!0)),!t.isMobileScreenReaderEnabled&&this.state.isMobileScreenReaderEnabled&&this._maybeToggleHeaderFooter()}}mediaViewerRef(e){return this._mediaViewerRefsMap.ref(e)}render(){const e=o.Styles.createViewStyle({width:this._viewerBounds.width,height:this._viewerBounds.height},!1);let t=i.map(this.state.viewers,(t=>{var s,i;const n="viewerContainer-"+((null===(s=t.mediaDescriptor)||void 0===s?void 0:s.mediaType)||"")+((null===(i=t.mediaDescriptor)||void 0===i?void 0:i.id)||"");return o.createElement(h.default,{goBack:this._goBack},o.createElement(o.Animated.View,{style:[X.stageContainer,t.xOffsetStyle],ref:this._containerRefsMap.onComponentRef(n),key:n},o.createElement(o.Animated.View,{style:[X.stageContainer,t.yOffsetStyle]},o.createElement(o.View,{style:e,key:"viewerContainer"},this._renderViewer(t)))))}));f.log(g.LogTraceArea.MediaViewerPanel,`Rendering viewers: ${JSON.stringify(this.state.viewers.map((e=>{var t,s;return`${null===(t=e.mediaDescriptor)||void 0===t?void 0:t.mediaType}-${null===(s=e.mediaDescriptor)||void 0===s?void 0:s.id} (${e.visualIndex})`})))}`);let s,r,l,d=[],c=Q;this.props.mouseControlsSize&&(c=this.props.mouseControlsSize),this.props.controller.getOptions().disableSwipeLeftRight||(i.find(this.state.viewers,(e=>-1===e.visualIndex))&&d.push(o.createElement(o.Animated.View,{key:"mouseControlsLeft",style:[X.previousButtonContainer,this._mouseControlsOpacityLeftStyle]},o.createElement(S.default,{ref:this._onPreviousIconButtonRef,size:c,style:[X.navigationButtonBase,X.previousButton],onPress:this.showPrevious,color:x.Color.gray200,hoverColor:x.Color.white,onHover:this._setOverrideShowMouseControls,icon:D.SkypeIcon.NavigationBack,title:b.getString("Global.PreviousButtonTitle")}))),i.find(this.state.viewers,(e=>1===e.visualIndex))&&d.push(o.createElement(o.Animated.View,{key:"mouseControlsRight",style:[X.nextButtonContainer,this._mouseControlsOpacityRightStyle]},o.createElement(S.default,{ref:this._onNextIconButtonRef,size:c,style:[X.navigationButtonBase,X.nextButton],onPress:this.showNext,onHover:this._setOverrideShowMouseControls,color:x.Color.gray200,hoverColor:x.Color.white,icon:D.SkypeIcon.NavigationForward,title:b.getString("Global.NextButtonTitle")}))));const u=this._getCurrentMediaInfo();u&&(this.props.controller.getOptions().showCustomHeader&&this.props.controller.renderCustomHeader&&(s=this.props.controller.renderCustomHeader(u.mediaDescriptor,this._invalidateCache)),this.props.controller.getOptions().showCustomFooter&&this.props.controller.renderCustomFooter&&(r=this.props.controller.renderCustomFooter(u.mediaDescriptor)),this.props.controller.getOptions().showOverlayPanel&&this.props.controller.renderOverlayPanel&&(l=this.props.controller.renderOverlayPanel(u.mediaDescriptor)));const p=E.default.hasHorizontalSafeAreas(this.state.safeAreaInsets)?E.default.horizontalPaddingStyle(this.state.safeAreaInsets):void 0,m=o.createElement(o.Image,{style:X.gradientImage,resizeMode:"stretch",source:n.Collection.PHOTO_SHIM}),y=o.createElement(o.Image,{style:[X.gradientImage,X.gradientImageFlipped],resizeMode:"stretch",source:n.Collection.PHOTO_SHIM});let _,v,C,T;if(r&&this.state.showHeaderFooter){const e=[X.controlBarContainer,X.overlayControlsContainer,this._bottomControlBarAnimatedStyle];p&&e.push(p),_=o.createElement(o.Animated.View,{key:"footer",style:e},y,r)}if(this.props.onDidClose&&this._showCloseIcon()){const e=this._getCloseButtonAccessibilityLabel();v=o.createElement(S.default,{style:X.customHeaderIconFontContainer,ref:this._onCloseIconButtonRef,size:D.IconSize.size24,onPress:this._close,color:x.Color.white,hoverColor:x.Color.gray300,icon:this._getContext().isPresentedInDesktopContentPanel?B.backIcon():B.closeIcon(),title:b.getString("Global.CloseButtonTitle"),importantForAccessibility:o.Types.ImportantForAccessibility.Yes,accessibilityLabel:e})}if(C=X.viewerBackgroundDesktop,this.state.showHeaderFooter){const e=[X.controlBarContainer,this._topControlBarAnimatedStyle];p&&e.push(p);const t=O.default.isWindowCloseOnRight()&&a.default.getS4LUiFeaturesNoSubscription().enableWindowRightClose;T=o.createElement(o.Animated.View,{key:"header",style:e},m,o.createElement(o.View,{style:X.customHeaderContainer},t?void 0:v,s,t?v:void 0))}const M=[X.viewerContainer];return this.state.safeAreaInsets.top&&M.push(E.default.marginTopStyle(this.state.safeAreaInsets.top)),this.state.safeAreaInsets.bottom&&!this.props.noBottomSpacing&&M.push(E.default.marginBottomStyle(this.state.safeAreaInsets.bottom)),o.createElement(h.default,{goBack:this._goBack},o.createElement(o.View,{ref:this._onMainViewRef,style:M,onLayout:this._onLayoutViewer,onMouseMove:this._onMouseMove,restrictFocusWithin:!this.props.noFocusRestriction&&!this._getContext().isPresentedInDesktopContentPanel},o.createElement(o.Animated.View,{key:"background",style:[C,this._backgroundOpacityAnimatedStyle]}),o.createElement(o.Animated.View,{key:"viewers",style:[X.stageContainer,this._stageContainerXOffsetStyle]},t),d,T,_,l))}_showHideScrubberControlForVideo(e){const t=this._getVideoViewer();t&&t.setScrubberControlsVisibility(e)}getViewerInfoPrefix(){return K}_presentMediaForAllViewers(e,t){f.log(g.LogTraceArea.MediaViewer,"_presentMediaForAllViewers, causeId: "+t),i.each(this.state.viewers,(s=>{const i=this._mediaViewerRefsMap.ref(K+s.mediaDescriptor.id);if(i){const o=0===s.visualIndex;this.props.controller.onMediaIsInFocus&&e&&o&&this.props.controller.onMediaIsInFocus(s.mediaDescriptor),this._isClosing||i.presentMedia(this._viewerBounds,o,!!e,t)}}))}_addRemoveHeaderFooterFromView(e){this._isMobileOrTablet()&&e===this._headerFooterShown&&this.isComponentMounted()&&this.setState({showHeaderFooter:this._headerFooterShown})}_getVideoViewer(){if(this._isMediaVideo()){return this._getCurrentViewer()}}_setPauseAutoAdvanceReason(e){this._pauseAutoAdvanceReasons[e]=e,this._autoAdvanceTimer&&(N.default.clearTimeout(this._autoAdvanceTimer),this._autoAdvanceTimer=void 0)}_clearAllPauseAutoAdvanceReasons(){this._pauseAutoAdvanceReasons={},this._clearPauseAutoAdvanceCommon(!1)}_clearPauseAutoAdvanceReason(e,t=!1){delete this._pauseAutoAdvanceReasons[e],this._clearPauseAutoAdvanceCommon(t)}_clearPauseAutoAdvanceCommon(e){if(this._autoAdvanceTimer&&(N.default.clearTimeout(this._autoAdvanceTimer),this._autoAdvanceTimer=void 0),!this._isAutoAdvancePaused()){const t=this.props.controller.getOptions().autoAdvanceDuration||0;t>0&&(e?this._performAutoAdvance():this._autoAdvanceTimer=N.default.setTimeout((()=>{this._performAutoAdvance()}),1e3*t))}}_isAutoAdvancePaused(){return 0!==i.keys(this._pauseAutoAdvanceReasons).length}_performAutoAdvance(){this._autoAdvanceTimer&&(N.default.clearTimeout(this._autoAdvanceTimer),this._autoAdvanceTimer=void 0),this._onAdvanceMedia(!0)}_renderViewer(e){const t=this.props.controller.getOptions(),s=K+e.mediaDescriptor.id,n=!t.disableSwipeLeftRight&&!this._isAnimatingOpen,r=(!this.props.disableDismissalGesture&&!!this.props.onDidClose||t.showOverlayPanel)&&!this._isAnimatingOpen,a=this.props.controller.getCurrentMessageForMedia?this.props.controller.getCurrentMessageForMedia(e.mediaDescriptor):void 0;let d=this.props.cacheMode;i.isUndefined(d)&&(m.default.isLocalCacheSupported()&&a?(d=I.CacheMode.FileCacheWithPrefetching,this._shouldStreamVideo(a,e)&&(d=I.CacheMode.FileCacheWithNetFallback)):d=I.CacheMode.Disabled);let c=this.props.cacheMode!==I.CacheMode.Disabled&&a?(0,l.getCacheKeyFullResOrDisplayable)(a):void 0,h={ref:this._mediaViewerRefsMap.onComponentRef(s),controller:this.props.controller,controlsStore:e.viewerControlsStore,backgroundOpacityValue:this._backgroundOpacityAnimatedValue,onClose:this._close,onTap:this._onTap,onPanHorizontal:n?this._onPanHorizontal:null,onPanVertical:r?this._onPanVertical:null,onPinchZoomClose:this.props.disableDismissalGesture?void 0:this._close,onShowHideControls:this._onShowHideControls,onPauseAutoAdvance:this._onPauseAutoAdvance,onResumeAutoAdvance:this._onResumeAutoAdvance,onContextMenu:e=>this._onContextMenu(s,e),showSpinnerForDelayShare:this.state.showSpinner,customFooterHeight:t.customFooterHeight?t.customFooterHeight:null,cacheMode:d,cacheId:c,isAnimating:this.state.isAnimatingViewers,viewMediaIntentScenario:this.props.viewMediaIntentScenario,viewerBounds:this._viewerBounds,onPlayVideo:this._syncControlsVisibility,autoHideHeaderFooterControls:this._autoHideHeaderFooterControls,onVideoEnded:this._onVideoEnded,isShowingCloseIcon:this._showCloseIcon(),messagetype:null==a?void 0:a.messagetype,isMobileScreenReaderEnabled:this.state.isMobileScreenReaderEnabled},u=M.MediaViewerFactory.renderViewer(e.mediaDescriptor,h);if(a){const t=w.default.createMenuCallbackWithConfig({message:a,mediaDescriptor:e.mediaDescriptor,componentContext:this._getContext(),view:()=>this._mainView});u=o.createElement(p.default,{ref:this._contextMenuRefsMap.onComponentRef(s),wrapperOnly:!0,getMenuItems:()=>w.default.getMediaViewerOptions(a),onItemSelected:t},u)}return u}_shouldStreamVideo(e,t){var s;return(null===(s=t.mediaDescriptor)||void 0===s?void 0:s.mediaType)===H.VideoViewer.MediaType&&(void 0!==e&&(!(!this.state.streamVideo||e.messagetype!==c.MessageTypes.Media_Video)||e.messagetype===c.MessageTypes.CastRecording))}_isMobileOrTablet(){return this.state.isUsingStackNavigationContext||this.state.isTablet}_canAnimateOpenClose(){const e=this._getCurrentViewer();return!!(e&&this.props.controller&&this.props.controller.getOptions().animateOpenClose)&&e.canAnimateOpenClose()}_startAutoHideControlsTimer(){this._autoHideControlsTimer&&this._clearAutoHideControlsTimer(),this._autoHideControlsTimer=N.default.setTimeout((()=>{this._clearAutoHideControlsTimer(),o.UserInterface.isNavigatingWithKeyboard()||this._overrideShowMouseControls||(this._onShowHideControls(!1),this._isMediaVideo()&&this._toggleAllControlsOnMobileOnTap(!1))}),2e3)}_clearAutoHideControlsTimer(){this._autoHideControlsTimer&&(N.default.clearTimeout(this._autoHideControlsTimer),this._autoHideControlsTimer=void 0)}_componentId(){return"MediaViewerPanel"}_closeViewer(e=!1,t=I.DismissAnimationType.Default){if(!this._isClosing){this._isClosing=!0,this._removeStatusBarStyle();const s=t||this.props.controller.getOptions().dismissAnimationType;if(!e&&this._canAnimateOpenClose())if(this._onShowHideHeaderFooter(!1),s===I.DismissAnimationType.Vertical||s===I.DismissAnimationType.Horizontal)this._completeClose(e,void 0,s);else{let t=r.Resolved(void 0);this.props.controller.getCloseToComponentPosition?t=this.props.controller.getCloseToComponentPosition():this.props.controller.getMediaLocationInWindow&&(t=this.props.controller.getMediaLocationInWindow(this.getCurrentMediaDescriptor())),t.then((t=>{this._completeClose(e,t)})).fail((()=>{this._completeClose(e)}))}else this._completeClose(e,void 0,s)}}_onViewerClosed(e){f.log(g.LogTraceArea.MediaViewerPanel,`Viewer closed: ${null==e?void 0:e.mediaType}-${null==e?void 0:e.id}`),this.props.onDidClose&&this.props.onDidClose()}_completeClose(e,t,s=I.DismissAnimationType.Default){this._onShowHideControls(!1);const i=this._getCurrentViewer(),o=this.getCurrentMediaDescriptor();this.props.onWillClose&&this.props.onWillClose(),i?((null==o?void 0:o.mediaType)===H.VideoViewer.MediaType&&i.stopVideo(),e?(i.close(),this._onViewerClosed(o)):i.animateClose(t,s).then((()=>{this._onViewerClosed(o)}))):this._onViewerClosed(o)}_loadPreviousAndNext(){if(!this.isComponentMounted())return;let e=this.getCurrentMediaDescriptor(),t=e,s=e;const i=[this._getCurrentMediaInfo()];for(let e=1;e<=1;e++)t&&(t=this.props.controller.getNextMedia?this.props.controller.getNextMedia(t):void 0,t&&i.push($._allocateMediaViewerInfo(t,e,this._viewerBounds.width))),s&&(s=this.props.controller.getPreviousMedia?this.props.controller.getPreviousMedia(s):void 0,s&&i.push($._allocateMediaViewerInfo(s,-e,this._viewerBounds.width)));this.setState({viewers:i})}_getCurrentViewer(){const e=this.getCurrentMediaDescriptor();if(e)return this._mediaViewerRefsMap.ref(K+e.id)}getCurrentMediaDescriptor(){let e=this._getCurrentMediaInfo();return e&&e.mediaDescriptor}_getCurrentMediaInfo(){return i.find(this.state.viewers,(e=>0===e.visualIndex))}_showCloseIcon(){return i.isUndefined(this.props.showCloseIcon)||this.props.showCloseIcon}static _allocateMediaViewerInfo(e,t,s){const i=t*(s+20);let n=new o.Animated.Value(i),r=o.Styles.createAnimatedViewStyle({transform:[{translateX:n}]}),a=new o.Animated.Value(0),l=o.Styles.createAnimatedViewStyle({transform:[{translateY:a}]});return f.log(g.LogTraceArea.MediaViewerPanel,`New MediaViewerInfo id: ${e.id} index: ${t} offset: ${i}`),{mediaDescriptor:e,viewerControlsStore:M.MediaViewerFactory.allocateMediaViewerControlsStore(e),visualIndex:t,xOffsetValue:n,xOffsetStyle:r,yOffsetValue:a,yOffsetStyle:l}}_showControls(){this._controlsShown||this._toggleControls()}_updateViewerXOffset(e){const t=e.visualIndex*(this._viewerBounds.width+20);f.log(g.LogTraceArea.MediaViewer,`Viewer offset update: ${e.mediaDescriptor.id} index: ${e.visualIndex} offset: ${t}`),e.xOffsetValue.setValue(t)}}t.default=$},68080:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(47204),n=s(5795),r=s(56397),a="mediaViewer";class l{static showWithConfig(e){l._show(e.initialMedia,e.controller,e.rootViewId,e.onClose,e.totalMedia)}static showWithMessageConfig(e){const t=i.createElement(r.default,{initialMessage:e.initialMessage,conversationMri:e.initialMessage.conversationId,animateOpenClose:e.animateOpenClose,initFromComponent:e.initFromComponent,closeToComponent:e.closeToComponent,reverseOrder:e.reverseOrder,defaultToLastItem:e.defaultToLastItem,viewMediaIntentScenario:e.viewMediaIntentScenario,emptyMediaDescriptor:e.emptyMediaDescriptor,onClose:()=>{this._onClose(e.onClose,e.rootViewId)},getContentNode:e.getContentNode,origin:e.origin});o.default.showModal(t,a,{rootViewId:e.rootViewId,useScopedModalId:!0})}static _show(e,t,s,r,l=1){const d=i.createElement(n.default,{initialMedia:e,controller:t,totalMedia:l,onDidClose:()=>{this._onClose(r,s)}});o.default.showModal(d,a,{rootViewId:s,useScopedModalId:!0})}}t.default=l,l._onClose=(e,t)=>{o.default.dismissModal(a,t,!0),e&&e()}},56397:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MediaViewerPanelModalComponent=void 0;const i=s(96486),o=s(16778),n=s(88837),r=s(97691),a=s(96074),l=s(71830),d=s(3056),c=s(62602),h=s(82146),u=s(52262),p=s(46096),g=s(13944),m=s(36237),S=s(61253),f=s(15877),y=s(33754),_=s(42653),v=s(70561),C=s(5795),b=s(15178),T=s(64387),M=s(20751),I=s(18078),w=s(72828),P=s(81760),k=s(11828),A=s(34528),E=s(19675),R=(0,f.lazyProperties)({container:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch",overflow:"visible"}),opaqueContainer:()=>o.Styles.createViewStyle({backgroundColor:P.Color.black}),headerContainer:()=>o.Styles.createViewStyle({flex:1,flexDirection:"row",backgroundColor:P.Color.transparent}),userName:()=>o.Styles.createTextStyle({color:P.Color.white,flex:1,textAlign:"center",paddingTop:16,textAlignVertical:"top"}),more:()=>(0,f.lazyProperties)({container:()=>o.Styles.createViewStyle({height:48,alignItems:"center",justifyContent:"center",flexDirection:"row"}),button:()=>o.Styles.createTextStyle({height:48,width:48})}),reaction:()=>(0,f.lazyProperties)({button:()=>o.Styles.createTextStyle({height:_.FooterContainerSize,width:_.FooterContainerSize,justifyContent:"center"})})}),L={mediaType:"EmptyMedia",id:"emptymedia"};class F extends a.default{constructor(){super(...arguments),this._cuidToCreatorName={},this._promiseAfterOpen=r.Defer(),this._getMediaViewerController=()=>{let e;return e={getOptions:()=>({animateOpenClose:this.props.animateOpenClose,showCustomFooter:!0,showCustomHeader:!0,customFooterHeight:_.FooterContainerSize}),getMediaLocationInWindow:e=>{let t=e.id?this._getMountedMediaNode(e.id):void 0;return t&&this.isComponentMounted()?c.default.measureLayoutRelativeToWindow((()=>t)):r.Rejected()},onMediaIsInFocus:e=>{const t=i.findIndex(this.state.messages,(t=>t.cuid===e.id));-1!==t?(this._setSelectedMessage(this.state.messages[t]),m.log(p.LogTraceArea.MediaViewerPanelModal,"controller.onMediaIsInFocus "+t+" / "+(this.state.messages.length-1))):m.log(p.LogTraceArea.MediaViewerPanelModal,"controller.onMediaIsInFocus item not found")},onShowMedia:e=>{let t=e.id?this._getMediaNode(e.id):void 0;t&&t.showNode()},onHideMedia:e=>{},getPreviousMedia:e=>{const t=this._getMediaItemIndex(e);if(!(t<=0))return T.default.getMediaDescriptorForItem(this.state.messages[t-1])},getNextMedia:e=>{const t=this._getMediaItemIndex(e);if(!(t<0||t+1>=this.state.messages.length))return T.default.getMediaDescriptorForItem(this.state.messages[t+1])},renderCustomHeader:(e,t)=>{const s=e.id&&this._cuidToCreatorName?this._cuidToCreatorName[e.id]:void 0;let i=null;i=o.createElement(g.default,{ref:this._setMoreButtonRef,size:k.IconSize.size24,style:R.more.button,onPress:t=>this._showMoreMenu(t,e),color:P.Color.white,hoverColor:P.Color.gray300,icon:A.moreIcon(),title:y.getString("Global.MoreOptions")});const{conversationMri:n}=this.state,r=!(n&&l.isAgent(n)||l.isBookmarkConversation(n))&&this._renderReactionButton(e);return o.createElement(o.View,{style:R.headerContainer},o.createElement(E.BodyText,{size:E.BodyTextSize.SmallDeprecated,style:R.userName,accessibilityHidden:!0},s),o.createElement(o.View,{style:R.more.container},r,i))},renderCustomFooter:e=>{const t=this._getCurrentMessage(e);return t?o.createElement(_.default,{hideLeftButton:!0,hideRightReactionButton:!0,message:t,mediaDescriptor:e,onDelete:this._onDelete,onShowSpinnerDelayShare:this._showSpinnerDelayShare}):void 0},getCurrentMessageForMedia:e=>this._getCurrentMessage(e)},this.props.closeToComponent&&(e.getCloseToComponentPosition=()=>this.props.closeToComponent?c.default.measureLayoutRelativeToWindow(this.props.closeToComponent):r.Rejected()),this.props.initFromComponent&&(e.getInitFromComponentPosition=()=>this.props.initFromComponent?c.default.measureLayoutRelativeToWindow(this.props.initFromComponent):r.Rejected()),e},this._setMoreButtonRef=e=>{this._moreButton=e||void 0},this._getCurrentMessage=e=>{!e&&this._refMediaViewerPanel&&(e=this._refMediaViewerPanel.getCurrentMediaDescriptor());let t=i.find(this.state.messages,(t=>t.cuid===e.id));return this.state.initialMediaCuid!==e.id||t&&!(0,S.default)(this.props.initialMessage,t)?t:this.props.initialMessage},this._showSpinnerDelayShare=e=>{this._refMediaViewerPanel&&this._refMediaViewerPanel.showSpinnerForDelayShare(e)},this._onDelete=()=>{this._refMediaViewerPanel&&(this.state.messages.length,this._refMediaViewerPanel.close())},this._onClose=()=>{this._cuidToCreatorName=void 0,this._refMediaViewerPanel=void 0,this._refMediaViewerThumbnailList=void 0,this.props.onClose&&this.props.onClose()},this._onOpen=()=>{this._promiseAfterOpen.resolve(void 0),this.setState({isOpening:!1})},this._onMediaViewerPanelRef=e=>{this._refMediaViewerPanel=e||void 0},this._onMediaViewerThumbnailListRef=e=>{this._refMediaViewerThumbnailList=e||void 0},this._goBack=e=>(m.warn(p.LogTraceArea.MediaViewerPanelModal,"MediaViewerPanelModalComponent._goBack, causeId: "+e),this._onClose(),!1),this._onMediaItemPress=e=>{const t=this.props.emptyMediaDescriptor||L;this.setState({initialMediaCuid:e.cuid,initialMedia:T.default.getMediaDescriptorForItem(e)||t})},this._renderGalleryPreview=()=>{const{conversationMri:e,messages:t,isOpening:s,isLoading:i}=this.state,{initialMessage:n}=this.props;if(!(!n||!e||t.length<=1||s||i))return o.createElement(b.default,{ref:this._onMediaViewerThumbnailListRef,conversationId:e,onMediaItemPress:this._onMediaItemPress,initialMessage:n,messages:t})},this._setSelectedMessage=e=>{this._refMediaViewerThumbnailList&&this._refMediaViewerThumbnailList.setSelectedMessage(e)},this._renderReactionButton=e=>{const t=this._getCurrentMessage(e);return t&&!I.default.isMyMri(t.creator)?o.createElement(w.default,{message:()=>t,isMessageKnownByServer:t.isAnyVersionKnownByServer(),style:R.reaction.button,colorOverride:P.Color.white,sizeOverride:k.IconSize.size24,hideAlternateReactionPacks:!0,keepOpenAfterReactionSelected:!1}):void 0}}_buildState(e,t){let s={};s.conversationMri=e.conversationMri||(e.initialMessage?e.initialMessage.conversationId:void 0);const i=e.emptyMediaDescriptor||L;if(s.conversationMri){s.messages=h.default.getMediaForConversation(s.conversationMri,e.initialMessage?e.initialMessage.createdTime:Date.now(),25,t&&e.origin!==p.NavigationMediaViewerOrigin.Gallery,e.reverseOrder,this._promiseAfterOpen.promise()),s.isLoading=h.default.isPopulatingOfSurroundMediaInProgressForConversation(s.conversationMri);const o=e.initialMessage||(s.messages.length>0?s.messages[e.defaultToLastItem?s.messages.length-1:0]:void 0);if(m.log(p.LogTraceArea.MediaViewerPanelModal,"message "+(o?o.cuid:"none")),o){this.state&&this.state.initialMedia&&this.state.initialMedia!==i||(m.log(p.LogTraceArea.MediaViewerPanelModal,"Setting initial media "+o.cuid),s.initialMediaCuid=o.cuid,s.initialMedia=T.default.getMediaDescriptorForItem(o)||i)}else s.initialMedia=i}else s.messages=[],s.initialMedia=i,s.initialMediaCuid="";return t&&(s.isOpening=!0,m.log(p.LogTraceArea.MediaViewerPanelModal,"componentDidMount"),this._associateCuidToCreatorName(s)),s}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),this._associateCuidToCreatorName(this.state,t.messages)}componentWillUnmount(){super.componentWillUnmount(),this._cuidToCreatorName=void 0,this._refMediaViewerPanel=void 0,this._refMediaViewerThumbnailList=void 0}_associateCuidToCreatorName(e,t){this._cuidToCreatorName={},t=t||e.messages;const s=y.getString("DisplayInfoStore.ListMyName");i.each(t,(e=>{this._cuidToCreatorName&&(this._cuidToCreatorName[e.cuid]=I.default.isMyMri(e.creator)?s:u.default.getDisplayName(e.creator))}))}_getMediaItemIndex(e){return i.findIndex(this.state.messages,(t=>t.cuid===e.id&&T.default.isMediaItem(t)))}_getMountedMediaNode(e){return this._intGetMediaNode(e,!0)}_getMediaNode(e){return this._intGetMediaNode(e,!1)}_contentNode(e){if(this.props.getContentNode)return this.props.getContentNode(e)}_intGetMediaNode(e,t){const s=this._contentNode(e);if(s){const i=s.component;return t?i instanceof n.ComponentBase&&i.isComponentMounted()?i:void m.warn(p.LogTraceArea.MediaViewerPanelModal,"Component is unnmounted or is not a ComponentBase, cuid: "+e):i}}_showMoreMenu(e,t){const s=this._getCurrentMessage(t);s&&v.default.showWithConfig({message:s,mediaDescriptor:t,componentContext:this._getContext(),anchor:()=>this._moreButton,onDownloadDelay:this._showSpinnerDelayShare,invokingEvent:e})}render(){const e=o.createElement(C.default,{ref:this._onMediaViewerPanelRef,initialMedia:this.state.initialMedia,controller:this._getMediaViewerController(),totalMedia:i.isEmpty(this.state.messages)?1:this.state.messages.length,disableDismissalGesture:this._getContext().isPresentedByMobileStackNavigator,onDidClose:this._onClose,onOpen:this._onOpen,viewMediaIntentScenario:this.props.viewMediaIntentScenario,noFocusRestriction:!0,noBottomSpacing:!0}),t=[R.container];return this.props.useOpaqueBackground&&t.push(R.opaqueContainer),o.createElement(d.default,{goBack:this._goBack},o.createElement(o.View,{style:t,restrictFocusWithin:!this._getContext().isPresentedInDesktopContentPanel},e,this._renderGalleryPreview(),o.createElement(M.default,null)))}}t.MediaViewerPanelModalComponent=F,t.default=F},15178:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(98278),r=s(77381),a=s(15877),l=s(23284),d=s(29130),c=s(51070),h=s(81115),u=s(81760),p=s(11828),g=s(80837),m=(0,a.lazyProperties)({containerStyle:()=>o.Styles.createViewStyle({backgroundColor:u.Color.black}),panel:()=>o.Styles.createViewStyle({flexDirection:"row",flexWrap:"nowrap",overflow:"visible"}),mediaWrapper:()=>o.Styles.createViewStyle({borderWidth:2,borderColor:u.Color.transparent,marginHorizontal:2,marginVertical:4,borderRadius:4,overflow:"hidden",width:94,height:94}),mediaWrapperSelected:()=>o.Styles.createViewStyle({borderColor:u.Color.white})});class S extends r.default{constructor(){super(...arguments),this.setSelectedMessage=e=>{this.setState({selectedMessage:e})},this._renderTiles=()=>this.state.messages.map((e=>this._renderMediaTile(e))),this._scrollViewRefCallback=e=>{this._scrollView=e},this._scrollToSelectedMessage=()=>{if(!this._scrollView||!this.isComponentMounted()||!this.state.selectedMessage)return;const{screenWidth:e}=this.state,t=this._getMessageIndex(this.state.selectedMessage);if(98*t-1<=e/2)return void this._scrollView.setScrollLeft(0,!0);let s=98*t-e/2+49;this._scrollView.setScrollLeft(s,!0)},this._onLayout=e=>{this._scrollToSelectedMessage()},this._onScrollViewContentSizeChanged=(e,t)=>{this._scrollToSelectedMessage()},this._getMessageIndex=e=>{if(0===this.state.messages.length||!e)return 0;const t=i.findIndex(this.state.messages,(t=>(t&&t.cuid)===e.cuid));return-1!==t?t:0},this._onThumbnailPress=e=>{this.props.onMediaItemPress(e)}}_buildState(e,t){const s=this._getRootViewId(),o=c.default.bottomSafeAreaInset(n.BottomInsetDefault),r=c.default.horizontalInsets(n.HorizontalInsetDefault);let a={messages:i.compact(e.messages),screenWidth:d.default.getWidth(s),safeAreaInsets:Object.assign(Object.assign({},r),{bottom:o})};return t&&(a.selectedMessage=e.initialMessage),a}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),t.selectedMessage!==this.state.selectedMessage&&this._scrollToSelectedMessage()}render(){let e=[m.containerStyle];return this.state.safeAreaInsets.bottom&&e.push(h.default.marginBottomStyle(this.state.safeAreaInsets.bottom)),(this.state.safeAreaInsets.left||this.state.safeAreaInsets.right)&&e.push(h.default.horizontalMarginStyle(this.state.safeAreaInsets)),o.createElement(o.View,{style:e},o.createElement(o.ScrollView,{horizontal:!0,vertical:!1,ref:this._scrollViewRefCallback,keyboardShouldPersistTaps:!1,showsHorizontalScrollIndicator:!1,style:g.default.flexOne,overScrollMode:"never",onLayout:this._onLayout,onContentSizeChange:this._onScrollViewContentSizeChanged},o.createElement(o.View,{style:m.panel},this._renderTiles())))}_renderMediaTile(e){let t=[m.mediaWrapper];return this.state.selectedMessage&&this.state.selectedMessage.cuid===e.cuid&&t.push(m.mediaWrapperSelected),o.createElement(o.View,{style:t,key:e.cuid},o.createElement(l.default,{message:e,height:90,width:90,showVideoMediaTypeIcon:!0,showOverlay:!0,showCreator:!1,onThumbnailPress:this._onThumbnailPress,shouldUseMessageAccessibilityLabel:!0,borderRadius:4,thumbnailIconsSize:p.IconSize.size32}))}}t.default=S},22669:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PictureViewer=void 0;const i=s(74958),o=s(96486),n=s(98356),r=s(16778),a=s(89391),l=s(98278),d=s(35566),c=s(52262),h=s(46096),u=s(74313),p=s(39821),g=s(10117),m=s(11276),S=s(36237),f=s(61253),y=s(16724),_=s(15877),v=s(33754),C=s(45983),b=s(74636),T=s(14976),M=s(15415),I=s(81760),w=s(11828),P=s(82176),k=s(67660),A=s(26712),E=(0,_.lazyProperties)({viewerContainer:()=>r.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center",overflow:"visible"}),imageContainer:()=>r.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,bottom:0,overflow:"visible"}),imageGestureView:()=>r.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,backgroundColor:I.Color.transparent,overflow:"visible"}),image:()=>r.Styles.createImageStyle({position:"absolute",left:0,right:0,top:0,bottom:0,alignItems:"stretch"}),spinnerContainer:()=>r.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,bottom:0,alignItems:"center",justifyContent:"center"}),alternateViewContainer:()=>r.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center",backgroundColor:I.Color.black}),thumbnailPlaceholderText:()=>r.Styles.createViewStyle({flex:0,flexDirection:"row",backgroundColor:I.Color.transparent,padding:w.IconSize.size96/4})});class R extends k.ThumbnailMediaViewer{constructor(){super(...arguments),this._copyImage=()=>{this._viewerHasFocus&&this.state.fullSizeUri&&m.copyImageToClipboard(this.state.fullSizeUri)},this._onAnimatedFullSizedContainer=e=>{this._animatedFullSizedContainer=e},this._onPinchZoom=e=>{let t=e.distance/e.initialDistance,s=1;this._prePinchZoomScale||(this._prePinchZoomScale=this._currentScale);let i=this._prePinchZoomScale*t;i>3?i=3+Math.sqrt(i-3):i<1&&(i=.5+.5*i,s=i,this.props.backgroundOpacityValue.setValue(s));let o=this._calcNewTranslationForScale(1===this._defaultScale?e.centerClientX:e.centerPageX,1===this._defaultScale?e.centerClientY:e.centerPageY,this._currentScale,i,this._currentTranslateX,this._currentTranslateY);if(this._containerAnimatedScaleValue.setValue(i),this._containerAnimatedTranslateXValue.setValue(o.x),this._containerAnimatedTranslateYValue.setValue(o.y),this._currentScale=i,this._currentTranslateX=o.x,this._currentTranslateY=o.y,e.isComplete){if(i<.75)this.props.onPinchZoomClose?this.props.onPinchZoomClose():this._leaveZoomMode();else if(i<1.25)this._leaveZoomMode();else if(this._setZoomModeActive(!0),i>3){let t=this._calcNewTranslationForScale(1===this._defaultScale?e.centerClientX:e.centerPageX,1===this._defaultScale?e.centerClientY:e.centerPageY,i,3,this._currentTranslateX,this._currentTranslateY);this._animateZoom(t.x,t.y,3,void 0,(()=>{this._animateImageBackOnScreen()}))}this._prePinchZoomScale=void 0}},this._onTap=e=>{this._isTapInImage(e)||!this.props.isShowingCloseIcon?this.props.onTap(e):this.props.onClose()},this._isTapInImage=e=>{if(!this.props.media.originalSize||!e)return!1;const t=this.props.viewerBounds.width/this.props.viewerBounds.height>(this.props.media.originalSize?this.props.media.originalSize.width/this.props.media.originalSize.height:0),s=(t?this.props.viewerBounds.height/this.props.media.originalSize.height:this.props.viewerBounds.width/this.props.media.originalSize.width)*(t?this.props.media.originalSize.width:this.props.media.originalSize.height),i=((t?this.props.viewerBounds.width:this.props.viewerBounds.height)-s)/2,o=i+s,n=t?e.clientX:e.clientY;return!!(n>i&&n<o||this.state.isZoomModeActive)},this._onDoubleTap=e=>{if(this.state.isZoomModeActive)this._leaveZoomMode();else{let t=this._calcNewTranslationForScale(1===this._defaultScale?e.clientX:e.pageX,1===this._defaultScale?e.clientY:e.pageY,this._currentScale,3,this._currentTranslateX,this._currentTranslateY);this._animateZoom(t.x,t.y,3,void 0,(()=>{this._animateImageBackOnScreen()})),this._setZoomModeActive(!0)}},this._onPan=e=>{let t=e.pageX-e.initialPageX,s=e.pageY-e.initialPageY,i=this._constrainToOnScreen(this._currentTranslateX+t,this._currentTranslateY+s,!0);this._containerAnimatedTranslateXValue.setValue(i.translateX),this._containerAnimatedTranslateYValue.setValue(i.translateY),e.isComplete&&(i=this._constrainToOnScreen(this._currentTranslateX+t+50*e.velocityX,this._currentTranslateY+s+50*e.velocityY,!0),this._animateZoom(i.translateX,i.translateY,this._currentScale,r.Animated.Easing.Out(),(()=>{this._animateImageBackOnScreen()})))},this._onLoadThumbnail=e=>{this.isComponentMounted()&&(this.props.media.id&&b.pictureViewerThumbnailLoaded(this.props.media.id),this._markTrackerStepIfUnmarked("ThumbnailLoad"),this.setState({thumbnailLoaded:!0,thumbnailLoadFailed:!1}),this.props.controller.onThumbnailLoaded&&this._viewerHasFocus&&this.props.controller.onThumbnailLoaded(this.props.media,!0),this._completeOpenAnimation&&this._completeOpenAnimation())},this._onLoadFullSize=e=>{this.isComponentMounted()&&(this.props.media.id&&b.pictureViewerFullLoaded(this.props.media.id),this.setState({fullSizeLoadSucceeded:!0,fullSizeLoadFailed:!1,fullSizeDimensions:e}),this.props.controller.onFullLoaded&&this._viewerHasFocus&&this.props.controller.onFullLoaded(this.props.media,!0),this._animatedFullSizedContainer&&this._animatedFullSizedContainer.fadeIn(),this._markTrackerStepIfUnmarked("FullSizeLoad"),this._callbackIfTrackerUnresolved((e=>e.finish())),this._telemetryEvent&&(this._telemetryEvent.endDownload(),this._telemetryEvent.setSuccess(!0,h.MessagingFailureReason.None),S.track(this._telemetryEvent),this._telemetryEvent=void 0),this.state.displayName||r.Accessibility.announceForAccessibility(v.getString("MediaViewer.OpenedPictureUnknownAuthor")),this.props.onResumeAutoAdvance(!1))},this._onErrorFullSize=()=>{this.isComponentMounted()&&(this.setState({fullSizeLoadFailed:!0}),this.props.controller.onFullLoaded&&this._viewerHasFocus&&this.props.controller.onFullLoaded(this.props.media,!1),this._telemetryEvent&&(this._telemetryEvent.endDownload(),this._telemetryEvent.setSuccess(!1,h.MessagingFailureReason.AMSFailure),S.track(this._telemetryEvent),S.log(h.LogTraceArea.PictureViewer,"Full image load failed",this._telemetryEvent),this._telemetryEvent=void 0),this.props.onResumeAutoAdvance(!1))},this._onErrorThumbnail=()=>{this.isComponentMounted()&&this._viewerHasFocus&&(this.setState({renderFullSize:!0,thumbnailLoadFailed:!0}),this.props.controller.onThumbnailLoaded&&this._viewerHasFocus&&this.props.controller.onThumbnailLoaded(this.props.media,!1))}}_buildState(e,t){let s={};const i=this.props,n=t||!(0,f.default)(e.media,i.media);if(n?(this._telemetryEvent=e.media.displayResolutionUrl?new y.FileReceived(e.media.displayResolutionUrl,e.media.originalSizeInBytes,P.default.extractExtensionForTelemetry(e.media.downloadFileName)):void 0,s.renderFullSize=!1,s.thumbnailLoaded=!1,s.fullSizeUri=void 0,s.fullSizeLoadSucceeded=!1,s.fullSizeLoadFailed=!1,s.isZoomModeActive=!1,s.isSwitchingViews=!1):this.state.isSwitchingViews?s.isSwitchingViews=e.isAnimating:s.isSwitchingViews=!i.isAnimating&&e.isAnimating&&!this.state.fullSizeLoadSucceeded,e.cacheMode===C.CacheMode.Disabled)s.fullSizeUri=e.media.displayResolutionUrl,S.log(h.LogTraceArea.PictureViewer,"Cache is disabled hence loading full image from network "+e.media.id);else if(n||!this.state.fullSizeLoadSucceeded){const t=e.cacheId?p.default.getLocalUri(e.cacheId):void 0;t?(s.fullSizeUri=t,S.log(h.LogTraceArea.PictureViewer,"Loading full image from cache "+e.media.id)):e.cacheMode===C.CacheMode.FileCacheWithNetFallback&&(s.fullSizeUri=e.media.displayResolutionUrl,S.log(h.LogTraceArea.PictureViewer,"Loading full image from network "+e.media.id))}let r,a={CacheMode:C.CacheMode[e.cacheMode]};if(e.controller.getCurrentMessageForMedia){const t=e.controller.getCurrentMessageForMedia(e.media);t&&(r=c.default.getDisplayName(t.creator),t.amsreferences&&(a.AmsDocumentIds=o.join(t.amsreferences,", ")))}return s.displayName=r,s.postedTime=undefined,s.telemetryProperties=a,s}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this.props.media.id&&b.pictureViewerOpening(this.props.media.id)}componentDidMount(){super.componentDidMount(),this.props.controller.onMediaDescriptorMounted&&this.props.controller.onMediaDescriptorMounted()}componentWillUnmount(){super.componentWillUnmount()}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),!this._telemetryEvent||t.renderFullSize||this.state.fullSizeLoadSucceeded||this.state.fullSizeLoadFailed||!this.state.renderFullSize||(this._telemetryEvent.setMediaProfile(P.default.currentMediaProfile()),this._telemetryEvent.setIntent(h.MediaDownloadIntent.PictureViewer),this._telemetryEvent.startDownload())}render(){let e,t,s,o;return this.state.thumbnailLoadFailed&&!this.state.fullSizeLoadSucceeded&&(e=r.createElement(r.View,{style:E.alternateViewContainer},r.createElement(g.default,{icon:w.SkypeIcon.Warning,color:I.Color.white,size:w.IconSize.size96,style:E.thumbnailPlaceholderText}))),this.state.renderFullSize&&this.state.fullSizeUri&&!this.state.isSwitchingViews&&(S.log(h.LogTraceArea.PictureViewer,`Rendering full size image: ${this.props.media.id} uri: ${i.pii.Omit(this.state.fullSizeUri)}`),t=r.createElement(u.default,{origin:"PictureViewerFullRes",style:E.image,containerStyle:E.imageContainer,source:this.state.fullSizeUri,resizeMode:"contain",onLoad:this._onLoadFullSize,onError:this._onErrorFullSize,shouldInstrument:!0,telemetryProperties:this.state.telemetryProperties})),(this.state.thumbnailLoaded||this.state.thumbnailLoadFailed||this.state.fullSizeLoadSucceeded||this.state.isSwitchingViews)&&!this.props.showSpinnerForDelayShare||(s=r.createElement(r.View,{style:E.spinnerContainer},r.createElement(M.default,{size:l.SXActivityIndicatorSize.Medium,tintColor:I.Color.white}))),o=this.state.displayName&&v.getString("MediaViewer.OpenedPicture",{senderName:this.state.displayName}),S.log(h.LogTraceArea.PictureViewer,`Rendering image with thumbnail: ${this.props.media.id} uri: ${i.pii.Omit(this.props.media.thumbnailUrl||"")}`),r.createElement(r.View,{autoFocus:!1,style:E.viewerContainer,accessibilityLabel:o,importantForAccessibility:this.props.isMobileScreenReaderEnabled?r.Types.ImportantForAccessibility.No:void 0},r.createElement(r.GestureView,{style:E.imageGestureView,onTap:this._onTap,onDoubleTap:this._onDoubleTap,onPinchZoom:this._onPinchZoom,onPan:this.state.isZoomModeActive?this._onPan:void 0,onPanVertical:this.state.isZoomModeActive?void 0:this.props.onPanVertical,onPanHorizontal:this.state.isZoomModeActive?void 0:this.props.onPanHorizontal,preferredPan:r.Types.PreferredPanGesture.Horizontal,onContextMenu:this.props.onContextMenu,importantForAccessibility:this.props.isMobileScreenReaderEnabled?r.Types.ImportantForAccessibility.No:r.Types.ImportantForAccessibility.Yes},r.createElement(r.Animated.View,{style:[E.imageContainer,this._containerAnimatedXStyle]},r.createElement(r.Animated.View,{style:[E.imageContainer,this._containerAnimatedYStyle]},r.createElement(r.Animated.View,{style:[E.imageContainer,this._containerAnimatedStyle]},r.createElement(u.default,{origin:"PictureViewerThumbnail",style:E.image,containerStyle:E.imageContainer,source:this.props.media.thumbnailUrl,resizeMode:"contain",errorView:e,onLoad:this._onLoadThumbnail,onError:this._onErrorThumbnail,telemetryProperties:this.state.telemetryProperties}),r.createElement(n.View,{ref:this._onAnimatedFullSizedContainer,style:E.image,opacity:0},t)))),s))}_calcNewTranslationForScale(e,t,s,i,o,n){let r=this._convertDisplayPointToImagePoint(e,t,this._currentScale,this._currentTranslateX,this._currentTranslateY),a=this._convertDisplayPointToImagePoint(e,t,i,this._currentTranslateX,this._currentTranslateY);return{x:this._currentTranslateX+(a.x-r.x)*i,y:this._currentTranslateY+(a.y-r.y)*i}}_convertDisplayPointToImagePoint(e,t,s,i,o){return{x:(e-i-this._containerWidth/2)/s+this._containerWidth/2,y:(t-o-this._containerHeight/2)/s+this._containerHeight/2}}_leaveZoomMode(){this._currentTranslateX=this._nonZoomModeTranslateX,this._currentTranslateY=this._nonZoomModeTranslateY,this._currentScale=this._defaultScale,r.Animated.parallel([r.Animated.timing(this._containerAnimatedScaleValue,{toValue:this._currentScale,duration:this._openCloseAnimationDuration,easing:r.Animated.Easing.InOut()}),r.Animated.timing(this._containerAnimatedTranslateXValue,{toValue:this._currentTranslateX,duration:this._openCloseAnimationDuration,easing:r.Animated.Easing.InOut()}),r.Animated.timing(this._containerAnimatedTranslateYValue,{toValue:this._currentTranslateY,duration:this._openCloseAnimationDuration,easing:r.Animated.Easing.InOut()}),r.Animated.timing(this.props.backgroundOpacityValue,{toValue:1,duration:this._openCloseAnimationDuration,easing:r.Animated.Easing.Linear()})]).start(),this._setZoomModeActive(!1)}_animateImageBackOnScreen(){let e=this._constrainToOnScreen(this._currentTranslateX,this._currentTranslateY,!1);e.translateX===this._currentTranslateX&&e.translateY===this._currentTranslateY||this._animateZoom(e.translateX,e.translateY,this._currentScale,r.Animated.Easing.In())}_constrainToOnScreen(e,t,s){const i=this._fitToContainerSafe(this._viewerBounds);let o=0,n=0;1===this._defaultScale?(o=i.width*this._currentScale,n=i.height*this._currentScale):(n=i.width*this._currentScale,o=i.height*this._currentScale);let r=Math.max((o-this._viewerBounds.width)/2,0),a=Math.max((n-this._viewerBounds.height)/2,0),l=s?.75:1,d=e-this._nonZoomModeTranslateX,c=t-this._nonZoomModeTranslateY;return d<-r?e+=(-d-r)*l:d>r&&(e-=(d-r)*l),c<-a?t+=(-c-a)*l:c>a&&(t-=(c-a)*l),{translateX:e,translateY:t}}_getFullScaleDimensions(){return this.state.fullSizeDimensions&&this.state.fullSizeDimensions.width>0&&this.state.fullSizeDimensions.height>0?this.state.fullSizeDimensions:this.props.media.originalSize&&this.props.media.originalSize.width>0&&this.props.media.originalSize.height>0?this.props.media.originalSize:this.props.media.thumbnailSize&&this.props.media.thumbnailSize.width>0&&this.props.media.thumbnailSize.height>0?this.props.media.thumbnailSize:this._viewerBounds}_setZoomModeActive(e){this.state.isZoomModeActive!==e&&(this.setState({isZoomModeActive:e}),e?this.props.onPauseAutoAdvance():this.props.onResumeAutoAdvance(!1))}_fitToContainerSafe(e){const t=!this.props.media.originalSize||1!==this._currentScale,s=this._getFullScaleDimensions();return d.default.fitToContainer(s,e,t)}_onCompleteOpen(){this.isComponentMounted()&&this._viewerHasFocus&&this.setState({renderFullSize:!0}),this._markTrackerStepIfUnmarked("AnimationComplete")}_markTrackerStepIfUnmarked(e){this._callbackIfTrackerUnresolved((t=>{t.isStepMarked(e)||t.markStepCompleted(e)}))}_callbackIfTrackerUnresolved(e){this.props.viewMediaIntentScenario&&!this.props.viewMediaIntentScenario.isResolved()&&e(this.props.viewMediaIntentScenario)}_calcAnimateFromLocation(e){const t=this._getSize();if(!t)return e;let s=o.clone(e),i=e.width/e.height,n=t.width/t.height;if(Math.abs(i-n)>.1)if(i<n){let t=e.height*n;s.width=t,s.x-=(t-e.width)/2}else if(i>n){let t=e.width/n;s.height=t,s.y-=(t-e.height)/2}return s}_onFocusChanged(e,t){super._onFocusChanged(e,t),this._viewerHasFocus=e,!e&&this.state.renderFullSize?this.setState({renderFullSize:!1}):e&&this.setState({renderFullSize:!0})}_handleCaching(e,t){super._handleCaching(e,t);const s=!!this.props.media;if(S.log(h.LogTraceArea.PictureViewer,"handleCaching, has media: "+s+" mediaId: "+(s?this.props.media.id:"none")+" cacheMode: "+this.props.cacheMode+" cacheId: "+T.mriOrId(this.props.cacheId)+" causeId: "+t),this.props.media&&this.props.media.displayResolutionUrl&&!A.default.isFileOrBlob(this.props.media.displayResolutionUrl)&&this.props.cacheMode===C.CacheMode.FileCacheWithPrefetching&&this.props.cacheId)if(e){S.log(h.LogTraceArea.PictureViewer,"handleCaching prefetching media for "+this.props.media.id+" causeId: "+t);const e=1e3*a.default.getS4LCMCFeaturesNoSubscription().picturePrefetchCacheExpiryTimeSec;this.prefetchMediaToCacheIfSupported(this.props.cacheId,this.props.media.displayResolutionUrl,this.props.media.downloadFileName,e).then(o.noop)}else S.log(h.LogTraceArea.PictureViewer,"handleCaching cancelling prefetching for "+this.props.media.id+" causeId: "+t),this.cancelPrefetchIfPending(this.props.cacheId,t)}getCloseButtonAccLabel(){return v.getString("MediaViewer.CloseButtonAccLabelImage")}}t.PictureViewer=R,R.MediaType=C.MediaViewerTypes.Picture},67660:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ThumbnailMediaViewer=void 0;const i=s(96486),o=s(35566),n=s(7580);class r extends n.MediaViewer{constructor(){super(...arguments),this._animate=()=>{this.state.thumbnailLoaded||this.state.thumbnailLoadFailed?this._completeOpenAnimation&&this._completeOpenAnimation():i.delay((()=>{this._completeOpenAnimation&&this._completeOpenAnimation()}),500)},this._getSize=()=>this.props.media.originalSize||this.props.media.thumbnailSize,this._allowUpscale=()=>!this.props.media.originalSize}canAnimateOpenClose(){if(!this.props.controller.getOptions().animateOpenClose)return!1;const e=this._getSize();return!!e&&e.width>0&&e.height>0}_calcAnimateFromLocation(e){const t=this._getSize();if(!t)return e;let s=i.clone(e),o=e.width/e.height,n=t.width/t.height;if(Math.abs(o-n)>.1)if(o<n){let t=e.height*n;s.width=t,s.x-=(t-e.width)/2}else if(o>n){let t=e.width/n;s.height=t,s.y-=(t-e.height)/2}return s}_fitToContainerSafe(e){const t=this._allowUpscale(),s=this._getSize();return s?o.default.fitToContainer(s,e,t):{width:0,height:0}}}t.ThumbnailMediaViewer=r},48790:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VideoViewer=t.VideoDownloadActions=t.VideoAction=void 0;const i=s(96486),o=s(63297),n=s(31844),r=s(16778),a=s(97691),l=s(60),d=s(89391),c=s(38566),h=s(34581),u=s(98278),p=s(73145),g=s(35566),m=s(52262),S=s(70891),f=s(46096),y=s(74313),_=s(39821),v=s(39285),C=s(10117),b=s(36237),T=s(61253),M=s(15877),I=s(33754),w=s(65822),P=s(71349),k=s(45983),A=s(92210),E=s(14976),R=s(86045),L=s(4057),F=s(93194),x=s(15415),O=s(81760),D=s(40363),B=s(11828),V=s(80837),N=s(82176),U=s(67660),H=s(94214),z=s(15188),W=s(78194),j=s(26712),G=s(53374),K=s(16718),q=s(54288),Q=s(3729);var X;!function(e){e[e.Pause=0]="Pause",e[e.Stop=1]="Stop"}(t.VideoAction||(t.VideoAction={})),function(e){e.PauseDownload="pauseDownloadCommand",e.ResumeDownload="resumeDownloadCommand"}(X=t.VideoDownloadActions||(t.VideoDownloadActions={}));const $=(0,M.lazyProperties)({viewerContainer:()=>r.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center",overflow:"visible"}),videoOverflow:()=>[V.default.absoluteFill,V.default.overflowVisible],thumbnail:()=>r.Styles.createImageStyle({flex:1,alignSelf:"stretch"}),centeredContainer:()=>r.Styles.createViewStyle({alignItems:"center",justifyContent:"center",backgroundColor:O.Color.transparent}),progressText:()=>r.Styles.createViewStyle({alignItems:"center",justifyContent:"flex-end",marginBottom:14}),alternateViewContainer:()=>r.Styles.createViewStyle({backgroundColor:O.Color.black}),thumbnailPlaceholderText:()=>r.Styles.createViewStyle({flex:0,flexDirection:"row",backgroundColor:O.Color.transparent,padding:B.IconSize.size96/4}),overlayContainerBackground:()=>r.Styles.createViewStyle({backgroundColor:O.Color.blackOverlay10})});class J extends U.ThumbnailMediaViewer{constructor(){super(...arguments),this._audioManagerClient=new c.default(c.AudioManagerSource.VideoViewer),this._videoPausedBeforeLoad=!1,this._accessibilityAnnouncementPlayed=!1,this._cachingTimerStarted=!1,this._cachingStartTime=0,this._cachingDuration=0,this._cachingSuccess=!1,this._videoContainerAnimatedXStyle=r.Styles.createAnimatedViewStyle({width:this._containerAnimatedWidthValue,height:this._containerAnimatedHeightValue,opacity:this._containerAnimatedOpacityValue,transform:[{translateX:this._containerAnimatedTranslateXValue}]}),this._videoContainerAnimatedYStyle=r.Styles.createAnimatedViewStyle({transform:[{translateY:this._containerAnimatedTranslateYValue}]}),this._videoContainerAnimatedStyle=r.Styles.createAnimatedViewStyle({transform:[{scale:this._containerAnimatedScaleValue}]}),this._onAppStateChange=e=>{0},this._handlePauseOrResumeDownloadCommand=e=>{const t=G.default.newCauseId();switch(b.log(f.LogTraceArea.MediaViewer,"Media _pauseOrResumeDownload, causeId: "+t),e){case X.PauseDownload:r.Accessibility.announceForAccessibility(I.getString("MediaViewer.DownloadPaused")),this._cancelPrefetching(t),this.isComponentMounted()&&this.setState({isDownloadPaused:!0});break;case X.ResumeDownload:r.Accessibility.announceForAccessibility(I.getString("MediaViewer.Downloading")),this._startPrefetching(),this.isComponentMounted()&&this.setState({isDownloadPaused:!1});case F.SXActionMenuCancel:}},this._onLongPress=e=>{let t={anchor:()=>this.isComponentMounted()?this:void 0,buttons:this._getPauseDownloadMenuItems()};F.default.showWithActionMenuConfig({options:t,callback:this._handlePauseOrResumeDownloadCommand,rootViewId:this._getRootViewId(),invokingEvent:e})},this._onPress=()=>this._handlePauseOrResumeDownloadCommand(X.ResumeDownload),this._getPauseDownloadMenuItems=()=>{let e=[];return e.push({text:I.getString("MediaViewer.PauseDownload"),command:X.PauseDownload}),e},this._onContextMenuRef=e=>{this._contextMenu=e||void 0},this._onContextMenu=e=>{this._contextMenu&&this._contextMenu.show(e)},this._onVideoPlayerRef=e=>{this._videoPlayerRef=e||void 0},this.playOrPauseVideo=()=>{this.props.controlsStore.getVideoPlayState()===q.VideoPlayState.Playing?(this.props.controlsStore.pause(),this.props.autoHideHeaderFooterControls&&this.props.autoHideHeaderFooterControls(!1)):(this.props.controlsStore.play(),this.props.autoHideHeaderFooterControls&&this.props.autoHideHeaderFooterControls(!0))},this.isFocused=()=>this._viewerHasFocus,this.displayControlsWhenVideoFocused=()=>{this._viewerHasFocus&&this.props.autoHideHeaderFooterControls&&this.props.autoHideHeaderFooterControls(!1)},this._onEnded=()=>{this.isComponentMounted()&&(b.log(f.LogTraceArea.VideoViewer,"VideoViewer("+this._id+").onEnded"),this.setState({isPlaying:!1}),this.props.onVideoEnded&&this.props.onVideoEnded(),this.props.autoHideHeaderFooterControls&&this.props.autoHideHeaderFooterControls(!1),this.props.onResumeAutoAdvance(!1),this.props.media.onVideoComplete&&this.props.media.onVideoComplete())},this._onWaiting=()=>{b.log(f.LogTraceArea.VideoViewer,"VideoViewer("+this._id+").onWaiting"),this.isComponentMounted()&&this.setState({isVideoPausedOnBuffering:!0})},this._onPlaying=()=>{b.log(f.LogTraceArea.VideoViewer,"VideoViewer("+this._id+").onPlaying"),this.isComponentMounted()&&this.setState({isVideoPausedOnBuffering:!1})},this._onLoadedData=e=>{this.isComponentMounted()&&e.duration&&(b.log(f.LogTraceArea.VideoViewer,"VideoViewer("+this._id+").onLoadedData duration="+e.duration),this.setState({videoDuration:e.duration}))},this._onCanPlay=()=>{this.isComponentMounted()&&!this.state.isVideoLoaded&&(b.log(f.LogTraceArea.VideoViewer,"VideoViewer("+this._id+").onCanPlay videoPausedBeforeLoad="+this._videoPausedBeforeLoad),this.setState({isVideoLoaded:!0,videoLoadFailed:!1,isPlaying:!this._videoPausedBeforeLoad}),this.props.controller.onFullLoaded&&this._viewerHasFocus&&this.props.controller.onFullLoaded(this.props.media,!0))},this._onVideoLoadError=()=>{this.isComponentMounted()&&(b.log(f.LogTraceArea.VideoViewer,"VideoViewer("+this._id+").onVideoLoadError"),this.setState({videoLoadFailed:!0}),this.props.controller.onFullLoaded&&this._viewerHasFocus&&this.props.controller.onFullLoaded(this.props.media,!1))},this._onProgress=e=>{if(this._viewerHasFocus&&this.props.controlsStore&&!this._videoPausedBeforeLoad){const t=this.props.controlsStore.getVideoPlayProgress();!this.state.isPlaying&&e.currentTime>0&&0===t.current&&t.duration>=0?this.isComponentMounted()&&this.setState({isPlaying:!0}):this.state.isPlaying||b.log(f.LogTraceArea.VideoViewer,"VideoViewer("+this._id+").onProgress while video is not playing"),this.props.controlsStore.setVideoPlayProgress({current:e.currentTime,duration:this.state.videoDuration}),this.props.media.onVideoProgress&&this.props.media.onVideoProgress(e.currentTime,this.state.videoDuration,this.state.isPlaying)}},this._onSeek=e=>{this._viewerHasFocus&&this.props.controlsStore&&!this._videoPausedBeforeLoad&&this.props.controlsStore.setVideoPlayProgress({current:e.currentTime,duration:this.state.videoDuration})},this._onLoad=e=>{this.isComponentMounted()&&(this.setState({thumbnailLoaded:!0}),this.props.controller.onThumbnailLoaded&&this._viewerHasFocus&&this.props.controller.onThumbnailLoaded(this.props.media,!0),this._completeOpenAnimation&&this._completeOpenAnimation())},this._onError=()=>{this.isComponentMounted()&&(this.setState({thumbnailLoadFailed:!0}),this.props.controller.onThumbnailLoaded&&this._viewerHasFocus&&this.props.controller.onThumbnailLoaded(this.props.media,!1),this.props.onResumeAutoAdvance(!1))},this._playAccAnnouncementIfNeeded=()=>{if(!R.default.isMobileScreenReaderEnabled()||this._accessibilityAnnouncementPlayed)return;let e;this.state.displayName||(e=I.getString("MediaViewer.OpenedVideoUnknownAuthor")),this._isPrefetching()&&(e=I.getString("MediaViewer.Downloading")),e&&r.Accessibility.announceForAccessibility(e),this._accessibilityAnnouncementPlayed=!0}}_buildState(e,t){let s={mediaProfile:N.default.currentMediaProfile()};t&&(this._id=G.default.newCauseId());const i=this.props,o=t||!(0,T.default)(e.media,i.media);if(o&&(s.thumbnailLoaded=!1,s.thumbnailLoadFailed=!1,s.isPlaying=!1,s.videoDuration=0,s.isVideoLoaded=!1,s.videoLoadFailed=!1,s.showVideoPlayer=!1,s.isAuthTokenLoaded=!0,this._videoPausedBeforeLoad=!1),e.media.videoProvider===S.MediaProvider.AMS&&(s.authToken=H.default.getRawSkypeToken(),s.isAuthTokenLoaded=!0),e.cacheMode===k.CacheMode.Disabled||e.media.videoProvider===S.MediaProvider.AzureMS)s.videoUrl=e.media.videoUrl,s.videoProvider=e.media.videoProvider,b.log(f.LogTraceArea.VideoViewer,"Cache is disabled hence loading full video from network "+e.media.id);else if(o||!this.state.isVideoLoaded){const t=e.cacheId?_.default.getLocalUri(e.cacheId):void 0;t?(s.videoUrl=t,s.videoProvider=S.MediaProvider.FileCache,b.log(f.LogTraceArea.VideoViewer,"Loading full video from cache "+e.media.id)):e.cacheMode===k.CacheMode.FileCacheWithNetFallback&&(s.videoUrl=e.media.videoUrl,s.videoProvider=e.media.videoProvider,b.log(f.LogTraceArea.VideoViewer,"Loading full video from network "+e.media.id))}const n=w.default.getActivePlayerToken();if(!t&&this._playerToken!==n&&this.state.isPlaying&&(s.isPlaying=!1),e.controller.getCurrentMessageForMedia){const t=e.controller.getCurrentMessageForMedia(e.media);t&&(s.displayName=m.default.getDisplayName(t.creator))}return s}_specializeInstrumentation(){this.props.viewMediaIntentScenario&&this.props.viewMediaIntentScenario.renameScenario(A.ScenarioName.PlayVideoIntent)}componentDidMount(){super.componentDidMount(),this._playerToken=w.default.registerAsPlayer(),this.state.isAuthTokenLoaded||h.default.getAuthToken().then((e=>{this.isComponentMounted()&&this.setState({authToken:e,isAuthTokenLoaded:!0})})),this._activationSubToken=l.default.subscribeForChanges("VideoViewer",this._onAppStateChange),this.props.controller.onMediaDescriptorMounted&&this.props.controller.onMediaDescriptorMounted(),b.log(f.LogTraceArea.VideoViewer,"VideoViewer("+this._id+").componentDidMount"),this._specializeInstrumentation()}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this._viewerHasFocus&&this._playAccAnnouncementIfNeeded();const i=G.default.newCauseId();b.log(f.LogTraceArea.VideoViewer,"VideoViewer("+this._id+").componentDidUpdate causeId: "+i),(t.isVideoLoaded&&!this.state.isVideoLoaded||t.isPlaying&&!this.state.isPlaying)&&(b.log(f.LogTraceArea.VideoViewer,"VideoViewer("+this._id+") pausing video. prevState.isVideoLoaded="+t.isVideoLoaded+" state.isVideoLoaded="+this.state.isVideoLoaded+" prevState.isPlaying="+t.isPlaying+" state.isPlaying="+this.state.isPlaying),this.pauseVideo()),this._viewerHasFocus&&((!this._videoPausedBeforeLoad&&!t.isVideoLoaded&&this.state.isVideoLoaded||!t.isPlaying&&this.state.isPlaying)&&this.isComponentMounted()&&(this._audioManagerClient.hasToken()?this.playVideo():this._audioManagerClient.requestMode(o.AudioModes.VideoPlayback,i).then((e=>{e&&this.isComponentMounted()&&(w.default.setAsActive(this._playerToken),this.playVideo())}))),this.state.isVideoLoaded&&this.state.isAuthTokenLoaded&&(this.props.controlsStore.setVideoPlayState(this.state.isPlaying?q.VideoPlayState.Playing:q.VideoPlayState.Paused),this.props.controlsStore.registerViewerCallbacks({onPlay:()=>{this.isComponentMounted()&&this.setState({isPlaying:!0})},onPause:()=>{this.isComponentMounted()&&this.setState({isPlaying:!1})},onSeekTo:e=>{this._onSeekTo(e)},onMute:e=>{this._muteVideo(e)}})),this._muteVideo(this.props.controlsStore.isMuted()))}_onToggleAllowScreenLock(e){e?n.default.allowScreenLock().catch((e=>{b.warn(f.LogTraceArea.VideoViewer,"VideoViewer("+this._id+") allowScreenLock failed: "+L.default.errorAsString(e))})):n.default.blockScreenLock().catch((e=>{b.warn(f.LogTraceArea.VideoViewer,"VideoViewer("+this._id+") blockScreenLock failed: "+L.default.errorAsString(e))}))}componentWillUnmount(){super.componentWillUnmount();const e=G.default.newCauseId();if(b.log(f.LogTraceArea.VideoViewer,"VideoViewer("+this._id+").componentWillUnmount causeId: "+e),this._cachingTimerStarted&&!this._cachingSuccess){this._cachingDuration=Date.now()-this._cachingStartTime,b.log(f.LogTraceArea.VideoViewer,`VideoViewer(${this._id}).componentWithUnmount tracking incomplete file caching cachingDuration: ${this._cachingDuration} causeId: ${e}`);let t=new P.VideoPlayback(this.props.media.videoUrl,this.props.media.videoProvider,this.props.media.originalSize,"VideoViewer",this.props.media.amsReferences,this.props.messagetype);t.setCachingStatus(this._cachingSuccess,this.props.cacheMode,this._cachingDuration),b.track(t)}this._audioManagerClient.release(e),this._onToggleAllowScreenLock(!0),this._accessibilityAnnouncementPlayed=!1,this._activationSubToken.unsubscribe()}render(){let e,t,s,i,o,n;if(this.state.videoLoadFailed&&(e=r.createElement(r.View,{style:[V.default.absoluteFill,$.centeredContainer,$.alternateViewContainer]},r.createElement(C.default,{icon:B.SkypeIcon.Warning,size:B.IconSize.size96,color:O.Color.white,style:$.thumbnailPlaceholderText}))),this.state.showVideoPlayer&&this.state.videoUrl&&(t=r.createElement(v.default,{style:$.videoOverflow},r.createElement(Q.default,{origin:"VideoViewer",key:"video-player",ref:this._onVideoPlayerRef,style:V.default.absoluteFill,source:this.state.videoUrl,authToken:this.state.authToken,mediaProvider:this.state.videoProvider,loop:this.props.media.loop,amsReferences:this.props.media.amsReferences,onEnded:this._onEnded,onLoadedData:this._onLoadedData,onCanPlay:this._onCanPlay,onError:this._onVideoLoadError,onProgress:this._onProgress,onSeek:this._onSeek,onWaiting:this._onWaiting,onPlaying:this._onPlaying,resizeMode:"contain",shouldRedirectForAndroidHLS:this._shouldRedirectForAndroidHLS(),resumeAfterForeground:this._shouldResumeAfterForeground(),playbackIntentScenario:this.props.viewMediaIntentScenario,size:this.props.media.originalSize,cacheMode:this.props.cacheMode,cachingDuration:this._cachingDuration,sizeInBytes:this.props.media.originalSizeInBytes,messagetype:this.props.messagetype,mediaProfile:this.state.mediaProfile})),s=r.createElement(K.VideoViewerControls,{controlsStore:this.props.controlsStore,autoHideHeaderFooterControls:this.props.autoHideHeaderFooterControls,onPlayOrPause:this.playOrPauseVideo})),(this.state.showVideoPlayer&&(!this.state.isVideoLoaded||!this.state.isAuthTokenLoaded||this.state.isVideoPausedOnBuffering||!this.state.videoUrl)||this.props.showSpinnerForDelayShare)&&!this.state.videoLoadFailed&&this.state.videoProvider!==S.MediaProvider.FileCache)if(this._isPrefetching()){const e=this._isMobile()?this._onLongPress:this._onContextMenu,t=this._isMobile()?void 0:this._onContextMenu,s=r.createElement(v.default,{style:[V.default.absoluteFill,$.centeredContainer],onLongPress:this.state.isDownloadPaused?void 0:e,onContextMenu:this.state.isDownloadPaused?void 0:t,onPress:this.state.isDownloadPaused?this._onPress:void 0},r.createElement(z.default,{contentUrls:[this.props.media.videoUrl],strokeColor:O.Color.white,size:B.IconSize.size60,showFiniteProgressIndicatorUI:!0,isDownloadPaused:this.state.isDownloadPaused,isDownload:!0}));i=r.createElement(p.default,{getMenuItems:this._getPauseDownloadMenuItems,onItemSelected:this._handlePauseOrResumeDownloadCommand,ref:this._onContextMenuRef,wrapperOnly:!0},s),o=r.createElement(v.default,{style:[V.default.absoluteFill,$.progressText]},r.createElement(W.default,{showShadow:!0,contentUrl:this.props.media.videoUrl,fileSizeInBytes:this.props.media.originalSizeInBytes,isDownload:!0,isDownloadPaused:this.state.isDownloadPaused}))}else i=r.createElement(r.View,{style:[V.default.absoluteFill,$.centeredContainer]},r.createElement(x.default,{size:u.SXActivityIndicatorSize.Medium,tintColor:O.Color.white}));this.props.media.thumbnailUrl&&(n=r.createElement(y.default,{origin:"VideoViewerThumbnail",style:$.thumbnail,containerStyle:$.viewerContainer,source:this.props.media.thumbnailUrl,resizeMode:"contain",onLoad:this._onLoad,onError:this._onError,shouldInstrument:!1}));let a,l,d=this.state.isPlaying?I.getString("MediaViewer.Pause"):I.getString("MediaViewer.Play");a=this.state.isPlaying?I.getString("MediaViewer.PauseVideo"):this.state.displayName?I.getString("MediaViewer.PlaySomeonesVideo",{senderName:this.state.displayName}):I.getString("MediaViewer.PlayVideo"),this._isPrefetching()?(this.state.isDownloadPaused?(d=I.getString("MediaViewer.ResumeDownload"),a=I.getString("MediaViewer.ResumeDownload")):(d=I.getString("MediaViewer.PauseDownload"),a=I.getString("MediaViewer.PauseDownload")),this.props.autoHideHeaderFooterControls&&this.props.autoHideHeaderFooterControls(!1)):l=this._isMobile()?this.props.onTap:void 0;let c=r.createElement(r.View,{style:[$.overlayContainerBackground,V.default.absoluteFill]});return r.createElement(r.View,{style:$.viewerContainer,accessibilityLabel:this.props.isMobileScreenReaderEnabled?void 0:d,importantForAccessibility:this.props.isMobileScreenReaderEnabled?r.Types.ImportantForAccessibility.No:void 0,accessibilityTraits:this.props.isMobileScreenReaderEnabled?void 0:r.Types.AccessibilityTrait.Button},r.createElement(r.GestureView,{style:$.videoOverflow,onPanVertical:this.props.onPanVertical,onPanHorizontal:this.props.onPanHorizontal,preferredPan:r.Types.PreferredPanGesture.Horizontal,accessibilityLabel:this.props.isMobileScreenReaderEnabled?void 0:a,onTap:l},r.createElement(r.Animated.View,{style:[$.videoOverflow,this._videoContainerAnimatedXStyle]},r.createElement(r.Animated.View,{style:[$.videoOverflow,this._videoContainerAnimatedYStyle]},r.createElement(r.Animated.View,{style:[$.videoOverflow,this._videoContainerAnimatedStyle]},n,c,t,e,this._showVideoControlsWithProgressBar()?void 0:s))),this._showVideoControlsWithProgressBar()?s:void 0,o,i))}_isMobile(){return!1}_showVideoControlsWithProgressBar(){return this._isMobile()}_shouldRedirectForAndroidHLS(){return!!this.props.media&&this.props.media.videoProvider===S.MediaProvider.AzureMS&&!1}setPauseButtonVisibility(e){this.props.controlsStore.setPlayPauseButtonState(e)}setScrubberControlsVisibility(e){this.props.controlsStore.setScrubberControlsVisibility(e)}playVideo(){this._videoPlayerRef&&(this._videoPlayerRef.play(),r.Accessibility.announceForAccessibility(I.getString("MediaViewer.PlayingVideo")),this.props.onPauseAutoAdvance(),this._onToggleAllowScreenLock(!1),this._isMobile()&&this.props.onPlayVideo&&this.props.onPlayVideo()),this.state.isVideoLoaded||(this._videoPausedBeforeLoad=!1)}stopVideo(){this._videoPlayerRef&&(this._videoPlayerRef.stop(),this.props.onPauseAutoAdvance(),this._onToggleAllowScreenLock(!0)),this.state.isVideoLoaded||(this._videoPausedBeforeLoad=!0)}pauseVideo(){this._videoPlayerRef&&(this._videoPlayerRef.pause(),r.Accessibility.announceForAccessibility(I.getString("MediaViewer.VideoPaused")),this.props.onPauseAutoAdvance(),this.state.isVideoPausedOnBuffering&&this.isComponentMounted()&&this.setState({isVideoPausedOnBuffering:!1}),this._onToggleAllowScreenLock(!0)),this.state.isVideoLoaded||(this._videoPausedBeforeLoad=!0)}_onSeekTo(e){this._videoPlayerRef&&(this._videoPlayerRef.seekPercent(e),this.props.onPauseAutoAdvance(),this.props.onShowHideControls(!0))}_muteVideo(e){this._videoPlayerRef&&this._videoPlayerRef.mute(e)}_onCompleteOpen(){this.isComponentMounted()&&this.setState({showVideoPlayer:!0})}_calcAnimateFromLocation(e){const t=this.props.media.thumbnailSize;if(!t)return e;let s=i.clone(e),o=e.width/e.height,n=t.width/t.height;if(Math.abs(o-n)>.1)if(o<n){let t=e.height*n;s.width=t,s.x-=(t-e.width)/2}else if(o>n){let t=e.width/n;s.height=t,s.y-=(t-e.height)/2}return s}_shouldResumeAfterForeground(){return!!this.props.resumeAfterForeground}canAnimateOpenClose(){return!!this.props.controller.getOptions().animateOpenClose&&this.hasValidMediaSize()}hasValidMediaSize(){const e=this.props.media.originalSize||this.props.media.thumbnailSize;return!!e&&e.width>0&&e.height>0}animateOpen(e){let t=a.Defer();this._viewerBounds={width:e.width,height:e.height},this._viewerHasFocus=!0,this.props.onPauseAutoAdvance();const s=this.props.media.originalSize||this.props.media.thumbnailSize,o=s?g.default.fitToContainer(s,this._viewerBounds,!0):this._viewerBounds,n=(this._viewerBounds.width-o.width)/2,l=(this._viewerBounds.height-o.height)/2;this._containerAnimatedWidthValue.setValue(o.width),this._containerAnimatedHeightValue.setValue(o.height),this._currentScale=this._defaultScale,this._currentTranslateX=n,this._currentTranslateY=l;const d=()=>{this._containerAnimatedScaleValue.setValue(this._defaultScale),this._containerAnimatedTranslateXValue.setValue(n),this._containerAnimatedTranslateYValue.setValue(l),this._containerAnimatedOpacityValue.setValue(1),this._onCompleteOpen(),t.resolve(void 0)};return this.props.controller.getMediaLocationInWindow?this.props.controller.getMediaLocationInWindow(this.props.media).then((e=>{let s=this._calcAnimateFromLocation(e);const a=s.width?s.width/o.width:this._currentScale,d=s.x?s.x-(1-a)*o.width/2:this._currentTranslateX,c=s.y?s.y-(1-a)*o.height/2:this._currentTranslateY;this._containerAnimatedScaleValue.setValue(a),this._containerAnimatedTranslateXValue.setValue(D.default.isRTL()?-d:d),this._containerAnimatedTranslateYValue.setValue(c),this._containerAnimatedOpacityValue.setValue(1),this._completeOpenAnimation=()=>{this.props.controller.onHideMedia&&this.props.controller.onHideMedia(this.props.media),this._animateZoom(n,l,this._defaultScale,r.Animated.Easing.Out(),(()=>{this._onCompleteOpen(),t.resolve(void 0)})),this._completeOpenAnimation=void 0},this.state.thumbnailLoaded||this.state.thumbnailLoadFailed?this._completeOpenAnimation():i.delay((()=>{this._completeOpenAnimation&&this._completeOpenAnimation()}),500)})).fail(d):d(),t.promise()}animateClose(e,t){let s=a.Defer();if(this.canAnimateOpenClose()){this._viewerBounds||(this._viewerBounds={width:0,height:0});let i=[r.Animated.timing(this.props.backgroundOpacityValue,{toValue:0,duration:this._openCloseAnimationDuration,easing:r.Animated.Easing.Linear()})];if(e){let t=this.props.media.originalSize||this.props.media.thumbnailSize;const s=t?g.default.fitToContainer(t,this._viewerBounds,!0):this._viewerBounds,o=e.width?e.width/s.width:this._currentScale,n=e.x?e.x-(1-o)*s.width/2:this._currentTranslateX,a=e.y?e.y-(1-o)*s.height/2:this._currentTranslateY;i.push(r.Animated.timing(this._containerAnimatedScaleValue,{toValue:o,duration:this._openCloseAnimationDuration,easing:r.Animated.Easing.In()})),i.push(r.Animated.timing(this._containerAnimatedTranslateXValue,{toValue:n,duration:this._openCloseAnimationDuration,easing:r.Animated.Easing.In()})),i.push(r.Animated.timing(this._containerAnimatedTranslateYValue,{toValue:a,duration:this._openCloseAnimationDuration,easing:r.Animated.Easing.In()}))}else t===k.DismissAnimationType.Vertical?i.push(r.Animated.timing(this._containerAnimatedTranslateYValue,{toValue:this._viewerBounds.height,duration:this._openCloseAnimationDuration,easing:r.Animated.Easing.Out()})):t===k.DismissAnimationType.Horizontal&&i.push(r.Animated.timing(this._containerAnimatedTranslateXValue,{toValue:-1*this._viewerBounds.width,duration:this._openCloseAnimationDuration,easing:r.Animated.Easing.Out()}));r.Animated.parallel(i).start((()=>{this.isComponentMounted()&&this.props.controller.onShowMedia&&this.props.controller.onShowMedia(this.props.media),s.resolve(void 0)}))}else this.props.backgroundOpacityValue.setValue(0),this.props.controller.onShowMedia&&this.props.controller.onShowMedia(this.props.media),s.resolve(void 0);return s.promise()}_handleCaching(e,t){super._handleCaching(e,t);const s=!!this.props.media;b.log(f.LogTraceArea.VideoViewer,"handleCaching, has media: "+s+" mediaId: "+(s?this.props.media.id:"none")+" cacheMode: "+this.props.cacheMode+" cacheId: "+this.props.cacheId+" causeId: "+t),this._isPrefetchingSupported()&&(e&&!this.state.isDownloadPaused?this._startPrefetching():this._cancelPrefetching(t))}presentMedia(e,t,s){this._viewerBounds=e;const i=G.default.newCauseId();b.log(f.LogTraceArea.MediaViewer,"Media presentMedia, causeId: "+i),this._handleCaching(t,i),this._viewerHasFocus!==t&&(this._viewerHasFocus=t,t?(this.props.onPauseAutoAdvance(),this.props.controller.onHideMedia&&this.props.controller.onHideMedia(this.props.media),this.props.controlsStore&&(this.props.controlsStore.setVideoPlayProgress({current:0,duration:0}),this.props.controlsStore.setVideoPlayState(q.VideoPlayState.NotLoaded)),this.isComponentMounted()&&this.setState({showVideoPlayer:!!this.props.media.videoUrl,videoLoadFailed:!this.props.media.videoUrl,isPlaying:this.state.isVideoLoaded}),this._videoPausedBeforeLoad=!1):(this.props.controller.onShowMedia&&this.props.controller.onShowMedia(this.props.media),this.props.controlsStore&&this.props.controlsStore.setVideoPlayState(q.VideoPlayState.Paused),this.isComponentMounted()&&this.setState({showVideoPlayer:!1,videoLoadFailed:!1,isVideoLoaded:!1,isPlaying:!1}),this._videoPausedBeforeLoad=!1));let o=this._viewerBounds;if(this.hasValidMediaSize()){const e=this.props.media.originalSize||this.props.media.thumbnailSize;e&&(o=g.default.fitToContainer(e,this._viewerBounds,!0))}this._currentScale=this._defaultScale;const n=(this._viewerBounds.width-o.width)/2,r=(this._viewerBounds.height-o.height)/2;this._currentTranslateX=n,this._currentTranslateY=r,this._containerAnimatedWidthValue.setValue(o.width),this._containerAnimatedHeightValue.setValue(o.height),this._containerAnimatedTranslateXValue.setValue(D.default.isRTL()?-n:n),this._containerAnimatedTranslateYValue.setValue(r),this._containerAnimatedScaleValue.setValue(this._defaultScale),this._containerAnimatedOpacityValue.setValue(1),this.props.backgroundOpacityValue.setValue(1),s&&t&&this._onCompleteOpen()}getCloseButtonAccLabel(){return I.getString("MediaViewer.CloseButtonAccLabelVideo")}_isPrefetchingSupported(){return!(!this.props.media||!this.props.media.videoUrl||j.default.isFileOrBlob(this.props.media.videoUrl)||this.props.media.videoProvider===S.MediaProvider.AzureMS||this.props.cacheMode!==k.CacheMode.FileCacheWithPrefetching)}_isPrefetching(){return!this.state.isVideoLoaded&&this._isPrefetchingSupported()}_startPrefetching(){if(this.props.cacheId){b.log(f.LogTraceArea.VideoViewer,"VideoViewer("+this._id+").handleCaching prefetching media for "+this.props.media.id),this._cachingTimerStarted||(this._cachingTimerStarted=!0,this._cachingStartTime=Date.now(),this._cachingSuccess=!1,b.log(f.LogTraceArea.VideoViewer,`VideoViewer(${this._id}).handleCaching cachingStartTime: ${this._cachingStartTime} cacheId: ${this.props.cacheId} videoUrl: ${E.dev_unknownOmit(this.props.media.videoUrl)}`));const e=1e3*d.default.getS4LCMCFeaturesNoSubscription().videoPrefetchCacheExpiryTimeSec;this.prefetchMediaToCacheIfSupported(this.props.cacheId,this.props.media.videoUrl,this.props.media.downloadFileName,e).then((e=>{e&&this._cachingTimerStarted&&(this._cachingDuration=Date.now()-this._cachingStartTime,this._cachingSuccess=!0,b.log(f.LogTraceArea.VideoViewer,`VideoViewer(${this._id}).handleCaching cachingDuration: ${this._cachingDuration} cacheId: ${this.props.cacheId} videoUrl: ${E.dev_unknownOmit(this.props.media.videoUrl)} value: ${e}`))}))}}_cancelPrefetching(e){this.props.cacheId&&(b.log(f.LogTraceArea.VideoViewer,"VideoViewer("+this._id+").handleCaching cancelling prefetching for "+this.props.media.id+" causeId: "+e),this.cancelPrefetchIfPending(this.props.cacheId,e))}}t.VideoViewer=J,J.MediaType=k.MediaViewerTypes.Video},16718:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VideoViewerControls=void 0;const i=s(96486),o=s(16778),n=s(88837),r=s(62602),a=s(16402),l=s(46096),d=s(10117),c=s(36237),h=s(15877),u=s(33754),p=s(4057),g=s(81760),m=s(11010),S=s(11828),f=s(80837),y=s(54288),_=16,v=(0,h.lazyProperties)({container:()=>f.default.absoluteFill,progressBar:()=>o.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,backgroundColor:g.Color.white}),buttonContainer:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch",justifyContent:"center",alignItems:"center",opacity:.75}),playButtonContainer:()=>o.Styles.createViewStyle({backgroundColor:g.Color.blackOverlay10,borderColor:g.Color.white,borderWidth:2,height:60,width:60,borderRadius:60,alignItems:"center",justifyContent:"center"}),progressBarWithScrubberContainer:()=>o.Styles.createViewStyle({flex:-1,flexDirection:"row",height:48,margin:4,position:"absolute",bottom:40,left:0,right:0,alignItems:"center",justifyContent:"flex-end",paddingLeft:5,paddingRight:5}),progressBarWithScrubberContainerCompact:()=>o.Styles.createViewStyle({height:34,bottom:0}),gestureView:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch",flexDirection:"row",alignItems:"center",backgroundColor:g.Color.transparent,paddingLeft:5,paddingRight:5}),propgressBarWithScrubber:()=>o.Styles.createViewStyle({flex:1,alignSelf:"center",height:2,borderRadius:4,backgroundColor:g.Color.whiteOverlay50}),progressBarWithScrubberDesktop:()=>o.Styles.createViewStyle({height:4}),scrubberThumb:()=>o.Styles.createViewStyle({position:"absolute",bottom:0,backgroundColor:g.Color.white}),scrubberThumbRegular:()=>o.Styles.createViewStyle({top:16,width:_,height:_,borderRadius:8}),scrubberThumbEnlarged:()=>o.Styles.createViewStyle({top:8,width:32,height:32,borderRadius:16}),scrubberCompactThumbRegular:()=>o.Styles.createViewStyle({top:9}),scrubberCompactThumbEnlarged:()=>o.Styles.createViewStyle({top:1}),timeText:()=>o.Styles.createTextStyle({color:g.Color.white,flex:-1,textAlign:"center",fontSize:m.default.fontSize.size13Deprecated}),timeTextDesktop:()=>o.Styles.createTextStyle({fontSize:m.default.controlFontSize.bodySmallDeprecated}),hoverBackgroundStyle:()=>o.Styles.createViewStyle({backgroundColor:g.Color.blackOverlay20})});class C extends n.ComponentBase{constructor(){super(...arguments),this._currentScrubberThumbDiameter=_,this._progressBarAnimatedWidth=new o.Animated.Value(0),this._progressBarAnimatedWidthStyle=o.Styles.createAnimatedViewStyle({width:this._progressBarAnimatedWidth}),this._scrubberThumbLeftValue=new o.Animated.Value(0),this._scrubberThumbLeftStyle=o.Styles.createAnimatedViewStyle({left:this._scrubberThumbLeftValue}),this._videoControlsAnimatedOpacityValue=new o.Animated.Value(0),this._videoControlsOpacityAnimatedStyle=o.Styles.createAnimatedViewStyle({opacity:this._videoControlsAnimatedOpacityValue}),this._overrideShowControlsValue=!1,this._onProgressBarHoverStart=()=>{this._overrideShowControls(!0)},this._onProgressBarHoverEnd=()=>{this._overrideShowControls(!1)},this._onScrubberRef=e=>{this._scrubberRef=e||void 0},this._onPan=e=>{this._onScrub(e,!e.isComplete)},this._onScrub=(e,t=!1)=>{this._scrubberRef&&r.default.measureLayoutRelativeToWindow((()=>this._scrubberRef)).then((s=>{if(this.isComponentMounted()){const i=(this._progressBarWidth||0)-this._currentScrubberThumbDiameter,o=e.pageX-s.x-this._currentScrubberThumbDiameter/2;let n=i>0?o/i:0;n=Math.max(n,0),n=Math.min(n,1),this.props.controlsStore.seekTo(n,t)}}),(e=>{c.warn(l.LogTraceArea.VideoViewer,"Scrubber component not measured: "+p.default.errorAsString(e))}))},this._overrideShowControls=e=>{this._overrideShowControlsValue=e,this.isComponentMounted()&&(this._overrideShowControlsValue?this.setState({showScrubberControls:!0,showScrubberThumb:!0}):this.setState({showScrubberThumb:!1}))},this._onLayout=e=>{this._progressBarWidth=e.width,this._recalcProgressBarWidth()},this._onPausePlay=e=>{this.props.onPlayOrPause(),e.stopPropagation()}}_buildState(e,t){let s={playState:e.controlsStore.getVideoPlayState(),playPauseButtonShown:e.controlsStore.isPlayPauseButtonShown(),showScrubberControls:e.controlsStore.isScrubberShown()};const i=this.props;return(t||e.controlsStore!==i.controlsStore)&&(s.playbackProgress=e.controlsStore.getVideoPlayProgress(),e.controlsStore.subscribeForViewerControlsChanges((()=>this._onViewerControlsChanged())),this._videoControlsAnimatedOpacityValue.setValue(e.controlsStore.isScrubberShown()?1:0)),s}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this._recalcProgressBarWidth(),t.showScrubberControls!==this.state.showScrubberControls&&this._animateShowOrHideControls()}render(){const e=this.state.playbackProgress.duration>0,t=e&&this.state.playState===y.VideoPlayState.Paused;let s,n,r,l=[v.container];if(e){l.push(v.hoverBackgroundStyle),t||l.push(this._videoControlsOpacityAnimatedStyle);const e=t?S.SkypeIcon.Play:this.state.showScrubberControls?S.SkypeIcon.Pause:void 0,i=e?o.createElement(d.default,{icon:e,size:S.IconSize.size24,color:g.Color.white}):void 0;s=(t||this.state.playState===y.VideoPlayState.Playing&&this.state.showScrubberControls)&&this.state.playPauseButtonShown?o.createElement(o.View,{style:v.playButtonContainer,onPress:void 0,importantForAccessibility:o.Types.ImportantForAccessibility.Yes,accessibilityLabel:u.getString("MediaViewer.PlayVideo")},i):void 0}n=o.createElement(o.Button,{style:v.buttonContainer,onPress:this._onPausePlay},s);const c=[v.progressBar,this._progressBarAnimatedWidthStyle],h=o.createElement(o.Animated.View,{style:c});if(i.isFinite(this.state.playbackProgress.duration)&&this.state.playbackProgress.duration){const e=a.default.getElapsedTimeStringFromS(this.state.playbackProgress.current),s=a.default.getElapsedTimeStringFromS(this.state.playbackProgress.duration),i=[v.timeText];i.push(v.timeTextDesktop);let n=[v.progressBarWithScrubberContainer];this.props.useCompactLayout&&n.push(v.progressBarWithScrubberContainerCompact),t&&n.push(this._videoControlsOpacityAnimatedStyle),this.props.progressBarStyle&&n.push(this.props.progressBarStyle);const l=[v.propgressBarWithScrubber];l.push(v.progressBarWithScrubberDesktop),r=o.createElement(o.Animated.View,{style:n,onMouseEnter:this._onProgressBarHoverStart,onMouseLeave:this._onProgressBarHoverEnd},o.createElement(o.Text,{style:i},e),o.createElement(o.GestureView,{ref:this._onScrubberRef,style:v.gestureView,onTap:this._onScrub,onPan:this._onPan,preferredPan:o.Types.PreferredPanGesture.Horizontal,mouseOverCursor:o.Types.GestureMouseCursor.Pointer},o.createElement(o.View,{style:l,onLayout:this._onLayout},h),this.state.showScrubberThumb&&this._renderScrubberThumb()),o.createElement(o.Text,{style:i},s))}return o.createElement(o.Animated.View,{style:l},n,r)}_renderScrubberThumb(){const e=[v.scrubberThumb,this._scrubberThumbLeftStyle,v.scrubberThumbRegular];return this.props.useCompactLayout&&e.push(v.scrubberCompactThumbRegular),o.createElement(o.Animated.View,{style:e})}_animateShowOrHideControls(){const e=this.state.showScrubberControls?1:0;o.Animated.timing(this._videoControlsAnimatedOpacityValue,{toValue:e,duration:200,easing:o.Animated.Easing.InOut()}).start()}_onViewerControlsChanged(){if(!this.isComponentMounted())return;const e=this.props.controlsStore,t=e.getVideoPlayState();let s=this.state.playState;t===s||t===y.VideoPlayState.Paused&&s===y.VideoPlayState.NotLoaded||(s=t);let i={playState:s,playPauseButtonShown:e.isPlayPauseButtonShown(),playbackProgress:e.getVideoPlayProgress(),showScrubberControls:e.isScrubberShown()||this._overrideShowControlsValue};this.setState(i)}_recalcProgressBarWidth(){const{playbackProgress:e,showScrubberThumb:t}=this.state,s=e.duration?(this._progressBarWidth||0)*e.current/e.duration:0;this._progressBarAnimatedWidth.setValue(s),t&&this._scrubberThumbLeftValue.setValue(s>this._currentScrubberThumbDiameter?s-this._currentScrubberThumbDiameter/2:this._currentScrubberThumbDiameter/4)}}t.VideoViewerControls=C},54288:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VideoViewerControlsStore=t.VideoPlayState=void 0;const i=s(61253);var o;!function(e){e[e.NotLoaded=0]="NotLoaded",e[e.Paused=1]="Paused",e[e.Playing=2]="Playing"}(o=t.VideoPlayState||(t.VideoPlayState={}));class n{constructor(e=!0){this._playState=o.NotLoaded,this._playPauseButtonShown=!1,this._scrubberShown=!1,this._playProgress={current:0,duration:0},this._isMutedLocal=!1,this._useGlobalMute=!0,this._useGlobalMute=e,this._playState=o.NotLoaded}subscribeForViewerControlsChanges(e){this._onViewerControlsChanged=e}getVideoPlayState(){return this._playState}getVideoPlayProgress(){return this._playProgress}isMuted(){return this._useGlobalMute?n._isMutedGlobal:this._isMutedLocal}isPlayPauseButtonShown(){return this._playPauseButtonShown}isScrubberShown(){return this._scrubberShown}play(){this._videoViewerCallbacks&&this._videoViewerCallbacks.onPlay()}pause(){this._videoViewerCallbacks&&this._videoViewerCallbacks.onPause()}seekTo(e,t){this._videoViewerCallbacks&&this._videoViewerCallbacks.onSeekTo(e,t)}mute(e){this._setMute(e),this._videoViewerCallbacks&&this._videoViewerCallbacks.onMute&&this._videoViewerCallbacks.onMute(e),this._onViewerControlsChanged&&this._onViewerControlsChanged()}registerViewerCallbacks(e){this._videoViewerCallbacks=e}setPlayPauseButtonState(e){(0,i.default)(this._playPauseButtonShown,e)||(this._playPauseButtonShown=e,this._onViewerControlsChanged&&this._onViewerControlsChanged())}setScrubberControlsVisibility(e){(0,i.default)(this._scrubberShown,e)||(this._scrubberShown=e,this._onViewerControlsChanged&&this._onViewerControlsChanged())}setVideoPlayState(e){this._playState!==e&&(this._playState=e,this._onViewerControlsChanged&&this._onViewerControlsChanged())}setVideoPlayProgress(e){this._playProgress=e,this._onViewerControlsChanged&&this._onViewerControlsChanged()}_setMute(e){this._useGlobalMute?n._isMutedGlobal=e:this._isMutedLocal=e}}t.VideoViewerControlsStore=n,n._isMutedGlobal=!1},23095:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AltMsgView=void 0;const i=s(16778),o=s(67579),n=s(77388),r=s(80837);class a extends i.Component{constructor(e){super(e),this._dynamicList=null,this._observableListSubscription=null,this._onDynamicListRef=e=>{this._dynamicList=e,this._observableListSubscription&&this._observableListSubscription.unsubscribe(),this._dynamicList&&(this._dynamicList.onDataChanged(0,Number.MAX_VALUE,0,this.props.observableList.getItemList()),this._observableListSubscription=this.props.observableList.listChanged.subscribe(this._onDataChanged))},this._onDataChanged=e=>{if(this._dynamicList){let t=0,s=0;e.type!==n.ListModificationType.RemoveItems&&e.type!==n.ListModificationType.ReplaceItems&&e.type!==n.ListModificationType.MoveItems||void 0!==e.removeIndex&&e.count&&(t=e.removeIndex,s=e.count);let i=0,o=[];e.type!==n.ListModificationType.AddItems&&e.type!==n.ListModificationType.ReplaceItems&&e.type!==n.ListModificationType.MoveItems||void 0!==e.insertIndex&&e.items&&(i=e.insertIndex,o=e.items),this._dynamicList.onDataChanged(t,s,i,o)}},this._onLayout=e=>{this.props.onLayout&&this.props.onLayout(e),this.setState({isListVisible:!0})},this._onListViewportChange=e=>{if(this.props.onVisibleRangeChanged&&e.itemsInViewport){const t=e.itemsInViewport.first,s=e.itemsInViewport.last,i=e.itemsFullyInViewport?e.itemsFullyInViewport.first:t,o=e.itemsFullyInViewport?e.itemsFullyInViewport.last:i;this.props.onVisibleRangeChanged(t,s,i,o)}},this.state={isListVisible:!1}}render(){return i.createElement(i.View,{style:r.default.flexOne,onLayout:this._onLayout},this.state.isListVisible&&i.createElement(o.default,{ref:this._onDynamicListRef,renderItem:this.props.renderItem,onViewportChange:this._onListViewportChange,initialScrollIndex:this.props.initialScrollIndex}))}scrollToBottom(){this._dynamicList&&this._dynamicList.scrollToEnd()}scrollToPosition(e,t,s=!1){this._dynamicList&&this._dynamicList.scrollToPosition(e)}focusMessage(e){}}t.AltMsgView=a},23284:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(44770),n=s(51577),r=s(65976),a=s(51077),l=s(98278),d=s(29791),c=s(23293),h=s(86374),u=s(73145),p=s(52262),g=s(46096),m=s(74313),S=s(39821),f=s(10117),y=s(36237),_=s(15877),v=s(33754),C=s(12762),b=s(89808),T=s(18078),M=s(14976),I=s(81115),w=s(46529),P=s(15415),k=s(81760),A=s(11010),E=s(11828),R=s(80837),L=s(24576),F=s(75865),x=(0,_.lazyProperties)({pictureContainer:()=>i.Styles.createViewStyle({flex:1,alignItems:"stretch",backgroundColor:k.Color.gray300}),videoInfoContainer:()=>i.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:k.Color.transparent}),creatorInfoContainer:()=>i.Styles.createViewStyle({position:"absolute",left:10,right:10,bottom:10,flexDirection:"row",backgroundColor:k.Color.transparent,alignItems:"center"}),creatorTextStyle:()=>i.Styles.createTextStyle({color:k.Color.white,marginRight:10}),alternateViewContainer:()=>i.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center"}),overlayTextCenter:()=>i.Styles.createViewStyle({alignItems:"center",justifyContent:"center"}),loadingContainer:()=>i.Styles.createViewStyle({justifyContent:"center",alignItems:"center",position:"absolute",left:0,right:0,top:0,bottom:0}),overlay:()=>i.Styles.createViewStyle({justifyContent:"center",alignItems:"center",position:"absolute",left:0,right:0,top:0,bottom:0,backgroundColor:k.Color.blackOverlay20}),actionButtonBorderStyle:()=>i.Styles.createViewStyle({backgroundColor:k.Color.blackOverlay10,borderStyle:"solid",borderWidth:1,borderColor:k.Color.white,alignItems:"center",justifyContent:"center"})});class O extends L.default{constructor(){super(...arguments),this._opacityValue=new i.Animated.Value(1),this._opacityStyle=i.Styles.createAnimatedViewStyle({opacity:this._opacityValue}),this._buttonOpacityValue=new i.Animated.Value(1),this._buttonOpacityStyle=i.Styles.createAnimatedViewStyle({opacity:this._buttonOpacityValue}),this._getReactionMenuAnchor=()=>this._contentRef,this._onContentRef=e=>{this._contentRef=e||void 0},this._onButtonRef=e=>{this._buttonRef=e||void 0},this._getContextMenuItems=()=>this.props.messageActions?this._commandManager.getSXMenuItems(this._getCommandManagerOptions(),this.props.messageActions.actionMenuCommands):[],this._onPress=e=>{e.stopPropagation(),this.props.onThumbnailPress&&this.props.onThumbnailPress(this.props.message)},this._onPressIn=e=>{e.stopPropagation(),this._buttonOpacityValue.setValue(.8)},this._onPressOut=e=>{e.stopPropagation(),this._buttonOpacityValue.setValue(1)},this._showContextMenuOnMobile=e=>{e.stopPropagation(),this._commandManager&&this.props.messageActions&&this._commandManager.showActionMenu(this._getCommandManagerOptions(),(()=>this.isComponentMounted()?this:void 0),this._getRootViewId(),"messageActionMenu",this.props.messageActions.actionMenuTitle,this.props.messageActions.actionMenuCommands,e)},this._onStreamItemCommandSelected=(e,t)=>{this._intOnCommandSelected(e,t.rootViewId)},this._onCommandSelected=e=>{this._intOnCommandSelected(e,this._getRootViewId())},this._onThumbnailLoaded=()=>{this.isComponentMounted()&&this.setState({thumbnailLoaded:!0})},this._onThumbnailError=e=>{this.state.isNetworkUrl?(y.error(g.LogTraceArea.GenericUnsafe,"MediaThumbnail failed to load image from network: "+this.state.thumbnailUrl),!this.state.networkThumbnailHasFailed&&this._canUseFullMediaUrl(this.props.message)&&this.isComponentMounted()&&this.setState({thumbnailUrl:this._getFullMediaNetworkUrl(this.props.message),networkThumbnailHasFailed:!0})):(y.error(g.LogTraceArea.GenericUnsafe,"MediaThumbnail failed to load image from file cache: "+this.state.thumbnailUrl),this.isComponentMounted()&&this.setState({thumbnailUrl:this._getThumbnailNetworkUrl(this.props.message),isNetworkUrl:!0,fileCacheThumbnailHasFailed:!0}))}}_buildState(e,t){const s=this.props;(t||s.message!==e.message)&&(this._decodedNode=h.decode(e.message)),this._commandManager||(this._commandManager=new w.StreamItemCommandManager(this._onStreamItemCommandSelected));const i={messageGroup:a.getMessageTypeGroup(e.message),displayInfo:e.showCreator&&e.message.creator?p.default.getDisplayableProfile(e.message.creator):void 0};return t||s.message.cuid!==e.message.cuid?(i.isNetworkUrl=void 0,i.networkThumbnailHasFailed=void 0,i.thumbnailLoaded=void 0,i.thumbnailUrl=void 0,i.fileCacheThumbnailHasFailed=void 0):(i.isNetworkUrl=this.state.isNetworkUrl,i.networkThumbnailHasFailed=this.state.networkThumbnailHasFailed,i.thumbnailLoaded=this.state.thumbnailLoaded,i.thumbnailUrl=this.state.thumbnailUrl,i.fileCacheThumbnailHasFailed=this.state.fileCacheThumbnailHasFailed),i.thumbnailLoaded||(e.useFileCache&&!i.fileCacheThumbnailHasFailed&&(i.thumbnailUrl=S.default.getLocalUri(r.getFileCacheKeyMediaThumb(e.message)),i.thumbnailUrl&&y.log(g.LogTraceArea.MediaThumbnail,"Thumbnail image is from file cache "+M.dev_unknownOmit(i.thumbnailUrl)),!i.thumbnailUrl&&this._canUseFullMediaUrl(e.message)&&(0,n.isDisplayableOrFullResImageCached)(e.message)&&(i.thumbnailUrl=(0,n.getLocalDisplayableOrFullResUri)(e.message),i.thumbnailUrl&&y.log(g.LogTraceArea.MediaThumbnail,"Full image is from file cache "+M.dev_unknownOmit(i.thumbnailUrl)))),i.thumbnailUrl||(i.networkThumbnailHasFailed?(i.thumbnailUrl=this._getFullMediaNetworkUrl(e.message),y.log(g.LogTraceArea.MediaThumbnail,"Full image is from network "+M.dev_unknownOmit(i.thumbnailUrl))):(i.thumbnailUrl=this._getThumbnailNetworkUrl(e.message),y.log(g.LogTraceArea.MediaThumbnail,"Thumbnail image is from network "+M.dev_unknownOmit(i.thumbnailUrl))))),i.messageAccessibilityLabel=e.shouldUseMessageAccessibilityLabel?d.toAccessibilityLabel(h.decode(e.message),{message:e.message}):void 0,i}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this._borderRadiusStyle=this._getBorderRadiusStyle(this.props.borderRadius),this._backgroundColorStyle=this._getBackgroundColorStyle()}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),this.props.borderRadius!==e.borderRadius&&(this._borderRadiusStyle=this._getBorderRadiusStyle(this.props.borderRadius)),this.props.message.creator!==e.message.creator&&(this._backgroundColorStyle=this._getBackgroundColorStyle())}requestFocus(){this._buttonRef?this._buttonRef.requestFocus():this._contentRef&&this._contentRef.requestFocus()}render(){const e=i.Styles.createViewStyle({height:this.props.height,width:this.props.width},!1),t=this._getThumbnailErrorView(),s=this._getThumbnailAlternateView(),o=[e,this._getImageViewBackgroundStyle()],n=[e];this._borderRadiusStyle&&(o.push(this._borderRadiusStyle),n.push(this._borderRadiusStyle));const r=i.createElement(i.Animated.View,{style:this._buttonOpacityStyle},i.createElement(m.default,{origin:"mediaThumbnail",style:n,containerStyle:o,source:this.state.thumbnailUrl,altView:s,errorView:t,resizeMode:"cover",shouldInstrument:!0,onLoad:this._onThumbnailLoaded,onError:this._onThumbnailError,noRetryOnError:!this.state.isNetworkUrl})),a=this._getCreatorView(),d=this._getVideoMediaTypeIconView(),c=this._getUnreadBadgeView(),h=this.props.showOverlay&&this.state.thumbnailLoaded?i.createElement(i.View,{style:x.overlay}):void 0,p=this.props.onThumbnailPress||this.props.messageActions;let g;const S=[this.state.messageAccessibilityLabel,this.props.accessibilityLabel].join(", ");let f;g=p?i.createElement(i.Button,{ref:this._onButtonRef,style:e,onPress:this._onPress,onPressIn:this._onPressIn,onPressOut:this._onPressOut,onLongPress:this.props.messageActions?this._showContextMenuOnMobile:void 0,disableTouchOpacityAnimation:!0,accessibilityLabel:S,tabIndex:this.props.tabIndex},r,h,a,c,d):i.createElement(i.View,{style:e,accessibilityLabel:S},r,h,a,c,d),this.props.showLoading&&(f=i.createElement(i.View,{style:x.loadingContainer},i.createElement(P.default,{size:l.SXActivityIndicatorSize.Medium})));let y=i.createElement(i.Animated.View,{ref:this._onContentRef,style:[e,this._opacityStyle,this.props.style],shouldRasterizeIOS:!0},g,f);return this.props.messageActions&&(y=i.createElement(u.default,{wrapperStyle:R.default.flexZero,getMenuItems:this._getContextMenuItems,onItemSelected:this._onCommandSelected},y)),y}_getCommandManagerOptions(){return{message:this.props.message,decodedNode:this._decodedNode,renderOrigin:this.props.renderOrigin,getReactionMenuPopupAnchor:this._getReactionMenuAnchor,componentContext:this._getContext(),getRootWindowComponent:this._getReactionMenuAnchor}}_getImageViewBackgroundStyle(){return x.pictureContainer}_getThumbnailAlternateView(){let e;const t=this.props.thumbnailIconsSize?this.props.thumbnailIconsSize:E.IconSize.size60,s=this.props.useLoadingImage?i.createElement(i.Image,{style:R.default.absoluteFill,resizeMode:"contain",source:o.Collection.WIGGLE_PATTERN_350}):void 0,n=this._useAccessibleTheme()?this._themeColors.primaryIconColor:k.Color.gray200;if(this.props.useLoadingImage){const t=[x.alternateViewContainer,this._backgroundColorStyle];this._borderRadiusStyle&&t.push(this._borderRadiusStyle),e=i.createElement(i.View,{style:t},s)}else e=i.createElement(i.View,{style:x.alternateViewContainer},s,i.createElement(f.default,{icon:E.SkypeIcon.Picture,size:t,color:n}));return e}_getThumbnailErrorView(){let e;const t=this.props.thumbnailIconsSize?this.props.thumbnailIconsSize:E.IconSize.size60,s=this.props.useLoadingImage?i.createElement(i.Image,{style:R.default.absoluteFill,resizeMode:"contain",source:o.Collection.WIGGLE_PATTERN_350}):void 0,n=this._useAccessibleTheme()?this._themeColors.primaryIconColor:k.Color.gray200;return e=i.createElement(i.View,{style:x.alternateViewContainer},s,i.createElement(f.default,{icon:E.SkypeIcon.Warning,size:t,color:n})),e}_getCreatorView(){if(this.props.showCreator){const e=[A.default.fontStyle.subtitle],t=v.getString("ConversationsListItem.UnknownConversationName"),s=this.state.displayInfo?this.state.displayInfo.getDisplayName(t):t,o=[x.creatorInfoContainer];return e.push(x.creatorTextStyle),this.props.horizontalInsets&&(this.props.horizontalInsets.left||this.props.horizontalInsets.right)&&o.push(I.default.horizontalPaddingStyle(this.props.horizontalInsets)),i.createElement(i.View,{style:o},i.createElement(i.Text,{style:e,numberOfLines:1},s))}}_getVideoMediaTypeIconView(){if(this.props.showVideoMediaTypeIcon&&this.state.thumbnailLoaded&&this.state.messageGroup===a.MessageTypeGroups.Video){const e=this.props.thumbnailIconsSize?this.props.thumbnailIconsSize:E.IconSize.size60,t=[x.videoInfoContainer,x.overlayTextCenter,i.Styles.createTextStyle({paddingLeft:Math.floor(e/15)},!1)],s=[x.actionButtonBorderStyle,i.Styles.createViewStyle({width:e,height:e,borderRadius:e/2})];return i.createElement(i.View,{style:t},i.createElement(i.View,{style:s},i.createElement(f.default,{icon:E.SkypeIcon.Play,size:e/2,color:k.Color.white})))}}_getUnreadBadgeView(){}_intOnCommandSelected(e,t){this._commandManager.dismissSXPopup("media-thumbnail-sx-popup",t),this._commandManager.onActionMenuOptionSelected(this._getCommandManagerOptions(),e)}_getBorderRadiusStyle(e){if(e&&e>0)return i.Styles.createViewStyle({borderRadius:e},!1)}_getBackgroundColorStyle(){let e;return e=T.default.isMyMri(this.props.message.creator)?b.default.getPrimaryColor():c.default.getPrimaryColor(this.props.message.creator),i.Styles.createViewStyle({backgroundColor:e},!1)}_getThumbnailNetworkUrl(e){return F.default.getAuthenticatedUrl(this._getThumbnailUrlForMediaMessage(e))}_getFullMediaNetworkUrl(e){return F.default.getAuthenticatedUrl(this._getFullUrlForMediaMessage(e))}_canUseFullMediaUrl(e){return a.getMessageTypeGroup(e)===a.MessageTypeGroups.Picture}_getThumbnailUrlForMediaMessage(e){const t=this._getMediaNode(e);return t&&t.getDisplayThumbnailUrlSanitized()}_getFullUrlForMediaMessage(e){const t=this._getMediaNode(e);return t&&t.getDisplayUrlSanitized()}_getMediaNode(e){return h.decode(e).getFirstUriObjectChild(C.DisplayableMediaWithThumbnail)}showNode(){this.isComponentMounted()&&this._opacityValue.setValue(1)}hideNode(){this.isComponentMounted()&&this._opacityValue.setValue(0)}getOriginalDimensions(){if(this.props.height&&this.props.width)return{height:this.props.height,width:this.props.width}}}t.default=O},15188:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(88837),r=(s(89391),s(10117)),a=s(15877),l=s(89808),d=s(13034),c=s(11397),h=s(81760),u=s(11828),p=s(26612),g=(0,a.lazyProperties)({container:()=>o.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,justifyContent:"center",alignItems:"center",overflow:"visible"}),progessIndicator:()=>o.Styles.createImageStyle({backgroundColor:h.Color.transparent,overflow:"visible"})});class m extends n.ComponentBase{constructor(){super(...arguments),this._transferProgresses={}}_buildState(e,t){(t||i.isEmpty(this._transferProgresses))&&i.each(e.contentUrls,(e=>this._transferProgresses[e]={progress:0,success:!1,finished:!1})),i.each(e.contentUrls,(e=>{const t=e?p.default.getTransferProgressForUrl(e):void 0;let s=this._transferProgresses[e];t&&s&&(t.progress>s.progress&&(s.progress=t.progress),t.success&&!s.success&&(s.success=!0),t.finished&&!s.finished&&(s.finished=!0))}));return{progress:i.sumBy(i.values(this._transferProgresses),(e=>e.progress))/e.contentUrls.length,finished:i.every(this._transferProgresses,(e=>e.finished)),strokeColor:l.default.getPrimaryColor()||h.Color.blue,jsonAnimationEnabled:!1}}render(){if(!this.props.showFiniteProgressIndicatorUI&&(this.state.finished||this.state.progress<=0))return null;if(this.state.jsonAnimationEnabled&&!this.props.showFiniteProgressIndicatorUI){const e=o.Styles.createViewStyle({width:this.props.size,height:this.props.size},!1);return o.createElement(o.View,{style:g.container},o.createElement(o.View,{style:e},o.createElement(d.default,{progress:this.state.progress,sizeToFit:!0,tintColor:this.props.strokeColor})))}const e=o.Styles.createImageStyle({width:this.props.size,height:this.props.size},!1);let t,s,i={strokeColor:this.props.strokeColor||h.Color.whiteOverlay90,fillColor:h.Color.transparent,fillOpacity:0,strokeOpacity:1,strokeWidth:4};return this.props.showFiniteProgressIndicatorUI&&(i={strokeWidth:2,strokeColor:this.state.strokeColor,fillColor:h.Color.transparent,fillOpacity:0},t={strokeWidth:2,strokeColor:h.Color.white,fillColor:this.props.showShadow?h.Color.gray400:h.Color.transparent,fillOpacity:this.props.showShadow?.2:0},this.props.isDownload&&this.props.isDownloadPaused&&(s=o.createElement(o.View,{style:g.container},o.createElement(r.default,{icon:u.SkypeIcon.Download,size:this.props.size/2.5,color:this.props.strokeColor})))),o.createElement(o.View,{style:g.container},o.createElement(c.default,{style:[g.progessIndicator,e],progress:this.state.progress,size:this.props.size,backgroundCircleProperties:t,progressStrokeProperties:i,showCircleBackground:this.props.showFiniteProgressIndicatorUI}),s)}}t.default=m},78194:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(52115),r=s(15877),a=s(33754),l=s(81760),d=s(11010),c=s(19675),h=s(24576),u=s(26612),p=(0,r.lazyProperties)({uploadText:()=>o.Styles.createTextStyle({lineHeight:16}),downloadText:()=>o.Styles.createTextStyle({fontSize:d.default.controlFontSize.tabHeaderSmall,lineHeight:15,color:l.Color.white}),downloadContainer:()=>o.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"flex-end"}),textShadow:()=>o.Styles.createTextStyle({overflow:"visible",shadowColor:l.Color.blackOverlay50,shadowRadius:2,shadowOffset:{height:1,width:0}})});class g extends h.default{_buildState(e,t){const s=e.contentUrl?u.default.getTransferProgressForUrl(e.contentUrl):void 0;let o;const r=s&&s.totalSize||e.fileSizeInBytes,l=this.state;let d;r&&(t||l.totalSize&&l.totalSize.value!==r)&&(o=n.default.formatFileSize(r,0)),d=e.isDownload?e.isDownloadPaused?a.getString("MediaViewer.DownloadPaused"):a.getString("MediaViewer.Downloading"):a.getString("StreamItem.Sending");return{progress:s?i.ceil(100*s.progress):0,totalSize:o,progressLabel:d}}render(){const e=this.props.showShadow?p.textShadow:void 0;let t="";if(this.state.totalSize&&(t=this.state.totalSize.formattedString),t+=(t?" (":"(")+this.state.progress+"%)",this.props.isDownload){let s=t?o.createElement(o.Text,{style:[e,p.downloadText]},t):void 0;return o.createElement(o.View,{style:p.downloadContainer},o.createElement(o.Text,{style:[e,p.downloadText]},this.state.progressLabel),s)}return o.createElement(c.Caption,{style:[e,p.uploadText,this._themeStyles.secondaryTextColorStyle]},t?this.state.progressLabel+" "+t:this.state.progressLabel)}}t.default=g},69015:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VirtualMessageView=void 0;const i=s(96486),o=(s(2250),s(34828)),n=s(98356),r=s(16778),a=s(77388),l=s(46096),d=s(36237),c=s(61253),h=s(10400),u=s(47126),p=s(15877),g=s(33348),m=s(36150),S=s(67241),f=s(80490),y=s(50795),_=s(80837),v=f.SwiftSuggestionStyles.suggestionsBarHeight,C=!1,b=(0,p.lazyProperties)({scrollOuterContainer:()=>r.Styles.createViewStyle({flex:1,alignSelf:"stretch",overflow:"visible"}),scrollInnerContainer:()=>r.Styles.createViewStyle({position:"absolute",left:0,right:0,bottom:0}),scrollInnerContainerAbsoluteFill:()=>_.default.absoluteFill,scrollView:()=>r.Styles.createScrollViewStyle({flex:1,alignSelf:"stretch",flexDirection:"column"}),staticContainer:()=>r.Styles.createViewStyle({flex:-1,opacity:1,flexDirection:"column"}),compositeItemsListContainer:()=>r.Styles.createViewStyle({flex:1,flexDirection:"row"})}),T={},M={};var I,w;!function(e){e[e.UnmeasuredAbove=0]="UnmeasuredAbove",e[e.UnmeasuredBelow=1]="UnmeasuredBelow",e[e.UnmeasuredInside=2]="UnmeasuredInside",e[e.UnmeasuredInsideNoAnimation=3]="UnmeasuredInsideNoAnimation",e[e.Measured=4]="Measured"}(I||(I={})),function(e){e[e.Undefined=0]="Undefined",e[e.WaitingForScroll=1]="WaitingForScroll"}(w||(w={}));class P{constructor(){this._average=0,this._count=0}input(e){const t=1/(this._count+1),s=t*this._count;this._average=e*t+this._average*s,this._count++}correct(e){this._average+=e/this._count}getAverage(){return Math.round(this._average)}}class k extends r.Component{constructor(e){super(e),this._lastScrollTop=0,this._lastScrollTopSetByUser=0,this._lastScrollLeft=0,this._viewportHeight=0,this._oldViewportHeight=0,this._viewportWidth=0,this._lastContainerLayoutTime=0,this._virtualListCells={},this._virtualListCellRefCallbacks={},this._scrollOuterContainerHeight=0,this._contentWidth=-1,this._isMounted=!1,this._containerHeight=0,this._containerHeightValue=new r.Animated.Value(this._containerHeight),this._containerAnimatedStyle=r.Styles.createAnimatedViewStyle({height:this._containerHeightValue}),this._isInitialInnerScrollContainerHeightMeasured=!1,this._innerScrollContainerHeight=0,this._innerScrollContainerHeightValue=new r.Animated.Value(this._innerScrollContainerHeight),this._scrollInnerContainerStyle=r.Styles.createAnimatedViewStyle({height:this._innerScrollContainerHeightValue}),this._itemList=[],this._itemMap={},this._isRenderDirty=!1,this._itemListChangedSinceLastVisibleRangeChange=!1,this._heightAboveRenderBlockEstimate=0,this._heightAboveRenderBlockCorrection=0,this._heightOfRenderBlock=0,this._heightBelowRenderBlockEstimate=0,this._heightBelowRenderBlockCorrection=0,this._itemsAboveRenderBlock=0,this._itemsInRenderBlock=0,this._itemsBelowRenderBlock=0,this._pendingMeasures={},this._pendingMounts={},this._pendingAnimations={},this._filledViewableScreen=!1,this._heightCache={},this._renderInfoCache={},this._lastPartialTopVisibleItem=-1,this._lastPartialBottomVisibleItem=-1,this._lastWholeTopVisibleItem=-1,this._lastWholeBottomVisibleItem=-1,this._onListChangedQueue=[],this._onLayoutItemQueue=[],this._onAnimateStartStopItemQueue=[],this._currentAverageHeight=0,this._averageHeightCounter=new P,this._isScreenReaderEnabled=!1,this._onLayoutOuterScrollContainer=e=>{if(d.log(l.LogTraceArea.VirtualMessageView,"onLayoutOuterScrollContainer: width "+e.width+" height "+e.height),!this._isMounted)return;const t=0!==h.default.getUpdateInfo().height;if(!this.props.allowKeyboardLayoutUpdates&&t&&this._isInitialInnerScrollContainerHeightMeasured)return void d.log(l.LogTraceArea.VirtualMessageViewDebug,"onLayoutOuterScrollContainer: ignoring event because keyboard is shown, height: "+Math.round(e.height));const s=Math.round(e.height);0!==s?(t||(this._isInitialInnerScrollContainerHeightMeasured=!0),this._scrollOuterContainerHeight=s,0===this._innerScrollContainerHeight?(this._shouldStartFromTop()?(this._innerScrollContainerHeightValue.setValue(this._heightOfRenderBlock),this._containerHeightValue.setValue(this._heightOfRenderBlock)):(this._innerScrollContainerHeight=s,this._innerScrollContainerHeightValue.setValue(s)),this._currentState.onLayoutListContainer(e,!0)):this._currentState.onLayoutListContainer(e,!1)):d.log(l.LogTraceArea.VirtualMessageViewDebug,"onLayoutOuterScrollContainer: height is 0 - probably transient event during rotation")},this._onScroll=(e,t)=>{this._onScrollHandler(e,t)},this._onScrollHandlerDebounced=i.debounce(this._onScrollHandler,100),this._onReportUserScrollEvent=()=>{this._reportUserScrollEvent&&(this._reportUserScrollEvent=!1,this.props.onUserScroll&&this.props.onUserScroll(this._lastScrollTop,this._lastScrollLeft))},this._onAnimateStartStopItem=(e,t)=>{this._isMounted&&(t?this._pendingAnimations[e]=e:delete this._pendingAnimations[e])},this._onKeyPress=e=>{if(e.keyCode!==u.default.UP&&e.keyCode!==u.default.DOWN||!this._renderedItemKeys||!this._focusedItemKey)return;if(e.altKey||e.ctrlKey||e.shiftKey)return;const t=this._renderedItemKeys.filter((e=>e!==S.ItemListKey.Composing));let s,i,o,n,r=t.indexOf(this._focusedItemKey);r>=0&&(s=this._virtualListCells[this._focusedItemKey]),r>=0&&(n=r+(e.keyCode===u.default.UP?-1:1),i=t[n]),i||(n=this._renderedItemKeys.length-1,i=t[n]),i&&(o=this._virtualListCells[i]),o&&s!==o&&(s&&s.setFocusLimited(!0),o.setFocusLimited(!1),this._focusedItemKey=i,o.focusCell(),e.preventDefault(),e.stopPropagation(),o.props.focusable||this._onKeyPress(e))},this._onCellFocus=e=>{this._isFocused=!!e},this._stateOnLayoutListContainer=e=>{this._currentState&&this._currentState.onLayoutListContainer(e,!0)},this._stateOnScroll=(e,t)=>{this._currentState&&this._currentState.onScroll(e,t)},this._onScrollBeginDrag=()=>{d.log(l.LogTraceArea.VirtualMessageViewDebug,"onScrollBeginDrag"),this._isDragging=!0},this._onScrollEndDrag=()=>{d.log(l.LogTraceArea.VirtualMessageViewDebug,"onScrollEndDrag"),this._isDragging=!1,this._currentState&&this._currentState.onScrollEndDrag()},this._stateOnLayoutItem=(e,t)=>{var s;null===(s=this._currentState)||void 0===s||s.onLayoutItem(e,t)},this._stateOnAnimateStartStopItem=(e,t)=>{this._currentState&&this._currentState.onAnimateStartStopItem(e,t)},this._stateControllerScrollPositionSet=()=>{this._currentState&&this._currentState.onControllerScrollPositionSet()},this._stateOnListChanged=(e,t)=>{this._currentState&&(this._itemListChangedSinceLastVisibleRangeChange=!0,this._currentState.onListChanged(e,t))},this._vmvControllerRefCallback=e=>{this._vmvController=e},this._scrollViewRefCallback=e=>{this._scrollView=e},e.observableList.listChanged.subscribe(this._stateOnListChanged),this._screenReaderDetectionStoreToken=m.default.subscribe((()=>{this._isScreenReaderEnabled=m.default.isMobileScreenReaderEnabled(),this._isScreenReaderEnabled})),this._isScreenReaderEnabled=m.default.isMobileScreenReaderEnabled(),this.setCurrentState(new k.Initialization(this),e)}setCurrentState(e,t){this._currentState=e,this._currentState.init(t||this.props)}UNSAFE_componentWillReceiveProps(e,t){(0,c.default)(this.props,e)||(this.props.contentMaxWidth,e.contentMaxWidth,this.props.observableList,e.observableList,this.props.leftSpacerWidth===e.leftSpacerWidth&&this.props.rightSpacerWidth===e.rightSpacerWidth&&this.props.useWideLayout===e.useWideLayout||this._resizeAllItems(e))}_getBottomSpacerHeight(){return this.props.canShowSuggestions?v:0}_initItemList(e,t){this._renderInfoCache={},this._pendingMeasures={},this._pendingMounts={},this._pendingAnimations={},this._itemListChangedSinceLastVisibleRangeChange=!0,d.log(l.LogTraceArea.VirtualMessageView,"_initItemList: New count: "+e.length);const s={};i.each(e,((e,t)=>{s[e.key]=t})),this._filledViewableScreen=!1;const o=this._calcHeightOfItems(e,0,e.length-1);this._itemsAboveRenderBlock=e.length,this._itemsInRenderBlock=0,this._itemsBelowRenderBlock=0,this._heightAboveRenderBlockCorrection=o,this._heightAboveRenderBlockEstimate=0,this._heightOfRenderBlock=0,this._heightBelowRenderBlockCorrection=0,this._heightBelowRenderBlockEstimate=0,this._itemMap=s,this._itemList=e,this._initialScrollIndex=t.initialScrollIndex}_isAndroidScreenReaderEnabled(){return this._isScreenReaderEnabled&&C}_itemsMoved(e,t){this._itemMap=this._regenerateItemMap(e);const s={type:a.ListModificationType.RemoveItems,removeIndex:t.removeIndex,count:t.count};this._processItemsRemoved(this._itemList,s);const o=i.map(this._itemList,(e=>e));o.splice(t.removeIndex,t.count),this._itemList=o;const n=[];for(let s=t.insertIndex;s<t.insertIndex+t.count;s++)n.push(e[s]);const r={type:a.ListModificationType.AddItems,insertIndex:t.insertIndex,items:n};this._processItemsAdded(this._itemList,e,r),this._itemList=e}_regenerateItemMap(e){const t={};return i.each(e,((e,s)=>{t[e.key]=s})),t}_itemsAdded(e,t){this._itemMap=this._regenerateItemMap(e),this._processItemsAdded(this._itemList,e,t),this._itemList=e}_processItemsAdded(e,t,s){const o=s.insertIndex,n=s.items,r=this._itemsAboveRenderBlock+this._itemsInRenderBlock,a=this._getMaxPendingMounts()-i.size(this._pendingMounts),c=s.options&&!1===s.options.animateFromBottom;if(o<=this._itemsAboveRenderBlock&&0!==this._itemsInRenderBlock)this._heightAboveRenderBlockCorrection+=this._calcHeightOfItems(t,o,o+n.length-1),this._itemsAboveRenderBlock+=n.length,d.log(l.LogTraceArea.VirtualMessageViewDebug,"_processItemsAdded adding "+n.length+" above render block");else if((o>r||o===r&&n.length>a&&c)&&0!==this._itemsInRenderBlock)this._itemsBelowRenderBlock+=n.length,this._heightBelowRenderBlockCorrection+=this._calcHeightOfItems(t,o,o+n.length-1),d.log(l.LogTraceArea.VirtualMessageViewDebug,"_processItemsAdded adding "+n.length+" below render block");else{const t=this._calcHeightOfItems(e,o,e.length-1),s=this._containerHeight-this._getBottomSpacerHeight()-t;i.each(n,(e=>{let t=this._getHeightOfItem(e);const i=c?I.UnmeasuredInsideNoAnimation:I.UnmeasuredInside;this._allocateRenderBlockItem(e,i,t,s)}))}}_itemsReplaced(e,t){this._itemMap=this._regenerateItemMap(e),this._processItemsRemoved(this._itemList,t);const s=i.map(this._itemList,(e=>e));s.splice(t.removeIndex,t.count),this._itemList=s,this._processItemsAdded(this._itemList,e,t),this._itemList=e}_itemsRemoved(e,t){this._itemMap=this._regenerateItemMap(e),this._processItemsRemoved(this._itemList,t),this._itemList=e}_processItemsRemoved(e,t){const s=t.removeIndex,i=t.removeIndex+t.count-1,o=this._itemsAboveRenderBlock,n=this._itemsInRenderBlock;d.log(l.LogTraceArea.VirtualMessageViewDebug,"_processItemsRemoved _itemsAboveRenderBlock "+this._itemsAboveRenderBlock+" _itemsInRenderBlock "+this._itemsInRenderBlock+" _itemsBelowRenderBlock "+this._itemsBelowRenderBlock);for(let t=s;t<o&&t<=i;t++){const s=e[t];d.log(l.LogTraceArea.VirtualMessageViewDebug,"_processItemsRemoved removing item #"+t+" with key "+s.key+" above render block"),this._heightAboveRenderBlockCorrection-=this._getHeightOfItem(s),this._itemsAboveRenderBlock--,this._deleteItemFromCaches(s.key,!0)}const r=o+n-1,a=this._getViewportBottom();for(let t=Math.max(s,o);t<=r&&t<=i;t++){const s=e[t];d.log(l.LogTraceArea.VirtualMessageViewDebug,"_processItemsRemoved removing item #"+t+" with key "+s.key+" from render block"),this._itemsInRenderBlock--;const i=this._getHeightOfItem(s);this._heightOfRenderBlock-=i;const o=this._renderInfoCache[s.key];this._isRenderDirty=!0,this._makeCellInvisibleDeferred(s.key),this._deleteItemFromCaches(s.key,!0),o&&(o.top+i<=a+30?this._adjustScrollPositionAfterReconcile(-i):this._adjustScrollPositionUntilReconcile(-i))}for(let t=Math.max(s,r+1);t<=i;t++){const s=e[t];d.log(l.LogTraceArea.VirtualMessageViewDebug,"_processItemsRemoved removing item #"+t+" with key "+s.key+" below render block"),this._heightBelowRenderBlockCorrection-=this._getHeightOfItem(s),this._itemsBelowRenderBlock--,this._deleteItemFromCaches(s.key,!0)}}_deleteItemFromCaches(e,t=!1){t&&delete this._heightCache[e],delete this._renderInfoCache[e],delete this._pendingMeasures[e],delete this._pendingMounts[e]}_updateViewportWidth(e){e!==this._viewportWidth&&(d.log(l.LogTraceArea.VirtualMessageView,"New viewport width: "+e),this._viewportWidth=e,this._resizeAllItems(this.props))}_updateViewportHeight(e){e!==this._viewportHeight&&(d.log(l.LogTraceArea.VirtualMessageView,"New viewport height: "+e),this._viewportHeight=e)}_onLayoutListContainer(e){let t=Math.round(e.width);const s=Math.round(e.height);this._isMounted&&0!==t&&0!==s&&(this.props.horizontalPadding&&(t-=this.props.horizontalPadding.left+this.props.horizontalPadding.right),this._lastContainerLayoutTime=Date.now().valueOf(),this._updateViewportWidth(t),this._updateViewportHeight(s),this._renderIfDirty(),this.props.onLayout&&this.props.onLayout(e))}_onLayoutItem(e,t){if(!this._isMounted)return!1;const s=this._itemMap[e];if(void 0===s||void 0===this._renderInfoCache[e])return d.log(l.LogTraceArea.VirtualMessageViewDebug,"onLayout: unexpected event for item "+e),!1;delete this._pendingMeasures[e],delete this._pendingMounts[e],t=Math.round(t);let i=this._itemList[s];const o=this._getHeightOfItem(i),n=t-o;if(this._isHeightOfItemKnown(i)&&Math.abs(n)<=1)return!1;i.height||(this._isHeightOfItemKnown(i)?this._averageHeightCounter.correct(n):this._averageHeightCounter.input(t)),this._heightCache[e]=t;const r=this._renderInfoCache[e];return 0===n&&r.measureState===I.Measured||(d.log(l.LogTraceArea.VirtualMessageViewDebug,"onLayout: Item Height Changed: "+e+" - Old: "+o+", New: "+t+", measureState: "+I[r.measureState]),s<this._itemsAboveRenderBlock?this._heightAboveRenderBlockCorrection+=n:s>=this._itemsAboveRenderBlock+this._itemsInRenderBlock?this._heightBelowRenderBlockCorrection-=n:(this._heightOfRenderBlock+=n,r.measureState===I.UnmeasuredAbove?this._adjustScrollPositionAfterReconcile(n):r.measureState===I.UnmeasuredBelow?this._adjustScrollPositionUntilReconcile(n):r.measureState===I.UnmeasuredInside?r.top<=this._getViewportBottom()+30?this._adjustScrollPositionAfterReconcile(t):this._adjustScrollPositionUntilReconcile(t):r.measureState===I.UnmeasuredInsideNoAnimation?this._adjustScrollPositionUntilReconcile(t):r.measureState===I.Measured&&(r.top+o<=this._getViewportBottom()?this._adjustScrollPositionAfterReconcile(n):this._adjustScrollPositionUntilReconcile(n))),r.measureState=I.Measured),0!==n}_adjustScrollPositionAfterReconcile(e){d.log(l.LogTraceArea.VirtualMessageViewDebug,"_adjustScrollPositionAfterReconcile "+e),this._heightAboveRenderBlockCorrection+=e,this._heightAboveRenderBlockEstimate-=e}_adjustScrollPositionUntilReconcile(e){d.log(l.LogTraceArea.VirtualMessageViewDebug,"_adjustScrollPositionUntilReconcile "+e),this._heightBelowRenderBlockCorrection+=e,this._heightBelowRenderBlockEstimate-=e}_onScrollHandler(e,t){e=Math.round(e),t=Math.round(t),this._lastScrollTop!==e&&(this._lastScrollTopSetByUser===e&&this._lastScrollTop!==e||(this._reportUserScrollEvent=!0,this._lastScrollTopSetByUser=e,this._lastScrollTop=e,this._lastScrollLeft=t,this._onReportUserScrollEvent()))}_allocateRenderBlockItem(e,t,s,i){this._pendingMounts[e.key]=e.key,this._isHeightOfItemKnown(e)?t=I.Measured:this._pendingMeasures[e.key]=e.key;const o=this._shouldShowItem(e);this._renderInfoCache[e.key]={top:i,measureState:t,isVisible:o,shouldUpdate:!0},this._isRenderDirty=!0,this._itemsInRenderBlock++,this._heightOfRenderBlock+=s,d.log(l.LogTraceArea.VirtualMessageViewDebug,"Allocating new render block item for "+e.key+" H="+s+" Y="+i," V="+o),this._forceUpdateCell(e.key)}_forceUpdateCell(e){this._virtualListCells[e]&&i.defer((()=>{const t=this._virtualListCells[e];t&&this._isMounted&&t.forceUpdate()}))}_getEffectiveScrollTop(){return 0===this._containerHeight?-this._viewportHeight:this._lastScrollTop}_removeItemsFromRenderBlock(){const e=this._getEffectiveScrollTop(),t=Math.max(6*this._viewportHeight,3072),s=e-t,i=e+this._viewportHeight+t;let o=this._containerHeight-this._getBottomSpacerHeight()-this._heightBelowRenderBlockEstimate,n=o-this._heightOfRenderBlock;for(;this._itemsInRenderBlock>0;){const e=this._itemsAboveRenderBlock,t=this._itemList[e];if(!this._isHeightOfItemKnown(t))break;const i=this._getHeightOfItem(t);if(n+i>=s)break;this._isRenderDirty=!0,this._itemsInRenderBlock--,this._heightOfRenderBlock-=i,this._itemsAboveRenderBlock++,this._heightAboveRenderBlockEstimate+=i,n+=i,this._deleteItemFromCaches(t.key),d.log(l.LogTraceArea.VirtualMessageViewDebug,"Culled Item From Top: "+t.key)}for(;this._itemsInRenderBlock>0;){const e=this._itemsAboveRenderBlock+this._itemsInRenderBlock-1,t=this._itemList[e];if(!this._isHeightOfItemKnown(t))break;const s=this._getHeightOfItem(t);if(o-s<=i)break;this._isRenderDirty=!0,this._itemsInRenderBlock--,this._heightOfRenderBlock-=s,this._itemsBelowRenderBlock++,this._heightBelowRenderBlockEstimate+=s,o-=s,this._deleteItemFromCaches(t.key),d.log(l.LogTraceArea.VirtualMessageViewDebug,"Culled Item From Bottom: "+t.key)}}_addInitialItemToRenderBlock(){let e=!1,t=0,s=this._itemList.length-1;if(void 0!==this._initialScrollIndex)s=this._initialScrollIndex,e=!this._filledViewableScreen,t=this._getEffectiveScrollTop()+Math.floor(.25*this._viewportHeight);else if(this._filledViewableScreen){let i=this._containerHeight-this._getBottomSpacerHeight(),o=this._getEffectiveScrollTop()+this._viewportHeight;for(;i>=o&&s>0;){const e=this._itemList[s];i-=this._getHeightOfItem(e),s--}e=!0,t=this._getEffectiveScrollTop()+this._viewportHeight-this._getHeightOfItem(this._itemList[s])}d.log(l.LogTraceArea.VirtualMessageView,"_addInitialItemToRenderBlock referenceIndex: "+s+" out of "+this._itemList.length);let i=this._itemList[s];this.props.shouldFocusInitialItem&&(this._itemKeyToFocus=i.key),this.props.isMessageSearchPanelVisible&&void 0!==this._initialScrollIndex&&this._itemKeyToFocusNext(i.key);const o=this._getHeightOfItem(i);this._heightAboveRenderBlockEstimate-=o,this._itemsInRenderBlock=0,this._heightOfRenderBlock=0,this._itemsAboveRenderBlock=s;const n=this._calcHeightOfItems(this._itemList,0,s-1);this._heightAboveRenderBlockCorrection=n-this._heightAboveRenderBlockEstimate,this._itemsBelowRenderBlock=this._itemList.length-this._itemsAboveRenderBlock-1;const r=this._calcHeightOfItems(this._itemList,s+1,this._itemList.length-1);if(this._heightBelowRenderBlockCorrection=r-this._heightBelowRenderBlockEstimate,e){const e=t-this._heightAboveRenderBlockEstimate;this._adjustScrollPositionAfterReconcile(-e),this._adjustScrollPositionUntilReconcile(e)}const a=e?I.UnmeasuredBelow:I.UnmeasuredAbove;this._allocateRenderBlockItem(i,a,o,this._heightAboveRenderBlockEstimate-this._getBottomSpacerHeight()),d.log(l.LogTraceArea.VirtualMessageView,"New item count above: "+this._itemsAboveRenderBlock)}_getMaxPendingMounts(){return g.default.isAnimationPending()?1:10}_expandRenderBlock(e,t){const s=this._getEffectiveScrollTop(),o=s-e,n=s+this._viewportHeight+t,r=this._getMaxPendingMounts();let a=this._containerHeight-this._getBottomSpacerHeight()-this._heightBelowRenderBlockEstimate,l=a-this._heightOfRenderBlock;for(;this._itemsBelowRenderBlock>0&&a<n;){if(i.size(this._pendingMounts)>=r)return;const e=this._itemList[this._itemsAboveRenderBlock+this._itemsInRenderBlock],t=this._getHeightOfItem(e);this._allocateRenderBlockItem(e,I.UnmeasuredBelow,t,a),a+=t,this._itemsBelowRenderBlock--,this._heightBelowRenderBlockEstimate-=t}for(;this._itemsAboveRenderBlock>0&&l>o;){if(i.size(this._pendingMounts)>=r)return;const e=this._itemList[this._itemsAboveRenderBlock-1],t=this._getHeightOfItem(e);this._allocateRenderBlockItem(e,I.UnmeasuredAbove,t,l-t),l-=t,this._itemsAboveRenderBlock--,this._heightAboveRenderBlockEstimate-=t}}_calcNewRenderedItemState(e=!0,t=!0){if(0===this._itemList.length)return;this._removeItemsFromRenderBlock();const s=0===this._itemsInRenderBlock;s&&this._itemList.length>0&&this._addInitialItemToRenderBlock();const i=e&&this._filledViewableScreen&&Date.now().valueOf()-this._lastContainerLayoutTime>500;this._repositionCells({animate:i});const o=t&&!s&&this._filledViewableScreen?Math.min(Math.max(5*this._viewportHeight,2048),4096):0;this._expandRenderBlock(o,o)}_getViewportBottom(){return this._lastScrollTop+this._viewportHeight-this._getBottomSpacerHeight()}_checkAndReportVisibleRangeChanges(){if(this.props.onVisibleRangeChanged&&this._isMounted&&this._filledViewableScreen){const e=this._lastScrollTop,t=this._getViewportBottom();let s=-1,i=-1,o=-1,n=-1;const r=this._containerHeight-this._getBottomSpacerHeight()-this._heightBelowRenderBlockEstimate,a=r-this._heightOfRenderBlock;if(a<t||r>e){let l=a;for(let t=0;t<this._itemsInRenderBlock;t++){const i=this._getHeightOfItem(this._itemList[t+this._itemsAboveRenderBlock]);if(l>=e&&-1===o&&(o=t+this._itemsAboveRenderBlock),l+=i,l>e&&-1===s&&(s=t+this._itemsAboveRenderBlock),-1!==s&&-1!==o)break}l=r;for(let e=this._itemsInRenderBlock-1;e>=0;e--){const s=this._getHeightOfItem(this._itemList[e+this._itemsAboveRenderBlock]);if(l<=t&&-1===n&&(n=e+this._itemsAboveRenderBlock),l-=s,l<t&&-1===i&&(i=e+this._itemsAboveRenderBlock),-1!==i&&-1!==n)break}}(this._itemListChangedSinceLastVisibleRangeChange||this._lastPartialTopVisibleItem!==s||this._lastPartialBottomVisibleItem!==i||this._lastWholeTopVisibleItem!==o||this._lastWholeBottomVisibleItem!==n)&&(this._itemListChangedSinceLastVisibleRangeChange=!1,this._lastPartialTopVisibleItem=s,this._lastPartialBottomVisibleItem=i,this._lastWholeTopVisibleItem=o,this._lastWholeBottomVisibleItem=n,d.log(l.LogTraceArea.VirtualMessageViewDebug,"Visible Range Changed: Partial: "+this._lastPartialTopVisibleItem+"-"+this._lastPartialBottomVisibleItem+", Whole: "+this._lastWholeTopVisibleItem+"-"+this._lastWholeBottomVisibleItem),this.props.onVisibleRangeChanged(this._lastPartialTopVisibleItem,this._lastPartialBottomVisibleItem,this._lastWholeTopVisibleItem,this._lastWholeBottomVisibleItem))}}_setContainerHeight(e){return this._containerHeight!==e&&(d.log(l.LogTraceArea.VirtualMessageView,"setContainerHeight Old: "+this._containerHeight+" New: "+e),this._containerHeight=e,this._shouldStartFromTop()?(this._containerHeightValue.setValue(this._heightOfRenderBlock),this._innerScrollContainerHeightValue.setValue(this._heightOfRenderBlock)):this._containerHeightValue.setValue(e),!0)}_getNewContainerHeight(){const e=this._heightAboveRenderBlockEstimate+this._heightAboveRenderBlockCorrection+this._heightOfRenderBlock+this._heightBelowRenderBlockEstimate+this._heightBelowRenderBlockCorrection+this._getBottomSpacerHeight();return Math.max(e,this._viewportHeight)}_reconcileCorrections(e){if(0===this._itemList.length)return!1;let t=!1;this._oldViewportHeight=this._viewportHeight;Math.abs(this._scrollOuterContainerHeight-this._innerScrollContainerHeight)>1&&(d.log(l.LogTraceArea.VirtualMessageView,"Forcing recalculations because viewport size changed, old _viewportHeight: "+this._viewportHeight+" new _viewportHeight: "+this._scrollOuterContainerHeight),this._innerScrollContainerHeight=this._scrollOuterContainerHeight,this._viewportHeight=this._scrollOuterContainerHeight,this._innerScrollContainerHeightValue.setValue(this._scrollOuterContainerHeight),t=!0);let s=this._getNewContainerHeight();if(0===this._heightAboveRenderBlockCorrection&&0===this._heightBelowRenderBlockCorrection&&this._containerHeight===s||(t=!0,d.log(l.LogTraceArea.VirtualMessageView,"Forcing recalculations because container size changed, _heightAboveRenderBlockCorrection: "+this._heightAboveRenderBlockCorrection+" _heightBelowRenderBlockCorrection: "+this._heightBelowRenderBlockCorrection+" _containerHeight: "+this._containerHeight+" newContainerHeight: "+s)),t){this._applyNewAverageToEstimates(),s=this._getNewContainerHeight();const t=this._setContainerHeight(s);return this._completeReconcileCorrections(e,t)}return!1}_applyNewAverageToEstimates(){const e=this._averageHeightCounter.getAverage();if(this._currentAverageHeight===e)return;const t=e-this._currentAverageHeight,s=t*this._calcUnknownHeightItemsCount(this._itemList,0,this._itemsAboveRenderBlock-1);this._heightAboveRenderBlockCorrection+=s;const i=t*this._calcUnknownHeightItemsCount(this._itemList,this._itemsAboveRenderBlock+this._itemsInRenderBlock,this._itemList.length-1);this._heightBelowRenderBlockCorrection+=i,d.log(l.LogTraceArea.VirtualMessageViewDebug," applyNewAverageToEstimates currentAverageHeight: "+this._currentAverageHeight+", newAverageHeight "+e+", aboveHeightAdjustment "+s+", belowHeightAdjustment "+i),this._currentAverageHeight=e}_completeReconcileCorrections(e,t){const s=this._viewportHeight-this._oldViewportHeight;let o=this._heightAboveRenderBlockCorrection-s;if(d.log(l.LogTraceArea.VirtualMessageView,"_reconcileCorrections: initial="+e+" A="+this._heightAboveRenderBlockCorrection+" B="+this._heightBelowRenderBlockCorrection+" viewPortHeightDelta="+s),this._heightAboveRenderBlockEstimate+=this._heightAboveRenderBlockCorrection,this._heightAboveRenderBlockCorrection=0,this._heightBelowRenderBlockEstimate+=this._heightBelowRenderBlockCorrection,this._heightBelowRenderBlockCorrection=0,e&&!i.isUndefined(this._initialScrollIndex)&&this._initialScrollIndex>=0){if(this._initialScrollIndex>=this._itemsAboveRenderBlock&&this._initialScrollIndex<=this._itemsAboveRenderBlock+this._itemsInRenderBlock){let e=this._containerHeight-this._getBottomSpacerHeight()-this._heightBelowRenderBlockEstimate-this._heightOfRenderBlock;for(let t=this._itemsAboveRenderBlock;t<this._initialScrollIndex;t++)e+=this._getHeightOfItem(this._itemList[t]);o=e-Math.floor(.25*this._viewportHeight)}this._initialScrollIndex=void 0}return this._setNewScrollTop(this._lastScrollTop+o,!1),this._repositionCells({}),!1}_setNewScrollTop(e,t){e=Math.round(e),e=Math.min(e,this._containerHeight-this._viewportHeight),(e=Math.max(e,0))!==this._lastScrollTop&&(d.log(l.LogTraceArea.VirtualMessageViewDebug,"Setting scroll top: "+e),this._lastScrollTop=e,this._scrollView&&(delete this._pendingSetScrollTop,this._setScrollTop(e,t)))}_adjustScrollTopAndRepositionCells(e,t){if(e=Math.round(e),e=Math.min(e,this._containerHeight-this._viewportHeight-this._lastScrollTop),0!==(e=Math.max(e,-this._lastScrollTop))){if(this._lastScrollTop+=e,d.log(l.LogTraceArea.VirtualMessageViewDebug,"Adjusting scroll top: "+e+" (absolute value "+this._lastScrollTop+")"),this._vmvController){const t=this._repositionCells({sendToNative:!1});return this._vmvController.scrollBy(e,t,this._isAndroidScreenReaderEnabled()),!0}this._scrollView&&(t?this._pendingSetScrollTop=this._lastScrollTop:this._setScrollTop(this._lastScrollTop,!1),this._repositionCells({}))}return!1}_validateHeightInvariants(e=!0){d.log(l.LogTraceArea.VirtualMessageViewDebug," AE:"+this._heightAboveRenderBlockEstimate+" AC:"+this._heightAboveRenderBlockCorrection+" RB:"+this._heightOfRenderBlock+" BE:"+this._heightBelowRenderBlockEstimate+" BC:"+this._heightBelowRenderBlockCorrection);this._calcHeightOfItems(this._itemList,0,this._itemsAboveRenderBlock-1),this._calcHeightOfItems(this._itemList,this._itemsAboveRenderBlock+this._itemsInRenderBlock,this._itemList.length-1),this._calcHeightOfItems(this._itemList,this._itemsAboveRenderBlock,this._itemsAboveRenderBlock+this._itemsInRenderBlock-1),this._itemsAboveRenderBlock,this._itemsBelowRenderBlock,this._itemsInRenderBlock;if(this._containerHeight>0&&e){const e=this._heightAboveRenderBlockEstimate+this._heightOfRenderBlock+this._heightBelowRenderBlockEstimate+this._getBottomSpacerHeight();Math.max(e,this._viewportHeight)}return!0}_popInvisibleIntoView(){this._filledViewableScreen=!0;for(let e=0;e<this._itemsInRenderBlock;e++){const t=this._itemList[this._itemsAboveRenderBlock+e];let s=this._renderInfoCache[t.key];s.isVisible||(s.isVisible=!0)}this._repositionCells({dissallowVisibilityChanges:!1}),this.props.onInitialRenderComplete&&this.props.onInitialRenderComplete()}_repositionCells(e){const t=!!e.staggerAnimations,s=!!i.isUndefined(e.sendToNative)||e.sendToNative,o=[],n=[],r=this._containerHeight-this._getBottomSpacerHeight()-this._heightBelowRenderBlockEstimate;let a=r,c=0;for(let i=this._itemsInRenderBlock-1;i>=0;i--){const h=this._itemList[this._itemsAboveRenderBlock+i];a-=this._getHeightOfItem(h),t&&(c=Math.floor(.1*(r-a)));const u=this._renderInfoCache[h.key];if(!u){d.error(l.LogTraceArea.VirtualMessageViewDebug,"Missing renderInfo for "+h.key);continue}const p=this._virtualListCells[h.key];if(p&&o.push({component:p,yPosition:a}),s){const t=e.dissallowVisibilityChanges?u.isVisible:this._shouldShowItem(h);this._setCellTopAndVisibility(h.key,t,a,c,e)&&n.push({key:h.key,yPosition:a,visibility:t})}}return s&&i.size(n)>0&&d.log(l.LogTraceArea.VirtualMessageViewDebug,"_repositionCells: "+i.reduce(n,((e,t)=>e+"("+t.key+","+t.yPosition+","+(t.visibility?"Y":"N")+")"),"")),o}_setCellTopAndVisibility(e,t,s,i,o){const r=!!o.animate;let a=this._renderInfoCache[e];if(!a)return d.error(l.LogTraceArea.VirtualMessageViewDebug,"Missing renderInfo for "+e),!1;const c=r&&a.isVisible&&!this._isAndroidScreenReaderEnabled();a.isVisible=t,a.top=s;const h=this._virtualListCells[e];let u=!1;return h&&this._filledViewableScreen&&(h.getTop()!==s&&(h.setTop({top:s,animate:c,animationDelay:i,animationEasingFunction:n.Easing.SkypeEaseOut,animationDuration:y.AnimationDuration.Short}),u=!0),h.isVisible()!==t&&(h.setVisibility(t),u=!0)),u}_makeCellInvisibleDeferred(e){i.defer((()=>{const t=this._virtualListCells[e],s=this._renderInfoCache[e];t&&!s&&t.setVisibility(!1)}))}_resizeAllItems(e){if(this._viewportWidth<=0)return;const t=this._viewportWidth-(e.leftSpacerWidth||0)-(e.rightSpacerWidth||0),s=e.contentMaxWidth&&t>e.contentMaxWidth?e.contentMaxWidth:t;s>0&&this._contentWidth!==s&&(this._contentWidth=s,this._itemsInRenderBlock>0&&(this._isRenderDirty=!0))}_renderIfDirty(){this._isRenderDirty&&this._isMounted&&this.forceUpdate()}_focusCellIfNeeded(){if(this._itemKeyToFocus){const e=this._virtualListCells[this._itemKeyToFocus];e&&(e.focusCell(),this._itemKeyToFocus=void 0)}}_shouldStartFromTop(){return!!(this.props.startFromTop&&this.props.streamContainerHeight&&this.props.streamContainerHeight>this._heightOfRenderBlock)}render(){let e=[];d.log(l.LogTraceArea.VirtualMessageViewDebug,"Rendering "+this._itemsInRenderBlock+" items starting at "+this._itemsAboveRenderBlock),this._renderedItemKeys=[];for(let t=0;t<this._itemsInRenderBlock;t++){const s=this._itemList[this._itemsAboveRenderBlock+t],i=this._renderInfoCache[s.key],n=this._isAndroidScreenReaderEnabled()?"ac_"+s.key:s.key;this._renderedItemKeys.push(s.key),e.push(r.createElement(o.VirtualListCell,{ref:this._getVirtualListCellRefCallback(s.key),key:n,onLayout:this._stateOnLayoutItem,itemKey:s.key,item:s,width:this._contentWidth,top:i?i.top:0,isVisible:!!i&&i.isVisible,isActive:!0,isFocused:!1,onAnimateStartStop:this._stateOnAnimateStartStopItem,useTransformOptimization:!this._isAndroidScreenReaderEnabled(),shouldUpdate:!i||i.shouldUpdate,renderItem:this.props.renderItem,focusable:s.focusable,onCellFocus:this._onCellFocus,limitFocusWithin:r.Types.LimitFocusType.Accessible})),i&&(i.shouldUpdate=!1)}d.log(l.LogTraceArea.VirtualMessageViewDebug,"Item Render Complete");const t=[b.staticContainer,this.props.style,this._containerAnimatedStyle,this._getItemContainerStyle(this.props.contentMaxWidth)];this.props.showOverflow&&t.push(_.default.overflowVisible),this.props.horizontalPadding&&this.props.horizontalPadding.left&&t.push(r.Styles.createViewStyle({marginLeft:this.props.horizontalPadding.left},!1));let s=r.createElement(r.Animated.View,{style:i.compact(t),onLayout:e=>{if(Math.trunc(e.height)===Math.trunc(this._containerHeight)){const e=this._pendingSetScrollTop;delete this._pendingSetScrollTop,e&&this._scrollView&&this._setScrollTop(e,!1)}}},e);this.props.useWideLayout&&(s=r.createElement(r.View,{style:b.compositeItemsListContainer},r.createElement(r.View,{style:this._getSpacerStyle(this.props.leftSpacerWidth)}),s,r.createElement(r.View,{style:this._getSpacerStyle(this.props.rightSpacerWidth)})));const n=[b.scrollInnerContainer,this._scrollInnerContainerStyle];return this._shouldStartFromTop()&&n.push(b.scrollInnerContainerAbsoluteFill),r.createElement(r.View,{style:b.scrollOuterContainer,onLayout:this._onLayoutOuterScrollContainer},r.createElement(r.Animated.View,{style:n},r.createElement(r.ScrollView,{onLayout:this._stateOnLayoutListContainer,onScroll:this._stateOnScroll,keyboardDismissMode:this.props.keyboardDismissMode,keyboardShouldPersistTaps:this.props.keyboardShouldPersistTaps,ref:this._scrollViewRefCallback,scrollEventThrottle:32,style:b.scrollView,scrollsToTop:this.props.scrollsToTop,scrollEnabled:this.props.scrollEnabled,overScrollMode:"never",onScrollBeginDrag:this._onScrollBeginDrag,onScrollEndDrag:this._onScrollEndDrag,onKeyPress:this._onKeyPress},null,s)))}_setScrollTop(e,t){var s;null===(s=this._scrollView)||void 0===s||s.setScrollTop(e,t)}_getSpacerStyle(e){return T[e]||(T[e]=r.Styles.createViewStyle({flex:1,minWidth:e})),T[e]}_getItemContainerStyle(e){return M[e]||(M[e]=r.Styles.createViewStyle({width:e})),M[e]}_getVirtualListCellRefCallback(e){return this._virtualListCellRefCallbacks[e]||(this._virtualListCellRefCallbacks[e]=t=>{t?this._virtualListCells[e]=t:(delete this._virtualListCells[e],delete this._virtualListCellRefCallbacks[e])}),this._virtualListCellRefCallbacks[e]}componentDidMount(){this._isMounted=!0,this._componentDidRender()}componentWillUnmount(){this._currentState=void 0,this._isMounted=!1,m.default.unsubscribe(this._screenReaderDetectionStoreToken)}componentDidUpdate(e,t,s){this._componentDidRender()}_componentDidRender(){if(d.log(l.LogTraceArea.VirtualMessageViewDebug,"Component Did Render"),this._isRenderDirty=!1,this._renderedItemKeys){let e;const t=this._renderedItemKeys.filter((e=>e!==S.ItemListKey.Composing));if(this._focusedItemKey){if(e=t.indexOf(this._focusedItemKey),e<0||!this._isFocused)if(e>=0){const s=this._virtualListCells[t[e]];s&&s.setFocusLimited(!0)}else e=t.length-1}else e=t.length-1;if(this._focusedItemKey=t[e],this._focusedItemKey){const e=this._virtualListCells[this._focusedItemKey];e&&e.setFocusLimited(!1)}}}scrollToBottom(){this._currentState&&this._currentState.onScrollToPosition(-1,!1)}scrollToPosition(e,t,s=!1){this._currentState&&(this._currentState.onScrollToPosition(e,s),this._itemKeyToFocusNext(t))}focusMessage(e){let t;i.eachRight(this._virtualListCells,(s=>{s.props.item&&i.endsWith(s.props.item.key,e)&&(t=s)})),t&&t.focusCell()}_itemKeyToFocusNext(e){const t=this._virtualListCells[e],s=this._virtualListCells[this._focusedItemKey];t&&(t.setFocusLimited(!1),s&&s.setFocusLimited(!0)),this._focusedItemKey=e}_shouldShowItem(e){return this._filledViewableScreen&&this._isHeightOfItemKnown(e)&&0===i.size(this._pendingMeasures)}_calcHeightOfItems(e,t,s){let i=0;for(let o=t;o<=s;o++)i+=this._getHeightOfItem(e[o]);return i}_calcUnknownHeightItemsCount(e,t,s){let i=0;for(let o=t;o<=s;o++){const t=e[o];i+=t.height||this._isHeightOfItemKnown(t)?0:1}return i}_isHeightOfItemKnown(e){return void 0!==this._heightCache[e.key]}_getHeightOfItem(e){return e?void 0!==this._heightCache[e.key]?this._heightCache[e.key]:e.height?e.height:this._currentAverageHeight:0}}t.VirtualMessageView=k,k.Initialization=class{constructor(e){this.view=e,this._initializationState=w.Undefined}init(e){d.log(l.LogTraceArea.VirtualMessageViewDebug,"Initialization","init"),this.view._initItemList(e.observableList.getItemList(),e)}onLayoutListContainer(e,t){d.log(l.LogTraceArea.VirtualMessageViewDebug,"Initialization","onLayoutListContainer"),t&&this.view._onLayoutListContainer(e),this._moveToNextIfReady()}onListChanged(e,t){d.log(l.LogTraceArea.VirtualMessageViewDebug,"Initialization","onListChanged"),this.view._onListChangedQueue.push({listModification:e,updatedList:t})}onScrollToPosition(e,t){this.view._onScrollToPositionEvent=e}onScroll(e,t){}onLayoutItem(e,t){this.view._onLayoutItem(e,t),this._moveToNextIfReady()}onAnimateStartStopItem(e,t){}onControllerScrollPositionSet(){d.log(l.LogTraceArea.VirtualMessageViewDebug,"Initialization","onControllerScrollPositionSet"),this._finishInitialization()}onScrollEndDrag(){}_canMoveNext(){return 0===i.size(this.view._pendingMeasures)&&this._initializationState!==w.WaitingForScroll&&0!==this.view._viewportHeight}_moveToNextIfReady(){if(this._canMoveNext()){if(0===this.view._itemList.length)return this.view._filledViewableScreen=!0,void this.view.setCurrentState(new k.Idle(this.view));this.view._calcNewRenderedItemState(!1),this.view._renderIfDirty(),this._canMoveNext()&&(d.log(l.LogTraceArea.VirtualMessageViewDebug,"Initialization","starting reconcileCorrections"),this.view._reconcileCorrections(!0),this._finishInitialization())}}_finishInitialization(){d.log(l.LogTraceArea.VirtualMessageViewDebug,"Initialization","starting popInvisibleIntoView"),this.view._popInvisibleIntoView(),this.view._scrollView&&this.view._setScrollTop(this.view._lastScrollTop,!1),this.view.setCurrentState(new k.Wait(this.view,100))}},k.Idle=class{constructor(e){this.view=e,this._needsReconcilation=!1,this._reconcileCorrectionsDebounced=i.debounce((()=>{if(this.view._isMounted){if(i.size(this.view._pendingMeasures)>0||i.size(this.view._pendingAnimations)>0||this.view._isDragging)return void this._reconcileCorrectionsDebounced();this._reconcileCorrections()}}),1e3)}init(e){for(d.log(l.LogTraceArea.VirtualMessageViewDebug,"Idle","init"),i.each(this.view._onAnimateStartStopItemQueue,(e=>{d.log(l.LogTraceArea.VirtualMessageViewDebug,"Idle","processing queued onAnimateStartStopItem for "+e.itemKey),this.view._onAnimateStartStopItem(e.itemKey,e.animateStart)})),this.view._onAnimateStartStopItemQueue=[],i.each(this.view._onLayoutItemQueue,(e=>{this.view._onLayoutItem(e.itemKey,e.newHeight)})),this.view._onLayoutItemQueue=[],this.view._onLayoutListContainerEvent&&(d.log(l.LogTraceArea.VirtualMessageViewDebug,"Idle","processing queued onLayoutListContainer"),this.view._onLayoutListContainer(this.view._onLayoutListContainerEvent)),this.view._onLayoutListContainerEvent=void 0,this.view._reportUserScrollEvent&&(d.log(l.LogTraceArea.VirtualMessageViewDebug,"Idle","processing queued reportUserScrollEvent"),this.view._onReportUserScrollEvent());i.size(this.view._onListChangedQueue)>0;){const e=this.view._onListChangedQueue.splice(0,1)[0];if(d.log(l.LogTraceArea.VirtualMessageView,"Idle","processing queued onListChanged"+JSON.stringify(i.omit(e.listModification,["items"]))+", "+i.map(e.listModification.items,(e=>e.key))),this._processOnListChanged(e.listModification,e.updatedList))return}this._processPendingOnScrollToPosition(),this._finishEventProcessing()}_processPendingOnScrollToPosition(){i.isUndefined(this.view._onScrollToPositionEvent)||(d.log(l.LogTraceArea.VirtualMessageViewDebug,"processing queued onScrollToPosition"),this._processOnScrollToPosition(this.view._onScrollToPositionEvent,!1),this.view._onScrollToPositionEvent=void 0)}onLayoutListContainer(e,t){d.log(l.LogTraceArea.VirtualMessageViewDebug,"Idle","onLayoutListContainer"),t&&this.view._onLayoutListContainer(e),this._finishEventProcessing()}_finishEventProcessing(e=!1){if(!this._needsReconcilation){const t=this.view._lastScrollTop<=0||this.view._lastScrollTop>=this.view._containerHeight-this.view._viewportHeight;this._needsReconcilation=t&&e}if(i.size(this.view._pendingAnimations)>0)return this._reconcileCorrectionsDebounced.cancel(),void this.view.setCurrentState(new k.WaitForAnimation(this.view));if(i.size(this.view._pendingMeasures)>0)return;if(this._needsReconcilation&&!this.view._isDragging)return void this._reconcileCorrections();const t=!this._needsReconcilation;this.view._checkAndReportVisibleRangeChanges(),this.view._calcNewRenderedItemState(!0,t),this.view._renderIfDirty(),this.view._focusCellIfNeeded(),this._reconcileCorrectionsDebounced()}_reconcileCorrections(){return this._needsReconcilation=!1,this.view._repositionCells({animate:!1}),this.view._reconcileCorrections(!1),this._processPendingOnScrollToPosition(),this.view._checkAndReportVisibleRangeChanges(),this.view._calcNewRenderedItemState(),this.view._renderIfDirty(),!1}onListChanged(e,t){d.log(l.LogTraceArea.VirtualMessageView,"Idle","onListChanged "+JSON.stringify(i.omit(e,["items"]))+", "+i.map(e.items,(e=>e.key))),this._processOnListChanged(e,t)||(this.view._renderIfDirty(),this._finishEventProcessing())}_processOnListChanged(e,t){if(i.each(t,(e=>{const t=this.view._renderInfoCache[e.key];if(t&&!t.shouldUpdate){const s=this.view._itemMap[e.key],i=this.view._itemList[s];t.shouldUpdate=this.view.props.shouldUpdateItem(i,e)}})),e.type===a.ListModificationType.AddItems){if(this.view._itemsAdded(t,e),i.size(this.view._pendingMeasures)>0)return this._reconcileCorrectionsDebounced.cancel(),this.view.setCurrentState(new k.WaitForModifiedItemsRender(this.view,e)),this.view._renderIfDirty(),!0}else if(e.type===a.ListModificationType.RemoveItems)this.view._itemsRemoved(t,e),this.view._repositionCells({animate:!0});else if(e.type===a.ListModificationType.ReplaceItems){if(this.view._itemsReplaced(t,e),i.size(this.view._pendingMeasures)>0)return this._reconcileCorrectionsDebounced.cancel(),this.view.setCurrentState(new k.WaitForModifiedItemsRender(this.view,e)),this.view._renderIfDirty(),!0}else e.type===a.ListModificationType.MoveItems&&this.view._itemsMoved(t,e);return this.view._isRenderDirty=!0,!1}onScrollToPosition(e,t){d.log(l.LogTraceArea.VirtualMessageViewDebug,"Idle","onScrollToPosition");if(i.size(this.view._pendingMeasures)>0||i.size(this.view._pendingAnimations)>0)return this.view._onScrollToPositionEvent=e,void(this._needsReconcilation=!0);this._reconcileCorrections()?this.view._onScrollToPositionEvent=e:(this._processOnScrollToPosition(e,t),this._finishEventProcessing())}_processOnScrollToPosition(e,t){const s=this.view._containerHeight-this.view._viewportHeight;if(-1===e)this.view._setNewScrollTop(s,t);else{const i=this.view._itemList,o=this.view._getHeightOfItem(this.view._itemList[e]);let n=this.view._calcHeightOfItems(i,0,e)-o-Math.floor(.25*this.view._viewportHeight);n=n>s?s:n,this.view._setNewScrollTop(n,t)}}onScroll(e,t){this.view._onScroll(e,t),this._finishEventProcessing(!0)}onLayoutItem(e,t){(this.view._onLayoutItem(e,t)||0===i.size(this.view._pendingMounts))&&this._finishEventProcessing(!0)}onAnimateStartStopItem(e,t){this.view._onAnimateStartStopItem(e,t),this._finishEventProcessing()}onControllerScrollPositionSet(){d.warn(l.LogTraceArea.VirtualMessageView,"Idle - onControllerScrollPositionSet - Unexpected event")}onScrollEndDrag(){this._finishEventProcessing(!0)}},k.WaitForModifiedItemsRender=class{constructor(e,t){this._view=e,this._listModification=t}init(e){d.log(l.LogTraceArea.VirtualMessageViewDebug,"WaitForModifiedItemsRender","init")}onLayoutListContainer(e,t){d.log(l.LogTraceArea.VirtualMessageViewDebug,"WaitForModifiedItemsRender","onLayoutListContainer"),t&&(this._view._onLayoutListContainerEvent=e)}onListChanged(e,t){d.log(l.LogTraceArea.VirtualMessageViewDebug,"WaitForModifiedItemsRender","onListChanged"),this._view._onListChangedQueue.push({listModification:e,updatedList:t})}onScrollToPosition(e,t){d.log(l.LogTraceArea.VirtualMessageViewDebug,"WaitForModifiedItemsRender","onScrollToPosition"),this._view._onScrollToPositionEvent=e}onScroll(e,t){d.log(l.LogTraceArea.VirtualMessageViewDebug,"WaitForModifiedItemsRender","onScroll"),this._view._onScroll(e,t)}onLayoutItem(e,t){if(this._view._onLayoutItem(e,t),0===i.size(this._view._pendingMeasures)){if(this._listModification.type===a.ListModificationType.AddItems){const t=this._listModification.options&&this._listModification.options.animateFromBottom,s=this._view._renderInfoCache[e].top;if(s<=this._view._getViewportBottom()+30&&s>=this._view._lastScrollTop){if(this._view._repositionCells({animate:!0,dissallowVisibilityChanges:!0}),t){const e=this._view._containerHeight-this._view._getBottomSpacerHeight()-this._view._heightBelowRenderBlockEstimate,t={animate:!1};i.each(this._listModification.items,(s=>{this._view._renderInfoCache[s.key]&&this._view._setCellTopAndVisibility(s.key,!0,e,0,t)}))}this._view._repositionCells({animate:!0,staggerAnimations:true})}}else this._view._repositionCells({animate:!0});i.size(this._view._pendingAnimations)>0?this._view.setCurrentState(new k.WaitForAnimation(this._view)):this._view.setCurrentState(new k.Idle(this._view))}}onAnimateStartStopItem(e,t){this._view._onAnimateStartStopItem(e,t)}onControllerScrollPositionSet(){d.warn(l.LogTraceArea.VirtualMessageView,"WaitForModifiedItemsRender - onControllerScrollPositionSet - Unexpected event")}onScrollEndDrag(){}},k.Wait=class{constructor(e,t){this._view=e,i.delay((()=>{this._view._isMounted&&this._view.setCurrentState(new k.Idle(this._view))}),t)}init(e){d.log(l.LogTraceArea.VirtualMessageViewDebug,"Wait","init")}onLayoutListContainer(e,t){d.log(l.LogTraceArea.VirtualMessageViewDebug,"Wait","onLayoutListContainer"),t&&(this._view._onLayoutListContainerEvent=e)}onListChanged(e,t){d.log(l.LogTraceArea.VirtualMessageViewDebug,"Wait","onListChanged"),this._view._onListChangedQueue.push({listModification:e,updatedList:t})}onScrollToPosition(e,t){d.log(l.LogTraceArea.VirtualMessageViewDebug,"Wait","onScrollToPosition"),this._view._onScrollToPositionEvent=e}onScroll(e,t){d.log(l.LogTraceArea.VirtualMessageViewDebug,"Wait","onScroll"),this._view._onScroll(e,t)}onLayoutItem(e,t){this._view._onLayoutItemQueue.push({itemKey:e,newHeight:t})}onAnimateStartStopItem(e,t){d.log(l.LogTraceArea.VirtualMessageViewDebug,"Wait","onAnimateStartStopItem"),this._view._onAnimateStartStopItem(e,t)}onControllerScrollPositionSet(){d.warn(l.LogTraceArea.VirtualMessageView,"Wait - onControllerScrollPositionSet - Unexpected event")}onScrollEndDrag(){}},k.WaitForAnimation=class{constructor(e){this._view=e}init(e){d.log(l.LogTraceArea.VirtualMessageViewDebug,"WaitForAnimation","init")}onLayoutListContainer(e,t){d.log(l.LogTraceArea.VirtualMessageViewDebug,"WaitForAnimation","onLayoutListContainer"),t&&(this._view._onLayoutListContainerEvent=e)}onListChanged(e,t){d.log(l.LogTraceArea.VirtualMessageViewDebug,"WaitForAnimation","onListChanged"),this._view._onListChangedQueue.push({listModification:e,updatedList:t})}onScrollToPosition(e,t){d.log(l.LogTraceArea.VirtualMessageViewDebug,"WaitForAnimation","onScrollToPosition"),this._view._onScrollToPositionEvent=e}onScroll(e,t){d.log(l.LogTraceArea.VirtualMessageViewDebug,"WaitForAnimation","onScroll"),this._view._onScroll(e,t)}onLayoutItem(e,t){this._view._onLayoutItemQueue.push({itemKey:e,newHeight:t})}onAnimateStartStopItem(e,t){d.log(l.LogTraceArea.VirtualMessageViewDebug,"WaitForAnimation","onAnimateStartStopItem"),this._view._onAnimateStartStopItem(e,t),0===i.size(this._view._pendingAnimations)&&this._view.setCurrentState(new k.Idle(this._view))}onControllerScrollPositionSet(){d.warn(l.LogTraceArea.VirtualMessageView,"WaitForAnimation - onControllerScrollPositionSet - Unexpected event")}onScrollEndDrag(){}},k.WaitForScrollPositionSet=class{constructor(e){this._view=e}init(e){d.log(l.LogTraceArea.VirtualMessageViewDebug,"WaitForScrollPositionSet","init")}onLayoutListContainer(e,t){d.log(l.LogTraceArea.VirtualMessageViewDebug,"WaitForScrollPositionSet","onLayoutListContainer"),t&&(this._view._onLayoutListContainerEvent=e)}onListChanged(e,t){d.log(l.LogTraceArea.VirtualMessageViewDebug,"WaitForScrollPositionSet","onListChanged"),this._view._onListChangedQueue.push({listModification:e,updatedList:t})}onScrollToPosition(e,t){d.log(l.LogTraceArea.VirtualMessageViewDebug,"WaitForScrollPositionSet","onScrollToPosition"),this._view._onScrollToPositionEvent=e}onScroll(e,t){}onLayoutItem(e,t){this._view._onLayoutItemQueue.push({itemKey:e,newHeight:t})}onAnimateStartStopItem(e,t){d.log(l.LogTraceArea.VirtualMessageViewDebug,"WaitForScrollPositionSet","onAnimateStartStopItem"),this._view._onAnimateStartStopItem(e,t)}onControllerScrollPositionSet(){d.log(l.LogTraceArea.VirtualMessageViewDebug,"WaitForScrollPositionSet","onControllerScrollPositionSet"),this._view._repositionCells({}),this._view.setCurrentState(new k.Idle(this._view))}onScrollEndDrag(){}}},22854:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationIcon=void 0;const i=s(16778),o=s(88837),n=s(38933),r=s(89391),a=s(43632),l=s(71830),d=s(23293),c=s(52262),h=s(74313),u=s(10117),p=s(15877),g=s(66127),m=s(82052),S=s(81760),f=s(11010),y=s(11828),_=s(80837),v=s(18037),C=s(97634),b=s(94214),T=s(75865),M=s(2301),I=s(88117),w=s(67977),P=s(72758),k=w.UserIconSize.Size20,A=w.UserIconSize.Size20,E=k+2,R=A+2,L=(0,p.lazyProperties)({convIconDefault:()=>i.Styles.createViewStyle({backgroundColor:S.Color.gray400,alignItems:"center",justifyContent:"center"}),meetNowIcon:()=>i.Styles.createViewStyle({backgroundColor:S.Color.blue}),meetNowIconDarkHightContrast:()=>i.Styles.createViewStyle({backgroundColor:S.Color.gray50}),meetNowIconLightHightContrast:()=>i.Styles.createViewStyle({backgroundColor:S.Color.gray400}),container:()=>i.Styles.createViewStyle({borderRadius:0,overflow:"visible"}),messageAuthorAvatarContainer:()=>i.Styles.createViewStyle({position:"absolute",justifyContent:"center",bottom:-4,right:-4,width:E,height:E,borderRadius:E/2,alignItems:"center"}),messageAuthorAvatarContainerModernize:()=>i.Styles.createViewStyle({position:"absolute",justifyContent:"center",bottom:-4,right:-4,width:R,height:R,borderRadius:R/2,alignItems:"center"}),borderOverlayStyle:()=>i.Styles.createViewStyle({position:"absolute",left:0,right:0})}),F={convIconSizes:(0,p.lazyProperties)({size24:()=>({dimensionsStyles:i.Styles.createViewStyle({width:w.ConversationIconSize.Size24,height:w.ConversationIconSize.Size24,borderRadius:w.ConversationIconSize.Size24/2}),size:y.IconSize.size16,color:S.Color.white}),size28:()=>({dimensionsStyles:i.Styles.createViewStyle({width:w.ConversationIconSize.Size28,height:w.ConversationIconSize.Size28,borderRadius:w.ConversationIconSize.Size28/2}),size:y.IconSize.size16,color:S.Color.white}),size30:()=>({dimensionsStyles:i.Styles.createViewStyle({width:w.ConversationIconSize.Size30,height:w.ConversationIconSize.Size30,borderRadius:w.ConversationIconSize.Size30/2}),size:y.IconSize.size16,color:S.Color.white}),size36:()=>({dimensionsStyles:i.Styles.createViewStyle({width:w.ConversationIconSize.Size36,height:w.ConversationIconSize.Size36,borderRadius:w.ConversationIconSize.Size36/2}),size:y.IconSize.size20,color:S.Color.white}),size40:()=>({dimensionsStyles:i.Styles.createViewStyle({width:w.ConversationIconSize.Size40,height:w.ConversationIconSize.Size40,borderRadius:w.ConversationIconSize.Size40/2}),size:y.IconSize.size20,color:S.Color.white}),size44:()=>({dimensionsStyles:i.Styles.createViewStyle({width:w.ConversationIconSize.Size44,height:w.ConversationIconSize.Size44,borderRadius:w.ConversationIconSize.Size44/2}),size:y.IconSize.size28,color:S.Color.white}),size50:()=>({dimensionsStyles:i.Styles.createViewStyle({width:w.ConversationIconSize.Size50,height:w.ConversationIconSize.Size50,borderRadius:w.ConversationIconSize.Size50/2}),size:y.IconSize.size24,color:S.Color.white}),size60:()=>({dimensionsStyles:i.Styles.createViewStyle({width:w.ConversationIconSize.Size60,height:w.ConversationIconSize.Size60,borderRadius:w.ConversationIconSize.Size60/2}),size:y.IconSize.size24,color:S.Color.white}),size64:()=>({dimensionsStyles:i.Styles.createViewStyle({width:w.ConversationIconSize.Size64,height:w.ConversationIconSize.Size64,borderRadius:w.ConversationIconSize.Size64/2}),size:y.IconSize.size28,color:S.Color.white}),size100:()=>({dimensionsStyles:i.Styles.createViewStyle({width:w.ConversationIconSize.Size100,height:w.ConversationIconSize.Size100,borderRadius:w.ConversationIconSize.Size100/2}),size:y.IconSize.size48,color:S.Color.white}),size120:()=>({dimensionsStyles:i.Styles.createViewStyle({width:w.ConversationIconSize.Size120,height:w.ConversationIconSize.Size120,borderRadius:w.ConversationIconSize.Size120/2}),size:y.IconSize.size48,color:S.Color.white}),size160:()=>({dimensionsStyles:i.Styles.createViewStyle({width:w.ConversationIconSize.Size160,height:w.ConversationIconSize.Size160,borderRadius:w.ConversationIconSize.Size160/2}),size:y.IconSize.size48,color:S.Color.white})})};class x extends o.ComponentBase{_buildState(e,t){const s=e.conversationId?c.default.getDisplayableProfile(e.conversationId):void 0,i=v.default.useInitialsForConversationIcon(),o=v.default.useAccessibleTheme()?S.Color.white:void 0,n=e.conversationId?d.default.getPrimaryColor(e.conversationId):void 0,l=v.default.useDarkTheme(),h=v.default.useAccessibleTheme(),u=r.default.getS4LMessagingFeatures().modernizeDefaultAvatars;let p,f;if(e.conversationId){const{background:t,textColor:s}=(0,a.getAvatarColorsFromMri)(e.conversationId);p=t,f=this._getIconFontColor(h,l,s)}else p=[S.Color.blue,S.Color.white],f=this._getIconFontColor(h,l);return{conversationImageUrl:s?T.default.getAuthenticatedUrl(s.getAvatarUrl()):void 0,skypeToken:b.default.getSkypeToken(),primaryColor:o||n,conversationNameInitials:i&&s?u?s.getUpperCaseInitials():s.getInitials():void 0,lastMessageAuthorDisplayName:e.lastMessageAuthorMri?P.default.getDisplayableUserByMri(e.lastMessageAuthorMri).displayName:void 0,conversationGradientColors:p,conversationIconFontColor:f,useInitialsForConvIcon:i,useDarkTheme:l,useAccessibleTheme:h,enableLastMessageAuthorAvatar:m.default.lastMessageAuthorAvatarEnabled(),modernizeDefaultAvatars:u,modernizeConversationList:g.default.canModernizeConversationList()}}render(){const e=this.state.conversationImageUrl,t=this.props.altName,s=this._getIconStyleInfo(),o=this.state.modernizeDefaultAvatars?this.state.conversationIconFontColor:this.state.primaryColor||S.Color.blue,r=[L.convIconDefault,I.default.getCachedBackgroundColorStyle(this.state.modernizeDefaultAvatars?I.default.getIconBackgroundColor(this.state.primaryColor,this.state.useAccessibleTheme,this.state.useDarkTheme):this.props.backgroundColor,this.props.colorThemeOverride?C.isDarkTheme(this.props.colorThemeOverride):this.state.useDarkTheme),s.dimensionsStyles];let a,d;if(this.props.showBorder||!1!==this.props.showBorder&&this.state.modernizeDefaultAvatars){const e=this._getAvatarBorderColor();a=I.default.getCachedBorderColorStyle(e,this.state.modernizeDefaultAvatars),a&&!this.state.modernizeDefaultAvatars&&r.push(a)}if(this.state.useInitialsForConvIcon&&this.state.conversationNameInitials){const e=[...x._getFontSizeStyles(this.props.size,o),_.default.transparentBackground];d=i.createElement(i.Text,{style:e,numberOfLines:1,allowFontScaling:!1,importantForAccessibility:i.Types.ImportantForAccessibility.NoHideDescendants},this.state.conversationNameInitials)}else{const e=y.SkypeIcon.ContactGroupTwoPersonas;d=i.createElement(u.default,{icon:e,color:this.state.modernizeDefaultAvatars?this.state.conversationIconFontColor:o,size:s.size,style:_.default.transparentBackground})}const c=[L.convIconDefault,r],p=this.state.modernizeDefaultAvatars&&!this.state.useAccessibleTheme?i.createElement(n.GradientView,{style:c,colors:this.state.conversationGradientColors,direction:n.GradientDirection.BOTTOM_RIGHT},d):i.createElement(i.View,{style:r},d),g="ConversationIcon; MRINamespace:"+(this.props.conversationId?l.Namespaces[l.getMriNamespace(this.props.conversationId)]:"null");return i.createElement(h.default,{origin:g,source:e,skypeToken:this.state.skypeToken,altView:p,title:t,containerStyle:[s.dimensionsStyles,L.container],style:s.dimensionsStyles,resizeMode:"cover",importantForAccessibility:this.props.importantForAccessibility,blockUntrustedDomains:!0,onPress:this.props.onPress,accessibilityLabel:this.props.accessibilityLabel},this._renderBorderOverlay(a,s.dimensionsStyles),this.state.enableLastMessageAuthorAvatar&&this.props.showLastMessageAuthor?this._getLastMessageAuthorAvatar():void 0)}_renderBorderOverlay(e,t){if(e&&this.state.modernizeDefaultAvatars)return i.createElement(i.View,{style:[e,t,L.borderOverlayStyle]})}_getLastMessageAuthorAvatar(){const e=[this.state.modernizeConversationList?L.messageAuthorAvatarContainerModernize:L.messageAuthorAvatarContainer];(this.props.statusBorderColor||this.state.modernizeDefaultAvatars)&&e.push(i.Styles.createViewStyle({backgroundColor:this._getAvatarBorderColor(this.props.statusBorderColor)},!1));const t=(this.state.modernizeConversationList,w.UserIconSize.Size20);return i.createElement(i.View,{style:e},i.createElement(M.default,{size:t,userMri:this.props.lastMessageAuthorMri,title:this.state.lastMessageAuthorDisplayName,showTitleOnHover:!0,borderRadiusOverride:t/2,showBorder:!1}))}_getIconStyleInfo(){switch(this.props.size){case w.ConversationIconSize.Size24:return F.convIconSizes.size24;case w.ConversationIconSize.Size28:return F.convIconSizes.size28;case w.ConversationIconSize.Size30:return F.convIconSizes.size30;case w.ConversationIconSize.Size36:return F.convIconSizes.size36;case w.ConversationIconSize.Size40:return F.convIconSizes.size40;case w.ConversationIconSize.Size44:return F.convIconSizes.size44;case w.ConversationIconSize.Size50:return F.convIconSizes.size50;case w.ConversationIconSize.Size60:return F.convIconSizes.size60;case w.ConversationIconSize.Size64:return F.convIconSizes.size64;case w.ConversationIconSize.Size100:return F.convIconSizes.size100;case w.ConversationIconSize.Size120:return F.convIconSizes.size120;case w.ConversationIconSize.Size160:return F.convIconSizes.size160;default:return F.convIconSizes.size40}}static _getFontSizeStyles(e,t){const s=Math.ceil(e/(e<=w.ConversationIconSize.Size40?3:4)),o=t+s;let n=x._cachedFontSizeStyles[o];return n||(n=i.Styles.createTextStyle({fontSize:s,font:f.default.font.uiDisplayBold,color:t||S.Color.white}),x._cachedFontSizeStyles[o]=n),[n]}_getIconFontColor(e,t,s){return e?t?S.Color.black:S.Color.white:s||S.Color.white}_getAvatarBorderColor(e){return e||(this.state.modernizeDefaultAvatars?this.state.useAccessibleTheme?this.state.useDarkTheme?S.Color.gray100:S.Color.gray400:this.state.useDarkTheme?S.Color.whiteOverlay40:S.Color.blackOverlay10:this.state.primaryColor||S.Color.blue)}}t.ConversationIcon=x,x._cachedFontSizeStyles={},t.default=x},77926:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(15877),n=s(24576),r=(0,o.lazyProperties)({container:()=>i.Styles.createButtonStyle({overflow:"visible",height:8,alignItems:"center",justifyContent:"center"}),divider:()=>i.Styles.createViewStyle({height:1,alignSelf:"stretch"})});class a extends n.default{render(){let e;return this.props.suppressBaseDivider||(e=i.createElement(i.View,{style:[r.divider,this._themeStyles.dividerColorStyle]})),i.createElement(i.View,{style:[r.container,this.props.style],ignorePointerEvents:!0},e)}}t.default=a},54464:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationsListItem=void 0;const i=s(96486),o=s(60014),n=s(16778),r=s(44770),a=(s(19784),s(89391)),l=s(1706),d=s(38173),c=s(7499),h=s(34196),u=s(53338),p=s(77605),g=s(60787),m=s(20187),S=s(94224),f=s(98925),y=s(37034),_=s(80200),v=s(47447),C=s(22801),b=s(76621),T=s(71908),M=s(51077),I=s(61375),w=s(81697),P=s(71830),k=s(98278),A=s(842),E=s(26459),R=s(984),L=s(29791),F=s(78364),x=s(91114),O=s(75760),D=s(31751),B=s(22854),V=s(20770),N=s(37324),U=s(39549),H=s(23353),z=s(57102),W=s(82261),j=s(99686),G=s(16402),K=s(12381),q=s(86374),Q=s(73145),X=s(52262),$=s(3782),J=s(54543),Y=s(3291),Z=s(41706),ee=s(25793),te=s(70891),se=s(46096),ie=s(62781),oe=s(11375),ne=s(13944),re=s(10117),ae=s(5581),le=s(36237),de=s(61253),ce=s(73600),he=s(15877),ue=s(33754),pe=s(34537),ge=s(51072),me=s(18743),Se=s(3088),fe=s(36699),ye=s(65788),_e=s(64723),ve=s(23752),Ce=s(14572),be=s(6658),Te=s(66127),Me=s(10909),Ie=s(4381),we=s(80622),Pe=s(89808),ke=s(78735),Ae=s(18078),Ee=s(4735),Re=s(30124),Le=s(27357),Fe=s(93003),xe=s(14976),Oe=(s(36150),s(86045)),De=s(56810),Be=s(93194),Ve=s(22222),Ne=s(81760),Ue=s(11010),He=s(11828),ze=s(80837),We=s(60305),je=s(19675),Ge=s(24576),Ke=s(2301),qe=s(88117),Qe=s(21788),Xe=s(72758),$e=s(92772),Je=s(53374),Ye=s(79481),Ze=s(80468),et=be.messageTextLineHeight,tt=He.IconSize.size16,st=He.IconSize.size10,it=He.IconSize.size12,ot=He.IconSize.size20,nt=(0,he.lazyProperties)({listItemWrapper:()=>n.Styles.createViewStyle({overflow:"visible",backgroundColor:Ne.Color.transparent}),listItemBase:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",paddingTop:10,paddingBottom:10,overflow:"visible"}),listItemBaseHorizontalPaddingClassic:()=>n.Styles.createViewStyle({paddingLeft:k.RowPaddingClassic.left,paddingRight:k.RowPaddingClassic.right}),listItemBaseHorizontalPaddingModernize:()=>n.Styles.createViewStyle({paddingLeft:k.RowPaddingModernize.leftDesktop,paddingRight:k.RowPaddingModernize.rightDesktop}),listItemBaseHorizontalPaddingModernizeMobile:()=>n.Styles.createViewStyle({paddingLeft:k.RowPaddingModernize.left,paddingRight:k.RowPaddingModernize.right}),listItemSmall:()=>n.Styles.createViewStyle({paddingTop:6,paddingBottom:8}),modernizedListItemSmall:()=>n.Styles.createViewStyle({paddingTop:6,paddingBottom:6}),listItemCompact:()=>n.Styles.createViewStyle({paddingTop:0,paddingBottom:0}),infoSection:()=>n.Styles.createViewStyle({alignItems:"flex-end",alignSelf:"stretch",marginLeft:4,marginTop:10}),linkText:()=>n.Styles.createTextStyle({flex:-1,fontSize:Ue.default.controlFontSize.cardTitle,marginBottom:3}),linkTextUnreadSelected:()=>n.Styles.createTextStyle({font:Ue.default.font.uiDisplayBold}),accessoryIcon:()=>n.Styles.createTextStyle({alignSelf:"flex-end",marginLeft:4}),accessoryIconMobile:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center",marginTop:4}),accessoryIconMobileCompact:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center"}),lastMessageTimeText:()=>n.Styles.createTextInputStyle({marginVertical:5}),lastMessageText:()=>n.Styles.createTextStyle({flex:1,lineHeight:et}),infoSectionRN:()=>n.Styles.createViewStyle({paddingTop:5,marginTop:0}),cardContentBase:()=>n.Styles.createViewStyle({flex:1,alignItems:"flex-start",alignSelf:"stretch",justifyContent:"center"}),cardContentCompact:()=>n.Styles.createViewStyle({marginLeft:10}),cardContentSmall:()=>n.Styles.createViewStyle({marginLeft:12}),displayName:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),displayNameBase:()=>n.Styles.createViewStyle({alignSelf:"stretch",paddingRight:6}),lastMessageAccessoryIcon:()=>n.Styles.createViewStyle({flexShrink:0,flexGrow:0,paddingRight:4,height:et}),lastMessageContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignSelf:"stretch",alignItems:"center",overflow:"visible",flex:1}),lastMessageContainerWeb:()=>n.Styles.createViewStyle({height:et,overflow:"hidden"}),typingIndicatorContainer:()=>n.Styles.createViewStyle({paddingVertical:2,height:22}),callButtonsContainer:()=>n.Styles.createViewStyle({flexDirection:"row",justifyContent:"center",overflow:"visible"}),joinButtonStyle:()=>n.Styles.createViewStyle({marginRight:-5,overflow:"visible"}),joinButtonStyleModernize:()=>n.Styles.createViewStyle({overflow:"visible"}),endCallControls:()=>n.Styles.createViewStyle({marginRight:-5}),endCallControlsModernize:()=>n.Styles.createViewStyle({}),optionalButton:()=>n.Styles.createViewStyle({alignItems:"center",paddingHorizontal:10,backgroundColor:Ne.Color.transparent}),optionalAccessoryButton:()=>n.Styles.createViewStyle({alignItems:"center",marginLeft:15,backgroundColor:Ne.Color.transparent}),badgeView:()=>n.Styles.createViewStyle({marginLeft:4}),staticDivider:()=>n.Styles.createViewStyle({height:1,bottom:0,alignSelf:"stretch"}),indicatorImage:()=>n.Styles.createImageStyle({width:30,height:15}),inlineIndicatorImage:()=>n.Styles.createImageStyle({position:"absolute",top:4}),compositeNav:()=>(0,he.lazyProperties)({listItemBase:()=>n.Styles.createViewStyle({paddingTop:0,paddingBottom:3}),listItemBaseHorizontalPaddingClassic:()=>n.Styles.createViewStyle({paddingLeft:k.RowPaddingClassic.leftDesktop,paddingRight:k.RowPaddingClassic.rightDesktop}),listItemBaseHorizontalPaddingModernize:()=>n.Styles.createViewStyle({paddingLeft:k.RowPaddingModernize.leftDesktop,paddingRight:k.RowPaddingModernize.rightDesktop}),listItemBaseCompact:()=>n.Styles.createViewStyle({paddingTop:0,paddingBottom:0}),listItemBaseCompactHorizontalPaddingClassic:()=>n.Styles.createViewStyle({paddingLeft:k.RowPaddingClassic.leftDesktop,paddingRight:k.RowPaddingClassic.rightDesktop}),listItemBaseCompactHorizontalPaddingModernize:()=>n.Styles.createViewStyle({paddingLeft:k.RowPaddingModernize.leftDesktop,paddingRight:k.RowPaddingModernize.rightDesktop}),infoSectionExtraPadding:()=>n.Styles.createViewStyle({marginTop:6}),infoSectionLeftNav:()=>n.Styles.createViewStyle({marginTop:4}),infoSectionCompact:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",overflow:"visible"}),accessoryViewCompact:()=>n.Styles.createViewStyle({marginLeft:5,overflow:"visible"}),linkText:()=>n.Styles.createTextStyle({fontSize:Ue.default.controlFontSize.body,font:Ue.default.font.uiDisplayRegular,marginBottom:0}),linkTextExtraCompact:()=>n.Styles.createTextStyle({fontSize:Ue.default.controlFontSize.bodySmallDeprecated}),inlineText:()=>n.Styles.createTextStyle({fontSize:Ue.default.controlFontSize.body,lineHeight:19}),accessoryIcon:()=>n.Styles.createTextStyle({marginTop:2}),itemDivider:()=>n.Styles.createViewStyle({left:55,right:15,bottom:-13,height:27,marginRight:0}),itemDividerCompact:()=>n.Styles.createViewStyle({left:40,right:15,bottom:-13,height:27,marginRight:0}),lastMessageTimeText:()=>n.Styles.createTextInputStyle({marginVertical:6}),darkThemeRead:()=>n.Styles.createViewStyle({opacity:.8}),lastMessageText:()=>n.Styles.createTextStyle({fontSize:Ue.default.controlFontSize.body})}),itemDivider:()=>n.Styles.createViewStyle({position:"absolute",left:85,right:0,bottom:-3,marginRight:15,alignItems:"stretch",overflow:"visible"}),itemDividerSmall:()=>n.Styles.createViewStyle({left:82,marginRight:10}),itemDividerCompact:()=>n.Styles.createViewStyle({left:60,marginRight:10}),itemDividerInner:()=>n.Styles.createViewStyle({flex:1,overflow:"visible"}),itemDividerInnerCompositveNavShort:()=>n.Styles.createViewStyle({bottom:4,marginRight:80,overflow:"hidden"}),itemDividerInnerCompositveNav:()=>n.Styles.createViewStyle({bottom:4}),cardContent:()=>n.Styles.createViewStyle({flexDirection:"row",alignSelf:"stretch"}),errorSymbolContainer:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center",marginBottom:2,width:tt+6,height:tt}),errorSymbol:()=>n.Styles.createViewStyle({paddingRight:6}),reducedHighlight:()=>n.Styles.createViewStyle({opacity:.5}),swipeActionsBackground:()=>n.Styles.createViewStyle({top:-.5,bottom:1}),userPresenceIndicator:()=>n.Styles.createViewStyle({width:st,height:st,borderRadius:st/2,marginHorizontal:1,marginLeft:5}),modernizeUserPresenceIndicator:()=>n.Styles.createViewStyle({width:st,height:st,borderRadius:st/2,marginHorizontal:5}),mobileCertifiedIconWrapper:()=>n.Styles.createViewStyle({position:"relative",bottom:1})});class rt extends Ge.default{constructor(){super(...arguments),this._cardContentAndDividerTransformValue=new n.Animated.Value(0),this._cardContentOpacityValue=new n.Animated.Value(1),this._conversationSwipeActionForCommand=e=>N.default.conversationSwipeActionForCommand(e,this.props.conversationId,this._currentTheme,this._useCompactLayout(),this._onHandleMoreMenuCommand),this._onDropStarted=()=>{const e=this._container;if(!e)return;if(!this.state.allUserConversations||0===this.state.allUserConversations.length)return void e.onDragDropContinue(this.props.conversationId);const t=z.ConversationUtils.getConversationForGivenType(this.state.allUserConversations,H.ConversationUIType.OneOnOneSkype),s=z.ConversationUtils.getConversationForGivenType(this.state.allUserConversations,H.ConversationUIType.Private),i=t&&t.id;s&&s.id;i&&e.onDragDropContinue(i)},this._containerRefCallback=e=>{this._container=e||void 0},this._onHoverStart=()=>{this.isComponentMounted()&&this.setState({isHovering:!0})},this._onHoverEnd=()=>{this.isComponentMounted()&&this.setState({isHovering:!1})},this._onAccessibilityAction=e=>{const t=e.nativeEvent;if(t&&!i.isEmpty(t.action)){const e=i.filter(this._getMoreMenuItems().items,(e=>(0,de.default)(e.text,t.action)));this._onHandleMoreMenuCommand(e[0].command)}},this._onHandleContextMenu=e=>{Q.default.showContextMenu(e,this._getRootViewId(),{getMenuGroups:this._getContextMenuGroups,onItemSelected:this._onHandleMoreMenuCommand})},this._onHandleLongPress=e=>{0},this._onArchiveConversation=()=>{c.default.showIfRequired(this._getRootViewId()).then((()=>{this._archiveConversation()}))},this._getContextMenuGroups=()=>N.default.getMenuSections(Object.assign({},this._getMenuItems())),this._onHandleMoreMenuCommand=e=>{const t=Je.default.newCauseId();le.log(se.LogTraceArea.ConversationsListItem,"ConversationsListItem._onHandleMoreMenuCommand, conversationId: "+xe.mriOrId(this.props.conversationId)+", command: "+e+", causeId: "+t);const s=P.isOneOnOneConversation(this.props.conversationId)&&a.default.getS4LMessagingFeaturesNoSubscription().enableGroupedConversations;switch(e){case N.ConversationCommands.AudioCall:this._startCall(f.StartCallOrMaybePromptUserIntent.Audio,t);break;case N.ConversationCommands.Call:this._startCall(f.StartCallOrMaybePromptUserIntent.Generic,t);break;case N.ConversationCommands.ManageGroup:Ee.default.showDetailsPanelWithParams({mri:this.props.conversationId,showConversationSettings:!0,rootViewId:this._getRootViewId(),causeId:t});break;case N.ConversationCommands.CopyLink:ce.default.getConversationJoinLink(this.props.conversationId).then((e=>{K.default.shareToClipboard(e),this._sendConfiramtionToast(ue.getString("MeetNow.LinkCopied")),this._trackMeetNowClick(_e.MeetNowClickType.ClickCopyLink)})).fail((()=>{this._sendConfiramtionToast(ue.getString("MeetNow.GenericErrorTitle")),this._trackMeetNowClick(_e.MeetNowClickType.CopyLinkFailed)}));break;case N.ConversationCommands.Profile:Ee.default.showDetailsPanelWithParams({mri:this.props.conversationId,showConversationSettings:!0,rootViewId:this._getRootViewId(),causeId:t});break;case N.ConversationCommands.Favorite:s?D.default.addToFavorites(this.props.conversationId):ie.default.addConversation(this.props.conversationId);break;case N.ConversationCommands.Unfavorite:s?D.default.removeFromFavorites(this.props.conversationId):ie.default.removeConversation(this.props.conversationId);break;case N.ConversationCommands.LeaveConversation:this._handleLeaveConversation();break;case N.ConversationCommands.ClearConversation:case N.ConversationCommands.DeleteConversation:(0,F.deleteConversationGroup)(this.props.conversationId,(()=>this._container),this.context,"ConversationListItem",I.DeleteConversationSource.ConversationListItem);break;case N.ConversationCommands.MarkRead:s?D.default.markGroupAsRead(this.props.conversationId):T.markConversationRead(this.props.conversationId);break;case N.ConversationCommands.MarkUnread:T.markMessageUnread(this.props.conversationId);break;case N.ConversationCommands.AddBotToContacts:d.default.addAgentAsContact(P.stripMriNamespace(this.props.conversationId)).then((()=>{b.default.ensureConversationLoadedOrFaked(this.props.conversationId,se.ConversationFakedOrigin.ConvListItem).then((e=>{Ee.default.navigateToConversation({convId:this.props.conversationId,origin:se.NavigationConversationOrigin.Recents,causeId:t,isNewConversation:!0})}))}));break;case N.ConversationCommands.DeleteBotFromContacts:(0,F.deleteConversation)(this.props.conversationId,(()=>this._container),this.context,"ConversationListItem",I.DeleteConversationSource.ConversationListItem);break;case N.ConversationCommands.BlockContact:const e={mriToBlock:this.state.otherPartyMri||this.props.conversationId,rootViewId:this._getRootViewId(),reportContext:se.ReportContextListOptions.BlockContact,isBlockingDialog:!0},i={onCancelPress:void 0};Ee.default.navigateToReportConcernModal(e,i);break;case N.ConversationCommands.Unblock:const o=this.state.otherPartyMri||this.props.conversationId;this.state.isOneOnOne&&this.state.isRecipientBlocked&&R.default.unblockContact(o);break;case N.ConversationCommands.Archive:this._onArchiveConversation();break;case N.ConversationCommands.Unarchive:this._intOnUnarchiveConversation(t);break;case N.ConversationCommands.More:this._onHandleLongPress();break;case N.ConversationCommands.Mute:C.default.setConversationSubscription(this.props.conversationId,P.SubscriptionTypes.Muted);break;case N.ConversationCommands.Unmute:C.default.setConversationSubscription(this.props.conversationId,"");case Be.SXActionMenuCancel:}le.track(new x.ConversationListItemClicked(this.props.conversationId,e))},this._requestFocusWithDelay=()=>{i.delay((()=>{this.isComponentMounted()&&this.requestFocus()}),200)},this._onMarkConversationUnread=()=>{this.isComponentMounted()&&this.setState({markAsUnreadShowUnreadCount:!0})},this._archiveConversation=()=>{const e=Je.default.newCauseId();le.log(se.LogTraceArea.ConversationsListItem,"_archiveConversation, causeId: "+e),u.default.archiveConversation(this.props.conversationId,se.ArchiveConversationOrigin.ContextMenu,this._getRootViewId()),Ee.default.navigateAfterArchivingConversation(this.props.conversationId,e,this._getContext())},this._unarchiveConversation=()=>{const e=Je.default.newCauseId();le.log(se.LogTraceArea.ConversationsListItem,"_unarchiveConversation, causeId: "+e),u.default.unarchiveConversation(this.props.conversationId,se.UnarchiveConversationOrigin.ContextMenu)},this._onCallButtonPress=e=>{e.stopPropagation();const t=Je.default.newCauseId();le.log(se.LogTraceArea.ConversationsListItem,"_onCallButtonPress, causeId: "+t),this._startCall(f.StartCallOrMaybePromptUserIntent.Audio,t)},this._onVideoCallButtonPress=e=>{e.stopPropagation();const t=Je.default.newCauseId();le.log(se.LogTraceArea.ConversationsListItem,"_onVideoCallButtonPress, causeId: "+t),this._startCall(f.StartCallOrMaybePromptUserIntent.Video,t)},this._onJoinCallButtonPress=e=>{e.stopPropagation();const t=Je.default.newCauseId();le.log(se.LogTraceArea.ConversationsListItem,"_onJoinCallButtonPress, causeId: "+t),this._startCall(f.StartCallOrMaybePromptUserIntent.Generic,t)},this._onEndCallButtonPress=e=>{e.stopPropagation(),this.state.callId&&new m.EndCallCommand(this.state.callId).execute()},this._onConversationAudioButtonRef=e=>{this._conversationAudioButtonRef=e||void 0},this._onDragStartContact=e=>{Y.default.addDragAndDropContactInformation(e,this.state.ownerConversationId,this.state.conversationDisplayName,J.DragOrigin.RecentConversations)},this._onPress=e=>{this._completeOnPress(this.props.origin)},this._completeOnPress=e=>{const t=Je.default.newCauseId();le.log(se.LogTraceArea.ConversationsListItem,"ConversationsListItem._onPress, causeId: "+t),n.UserInterface.isNavigatingWithKeyboard()&&Oe.default.maybeAnnounceForAccessibility(ue.getString("Global.EnteringChatAnnouncement",{chatName:this.state.conversationDisplayName})),this.props.isSelected?n.UserInterface.isNavigatingWithKeyboard()&&oe.setFocus(oe.FocusEvent.RefreshConversation):!this.state.isUsingStackNav&&this.state.callId&&this.state.hasActiveCall&&this.state.activeCallStatus===_.ActiveCallStatus.Connected?S.default.CallNavigationHelper.rejoinCall(this.props.conversationId,this.state.callId,t,se.NavigationCallOrigin.ConversationListItem,!0):Ee.default.navigateToConversation({convId:this.props.conversationId,origin:e,causeId:t})}}_buildState(e,t){const s=O.default.getMessageCountsForConversation(e.conversationId,!0),o=(0,U.default)(),n=o.getConversation(e.conversationId);n||le.warn(se.LogTraceArea.ConversationsListItem,"ConversationsListItem: _buildState, conversation "+xe.mriOrId(e.conversationId)+" doesn't exist");const r=!!n&&n.isOneOnOne(),d=r&&n?n.getOtherPartyMri():void 0;let c;n&&this._shouldDisplayLastMessage(n)&&(c=o.getFakeLastMessageFallback(e.conversationId)||n.lastMessage);const h=A.default.getComposingUsers(e.conversationId),u=Re.default.isUsingStackNavigationContext(),p=this.props,g=j.default.isCurrentUserActive();let m=!!this.state&&this.state.markAsUnreadShowUnreadCount;this.state&&this.state.markAsUnreadShowUnreadCount&&(!e.isSelected&&p.isSelected||this.state.unreadCount>0&&0===s.unreadCount)&&(m=!1);const f=t||!e.isSelected||this.state.displayedUnreadCount||!g||m,y=a.default.getS4LMessagingFeatures(),v=r&&y.enableGroupedConversations?D.default.isGroupMarkedAsFavorite(e.conversationId):!!n&&n.isFavorite(),C=a.default.getS4LCMCFeatures(),b=P.isEncryptedThread(e.conversationId),T=d||e.conversationId,I=Xe.default.getConversationOwner(T),k=X.default.getDisplayName(I)||"",L=X.default.getShortDisplayName(I)||"",F=d?we.getCustomStatusFromMri(d):void 0,x=c&&c.hasAlbumId()&&!c.isSendRejected(),B=Se.default.getDraftPreviews(e.conversationId),N=a.default.getEngagementFeatures().conciergeBotSettings.enableVisibility&&P.isConciergeBotMri(e.conversationId),G=!!d&&P.isAgent(d),K=Te.default.canModernizeConversationList(),q=Te.default.canModernizeMobileTab(),Q={conversationTimestamp:this._getConversationTimestamp(n,y.enableMediaPreviewDrafts),conversationLastMessage:c,conversationDisplayName:k,conversationShortDisplayName:L,colorInfo:Pe.default.getColorInfo(),isFavorite:v,isMuted:!!n&&n.isMuted(),markAsUnreadShowUnreadCount:m,highPriorityUnreadCount:s.highPriorityUnreadCount,unreadCount:s.unreadCount,displayedUnreadCount:f?s.unreadCount:0,unreadCountOverflowed:s.unreadCountOverflowed,isMriAContact:!!d&&R.default.isContact(Xe.default.getConversationOwner(d)),isMriAnAgent:G,isEngagementBot:N,isJoinEnabled:null==n?void 0:n.isJoinEnabled(),isCallingAllowed:S.default.CallNavigationHelper.isCallingAllowed(e.conversationId),isRecipientBlocked:o.isConversationBlocked(n),isEncrypted:b,isTeamsUser:P.isS4BBridgeMri(e.conversationId),useMobileUI:u||!K&&We.default.useTabletUI(),otherPartyMri:d,isUsingStackNav:u,isOneOnOne:r,iOSAccessibilityActionEnabled:!1,addAccessibilityHint:!1,enableJoinerCallPreview:C.enableJoinerCallPreview&&P.isGroupConversation(e.conversationId),isLastMessageCallEvent:c&&M.isCallMessageType(c),displayBlockButton:n&&this._shouldDisplayBlockOption(n),allUserConversations:D.default.getDisplayableConversationsForUser(I),enableDragDropFromDesktopToRecentLists:y.enableDragAndDropFromDesktopToRecentLists,enableDragDropFromConversationToRecentLists:y.enableDragAndDropFilesFromConversationToRecentLists,ownerConversationId:I,isArchived:!!n&&n.isArchived(),draft:V.default.getSavedMessageInput(e.conversationId),mood:F&&F.mood,moodEmoticonType:F&&F.moodEmoticonType,moodEmoticonTone:F&&F.moodEmoticonTone,moodAccessibilityLabel:F&&F.mood&&F.moodEmoticonType&&we.getAccessibilityTitle(F.mood),enableMediaPreviewDrafts:y.enableMediaPreviewDrafts,mediaDraft:i.first(B),isLastMessageFromAlbum:x,isTranslated:C.enableMessageTranslation&&ae.default.isConversationTranslated(e.conversationId),enableEndCallInRecents:C.enableEndCallInRecents,lastMessageAuthorAvatarSwitchedOn:ke.default.getLastMessageAuthorAvatarSwitchedOn(),alwaysNavigateToLobby:C.redesignedLobbiesEnabled&&(null==n?void 0:n.isGroupConversation()),isTrustedAgent:G&&l.default.isTrustedAgent(e.conversationId),modernizeConversationList:K,modernizeMobileTab:q&&!(null==n?void 0:n.isArchived()),badgeColorStyle:pe.default.getBadgeColorStyle(K,this._currentTheme),fakeDraftMessage:void 0};if(Q.draft?Q.fakeDraftMessage=W.createFakeDraftMessage(e.conversationId,Q.draft):Q.enableMediaPreviewDrafts&&Q.mediaDraft&&(Q.fakeDraftMessage=W.createFakeMediaDraftMessage(e.conversationId,Q.mediaDraft,Se.default.getDraftPreviewTimestamp(e.conversationId))),d)if(P.isMriWithUserMetadata(d)&&R.default.isConversationAccepted(e.conversationId))Q.mriForUserPresence=d;else{const e=i.find(Q.allUserConversations,(e=>P.isMriWithUserMetadata(e.id)&&R.default.isConversationAccepted(e.id)));e&&(Q.mriForUserPresence=e.id)}this._activityIndicatorOffset=Q.useMobileUI?-25:-22,n&&n.isThread()&&w.default.prioritizeConversation(n.id,!1,!0);const $=S.default.ActiveCallUIHelper.getActiveCallId(e.conversationId);Q.callId=$,Q.showTwinCam=!!$&&(C.twinCamEnabled&&S.default.CallingStore.getConnectedEndpoints($).length>0),Q.hasActiveCall=S.default.ActiveCallUIHelper.hasActiveCall(e.conversationId),Q.allowOutboundVideo=S.default.CallingFeaturesHelper.allowOutboundVideo({isPSTNCall:S.default.CallingStore.isPSTNCallWithNullCheck(Q.callId,e.conversationId),isEncryptedCall:b,conversationMri:e.conversationId}),Q.activeCallStatus=S.default.ActiveCallUIHelper.activeCallStatus(e.conversationId),Q.activeCallDuration=Q.enableEndCallInRecents?this._getCallDuration(Q.callId):void 0;const J=t||e.conversationId!==p.conversationId,Y=!i.isEmpty(h);if(J&&(Q.isHovering=!1),Q.conversationLastMessage?(t||Q.conversationLastMessage!==this.state.conversationLastMessage)&&(this._cachedLastMessageLabel=this._getLastMessageAccessibilityLabel(Q.conversationLastMessage)):this._cachedLastMessageLabel="",Q.allUserConversations){const e=z.ConversationUtils.getConversationForGivenType(Q.allUserConversations,H.ConversationUIType.Private);Q.isPrivateConversationHandshakeCompleted=!!e&&Z.default.getHandshakeState(e.id)===ee.SecureHandshakeState.Completed}if(Q.showTypingState=!e.isSelected&&!Q.isMuted&&Y&&(!Q.isEncrypted||Z.default.getHandshakeState(e.conversationId)===ee.SecureHandshakeState.Completed),n&&e.conversationId===p.conversationId&&this.state&&Q.unreadCount&&Q.unreadCount>this.state.unreadCount&&E.default.setPreviousConsumptionHorizon(e.conversationId,n.getConsumptionHorizon()),Q.mriForUserPresence){Q.statusTypes=$e.contactAllowedStatuses();let t=Qe.default.getUserStatusWithOptions(Q.mriForUserPresence,Q.statusTypes);t&&(t=$e.maskedUserStatus(t)),Q.userPresence=i.clone(Qe.default.getCachedUserPresence(Q.mriForUserPresence)),Q.userStatus=e.rowSize===Fe.RowSize.ExtraCompact?t:void 0}else Q.statusTypes=void 0,Q.userStatus=void 0;return Q.shouldRenderJoinButtonForActiveCall=Q.enableJoinerCallPreview&&Q.hasActiveCall&&Q.activeCallStatus!==_.ActiveCallStatus.Connected&&!(Q.callId&&S.default.CallingStore.isCallIncoming(Q.callId)),Q}componentWillUnmount(){super.componentWillUnmount(),this._onMarkConversationUnreadToken&&this._onMarkConversationUnreadToken.unsubscribe()}componentDidMount(){super.componentDidMount();const e=this._isTyping(this.props,this.state),t=this._indicatorInfo(e,this.state.hasActiveCall);this._cardContentAndDividerTransformValue.setValue(t.offset),this._cardContentOpacityValue.setValue(t.contentOpacity),this._onMarkConversationUnreadToken=E.default.markConversationUnreadCallback(this.props.conversationId,this._onMarkConversationUnread)}_shouldComponentUpdate(e,t,s,i,o,n){return e?this.state.showTypingState!==s.showTypingState||this.state.hasActiveCall!==s.hasActiveCall||this.state.unreadCount!==s.unreadCount||this.state.conversationLastMessage!==s.conversationLastMessage:super._shouldComponentUpdate(e,t,s,i,o,n)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this._pauseWhenNotVisible()||this._intComponentDidUpdate(e,t)}_componentDidUpdate(e,t,s){super._componentDidUpdate(e,t,s),this._intComponentDidUpdate(e,t)}_getCallDuration(e){return e?S.default.CallDurationStore.getCallDurationInSeconds(e):0}_intComponentDidUpdate(e,t){const s=this._isTyping(this.props,this.state),i=this._isTyping(e,t),o=this._indicatorInfo(s,this.state.hasActiveCall);this._cardContentAndDividerTransformValue.setValue(o.offset),s===i&&this.state.hasActiveCall===t.hasActiveCall||(this._cardContentAndDividerAnimation&&this._cardContentAndDividerAnimation.stop(),this._cardContentAndDividerAnimation=n.Animated.parallel([n.Animated.timing(this._cardContentAndDividerTransformValue,{toValue:o.offset,duration:150,easing:n.Animated.Easing.Out()}),n.Animated.timing(this._cardContentOpacityValue,{toValue:o.contentOpacity,duration:200,delay:o.contentOpacity?100:0,easing:n.Animated.Easing.Out()})]),this._cardContentAndDividerAnimation.start())}_indicatorInfo(e,t){return e&&!t?{offset:this._activityIndicatorOffset,contentOpacity:0}:t&&!this._useCompactLayout()&&this._isPresentedInDesktopLeftNav()?{offset:-8,contentOpacity:0}:{offset:0,contentOpacity:1}}_renderDivider(e){if(this.state.modernizeMobileTab||this._isPresentedInDesktopLeftNav()||this.state.modernizeConversationList&&this._isPresentedInTabletLeftNav())return;const t=this._useCompactLayout(),s=[nt.itemDivider],i=[nt.itemDividerInner];return this.state.useMobileUI?s.push(t?nt.itemDividerCompact:nt.itemDividerSmall):(t?s.push(nt.compositeNav.itemDividerCompact):s.push(nt.compositeNav.itemDivider),(this.state.hasActiveCall||e&&t)&&(this.state.shouldRenderJoinButtonForActiveCall?i.push(nt.itemDividerInnerCompositveNavShort):i.push(nt.itemDividerInnerCompositveNav))),n.createElement(n.View,{style:[s,nt.staticDivider,this._themeStyles.dividerColorStyle]})}_renderMobileBackgroundView(){if(!this.state.isUsingStackNav&&(this.state.isHovering||this.props.isSelected)){const e=[ze.default.absoluteFill],t=this._isPresentedInDesktopLeftNav();return this.state.modernizeConversationList&&(t||this._isPresentedInTabletLeftNav())||(e.push(this._backgroundColorStyles()),e.push(nt.reducedHighlight)),n.createElement(n.View,{style:e,ignorePointerEvents:!0})}}_backgroundColorStyles(){if(!this.state.isUsingStackNav&&(this.state.isHovering||this.props.isSelected||this.state.modernizeConversationList)){const e=this._isPresentedInDesktopLeftNav();let t=[];return this.state.modernizeConversationList&&(e||this._isPresentedInTabletLeftNav())?t.push(pe.default.getItemBackgroundStyle(this._useDarkTheme(),this.props.isSelected,this.state.isHovering,this._useAccessibleTheme(),this._themeStyles,this.state.colorInfo)):this.props.isSelected?t.push(e?this._themeStyles.secondaryRowHighlightViewStyle:this._themeStyles.rowHighlightViewStyle):this.state.isHovering&&t.push(e?this._themeStyles.secondaryRowHoverViewStyle:this._themeStyles.rowHoverViewStyle),t}}_renderCallButtons(){return this.state.shouldRenderJoinButtonForActiveCall?this._renderJoinCallControls():this.state.activeCallStatus===_.ActiveCallStatus.Connected?this.state.enableEndCallInRecents?this._renderEndCallControls():void 0:this._renderAcceptCallControls()}requestFocus(){this._container&&this._container.requestFocus()}_renderJoinCallControls(){const e={backgroundColor:Ne.Color.green,textColor:Ne.Color.white};return n.createElement(Ve.default,{buttonSize:k.SXButtonSize.Small,buttonStyle:k.SXButtonStyle.Custom,style:this.state.modernizeConversationList?nt.joinButtonStyleModernize:nt.joinButtonStyle,title:ue.getString("CallBanner.JoinLiveCallMessage"),onPress:this._onJoinCallButtonPress,disabled:this._isJoinCallButtonDisabled(),buttonConfig:e})}_renderEndCallControls(){return n.createElement(n.View,{style:[nt.callButtonsContainer,this.state.modernizeConversationList?nt.endCallControlsModernize:nt.endCallControls]},n.createElement(g.CallButton,{title:ue.getString("CallControls.CallButtonEndCall"),accessibilityLabel:ue.getString("CallControls.CallButtonEndCall"),onPress:this._onEndCallButtonPress,icon:He.SkypeIcon.CallEnd,size:g.CallButtonSize.ExtraSmall,isToggledOn:!1,isCallEndButton:!0,backgroundStyle:g.CallButtonBackgroundStyle.Solid,spacing:g.CallButtonSpacing.None}))}_renderAcceptCallControls(){const e=this._useCompactLayout()&&this.state.hasActiveCall,t=e&&!this.state.useMobileUI||this._isPresentedInDesktopLeftNav(),s=this._themeColors.iconHoverColor,i=this._themeColors.primaryIconColor,o=t?He.IconSize.size16:He.IconSize.size24,r=e||t?nt.optionalAccessoryButton:nt.optionalButton,a=this.state.activeCallStatus===_.ActiveCallStatus.OnHold,l=a?ue.getString("OngoingCall.OngoingCallOnHoldTitle"):ue.getString("CallControls.CallButtonAudioLabel",{conversationName:this.state.conversationDisplayName}),d=n.createElement(ne.default,{ref:this._onConversationAudioButtonRef,size:o,onPress:this._onCallButtonPress,color:i,hoverColor:s,icon:this._getAcceptCallAudioButtonIcon(a),style:r,title:l,accessibilityLabel:l});if(this.state.allowOutboundVideo){const e=ue.getString("CallControls.CallButtonVideoLabel",{conversationName:this.state.conversationDisplayName}),t=n.createElement(ne.default,{size:o,onPress:this._onVideoCallButtonPress,color:i,hoverColor:s,icon:He.SkypeIcon.Video,style:r,title:e,accessibilityLabel:e});return n.createElement(n.View,{style:nt.callButtonsContainer},t,d)}return d}_getAcceptCallAudioButtonIcon(e){return e?He.SkypeIcon.Pause:this.state.isEncrypted?He.SkypeIcon.PrivateCallFill:He.SkypeIcon.CallStart}_getMessageContentOptions(e,t){return{processing:te.ProcessingDefaults.Preview,renderMedia:!1,mediaPlaceholderIconColor:t,allowLargeEmoticons:!1,trimToFirstLine:!0,forceLayoutInRTL:!0,numberOfLines:1,textOverrideStyle:e,renderLocation:!0,forceStaticAnimatedEmoticons:!0,fontSize:this._themeColors.bubbleFontSize,allowTextFallbackEmoticons:!0,showPlaceholderEmoticons:!1,placeholderBackgroundColor:Ne.Color.transparent,atMentionStyle:e,atMentionMeOverrideStyle:e,renderSimpleAtMentions:!0}}render(){const e=this._useCompactLayout(),t=this._isTyping(this.props,this.state),s=this.state.displayedUnreadCount>0;let r,a;this._useCompactLayout()||(r=this._getOptionalLastMessageContent(t),this.state.hasActiveCall&&(a=this._renderCallButtons()));const l=this.state.iOSAccessibilityActionEnabled?i.map(this._getMoreMenuItems().items,(e=>({name:e.text}))):void 0,d=N.default.getAccessibilityLabel({conversationDisplayName:this.state.conversationDisplayName,isOneOnOne:this.state.isOneOnOne,presence:this.state.userPresence,isRecipientBlocked:this.state.isRecipientBlocked,isFavorite:this.state.isFavorite,lastMessageLabel:this._cachedLastMessageLabel,lastMessageTime:this._getLastMessageTime(!0),hasActiveCall:this.state.hasActiveCall,activeCallStatus:this.state.activeCallStatus,isTyping:t,isMuted:this.state.isMuted,displayedUnreadCount:this.state.displayedUnreadCount,addAccessibilityHint:this.state.addAccessibilityHint,isSelected:this.props.isSelected,isAgent:P.isAgent(this.props.conversationId),moodAccessibilityLabel:this.state.moodAccessibilityLabel}),c=this._onHandleContextMenu;let h,u=[nt.listItemBase,this.state.modernizeConversationList?nt.listItemBaseHorizontalPaddingModernize:this.state.modernizeMobileTab?nt.listItemBaseHorizontalPaddingModernizeMobile:nt.listItemBaseHorizontalPaddingClassic];this.state.useMobileUI?h=this._renderMobileBackgroundView():(u.push(e?nt.compositeNav.listItemBaseCompact:nt.compositeNav.listItemBase,this.state.modernizeConversationList?e?nt.compositeNav.listItemBaseCompactHorizontalPaddingModernize:nt.compositeNav.listItemBaseHorizontalPaddingModernize:e?nt.compositeNav.listItemBaseCompactHorizontalPaddingClassic:nt.compositeNav.listItemBaseHorizontalPaddingClassic,ze.default.pointerCursor),u.push(this._backgroundColorStyles())),this.state.useMobileUI&&(this.state.modernizeConversationList&&u.push(this._backgroundColorStyles()),u.push(e?nt.listItemCompact:this.state.modernizeMobileTab?nt.modernizedListItemSmall:nt.listItemSmall));const p=this._getItemHeightStyle();p&&u.push(p);const g=this._isDraggable(),m=N.default.rowDecorator({conversationId:this.props.conversationId,useExtraCompactLayout:this.props.rowSize===Fe.RowSize.ExtraCompact,userStatus:this.state.userStatus,hasActiveCall:this.state.hasActiveCall,isEncrypted:this.state.isEncrypted,isOneOnOne:this.state.isOneOnOne,isTranslated:this.state.isTranslated,isTeamsUser:this.state.isTeamsUser});let S;switch(m.type){case N.RowDecoratorType.Avatar:S=this._renderIcon();break;case N.RowDecoratorType.Icon:S=this._renderCompactDecoratorIcon(m.icon);break;case N.RowDecoratorType.Status:S=i.isUndefined(this.state.userStatus)?this._renderCompactDecoratorSpacer():qe.default.getPresenceIcon(this.state.userStatus,this.state.modernizeMobileTab?nt.modernizeUserPresenceIndicator:nt.userPresenceIndicator,st,void 0,void 0);break;default:case N.RowDecoratorType.None:S=this._renderCompactDecoratorSpacer()}const f=n.createElement(ge.default.View,{style:u,accessibilityTraits:[n.Types.AccessibilityTrait.Button,n.Types.AccessibilityTrait.MenuItem],accessibilityLabel:d,onMouseEnter:this._onHoverStart,onMouseLeave:this._onHoverEnd,onPress:this._onPress,onLongPress:c,onContextMenu:c,activeOpacity:.7,importantForAccessibility:n.Types.ImportantForAccessibility.Yes},h,S,this._renderConversationCard(r,s),this._renderInfoSection(),a,this._renderDivider(t));let y;if((this.state.enableDragDropFromDesktopToRecentLists||this.state.enableDragDropFromConversationToRecentLists)&&v.UICapabilities.dragAndDropSupported()&&this._allowsUpload())y=n.createElement($.default,{ref:this._containerRefCallback,style:nt.listItemWrapper,origin:me.FilePickerOrigin.DragAndDropToRecentConversationsLists,conversationId:this.props.conversationId,onDragEnter:this._onHoverStart,onDragLeave:this._onHoverEnd,onDropStarted:this._onDropStarted,dropTargetSource:Y.DropTargetOrigin.ConversationListItem},g?n.createElement(o.DragDroppableView,{style:nt.listItemWrapper,useChildrenThumbnail:!0,useThumbnailExplicitMaxWidth:!0,onDragStart:this._onDragStartContact},f):f);else{const e={accessibilityActions:l,onAccessibilityAction:l?this._onAccessibilityAction:void 0};if(this.props.enableSwipeActions){const t=N.default.getSwipeActions(this.state.isArchived,this.state.hasActiveCall,this.state.displayedUnreadCount>0,this.state.isMuted),s=i.map(t.rightActions,this._conversationSwipeActionForCommand),o=t.leftActions?i.map(t.leftActions,this._conversationSwipeActionForCommand):void 0,r=[];t.overScrollRight&&r.push(De.SwipableItemActionSide.Right),t.overScrollLeft&&r.push(De.SwipableItemActionSide.Left),y=n.createElement(De.default,Object.assign({ref:this._containerRefCallback,itemId:this.props.conversationId,style:nt.listItemWrapper,layoutType:De.SwipeActionLayout.Reveal,rightActions:i.compact(s),leftActions:i.compact(o),overscrollSides:r,onSwiping:this.props.onSwiping,dragThreshold:30,swipeDistanceThreshold:t.overScrollDistance,backgroundStyle:nt.swipeActionsBackground,numberOfLines:2},e),f)}else y=n.createElement(n.View,Object.assign({ref:this._containerRefCallback,style:nt.listItemWrapper},e),f)}return y}_getOptionalLastMessageContent(e){let t;const s=this._themeColors.secondaryTextColor,i=[nt.lastMessageContainer];i.push(nt.lastMessageContainerWeb);const o=[Ue.default.fontStyle.body,nt.lastMessageText,this._useDarkTheme()?this._themeStyles.secondaryTextColorStyle:this._themeStyles.primaryTextColorStyle];if(this.state.useMobileUI||o.push([nt.compositeNav.lastMessageText,this._themeStyles.secondaryTextColorStyle]),this.state.modernizeConversationList&&o.push(pe.default.getItemSubtitleTextStyle(this._useDarkTheme(),this.props.isSelected,this._useAccessibleTheme(),this._themeStyles)),this.state.modernizeMobileTab&&o.push(pe.default.getItemSubtitleTextStyle(this._useDarkTheme(),this.props.isSelected,this._useAccessibleTheme(),this._themeStyles,!0)),this.state.hasActiveCall){let e;this._isPresentedInDesktopLeftNav()||this.state.activeCallStatus===_.ActiveCallStatus.OnHold&&(e=ue.getString("CallPanel.OnHoldHeader")),this.state.enableEndCallInRecents&&this.state.activeCallStatus===_.ActiveCallStatus.Connected&&this.state.activeCallDuration>0&&(e=G.default.getElapsedTimeStringFromS(this.state.activeCallDuration)),e&&(t=n.createElement(n.View,{style:i},n.createElement(n.Text,{style:o,numberOfLines:1},e)))}else if(e){i.push(nt.typingIndicatorContainer);const e=this._renderNewTypingIndicator(nt.indicatorImage,[nt.inlineIndicatorImage,nt.indicatorImage]);t=n.createElement(n.View,{style:i},n.createElement(n.Text,{style:o,numberOfLines:1},""),e)}else if(this._canDisplayDraft()&&this.state.fakeDraftMessage){const e=this.state.isEncrypted?n.createElement(n.Text,{style:o,numberOfLines:1},ue.getString("MessageComposer.DraftDecorator")+" "+(a.default.getS4LMessagingFeaturesNoSubscription().enableGroupedConversations?ue.getString("ConversationsListItem.PrivateMessage"):ue.getString("ConversationsListItem.PrivateConversationLabel"))):n.createElement(ve.default,{message:this.state.fakeDraftMessage,options:this._getMessageContentOptions(o,s)});t=n.createElement(n.View,{style:i},e)}else if(this.state.isEncrypted&&!this.state.isLastMessageCallEvent)t=n.createElement(n.View,{style:i},n.createElement(n.Text,{style:o,numberOfLines:1},a.default.getS4LMessagingFeaturesNoSubscription().enableGroupedConversations?ue.getString("ConversationsListItem.PrivateMessage"):ue.getString("ConversationsListItem.PrivateConversationLabel")));else if(this.state.conversationLastMessage){let e;if(this.state.isLastMessageFromAlbum)return n.createElement(n.View,{style:i},n.createElement(n.Text,{style:o,numberOfLines:1},ue.getString("ConversationsListItem.MediaAlbumItems")));this.state.conversationLastMessage.isSendRejected()&&(e=n.createElement(n.View,{style:nt.errorSymbolContainer},n.createElement(re.default,{icon:He.SkypeIcon.Error,size:tt,color:this._themeColors.destructiveTextColor,style:nt.errorSymbol}))),t=n.createElement(n.View,{style:i},e,n.createElement(ve.default,{message:this.state.conversationLastMessage,options:this._getMessageContentOptions(o,s)}))}return t}_renderCompactDecoratorSpacer(){return n.createElement(n.View,{style:this.state.modernizeMobileTab?nt.modernizeUserPresenceIndicator:nt.userPresenceIndicator})}_renderCompactDecoratorIcon(e){if(e)return n.createElement(re.default,{icon:e,size:this.state.modernizeMobileTab?ot:it,color:this._useDarkTheme()?this._themeColors.secondaryTextColor:this._themeColors.primaryIconColor})}_triggerFileUpload(e){const t=this._container;t&&t.onDragDropContinue(e)}_allowsUpload(){if(this.state.allUserConversations&&this.state.allUserConversations.length>0){const e=z.ConversationUtils.getConversationForGivenType(this.state.allUserConversations,H.ConversationUIType.OneOnOneSkype),t=z.ConversationUtils.getConversationForGivenType(this.state.allUserConversations,H.ConversationUIType.Private);if(!e&&!t)return!1;if(t&&!e)return!1}return!0}_renderIcon(){var e;let t;const s=this._isPresentedInDesktopLeftNav(),i=qe.default.getIconSize(this.props.conversationIconSize),o=!this.state.isUsingStackNav&&this.props.isSelected,r=!o||s&&!this._useDarkTheme()?void 0:this._themeColors.primaryBackgroundColor,a=P.getHoverTitle(this.state.userPresence);let l;if(l=s?o?this._themeColors.secondaryRowHighlightColor:this._themeColors.secondaryBackgroundColor:o?this._themeColors.rowHighlightColor:this._themeColors.primaryBackgroundColor,this.state.isOneOnOne)t=n.createElement(Ke.UserIcon,{userMri:this.state.otherPartyMri,size:i.user,title:a,backgroundColor:r,statusTypes:this.state.statusTypes,statusBorderColor:l,importantForAccessibility:n.Types.ImportantForAccessibility.NoHideDescendants});else{let s,o;this.state.conversationLastMessage&&(s=M.isThreadActivityType(this.state.conversationLastMessage.messagetype)?Ce.getMessageInitiator(this.state.conversationLastMessage):null===(e=this.state.conversationLastMessage)||void 0===e?void 0:e.creator,o=!this._useCompactLayout()&&this.state.lastMessageAuthorAvatarSwitchedOn&&!M.isEventCallEndedMessageType(this.state.conversationLastMessage)),t=n.createElement(B.ConversationIcon,{conversationId:this.props.conversationId,altName:this.state.conversationDisplayName,size:i.conversation,backgroundColor:r,statusBorderColor:l,lastMessageAuthorMri:s,showLastMessageAuthor:o,importantForAccessibility:n.Types.ImportantForAccessibility.NoHideDescendants})}return t}_renderConversationCard(e,t){const s=[nt.cardContentBase];let i;if(this.state.useMobileUI&&!this._useCompactLayout()?s.push(nt.cardContentSmall):s.push(nt.cardContentCompact),t||this.props.isSelected||this.state.useMobileUI||!this._useDarkTheme()||s.push(nt.compositeNav.darkThemeRead),e){const t=this.state.isLastMessageCallEvent?void 0:this._renderOptionalMessageTypeIcon();i=n.createElement(n.Animated.View,{style:nt.cardContent},t,e)}const o=[nt.displayNameBase,nt.displayName],r=this._getDisplayNameStyle();let a;this._useCompactLayout()&&this._canDisplayDraft()&&(a=n.createElement(n.Text,{style:[r,this._themeStyles.secondaryTextColorStyle,ze.default.flexZero],numberOfLines:1},ue.getString("MessageComposer.DraftDecorator")+" "));const l=this.state.mood&&this.state.moodEmoticonType?n.createElement(Ie.default,{mood:this.state.mood,moodEmoticonType:this.state.moodEmoticonType,moodEmoticonTone:this.state.moodEmoticonTone}):void 0,d=this.state.isTrustedAgent?this._getOptionalCertifiedIcon():void 0;return n.createElement(n.View,{style:s},n.createElement(n.View,{style:o},a,n.createElement(n.Text,{style:r,numberOfLines:1},this.state.conversationDisplayName),l,d),i)}_canDisplayDraft(){return this.state.draft&&!this.state.unreadCount||this.state.enableMediaPreviewDrafts&&this.state.mediaDraft&&!this.state.unreadCount}_optionalMessageTypeIcon(){return N.default.optionalMessageTypeIcon(this.props.rowSize===Fe.RowSize.ExtraCompact,this.state.isEncrypted,this.state.isTranslated,this.props.conversationId,this.state.isLastMessageFromAlbum)}_renderOptionalMessageTypeIcon(){if(this.props.rowSize===Fe.RowSize.ExtraCompact)return;const e=this._optionalMessageTypeIcon();return e?this._getMessageTypeIcon(e):void 0}_getOptionalCertifiedIcon(){return n.createElement(h.default,{botMri:this.props.conversationId,style:undefined})}_getMessageTypeIcon(e){let t=this._useDarkTheme()?this._themeColors.secondaryTextColor:this._themeColors.primaryTextColor;return this.state.useMobileUI||(t=this._themeColors.secondaryTextColor),n.createElement(re.default,{icon:e,size:He.IconSize.size15,color:t,style:nt.lastMessageAccessoryIcon})}_renderNewTypingIndicator(e,t){const s=[e];let i;!this.state.isUsingStackNav&&t&&s.push(t),i=this._useAccessibleTheme()?this._useDarkTheme()?r.Collection.TYPING_INDICATOR_NEXT_HIGHCONTRAST_DARK:r.Collection.TYPING_INDICATOR_NEXT_HIGHCONTRAST_LIGHT:this._useDarkTheme()?r.Collection.TYPING_INDICATOR_NEXT_DARK:r.Collection.TYPING_INDICATOR_NEXT_LIGHT;const o=n.createElement(n.Image,{key:"typing",style:s,source:i,resizeMode:"contain"});return this.state.isUsingStackNav?n.createElement(Ye.default,{key:"typing",style:t},o):o}_renderInfoSection(){const e=this._useCompactLayout(),t=this._isTyping(this.props,this.state),s=[nt.lastMessageTimeText];this.state.isUsingStackNav||s.push(nt.compositeNav.lastMessageTimeText);const i=e&&t?this._renderNewTypingIndicator(nt.indicatorImage,s):void 0;let o,r;this.state.hasActiveCall||i||(o=n.createElement(je.Caption,{style:s,numberOfLines:1,selected:this.state.modernizeConversationList&&this.props.isSelected,modernizeConversationList:this.state.modernizeConversationList},this._getLastMessageTime())),e?r=[nt.compositeNav.infoSectionCompact]:(r=[nt.infoSection],this.state.useMobileUI||r.push(this._isPresentedInDesktopLeftNav()?nt.compositeNav.infoSectionLeftNav:nt.compositeNav.infoSectionExtraPadding));const a=this._renderAccessoryView();return o||i||a?n.createElement(n.View,{style:r},i,o,a):void 0}_renderAccessoryView(){let e;const t=this._useCompactLayout();if(!this.state.hasActiveCall||t){if(t&&this.state.hasActiveCall)e=this._renderCallButtons();else if(this.state.isMuted)e=n.createElement(re.default,Object.assign({icon:He.SkypeIcon.NotificationOff},this._accessoryStyleInfo()));else if(this.state.displayedUnreadCount){const s=this.state.displayedUnreadCount;let i=s.toString();s&&this.state.unreadCountOverflowed&&(i=ue.getString("Global.CountOverflow",{count:i}));const o=this.state.isOneOnOne||!!this.state.highPriorityUnreadCount,r=this.state.useMobileUI&&t?p.BadgeSize.Desktop:p.BadgeSize.Default;e=n.createElement(p.default,{style:nt.badgeView,count:i,rawCount:s,colorStyle:this.state.badgeColorStyle,isHighPriority:o,badgeSize:r})}e&&t&&(e=n.createElement(n.View,{style:nt.compositeNav.accessoryViewCompact},e))}return e}_accessoryStyleInfo(){const e=[nt.accessoryIcon];return this._useCompactLayout()?e.push(nt.accessoryIconMobileCompact):this.state.useMobileUI?e.push(nt.accessoryIconMobile):e.push(nt.compositeNav.accessoryIcon),{style:e,size:this.state.useMobileUI?He.IconSize.size16:He.IconSize.size14,color:this._themeColors.secondaryTextColor}}_getItemHeightStyle(){if(!this.props.itemHeight)return;let e=rt._heightStyleCache[this.props.itemHeight];return e||(e=n.Styles.createViewStyle({height:this.props.itemHeight}),rt._heightStyleCache[this.props.itemHeight]=e),e}_isTyping(e,t){return t.showTypingState&&!t.hasActiveCall&&!t.isEncrypted}_getDisplayNameStyle(){const e=[nt.linkText,this._themeStyles.primaryTextColorStyle];return this.state.useMobileUI?(this._useCompactLayout()&&e.push(Ue.default.fontStyle.body),(this.props.isSelected||this.state.displayedUnreadCount)&&e.push(nt.linkTextUnreadSelected)):(e.push(nt.compositeNav.linkText,nt.compositeNav.inlineText),this.props.rowSize===Fe.RowSize.ExtraCompact&&e.push(nt.compositeNav.linkTextExtraCompact),this.state.displayedUnreadCount&&e.push(nt.linkTextUnreadSelected)),this.state.modernizeConversationList&&e.push(pe.default.getItemTitleTextStyle(this.props.isSelected,this.state.displayedUnreadCount>0,this._themeStyles)),this.state.modernizeMobileTab&&e.push(pe.default.getItemTitleTextStyle(this.props.isSelected,this.state.displayedUnreadCount>0,this._themeStyles,!0)),e}_getLastMessageTime(e=!1){return this.state.conversationTimestamp?G.default.getDisplayDateTimeMixedString(this.state.conversationTimestamp,e):""}_intOnUnarchiveConversation(e){le.log(se.LogTraceArea.ConversationsListItem,"ConversationsListItem._intOnUnarchiveConversation, causeId: "+e),this._unarchiveConversation(),this.props.isSelected&&!this.state.isUsingStackNav&&Ee.default.navigateAfterUnarchivingConversation(this.state.otherPartyMri||this.props.conversationId,e,this._getContext())}_getMoreMenuItems(){return N.default.getMenuItems(Object.assign({},this._getMenuItems()))}_getMenuItems(){return{conversationId:this.props.conversationId,conversationShortDisplayName:this.state.conversationShortDisplayName,isFavorite:this.state.isFavorite,isOneOnOne:this.state.isOneOnOne,isMriAnAgent:this.state.isMriAnAgent,isMriAContact:this.state.isMriAContact,isRecipientBlocked:this.state.isRecipientBlocked,isCallingAllowed:this.state.isCallingAllowed,hasActiveCall:this.state.hasActiveCall,displayedUnreadCount:this.state.displayedUnreadCount,displayBlockButton:this.state.displayBlockButton,isArchived:this.state.isArchived,isEngagementBot:this.state.isEngagementBot,isJoinEnabled:this.state.isJoinEnabled}}_trackMeetNowClick(e){le.track(new ye.MeetNowClickEvent(void 0,{origin:_e.MeetNowOrigin.ConversationListContextMenu},e))}_sendConfiramtionToast(e){const t={duration:5e3,textMessage:e,key:"copied_link_copied",rootViewId:this._getRootViewId(),accessibilityLabel:e};Me.default.scheduleMessage(t)}_getLastMessageAccessibilityLabel(e){const t=q.decode(e);return L.toAccessibilityLabel(t,{message:e,includeSenderInformationInAccessibilityLabel:!1,includeReactionInformationInAccessibilityLabel:!1})}_handleLeaveConversation(){const e=Je.default.newCauseId();le.log(se.LogTraceArea.ConversationsListItem,"_handleLeaveConversation, causeId: "+e);const t=this._getRootViewId();(0,Ze.default)(this.props.conversationId,(()=>{this.state.isUsingStackNav||Le.default.getActiveConversationId(t)!==this.props.conversationId||Ee.default.navigateToDesktopRecents(e)}),t,I.RemoveMemberFromThreadSource.ConversationListItem)}_isJoinCallButtonDisabled(){return!this.state.alwaysNavigateToLobby&&!this.state.isCallingAllowed}_startCall(e,t){le.log(se.LogTraceArea.ConversationsListItem,"_startCall, causeId: "+t),this.state.isOneOnOne||this.state.showTwinCam||fe.default.beginTrackingJoinMeetNow(_e.MeetNowOrigin.ConversationsListPanel),y.default.startCallOrMaybePrompt((()=>this._conversationAudioButtonRef||(this.isComponentMounted()?this:void 0)),this._getRootViewId(),{skypeMri:this.props.conversationId,userIntent:e,showSmsOption:!1,callOrigin:se.NavigationCallOrigin.ConversationListItem,inviteOrigin:se.ContactInviteOrigin.Unknown,showCallPreview:this.state.enableJoinerCallPreview},t)}_useCompactLayout(){return this.props.rowSize===Fe.RowSize.Compact||this.props.rowSize===Fe.RowSize.ExtraCompact}_pauseWhenNotVisible(){return this.state.isUsingStackNav}_shouldDisplayLastMessage(e){return!(e.getTimestamp()<14926392e5||e.isThread()&&e.isDeleted())}_shouldDisplayBlockOption(e){return!(e.lastMessage&&!M.isCallOrSmsMessageType(e.lastMessage)&&Ae.default.isMyMri(e.lastMessage.creator))}_isDraggable(){return Y.default.isDragAndDropContactsEnabled()&&this.state.isOneOnOne&&!P.isAgent(this.props.conversationId)}click(e){this._completeOnPress(e)}_getConversationTimestamp(e,t){if(!e)return;const s=Math.max(V.default.getDraftTimestampForConversation(e.id)||0,t&&Se.default.getDraftPreviewTimestamp(e.id)||0,(0,U.default)().getFakeTimestamp(e.id)||0,e.getTimestamp()||0);return s||void 0}}t.ConversationsListItem=rt,rt._heightStyleCache={},t.default=rt},28805:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(34828),n=s(16778),r=s(44770),a=s(77340),l=(s(60),s(89391)),d=s(80128),c=s(98278),h=s(63060),u=s(75760),p=s(31751),g=s(75861),m=s(62813),S=s(45083),f=s(96539),y=s(54464),_=s(48734),v=s(92758),C=s(39549),b=s(30010),T=s(24631),M=s(72822),I=s(56280),w=(s(10167),s(35251)),P=s(89029),k=s(46096),A=s(60088),E=s(11375),R=s(13944),L=s(10117),F=s(36237),x=s(10400),O=s(72490),D=s(15877),B=s(33754),V=s(66127),N=s(34537),U=s(6250),H=s(93486),z=s(78735),W=s(4735),j=s(30124),G=s(46068),K=s(53154),q=s(94021),Q=s(28377),X=s(82052),$=s(93003),J=s(29130),Y=s(81115),Z=s(36150),ee=s(4101),te=s(99948),se=s(22222),ie=s(81760),oe=s(11010),ne=s(11828),re=s(80837),ae=s(60305),le=s(19675),de=s(24576),ce=s(67977),he=s(53374),ue=s(61239),pe=s(30583),ge=(0,D.lazyProperties)({panel:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch",backgroundColor:ie.Color.transparent}),filterButtonContainer:()=>n.Styles.createViewStyle({position:"absolute",right:0,top:0,bottom:0,width:44,alignItems:"center",justifyContent:"center"}),filterButtonContainerModernized:()=>n.Styles.createViewStyle({position:"absolute",right:0,top:0,bottom:0,width:32,marginRight:16,alignItems:"center",justifyContent:"center",borderRadius:10,marginVertical:4}),icon:()=>n.Styles.createViewStyle({flexDirection:"row",justifyContent:"center",alignItems:"center",width:ne.IconSize.default,height:ne.IconSize.default}),iconModernized:()=>n.Styles.createViewStyle({flexDirection:"row",justifyContent:"center",alignItems:"center",width:ne.IconSize.size32}),emptyStateContainer:()=>n.Styles.createViewStyle({flex:1,paddingVertical:10,paddingHorizontal:10,justifyContent:"center",alignItems:"stretch"}),emptyStateContainerItemsAtTop:()=>n.Styles.createViewStyle({justifyContent:"flex-start"}),emptyStateContainerTopPadding:()=>n.Styles.createViewStyle({paddingTop:20}),emptyStateText:()=>n.Styles.createTextStyle({textAlign:"center"}),emptyStateTextSecondLine:()=>n.Styles.createTextStyle({paddingTop:5,textAlign:"center"}),emptyStateTextSecondLineV2:()=>n.Styles.createTextStyle({marginHorizontal:30}),emptyStateTextsContainer:()=>n.Styles.createViewStyle({alignItems:"flex-start",alignSelf:"center",marginHorizontal:35}),emptyStateTextWithIconContainer:()=>n.Styles.createViewStyle({marginTop:10,flexDirection:"row",alignItems:"flex-start",flex:1}),emptyStateTextWithIconContainerV2:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"flex-start",flex:1}),emptyStateTextWithIcon:()=>n.Styles.createTextStyle({textAlign:"left",flex:1}),emptyStateTextIcon:()=>n.Styles.createViewStyle({marginRight:10}),emptyStateTextIconV2:()=>n.Styles.createViewStyle({marginHorizontal:3}),emptyStateTextIconWrap:()=>n.Styles.createViewStyle({transform:[{translateY:3}]}),emptyStateImageV1:()=>n.Styles.createImageStyle({height:130,width:130,alignSelf:"center"}),emptyStateImageV2:()=>n.Styles.createImageStyle({width:280,height:176,marginBottom:20,alignSelf:"center"}),syncContactsButton:()=>n.Styles.createButtonStyle({alignSelf:"center",marginTop:20,marginHorizontal:40}),syncContactsButtonV2:()=>n.Styles.createButtonStyle({marginTop:40,width:180,borderRadius:30,paddingVertical:10}),syncContactsButtonV2Small:()=>n.Styles.createButtonStyle({marginTop:20}),textStyleOverride:()=>n.Styles.createTextStyle({fontWeight:c.FontWeight.bold,fontSize:oe.default.controlFontSize.button}),emptyStateSyncContactImage:()=>n.Styles.createImageStyle({height:152,width:200,marginBottom:20,alignSelf:"center"}),emptyStateSyncContactImageSmall:()=>n.Styles.createImageStyle({marginBottom:0}),learnMoreButton:()=>n.Styles.createTextStyle({fontSize:oe.default.controlFontSize.button})});class me extends de.default{constructor(){super(...arguments),this._currentScrollTop=0,this._currentSwipeScrollTop=0,this._shadowVisible=!1,this._conversationItemRefs=new U.default,this._shadowOpacityValue=new n.Animated.Value(0),this._shadowOpacityStyle=n.Styles.createAnimatedViewStyle({opacity:this._shadowOpacityValue}),this._debouncedClickOnConversationListItem=i.debounce((e=>{e.click(k.NavigationConversationOrigin.KeyboardShortcutRecents)}),50),this._onNavigateToPreviousConversation=()=>{if(this.state.currentConversationIndex>0){const e=i.findLast(this.state.itemList,(e=>!!e.isNavigable),this.state.currentConversationIndex-1);e&&this._clickOnConversation(e.key)}return!0},this._onNavigateToNextConversation=()=>{const e=i.find(this.state.itemList,(e=>!!e.isNavigable),this.state.currentConversationIndex+1);return e&&this._clickOnConversation(e.key),!0},this.handleFocusEvent=e=>{F.log(k.LogTraceArea.GenericUnsafe,"ConversationsListPanel.handleFocusEvent");const t=this.props.selectedConversationId&&(0,C.default)().isClearApplicableAndKeepInRecents(this.props.selectedConversationId);return!(e!==E.FocusEvent.Recent&&e!==E.FocusEvent.ConversationDeleted||t||!this.focusFirst())||!(e!==E.FocusEvent.CancelMobileSearch||!this._searchInputButton)&&(this._searchInputButton.focusButton(),!0)},this._renderAdBanner=e=>{if(!e)return null;const t=this.state.modernizeConversationList?N.default.getBannerBackgroundColorStyle(this._useDarkTheme(),this._useAccessibleTheme(),this._themeStyles):void 0;return n.createElement(S.default,{adsGuid:e.adsGuid,adGuid:e.adGuid,isLastItem:e.isLastItem,dimensions:e.dimensions,placementId:e.placementId,canHide:e.canHide,provider:e.provider,style:t})},this._onInitialRenderComplete=()=>{te.default.recentsRendered()},this._onLayoutVlvContainer=e=>{this.isComponentMounted()&&(this.state.listItemContainerHeight===e.height&&this.state.listItemContainerWidth===e.width||this.setState({listItemContainerHeight:e.height,listItemContainerScreenAvailableHeight:this._getItemContainerHeightDisregardingKeyboard(e.height,this.state),listItemContainerWidth:e.width}))},this._onLayoutEmptyState=e=>{this.isComponentMounted()&&this.setState({emptyStateHeight:e.height})},this._onScrollViewRef=e=>{this._scrollView=e||void 0},this._debouncedOnEndReached=i.debounce((()=>{F.log(k.LogTraceArea.ConversationsListItem,"ConversationsListPanel._debouncedOnEndReached LoadMoreConversations"),v.default.loadMoreConversations()}),200),this._onEndReached=()=>{F.log(k.LogTraceArea.ConversationsListItem,"ConversationsListPanel._onEndReached"),this._debouncedOnEndReached()},this._onScroll=(e,t)=>{if(this.props.onScroll&&this.props.onScroll(e,this._currentScrollTop),!this.state.isUsingStackNavigationContext){const t=e>0;this._shadowVisible!==t&&(this._shadowOpacityValue.setValue(t?.5:0),this._shadowVisible=t)}(e>this._currentSwipeScrollTop+40||e<this._currentSwipeScrollTop-40)&&this._closeCurrentSwipeView(),this._currentScrollTop=e},this._closeCurrentSwipeView=()=>{if(this._currentSwipableItemRef){const e=this._currentSwipableItemRef.ref();e&&e.close()&&(this._currentSwipableItemRef=void 0)}},this._onPressLearnMore=()=>{F.track(new q.ClickedLearnMoreOnEmptyStateCta),ue.default.showDialog({isSmallDevice:this.state.deviceSize===J.DeviceSize.Small,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,onCancel:()=>{}},this._getRootViewId())},this._shouldRenderEmptyStateImage=e=>!0,this._renderItem=(e,t)=>{if(e.key===f.ConversationListItemNames.searchBar){const t=e;let s;t.safeAreaHorizontalInsets&&Y.default.hasHorizontalSafeAreas(t.safeAreaHorizontalInsets)&&(s=Y.default.horizontalPaddingStyle(t.safeAreaHorizontalInsets));const i=n.createElement(ee.default,{key:"search",ref:this._onSearchInputButtonRef,buttonOnly:!0,horizontalButtonPadding:t.showFilterIcon?this.state.modernizeMobileTabHeader?48:44:0,placeholderText:this.state.modernizeMobileTabHeader?B.getString("SearchInputControl.PlaceHolderTextShort"):B.getString("ConversationsListPanel.SearchPeopleGroupsMessagesButtonTitle"),accessibilityLabel:B.getString("HubHeaderPanel.SearchHubAccessibilityLabel"),useIOSStyles:!this.state.modernizeMobileTabHeader&&t.useIOSSearchStyles,safeAreaPaddingStyle:s,onPress:this._handleMobileSearchButtonClick,showSearchIcon:this.state.modernizeMobileTabHeader});if(!t.showFilterIcon)return i;const o=this.state.modernizeMobileTabHeader?[ge.filterButtonContainerModernized,this._themeStyles.searchModernizeColorStyle,this._useAccessibleTheme()?this._themeStyles.searchBorderModernizeColorStyle:void 0]:[ge.filterButtonContainer];t.safeAreaHorizontalInsets&&t.safeAreaHorizontalInsets.right&&o.push(n.Styles.createViewStyle({right:t.safeAreaHorizontalInsets.right},!1));const r=t.safeAreaHorizontalInsets?n.Styles.createViewStyle({marginLeft:-1*t.safeAreaHorizontalInsets.left,marginRight:-1*t.safeAreaHorizontalInsets.right},!1):void 0,a=n.createElement(R.default,{ref:this._onFilterButtonRef,size:this.state.modernizeMobileTabHeader?ne.IconSize.size20:ne.IconSize.size16,style:this.state.modernizeMobileTabHeader?ge.iconModernized:ge.icon,onPress:this._onFilterButtonClick,color:this._themeColors.secondaryTextColor,hoverColor:this._themeColors.iconHoverColor,icon:this.state.modernizeMobileTabHeader?ne.SkypeIcon.FilterMenu:ne.SkypeIcon.Filter,title:B.getString("MobileRecentsFilter.ManageChats")});return n.createElement(n.View,{style:r},i,n.createElement(n.View,{style:o},a))}if(e.key===f.ConversationListItemNames.topSpacer)return n.createElement(n.View,{key:"topSpacer"});if(e.key.startsWith(f.ConversationListItemNames.itemSpacer))return n.createElement(n.View,{key:e.key,style:n.Styles.createViewStyle({height:e.height},!1)});if(e.key===f.ConversationListItemNames.bottomSpacer)return n.createElement(n.View,{key:"bottomSpacer"});if(e.key.substr(0,f.ConversationListItemNames.header.length)===f.ConversationListItemNames.header){const t=e;return n.createElement(_.default,{title:t.title})}if(e.key===f.ConversationListItemNames.notificationsPrompt)return n.createElement(G.default,null);if(e.key===f.ConversationListItemNames.finishSetupPrompt)return n.createElement(A.default,null);if(e.key===f.ConversationListItemNames.emptyState){const t=e;return this._renderEmptyStateListItem(t)}if(e.key===f.ConversationListItemNames.nativeAd){const t=e,s={adsGuid:t.adsGuid,adGuid:t.adGuid,dimensions:t.dimensions,placementId:t.placementId,canHide:t.canHide,provider:t.provider};return t.adType===I.AdsType.ListItemNarrow?n.createElement(g.default,Object.assign({},s)):n.createElement(m.default,Object.assign({},s))}if(e.key===f.ConversationListItemNames.loadingIndicator)return a.ActivityIndicatorHelper.renderItem(e,this._themeColors.secondaryTextColor);const s=e,o=this._getIconSize(s.rowSize,s.useMobileView,s.isUsingStackNavigationContext,s.useCompactIcon);if(e.key===f.ConversationListItemNames.engagementBanner){const t=e.template,s=f.ConversationsListHelper.getEngagementBannerProps(t,this._getContext());if(f.ConversationsListHelper.isEngagementBannerConfigModernizedType(s))return n.createElement(pe.EngagementBannerModernized,Object.assign({},s));if(!i.isUndefined(s))return n.createElement(P.EngagementBanner,Object.assign({},s))}const r=this.state.viewType===v.ConversationsListMode.ArchivedConversations?k.NavigationConversationOrigin.ArchivedConversations:k.NavigationConversationOrigin.Recents;return n.createElement(y.ConversationsListItem,{ref:this._conversationItemRefs.onComponentRef(s.key),key:"convItem",itemHeight:s.height,conversationId:s.key,isSelected:s.isSelected,conversationIconSize:o,rowSize:s.rowSize,origin:r,enableSwipeActions:this.state.enableSwipeActions,onSwiping:this.state.enableSwipeActions?this._onSwiping:void 0})},this._getIconSize=(e,t,s,i)=>e===$.RowSize.Compact||e===$.RowSize.ExtraCompact||i?s?this.state.modernizeMobileTab?ce.AvatarIconSize.Size44:ce.AvatarIconSize.Size40:ce.AvatarIconSize.Size24:this.state.modernizeMobileTab?ce.AvatarIconSize.Size64:t&&!this.state.modernizeConversationList?ce.AvatarIconSize.Size60:ce.AvatarIconSize.Size40,this._onSwiping=(e,t,s,i)=>{e&&(this._currentSwipeScrollTop=Math.max(this._currentScrollTop,0)),this.isComponentMounted()&&this.state.isSwiping!==e&&this.setState({isSwiping:e}),s&&this._currentScrollTop!==this._currentSwipeScrollTop&&this._scrollView&&this._scrollView.scrollToTop(!0,this._currentSwipeScrollTop),this._currentSwipableItemRef&&this._currentSwipableItemRef.itemId===i.itemId||(this._closeCurrentSwipeView(),t&&(this._currentSwipableItemRef=i))},this._handleMobileSearchButtonClick=e=>{const t=he.default.newCauseId();F.log(k.LogTraceArea.ConversationsListItem,"ConversationListPanel._handleMobileSearchButtonClick, causeId: "+t),e&&e.stopPropagation(),W.default.navigateToSearch({searchOrigin:k.SearchPanelInitiator.RecentsListSearchButton},t)},this._onFilterButtonRef=e=>{this._filterButton=e||void 0},this._onSearchInputButtonRef=e=>{this._searchInputButton=e||void 0},this._onFilterButtonClick=e=>{X.default.showOptionsMenu(void 0,(()=>this._filterButton),this._getRootViewId(),e)},this._onSyncContactsClick=()=>{f.ConversationsListHelper.syncContactsClickHandler(this._getRootViewId(),M.DialogNavOrigin.ChatsEmptyState)}}_buildState(e,t){const s=this._getRootViewId(),o=l.default.getS4LMessagingFeatures(),n=l.default.getOnboardingFeatures(),r=V.default.canModernizeConversationList(),a=V.default.canModernizeMobileTab(),c=V.default.canModernizeMobileTabHeader()||V.default.canModernizeMobileTabHeaderTablets(),h=j.default.isUsingStackNavigationContext()||!r&&e.useMobileView,g=z.default.getUserPreferencesLocal().recentsSortedBy||$.RecentsSortBy.Time,m=me._getRecentsViewModeType(e,h);let S=0;const y=this._getContext(),_=new f.ConversationsListHelper(s,!!h,y.isPresentedInDesktopLeftNav);if(g===$.RecentsSortBy.Unread&&!h){const t=u.default.getConversationsWithUnreadCounts();e.selectedConversationId&&e.selectedConversationId in t&&(this._currentUnreadConversationId=e.selectedConversationId)}const b=this.state?this.state.emptyStateHeight:void 0,T=this.state?this.state.listItemContainerHeight:void 0,M=this.state?this.state.itemList.length:0,I=this.state&&this.state.listItemContainerScreenAvailableHeight?this.state.listItemContainerScreenAvailableHeight:void 0,w=this.state&&this.state.listItemContainerWidth?this.state.listItemContainerWidth:void 0,P=_.getConversationsItemsList(e,t,b,T,M,this._currentUnreadConversationId,g,I,w,this._isPresentedInDesktopLeftNav(),this._isPresentedInTabletLeftNav()),A=_.getConversationAdBanner(e.useMobileView,w,r),E=Z.default.isMobileScreenReaderEnabled();let R=0;m===v.ConversationsListMode.AllConversations&&(S=_.getFavoritesCount(),R=_.getShownConversationsCount()-S,F.log(k.LogTraceArea.ConversationsListItem,"ConversationsListPanel._buildState user has "+S+"favorites conversationand shown non-favorites conversation"+R));const L=m!==v.ConversationsListMode.AllConversations&&_.isAnyConversationArchived(),O=J.default.isMobileScreenSize(s)&&!ae.default.useTabletUI(),D=o.enableKeyboardNavigationBetweenConversations&&!y.isPresentedInSplitView,B={favoritesCount:S,isMobileScreenSize:O,isMobileScreenReaderEnabled:E,isUsingStackNavigationContext:h,useIOSSearchStyles:d.default.useIOSSearchStyles(),safeAreaHorizontalInsets:_.getSafeAreaHorizontalInsets(a||r),renderDesktopFilter:!(h||e.useMobileView)&&(!O||e.useDesktopUtilityBar),viewType:m,hasArchivedConversations:L,enableSwipeActions:l.default.getS4LUiFeatures().enableRecentChatsSwipeActions,enableKeyboardNavigationBetweenConversations:D,recentConversationsIncrementor:o.recentConversationsIncrementor,shownConvsCount:R,showEmptyState:_.getShownConversationsCount()<2,itemList:P,keyboardHeight:x.default.getUpdateInfo().height,canLoadConversationsFromMemory:(0,C.default)().canPossiblyShowMoreRecentConversations(),nativeAdBanner:A,emptyStateDesignV2:n.conversationsListEmptyStateDesignV2,enableEmptyStateCTADesignV2:n.enableEmptyStateCTADesignV2,emptyStateBanner:n.features.emptyStateBanner,deviceSize:J.default.deviceSize(s),screenWidth:J.default.getWidth(this._getRootViewId()),modernizeConversationList:r,modernizeMobileTab:a&&!L,modernizeMobileTabHeader:c,isChild:H.default.isChild()};let N=l.default.getS4LMessagingFeatures().enableRecyclerListViewUseCases;B.enabledRecyclerView=N.indexOf("MainScreen.Tabs.Chat")>-1;const U=e.selectedConversationId?p.default.getAllSiblingConversations(e.selectedConversationId):[];return B.currentConversationIndex=D?i.findIndex(P,(t=>t.key===e.selectedConversationId||!!i.find(U,(e=>e.id===t.key)))):void 0,t&&(B.isSwiping=!1),B.currentConversationIndex=D?i.findIndex(P,(t=>t.key===e.selectedConversationId||!!i.find(U,(e=>e.id===t.key)))):void 0,t||this.state.trackedEmptyStateEvent||!B.showEmptyState||m!==v.ConversationsListMode.AllConversations||Q.default.getSyncAddressBookPrivacySetting()||(B.trackedEmptyStateEvent=!0,F.track(new q.DisplayedEmptyStateCta(q.EmptyStateOrigin.NoRecentConversations))),B}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),te.default.recentsWillMount()}componentDidMount(){if(super.componentDidMount(),E.register(this._focusEvents(),this),te.default.conversationListPanelRendered(),this.state.enableKeyboardNavigationBetweenConversations&&(O.default.addHandler(k.KeyboardShortcut.NavigateToPreviousConversation,this._onNavigateToPreviousConversation),O.default.addHandler(k.KeyboardShortcut.NavigateToNextConversation,this._onNavigateToNextConversation)),this.state.enableSwipeActions){const e=this._getContext().componentVisibilityStatus;e&&(this._visibilitySubscriptionToken=e.isVisibleEvent().subscribe((e=>{e||this._closeCurrentSwipeView()})))}}_focusEvents(){const e=[E.FocusEvent.Recent];return this.state.isUsingStackNavigationContext||e.push(E.FocusEvent.ConversationDeleted),this._isPresentedInTabletLeftNav()&&e.push(E.FocusEvent.CancelMobileSearch),e}_clickOnConversation(e){const t=this._conversationItemRefs.ref(e);this._scrollView&&t&&this.state.viewType===v.ConversationsListMode.AllConversations&&(this._scrollView.scrollToItem(e,!1),this._debouncedClickOnConversationListItem(t))}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t),this._currentUnreadConversationId&&!this.state.isUsingStackNavigationContext&&this.props.selectedConversationId===this._currentUnreadConversationId&&this.props.selectedConversationId!==e.selectedConversationId&&(this._currentUnreadConversationId=void 0)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);!(this.state.viewType===v.ConversationsListMode.ArchivedConversations)||this.state.isUsingStackNavigationContext||this.state.hasArchivedConversations||v.default.setConversationsListMode(v.ConversationsListMode.AllConversations),!this.props.isActiveTab&&e.isActiveTab&&this._closeCurrentSwipeView(),this._loadMoreConversationsIfNeeded()}componentWillUnmount(){super.componentWillUnmount(),E.unregister(this._focusEvents(),this),this._visibilitySubscriptionToken&&(this._visibilitySubscriptionToken.unsubscribe(),this._visibilitySubscriptionToken=void 0),this._activationSubToken&&(this._activationSubToken.unsubscribe(),this._activationSubToken=void 0),this.state.enableKeyboardNavigationBetweenConversations&&(O.default.removeHandler(k.KeyboardShortcut.NavigateToPreviousConversation,this._onNavigateToPreviousConversation),O.default.removeHandler(k.KeyboardShortcut.NavigateToNextConversation,this._onNavigateToNextConversation))}render(){const e=this.props.topInset?{top:this.props.topInset,left:0,bottom:0,right:0}:void 0,t=this._renderOptionalHubDesktopPicker(),s=t?this._renderShadow():void 0;let i=n.createElement(o.VirtualListView,{ref:this._onScrollViewRef,itemList:this.state.itemList,renderItem:this._renderItem,scrollsToTop:this.props.isScrollToTopTarget,animateChanges:!this.props.disableChangeAnimation,skipRenderIfItemUnchanged:!this.state.showEmptyState,keyboardDismissMode:this._getContext().isPresentedInDesktopLeftNav?"on-drag":void 0,showOverflow:Y.default.hasHorizontalSafeAreas(this.state.safeAreaHorizontalInsets),scrollIndicatorInsets:e,horizontalPadding:this.state.safeAreaHorizontalInsets,onScroll:this.props.onScroll||!this.state.isUsingStackNavigationContext||this.state.enableSwipeActions?this._onScroll:void 0,onInitialRenderComplete:this._onInitialRenderComplete,accessibilityLabel:B.getString("ConversationsListPanel.ConversationsList"),disableScrolling:this.state.isSwiping,onEndReached:this._isRecentsView()?this._onEndReached:void 0,endReachedThreshold:100,screenWidth:this.state.screenWidth,enabledRecyclerView:this.state.enabledRecyclerView});return s&&(i=n.createElement(n.View,{style:re.default.flexOne},i,s)),n.createElement(n.View,{style:ge.panel,onLayout:this._onLayoutVlvContainer},t,i,this._renderAdBanner(this.state.nativeAdBanner))}focusFirst(){return!!this._scrollView&&(this._scrollView.scrollToTop(!1),this._scrollView.focus(!0),!0)}scrollToTop(){this._scrollView&&this._scrollView.scrollToTop(!0)}_getConversationItems(e){return i.filter(e,(e=>!i.includes(f.ConversationListItemNames,e.key)))}_getItemContainerHeightDisregardingKeyboard(e,t){return t.keyboardHeight<=0?e:t.listItemContainerScreenAvailableHeight?t.listItemContainerScreenAvailableHeight:t.listItemContainerHeight?t.listItemContainerHeight:e}_shouldComponentUpdate(e,t,s,i,o,n){return e?!h.default.comparator(s.itemList,o.itemList):super._shouldComponentUpdate(e,t,s,i,o,n)}_getEmptyStateListItemHeight(e,t,s){const o=t-i.sumBy(e,(e=>e.key===f.ConversationListItemNames.emptyState?0:e.height));return s<=o?o:s}_isRecentsView(){return this.props.viewType===v.ConversationsListMode.AllConversations||this.state.viewType===v.ConversationsListMode.AllConversations}_renderOptionalHubDesktopPicker(){return this.state.renderDesktopFilter?n.createElement(b.default,{newActionPickerContext:this.props.newActionPickerContext}):void 0}_renderShadow(){return n.createElement(T.default,{opacityStyle:this._shadowOpacityStyle})}_getEmptyStateContainerStyles(e){const t=[ge.emptyStateContainer];if(this.state.listItemContainerHeight&&this.state.emptyStateHeight){const s=1===e.height?this._getEmptyStateListItemHeight(this.state.itemList,this.state.listItemContainerHeight,this.state.emptyStateHeight):e.height;t.push(n.Styles.createViewStyle({height:s},!1))}else t.push(n.Styles.createViewStyle({opacity:0},!1));return t.push(ge.emptyStateContainerItemsAtTop),this.state.isMobileScreenSize||t.push(ge.emptyStateContainerTopPadding),t}_renderEmptyStateListItem(e){const t=this._getEmptyStateContainerStyles(e);let s;this._shouldRenderEmptyStateImage(e)&&(s=n.createElement(n.Image,{style:ge.emptyStateImageV1,source:r.Collection.ONBOARDING_CHATS_EMPTYSTATE_V1}));let i=B.getString("ConversationsListPanelEmptyState.NotSyncedHeaderAlternative"),o=B.getString("ConversationsListPanelEmptyState.NotSyncedFirstTextAlternative");const a=B.getString("ConversationsListPanelEmptyState.NotSyncedSecondTextAlternative"),l=B.getString("ConversationsListPanelEmptyState.SyncAddressBookButtonAlternative");let d;if(e.hideSyncAddressBookCta){const e=void 0;i=B.getString("ConversationsListPanelEmptyState.EmptyChatsHeaderAlternative"),o=B.getString("ConversationsListPanelEmptyState.SearchCTATextAlternative"),d=n.createElement(n.View,{style:ge.emptyStateTextsContainer},n.createElement(n.View,{style:ge.emptyStateTextWithIconContainerV2},n.createElement(L.default,{key:"searchIcon",icon:ne.SkypeIcon.Search,size:ne.IconSize.size16,color:this._themeColors.secondaryTextColor,style:ge.emptyStateTextIcon}),n.createElement(le.BodyText,{style:ge.emptyStateTextWithIcon,textThemeColor:le.TextThemeColor.Secondary},o)),e)}else if(this.state.isChild)d=null;else{if(this.state.enableEmptyStateCTADesignV2)return this._getEmptyStateCTADesignV2(t);d=n.createElement(n.View,null,n.createElement(le.BodyText,{style:ge.emptyStateText,textThemeColor:le.TextThemeColor.Secondary},o),n.createElement(le.BodyText,{style:ge.emptyStateTextSecondLine,textThemeColor:le.TextThemeColor.Secondary},a),n.createElement(se.default,{style:ge.syncContactsButton,buttonStyle:c.SXButtonStyle.ColorFill,buttonSize:c.SXButtonSize.Medium,onPress:this._onSyncContactsClick,title:l,allowTextWrap:!0}))}return n.createElement(n.View,{style:t,ignorePointerEvents:!0,onLayout:this._onLayoutEmptyState},s,n.createElement(w.default,{headerText:i}),d)}_getEmptyStateCTADesignV2(e){const t=B.getString("ConversationsListPanelEmptyState.SyncAddressBookButtonAlternative"),s=this.state.deviceSize===J.DeviceSize.Small,i=[ge.syncContactsButton,ge.syncContactsButtonV2,s?ge.syncContactsButtonV2Small:void 0],o=[ge.emptyStateSyncContactImage,s?ge.emptyStateSyncContactImageSmall:void 0];return n.createElement(n.View,{style:e,ignorePointerEvents:!0,onLayout:this._onLayoutEmptyState},n.createElement(n.Image,{style:o,source:r.Collection.ONBOARDING_SYNC_CONTACTS_V2}),n.createElement(w.default,{headerText:B.getString("ConversationsListPanelEmptyState.EmptyChatsHeaderAlternative")}),n.createElement(le.BodyText,{style:[ge.emptyStateTextSecondLine,ge.emptyStateTextSecondLineV2],textThemeColor:le.TextThemeColor.Secondary},B.getString("ConversationsListPanelEmptyState.NotSyncedSecondTextAlternative")),n.createElement(se.default,{style:i,textStyleOverride:[ge.textStyleOverride],buttonStyle:c.SXButtonStyle.ColorFill,buttonSize:c.SXButtonSize.Medium,onPress:this._onSyncContactsClick,title:t,accessibilityLabel:t,allowTextWrap:!1,icon:void 0,iconSize:ne.IconSize.size18,iconPositon:c.SXButtonIconPosition.End}),n.createElement(se.default,{onPress:this._onPressLearnMore,buttonStyle:c.SXButtonStyle.Custom,buttonConfig:{textColor:ie.Color.blue,backgroundColor:ie.Color.transparent},textStyleOverride:[ge.learnMoreButton],buttonSize:c.SXButtonSize.Small,title:B.getString("UserSettingsPanel.HotkeysLearnMoreLink")}))}_renderMobileEmptyStateListItemV2(e){const t=this._getEmptyStateContainerStyles(e);let s,i,o,a=this.state.emptyStateDesignV2.backgroundVariant;switch(this.state.isChild&&(a=K.ChatsEmptyStateBackground.MeetNow),a){case K.ChatsEmptyStateBackground.MeetNow:s=r.Collection.ONBOARDING_CHATS_EMPTYSTATE_V2_MEETNOW,i="ConversationsListPanelEmptyState.EmptyChatsCTATextMeetNow",o=ne.SkypeIcon.MeetNow;break;case K.ChatsEmptyStateBackground.Search:s=r.Collection.ONBOARDING_CHATS_EMPTYSTATE_V2_SEARCH,i="ConversationsListPanelEmptyState.EmptyChatsCTATextSearch",o=ne.SkypeIcon.Search;break;case K.ChatsEmptyStateBackground.Chat:default:s=r.Collection.ONBOARDING_CHATS_EMPTYSTATE_V2_CHAT,i="ConversationsListPanelEmptyState.EmptyChatsCTATextChat",o=ne.SkypeIcon.Topic}const l=n.createElement(le.BodyText,{style:ge.emptyStateText,textThemeColor:le.TextThemeColor.Primary},B.getParts(i,{icon:n.createElement(n.View,{style:ge.emptyStateTextIconWrap},n.createElement(L.default,{icon:o,size:ne.IconSize.size18,color:this._themeColors.primaryTextColor,style:ge.emptyStateTextIconV2}))}));return n.createElement(n.View,{style:t,ignorePointerEvents:!0,onLayout:this._onLayoutEmptyState},n.createElement(n.Image,{style:ge.emptyStateImageV2,source:s}),n.createElement(n.View,{style:ge.emptyStateTextsContainer},n.createElement(n.View,{style:ge.emptyStateTextWithIconContainerV2},l)))}_renderContactsCta(e,t,s){return n.createElement(n.View,{style:ge.emptyStateTextWithIconContainer},n.createElement(L.default,{key:"contactsIcon",icon:ne.SkypeIcon.Contact,size:e,color:t,style:s}),n.createElement(le.BodyText,{style:ge.emptyStateTextWithIcon,textThemeColor:le.TextThemeColor.Secondary},B.getString("ConversationsListPanelEmptyState.ContactsCTATextAlternative")))}_pauseWhenNotVisible(){return j.default.isUsingStackNavigationContextNoSubscription()}static _getRecentsViewModeType(e,t){let s=v.ConversationsListMode.AllConversations;return t?e.viewType&&(s=e.viewType):s=v.default.getConversationsListMode(),s}_loadMoreConversationsIfNeeded(){if(this.state.canLoadConversationsFromMemory&&!this.state.isUsingStackNavigationContext&&this.state.listItemContainerHeight&&this.state.itemList){const e=new f.ConversationsListHelper(this._getRootViewId(),!1,this._isPresentedInDesktopLeftNav()).getNumberOfConversationsToFit(this.state.listItemContainerHeight,this.state.modernizeConversationList),t=this._getConversationItems(this.state.itemList).length,s=e-t;e>=t&&(F.log(k.LogTraceArea.ConversationsListItem,"LoadMoreConversations Increasing the limit to show more conversations, screen can fit "+e+", conversations shown: ",t),v.default.loadMoreConversations(s))}}}t.default=me},48734:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(77381),n=s(15877),r=(s(33754),s(19675)),a=s(66127),l=(0,n.lazyProperties)({container:()=>i.Styles.createViewStyle({flex:-1,flexDirection:"row",alignItems:"center",paddingTop:20,paddingBottom:6,paddingHorizontal:10}),containerPaddingModernize:()=>i.Styles.createViewStyle({paddingHorizontal:16,paddingTop:6,paddingBottom:6}),containerPaddingModernizeMobile:()=>i.Styles.createViewStyle({paddingHorizontal:16,paddingTop:8,paddingBottom:8}),containerSmall:()=>i.Styles.createViewStyle({paddingTop:10}),sectionTitleText:()=>i.Styles.createTextStyle({flex:-1,flexDirection:"row"})});class d extends o.default{_buildState(e,t){return{modernizeConversationList:a.default.canModernizeConversationList(),modernizeMobileTab:a.default.canModernizeMobileTab()}}render(){const e=!1,t=i.Types.ImportantForAccessibility.NoHideDescendants;let s;const o=[l.container];this._isPresentedInDesktopLeftNav()&&o.push(l.containerSmall),this.state.modernizeConversationList&&o.push(l.containerPaddingModernize),this.state.modernizeMobileTab&&o.push(l.containerPaddingModernizeMobile),this.props.style&&o.push(this.props.style);const n={style:l.sectionTitleText,numberOfLines:1,accessibilityHidden:!0,useMobileUI:this.state.modernizeMobileTab},a=this.props.title,d=this.state.modernizeConversationList||this.state.modernizeMobileTab?i.createElement(r.SubtitleModernize,Object.assign({},n),a):i.createElement(r.Subtitle,Object.assign({},n),a);return i.createElement(i.View,{style:o,importantForAccessibility:t,accessibilityTraits:undefined,accessibilityLabel:s},d)}}t.default=d},95106:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});s(96486);const i=s(16778),o=s(97691),n=s(71830),r=s(62141),a=s(18083),l=s(39549),d=s(16402),c=s(52262),h=s(70891),u=s(46096),p=s(53026),g=s(36237),m=s(15877),S=s(33754),f=s(34537),y=s(51072),_=s(23752),v=s(66127),C=s(6658),b=s(18078),T=s(89808),M=s(4735),I=s(14976),w=s(4057),P=s(81760),k=s(11010),A=s(19675),E=s(24576),R=s(12770),L=s(2301),F=s(67977),x=s(53374),O=C.messageTextLineHeight,D=(0,m.lazyProperties)({card:()=>i.Styles.createButtonStyle({flex:1,flexDirection:"row",alignItems:"center",paddingVertical:8}),cardHorizontalPaddingClassic:()=>i.Styles.createViewStyle({paddingHorizontal:12}),cardHorizontalPaddingModernize:()=>i.Styles.createViewStyle({paddingHorizontal:8}),iconAndContentContainer:()=>i.Styles.createViewStyle({flex:1,flexDirection:"row",marginRight:4}),cardContentContainer:()=>i.Styles.createViewStyle({marginBottom:2}),cardContentContainerWeb:()=>i.Styles.createViewStyle({maxHeight:3*O}),cardContentText:()=>i.Styles.createTextStyle({lineHeight:O}),userIcon:()=>i.Styles.createViewStyle({flexDirection:"row",marginRight:12,alignSelf:"flex-start"}),contentContainer:()=>i.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),title:()=>i.Styles.createTextStyle({flexShrink:1}),footer:()=>i.Styles.createTextStyle({flexShrink:1})});class B extends E.default{constructor(){super(...arguments),this._onContainerRef=e=>{this._containerRef=e||void 0},this._onHoverStart=()=>{this.isComponentMounted()&&this.setState({isHovering:!0})},this._onHoverEnd=()=>{this.isComponentMounted()&&this.setState({isHovering:!1})},this._onPress=()=>{if(this.props.searchResult.ConversationId){const e=this.props.searchResult.ConversationId,t=this.props.searchResult.MessageId,s=this.props.searchResult.ServerMessageId?Number(this.props.searchResult.ServerMessageId):void 0;let i;i=t?r.default.getMessageByCuid(e,t).then((e=>e?e.createdTime:o.Rejected(void 0))).catch((i=>(g.log(u.LogTraceArea.Search,"ContentSearchMessageResult could not fetch message conversationId="+I.mriOrId(e)+" cuid="+t+" id="+s+(i?" err="+w.default.errorAsString(i):"")),s))):o.Resolved(s),i.then((s=>{this._navigateToConversation(s,e,t)})),this.props.onSearchMessagePress&&this.props.onSearchMessagePress(this,t)}}}_buildState(e,t){const s=(0,l.default)().getConversation(e.searchResult.ConversationId),i=s&&(!s.isOneOnOne()||b.default.isMyMri(e.searchResult.From));return{isHovering:!1,creatorName:c.default.getDisplayName(e.searchResult.From),formattedTimestamp:this._getElapsedTimeAndUpdateTimer(e),conversationName:i?c.default.getDisplayName(e.searchResult.ConversationId):"",modernizeConversationList:v.default.canModernizeConversationList(),userColor:T.default.getColorInfo()}}requestFocus(){this._containerRef&&this._containerRef.requestFocus()}_getOptionalModernizeTitleStyle(){if(this.state.modernizeConversationList)return f.default.getItemTitleTextStyle(!1,!1,this._themeStyles)}_getOptionalModernizeSubtitleStyle(){if(this.state.modernizeConversationList)return f.default.getItemSubtitleTextStyle(this._useDarkTheme(),!1,this._useAccessibleTheme(),this._themeStyles)}render(){let e="";const t=this.props.searchResult,s=t.From;n.isMri(s)&&(e=this.state.creatorName);const o=[k.default.fontStyle.body,this._themeStyles.secondaryTextColorStyle,D.cardContentText,this._getOptionalModernizeSubtitleStyle()],r=[D.title,this._getOptionalModernizeTitleStyle()],l=e?i.createElement(A.RowTitle,{style:r,numberOfLines:1},e.split("\n",1)):void 0,d=Object.assign(Object.assign({},h.ProcessingDefaults.Preview),{atMentions:h.ProcessingLevel.Full}),c=[o,k.default.font.uiDisplayBold],u={processing:d,renderMedia:!1,mediaPlaceholderIconColor:P.Color.gray200,allowLargeEmoticons:!1,numberOfLines:3,textOverrideStyle:o,atMentionStyle:c,atMentionMeOverrideStyle:c,renderSimpleAtMentions:!0},p=a.default.simulateFullMessage(t,"");if(!p)return null;let g=[D.cardContentContainer];g.push(D.cardContentContainerWeb);const m=[D.card,this.state.modernizeConversationList?D.cardHorizontalPaddingModernize:D.cardHorizontalPaddingClassic],S=!(!this.state.isHovering&&!this.props.isPseudoFocused);this.state.modernizeConversationList&&(this._isPresentedInDesktopLeftNav()||this._isPresentedInTabletLeftNav())?m.push(f.default.getItemBackgroundStyle(this._useDarkTheme(),!1,S,this._useAccessibleTheme(),this._themeStyles,this.state.userColor)):S&&m.push(this._isPresentedInDesktopLeftNav()?this._themeStyles.secondaryRowHoverViewStyle:this._themeStyles.rowHoverViewStyle);const v=this.state.formattedTimestamp.value+" "+this.state.conversationName,C=this.state.formattedTimestamp.valueAccessible+" "+this.state.conversationName,b=i.createElement(i.View,{style:D.iconAndContentContainer},i.createElement(i.View,{style:D.userIcon},i.createElement(L.UserIcon,{size:F.UserIconSize.Size40,userMri:s})),i.createElement(i.View,{style:D.contentContainer},l,i.createElement(i.View,{style:g},i.createElement(_.default,{message:p,rawSearchQuery:this.props.rawSearchQuery,options:u})),i.createElement(i.View,{accessibilityLabel:C},i.createElement(A.Caption,{style:D.footer,numberOfLines:1,modernizeConversationList:this.state.modernizeConversationList},v.split("\n",1))))),T={ref:this._onContainerRef};return i.createElement(y.default.View,Object.assign({},T,{style:m,onPress:this._onPress,onMouseEnter:this._onHoverStart,onMouseLeave:this._onHoverEnd,importantForAccessibility:undefined,accessibilityTraits:[i.Types.AccessibilityTrait.Button,i.Types.AccessibilityTrait.MenuItem]}),b)}_getElapsedTimeAndUpdateTimer(e){let t=new Date(e.searchResult.CreationDate).valueOf(),s=Date.now()-t;if(s>=36e5){let e=d.default.getDisplayDateTimeString(t);return{value:e,valueAccessible:e}}{const e=6e4-Math.floor(s%6e4);if(R.default.setTimeout((()=>{this._updateTimeState()}),e),s>=6e4){let e=Math.floor(s/6e4).toString();return{value:S.getString("SearchResultsList.ElapsedTimeMinutes",{minutes:e}),valueAccessible:S.getString("SearchResultsList.ElapsedTimeMinutesAccessible",{minutes:e})}}return{value:S.getString("SearchResultsList.ElapsedTimeOneMinute"),valueAccessible:S.getString("SearchResultsList.ElapsedTimeOneMinuteAccessible")}}}_updateTimeState(){this.isComponentMounted()&&this.setState({formattedTimestamp:this._getElapsedTimeAndUpdateTimer(this.props)})}_navigateToConversation(e,t,s){const i=x.default.newCauseId();this.props.rawSearchQuery&&p.default.setSearchQuery({query:this.props.rawSearchQuery,conversationId:t,messageId:s,sessionId:i}),M.default.navigateToConversationFromSearch({convId:t,scrollToTimestamp:e,causeId:i})}}t.default=B},47121:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(88837);class n extends o.ComponentBase{constructor(){super(...arguments),this._onPress=e=>{this.props.onPress(e,this.props.name)}}render(){return i.createElement(i.Button,{style:this.props.style,title:this.props.title,key:"album"+this.props.name,onPress:this._onPress},this.props.children)}}t.default=n},49096:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MediaAlbumPicker=void 0;const i=s(96486),o=s(29359),n=s(16778),r=s(88837),a=s(47121),l=s(62033),d=s(25854),c=s(11930),h=s(46096),u=s(74313),p=s(10117),g=s(36237),m=s(72490),S=s(15877),f=s(33754),y=s(51070),_=s(81115),v=s(90631),C=s(4057),b=s(81760),T=(s(40363),s(11828)),M=s(80837),I=s(19675),w=(0,S.lazyProperties)({overlayInner:()=>n.Styles.createViewStyle({position:"absolute",top:0,left:0,bottom:0,right:0,backgroundColor:b.Color.gray400}),containerOpaque:()=>n.Styles.createViewStyle({backgroundColor:b.Color.black}),header:()=>(0,S.lazyProperties)({container:()=>n.Styles.createViewStyle({flexDirection:"row",alignSelf:"stretch",paddingHorizontal:16,paddingTop:4,paddingBottom:6,height:48}),title:()=>n.Styles.createTextStyle({color:b.Color.white}),headerControlWrap:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",justifyContent:"center"})}),itemContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",paddingRight:12}),itemImage:()=>n.Styles.createViewStyle({width:80,height:80}),itemImageContainer:()=>n.Styles.createViewStyle({width:80,height:80}),itemImageContainerMargin:()=>n.Styles.createViewStyle({marginBottom:1}),itemInfo:()=>n.Styles.createViewStyle({flexDirection:"column",alignItems:"flex-start",justifyContent:"center",marginLeft:12,paddingVertical:10,flex:1}),itemInfoBorder:()=>n.Styles.createViewStyle({borderColor:b.Color.gray300,borderTopWidth:1,borderStyle:"solid"}),itemInfoName:()=>n.Styles.createTextStyle({color:b.Color.white}),itemInfoCount:()=>n.Styles.createTextStyle({color:b.Color.gray100}),thumbnailPlaceholderText:()=>n.Styles.createViewStyle({flex:0,flexDirection:"row"}),failureContainer:()=>n.Styles.createViewStyle({position:"absolute",top:0,left:0,bottom:0,right:0,justifyContent:"center",alignItems:"center"}),errortext:()=>n.Styles.createTextStyle({color:b.Color.white,paddingHorizontal:40})});class P extends r.ComponentBase{constructor(){super(...arguments),this._onHeaderCenterRef=e=>{e&&i.defer((()=>{e.requestFocus()}))},this._onAlbumPress=(e,t)=>{e.stopPropagation(),this.props.onClose(t)},this._onBack=()=>(this.props.onClose(void 0),g.log(h.LogTraceArea.HardwareBackButton,"goBack: true componentId: MediaAlbumPicker"),!0),this._onKeyUp=()=>(this.props.onClose(void 0),!0)}_buildState(e,t){let s={statusBarHeight:y.default.statusBarHeight(),safeAreaHorizontalPaddingStyle:y.default.horizontalPaddingStyle()};return t&&(s.isLoading=!0,s.failed=!1),s}componentDidMount(){super.componentDidMount(),l.default.subscribe(this._onBack),m.default.addEscapeHandler(this._onKeyUp),this._mediaPickerToken?this._loadAlbums():o.default.open().then((e=>{this._mediaPickerToken=e,this._loadAlbums()}))}componentWillUnmount(){super.componentWillUnmount(),l.default.unsubscribe(this._onBack),m.default.removeEscapeHandler(this._onKeyUp),this._mediaPickerToken&&o.default.close(this._mediaPickerToken)}_loadAlbums(){this._mediaPickerToken&&o.default.getAlbums(this._mediaPickerToken,{photoOnly:this.props.mediaType===d.MediaType.PhotoOnly,disableGifs:this.props.disableGifs}).then((e=>{this.isComponentMounted()&&this.setState({albums:e,isLoading:!1,failed:!1})})).catch((e=>{g.error(h.LogTraceArea.MediaPickerPanel,"Failed to retrieve albums from the device"+C.default.errorAsString(e)),this.isComponentMounted()&&this.setState({failed:!0,isLoading:!1})}))}render(){let e=[w.overlayInner,this.props.style];e.push(w.containerOpaque);let t,s,o=[w.header.container];if(this.state.statusBarHeight&&(o.push(_.default.paddingTopStyle(this.state.statusBarHeight)),o.push(_.default.heightStyle(this.state.statusBarHeight+48))),this.state.failed)t=n.createElement(n.View,{style:w.failureContainer},n.createElement(p.default,{icon:T.SkypeIcon.Warning,size:T.IconSize.size60,color:b.Color.gray100}),n.createElement(I.BodyText,{style:w.errortext},f.getString("MediaAlbumPicker.FailedToLoad")));else{const e=n.createElement(p.default,{icon:T.SkypeIcon.Picture,size:T.IconSize.size32,color:b.Color.gray100,style:w.thumbnailPlaceholderText}),t=n.createElement(p.default,{icon:T.SkypeIcon.Warning,size:T.IconSize.size32,color:b.Color.gray100,style:w.thumbnailPlaceholderText}),o=[M.default.flexOne];this.state.safeAreaHorizontalPaddingStyle&&o.push(this.state.safeAreaHorizontalPaddingStyle),s=n.createElement(n.ScrollView,{style:o,keyboardShouldPersistTaps:!0},i.map(this.state.albums,((s,i)=>{let o=[w.itemInfo],r=[w.itemImageContainer];return i>0&&(o.push(w.itemInfoBorder),r.push(w.itemImageContainerMargin)),n.createElement(a.default,{key:"album"+i,name:s.name,title:f.getString("MediaAlbumPicker.ItemTitle",{albumName:s.name,numItems:s.count}),onPress:this._onAlbumPress,style:w.itemContainer},n.createElement(u.default,{origin:"MediaAlbumPicker",key:"albumImage"+i,style:w.itemImage,containerStyle:r,source:s.thumbnailUri,altView:e,errorView:t,resizeMode:"cover"}),n.createElement(n.View,{style:o},n.createElement(I.RowTitle,{style:w.itemInfoName},s.name),n.createElement(I.Caption,{style:w.itemInfoCount},s.count)))})))}const r={color:b.Color.white,closeButtonType:v.CloseButtonType.Close,onPress:this._onBack,title:f.getString("Global.CloseButtonTitle")};return n.createElement(n.View,{style:e},n.createElement(v.SimplePanelHeader,{titleView:this._getHeaderCenterControls(),leftButton:r,useTransparentBackground:!0}),t,s)}_getHeaderCenterControls(){const e=f.getString("MediaAlbumPicker.Title"),t=c.default.headerAccessibilityInfo(e);return n.createElement(n.View,{style:w.header.headerControlWrap,ref:this._onHeaderCenterRef,importantForAccessibility:n.Types.ImportantForAccessibility.Yes,accessibilityLabel:t.accessibilityLabel,accessibilityTraits:t.accessibilityTraits},n.createElement(I.PanelHeader,{style:w.header.title,numberOfLines:1,accessibilityHidden:!0},e))}}t.MediaAlbumPicker=P,t.default=P},72071:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MediaPickerPanel=void 0;const i=s(96486),o=s(16778),n=s(19784),r=s(89391),a=s(96074),l=s(25854),d=s(11930),c=s(46096),h=s(10117),u=s(36237),p=s(61253),g=s(15877),m=s(33754),S=s(49096),f=s(81157),y=s(21101),_=s(6286),v=s(71349),C=s(45026),b=s(4735),T=s(51070),M=s(81115),I=s(36150),w=s(90631),P=s(49603),k=s(12187),A=s(81760),E=s(11828),R=s(34528),L=s(78262),F=s(80837),x=s(19675),O=s(53374),D=w.HeaderHeight,B=D,V=(0,g.lazyProperties)({panel:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch",backgroundColor:A.Color.gray400}),panelInline:()=>o.Styles.createViewStyle({backgroundColor:A.Color.transparent}),gestureOverlay:()=>o.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:A.Color.transparent}),header:()=>(0,g.lazyProperties)({innerContainer:()=>o.Styles.createViewStyle({flexDirection:"row",justifyContent:"center",alignItems:"center"}),headerControlWrap:()=>o.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",justifyContent:"center"}),container:()=>o.Styles.createViewStyle({alignSelf:"stretch",alignItems:"stretch",backgroundColor:A.Color.gray400,height:D}),title:()=>o.Styles.createTextStyle({color:A.Color.white,marginRight:5})}),modal:()=>o.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:A.Color.transparent,overflow:"visible"}),emptyViewWrapper:()=>o.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,padding:20,backgroundColor:A.Color.gray400,alignItems:"center",justifyContent:"center"}),emptyViewWrapperFullHeight:()=>o.Styles.createViewStyle({bottom:0}),emptyViewText:()=>o.Styles.createTextStyle({color:A.Color.white,textAlign:"center"})});class N extends a.default{constructor(){super(...arguments),this._hasShownAlbum=!1,this._isDragging=!1,this._contentTransform=0,this._headerAnimatedTransfromValue=new o.Animated.Value(-120),this._headerAnimatedTransfromStyle=o.Styles.createAnimatedViewStyle({transform:[{translateY:this._headerAnimatedTransfromValue}]}),this._contentAnimatedTransfromValue=new o.Animated.Value(o.UserInterface.measureWindow().height),this._contentAnimatedOpacityValue=new o.Animated.Value(1),this._contentAnimatedStyle=o.Styles.createAnimatedViewStyle({transform:[{translateY:this._contentAnimatedTransfromValue}]}),this._contentAnimatedOpacityStyle=o.Styles.createAnimatedViewStyle({opacity:this._contentAnimatedOpacityValue}),this._emptyViewAnimatedHeightValue=new o.Animated.Value(100),this._emptyViewAnimatedHeightStyle=o.Styles.createAnimatedViewStyle({height:this._emptyViewAnimatedHeightValue}),this._onPan=e=>{this._interestedInGesture=!1,e.isComplete&&(this._interestedInGesture=void 0,this._isDragging=!1)},this._onPanVertical=e=>{void 0===this._interestedInGesture&&(this._interestedInGesture=!0);let t=0;if(this._interestedInGesture){t=e.pageY-e.initialPageY;let s=this._contentTransform+t;s<0&&(s=0),this._contentAnimatedTransfromValue.setValue(s);const i=B+this.state.statusBarPadding,o=this.state.viewDimensions.height-i-s;this.props.mediaPickerMode===l.MediaPickerMode.InlinePeekaboo&&this._emptyViewAnimatedHeightValue.setValue(o),this._isDragging||(this._contentAnimatedOpacityValue.setValue(1),this._isDragging=!0)}if(e.isComplete){this._contentTransform+=t;let s=!1;e.velocityY<-.1?s=!0:e.velocityY<.1&&(s=this._contentTransform<this.state.viewDimensions.height/2),this._expandOrCollapse(s),this._interestedInGesture=void 0}},this._onScrolledToTop=e=>{this.isComponentMounted()&&this.setState({isScrolledToTop:e})},this._onPhotosLoaded=e=>{const t=e>0;this.isComponentMounted()&&this.state.hasPhotos!==t&&this.setState({hasPhotos:t})},this._onLayoutChanged=e=>{const t={height:e.height,width:e.width};(0,p.default)(this.state.viewDimensions,t)||this.setState({viewDimensions:t})},this._onAlbumChange=e=>{e.stopPropagation(),this.isComponentMounted()&&this.setState({showAlbumPicker:!0})},this._onCloseAlbumPicker=e=>{if(this._hasShownAlbum||e){if(this.isComponentMounted()){const t=!1;let s=this.state.currentAlbumName,i=this.state.hasPhotos;e&&e!==this.state.currentAlbumName&&(s=e,i=!0),this.setState({showAlbumPicker:t,currentAlbumName:s,hasPhotos:i})}}else this._close()},this._onClose=()=>{this._close(),this.props.onClose&&this.props.onClose()},this._onMediaItemSelected=(e,t,s,o)=>{if(this._isDragging)return;if(this._captureSessionTelemetry=new v.CaptureSession(c.PostSource.MediaPicker),!this.props.allowMultiple)return void(s&&!this._exceedsMaxVideoLength(t)&&this._editMediaSelection([t]));let n=this.state.selectedItems.slice(0);s?i.find(n,(t=>t.id===e))||n.push(t):n=i.filter(n,(t=>t.id!==e)),this.setState({selectedItems:n,selectedItemsCount:n.length})},this._onMediaPickerReset=()=>{this.setState({selectedItems:[],selectedItemsCount:0})},this._onNext=e=>{const t=O.default.newCauseId();if(u.log(c.LogTraceArea.MediaPickerPanel,"MediaPickerPanel._onNext",t),0===this.state.selectedItemsCount)return;i.some(this.state.selectedItems,(e=>this._exceedsMaxVideoLength(e)))||(1===this.state.selectedItemsCount||this._isMediaPreviewEnabled()?this._editSelectedPhoto():this._sendSelectedPhotos(t))},this._onSendFlowComplete=()=>{const e=O.default.newCauseId();u.log(c.LogTraceArea.MediaPickerPanel,"MediaPickerPanel._onSendFlowComplete",e),this.props.onSendFlowComplete?this.props.onSendFlowComplete():this.props.conversationId?b.default.navigateToConversation({convId:this.props.conversationId,origin:c.NavigationConversationOrigin.MediaPicker,causeId:e}):b.default.navigateToHub(e)},this._onMediaPickerWrapperViewRef=e=>{this._mediaPickerWrapperView=e||void 0},this._onCenterControlsRef=e=>{this._centerControls=e||void 0},this._isMediaPreviewEnabled=()=>this.props.conversationId&&_.default.isMediaPreviewEnabled(this.props.conversationId)}_buildState(e,t){let s={statusBarPadding:T.default.statusBarPadding(),isMobileScreenReaderEnabled:I.default.isMobileScreenReaderEnabled(),maxSelectionCount:e.allowMultiple?r.default.getS4LMessagingFeaturesNoSubscription().limitForFilePicker:0,disableGifs:r.default.getS4LMessagingFeatures().disableGifsInMediaPicker,maxVideoDurationOnMobileMin:r.default.getS4LCMCFeatures().maxVideoDurationOnMobileMin};if(t){const t=e.mediaPickerMode||l.MediaPickerMode.Default;s.selectedItems=[],s.selectedItemsCount=0,s.currentAlbumName="",s.nextButtonDisabled=!0,s.showAlbumPicker=!!e.defaultToAlbums,s.thumbnailSize=0,s.isExpanded=t!==l.MediaPickerMode.InlinePeekaboo,s.isScrolledToTop=!0,s.viewDimensions={width:0,height:0},s.hasPhotos=!0,this._contentTransform=e.hidden?o.UserInterface.measureWindow().height:0,C.default.markAnimatedValue(this._contentAnimatedTransfromValue,this._contentTransform),C.default.markAnimatedValue(this._contentAnimatedOpacityValue,1);const i=e.hidden||e.mediaPickerMode===l.MediaPickerMode.InlinePeekaboo?-1*(B+s.statusBarPadding):0;C.default.markAnimatedValue(this._headerAnimatedTransfromValue,i)}return s}componentDidMount(){if(super.componentDidMount(),this.props.mediaPickerMode===l.MediaPickerMode.InlinePeekaboo&&this._expandOrCollapse(this.state.isExpanded,!1),this._hasShownAlbum=!this.state.showAlbumPicker,!this.props.overrideStatusBar){const e=k.default.mergeStyles([k.default.createBackgroundColorStyle(A.Color.black),k.default.createBarStyle(P.BarStyleTheme.Light),k.default.createHiddenStyle(!1)]);this._updateStatusBarStyle(e)}this.state.isExpanded&&!this.props.preventAccessibilityFocus&&this._centerControls&&(u.log(c.LogTraceArea.MediaPickerPanel,"componentDidMount, focus center controls"),this._focusCenterControlWithDelay())}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this._hasShownAlbum||this.state.showAlbumPicker||(this._hasShownAlbum=!0);const i=this._mediaPickerMode();if(i!==l.MediaPickerMode.Default){if(this.props.thumbnailPeek===e.thumbnailPeek&&this.state.viewDimensions.height===t.viewDimensions.height||this.state.isExpanded||this._expandOrCollapse(this.state.isExpanded,!1),this.props.hidden!==e.hidden){const e=this.props.hidden||i===l.MediaPickerMode.InlinePeekaboo;this._expandOrCollapse(!e)}this.props.onExpanded&&this.state.isExpanded!==t.isExpanded&&this.props.onExpanded(this.state.isExpanded),this.state.isExpanded&&!t.isExpanded&&!this.props.preventAccessibilityFocus&&this._centerControls&&(u.log(c.LogTraceArea.MediaPickerPanel,"componentDidUpdate, focus center controls"),this._focusCenterControlWithDelay())}}handleBackAction(){return!(!this.state.isExpanded||this._mediaPickerMode()!==l.MediaPickerMode.InlinePeekaboo)&&(this._expandOrCollapse(!1),!0)}expandOrCollapse(e,t=!0){this._expandOrCollapse(e,t)}_mediaPickerMode(){return this.props.mediaPickerMode||l.MediaPickerMode.Default}_focusCenterControlWithDelay(){const e=this._getContext().isPresentedByMobileStackNavigator?100:500;i.delay((()=>{this.isComponentMounted()&&this.state.isExpanded&&this._centerControls&&(u.log(c.LogTraceArea.MediaPickerPanel,"Focussed center controls after delay: "+e),this._centerControls.requestFocus())}),e)}_expandOrCollapse(e,t=!0,s=!0){if(0===this.state.viewDimensions.height)return;const i=B+this.state.statusBarPadding,n=this.props.hidden?-60:this.props.thumbnailPeek||-60,r=e?0:this.state.viewDimensions.height-i-n,a=e?0:-1*(i+50),d=e?1:.75,h=this.state.viewDimensions.height-i-r;if(this.state.isExpanded!==e&&(this.props.onExpanded&&this.props.onExpanded(e),e||this.props.mediaPickerMode!==l.MediaPickerMode.InlinePeekaboo||this.props.hidden||this._mediaPickerWrapperView&&this._mediaPickerWrapperView.scrollToTop()),u.log(c.LogTraceArea.MediaPickerPanel,"_expandOrCollapse",e),t){const t=300;o.Animated.parallel([C.default.timing(this._contentAnimatedTransfromValue,{toValue:r,duration:t,easing:e||this.props.hidden?o.Animated.Easing.Out():o.Animated.Easing.OutBack(),useNativeDriver:!0}),C.default.timing(this._contentAnimatedOpacityValue,{toValue:d,duration:t,easing:o.Animated.Easing.Out(),useNativeDriver:!0}),C.default.timing(this._headerAnimatedTransfromValue,{toValue:a,duration:t,easing:o.Animated.Easing.Out(),useNativeDriver:!0})]).start((t=>{this.state.isExpanded!==e&&s&&this.isComponentMounted()&&this.setState({isExpanded:e}),this._isDragging=!1})),this.props.mediaPickerMode===l.MediaPickerMode.InlinePeekaboo&&o.Animated.timing(this._emptyViewAnimatedHeightValue,{toValue:h,duration:t,easing:o.Animated.Easing.Out()}).start()}else this._contentAnimatedTransfromValue.setValue(r),this._contentAnimatedOpacityValue.setValue(d),this._headerAnimatedTransfromValue.setValue(a),this.props.mediaPickerMode===l.MediaPickerMode.InlinePeekaboo&&this._emptyViewAnimatedHeightValue.setValue(h),this.state.isExpanded!==e&&s&&this.isComponentMounted()&&this.setState({isExpanded:e}),this._isDragging=!1;this._contentTransform=r}render(){let e=[V.header.container,this._headerAnimatedTransfromStyle];this.state.statusBarPadding&&e.push(M.default.heightStyle(D+this.state.statusBarPadding));const t=o.createElement(y.default,{key:"mediapickernative",ref:this._onMediaPickerWrapperViewRef,maxSelectionCount:this.state.maxSelectionCount,disableGifs:this.state.disableGifs,mediaType:this.props.allowVideo?l.MediaType.All:l.MediaType.PhotoOnly,albumName:this.state.currentAlbumName,disableScrolling:!this.state.isExpanded,darkTheme:!0,pauseLoading:this.props.pauseLoading||this.props.defaultToAlbums&&!this.state.currentAlbumName,onClose:this._onClose,onItemSelected:this._onMediaItemSelected,onReset:this._onMediaPickerReset,onScrolledToTop:this._onScrolledToTop,onPhotosLoaded:this._onPhotosLoaded,screenChangeOnSelection:this.props.screenChangeOnSelection}),s=[V.emptyViewWrapper];this.props.mediaPickerMode===l.MediaPickerMode.InlinePeekaboo?s.push(this._emptyViewAnimatedHeightStyle):s.push(V.emptyViewWrapperFullHeight);const i=this.state.hasPhotos?void 0:o.createElement(o.Animated.View,{key:"emptyWrapper",style:s,blockPointerEvents:!0},o.createElement(x.BodyText,{size:x.BodyTextSize.BigDeprecated,style:V.emptyViewText},m.getString("MediaPickerPanel.EmptyAlbumMessage")));let n=this.state.hasPhotos?t:i;const r=this._mediaPickerMode();r!==l.MediaPickerMode.Default&&(r===l.MediaPickerMode.InlinePeekaboo&&(n=o.createElement(o.GestureView,{style:F.default.flexOne,onPanVertical:!this.state.isExpanded||this.state.isScrolledToTop?this._onPanVertical:this._onPan,panPixelThreshold:20,releaseOnRequest:!0,importantForAccessibility:o.Types.ImportantForAccessibility.No},n)),n=o.createElement(o.Animated.View,{key:"content",style:[F.default.flexOne,this._contentAnimatedStyle,this._contentAnimatedOpacityStyle],importantForAccessibility:this.state.showAlbumPicker?o.Types.ImportantForAccessibility.NoHideDescendants:o.Types.ImportantForAccessibility.No},n));const a=this.state.showAlbumPicker?o.createElement(o.View,{key:"albumpicker",style:V.modal},o.createElement(S.MediaAlbumPicker,{disableGifs:this.state.disableGifs,onClose:this._onCloseAlbumPicker,mediaType:this.props.allowVideo?l.MediaType.All:l.MediaType.PhotoOnly})):void 0,d=[V.panel];r!==l.MediaPickerMode.Default&&d.push(V.panelInline);const c={icon:r===l.MediaPickerMode.InlinePeekaboo?E.SkypeIcon.DownChevron:R.closeIcon(),title:m.getString("MediaPickerPanel.CloseMediaPanelAccessibilityLabel"),onPress:this._onClose,color:A.Color.white},h=this.state.selectedItemsCount>1&&!this._isMediaPreviewEnabled(),u=this.props.allowMultiple&&(this.state.selectedItemsCount>0||h)?{icon:h?E.SkypeIcon.Send:R.navForwardIcon(!0),title:h?m.getString("Global.SendButtonTitle"):m.getString("Global.NextButtonTitle"),color:A.Color.blue,onPress:this._onNext,flipIcon:h&&this._getContext().isRTL}:void 0,p=this.state.isMobileScreenReaderEnabled?void 0:o.createElement(o.GestureView,{style:V.gestureOverlay});return o.createElement(o.View,{style:d,onLayout:this._onLayoutChanged,ignorePointerEvents:!0,importantForAccessibility:this.props.preventAccessibilityFocus||!this.state.isExpanded?o.Types.ImportantForAccessibility.NoHideDescendants:void 0},o.createElement(o.Animated.View,{key:"header",style:e,importantForAccessibility:this.state.showAlbumPicker?o.Types.ImportantForAccessibility.NoHideDescendants:void 0},p,o.createElement(w.SimplePanelHeader,{titleView:this._getHeaderCenterControls(),leftButton:c,rightButtons:u,useTransparentBackground:!0})),n,a)}_getHeaderCenterControls(){const e=0===this.state.selectedItemsCount,t=e?this.state.currentAlbumName||m.getString("MediaPickerPanel.Title"):m.getString("MediaPickerPanel.SelectedTitle",{count:this.state.selectedItemsCount,total:this.state.maxSelectionCount}),s=e?o.createElement(h.default,{icon:E.SkypeIcon.DownChevron,size:E.IconSize.size12,color:A.Color.white}):void 0,i=e?d.default.combinedAccessibilityLabel(t,m.getString("MediaPickerPanel.ChangeAlbum")):m.getString("MediaPickerPanel.SelectedAccessibilityTitle",{count:this.state.selectedItemsCount,total:this.state.maxSelectionCount});return o.createElement(o.View,{style:V.header.headerControlWrap,onPress:e?this._onAlbumChange:void 0,ref:this._onCenterControlsRef,accessibilityTraits:e?o.Types.AccessibilityTrait.Button:void 0,accessibilityLabel:i,importantForAccessibility:this.state.isExpanded?o.Types.ImportantForAccessibility.Yes:o.Types.ImportantForAccessibility.NoHideDescendants,tabIndex:0},o.createElement(o.View,{style:V.header.innerContainer},o.createElement(x.PanelHeader,{style:V.header.title,numberOfLines:1},t),s))}_close(){const e=O.default.newCauseId();u.log(c.LogTraceArea.MediaPickerPanel,"MediaPickerPanel._close, causeId: "+e),this._removeStatusBarStyle(),this._mediaPickerMode()===l.MediaPickerMode.InlinePeekaboo?this._expandOrCollapse(!1):this.props.onBackPressed&&this.props.onBackPressed()||b.default.closeMediaPickerPanel(e,this._getContext())}_editSelectedPhoto(){if(0===this.state.selectedItems.length)return;const e=this.state.selectedItems;this._editMediaSelection(e)}_editMediaSelection(e){if(!e)return;const t=this.props.capturedContentHandler;if(!t)return;const s=e.map((e=>{const s=e.node,i=!s.node.isPhoto,o=s.node.image.thumbnailUri;return{localMediaObjectUri:s.node.image.uri,fileSize:void 0,width:s.node.image.width,height:s.node.image.height,localMediaThumbnailUri:o,localMediaIsVideo:i,mediaSelection:e,conversationId:this.props.conversationId,onCaptureFlowComplete:this._onSendFlowComplete,capturedContentHandler:t,captureSessionTelemetry:this._captureSessionTelemetry,entryPoint:c.PostSource.MediaPicker,unlockOrientation:!0,skipShareWithPanel:!!this.props.conversationId,onReject:this._onClose}}));this.props.onHandleEditMediaSelection?this.props.onHandleEditMediaSelection(s):b.default.navigateToCapturePreview(s[0])}_sendSelectedPhotos(e){if(!this.props.conversationId)return void u.error(c.LogTraceArea.MediaPickerPanel,"MediaPickerPanel: must have a conversationId to send multiple photos. causeId:"+e);const t=this.state.selectedItems,s=this._captureSessionTelemetry;delete this._captureSessionTelemetry,s&&s.setMediaCount(t.length),f.default.postMediaSelections(t,this.props.conversationId,c.PostSource.MediaPicker,{},s,e),this._close()}_exceedsMaxVideoLength(e){const t=60*this.state.maxVideoDurationOnMobileMin+1,s=!e.node.node.isPhoto&&e.node.node.image.duration;if(s&&s>=t){n.default.showOKAlert("",m.getString("MediaPickerPanel.ItemCannotBeSelected",{count:this.state.maxVideoDurationOnMobileMin}),this._getRootViewId());const e=O.default.newCauseId();u.log(c.LogTraceArea.MediaPickerPanel,"MediaPickerPanel._exceedsMaxVideoLength: Max Video Length Exceeded"+e);const t=new v.FileRejectedByClient(L.UploadFileType.Video,c.PostSource.MediaPicker,v.FileRejectedReason.VideoDuration),i=+(s/60).toFixed(2);return t.setVideoDurationDetails(this.state.maxVideoDurationOnMobileMin,i),u.track(t),!0}return!1}}t.MediaPickerPanel=N,t.default=N},23752:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(1706),r=s(89391),a=s(38173),l=s(82773),d=s(22801),c=s(76621),h=s(51077),u=s(61375),p=s(71830),g=s(984),m=s(17677),S=s(3871),f=s(77381),y=s(39549),_=s(82261),v=s(86374),C=s(52262),b=s(70891),T=s(46096),M=s(36400),I=s(36237),w=s(15877),P=s(40522),k=s(33754),A=s(12762),E=s(12762),R=s(75043),L=s(44972),F=s(18078),x=s(4735),O=s(85207),D=s(29130),B=s(14976),V=s(29034),N=s(79829),U=s(77914),H=s(960),z=s(4057),W=s(81531),j=s(81760),G=s(11010),K=s(60305),q=s(19675),Q=s(3109),X=s(77878),$=s(26712),J=s(53374),Y=(0,w.lazyProperties)({messageContentsViewContainer:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),atMentionMe:()=>o.Styles.createTextStyle({font:G.default.font.uiDisplaySemibold,color:j.Color.orange}),mentionIconStyle:()=>o.Styles.createTextStyle({color:j.Color.whiteOverlay50,backgroundColor:j.Color.transparent,marginTop:-3,marginBottom:4}),inlineViewWrapper:()=>o.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap"}),reportedMessageStyle:()=>o.Styles.createTextStyle({fontStyle:"italic"}),translationContainer:()=>o.Styles.createViewStyle({flexDirection:"column"}),translateLinkStyleRight:()=>o.Styles.createTextStyle({textAlign:"right"}),translateLinkStyleLeft:()=>o.Styles.createTextStyle({textAlign:"left"}),translateLinkHoveredStyle:()=>o.Styles.createTextStyle({opacity:1})});class Z extends f.default{constructor(){super(...arguments),this._onToggleTranslationPressed=()=>{this.props.options&&this.props.options.onToggleTranslation&&this.props.options.onToggleTranslation()}}_buildState(e,t){const s={isOwnMessage:F.default.isMyMri(e.message.creator),enableMessageTranslation:r.default.getS4LCMCFeatures().enableMessageTranslation};t&&(s.onFollowQuoteLinkDefault=(e,t,s)=>{if(e.preventDefault(),c.default.getConversationMetaFromMemoryCache(t)){const e=J.default.newCauseId();I.log(T.LogTraceArea.MessageContent,"MessageContent.onFollowQuoteLinkDefault, causeId: "+e),x.default.navigateToConversation({convId:t,scrollToTimestamp:s,forceRefreshFocus:!0,origin:T.NavigationConversationOrigin.QuoteLink,causeId:e})}},s.onSwiftReplyActionLinkDefault=(t,s,i=[])=>{t.preventDefault();const o=_.createSwiftResponseMessageInfo(e.message.conversationId,T.PostSource.SwiftReply,s,i,e.message.creator);O.default.postMessage(o)},s.onSwiftSkypeUriActionLinkDefault=(t,s,i)=>{t.preventDefault();const o=J.default.newCauseId();I.log(T.LogTraceArea.MessageContent,"MessageContent.onSwiftSkypeUriActionLinkDefault, causeId: "+o);const r=s.substring(6),l=r.split("?")[0];if("add_to_this_conversation"===r.split("?")[1]){const t=(0,y.default)().getConversation(e.message.conversationId);if(t&&t.isThread()){const s=(0,L.isModerated)(t);d.default.serviceAddMemberToThread(e.message.conversationId,l,u.AddMemberToThreadSource.SwiftCard,!s).fail((()=>{I.log(T.LogTraceArea.MessageContent,"Could not add "+B.mriOrId(l)+" to "+B.mriOrId(e.message.conversationId)+": Chat service request failed.")}))}else if(g.default.isContact(l))c.default.ensureConversationLoadedOrFaked(l,T.ConversationFakedOrigin.NotContactSwiftCard).then((()=>{x.default.navigateToConversation({convId:l,origin:T.NavigationConversationOrigin.SwiftCardLink,causeId:o})}));else{let e=n.default.getAgentDescriptionForMri(l);a.default.addAgentAsContact(e.agentId).then((()=>{c.default.ensureConversationLoadedOrFaked(l,T.ConversationFakedOrigin.ContactSwiftCard).then((e=>{x.default.navigateToConversation({convId:l,isNewConversation:!0,origin:T.NavigationConversationOrigin.SwiftCardLink,causeId:o})}))}),(()=>{I.log(T.LogTraceArea.MessageContent,"Failed to add agent from the swift card")}))}}else I.log(T.LogTraceArea.MessageContent,"Unsupported skype uri query")},s.onOAuthActionLinkDefault=(t,s,o)=>{t.preventDefault();const n=J.default.newCauseId();if(I.log(T.LogTraceArea.MessageContent,"MessageContent.onOAuthActionLinkDefault, causeId: "+n),s&&o){let t=s+"&userid="+encodeURIComponent(F.default.getSkypeId())+"&threadid="+encodeURIComponent(e.message.conversationId);$.default.isUrlValid(t)&&P.openUrlWithParams({origin:T.BrowserOrigin.AuthActionLink,url:t,options:{onNavigationStateChange:e=>{i.startsWith(e.url,o)&&x.default.closeInAppBrowser(n,this._getContext())}},rootViewId:this._getRootViewId()})}},s.onCallInviteAccepted=t=>{U.default.acceptInvitation(t),I.track(new V.ScheduledCallRSVPEvent(N.ScheduleCallRSVPEntryPoint.MessageStream,N.ScheduledCallInvitationStatus.Accepted,e.message.conversationId,t))},s.onCallInviteDeclined=t=>{U.default.declineInvitation(t),I.track(new V.ScheduledCallRSVPEvent(N.ScheduleCallRSVPEntryPoint.MessageStream,N.ScheduledCallInvitationStatus.Declined,e.message.conversationId,t))});const o=i.cloneDeep(e.options||{});let f;if(o.message=e.message,s.isOwnMessage||g.default.isConversationAccepted(e.message.conversationId)||(o.blurMedia=!0,o.processing=o.processing||{},o.processing.links=b.ProcessingLevel.Stripped),o.onFollowQuoteLink||(o.onFollowQuoteLink=s.onFollowQuoteLinkDefault||this.state.onFollowQuoteLinkDefault),o.onSwiftReplyActionLink||(o.onSwiftReplyActionLink=s.onSwiftReplyActionLinkDefault||this.state.onSwiftReplyActionLinkDefault),o.onSwiftSkypeUriActionLink||(o.onSwiftSkypeUriActionLink=s.onSwiftSkypeUriActionLinkDefault||this.state.onSwiftSkypeUriActionLinkDefault),o.atMentionMeOverrideStyle||(o.atMentionMeOverrideStyle=Y.atMentionMe),e.message.properties&&e.message.properties[h.MessageProperties.Prototype]&&(o.swiftCardState=z.default.parseJsonWithDefault(e.message.properties[h.MessageProperties.Prototype],{}),o.swiftCardState.disableActions=e.disableActions),o.swiftCardState||(o.swiftCardState={disableActions:e.disableActions}),o.isMobileScreenSize||(o.isMobileScreenSize=D.default.isMobileScreenSize(this._getRootViewId())),o.onOAuthActionLink||(o.onOAuthActionLink=s.onOAuthActionLinkDefault||this.state.onOAuthActionLinkDefault),o.onCallInviteAccepted||(o.onCallInviteAccepted=s.onCallInviteAccepted||this.state.onCallInviteAccepted),o.onCallInviteDeclined||(o.onCallInviteDeclined=s.onCallInviteDeclined||this.state.onCallInviteDeclined),e.wrapInQuote){const t=C.default.getDisplayName(e.message.creator,!0),s=m.quoteMessage(e.message,t);f=v.Parser.root([s])}else f=e.preDecodedMessage||v.decode(e.message),s.enableMessageTranslation&&o.hasTranslation&&(f=this._maybeTranslateQuotes(e,f,o));o.textOnlyForEmoticons=f.getNumberOfEmoticons()>r.default.dangerouslyGetS4LMessagingFeatures().maxNumberEmoticonsPerMessage,o.onPressSuggestedTextHighlight=t=>{let s=i.find(o.suggestedTextHighlights,(e=>e.phrase===t));if(!s||!s.sanitizedAction)return;const n=s.sanitizedAction;switch(n.type){case b.SwiftActionTypes.openUrl:W.default.handleOpenUrl(n,e.message.conversationId,this._getRootViewId());break;case b.SwiftActionTypes.openView:W.default.handleOpenView(n,e.message.conversationId,this._getRootViewId());case b.SwiftActionTypes.invoke:}W.default.textHighlightPressedTelemetry(n,e.message)};const M=e.message.messagetype===h.MessageTypes.Text,w=e.message.messagetype===h.MessageTypes.RichText,k=p.isAgent(e.message.creator);let A,E,H;if(e.message.isReported())A=this._renderReportedMessage(o);else if(o.urlPreviewData)A=S.renderLinkAsPreview(o);else{const t=h.isDoNotFormatType(e.message.properties),i=p.isPhoneMri(e.message.conversationId),n=!t&&!i&&(M||w&&k),a=!t,d=t=>{let s=Q.extraTextNodeParsing(t,n,a,e.options&&e.options.suggestedTextHighlights);return s=(0,X.transformUnicodeEmojis)(s),s=this._maybeHighlightSearchResults(e,s),S.renderReact(s,o,e.searchStore)};A=d(f);const{enableBookmarks:c}=r.default.getS4LMessagingFeatures();if(c&&(M||w)&&e.message.isBookmark()){const t=l.default.getBookmarkEditedMessage(e.message.cuid,e.message);if(t){I.log(T.LogTraceArea.Bookmarks,"Rendering new version of bookmark message.");E=d(v.decode(t))}}if(s.enableMessageTranslation&&o.hasTranslation){const t=R.default.getTranslatedMessage(e.message.conversationId,e.message.cuid);if(t){let i=v.decode(t);if(e.wrapInQuote){const e=C.default.getDisplayName(t.creator,!0),s=m.quoteMessage(t,e);i=v.Parser.root([s])}else if(h.hasQuote(e.message.content)){let t=f.getQuoteNodes();t=t.map((t=>this._translateQuoteNode(e.message.conversationId,t,!!s.isOwnMessage,!0))),i=v.Parser.root(t.concat([i]))}H=d(i)}}}return s.renderEditedBookmarkResult=E,s.renderTranslatedReact=H,s.renderResult=A,s}render(){const e=this._getContentElement(),{renderAtMentionSymbol:t}=this.props,s=this.state.renderTranslatedReact&&!K.default.isTablet(),n=i.compact([t&&this._getAtMentionElement(),...i.isArray(e)?e:[e],s&&this._getTranslateLink()]);if(this.state.renderResult.renderAsInline&&1===n.length)return e;const r=this.state.renderResult.renderAsInline&&!t,a=[r?Y.inlineViewWrapper:Y.messageContentsViewContainer,this.state.renderTranslatedReact&&Y.translationContainer];return o.createElement(o.View,{key:this.props.message.cuid,style:a,onLayout:r?void 0:this.props.onLayout},n)}_renderReportedMessage(e){const t=E.PlainTextNode.fromPlainText(k.getString("MessageContentNodes.ReportedMessageFallback")),s=v.Parser.root([t]);return e.textOverrideStyle=o.Styles.combine(e.textOverrideStyle,Y.reportedMessageStyle),S.renderReact(s,e,this.props.searchStore)}_maybeHighlightSearchResults(e,t){let s=!1;const i=F.default.isMyMri(e.message.creator),o=e.searchStore;let n;if(o){if(o.isMessageInConvSearchResults(e.message.cuid)){const t=o.getSearchQuery();t&&(s=o.isMessageFocused(e.message.cuid),n=t.query)}}else n=e.rawSearchQuery;return n&&(t=(0,H.highlightSearchResults)(t,n,s,i)),t}_maybeTranslateQuotes(e,t,s){if(s.showTranslatedMessage)return t;const o=F.default.isMyMri(e.message.creator),n=t.getQuoteNodes().map((t=>this._translateQuoteNode(e.message.conversationId,t,o,!1)));return v.Parser.root(n.concat(i.filter(t.children,(e=>!(e instanceof A.QuoteNode)))))}_translateQuoteNode(e,t,s,i){if(t&&t.cuid){const o=R.default.getTranslatedMessage(e,t.cuid);if(o){if(i!==(F.default.isMyMri(o.creator)!==s)){const e=C.default.getDisplayName(o.creator,!0);return m.quoteMessage(o,e)}}}return t}_getAtMentionElement(){return o.createElement(q.BodyText,{key:"atMention",size:q.BodyTextSize.BigDeprecated,style:[Y.mentionIconStyle,this.props.atMentionSymbolStyle]},"@")}_getContentElement(){return this.props.message.isBookmark()&&this.state.renderEditedBookmarkResult?this.state.renderEditedBookmarkResult.value:this.state.renderTranslatedReact&&i.get(this.props,["options","showTranslatedMessage"])?this.state.renderTranslatedReact.value:this.state.renderResult.value}_getTranslateLink(){if(!this.props.options||this.props.wrapInQuote)return null;const e=`${this.props.message.cuid}-link`,t=[this.props.options.translationLinkStyle,G.default.fontStyle.captionSelected,this.state.isOwnMessage?Y.translateLinkStyleRight:Y.translateLinkStyleLeft],s=this.props.options.showTranslatedMessage?k.getString("Translator.MessageShowOriginal"):k.getString("Translator.MessageShowTranslation"),i=this.props.options.showTranslatedMessage?k.getString("Translator.MessageShowTranslation"):k.getString("Translator.MessageShowOriginal");return o.createElement(o.View,{accessibilityLabel:i,accessibilityTraits:o.Types.AccessibilityTrait.Switch,onPress:this._onToggleTranslationPressed,importantForAccessibility:o.Types.ImportantForAccessibility.Yes},o.createElement(M.HoverableLink,{key:e,url:"#",style:t,hoverStyle:Y.translateLinkHoveredStyle,onPress:this._onToggleTranslationPressed},s))}}t.default=Z},76093:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(63297),o=s(16778),n=s(89391),r=s(38566),a=s(51077),l=s(70891),d=s(46096),c=s(74313),h=s(36400),u=s(13944),p=s(10117),g=s(36237),m=s(15877),S=s(40522),f=s(33754),y=s(65822),_=s(12056),v=s(20849),C=s(17707),b=s(58962),T=s(86045),M=s(34907),I=s(81760),w=s(11010),P=s(11828),k=s(19675),A=s(24576),E=s(94214),R=s(75865),L=s(53374),F=s(3729),x=(0,m.lazyProperties)({mojiContainer:()=>o.Styles.createViewStyle({flexDirection:"row"}),playButtonContainer:()=>o.Styles.createViewStyle({backgroundColor:I.Color.blackOverlay50,alignItems:"center",justifyContent:"center",width:64,height:64,borderRadius:32}),playButtonContainerMedium:()=>o.Styles.createViewStyle({width:48,height:48,borderRadius:24}),alternateTextLink:()=>o.Styles.createTextStyle({lineHeight:16}),alternateTextLinkDarkTheme:()=>o.Styles.createTextStyle({color:I.Color.white}),alternateTextLinkHover:()=>o.Styles.createTextStyle({color:I.Color.blue}),metadataContainer:()=>o.Styles.createViewStyle({marginTop:8,marginHorizontal:8,flex:-1}),metadataPreview:()=>o.Styles.createViewStyle({marginLeft:-44}),description:()=>o.Styles.createTextStyle({lineHeight:16}),descriptionDarkTheme:()=>o.Styles.createTextStyle({color:I.Color.gray200}),copyright:()=>o.Styles.createTextStyle({lineHeight:16}),copyrightDarkTheme:()=>o.Styles.createTextStyle({color:I.Color.gray200}),metdataTextRight:()=>o.Styles.createTextStyle({textAlign:"right",lineHeight:16}),metdataTextBottom:()=>o.Styles.createTextStyle({textAlign:"center"}),mojiContainerCentered:()=>o.Styles.createViewStyle({alignSelf:"center"}),replayButtonContainer:()=>o.Styles.createViewStyle({flexDirection:"column",paddingHorizontal:60}),replayButton:()=>o.Styles.createViewStyle({justifyContent:"center",position:"absolute",width:P.IconSize.size60,top:0,right:0,left:0,bottom:0}),sendButtonWrapper:()=>o.Styles.createViewStyle({position:"absolute",right:0,left:0,top:0,bottom:0,flex:1,alignItems:"center",justifyContent:"center",backgroundColor:I.Color.blueOverlay70}),transparentView:()=>o.Styles.createViewStyle({opacity:0}),opaqueView:()=>o.Styles.createViewStyle({opacity:1}),flippedView:()=>o.Styles.createViewStyle({transform:[{scaleX:-1}]})}),O=(0,m.lazyProperties)({mojiExtraLarge:()=>({mojiVideoContainer:o.Styles.createButtonStyle({width:b.frameHeights.moji.Size232,height:b.frameHeights.moji.Size232,alignItems:"center",justifyContent:"center"}),mojiMaskSize:b.frameHeights.moji.Size232,mojiMask:o.Styles.createTextStyle({position:"absolute",top:0,left:0,fontSize:b.frameHeights.moji.Size232+4,width:b.frameHeights.moji.Size232+4,height:b.frameHeights.moji.Size232+4}),mojiPlaceholder:o.Styles.createViewStyle({width:b.frameHeights.moji.Size232,height:b.frameHeights.moji.Size232,backgroundColor:I.Color.gray200,justifyContent:"center",alignItems:"center"}),thumbnailContainer:o.Styles.createViewStyle({width:b.frameHeights.moji.Size232,height:b.frameHeights.moji.Size232,alignItems:"center",justifyContent:"center"}),thumbnailImage:o.Styles.createImageStyle({position:"absolute",top:0,left:0,width:b.frameHeights.moji.Size232,height:b.frameHeights.moji.Size232}),video:o.Styles.createViewStyle({position:"absolute",top:0,left:0,width:b.frameHeights.moji.Size232,height:b.frameHeights.moji.Size232}),sendButtonSize:P.IconSize.size24}),mojiLarge:()=>({mojiVideoContainer:o.Styles.createButtonStyle({width:b.frameHeights.moji.Size200,height:b.frameHeights.moji.Size200,alignItems:"center",justifyContent:"center"}),mojiMaskSize:b.frameHeights.moji.Size200,mojiMask:o.Styles.createTextStyle({position:"absolute",top:0,left:0,fontSize:b.frameHeights.moji.Size200,width:b.frameHeights.moji.Size200,height:b.frameHeights.moji.Size200}),mojiPlaceholder:o.Styles.createViewStyle({width:b.frameHeights.moji.Size200,height:b.frameHeights.moji.Size200,backgroundColor:I.Color.gray200,justifyContent:"center",alignItems:"center"}),thumbnailContainer:o.Styles.createViewStyle({width:b.frameHeights.moji.Size200,height:b.frameHeights.moji.Size200,alignItems:"center",justifyContent:"center"}),thumbnailImage:o.Styles.createImageStyle({position:"absolute",top:0,left:0,width:b.frameHeights.moji.Size200,height:b.frameHeights.moji.Size200}),video:o.Styles.createViewStyle({position:"absolute",top:0,left:0,width:b.frameHeights.moji.Size200,height:b.frameHeights.moji.Size200}),sendButtonSize:P.IconSize.size20}),mojiMedium:()=>({mojiVideoContainer:o.Styles.createButtonStyle({width:b.frameHeights.moji.Size108,height:b.frameHeights.moji.Size108,alignItems:"center",justifyContent:"center"}),mojiMaskSize:b.frameHeights.moji.Size108+10,mojiMask:o.Styles.createTextStyle({position:"absolute",top:0,left:0,fontSize:b.frameHeights.moji.Size108+1,width:b.frameHeights.moji.Size108+1,height:b.frameHeights.moji.Size108+1}),mojiPlaceholder:o.Styles.createViewStyle({width:b.frameHeights.moji.Size108,height:b.frameHeights.moji.Size108,backgroundColor:I.Color.gray200,justifyContent:"center",alignItems:"center"}),thumbnailContainer:o.Styles.createViewStyle({width:b.frameHeights.moji.Size108,height:b.frameHeights.moji.Size108,alignItems:"center",justifyContent:"center"}),thumbnailImage:o.Styles.createImageStyle({position:"absolute",top:0,left:0,width:b.frameHeights.moji.Size108,height:b.frameHeights.moji.Size108}),video:o.Styles.createViewStyle({position:"absolute",top:0,left:0,width:b.frameHeights.moji.Size108,height:b.frameHeights.moji.Size108,borderRadius:16}),sendButtonSize:P.IconSize.size24}),mojiMediumSmall:()=>({mojiVideoContainer:o.Styles.createButtonStyle({width:b.frameHeights.moji.Size80,height:b.frameHeights.moji.Size80,alignItems:"center",justifyContent:"center"}),mojiMaskSize:b.frameHeights.moji.Size80+4,mojiMask:o.Styles.createTextStyle({position:"absolute",top:0,left:0,fontSize:b.frameHeights.moji.Size80+4,width:b.frameHeights.moji.Size80+4,height:b.frameHeights.moji.Size80+4}),mojiPlaceholder:o.Styles.createViewStyle({width:b.frameHeights.moji.Size80,height:b.frameHeights.moji.Size80,backgroundColor:I.Color.gray200,justifyContent:"center",alignItems:"center"}),thumbnailContainer:o.Styles.createViewStyle({width:b.frameHeights.moji.Size80,height:b.frameHeights.moji.Size80,alignItems:"center",justifyContent:"center"}),thumbnailImage:o.Styles.createImageStyle({position:"absolute",top:0,left:0,width:b.frameHeights.moji.Size80,height:b.frameHeights.moji.Size80}),video:o.Styles.createViewStyle({position:"absolute",top:0,left:0,width:b.frameHeights.moji.Size80,height:b.frameHeights.moji.Size80}),sendButtonSize:P.IconSize.size16}),mojiSmall:()=>({mojiVideoContainer:o.Styles.createButtonStyle({width:b.frameHeights.moji.Size40,height:b.frameHeights.moji.Size40,alignItems:"center",justifyContent:"center"}),mojiMaskSize:b.frameHeights.moji.Size40+2,mojiMask:o.Styles.createTextStyle({position:"absolute",top:0,left:0,fontSize:b.frameHeights.moji.Size40+2,width:b.frameHeights.moji.Size40+2,height:b.frameHeights.moji.Size40+2}),mojiPlaceholder:o.Styles.createViewStyle({width:b.frameHeights.moji.Size40,height:b.frameHeights.moji.Size40,backgroundColor:I.Color.gray200,justifyContent:"center",alignItems:"center"}),thumbnailContainer:o.Styles.createViewStyle({width:b.frameHeights.moji.Size40,height:b.frameHeights.moji.Size40,alignItems:"center",justifyContent:"center"}),thumbnailImage:o.Styles.createImageStyle({position:"absolute",top:0,left:0,width:b.frameHeights.moji.Size40,height:b.frameHeights.moji.Size40}),video:o.Styles.createViewStyle({position:"absolute",top:0,left:0,width:b.frameHeights.moji.Size40,height:b.frameHeights.moji.Size40}),sendButtonSize:P.IconSize.size16})});class D extends A.default{constructor(){super(...arguments),this._audioManagerClient=new r.default(r.AudioManagerSource.Moji),this._onCdnTokenRefresh=()=>{this.isComponentMounted()&&!this.state.isVideoLoaded&&this.setState({videoFailed:!1})},this._onAuxiliaryUrlLinkPress=()=>{this.state.mojiMetadata&&this.state.mojiMetadata.auxiliaryUrl&&S.openUrlWithParams({origin:d.BrowserOrigin.Moji,url:this.state.mojiMetadata.auxiliaryUrl,rootViewId:this._getRootViewId()})},this._onVideoWithTelemetryRef=e=>{this._videoWithTelemetry=e||void 0},this._onSend=e=>{e.stopPropagation(),this.props.isPreviewModeOn&&this.props.onSend()},this._onReplay=e=>{e.stopPropagation(),this.state.isVideoLoaded&&this._videoWithTelemetry&&(this._videoWithTelemetry.seek(0),this.setState({isPlaying:!0}))},this._onMojiContainerPress=e=>{e.stopPropagation(),T.default.isMobileScreenReaderEnabled()&&this._onPlayOrPause(e)},this._onPlayOrPause=e=>{e.stopPropagation(),this.state.isPlaying?this.setState({isPlaying:!1}):(this.setState({isPlaying:!0}),this.props.message&&g.track(new _.MessageContentClicked(this.props.message)))},this._onRetry=e=>{e.stopPropagation(),this.isComponentMounted()&&this.setState({thumbnailNotLoaded:!1,isVideoLoaded:!1,videoFailed:!1})},this._onEnded=()=>{this.isComponentMounted()&&this.setState({isPlaying:!1})},this._onCanPlay=()=>{this.isComponentMounted()&&(this.setState({isVideoLoaded:!0}),(this.props.isPreviewModeOn||this.props.autoPlay)&&this._playVideo())},this._onMojiError=()=>{this.isComponentMounted()&&!this.state.videoFailed&&(M.default.requestDebouncedCdnTokenRefresh(),this.setState({videoFailed:!0}))},this._onThumbnailError=()=>{this.isComponentMounted()&&!this.state.thumbnailNotLoaded&&this.setState({thumbnailNotLoaded:!0})},this._onThumbnailLoaded=()=>{this.isComponentMounted()&&this.setState({thumbnailNotLoaded:!1})}}_buildState(e,t){const s=n.default.getConfigSettings().pes.rewriteRules,i=b.rewriteUrl(e.src,s),o=i+"/views/meta."+f.getLocale(),r=this.props;let a=i+"/views/default",d=i+"/views/thumbnail";e.size===l.MojiSize.Small&&(d+="_120");let c=i;f.getLocale()!==C.default.getCurrentCachedPesLocal()&&(c=void 0);const h={contentUrl:R.default.getAuthenticatedUrl(a),thumbnailUrl:R.default.getAuthenticatedUrl(d),cdnToken:E.default.getCdnToken(),mojiMetadata:v.default.getMetadataForMoji(o,e.pesID,c)};(t||r.pesID!==e.pesID||r.src!==e.src)&&(h.isPlaying=!1,h.isVideoLoaded=!1,h.videoFailed=!1,h.thumbnailNotLoaded=!0,h.renderCounter=0),!t&&this.state.cdnToken!==h.cdnToken&&this.state.thumbnailNotLoaded&&(h.renderCounter=this.state.renderCounter+1,h.isVideoLoaded=!1,h.videoFailed=!1);const u=y.default.getActivePlayerToken();return!t&&this._playerToken!==u&&this.state.isPlaying&&(h.isPlaying=!1),h}_playVideo(){!this.state.isPlaying&&this._videoWithTelemetry&&this.setState({isPlaying:!0})}componentDidMount(){super.componentDidMount(),this._playerToken=y.default.registerAsPlayer(),M.default.refreshed.subscribe(this._onCdnTokenRefresh)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);const o=L.default.newCauseId();g.log(d.LogTraceArea.Moji,"Moji.componentDidUpdate causeId: "+o),!t.isPlaying&&this.state.isPlaying?this._audioManagerClient.requestMode(i.AudioModes.MojiPlayback,o).then((e=>{e&&this.isComponentMounted()&&(y.default.setAsActive(this._playerToken),this._videoWithTelemetry&&this._videoWithTelemetry.play())})):t.isPlaying&&!this.state.isPlaying&&(this._videoWithTelemetry&&this._videoWithTelemetry.pause(),this.state.isVideoLoaded&&T.default.isMobileScreenReaderEnabled()&&T.default.maybeAnnounceForAccessibility(f.getString("Moji.SendButtonTitle")),this._audioManagerClient.release(o))}componentWillUnmount(){super.componentWillUnmount();const e=L.default.newCauseId();g.log(d.LogTraceArea.Moji,"componentWillUnmount causeId",e),this._audioManagerClient.release(e),M.default.refreshed.unsubscribe(this._onCdnTokenRefresh)}_getStyle(e){switch(e){case l.MojiSize.Small:return O.mojiSmall;case l.MojiSize.Medium:return O.mojiMedium;case l.MojiSize.Large:return O.mojiLarge;case l.MojiSize.ExtraLarge:return O.mojiExtraLarge;default:return O.mojiMediumSmall}}render(){const e=this._getStyle(this.props.size),t=o.createElement(p.default,{icon:P.SkypeIcon.MojiMaskInverted,size:e.mojiMaskSize,color:this.props.borderColor,style:e.mojiMask});let s;if(this.state.mojiMetadata&&!this.props.hideMetadata){let e,t,i=[x.description],n=[w.default.fontStyle.captionSmall,x.copyright,this._themeStyles.secondaryTextColorStyle],r=[w.default.fontStyle.subtitle,x.alternateTextLink,this._themeStyles.primaryTextColorStyle];this.props.metadataPosition===l.MojiMetadataAlign.Bottom?(i.push(x.metdataTextBottom),n.push(x.metdataTextBottom),t=x.metdataTextBottom):this.props.metadataPosition===l.MojiMetadataAlign.Left&&(i.push(x.metdataTextRight),n.push(x.metdataTextRight),t=x.metdataTextRight),this.props.useTransparentDarkTheme&&(i.push(x.descriptionDarkTheme),n.push(x.copyrightDarkTheme),r.push(x.alternateTextLinkDarkTheme)),e=this.state.mojiMetadata.auxiliaryUrl?o.createElement(o.Text,{style:t,selectable:!0},o.createElement(h.HoverableLink,{style:r,hoverStyle:x.alternateTextLinkHover,disableHoverOpacityStyles:!0,url:this.state.mojiMetadata.auxiliaryUrl,onPress:this._onAuxiliaryUrlLinkPress},this.state.mojiMetadata.auxiliaryText)):o.createElement(k.Subtitle,{selectable:!0},this.state.mojiMetadata.auxiliaryText);let a=[x.metadataContainer];this.props.isPreviewModeOn&&this.props.metadataPosition===l.MojiMetadataAlign.Right&&a.push(x.metadataPreview),s=o.createElement(o.View,{style:a,importantForAccessibility:o.Types.ImportantForAccessibility.No,key:"metadata"},o.createElement(k.Caption,{style:i,selectable:!0,accessibilityHidden:!0},this.state.mojiMetadata.description),e,o.createElement(o.Text,{style:n,selectable:!0,importantForAccessibility:o.Types.ImportantForAccessibility.No},this.state.mojiMetadata.copyright))}const i=this.state.contentUrl?o.createElement(F.default,{origin:"Moji",key:"video",ref:this._onVideoWithTelemetryRef,style:[e.video,this.state.isPlaying?x.opaqueView:x.transparentView],source:this.state.contentUrl,onEnded:this._onEnded,onCanPlay:this._onCanPlay,onError:this._onMojiError,mediaProvider:l.MediaProvider.Moji,messagetype:a.MessageTypes.Media_FlikMsg}):void 0,n=o.createElement(o.View,{style:[e.thumbnailContainer,e.mojiPlaceholder]},o.createElement(p.default,{icon:P.SkypeIcon.Moji,size:P.IconSize.size32,color:I.Color.gray300})),r=o.createElement(o.View,{style:[e.thumbnailContainer,e.mojiPlaceholder]},o.createElement(p.default,{icon:P.SkypeIcon.MojiDeleted,size:P.IconSize.size32,color:I.Color.gray300})),d=o.createElement(c.default,{origin:"MojiThumbnail",key:"thumbnail"+this.state.renderCounter,style:e.thumbnailImage,source:this.state.thumbnailUrl,containerStyle:e.thumbnailImage,altView:n,errorView:r,resizeMode:"cover",onError:this._onThumbnailError,onLoad:this._onThumbnailLoaded});let g,m=[e.mojiVideoContainer];this.props.metadataPosition===l.MojiMetadataAlign.Bottom&&m.push(x.mojiContainerCentered);const S=!this.state.isPlaying&&this.state.isVideoLoaded;if(this.state.videoFailed){let e,s;if(this.state.thumbnailNotLoaded){const e=this.state.mojiMetadata&&this.state.mojiMetadata.pickerTitle?this.state.mojiMetadata.pickerTitle:"";s=f.getString("Moji.MojiTitle",{description:e})}else s=f.getString("Moji.RetryButtonTitle"),e=this._getRetryButton(this._onRetry);g=o.createElement(o.View,{key:"placeholderContainer",style:m,onPress:this.state.thumbnailNotLoaded?void 0:this._onRetry,onLongPress:this.props.onLongPress,title:s,activeOpacity:this.props.activeOpacityOverride||1},d,t,e)}else if(this.props.isPreviewModeOn){let s,n,r,a;if(S)this.props.showReplayButtonAfterPlay?(a=this._onReplay,s=this._getRetryButton(this._onReplay),r=f.getString("Moji.ReplayButtonTitle")):(r=f.getString("Moji.SendButtonTitle"),a=this._onSend,s=o.createElement(o.View,{style:x.sendButtonWrapper},o.createElement(p.default,{icon:P.SkypeIcon.Send,style:this._getContext().isRTL?x.flippedView:void 0,color:I.Color.white,size:e.sendButtonSize})));else{const e=this.state.mojiMetadata&&this.state.mojiMetadata.pickerTitle?this.state.mojiMetadata.pickerTitle:"";r=f.getString("Moji.MojiTitle",{pickerTitle:e}),a=this._onPlayOrPause}(S&&!this.props.showReplayButtonAfterPlay||T.default.isMobileScreenReaderEnabled())&&(n=o.createElement(u.default,{style:x.replayButton,title:f.getString("Moji.ReplayButtonTitle"),onPress:this._onReplay,onLongPress:this.props.onLongPress,size:P.IconSize.size24,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,icon:P.SkypeIcon.Reload,activeOpacity:this.props.activeOpacityOverride,disabled:!S})),g=o.createElement(o.View,{style:x.replayButtonContainer},o.createElement(o.Button,{key:"videoContainer",autoFocus:!0,style:m,onPress:a,onLongPress:this.props.onLongPress,title:r,activeOpacity:this.props.activeOpacityOverride||1,disabled:this.props.disableActions,disabledOpacity:1},d,i,s,t),n)}else{const e=this.props.size===l.MojiSize.Medium?P.IconSize.size40:P.IconSize.size60;let s;if(S){const t=[x.playButtonContainer];this.props.size===l.MojiSize.Medium&&t.push(x.playButtonContainerMedium),s=o.createElement(u.default,{key:"play",style:t,size:e,color:I.Color.white,hoverColor:I.Color.whiteOverlay70,icon:P.SkypeIcon.Play,activeOpacity:this.props.activeOpacityOverride})}g=o.createElement(o.Button,{key:"videoContainer",autoFocus:this.props.setAccessibilityFocusOnMoji,style:m,onPress:this._onPlayOrPause,onContextMenu:this.props.onContextMenu,onLongPress:this.props.onLongPress,title:this._getPlayMojiTitle(),activeOpacity:this.props.activeOpacityOverride||1,disabled:this.props.disableActions,disabledOpacity:1},d,i,t,s)}const y=this._getContainerStyle();return this.props.metadataPosition===l.MojiMetadataAlign.Bottom?o.createElement(o.View,{style:y},g,s):this.props.metadataPosition===l.MojiMetadataAlign.Left?o.createElement(o.View,{style:y,onPress:void 0},s,g):o.createElement(o.View,{style:y},g,s)}_getContainerStyle(){return this.props.metadataPosition===l.MojiMetadataAlign.Bottom?this.props.style:[x.mojiContainer,this.props.style]}_getRetryButton(e){const t=[x.playButtonContainer];return this.props.size===l.MojiSize.Medium&&t.push(x.playButtonContainerMedium),o.createElement(u.default,{style:t,key:"retry",title:f.getString("Global.RetryLabel"),onPress:e,onLongPress:this.props.onLongPress,size:this.props.size===l.MojiSize.Medium?P.IconSize.size40:P.IconSize.size60,color:I.Color.white,hoverColor:I.Color.whiteOverlay70,icon:P.SkypeIcon.Reload,importantForAccessibility:o.Types.ImportantForAccessibility.NoHideDescendants,activeOpacity:this.props.activeOpacityOverride})}_subscribeToThemeChanges(){return!1}_getPlayMojiTitle(){return this.state.mojiMetadata&&this.state.mojiMetadata.pickerTitle?f.getString("Moji.PlayMojiButtonTitle",{mojiName:this.state.mojiMetadata.pickerTitle}):void 0}}t.default=D},81357:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(62698),o=s(16778),n=s(38933),r=s(43632),a=s(74313),l=s(13944),d=s(33754),c=s(81760),h=s(11828),u=s(10117),p=s(97174),g=s(36237),m=s(15877),S=s(26424),f=s(79810),y=s(65042),_=s(35455),v=s(24576),C=(0,m.lazyProperties)({container:()=>o.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap",alignSelf:"stretch",paddingHorizontal:10}),iconButton:()=>o.Styles.createViewStyle({paddingRight:6}),iconButtonBackground:()=>o.Styles.createButtonStyle({width:32,height:32,borderRadius:16,borderWidth:1,borderStyle:"solid",borderColor:c.Color.gray200,alignItems:"center",justifyContent:"center"}),iconButtonNoBorder:()=>o.Styles.createButtonStyle({borderWidth:0}),stickerImage:()=>o.Styles.createViewStyle({width:20,height:20}),checkmark:()=>o.Styles.createViewStyle({position:"absolute",right:3,bottom:0,marginRight:0,flex:0,alignSelf:"center",width:14,height:14,borderRadius:14,borderWidth:1,borderStyle:"solid",alignItems:"center",justifyContent:"center",backgroundColor:c.Color.blueDark,borderColor:c.Color.white}),checkmarkIcon:()=>o.Styles.createViewStyle({padding:3.5})}),b={colors:[{key:"Blue",colorGradientStart:c.Color.blueLight,colorGradientEnd:c.Color.blueDark},{key:"Blueviolet",colorGradientStart:c.Color.blurpleLight,colorGradientEnd:c.Color.blurpleDark},{key:"Redviolet",colorGradientStart:c.Color.purpleLight,colorGradientEnd:c.Color.purpleDark},{key:"Red",colorGradientStart:c.Color.pinkLight,colorGradientEnd:c.Color.pinkDark},{key:"Orange",colorGradientStart:c.Color.orangeLight,colorGradientEnd:c.Color.orangeDark},{key:"White",colorGradientStart:c.Color.gray50,colorGradientEnd:c.Color.gray200}]};class T extends v.default{constructor(){super(...arguments),this._onSelectBackgroundColor=e=>{if(this.setState({selectedBackgroundColor:e}),this.props.onSelectBackgroundColorInfo){this.props.onSelectBackgroundColorInfo({key:e.key,colors:[e.colorGradientStart,e.colorGradientEnd]},this.props.iconEntity);const t={tabType:this.props.selectedTabType,triggeredBy:this.props.triggeredBy};g.track(new f.PesBackgroundColorTelemetryEvent(t))}},this._mapColorGradientToColorInfo=()=>{var e,t,s;return{key:null===(e=this.state.selectedBackgroundColor)||void 0===e?void 0:e.key,colors:[null===(t=this.state.selectedBackgroundColor)||void 0===t?void 0:t.colorGradientStart,null===(s=this.state.selectedBackgroundColor)||void 0===s?void 0:s.colorGradientEnd]}}}_buildState(e,t){const s={};return t&&e.iconEntity&&(s.selectedBackgroundColor=b.colors[0]),s}render(){const e=this.props.iconEntity?this.state.generatedColors:b;return e&&e.colors.length?o.createElement(o.View,{style:C.container},e.colors.map((e=>o.createElement(M,{key:e.key,iconEntity:this.props.iconEntity,selectedColorInfo:this.state.selectedBackgroundColor,colorInfo:e,onSelect:this._onSelectBackgroundColor,staticIcon:this.props.staticIcon})))):null}componentDidMount(){super.componentDidMount(),this.props.onSelectBackgroundColorInfo&&!this.props.iconEntity&&this.props.onSelectBackgroundColorInfo(this._mapColorGradientToColorInfo()),this.props.iconEntity&&this._generateBackgroundColors()}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);const i=this.props.iconEntity!==e.iconEntity,o=this.state.generatedColors!==t.generatedColors;i&&this.props.iconEntity&&this._generateBackgroundColors(),o&&this.props.onSelectBackgroundColorInfo&&this.props.onSelectBackgroundColorInfo(this._mapColorGradientToColorInfo(),this.props.iconEntity)}_generateBackgroundColors(){const e=(0,r.getInputEntityUrl)(this.props.iconEntity,S.EmoticonSize.Small);e&&i.default.getColorHarmonies(e).then((e=>{this.setState({generatedColors:null!=e?e:b,selectedBackgroundColor:(null!=e?e:b).colors[0]})})).catch((()=>{this.setState({generatedColors:b,selectedBackgroundColor:b.colors[0]})}))}}t.default=T;class M extends o.Component{constructor(){super(...arguments),this._onSelect=()=>{this.props.onSelect&&this.props.onSelect(this.props.colorInfo),o.Accessibility.announceForAccessibility(this._getAccessibilityLabel(!0))}}render(){const{iconEntity:e,selectedColorInfo:t,colorInfo:s,staticIcon:i}=this.props,r=(null==t?void 0:t.key)===s.key;if(!e&&!i)return null;const a=e?e instanceof p.EmoticonEntity?this._getEmoticonIcon():this._getStickerIcon():this._getStaticIcon(),l=i?C.iconButtonNoBorder:void 0;return o.createElement(o.Button,{key:s.key,style:C.iconButton,onPress:this._onSelect,autoFocus:r,accessibilityLabel:this._getAccessibilityLabel(r)},o.createElement(n.GradientView,{style:[C.iconButtonBackground,l],colors:[s.colorGradientStart,s.colorGradientEnd],direction:n.GradientDirection.BOTTOM_RIGHT},a),r&&this._renderCheckmark())}_getAccessibilityLabel(e){const t=(0,r.getLocalizedColorName)(this.props.colorInfo.key);return`${d.getString("MeetNow.BackgroundPickerItemLabel",{color:t})}${e?`, ${d.getString("Global.SelectedAccessibilityLabel")}`:""}`}_getEmoticonIcon(){const e=this.props.iconEntity;if(!e)return null;const t={id:e.emoticonName,tone:e.tone,firstFrame:0,frameCount:0};return o.createElement(y.StaticEmoticon,{key:"emoticon",emoticonInfo:t,size:S.EmoticonSize.Small})}_getStickerIcon(){const e=this.props.iconEntity,t=(0,_.getStickerUrl)(e.uri,_.StickerSize.ThumbLarge,!1,!0);return o.createElement(a.default,{origin:"StickerThumbnail",key:"sticker",style:C.stickerImage,containerStyle:C.stickerImage,resizeMode:"cover",source:t})}_getStaticIcon(){const e="White"===this.props.colorInfo.key?c.Color.gray400:c.Color.white;return this.props.staticIcon&&o.createElement(l.default,{size:h.IconSize.size16,color:e,hoverColor:e,icon:this.props.staticIcon,title:d.getString("PesPicker.MeetNowTitle")})}_renderCheckmark(){return o.createElement(o.View,{style:C.checkmark},o.createElement(u.default,{style:C.checkmarkIcon,icon:h.SkypeIcon.Ok,size:h.IconSize.size12,color:c.Color.white}))}}},94894:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(82773),n=s(11009),r=s(77381),a=s(45381),l=s(11828);class d extends r.default{constructor(){super(...arguments),this._toolTipAnimationConfig={duration:250,easing:i.Animated.Easing.OutBack()},this._toolTipConfig=()=>({getElement:this.props.anchor,positions:[n.PopupAnchorPositon.Bottom],durationMs:3500,title:this.props.title,optionalIcon:l.SkypeIcon.Bookmarked,anchorAccessibilityLabel:this.props.accessibilityLabel,instanceId:this.state.instanceId,rootViewId:this._getRootViewId()}),this._onBookmarkTooltipDismiss=()=>{o.default.bookmarkTooltipDisplayed()}}_buildState(e,t){return{instanceId:e.instanceId||"unknown"}}render(){return i.createElement(a.default,{toolTipInfo:this._toolTipConfig(),animateDismissal:!0,animationConfig:this._toolTipAnimationConfig,textMarginHorizontal:10,textMarginVertical:10,containerOffsetX:this.props.offsetX,containerOffsetY:this.props.offsetY,onDismiss:this._onBookmarkTooltipDismiss})}}t.default=d},10547:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(67294),n=s(16778),r=s(89391),a=s(81357),l=s(43368),d=s(32949),c=s(46096),h=s(1720),u=s(43106),p=s(28909),g=s(36237),m=s(72490),S=s(15877),f=s(33754),y=s(1117),_=s(6250),v=s(43855),C=s(96168),b=s(31903),T=s(79096),M=s(63584),I=s(83294),w=s(17707),P=s(58962),k=s(23528),A=s(22538),E=s(63110),R=s(81760),L=s(11010),F=s(11828),x=s(80837),O=s(24576),D=s(53374),B=R.Color.gray50,V=R.Color.gray200,N=(0,S.lazyProperties)({container:()=>n.Styles.createViewStyle({height:250,borderColor:B,backgroundColor:R.Color.white}),containerTop:()=>n.Styles.createViewStyle({borderWidth:1,borderBottomWidth:0,borderTopLeftRadius:10,borderTopRightRadius:10}),containerBottom:()=>n.Styles.createViewStyle({borderWidth:1,borderTopWidth:0,borderBottomLeftRadius:10,borderBottomRightRadius:10}),containerWhiteBackground:()=>n.Styles.createViewStyle({backgroundColor:R.Color.white}),containerRadiusOverrideTop:()=>n.Styles.createViewStyle({borderTopLeftRadius:24,borderTopRightRadius:24}),containerRadiusOverrideBottom:()=>n.Styles.createViewStyle({borderBottomLeftRadius:24,borderBottomRightRadius:24}),centeredContainer:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center"}),headerContainer:()=>n.Styles.createViewStyle({minHeight:b.MinimumPesHeaderHeight,borderBottomWidth:1,borderColor:B,flexDirection:"row",alignItems:"center",justifyContent:"space-between",alignSelf:"stretch"}),headerContainerNoCategorySwitcher:()=>n.Styles.createViewStyle({justifyContent:"flex-end"}),headerContainerNarrowView:()=>n.Styles.createViewStyle({paddingVertical:b.HeaderContainerVerticalPadding,flexDirection:"column-reverse",alignItems:"stretch"}),headerContainerNarrowViewDirectionColum:()=>n.Styles.createViewStyle({flexDirection:"column"}),searchInputContainer:()=>n.Styles.createViewStyle({flexBasis:150,flexShrink:1,height:b.SearchInputHeight,borderRadius:5,borderWidth:1,marginHorizontal:10}),searchInputContainerNarrowView:()=>n.Styles.createViewStyle({marginBottom:5,minWidth:150,flexBasis:30}),searchInputInnerContainer:()=>n.Styles.createViewStyle({paddingHorizontal:5}),searchInputControl:()=>n.Styles.createTextInputStyle({paddingHorizontal:5}),borderLightTheme:()=>n.Styles.createTextInputStyle({borderColor:B}),borderLightThemeSearchInput:()=>n.Styles.createViewStyle({borderColor:V}),borderAccessibleTheme:()=>n.Styles.createTextInputStyle({borderColor:R.Color.black}),borderSeparator:()=>n.Styles.createTextInputStyle({borderBottomWidth:1,borderColor:B,marginVertical:10}),categorySwitcherContainer:()=>n.Styles.createTextInputStyle({flexGrow:1,paddingHorizontal:20}),categorySwitcherHorizontalPadding:()=>n.Styles.createTextInputStyle({paddingHorizontal:b.HeaderContainerVerticalPadding}),meetNowPickerContainer:()=>n.Styles.createTextInputStyle({paddingVertical:b.HeaderContainerVerticalPadding,borderBottomWidth:1,borderColor:B})});class U extends O.default{constructor(){super(...arguments),this._mountedPickerRefs=new _.default,this._initialTabType=I.defaultTabType,this._onEscape=()=>(this.props.onClose(),!0),this._onEmoticonSelected=e=>{this.props.showBackgroundColorsSwitcher&&this.setState({selectedEntityForBackgroundColor:e}),this.props.onEmoticonSelected(e)},this._onStickerSelected=e=>{this.props.showBackgroundColorsSwitcher&&this.setState({selectedEntityForBackgroundColor:e}),this.props.onStickerSelected(e)},this._onSwitchPesTabType=e=>{if(e!==this.state.selectedTabType){this._updatePickerTelemetrySessions(this.state.selectedTabType,e),this.isComponentMounted()&&this.setState({selectedTabType:e,hasSwitchedTabs:!0,isSearchInputPristine:!!this.state.searchQuery,searchQuery:this.state.searchQuery,visibleSearchInput:this._isSearchableTab(e),selectedEntityForBackgroundColor:void 0});const t=this._mountedPickerRefs.ref(e.toString());t&&t.requestFocusOnFirstItem()}},this._isSearchableTab=e=>e in P.SearchableTabType,this._shouldShowBackgroundPicker=()=>this.props.showBackgroundColorsSwitcher&&this.state.selectedEntityForBackgroundColor,this._onSearchQueryChange=e=>{if(!this.isComponentMounted())return;let t={};const s=e.trim();this.state.selectedTabType===P.TabType.Gif&&(s||u.default.setSearchParams("")),s!==this.state.searchQuery&&(t.searchQuery=e),this.state.isSearchInputPristine&&(t.isSearchInputPristine=!1),!i.isEmpty(t)&&this.isComponentMounted()&&this.setState(t)},this._onSearchQueryChangeDebounced=i.debounce(this._onSearchQueryChange,r.default.getS4LSearchFeatures().searchHeaderDebounceWait)}_buildState(e,t){const s=this.props,i={showingInNarrowView:!!e.availableWidth&&e.availableWidth<600,loadingStatus:C.default.getLoadingStatus(),isComposerWithPopupEnabled:r.default.getS4LMessagingFeatures().enableDesktopComposerWithPopUpMenu};return t&&(i.selectedTabType=e.selectedTabType||this._initialTabType,i.hasSwitchedTabs=!1,i.isSearchInputPristine=!0,i.searchQuery=e.searchQuery||"",i.visibleSearchInput=this._isSearchableTab(i.selectedTabType)),s.showCategorySwitcher!==e.showCategorySwitcher&&this.state.selectedTabType!==this._initialTabType&&(i.selectedTabType=this._initialTabType),i}componentDidMount(){super.componentDidMount();const e=D.default.newCauseId();g.log(c.LogTraceArea.Pes,"DesktopPesPicker componentDidMount causeId: "+e),this.state.loadingStatus===C.PesConfigLoadingStatus.NotStarted?A.EnsureStarted(w.default).then((()=>w.default.refreshConfig(e))):this.state.loadingStatus===C.PesConfigLoadingStatus.Loading&&w.default.refreshConfig(e),m.default.addEscapeHandler(this._onEscape)}componentWillUnmount(){super.componentWillUnmount(),m.default.removeEscapeHandler(this._onEscape),l.default.close(this._getRootViewId())}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t),e.searchQuery&&e.selectedTabType&&(e.searchQuery!==this.state.searchQuery||e.selectedTabType!==this.state.selectedTabType)&&this.setState({searchQuery:e.searchQuery,selectedTabType:e.selectedTabType})}_isDarkThemeAllowed(){return this._useDarkTheme()&&!this.props.disableDarkTheme}render(){const e=this.props.renderPosition===P.PesPickerRenderPosition.BOTTOM,t=[N.container,this.props.styles,e?N.containerBottom:N.containerTop,this._getAccessibleThemeStyles()];return this.state.isComposerWithPopupEnabled&&t.push(e?N.containerRadiusOverrideBottom:N.containerRadiusOverrideTop),this._isDarkThemeAllowed()&&t.push(this._themeStyles.headerShadowBorderColorStyle,this._themeStyles.secondaryBackgroundColorStyle),this.state.loadingStatus===C.PesConfigLoadingStatus.NotStarted||this.state.loadingStatus===C.PesConfigLoadingStatus.Loading?(t.push(N.centeredContainer),n.createElement(n.View,{style:t},n.createElement(v.default,null))):n.createElement(n.View,{style:t},this._getHeader(),this._getPicker())}_getHeader(){const e=[N.headerContainer,this._getAccessibleThemeStyles()],t=[N.searchInputContainer,this._getAccessibleThemeStyles(!0)],s=[N.categorySwitcherContainer],i=[];let r;this.state.showingInNarrowView&&(e.push(N.headerContainerNarrowView),t.push(N.searchInputContainerNarrowView),s.push(N.categorySwitcherHorizontalPadding),this.props.showBackgroundColorsSwitcher&&(e.push(N.headerContainerNarrowViewDirectionColum),i.push(this.state.visibleSearchInput?N.borderSeparator:void 0,this._getAccessibleThemeStyles()))),this._isDarkThemeAllowed()&&e.push(this._themeStyles.headerShadowBorderColorStyle),this.props.showCategorySwitcher?r=n.createElement(n.View,{style:s},n.createElement(T.default,{categoryOrder:this.props.customCategoryOrder,currentTabType:this.state.selectedTabType,onSwitchPesTabType:this._onSwitchPesTabType,showInLandscape:!0,showCategoriesAsIcons:this.state.showingInNarrowView,disableDarkTheme:this.props.disableDarkTheme})):e.push(N.headerContainerNoCategorySwitcher);const l=n.createElement(k.default,{inputText:this.state.searchQuery,style:t,searchInputControlStyle:N.searchInputInnerContainer,clearSearchIconColor:this._getSearchIconColor(),placeholderText:f.getString("SearchInputControl.PlaceHolderTextShort"),accessibilityLabel:f.getString("SearchInputControl.PlaceHolderTextShort"),clearSearchIconSize:F.IconSize.size14,inputStyle:[N.searchInputControl,L.default.fontStyle.caption],showSearchIcon:!0,hideBackground:!0,doNotAutoFocusOnMount:!0,onInputTextChange:this._onSearchQueryChangeDebounced});let d;return this._shouldShowBackgroundPicker()&&(d=n.createElement(o.Fragment,null,n.createElement(a.default,{iconEntity:this.state.selectedEntityForBackgroundColor,onSelectBackgroundColorInfo:this.props.onBackgroundSelected,selectedTabType:this.state.selectedTabType,triggeredBy:this.props.origin}),n.createElement(n.View,{style:i}))),n.createElement(n.View,{style:e},r,n.createElement(n.View,{style:i}),d,this.state.visibleSearchInput&&l)}_getPicker(){let e;switch(this.state.selectedTabType){case P.TabType.Emoticon:e=this._getEmoticonPicker();break;case P.TabType.Moji:e=this._getMojiPicker();break;case P.TabType.ChatSticker:e=this._getStickerPicker();break;case P.TabType.Gif:e=this._getGifPicker();break;case P.TabType.MeetNow:e=this._getMeetNowIconPicker();break;case P.TabType.ImageUploader:e=this._getImageUploadPicker();break;case P.TabType.CaptureSticker:case P.TabType.Effect:case P.TabType.PickerPopup:break;default:D.default.switchStatementExhaustiveChecking(this.state.selectedTabType)}return n.createElement(n.View,{style:x.default.flexOne},e)}_getEmoticonPicker(){return n.createElement(d.default,{ref:this._mountedPickerRefs.onComponentRef(P.TabType.Emoticon.toString()),renderMobileInterface:!1,onPesSelected:this._onEmoticonSelected,filter:this.state.searchQuery,doNotRenderTabIndicator:!!this.state.searchQuery,searchMode:!!this.state.searchQuery,showingInNarrowView:this.state.showingInNarrowView,darkTheme:this._isDarkThemeAllowed(),availableWidth:this.props.availableWidth,autoFocusFirstItem:this.state.hasSwitchedTabs&&this.state.isSearchInputPristine,showCategorySwitcher:this.props.showCategorySwitcher,parentRef:this.props.parentRef,pesPickerPopupRef:this.props.pesPickerPopupRef,triggeredBy:this.props.origin,forceExcludeRecents:!1,hideDeleteButton:this.props.hideDeleteButton})}_getMojiPicker(){return n.createElement(y.default,{ref:this._mountedPickerRefs.onComponentRef(P.TabType.Moji.toString()),renderMobileInterface:!1,onPesSelected:this.props.onMojiSelected,filter:this.state.searchQuery,doNotRenderTabIndicator:!!this.state.searchQuery,searchMode:!!this.state.searchQuery,showingInNarrowView:this.state.showingInNarrowView,darkTheme:this._useDarkTheme(),availableWidth:this.props.availableWidth,autoFocusFirstItem:this.state.hasSwitchedTabs&&this.state.isSearchInputPristine})}_getStickerPicker(){return n.createElement(E.default,{ref:this._mountedPickerRefs.onComponentRef(P.TabType.ChatSticker.toString()),renderMobileInterface:!1,onPesSelected:this._onStickerSelected,filter:this.state.searchQuery,doNotRenderTabIndicator:!!this.state.searchQuery,searchMode:!!this.state.searchQuery,showingInNarrowView:this.state.showingInNarrowView,darkTheme:this._useDarkTheme(),availableWidth:this.props.availableWidth,autoFocusFirstItem:this.state.hasSwitchedTabs&&this.state.isSearchInputPristine,triggeredBy:this.props.origin})}_getGifPicker(){return n.createElement(h.default,{renderMobileInterface:!1,onPesSelected:this.props.onGifSelected,filter:this.state.searchQuery,doNotRenderPreview:!1,doNotRenderTabIndicator:!!this.state.searchQuery,searchMode:!!this.state.searchQuery,showingInNarrowView:this.state.showingInNarrowView,darkTheme:this._useDarkTheme(),autoFocusFirstItem:this.state.hasSwitchedTabs&&this.state.isSearchInputPristine})}_getMeetNowIconPicker(){return n.createElement(n.View,{style:[N.meetNowPickerContainer,this._getAccessibleThemeStyles()]},n.createElement(a.default,{staticIcon:F.SkypeIcon.MeetNow,onSelectBackgroundColorInfo:this.props.onBackgroundSelected,selectedTabType:this.state.selectedTabType,triggeredBy:this.props.origin}))}_getAccessibleThemeStyles(e=!1){return this.props.disableDarkTheme?this._useAccessibleTheme()?N.borderAccessibleTheme:e?N.borderLightThemeSearchInput:N.borderLightTheme:this._useAccessibleTheme()||e?this._themeStyles.dividerBorderColorStyle:void 0}_getSearchIconColor(){if(this.props.disableDarkTheme)return this._useAccessibleTheme()?R.Color.black:R.Color.gray400}_getImageUploadPicker(){return n.createElement(p.default,{onImageUploadSelected:this.props.onImageUploadSelected})}_updatePickerTelemetrySessions(e,t){switch(e){case P.TabType.Emoticon:M.EmoticonPickerTelemetry.closed();break;case P.TabType.ChatSticker:M.StickerPickerTelemetry.closed();break;case P.TabType.Moji:M.MojiPickerTelemetry.closed();break;case P.TabType.Gif:M.GifPickerTelemetry.closed();break;case P.TabType.MeetNow:M.PesPickerMeetNowTelemetry.closed();break;case P.TabType.ImageUploader:M.PesPickerImageUploaderTelemetry.closed()}switch(t){case P.TabType.Emoticon:M.EmoticonPickerTelemetry.open(this.props.origin);break;case P.TabType.ChatSticker:M.StickerPickerTelemetry.open(this.props.origin);break;case P.TabType.Moji:M.MojiPickerTelemetry.open();break;case P.TabType.Gif:M.GifPickerTelemetry.open();break;case P.TabType.MeetNow:M.PesPickerMeetNowTelemetry.open(this.props.origin);break;case P.TabType.ImageUploader:M.PesPickerImageUploaderTelemetry.open(this.props.origin)}}}t.default=U},58460:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EmoticonItem=void 0;const i=s(16778),o=s(39024),n=s(10117),r=s(15877),a=s(33754),l=s(30124),d=s(95549),c=s(65042),h=s(81760),u=s(11828),p=i.Styles.createButtonStyle({flex:1,alignItems:"center",alignSelf:"stretch"}),g=(0,r.lazyProperties)({diversityIndicator:()=>i.Styles.createViewStyle({width:4,height:4,borderRadius:2,position:"absolute",top:1,right:1}),diversityIndicatorLightTheme:()=>i.Styles.createViewStyle({backgroundColor:h.Color.gray200}),diversityIndicatorDarkTheme:()=>i.Styles.createViewStyle({backgroundColor:h.Color.gray300}),customIcon:()=>i.Styles.createButtonStyle({position:"absolute",right:1,bottom:0,backgroundColor:h.Color.gray100,borderWidth:1,borderColor:h.Color.white,borderRadius:9,overflow:"visible",height:14,paddingTop:2,paddingLeft:3,paddingRight:2}),customAddIcon:()=>i.Styles.createButtonStyle({backgroundColor:h.Color.blueDark}),customRemoveIcon:()=>i.Styles.createButtonStyle({backgroundColor:h.Color.red}),customRemoveIconContrast:()=>i.Styles.createButtonStyle({backgroundColor:h.Color.gray100}),customAddIconContrastLight:()=>i.Styles.createButtonStyle({backgroundColor:h.Color.black}),customAddIconContrastDark:()=>i.Styles.createButtonStyle({backgroundColor:h.Color.white})});class m extends d.PesPickerItem{_getMarginStyle(e){let t=m._cachedMarginStyles[e];return t||(t=i.Styles.createImageStyle({margin:e},!1),m._cachedMarginStyles[e]=t),t}_getImportantForAccessibility(){return i.Types.ImportantForAccessibility.Yes}_getAccessibilityLabel(e){if(!e.description)return;let t=o.getEmoticonInfoAccessibilityLabel(e);return this._isItemWithPopup(e)&&(t+=", "+a.getString("Global.MoreOptionsAvailableAccessibilityLabel")),t}_renderItem(e){const t=[],s=this._getPopupIndicator(e);return s&&!this.props.hideDiverseIndicatior&&t.push(s),t.push(i.createElement(c.StaticEmoticon,{key:"emoticon",emoticonInfo:e,size:this.props.size,style:this._getMarginStyle(this.props.margin),onLoad:this.props.onImageLoad})),this.props.renderWithToggleIcons&&t.push(this.props.existsInCustomSet?this._renderRemoveIcon():this._renderAddIcon()),t}_renderAddIcon(){let e;return this._useAccessibleTheme()&&(e=this._useDarkTheme()?g.customAddIconContrastDark:g.customAddIconContrastLight),i.createElement(i.View,{key:"toggleIconAdd"+this.props.id,style:[g.customIcon,g.customAddIcon,e]},i.createElement(n.default,{icon:u.SkypeIcon.Plus,size:u.IconSize.size8,color:this._useAccessibleTheme()&&this._useDarkTheme()?h.Color.black:h.Color.white}))}_renderRemoveIcon(){let e;return this._useAccessibleTheme()&&(e=g.customRemoveIconContrast),i.createElement(i.View,{key:"toggleIconRemove"+this.props.id,style:[g.customIcon,g.customRemoveIcon,e]},i.createElement(n.default,{icon:u.SkypeIcon.PresenceBusy,size:u.IconSize.size8,color:this._useAccessibleTheme()?h.Color.black:h.Color.white}))}_getPopupIndicator(e){if(!this._isItemWithPopup(e))return;const t=this._useDarkTheme()?g.diversityIndicatorDarkTheme:g.diversityIndicatorLightTheme;return i.createElement(i.View,{style:[g.diversityIndicator,t],key:"diverseIndicator"})}_onPressPesItem(){this.props.onSelected(this.props.info)}_getCustomParentStyle(){return l.default.isUsingStackNavigationContextNoSubscription()?p:void 0}_isItemWithPopup(e){return!!e.diverse||!!(this.props.emoticonGroupsEnabled&&e.group&&e.group.length>0)}}t.EmoticonItem=m,m._cachedMarginStyles={}},32949:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(34339),r=s(89391),a=s(62602),l=s(58460),d=s(82433),c=s(46096),h=s(97174),u=s(36237),p=s(15877),g=s(33754),m=s(26424),S=s(96168),f=s(31903),y=s(31903),_=s(95549),v=s(63584),C=s(83294),b=s(58962),T=s(58962),M=s(82677),I=s(31234),w=(s(36150),s(4057)),P=s(11828),k=(0,p.lazyProperties)({previewMarginBottom:()=>o.Styles.createViewStyle({marginBottom:24})});class A extends f.PesPicker{constructor(){super(...arguments),this._renderPesItem=(e,t)=>{const s=this.state.items[e];if(!s)return u.warn(c.LogTraceArea.Pes,`Emoticon with id ${e} not found`),null;const i=this.state.itemsForTabsMap[this.state.isSearching?0:this._currentTabIndex];let n=!1,r=e;i&&(n=i[0]===e),s.group&&s.group.length>0&&(r=s.group[0]+"_"+r);const a=!!this.state.previewItem&&this.state.previewItem.id===s.id,d=-1===this.state.focusedButtonIndexInPack&&a;return o.createElement(o.View,{key:r},o.createElement(l.EmoticonItem,{autoFocus:this._shouldAutoFocusFirstItem()&&n,ref:this._itemsInCurrentTabRefs.onComponentRef(e),tabIndex:d?0:-1,key:r,id:s.id,info:s,size:this._getSize(),margin:this._getExtraItemMargin(),isSelected:a,renderMobileInterface:this.props.renderMobileInterface,emoticonGroupsEnabled:this.state.emoticonGroupsEnabled,renderWithToggleIcons:this.props.renderWithToggleIcons,existsInCustomSet:this._existsInCustomSet(s),hideDiverseIndicatior:this.props.hideDiverseIndicatior,onFocus:this._getButtonFocusCallback(e),onHover:this._onPesHoverBound,onItemContextMenu:this._onItemContextMenu,onItemLongPress:this._onItemLongPress,onSelected:this._onSelected,onItemDidMount:this._onEmoticonItemDidMount,onItemWillMount:this._onEmoticonItemWillMount,onImageLoad:t?this._onFirstImageLoad:this._onImageLoad}))},this._onSelected=e=>{this._hidePickerPopup(),e.group&&e.group.length>0?d.default.setLastUsedEmoticonGroupItem(e.group[0],e.id):this.props.isCustomReactions||d.default.setLastUsedTone(e.id,e.tone);const t=i.head(e.shortcuts);if(t){const s=new h.EmoticonEntity(t,e.id,e.tone);this.props.onPesSelected(s,b.mediaTypes.emoticon,e.id)}this._trackClickedEmotion(e),!this.props.renderMobileInterface&&this.state.isSearching&&this._desktopSearchTelemetry&&(this._desktopSearchTelemetry.sendSuccessTelemetryEvent(e.id,this.state.searchQuery.length),this._searchSuccessTelemetry=!0)},this._trackClickedEmotion=e=>{v.EmoticonPickerTelemetry.itemAdded(e);const t=e.group?i.indexOf(e.group,e.id):void 0;this._trackClickedItem(e.id,e.tone,t,this.props.triggeredBy)},this._onItemContextMenu=(e,t,s)=>{this._showPickerPopup(e,t,s,T.PesPickerTriggeredBy.ContextMenu)},this._onItemLongPress=(e,t,s)=>{this._showPickerPopup(e,t,s,T.PesPickerTriggeredBy.LongPress)},this._showPickerPopup=(e,t,s,i)=>{if(!this._isItemWithPopup(t))return;const o=this._getPickerPopup();o&&this._measurePosition(s,(()=>this._getParent()),(e=>{const s={item:t,itemSize:this._getSize(),onItemSelected:this._onSelected,onItemHover:this._onPesHoverBound,onHide:this._onPickerPopupHide,x:e.x,y:e.y,leftBoundary:e.leftBoundary,rightBoundary:e.rightBoundary,triggeredBy:i};o.show(s)}))},this._hidePickerPopup=()=>{const e=this._getPickerPopup();e&&e.hide()},this._getParent=()=>{if(this.props.parentRef)return this.props.parentRef()},this._getPickerPopup=()=>{if(this.props.pesPickerPopupRef)return this.props.pesPickerPopupRef()},this._onPickerPopupHide=e=>{this._requestFocusOnItem(e)},this._onEmoticonItemWillMount=()=>{v.EmoticonPickerTelemetry.willMountItem()},this._onEmoticonItemDidMount=()=>{v.EmoticonPickerTelemetry.mountedItem()},this._imagesLoadedCount=0,this._onFirstImageLoad=()=>{v.EmoticonPickerTelemetry.markFirstVisibleItemReady(),this._onImageLoad()},this._onImageLoad=()=>{this._imagesLoadedCount++,this._imagesLoadedCount>=this.state.totalItemsCount&&(v.EmoticonPickerTelemetry.finishOpenScenario(this.state.totalItemsCount),this._imagesLoadedCount=0)},this._onMobileScroll=this._hidePickerPopup,this._onDesktopScroll=this._hidePickerPopup}componentWillUnmount(){super.componentWillUnmount(),v.EmoticonPickerTelemetry.pickerWillUnmount(),this._hidePickerPopup()}_willChangeTab(e){super._willChangeTab(e),this._hidePickerPopup()}_willChangeCategory(e){super._willChangeCategory(e),e!==this._getPesTabType()&&(v.EmoticonPickerTelemetry.closed(),v.EmoticonPickerTelemetry.finishOpenScenario(),this._hidePickerPopup())}_buildState(e,t){const s=r.default.getS4LMessagingFeatures(),o=super._buildState(e,t);if(o.items){const t=d.default.getLastUsedTones(),n=o.items;if(e.isCustomReactions||i.each(t,((e,t)=>{n[t]&&(n[t]=Object.assign(Object.assign({},n[t]),{tone:e}))})),s.enableEmoticonGroups){const e=d.default.getLastUsedEmoticonGroupItems();i.each(e,((e,t)=>{const s=n[t],o=this._getPesItem(e);s&&o&&void 0!==s.group&&-1!==i.indexOf(s.group,e)&&(n[t]=Object.assign(Object.assign({},o),{group:s.group}))}))}}return Object.assign(Object.assign({},o),{emoticonGroupsEnabled:s.enableEmoticonGroups,useSmallEmoticonSizeDesktop:s.enableSmallEmoticonsInDesktopPicker,useSmallEmoticonSizeMobile:!1})}_getPesPreview(){if(this.state.previewItem)return o.createElement(n.AnimatedEmoticon,{style:k.previewMarginBottom,size:n.Size.ExtraLarge,description:this.state.previewItem.description,innerText:i.head(this.state.previewItem.shortcuts),emoticonName:this.state.previewItem.id,tone:this.state.previewItem.tone,preventSelectable:!0})}_getInitialPagedTabIndex(e){if(this.props.initialTabId&&e){let t=this.getTabIndexByTabId(e,this.props.initialTabId);if(-1===t&&(t=this.getTabIndexByCopyright(e,this.props.initialTabId)),-1!==t)return t}return 1}_getEmptyRecentMessage(){return g.getString("PesPicker.EmptyRecentEmoticons")}_getPesTabType(){return b.TabType.Emoticon}_getTabs(e,t,s){const o=S.default.getEmoticonTabs();let n;if(e){const t=s?this._getGroupedEmoticonTab():void 0;t&&o.push(t),n=C.searchInPackTitleAndItemKeyword(o,e),n=i.filter(n,(e=>e.packs&&e.packs.length>0));const r=this._mergePacksInSingleTab(n);r&&(n=[r])}else{const e=s?d.default.getLastUsedEmoticonGroupItems():void 0,n=I.default.getRecentEmoticonTabInfo(e);(!t||t&&!i.isEmpty(n.packs))&&o.unshift(n)}const r=n||o;return this._getContext().isRTL,r}_getPackAccessibilityLabel(e){return g.getString("PesPicker.EmoticonPackHeaderAccessibilityLabel",{title:e.title,count:e.items.length})}_getSearchNoResultsMessage(){return g.getString("PesSearch.EmoticonPickerNoResultsSearchText")}_getErrorMessage(){return g.getString("MediaBar.EmoticonPickerErrorText")}_getErrorSymbol(){return P.SkypeIcon.EmoticonNotPresent}_getPesInfo(e){const t=e.description,s=i.head(e.shortcuts);return[t,new h.EmoticonEntity(s,e.id,e.tone).text()]}_getPesItem(e){const t=M.separateReactionNameAndTone(e),s=d.default.getEmoticonByName(t.reactionNameWithoutTone);return s&&M.isTonedReaction(e)?Object.assign(Object.assign({},s),{tone:t.reactionTone}):s}_getSearchLabel(){return g.getString("PesPicker.SearchEmoticons")}_supportsRenderTabsWithoutPaging(){return!1}_getStaticItemDimension(){return this.state.useSmallEmoticonSizeMobile?b.frameHeights.emoticons.Size30:b.frameHeights.emoticons.Size40}_getDefaultItemDimension(){return this._getStaticItemDimension()}_getNumberOfItemsPerLine(){{if(i.isUndefined(this.state.availableWidth))return;const e=this._getStaticItemDimension()+2;return Math.floor(this.state.availableWidth/e)}}_onPickerResize(){super._onPickerResize(),this._hidePickerPopup()}_measurePosition(e,t,s){this.isComponentMounted()&&a.default.measureLayoutRelativeToWindow(e).then((e=>{this.isComponentMounted()&&a.default.measureLayoutRelativeToWindow((()=>this._mainContentRef)).then((i=>{if(!this.isComponentMounted())return;let o;t&&t()&&a.default.measureLayoutRelativeToWindow(t).then((e=>{this.isComponentMounted()&&(o=e,u.log(c.LogTraceArea.Pes,e))})).fail((e=>{u.error(c.LogTraceArea.Pes,"Unable to measure parent position: "+w.default.errorAsString(e))}));const n=this._previewSeen?f.PesPreviewContainerWidth:0;let r=e.width/2+n,l=y.MinimumPesHeaderHeight+(this.props.showingInNarrowView&&this.props.showCategorySwitcher?f.CategorySwitcherIconHeight:0);l=l,o&&(r=e.width/2,l=0),s({x:e.x-(o?o.x:i.x)+r,y:e.y-(o?o.y:i.y)+l,leftBoundary:n,rightBoundary:i.width+n})})).fail((e=>{u.error(c.LogTraceArea.Pes,"Unable to measure picker position: "+w.default.errorAsString(e))}))})).fail((e=>{u.error(c.LogTraceArea.Pes,"Unable to measure item position: "+w.default.errorAsString(e))}))}_getSize(){return this.props.renderMobileInterface&&this._shouldRenderTabsWithoutPaging()?this.state.useSmallEmoticonSizeMobile?m.EmoticonSize.Medium:m.EmoticonSize.Large:!this.props.renderMobileInterface&&this.state.useSmallEmoticonSizeDesktop?m.EmoticonSize.Small:this.props.renderMobileInterface?m.EmoticonSize.Large:m.EmoticonSize.Medium}_getExtraItemMargin(){let e=0;if(this.props.renderMobileInterface&&!this._shouldRenderTabsWithoutPaging()&&this.props.availableWidth){const t=this.props.availableWidth-2*f.PesListMobilePadding,s=b.frameHeights.emoticons.Size40+2*_.PesItemBorder,i=Math.floor(t/s),o=t%s;e=Math.floor(o/(2*i))}else this.props.renderMobileInterface||(e=3);return e}_existsInCustomSet(e){const t=M.updateReactionNameWithTone(e.id,null==e?void 0:e.tone);return i.includes(this.props.selectedEmoticons,t)}_isItemWithPopup(e){return!!e.diverse||!!(this.state.emoticonGroupsEnabled&&e.group&&e.group.length>0)}_getGroupedEmoticonTab(){const e=d.default.getGroupedEmoticons();if(!i.isEmpty(e))return{id:"grouped emoticons tab",packs:[{id:"grouped emoticons pack",items:e,title:""}],iconUrlOrAssetID:0,tabType:b.TabType.Emoticon}}}t.default=A},23790:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GifItem=void 0;const i=s(16778),o=s(44770),n=s(46096),r=s(74313),a=s(10117),l=s(36237),d=s(15877),c=s(33754),h=s(95549),u=s(60621),p=s(81760),g=s(11828),m=s(80837),S=(0,d.lazyProperties)({alternateViewContainer:()=>i.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center"}),backgroundImage:()=>[m.default.absoluteFill,i.Styles.createViewStyle({opacity:.5,backgroundColor:p.Color.gray300})],gifItemNoBorder:()=>i.Styles.createButtonStyle({borderWidth:0}),gifItemNoPadding:()=>i.Styles.createButtonStyle({padding:0,borderWidth:0}),sendButtonWrapper:()=>i.Styles.createViewStyle({position:"absolute",right:0,left:0,top:0,bottom:0,flex:1,alignItems:"center",justifyContent:"center",backgroundColor:p.Color.blueOverlay70}),flippedView:()=>i.Styles.createViewStyle({transform:[{scaleX:-1}]})});class f extends h.PesPickerItem{constructor(){super(...arguments),this._isGifImageLoaded=!1,this._onPreviewOpened=e=>{e===this.props.info&&this.setState({isPreviewOn:!0})},this._onPreviewClosed=e=>{e===this.props.info&&this.setState({isPreviewOn:!1})},this._handleGifImageLoad=()=>{this._isGifImageLoaded=!0},this._handleGifImageLoadError=()=>{l.error(n.LogTraceArea.Pes,"There was an error loading the gif ",this.props.id),this._isGifImageLoaded=!1}}componentDidMount(){super.componentDidMount(),this._gifPreviewOpenSubscriptionToken=u.GifPreviewService.onPesPreviewOpened(this._onPreviewOpened),this._gifPreviewCloseSubscriptionToken=u.GifPreviewService.onPesPreviewClosed(this._onPreviewClosed)}componentWillUnmount(){super.componentWillUnmount(),this._gifPreviewOpenSubscriptionToken.unsubscribe(),this._gifPreviewCloseSubscriptionToken.unsubscribe()}_getStyle(e,t){return{thumbnailContainer:i.Styles.createViewStyle({width:e,height:t,alignItems:"center",justifyContent:"center"},!1),thumbnailImage:i.Styles.createImageStyle({position:"absolute",top:0,left:0,width:e,height:t},!1)}}_getCustomParentStyle(){let e=[];return this.props.isUsedForPreview&&e.push(S.gifItemNoBorder),this.props.isUsedForSearch&&e.push(S.gifItemNoPadding),e}_renderItem(e){const t=this._getStyle(this.props.width,this.props.height);let s;this.props.showPlaceholder&&(s=i.createElement(i.View,{style:S.alternateViewContainer},i.createElement(i.Image,{style:S.backgroundImage,resizeMode:"cover",source:o.Collection.WIGGLE_PATTERN_350})));const n=i.createElement(i.View,{style:S.alternateViewContainer},i.createElement(i.Image,{style:S.backgroundImage,resizeMode:"cover",source:o.Collection.WIGGLE_PATTERN_350}),i.createElement(a.default,{icon:g.SkypeIcon.Gif,color:p.Color.white,size:g.IconSize.size30})),l=this._getGifTitle(e.title);const d=i.createElement(r.default,{origin:"GifThumbnail",key:"thumbnail",style:t.thumbnailImage,containerStyle:t.thumbnailContainer,altView:s,errorView:n,resizeMode:this.props.isUsedForPreview?"contain":"cover",source:this.props.src,onLoad:this._handleGifImageLoad,onError:this._handleGifImageLoadError});return[i.createElement(i.View,{key:"placeholderContainer",title:l,importantForAccessibility:i.Types.ImportantForAccessibility.Yes,accessibilityTraits:i.Types.AccessibilityTrait.Button},d,undefined)]}_getGifTitle(e){return this.state.isPreviewOn?c.getString("PesPicker.SendGif",{gifName:e}):e}_onPressPesItem(){this._isGifImageLoaded&&this.props.onSelected(this.props.info)}_getImportantForAccessibility(){return i.Types.ImportantForAccessibility.Yes}}t.GifItem=f},1720:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(89391),r=s(35566),a=s(46096),l=s(23790),d=s(43106),c=s(97174),h=s(36237),u=s(33754),p=(s(30124),s(26424)),g=s(96168),m=s(31903),S=s(63584),f=s(60621),y=s(83294),_=s(17707),v=s(58962),C=s(11828);class b extends m.PesPicker{constructor(){super(...arguments),this._renderPesItem=e=>{const t=this.state.items[e];if(!t)return h.warn(a.LogTraceArea.Pes,`Gif with id ${e} not found`),null;const s=this.state.itemsForTabsMap[this._currentTabIndex],i=s&&s[0]===e,n=this._getItemDimension(),r=!!this.state.previewItem&&this.state.previewItem.id===t.id,d=-1===this.state.focusedButtonIndexInPack&&r;return n?o.createElement(l.GifItem,{autoFocus:this._shouldAutoFocusFirstItem()&&i,tabIndex:d?0:-1,ref:this._itemsInCurrentTabRefs.onComponentRef(e),onFocus:this._getButtonFocusCallback(e),key:t.id,id:t.id,info:t,src:t.asmImageProxySmall,isSelected:r,renderMobileInterface:this.props.renderMobileInterface,onHover:this._onPesHoverBound,onSelected:this._onSelected,width:n,height:n,showPlaceholder:!0,onItemDidMount:this._onGifItemDidMount,onItemWillMount:this._onGifItemWillMount}):null},this._onSelected=e=>{if(e&&e!==this.state.previewItem)return;const t=e?y.getGifSwiftMessage(e):void 0;if(t){const s=new c.SwiftUriObjectEntity(t,this.props.conversationId,!0);this.props.onPesSelected(s,v.mediaTypes.gif,e.id),this._trackClickedGif(e),this.state.isSearching&&this._desktopSearchTelemetry&&(this._desktopSearchTelemetry.sendSuccessTelemetryEvent(e.id,this.state.searchQuery.length),this._searchSuccessTelemetry=!0)}},this._onGifPreviewOpened=e=>{this.isComponentMounted()&&this.setState({previewItem:e})},this._onGifPreviewClosed=()=>{this.isComponentMounted()&&this.setState({previewItem:void 0})},this._trackClickedGif=e=>{S.GifPickerTelemetry.itemAdded(void 0),this._trackClickedItem(e.id)},this._onGifItemWillMount=()=>{S.GifPickerTelemetry.willMountItem()},this._onGifItemDidMount=()=>{S.GifPickerTelemetry.mountedItem()}}_buildState(e,t){const s=!!e.filter&&e.filter.length>=p.GifMinSearchChars;return Object.assign(Object.assign({},super._buildState(e,t)),{isSearching:s,forceRenderTabIndicator:!i.isUndefined(s)&&!s,isFetchingGifsForSearch:d.default.isSearching(),gifItemsLimit:n.default.getS4LMessagingFeatures().pesGifItemsLimit})}componentDidMount(){if(super.componentDidMount(),this.props.filter&&this.props.filter.length>=p.GifMinSearchChars)_.default.getGifsForSearchTerm(this.props.filter,this.state.gifItemsLimit);else{const e=this._getCurentTab();e&&this._fetchGifsForCategory(e)}this._gifPreviewOpenSubscriptionToken=f.GifPreviewService.onPesPreviewOpened(this._onGifPreviewOpened),this._gifPreviewCloseSubscriptionToken=f.GifPreviewService.onPesPreviewClosed(this._onGifPreviewClosed),this._gifSendSubscriptionToken=f.GifPreviewService.onSend(this._onSelected)}componentWillUnmount(){super.componentWillUnmount(),this._gifPreviewOpenSubscriptionToken.unsubscribe(),this._gifPreviewCloseSubscriptionToken.unsubscribe(),this._gifSendSubscriptionToken.unsubscribe(),S.GifPickerTelemetry.pickerWillUnmount()}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t),e.filter&&this.props.filter&&e.filter.length<p.GifMinSearchChars&&e.filter.length<this.props.filter.length&&d.default.setSearchParams("")}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);const i=this.props.filter!==e.filter;if(this.state.isSearching&&i&&this.props.filter)_.default.getGifsForSearchTerm(this.props.filter,this.state.gifItemsLimit);else if(t.isSearching&&!this.state.isSearching){const e=this._getCurentTab();e&&this._fetchGifsForCategory(e)}}_fetchGifsForCategory(e){const t=e.searchTerm&&(e.searchTerm&&e.searchTerm.toLowerCase())!==p.GifDefaultCategory.toLowerCase()?e.searchTerm:void 0;!e.packs.length||e.packs[0].items.length||this.state.isFetchingItems||_.default.getGifsForCategory(e.id,this.state.gifItemsLimit,t)}_getCurentTab(){return this.state.tabs[this._currentTabIndex]||void 0}_getInitialPagedTabIndex(){return 0}_getEmptyRecentMessage(){return u.getString("PesPicker.EmptyRecentGifs")}_getPesTabType(){return v.TabType.Gif}_noSearchResultsFound(){return!this._isFetchingResults()&&this.state.isSearching&&i.isEmpty(this.state.items)}_isFetchingResults(){return this.state.isFetchingGifsForSearch}_shouldAnnounceForAccessibility(e,t){return this.state.isSearching&&!i.isUndefined(this.props.filter)&&this.props.filter.length>=p.GifMinSearchChars&&this.props.filter===d.default.getGifsForSearch().searchQuery}_getSearchItemsCountForAccessibility(){return i.keys(this.state.items).length}_getTabs(e){const t=g.default.getGifTabs();let s;if(e&&e.length>=p.GifMinSearchChars){const e=d.default.getGifsIdsFromSearch(),o=t[0];if(!i.isEmpty(e)&&o){const t=Object.assign(Object.assign({},o.packs[0]),{items:e});s=[Object.assign(Object.assign({},o),{packs:[t]})]}}const o=s||t;return this._getContext().isRTL,o}_getPesItem(e,t){return this.state&&this.state.isSearching&&t&&t.length>=p.GifMinSearchChars?d.default.getSearchGif(e):d.default.getCategoryGif(e)}_getPesInfo(e){return["",y.getGifAttribution()]}_getPesPreview(){if(!this.state.previewItem)return;const e=r.default.fitToContainer({width:this.state.previewItem.full.width,height:this.state.previewItem.full.height},{width:m.PesPreviewContainerWidth-10,height:m.PesPreviewContainerHeight});return o.createElement(l.GifItem,{key:this.state.previewItem.id,id:this.state.previewItem.id,info:this.state.previewItem,src:this.state.previewItem.asmImageProxy,renderMobileInterface:this.props.renderMobileInterface,isSelected:!0,isUsedForPreview:!0,width:e.width,height:e.height,onSelected:this._onSelected})}_getPackAccessibilityLabel(e){return u.getString("PesPicker.GifPackHeaderAccessibilityLabel",{title:e.title,count:e.items.length})}_getErrorMessage(){return this.state.isSearching?u.getString("PesSearch.GifPickerNoResultsSearchText"):u.getString("MediaBar.GifPickerErrorText")}_getErrorSymbol(){return C.SkypeIcon.Gif}_getSearchLabel(){return u.getString("PesPicker.SearchGifs")}_getSearchNoResultsMessage(){return u.getString("PesSearch.GifPickerNoResultsSearchText")}_willChangeTab(e){this._fetchGifsForCategory(e)}_willChangeCategory(e){super._willChangeCategory(e),e!==this._getPesTabType()&&(f.GifPreviewService.closePesPreview(),S.GifPickerTelemetry.closed())}_getStaticItemDimension(){return(this._getItemDimension()||this._getDefaultItemDimension())+this._doubleBorderItem}_getDefaultItemDimension(){return v.frameHeights.gifs.Size90}_getMinItems(e){return e>p.GifPickerLayoutBreakpoint?8:6}}t.default=b},28909:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(24576),n=s(33754),r=s(36400),a=s(10117),l=s(81760),d=s(11828),c=s(19675),h=(0,s(15877).lazyProperties)({containerStyle:()=>i.Styles.createViewStyle({paddingTop:20,alignSelf:"center"}),buttonStyle:()=>i.Styles.createButtonStyle({paddingVertical:10,paddingHorizontal:20,flexDirection:"row",borderRadius:30,borderWidth:1,maxWidth:180}),iconStyleMargin:()=>i.Styles.createViewStyle({marginRight:10}),textColor:()=>i.Styles.createTextStyle({color:l.Color.gray400})});class u extends o.default{constructor(){super(...arguments),this._uploadAvatarImage=()=>{this.props.onImageUploadSelected&&this.props.onImageUploadSelected()}}render(){return i.createElement(i.View,{style:h.containerStyle},i.createElement(r.HoverableButton,{style:h.buttonStyle,onPress:this._uploadAvatarImage,accessibilityLabel:n.getString("PesPicker.ImageUploaderTabPlaceholder")},i.createElement(a.default,{icon:d.SkypeIcon.Media,style:h.iconStyleMargin,color:this._useAccessibleTheme()?l.Color.black:l.Color.gray400,size:d.IconSize.size20}),i.createElement(c.BodyText,{style:h.textColor},n.getString("PesPicker.ImageUploaderTabPlaceholder"))))}}t.default=u},40392:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocationPickerPin=t.PinSize=t.CurrentLocationPinHeight=t.NonCurrentLocationPinHeight=void 0;const i=s(16426),o=s(16778),n=s(63099),r=s(52262),a=s(10117),l=s(36237),d=s(15877),c=s(33754),h=s(46705),u=s(18078),p=s(81760),g=s(11828),m=s(34528),S=s(78262),f=s(19675),y=s(24576);t.NonCurrentLocationPinHeight=99,t.CurrentLocationPinHeight=135,t.PinSize=22;const _=t.PinSize/2+5,v=(0,d.lazyProperties)({popover:()=>(0,d.lazyProperties)({contentContainer:()=>o.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"space-between",alignItems:"center",borderRadius:8,paddingHorizontal:10,backgroundColor:p.Color.gray400}),textContainer:()=>o.Styles.createViewStyle({paddingVertical:10,maxWidth:250,alignSelf:"center"}),narrowTextContainer:()=>o.Styles.createViewStyle({maxWidth:200}),caret:()=>o.Styles.createViewStyle({alignSelf:"center",justifyContent:"center",marginTop:-2,width:12,height:8,backgroundColor:p.Color.transparent}),textFirstLine:()=>o.Styles.createTextStyle({color:p.Color.white}),textSecondLine:()=>o.Styles.createTextStyle({flex:1,color:p.Color.gray200}),textSecondLineAccessible:()=>o.Styles.createTextStyle({flex:1,color:p.Color.white})}),mapMarkerStyle:()=>o.Styles.createTextStyle({alignSelf:"center",backgroundColor:"transparent",marginTop:5}),mapMarkerCurrentStyle:()=>o.Styles.createTextStyle({marginTop:_}),mapMarkerCurrentStyleDesktop:()=>o.Styles.createTextStyle({marginTop:0}),pinStyle:()=>o.Styles.createViewStyle({height:t.PinSize,width:t.PinSize,borderRadius:2*t.PinSize,backgroundColor:p.Color.gray400,borderWidth:3,borderColor:p.Color.white}),sendButtonStyle:()=>o.Styles.createTextStyle({justifyContent:"center",alignItems:"center",width:g.IconSize.default,height:g.IconSize.default})});class C extends y.default{constructor(){super(...arguments),this._onPressPopover=()=>{this.props.onPressPopupOver&&this.state.address&&this.props.onPressPopupOver(this.state.address.addressFriendlyName,this.state.address.fullAddress,this.state.address.shortAddress)}}_buildState(e,t){e.locationType===S.LocationType.Current&&e.userMri;let s={postedByCurrentUser:e.userMri&&u.default.isMyMri(e.userMri),address:{}};if(!s.postedByCurrentUser&&e.conversationId&&e.userMri&&(s.userName=r.default.getMemberShortNameForConversation(e.conversationId,e.userMri)),(t||e.overrideAddress)&&(s.isAddressOverwritten=!1,e.overrideAddress)){const t=c.getString("LocationPicker.FullAddress",{addressFriendlyName:e.overrideAddress.addressFriendlyName,address:e.overrideAddress.address});s.address.addressFriendlyName=e.overrideAddress.addressFriendlyName,s.address.fullAddress=t,s.address.shortAddress=e.overrideAddress.address,s.isAddressOverwritten=!0}return s}componentDidMount(){super.componentDidMount(),this._resolveAddress(this.props)}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),(e.overrideAddress||e.location!==this.props.location)&&this._resolveAddress(e)}requestFocus(){}render(){const e=[v.mapMarkerStyle];this.props.hideLocationPin&&e.push(v.mapMarkerCurrentStyleDesktop);const t=this.props.hideLocationPin?null:o.createElement(o.View,{style:v.pinStyle});return o.createElement(o.View,{style:this.props.style},this._getPopover(),o.createElement(o.View,{style:e},t))}_getPopover(){if(this.props.showSendPopover||this.props.showViewerPopover){const e=this._getPopoverTextElement();let t;return this.props.showSendPopover?t=o.createElement(o.View,{style:v.popover.contentContainer},e,o.createElement(o.Button,{title:c.getString("LocationPicker.SendButtonTitle"),onPress:this._onPressPopover,autoFocus:!0},o.createElement(a.default,{style:v.sendButtonStyle,size:g.IconSize.size24,color:p.Color.white,icon:g.SkypeIcon.Send}))):this.props.showViewerPopover&&(t=o.createElement(o.Button,{style:v.popover.contentContainer,onPress:this._onPressPopover},e,o.createElement(a.default,{style:v.sendButtonStyle,size:g.IconSize.size24,color:p.Color.white,icon:m.navForwardIcon()}))),o.createElement(o.View,null,t,this._getCaret())}return null}_getPopoverTextElement(){let e,t=this._getTextLines();t.second&&(e=o.createElement(f.BodyText,{numberOfLines:1,allowFontScaling:!1,style:this._useAccessibleTheme()?v.popover.textSecondLineAccessible:v.popover.textSecondLine},t.second));const s=[v.popover.textContainer];return this.props.narrow&&s.push(v.popover.narrowTextContainer),o.createElement(o.View,{style:s},o.createElement(f.RowTitle,{numberOfLines:1,allowFontScaling:!1,style:v.popover.textFirstLine},t.first),e)}_getTextLines(){let e=this._getCurrentLocationString(),t="";return this.props.showViewerPopover?t=c.getString("LocationPicker.TapToSeeOnMapLabel"):this.state.address&&(this.props.locationType===S.LocationType.Current?t=this.state.address.fullAddress:this.state.isAddressOverwritten?t=this.state.address.shortAddress:this.state.address.locality&&this.state.address.zipCode&&(t=this.state.address.state?c.getString("LocationPicker.LocalAddressLabel",{locality:this.state.address.locality,state:this.state.address.state,zipcode:this.state.address.zipCode}):c.getString("LocationPicker.LocalAddressNoStateLabel",{locality:this.state.address.locality,zipcode:this.state.address.zipCode}))),{first:e,second:t}}_getCurrentLocationString(){let e;return this.props.locationType===S.LocationType.Current?e=this.state.postedByCurrentUser?c.getString("LocationPicker.YourLocationLabel"):this.state.userName?c.getString("LocationPicker.SharedCurrentLocation",{userName:this.state.userName}):void 0:this.state.address&&(e=this.state.address.addressFriendlyName,e||(e=this.state.address.streetName&&this.state.address.streetNumber?c.getString("LocationPicker.LocalStreetLabel",{streetName:this.state.address.streetName,streetNumber:this.state.address.streetNumber}):c.getString("LocationPicker.NoValidAddressFallback"))),e}_getCaret(){return o.createElement(i.ImageSvg,{style:v.popover.caret,webShadow:"3px 3px 6px rgba(0, 175, 240, 0.2)",width:12,height:8},o.createElement(i.SvgPath,{strokeColor:p.Color.gray400,strokeWidth:1,strokeOpacity:0,fillColor:p.Color.gray400,fillOpacity:1,d:"M12,0 l0,0 c0,0 0,0 0,0 l0,0 c0,0 0,0 0,0 l0,0 l-6,8 l-6,-8 l0,0 c0,0 0,0 0,0 l0,0 c0,0 0,0 0,0 z"}))}_resolveAddress(e){if(!e.skipAddressResolution&&!e.overrideAddress&&e.location&&!this._queryingGeocodingServices){this._queryingGeocodingServices=!0;const t=(new Date).getTime();n.resolveAdddress({lat:e.location.latitude,lng:e.location.longitude}).then((s=>{this._queryingGeocodingServices=!1;const i=this.isComponentMounted(),o=null!==s;i&&this.setState({address:s});const n=(new Date).getTime();l.track(new h.LocationPickerResolveAddress(e.locationType,o,i,n-t))})).catch((s=>{this._queryingGeocodingServices=!1;const i=this.isComponentMounted(),o=(new Date).getTime();l.track(new h.LocationPickerResolveAddress(e.locationType,!1,i,o-t))}))}}}t.LocationPickerPin=C,t.default=C},31298:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MojiItem=void 0;const i=s(16778),o=s(89391),n=s(47204),r=s(74313),a=s(39285),l=s(10117),d=s(15877),c=s(33754),h=s(20849),u=s(58660),p=s(30124),g=s(95549),m=s(60621),S=s(58962),f=s(36150),y=s(81760),_=s(11828),v=s(19675),C=s(75865),b=(0,d.lazyProperties)({mojiContainer:()=>i.Styles.createViewStyle({alignItems:"center",justifyContent:"center"}),sendButtonWrapper:()=>i.Styles.createViewStyle({position:"absolute",right:0,left:0,top:0,bottom:0,flex:1,alignItems:"center",justifyContent:"center",backgroundColor:y.Color.blueOverlay70}),flippedView:()=>i.Styles.createViewStyle({transform:[{scaleX:-1}]})}),T="mojiPreviewDialog";class M extends g.PesPickerItem{constructor(){super(...arguments),this._isMojiImageLoaded=!1,this._onDismissMojiPreview=e=>{e&&this.props.id===e.id&&this.isComponentMounted()&&this.setState({isPreviewOn:!1})},this._onSendMoji=e=>{e&&this.props.id===e.id&&this.isComponentMounted()&&this._onPressPesItem()},this._handleMojiImageLoad=()=>{this._isMojiImageLoaded=!0},this._handleMojiImageLoadError=()=>{this._mojiPreviewCloseSubscriptionToken&&(this._mojiPreviewCloseSubscriptionToken.unsubscribe(),this._mojiPreviewCloseSubscriptionToken=void 0),this._mojiSendSubscriptionToken&&(this._mojiSendSubscriptionToken.unsubscribe(),this._mojiSendSubscriptionToken=void 0)},this._sendMojiFromPreviewModal=()=>{n.default.dismissModal(T,this._getRootViewId()),this.props.onSelected(this.props.info),this.state.isPreviewOn&&this.setState({isPreviewOn:!1})},this._dismissMojiPreviewModal=()=>{n.default.dismissModal(T,this._getRootViewId())},this._onUpdateMojiPreview=()=>{this.isComponentMounted()&&this.setState({isPreviewOn:!1})},this._onCloseMojiPreviewModal=()=>{this._dismissMojiPreviewModal(),this._onUpdateMojiPreview()}}_buildState(e,t){const s=o.default.getConfigSettings().pes.rewriteRules,i=S.rewriteUrl(e.info.baseUrl,s),n=i+"/views/meta."+c.getLocale();let r=i+"/views/thumbnail";return{thumbnailUrl:C.default.getAuthenticatedUrl(r),localizedMetadata:h.default.getMetadataForMoji(n,e.info.id),isUsingStackNavigationContext:p.default.isUsingStackNavigationContext()}}_getStyle(e){let t=M._cachedStyles[e];return t||(t={thumbnailContainer:i.Styles.createViewStyle({width:e,height:e,alignItems:"center",justifyContent:"center"},!1),thumbnailImage:i.Styles.createImageStyle({position:"absolute",top:0,left:0,width:e-1,height:e},!1),mojiTitle:i.Styles.createTextStyle({width:e-2,paddingHorizontal:1,paddingTop:8,color:y.Color.gray300,textAlign:"center"},!1),mojiPlaceholder:i.Styles.createViewStyle({width:e,height:e,backgroundColor:y.Color.gray100,justifyContent:"center",alignItems:"center"},!1),mojiMask:i.Styles.createTextStyle({position:"absolute",top:0,left:0,fontSize:e+1})},M._cachedStyles[e]=t),t}componentDidMount(){super.componentDidMount(),this._mojiPreviewCloseSubscriptionToken=m.MojiPreviewService.onPesPreviewClosed(this._onDismissMojiPreview),this._mojiSendSubscriptionToken=m.MojiPreviewService.onSend(this._onSendMoji)}componentWillUnmount(){super.componentWillUnmount(),this._mojiPreviewCloseSubscriptionToken&&(this._mojiPreviewCloseSubscriptionToken.unsubscribe(),this._mojiPreviewCloseSubscriptionToken=void 0),this._mojiSendSubscriptionToken&&(this._mojiSendSubscriptionToken.unsubscribe(),this._mojiSendSubscriptionToken=void 0)}_renderItem(e){const t=this._getStyle(this.props.dimension),s=this.props.showPlaceholder?i.createElement(i.View,{style:[t.thumbnailContainer,t.mojiPlaceholder]},i.createElement(l.default,{icon:_.SkypeIcon.Moji,size:_.IconSize.size14,color:y.Color.gray300})):void 0,o=i.createElement(i.View,{style:[t.thumbnailContainer,t.mojiPlaceholder]},i.createElement(l.default,{icon:_.SkypeIcon.MojiDeleted,size:_.IconSize.size14,color:y.Color.gray300})),n=this._shouldShowSendOverlay()?i.createElement(a.default,{style:b.sendButtonWrapper},i.createElement(l.default,{icon:_.SkypeIcon.Send,size:_.IconSize.size16,color:y.Color.white,style:this._getContext().isRTL?b.flippedView:void 0})):void 0,d=!this.props.hideTitle&&this.state.localizedMetadata?i.createElement(v.Caption,{small:!0,style:t.mojiTitle,numberOfLines:1,accessibilityHidden:!0},this.state.localizedMetadata.pickerTitle):void 0,c=this._useDarkTheme()?y.Color.pesPickerBackgroundDark:y.Color.pesPickerBackgroundLight,h=this._getMojiTitle();return[i.createElement(i.View,{key:"mojiContainer",style:b.mojiContainer,title:h,importantForAccessibility:i.Types.ImportantForAccessibility.Yes,accessibilityTraits:i.Types.AccessibilityTrait.Button},i.createElement(a.default,{key:"thumbnailContainer",style:t.thumbnailContainer},i.createElement(r.default,{origin:"MojiThumbnail",key:"thumbnail",style:t.thumbnailImage,containerStyle:t.thumbnailContainer,altView:s,errorView:o,resizeMode:"cover",source:this.state.thumbnailUrl,onLoad:this._handleMojiImageLoad,onError:this._handleMojiImageLoadError}),n),i.createElement(l.default,{icon:_.SkypeIcon.MojiMaskInverted,size:this.props.dimension,color:c,style:t.mojiMask}),d)]}_shouldShowSendOverlay(){return this.state.isPreviewOn||this.props.isSelected}_getMojiTitle(){let e;return this.state.localizedMetadata&&(this.props.renderMobileInterface?(e=c.getString("Moji.PreviewMoji",{pickerTitle:this.state.localizedMetadata.pickerTitle||""}),this._shouldShowSendOverlay()&&(e=c.getString("Moji.SendMoji",{mojiName:e}))):e=this.state.localizedMetadata.pickerTitle,this.state.localizedMetadata.copyright&&(e+=this.state.localizedMetadata.copyright)),e}_onPressPesItem(){if(this._isMojiImageLoaded)if(this.props.sendOnFirstTapIfScreenReaderActive&&f.default.isMobileScreenReaderEnabled())this.props.onSelected(this.props.info);else{if(this.props.showMojiPreviewAsFullScreenModal){const e=i.createElement(u.MojiPreview,{moji:this.props.info,onClose:this._dismissMojiPreviewModal,onSend:this._sendMojiFromPreviewModal,useFullScreen:!0,useTransparentDarkTheme:!0,showSendButton:!0,sendButtonTitle:c.getString("Moji.SendButtonTitle"),showReplayOnMojiAfterPlay:!0,setAccessibilityFocusOnMoji:!0});return this.props.onMojiPreviewSeen&&this.props.onMojiPreviewSeen(),void n.default.showModal(e,T,{rootViewId:this._getRootViewId()})}if(this.props.renderMobileInterface)if(!this.props.renderMobileInterface||this.state.isUsingStackNavigationContext)this.props.renderMobileInterface&&!this.state.isPreviewOn?(m.MojiPreviewService.openPesPreview(this.props.info),this.setState({isPreviewOn:!0})):(m.MojiPreviewService.closePesPreview(),this.setState({isPreviewOn:!1}),this.props.onSelected(this.props.info));else if(this.state.isPreviewOn||this.props.isSelected)this._onCloseMojiPreviewModal(),this.props.onSelected(this.props.info);else{const e=i.createElement(u.MojiPreview,{moji:this.props.info,onClose:this._onCloseMojiPreviewModal,onSend:this._sendMojiFromPreviewModal,onMojiUpdated:this._onUpdateMojiPreview,useTransparentDarkTheme:!0,showSendButton:!0,sendButtonTitle:c.getString("Moji.SendButtonTitle")});this._dismissMojiPreviewModal(),n.default.showModal(e,T,{rootViewId:this._getRootViewId()}),this.setState({isPreviewOn:!0})}else this.props.isSelected&&this.props.onSelected&&this.props.onSelected(this.props.info)}}_getImportantForAccessibility(){}_getAccessibilityLabel(e){}}t.MojiItem=M,M._cachedStyles={}},1117:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(89391),r=s(70891),a=s(46096),l=s(97174),d=s(36237),c=s(15877),h=s(33754),u=s(76093),p=s(31298),g=s(72666),m=s(96168),S=s(31903),f=s(63584),y=s(60621),_=s(83294),v=s(58962),C=s(31234),b=s(29130),T=s(86045),M=s(11828),I=(0,c.lazyProperties)({previewMarginBottom:()=>o.Styles.createViewStyle({marginBottom:10})});class w extends S.PesPicker{constructor(){super(...arguments),this._renderPesItem=e=>{const t=this.state.items[e];if(!t)return d.warn(a.LogTraceArea.Pes,`Moji with id ${e} not found`),null;const s=this.state.itemsForTabsMap[this._currentTabIndex],i=s&&s[0]===e,n=this._getItemDimension(),r=!!this.state.previewItem&&this.state.previewItem.id===t.id,l=-1===this.state.focusedButtonIndexInPack&&r;return n?o.createElement(p.MojiItem,{autoFocus:this._shouldAutoFocusFirstItem()&&i,tabIndex:l?0:-1,ref:this._itemsInCurrentTabRefs.onComponentRef(e),onFocus:this._getButtonFocusCallback(e),key:t.id,id:t.id,info:t,isSelected:r,renderMobileInterface:this.props.renderMobileInterface,onHover:this._onPesHoverBound,onSelected:this._onSelected,dimension:n,showPlaceholder:!0,showMojiPreviewAsFullScreenModal:this.props.showMojiPreviewAsFullScreenModal,onMojiPreviewSeen:this.props.onMojiPreviewSeen,onItemWillMount:this._onMojiItemWillMount,onItemDidMount:this._onMojiItemDidMount}):null},this._onSelected=e=>{const t=n.default.getConfigSettings().pes,s=t.xmmFallbackUrl+t.xmmFallbackUrlParams+e.id,i=new l.MojiEntity(e.id,e.baseUrl,e.baseUrl+"/views/thumbnail","Video.1/Flik.1",s,"","Moji",e.description||"");this.props.onPesSelected(i,v.mediaTypes.moji,e.id),this._trackClickedMoji(e),!this.props.renderMobileInterface&&this.state.isSearching&&this._desktopSearchTelemetry&&(this._desktopSearchTelemetry.sendSuccessTelemetryEvent(e.id,this.state.searchQuery.length),this._searchSuccessTelemetry=!0)},this._trackClickedMoji=e=>{f.MojiPickerTelemetry.itemAdded(void 0),this._trackClickedItem(e.id)},this._onMojiPreviewClosed=e=>{if(e&&T.default.isMobileScreenReaderEnabled()){let t=this._itemsInCurrentTabRefs.ref(e.id);t&&t.requestFocus()}this.isComponentMounted()&&this.setState({previewItem:void 0})},this._onMojiPreviewOpened=e=>{this.setState({previewItem:e})},this._onMojiItemWillMount=()=>{f.MojiPickerTelemetry.willMountItem()},this._onMojiItemDidMount=()=>{f.MojiPickerTelemetry.mountedItem()}}_buildState(e,t){const s=this._getRootViewId();return Object.assign(Object.assign({},super._buildState(e,t)),{deviceOrientation:b.default.getDeviceOrientation(s)})}componentDidMount(){super.componentDidMount(),this._mojiPreviewOpenSubscriptionToken=y.MojiPreviewService.onPesPreviewOpened(this._onMojiPreviewOpened),this._mojiPreviewCloseSubscriptionToken=y.MojiPreviewService.onPesPreviewClosed(this._onMojiPreviewClosed)}componentWillUnmount(){super.componentWillUnmount(),this._mojiPreviewOpenSubscriptionToken.unsubscribe(),this._mojiPreviewCloseSubscriptionToken.unsubscribe(),f.MojiPickerTelemetry.pickerWillUnmount()}_willChangeCategory(e){super._willChangeCategory(e),e!==this._getPesTabType()&&(y.MojiPreviewService.closePesPreview(),f.MojiPickerTelemetry.closed())}_getPesPreview(){if(!this.state.previewItem)return;const e=this.props.renderMobileInterface?r.MojiSize.Large:r.MojiSize.Medium;return o.createElement(u.default,{style:I.previewMarginBottom,key:this.state.previewItem.id,borderColor:this._themeColors.primaryBackgroundColor,src:this.state.previewItem.baseUrl,hideMetadata:!0,autoPlay:!0,size:e,pesID:this.state.previewItem.id})}_getInitialPagedTabIndex(){return 1}_getEmptyRecentMessage(){return h.getString("PesPicker.EmptyRecentMojis")}_getPesTabType(){return v.TabType.Moji}_getTabs(e,t){const s=m.default.getMojiTabs();let o;if(e){o=_.searchInPackTitleAndDescription(s,e),o=i.filter(o,(e=>e.packs&&e.packs.length>0));const t=this._mergePacksInSingleTab(o);t&&(o=[t])}else if(""!==e){const e=C.default.getRecentMojiTabInfo();(!t||t&&!i.isEmpty(e.packs))&&s.unshift(e)}const n=o||s;return this._getContext().isRTL,n}_getSearchNoResultsMessage(){return h.getString("PesSearch.MojiPickerNoResultsSearchText")}_getErrorMessage(){return h.getString("MediaBar.MojiPickerErrorText")}_getPackAccessibilityLabel(e){return h.getString("PesPicker.MojiPackHeaderAccessibilityLabel",{title:e.title,count:e.items.length})}_getErrorSymbol(){return M.SkypeIcon.MojiDeleted}_getPesInfo(e){return[e.pickerTitle?e.pickerTitle.trim():void 0,e.copyright?e.copyright.trim():void 0]}_getPesItem(e){return g.default.getMoji(e)}_getSearchLabel(){return h.getString("PesPicker.SearchMojis")}_getStaticItemDimension(){return(this._getItemDimension()||this._getDefaultItemDimension())+this._doubleBorderItem}_getDefaultItemDimension(){return v.frameHeights.moji.Size70}_getMinItems(e){return 5}}t.default=w},13168:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocationPickerId=void 0;const i=s(96486),o=s(34828),n=s(16778),r=s(44770),a=s(97691),l=s(89391),d=s(48564),c=s(11930),h=s(98278),u=s(58691),p=s(36237),g=s(15877),m=s(33754),S=s(46705),f=s(89808),y=s(71082),_=s(15415),v=s(19675),C=s(24576);var b,T;!function(e){e[e.Ready=0]="Ready",e[e.Fetching=1]="Fetching",e[e.Failed=2]="Failed",e[e.Complete=3]="Complete"}(b||(b={})),function(e){e.BingFooter="nbpl_bingFooter",e.BingHeader="nbpl_bingHeader",e.BingPlace="nbpl_bingPlace",e.FoursquareFooter="nbpl_foursquareFooter",e.FoursquareHeader="nbpl_foursquareHeader",e.FoursquarePlace="nbpl_place"}(T||(T={})),t.LocationPickerId="LocationPicker";const M={key:"foursquareHeader",template:T.FoursquareHeader,height:43,isNavigable:!1,isHoverable:!1,accessibilityGroup:o.Types.AccessibilityGroupMarker.Begin,accessibilityGroupLabel:m.getString("LocationPicker.NearByPlacesLabel")},I={key:"bingHeader",template:T.BingHeader,height:43,isNavigable:!1,isHoverable:!1,accessibilityGroup:o.Types.AccessibilityGroupMarker.Begin,accessibilityGroupLabel:m.getString("LocationPicker.NearByPlacesLabel")},w={key:"foursquareFooter",template:T.FoursquareFooter,height:46,isNavigable:!1,isHoverable:!1,accessibilityGroup:o.Types.AccessibilityGroupMarker.End,accessibilityTrait:n.Types.AccessibilityTrait.None},P={key:"bingFooter",template:T.BingFooter,height:46,isNavigable:!1,isHoverable:!1,accessibilityGroup:o.Types.AccessibilityGroupMarker.End,accessibilityTrait:n.Types.AccessibilityTrait.None},k=(0,g.lazyProperties)({container:()=>n.Styles.createViewStyle({alignSelf:"stretch",flexDirection:"column",alignItems:"flex-start"}),spinner:()=>n.Styles.createViewStyle({flex:1,justifyContent:"center",alignItems:"center",alignSelf:"stretch"}),errorContainer:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch",justifyContent:"center",alignItems:"center"}),errorMessage:()=>n.Styles.createTextStyle({textAlign:"center"}),listContainer:()=>n.Styles.createViewStyle({alignSelf:"stretch"}),poweredByImage:()=>n.Styles.createImageStyle({flexDirection:"row",justifyContent:"center",marginVertical:8,paddingVertical:15}),nearbyTitleContainer:()=>n.Styles.createViewStyle({paddingHorizontal:10,paddingTop:20,paddingBottom:8,flexDirection:"row",alignItems:"flex-end",justifyContent:"space-between"})});class A extends C.default{constructor(){super(...arguments),this._renderItem=e=>{switch(e.template){case T.BingHeader:case T.FoursquareHeader:const t=m.getString("LocationPicker.NearByPlacesLabel"),s=e.template===T.FoursquareHeader?m.getString("LocationPicker.PoweredByFoursquareLabel"):m.getString("LocationPicker.PoweredByBingMapsLabel"),i=!0,o=i?c.default.headerAccessibilityInfo(t,s):void 0;return n.createElement(n.View,{key:e.key,style:[k.nearbyTitleContainer,this._themeStyles.primaryBackgroundColorStyle],accessibilityLabel:o?o.accessibilityLabel:void 0,accessibilityTraits:o?o.accessibilityTraits:void 0,importantForAccessibility:i?n.Types.ImportantForAccessibility.Yes:void 0},n.createElement(v.Subtitle,{accessibilityHidden:!!i},t),n.createElement(v.Caption,{accessibilityHidden:!!i},s));case T.BingFooter:return n.createElement(n.Image,{key:e.key,style:k.poweredByImage,accessibilityLabel:m.getString("LocationPicker.PoweredByBingMapsLabel"),source:this.state.poweredByBingImageUrl,resizeMode:"contain"});case T.FoursquareFooter:return n.createElement(n.Image,{key:e.key,style:k.poweredByImage,accessibilityLabel:m.getString("LocationPicker.PoweredByFoursquareLabel"),source:r.Collection.POWERED_BY_FOURSQUARE,resizeMode:"contain"});case T.BingPlace:return n.createElement(y.BingListItem,{key:e.key,id:e.key,suggestion:e.suggestion,onPlaceSelected:this.props.onItemSelected,onPlaceSent:this.props.sendItem,onRemoveItem:this._onRemoveItem});case T.FoursquarePlace:return n.createElement(y.FoursquareListItem,{key:e.key,place:e.place,onPlaceSelected:this.props.onItemSelected,onPlaceSent:this.props.sendItem});default:return[]}},this._onRemoveItem=e=>{this.setState({itemList:i.filter(this.state.itemList,(t=>t.key!==e))})}}_buildState(e,t){const s={disableFoursquareApi:l.default.getS4LMessagingFeatures().disableFoursquareApi};return t&&(s.itemList=[],s.service=b.Ready,s.poweredByBingImageUrl=l.default.getS4LMessagingFeatures().bingMapsPoweredByImageUrl),s}componentDidMount(){super.componentDidMount(),this._fetchLocations(this.props.latitude,this.props.longitude,this.props.query)}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),e.latitude===this.props.latitude&&e.longitude===this.props.longitude&&e.query===this.props.query||this._fetchLocations(e.latitude,e.longitude,e.query)}_fetchLocations(e,t,s){if(!e||!t)return;this._runningSearchTasks&&i.each(this._runningSearchTasks,(e=>e.cancel()));let o=this.state.service;if(this._runningSearchTasks=[],null==s?void 0:s.length){o=b.Fetching;const r=d.default.getInstance().getAutoSuggestResults(e,t,s);this._runningSearchTasks.push(r.then((e=>{let t=this.state.itemList;const s=i.findIndex(t,(e=>e.key===P.key));s>=0&&(t=t.slice(s+1));const o=[];(null==e?void 0:e.length)&&o.push(I),o.push(...i.map(e,(e=>({template:T.BingPlace,height:84,key:e.id,suggestion:e,accessibilityTrait:n.Types.AccessibilityTrait.Button})))),(null==e?void 0:e.length)&&o.push(P),this.isComponentMounted()&&this.setState({itemList:[...o,...t],service:b.Complete})})))}if(!this.state.disableFoursquareApi){o=b.Fetching;const r=u.default.getInstance().getLocations(e,t,s,25,125e3);this._runningSearchTasks.push(r.then((e=>{let t=this.state.itemList;const s=i.findIndex(t,(e=>e.key===M.key));s>=0&&(t=t.slice(0,s));const o=[];e.length>0&&o.push(M),o.push(...i.map(e,((e,t)=>({template:T.FoursquarePlace,height:84,key:`${e.latitude},${e.longitude},fourquare_${t}`,place:e,accessibilityTrait:n.Types.AccessibilityTrait.Button})))),e.length>0&&o.push(w),this.isComponentMounted()&&this.setState({itemList:[...t,...o],service:b.Complete})})))}const r=(new Date).getTime();a.all(this._runningSearchTasks).then((()=>{const e=this.isComponentMounted(),t=(new Date).getTime();p.track(new S.LocationPickerNearByFetching(this.props.locationType,e,t-r)),this._runningSearchTasks=void 0})).fail((e=>{const t=this.isComponentMounted(),s=(new Date).getTime();p.track(new S.LocationPickerNearByFetchingFailed(this.props.locationType,t,s-r,e&&i.isNumber(e.statusCode)?e.statusCode:0))})),this.setState({service:o,itemList:[]})}_renderLocationItems(){return this.state.itemList.length?n.createElement(o.VirtualListView,{itemList:this.state.itemList,renderItem:this._renderItem,animateChanges:!1,skipRenderIfItemUnchanged:!0,keyboardDismissMode:"on-drag",keyboardShouldPersistTaps:!0,style:k.listContainer,accessibilityLabel:m.getString("LocationPicker.NearByPlacesListLabel")}):n.createElement(n.View,{style:k.listContainer})}render(){const e=[k.container,this._themeStyles.primaryBackgroundColorStyle,this.props.style],t=this.state.service===b.Fetching?n.createElement(n.View,{style:k.spinner},n.createElement(_.default,{size:h.SXActivityIndicatorSize.Medium,tintColor:f.default.getPrimaryColorNoSubscription()})):void 0,s=this._shouldRenderError()?n.createElement(n.View,{style:k.errorContainer},n.createElement(n.Text,{style:[k.errorMessage,this._themeStyles.secondaryTextColorStyle]},m.getString(this.props.searchModeOn?"LocationPicker.NoResultsFound":"LocationPicker.NoPlacesNearByFound"))):void 0;return n.createElement(n.View,{style:e},this._renderLocationItems(),t,s)}_shouldRenderError(){return!this.props.latitude||!this.props.longitude||this.state.service===b.Failed||this.state.service===b.Complete&&this.state.itemList.length<=1||i.isEmpty(this.props.query)}}t.default=A},71082:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FoursquareListItem=t.BingListItem=void 0;const i=s(16778),o=s(88837),n=s(48564),r=s(74313),a=s(10117),l=s(15877),d=s(51072),c=s(81760),h=s(11828),u=s(19675),p=s(24576),g=(0,l.lazyProperties)({listItem:()=>i.Styles.createViewStyle({flexDirection:"row",paddingHorizontal:10,paddingVertical:12}),placePicture:()=>i.Styles.createViewStyle({width:60,height:60,marginRight:10}),extraInfoContainer:()=>i.Styles.createViewStyle({flex:1,justifyContent:"center"}),placeName:()=>i.Styles.createTextStyle({marginBottom:5}),alternateView:()=>i.Styles.createViewStyle({flex:1,alignSelf:"stretch",width:60,height:60,alignItems:"center",justifyContent:"center",backgroundColor:c.Color.gray300})});class m extends p.default{constructor(){super(...arguments),this._onPlaceSelectedOrSent=()=>{i.UserInterface.isNavigatingWithKeyboard()&&this.props.onPlaceSent?this.props.onPlaceSent():this.props.onPlaceSelected()},this._hoverStart=()=>{this.setState({isHovering:!0})},this._hoverEnd=()=>{this.setState({isHovering:!1})}}render(){const e=i.createElement(i.View,{style:g.alternateView},i.createElement(a.default,{icon:h.SkypeIcon.Location,size:h.IconSize.size20,color:c.Color.white})),t=[g.listItem];return this.state.isHovering&&t.push(this._themeStyles.rowHighlightViewStyle),i.createElement(i.View,null,i.createElement(d.MaybeListItem.Button,{key:this.props.name+this.props.address,style:t,onPress:this._onPlaceSelectedOrSent,onFocus:this.props.onPlaceSelected,onHoverStart:this._hoverStart,onHoverEnd:this._hoverEnd},i.createElement(r.default,{origin:"NearByPlacePhoto",key:"placePhoto",resizeMode:"cover",title:this.props.name,source:this.props.photoUrl,style:g.placePicture,containerStyle:g.placePicture,altView:e,errorView:e}),i.createElement(i.View,{style:g.extraInfoContainer},i.createElement(u.RowTitle,{style:g.placeName,numberOfLines:1},this.props.name),i.createElement(u.BodyText,{numberOfLines:1,textThemeColor:u.TextThemeColor.Secondary},this.props.address))))}}class S extends o.ComponentBase{constructor(e){super(e),this._onSelected=()=>{this.state.place&&this.props.onPlaceSelected(this.state.place)},this._onSent=()=>{this.state.place&&this.props.onPlaceSent&&this.props.onPlaceSent(this.state.place)},this._bingMapsClient=n.default.getInstance()}componentDidMount(){super.componentDidMount(),this._bingMapsClient.getLocationDetail(this.props.suggestion).then((e=>{this.isComponentMounted()&&this.setState({place:e})})).catch((()=>{this.isComponentMounted()&&this.props.onRemoveItem(this.props.id)}))}render(){return i.createElement(m,{name:this.props.suggestion.name,address:this.props.suggestion.address,photoUrl:this.state.place&&this.state.place.photoUrl,onPlaceSelected:this._onSelected,onPlaceSent:this._onSent})}}t.BingListItem=S;class f extends o.ComponentBase{constructor(){super(...arguments),this._onSelected=()=>{this.props.onPlaceSelected(this.props.place)},this._onSent=()=>{this.props.onPlaceSent&&this.props.onPlaceSent(this.props.place)}}render(){return i.createElement(m,{name:this.props.place.name,address:this.props.place.address,photoUrl:this.props.place.photoUrl,onPlaceSelected:this._onSelected,onPlaceSent:this._onSent})}}t.FoursquareListItem=f},43855:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(44770),n=s(15877),r=s(24576),a=(0,n.lazyProperties)({sendingIndicator:()=>i.Styles.createViewStyle({height:48,width:48}),sendingIndicatorDark:()=>i.Styles.createViewStyle({opacity:.5})});class l extends r.default{render(){return i.createElement(i.Image,{style:[a.sendingIndicator,this._useDarkTheme()?a.sendingIndicatorDark:void 0],source:this._useDarkTheme()?o.Collection.SENDING_INDICATOR_DARK:o.Collection.SENDING_INDICATOR_LIGHT,resizeMode:"contain"})}}t.default=l},31903:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PesPicker=t.SearchInputHeight=t.PesListMobilePadding=t.PesPreviewContainerHeight=t.PesPreviewContainerWidth=t.HeaderContainerVerticalPadding=t.CategorySwitcherIconHeight=t.MinimumPesHeaderHeight=t.DesktopTabViewMargin=void 0;const i=s(96486),o=s(48404),n=s(16778),r=s(44770),a=s(89391),l=s(98278),d=s(46096),c=s(10117),h=s(36237),u=s(47126),p=s(15877),g=s(33754),m=s(6250),S=s(30124),f=s(47990),y=s(43855),_=s(96168),v=s(79096),C=s(95549),b=s(41067),T=s(83294),M=s(17707),I=s(58962),w=s(75821),P=s(31234),k=s(51070),A=s(81115),E=s(86045),R=s(22538),L=s(4057),F=s(81760),x=s(40363),O=s(11010),D=s(11828),B=s(78262),V=s(80837),N=s(60305),U=s(19675),H=s(24576),z=s(53374);class W extends o.PesTabView{}class j extends o.PesListView{}t.DesktopTabViewMargin=10,t.MinimumPesHeaderHeight=60,t.CategorySwitcherIconHeight=44,t.HeaderContainerVerticalPadding=10,t.PesPreviewContainerWidth=140,t.PesPreviewContainerHeight=120,t.PesListMobilePadding=8,t.SearchInputHeight=30;const G=(0,p.lazyProperties)({pesPickerContainerMobile:()=>n.Styles.createViewStyle({flex:1,alignItems:"stretch",justifyContent:"center"}),pesPickerContainerTransparent:()=>n.Styles.createViewStyle({backgroundColor:F.Color.transparent}),errorPaddingStyle:()=>n.Styles.createViewStyle({padding:15}),pesScrollContainer:()=>n.Styles.createViewStyle({alignSelf:"stretch"}),pesScrollContainerMobile:()=>n.Styles.createViewStyle({paddingHorizontal:8}),pesScrollContainerTransparent:()=>n.Styles.createViewStyle({backgroundColor:F.Color.transparent}),tabViewStyleRTL:()=>n.Styles.createViewStyle({transform:[{scaleX:-1}]}),wrappedPesList:()=>n.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap",alignItems:"center",justifyContent:"flex-start",flex:1}),sectionTitle:()=>n.Styles.createViewStyle({alignSelf:"stretch",borderBottomWidth:1,borderStyle:"solid",marginBottom:4}),sectionTitleDesktop:()=>n.Styles.createViewStyle({borderBottomWidth:0,paddingTop:10}),sectionTitleText:()=>n.Styles.createTextStyle({margin:4}),sectionTitleLight:()=>n.Styles.createTextStyle({color:F.Color.gray300}),sectionTitleAccessible:()=>n.Styles.createTextStyle({color:F.Color.black}),errorContainer:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center"}),errorIconContainer:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center",paddingBottom:30}),errorTextStyle:()=>n.Styles.createTextStyle({textAlign:"center"}),messageContainer:()=>n.Styles.createViewStyle({justifyContent:"center",alignItems:"center"}),messageText:()=>n.Styles.createTextStyle({textAlign:"center",marginHorizontal:40}),flippedView:()=>n.Styles.createViewStyle({transform:[{scaleX:-1}]}),headerShadow:()=>n.Styles.createViewStyle({left:0,right:0,height:1,marginBottom:-1}),wrappedContent:()=>n.Styles.createViewStyle({flexDirection:"column-reverse",flex:1,alignItems:"stretch"}),pesPickerContainerBackgroundLight:()=>n.Styles.createViewStyle({backgroundColor:F.Color.pesPickerBackgroundLight}),pesPickerContainerBackgroundDark:()=>n.Styles.createViewStyle({backgroundColor:F.Color.pesPickerBackgroundDark}),sectionTitleView:()=>n.Styles.createViewStyle({alignSelf:"stretch",height:20}),sectionTitleTextMargin:()=>n.Styles.createViewStyle({marginTop:5,marginLeft:5}),desktop:()=>(0,p.lazyProperties)({pesPickerContainerDesktop:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row"}),pesListViewMargin:()=>n.Styles.createViewStyle({marginLeft:t.DesktopTabViewMargin}),sectionTitleText:()=>n.Styles.createViewStyle({marginTop:4,marginBottom:4,marginRight:4,marginLeft:6}),previewInfoContainer:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center",borderRightWidth:1,borderColor:F.Color.gray50,width:t.PesPreviewContainerWidth}),previewContainer:()=>n.Styles.createViewStyle({flexGrow:1,alignItems:"center",justifyContent:"center"}),previewLabel:()=>n.Styles.createTextStyle({textAlign:"center",marginHorizontal:8}),searchNoResultsImage:()=>n.Styles.createImageStyle({height:80,width:80}),searchResultsList:()=>n.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap",paddingTop:10}),loadingContainer:()=>n.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"center"})}),mobile:()=>(0,p.lazyProperties)({pesPickerTabContainer:()=>n.Styles.createViewStyle({paddingHorizontal:t.PesListMobilePadding})})});let K={};class q extends H.default{constructor(){super(...arguments),this._tabsSeen=!1,this._tabHeaderRefs={},this._buttonFocusCallbacks={},this._cachedDimensions={},this._listViewNoPagingRefs={},this._previewSeen=!1,this._itemsInCurrentTabRefs=new m.default,this._doubleBorderItem=2*C.PesItemBorderWidth,this._scrolledToTop=!0,this._headerOpacityValue=new n.Animated.Value(0),this._headerOpacityStyle=n.Styles.createAnimatedViewStyle({opacity:this._headerOpacityValue}),this._onPesHoverBound=i.debounce((e=>{if(!this.isComponentMounted())return;const t={previewItem:e};this.setState(t)}),100),this._trackClickedItem=(e,t,s,o)=>{if(!this.state.enableItemClickTracking)return;const n=this.state.isSearching?0:this._currentTabIndex,r=this.state.tabs[n],a=i.find(r.packs,(t=>i.includes(t.items,e))),l=this.state.availableWidth||this.props.availableWidth,d={itemIndex:a?i.indexOf(a.items,e):-1,sectionIndex:r?i.indexOf(r.packs,a):-1,tabIndex:n,pickerWidth:l||-1,itemTone:t,type:this._getPesTabType(),groupIndex:s,isSearchMode:this.props.searchMode,triggeredBy:o};h.track(new f.PesItemTelemetryEvent(d))},this._onCategoryPressed=e=>{let t;switch(e){case I.TabType.Emoticon:t=B.MediaBarCustomAction.LaunchEmoticon;break;case I.TabType.Moji:t=B.MediaBarCustomAction.LaunchMoji;break;case I.TabType.ChatSticker:t=B.MediaBarCustomAction.LaunchSticker;break;case I.TabType.Gif:t=B.MediaBarCustomAction.LaunchGif}this._willChangeCategory(e),this.props.onCustomAction&&!i.isUndefined(t)&&this.props.onCustomAction(t)},this._onCategorySwitcherRef=e=>{this._categorySwitcherRef=e||void 0},this._setTabViewRef=e=>{this._tabViewRef=e||void 0},this._setTabViewNoPagingRef=e=>{this._tabViewNoPagingRef=e||void 0},this._setTabIndicatorRef=e=>{this._tabIndicatorRef=e||void 0},this._setMainContentRef=e=>{this._mainContentRef=e||void 0},this._renderTabContent=(e,t)=>{if(!e)return null;if(e.id===P.default.recentTabId&&0===e.packs.length){const e=[G.messageContainer];return this._appendCommonStyles(e),n.createElement(n.View,{style:e},n.createElement(n.Text,{style:[G.messageText,this._themeStyles.primaryTextColorStyle]},this._getEmptyRecentMessage()))}if(this.state.isFetchingItems)return this._getLoadingView();const s=this._getPesListViewStyle(),r=[G.pesScrollContainer];this.props.renderMobileInterface&&r.push(G.pesScrollContainerMobile),this.props.darkTheme&&r.push(G.pesScrollContainerTransparent),this._appendCommonStyles(r);const a=this._getPacksForPesListView(e.packs),l=this._getStaticItemDimension()||40;let d,c=!0;i.isUndefined(t)||(d=t-20,c=d>l);const h=this.state.tabs[0].id===e.id;if(this.props.renderMobileInterface&&this._shouldRenderTabsWithoutPaging())return n.createElement(n.View,{style:r},n.createElement(o.PesPackHorizontalListView,{packs:a,renderPackHeader:c?this._renderPackHeader:this._noOp,renderPackItem:h?this._renderFirstTabPesItem:this._renderPesItem,style:s,availableHeight:d,itemHeight:l,getNumberOfColumnsForInitialRender:(t,s,i)=>this._getNumberOfColumnsForInitialRender(t,s,i,e.id),ref:t=>this._onListViewRef(t,e.id)}));{const e=this._getNumberOfItemsPerLine()||4;return this._hasEmptyPack(a)?this._getErrorView():n.createElement(j,{packs:a,itemHeight:l,renderPackHeader:this._renderPackHeader,renderPackItem:this._renderPesItem,style:[...s,this.state.safeAreaHorizontalPaddingStyle],onScroll:this._onScroll,onScrolled:this._onDesktopScroll,numberOfColumns:e,onKeyPress:this._onKeyPress,setScrollTopOnKeyboardNavigation:!1})}},this._noOp=e=>{},this._renderPackHeader=e=>{let t=this.props.renderMobileInterface?[G.sectionTitleView]:[G.sectionTitle,this._themeStyles.dividerBorderColorStyle];this.props.renderMobileInterface||t.push(G.sectionTitleDesktop);const s=this.state.packs[e];if(s)return n.createElement(n.View,{key:"sectionTitle",ref:this._setFirstTabHeaderRef,style:t,accessibilityLabel:this._getPackAccessibilityLabel(s),importantForAccessibility:n.Types.ImportantForAccessibility.Yes,accessibilityTraits:[n.Types.AccessibilityTrait.Text,n.Types.AccessibilityTrait.Header],tabIndex:-1},n.createElement(n.Text,{style:this._getSectionTitleTextStyle(),numberOfLines:1,allowFontScaling:!1},s.title));h.warn(d.LogTraceArea.Pes,`Pack with id ${e} not found`)},this._onScroll=(e,t)=>{if(this.props.onScroll&&this.props.onScroll(e,t),!this.state.isDesktopCompositeNav){const t=e<=0;this._scrolledToTop!==t&&(this._scrolledToTop=t,n.Animated.timing(this._headerOpacityValue,{toValue:t?0:1,duration:50,easing:n.Animated.Easing.Out()}).start())}},this._onCurrentVisibleTabChanged=e=>{if(this._tabIndicatorRef){const t=i.findIndex(this.state.tabs,(t=>t.id===e));this._tabIndicatorRef.onPageSelected({position:t}),this._setListViewUpdatePriority(t)}},this._onTabSelected=e=>{const t=i.findIndex(this.state.tabs,(t=>t.id===e.id));if(this._currentTabIndex===t)return;this._previousTabIndex=this._currentTabIndex,this._currentTabIndex=t,this._setListViewUpdatePriority(this._currentTabIndex),this._tabViewRef&&this._tabViewRef.showTab(this.state.tabs[this._currentTabIndex]),this._tabViewNoPagingRef&&this._tabViewNoPagingRef.showTab(this.state.tabs[this._currentTabIndex]),this._tabIndicatorRef&&this._tabIndicatorRef.onPageSelected({position:this._currentTabIndex}),this._itemsInCurrentTabRefs=new m.default,this._buttonFocusCallbacks={},this.setState({hasSwitchedTabs:!0});this._tabHeaderRefs[this._currentTabIndex];this.requestFocusOnFirstItem(),this._willChangeTab(e)},this._setFirstTabHeaderRef=e=>{this._previousTabIndex&&this._tabHeaderRefs[this._previousTabIndex]&&!e&&(this._tabHeaderRefs[this._previousTabIndex]=void 0),this._currentTabIndex&&!this._tabHeaderRefs[this._currentTabIndex]&&e&&(this._tabHeaderRefs[this._currentTabIndex]=e,this.props.dontSetFocusOnTabHeader)},this._onContainerLayout=e=>{const s=e.width-t.DesktopTabViewMargin;this.state.availableWidth!==e.width&&this.setState({availableWidth:s}),this._onPickerResize()},this._onContainerBlur=()=>{this.setState({hasFocus:!1,focusedButtonIndexInPack:-1,focusedPackIndex:-1})},this._onKeyPress=e=>{let t=0;const s=this._getNumberOfItemsPerLine()||0;if(e.keyCode===u.default.RIGHT?t=1:e.keyCode===u.default.LEFT?t=-1:e.keyCode===u.default.UP?t=-s:e.keyCode===u.default.DOWN&&(t=s),0===t)return;let i,o=this.state.isSearching?0:this._currentTabIndex,n=this.state.focusedButtonIndexInPack,r=this.state.focusedPackIndex;const a=this._getPacksForPesListView(this.state.tabs[o].packs);if(i=this.state.isSearching?Object.keys(this.state.items):a[Object.keys(a)[r]],!i)return;let l,d=i.length,c=n%s;const h=n+t;if(h<d&&h>-1)l=i[h];else if(this.state.isSearching&&e.keyCode===u.default.DOWN){Math.floor(n/s)===Math.floor((d-1)/s)||(l=i[d-1])}else e.keyCode===u.default.LEFT||e.keyCode===u.default.UP?l=this._getRequiredItemIdOfAdjacentPack(!1,r,n,c,t,a,s,i):e.keyCode===u.default.RIGHT?l=this._getRequiredItemIdOfAdjacentPack(!0,r,n,0,t,a,s,i):e.keyCode===u.default.DOWN&&(l=this._getRequiredItemIdOfAdjacentPack(!0,r,n,c,t,a,s,i));l&&this._requestFocusOnItem(l),e.preventDefault(),e.stopPropagation()},this._renderFirstTabPesItem=e=>this._renderPesItem(e,!0)}_buildState(e,t){let s;e.filter&&(s=L.default.deburrLowerCase(e.filter.trim()));const i=a.default.getS4LMessagingFeatures(),o=S.default.isUsingStackNavigationContext(),n=N.default.useTabletUI(),r=o||n,d=N.default.isTablet()?!e.searchMode&&e.showCategorySwitcher:!e.searchMode&&e.showCategorySwitcher&&o,c=!!e.forceExcludeRecents||e.renderMobileInterface&&this._shouldRenderTabsWithoutPaging(),h=this._getTabs(s,c,i.enableEmoticonGroups),u=this._getPackDataForPicker(h),p=this._getPesItems(h,e.filter),{itemIdsPerTabMap:g,previewItem:m,totalItemsCount:f}=this._getItemIdsForTabs(h,e.filter),y={tabs:h,packs:u,items:p,totalItemsCount:f,loadingStatus:_.default.getLoadingStatus(),isDesktopCompositeNav:!o,isSearching:!!e.filter,bottomSafeAreaInset:k.default.bottomSafeAreaInset(l.BottomInsetDefault),safeAreaHorizontalInsets:k.default.horizontalInsets(l.HorizontalInsetDefault),useMobileUI:r,itemsForTabsMap:g,showCategorySwitcher:d,forceRenderTabIndicator:!1,enableItemClickTracking:i.enableIndividualPesItemTelemetry,focusedButtonIndexInPack:-1,focusedPackIndex:-1};return t?(this._currentTabIndex=this._getStartingTabIndex(h),y.searchQuery="",y.hasSwitchedTabs=!1,y.previewItem=m):this.state.previewItem||(y.previewItem=m),y.isFetchingItems=!(!h||!h[this._currentTabIndex])&&h[this._currentTabIndex].isFetchingItems,e.ancestorUsesSafeAreaHorizontalPaddingStyle||(y.safeAreaHorizontalPaddingStyle=k.default.horizontalPaddingStyle(l.HorizontalInsetDefault)),y}componentDidMount(){super.componentDidMount();const e=z.default.newCauseId();h.log(d.LogTraceArea.Pes,"PesPicker componentDidMount causeId: "+e),this.state.loadingStatus===_.PesConfigLoadingStatus.NotStarted?R.EnsureStarted(M.default).then((()=>M.default.refreshConfig(e))):this.state.loadingStatus===_.PesConfigLoadingStatus.Loading&&M.default.refreshConfig(e)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);const i=this.state.searchQuery!==t.searchQuery,o=this.props.filter!==e.filter;if(this._shouldAnnounceForAccessibility(i,o)){const e=this.props.filter||this.state.searchQuery;this._annouceForAccessibility(this._getSearchItemsCountForAccessibility(),e)}if(o){this._itemsInCurrentTabRefs=new m.default,this._buttonFocusCallbacks={};const e=this.state.items[Object.keys(this.state.items)[0]];this.setState({previewItem:e})}}componentWillUnmount(){super.componentWillUnmount(),this._desktopSearchTelemetry&&this.state.isSearching&&!this._searchSuccessTelemetry&&this._desktopSearchTelemetry.cancelSessionTelemetryEvent(this.state.searchQuery.length)}_shouldRenderTabsWithoutPaging(){return!E.default.isMobileScreenReaderEnabled()&&this._supportsRenderTabsWithoutPaging()}_supportsRenderTabsWithoutPaging(){return!1}_requestFocusOnItem(e){const t=this._itemsInCurrentTabRefs.ref(e);t&&t.requestFocus()}_getButtonFocusCallback(e){return this._buttonFocusCallbacks[e]||(this._buttonFocusCallbacks[e]=t=>{let s=-1,o=-1;if(this.state.isSearching)s=i.indexOf(Object.keys(this.state.items),e);else{const t=this._getPacksForPesListView(this.state.tabs[this._currentTabIndex].packs);i.each(t,((n,r)=>{if(s=i.indexOf(n,e),-1!==s)return o=i.indexOf(Object.keys(t),r),!1}))}this.setState({focusedButtonIndexInPack:s,focusedPackIndex:o})}),this._buttonFocusCallbacks[e]}_getWrappedPesListStyle(e){if(0===e)return[G.wrappedPesList];let t=K[e];return t||(t=n.Styles.createViewStyle({marginHorizontal:e},!1),K[e]=t),[G.wrappedPesList,t]}_onPickerResize(){}_willChangeTab(e){}_willChangeCategory(e){}_getItemIdsForTabs(e,t){const s={};let o,n=0;return i.each(e,((e,r)=>{const a=[];i.each(e.packs,(s=>{i.each(s.items,(s=>{const i=this._getPesItem(s,t);i&&this._isPesItemVisible(i)&&(a.push(i.id),o||this.props.renderMobileInterface||e.id===P.default.recentTabId||(o=i))}))})),s[r]=a,n+=a.length})),{itemIdsPerTabMap:s,previewItem:o,totalItemsCount:n}}_mergePacksInSingleTab(e){let t;if(e.length>0){t=e[0];let s=new Array;i.each(e,(e=>{s=s.concat(e.packs)}));t=Object.assign(Object.assign({},t),{packs:s})}return t}_shouldAutoFocusFirstItem(){return(this.state.hasSwitchedTabs||this.props.autoFocusFirstItem)&&!this.state.isSearching}_getItemDimensionBasedOnAvailableWidth(e,t,s){const o=this._getAvailableWidthForItemsDisplay(e),n=t+this._doubleBorderItem,r=Math.round(o/n);let a=o/Math.max(s,r)-2*C.PesItemPadding-this._doubleBorderItem;if(-1!==a.toString().indexOf(".")){const e=i.split(a.toString(),".",2);a=parseFloat(e[0]+"."+e[1].charAt(0))}return a}_getItemDimension(){const e=this.state.availableWidth;if(i.isUndefined(e))return;if(this._cachedDimensions[e])return this._cachedDimensions[e];let t=this._getMinItems(e),s=this._getItemDimensionBasedOnAvailableWidth(Math.floor(e),this._getDefaultItemDimension(),t);return this._cachedDimensions[e]=s,this._cachedDimensions[e]}_getMinItems(e){return 3}_getPesItems(e,t){const s={};return i.each(e,(e=>{i.each(e.packs,(e=>{i.each(e.items,(e=>{const i=this._getPesItem(e,t);i&&this._isPesItemVisible(i)&&(s[e]=i)}))}))})),s}_getNumberOfItemsPerLine(){const e=this.state.availableWidth;if(!i.isUndefined(e))return Math.floor(this._getAvailableWidthForItemsDisplay(e)/this._getStaticItemDimension())}_getAvailableWidthForItemsDisplay(e){return e-(t.DesktopTabViewMargin||2*t.PesListMobilePadding)-this.state.safeAreaHorizontalInsets.left-this.state.safeAreaHorizontalInsets.right}requestFocusOnFirstItem(){const e=this.state.itemsForTabsMap[this._currentTabIndex];e&&e.length>0&&this._requestFocusOnItem(e[0])}_getPackDataForPicker(e){let t={};return i.each(e,(e=>{i.each(e.packs,(e=>{t[e.id]=e}))})),t}_reverseLayout(){return x.default.isRTL()&&x.default.getPlatformType()===d.PlatformType.Android}_isDarkThemeAllowed(){return this._useDarkTheme()&&!!this.props.darkTheme}render(){return this.props.renderMobileInterface?this._renderMobile():this._renderDesktop()}_renderMobile(){if(this.state.loadingStatus===_.PesConfigLoadingStatus.Error)return this._getErrorView();if(this._noSearchResultsFound())return this.props.onSearchNoResultsFound&&this.props.onSearchNoResultsFound(),this._getNoSearchResultsView();if(this._isLoadingConfig())return this._getLoadingView();const e=this.state.tabs[this._currentTabIndex],t=this._reverseLayout();this._tabsSeen=!this.props.doNotRenderTabIndicator&&!this.state.searchQuery;const s=[];this.state.safeAreaHorizontalPaddingStyle&&s.push(this.state.safeAreaHorizontalPaddingStyle),this.state.bottomSafeAreaInset&&s.push(A.default.marginBottomStyle(this.state.bottomSafeAreaInset)),this._isDarkThemeAllowed()?s.push(G.pesPickerContainerBackgroundDark):s.push(G.pesPickerContainerBackgroundLight);let i=this._tabsSeen?n.createElement(w.default,{style:s,initialTab:e,ref:this._setTabIndicatorRef,transparentTheme:!1,onPesDeleteButtonPress:this.props.onPesDeleteButtonPress,tabs:this.state.tabs,onTabSelected:this._onTabSelected,conversationId:this.props.conversationId,onMessageSent:this.props.onMessageSent,onCloseSearch:this.props.onCloseSearch,clearEditInChatsComposer:this.props.clearEditInChatsComposer,renderMobileInterface:this.props.renderMobileInterface,reversed:t,hideSearchDelete:this.props.hideSearchDelete,darkTheme:this._isDarkThemeAllowed()}):null,r=this._shouldRenderTabsWithoutPaging()?n.createElement(o.PesTabViewNoPaging,{ref:this._setTabViewNoPagingRef,style:t?G.tabViewStyleRTL:void 0,tabs:this.state.tabs,renderTab:this._renderTabContent,tabOrderReversed:t,onTabSelected:this._onTabSelected,onCurrentScrollActiveTabChanged:this._onCurrentVisibleTabChanged,onScroll:this._onMobileScroll}):n.createElement(W,{style:t?G.tabViewStyleRTL:void 0,initialTab:e,ref:this._setTabViewRef,tabs:this.state.tabs,renderTab:this._renderTabContent,onTabSelected:this._onTabSelected,forceDesktopMode:this._shouldForceLandscapeMode(),tabOrderReversed:t,isFetching:!!this.state.isFetchingItems,availableWidth:this.state.availableWidth,removeHiddenItems:this._getPesTabType()===I.TabType.Gif});this.state.showCategorySwitcher&&(r=n.createElement(n.View,{style:G.wrappedContent,onLayout:this._onContainerLayout},r,n.createElement(n.Animated.View,{style:[G.headerShadow,this._themeStyles.headerShadowColorStyle,this._headerOpacityStyle]}),n.createElement(v.default,{ref:this._onCategorySwitcherRef,key:"categorytoggle",currentTabType:this._getPesTabType(),onSwitchPesTabType:this._onCategoryPressed,showInLandscape:!0,preventAutoFocus:this.props.preventAutoFocusOnCategory})));const a=this._isDarkThemeAllowed()?G.pesPickerContainerBackgroundDark:G.pesPickerContainerBackgroundLight,l=[G.pesPickerContainerMobile,a];if(this.props.isRenderedForCustomStatus){const e=n.Styles.createViewStyle({width:this.props.availableWidth},!1);l.push(e)}return n.createElement(n.View,{ref:this._setMainContentRef,key:this._containerKey(),style:l,onLayout:this._onContainerLayout},r,i)}_isLoadingConfig(){const e=this.state.tabs&&1===this.state.tabs.length&&this.state.tabs[0].id===P.default.recentTabId;return this.state.loadingStatus===_.PesConfigLoadingStatus.NotStarted||this.state.loadingStatus===_.PesConfigLoadingStatus.Loading||i.isEmpty(this.state.tabs)||e}_renderDesktop(){let e,t,s;if(this._tabsSeen=!1,this.state.loadingStatus===_.PesConfigLoadingStatus.Error)e=this._getErrorView();else if(this.state.isSearching)this._desktopSearchTelemetry||(this._desktopSearchTelemetry=new b.default(!0,this._getPesTabType())),t=this._getOptionalPesPreview(),e=this._getDesktopSearchResults();else if(this._isLoadingConfig())e=this._getLoadingView();else{t=this._getOptionalPesPreview();const i=this.state.tabs[this._currentTabIndex],o=this._reverseLayout(),r=[];this.state.safeAreaHorizontalPaddingStyle&&r.push(this.state.safeAreaHorizontalPaddingStyle),this.state.bottomSafeAreaInset&&r.push(A.default.marginBottomStyle(this.state.bottomSafeAreaInset)),this._tabsSeen=!this.props.doNotRenderTabIndicator||this.state.forceRenderTabIndicator,s=this._tabsSeen?n.createElement(w.default,{style:r,initialTab:i,ref:this._setTabIndicatorRef,transparentTheme:!1,onPesDeleteButtonPress:this.props.onPesDeleteButtonPress,tabs:this.state.tabs,onTabSelected:this._onTabSelected,conversationId:this.props.conversationId,onMessageSent:this.props.onMessageSent,onCloseSearch:this.props.onCloseSearch,clearEditInChatsComposer:this.props.clearEditInChatsComposer,renderMobileInterface:this.props.renderMobileInterface,reversed:o,darkTheme:this._isDarkThemeAllowed(),hideDeleteButton:this.props.hideDeleteButton}):void 0,e=n.createElement(n.View,{ref:this._setMainContentRef,onLayout:this._onContainerLayout,onBlur:this._onContainerBlur,style:V.default.flexOne},n.createElement(W,{style:o?G.tabViewStyleRTL:void 0,initialTab:i,ref:this._setTabViewRef,tabs:this.state.tabs,renderTab:this._renderTabContent,onTabSelected:this._onTabSelected,forceDesktopMode:this._shouldForceLandscapeMode(),tabOrderReversed:o,isFetching:!!this.state.isFetchingItems,removeHiddenItems:!1,availableWidth:this.state.availableWidth}))}const i=[G.desktop.pesPickerContainerDesktop];return this.props.darkTheme&&i.push(G.pesPickerContainerTransparent),n.createElement(n.View,{key:this._containerKey(),style:i},t,n.createElement(n.View,{style:V.default.flexOne},e,s))}getNumberOfPesItemsRendered(){let e=0;return this.state.tabs&&i.each(this.state.tabs,(t=>{i.each(t.packs,(t=>{e+=t.items.length}))})),e}requestFocus(){this._categorySwitcherRef&&this._categorySwitcherRef.requestFocus()}getTabIndexByTabId(e,t){return i.findIndex(e,(e=>e.id===t))}getTabIndexByCopyright(e,t){return i.findIndex(e,(e=>e.copyright===t))}_getStartingTabIndex(e){return this._shouldRenderTabsWithoutPaging()?0:this._getInitialPagedTabIndex(e)}_isPesItemVisible(e){return i.isUndefined(e.visible)||e.visible}_containerKey(){return"container"+this.state.safeAreaHorizontalInsets.left+"_"+this.state.safeAreaHorizontalInsets.right}_shouldForceLandscapeMode(){return!1}_getNumberOfColumnsForInitialRender(e,t,s,i){let o=e;for(let e=0;e<this.state.tabs.length;e++){const n=this.state.tabs[e],r=n.id===i;for(let e=0;e<n.packs.length;e++){if(r&&e===s)return o;if(o-=Math.ceil(n.packs[e].items.length/t),o<=0)return 0}}return o}_setListViewUpdatePriorityForTab(e,t,s){if(s){const i=Math.abs(t-e);s.setBackgroundUpdatePriority(i)}}_setListViewUpdatePriority(e){i.each(this._listViewNoPagingRefs,((t,s)=>{this._setListViewUpdatePriorityForTab(e,+s,t)}))}_onListViewRef(e,t){const s=i.findIndex(this.state.tabs,(e=>e.id===t));s>-1&&(this._listViewNoPagingRefs[s]=e||void 0,this._setListViewUpdatePriorityForTab(this._currentTabIndex,s,e||void 0))}_hasEmptyPack(e){return i.some(e,(e=>!e.length))}_getPesListViewStyle(){let e=[V.default.flexOne];if(this.props.renderMobileInterface)e.push(G.mobile.pesPickerTabContainer);else{const t=G.desktop.pesListViewMargin;e.push(t)}return this.props.initialPaddingForSearchResults&&e.push(n.Styles.createViewStyle({paddingTop:this.props.initialPaddingForSearchResults},!1)),e}_appendCommonStyles(e){const t=this._reverseLayout(),s=this.state.safeAreaHorizontalPaddingStyle;e.push(V.default.flexOne),t&&e.push(G.flippedView),s&&e.push(s)}_getSectionTitleTextStyle(){let e=this._themeStyles.secondaryTextColorStyle;!this.props.darkTheme&&this._useAccessibleTheme()?e=G.sectionTitleAccessible:!this.props.darkTheme&&this._useDarkTheme()&&(e=G.sectionTitleLight);const t=[O.default.fontStyle.caption,e];let s=G.sectionTitleText;return this.props.renderMobileInterface&&this._shouldRenderTabsWithoutPaging()?s=G.sectionTitleTextMargin:this.props.renderMobileInterface||(s=G.desktop.sectionTitleText),t.push(s),t}_getOptionalPesPreview(){if(this._previewSeen=!1,!this.props.showingInNarrowView&&!this.props.doNotRenderPreview)return this._noSearchResultsFound()||this._isFetchingResults()&&!this.state.previewItem?n.createElement(n.View,{style:this._getPesPreviewStyle()},n.createElement(n.Image,{style:G.desktop.searchNoResultsImage,source:r.Collection.SEARCH_EMPTYSTATE})):!this._noSearchResultsFound()&&this.state.previewItem?(this._previewSeen=!0,n.createElement(n.View,{style:this._getPesPreviewStyle()},this._getPesPreviewMediaAndInfo())):void 0}_getPesPreviewStyle(){const e=[G.desktop.previewInfoContainer];return this._useDarkTheme()&&e.push(this._themeStyles.headerShadowBorderColorStyle),e}_getPesPreviewMediaAndInfo(){const e=G.desktop.previewContainer;return n.createElement(n.View,{key:"PreviewContainer",style:e},this._getPesPreview(),this._getPesPreviewInfo())}_getPesPreviewInfo(){const[e,t]=this._getPesInfo(this.state.previewItem),s=[G.desktop.previewLabel,O.default.fontStyle.captionSmall];e&&s.push(O.default.fontStyle.subtitle),s.push(this._themeStyles.primaryTextColorStyle);const i=[G.desktop.previewLabel,O.default.fontStyle.captionSmall];return n.createElement(n.View,{key:"InfoContainer",title:e},n.createElement(n.Text,{key:"pesTitle",style:s},e),n.createElement(n.Text,{key:"pesInfo",style:[i,this._themeStyles.secondaryTextColorStyle]},t))}_noSearchResultsFound(){return this.state.isSearching&&i.isEmpty(this.state.tabs)}_isFetchingResults(){return!1}_shouldAnnounceForAccessibility(e,t){return this.state.isSearching&&(e||t)}_getSearchItemsCountForAccessibility(){return this.getNumberOfPesItemsRendered()}_annouceForAccessibility(e,t){const s=this._getPesTabType();if(0===e){const e=T.getNoSearchResultsAnnouncementKey(s),i=g.getString(e,{query:t||""});n.Accessibility.announceForAccessibility(i)}else{const t=T.getSearchResultsAnnouncementKey(s),i=g.getString(t,{count:e});n.Accessibility.announceForAccessibility(i)}}_getDesktopSearchResults(){if(this._isFetchingResults())return this._getLoadingView();if(this._noSearchResultsFound())return this._desktopSearchTelemetry&&this._desktopSearchTelemetry.trackNoResultsInSearch(),this.props.onSearchNoResultsFound&&this.props.onSearchNoResultsFound(),this._getNoSearchResultsView();const e=[G.pesScrollContainer];this._appendCommonStyles(e);const t=G.desktop.searchResultsList;return n.createElement(n.View,{ref:this._setMainContentRef,style:e,onLayout:this._onContainerLayout,onKeyPress:this._onKeyPress,onBlur:this._onContainerBlur},n.createElement(n.ScrollView,{keyboardShouldPersistTaps:!0,style:this._getPesListViewStyle()},n.createElement(n.View,{style:t},i.map(this.state.items,((e,t)=>this._renderPesItem(t))))))}_getNoSearchResultsView(){return n.createElement(n.View,{style:[G.errorContainer]},n.createElement(U.BodyText,{style:G.errorTextStyle,textThemeColor:U.TextThemeColor.Secondary},this._getSearchNoResultsMessage()))}_getPacksForPesListView(e){let t={};return i.each(e,(e=>(t[e.id]=i.filter(e.items,(e=>!!this.state.items[e])),t))),t}_getErrorView(){const e=[G.errorContainer,G.errorPaddingStyle,this._themeStyles.primaryBackgroundColorStyle];return n.createElement(n.View,{style:e},n.createElement(n.View,{style:G.errorIconContainer},n.createElement(c.default,{icon:this._getErrorSymbol(),color:this._themeColors.secondaryTextColor,size:D.IconSize.size60})),n.createElement(U.BodyText,{style:G.errorTextStyle,textThemeColor:U.TextThemeColor.Secondary},this._getErrorMessage()))}_getLoadingView(e){const t=e?G.pesPickerContainerTransparent:this._themeStyles.primaryBackgroundColorStyle,s=this.props.renderMobileInterface?[G.errorContainer,t]:[G.desktop.loadingContainer];return n.createElement(n.View,{style:s},n.createElement(y.default,null))}_getRequiredItemIdOfAdjacentPack(e,t,s,i,o,n,r,a){if(!e&&t>0){t--;const e=n[Object.keys(n)[t]];let s=e.length-1;if(o<-1){const t=e.length;s=Math.floor((t-1)/r)*r+i,s>=e.length&&(s=e.length-1)}return e[s]}if(e){const e=a.length;if(!(Math.floor(s/r)===Math.floor((e-1)/r)))return a[e-1];if(t<Object.keys(n).length-1){t++;const e=n[Object.keys(n)[t]];return i>=e.length&&(i=e.length-1),e[i]}}}}t.PesPicker=q},79096:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(31844),n=s(16778),r=s(4736),a=s(89391),l=s(11930),d=s(98278),c=s(47126),h=s(15877),u=s(33754),p=s(9748),g=s(6250),m=s(26424),S=s(60621),f=s(58962),y=s(29130),_=s(51070),v=s(22222),C=s(11010),b=s(11828),T=s(81760),M=s(60305),I=s(24576),w=s(53374),P=(0,h.lazyProperties)({categoryButtonContainerTopMargin:()=>n.Styles.createViewStyle({marginTop:5,marginBottom:5}),categoryButtonContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignSelf:"stretch",justifyContent:"space-between",margin:5}),categoryButton:()=>n.Styles.createButtonStyle({flex:1,flexBasis:0,marginRight:5}),categoryButtonLast:()=>n.Styles.createButtonStyle({marginRight:0}),categoryButtonNotSelected:()=>n.Styles.createButtonStyle({opacity:.5}),categoryButtonText:()=>n.Styles.createTextStyle({fontSize:C.default.controlFontSize.caption}),desktop:()=>(0,h.lazyProperties)({categoryButtonContainer:()=>n.Styles.createViewStyle({flexGrow:1,flexShrink:0,flexDirection:"row",alignItems:"center",justifyContent:"flex-start",marginRight:5,overflow:"visible"}),categoryButton:()=>n.Styles.createButtonStyle({flexShrink:1,flexGrow:0,flexBasis:110,marginRight:5})})});class k extends I.default{constructor(){super(...arguments),this._mountedRefsMap=new g.default,this._buttonFocusCallbacks={},this._getTabByType=e=>{switch(e){case p.MediaBarItemKeys.Moji:return f.TabType.Moji;case p.MediaBarItemKeys.Sticker:return f.TabType.ChatSticker;case p.MediaBarItemKeys.Gif:return f.TabType.Gif;case p.MediaBarItemKeys.MeetNowIconPicker:return f.TabType.MeetNow;case p.MediaBarItemKeys.ImagePicker:return f.TabType.ImageUploader;case p.MediaBarItemKeys.Emoticon:default:return f.TabType.Emoticon}},this._onSwitchPesTabTypeEmoticon=()=>{this.props.onSwitchPesTabType(f.TabType.Emoticon),this._closeOtherPreviews(f.TabType.Emoticon)},this._onSwitchPesTabTypeMoji=()=>{this.props.onSwitchPesTabType(f.TabType.Moji),this._closeOtherPreviews(f.TabType.Moji)},this._onSwitchPesTabTypeChatSticker=()=>{this.props.onSwitchPesTabType(f.TabType.ChatSticker),this._closeOtherPreviews(f.TabType.ChatSticker)},this._onSwitchPesTabTypeGif=()=>{this.props.onSwitchPesTabType(f.TabType.Gif),this._closeOtherPreviews(f.TabType.Gif)},this._onSwitchTypeMeetNowIcon=()=>{this.props.onSwitchPesTabType(f.TabType.MeetNow),this._closeOtherPreviews(f.TabType.MeetNow)},this._onSwitchPesTabTypeImageUploader=()=>{this.props.onSwitchPesTabType(f.TabType.ImageUploader),this._closeOtherPreviews(f.TabType.ImageUploader)},this._closeOtherPreviews=e=>{e!==f.TabType.Gif&&S.GifPreviewService.closePesPreview(),e!==f.TabType.Moji&&S.MojiPreviewService.closePesPreview()},this._onKeyPress=e=>{let t=0;if(e.keyCode===c.default.RIGHT?t=1:e.keyCode===c.default.LEFT&&(t=-1),0!==t){const s=this.state.switcherCategories.length;this._focusButton((this.state.focusedButtonIndex+t+s)%s),e.preventDefault(),e.stopPropagation()}},this._onContainerBlur=()=>{this.setState({focusedButtonIndex:-1})}}_buildState(e,t){const{pesPickerCategoryOrder:s,enablePesGifs:i}=a.default.getS4LMessagingFeatures(),n=e.categoryOrder?e.categoryOrder:s,r=this._getRootViewId(),l={switcherCategories:this._getSwitcherCategories(n,i),safeAreaHorizontalPaddingStyle:_.default.horizontalPaddingStyle(d.HorizontalInsetDefault),isTablet:M.default.isTablet(),isLandscape:y.default.getDeviceOrientation(r)===o.DeviceOrientation.Landscape};return t&&(l.focusedButtonIndex=-1),l}_getSwitcherCategories(e,t){return(t?e:e.filter((e=>e!==p.MediaBarItemKeys.Gif))).map((e=>this._getTabByType(e)))}requestFocus(){const e=this._mountedRefsMap.ref(this.props.currentTabType.toString());e&&e.requestFocus()}render(){if(this.state.isLandscape&&!this.props.showInLandscape)return null;const e=this.state.switcherCategories.length,t=i.map(this.state.switcherCategories,((t,s)=>this._renderCategoryButton(t,0===s,s===this.state.switcherCategories.length-1,s,e))),s=this._getCategorySwitcherStyles();return n.createElement(n.View,{key:"categorytoggle",style:s,onBlur:this._onContainerBlur,onKeyPress:this._onKeyPress,accessibilityTraits:[n.Types.AccessibilityTrait.TabList]},t)}_getCategorySwitcherStyles(){let e;return e=[P.desktop.categoryButtonContainer],this.state.isTablet&&e.push(P.categoryButtonContainerTopMargin),this.state.safeAreaHorizontalPaddingStyle&&e.push(this.state.safeAreaHorizontalPaddingStyle),e}_renderCategoryButton(e,t,s,o,a){let c,h;const p={paddingLeft:5,paddingRight:5,height:m.PesCategorySwitcherHeight,borderRadius:17},g=e===this.props.currentTabType,S=this.state.focusedButtonIndex===o||-1===this.state.focusedButtonIndex&&g;let y;c=[P.desktop.categoryButton],h=[P.categoryButtonText],g||c.push(P.categoryButtonNotSelected),s&&c.push(P.categoryButtonLast),p.marginBottom=m.PesCategoryButtonSpacer,p.marginRight=m.PesCategoryButtonSpacer;let _=i.noop,C=b.SkypeIcon.EmoticonStroke;switch(e){case f.TabType.Emoticon:y=u.getString("PesPicker.EmoticonTitle"),_=this._onSwitchPesTabTypeEmoticon,C=b.SkypeIcon.EmoticonStroke;break;case f.TabType.Moji:y=u.getString("PesPicker.MojiTitle"),_=this._onSwitchPesTabTypeMoji,C=b.SkypeIcon.Moji;break;case f.TabType.ChatSticker:y=u.getString("PesPicker.StickerTitle"),_=this._onSwitchPesTabTypeChatSticker,C=b.SkypeIcon.Sticker;break;case f.TabType.Gif:y=u.getString("PesPicker.GifTitle"),_=this._onSwitchPesTabTypeGif,C=b.SkypeIcon.Gif;break;case f.TabType.MeetNow:y=u.getString("PesPicker.MeetNowTitle"),_=this._onSwitchTypeMeetNowIcon,C=b.SkypeIcon.MeetNow;break;case f.TabType.ImageUploader:y=u.getString("PesPicker.ImageUploaderTitle"),_=this._onSwitchPesTabTypeImageUploader,C=b.SkypeIcon.Media;break;default:return w.default.switchStatementExhaustiveChecking(e)}const M=l.default.tabAccessibilityLabel(y,o,a),I=l.default.tabAccessibilityTraits(g),k="button"+e;return this.props.showCategoriesAsIcons?n.createElement(r.default,{autoFocus:!this.props.preventAutoFocus&&g,ref:this._mountedRefsMap.onComponentRef(e.toString()),onFocus:this._getButtonFocusCallback(o),key:k,onPress:_,accessibilityLabel:M,accessibilityTraits:I,title:y,icon:C,iconSize:b.IconSize.size20,size:r.ActionButtonSize.Small,deselected:!g,tabIndex:S?0:-1,backgroundColor:!g&&this.props.disableDarkTheme?T.Color.gray50:void 0,iconColor:!g&&this.props.disableDarkTheme?T.Color.gray400:void 0}):n.createElement(v.default,{autoFocus:!this.props.preventAutoFocus&&g,onFocus:this._getButtonFocusCallback(o),ref:this._mountedRefsMap.onComponentRef(e.toString()),key:k,onPress:_,accessibilityLabel:M,accessibilityTraits:I,buttonStyle:g?d.SXButtonStyle.GradientFill:d.SXButtonStyle.ThemeStroke,buttonSize:d.SXButtonSize.Medium,textStyleDeprecated:h,title:y||"",style:c,backgroundStyle:p,tabIndex:S?0:-1})}_focusButton(e){const t=this.state.switcherCategories[e];if(!i.isUndefined(t)){const e=this._mountedRefsMap.ref(t.toString());e&&e.requestFocus()}}_getButtonFocusCallback(e){return this._buttonFocusCallbacks[e]||(this._buttonFocusCallbacks[e]=t=>{this.setState({focusedButtonIndex:e})}),this._buttonFocusCallbacks[e]}}t.default=k},95549:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PesPickerItem=t.PesItemBorder=t.PesItemPadding=t.PesItemBorderWidth=void 0;const i=s(16778),o=s(15877),n=s(89808),r=s(81760),a=s(24576);t.PesItemBorderWidth=2,t.PesItemPadding=1,t.PesItemBorder=t.PesItemBorderWidth+t.PesItemPadding;const l=(0,o.lazyProperties)({pesItemContainer:()=>i.Styles.createButtonStyle({borderColor:r.Color.transparent,borderRadius:4,borderStyle:"solid",borderWidth:t.PesItemBorderWidth,padding:t.PesItemPadding})});class d extends a.default{constructor(){super(...arguments),this._onButtonRef=e=>{this._buttonRef=e||void 0},this._onPesHoverStart=()=>{this.props.onHover&&this.props.onHover(this.props.info),this.setState({isHovering:!0})},this._onPesHoverEnd=()=>{this.setState({isHovering:!1})},this._onPress=()=>{this._onPressPesItem()},this._onPressIn=()=>{this.props.onPressIn&&this.props.onPressIn(this.props.info)},this._onLongPress=e=>{this.props.onItemLongPress&&this.props.onItemLongPress(e,this.props.info,(()=>this.isComponentMounted()?this:void 0))},this._onItemContextMenu=e=>{this.props.onItemContextMenu&&(e.preventDefault(),this.props.onItemContextMenu(e,this.props.info,(()=>this.isComponentMounted()?this:void 0)))}}_getImportantForAccessibility(){return i.Types.ImportantForAccessibility.No}_getAccessibilityLabel(e){}_getCustomParentStyle(){}render(){const e=this._renderItem(this.props.info),t=[l.pesItemContainer];if(this.state.isHovering){const e=this._useAccessibleTheme()?this._themeColors.dividerColor:n.default.getPrimaryColorNoSubscription();t.push(i.Styles.createViewStyle({borderColor:e},!1))}return i.createElement(i.Button,{autoFocus:this.props.autoFocus,tabIndex:this.props.tabIndex,ref:this._onButtonRef,key:this.props.id,style:[t,this._getCustomParentStyle()],onHoverStart:this._onPesHoverStart,onHoverEnd:this._onPesHoverEnd,onPressIn:this._onPressIn,onPressOut:this.props.onPressOut,onPress:this._onPress,onContextMenu:this.props.onItemContextMenu?this._onItemContextMenu:void 0,onLongPress:this.props.onItemLongPress?this._onLongPress:void 0,importantForAccessibility:this._getImportantForAccessibility(),accessibilityLabel:this._getAccessibilityLabel(this.props.info),onFocus:this.props.onFocus},e)}requestFocus(){this._buttonRef&&this._buttonRef.requestFocus()}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this.props.onItemWillMount&&this.props.onItemWillMount()}componentDidMount(){super.componentDidMount(),this.props.onItemDidMount&&this.props.onItemDidMount()}}t.PesPickerItem=d},79348:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PesPickerPopup=void 0;const i=s(96486),o=s(16426),n=s(16778),r=s(39024),a=s(82433),l=s(46096),d=s(36237),c=s(72490),h=s(47126),u=s(15877),p=s(33754),g=s(6250),m=s(26424),S=s(95549),f=s(60681),y=s(63584),_=s(58962),v=s(86045),C=s(93194),b=s(81760),T=s(24576);var M;!function(e){e[e.Diversity=0]="Diversity",e[e.EmoticonGroup=1]="EmoticonGroup"}(M||(M={}));const I=7,w=3,P=3,k=8,A=8,E=6,R=(0,u.lazyProperties)({container:()=>n.Styles.createViewStyle({position:"absolute",overflow:"visible",flexDirection:"column",alignItems:"stretch",paddingBottom:A,paddingLeft:w,paddingRight:w,backgroundColor:"transparent"}),bubble:()=>n.Styles.createViewStyle({position:"absolute",top:0,left:0,overflow:"visible",borderRadius:E}),shadow:()=>n.Styles.createViewStyle({shadowColor:b.Color.gray200,shadowOpacity:.9,shadowRadius:20,shadowOffset:{width:0,height:6}}),svg:()=>n.Styles.createViewStyle({position:"absolute"}),itemContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignContent:"stretch",justifyContent:"center",flexGrow:1,marginBottom:A}),item:()=>n.Styles.createViewStyle({flexGrow:1,justifyContent:"center",alignItems:"center"})});class L extends T.default{constructor(){super(...arguments),this._itemRefs=new g.default,this._focusedItemIndex=0,this._preventHide=!1,this.show=e=>{if(!this.isComponentMounted())return;n.Input.keyDownEvent.subscribe(this._onKeyDown),c.default.addEscapeHandler(this.hide),this._focusedItemIndex=0;const t=L._getPopupType(e.item);i.isUndefined(t)||(L._announcePickerOpening(e.item,t),y.PesPickerPopupTelemetry.open(e.triggeredBy),this.setState({isVisible:!0,displayData:e,popupType:t}))},this.hide=()=>!(!this.state.isVisible||!this.isComponentMounted())&&(this._preventHide?(this._preventHide=!1,!0):(n.Input.keyDownEvent.unsubscribe(this._onKeyDown),c.default.removeEscapeHandler(this.hide),y.PesPickerPopupTelemetry.closed(),this.setState({isVisible:!1}),y.PesPickerPopupTelemetry.pickerWillUnmount(),this.state.displayData&&this.state.displayData.onHide&&this.state.displayData.onHide(this.state.displayData.item.id),!0)),this.preventHide=()=>{this._preventHide=!0},this.item=()=>{if(this.state.displayData)return this.state.displayData.item},this.isVisible=()=>this.state.isVisible,this._setPopupPosition=e=>{const t={top:this._getPopupY(e.y)};this._getContext().isRTL?t.right=this._getPopupX(e.x,e.leftBoundary,e.rightBoundary):t.left=this._getPopupX(e.x,e.leftBoundary,e.rightBoundary),this._containerPositionStyle=n.Styles.createViewStyle(t,!1),this._svgPath=this._buildBubblePath()},this._setPopupSize=e=>{let t=(0,_.getFrameHeight)(e);this._itemWidth=t+2*P+2*S.PesItemBorder;const s=this._useAccessibleTheme()?2:0;this._pickerWidth=2*w+this._items.length*this._itemWidth+s,this._pickerHeight=2*I+this._itemWidth,this._containerSizeStyle=n.Styles.createViewStyle({width:this._pickerWidth,height:this._pickerHeight+A},!1),this._bubbleSizeStyle=n.Styles.createViewStyle({width:this._pickerWidth+s-1,height:this._pickerHeight-A-1},!1)},this._onItemSelected=e=>{y.PesPickerPopupTelemetry.itemAdded(e),this.state.displayData&&this.state.displayData.onItemSelected(e)},this._onMenuItemSelected=(e,t)=>{if(e===C.SXActionMenuCancel)return;const s=parseInt(e,10),i=this._items[s];i&&(y.PesPickerPopupTelemetry.itemAdded(i),t(i))},this._onKeyDown=e=>{if(!this.isVisible()||!this.isComponentMounted())return!1;switch(e.keyCode){case h.default.TAB:return e.shiftKey?this._focusPrevItem():this._focusNextItem(),!0;case h.default.LEFT:case h.default.UP:return this._focusPrevItem(),!0;case h.default.RIGHT:case h.default.DOWN:return this._focusNextItem(),!0}return!1},this._getFocusedItem=()=>this._itemRefs.ref(this._focusedItemIndex.toString()),this._focusPrevItem=()=>{this._focusedItemIndex=(this._focusedItemIndex+this._items.length-1)%this._items.length;const e=this._getFocusedItem();e&&(this.preventHide(),e.requestFocus())},this._focusNextItem=()=>{this._focusedItemIndex=(this._focusedItemIndex+1)%this._items.length;const e=this._getFocusedItem();e&&(this.preventHide(),e.requestFocus())},this._onEmoticonItemWillMount=()=>{y.PesPickerPopupTelemetry.willMountItem()},this._onEmoticonItemDidMount=()=>{y.PesPickerPopupTelemetry.mountedItem()},this._renderPopupItems=()=>{if(!this.state.displayData)return;const e=this.state.displayData.onItemHover,t=this.state.displayData.itemSize,s=[];return i.each(this._items,((i,o)=>{const r=this.preventHide;s.push(n.createElement(n.View,{key:i.id+"_"+o,style:R.item},n.createElement(f.PesPickerPopupEmoticonItem,{id:i.id,info:i,ref:this._itemRefs.onComponentRef(o.toString()),autoFocus:0===o,tabIndex:0,size:t,margin:P,renderMobileInterface:this.props.renderMobileInterface,emoticonGroupsEnabled:!0,isSelected:!1,onPressIn:r,onSelected:this._onItemSelected,onHover:e,onItemDidMount:this._onEmoticonItemDidMount,onItemWillMount:this._onEmoticonItemWillMount})))})),n.createElement(n.View,{style:R.itemContainer,restrictFocusWithin:!1,onBlur:this.hide},s)},this._buildBubblePath=()=>{const e=this._useAccessibleTheme()?1:0,t=e,s=e,i=this._pickerWidth-1,o=this._pickerHeight-A-1;return this._genLineSegment(t,E,"M")+this._genLineSegment(t,s,"C")+this._genLineSegment(E,s)+this._genLineSegment(E,s)+this._genLineSegment(i-E,s,"L")+this._genLineSegment(i,s,"C")+this._genLineSegment(i,E)+this._genLineSegment(i,E)+this._genLineSegment(i,o-E,"L")+this._genLineSegment(i,o,"C")+this._genLineSegment(i-E,o)+this._genLineSegment(i-E,o)+this._genLineSegment(this._beakPositionX+k,o,"L")+this._genLineSegment(this._beakPositionX,o+A,"L")+this._genLineSegment(this._beakPositionX-k,o,"L")+this._genLineSegment(E,o,"L")+this._genLineSegment(t,o,"C")+this._genLineSegment(t,o-E)+this._genLineSegment(t,o-E)+"Z"},this._genLineSegment=(e,t,s="")=>(this._useAccessibleTheme()||(e+=.5,t+=.5),s+e+","+t+" "),this._getPopupX=(e,t,s)=>{const i=this._pickerWidth/2;let o=e-i,n=o;const r=E+k+P;if(this._pickerWidth+this._itemWidth>s-t)return o=(s+t)/2-i,this._beakPositionX=i+n-o,this._beakPositionX=Math.min(this._beakPositionX,this._pickerWidth-r),this._beakPositionX=Math.max(this._beakPositionX,r),o;if(s+=w+P,o<(t-=w-P)){for(this._items.length%2==0&&(o+=this._itemWidth/2);o<t;)o+=this._itemWidth;n-=1,t=e-r,o=Math.min(o,t)}if(o+this._pickerWidth>s){for(this._items.length%2==0&&(o-=this._itemWidth/2);o+this._pickerWidth>s;)o-=this._itemWidth;s=e+r-this._pickerWidth,o=Math.max(o,s)}return this._beakPositionX=i+(n-o),o},this._getPopupY=e=>{let t=e-this._pickerHeight-1;return t=Math.max(t,0),t}}_buildState(e,t){let s={};return t&&(s.isVisible=!1),s}UNSAFE_componentWillUpdate(e,t,s){if(super.UNSAFE_componentWillUpdate(e,t,s),!t.displayData||!t.isVisible)return;const i=t.displayData.item;if(this.state.displayData&&this.state.displayData.item===t.displayData.item)this.state.displayData&&this.state.displayData.itemSize===t.displayData.itemSize||this._setPopupSize(t.displayData.itemSize);else{if(this._items=L._getPopupItems(t.displayData.item),this._items.length<2)return void d.warn(l.LogTraceArea.Pes,"PES picker pop-up cannot be shown (<2 options) for emoticon "+i.id);this._setPopupSize(t.displayData.itemSize)}this._setPopupPosition(t.displayData)}render(){return this.state.displayData&&this.state.isVisible?n.createElement(n.View,{style:[R.container,this._containerSizeStyle,this._containerPositionStyle]},this._renderBubble(),this._renderPopupItems()):null}showActionMenu(e,t,s){if(!t.description)return;const o=L._getPopupType(t);if(i.isUndefined(o))return;L._announcePickerOpening(t,o),this._items=L._getPopupItems(t);const n=[];i.each(this._items,((e,t)=>{n.push({text:r.getEmoticonAccessibilityLabel(e.description||e.id,e.tone),command:t.toString()})})),C.default.showWithActionMenuConfig({options:{anchor:()=>{},buttons:n},callback:e=>this._onMenuItemSelected(e,s),rootViewId:this._getRootViewId(),invokingEvent:e})}_svgPopupProps(){const e=this._useAccessibleTheme();return this._useDarkTheme()||e||!this._shadowsSupported()?{fillColor:this._themeColors.popoverBackgroundColor,fillOpacity:1,strokeColor:this._themeColors.dividerColor,strokeWidth:e?2:1,strokeOpacity:1,d:this._svgPath}:{fillColor:this._themeColors.popoverBackgroundColor,fillOpacity:1,d:this._svgPath}}_renderBubble(){const e=[R.bubble,this._bubbleSizeStyle],t=this._useAccessibleTheme();return this._useDarkTheme()||t||!this._shadowsSupported()||e.push(R.shadow),n.createElement(n.View,{key:"bubble",style:e},n.createElement(o.ImageSvg,{style:R.svg,width:this._pickerWidth,height:this._pickerHeight},n.createElement(o.SvgPath,Object.assign({},this._svgPopupProps()))))}_shadowsSupported(){return!0}static _announcePickerOpening(e,t){let s;s=t===M.Diversity?p.getString("PesPicker.DiversityPickerAnnouncement"):p.getString("PesPicker.EmoticonGroupPickerAnnouncement",{emoticonName:e.description||e.id}),v.default.maybeAnnounceForAccessibility(s)}static _getPopupType(e){return e.group&&e.group.length>0?M.EmoticonGroup:e.diverse?M.Diversity:void d.warn(l.LogTraceArea.Pes,"PES picker pop-up cannot be shown for emoticon "+e.id)}}t.PesPickerPopup=L,L._getPopupItems=e=>{let t;return L._getPopupType(e)===M.EmoticonGroup?(t=[],i.each(e.group,(s=>{const i=a.default.getEmoticonByName(s);i&&t.push(Object.assign(Object.assign({},i),{group:e.group}))})),t.length>6&&(d.warn(l.LogTraceArea.Pes,"More than 6 groupped emoticons found for emoticon "+e.id),t=i.take(t,6))):t=i.map(m.DiverseToneSuffixes,(t=>Object.assign(Object.assign({},e),{tone:t===m.DefaultDiverseTone?void 0:t}))),t}},60681:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PesPickerPopupEmoticonItem=void 0;const i=s(58460),o=s(39024);class n extends i.EmoticonItem{_getAccessibilityLabel(e){return o.getEmoticonInfoAccessibilityLabel(e)}_getPopupIndicator(e){}}t.PesPickerPopupEmoticonItem=n},63584:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PesPickerImageUploaderTelemetry=t.PesPickerMeetNowTelemetry=t.PesPickerPopupTelemetry=t.GifPickerTelemetry=t.StickerPickerTelemetry=t.MojiPickerTelemetry=t.EmoticonPickerTelemetry=void 0;const i=s(36237),o=s(58962),n=s(90025),r=s(15963),a=s(94050),l=s(53374);class d{constructor(e){this._pickerType=e,this._numberOfItems=0,this._shouldMeasureOpeningTime=!0,this._firstRender=!0}open(e){if(!this._scenario&&(this._usageEvent=new n.PesPickerUsageEvent(this._pickerType,this._firstRender,e),this._shouldMeasureOpeningTime)){const e=this._getScenarioNameForPickerType(this._pickerType);this._scenario=new a.default(e),this._scenario.start(void 0,this._endOpeningTime),this._shouldMeasureOpeningTime=!1}}_getScenarioNameForPickerType(e){switch(e){case o.TabType.Emoticon:return r.ScenarioName.OpenEmoticonPicker;case o.TabType.Moji:return r.ScenarioName.OpenMojiPicker;case o.TabType.ChatSticker:return r.ScenarioName.OpenChatStickerPicker;case o.TabType.Gif:return r.ScenarioName.OpenGifPicker;case o.TabType.PickerPopup:return r.ScenarioName.OpenDiversityPicker;case o.TabType.MeetNow:return r.ScenarioName.OpenMeetNowPicker;case o.TabType.ImageUploader:return r.ScenarioName.OpenImageUploader;default:return l.default.switchStatementExhaustiveChecking(e)}}willMountItem(){this._scenario&&this._numberOfItems++}mountedItem(){this._scenario&&(this._numberOfItems--,this._numberOfItems<=0&&this._usageEvent&&(this._scenario.markStepCompleted("finished_opening",void 0,void 0,!0),this._scenario.finish(),this._usageEvent.openingCompleted(Date.now()),this._scenario=void 0,this._endOpeningTime=void 0,this._numberOfItems=0))}itemAdded(e){var t,s;null===(s=null===(t=this._usageEvent)||void 0===t?void 0:t.itemAdded)||void 0===s||s.call(t,e)}pickerWillUnmount(){this._shouldMeasureOpeningTime=!0}closed(){this._scenario&&(this._scenario.finish(),this._scenario=void 0),this._usageEvent&&(i.track(this._usageEvent),this._firstRender=!1,this._usageEvent=void 0)}}const c="finished_first_item_load",h="finished_keyboard_seen";t.EmoticonPickerTelemetry=new class extends d{startOpenScenario(){this._shouldMeasureOpeningTime&&(this._markedFirstItemReady=!1,this._markedKeyboardSeen=!1,this._openScenario=new a.default(r.ScenarioName.EmoticonPesPickerOpen),this._openScenario.start())}markFirstVisibleItemReady(){var e;this._markedFirstItemReady||(null===(e=this._openScenario)||void 0===e||e.markStepCompleted(c),this._markedFirstItemReady=!0)}markKeyboardSeen(){var e;this._markedKeyboardSeen||(null===(e=this._openScenario)||void 0===e||e.markStepCompleted(h),this._markedKeyboardSeen=!0)}finishOpenScenario(e){if(!this._openScenario)return;const t=null==e?void 0:{totalCount:e};this._openScenario.finish(t),this._openScenario=void 0,this._markedFirstItemReady=!1,this._markedKeyboardSeen=!1}}(o.TabType.Emoticon),t.MojiPickerTelemetry=new d(o.TabType.Moji),t.StickerPickerTelemetry=new d(o.TabType.ChatSticker),t.GifPickerTelemetry=new d(o.TabType.Gif),t.PesPickerPopupTelemetry=new d(o.TabType.PickerPopup),t.PesPickerMeetNowTelemetry=new d(o.TabType.MeetNow),t.PesPickerImageUploaderTelemetry=new d(o.TabType.ImageUploader)},32687:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(20770),r=s(87134),a=s(32949),l=s(15877),d=s(54757),c=s(42545),h=s(81115),u=s(57946),p=s(80837),g=(0,l.lazyProperties)({messageComposerOuterContainerVertical:()=>o.Styles.createViewStyle({flex:-1,flexDirection:"row",justifyContent:"center"})});class m extends c.PesSearchPanel{constructor(){super(...arguments),this._noOfPesItemsSelected=0,this._onMessageSent=e=>{let t=!!this.props.onMessageSent&&this.props.onMessageSent(e);return this._closeSearchPanel(!0),this._pesSearchTelemetry.sendSuccessTelemetryEvent(void 0,this.state.rawSearchQuery.length,!0,this._noOfPesItemsSelected),t},this._handleScroll=(e,t)=>{this._messageComposer&&this._messageComposer.isFocused&&this._messageComposer.blur(),this._onScroll(e,t)},this._onEmoticonPesSelected=(e,t,s)=>{this._messageComposer&&this._messageComposer.autoReplaceText(e.text(),"Emoticon",e),this._noOfPesItemsSelected++,this._pesSearchTelemetry.sendSuccessTelemetryEvent(s,this.state.rawSearchQuery.length)},this._onMessageComposerRef=e=>{this._messageComposer=e||void 0},this._onEmoticonPickerRef=e=>{this._emoticonPicker=e||void 0},this._onClearQuotedMessage=()=>{this.isComponentMounted()&&this.setState({quotedMessages:void 0})},this._onClearEditedMessage=()=>{this.isComponentMounted()&&this.setState({editedMessage:void 0}),this.props.clearEditInChatsComposer&&this.props.clearEditInChatsComposer()}}_buildState(e,t){let s=super._buildState(e,t);const o=n.default.getSavedMessageInput(e.conversationId);return o&&(s.type=o.type,s.inputEntities=o.inputEntities,i.isEmpty(o.messages)||(s.quotedMessages=o.type===u.SavedMessageType.Quoted?o.messages:void 0,s.editedMessage=o.type===u.SavedMessageType.Edited?i.first(o.messages):void 0)),s}_renderPesResultsPane(){const e=o.createElement(a.default,{ref:this._onEmoticonPickerRef,renderMobileInterface:!0,darkTheme:this._useDarkTheme(),availableWidth:this.state.availableWidth,onPesSelected:this._onEmoticonPesSelected,filter:this.state.rawSearchQuery,doNotRenderTabIndicator:!0,searchMode:!0,onScroll:this._handleScroll,dontSetFocusOnTabHeader:!0,initialPaddingForSearchResults:this.state.keepSearchBoxCollapsed?void 0:this._initialPaddingForSearchResults,onSearchNoResultsFound:this._onNoResultsError}),t=[g.messageComposerOuterContainerVertical];this.state.safeAreaHorizontalPaddingStyle&&t.push(this.state.safeAreaHorizontalPaddingStyle),this.state.bottomSafeAreaInset&&!this.state.isKeyboardSeen&&t.push(h.default.marginBottomStyle(this.state.bottomSafeAreaInset));const s=o.createElement(o.View,{style:t},o.createElement(d.default,{ref:this._onMessageComposerRef,conversationId:this.props.conversationId,otherPartyMri:void 0,disableCopyPasteMedia:!0,hideMediaBar:!0,hideAudioMessage:!0,shouldAutoFocus:!1,onMessageSent:this._onMessageSent,initialInputEntities:this.state.inputEntities,quotedMessages:this.state.quotedMessages,onClearQuotedMessage:this._onClearQuotedMessage,editedMessage:this.state.editedMessage,onClearEdit:this._onClearEditedMessage})),i=this._divider();return o.createElement(o.View,{style:p.default.flexOne},e,i,s)}_getNumberOfItemsRendered(){return this._emoticonPicker?this._emoticonPicker.getNumberOfPesItemsRendered():-1}_getAccessibilityKeyForSearchResults(){return"PesSearch.SearchResultsAnnouncementEmoticons"}_divider(){return o.createElement(r.default,{marginLeft:0,marginRight:0,useLightTheme:!0})}}t.default=m},76359:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(51077),n=s(46096),r=s(1117),a=s(42545),l=(s(58962),s(85207));class d extends a.PesSearchPanel{constructor(){super(...arguments),this._onMojiPickerRef=e=>{this._mojiPicker=e||void 0},this._onMojiPreviewSeen=()=>{this._blurSearchInput()},this._sendMoji=(e,t,s)=>{this._closeSearchPanel(),l.default.postMessageFromInput(this.props.conversationId,n.PostSource.MojiSearch,[e],o.MessageTypes.Media_FlikMsg),this._pesSearchTelemetry.sendSuccessTelemetryEvent(s,this.state.rawSearchQuery.length,!0)}}_renderPesResultsPane(){return i.createElement(r.default,{ref:this._onMojiPickerRef,renderMobileInterface:!0,darkTheme:this._useDarkTheme(),onPesSelected:this._sendMoji,availableWidth:this.state.availableWidth,filter:this.state.rawSearchQuery,doNotRenderTabIndicator:this.state.rawSearchQuery.length>0,showMojiPreviewAsFullScreenModal:!0,onMojiPreviewSeen:this._onMojiPreviewSeen,searchMode:!0,onScroll:this._onScroll,initialPaddingForSearchResults:this.state.keepSearchBoxCollapsed?void 0:this._initialPaddingForSearchResults,dontSetFocusOnTabHeader:!0,onSearchNoResultsFound:this._onNoResultsError})}_getNumberOfItemsRendered(){return this._mojiPicker?this._mojiPicker.getNumberOfPesItemsRendered():-1}_getAccessibilityKeyForSearchResults(){return"PesSearch.SearchResultsAnnouncementMojis"}}t.default=d},42545:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PesSearchPanel=void 0;s(96486);const i=s(31844),o=s(16778),n=s(96074),r=s(52754),a=s(80128),l=s(98278),d=s(41444),c=s(46096),h=s(36237),u=s(10400),p=s(15877),g=s(33754),m=s(30124),S=s(41067),f=s(29130),y=s(51070),_=s(36150),v=s(86045),C=s(49603),b=s(12187),T=(s(40363),s(11828)),M=s(34528),I=s(80837),w=s(53374),P=(0,p.lazyProperties)({panel:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),searchHeaderWrapper:()=>o.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0})});class k extends n.default{constructor(){super(...arguments),this._currentScrollTop=0,this._headerExpanded=!0,this._onScroll=(e,t,s)=>{if(s||this._blurSearchInput(),this.state.keepSearchBoxCollapsed)return;let i=this._headerExpanded;if(e<a.default.collapsableHeight(this._getRootViewId()))i=!0;else{const t=this._currentScrollTop-e>0;i=i&&t}this._expandOrCollapseHeader(i,!0),this._currentScrollTop=e},this._onNoResultsError=()=>{this._pesSearchTelemetry.trackNoResultsInSearch()},this._cancelSearch=e=>{e&&e.stopPropagation(),this._closeSearchPanel(!1),this._pesSearchTelemetry.cancelSessionTelemetryEvent(this.state.rawSearchQuery.length)},this._onHeaderExpanded=e=>{if(this.isComponentMounted()){let t;t=e&&!this._useAccessibleTheme()?b.default.createBarStyle(C.BarStyleTheme.Light):b.default.createBarStyle(this._themeColors.defaultStatusBarTheme),this._updateStatusBarStyle(t)}},this._onInputTextChange=e=>{if(!this.isComponentMounted())return;let t={};t.rawSearchQuery=e,this.setState(t)},this._onSearchHeaderRef=e=>{this._searchHeader=e||void 0},this._onDesktopSearchHeaderRef=e=>{this._desktopSearchHeader=e||void 0}}_buildState(e,t){let s={};const o=this._getRootViewId();return s.availableWidth=f.default.getWidth(o),s.isSmallDevice=f.default.isSmallDevice(o),s.isUsingStackNavigationContext=m.default.isUsingStackNavigationContext(),s.statusBarPadding=y.default.statusBarPadding(),s.bottomSafeAreaInset=y.default.bottomSafeAreaInset(l.BottomInsetDefault),s.safeAreaHorizontalPaddingStyle=y.default.horizontalPaddingStyle(l.HorizontalInsetDefault),s.isKeyboardSeen=u.default.isKeyboardSeen(),s.keepSearchBoxCollapsed=f.default.getDeviceOrientation(o)===i.DeviceOrientation.Landscape||_.default.isMobileScreenReaderEnabled()&&!1||!s.isUsingStackNavigationContext,t&&(s.rawSearchQuery="",this._pesSearchTelemetry=new S.default(!0,e.searchType)),s}componentDidMount(){let e;super.componentDidMount(),e=this._useAccessibleTheme()?b.default.createBarStyle(this._themeColors.defaultStatusBarTheme):b.default.createBarStyle(C.BarStyleTheme.Light);const t=b.default.mergeStyles([e,b.default.createHiddenStyle(!1)]);this._updateStatusBarStyle(t)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this._updateAccessibilityNotification(),this.state.keepSearchBoxCollapsed!==t.keepSearchBoxCollapsed&&(this.state.keepSearchBoxCollapsed?this._expandOrCollapseHeader(!1,!1):this._onScroll(this._currentScrollTop,0,!0))}render(){let e=this._renderSearchHeader();const t=[I.default.flexOne];this._initialPaddingForSearchResults=a.default.collapsableHeight(this._getRootViewId());const s=this._renderPesResultsPane();let i;return this.state.keepSearchBoxCollapsed?(this._initialPaddingForSearchResults=void 0,i=o.createElement(o.View,{style:P.panel},e,s)):(t.push(o.Styles.createViewStyle({marginTop:a.default.collapsedHeight(this._getRootViewId())+this.state.statusBarPadding},!1)),i=o.createElement(o.View,{style:[P.panel,this._themeStyles.primaryBackgroundColorStyle]},o.createElement(o.View,{style:t},s),o.createElement(o.View,{style:P.searchHeaderWrapper,ignorePointerEvents:!0},e))),i}_closeSearchPanel(e){const t=w.default.newCauseId();h.log(c.LogTraceArea.Navigation,"PESSearchPanel._closeSearchPanel,  causeId: "+t),this.props.onCloseSearch&&this.props.onCloseSearch(e),u.default.immediatelyResetUpdateInfo(),this._goBack(t)}_focusSearchInput(){this._searchHeader?this._searchHeader.focusInput():this._desktopSearchHeader&&this._desktopSearchHeader.focusInput()}_blurSearchInput(){this._searchHeader?this._searchHeader.blurInput():this._desktopSearchHeader&&this._desktopSearchHeader.blurInput()}_renderSearchHeader(){return this.state.isUsingStackNavigationContext?o.createElement(r.default,{ref:this._onSearchHeaderRef,initialValue:this.state.keepSearchBoxCollapsed?0:1,closeIcon:M.closeIcon(),rawSearchQuery:this.state.rawSearchQuery,autoFocus:!0,cancelSearch:this._cancelSearch,onInputTextChange:this._onInputTextChange,onExpanded:this._onHeaderExpanded}):o.createElement(d.default,{ref:this._onDesktopSearchHeaderRef,rawSearchQuery:this.state.rawSearchQuery,onInputTextChange:this._onInputTextChange,hideCloseButton:!1,searchHeaderStyles:I.default.flexNegativeOne,showSearchIcon:!0,autoFocus:!0,cancelSearch:this._cancelSearch,closeButtonSize:T.IconSize.size20})}_expandOrCollapseHeader(e,t=!0){this._headerExpanded!==e&&(this._searchHeader&&this._searchHeader.setExpandedValue(e?1:0,t),this._headerExpanded=e)}_updateAccessibilityNotification(){if(v.default.shouldAnnounceForAccessibility()&&""!==this.state.rawSearchQuery){const e=this._getNumberOfItemsRendered();let t;e>=0&&e!==this._previousResultCount&&(t=g.getString(this._getAccessibilityKeyForSearchResults(),{count:e})),t&&o.Accessibility.announceForAccessibility(t),this._previousResultCount=e}}}t.PesSearchPanel=k},41067:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(36237),o=s(90025);t.default=class{constructor(e,t){this._navigatedFromMediaBar=e,this._searchType=t,this._startNewTelemetrySession()}_startNewTelemetrySession(){this._pesSearchTelemetryEvent=new o.PesSearchSession,this._pesSearchTelemetryEvent.setSearchType(this._searchType),this._pesSearchTelemetryEvent.setNavigatedFromMediaBar(this._navigatedFromMediaBar)}sendSuccessTelemetryEvent(e,t,s,o){this._pesSearchTelemetryEvent.complete(!0,t,e,s,o),i.track(this._pesSearchTelemetryEvent),s||this._startNewTelemetrySession()}trackNoResultsInSearch(){this._pesSearchTelemetryEvent.incrementAttemptsMade()}cancelSessionTelemetryEvent(e,t=!1){this._pesSearchTelemetryEvent.complete(!1,e,void 0,void 0,void 0,t),i.track(this._pesSearchTelemetryEvent)}}},36061:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(51077),n=s(46096),r=s(42545),a=(s(58962),s(85207)),l=s(63110);class d extends r.PesSearchPanel{constructor(){super(...arguments),this._onStickerPickerRef=e=>{this._stickerPicker=e||void 0},this._sendSticker=(e,t,s)=>{this._closeSearchPanel(),a.default.postMessageFromInput(this.props.conversationId,n.PostSource.StickerSearch,[e],o.MessageTypes.RichText),this._pesSearchTelemetry.sendSuccessTelemetryEvent(s,this.state.rawSearchQuery.length,!0)}}_renderPesResultsPane(){return i.createElement(l.default,{ref:this._onStickerPickerRef,renderMobileInterface:!0,darkTheme:this._useDarkTheme(),onPesSelected:this._sendSticker,availableWidth:this.state.availableWidth,filter:this.state.rawSearchQuery,doNotRenderTabIndicator:this.state.rawSearchQuery.length>0,searchMode:!0,onScroll:this._onScroll,initialPaddingForSearchResults:this.state.keepSearchBoxCollapsed?void 0:this._initialPaddingForSearchResults,dontSetFocusOnTabHeader:!0,onSearchNoResultsFound:this._onNoResultsError})}_getNumberOfItemsRendered(){return this._stickerPicker?this._stickerPicker.getNumberOfPesItemsRendered():-1}_getAccessibilityKeyForSearchResults(){return"PesSearch.SearchResultsAnnouncementStickers"}}t.default=d},75821:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(25465),n=s(16778),r=s(11930),a=(s(84994),s(98278),s(46096)),l=s(13944),d=s(36237),c=s(47126),h=s(15877),u=s(33754),p=s(40897),g=s(6250),m=s(4735),S=s(30124),f=s(63584),y=s(60621),_=s(58962),v=s(33242),C=(s(29130),s(81760)),b=s(11828),T=s(80837),M=s(60305),I=s(24576),w=s(12770),P=s(53374),k=b.IconSize.size20,A=(0,h.lazyProperties)({pesTabsContainerBase:()=>n.Styles.createViewStyle({alignSelf:"stretch",alignItems:"center",flexDirection:"row",borderTopWidth:1,borderStyle:"solid",paddingHorizontal:8}),pesTabsContainerBaseTransparent:()=>n.Styles.createViewStyle({alignSelf:"stretch",alignItems:"center",flexDirection:"row",paddingHorizontal:8}),pesTabsContainerTransparent:()=>n.Styles.createViewStyle({justifyContent:"flex-end",backgroundColor:C.Color.blackOverlay70}),swipeableViewRTL:()=>n.Styles.createScrollViewStyle({flexDirection:"row-reverse"}),flippedView:()=>n.Styles.createScrollViewStyle({transform:[{scaleX:-1}]}),iconSpacerTouch:()=>n.Styles.createViewStyle({width:40,height:40}),searchButton:()=>n.Styles.createViewStyle({paddingRight:8,borderRightWidth:1,alignSelf:"stretch"}),deleteButton:()=>n.Styles.createViewStyle({paddingLeft:8,borderLeftWidth:1,alignSelf:"stretch"}),pesTabsContainerDesktop:()=>n.Styles.createViewStyle({flexDirection:"row"}),borderColorLight:()=>n.Styles.createViewStyle({borderColor:C.Color.gray50}),backgroundColorDark:()=>n.Styles.createViewStyle({backgroundColor:C.Color.transparent}),backgroundColorLight:()=>n.Styles.createViewStyle({backgroundColor:C.Color.white})});class E extends I.default{constructor(){super(...arguments),this._isDeleteButtonPressTimedOut=!1,this._mountedRefsMap=new g.default,this._buttonFocusCallbacks={},this._tabSelected=e=>{let t=i.findIndex(this.props.tabs,(t=>t.id===e));this.props.reversed&&!i.isEmpty(this.props.tabs)&&(t=this.props.tabs.length-t-1),this.setState({selectedTabIndex:t}),this.props.onTabSelected(this.props.tabs[t])},this._setScrollViewRef=e=>{this._scrollView=e||void 0},this._onLayout=e=>{const t=e.width+(this._showDeleteButton()?k:0);this.setState({availableWidthForIndicator:t,iconSpacing:this._computeIconSpacing(t)},(()=>this._scrollToTabIcon(this.state.selectedTabIndex,!1)))},this._onScroll=(e,t)=>{this.setState({scrollPosition:t})},this._handleSearchButtonClick=e=>{e.stopPropagation();const t=P.default.newCauseId();if(d.log(a.LogTraceArea.Pes,"PesTabIndicaor._handleSearchButtonClick,  causeId: "+t),!this.props.conversationId)return;const s=this._getSelectedTabType();i.isUndefined(s)||(s===_.TabType.Moji&&(y.MojiPreviewService.closePesPreview(),f.MojiPickerTelemetry.closed()),s===_.TabType.Gif&&(y.GifPreviewService.closePesPreview(),f.GifPickerTelemetry.closed()),(0,p.isSupportedTabType)(s)&&p.default.tryActivateInlineSearch(s)?o.default.showNativeKeyboard():m.default.navigateToPesSearch({searchType:s,conversationId:this.props.conversationId,onMessageSent:this.props.onMessageSent,onCloseSearch:this.props.onCloseSearch,clearEditInChatsComposer:this.props.clearEditInChatsComposer,causeId:t},this._getContext()))},this._deleteButtonPressIn=e=>{e.stopPropagation(),!this._isDeleteButtonPressTimedOut&&this.props.onPesDeleteButtonPress&&this.props.onPesDeleteButtonPress(!1),this._deleteButtonPressedInterval=w.default.setInterval((()=>{!this._isDeleteButtonPressTimedOut&&this.props.onPesDeleteButtonPress&&this.props.onPesDeleteButtonPress(!1)}),100),this._deleteButtonPressedTimeout=w.default.setTimeout((()=>{w.default.clearInterval(this._deleteButtonPressedInterval),this._isDeleteButtonPressTimedOut=!0,this._deleteButtonPressedInterval=w.default.setInterval((()=>{this.props.onPesDeleteButtonPress&&this.props.onPesDeleteButtonPress(!0)}),150)}),1e3)},this._deleteButtonPressOut=e=>{e.stopPropagation(),w.default.clearInterval(this._deleteButtonPressedInterval),w.default.clearTimeout(this._deleteButtonPressedTimeout),this._isDeleteButtonPressTimedOut=!1},this._onKeyPress=e=>{let t=0;if(e.keyCode===c.default.RIGHT?t=1:e.keyCode===c.default.LEFT&&(t=-1),0!==t){const s=this.props.tabs.length;this._focusButton((this.state.focusedButtonIndex+t+s)%s),e.preventDefault(),e.stopPropagation()}},this._onContainerBlur=()=>{this.setState({focusedButtonIndex:-1})}}_buildState(e,t){const s={useTabletUI:M.default.useTabletUI()};this._getRootViewId();if(t){let t=0;e.initialTab&&(t=i.findIndex(e.tabs,(t=>t.id===e.initialTab.id)),t=Math.max(t,0)),s.selectedTabIndex=t,s.isUsingStackNavigationContext=S.default.isUsingStackNavigationContext(),s.focusedButtonIndex=-1,s.scrollPosition=0,s.iconSpacing=6,s.scrollPosition=0}return s}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s)}render(){return this._renderScrollableView()}onPageSelected(e){e.position!==this.state.selectedTabIndex&&(this._scrollToTabIcon(e.position),this.setState({selectedTabIndex:e.position}))}_renderTabIcons(){const e=this.props.reversed,t=this.props.tabs,s=t?t.length:0;return i.map(t,((t,i)=>{const o=e?s-i-1:i,a=this.state.selectedTabIndex===o,l=this.state.focusedButtonIndex===i||-1===this.state.focusedButtonIndex&&a;let d;return t.title&&(d=r.default.tabAccessibilityLabel(t.title,i,s)),n.createElement(v.default,{ref:this._mountedRefsMap.onComponentRef(i.toString()),onFocus:this._getButtonFocusCallback(i),tabIndex:l?0:-1,thumbnailUrlOrAssetID:t.iconUrlOrAssetID,key:"pack-"+t.id,accessibilityTraits:r.default.tabAccessibilityTraits(a),style:e?A.flippedView:void 0,isSelected:a,buttonSize:20,title:t.title,accessibilityLabel:d,buttonId:t.id,onClick:this._tabSelected,paddingVertical:12,paddingHorizontal:this.state.iconSpacing})}))}_renderScrollableView(){const e=this._renderDeleteButton(),t=this._renderSearchButton(),s=this._renderScrollableIndicator();if(!e&&!s)return null;const i=this._getScrollableViewContainerStyles();return n.createElement(n.View,{style:i,onBlur:this._onContainerBlur,onKeyPress:this._onKeyPress},t,s,e)}_getScrollableViewContainerStyles(){let e;return e=this.props.transparentTheme?[A.pesTabsContainerBaseTransparent,A.pesTabsContainerTransparent]:this.props.darkTheme?[A.pesTabsContainerBase,A.backgroundColorDark,this._themeStyles.headerShadowBorderColorStyle]:[A.pesTabsContainerBase,A.backgroundColorLight,A.borderColorLight],this.props.style&&e.push(this.props.style),e}_renderScrollableIndicator(){let e=[T.default.flexOne];e.push(A.pesTabsContainerDesktop),this.props.reversed&&e.push([A.swipeableViewRTL,A.flippedView]);let t=this._renderTabIcons();return t=n.createElement(n.View,{accessibilityTraits:[n.Types.AccessibilityTrait.TabList],style:[A.pesTabsContainerDesktop,T.default.overflowVisible],forceDirection:!0},t),n.createElement(n.ScrollView,{style:e,onLayout:this._onLayout,ref:this._setScrollViewRef,vertical:!1,horizontal:!0,keyboardDismissMode:"none",keyboardShouldPersistTaps:!0,onScroll:this._onScroll,showsHorizontalScrollIndicator:!0},t)}_showDeleteButton(){return!1}_renderDeleteButton(){if(!this._showDeleteButton())return;const e=[A.deleteButton,this._themeStyles.dividerBorderColorStyle];return n.createElement(l.default,{key:"delete-emoticon",color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,size:k,onPressIn:this._deleteButtonPressIn,onPressOut:this._deleteButtonPressOut,icon:b.SkypeIcon.Backspace,title:u.getString("Global.DeleteLabel"),flipIcon:this.props.reversed&&!0,style:e})}_renderSearchButton(){}_scrollToTabIcon(e,t=!0){0}_computeIconSpacing(e){return 6}_getSelectedTabType(){const e=this.props.tabs[this.state.selectedTabIndex];return e&&e.tabType}_focusButton(e){const t=this._mountedRefsMap.ref(e.toString());t&&t.requestFocus()}_getButtonFocusCallback(e){return this._buttonFocusCallbacks[e]||(this._buttonFocusCallbacks[e]=t=>{this.setState({focusedButtonIndex:e})}),this._buttonFocusCallbacks[e]}}t.default=E},33242:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(88837),r=s(89391),a=s(39597),l=s(61253),d=s(33754),c=s(81760);var h;!function(e){e[e.notSelected=0]="notSelected",e[e.hover=1]="hover",e[e.selected=2]="selected"}(h||(h={}));class u extends n.ComponentBase{constructor(){super(...arguments),this._isImageCachingStoreAllowed=r.default.getS4LMessagingFeaturesNoSubscription().enableImageCachingStoreForStatic,this._onButtonClick=e=>{e.stopPropagation(),(0,l.default)(this.props.isSelected,void 0)&&this.setState({currentFrame:h.selected}),this.props.onClick&&this.props.onClick(this.props.buttonId)},this._onHoverStart=()=>{this.isComponentMounted()&&(this.state.currentFrame===h.notSelected?this.setState({isHovering:!0,currentFrame:h.hover}):this.setState({isHovering:!0}))},this._onHoverEnd=()=>{this.isComponentMounted()&&(this.state.currentFrame===h.hover?this.setState({isHovering:!1,currentFrame:h.notSelected}):this.setState({isHovering:!1}))},this._onButtonRef=e=>{this._buttonRef=e||void 0}}_buildState(e,t){let s={};return this._isImageCachingStoreAllowed&&(i.isNumber(e.thumbnailUrlOrAssetID)?s.urlOrAssetIDToRender=e.thumbnailUrlOrAssetID:s.urlOrAssetIDToRender=a.default.requestImage(e.thumbnailUrlOrAssetID)),s.currentFrame=e.isSelected?h.selected:h.notSelected,t?s.isHovering=!1:this.state.isHovering&&(s.currentFrame=h.hover),s}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t),i.isUndefined(e.isSelected)||this.setState({currentFrame:e.isSelected?h.selected:h.notSelected})}requestFocus(){this._buttonRef&&this._buttonRef.requestFocus()}render(){const e=this.state.currentFrame*this.props.buttonSize,t=o.Styles.createButtonStyle({height:this.props.buttonSize+2*(this.props.paddingVertical||0),width:this.props.buttonSize+2*(this.props.paddingHorizontal||0),justifyContent:"center",alignItems:"center"},!1),s=o.Styles.createViewStyle({height:this.props.buttonSize,width:this.props.buttonSize,backgroundColor:c.Color.transparent},!1),i=o.Styles.createImageStyle({height:this.props.buttonSize*u._frameCount,width:this.props.buttonSize,transform:[{translateY:-e}]},!1);let n;return n=this._isImageCachingStoreAllowed?void 0!==this.state.urlOrAssetIDToRender?o.createElement(o.Image,{style:i,source:this.state.urlOrAssetIDToRender,resizeMode:"contain"}):null:o.createElement(o.Image,{style:i,source:this.props.thumbnailUrlOrAssetID,resizeMode:"contain"}),o.createElement(o.Button,{onPress:this._onButtonClick,onHoverStart:this._onHoverStart,onHoverEnd:this._onHoverEnd,style:[t,this.props.style],title:this.props.title,accessibilityLabel:this._getAccessibilityLabel(),accessibilityTraits:this.props.accessibilityTraits,ref:this._onButtonRef,onFocus:this.props.onFocus,tabIndex:this.props.tabIndex},o.createElement(o.View,{style:s},n))}_getAccessibilityLabel(){return this.props.accessibilityLabel?this.props.accessibilityLabel:this.props.title?this.state.currentFrame===h.selected?d.getString("AccessibilityLabel.SelectedTriStateButton",{title:this.props.title}):d.getString("AccessibilityLabel.NotSelectedTriStateButton",{title:this.props.title}):void 0}}t.default=u,u._frameCount=3},2544:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StickerItem=void 0;const i=s(96486),o=s(16778),n=s(89391),r=s(46096),a=s(74313),l=s(10117),d=s(36237),c=s(33754),h=s(95549),u=s(58962),p=s(24139),g=s(81760),m=s(11828),S=s(75865);class f extends h.PesPickerItem{constructor(){super(...arguments),this._isStickerImageLoaded=!1,this._handleStickerImageLoad=()=>{this._isStickerImageLoaded=!0},this._handleStickerImageLoadError=()=>{d.error(r.LogTraceArea.Capture,"There was an error loading the sticker",this.props.id),this._isStickerImageLoaded=!1}}_buildState(e,t){const s=n.default.getConfigSettings().pes.rewriteRules,i=e.info.baseUrl?u.rewriteUrl(e.info.baseUrl,s):void 0,o=i?i+"/views/meta."+c.getLanguageFromLocale():void 0;let r=i?`${i}/views/thumblarge?etag=${e.info.etag?e.info.etag:"v1"}`:void 0;return{thumbnailUrl:r?S.default.getAuthenticatedUrl(r):void 0,localizedMetadata:o?p.default.getMetadataForSticker(o,e.info.id):void 0}}_getStyle(e){let t=f._cachedStyles[e];return t||(t={thumbnailContainer:o.Styles.createViewStyle({width:e,height:e,alignItems:"center",justifyContent:"center"},!1),thumbnailImage:o.Styles.createImageStyle({position:"absolute",top:0,left:0,width:e-1,height:e},!1),stickerPlaceholder:o.Styles.createViewStyle({width:e,height:e,backgroundColor:g.Color.transparent,justifyContent:"center",alignItems:"center"},!1)},f._cachedStyles[e]=t),t}_renderItem(e){const t=this._getStyle(this.props.dimension);let s;this.props.showPlaceholder&&(s=o.createElement(o.View,{style:[t.thumbnailContainer,t.stickerPlaceholder]},o.createElement(l.default,{icon:m.SkypeIcon.Sticker,color:g.Color.transparent,size:m.IconSize.size14})));const i=o.createElement(o.View,{style:[t.thumbnailContainer,t.stickerPlaceholder]},o.createElement(l.default,{icon:m.SkypeIcon.StickerDeleted,color:g.Color.transparent,size:m.IconSize.size14}));return[o.createElement(a.default,{origin:"StickerThumbnail",key:"thumbnail",title:this.state.localizedMetadata?this.state.localizedMetadata.description:void 0,style:t.thumbnailImage,containerStyle:t.thumbnailContainer,altView:s,errorView:i,resizeMode:"cover",source:this.state.thumbnailUrl,onLoad:this._handleStickerImageLoad,onError:this._handleStickerImageLoadError})]}_onPressPesItem(){this._isStickerImageLoaded&&this.props.onSelected(this.props.info)}_getAccessibilityLabel(e){let t=this.state.localizedMetadata?this.state.localizedMetadata.name:void 0;return t&&this.props.numberInGroupAccessibilityLabel&&!i.isUndefined(this.props.itemIndex)&&!i.isUndefined(this.props.totalInGroup)&&(t+=", ",t+=c.getString("MediaPickerPanel.SelectedTitle",{count:this.props.itemIndex+1,total:this.props.totalInGroup})),t}_getImportantForAccessibility(){return o.Types.ImportantForAccessibility.Yes}}t.StickerItem=f,f._cachedStyles={}},63110:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(46096),r=s(97174),a=s(36237),l=s(33754),d=s(96168),c=s(31903),h=s(63584),u=s(83294),p=s(58962),g=s(31234),m=s(31847),S=s(2544),f=s(13130),y=s(11828);class _ extends c.PesPicker{constructor(){super(...arguments),this._renderPesItem=e=>{const t=this.state.items[e];if(!t)return a.warn(n.LogTraceArea.Pes,`Sticker with id ${e} not found`),null;const s=this.state.itemsForTabsMap[this._currentTabIndex],i=s&&s[0]===e,r=this._getItemDimension(),l=!!this.state.previewItem&&this.state.previewItem.id===t.id,d=-1===this.state.focusedButtonIndexInPack&&l;return r?o.createElement(S.StickerItem,{autoFocus:this._shouldAutoFocusFirstItem()&&i,tabIndex:d?0:-1,ref:this._itemsInCurrentTabRefs.onComponentRef(e),onFocus:this._getButtonFocusCallback(e),key:t.id,id:t.id,info:t,isSelected:l,renderMobileInterface:this.props.renderMobileInterface,onHover:this._onPesHoverBound,onSelected:this._onSelected,dimension:r,showPlaceholder:!0,onItemDidMount:this._onStickerItemDidMount,onItemWillMount:this._onStickerItemWillMount}):null},this._onSelected=e=>{const t=new r.StickerEntity(e.id,e.baseUrl,e.baseUrl,e.name);this.props.onPesSelected(t,p.mediaTypes.sticker,e.id),this._trackClickedSticker(e),!this.props.renderMobileInterface&&this.state.isSearching&&this._desktopSearchTelemetry&&(this._desktopSearchTelemetry.sendSuccessTelemetryEvent(e.id,this.state.searchQuery.length),this._searchSuccessTelemetry=!0)},this._trackClickedSticker=e=>{h.StickerPickerTelemetry.itemAdded(void 0),this._trackClickedItem(e.id,void 0,void 0,this.props.triggeredBy)},this._onStickerItemWillMount=()=>{h.StickerPickerTelemetry.willMountItem()},this._onStickerItemDidMount=()=>{h.StickerPickerTelemetry.mountedItem()}}componentWillUnmount(){super.componentWillUnmount(),h.StickerPickerTelemetry.pickerWillUnmount()}_willChangeCategory(e){super._willChangeCategory(e),e!==this._getPesTabType()&&h.StickerPickerTelemetry.closed()}_getInitialPagedTabIndex(){return 1}_getEmptyRecentMessage(){return l.getString("PesPicker.EmptyRecentStickers")}_getPesTabType(){return p.TabType.ChatSticker}_getTabs(e,t){const s=d.default.getChatStickerTabs();let o;if(e){o=u.searchInPackDescriptionAndItemMetadata(s,e),o=i.filter(o,(e=>e.packs&&e.packs.length>0));const t=this._mergePacksInSingleTab(o);t&&(o=[t])}else if(""!==e){const e=g.default.getRecentStickerInChatTabInfo();(!t||t&&!i.isEmpty(e.packs))&&s.unshift(e)}const n=o||s;return this._getContext().isRTL&&i.reverse(n),n}_getPesItem(e){return f.default.getSticker(e)}_getPesPreview(){if(this.state.previewItem)return o.createElement(m.default,{key:this.state.previewItem.id,src:this.state.previewItem.baseUrl,etag:this.state.previewItem.etag,showPlaceholder:!0,dimension:p.frameHeights.stickers.Size112,name:this.state.previewItem.name})}_getPesInfo(e){return[e.name?e.name.trim():void 0,e.copyright?e.copyright.trim():void 0]}_getPackAccessibilityLabel(e){return l.getString("PesPicker.StickerPackHeaderAccessibilityLabel",{title:e.title,count:e.items.length})}_getSearchNoResultsMessage(){return l.getString("PesSearch.StickerPickerNoResultsSearchText")}_getErrorMessage(){return l.getString("MediaBar.StickerPickerErrorText")}_getErrorSymbol(){return y.SkypeIcon.StickerDeleted}_getSearchLabel(){return l.getString("PesPicker.SearchStickers")}_getStaticItemDimension(){return(this._getItemDimension()||this._getDefaultItemDimension())+this._doubleBorderItem}_getDefaultItemDimension(){return p.frameHeights.stickers.Size90}_getMinItems(e){return 3}}t.default=_},56129:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(11009),n=s(77381),r=s(45381),a=s(11828);class l extends n.default{constructor(){super(...arguments),this._toolTipAnimationConfig={duration:250,easing:i.Animated.Easing.OutBack()},this._toolTipConfig=()=>({getElement:this.props.anchor,positions:[o.PopupAnchorPositon.Bottom],durationMs:3500,title:this.props.title,optionalIcon:a.SkypeIcon.Lightbulb,anchorAccessibilityLabel:this.props.accessibilityLabel,instanceId:this.state.instanceId,rootViewId:this._getRootViewId()}),this._onTooltipClick=e=>{this.props.onPress&&this.props.onPress(e)}}_buildState(e,t){return{instanceId:e.instanceId||"unknown"}}render(){return i.createElement(r.default,{toolTipInfo:this._toolTipConfig(),animateDismissal:!1,animationConfig:this._toolTipAnimationConfig,textMarginHorizontal:10,textMarginVertical:10,containerOffsetX:this.props.offsetX,containerOffsetY:this.props.offsetY,onPress:this._onTooltipClick})}}t.default=l},24722:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(71830),r=s(47204),a=s(77381),l=s(39549),d=s(37490),c=s(52262),h=s(41706),u=s(67121),p=s(25793),g=s(15877),m=s(33754),S=s(30124),f=s(29130),y=s(10265),_=s(81760),v=s(11010),C=s(19675),b=(0,g.lazyProperties)({contentContainer:()=>o.Styles.createViewStyle({flexDirection:"column",flex:1}),safeCodeSummaryText:()=>o.Styles.createTextStyle({paddingVertical:16,color:_.Color.white}),safeCodeText:()=>o.Styles.createTextStyle({paddingRight:15,paddingBottom:10,color:_.Color.white,fontFamily:v.default.fontFamily.monospace}),safeCodeTextContainer:()=>o.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap",maxWidth:280})}),T="SafeCodeDialog";class M extends a.default{_buildState(e,t){const s=this._getRootViewId();return{isUsingStackNavigationContext:S.default.isUsingStackNavigationContext(),width:f.default.getWidth(s),recipientShortName:c.default.getShortDisplayName(e.mri),isEncryptedThreadEstablished:h.default.getHandshakeState(e.conversationId)===p.SecureHandshakeState.Completed}}static hideSafeCode(e){r.default.isModalDisplayed(T,e)&&r.default.dismissModal(T,e)}static showForConversationId(e,t){const s=(0,l.default)().getConversation(e);if(s){const i=s.getOtherPartyMri();i&&u.default.getFingerprint(n.asSkypeThreadId(e)).then((s=>{d.dismissAll();const n=o.createElement(M,{conversationId:e,mri:i,fingerprint:s});r.default.showModal(n,T,{rootViewId:t})}))}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),t.isEncryptedThreadEstablished&&!this.state.isEncryptedThreadEstablished&&M.hideSafeCode(this._getRootViewId())}render(){const e=[{text:m.getString("Global.CloseButtonTitle"),isCancel:!0}],t=[b.contentContainer];const s=m.getString("InfoPanel.SafeCodeDialogHeading",{recipientName:this.state.recipientShortName}),i=m.getString("InfoPanel.SafeCodeDialogTitle");return o.createElement(y.default,{dialogId:T,text:i,buttons:e,closeOnClickOutside:!0,accessibilityLabel:i},o.createElement(o.View,{style:t},o.createElement(C.BodyText,{style:b.safeCodeSummaryText},m.getString("InfoPanel.SafeCodeDialogBody")),o.createElement(C.BodyText,{bold:!0,style:b.safeCodeSummaryText},s),o.createElement(o.View,{style:b.safeCodeTextContainer},this._formatFingerprint())))}_formatFingerprint(){const e=i.map(i.chunk(this.props.fingerprint,5),(e=>i.join(e,"")));return i.map(e,(e=>o.createElement(o.Text,{style:[v.default.fontStyle.secondaryButton,b.safeCodeText],key:e},e)))}}t.default=M},17993:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(98278),n=s(41706),r=s(25793),a=s(33754),l=s(30124),d=s(69413),c=s(11828),h=s(24576),u=s(77524);class p extends h.default{constructor(){super(...arguments),this._showSafeCode=e=>{e.stopPropagation(),(0,d.showPrivateConversationSafeCode)(this.props.conversationId,this._getRootViewId())}}_buildState(e,t){return{isUsingStackNavigationContext:l.default.isUsingStackNavigationContext(),isEncryptedThreadEstablished:n.default.getHandshakeState(e.conversationId)===r.SecureHandshakeState.Completed}}render(){return i.createElement(u.WideButton,{icon:c.SkypeIcon.PrivateSessionKey,label:a.getString("InfoPanel.SafeCodeLabel"),onPressed:this._showSafeCode,hideArrow:!0,disabled:!this.state.isEncryptedThreadEstablished,buttonStyles:this.state.isUsingStackNavigationContext?void 0:o.ListItem.small.shortHeightStyle})}}t.default=p},18369:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ImagePreview=t.UrlPreview=t.PreviewInfo=t.FilePreview=void 0;const i=s(16778),o=s(98278),n=s(74313),r=s(85609),a=s(10117),l=s(15877),d=s(15415),c=s(81760),h=s(11010),u=s(11828),p=s(80837),g=s(19675),m=s(24576),S=(0,l.lazyProperties)({previewIconContainer:()=>i.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:c.Color.blue,justifyContent:"center",alignItems:"center"}),previewIconContainerUrl:()=>i.Styles.createViewStyle({justifyContent:"center",alignItems:"center"}),previewInfoContainer:()=>i.Styles.createViewStyle({flexDirection:"column",justifyContent:"center"}),previewInfo2Container:()=>i.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-start",alignItems:"center"}),previewInfo2ContainerForContact:()=>i.Styles.createViewStyle({justifyContent:"center",paddingRight:5}),previewTextSmall1:()=>i.Styles.createTextStyle({backgroundColor:c.Color.transparent,textAlign:"left"}),previewTextSmall2:()=>i.Styles.createTextStyle({backgroundColor:c.Color.transparent,textAlign:"left",textAlignVertical:"center",marginTop:2}),previewTextLarge1:()=>i.Styles.createTextStyle({textAlign:"center",color:c.Color.black,fontSize:h.default.fontSize.size20}),previewTextLarge2:()=>i.Styles.createTextStyle({color:c.Color.black,fontSize:h.default.fontSize.size18}),spinnerContainer:()=>i.Styles.createTextInputStyle({alignSelf:"stretch",marginRight:10,justifyContent:"center",alignItems:"center"}),imageContainerPreview:()=>i.Styles.createImageStyle({flex:1,alignSelf:"stretch"}),fileIcon:()=>i.Styles.createViewStyle({margin:8}),fileIconCaption:()=>i.Styles.createTextStyle({paddingHorizontal:4,maxWidth:110}),iconPadding:()=>i.Styles.createViewStyle({paddingRight:4})});class f extends m.default{render(){let e,t,s,o,n=c.Color.white;this.props.borderRadius&&(s=i.Styles.createViewStyle({borderRadius:this.props.borderRadius},!1));let l=[S.previewIconContainer,s];if(this.props.fileName){n=this._themeColors.primaryIconColor,l.push(this._themeStyles.primaryBackgroundColorStyle),o=S.fileIcon;const s=r.FileIconHelper.getIconFromFileType(this.props.fileName,this.props.fileType);e=s.icon,t=i.createElement(g.BodyText,{bold:!0,ellipsizeMode:"tail",numberOfLines:1,style:S.fileIconCaption},s.displayString)}return(!e||this.props.isShareWithContact&&e===u.SkypeIcon.File)&&(e=u.SkypeIcon.FileMultiple),i.createElement(i.View,{style:l},i.createElement(a.default,{icon:e,size:u.IconSize.size32,color:n,style:o}),t)}}t.FilePreview=f;class y extends m.default{render(){const e=[S.previewTextSmall1,this.props.isShareWithContact?S.previewTextLarge1:void 0,this.props.lineStyles],t=[S.previewTextSmall2,this.props.lineStyles,this.props.isShareWithContact?S.previewTextLarge2:void 0,this.props.lineStyles];let s,o;if(this.props.firstLine){const t=this.props.iconToShowFirstLine?i.createElement(a.default,{icon:this.props.iconToShowFirstLine,size:u.IconSize.size16,color:this._themeColors.primaryTextColor,style:S.iconPadding}):void 0,o=i.createElement(g.BodyText,{style:e,numberOfLines:1,ellipsizeMode:"tail",bold:!0,size:g.BodyTextSize.SmallDeprecated},this.props.firstLine);s=t?i.createElement(i.View,{style:S.previewInfo2Container},t,o):o}if(this.props.secondLine){const e=this.props.iconToShowSecondLine?i.createElement(a.default,{icon:this.props.iconToShowSecondLine,size:u.IconSize.size12,color:this._themeColors.secondaryTextColor,style:S.iconPadding}):void 0;o=i.createElement(i.View,{style:[S.previewInfo2Container,this.props.isShareWithContact?S.previewInfo2ContainerForContact:void 0]},e,i.createElement(g.Caption,{style:t,ellipsizeMode:"tail",numberOfLines:1},this.props.secondLine))}return i.createElement(i.View,{style:S.previewInfoContainer},s,o)}}t.PreviewInfo=y;class _ extends m.default{render(){let e;this.props.borderRadius&&(e=i.Styles.createViewStyle({borderRadius:this.props.borderRadius},!1));let t,s=[];return this.props.urlThumbnail?(t=i.createElement(v,{imagePreviewHeight:this.props.imagePreviewHeight,imagePreviewWidth:this.props.imagePreviewWidth,borderRadius:this.props.borderRadius,urlThumbnail:this.props.urlThumbnail}),s=[p.default.shadowStyle,p.default.absoluteFill,e]):(t=i.createElement(a.default,{icon:u.SkypeIcon.Link,size:u.IconSize.size40,color:this._themeColors.primaryIconColor}),s.push(S.previewIconContainerUrl)),i.createElement(i.View,{style:s},t)}}t.UrlPreview=_;class v extends m.default{render(){const e=i.Styles.createTextInputStyle({height:this.props.imagePreviewHeight,width:this.props.imagePreviewWidth},!1);let t;this.props.borderRadius&&(t=i.Styles.createViewStyle({borderRadius:this.props.borderRadius},!1));const s=i.createElement(i.View,{style:[S.spinnerContainer,e]},i.createElement(d.default,{size:o.SXActivityIndicatorSize.Small,tintColor:this._themeColors.primaryIconColor})),r=i.createElement(f,{borderRadius:this.props.borderRadius}),a=i.Styles.createImageStyle({overlayColor:this._themeColors.primaryBackgroundColor},!1);return i.createElement(n.default,{containerStyle:[S.imageContainerPreview,t],style:[S.imageContainerPreview,t,a],origin:"ShareWithContactPanel",source:this.props.urlThumbnail,resizeMode:"cover",altView:s,errorView:r})}}t.ImagePreview=v},79735:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(98278),n=s(9628),r=s(15877),a=s(33754),l=s(89808),d=s(86045),c=s(15415),h=s(22222),u=s(11828),p=s(80837),g=s(24576),m=(0,r.lazyProperties)({containerWidth:()=>i.Styles.createViewStyle({minWidth:77,marginRight:2}),spinnerContainer:()=>p.default.alignItemsCenter,containerSmall:()=>i.Styles.createViewStyle({height:30})});class S extends g.default{constructor(){super(...arguments),this._renderSendButton=()=>{const e=a.getString("ShareWithPanel.SendButton");return i.createElement(h.default,{title:e,accessibilityLabel:this.state.accessibilityLabel,buttonStyle:o.SXButtonStyle.ColorFill,buttonSize:o.SXButtonSize.Small,onPress:this._onSendPress,tabIndex:-1,importantForAccessibility:void 0})},this._onSendPress=e=>{e.stopPropagation(),this.props.onSendMessageButtonPress(this.props.userMri)},this._renderSendingIndicator=()=>i.createElement(c.default,{size:o.SXActivityIndicatorSize.Small,tintColor:this.state.color}),this._renderSentIndicator=()=>{const e=a.getString("ShareWithPanel.SentLabel");return i.createElement(h.default,{title:e,accessibilityLabel:this.state.accessibilityLabel,buttonStyle:o.SXButtonStyle.ColorStroke,buttonSize:o.SXButtonSize.Small,onPress:this._onSendPress,disabled:!0,icon:u.SkypeIcon.Ok,disabledOpacityOverride:!0,tabIndex:-1,importantForAccessibility:void 0})}}_buildState(e,t){const s=n.default.getStateForMri(e.userMri);return{sendingState:s,color:this._useAccessibleTheme()?this._themeColors.primaryTextColor:l.default.getPrimaryColor(),accessibilityLabel:this._getAccessibilityLabelForMRI(e.rowTitle,s)}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),t.sendingState!==n.ForwardMessageState.Sent&&this.state.sendingState===n.ForwardMessageState.Sent&&d.default.maybeAnnounceForAccessibility(a.getString("MessageComposer.MessageSentLabel"))}render(){let e,t=[m.containerWidth];return this.state.sendingState===n.ForwardMessageState.Sending?(t.push(m.spinnerContainer),e=this._renderSendingIndicator()):this.state.sendingState===n.ForwardMessageState.Sent?(t.push(m.containerSmall),e=this._renderSentIndicator()):(t.push(m.containerSmall),e=this._renderSendButton()),i.createElement(i.View,{style:t},e)}_getAccessibilityLabelForMRI(e,t){let s="ShareWithPanel.SendToAccessibilityLabel";return t===n.ForwardMessageState.Sent&&(s="ShareWithPanel.SentToAccessibilityLabel"),a.getString(s,{displayName:e})}}t.default=S},90574:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(15069),n=s(31844),r=s(58108),a=s(16778),l=s(74634),d=s(97691),c=s(89391),h=s(67930),u=s(51077),p=s(3056),g=s(18369),m=s(46992),S=s(82261),f=s(16402),y=s(70891),_=s(46096),v=s(52115),C=s(53559),b=s(9628),T=s(97174),M=s(23944),I=s(36237),w=s(10400),P=s(15877),k=s(33754),A=s(81157),E=s(23752),R=s(4735),L=s(30124),F=s(95691),x=s(85207),O=s(28433),D=s(29130),B=s(51070),V=s(15963),N=s(94622),U=s(10541),H=s(32514),z=s(50571),W=s(94165),j=s(24067),G=s(90631),K=s(16392),q=s(12187),Q=s(4057),X=s(32293),$=s(81760),J=s(11010),Y=s(11828),Z=s(80837),ee=s(19675),te=s(9426),se=s(10609),ie=s(26712),oe=s(2301),ne=s(67977),re=s(53374),ae=o.default.isMobile()?140:205,le=o.default.isMobile()?20:0,de=o.default.isMobile()?110:185,ce=o.default.isMobile()?110:185,he=10,ue=(0,P.lazyProperties)({container:()=>a.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),previewContainer:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"stretch",padding:10}),mediaPreviewContainer:()=>a.Styles.createViewStyle({height:de,width:ce,alignSelf:"stretch",marginRight:10,justifyContent:"center",alignItems:"center",borderRadius:he}),mediaPreviewForwardContainerDesktop:()=>a.Styles.createViewStyle({height:110,width:110}),frontImageContainerPreview:()=>a.Styles.createViewStyle({position:"absolute",top:7,left:0,right:0,bottom:0,borderRadius:he}),backImageContainerPreview:()=>a.Styles.createViewStyle({position:"absolute",top:2,left:7,right:7,bottom:7,borderRadius:he}),imagesCount:()=>a.Styles.createTextStyle({position:"absolute",bottom:0,left:0,right:0,lineHeight:24,borderBottomLeftRadius:he,borderBottomRightRadius:he,color:$.Color.white,backgroundColor:$.Color.blackOverlay60,textAlign:"center",elevation:3}),messageAndButtonAndPreviewInfoContainer:()=>a.Styles.createViewStyle({flex:1,paddingTop:12,paddingLeft:12,paddingRight:12,paddingBottom:8,borderRadius:he,overflow:"visible",flexDirection:"column",justifyContent:"space-between"}),messageDesktop:()=>a.Styles.createTextInputStyle({backgroundColor:$.Color.transparent,paddingRight:15,flex:1,height:80,fontSize:J.default.fontSize.size17}),messageDesktopForward:()=>a.Styles.createTextInputStyle({backgroundColor:$.Color.transparent,flex:1}),messageForwardCanvas:()=>a.Styles.createTextInputStyle({margin:12}),quotePreviewArea:()=>a.Styles.createViewStyle({flex:1,paddingTop:12,paddingHorizontal:12}),quotesPreviewContainerWithTextInput:()=>a.Styles.createViewStyle({flex:1,flexDirection:"column",alignItems:"stretch",margin:10,borderRadius:10,borderWidth:0}),quotePreviewTextStyle:()=>a.Styles.createTextStyle({fontSize:Y.IconSize.size16,lineHeight:21}),previewInfoWithoutThumbnail:()=>a.Styles.createTextStyle({maxWidth:420}),previewInfoWithThumbnail:()=>a.Styles.createTextStyle({maxWidth:300}),quoteContainerForwardDesktop:()=>a.Styles.createViewStyle({height:47}),previewLocationPin:()=>a.Styles.createViewStyle({backgroundColor:$.Color.black,height:22,width:22,borderRadius:44,borderWidth:3,borderColor:$.Color.white,borderStyle:"solid",position:"absolute",top:55,left:55})}),pe={[_.SearchType.ZeroInput]:[{groupType:_.SearchResultsListGroup.SuggestedRecentConversationsWithEstablishedPrivateConversations,isCollapsible:!0},{groupType:_.SearchResultsListGroup.CombinedContactsWithoutAddressBookOrAlphaHeaders,isCollapsible:!0}],[_.SearchType.ShortQuery]:[{groupType:_.SearchResultsListGroup.AllPeopleWithoutAddressBook},{groupType:_.SearchResultsListGroup.GroupChats}],[_.SearchType.LongQuery]:[{groupType:_.SearchResultsListGroup.AllPeopleWithoutAddressBook},{groupType:_.SearchResultsListGroup.GroupChats},{groupType:_.SearchResultsListGroup.PublicDirectory}]};class ge extends h.default{constructor(){super(...arguments),this._onKeyDownEvent=new l.default,this._keyboardAnimatedHeightValue=new a.Animated.Value(0),this._keyboardAnimatedHeightStyle=a.Styles.createAnimatedViewStyle({height:this._keyboardAnimatedHeightValue}),this._hasUsedSearch=!1,this._wasSharePanelDismissedByUser=!1,this._goBack=e=>(I.log(_.LogTraceArea.ShareWithPanel,"ShareWithPanel._goBack,  causeId: "+e),this.props.onShareCancel&&(this.props.onShareCancel(),this._dismissed=!0),this._wasSharePanelDismissedByUser=!0,A.default.hideProcessingDialog(!1),super._goBack(e)),this._onSearchResultsListRef=e=>{this._searchResultsListRef=e||void 0},this._onProfileRemoved=()=>{this._searchResultsListRef&&this._searchResultsListRef.focusFirst()},this._onInputChanged=e=>{this.isComponentMounted()&&(!1===this._hasUsedSearch&&e.length>0&&(this._hasUsedSearch=!0),this.setState({inputText:e}))},this._isDoneButtonDisabled=()=>!this.isComponentMounted()||!this.state.shareDestinations||this.state.shareDestinations.length<=0,this._getHeader=()=>{let e;if(!this.props.isExternalWindow){const t={closeButtonType:this.props.navigationDirection===K.StackNavigationDirection.Push?G.CloseButtonType.Back:G.CloseButtonType.Close,onPress:this._cancelShare,title:k.getString("ShareWithPanel.CloseButtonTitle")},s=this._getHeaderText(this.state),o=this.props.accessibilityLabelTitle||i.trimEnd(s,".");e=a.createElement(G.SimplePanelHeader,{panelName:s,accessibleName:o,leftButton:t,hideBottomBorder:!this._enablePreview})}const t=this._enablePreview?this._renderPreviewAndText():void 0;return a.createElement(a.View,null,e,t)},this._onSearchInputKeyDown=e=>{this._onKeyDownEvent.fire(e.keyCode)},this._onSendButtonPress=e=>{const t=re.default.newCauseId();I.log(_.LogTraceArea.ShareWithPanel,"ShareWithPanel._onSendButtonPress,  causeId: "+t),b.default.updateSendingStatus(e,b.ForwardMessageState.Sending),this.state.shareDestinations.push(e),this.isComponentMounted()&&this.setState({shareDestinations:this.state.shareDestinations,headerConfig:Object.assign(Object.assign({},this.state.headerConfig),{key:"header"+this.state.shareDestinations.length})}),this._completeSharingProcess([e],t)},this._cancelShare=()=>{const e=re.default.newCauseId();I.log(_.LogTraceArea.ShareWithPanel,"ShareWithPanel._cancelShare, causeId: "+e),this._goBack(e)},this._shareDone=()=>{const e=re.default.newCauseId();return I.log(_.LogTraceArea.ShareWithPanel,"ShareWithPanel._shareDone, causeId: "+e),this._wasSharePanelDismissedByUser=!0,A.default.hideProcessingDialog(!1),super._goBack(e)},this._onInput=e=>{this._savedMessageInput=e,this.isComponentMounted()&&this.setState({previewMessage:e,headerConfig:Object.assign(Object.assign({},this.state.headerConfig),{key:"header"+e})})},this._headerHeight=()=>(this.state.deviceOrientation!==n.DeviceOrientation.Landscape?this.state.isSmallDevice?G.HeaderHeightSmall:G.HeaderHeight:this.state.isSmallDevice?G.HeaderHeightLandscapeSmall:G.HeaderHeightLandscape)+this.state.statusBarPadding+(this._enablePreview?ae:0)+(this.props.sharePreviewType===F.SharePreviewType.AudioMessage?le:0)}_buildState(e,t){const s=this._getRootViewId();let o={statusBarPadding:B.default.statusBarPadding(),deviceOrientation:D.default.getDeviceOrientation(s),isSmallDevice:D.default.isSmallDevice(s)};const n=c.default.getS4LMessagingFeatures();if(t&&(this._conversationSelectionController=new m.default,this._finishButtonAnimatedHeightValue=new a.Animated.Value(0),this._dismissed=!1,o.urlThumbnail=void 0,o.inputText="",o.shareDestinations=[],this._enableForwardPreview=i.isUndefined(e.showForwardPreview)||e.showForwardPreview,this._enableMediaPreview=e.enableMediaPreview&&n.enableShareMediaPreview,this._enablePreview=i.isUndefined(this._enableForwardPreview)?this._enableMediaPreview:this._enableForwardPreview,this._enablePreview)){o=this._tryGetUrlPreview(e,o);const t=i.find(e.multipleMessagesParameters,(e=>!!e.messageContent));o.previewMessage=this._isUrlShare||e.showForwardPreview||e.sharePreviewType!==F.SharePreviewType.Text?void 0:t&&t.messageContent,this._savedMessageInput=o.previewMessage}o.isUsingStackNavigationContext=L.default.isUsingStackNavigationContext(),o.keyboardUpdateInfo=w.default.getUpdateInfo(),o.keyboardResizeMode=w.default.getResizeMode(),o.selectedMris=this._conversationSelectionController.getSelectedConversations(),o.canSubmit=this._conversationSelectionController.getSelectedConversations().length>0,o.enableForwardingQuotes=n.enableForwardingQuotes;const r=e.sharePreviewType===F.SharePreviewType.Text,l=e.sharePreviewType===F.SharePreviewType.MultipleMessages&&i.every(e.multipleMessagesParameters,(e=>e.messageType===u.MessageTypes.Text||e.messageType===u.MessageTypes.EncryptedText)),d=r||l;return o.includePrivateConversations=e.showForwardPreview&&d,o.excludeS4B=!d,o.headerConfig={getHeader:this._getHeader,getHeaderHeight:this._headerHeight,key:"header"+o.previewMessage},o}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this._searchController=new H.default,b.default.reset()}componentDidMount(){super.componentDidMount();const e=q.default.mergeStyles([q.default.createHiddenStyle(!1),q.default.createBarStyle(this._themeColors.defaultStatusBarTheme)]);this._updateStatusBarStyle(e);const t=this.props.multipleMessagesParameters.length>0&&this.props.multipleMessagesParameters[0].conversationId;t&&(this._conversationSelectionController.addConversation(t),this.setState({canSubmit:!0}),a.Animated.timing(this._finishButtonAnimatedHeightValue,{toValue:48,duration:250,easing:a.Animated.Easing.InOut()}).start())}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),this.state.keyboardUpdateInfo.height!==t.keyboardUpdateInfo.height&&this._keyboardAnimatedHeightValue.setValue(t.keyboardUpdateInfo.height)}componentWillUnmount(){super.componentWillUnmount();const e=re.default.newCauseId();I.log(_.LogTraceArea.ShareWithPanel,"ShareWithPanel.componentWillUnmount,  causeId: "+e),b.default.reset(),!this._dismissed&&this.props.onShareCancel&&this.props.onShareCancel(),this._searchController&&this._searchController.destroy(),I.track(new z.SharePanelTelemetry(this.props.entryPoint,this.state.shareDestinations.length,this._hasUsedSearch,!!this._savedMessageInput)),this.state.shareDestinations.length>0&&this._wasSharePanelDismissedByUser&&(this.props.showForwardPreview&&i.each(this.props.multipleMessagesParameters,(t=>{this._onShareCompleteForMessage(t,this.state.shareDestinations,e)})),!this.props.onShareComplete||this.props.onShareCancel&&this._dismissed||this.props.onShareComplete(this.state.shareDestinations,!!this.state.previewMessage))}render(){const e=this.state.keyboardResizeMode===r.KeyboardAwareResizeMode.None?a.createElement(a.Animated.View,{style:this._keyboardAnimatedHeightStyle}):void 0,t=!a.UserInterface.isNavigatingWithKeyboard();return a.createElement(p.default,{goBack:this._goBack},a.createElement(a.View,{style:[ue.container,this._themeStyles.primaryBackgroundColorStyle]},a.createElement(a.View,{style:ue.container},a.createElement(O.default,{key:"peopleInput",searchController:this._searchController,headerConfig:this.state.headerConfig,onCancel:this._cancelShare,peopleType:U.PeopleType.AllExcludingBots,includeGroups:!0,autoFocusOnInput:t,autoFocusWhenActive:!0,selectorController:this._conversationSelectionController,useCollapsableHeader:!1,onKeyDown:this._onSearchInputKeyDown,isUrlRequestComplete:!!this.state.urlThumbnail,inputText:this.state.inputText,onInputChanged:this._onInputChanged,colorThemeOverride:this.props.colorThemeOverride,onProfileRemoved:this._onProfileRemoved,noFixedHeight:this._isHeightUnknownForHeader(),showSendButtonOnEverySearchItemUI:!0}),a.createElement(N.SearchResultsList,{ref:this._onSearchResultsListRef,rawSearchQuery:this.state.inputText,origin:_.SearchResultsListOrigin.ShareWithPanel,searchResultGroups:this._getSearchResultsGroup(),searchController:this._searchController,arePeopleSelectableForInvite:!1,selectedMris:this.state.selectedMris,peopleType:U.PeopleType.AllExcludingBots,maxNumberOfSuggestedContacts:20,excludePstn:!0,excludeS4B:this.state.excludeS4B,userMrisToExclude:this.props.userMrisToExclude,keyDownEvent:this._onKeyDownEvent,colorThemeOverride:this.props.colorThemeOverride,excludeEncrypted:!this.state.includePrivateConversations,includePrivateConversationsWithHandshake:this.state.includePrivateConversations,onSendMessageButtonPress:this._onSendButtonPress,disableItemOnLongPress:!0,disableRowHoverStyle:!0})),a.createElement(j.default,{button:this._getActionDoneButton()}),e))}_componentId(){return"ShareWithPanel"}_isHeightUnknownForHeader(){return!this.state.isUsingStackNavigationContext||this.props.sharePreviewType===F.SharePreviewType.Text}_getActionDoneButton(){return{onPress:this._shareDone,disabled:this._isDoneButtonDisabled(),text:k.getString("Global.DoneButtonTitle"),accessibilityLabel:k.getString("Global.DoneButtonTitle")}}_tryGetUrlPreview(e,t){if(e.sharePreviewType!==F.SharePreviewType.Text)return t;if(e.showForwardPreview){const s=i.filter(e.multipleMessagesParameters,(e=>!!e.urlPreviewData));if(s&&1===s.length){const e=s[0].urlPreviewData;e&&e.isValid&&(this._isUrlShare=!0,t=Object.assign(Object.assign({},t),{urlThumbnail:e.urlPreviewMetadata.thumbnail,site:e.urlPreviewMetadata.site,infoUrl:e.urlPreviewMetadata.url}))}return t}let s;return e.multipleMessagesParameters.length>0&&(s=e.multipleMessagesParameters[0].messageContent||e.multipleMessagesParameters[0].url),s&&ie.default.isUrlValid(s)?(this._isUrlShare=!0,te.default.getUrlInfoAsync(s).then((e=>{if(!s)return;const t=se.getUrlPreviewInformationFromMetadata(e,s),i=t.hasThumbnail?t.urlPreviewMetadata.thumbnail:void 0,o=t.urlPreviewMetadata.site,n=t.urlPreviewMetadata.url;this.isComponentMounted()&&this.setState({urlThumbnail:i,site:o,infoUrl:n})})).catch((e=>{I.error(_.LogTraceArea.ShareWithPanel,"Error generating url preview in ShareWithPanel: "+Q.default.errorAsString(e))})),t):t}_renderPreviewAndText(){let e,t,s,n;const r=!this.props.isExternalWindow&&!o.default.isMobile();let l,d=[ue.mediaPreviewContainer,r?ue.mediaPreviewForwardContainerDesktop:void 0];if(l=this.state.urlThumbnail?ue.previewInfoWithThumbnail:ue.previewInfoWithoutThumbnail,this._isUrlShare)this.state.urlThumbnail&&(e=a.createElement(g.UrlPreview,{imagePreviewHeight:de,imagePreviewWidth:ce,borderRadius:he,urlThumbnail:this.state.urlThumbnail})),t=this._getOptionalPreviewInfo({firstLine:this.state.site,secondLine:this.state.infoUrl,isUrlPreview:!0,iconToShowSecondLine:Y.SkypeIcon.Link,lineStyles:l});else{let o=i.filter(this.props.multipleMessagesParameters,(e=>!i.isUndefined(e.localMediaThumbnailUri)));const r=this.props.sharePreviewType===F.SharePreviewType.Audio;let l,c=ue.previewInfoWithThumbnail;switch(this.props.sharePreviewType){case F.SharePreviewType.Video:t=this._getOptionalPreviewInfo({firstLine:k.getString("ShareWithPanel.VideoPreviewInfo"),iconToShowFirstLine:Y.SkypeIcon.Video,lineStyles:c}),e=this._renderThumbnailsPreview(o);break;case F.SharePreviewType.MixedVideoAndPhoto:case F.SharePreviewType.Photo:e=this._renderThumbnailsPreview(o);break;case F.SharePreviewType.AudioMessage:const h=this.props.multipleMessagesParameters&&this.props.multipleMessagesParameters.length>0?this.props.multipleMessagesParameters[0].audioMessageDuration:void 0,u=h?f.default.getElapsedTimeStringFromS(Math.ceil(h/1e3)):void 0;t=this._getOptionalPreviewInfo({firstLine:k.getString("ShareWithPanel.AudioMessagePreviewInfo"),secondLine:u?k.getString("ShareWithPanel.AudioMessageDuration",{duration:u}):void 0,iconToShowFirstLine:i.isUndefined(u)?Y.SkypeIcon.Microphone:void 0,iconToShowSecondLine:u?Y.SkypeIcon.Microphone:void 0,lineStyles:ue.previewInfoWithThumbnail});break;case F.SharePreviewType.File:case F.SharePreviewType.Audio:let p;if(d.push(this._themeStyles.viewBorderStyle),o&&1===o.length){const e=o[0];p=e.localMediaThumbnailUri&&this._getFileNameFromUrl(e.localMediaThumbnailUri)}else o=i.filter(this.props.multipleMessagesParameters,(e=>!i.isUndefined(e.fileName))),o&&1===o.length&&(p=o[0].fileName,l=r?o[0].fileType:void 0);const m=W.default.getPreviewInfoSizeInBytes(o),S=m?v.default.formatFileSize(m,2).formattedString:void 0;e=a.createElement(g.FilePreview,{borderRadius:he,fileName:p,fileType:l}),t=this._getOptionalPreviewInfo({firstLine:W.default.getPreviewInfoTitle(o,this.props.sharePreviewType),secondLine:S,lineStyles:c});break;case F.SharePreviewType.Contact:let y,_,C="",b="";o=i.filter(this.props.multipleMessagesParameters,(e=>!i.isUndefined(e.contactInfo&&e.contactInfo.skypeId))),o&&1===o.length&&(y=o[0]),y&&y.contactInfo&&(C=y.contactInfo.skypeId,b=y.contactInfo.fullName,_=y.contactInfo.userMri),_&&(e=this._renderContactPreview(_)),t=this._getOptionalPreviewInfo({firstLine:b,secondLine:C,lineStyles:c});break;case F.SharePreviewType.SwiftCards:let T,M;if(o=i.filter(this.props.multipleMessagesParameters,(e=>!i.isUndefined(e.swiftMessage))),o&&1===o.length){o[0].localMediaThumbnailUri&&(e=this._renderThumbnailsPreview(o));const t=o[0].swiftMessage;if(t){t.attachments&&1===t.attachments.length&&(T=t.summary,M=X.default.getSwiftCardInfoTitle(t))}}t=this._getOptionalPreviewInfo({firstLine:T,secondLine:M,lineStyles:c,isUrlPreview:!0,iconToShowSecondLine:Y.SkypeIcon.Link});break;case F.SharePreviewType.Text:if(!this.props.showForwardPreview)break;let I=i.filter(this.props.multipleMessagesParameters,(e=>!i.isUndefined(e.message)));if(I.length&&I[0]){const e=I[0].message;if(!e||this.state.enableForwardingQuotes&&I[0].sendAsForwardedQuote)break;n=this._renderQuotePreview(e)}break;case F.SharePreviewType.Location:if(o=i.filter(this.props.multipleMessagesParameters,(e=>!i.isUndefined(e.locationInfo))),e=this._renderThumbnailsPreview(o),e&&(s=a.createElement(a.View,{style:ue.previewLocationPin})),o&&o.length){const e=o[0].locationInfo;e&&(t=this._getOptionalPreviewInfo({firstLine:e.topAddress,secondLine:e.bottomAddress,lineStyles:c}))}}}const c=[this._themeStyles.primaryTextColorStyle,r?ue.messageDesktopForward:ue.messageDesktop,n?ue.messageForwardCanvas:void 0],h=[ue.messageAndButtonAndPreviewInfoContainer,this._themeStyles.messageComposerBackgroundStyle],u=e?a.createElement(a.View,{style:d},e):void 0,p=a.createElement(a.TextInput,{key:"optionalInputText",autoCorrect:!0,value:this.state.previewMessage,style:c,maxLength:25e3,multiline:!n,blurOnSubmit:!!n,onChangeText:this._onInput,placeholder:k.getString("ShareWithPanel.MessagePlaceHolder"),placeholderTextColor:this._themeColors.secondaryTextColor,keyboardAppearance:this._useDarkTheme()?"dark":"default",autoCapitalize:"sentences",editable:!this.state.isTextInputDisabled,clearButtonMode:"never"});if(n){const e=[ue.quotesPreviewContainerWithTextInput,this._themeStyles.secondaryBackgroundColorStyle];return a.createElement(a.View,{style:e},n,p)}return a.createElement(a.View,{style:ue.previewContainer},u,s,a.createElement(a.View,{style:h},p,t))}_getOptionalPreviewInfo(e){return a.createElement(g.PreviewInfo,{firstLine:e.firstLine,secondLine:e.secondLine,isUrlPreview:e.isUrlPreview||!1,colorThemeOverride:this.props.colorThemeOverride,iconToShowFirstLine:e.iconToShowFirstLine,iconToShowSecondLine:e.iconToShowSecondLine,lineStyles:e.lineStyles})}_renderQuotePreview(e){const t=[this._themeStyles.primaryTextColorStyle,J.default.font.uiDisplayBold],s={numberOfLines:1,renderOrigin:y.MessageRenderOrigin.ForwardCanvas,textOverrideStyle:[ue.quotePreviewTextStyle,this._themeStyles.primaryTextColorStyle],atMentionStyle:t,atMentionMeOverrideStyle:this._themeStyles.primaryTextColorStyle,quoteSymbolStyle:{size:Y.IconSize.size20,color:this._themeColors.primaryTextColor},quoteSeparatorStyle:a.Styles.createViewStyle({borderColor:this._themeColors.secondaryTextColor,marginBottom:0},!1),renderSimpleAtMentions:!0},i=[ue.quotePreviewArea,ue.quoteContainerForwardDesktop];return a.createElement(a.View,{style:i},a.createElement(E.default,{message:e,wrapInQuote:!0,options:s}))}_renderContactPreview(e){return a.createElement(oe.UserIcon,{key:"contact-preview",userMri:e,size:ne.UserIconSize.Size110,borderRadiusOverride:he})}_renderThumbnailsPreview(e){if(!i.isUndefined(e)&&0===e.length)return;const t=[],s=e[0],o=e[1];let n;if(i.isUndefined(s.localMediaThumbnailUri))return;if(o){const s=a.createElement(g.ImagePreview,{imagePreviewHeight:de,imagePreviewWidth:ce,borderRadius:he,urlThumbnail:o.localMediaThumbnailUri});t.push(a.createElement(a.View,{key:"image-back",style:[Z.default.shadowStyle,ue.backImageContainerPreview]},s));const i=W.default.getPreviewInfoTitle(e,this.props.sharePreviewType);n=a.createElement(ee.Caption,{key:"images-count",style:ue.imagesCount},i)}const r=a.createElement(g.ImagePreview,{imagePreviewHeight:de,imagePreviewWidth:de,borderRadius:he,urlThumbnail:s.localMediaThumbnailUri});return o?(t.push(a.createElement(a.View,{key:"image-front",style:[Z.default.shadowStyle,ue.frontImageContainerPreview]},r)),n&&t.push(n),t):r}_getSearchResultsGroup(){let e=pe,t=i.trim(this.state.inputText);return 0===t.length?e[_.SearchType.ZeroInput]:t.length<c.default.getConfigSettingsNoSubscription().search.longQueryCharCount?e[_.SearchType.ShortQuery]:e[_.SearchType.LongQuery]}_completeSharingProcess(e,t){I.log(_.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcess,  causeId: "+t);let s=!0;if(this.state.previewMessage){const t=this.props.sharePreviewType===F.SharePreviewType.Text&&!this._isUrlShare;this.props.showForwardPreview&&t||W.default.sendPreviewTextMessage(e,this.state.previewMessage)}i.each(this.props.multipleMessagesParameters,(i=>{s=s&&this._shareOrForwardMessage(i,e,t)})),i.each(e,(e=>{b.default.updateSendingStatus(e,b.ForwardMessageState.Sent)}))}_shareOrForwardMessage(e,t,s){I.log(_.LogTraceArea.ShareWithPanel,"ShareWithPanel._shareOrForwardMessage,  causeId: "+s);let o=!0;return e&&!i.isEmpty(t)&&(e.mediaSelection?(this._completeSharingProcessForMediaSelection(e.mediaSelection,t,s),o=!1):!i.isEmpty(e.forwardMediaInfos)&&!e.swiftMessage||e.messageType===u.MessageTypes.MediaAlbum?this._completeForwardProcessForMedia(e,t,s):e.messageType&&(o=this._shareMessageBasedOnType(e,t,s))),this.props.showForwardPreview||this._onShareCompleteForMessage(e,t,s),o}_onShareCompleteForMessage(e,t,s){I.log(_.LogTraceArea.ShareWithPanel,"ShareWithPanel._onShareCompleteForMessage,  causeId: "+s),e.onShareCompleteForMessage&&(this._isUrlShare&&!i.isUndefined(s)&&this.props.entryPoint===_.SharePanelEntryOrigin.External&&this._completeSharingProcessForGenericMessage(e,t,s),e.onShareCompleteForMessage(t))}_shareMessageBasedOnType(e,t,s){let i;I.log(_.LogTraceArea.ShareWithPanel,"ShareWithPanel._shareMessageBasedOnType,  causeId: "+s);let o=!1;switch(e.messageType){case u.MessageTypes.RichText:case u.MessageTypes.Location:case u.MessageTypes.Contacts:i=this._completeSharingProcessForGenericMessage(e,t,s),o=!0,this._onPostComplete(i);break;case u.MessageTypes.Media_Card:e.adaptiveCardMessage?(i=this._completeSharingProcessForAdaptiveCard(e,t,s),o=!0):(i=this._completeSharingProcessForMediaCard(e,t,s),o=!0),this._onPostComplete(i);break;case u.MessageTypes.UriObject:this._completeSharingProcessForPhoto(e,t,s).then((e=>{this._onPostComplete(e)}));break;case u.MessageTypes.Media_Video:this._completeSharingProcessForVideo(e,t,s).then((e=>{this._onPostComplete(e)}))}return o}_onPostComplete(e){this.props.onPostComplete&&this.props.onPostComplete(e)}_completeSharingProcessForGenericMessage(e,t,s){if(I.log(_.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForGenericMessage,  causeId: "+s),i.isEmpty(t))return I.log(_.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForGenericMessage, nothing to share, causeId: "+s),[];const o=[];return i.each(t,(t=>{if(e.url||this._isUrlShare){const s=e.url||e.messageContent;if(!s)return;const i=W.default.sendUrlAsLink(s,t);o.push(i)}else if(e.inputEntities){let s;const i=[e.inputEntities];this._savedMessageInput&&this.props.sharePreviewType===F.SharePreviewType.Text&&(this.state.enableForwardingQuotes&&e.sendAsForwardedQuote?this._shareMessage(t,this._savedMessageInput,e.message,e.messageType,o):(s=new T.UnhandledEntity(this._savedMessageInput),i.push(s)));const n=W.default.shareMessageEntities(t,i,e.message,e.messageType);o.push(n)}else e.messageContent&&this._shareMessage(t,e.messageContent,e.message,e.messageType,o)})),o}_shareMessage(e,t,s,i,o){const n=S.createForwardMessageInfo(e,_.PostSource.ShareWith,t||"",i,void 0,void 0,s?u.getForwardedTeamsProperties(s.properties):void 0);x.default.postMessage(n),o.push({clientMessageId:n.messageForPosting.clientmessageid,conversationId:e})}_completeSharingProcessForAdaptiveCard(e,t,s){const o=[];return I.log(_.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForAdaptiveCard,  causeId: "+s),i.isEmpty(t)?(I.log(_.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForAdaptiveCard, nothing to share, causeId: "+s),o):(i.each(t,(t=>{if(e.adaptiveCardMessage){const s={type:e.adaptiveCardMessage.type,attachments:e.adaptiveCardMessage.attachments},i=M.encode([new T.AdaptiveUriObjectEntity(s,t,!0)],!1,!1),n=S.createForwardMessageInfo(t,_.PostSource.ShareWith,i,e.messageType);x.default.postMessage(n),o.push({clientMessageId:n.messageForPosting.clientmessageid||"",conversationId:t})}})),o)}_completeSharingProcessForMediaCard(e,t,s){const o=[];return I.log(_.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForMediaCard,  causeId: "+s),i.isEmpty(t)?(I.log(_.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForMediaCard, nothing to share, causeId: "+s),o):(i.each(t,(t=>{if(e.swiftMessage){const s={type:e.swiftMessage.type,attachments:e.swiftMessage.attachments,summary:e.swiftMessage.summary},i=M.encode([new T.SwiftUriObjectEntity(s,t,!0,e.swiftMessage.summary)],!1,!1),n=S.createForwardSwiftMessageInfo(t,_.PostSource.ShareWith,i,e.messageType,s,e.forwardMediaInfos);x.default.postMessage(n),o.push({clientMessageId:n.messageForPosting.clientmessageid||"",conversationId:t})}})),o)}_completeForwardProcessForMedia(e,t,s){I.log(_.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeForwardProcessForMediaSelection,  causeId: "+s),i.isEmpty(t)?I.log(_.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeForwardProcessForMediaSelection, nothing to forward, causeId: "+s):i.each(t,(t=>{x.default.postMessage(S.createForwardMessageInfo(t,_.PostSource.ShareWith,e.messageContent||"",e.messageType,e.forwardMediaInfos,e.albumId))}))}_completeSharingProcessForMediaSelection(e,t,s){I.log(_.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForMediaSelection,  causeId: "+s),i.isEmpty(t)?I.log(_.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForMediaSelection, nothing to share, causeId: "+s):A.default.postMediaSelections(e,t,_.PostSource.ShareWith,{},void 0,s).then((()=>{R.default.navigateToHub(s)}))}_completeSharingProcessForPhoto(e,t,s){if(I.log(_.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForPhoto,  causeId: "+s),i.isEmpty(t))return I.log(_.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForPhoto, nothing to share, causeId: "+s),d.Resolved([]);const o=e.localMediaObjectUri;if(o){const i=this._getFileNameFromUrl(o),n={file:{uri:o,name:i,size:e.fileSize,type:"image/jpg"},extension:C.default.extractFileExtension(i)};return e.width&&e.height&&(n.dimensions={width:e.width,height:e.height}),x.default.postUploadAndShowFeedbackToast(t,n,_.PostSource.ShareWith,void 0,void 0,void 0,{name:V.ScenarioName.SendMessage}).finally((()=>{R.default.navigateToHub(s)}))}return I.warn(_.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForPhoto, no uri for the photo!  causeId: "+s),d.Rejected()}_completeSharingProcessForVideo(e,t,s){if(I.log(_.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForVideo,  causeId: "+s),i.isEmpty(t))return I.log(_.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForVideo, nothing to share, causeId: "+s),d.Resolved([]);const o=e.localMediaObjectUri;if(o){const i=o.substring(o.lastIndexOf("/")+1),n={file:{uri:o,name:i,size:e.fileSize,type:"video/mp4"},extension:C.default.extractFileExtension(i)};if(e.width&&e.height&&(n.dimensions={width:e.width,height:e.height}),e.localMediaThumbnailUri){const o=e.localMediaThumbnailUri,r=C.default.extractFileName(i)+"-thumbnail.jpg";n.thumbnail={file:{uri:o,name:r,size:0,type:"image/jpg"},extension:C.default.extractFileExtension(i)},e.width&&e.height&&(n.thumbnail.dimensions={width:e.width,height:e.height});const a={name:V.ScenarioName.SendVideo};return x.default.postVideoWithThumbnail(t,n,_.PostSource.ShareWith,!1,a).finally((()=>{R.default.navigateToHub(s)}))}return I.warn(_.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForVideo, the local media thumbnail uri is not present. causeId: "+s),d.Rejected()}return I.warn(_.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForVideo, no uri for the video! causeId: "+s),d.Rejected()}_getHeaderText(e){return this.props.shareMessageTitle||k.getString("ShareWithPanel.ShareWithHeader")}_getFileNameFromUrl(e){return e.substring(e.lastIndexOf("/")+1)}}t.default=ge},65042:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StaticEmoticonV2=t.StaticEmoticonV1=t.StaticEmoticon=t.Size=void 0;const i=s(96486),o=s(88837),n=s(16778),r=s(61253),a=s(39597),l=s(36974),d=s(89391),c=s(58962),h=s(32183),u=s(58187),p=s(34339);Object.defineProperty(t,"Size",{enumerable:!0,get:function(){return p.Size}});const g=s(23619),m=s(32183),S=s(26424),f={};function y(e){let t=c.getFrameHeight(e);return f[t]||(f[t]={image:n.Styles.createViewStyle({height:t,width:t}),placeholder:n.Styles.createViewStyle({height:t,width:t,borderRadius:t/2})}),f[t]}const _=e=>{if(e)return n.createElement(v,Object.assign({},e))},v=e=>{const{themeColors:t}=(0,u.useCommonContext)(),s=n.Styles.createViewStyle({backgroundColor:t.buttonBackgroundColor},!1);return n.createElement(n.View,{style:[s,y(e.size).placeholder,e.style]})};class C extends o.ComponentBase{render(){return!d.default.getS4LMessagingFeaturesNoSubscription().enableImageCachingStoreForStatic?n.createElement(b,Object.assign({},this.props)):n.createElement(T,Object.assign({},this.props))}}t.StaticEmoticon=C;class b extends o.ComponentBase{render(){const{key:e,emoticonInfo:t,size:s,onError:o,style:r}=this.props,a=y(s),l=d.default.getConfigSettingsNoSubscription().images.cacheControlRequestHeader,c=i.head(t.shortcuts),u={size:s,style:r};return n.createElement(g.PrefetchedImage,{key:e,source:h.getEmoticonUrl(t.id,s,!0,t.tone,t.etag),resizeMode:"cover",style:r?[a.image,r]:a.image,onError:o,altView:_,errorView:_,headers:l?{"Cache-Control":l}:void 0,config:u,onLoad:this.props.onLoad,title:c})}}t.StaticEmoticonV1=b;class T extends o.ComponentBase{constructor(){super(...arguments),this._telemetry=new l.default(d.default.getS4LMessagingFeaturesNoSubscription().nativeEmoticonCacheTelemetrySampleRate,(()=>this._getEmoticonInfo(this.props)))}_getEmoticonInfo(e){return{id:e.emoticonInfo.id,size:c.getPixelSize(e.size),type:S.EmoticonType.Static,tone:e.emoticonInfo.tone,etag:e.emoticonInfo.etag}}_doPropsDiffer(e,t){return!(0,r.default)(this._getEmoticonInfo(e),this._getEmoticonInfo(t))}_buildState(e,t){const s=this._getEmoticonInfo(e);return{resultToRender:a.default.requestEmoticon((0,m.getUrl)(s),s).result}}componentDidMount(){super.componentDidMount(),this._telemetry.updateTelemetry(this.state.resultToRender)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this._doPropsDiffer(e,this.props)?(this._telemetry.finishAndResetTelemetry(),this._telemetry.updateTelemetry(this.state.resultToRender)):(0,r.default)(t.resultToRender,this.state.resultToRender)||this._telemetry.updateTelemetry(this.state.resultToRender)}componentWillUnmount(){this._telemetry.finishAndResetTelemetry(),super.componentWillUnmount()}render(){if(!this.state.resultToRender||this.state.resultToRender.type!==S.ResultIconType.Final)return _({size:this.props.size,style:this.props.style});const e=y(this.props.size),t=d.default.getConfigSettingsNoSubscription().images.cacheControlRequestHeader,s=i.head(this.props.emoticonInfo.shortcuts);return n.createElement(n.Image,{source:(0,m.getUrl)(this.state.resultToRender.icon),resizeMode:"cover",onLoad:this.props.onLoad,style:this.props.style?[e.image,this.props.style]:e.image,onError:this.props.onError,headers:t?{"Cache-Control":t}:void 0,title:s})}}t.StaticEmoticonV2=T},31847:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(88837),n=s(74313),r=s(10117),a=s(33754),l=s(35455),d=s(81760),c=s(11828);let h={};class u extends o.ComponentBase{_buildState(e,t){return{imageUrl:l.getStickerUrl(e.src,l.StickerSize.ThumbLarge,!1,!0,e.etag)}}render(){let e;this.props.showPlaceholder&&(e=i.createElement(r.default,{icon:c.SkypeIcon.Sticker,color:d.Color.gray300,size:c.IconSize.size32}));const t=i.createElement(r.default,{icon:c.SkypeIcon.StickerDeleted,color:d.Color.gray300,size:c.IconSize.size32}),s=this.props.name?a.getString("AccessibilityLabel.Sticker",{stickerName:this.props.name}):a.getString("AccessibilityLabel.StickerWithoutName"),o=(l=this.props.dimension,h[l]||(h[l]={container:i.Styles.createViewStyle({width:l+4,height:l+4,margin:4},!1),stickerImage:i.Styles.createViewStyle({width:l,height:l},!1)}),h[l]);var l;return i.createElement(i.View,{importantForAccessibility:i.Types.ImportantForAccessibility.Yes,accessibilityLabel:s},i.createElement(n.default,{origin:"StickerThumbnail",key:"sticker",style:o.stickerImage,containerStyle:o.container,altView:e,errorView:t,resizeMode:"cover",source:this.state.imageUrl}))}}t.default=u},3871:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.renderLinkAsPreview=t.renderReact=void 0;const i=s(70655),o=s(23719),n=s(96486),r=s(16778),a=s(54391),l=s(88837),d=s(34339),c=s(89391),h=s(21476),u=s(92091),p=s(9841),g=s(79957),m=s(68625),S=s(48467),f=s(28553),y=s(92387),_=s(56241),v=s(96096),C=s(5531),b=s(65127),T=s(71830),M=s(98278),I=s(57219),w=s(16026),P=s(47477),k=s(81959),A=s(86374),E=s(13991),R=s(35521),L=s(70891),F=s(46096),x=s(85609),O=s(2781),D=s(73560),B=s(5406),V=s(91754),N=s(23944),U=s(36237),H=s(15877),z=s(40522),W=s(52859),j=s(33754),G=s(62523),K=s(72977),q=s(24466),Q=s(12762),X=s(42036),$=s(6658),J=s(65047),Y=s(76093),Z=s(18078),ee=s(18317),te=s(58962),se=s(78302),ie=s(71837),oe=s(634),ne=s(26143),re=s(31847),ae=s(4057),le=s(60552),de=s(88808),ce=s(27862),he=s(21835),ue=s(81760),pe=s(11010),ge=s(11828),me=s(80837),Se=s(60562),fe=s(26712),ye=s(53374),_e=s(5451),ve=s(53559),Ce=$.messageTextLineHeight,be=te.frameHeights.emoticons.SMALL+2,Te=(0,H.lazyProperties)({onlyEmoticonsStyleExtraExtraLarge:()=>r.Styles.createViewStyle({margin:4,width:te.frameHeights.emoticons.Size120+8}),onlyEmoticonsStyleExtraLarge:()=>r.Styles.createViewStyle({margin:4,width:te.frameHeights.emoticons.Size80}),onlyEmoticonsStyleLarge:()=>r.Styles.createViewStyle({margin:4,width:te.frameHeights.emoticons.Size40}),onlyEmoticonsStyleMedium:()=>r.Styles.createViewStyle({margin:4,width:te.frameHeights.emoticons.Size30}),onlyEmojiStyleSmallVerticalAlign:()=>r.Styles.createTextStyle({verticalAlign:"text-bottom",marginHorizontal:2,width:te.frameHeights.emoticons.SMALL}),onlyEmoticonsStyleSmall:()=>r.Styles.createTextStyle({paddingTop:4,paddingLeft:2,width:te.frameHeights.emoticons.SMALL+4,height:be,overflow:"visible"}),onlyEmoticonsStyleSmallNoText:()=>r.Styles.createTextStyle({paddingTop:0}),onlyEmojiStyleExtraExtraLarge:()=>r.Styles.createTextStyle({lineHeight:te.frameHeights.emoticons.Size120,fontStyle:"normal",fontSize:90}),onlyEmojiStyleExtraLarge:()=>r.Styles.createTextStyle({lineHeight:te.frameHeights.emoticons.Size80,fontStyle:"normal",fontSize:63}),onlyEmojiStyleLarge:()=>r.Styles.createTextStyle({lineHeight:te.frameHeights.emoticons.Size40,fontStyle:"normal",fontSize:30}),onlyEmojiStyleMedium:()=>r.Styles.createTextStyle({lineHeight:te.frameHeights.emoticons.Size30,fontStyle:"normal",fontSize:22}),onlyEmojiStyleSmall:()=>r.Styles.createTextStyle({lineHeight:te.frameHeights.emoticons.SMALL,fontStyle:"normal",fontSize:15}),smallEmojiDesktopRenderNormalization:()=>r.Styles.createTextStyle({top:2,paddingRight:2}),horizontalPadding:()=>r.Styles.createViewStyle({paddingHorizontal:2})});class Me extends P.TransformerBase{constructor(e,t,s){super(),this._root=t,this._key=0,this.transformEditMessageMetaDataNode=this._skip,this.transformLegacyQuoteNode=this._skip,this._onExecuteAdaptiveCardAction=e=>{if(e.type!==a.Types.ActionTypes.actionOpenUrl)return;const t=e;t&&fe.default.isUrlValid(t.url)&&(t.preview?X.default.viewLink(t.url,M.MainRootViewId):z.openUrl(F.BrowserOrigin.AdaptiveCard,t.url,M.MainRootViewId))},this.transformUnknownNode=this._renderChildren,this.transformTextWrapperNode=this._skip,this.transformTargetUserNode=this._skip,this.transformTargetLegacyUserNode=this._skip,this.transformTargetRoleNode=this._skip,this.transformTargetsNode=this._skip,this.transformMetaNode=this._skip,this.transformUriObjectNode=this._renderChildren,this.transformSkypeVideoMessageNode=this._renderChildren,this.transformPartNode=this._skip,this.transformEndedNode=this._skip,this.transformGuestNameUpdateTargetNode=n.identity,this._renderStringParts=(e,t)=>n.flatMap(e,((e,s)=>n.isString(e)?r.createElement(r.Text,{key:this._generateReactKey(t,s),style:n.compact([this._options.systemTextStyle,this._options.textOverrideStyle]),selectable:!this._useInheritedStyle&&this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0},e):n.isArray(e)?this._renderStringParts(e):e)),this._renderArbitraryText=(e,t)=>{const s=A.decodeFromContent(e),i=n.clone(this._options);return i.textOverrideStyle=n.flatten(n.compact([i.textOverrideStyle,t])),new Me(i,this._root,this._searchStore).transform(s)},this._renderTextNode=(e,t)=>{const s=n.clone(this._options);return s.textOverrideStyle=n.flatten(n.compact([s.textOverrideStyle,t])),new Me(s,this._root,this._searchStore).transform(e)},this._formatListAsDisplayNames=e=>{const t=[];return n.each(e,((s,i)=>{t.push(this._formatAsDisplayName(s)),i!==e.length-1&&t.push(r.createElement(r.Text,{key:","+i,style:n.compact([this._options.regularTextStyle,this._options.textOverrideStyle]),selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0},", "))})),t},this._formatAsDisplayName=(e,t="")=>r.createElement(R.DisplayName,{key:this._appendUniqueKeyValue(e),mri:e,fallbackText:t,renderName:this._formatParticipantName}),this._formatParticipantName=e=>r.createElement(r.Text,{key:this._appendUniqueKeyValue(e),style:n.compact([this._options.systemEmphasisTextStyle,this._options.textOverrideStyle]),selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0},e),this._formatAtMentionParticipantName=e=>this._formatParticipantName("@"+e),this._renderMessageParts=(e,t)=>{const s=this._renderStringParts(e,t);return r.createElement(r.Text,{key:this._appendUniqueKeyValue("localizeParts"),style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceLayoutInRTL:this._options.forceLayoutInRTL,forceDirection:!0},s)},this._options=this._optionsWithDefaults(e),this._searchStore=s,this._useInheritedStyle=!!this._options.inheritColor}static _getDefaultOptions(e){const t=Math.round(e);if(!Me._defaultOptions[t]){const e={metadataAlign:L.MojiMetadataAlign.Left,size:L.MojiSize.Large,hideMetadata:!1};Me._defaultOptions[t]={message:void 0,onlyEmoticons:!1,numberOfEmoticons:0,onlyUnicodeEmoji:!1,numberOfUnicodeEmoji:0,processing:{},lineBreakString:"\n",renderMedia:!0,mediaPlaceholderIconColor:ue.Color.gray400,blurMedia:!1,allowTextSelection:!1,regularTextStyle:r.Styles.createTextStyle({fontSize:t,lineHeight:Ce,letterSpacing:-.2,fontFamily:pe.default.fontFamily.uidDisplayRegular,color:ue.Color.gray400,alignSelf:"stretch",backgroundColor:ue.Color.transparent}),italicTextStyle:r.Styles.createTextStyle({fontSize:t,lineHeight:Ce,fontStyle:"italic",backgroundColor:ue.Color.transparent}),boldTextStyle:r.Styles.createTextStyle({fontSize:t,lineHeight:Ce,font:pe.default.font.uiDisplaySemibold,backgroundColor:ue.Color.transparent}),strikeThroughStyle:r.Styles.createTextStyle({fontSize:t,lineHeight:Ce,textDecorationLine:"line-through",backgroundColor:ue.Color.transparent}),preTextStyle:r.Styles.createTextStyle({fontSize:t,lineHeight:Ce,fontFamily:pe.default.fontFamily.monospace,fontStyle:"normal"}),systemTextStyle:r.Styles.createTextStyle({fontSize:t,lineHeight:Ce,fontFamily:pe.default.fontFamily.uidDisplayRegular,color:ue.Color.gray400}),systemEmphasisTextStyle:r.Styles.createTextStyle({fontSize:t,lineHeight:Ce,font:pe.default.font.uiDisplaySemibold,color:ue.Color.gray400}),atMentionStyle:r.Styles.createTextStyle({font:pe.default.font.uiDisplaySemibold,color:ue.Color.gray400}),quotedTextStyle:r.Styles.createTextStyle({color:ue.Color.gray400,fontSize:t,lineHeight:Ce,fontStyle:"italic"}),quoteAttributeStyle:r.Styles.createTextStyle({color:ue.Color.gray400,fontSize:pe.default.controlFontSize.bodySmallDeprecated,lineHeight:18,font:pe.default.font.uiDisplayRegular}),quoteSeparatorStyle:r.Styles.createViewStyle({borderColor:ue.Color.gray300,borderBottomWidth:1}),linkStyle:r.Styles.createTextStyle({fontSize:t,lineHeight:Ce,color:ue.Color.white,fontFamily:pe.default.fontFamily.uidDisplayRegular,textDecorationLine:"underline"}),mojiBackgroundColor:ue.Color.white,mojiProps:e,renderSimpleAtMentions:!1,linkedMessages:[],hasTranslation:!1}}return Me._defaultOptions[t]}_optionsWithDefaults(e){const t=e.fontSize||pe.default.controlFontSize.messageStreamItemDesktop;return n.defaults(e,Me._getDefaultOptions(t))}_renderChildren(e){return this._renderReactNodes(e.children)}_skip(){return{value:null,stopProcessing:!1,renderAsInline:!0}}_aggregateInlines(e,t,s,i,o){const a=[];let l=[];if(n.each(e,(e=>{n.isString(e)?l.push(e):(l.length&&(a.push(l.join("")),l=[]),a.push(e))})),l.length&&a.push(l.join("")),a.length>1&&!i){const e=n.flatten(n.compact([this._options.regularTextStyle,this._options.textOverrideStyle]));return s?a:n.map(a,(s=>n.isString(s)?r.createElement(r.Text,{key:this._appendUniqueKeyValue(t),style:e,selectable:this._options.allowTextSelection,forceDirection:o,textBreakStrategy:"simple"},s):s))}if(1!==a.length||!s&&n.isString(a[0])||i&&!(a[0]instanceof r.Text)){let e=n.flatten(n.compact([this._options.regularTextStyle,this._options.textOverrideStyle]));return[r.createElement(r.Text,{ref:this._options.onSelectableText,key:t,selectable:!this._useInheritedStyle&&this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,style:e,allowFontScaling:this._options.allowFontScaling,maxContentSizeMultiplier:this._options.maxContentSizeMultiplier,forceLayoutInRTL:this._options.forceLayoutInRTL,forceDirection:o||void 0,textBreakStrategy:"simple"},a)]}return a}_renderReactNodes(e,t=!1,s){let i,o=[],r=[],a=!1,l=!0;const d=e.length;for(let c=0;c<d;c++){let d;const h=e[c];if(h?(d=h.accept(this),d||(d=this._skip())):d=this._skip(),d.value&&(i=(void 0===i||i)&&d.forceDirection,d.renderAsInline?n.isArray(d.value)?r=r.concat(d.value):r.push(d.value):(l=!1,r.length>0&&(o.push(...this._aggregateInlines(r,this._appendUniqueKeyValue("inline"),t,!!s,d.forceDirection)),r=[]),o.push(d.value))),d.stopProcessing){a=!0;break}}r.length>0&&o.push(...this._aggregateInlines(r,this._appendUniqueKeyValue("inline"),t,!!s,i));let c=null;return 1===o.length?c=o[0]:o.length>1&&(c=o),{value:c,stopProcessing:a,renderAsInline:l}}_useLargeEmoticons(){const{allowLargeEmoticons:e,onlyEmoticons:t,onlyUnicodeEmoji:s,numberOfEmoticons:i,numberOfUnicodeEmoji:o}=this._options;return!!e&&(t&&i<=3||s&&o<=3)}_generateReactKey(e,...t){return this._appendUniqueKeyValue(e?e.getTag():"_")+t.join("")}_appendUniqueKeyValue(e){return this._key++,e+this._key.toString()}transform(e){return e.accept(this)}transformRootNode(e){return this._useLargeEmoticons()?this._renderReactNodes(e.children,!1,!1):this._renderReactNodes(e.children,!1,!0)}transformPlainTextNode(e){return this._renderPlainText(e.getRawText(),e)}transformHighlightedNode(e,t,s){if(!e.children)return{value:null,stopProcessing:!1};const i=this._renderReactNodes(e.children,!0,!1);return Object.assign(Object.assign({},i),{value:r.createElement(B.HighlightedNode,{key:this._generateReactKey(e),isPrimarySearchResult:!!t,allowTextSelection:this._options.allowTextSelection,textOverrideStyle:this._options.textOverrideStyle,isOwnMessage:!!s},i.value)})}_renderSingleLine(e,t){return{value:e,stopProcessing:!1}}_renderLineBreak(e){return this._options.trimToFirstLine?{value:null,stopProcessing:!0,renderAsInline:!0}:{value:this._options.lineBreakString,stopProcessing:!1,renderAsInline:!0}}transformAtMentionNode(e){if(!this._options.renderSimpleAtMentions)switch(this._options.processing.atMentions){case L.ProcessingLevel.None:return this._skip();case L.ProcessingLevel.Stripped:return this._renderReactNodes(e.children)}let t=!1;const s=ye.default.unescapeXml(e.id);let i;"*"===s?t=!0:(i=T.isMri(s)?s:T.skypeIdToMri(s),Z.default.isMyMri(i)&&(t=!0));let o=n.compact([this._options.regularTextStyle,this._options.textOverrideStyle,this._options.atMentionStyle,me.default.pointerCursor]);t&&this._options.atMentionMeOverrideStyle&&o.push(this._options.atMentionMeOverrideStyle);const a=n.clone(this._options);a.textOverrideStyle=o;let l=e.children;e.isAllMention()&&(l=[Q.PlainTextNode.fromPlainText(e.getLocalizedAllMention())]);const d=new Me(a,this._root,this._searchStore)._renderReactNodes(l),c=C.default.navigation().canAccessUserDetails&&!t&&!e.isInQuote();return{value:r.createElement(h.default,{style:o,key:this._generateReactKey(e),selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines,allowFontScaling:this._options.allowFontScaling,maxContentSizeMultiplier:this._options.maxContentSizeMultiplier,onPressProfileMriToShow:c?i:void 0,onContextMenu:this._options.onContextMenu,onPressInterceptionCallback:this._options.onPressInterceptionCallback,renderSimpleAtMention:this._options.renderSimpleAtMentions,skipAtSymbol:e.isLegacyAtMention},d.value),stopProcessing:d.stopProcessing,renderAsInline:!0}}transformUserMriNode(e){return{value:this._formatAsDisplayName(ye.default.unescapeXml(e.mri),ye.default.unescapeXml(e.textNode.getRawText())),stopProcessing:!1,renderAsInline:!0}}transformUnicodeEmojiNode(e){const t=this._useLargeEmoticons();let s,i;switch(s=t&&1===this._options.numberOfUnicodeEmoji?this._options.singleEmoticonSize||this._options.emoticonsOnlyEmoticonSize||d.Size.ExtraExtraLarge:t?this._options.emoticonsOnlyEmoticonSize||d.Size.ExtraLarge:d.Size.Small,t&&!this._options.allowHugeEmoticons&&(s=d.Size.Large),this._unicodeEmojiColorStyle||(this._unicodeEmojiColorStyle=r.Styles.createTextStyle({color:this._options.mediaPlaceholderIconColor},!1)),s){case d.Size.Small:i=[Te.onlyEmojiStyleSmall,this._unicodeEmojiColorStyle],i=[Te.onlyEmojiStyleSmall,this._unicodeEmojiColorStyle,Te.smallEmojiDesktopRenderNormalization];break;case d.Size.Medium:i=[Te.onlyEmojiStyleMedium,this._unicodeEmojiColorStyle];break;case d.Size.Large:i=[Te.onlyEmojiStyleLarge,this._unicodeEmojiColorStyle];break;case d.Size.ExtraLarge:i=[Te.onlyEmojiStyleExtraLarge,this._unicodeEmojiColorStyle];break;case d.Size.ExtraExtraLarge:i=[Te.onlyEmojiStyleExtraExtraLarge,this._unicodeEmojiColorStyle]}return{value:r.createElement(r.Text,{key:this._generateReactKey(e),style:i,selectable:this._options.allowTextSelection},e.emojiTextNode.getRawText()),stopProcessing:!1,renderAsInline:!0}}transformEmoticonNode(e){switch(this._options.processing.emoticons){case L.ProcessingLevel.None:return this._skip();case L.ProcessingLevel.Stripped:return this._renderReactNodes(e.children)}const t=ye.default.unescapeXml(e.type),s=e.children[0].getRawText()||"",i=P.trimToFirstLineIfNeeded(s,!!this._options.trimToFirstLine),o=this._useLargeEmoticons();let n,a=[];switch(n=o&&1===this._options.numberOfEmoticons?this._options.singleEmoticonSize||this._options.emoticonsOnlyEmoticonSize||d.Size.ExtraExtraLarge:o?this._options.emoticonsOnlyEmoticonSize||d.Size.ExtraLarge:d.Size.Small,o&&!this._options.allowHugeEmoticons&&(n=d.Size.Large),n){case d.Size.Small:a=[Te.onlyEmojiStyleSmallVerticalAlign];break;case d.Size.Medium:a=[Te.onlyEmoticonsStyleMedium];break;case d.Size.Large:a=[Te.onlyEmoticonsStyleLarge];break;case d.Size.ExtraLarge:a=[Te.onlyEmoticonsStyleExtraLarge];break;case d.Size.ExtraExtraLarge:a=[Te.onlyEmoticonsStyleExtraExtraLarge]}return{value:r.createElement(d.AnimatedEmoticon,{key:this._generateReactKey(e),innerText:i.value,emoticonName:t,size:n,style:a,preventSelectable:!this._options.allowTextSelection,onlyRenderFallbackText:this._options.textOnlyForEmoticons,isStatic:this._options.forceStaticAnimatedEmoticons,allowTextFallback:this._options.allowTextFallbackEmoticons,showPlaceHolder:this._options.showPlaceholderEmoticons,placeholderBackgroundColor:this._options.placeholderBackgroundColor,fallbackTextStyle:!o&&this._options.textOverrideStyle?this._options.textOverrideStyle:void 0,tone:e.tone}),stopProcessing:i.stopProcessing,renderAsInline:i.renderAsInline}}transformFlagNode(e){switch(this._options.processing.emoticons){case L.ProcessingLevel.None:return this._skip();case L.ProcessingLevel.Stripped:return this._renderReactNodes(e.children)}return this._renderReactNodes(e.children)}transformQuoteNode(e){if(this._options.trimToFirstLine&&this._options.onlyQuotedContent){return{value:r.createElement(oe.QuoteOnly,{key:this._generateReactKey(e),mediaPlaceholderIconColor:this._options.mediaPlaceholderIconColor,regularTextStyle:this._options.regularTextStyle,textOverrideStyle:this._options.textOverrideStyle}),stopProcessing:!0,renderAsInline:!0}}switch(this._options.processing.quotes){case L.ProcessingLevel.None:return this._skip();case L.ProcessingLevel.Stripped:return this._renderReactNodes(e.children)}const t=this._options.numberOfLines||(this._options.renderOrigin===L.MessageRenderOrigin.ChatCanvas||this._options.renderOrigin===L.MessageRenderOrigin.CallCanvas?void 0:1),s=n.clone(this._options);s.onlyEmoticons=!1,s.inheritColor=!0,s.numberOfLines=t,s.maxContentSizeMultiplier=this._options.maxContentSizeMultiplier&&Math.min(this._options.maxContentSizeMultiplier,Me._maxContentSizeMultiplierForQuotes),s.allowTextSelection=!1;const i=new Me(s,this._root,this._searchStore)._renderReactNodes(e.children),o=e.author&&ye.default.unescapeXml(e.author),a=e.authorname&&ye.default.unescapeXml(e.authorname);return{value:r.createElement(oe.QuoteNode,{key:this._generateReactKey(e),children:i.value,options:this._options,conversationId:e.conversation,messageTimestamp:Number(e.messageid),numberOfLines:t||0,authorSkypeId:o,authorname:a,timestamp:1e3*e.timestamp,message:this._options.message,onContextMenu:this._options.onContextMenu,searchStore:this._searchStore}),stopProcessing:i.stopProcessing,renderAsInline:!1}}transformWikiMarkupNode(e){switch(this._options.processing.wikiMarkup){case L.ProcessingLevel.None:return this._skip();case L.ProcessingLevel.Stripped:return this._renderReactNodes(e.children)}let t;switch(e.getTag()){case"i":t=this._options.italicTextStyle;break;case"b":t=this._options.boldTextStyle;break;case"s":t=this._options.strikeThroughStyle;break;case"pre":t=this._options.preTextStyle;break;default:t=this._options.regularTextStyle}const s=n.every(e.children,(e=>e instanceof Q.PlainTextNode)),i=n.flatten(n.compact([this._options.textOverrideStyle,t])),o=n.clone(this._options);o.textOverrideStyle=i;const a=new Me(o,this._root,this._searchStore)._renderReactNodes(e.children,s),l={style:i,key:this._generateReactKey(e),selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0};return{value:a.renderAsInline?r.createElement(r.Text,Object.assign({},l,{selectable:this._options.allowTextSelection}),a.value):r.createElement(r.View,Object.assign({},l),a.value),stopProcessing:a.stopProcessing,renderAsInline:a.renderAsInline}}transformLinkNode(e){switch(this._options.processing.links){case L.ProcessingLevel.None:return this._skip();case L.ProcessingLevel.Stripped:return this._renderReactNodes(e.children)}const t=e.getSanitizedHref();if(!t)return this._renderReactNodes(e.children);this._useInheritedStyle=!0;const s=n.flatten(n.compact([this._options.textOverrideStyle,me.default.pointerCursor])),i=n.clone(this._options);i.onSelectableText=void 0,i.textOverrideStyle=s;const o=new Me(i,this._root,this._searchStore)._renderReactNodes(e.children,!1);this._useInheritedStyle=!1;return{value:r.createElement(W.default,{key:this._generateReactKey(e),message:this._options.message,decodedNode:this._root,style:n.compact([this._options.linkStyle,this._options.textOverrideStyle]),url:t,messageActions:this._options.messageActions,linkSelectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,supportsCopy:!!this._options.supportsCopy,onLongPress:this._options.overrideLongPressForLinks?this._options.onLongPressContent:void 0,onEdit:this._options.onEdit,onQuote:this._options.onQuote,maxContentSizeMultiplier:this._options.maxContentSizeMultiplier,renderOrigin:this._options.renderOrigin,onPressInterceptionCallback:this._options.onPressInterceptionCallback},o.value),stopProcessing:o.stopProcessing,renderAsInline:!0}}transformEmoteNode(e){const t=this._renderReactNodes(e.children,!0);return{value:[this._formatAsDisplayName(ye.default.unescapeXml(e.escapedAuthorMri),ye.default.unescapeXml(e.escapedFallbackText)),r.createElement(r.Text,{key:e.escapedAuthorMri||e.escapedFallbackText,style:n.compact([this._options.regularTextStyle,this._options.textOverrideStyle]),selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,maxContentSizeMultiplier:this._options.maxContentSizeMultiplier}," ")].concat(t.value),stopProcessing:t.stopProcessing,renderAsInline:!0}}transformSuggestedTextHighlightNode(e){const t=this._renderReactNodes(e.children,!0);return{value:r.createElement(le.default,{key:this._generateReactKey(e),style:n.compact([this._options.regularTextStyle,this._options.linkStyle,this._options.textOverrideStyle]),activityId:e.getActivityId(),text:e.getPhrase(),selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,onHighlightedTextPressed:this._options.onPressSuggestedTextHighlight},t.value),stopProcessing:!1,renderAsInline:!0}}transformContextNode(e){return{value:null,stopProcessing:!1,renderAsInline:!0}}transformSwiftUriObjectNode(e){if(this._options.renderMedia&&e.swiftChild)return this._renderReactNodes([e.swiftChild]);return{value:r.createElement(ce.default,{key:this._generateReactKey(e),creatorMri:this._options.message.creator,message:this._options.message,mediaPlaceholderIconColor:this._options.mediaPlaceholderIconColor,regularTextStyle:this._options.regularTextStyle,textOverrideStyle:this._options.textOverrideStyle}),stopProcessing:!1,renderAsInline:!0}}transformSwiftNode(e){const t={preview:{renderPreview:!this._options.renderMedia,numberOfLines:1,stylesOverride:this._options.textOverrideStyle,isTextSelectable:!1},message:this._options.message,isInKeyboard:this._options.isInKeyboard,leftPaddingSwiftCarousel:this._options.leftPaddingSwiftCarousel,isMobileScreenSize:this._options.isMobileScreenSize,textOverrideStyle:this._options.textOverrideStyle,renderText:(e,t)=>this._renderArbitraryText(e,t),renderReact:(e,t)=>this._renderTextNode(e,t),onSelectionPress:this._options.onSwiftCardSelectionPress,onReplyActionLink:this._options.onSwiftReplyActionLink,onSkypeUriActionLink:this._options.onSwiftSkypeUriActionLink,swiftCardState:this._options.swiftCardState,onOAuthActionLink:this._options.onOAuthActionLink,onDisableScroll:this._options.onDisableScroll,onLongPress:this._options.onLongPressContent,onContextMenu:this._options.onContextMenu,onContentHorizontalScroll:this._options.onContentHorizontalScroll,renderOrigin:this._options.renderOrigin,availableSpace:this._options.availableSpace};return{value:r.createElement(de.default,{key:this._generateReactKey(e),swiftMessage:e.swiftMessage,options:t,postedByCurrentUser:!this._options.message||!this._options.message.creator||Z.default.isMyMri(this._options.message.creator),conversationId:e.conversationId,message:this._options.message}),stopProcessing:!1,renderAsInline:!1}}transformScheduledCallInviteNode(e){if(!n.isUndefined(e.canceledTimeMs))return this._skip();return{value:r.createElement(ne.default,{key:this._generateReactKey(e),scheduledCallId:e.scheduledCallId,isSender:e.isSender,options:this._options}),stopProcessing:!1,renderAsInline:!1}}transformAdaptiveCardNode(e){const t={cardMaxWidth:$.adaptiveCardMessageMaxWidth,cardMaxHeight:$.adaptiveCardMessageMaxHeight,fixedAspectRatio:$.adaptiveCardMessageFixedAspectRatio,leftPaddingCarousel:this._options.leftPaddingSwiftCarousel,onContentHorizontalScroll:this._options.onContentHorizontalScroll};return{value:r.createElement(he.default,{adaptiveCardMessage:e.adaptiveCardMessage,conversationId:e.conversationId,message:this._options.message,renderOptions:t,postedByCurrentUser:!this._options.message||!this._options.message.creator||Z.default.isMyMri(this._options.message.creator),onExecuteAdaptiveCardAction:this._onExecuteAdaptiveCardAction,placeholderLoadingEnabled:!0}),stopProcessing:!1,renderAsInline:!1}}transformContactNode(e){return{value:r.createElement(I.default,{tree:e,selectable:this._options.allowTextSelection,message:this._options.message,renderDimensions:this._options.constrainedDimensions||E.ContactNodeSizes.Regular,onPress:this._options.onPress,onLongPress:this._options.onLongPressContent,onContextMenu:this._options.onContextMenu}),stopProcessing:!1,renderAsInline:!1}}transformContactsNode(e){if(this._options.trimToFirstLine){const t=j.getString("ContentToReactTransformer.ContactCardIconPreviewLabel");return{value:this._getContentPlaceholderResult(e,ge.SkypeIcon.ContactCard,t),stopProcessing:!0,renderAsInline:!0}}const t=this._renderReactNodes(e.children,!0);return{value:r.createElement(r.View,{key:"contact-list"},t.value),stopProcessing:t.stopProcessing,renderAsInline:!1}}transformFileNode(e){return{value:r.createElement(r.Text,{key:this._generateReactKey(e),style:n.compact([this._options.systemTextStyle,this._options.textOverrideStyle]),selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0},e.nameChild.getRawText()),stopProcessing:!1,renderAsInline:!0}}transformFilesNode(e){const[t]=this._renderStringParts([j.getString("ContentToDisplayTransformerBase.FilesReceivedNotSupported")],e);if(this._options.trimToFirstLine)return{value:t,stopProcessing:!0,renderAsInline:!0};const s=this._renderLineBreak(e).value,i=this._renderReactNodes(e.children,!0);return{value:[t,s,r.createElement(r.Text,{key:this._generateReactKey(e),style:this._options.textOverrideStyle,numberOfLines:this._options.numberOfLines||0},this._renderLineBreakBetweenElements(i).value)],stopProcessing:i.stopProcessing,renderAsInline:!0}}transformSmsNode(e){const t=N.convertRawTextToInputEntities(e.smsContentUnescaped,!1,!1),s=N.decodeFromInput(t,!1,!1,!1);let i=Object.assign(Object.assign({},this._options),{onlyEmoticons:s.hasOnlyEmoticonsOrWhitespaceText(),numberOfEmoticons:s.getNumberOfEmoticons(),onlyQuotedContent:s.hasOnlyQuotedContent()});return new Me(i,this._root,this._searchStore)._renderReactNodes(s.children)}transformCallerIDNode(e){return{value:r.createElement(f.default,{layoutOption:e.layoutOption}),stopProcessing:!0,renderAsInline:!1}}transformMmsNode(e){return this._renderReactNodes(e.contentNodes)}transformMojiNode(e){const t=e.getSourceUrlSanitized();let s,i=!1;return this._options.renderMedia?s=r.createElement(Y.default,{key:this._generateReactKey(e),src:t,borderColor:this._options.mojiBackgroundColor||ue.Color.white,size:this._options.mojiProps.size,metadataPosition:this._options.mojiProps.metadataAlign,hideMetadata:this._options.mojiProps.hideMetadata,onLongPress:this._options.onLongPressContent,onContextMenu:this._options.onContextMenu,message:this._options.message,disableActions:this._options.disableActions,activeOpacityOverride:this._options.activeOpacityOverride}):(s=this._getContentPlaceholderResult(e,ge.SkypeIcon.Moji,j.getString("ContentToReactTransformer.MojiMediaIconPreviewLabel")),i=!1),{value:s,stopProcessing:!1,renderAsInline:i}}transformStickerNode(e){const t=e.getSourceUrlSanitized();let s;return s=this._options.renderMedia?r.createElement(re.default,{key:this._generateReactKey(e),src:t,showPlaceholder:!0,dimension:te.frameHeights.stickers.Size75,name:e.getNameForUI()}):this._getContentPlaceholderResult(e,ge.SkypeIcon.Sticker,j.getString("ContentToReactTransformer.StickerMediaIconPreviewLabel")),{value:s,stopProcessing:!1,renderAsInline:!1}}transformLocationNode(e){let t,s=!1;if(!this._options.renderLocation)return this._renderReactNodes(e.children);{const i=e.addressSanitized,o=!this._options.message.isForwarded()&&e.isUserLocation,n=e.userMri||this._options.message.creator;this._options.renderMedia?t=r.createElement(G.default,{key:this._generateReactKey(e),message:this._options.message,originalCreatorMri:n,isUserLocation:o,latitude:e.latitude,longitude:e.longitude,fullAddress:i,addressFriendlyName:e.addressFriendlyNameSanitized,shortAddress:e.shortAddressSanitized,bingMapsUrl:e.bingUrl,onLongPress:this._options.onLongPressContent,onContextMenu:this._options.onContextMenu,disableActions:this._options.disableActions,activeOpacityOverride:this._options.activeOpacityOverride}):(t=r.createElement(K.default,{key:this._generateReactKey(e),conversationId:this._options.message.conversationId,isUserLocation:o,address:i,authorMri:n,mediaPlaceholderIconColor:this._options.mediaPlaceholderIconColor,regularTextStyle:this._options.regularTextStyle,textOverrideStyle:this._options.textOverrideStyle}),s=!0)}return{value:t,stopProcessing:!1,renderAsInline:s}}transformTranslationNode(e){return this._renderReactNodes([e.contentNode])}transformDataNode(e){if(e.type===J.DataMessageContentType.TranslationSettings){const t=P.getTranslationActionString(e.content);return{value:r.createElement(r.Text,{key:this._generateReactKey(e),style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0},t),stopProcessing:!1,renderAsInline:!0,forceDirection:!0}}return this._renderReactNodes(e.children)}transformUriObjectFileNode(e){let t;const s=e.getNameForUI();let i=!1;if(this._options.renderMedia)t=r.createElement(O.default,{message:this._options.message,key:this._generateReactKey(e,this._options.message.cuid),contentUrl:e.getFileContentUrlSanitized(),displayFilename:s,downloadFilename:e.getNameForDownload(),mediaPlaceholderIconColor:this._options.mediaPlaceholderIconColor,fileSizeInBytes:e.getSizeInBytes(),onLongPress:this._options.onLongPressContent,onContextMenu:this._options.onContextMenu,renderOrigin:this._options.renderOrigin,renderDimensions:this._options.constrainedDimensions||E.UndefinedDimensions,authorMri:this._options.message.creator,isUserInformationShown:this._options.showUserName||this._options.showTimestamp,disableActions:this._options.disableActions,activeOpacityOverride:this._options.activeOpacityOverride,allowTextSelection:this._options.allowTextSelection,isFileAvailable:b.isFileAvailable(this._options.message.createdTime),isDraggingEnabled:this._options.isDraggingEnabled,searchStore:this._searchStore});else{const o=x.FileIconHelper.getIconFromFileType(s);t=this._getContentPlaceholderResult(e,o.icon,s||j.getString("ContentToReactTransformer.FileMediaIconPreviewLabel"),this._options.mediaPlaceholderIconColor?void 0:o.iconColor),i=!0}return{value:t,stopProcessing:!1,renderAsInline:i}}transformPictureNode(e){let t,s=!1;return this._options.renderMedia?t=r.createElement(se.default,{key:this._generateReactKey(e),thumbnailUrl:e.getDisplayThumbnailUrlSanitized(this._options.blurMedia),showDownloadIcon:this._options.blurMedia,contentUrl:e.getDisplayUrlSanitized(),fileName:e.getNameForDownload(),renderOrigin:this._options.renderOrigin,fileSizeInBytes:e.getSizeInBytes(),renderDimensions:this._options.constrainedDimensions||E.UndefinedDimensions,hideSendingIndicator:this._options.hideSendingIndicators,authorMri:this._options.message.creator,containerRadiusStyles:this._options.containerRadiusStyle,onPress:this._options.onPress,onLongPress:this._options.onLongPressContent,onContextMenu:this._options.onContextMenu,onMountContent:this._options.onMountContent,onShowContent:this._options.onShowContent,onHideContent:this._options.onHideContent,onThumbnailLoaded:this._options.onThumbnailLoaded,activeOpacityOverride:this._options.activeOpacityOverride,disableActions:this._options.disableActions,isMessageInSendingState:this._options.isMessageInSendingState,isDraggingEnabled:this._options.isDraggingEnabled,message:this._options.message,isRetryCommandSupported:this._options.isRetryCommandSupported}):(t=this._getContentPlaceholderResult(e,ge.SkypeIcon.Picture,j.getString("ContentToReactTransformer.PhotoMediaIconPreviewLabel")),s=!1),{value:t,stopProcessing:!1,renderAsInline:s}}transformVideoNode(e){let t,s=!1;return this._options.renderMedia?t=r.createElement(_e.default,{key:this._generateReactKey(e),thumbnailUrl:e.getDisplayThumbnailUrlSanitized(this._options.blurMedia),contentUrl:e.getDisplayUrlSanitized(),fileSizeInBytes:e.getSizeInBytes(),renderDimensions:this._options.constrainedDimensions||E.UndefinedDimensions,authorMri:this._options.message.creator,containerRadiusStyles:this._options.containerRadiusStyle,onPress:this._options.onPress,onLongPress:this._options.onLongPressContent,onContextMenu:this._options.onContextMenu,onMountContent:this._options.onMountContent,onShowContent:this._options.onShowContent,onHideContent:this._options.onHideContent,activeOpacityOverride:this._options.activeOpacityOverride,disableActions:this._options.disableActions,renderOrigin:this._options.renderOrigin,subType:e.getSubType(),isMessageInSendingState:this._options.isMessageInSendingState,message:this._options.message,isDraggingEnabled:this._options.isDraggingEnabled,isRetryCommandSupported:this._options.isRetryCommandSupported}):(t=this._getContentPlaceholderResult(e,ge.SkypeIcon.Video,j.getString("ContentToReactTransformer.VideoMediaIconPreviewLabel")),s=!0),{value:t,stopProcessing:!1,renderAsInline:s}}transformVideoMessageNode(e){let t,s=!1;if(this._options.renderMedia)t=r.createElement(_e.default,{key:this._generateReactKey(e),thumbnailUrl:e.getDisplayThumbnailUrlSanitized(this._options.blurMedia),contentUrl:e.getDisplayUrlSanitized(),fileSizeInBytes:e.getSizeInBytes(),renderDimensions:this._options.constrainedDimensions||E.UndefinedDimensions,authorMri:this._options.message.creator,containerRadiusStyles:this._options.containerRadiusStyle,renderOrigin:this._options.renderOrigin,onPress:this._options.onPress,onLongPress:this._options.onLongPressContent,onContextMenu:this._options.onContextMenu,onMountContent:this._options.onMountContent,onShowContent:this._options.onShowContent,onHideContent:this._options.onHideContent,disableActions:this._options.disableActions,subType:e.getSubType(),isMessageInSendingState:this._options.isMessageInSendingState,message:this._options.message,isDraggingEnabled:this._options.isDraggingEnabled});else{const i=c.default.getS4LMessagingFeaturesNoSubscription().useNewVideoMessageIcon?ge.SkypeIcon.MessageVideo:ge.SkypeIcon.Videomail;t=this._getContentPlaceholderResult(e,i,j.getString("ContentToReactTransformer.VideoMessageMediaIconPreviewLabel")),s=!0}return{value:t,stopProcessing:!1,renderAsInline:s}}transformAudioNode(e){let t,s=!1;return this._options.renderMedia?t=r.createElement(p.default,{key:this._generateReactKey(e),authorMri:this._options.message.creator,contentUrl:e.getDisplayUrlSanitized(),contentExtension:ve.default.extractFileExtension(e.getNameForDownload()),displayFilename:e.getNameForUI(),fileSizeInBytes:e.getSizeInBytes(),message:this._options.message,onContextMenu:this._options.onContextMenu,onLongPress:this._options.onLongPressContent}):(t=this._getContentPlaceholderResult(e,ge.SkypeIcon.VolumeMid,j.getString("ContentToReactTransformer.AudioFileMediaIconPreviewLabel")),s=!0),{value:t,stopProcessing:!1,renderAsInline:s}}transformAudioMessageNode(e){let t,s=!1;return this._options.renderMedia?t=r.createElement(u.default,{key:this._generateReactKey(e),authorMri:this._options.message.creator,contentUrl:e.getDisplayUrlSanitized(),contentExtension:ve.default.extractFileExtension(e.getNameForDownload()),displayFilename:e.getNameForUI(),fileSizeInBytes:e.getSizeInBytes(),audioMessageDurationMs:e.getAudioDurationMs(),message:this._options.message,onLongPress:this._options.onLongPressContent}):(t=this._getContentPlaceholderResult(e,ge.SkypeIcon.Microphone,j.getString("ContentToReactTransformer.AudioMessageMediaIconPreviewLabel")),s=!0),{value:t,stopProcessing:!1,renderAsInline:s}}_getContentPlaceholderResult(e,t,s,i){return r.createElement(w.ContentPlaceholder,{key:this._generateReactKey(e,this._options.message.cuid),icon:t,label:s,iconColorOverride:i,mediaPlaceholderIconColor:this._options.mediaPlaceholderIconColor,regularTextStyle:this._options.regularTextStyle,textOverrideStyle:this._options.textOverrideStyle})}_getThreadActivityParts(e,t=[]){const{authorMri:s,personMris:i}=P.getThreadActivityMemberParts(e.initiator,t);return{authorReact:this._formatAsDisplayName(s),personsReact:this._formatListAsDisplayNames(i),authorMri:s}}transformAddMemberNode(e){const t=e.content,{authorReact:s,personsReact:i,authorMri:o}=this._getThreadActivityParts(e,t),n=P.getAddMemberLocalizeInfo(s,i,i.length>0);let a=[this._renderStringWithGender(n,o,e)];if(i.length>0){const t=this._renderLineBreak(e);if(!t.stopProcessing){const s=r.createElement(g.BotDisclosure,{key:this._generateReactKey(e),targets:e.content,conversationId:e.conversationId,prependValue:t.value,renderBotName:this._formatParticipantName,renderAtMentionBotName:this._formatAtMentionParticipantName,renderStringParts:this._renderStringParts,textOverrideStyle:this._options.textOverrideStyle,allowTextSelection:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines});a.push(s)}}const l=this._renderStringParts(a,e);return{value:r.createElement(r.Text,{key:this._appendUniqueKeyValue("add"),style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0},l),stopProcessing:!1,renderAsInline:!0,forceDirection:!0}}transformDeleteMemberNode(e){const t=e.content,{authorReact:s,personsReact:i,authorMri:o}=this._getThreadActivityParts(e,t),n=T.isThread(o)?void 0:s,a=P.getDeleteMemberNodeLocalizeInfo(n,i,i.length>0),l=[this._renderStringWithGender(a,o,e)];return{value:r.createElement(r.Text,{key:this._appendUniqueKeyValue("delete"),style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0},l),stopProcessing:!1,renderAsInline:!0,forceDirection:!0}}transformRoleUpdateNode(e){const t=[e.content[0]],{authorReact:s,personsReact:i,authorMri:o}=this._getThreadActivityParts(e,t),n=e.content[0].roleChild.getRawText(),a=P.getRoleUpdateNodeLocalizeInfo(s,i,n),l=[this._renderStringWithGender(a,o,e)];return{value:r.createElement(r.Text,{key:this._appendUniqueKeyValue("update"),style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0},l),stopProcessing:!1,renderAsInline:!0,forceDirection:!0}}transformTopicUpdateNode(e){const{authorReact:t,authorMri:s}=this._getThreadActivityParts(e),i=e.content.getRawText(),o=A.decodeFromContent(i),n=new Me(this._options,this._root,this._searchStore).transform(o).value,a=P.getTopicUpdateNodeLocalizeInfo(t,n),l=[this._renderStringWithGender(a,s,e)];return{value:r.createElement(r.Text,{key:this._appendUniqueKeyValue("topic"),style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0},l),stopProcessing:!1,renderAsInline:!0,forceDirection:!0}}transformHandshakeInviteNode(e){const{authorReact:t,personsReact:s,authorMri:i}=this._getThreadActivityParts(e,e.content),o=Z.default.isMyMri(e.initiator.getRawText()),n=P.getHandshakeInviteNodeLocalizedInfo(o?s[0]:t,o),a=[this._renderStringWithGender(n,i,e)];return{value:r.createElement(r.Text,{key:this._appendUniqueKeyValue("e2eeinvite"),style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0},a),stopProcessing:!1,renderAsInline:!0,forceDirection:!0}}transformHandshakeAcceptNode(e){const{authorReact:t,personsReact:s,authorMri:i}=this._getThreadActivityParts(e,e.content),o=Z.default.isMyMri(e.initiator.getRawText()),n=P.getHandshakeAcceptNodeLocalizedInfo(o?s[0]:t,o),a=[this._renderStringWithGender(n,i,e)];return{value:r.createElement(r.Text,{key:this._appendUniqueKeyValue("e2eeaccept"),style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0},a),stopProcessing:!1,renderAsInline:!0,forceDirection:!0}}transformHandshakeCompleteNode(){return{value:r.createElement(r.Text,{key:this._appendUniqueKeyValue("e2eecomplete"),style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0},j.getString("ContentToDisplayTransformerBase.E2eeInvitationConfirmed")),stopProcessing:!1,renderAsInline:!0}}transformHandshakeRejectNode(){return{value:r.createElement(r.Text,{key:this._appendUniqueKeyValue("e2eereject"),style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0},j.getString("ContentToDisplayTransformerBase.E2eeInvitationRejected")),stopProcessing:!1,renderAsInline:!0}}transformPictureUpdateNode(e){const{authorReact:t,authorMri:s}=this._getThreadActivityParts(e),i=P.getPictureUpdateNodeLocalizeInfo(t),o=[this._renderStringWithGender(i,s,e)];return{value:r.createElement(r.Text,{key:this._appendUniqueKeyValue("picture"),style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0},o),stopProcessing:!1,renderAsInline:!0}}transformHistoryDisclosedUpdateNode(e){const{authorReact:t,authorMri:s}=this._getThreadActivityParts(e),i=P.getHistoryDisclosedUpdateLocalizeInfo(t,e.nowDisclosed),o=[this._renderStringWithGender(i,s,e)];return{value:r.createElement(r.Text,{key:this._appendUniqueKeyValue("history"),style:[this._options.textOverrideStyle,Te.horizontalPadding],selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0},o),stopProcessing:!1,renderAsInline:!0,forceDirection:!0}}transformJoiningEnabledUpdateNode(e){const{authorReact:t,authorMri:s}=this._getThreadActivityParts(e),i=P.getJoiningEnabledUpdateNodeLocalizeInfo(t,e.nowEnabled),o=[this._renderStringWithGender(i,s,e)];return{value:r.createElement(r.Text,{key:this._appendUniqueKeyValue("join"),style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0},o),stopProcessing:!1,renderAsInline:!0,forceDirection:!0}}transformLegacyMemberAddedNode(e){const{authorReact:t,authorMri:s}=this._getThreadActivityParts(e),i=this.transformLinkNode(e.link),o=P.getLegacyMemberAddedNodeLocalizeInfo(t,i.value),n=[this._renderStringWithGender(o,s,e)];return{value:r.createElement(r.Text,{key:this._appendUniqueKeyValue("add"),style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0},n),stopProcessing:i.stopProcessing,renderAsInline:!0,forceDirection:!0}}transformLegacyMemberUpgradedNode(e){const{authorReact:t,authorMri:s}=this._getThreadActivityParts(e),i=P.getLegacyMemberUpgradedNodeLocalizeInfo(t),o=[this._renderStringWithGender(i,s,e)];return{value:r.createElement(r.Text,{key:this._appendUniqueKeyValue("upgrade"),style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0},o),stopProcessing:!1,renderAsInline:!0,forceDirection:!0}}transformPartListNode(e){let t=!1;const s=v.default.calculateCallMarkerInfo(e),i=this._options.message.conversationId;let o;if(this._options.renderMedia){let t=!!this._options.message.properties&&this._options.message.properties.messagesSentDuringCall;o=r.createElement(y.default,{key:this._generateReactKey(e),callId:s.callId,duration:s.duration,markerType:s.type,timestamp:this._options.message.createdTime,messagesSentDuringCall:t,conversationId:i,callerMri:this._options.message.creator,style:this._options.callMarkerStyle})}else t=!0,o=r.createElement(_.CallMarkerPreview,{key:this._generateReactKey(e),callId:s.callId,duration:s.duration,markerType:s.type,conversationId:i,mediaPlaceholderIconColor:this._options.mediaPlaceholderIconColor,regularTextStyle:this._options.regularTextStyle,textOverrideStyle:this._options.textOverrideStyle});return{value:o,stopProcessing:!1,renderAsInline:t}}transformCallInfoUriObjectNode(e){let t;const s=this._options.message.creator,i="Call"===e.containerType,o=i?ge.SkypeIcon.CallStart:ge.SkypeIcon.CallQualityIndicator,n=i?j.getString("CallCard.CallStartedStatusMessage"):e.label;let a=!1;if(this._options.renderMedia){const i=this._options.message.isMessageLie()&&!this._options.message.isEphemeral();t=r.createElement(r.Button,{onPress:this._options.onPress},r.createElement(m.default,{callId:e.callId,cardType:S.CallCardType.Cast,conversationId:e.threadId,creatorMri:s,createdTime:this._options.message.createdTime,messageText:n,iconText:o,locationName:e.locationName,isPSTN:!1,isSending:i,containerRadiusStyles:this._options.containerRadiusStyle}))}else t=this._getContentPlaceholderResult(e,o,n),a=!0;return{value:t,stopProcessing:!1,renderAsInline:a}}transformNgcUpgradeNode(e){return{value:r.createElement(ee.NgcUpgradeSystemMessageNode,{userMrisOrNames:e.userMrisOrNames,systemTextStyle:this._options.systemTextStyle,textOverrideStyle:this._options.textOverrideStyle,numberOfLines:this._options.numberOfLines}),stopProcessing:!1,renderAsInline:!0}}transformPollNode(e){let t;return t=c.default.getS4LMessagingFeatures().enablePollExtension&&this._options.renderMedia?r.createElement(ie.default,{key:this._generateReactKey(e),conversationId:this._options.message.conversationId,message:this._options.message,title:ye.default.unescapeXml(e.title),expirationTimeMs:e.expirationTimeMs,options:e.options,allowMultipleVotes:e.allowMultipleVotes}):this._getContentPlaceholderResult(e,ge.SkypeIcon.Poll,j.getString("Poll.PlaceholderText")),{value:t,stopProcessing:!1,renderAsInline:!1}}transformMediaAlbumNode(e){let t=null;return this._options.linkedMessages.length>1&&(t=r.createElement(q.MediaAlbumNode,{key:this._generateReactKey(e),linkedMessages:this._options.linkedMessages,albumId:this._options.message.getAlbumId(),onPress:this._options.onPress,onLongPress:this._options.onLongPressContent,onContextMenu:this._options.onContextMenu,containerRadiusStyles:this._options.containerRadiusStyle})),{value:t,stopProcessing:!1,renderAsInline:!1}}transformHtmlNode(e){let t;if(n.isUndefined(this._options.numberOfLines)&&this._options.renderMedia){let s=null;const i=this._renderReactNodes(e.children,!0);return i.value&&(s=r.createElement(r.Text,{style:[this._options.textOverrideStyle,e.isQuote()?this._options.quotedTextStyle:void 0]},i.value)),t=[r.createElement(V.HtmlNode,{key:this._generateReactKey(e),tree:e,message:this._options.message,options:this._options,renderDimensions:this._options.constrainedDimensions||E.UndefinedDimensions,createChildReact:(e,t)=>new Me(t,this._root)._renderReactNodes(e)}),s],{value:t,stopProcessing:i.stopProcessing,renderAsInline:!1}}{let s=k.renderText(e);return s?(1===this._options.numberOfLines&&(s=n.split(s,"\n")[0]),t=V.HtmlNode.highlightText(e,this._options.message,s)||this._renderStringParts([s],e)):t=o.DomUtils.findOne((e=>"img"===e.name),e.getHtmlDom())?this._getContentPlaceholderResult(e,ge.SkypeIcon.Picture,j.getString("ContentToReactTransformer.PhotoMediaIconPreviewLabel")):"",{value:t,stopProcessing:!1,renderAsInline:!0}}}transformGuestNameUpdateNode(e){var t;const s=null===(t=n.first(e.content))||void 0===t?void 0:t.encodedAttr(),i=null==s?void 0:s.newName,o=null==s?void 0:s.oldName;return{value:i&&o?r.createElement(r.Text,{key:this._appendUniqueKeyValue("guestNameUpdate"),style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0},j.getString("ContentToDisplayTransformerBase.GuestNameUpdate",{oldName:o,newName:i})):null,stopProcessing:!1,renderAsInline:!0}}_renderStringWithGender(e,t,s){return r.createElement(D.GenderLocalizedMessage,{key:this._appendUniqueKeyValue("localizedMessage"),mri:t,localizeKey:e.key,localizeParams:e.params,tree:s,renderMessage:this._renderMessageParts})}}Me._defaultOptions={},Me._maxContentSizeMultiplierForQuotes=2;let Ie=class{renderReact(e,t={},s){try{const i=n.defaults(t,{onlyEmoticons:e.hasOnlyEmoticonsOrWhitespaceText(),onlyUnicodeEmoji:e.hasOnlyUnicodeEmoji(),numberOfEmoticons:e.getNumberOfEmoticons(),numberOfUnicodeEmoji:e.getNumberOfUnicodeEmoji(),onlyQuotedContent:e.hasOnlyQuotedContent()}),o=new Me(i,e,s);return o.transform(e)}catch(e){U.error(F.LogTraceArea.GenericUnsafe,"ContentToReactTransformer: Failed to transform tree: "+ae.default.errorAsString(e))}return{value:null,renderAsInline:!1,stopProcessing:!1}}renderLinkAsPreview(e){return{renderAsInline:!1,stopProcessing:!0,value:r.createElement(Se.default,{key:"urlpreview",obfuscate:e.obfuscateUrlPreview,urlPreviewData:e.urlPreviewData,urlPreviewOnly:e.urlPreviewOnly,thumbnailRadiusStyle:e.urlPreviewThumbnailRadiusStyle,style:e.containerRadiusStyle,message:e.message,onLongPress:e.onLongPressContent,renderOrigin:e.renderOrigin,activeOpacityOverride:e.activeOpacityOverride,disableActions:e.disableActions,onContextMenu:e.onContextMenu,renderDimensions:e.constrainedDimensions,searchStore:e.searchStore})}}};(0,i.__decorate)([l.disableWarnings],Ie.prototype,"renderReact",null),(0,i.__decorate)([l.disableWarnings],Ie.prototype,"renderLinkAsPreview",null),Ie=(0,i.__decorate)([l.AutoSubscribeStore],Ie);const we=new Ie;t.renderReact=we.renderReact,t.renderLinkAsPreview=we.renderLinkAsPreview},960:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.highlightSearchResults=t.createQueryRegex=t.transformToHighlightedText=t.transformToHighlighted=t.SearchTermHighlightingTransformer=void 0;const i=s(96486),o=s(16778),n=s(81169),r=s(46096),a=s(5406),l=s(36237),d=s(12762),c=s(4057),h=/^\b$/;class u{constructor(e){this._options=e,this.transformRootNode=this._default,this.transformHighlightedNode=i.identity,this.transformUnknownNode=i.identity,this.transformEditMessageMetaDataNode=i.identity,this.transformUserMriNode=i.identity,this.transformFlagNode=i.identity,this.transformLegacyQuoteNode=i.identity,this.transformEmoteNode=i.identity,this.transformContextNode=i.identity,this.transformTextWrapperNode=i.identity,this.transformTargetUserNode=i.identity,this.transformTargetLegacyUserNode=i.identity,this.transformTargetRoleNode=i.identity,this.transformTargetsNode=i.identity,this.transformContactNode=i.identity,this.transformContactsNode=i.identity,this.transformFileNode=i.identity,this.transformFilesNode=i.identity,this.transformSmsNode=i.identity,this.transformMmsNode=i.identity,this.transformLocationNode=i.identity,this.transformMetaNode=i.identity,this.transformUriObjectNode=i.identity,this.transformUriObjectFileNode=i.identity,this.transformPictureNode=i.identity,this.transformVideoNode=i.identity,this.transformVideoMessageNode=i.identity,this.transformAudioNode=i.identity,this.transformAudioMessageNode=i.identity,this.transformCallInfoUriObjectNode=i.identity,this.transformMojiNode=i.identity,this.transformStickerNode=i.identity,this.transformSkypeVideoMessageNode=i.identity,this.transformAddMemberNode=i.identity,this.transformDeleteMemberNode=i.identity,this.transformRoleUpdateNode=i.identity,this.transformTopicUpdateNode=i.identity,this.transformHandshakeInviteNode=i.identity,this.transformHandshakeAcceptNode=i.identity,this.transformHandshakeCompleteNode=i.identity,this.transformHandshakeRejectNode=i.identity,this.transformPictureUpdateNode=i.identity,this.transformHistoryDisclosedUpdateNode=i.identity,this.transformJoiningEnabledUpdateNode=i.identity,this.transformLegacyMemberAddedNode=i.identity,this.transformLegacyMemberUpgradedNode=i.identity,this.transformPartNode=i.identity,this.transformPartListNode=i.identity,this.transformEndedNode=i.identity,this.transformSwiftUriObjectNode=i.identity,this.transformSwiftNode=i.identity,this.transformAdaptiveCardNode=i.identity,this.transformScheduledCallInviteNode=i.identity,this.transformNgcUpgradeNode=i.identity,this.transformSuggestedTextHighlightNode=i.identity,this.transformPollNode=i.identity,this.transformCallerIDNode=i.identity,this.transformMediaAlbumNode=i.identity,this.transformTranslationNode=i.identity,this.transformDataNode=i.identity,this.transformGuestNameUpdateNode=i.identity,this.transformGuestNameUpdateTargetNode=i.identity,this._keywords=g(this._options.query),this._queryRegex=m(this._keywords)}_default(e){const t=(0,n.chain)(e.children,(0,n.map)((e=>{const t=e&&e.accept(this);return t instanceof d.RootNode?i.compact(t.children):t})),(0,n.compact)(),(0,n.flatten)());return e.cloneWithChildren(t)}_parseChildren(e){return(0,n.chain)(e.children,(0,n.map)((e=>{if(!e)return[];const t=this.transform(e);return t instanceof d.RootNode?i.compact(t.children):[t]})),(0,n.flatten)())}transform(e){return 0===this._keywords.length?e:e.accept(this)}transformPlainTextNode(e){const t=e.getRawText(),s=this._parseText(t);if(1===s.length)return s[0];return d.RootNode.parse(s)}_parseText(e){return S(e,this._queryRegex,(e=>d.HighlightedNode.fromPlainText(e,this._options.isPrimarySearchResult,this._options.isOwnMessage)),(e=>d.PlainTextNode.fromPlainText(e)))}transformAtMentionNode(e){return d.AtMentionNode.parse(this._parseChildren(e),e.encodedAttr())}transformEmoticonNode(e){const t=e.type.toLocaleLowerCase();return i.includes(this._keywords,t)?d.HighlightedNode.parse([e],this._options.isPrimarySearchResult,this._options.isOwnMessage):e}transformUnicodeEmojiNode(e){return e.emojiTextNode}transformQuoteNode(e){return d.QuoteNode.parse(this._parseChildren(e),e.encodedAttr(),e.getTag(),void 0)}transformWikiMarkupNode(e){return d.WikiMarkupNode.parse(this._parseChildren(e),e.encodedAttr(),e.getTag())}transformLinkNode(e){return d.LinkNode.parse(this._parseChildren(e),e.encodedAttr())}transformHtmlNode(e){return e.cloneAsSearchResult(this._options.query,this._options.isPrimarySearchResult)}}let p;t.SearchTermHighlightingTransformer=u;function g(e){return c.default.deburrLocaleLowerCase(e.trim()).split(/[\s]+/).filter(i.negate(i.isEmpty))}function m(e){if(e.length>0){const t=i.map(e,(e=>i.escapeRegExp(e)));return new RegExp(`(${t.join("|")})`,"g")}return h}function S(e,t,s,i){const o=c.default.deburrLocaleLowerCase(e);if(-1===o.search(t))return[i(e)];const n=[];let r,a=0;for(;(r=t.exec(o))&&(a!==r.index&&n.push(i(e.substring(a,r.index))),void 0!==r.index);)a=r.index+r[0].length,n.push(s(e.substring(r.index,a),"highlight.at."+r.index));return a!==e.length&&n.push(i(e.substring(a,e.length))),t.lastIndex=0,n}function f(e){return m(g(e))}t.transformToHighlighted=S,t.transformToHighlightedText=function(e,t,s,i,n){return S(e,f(t),((e,t)=>o.createElement(a.HighlightedNode,{isPrimarySearchResult:s,isOwnMessage:i,key:t,allowTextSelection:n},e)),(e=>e))},t.createQueryRegex=f,t.highlightSearchResults=function(e,t,s,i){try{return((e,t,s)=>(!p||p.query===e&&p.isPrimarySearchResult===t&&p.isOwnMessage===s||(p=void 0),p||(p={query:e,isPrimarySearchResult:t,isOwnMessage:s,transformer:new u({query:e,isPrimarySearchResult:t,isOwnMessage:s})}),p.transformer))(t,s,i).transform(e)}catch(e){l.error(r.LogTraceArea.GenericUnsafe,"SearchTermHighlightingTransformer: Failed to transform tree: "+c.default.errorAsString(e))}return e}},21476:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(77381),n=s(46096),r=s(36237),a=s(4735),l=s(53374);class d extends o.default{constructor(){super(...arguments),this._showProfile=()=>{const e=l.default.newCauseId();r.log(n.LogTraceArea.Navigation,"AtMentionNode._showProfile, causeId: "+e);const t=this.props.onPressProfileMriToShow;t&&a.default.showDetailsPanelWithParams({mri:t,rootViewId:this._getRootViewId(),causeId:e})}}render(){const{style:e,selectable:t,numberOfLines:s=0,allowFontScaling:o,onContextMenu:n,children:r,skipAtSymbol:a,maxContentSizeMultiplier:l,onPressProfileMriToShow:d,onPressInterceptionCallback:c,renderSimpleAtMention:h}=this.props,u={style:e,selectable:t,numberOfLines:s,allowFontScaling:o,maxContentSizeMultiplier:l},p=a?null:"@";return d&&!h&&(u.onPress=c||this._showProfile,u.onContextMenu=n),i.createElement(i.Text,Object.assign({},u),p,r)}}t.default=d},92091:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(9841);class o extends i.default{renderFileInformationOnStop(){return!1}}t.default=o},9841:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(81806),n=s(46096),r=s(15877),a=s(18078),l=s(36150),d=s(81760),c=s(24576),h=s(63841),u=s(18037),p=(0,r.lazyProperties)({controlsContainer:()=>i.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",flexDirection:"row",justifyContent:"center",backgroundColor:d.Color.transparent}),progressContainer:()=>i.Styles.createViewStyle({width:120})});class g extends c.default{constructor(){super(...arguments),this._onPress=e=>{e.stopPropagation(),this._audioPlayer&&this.isComponentMounted()&&this._audioPlayer.onPausePlay()},this._onAudioPlayerRef=e=>{this._audioPlayer=e||void 0}}_buildState(e,t){const s=u.default.colorTheme(),i=u.default.flipBubbleColors(),o=u.default.useDarkTheme(),n=u.default.useAccessibleTheme(),r=a.default.isMyMri(e.authorMri);let d=!1;return r?d=!o&&!i:(s===h.Theme.AccessibleDark||this._currentTheme===h.Theme.Delphi||i&&!o&&!n)&&(d=!0),{isMyMri:r,hasLightBackground:d,isMobileScreenReaderEnabled:l.default.isMobileScreenReaderEnabled()}}render(){let e;return e=this.state.hasLightBackground?{iconColor:d.Color.gray400,iconHoverColor:d.Color.gray300,progressContainerStyle:[p.progressContainer],progressTrackColor:d.Color.gray300,progressBarColor:d.Color.gray200,timerColor:d.Color.gray400,fileNameColor:d.Color.gray400}:{iconColor:d.Color.white,iconHoverColor:d.Color.gray200,progressContainerStyle:[p.progressContainer],progressTrackColor:d.Color.whiteOverlay20,progressBarColor:d.Color.white,timerColor:d.Color.white,fileNameColor:d.Color.white},i.createElement(i.View,{style:p.controlsContainer,onPress:this.state.isMobileScreenReaderEnabled?this._onPress:void 0,onLongPress:this.props.onLongPress,onContextMenu:this.props.onContextMenu},i.createElement(o.default,{origin:n.AudioPlayerOrigin.AudioNode,contentUrl:this.props.contentUrl,contentExtension:this.props.contentExtension,ref:this._onAudioPlayerRef,displayFilename:this.props.displayFilename,fileSizeInBytes:this.props.fileSizeInBytes,defaultDurationMs:this.props.audioMessageDurationMs,autoloop:!1,playerStyles:e,renderInformationOnstop:this.renderFileInformationOnStop(),message:this.props.message}))}renderFileInformationOnStop(){return!0}}t.default=g},79957:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BotDisclosure=t.getBotsForDisclosure=void 0;const i=s(96486),o=s(16778),n=s(88837),r=s(73208),a=s(1706),l=s(81169),d=s(71830),c=s(47477),h=s(39549),u=s(18078);function p(e,t,s,o){const n=i.some(e,(e=>u.default.isMyMri(e.getRawText())));let c=[],p=[],g=[];if(n){let e=(0,h.default)().getConversation(t);e&&(g=i.filter(e.getMemberMris(),(e=>d.isAgent(e))))}else g=(0,l.chain)(e,(0,l.map)((e=>e.getRawText())),(0,l.filter)((e=>d.isAgent(e))));i.each(g,(e=>{const t=a.default.getAgentDescriptionForMri(e);r.default.canListenToAllMessages(t.disclosures)?c.push(t.displayName):p.push(t.displayName)}));return{allMessagesBotsFormatted:i.map(c,(e=>s(e))),atMentionOnlyBotsFormatted:i.map(p,(e=>({botName:s(e),atMentionBotName:o(e)})))}}t.getBotsForDisclosure=p;class g extends n.ComponentBase{_buildState(e,t){return p(e.targets,e.conversationId,e.renderBotName,e.renderAtMentionBotName)}render(){const{allMessagesBotsFormatted:e,atMentionOnlyBotsFormatted:t}=this.state;if(e.length>0||t.length>0){const s=c.renderBotDisclosureParts(e,t);this.props.prependValue&&s.unshift(this.props.prependValue);const i=this.props.renderStringParts(s);return o.createElement(o.Text,{key:"BotDisclosure",style:this.props.textOverrideStyle,selectable:this.props.allowTextSelection,numberOfLines:this.props.numberOfLines||0},i)}return o.createElement(o.Text,null)}}t.BotDisclosure=g},32832:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallInviteNodeBase=void 0;const i=s(16778),o=s(16402),n=s(46096),r=s(10117),a=s(36237),l=s(15877),d=s(33754),c=s(6658),h=s(29130),u=s(34273),p=s(79829),g=s(71987),m=s(81760),S=s(11828),f=s(80837),y=s(19675),_=s(24576),v=s(53374),C=(0,l.lazyProperties)({backgroundContainer:()=>i.Styles.createViewStyle({paddingTop:15,borderRadius:8,flex:1}),callInfo:()=>(0,l.lazyProperties)({wrapper:()=>i.Styles.createViewStyle({marginLeft:15,marginRight:15,overflow:"visible"}),wrapperV2:()=>f.default.alignItemsCenter,subject:()=>i.Styles.createTextStyle({marginTop:8,marginBottom:2}),datetime:()=>i.Styles.createTextStyle({marginTop:8,marginBottom:10}),calendarIcon:()=>i.Styles.createViewStyle({marginTop:5,marginRight:5,marginBottom:5,top:1}),calendarIconWrapper:()=>i.Styles.createViewStyle({backgroundColor:m.Color.blue,height:S.IconSize.size32,width:S.IconSize.size32,alignItems:"center",justifyContent:"center",borderRadius:S.IconSize.size32,paddingLeft:3})}),statusIcon:()=>i.Styles.createViewStyle({margin:5})});class b extends _.default{constructor(){super(...arguments),this._onPress=()=>{const e=v.default.newCauseId();a.log(n.LogTraceArea.ScheduleCall,"CallInviteNodeBase._onPress causeId: "+e),u.default.NavigationActions.navigateToScheduledOverviewPanel({entryPoint:p.ScheduleCallEntryPoint.MessageStream,scheduledCallId:this.props.scheduledCall.id},this._getRootViewId())},this._getHeaderRef=e=>{this._headerRef=e}}_buildState(e,t){const s={};if(e.messagePadding){const t=this._getRootViewId(),i=h.default.getWidth(t),o=h.default.isSmallDevice(t);s.cardWidth=o?i-e.messagePadding:c.adaptiveCardMessageFixedWidth}else s.cardWidth=c.adaptiveCardMessageFixedWidth;return s.accessibilityResumeLabel=g.default.getAccessibilityLabelForScheduledCall(e.scheduledCall),s}render(){const e=i.Styles.createViewStyle({width:this.state.cardWidth},!1),t=[C.backgroundContainer,this._themeStyles.cardColorStyle,f.default.pointerCursor,e],s=o.default.getConditionalDateTimeString(this.props.scheduledCall.datetimeMs),n=i.createElement(i.Button,{style:[C.callInfo.wrapper,C.callInfo.wrapperV2],importantForAccessibility:i.Types.ImportantForAccessibility.Yes,onPress:this._onPress,onLongPress:this.props.onLongPress,accessibilityTraits:i.Types.AccessibilityTrait.Button,accessibilityLabel:this.state.accessibilityResumeLabel,ref:this._getHeaderRef},i.createElement(i.View,{style:C.callInfo.calendarIconWrapper},i.createElement(r.default,{icon:S.SkypeIcon.Schedule,size:S.IconSize.size18,color:m.Color.white,style:C.callInfo.calendarIcon})),i.createElement(y.CardTitle,{numberOfLines:2,style:[C.callInfo.subject,this._themeStyles.headerTextColorStyle]},g.default.getScheduledCallSubject(this.props.scheduledCall.subject)),i.createElement(y.Caption,null,d.getString("ContentToReactTransformer.ScheduledCallPreviewLabel")),i.createElement(y.Caption,{numberOfLines:2,style:C.callInfo.datetime},s));return i.createElement(i.View,{style:t},n,this.renderContent())}getTextAndIconForStatus(e,t){let s,o;switch(e){case p.ScheduledCallInvitationStatus.Unknown:s=d.getString("ScheduledCallCard.InvitedStatus");break;case p.ScheduledCallInvitationStatus.Accepted:s=d.getString("ScheduledCallCard.AcceptedStatus"),o=i.createElement(r.default,Object.assign({key:"icon",size:S.IconSize.size16,style:C.statusIcon},this.getIconPropsForStatus(e,t)));break;case p.ScheduledCallInvitationStatus.Declined:s=d.getString("ScheduledCallCard.DeclinedStatus"),o=i.createElement(r.default,Object.assign({key:"icon",size:S.IconSize.size16,style:C.statusIcon},this.getIconPropsForStatus(e,t)));break;default:return v.default.switchStatementExhaustiveChecking(e)}return{statusText:s,optionalIcon:o}}getIconPropsForStatus(e,t){switch(e){case p.ScheduledCallInvitationStatus.Accepted:return{icon:S.SkypeIcon.Ok,color:t?this._themeColors.secondaryTextColor:m.Color.green};case p.ScheduledCallInvitationStatus.Declined:return{icon:S.SkypeIcon.Cancel,color:t?this._themeColors.secondaryTextColor:m.Color.red};default:return v.default.switchStatementExhaustiveChecking(e)}}}t.CallInviteNodeBase=b},74775:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(32832),n=s(87134),r=s(10117),a=s(15877),l=s(33754),d=s(18078),c=s(79829),h=s(11010),u=s(11828),p=(0,a.lazyProperties)({responseStatus:()=>(0,a.lazyProperties)({responseButtonsContainer:()=>i.Styles.createViewStyle({flexDirection:"row",alignItems:"stretch",justifyContent:"space-around",overflow:"visible",height:44}),responseButton:()=>i.Styles.createButtonStyle({flex:1,alignItems:"center"}),inviteeStatus:()=>i.Styles.createViewStyle({flexGrow:1,flexShrink:0,flexDirection:"row",alignItems:"center",justifyContent:"center",height:44,paddingHorizontal:15})}),verticalDivider:()=>i.Styles.createViewStyle({width:1,height:44})});class g extends o.CallInviteNodeBase{constructor(){super(...arguments),this._onAccept=e=>{e.stopPropagation(),this.props.onCallInviteAccepted(this.props.scheduledCall.id,this.state.mySkypeMri),this._headerRef&&this._headerRef.requestFocus()},this._onDecline=e=>{e.stopPropagation(),this.props.onCallInviteDeclined(this.props.scheduledCall.id,this.state.mySkypeMri),this._headerRef&&this._headerRef.requestFocus()}}_buildState(e,t){const s=super._buildState(e,t);s.mySkypeMri=d.default.getSkypeMri();const i=e.scheduledCall.invitations[s.mySkypeMri];return i&&(t||!t&&i.invitationStatus!==c.ScheduledCallInvitationStatus.Unknown)&&(s.responseStatus=i.invitationStatus||c.ScheduledCallInvitationStatus.Unknown),s}renderContent(){let e;return this.state.responseStatus===c.ScheduledCallInvitationStatus.Unknown?e=this._renderResponseButtons():this.state.responseStatus&&(e=this._renderResponseStatus(this.state.responseStatus)),[i.createElement(n.default,{key:"divider",style:this._themeStyles.messageStreamBackgroundColorStyle}),i.createElement(i.View,{key:"invite_status"},e)]}_renderResponseButtons(){return i.createElement(i.View,{style:p.responseStatus.responseButtonsContainer},i.createElement(i.Button,{onPress:this._onAccept,accessibilityLabel:l.getString("ScheduledCallCard.AcceptButton"),style:p.responseStatus.responseButton},i.createElement(r.default,Object.assign({key:"accept",size:u.IconSize.size24},this.getIconPropsForStatus(c.ScheduledCallInvitationStatus.Accepted)))),i.createElement(n.default,{key:"buttonDivider",style:[p.verticalDivider,this._themeStyles.messageStreamBackgroundColorStyle]}),i.createElement(i.Button,{onPress:this._onDecline,accessibilityLabel:l.getString("ScheduledCallCard.DeclineButton"),style:p.responseStatus.responseButton},i.createElement(r.default,Object.assign({key:"decline",size:u.IconSize.size24},this.getIconPropsForStatus(c.ScheduledCallInvitationStatus.Declined)))))}_renderResponseStatus(e){const{statusText:t,optionalIcon:s}=this.getTextAndIconForStatus(e);return i.createElement(i.View,{style:p.responseStatus.inviteeStatus},s,i.createElement(i.Text,{importantForAccessibility:i.Types.ImportantForAccessibility.No,style:[h.default.fontStyle.tertiaryButton,this._themeStyles.primaryTextColorStyle]},t))}}t.default=g},66265:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(32832),r=s(52262),a=s(87134),l=s(15877),d=s(81412),c=s(79829),h=s(81760),u=s(67977),p=(0,l.lazyProperties)({dividerDark:()=>o.Styles.createViewStyle({backgroundColor:h.Color.gray300}),avatars:()=>o.Styles.createViewStyle({margin:10})});class g extends n.CallInviteNodeBase{_buildState(e,t){const s=super._buildState(e,t),o=[];return i.each(e.scheduledCall.invitations,((e,t)=>{o.push({name:r.default.getDisplayName(t),status:e.invitationStatus||c.ScheduledCallInvitationStatus.Unknown,skypeId:t})})),s.invitees=o,s}renderContent(){return[o.createElement(a.default,{key:"divider",marginLeft:15,marginRight:15,style:this._useDarkTheme()?p.dividerDark:this._themeStyles.dividerColorStyle}),o.createElement(d.default,{key:"invitees-avatar-list",shouldUseInvitationStatusToFilter:!0,shouldShowFilteredStatusAsLabel:!0,style:p.avatars,avatarSize:u.UserIconSize.Size24,avatarBorderWidth:0,invitations:this.props.scheduledCall.invitations})]}}t.default=g},56241:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallMarkerPreview=void 0;const i=s(16778),o=s(88837),n=s(25489),r=s(96096),a=s(71830),l=s(10117),d=s(15877),c=s(81760),h=(0,d.lazyProperties)({contentPlaceholderContainer:()=>i.Styles.createViewStyle({flexDirection:"row",justifyContent:"center",marginBottom:-2,width:20,height:16}),contentPlaceholderPadding:()=>i.Styles.createViewStyle({paddingRight:4})});class u extends o.ComponentBase{_buildState(e,t){const s=n.default.getCallLog(e.callId),i=r.default.calculateCallMarkerInfoFromPath(s,e.callId,e.conversationId,e.markerType,e.duration);return{markerType:i.type,duration:i.duration}}render(){const e=[this.props.regularTextStyle,this.props.textOverrideStyle],t=h.contentPlaceholderPadding,s=r.CallMarkerDisplayUtils.getIcon(this.state.markerType),o=i.createElement(i.View,{key:"placeholderIcon",style:h.contentPlaceholderContainer},i.createElement(l.default,{icon:s,size:16,color:this.props.mediaPlaceholderIconColor?this.props.mediaPlaceholderIconColor:c.Color.white,style:t})),n=this.state.markerType,d=this.props.conversationId;let u=d&&a.isEncryptedThread(d)?r.CallMarkerDisplayUtils.getTextForEncryptedThread(n,this.state.duration):r.CallMarkerDisplayUtils.getText(n,this.state.duration);return i.createElement(i.Text,{style:e,ellipsizeMode:"middle"},o,u)}}t.CallMarkerPreview=u},57219:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(5531),n=s(71830),r=s(13991),a=s(46096),l=s(14299),d=s(36237),c=s(15877),h=s(33754),u=s(51072),p=s(33596),g=s(12056),m=s(18078),S=s(4735),f=s(27683),y=s(81760),_=s(78262),v=s(19675),C=s(24576),b=s(2301),T=s(67977),M=s(53374),I=r.contactNodeHeigth,w=(0,c.lazyProperties)({contactCardContainer:()=>i.Styles.createViewStyle({flex:1,flexDirection:"column",minHeight:I,borderStyle:"solid",borderRadius:10}),senderBorderRadius:()=>i.Styles.createViewStyle({borderBottomRightRadius:0}),recieverBorderRadius:()=>i.Styles.createViewStyle({borderTopLeftRadius:0}),dataContainer:()=>i.Styles.createViewStyle({flex:1,flexDirection:"column",alignItems:"center",justifyContent:"flex-start",marginTop:8}),textContainer:()=>i.Styles.createViewStyle({flex:-1,flexDirection:"column",alignItems:"center",marginTop:10}),fullName:()=>i.Styles.createTextStyle({flex:-1,lineHeight:22,paddingBottom:5,paddingHorizontal:10}),skypeId:()=>i.Styles.createTextStyle({flex:-1,lineHeight:16,paddingHorizontal:10}),btnContainer:()=>i.Styles.createViewStyle({paddingVertical:15,borderStyle:"solid",borderTopWidth:2,paddingHorizontal:12}),btnText:()=>i.Styles.createTextStyle({textAlign:"center"}),textWrapper:()=>i.Styles.createViewStyle({flex:0,flexDirection:"row"})});class P extends C.default{constructor(){super(...arguments),this._onPress=()=>{const e=M.default.newCauseId();d.log(a.LogTraceArea.Navigation,"ContactNode._onPress, causeId: "+e),o.default.contacts().canHaveContacts?S.default.navigateToConversation({convId:this.state.contactUserMri,origin:a.NavigationConversationOrigin.SharedContactCard,causeId:e}):S.default.navigateToGuestUpsell(l.GuestUpsellType.LeaveGroup),this.props.message&&d.track(new g.MessageContentClicked(this.props.message))}}_buildState(e,t){let s;if(e.tree.isPstn&&e.tree.skypeId){let t={number:f.default.normalizePartialNumberWithCountryCode(e.tree.skypeId),type:_.PhoneNumberTypes.Other};s=n.getMriFromPhoneNumber(t)}else s=e.tree.isS4B&&e.tree.skypeId?n.getMriFromS4BId(e.tree.skypeId):n.skypeIdToMri(e.tree.skypeId);return{contactUserMri:s,isSentByCurrentUser:e.message&&m.default.isMyMri(e.message.creator)}}render(){const e=p.getStyleForDimensions({width:this.props.renderDimensions.width,height:void 0}),t=i.Styles.createTextStyle({maxWidth:this.props.renderDimensions.width},!1),s=this.props.tree.fullName,o=i.createElement(i.View,{style:w.textWrapper},i.createElement(v.BodyText,{style:[w.fullName,t],size:v.BodyTextSize.BigDeprecated,bold:!0,numberOfLines:1,ellipsizeMode:"middle",accessibilityHidden:!0},s)),n=i.createElement(v.Caption,{style:[w.skypeId,t],numberOfLines:1,ellipsizeMode:"tail",textThemeColor:v.TextThemeColor.Primary,accessibilityHidden:!0},this.props.tree.skypeId),r=h.getString("ContactCard.ChatButtonTitle"),a=s?h.getString("ContactCard.ChatButtonAccessibilityLabel",{userName:s}):r,l=i.createElement(i.Button,{style:[w.btnContainer,this._themeStyles.primaryBorderColorStyle],onPress:this._onPress,onLongPress:this.props.onLongPress,title:r,disabled:m.default.isMyMri(this.state.contactUserMri),accessibilityLabel:a},i.createElement(v.BodyText,{size:v.BodyTextSize.BigDeprecated,bold:!0,style:w.btnText},r)),d=i.createElement(b.UserIcon,{userMri:this.state.contactUserMri,backgroundColor:y.Color.gray100,size:T.UserIconSize.Size50,importantForAccessibility:i.Types.ImportantForAccessibility.NoHideDescendants}),c=this.state.isSentByCurrentUser?w.senderBorderRadius:w.recieverBorderRadius;return i.createElement(u.default.View,{style:[w.contactCardContainer,e,c,this._themeStyles.cardColorStyle],onContextMenu:this.props.onContextMenu,keepOriginalProps:!0},i.createElement(i.View,{style:w.dataContainer},d,i.createElement(i.View,{style:w.textContainer},o,n)),l)}}t.default=P},16026:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContentPlaceholder=void 0;const i=s(96486),o=s(16778),n=s(88837),r=s(10117),a=s(15877),l=s(81760),d=s(80837),c=(0,a.lazyProperties)({contentPlaceholderContainer:()=>o.Styles.createViewStyle({flexDirection:"row",justifyContent:"center",marginBottom:-2,width:20,height:16}),contentPlaceholderPadding:()=>o.Styles.createViewStyle({paddingRight:4})});class h extends n.ComponentBase{render(){const e=i.compact([this.props.regularTextStyle,this.props.textOverrideStyle,d.default.noWrap]);let t=this.props.iconColorOverride;!t&&this.props.mediaPlaceholderIconColor&&(t=this.props.mediaPlaceholderIconColor);const s=o.createElement(o.View,{key:"placeholderIcon",style:c.contentPlaceholderContainer},o.createElement(r.default,{icon:this.props.icon,size:16,color:null!=t?t:l.Color.white,style:c.contentPlaceholderPadding}));return o.createElement(o.Text,{style:e,numberOfLines:this.props.numberOfLines||0,selectable:this.props.allowTextSelection,ellipsizeMode:"middle"},s,this.props.label)}}t.ContentPlaceholder=h},35521:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DisplayName=t.displayNameText=void 0;const i=s(96486),o=s(88837),n=s(52262);function r(e,t){return e&&n.default.getDisplayName(e)||i.trimEnd(t)}t.displayNameText=r;class a extends o.ComponentBase{_buildState(e,t){return{name:r(e.mri,e.fallbackText)}}render(){return this.props.renderName(this.state.name)}}t.DisplayName=a},2781:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(60014),n=s(33010),r=(s(74377),s(16778)),a=s(98861),l=s(19784),d=s(89391),c=s(20603),h=s(25638),u=s(46549),p=s(71830),g=s(11930),m=s(984),S=s(16402),f=s(13991),y=s(52262),_=s(35521),v=s(6452),C=s(3291),b=s(70891),T=s(46096),M=s(7234),I=s(85609),w=s(61317),P=s(52115),k=s(79251),A=s(73439),E=s(53559),R=(s(69382),s(17873)),L=s(10117),F=s(36237),x=s(61253),O=s(16724),D=s(15877),B=s(40522),V=s(33754),N=s(51072),U=s(33596),H=s(12056),z=s(78735),W=s(18078),j=(s(4735),s(32226)),G=s(85207),K=s(17791),q=s(29130),Q=s(86045),X=s(960),$=s(83181),J=s(81760),Y=s(40363),Z=s(11010),ee=s(80837),te=s(82176),se=s(19675),ie=s(24576),oe=s(15188),ne=s(26612),re=s(26712),ae=s(53374);var le;!function(e){e[e.NONE=0]="NONE",e[e.DOWNLOADING=1]="DOWNLOADING",e[e.UPLOADING=2]="UPLOADING",e[e.ERROR=3]="ERROR",e[e.SUCCESS=4]="SUCCESS"}(le||(le={}));const de=Date.now()+2592e6,ce=25*Math.pow(1024,2),he={whiteSpace:"nowrap"},ue=(0,D.lazyProperties)({link:()=>r.Styles.createButtonStyle({flex:1,flexDirection:"column",alignSelf:"stretch",justifyContent:"center",overflow:"visible"}),learnMoreLink:()=>r.Styles.createLinkStyle({color:J.Color.blue}),contentContainer:()=>r.Styles.createButtonStyle({paddingTop:12,paddingBottom:0,borderBottomRightRadius:10,borderBottomLeftRadius:10}),contentContainerRestricted:()=>r.Styles.createButtonStyle({maxWidth:f.fileNodeWidth,minWidth:f.fileNodeWidth}),contentContainerRestrictedSmall:()=>r.Styles.createButtonStyle({maxWidth:f.fileNodeWidthSmall,minWidth:f.fileNodeWidthSmall}),textWrapper:()=>r.Styles.createTextStyle({flex:1,paddingHorizontal:10}),containerBorders:()=>r.Styles.createViewStyle({borderWidth:0,borderColor:J.Color.transparent,borderBottomLeftRadius:10,borderBottomRightRadius:10,borderTopLeftRadius:10,borderTopRightRadius:10}),radiusCurrentUser:()=>r.Styles.createViewStyle({borderBottomRightRadius:0}),radiusOtherUser:()=>r.Styles.createViewStyle({borderTopLeftRadius:0}),cardTitle:()=>r.Styles.createTextStyle({alignItems:"flex-start",paddingRight:16}),cardSubtitle:()=>r.Styles.createTextStyle({paddingTop:4}),cardSubtitleError:()=>r.Styles.createTextStyle({paddingTop:4,color:J.Color.pink}),fileTypeSection:()=>r.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",paddingTop:24,paddingBottom:10}),fileTypeIconPadding:()=>r.Styles.createViewStyle({paddingRight:6}),fileActionSection:()=>(0,D.lazyProperties)({base:()=>r.Styles.createViewStyle({flex:0,flexDirection:"column",alignItems:"center",paddingVertical:13,paddingHorizontal:5,borderTopWidth:2,borderStyle:"solid"})}),progressIndicator:()=>r.Styles.createViewStyle({flex:0,width:24,height:24,marginRight:10}),actionButtonText:()=>r.Styles.createTextStyle({textAlign:"center"}),fileFooterTextAlignRight:()=>r.Styles.createTextStyle({textAlign:"right"}),fileFooterTextAlignLeft:()=>r.Styles.createTextStyle({textAlign:"left"}),FileFooterContainer:()=>r.Styles.createViewStyle({flexGrow:1,flexShrink:1}),draggableThumbnailContainer:()=>r.Styles.createViewStyle({alignItems:"center",justifyContent:"center",width:60,height:60,shadowRadius:1,shadowOffset:{width:0,height:2},paddingVertical:18,paddingHorizontal:18,shadowColor:J.Color.blackOverlay20,borderRadius:10,borderWidth:1})});class pe extends ie.default{constructor(){super(...arguments),this._onFileNodeContainerRef=e=>{this._fileNodeContainerRef=e||void 0},this._onPress=e=>{e.stopPropagation();const t=ae.default.newCauseId();F.log(T.LogTraceArea.FileNode,"_onPress, causeId: "+t),R.default.potentiallyMarkItemViewed(this.props.message,this.props.renderOrigin),this._handleDownload(t)},this._handleDownload=(e,t)=>{if(!this.state.isConnected&&this.state.status===le.NONE)return;const s=!0,o=this.state.fileSizeInformation.value+this.state.fileSizeInformation.unit,n=this.props.fileSizeInBytes;switch(this.state.status){case le.DOWNLOADING:return void F.track(new k.FileDownloadCancelClick(this.state.fileExtension,this.props.message,o,n));case le.UPLOADING:return void i.each(this.props.message.getUnacknowledgedClientMessageIds(),(e=>{G.default.cancelPostMessage(this.props.message.conversationId,e)}));case le.SUCCESS:return void(this.state.isUpload?(this._downloadFile(s,t),F.track(new k.FileDownloadClick(this.state.fileExtension,this.props.message,o,n))):(this._processFile(),F.track(new k.FileOpenClick(this.state.fileExtension,this.props.message))));case le.ERROR:return this._downloadFile(s,t),void F.track(new k.FileDownloadRetryClick(this.state.fileExtension,this.props.message,o,n));default:return this._downloadFile(s,t),void F.track(new k.FileDownloadClick(this.state.fileExtension,this.props.message,o,n))}},this._handleAutoDownload=()=>{const e=ae.default.newCauseId();F.log(T.LogTraceArea.FileNode,"_handleAutoDownload, causeId: "+e),this._handleDownload(e,!0)},this._autoDownloadFile=()=>{if(this.state.documentId&&!u.default.isQueued(this.state.documentId)){const e={key:this.state.documentId,url:this.props.contentUrl,filename:this.state.fileUri,tag:this.props.message.conversationId,encryptionData:this._getEncryptionData()};u.default.downloadItem(e)}},this._onFileLearnMorePress=e=>{e.stopPropagation(),e.preventDefault(),B.openUrlWithParams({origin:T.BrowserOrigin.FileSharingLimits,url:d.default.getConfigSettingsNoSubscription().fileNode.learnMoreLink,rootViewId:this._getRootViewId()})},this._onFileLearnMoreKeyPress=e=>{e.stopPropagation()},this._showPromptForLargeFiles=()=>{const e=[{text:V.getString("FileTransfer.FileAccept"),onPress:()=>this._checkFileStatus(),isSubmit:!0},{text:V.getString("FileTransfer.DontAskMeAgain"),onPress:()=>(this._checkFileStatus(),z.default.setUserPreferencesLocal({dontShowAcceptLargeFileDialog:!0}),!0)},{text:V.getString("Global.CancelLabel"),isCancel:!0}],t=V.getString("FileTransfer.AcceptLargeFilePromptTitle",{maxFileSize:25}),s=V.getString("FileTransfer.AcceptLargeFilePromptMessage",{maxFileSize:25}),i=`${t}, ${s}`;return l.default.showWithOptions({title:t,message:s,dialogAccessibilityTitle:i,buttons:e,rootViewId:this._getRootViewId()})},this._handleFileCancelled=e=>{e===this.state.documentId&&this.setState({status:le.NONE})},this._handleFileDownloadUpdate=e=>{if(this.isComponentMounted()){if(this.state.documentId!==e.key)return;e.isFinished&&(e.downloadTransfer&&e.downloadTransfer.success?(Y.default.getPlatformType()===T.PlatformType.iOS?e.isCached&&this.setState({status:le.SUCCESS,localUri:M.default.getLocalUri(e.key)}):this.setState({status:le.SUCCESS,localUri:e.downloadTempLocalUri}),this._sendTelemetryEvent(!0,T.MessagingFailureReason.None,e),Q.default.maybeAnnounceForAccessibility(V.getString("AccessibilityLabel.FileDownloadSuccess"))):(this.setState({status:le.ERROR}),this._sendTelemetryEvent(!1,T.MessagingFailureReason.AMSFailure,e),Q.default.maybeAnnounceForAccessibility(V.getString("AccessibilityLabel.FileDownloadError")),F.track(new k.FileDownloadFailure(this.state.fileExtension,this.props.message,this.state.fileSizeInformation.value+this.state.fileSizeInformation.unit,this.props.fileSizeInBytes))))}},this._downloadFileRN=()=>{const e=ae.default.newCauseId();if(F.log(T.LogTraceArea.FileNode,"_downloadFileRN, causeId: "+e),!this.state.documentId)return F.warn(T.LogTraceArea.FileNode,"Tried to download a file without a documentId. Setting status to ERROR."),void this.setState({status:le.ERROR});const t=this._getEncryptionData();Y.default.getPlatformType()===T.PlatformType.iOS?v.default.downloadAmsContentToCache(this.state.documentId,this.props.downloadFilename,de,M.CacheEvictionKind.UserInvolved,Date.now(),this.props.contentUrl,e,void 0,t):v.default.androidDownloadAmsContentToPublicFolder(this.state.documentId,this.props.downloadFilename,this.props.contentUrl,e,void 0,t),this.setState({status:le.DOWNLOADING}),Q.default.maybeAnnounceForAccessibility(V.getString("AccessibilityLabel.FileDownloadStarted")),i.defer((()=>{this.requestFocus()}))},this._downloadFileWebOrWrapper=()=>{const e=ae.default.newCauseId();if(F.log(T.LogTraceArea.FileNode,"_downloadFileWebOrWrapper, causeId: "+e),!this.state.documentId)return F.warn(T.LogTraceArea.FileNode,"Tried to download a file without a documentId. Setting status to ERROR."),void this.setState({status:le.ERROR});{const e=new h.default(this.props.contentUrl).getViewId();e&&(c.default.getStatusAsync(this.state.documentId,e).then((e=>{this.isComponentMounted()&&(this.state.status===le.DOWNLOADING&&e&&e.view_location&&n.default.saveFile(e.view_location,this.props.downloadFilename),this.setState({status:le.NONE}))})).fail((()=>{this.isComponentMounted()&&this.setState({status:le.ERROR})})),this.setState({status:le.DOWNLOADING}))}},this._onShareError=e=>{l.default.showOKAlert(V.getString("FileTransfer.FileOpen"),V.getString("FileTransfer.UnableToOpenFileMessage",{fileName:this.props.downloadFilename}),this._getRootViewId()),this._trackShare(!1,e)},this._onShareCallback=(e,t)=>{this._trackShare(e,void 0)},this._onLongPress=e=>{this.props.onLongPress&&this.props.onLongPress(e)},this._onHoverStart=()=>{this.isComponentMounted()&&this.setState({isHovering:!0})},this._onHoverEnd=()=>{this.isComponentMounted()&&this.setState({isHovering:!1})},this._getLocalFileUri=()=>{let e=this.state.localUri;return!e&&this.state.documentId&&A.default.canTrackFiles()&&(e=A.default.getLocalUri(this.state.documentId)),e},this._canDownloadFile=()=>!!this.props.isFileAvailable&&(!(this._getLocalFileUri()||this._isDownloading()||!this.state.isConversationAccepted||!this.state.allowAutoDownloadFiles)&&!(this.state.isInCall&&!this.state.allowAutoDownloadFilesInCall)),this._cancelDownloadForKey=e=>{F.log(T.LogTraceArea.FileNode,"FileNode._cancelDownloadForKey, causeId: "+e),this.state.documentId&&(this.state.allowAutoDownloadFiles&&u.default.isQueued(this.state.documentId)?u.default.cancelDownload(this.state.documentId):v.default.cancelDownloadForKey(this.state.documentId,e))},this._maybeCancelOngoingDownloads=()=>{if(this.state.documentId&&this._isDownloading()&&v.default.isDownloading(this.state.documentId)){const e=ae.default.newCauseId();this._cancelDownloadForKey(e)}},this._isDownloading=()=>this.state.status===le.DOWNLOADING,this._onDragStartFile=e=>{C.default.addDragAndDropFileInformation(e,this.props.message)}}_buildState(e,t){d.default.getS4LMessagingFeatures();const s=W.default.isMyMri(e.authorMri),i=z.default.getUserPreferencesLocal(),o={dontPromptDownloadConfirmation:s||i.dontShowAcceptFileDialog,dontPromptLargeFileDownloadConfirmation:i.dontShowAcceptLargeFileDialog,wasCreatedByCurrentUser:s,isConnected:j.default.isConnected(),status:t?le.NONE:this.state.status,fileRetentionDurationDays:d.default.getS4LCMCFeatures().fileRetentionDurationDays,isConversationAccepted:m.default.isConversationAccepted(e.message.conversationId),allowAutoDownloadFiles:false,allowAutoDownloadFilesInCall:false,isInCall:$.default.isInCall(),networkType:K.default.getNetworkType()};let n=!1;const r=this.props;if(t?(o.fileSizeInformation=P.default.formatFileSize(e.fileSizeInBytes,1),o.fileExtension=E.default.extractFileExtension(e.displayFilename),o.lastContentUrl=e.contentUrl,o.isUpload=!1):this.state.status===le.SUCCESS&&this.state.localUri&&(n=!0),(t||r.displayFilename!==e.displayFilename)&&(o.fileInfo=I.FileIconHelper.getIconFromFileType(e.displayFilename)),e.contentUrl&&(t||this.state.lastContentUrl!==e.contentUrl)&&(o.lastContentUrl=e.contentUrl,o.documentId=new h.default(e.contentUrl).getDocumentId(),o.documentId?A.default.canTrackFiles()&&(o.localUri=A.default.getLocalUri(o.documentId)):o.isUpload=!0),!n){const t=e.contentUrl?ne.default.getTransferProgressForUrl(e.contentUrl):0,s=re.default.isFileOrBlob(e.contentUrl),i=o.status;o.localUri?o.status=le.SUCCESS:t&&(t.finished?t.success&&(o.status=le.SUCCESS):o.status=s?le.UPLOADING:le.DOWNLOADING),F.log(T.LogTraceArea.FileNode,"File node state changed from: "+i+", to: "+o.status)}const a=(o.fileSizeInformation||this.state.fileSizeInformation).formattedString;let l=e.displayFilename;switch(o.status){case le.DOWNLOADING:l+=V.getString("AccessibilityLabel.FileCancelDownload");break;case le.SUCCESS:l+=V.getString("AccessibilityLabel.OpenFile",{fileSize:a});break;case le.NONE:case le.ERROR:l+=V.getString("AccessibilityLabel.DownloadFile",{fileSize:a});break;case le.UPLOADING:l+=V.getString("AccessibilityLabel.FileUploadProgress")}const c={senderName:(0,_.displayNameText)(e.message.creator,e.message.creator),timestamp:S.default.getDisplayTimeString(e.message.createdTime),messageContent:l};o.accessibilityLabel=e.message.isUnsent()?V.getString("AccessibilityLabel.MediaMessageSending",c):V.getString("AccessibilityLabel.MediaMessage",c),o.responsiveWidth=q.default.getResponsiveWidth(this._getRootViewId());const u=e.searchStore?e.searchStore.getSearchQuery():void 0;return e.searchStore&&u&&e.searchStore.isMessageInConvSearchResults(e.message.cuid)?o.cardTitle=(0,X.transformToHighlightedText)(e.displayFilename,u.query,e.searchStore.isMessageFocused(e.message.cuid),!1):o.cardTitle=[e.displayFilename],o.fileUri=w.FilePickerUtils.getFileUri(e.downloadFilename,i.fileDownloadPathDesktop),o}componentWillUnmount(){super.componentWillUnmount(),v.default.downloadUpdated.unsubscribe(this._handleFileDownloadUpdate),u.default.downloadCancelled.unsubscribe(this._handleFileCancelled),this._maybeCancelOngoingDownloads()}componentDidMount(){super.componentDidMount(),v.default.downloadUpdated.subscribe(this._handleFileDownloadUpdate),u.default.downloadCancelled.subscribe(this._handleFileCancelled),this._canDownloadFile()&&this._handleAutoDownload()}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this._canDownloadFile()&&this.state.shouldHandleAutoDownload&&this._handleAutoDownload()}render(){const e=!p.isEncryptedThread(this.props.message.conversationId);let t=[ue.containerBorders];this.props.renderOrigin!==b.MessageRenderOrigin.CompositeGalleryCanvas&&t.push(this.state.wasCreatedByCurrentUser&&this.props.renderOrigin!==b.MessageRenderOrigin.StackGalleryCanvas?ue.radiusCurrentUser:ue.radiusOtherUser);let s,n=e?V.getString("FileTransfer.DownloadFile"):V.getString("FileTransfer.UnsupportedEncryptedFile"),a=this.state.fileSizeInformation.formattedString,l=ue.cardSubtitle,d=!1;switch(this.state.status){case le.DOWNLOADING:n=V.getString("Global.CancelLabel"),a=V.getString("FileTransfer.DownloadingStatus",{fileSize:a}),d=!0;break;case le.UPLOADING:n=V.getString("Global.CancelLabel"),a=V.getString("FileTransfer.UploadingStatus",{fileSize:a}),d=!0;break;case le.ERROR:n=V.getString("FileTransfer.RetryDownloadFile"),a=V.getString("FileTransfer.ErrorStatus"),l=ue.cardSubtitleError;break;case le.SUCCESS:this.state.isUpload?a=V.getString("FileTransfer.UploadedStatus",{fileSize:a}):(n=V.getString("FileTransfer.OpenFile"),a=V.getString("FileTransfer.DownloadedStatus",{fileSize:a}));case le.NONE:}d&&(s=r.createElement(r.View,{style:ue.progressIndicator},r.createElement(oe.default,{size:24,strokeColor:this._themeColors.primaryTextColor,contentUrls:[this.props.contentUrl],showFiniteProgressIndicatorUI:!0})));let c=[ue.link,ue.contentContainer,this._themeStyles.cardColorStyle];(0,x.default)(this.props.renderDimensions,f.FileNodeSizes.Small)?c.push(ue.contentContainerRestrictedSmall):(0,x.default)(this.props.renderDimensions,f.FileNodeSizes.Regular)&&c.push(ue.contentContainerRestricted),c=i.flatten([c,t]);let h=[ue.actionButtonText,Z.default.fontStyle.cardAction];!this.state.isConnected&&this.state.status===le.NONE||!e?(h.push(this._themeStyles.disabledTextColorStyle),c.push(ee.default.defaultCursor)):h.push(this.state.isHovering?this._themeStyles.textHoverColorStyle:this._themeStyles.buttonTextColorStyle);const u=[ue.fileActionSection.base,this._themeStyles.primaryBorderColorStyle];let g,m=this._renderFooterView();this.props.isFileAvailable&&(g=r.createElement(r.View,{style:u,onMouseEnter:this._onHoverStart,onMouseLeave:this._onHoverEnd},r.createElement(r.Text,{style:h,forceDirection:!0},n)));const S=U.getStyleForDimensions({width:this.props.renderDimensions.width,height:void 0});return r.createElement(o.DragDroppableView,{onDragStart:this.props.isDraggingEnabled?this._onDragStartFile:void 0,dragThumbnailElement:this.props.isDraggingEnabled?this._getThumbnailElement():void 0,style:S},r.createElement(N.default.Button,{ref:this._onFileNodeContainerRef,key:"file",style:c,title:V.getString("FileTransfer.FileOpen"),onPress:e?this._onPress:void 0,onLongPress:e?this._onLongPress:void 0,onContextMenu:this.props.onContextMenu,underlayColor:this._themeColors.rowHighlightColor,activeOpacity:this.props.activeOpacityOverride,accessibilityLabel:this.state.accessibilityLabel,keepOriginalProps:!0,disabled:this.props.disableActions||!this.props.isFileAvailable,disabledOpacity:1},r.createElement(r.View,{style:ue.textWrapper,title:this.props.displayFilename},r.createElement(se.CardTitle,{style:ue.cardTitle,numberOfLines:1,ellipsizeMode:"middle"},this.state.cardTitle),r.createElement(se.Caption,{style:l,numberOfLines:1},a),r.createElement(r.View,{style:[ue.fileTypeSection]},r.createElement(L.default,{icon:this.state.fileInfo.icon,size:24,color:this.props.mediaPlaceholderIconColor||J.Color.gray300,style:ue.fileTypeIconPadding}),r.createElement(se.Caption,{style:ee.default.flexOne,numberOfLines:1},this.state.fileInfo.displayString),s),g)),m)}requestFocus(){this._fileNodeContainerRef&&this._fileNodeContainerRef.requestFocus()}_renderFooterView(){let e;if(!this.props.isFileAvailable){let t,s=this.state.wasCreatedByCurrentUser?ue.fileFooterTextAlignRight:ue.fileFooterTextAlignLeft;this.props.renderOrigin!==b.MessageRenderOrigin.CompositeGalleryCanvas&&this.props.renderOrigin!==b.MessageRenderOrigin.StackGalleryCanvas||(s=ue.fileFooterTextAlignLeft);const i=r.createElement(r.Link,{url:d.default.getConfigSettingsNoSubscription().fileNode.learnMoreLink,onPress:this._onFileLearnMorePress,style:[ue.learnMoreLink,he],key:"FileLearnMoreLink "},V.getString("FileTransfer.FileLearnMoreLinkText")),o=V.getParts("FileTransfer.FileNotAvailableMessage",{learnMoreLink:i}),n=r.createElement(se.Caption,{style:s,allowFontScaling:!1},o),a=!1;a&&(t=g.default.linkAccessibilityInfo(V.getString("FileTransfer.FileNotAvailableMessage",{learnMoreLink:V.getString("FileTransfer.FileLearnMoreLinkText")}),!0)),e=r.createElement(r.View,{style:ue.FileFooterContainer,importantForAccessibility:r.Types.ImportantForAccessibility.Yes,accessibilityLabel:t?t.label:void 0,accessibilityTraits:t?t.traits:void 0,onPress:a?this._onFileLearnMorePress:void 0,onKeyPress:this._onFileLearnMoreKeyPress},n)}return e}_downloadFile(e,t){this.setState({isUpload:!1});const{dontPromptLargeFileDownloadConfirmation:s}=this.state,i=t&&this.state.allowAutoDownloadFiles;if(e)i?this._autoDownloadFile():this._checkFileStatusWrapperOrWeb();else{const e=this.state.networkType===a.DeviceNetworkType.Wifi,t=this.props.fileSizeInBytes>=ce;e||s||i||!t?this._checkFileStatus():this._showPromptForLargeFiles()}}_sendTelemetryEvent(e,t,s){const i=s.targetUri||"",o=new O.FileReceived(i,void 0,te.default.extractExtensionForTelemetry(s.filename));o.setDownloadDuration(Date.now()-s.startTime),o.setSuccess(e,t,s.finishedAttemptsSoFar,s.responseStatusCode),F.track(o)}_checkFileStatusWrapperOrWeb(){const e=this.props.displayFilename,t=y.default.getDisplayName(this.props.authorMri,!0)||this.props.authorMri,s=e.substr(e.lastIndexOf(".")+1,e.length),i=d.default.getS4LMessagingFeatures().unsafeFiles.indexOf(s)>=0,o=V.getString(i?"FileTransfer.AcceptUnsafeFileMessage":"FileTransfer.AcceptFileMessage",{fileName:e,senderName:t});let n="";const r=[{text:V.getString("FileTransfer.FileAccept"),onPress:this._downloadFileWebOrWrapper,isSubmit:!0},{text:V.getString("Global.CancelLabel"),isCancel:!0}];if(i)n=V.getString("FileTransfer.UnsafeFileHeader");else{if(this.state.dontPromptDownloadConfirmation)return this._downloadFileWebOrWrapper();r.push({text:V.getString("FileTransfer.DontAskMeAgain"),onPress:()=>(this._downloadFileWebOrWrapper(),z.default.setUserPreferencesLocal({dontShowAcceptFileDialog:!0}),!0)})}l.default.showWithOptions({title:n,message:o,dialogAccessibilityTitle:o,buttons:r,rootViewId:this._getRootViewId()})}_checkFileStatus(){const e=d.default.getS4LMessagingFeatures().unsafeFiles.indexOf(this.state.fileExtension)>=0,t=y.default.getDisplayName(this.props.authorMri,!0)||this.props.authorMri,s=this.props.displayFilename,i=V.getString(e?"FileTransfer.AcceptUnsafeFileMessage":"FileTransfer.AcceptFileMessage",{fileName:s,senderName:t}),o=[{text:V.getString("FileTransfer.FileAccept"),onPress:this._downloadFileRN},{text:V.getString("Global.CancelLabel")}];e?l.default.showWithOptions({title:V.getString("FileTransfer.UnsafeFileHeader"),message:i,dialogAccessibilityTitle:i,buttons:o,rootViewId:this._getRootViewId()}):this.state.dontPromptDownloadConfirmation?this._downloadFileRN():(o.push({text:V.getString("FileTransfer.DontAskMeAgain"),onPress:()=>{this._downloadFileRN(),z.default.setUserPreferencesLocal({dontShowAcceptFileDialog:!0})}}),l.default.showWithOptions({title:V.getString("FileTransfer.AcceptFileHeader"),dialogAccessibilityTitle:i,message:i,buttons:o,rootViewId:this._getRootViewId()}))}_processFile(){}_trackShare(e,t){const s=new H.ShareFileMessageTelemetry(this.props.message.conversationId,this.props.message,this.props.message.createdTime,H.MessageActionOrigin.FileNode,H.MessageActionType.ShareFile,this.state.fileExtension,!1);F.track(s)}_getEncryptionData(){return this.props.message.getFileEncryptionKeys()}_getThumbnailElement(){return r.createElement(L.default,{icon:this.state.fileInfo.icon,size:24,color:this.props.mediaPlaceholderIconColor||J.Color.gray300,style:[ue.draggableThumbnailContainer,this._themeStyles.primaryBackgroundColorStyle,this._themeStyles.dividerBorderColorStyle]})}}t.default=pe},73560:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GenderLocalizedMessage=t.localizeMessageString=t.localizeMessageParts=void 0;const i=s(88837),o=s(71830),n=s(47662),r=s(33754),a=s(78262),l=s(72758);function d(e,t){const s=e&&!o.isThread(e)&&l.default.getFullUserProfileByMri(e).gender||a.eGender.Unspecified;return t.gender=n.getLocalizeParamForGender(s),t}t.localizeMessageParts=function(e,t,s){const i=d(e,s);return r.getParts(t,i)},t.localizeMessageString=function(e,t,s){const i=d(e,s);return r.getString(t,i)};class c extends i.ComponentBase{_buildState(e,t){const s=d(e.mri,e.localizeParams);return{messageParts:r.getParts(e.localizeKey,s)}}render(){return this.props.renderMessage(this.state.messageParts,this.props.tree)}}t.GenderLocalizedMessage=c},5406:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HighlightedNode=void 0;const i=s(96486),o=s(16778),n=s(15877),r=s(89808),a=s(24576),l=(0,n.lazyProperties)({searchResultBackgroundStyle:()=>o.Styles.createViewStyle({padding:2,borderRadius:3})});class d extends a.default{_buildState(e,t){return{backgroundStyle:e.isPrimarySearchResult?o.Styles.createViewStyle({backgroundColor:r.default.getCurrentSearchResultBackgroundColor()},!1):o.Styles.createViewStyle({backgroundColor:r.default.getSearchResultsBackgroundColor(e.isOwnMessage)},!1),textStyle:e.isPrimarySearchResult?o.Styles.createTextStyle({color:r.default.getCurrentSearchResultTextColor()},!1):o.Styles.createTextStyle({color:r.default.getSearchResultsTextColor(e.isOwnMessage)},!1)}}render(){let e=[this.state.backgroundStyle,this.state.textStyle,l.searchResultBackgroundStyle];return this.props.textOverrideStyle&&(e=i.compact([this.props.textOverrideStyle,e])),o.createElement(o.Text,{style:e,selectable:this.props.allowTextSelection},this.props.children)}}t.HighlightedNode=d},31807:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HtmlInlineImage=void 0;const i=s(99560),o=s(16778),n=s(44770),r=s(89391),a=s(65976),l=s(62602),d=s(77381),c=s(74313),h=s(53559),u=s(13944),p=s(15877),g=s(33754),m=s(33596),S=s(42653),f=s(45983),y=s(70561),_=s(68080),v=s(81760),C=s(11828),b=s(34528),T=s(78262),M=s(80837),I=s(75865),w=s(26712),P=(0,p.lazyProperties)({backgroundImage:()=>[M.default.absoluteFill,o.Styles.createViewStyle({opacity:.5})],alternateViewContainer:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center",backgroundColor:v.Color.gray200}),headerContainer:()=>o.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"flex-end",backgroundColor:v.Color.transparent}),moreButton:()=>o.Styles.createTextStyle({height:48,width:48})});class k extends d.default{constructor(){super(...arguments),this._mediaViewerController={getOptions:()=>({animateOpenClose:!0,showCustomHeader:!0,showCustomFooter:!1}),renderCustomHeader:(e,t)=>o.createElement(o.View,{style:P.headerContainer},o.createElement(u.default,{ref:this._setMoreButtonRef,size:C.IconSize.size24,style:P.moreButton,onPress:t=>this._showMoreMenu(t,e),color:v.Color.white,hoverColor:v.Color.gray300,icon:b.moreIcon(),title:g.getString("Global.MoreOptions")})),renderCustomFooter:e=>o.createElement(S.default,{hideLeftButton:!1,hideRightReactionButton:!0,message:this.props.message,mediaDescriptor:e}),getMediaLocationInWindow:e=>l.default.measureLayoutRelativeToWindow((()=>this))},this._setMoreButtonRef=e=>{this._moreButton=e||void 0},this._onPress=e=>{const t=`${this.props.message.cuid}_${i(this.props.source).toString()}`,s=h.default.extractFileNameWithExtension(this.props.source),o=h.default.extractFileExtension(s)?s:t+".jpg",n=this.props.originalDimensions.width&&this.props.originalDimensions.height?{width:this.props.originalDimensions.width,height:this.props.originalDimensions.height}:void 0,r=this.props.thumbnailDimensions.width&&this.props.thumbnailDimensions.height?{width:this.props.thumbnailDimensions.width,height:this.props.thumbnailDimensions.height}:void 0,a={id:t,mediaType:f.MediaViewerTypes.Picture,downloadFileName:o,thumbnailUrl:this.state.thumbnailUrl,displayResolutionUrl:this.state.fullSizeUrl,fullResolutionUrl:this.state.fullSizeUrl,originalSize:n,thumbnailSize:r};_.default.showWithConfig({initialMedia:a,controller:this._mediaViewerController,rootViewId:this._getRootViewId()})}}_showMoreMenu(e,t){y.default.showWithConfig({message:this.props.message,mediaDescriptor:t,componentContext:this._getContext(),anchor:()=>this._moreButton,invokingEvent:e})}_buildState(e,t){let s,i;const o=a.getDocumentId(e.source);if(o)s=a.getDisplayUrl(o,T.UploadFileType.Picture,T.MediaViewSize.ThumbnailUncropped),i=a.getDisplayUrl(o,T.UploadFileType.Picture,T.MediaViewSize.Full);else{const t=r.default.getS4LMessagingFeatures().asmImageProxy;s=w.default.addUrlParameter(t,"url",encodeURIComponent(e.source)),i=s}return{thumbnailUrl:I.default.getAuthenticatedUrl(s),fullSizeUrl:I.default.getAuthenticatedUrl(i)}}render(){const e=[P.alternateViewContainer],t=o.createElement(o.View,{style:e},o.createElement(o.Image,{style:P.backgroundImage,resizeMode:"cover",source:n.Collection.WIGGLE_PATTERN_350})),s=m.getStyleForDimensions(this.props.thumbnailDimensions);return o.createElement(c.default,{origin:"HtmlNode",containerStyle:s,style:[this.props.style,s],source:this.state.thumbnailUrl,resizeMode:"contain",onPress:this._onPress,altView:t,errorView:t})}}t.HtmlInlineImage=k},91754:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HtmlNode=void 0;const i=s(23719),o=s(96486),n=s(68870),r=s(16778),a=s(51077),l=s(77381),d=s(13991),c=s(31807),h=s(17213),u=s(57199),p=s(12762),g=s(18078),m=s(58962),S=s(960),f=s(80837);class y extends l.default{constructor(){super(...arguments),this._createEmoticonNodeFromHtml=e=>{const t=p.PlainTextNode.fromPlainText("("+e+")"),s=new p.EmoticonNode(t,e,void 0),i=o.clone(this.props.options);i.allowLargeEmoticons=!1,i.allowHugeEmoticons=!1;return this.props.createChildReact([s],i).value},this._createImageNodeFromHtml=(e,t)=>{const s={width:this._getPixelDimension(t.width),height:this._getPixelDimension(t.height)},i=d.getScaledThumbnailDimensions(s,this.props.renderDimensions);return{result:r.createElement(c.HtmlInlineImage,{message:this.props.message,originalDimensions:s,thumbnailDimensions:i,style:t,source:e}),renderInline:!1}},this._createAtMentionNodeFromHtml=e=>{const t=a.getTeamsMentionProperties(this.props.message.properties);if(t){const s=o.find(t,(t=>t.itemid+""==e+""));if(s&&s.mri){const t=s.displayName,i=p.PlainTextNode.fromPlainText(t||e),n=new p.AtMentionNode([i],s.mri,!1,e);let r;this.props.tree.isQuote()?(r=o.clone(this.props.options),r.textOverrideStyle=r.quotedTextStyle):r=this.props.options;return this.props.createChildReact([n],r).value}}},this._createTextNodeFromHtml=e=>{const t=e.replace(/\r\n/g,"\n");return y.highlightText(this.props.tree,this.props.message,t)||t},this._onScrollViewLayout=e=>{this._scrollLayoutWidth=e.width,this._updateScrollIndicator()},this._onContentSizeChange=(e,t)=>{this._scrollContentWidth=e,this._updateScrollIndicator()}}_buildState(e,t){let s;const r=this.props;if(t||e.tree!==r.tree){let t=[];const n=e.tree.getHtmlDom(),r=this._transformHtmlForRendering(o.cloneDeep(n),t,e.tree.isQuote());o.each(t,(e=>i.DomUtils.removeElement(e))),s=new u.default(r)}else s=this.state.htmlDom;return{htmlDom:s,renderResult:n.default.htmlToReact(s.value,{defaultTextStyle:[e.options.regularTextStyle,e.options.textOverrideStyle,f.default.overflowVisible],emoticonSize:m.frameHeights.emoticons.SMALL,renderEmoticon:this._createEmoticonNodeFromHtml,renderImage:this._createImageNodeFromHtml,renderAtMention:this._createAtMentionNodeFromHtml,renderTextNode:this._createTextNodeFromHtml}),needsHorizontalScroll:this.state&&this.state.needsHorizontalScroll||!1}}_transformHtmlForRendering(e,t,s){return o.map(e,(e=>{if(s&&"text"===e.type&&o.trim(e.data)){const t=e.parent;if(t&&"tag"===t.type&&"i"===t.name)return e;const s={attribs:{},children:[e],name:"i",parent:e.parent,type:"tag"};return i.DomUtils.replaceElement(e,s),s}if("tag"===e.type&&"img"===e.name&&e.attribs&&e.attribs.itemtype===h.SemanticObjectSchemas.amsImage){const s=i.DomUtils.getSiblings(e),n=o.findIndex(s,e);if(n>=0){let e=n-1;for(;e>=0&&this._checkForLineBreaks(s[e],t);)e--;for(e=n+1;e<s.length&&this._checkForLineBreaks(s[e],t);)e++}}return e.children&&(e.children=this._transformHtmlForRendering(e.children,t,s)),e}))}_checkForLineBreaks(e,t){return"tag"===e.type&&"br"===e.name?(t.push(e),!0):"text"===e.type&&0===o.trim(e.data).length}_getPixelDimension(e){if(o.isString(e)&&o.endsWith(e,"px")){const t=e;return o.toNumber(t.slice(0,-2))}if(o.isNumber(e))return o.toNumber(e)}static highlightText(e,t,s){const i=e.getSearchQuery();if(i)return(0,S.transformToHighlightedText)(s,i,e.isPrimarySearchResult(),g.default.isMyMri(t.creator))}_updateScrollIndicator(){o.isUndefined(this._scrollContentWidth)||o.isUndefined(this._scrollLayoutWidth)||this.setState({needsHorizontalScroll:this._scrollContentWidth>this._scrollLayoutWidth})}render(){return r.createElement(r.ScrollView,{style:f.default.flexOne,horizontal:!0,vertical:!1,showsHorizontalScrollIndicator:this.state.needsHorizontalScroll,onLayout:this._onScrollViewLayout,onContentSizeChange:this._onContentSizeChange},this.state.renderResult)}}t.HtmlNode=y},52859:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});s(96486);const i=s(16778),o=s(19061),n=s(77381),r=s(73145),a=s(46096),l=s(17873),d=s(40522),c=(s(33754),s(19089)),h=s(46529),u=s(750),p=s(26712),g=s(91319),m="web-link";class S extends n.default{constructor(e){super(e),this._getReactionMenuAnchor=()=>this._linkRef,this._getContextMenuItems=()=>{let e=[];return this.props.messageActions&&(e=[...this.props.messageActions.actionMenuCommands]),this.props.supportsCopy&&e.push(u.CommandTypes.CopyLink),this._commandManager.getSXMenuItems(this._createCommandOptions(),e)},this._onLinkRef=e=>{this._linkRef=e||void 0},this._onPress=e=>{if(this.props.onPressInterceptionCallback)this.props.onPressInterceptionCallback();else{if(l.default.potentiallyMarkItemViewed(this.props.message,this.props.renderOrigin),c.default.isPiPEnabled()){const e=g.default.getYoutubeVideoPropsFromUrl(this.props.url);if(e)return void c.default.setContentProps(e)}d.openUrlWithParams({origin:a.BrowserOrigin.LinkNode,url:this.props.url,options:{conversationId:this.props.message?this.props.message.conversationId:void 0,preventInAppNavigationForGuest:!o.default.canNavigateInApp(),openInExternalBrowser:p.default.isSkypeDeepLinkUrl(this.props.url)||void 0},rootViewId:this._getRootViewId()})}},this._onStreamItemCommandSelected=(e,t)=>{this._intOnCommandSelected(e,t.rootViewId)},this._onCommandSelected=e=>{this._intOnCommandSelected(e,this._getRootViewId())},this._onLongPress=e=>{if(this.props.onLongPress)this.props.onLongPress(e);else if(this.props.supportsCopy){const t=[u.CommandTypes.CopyLink],s=this._createCommandOptions();this._commandManager.showSXPopup(s,t,m,(()=>this._linkRef),this._getRootViewId(),e)}},this._commandManager=new h.StreamItemCommandManager(this._onStreamItemCommandSelected)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s)}requestFocus(){this._linkRef&&this._linkRef.requestFocus()}render(){let e=i.createElement(i.Link,{ref:this._onLinkRef,style:this.props.style,url:this.props.url,title:this.props.url,onPress:this._onPress,onLongPress:this._onLongPress,selectable:this.props.linkSelectable,numberOfLines:this.props.numberOfLines,maxContentSizeMultiplier:this.props.maxContentSizeMultiplier,tabIndex:this.props.onPressInterceptionCallback?-1:void 0},this.props.children);return this.props.onPressInterceptionCallback||(e=i.createElement(r.default,{wrapperOnly:!1,getMenuItems:this._getContextMenuItems,onItemSelected:this._onCommandSelected,renderAsText:!0},e)),e}_intOnCommandSelected(e,t){this._commandManager.dismissSXPopup(m,t),this._commandManager.onActionMenuOptionSelected(this._createCommandOptions(),e)}_createCommandOptions(){return{message:this.props.message,decodedNode:this.props.decodedNode,url:this.props.url,onQuoteCallback:this.props.onQuote,onEditCallback:this.props.onEdit,renderOrigin:this.props.renderOrigin,getReactionMenuPopupAnchor:this._getReactionMenuAnchor,componentContext:this._getContext(),getRootWindowComponent:this._getReactionMenuAnchor}}}t.default=S},62523:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LongitudeDelta=t.LatitudeDelta=void 0;const i=s(93391),o=s(16778),n=s(52262),r=s(46096),a=s(74313),l=s(7234),d=s(36237),c=s(15877),h=s(40522),u=s(33754),p=s(40392),g=s(46705),m=s(51176),S=s(51176),f=s(51072),y=s(18078),_=(s(4735),s(4057)),v=s(81760),C=s(78262),b=s(60305),T=s(19675),M=s(24576);t.LatitudeDelta=.0421,t.LongitudeDelta=.0221;const I=(0,c.lazyProperties)({container:()=>o.Styles.createViewStyle({width:m.MapWidth,height:m.LocationHeight,alignItems:"stretch"}),mapSnapshotStyle:()=>o.Styles.createViewStyle({height:0,width:0}),mapStyle:()=>o.Styles.createViewStyle({height:m.MapHeight,width:m.MapWidth}),locationPin:()=>o.Styles.createViewStyle({position:"absolute",top:m.MapHeight/2-p.PinSize/2,left:m.MapWidth/2-p.PinSize/2}),footerContainer:()=>o.Styles.createViewStyle({paddingHorizontal:10,height:m.FooterHeight,justifyContent:"center"}),footerRadius:()=>o.Styles.createViewStyle({borderBottomLeftRadius:10,borderBottomRightRadius:0}),footerRadiusOtherUsers:()=>o.Styles.createViewStyle({borderBottomLeftRadius:10,borderBottomRightRadius:10}),footerTextFirstLine:()=>o.Styles.createTextStyle({marginBottom:5}),mapSnapshotAlternateView:()=>o.Styles.createViewStyle({flex:1,alignSelf:"center",alignItems:"center",justifyContent:"center",width:m.MapWidth,height:m.MapHeight,backgroundColor:v.Color.gray200}),topRadius:()=>o.Styles.createViewStyle({borderTopLeftRadius:10,borderTopRightRadius:10}),topRadiusOtherUsers:()=>o.Styles.createViewStyle({borderTopLeftRadius:0,borderTopRightRadius:10})});class w extends M.default{constructor(){super(...arguments),this._setMapViewRef=e=>{this._mapView=e},this._onPress=e=>{d.track(new g.LocationViewerOpen(this.props.message.conversationId,this.props.message)),h.openUrlWithParams({origin:r.BrowserOrigin.LocationNode,url:this.props.bingMapsUrl,options:{conversationId:this.props.message?this.props.message.conversationId:void 0},rootViewId:this._getRootViewId()})},this._onLongPress=e=>{this.props.onLongPress&&this.props.onLongPress(e)}}_buildState(e,t){const s=S.default.getLocationRegionFromLatLong(e.latitude,e.longitude);let i={wasOriginallyPostedByCurrentUser:y.default.isMyMri(e.originalCreatorMri),wasLastPostedByCurrentUser:y.default.isMyMri(e.message.creator),shouldRenderSnapshot:this._canTakeMapSnapshot(),latitudeValue:s.latitude,longitudeValue:s.longitude,fileId:S.default.getFileIdForLocation(e.message.cuid),useTabletUI:b.default.useTabletUI()};return i.wasOriginallyPostedByCurrentUser||(i.creatorName=n.default.getMemberShortNameForConversation(e.message.conversationId,e.originalCreatorMri)),l.default.isKnown(i.fileId)?i.mapSnapshotUri=l.default.getLocalUri(i.fileId):i.mapSnapshotUri=S.default.getBingMapsImageUrl(s,m.MapWidth,m.MapHeight),i}_canTakeMapSnapshot(){return!0}componentDidMount(){if(super.componentDidMount(),this.state.shouldRenderSnapshot&&!this.state.mapSnapshotUri&&this._mapView){const e={latitude:this.state.latitudeValue,longitude:this.state.longitudeValue,latitudeDelta:m.LatitudeLongitudeDelta,longitudeDelta:m.LatitudeLongitudeDelta*(m.MapWidth/m.MapHeight)};this._mapView.takeSnapshot(m.MapWidth,m.MapHeight,e,((e,t)=>{if(e)return void d.warn(r.LogTraceArea.LocationNode,"Unable to takeSnapshot: "+_.default.errorAsString(e));if(!t)return void d.warn(r.LogTraceArea.LocationNode,"Unable to takeSnapshot: snapshot is undefined");const s="file://"+t.uri;l.default.isKnown(this.state.fileId)||l.default.save(this.state.fileId,s,this.state.fileId+m.LocationSuffix+".png",Date.now()+6048e5,!1,l.CacheEvictionKind.Preview,Date.now()).then((()=>{this.isComponentMounted()&&this.setState({mapSnapshotUri:l.default.getLocalUri(this.state.fileId)})})).fail((e=>{d.warn(r.LogTraceArea.LocationNode,"Unable to move the screenshot: "+e.code)}))}))}}render(){const e={latitude:this.state.latitudeValue,longitude:this.state.longitudeValue,latitudeDelta:t.LatitudeDelta,longitudeDelta:t.LongitudeDelta};let s,n,r,l=this.props.addressFriendlyName;if(this.props.isUserLocation&&(l=this.state.wasOriginallyPostedByCurrentUser?u.getString("LocationPicker.YourLocationLabel"):u.getString("LocationPicker.OtherPersonLocationLabel",{name:this.state.creatorName||""})),l&&(s=o.createElement(T.CardTitle,{style:I.footerTextFirstLine,numberOfLines:1},l)),this.props.fullAddress){let e=this.props.addressFriendlyName?this.props.shortAddress:this.props.fullAddress;n=o.createElement(T.Caption,{textThemeColor:T.TextThemeColor.Primary,numberOfLines:1},e)}if(s||n){const e=[I.footerContainer,this._themeStyles.cardColorStyle,this.state.wasLastPostedByCurrentUser?I.footerRadius:I.footerRadiusOtherUsers];r=o.createElement(o.View,{style:e},s,n)}const d=o.createElement(p.default,{key:"locationpin",style:this.state.shouldRenderSnapshot?I.locationPin:void 0,userMri:this.props.originalCreatorMri,locationType:this.props.isUserLocation?C.LocationType.Current:C.LocationType.None}),c=this.state.shouldRenderSnapshot?d:o.createElement(i.MapMarker,{coordinate:e},d);let h,g;const m=this.state.wasLastPostedByCurrentUser?I.topRadius:I.topRadiusOtherUsers;if(this.state.shouldRenderSnapshot){const e=[I.mapSnapshotAlternateView,m],t=o.createElement(o.View,{style:e},d);g=o.createElement(a.default,{origin:"LocationSnapshot",resizeMode:"cover",source:this.state.mapSnapshotUri,style:e,containerStyle:e,altView:t,errorView:t},d)}if(!this.state.mapSnapshotUri){const t=[this.state.shouldRenderSnapshot?I.mapSnapshotStyle:I.mapStyle,m];h=o.createElement(i.MapView,{ref:this._setMapViewRef,initialRegion:e,style:t,scrollEnabled:!1,cacheEnabled:!1,pitchEnabled:!1,rotateEnabled:!1,showsUserLocation:!1,loadingEnabled:!1,zoomEnabled:!1,showsMyLocationButton:!0,toolbarEnabled:!1,liteMode:!0,disableRegionChangeUpdates:!0},c)}return o.createElement(f.default.Button,{key:"location",style:[I.container,m],onPress:this._onPress,onLongPress:this._onLongPress,onContextMenu:this.props.onContextMenu,activeOpacity:this.props.activeOpacityOverride,keepOriginalProps:!0,disabled:this.props.disableActions,disabledOpacity:1},h,g,r)}}t.default=w},72977:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(88837),n=s(16026),r=s(52262),a=s(33754),l=s(18078),d=s(11828);class c extends o.ComponentBase{_buildState(e,t){let s={postedByCurrentUser:l.default.isMyMri(e.authorMri)};return s.postedByCurrentUser||(s.creatorName=r.default.getMemberShortNameForConversation(e.conversationId,e.authorMri)),s}render(){let e=this.props.address;return this.props.isUserLocation?e=l.default.isMyMri(this.props.authorMri)?a.getString("LocationPicker.SharedCurrentLocationYou"):a.getString("LocationPicker.SharedCurrentLocation",{userName:this.state.creatorName||""}):e||(e=a.getString("ContentToReactTransformer.LocationMessageMediaIconPreviewLabel")),i.createElement(n.ContentPlaceholder,{icon:d.SkypeIcon.Location,label:e,numberOfLines:1,allowTextSelection:!1,mediaPlaceholderIconColor:this.props.mediaPlaceholderIconColor,regularTextStyle:this.props.regularTextStyle,textOverrideStyle:this.props.textOverrideStyle})}}t.default=c},24466:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MediaAlbumNode=void 0;const i=s(96486),o=s(16778),n=s(86374),r=s(15877),a=s(33754),l=s(51072),d=s(18606),c=s(12762),h=s(6658),u=s(18078),p=s(30124),g=s(78302),m=s(44487),S=s(81760),f=s(11010),y=s(11828),_=s(80837),v=s(24576),C=s(15188),b=s(26712),T=s(5451),M=(0,r.lazyProperties)({albumStyle:()=>o.Styles.createViewStyle({flexDirection:"row",overflow:"hidden",justifyContent:"center"}),albumRow:()=>o.Styles.createViewStyle({flexDirection:"row"}),overflowNumberTransparentLayer:()=>o.Styles.createViewStyle({backgroundColor:S.Color.blackOverlay50}),overflowNumberContainer:()=>o.Styles.createViewStyle({justifyContent:"center",alignItems:"center"}),overflowNumber:()=>o.Styles.createTextStyle({color:S.Color.white,fontSize:28,position:"absolute"}),boldOverflowNumber:()=>o.Styles.createTextStyle({font:f.default.font.uiDisplayBold}),marginRight:()=>o.Styles.createViewStyle({marginRight:1}),marginBottom:()=>o.Styles.createViewStyle({marginBottom:1}),marginRightBottom:()=>o.Styles.createViewStyle({marginRight:1,marginBottom:1}),borderTopLeftRadius:()=>o.Styles.createViewStyle({borderTopLeftRadius:h.messageBorderRadius}),borderTopRightRadius:()=>o.Styles.createViewStyle({borderTopRightRadius:h.messageBorderRadius}),borderBottomRightRadius:()=>o.Styles.createViewStyle({borderBottomRightRadius:h.messageBorderRadius}),borderBottomLeftRadius:()=>o.Styles.createViewStyle({borderBottomLeftRadius:h.messageBorderRadius})});var I;!function(e){e.Picture="Picture",e.Video="Video"}(I||(I={}));class w extends v.default{constructor(){super(...arguments),this._renderProgressIndicator=()=>{if(this.state.isUploading)return o.createElement(C.default,{contentUrls:this.state.contentUrls,strokeColor:S.Color.white,size:y.IconSize.size60,showFiniteProgressIndicatorUI:!0,isUploadingCompleted:!this.state.isUploading})},this._renderOverflowNumber=e=>{if(!this._shouldRenderOverflowNumber())return;const{mediaItems:t}=this.state,s="+"+(t.length>4?t.length-4:1);let i=[M.overflowNumber];this.state.isUsingStackNavigation&&i.push(M.boldOverflowNumber);let n=[_.default.absoluteFill,M.overflowNumberContainer],r=[];return o.createElement(o.View,{style:[n,...r]},o.createElement(o.View,{style:[M.overflowNumberTransparentLayer,_.default.absoluteFill,...r]}),o.createElement(o.Text,{style:i},s))},this._onPress=e=>{this.props.onPress&&this.props.onPress(e)},this._shouldRenderOverflowNumber=()=>{const{mediaItems:e}=this.state;return 3===e.length||e.length>4},this._determineNodesLength=()=>{const{mediaItems:e}=this.state;return i.take(e,3===e.length?2:4)},this._createAlbumStyle=()=>{const{width:e,height:t}=this._getCellDimensions();return o.Styles.createViewStyle({maxWidth:2*e+2,maxHeight:2*t+2},!1)},this._getCellDimensions=()=>{const e=this._getDesktopCellDimensions();return this.state.isUsingStackNavigation?{width:120,height:120}:{width:e.width,height:e.height}},this._getDesktopCellDimensions=()=>{const e=this._getContext().isPresentedInDesktopRightNav||this._getContext().isPresentedInDesktopLeftNav;return{width:e?100:140,height:e?100:140}}}_buildState(e,t){let s={linkedMessages:d.default.getNotFailedMediaMessagesForAlbum(e.albumId),isUsingStackNavigation:p.default.isUsingStackNavigationContext(),isSelectMessagesModeActive:m.default.isSelectMessagesModeActive(this._getRootViewId())},o=i.compact(i.map(s.linkedMessages,(e=>{const t=n.decode(e),s=t.getFirstUriObjectChild(c.PictureNode),i=t.getFirstUriObjectChild(c.VideoNode),o=s||i;if(o)return{message:e,contentUrl:o.getDisplayThumbnailUrlSanitized(),thumbnailUrl:o.getDisplayThumbnailUrlSanitized(),type:s?I.Picture:I.Video,onPress:t=>{d.default.setSelectedMediaForAlbum(e),this._onPress(t)},onFocus:()=>d.default.setSelectedMediaForAlbum(e)}})));return s.mediaItems=o,s.contentUrls=i.compact(i.filter(i.map(o,(e=>e.contentUrl)),(e=>b.default.isFileOrBlob(e)))),s.isUploading=!i.isEmpty(s.contentUrls),s.isPostedByCurrentUser=s.linkedMessages&&!i.isEmpty(s.linkedMessages)&&u.default.isMyMri(s.linkedMessages[0].creator),s}render(){const e=this.state.isSelectMessagesModeActive?o.Types.ImportantForAccessibility.NoHideDescendants:void 0,t=this.state.mediaItems.length,s=a.getString("AccessibilityLabel.MediaAlbumPhotos",{count:t}),n=this._renderAlbumItems();let r;return r=2===n.length?n:o.createElement(o.View,null,o.createElement(o.View,{style:M.albumRow},i.take(n,2)),o.createElement(o.View,{style:M.albumRow},i.takeRight(n,2))),o.createElement(l.default.Button,{onPress:this._onPress,keepOriginalProps:!0,key:"album",style:this.props.containerRadiusStyles,importantForAccessibility:e,accessibilityLabel:s},o.createElement(o.View,{style:[M.albumStyle,this._createAlbumStyle()]},r),this._renderProgressIndicator())}_renderAlbumItems(){const e=this._getCellDimensions(),t=this._determineNodesLength();return i.map(t,((s,i)=>{const n=o.Styles.createViewStyle(e,!1);let r;const a=void 0;r=s.type===I.Video?o.createElement(T.default,{contentUrl:s.contentUrl,thumbnailUrl:s.thumbnailUrl,authorMri:s.message.creator,renderDimensions:e,subType:void 0,message:s.message,key:`albumItem-${s.message.cuid}`,isPresentedInAlbum:!0,containerRadiusStyles:a}):o.createElement(g.default,{contentUrl:s.contentUrl,thumbnailUrl:s.thumbnailUrl,authorMri:s.message.creator,renderDimensions:e,message:s.message,key:`albumItem-${s.message.cuid}`,isPresentedInAlbum:!0,containerRadiusStyles:a});const l=i===t.length-1,d=this._getItemMargin(t.length,i);return o.createElement(o.View,{key:`albumItemButton-${s.message.cuid}`,onPress:s.onPress,onFocus:s.onFocus,onLongPress:this.props.onLongPress,onContextMenu:this.props.onContextMenu,style:[n,d],importantForAccessibility:o.Types.ImportantForAccessibility.NoHideDescendants,activeOpacity:1},r,l&&this._renderOverflowNumber(i))}))}_getBorderRadiusStyleForItem(e,t){let s=[];const i=0===t,o=1===t,n=2===t,r=3===t;return this.state.isPostedByCurrentUser?e<=3?i?(s.push(M.borderTopLeftRadius),s.push(M.borderBottomLeftRadius)):(o||n)&&s.push(M.borderTopRightRadius):i?s.push(M.borderTopLeftRadius):o?s.push(M.borderTopRightRadius):n&&s.push(M.borderBottomLeftRadius):e<=3?i?s.push(M.borderBottomLeftRadius):(o||n)&&(s.push(M.borderTopRightRadius),s.push(M.borderBottomRightRadius)):o?s.push(M.borderTopRightRadius):n?s.push(M.borderBottomLeftRadius):r&&s.push(M.borderBottomRightRadius),s}_getItemMargin(e,t){let s=[];const i=0===t,o=1===t,n=2===t;return i&&s.push(M.marginRight),e>3&&(i&&s.push(M.marginRightBottom),o&&s.push(M.marginBottom),n&&s.push(M.marginRight)),s.push(M.marginRight),s}}t.MediaAlbumNode=w},18317:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NgcUpgradeSystemMessageNode=t.ngcUpgradeMessageText=void 0;const i=s(96486),o=s(16778),n=s(88837),r=s(71830),a=s(52262),l=s(33754);function d(e){return r.isMri(e)?a.default.getDisplayName(e):e}function c(e){let t;if(1===i.size(e))t=l.getString("NgcUpgradeNode.NgcUpgradeOneMessage",{user:d(e[0])||""});else{const s=i.last(e),o=i.filter(e,(e=>e!==s));t=l.getString("NgcUpgradeNode.NgcUpgradeManyMessage",{users:i.map(o,(e=>d(e))).join(", "),lastUser:d(s)||""})}return t}t.ngcUpgradeMessageText=c;class h extends n.ComponentBase{_buildState(e,t){return{ngcUpgradeMessage:c(e.userMrisOrNames)}}render(){return o.createElement(o.Text,{key:"ngcUpgradeMessage",style:[this.props.systemTextStyle,this.props.textOverrideStyle],numberOfLines:this.props.numberOfLines||0},this.state.ngcUpgradeMessage)}}t.NgcUpgradeSystemMessageNode=h},78302:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(60014),o=s(16778),n=s(44770),r=s(3291),a=s(70891),l=s(46096),d=s(74313),c=s(10117),h=s(36237),u=s(15877),p=s(33754),g=s(51072),m=s(33596),S=s(42036),f=s(18078),y=s(44487),_=s(81760),v=s(11828),C=s(80837),b=s(19675),T=s(24576),M=s(15188),I=s(75865),w=s(26712),P=(0,u.lazyProperties)({pictureContainer:()=>o.Styles.createViewStyle({justifyContent:"center"}),pictureContainerHidden:()=>o.Styles.createViewStyle({opacity:0}),overlayCenteredContainer:()=>o.Styles.createViewStyle({alignItems:"center",justifyContent:"center"}),overlayContainerBackground:()=>o.Styles.createViewStyle({backgroundColor:_.Color.blackOverlay10}),actionButtonborderStyle:()=>o.Styles.createViewStyle({backgroundColor:_.Color.blackOverlay10,borderStyle:"solid",borderWidth:2,borderColor:_.Color.white,alignItems:"center",justifyContent:"center"}),absolutPositionStyle:()=>o.Styles.createViewStyle({position:"absolute"}),alternateViewContainer:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center",backgroundColor:_.Color.gray200}),retryButtonSmallSizeStyle:()=>o.Styles.createViewStyle({borderRadius:v.IconSize.size48/2,width:v.IconSize.size48,height:v.IconSize.size48}),retryButtonNormalSizeStyle:()=>o.Styles.createViewStyle({borderRadius:v.IconSize.size60/2,width:v.IconSize.size60,height:v.IconSize.size60}),backgroundImage:()=>[C.default.absoluteFill,o.Styles.createViewStyle({opacity:.5})],draggableThumbnailContainer:()=>o.Styles.createViewStyle({alignItems:"center",justifyContent:"center",width:60,height:60,shadowRadius:1,shadowOffset:{width:0,height:2},shadowColor:_.Color.blackOverlay20,borderRadius:10,borderWidth:1}),footerContainer:()=>o.Styles.createViewStyle({flexGrow:1,flexShrink:1}),footerTextAlignRight:()=>o.Styles.createViewStyle({alignItems:"flex-end"})});class k extends T.default{constructor(){super(...arguments),this._onPress=e=>{this.state.sendingFailed&&this.props.isRetryCommandSupported?(this._onRetryClick(),e.stopPropagation()):this.props.onPress&&this.props.onPress(e)},this._onImageRef=e=>{this._errorSafeImage=e||void 0},this._onLocalThumbnailError=()=>{this._onError(this.state.localUrl)},this._onThumbnailError=()=>{this._onError(this.props.thumbnailUrl)},this._onThumbnailLoad=()=>{this.setState({thumbnailLoaded:!0}),this.props.onThumbnailLoaded&&this.props.onThumbnailLoaded(!0)},this._onDragStartPicture=e=>{r.default.addDragAndDropFileInformation(e,this.props.message)}}_buildState(e,t){let s={contentUrl:I.default.getAuthenticatedUrl(e.contentUrl),thumbnailUrl:I.default.getAuthenticatedUrl(e.thumbnailUrl),wasCreatedByCurrentUser:f.default.isMyMri(e.authorMri),sendingFailed:e.message.isSendRejected(),isSelectMessagesModeActive:y.default.isSelectMessagesModeActive(this._getRootViewId())};return t&&(s.isImageHidden=!1),w.default.isFileOrBlob(e.thumbnailUrl)?(s.localUrl=e.thumbnailUrl,s.isUploading=!0,s.showAltView=!0):s.isUploading=!1,s}componentDidMount(){super.componentDidMount(),this.props.onMountContent&&this.props.onMountContent("PictureNode",this,!0)}componentWillUnmount(){super.componentWillUnmount(),this.props.onMountContent&&this.props.onMountContent("PictureNode",this,!1)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),t.isUploading&&!this.state.isUploading&&this.setState({showAltView:!1})}getThumbnailDimensions(){let e;return this._errorSafeImage&&(e=this._errorSafeImage.getNativeImageSize()),e}hideNode(){this.isComponentMounted()&&(this.setState({isImageHidden:!0}),this.props.onHideContent&&this.props.onHideContent())}showNode(){this.isComponentMounted()&&(this.setState({isImageHidden:!1}),this.props.onShowContent&&this.props.onShowContent())}render(){let e,t=this.state.isUploading||this.props.isMessageInSendingState;this.state.sendingFailed&&(t=!1);const s=m.getStyleForDimensions(this.props.renderDimensions),r=m.getStyleForDimensions({width:this.props.renderDimensions.width,height:void 0});let a=v.IconSize.size60;this._isPictureSmall()&&(a=v.IconSize.size48),t&&(e=o.createElement(M.default,{contentUrls:[this.state.contentUrl],strokeColor:_.Color.white,size:a,showFiniteProgressIndicatorUI:!0,isUploadingCompleted:!this.state.isUploading}));let l=[P.pictureContainer];this.state.isImageHidden&&l.push(P.pictureContainerHidden);const h=[P.alternateViewContainer,this.props.containerRadiusStyles],u=o.createElement(o.View,{style:h},o.createElement(o.Image,{style:P.backgroundImage,resizeMode:"cover",source:n.Collection.WIGGLE_PATTERN_350})),p=o.createElement(o.View,{style:h},o.createElement(o.Image,{style:P.backgroundImage,resizeMode:"cover",source:n.Collection.WIGGLE_PATTERN_350})),S=o.Styles.createImageStyle({overlayColor:this._themeColors.messageStreamBackgroundColor},!1);let f,y=[m.defaultStyles.pictureDefaultThumbnail,s,S,this.props.containerRadiusStyles],b=[l,this.props.containerRadiusStyles,s];this.state.localUrl&&(f=o.createElement(d.default,{origin:"PictureNodeLocalImage",key:"localImage",style:y,containerStyle:b,source:this.state.localUrl,altView:u,errorView:p,onError:this._onLocalThumbnailError,onLoad:this._onThumbnailLoad,resizeMode:"cover"}));const T=o.createElement(d.default,{ref:this._onImageRef,origin:"PictureNodeImage",style:y,containerStyle:b,source:this.state.thumbnailUrl,altView:f||u,errorView:p,onError:this._onThumbnailError,onLoad:this._onThumbnailLoad,resizeMode:"cover",showAltView:this.state.showAltView});let I;if(this.state.thumbnailLoaded){let e;this.props.showDownloadIcon&&(e=o.createElement(o.View,{style:P.actionButtonborderStyle},o.createElement(c.default,{icon:v.SkypeIcon.Down,size:v.IconSize.size24,color:_.Color.white})));const t=[C.default.absoluteFill,P.overlayCenteredContainer,this.props.containerRadiusStyles,P.overlayContainerBackground];I=o.createElement(i.DragDroppableView,{style:t,onDragStart:this.props.isDraggingEnabled?this._onDragStartPicture:void 0,dragThumbnailElement:this.props.isDraggingEnabled?this._getDraggableThumbnailElement():void 0},e)}const w=this._isPictureSmall()?P.retryButtonSmallSizeStyle:P.retryButtonNormalSizeStyle,k=this.state.sendingFailed&&this.props.isRetryCommandSupported?o.createElement(o.View,{style:[P.actionButtonborderStyle,P.absolutPositionStyle,w]},o.createElement(c.default,{icon:v.SkypeIcon.Reload,size:v.IconSize.size24,color:_.Color.white})):void 0,A=this._getPictureNodeButtonTitle();let E=o.createElement(g.default.Button,{key:"picture",style:[l,s,this.props.containerRadiusStyles,C.default.alignItemsCenter],title:A,onPress:this._onPress,onLongPress:this.props.onLongPress,onContextMenu:this.props.onContextMenu,activeOpacity:this.props.activeOpacityOverride,keepOriginalProps:!0,disabled:this.props.disableActions,disabledOpacity:1,importantForAccessibility:this.state.isSelectMessagesModeActive?o.Types.ImportantForAccessibility.No:void 0},T,I,k,e);this.props.isPresentedInAlbum&&(E=o.createElement(o.View,{key:"picture",style:[l,s,this.props.containerRadiusStyles,C.default.alignItemsCenter],title:A},T,I));const R=this._renderFooterView();return R?o.createElement(o.View,{style:[l,r]},E,R):E}_onRetryClick(){S.default.retryFailedSend(this.props.message)}_onError(e){this.props.onThumbnailLoaded&&this.props.onThumbnailLoaded(!1),h.warn(l.LogTraceArea.GenericUnsafe,"Failed to load image for PictureNode: "+e)}_renderFooterView(){let e;if(this.state.sendingFailed){const t=this.props.isRetryCommandSupported?p.getString("MediaNode.SendingFailed"):p.getString("MediaNode.MediaNotAvailableForSending");e=o.createElement(o.View,{style:[P.footerContainer,this.state.wasCreatedByCurrentUser?P.footerTextAlignRight:void 0]},o.createElement(b.Caption,null,t))}return e}_getDraggableThumbnailElement(){return o.createElement(o.Image,{source:this.props.thumbnailUrl,style:[P.draggableThumbnailContainer,this._themeStyles.dividerBorderColorStyle]})}_isPictureSmall(){return this.props.renderDimensions.width&&this.props.renderDimensions.width<75||this.props.renderDimensions.height&&this.props.renderDimensions.height<75}_getPictureNodeButtonTitle(){return this.state.sendingFailed?p.getString("FileTransfer.RetryImageSendAction"):this.props.fileName&&this.props.renderOrigin&&this.props.renderOrigin===a.MessageRenderOrigin.CompositeGalleryCanvas?p.getString("FileTransfer.ImageOpenWithFileName",{fileName:this.props.fileName}):p.getString("FileTransfer.ImageOpen")}}t.default=k},71837:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(34339),r=s(89391),a=s(16402),l=s(87134),d=s(10117),c=s(36237),h=s(15877),u=s(33754),p=s(26424),g=s(53569),m=s(35590),S=s(45151),f=s(71926),y=s(99375),_=s(81760),v=s(11828),C=s(19675),b=s(24576),T=(0,h.lazyProperties)({attribution:()=>(0,h.lazyProperties)({container:()=>o.Styles.createViewStyle({flexDirection:"row",paddingTop:10,paddingBottom:15,paddingHorizontal:15}),text:()=>o.Styles.createTextStyle({lineHeight:16,paddingLeft:8})}),cardContainer:()=>o.Styles.createViewStyle({flex:1,flexDirection:"column",overflow:"visible",width:240,borderTopLeftRadius:10,borderTopRightRadius:10,borderBottomLeftRadius:10,borderBottomRightRadius:0}),details:()=>(0,h.lazyProperties)({button:()=>o.Styles.createViewStyle({flex:1,alignItems:"center",marginVertical:12,marginHorizontal:3}),text:()=>o.Styles.createTextStyle({lineHeight:22})}),divider:()=>o.Styles.createViewStyle({height:1,backgroundColor:_.Color.white}),expiration:()=>(0,h.lazyProperties)({text:()=>o.Styles.createTextStyle({lineHeight:16,paddingTop:10,paddingLeft:15})}),title:()=>o.Styles.createTextStyle({lineHeight:24,paddingHorizontal:15,paddingTop:15,marginBottom:5}),winner:()=>(0,h.lazyProperties)({container:()=>o.Styles.createViewStyle({flexDirection:"column",paddingHorizontal:15,paddingTop:15}),emoticonContainer:()=>o.Styles.createViewStyle({flexDirection:"column",paddingBottom:28,backgroundColor:_.Color.white,alignItems:"center"}),header:()=>o.Styles.createTextStyle({lineHeight:24}),text:()=>o.Styles.createTextStyle({paddingTop:15,paddingBottom:27,color:_.Color.black}),title:()=>o.Styles.createTextStyle({lineHeight:16,paddingVertical:5,fontStyle:"italic"})})});class M extends b.default{constructor(){super(...arguments),this._onVote=e=>{y.selectVote(this.props.message,y.getMyVotes(this.state.pollVotes),e,this.props.expirationTimeMs,this.props.allowMultipleVotes,f.VoteOrigin.Card)},this._onViewPollDetails=()=>{c.track(new f.PollDetailsOpenedEvent(this.props.message)),g.default.navigateToPollSummaryPanel({conversationId:this.props.conversationId,message:this.props.message,title:this.props.title,expirationTimeMs:this.props.expirationTimeMs,options:this.props.options,allowMultipleVotes:this.props.allowMultipleVotes},this._getRootViewId())}}_buildState(e){const t=r.default.getS4LMessagingFeatures(),s=e.message.getPollData(),i=y.combinePollOptionsAndVotes(e.options,s,e.message,!1),o=S.default.getPollByMessageCuid(e.message.cuid);return{pollVotes:i,isPollExpired:y.isPollExpired(o?o.expirationTimeMs:e.expirationTimeMs),noVotesEmoticonName:t.pollNoVotesEmoticonName,winnerEmoticonName:t.pollWinnerEmoticonName}}render(){return this.state.isPollExpired?this._renderResultsCardForExpiredPoll():this._renderCardForUnexpiredPoll()}_renderResultsCardForExpiredPoll(){return o.createElement(o.View,{key:"pollCardNode_"+this.props.message.getLatestServerMessageId(),style:[T.cardContainer,this._themeStyles.cardColorStyle],importantForAccessibility:o.Types.ImportantForAccessibility.No},this._renderWinnerHeader(),this._renderAttribution(),o.createElement(l.default,{style:T.divider}),this._renderDetailsButton())}_renderCardForUnexpiredPoll(){return o.createElement(o.View,{key:"pollCardNode_"+this.props.message.getLatestServerMessageId(),style:[T.cardContainer,this._themeStyles.cardColorStyle],importantForAccessibility:o.Types.ImportantForAccessibility.No},this._renderTitle(),this._renderOptions(),this._renderExpiration(),this._renderAttribution(),o.createElement(l.default,{style:T.divider}),this._renderDetailsButton())}_renderWinnerHeader(){const e=y.getMaxVoteOptions(this.state.pollVotes);return o.createElement(o.View,{key:"pollCardNode_"+this.props.message.getLatestServerMessageId(),style:T.winner.container,importantForAccessibility:o.Types.ImportantForAccessibility.No},o.createElement(C.CardTitle,{style:[T.winner.header,this._themeStyles.headerTextColorStyle],numberOfLines:1,useSmallTitle:!1},this._getWinnerTitle(e)),o.createElement(C.Caption,{style:T.winner.title,numberOfLines:1},this.props.title),this._renderWinnerIcon(e))}_getWinnerTitle(e){return!e||i.isEmpty(e)?u.getString("Poll.NoVotesWinnerLabel"):e.length>1?u.getString("Poll.TieLabel"):u.getString("Poll.WinnerLabel")}_renderWinnerIcon(e){return o.createElement(o.View,{style:T.winner.emoticonContainer,importantForAccessibility:o.Types.ImportantForAccessibility.No},o.createElement(C.CardTitle,{style:[T.winner.text],numberOfLines:1,useSmallTitle:!1},i.join(e,u.getString("Poll.TieVotesSeparator"))),o.createElement(n.AnimatedEmoticon,{emoticonName:this._getEmoticonName(e),size:p.EmoticonSize.ExtraLarge}))}_getEmoticonName(e){return i.isEmpty(e)?this.state.noVotesEmoticonName:this.state.winnerEmoticonName}_renderTitle(){return o.createElement(o.View,{importantForAccessibility:o.Types.ImportantForAccessibility.Yes,accessibilityLabel:u.getString("Poll.StreamItemAccessibilityLabel",{question:this.props.title})},o.createElement(C.CardTitle,{style:[T.title,this._themeStyles.headerTextColorStyle],numberOfLines:2,useSmallTitle:!1},this.props.title))}_renderOptions(){if(!i.isEmpty(this.state.pollVotes))return i.map(i.keys(this.state.pollVotes),((e,t)=>this._renderPollOption(t,e,this.state.pollVotes[e])))}_renderPollOption(e,t,s){return o.createElement(m.default,{key:"pollOption"+e,expirationTimeMs:this.props.expirationTimeMs,index:e,onVote:this._onVote,option:t,users:s})}_renderExpiration(){const e=u.getString("Poll.ExpirationDateLabel",{expirationDate:a.default.getConditionalDateTimeString(this.props.expirationTimeMs)});return o.createElement(C.Caption,{style:T.expiration.text},e)}_renderAttribution(){return o.createElement(o.View,{style:T.attribution.container},o.createElement(d.default,{icon:v.SkypeIcon.Poll,size:v.IconSize.size16,color:this._themeColors.primaryIconColor}),o.createElement(C.Caption,{style:T.attribution.text},u.getString("Poll.Header")))}_renderDetailsButton(){const e=this.state.isPollExpired?u.getString("Poll.SummaryButtonTextAfterExpiration"):u.getString("Poll.SummaryButtonTextBeforeExpiration");return o.createElement(o.Button,{style:T.details.button,accessibilityLabel:e,onPress:this._onViewPollDetails},o.createElement(C.BodyText,{style:T.details.text,bold:!0},e))}}t.default=M},634:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.QuoteOnly=t.QuoteNode=void 0;const i=s(96486),o=(s(31844),s(16778)),n=s(88837),r=s(34339),a=s(89391),l=s(21476),d=s(10117),c=s(76621),h=s(71830),u=s(16026),p=s(77381),g=s(39549),m=s(16402),S=s(52262),f=s(70891),y=s(5406),_=s(13944),v=s(15877),C=s(52859),b=s(33754),T=s(18078),M=s(29130),I=s(960),w=s(81760),P=s(11828),k=s(34528),A=(s(60305),(0,v.lazyProperties)({quoteContainer:()=>o.Styles.createViewStyle({flex:1,flexDirection:"column",backgroundColor:w.Color.transparent}),quoteContainerInDesktopComposer:()=>o.Styles.createViewStyle({flex:1,flexDirection:"row",marginRight:15}),quoteContainerInForwardCanvas:()=>o.Styles.createViewStyle({flex:1,flexDirection:"row",paddingBottom:12}),quoteSeparator:()=>o.Styles.createViewStyle({borderStyle:"solid",borderBottomWidth:1,marginBottom:5}),quoteSeparatorInChat:()=>o.Styles.createViewStyle({marginBottom:14}),openQuote:()=>o.Styles.createViewStyle({marginBottom:4,flexDirection:"row"}),quoteTextDesktopStyles:()=>o.Styles.createTextStyle({paddingRight:4}),quoteAttribute:()=>o.Styles.createTextStyle({marginTop:6,marginBottom:12}),quoteContentContainer:()=>o.Styles.createViewStyle({flex:1,paddingLeft:20}),quoteContentContainerInForwardCanvas:()=>o.Styles.createViewStyle({flex:1,paddingHorizontal:10}),quoteContentTextInComposer:()=>o.Styles.createViewStyle({flex:1,maxHeight:22,alignSelf:"stretch"}),quoteContentTextInStream:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),clearQuoteButton:()=>o.Styles.createButtonStyle({position:"absolute",top:4,right:0,marginTop:-5})}));class E extends p.default{constructor(){super(...arguments),this._onPressQuote=e=>{e.stopPropagation(),this.props.options.onPressInterceptionCallback?this.props.options.onPressInterceptionCallback():this.state.conversationIdForNavigation&&this.props.messageTimestamp&&this.props.options.onFollowQuoteLink&&this.props.options.onFollowQuoteLink(e,this.state.conversationIdForNavigation,this.props.messageTimestamp)},this._onLongPress=e=>{e.stopPropagation(),this.props.options.onLongPressContent&&this.props.options.onLongPressContent(e)}}_buildState(e,t){let s;if(e.authorSkypeId){const t=h.skypeIdToMri(e.authorSkypeId);t&&(s=S.default.getDisplayName(t))}s||(s=e.authorname||e.authorSkypeId);const i=b.getString("ContentToReactTransformer.QuoteNodeAttributeText",{name:s.trim(),date:m.default.getDisplayDateTimeString(e.timestamp)}),o=e.searchStore?e.searchStore.getSearchQuery():void 0;let n;n=o&&e.searchStore&&e.searchStore.isMessageInConvSearchResults(e.message.cuid)?(0,I.transformToHighlightedText)(i,o.query,e.searchStore.isMessageFocused(e.message.cuid),T.default.isMyMri(e.message.creator)):[i];const r=this._getRootViewId(),{enableReply:l}=a.default.getS4LMessagingFeaturesNoSubscription();return{attributeText:n,suppressAttribution:(e.options.renderOrigin,f.MessageRenderOrigin.ChatCanvas,e.options.renderOrigin===f.MessageRenderOrigin.ForwardCanvas),isSmallDevice:M.default.isSmallDevice(r),quoteSymbol:k.getQuoteSymbol(l),conversationIdForNavigation:this._getConverstionIdForNavigation(e)}}render(){let e;if(!this.props.options.onlyQuotedContent||this.props.options.renderOrigin===f.MessageRenderOrigin.ForwardCanvas){const t=i.compact([A.quoteSeparator,this.props.options.renderOrigin===f.MessageRenderOrigin.ChatCanvas?A.quoteSeparatorInChat:void 0,this.props.options.quoteSeparatorStyle]);e=o.createElement(o.View,{style:t,key:"quote.separator"})}const t=[this._getOpenQuote(),this._getQuoteContent()];let s,n=A.quoteContainer;this.props.options.renderOrigin===f.MessageRenderOrigin.ForwardCanvas?n=A.quoteContainerInForwardCanvas:this.props.options.renderOrigin!==f.MessageRenderOrigin.ChatCanvas&&(n=A.quoteContainerInDesktopComposer);const r=[f.MessageRenderOrigin.ForwardCanvas,f.MessageRenderOrigin.MessageComposerCanvas];return s=i.includes(r,this.props.options.renderOrigin)?o.createElement(o.View,{style:n,key:"quote.maybeclickable"},t):i.isUndefined(this.state.conversationIdForNavigation)?t:o.createElement(o.Button,{style:n,key:"quote.maybeclickable",onPress:this._onPressQuote,onLongPress:void 0,onContextMenu:this.props.onContextMenu,activeOpacity:this.props.options.activeOpacityOverride,disabled:this.props.options.disableActions,disabledOpacity:1},t),o.createElement(o.View,{style:A.quoteContainer},s,e,this._getQuoteCloseButton())}_getConverstionIdForNavigation(e){if(!e.conversationId||!e.messageTimestamp)return;if(T.default.isMyMri(e.conversationId))return e.options.message&&e.options.message.creator;const t=c.default.getConversationMetaFromMemoryCache(e.conversationId);if(t&&(0,g.default)().ableToViewConversation(e.conversationId)){if(!t.conv.isThread()){if(i.isUndefined(e.authorSkypeId)||i.isUndefined(e.options.message))return;if(!T.default.isMyMri(h.skypeIdToMri(e.authorSkypeId))&&!T.default.isMyMri(e.options.message.creator))return}return e.conversationId}}_getOpenQuote(){var e,t,s,i;return o.createElement(d.default,{key:"quote.open",icon:this.state.quoteSymbol,size:null!==(t=null===(e=this.props.options.quoteSymbolStyle)||void 0===e?void 0:e.size)&&void 0!==t?t:P.IconSize.size16,color:null!==(i=null===(s=this.props.options.quoteSymbolStyle)||void 0===s?void 0:s.color)&&void 0!==i?i:w.Color.black,style:A.openQuote,importantForAccessibility:o.Types.ImportantForAccessibility.NoHideDescendants})}_getQuoteContent(){const e=this.state.suppressAttribution?void 0:o.createElement(o.Text,{style:[A.quoteAttribute,this.props.options.textOverrideStyle,this.props.options.quoteAttributeStyle],key:"quote.author"},this.state.attributeText),t=this.props.options.renderOrigin===f.MessageRenderOrigin.ChatCanvas||this.props.options.renderOrigin===f.MessageRenderOrigin.ForwardCanvas||this.props.options.renderOrigin===f.MessageRenderOrigin.CallCanvas?A.quoteContentTextInStream:A.quoteContentTextInComposer,s=[this.props.options.textOverrideStyle,this.props.options.quotedTextStyle,A.quoteTextDesktopStyles],n=o.Children.toArray(this.props.children),a=i.some(n,(e=>!i.includes([o.Text,r.AnimatedEmoticon,C.default,l.default,y.HighlightedNode],e.type)))?o.createElement(o.View,null,this.props.children):o.createElement(o.Text,{style:s,numberOfLines:this.props.numberOfLines},this.props.children),d=this.props.options.renderOrigin===f.MessageRenderOrigin.ForwardCanvas?A.quoteContentContainerInForwardCanvas:A.quoteContentContainer;return o.createElement(o.View,{style:d,key:"quote.content"},o.createElement(o.View,{style:t},a),e)}_getQuoteCloseButton(){return this.props.options.renderOrigin!==f.MessageRenderOrigin.ChatCanvas&&this.props.options.onClearQuote?o.createElement(_.default,{style:A.clearQuoteButton,title:b.getString("MessageComposer.RemoveQuoteButtonTitle"),onPress:this.props.options.onClearQuote,size:P.IconSize.size16,color:w.Color.gray300,hoverColor:w.Color.black,icon:P.SkypeIcon.Cancel,disabled:this.props.options.disableActions}):void 0}}t.QuoteNode=E;class R extends n.ComponentBase{_buildState(e,t){return{quoteSymbol:k.getQuoteSymbol()}}render(){return o.createElement(u.ContentPlaceholder,{icon:this.state.quoteSymbol,label:b.getString("ContentToReactTransformer.QuoteIconPreviewLabel"),mediaPlaceholderIconColor:this.props.mediaPlaceholderIconColor,regularTextStyle:this.props.regularTextStyle,textOverrideStyle:this.props.textOverrideStyle})}}t.QuoteOnly=R},26143:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(74775),n=s(66265),r=s(16026),a=s(77381),l=s(33754),d=s(77914),c=s(22538),h=s(11828);class u extends a.default{_buildState(e,t){let s;if(c.HasStarted(d.default)){const i=t?e.options.message:void 0;s=d.default.getScheduledCallById(e.scheduledCallId,i)}return{scheduledCall:s}}render(){let e;return e=this.props.options.renderMedia&&this.state.scheduledCall&&this.props.options.onCallInviteAccepted&&this.props.options.onCallInviteDeclined?this.props.isSender?i.createElement(n.default,{scheduledCall:this.state.scheduledCall,message:this.props.options.message,onLongPress:this.props.options.onLongPressContent,messagePadding:this.props.options.messagePadding}):i.createElement(o.default,{scheduledCall:this.state.scheduledCall,onCallInviteAccepted:this.props.options.onCallInviteAccepted,onCallInviteDeclined:this.props.options.onCallInviteDeclined,message:this.props.options.message,onLongPress:this.props.options.onLongPressContent}):i.createElement(r.ContentPlaceholder,{icon:h.SkypeIcon.Schedule,label:l.getString("ContentToReactTransformer.ScheduledCallPreviewLabel"),mediaPlaceholderIconColor:this.props.options.mediaPlaceholderIconColor,regularTextStyle:this.props.options.regularTextStyle,textOverrideStyle:this.props.options.textOverrideStyle}),e}}t.default=u},60552:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(88837);class n extends o.ComponentBase{constructor(){super(...arguments),this._onPressed=()=>{this.props.onHighlightedTextPressed&&this.props.onHighlightedTextPressed(this.props.text,this.props.activityId)}}render(){return i.createElement(i.Text,{style:this.props.style,selectable:this.props.selectable,numberOfLines:this.props.numberOfLines,onPress:this._onPressed},this.props.children)}}t.default=n},88808:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(88837),n=s(70891),r=s(17873),a=s(16419);class l extends o.ComponentBase{constructor(){super(...arguments),this._onSwiftCardPressTelemetryCallback=()=>{r.default.potentiallyMarkItemViewed(this.props.message,this.props.options.renderOrigin)}}static getConstrainedWidth(e){return a.default.getConstrainedWidth(e)}render(){const e=this.props.options;return this.props.options.renderOrigin!==n.MessageRenderOrigin.CompositeGalleryCanvas&&this.props.options.renderOrigin!==n.MessageRenderOrigin.StackGalleryCanvas||(e.onSwiftCardPressTelemetryCallback=this._onSwiftCardPressTelemetryCallback),i.createElement(a.default,{swiftMessage:this.props.swiftMessage,options:e,postedByCurrentUser:this.props.postedByCurrentUser,conversationId:this.props.conversationId})}}t.default=l},27862:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(88837),n=s(16026),r=s(81959),a=s(86374),l=s(52262),d=s(70891),c=s(53559),h=s(33754),u=s(12762),p=s(11828);class g extends o.ComponentBase{_buildState(e,t){return{labelText:this._getLabelText(l.default.getDisplayName(e.creatorMri)),icon:this._getIcon()}}_getLabelText(e){let t;if(this.props.message){const s=a.decode(this.props.message).getFirstUriObjectChild(u.SwiftUriObjectNode);s&&(t=r.renderText(s,{message:this.props.message,processing:{quotes:d.ProcessingLevel.None,wikiMarkup:d.ProcessingLevel.Stripped},trimToFirstLine:!0}),"Card"===t&&(t=h.getString("SwiftCard.Card")),s.getCardType()===c.default.imageContentTypes.gif&&e&&(t=h.getString("ContentToReactTransformer.GifCardIconPreviewLabel",{creator:e})))}return t||(t=e?h.getString("ContentToReactTransformer.CardIconPreviewLabelLong",{creator:e}):h.getString("ContentToReactTransformer.CardIconPreviewLabelShort")),t}_getIcon(){if(this.props.message){const e=a.decode(this.props.message).getFirstUriObjectChild(u.SwiftUriObjectNode);if(e&&e&&e.getCardType()===c.default.imageContentTypes.gif)return p.SkypeIcon.Gif}return p.SkypeIcon.Card}render(){return i.createElement(n.ContentPlaceholder,{icon:this.state.icon,label:this.state.labelText,numberOfLines:1,allowTextSelection:!1,mediaPlaceholderIconColor:this.props.mediaPlaceholderIconColor,regularTextStyle:this.props.regularTextStyle,textOverrideStyle:this.props.textOverrideStyle})}}t.default=g},60562:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(89391),r=s(19061),a=s(16402),l=s(13991),d=s(52262),c=s(70891),h=s(46096),u=s(74313),p=s(53559),g=s(17873),m=s(10117),S=s(36237),f=s(61253),y=s(15877),_=s(40522),v=s(33754),C=s(51072),b=s(19089),T=s(6658),M=s(18078),I=s(17791),w=s(29130),P=s(960),k=s(4057),A=s(81760),E=s(11010),R=s(11828),L=s(78262),F=s(80837),x=s(19675),O=s(24576),D=s(65322),B=s(26712),V=s(91319),N=T.messageTextLineHeight,U=(0,y.lazyProperties)({removeBorder:()=>o.Styles.createViewStyle({borderWidth:0,borderColor:A.Color.transparent}),containerSmall:()=>o.Styles.createViewStyle({width:200}),containerRegular:()=>o.Styles.createViewStyle({width:300}),thumbnailRegular:()=>o.Styles.createViewStyle({width:300,height:150}),thumbnailRegularHeightOnly:()=>o.Styles.createViewStyle({height:150}),thumbnailSmall:()=>o.Styles.createViewStyle({width:200,height:125}),thumbnailBackgroundStyle:()=>o.Styles.createViewStyle({backgroundColor:A.Color.gray200}),thumbnailObfuscated:()=>o.Styles.createViewStyle({justifyContent:"center",alignItems:"center"}),cardTitle:()=>o.Styles.createTextStyle({paddingHorizontal:10,marginTop:10,lineHeight:N}),titleTextMaxHeight:()=>o.Styles.createTextStyle({maxHeight:2*N}),titleTextMaxHeightLarge:()=>o.Styles.createTextStyle({maxHeight:3*N}),cardDescription:()=>o.Styles.createTextStyle({paddingHorizontal:10,marginTop:4}),descriptionTextMaxHeight:()=>o.Styles.createTextStyle({lineHeight:16,maxHeight:32}),descriptionTextMaxHeightLarge:()=>o.Styles.createTextStyle({lineHeight:16,maxHeight:96}),footer:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"flex-start",marginTop:7,marginBottom:12,paddingHorizontal:12}),reactionOverlayedFooter:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"flex-start",marginTop:7,marginBottom:24,paddingHorizontal:12}),footerText:()=>o.Styles.createTextStyle({flex:1,marginLeft:4}),favIcon:()=>o.Styles.createViewStyle({height:16,width:16}),linkStyle:()=>o.Styles.createTextStyle({fontSize:14,lineHeight:N,color:A.Color.blue,fontFamily:E.default.fontFamily.uidDisplayRegular,paddingHorizontal:12,paddingVertical:7})});class H extends O.default{constructor(){super(...arguments),this._maxGifFileSizeForIOs=n.default.getConfigSettings().urlPreview.gifSizeLimitInBytes,this._onPress=e=>{g.default.potentiallyMarkItemViewed(this.props.message,this.props.renderOrigin);let t={conversationId:this.props.message.conversationId};if(b.default.isPiPEnabled()){const e=V.default.getYoutubeVideoPropsFromUrlPreviewData(this.props.urlPreviewData);if(e)return void b.default.setContentProps(e)}t.preventInAppNavigationForGuest=!r.default.canNavigateInApp(),_.openUrlWithParams({origin:h.BrowserOrigin.LinkNode,url:this.props.urlPreviewData.url,options:t,rootViewId:this._getRootViewId()}),S.track(new D.UrlPreviewClickTelemetry(this.props.urlPreviewData.url,this.props.message))},this._onLongPress=e=>{this.props.onLongPress&&this.props.onLongPress(e,this.props.urlPreviewData.url)},this._onFavIconError=e=>{this._shouldInstrument()&&(S.warn(h.LogTraceArea.LinkNode,"Failed to load the favicon"+k.default.errorAsString(e)),S.track(new D.UrlPreviewImageFailureTelemetry(this.props.urlPreviewData.urlPreviewMetadata.favicon,e?e.name:"<noErr>",D.UrlPreviewActionType.LoadFaviconFailure)))},this._onThumbnailError=e=>{this._shouldInstrument()&&(S.warn(h.LogTraceArea.LinkNode,"Failed to thumbnail the favicon"+k.default.errorAsString(e)),S.track(new D.UrlPreviewImageFailureTelemetry(this.props.urlPreviewData.urlPreviewMetadata.thumbnail,e?e.name:"<noErr>",D.UrlPreviewActionType.LoadThumbnailFailure)))}}_buildState(e,t){let s={wasCreatedByCurrentUser:M.default.isMyMri(e.message.creator)};const i=e.urlPreviewData.urlPreviewMetadata;if((i||e.obfuscate)&&(s.senderDisplayName=d.default.getMemberShortNameForConversation(e.message.conversationId,e.message.creator)),i){const t=v.getString("AccessibilityLabel.UrlPreview",{previewTitle:e.urlPreviewData.urlPreviewMetadata.title||"",previewDescription:e.urlPreviewData.urlPreviewMetadata.description||""}),i={senderName:s.senderDisplayName||"",timestamp:a.default.getDisplayTimeString(e.message.createdTime),messageContent:t};s.accessibilityLabel=v.getString("AccessibilityLabel.MediaMessage",i)}s.responsiveWidth=this._getContext().isPresentedInDesktopSubview?L.ResponsiveWidth.MinDesktop:w.default.getResponsiveWidth(this._getRootViewId()),s.showReactionsOverlay=n.default.getS4LMessagingFeatures().enableReactionOverlays;const o=e.searchStore?e.searchStore.getSearchQuery():void 0,r=B.default.getDomainName(e.urlPreviewData.url);let l;if(r&&(l=o&&e.searchStore&&e.searchStore.isMessageInConvSearchResults(e.message.cuid)?(0,P.transformToHighlightedText)(r,o.query,e.searchStore.isMessageFocused(e.message.cuid),!!s.wasCreatedByCurrentUser):[r]),s.domainName=l,e.urlPreviewData.urlPreviewMetadata){let t,i=e.urlPreviewData.urlPreviewMetadata.title;i=e.obfuscate?v.getString("StreamItem.LinkNodeObfuscatedTitle",{userName:s.senderDisplayName||""}):i&&i.trim(),i&&(t=o&&e.searchStore&&e.searchStore.isMessageInConvSearchResults(e.message.cuid)?(0,P.transformToHighlightedText)(i,o.query,e.searchStore.isMessageFocused(e.message.cuid),!!s.wasCreatedByCurrentUser):[i]),s.title=t}return s}_getStyles(){const e=this.props.renderOrigin===c.MessageRenderOrigin.StackGalleryCanvas;return this.props.renderOrigin===c.MessageRenderOrigin.CompositeGalleryCanvas?{container:void 0,thumbnail:U.thumbnailRegularHeightOnly,maxTitleHeight:U.titleTextMaxHeight,maxDescriptionHeight:U.descriptionTextMaxHeight}:{container:e?void 0:(0,f.default)(this.props.renderDimensions,l.UrlPreviewNodeSizes.Small)?U.containerSmall:U.containerRegular,thumbnail:(0,f.default)(this.props.renderDimensions,l.UrlPreviewNodeSizes.Small)?U.thumbnailSmall:U.thumbnailRegular,maxTitleHeight:this.state.responsiveWidth===L.ResponsiveWidth.Large?U.titleTextMaxHeightLarge:U.titleTextMaxHeight,maxDescriptionHeight:this.state.responsiveWidth===L.ResponsiveWidth.Large?U.descriptionTextMaxHeightLarge:U.descriptionTextMaxHeight}}render(){const e=this._getStyles(),t=[U.removeBorder,this._themeStyles.cardColorStyle,e.container,this.props.style],s=this.props.urlPreviewData.urlPreviewMetadata;let n,r,a,l,d;s&&(n=s.description,r=s.favicon,a=s.thumbnail,l=s.content_type,d=Number(s.size));const c=l&&p.default.isImageMimeType(l);let g,f,y;if(this.state.title?g=o.createElement(x.CardTitle,{style:[U.cardTitle,e.maxTitleHeight],allowFontScaling:!1,numberOfLines:2},this.state.title):c||n||(g=o.createElement(o.Link,{style:[U.linkStyle,this._themeStyles.linkTextColorStyle],url:this.props.urlPreviewData.url,onPress:this._onPress,selectable:!0},this.props.urlPreviewData.url)),n||this.props.obfuscate){const t=this.props.obfuscate?v.getString("StreamItem.LinkNodeObfuscatedDescription"):n&&n.trim();f=o.createElement(x.Caption,{style:[U.cardDescription,e.maxDescriptionHeight],allowFontScaling:!1,numberOfLines:2},t)}const _=o.createElement(o.View,null,o.createElement(m.default,{icon:R.SkypeIcon.Link,size:R.IconSize.default,color:A.Color.gray300,style:F.default.flexOne})),b=i.compact([U.removeBorder,e.thumbnail,U.thumbnailBackgroundStyle,this.props.thumbnailRadiusStyle]);if(this.props.obfuscate){const e=[b,U.thumbnailObfuscated];y=o.createElement(o.View,{style:e},_)}else if(a){l===p.default.imageContentTypes.gif&&S.log(h.LogTraceArea.LinkNode,"Rendering a gif in link preview of size "+d);const t=o.Styles.createImageStyle({overlayColor:this._themeColors.messageStreamBackgroundColor},!1);y=o.createElement(u.default,{origin:"LinkThumbnailUrlp",key:"thumbnail",style:[e.thumbnail,t,this.props.thumbnailRadiusStyle],containerStyle:b,source:a,altView:_,errorView:_,onError:this._onThumbnailError,resizeMode:"cover"})}const T=o.createElement(m.default,{icon:R.SkypeIcon.Link,size:R.IconSize.size16,color:A.Color.gray300}),M=o.createElement(o.View,{style:[this.state.showReactionsOverlay&&this.props.message.hasReactions()&&this.props.urlPreviewOnly?U.reactionOverlayedFooter:U.footer]},o.createElement(u.default,{origin:"LinkFaviconUrlp",key:"favicon",style:U.favIcon,containerStyle:U.favIcon,source:r,altView:T,errorView:T,onError:this._onFavIconError,resizeMode:"cover"}),o.createElement(x.Caption,{style:U.footerText,allowFontScaling:!1,numberOfLines:1},this.state.domainName));return o.createElement(C.default.Button,{style:t,onPress:this._onPress,onLongPress:this._onLongPress,accessibilityLabel:this.state.accessibilityLabel,title:this.props.urlPreviewData.url,activeOpacity:this.props.activeOpacityOverride,keepOriginalProps:!0,onContextMenu:this.props.onContextMenu,disabled:this.props.disableActions,disabledOpacity:1},o.createElement(o.View,{style:U.removeBorder,onLayout:this.props.onLayout},y,g,f,M))}_shouldInstrument(){return this.isComponentMounted()&&I.default.isNetworkingAvailable()}}t.default=H},5451:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(60014),o=s(16778),n=s(44770),r=s(89391),a=s(51077),l=s(3291),d=s(46096),c=s(74313),h=s(39285),u=s(10117),p=s(36237),g=s(15877),m=s(33754),S=s(51072),f=s(33596),y=s(42036),_=s(18078),v=s(44487),C=s(81760),b=s(11828),T=s(80837),M=s(19675),I=s(24576),w=s(15188),P=s(78194),k=s(75865),A=s(26712),E=(0,g.lazyProperties)({thumbnailContainer:()=>o.Styles.createButtonStyle({flex:1,alignSelf:"stretch",justifyContent:"center",alignItems:"center",flexDirection:"row"}),overlayContainer:()=>o.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,alignItems:"center",justifyContent:"center"}),overlayContainerBackground:()=>o.Styles.createViewStyle({backgroundColor:C.Color.blackOverlay10}),videoContainerHidden:()=>o.Styles.createViewStyle({opacity:0}),actionButtonborderStyle:()=>o.Styles.createViewStyle({backgroundColor:C.Color.blackOverlay10,borderRadius:b.IconSize.size60/2,borderStyle:"solid",borderWidth:2,borderColor:C.Color.white,alignItems:"center",justifyContent:"center",width:b.IconSize.size60,height:b.IconSize.size60}),playButtonBorderDraggableThumbnailStyle:()=>o.Styles.createViewStyle({borderWidth:1,borderRadius:b.IconSize.size30/2,width:b.IconSize.size30,height:b.IconSize.size30,shadowColor:C.Color.black,shadowRadius:2,backgroundColor:C.Color.blackOverlay10}),alternateViewContainer:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center",backgroundColor:C.Color.gray200}),backgroundImage:()=>o.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,bottom:0,opacity:.5}),nodeContainer:()=>o.Styles.createViewStyle({alignItems:"center",justifyContent:"center"}),callRecordingFooterText:()=>o.Styles.createTextStyle({textAlign:"center"}),callRecordingFooterContainer:()=>o.Styles.createViewStyle({flexGrow:1,flexShrink:1,paddingHorizontal:5}),uploadProgressFooterContainer:()=>o.Styles.createViewStyle({flexGrow:1,flexShrink:1}),footerTextAlignRight:()=>o.Styles.createViewStyle({alignItems:"flex-end"}),draggableThumbnailContainer:()=>o.Styles.createViewStyle({alignItems:"center",justifyContent:"center",width:60,height:60,shadowRadius:1,shadowOffset:{width:0,height:2},shadowColor:C.Color.blackOverlay20,borderRadius:10,borderWidth:1})});class R extends I.default{constructor(){super(...arguments),this._onLocalThumbnailError=()=>{this._onError(this.state.localUrl)},this._onThumbnailError=()=>{this._onError(this.props.thumbnailUrl)},this._onThumbnailLoad=()=>{this.setState({thumbnailLoaded:!0})},this._onPress=e=>{this.state.sendingFailed&&this.props.isRetryCommandSupported?(this._onRetryClick(),e.stopPropagation()):this.props.onPress&&this.props.onPress(e)},this._onDragStartVideo=e=>{l.default.addDragAndDropFileInformation(e,this.props.message)}}_buildState(e,t){let s={contentUrl:k.default.getAuthenticatedUrl(e.contentUrl),thumbnailUrl:k.default.getAuthenticatedUrl(e.thumbnailUrl),wasCreatedByCurrentUser:_.default.isMyMri(e.authorMri),callRecorderRetentionDurationDays:r.default.getS4LCMCFeatures().callRecorderRetentionDurationDays,sendingFailed:e.message.isSendRejected(),isSelectMessagesModeActive:v.default.isSelectMessagesModeActive(this._getRootViewId())};return t&&(s.isVideoHidden=!1),A.default.isFileOrBlob(e.thumbnailUrl)?(s.isUploading=!0,s.localUrl=e.thumbnailUrl,s.showAltView=!0):s.isUploading=!1,s}componentDidMount(){super.componentDidMount(),this.props.onMountContent&&this.props.onMountContent("VideoNode",this,!0)}componentWillUnmount(){super.componentWillUnmount(),this.props.onMountContent&&this.props.onMountContent("VideoNode",this,!1)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),t.isUploading&&!this.state.isUploading&&this.setState({showAltView:!1})}hideNode(){this.isComponentMounted()&&(this.setState({isVideoHidden:!0}),this.props.onHideContent&&this.props.onHideContent())}showNode(){this.isComponentMounted()&&(this.setState({isVideoHidden:!1}),this.props.onShowContent&&this.props.onShowContent())}render(){let e=f.getStyleForDimensions(this.props.renderDimensions);const t=f.getStyleForDimensions({width:this.props.renderDimensions.width,height:void 0}),s=o.createElement(o.View,{style:E.alternateViewContainer},o.createElement(o.Image,{style:E.backgroundImage,resizeMode:"cover",source:n.Collection.WIGGLE_PATTERN_350})),r=o.createElement(o.View,{style:E.alternateViewContainer},o.createElement(o.Image,{style:E.backgroundImage,resizeMode:"cover",source:n.Collection.WIGGLE_PATTERN_350}));let a,l,d,p;if(this.state.thumbnailUrl){let t=[E.overlayContainer,e,this.props.containerRadiusStyles];if(this.state.isVideoHidden&&t.push(E.videoContainerHidden),this.state.thumbnailLoaded){const e=[T.default.absoluteFill,this.props.containerRadiusStyles,E.overlayContainerBackground];d=o.createElement(o.View,{style:e})}const i=[f.defaultStyles.pictureDefaultThumbnail,e,this.props.containerRadiusStyles],n=[t,this.props.containerRadiusStyles];this.state.localUrl&&(l=o.createElement(c.default,{origin:"VideoNodeLocalThumbnail",key:"localImage",style:i,containerStyle:n,source:this.state.localUrl,altView:s,errorView:r,onError:this._onLocalThumbnailError,onLoad:this._onThumbnailLoad,resizeMode:"cover"})),a=o.createElement(c.default,{origin:"VideoNodeThumbnail",style:i,containerStyle:n,source:this.state.thumbnailUrl,altView:l||s,errorView:r,onError:this._onThumbnailError,onLoad:this._onThumbnailLoad,resizeMode:"cover",showAltView:this.state.showAltView})}let g=this._isVideoCurrentlyBeingSent();this.state.sendingFailed&&(g=!1),g&&this.state.contentUrl&&(p=o.createElement(h.default,{style:[E.overlayContainer,this.props.containerRadiusStyles]},o.createElement(w.default,{contentUrls:[this.state.contentUrl],strokeColor:C.Color.white,size:b.IconSize.size60,showFiniteProgressIndicatorUI:!0,isUploadingCompleted:!this.state.isUploading})));const y=o.createElement(o.View,{style:E.actionButtonborderStyle},o.createElement(u.default,{icon:this.state.sendingFailed&&!this.props.isPresentedInAlbum?b.SkypeIcon.Reload:b.SkypeIcon.Play,size:b.IconSize.size24,color:C.Color.white})),_=g||this.state.sendingFailed&&!this.props.isRetryCommandSupported?void 0:o.createElement(i.DragDroppableView,{style:[E.overlayContainer,this.props.containerRadiusStyles],onDragStart:this.props.isDraggingEnabled&&!this.state.sendingFailed?this._onDragStartVideo:void 0,dragThumbnailElement:this.props.isDraggingEnabled&&!this.state.sendingFailed?this._getDraggableThumbnailElement():void 0},y),v=this.state.sendingFailed?m.getString("VideoNode.RetrySendAction"):m.getString("VideoNode.OpenVideoTitle");let M=o.createElement(S.default.Button,{key:"video",style:[E.thumbnailContainer,e,this.props.containerRadiusStyles],title:v,onLongPress:this.props.onLongPress,onContextMenu:this.props.onContextMenu,activeOpacity:this.props.activeOpacityOverride,onPress:this._onPress,keepOriginalProps:!0,disabled:this.props.disableActions,disabledOpacity:1,importantForAccessibility:this.state.isSelectMessagesModeActive?o.Types.ImportantForAccessibility.No:void 0},a,d,p,_);this.props.isPresentedInAlbum&&(M=o.createElement(o.View,{key:"video",style:[E.thumbnailContainer,e,this.props.containerRadiusStyles],title:v},a,d,y));let I=this._renderFooterView();if(!I)return M;let P=[];if(this._shouldShowCallRecordingFooter()){const e=f.getStyleForDimensions({width:this.props.renderDimensions.width,height:void 0});P=[E.nodeContainer,e]}return o.createElement(o.View,{style:[P,t]},M,I)}_isVideoCurrentlyBeingSent(){return this.state.isUploading||this.props.isMessageInSendingState}_renderFooterView(){let e;if(this.state.sendingFailed){const t=this.props.isRetryCommandSupported?m.getString("MediaNode.SendingFailed"):m.getString("MediaNode.MediaNotAvailableForSending");return e=o.createElement(h.default,{style:[E.uploadProgressFooterContainer,this.state.wasCreatedByCurrentUser?E.footerTextAlignRight:void 0]},o.createElement(M.Caption,null,t)),e}if(this.state.contentUrl&&this.state.isUploading&&!this.props.isPresentedInAlbum)return e=o.createElement(h.default,{style:[E.uploadProgressFooterContainer,this.state.wasCreatedByCurrentUser?E.footerTextAlignRight:void 0]},o.createElement(P.default,{contentUrl:this.state.contentUrl,fileSizeInBytes:this.props.fileSizeInBytes})),e;if(this._shouldShowCallRecordingFooter()){const t=o.createElement(M.Caption,{style:E.callRecordingFooterText,allowFontScaling:!1},m.getString("VideoNode.CallRecordingAvailabilityMessage",{numberOfDays:this.state.callRecorderRetentionDurationDays}));e=o.createElement(o.View,{style:E.callRecordingFooterContainer},t)}return e}_shouldShowCallRecordingFooter(){return this.props.subType&&this.props.subType===a.UriObjectTypeSubTypes.Video.CallRecording}_onError(e){p.warn(d.LogTraceArea.GenericUnsafe,"Failed to load image for VideoNode: "+e)}_onRetryClick(){y.default.retryFailedSend(this.props.message)}_getDraggableThumbnailElement(){return o.createElement(o.Image,{source:this.props.thumbnailUrl,style:[E.draggableThumbnailContainer,this._themeStyles.dividerBorderColorStyle]},o.createElement(o.View,{style:[E.actionButtonborderStyle,E.playButtonBorderDraggableThumbnailStyle]},o.createElement(u.default,{icon:b.SkypeIcon.Play,size:b.IconSize.size10,color:C.Color.white})))}}t.default=R},25739:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MenuItem=void 0;const i=s(96486),o=s(89391),n=s(98925),r=s(90239),a=s(71830),l=s(33754),d=s(49769),c=s(40363),h=s(92772);var u;!function(e){e.Settings="settings",e.SendSMS="sendsms",e.PrivateConversation="privateconversation",e.NewGroup="newgroup",e.Translate="translate",e.ShareLink="sharelink",e.AddParticipants="addparticipants",e.Gallery="gallery"}(u=t.MenuItem||(t.MenuItem={}));let p=new class{constructor(){this._validateMenuItem=(e,t)=>{switch(e){case u.Settings:case u.ShareLink:case u.AddParticipants:return!0;case u.SendSMS:return t.otherPartyMri&&t.canShowSmsEntryPoint&&d.default.canSendSMSToMri(t.otherPartyMri);case u.PrivateConversation:return t.otherPartyMri&&!t.isEncryptedThread&&t.otherPartyMri!==c.default.getEchoMri()&&!a.isAgent(t.otherPartyMri)&&!a.isPhoneMri(t.otherPartyMri);case u.NewGroup:return!t.isEncryptedThread;case u.Translate:return t.otherPartyMri&&!t.isEncryptedThread&&t.createTranslatedChatEnabled&&t.hasTranslatorAgentId&&!t.isTranslatorMriBlocked}return!1}}accessibilityLabel(e,t,s,i){let o=l.getString("ContentPanelHeader.ProfileButtonAccessibilityLabel",{conversationName:e.conversationName})+", ";if(e.isEncryptedThread&&(o+=l.getString("ContentPanelHeader.PrivateConversationLabel")+", "),!t)if(s&&e.userPresence){const t=h.accessibilityLabelForUserStatus(e.userPresence);t&&(o+=t+", "),e.moodLabel?o+=e.moodLabel+", ":e.moodRawText?o+=l.getString("ContentPanelHeaderTitle.MoodMessageWrapper",{moodMessage:e.moodRawText})+", ":e.isUserActive||e.userPresence.status===r.UserStatus.Busy||e.isEncryptedThread||(o+=a.getLastSeenPresenceText(e.userPresence,!1,e.gender,e.isUserActive,!0),o+=", ")}else e.memberCount&&(i&&e.callRateText&&(o+=e.callRateText+", "),e.isOneOnOne||(o+=l.getString("ContentPanelHeaderTitle.ParticipantsLowercase",{count:e.memberCount})+", "));return o+=l.getString("UserProfilePanel.ViewProfileLabel"),o}callingDisabledTooltip(e){let t;switch(e){case n.CallValidationFailureReason.GroupTooLarge:t=l.getString("ContentPanelHeader.CallDisabledToolTip");break;case n.CallValidationFailureReason.RegularMemberInModeratedGroup:t=l.getString("ContentPanelHeader.CallDisabledModeratedToolTip");break;case n.CallValidationFailureReason.PlatformNotSupported:t=l.getString("ContentPanelHeader.PlatformNotSupportedTooltip");break;case n.CallValidationFailureReason.E2eeHandshakeIncomplete:case n.CallValidationFailureReason.GogoNetwork:default:t=void 0}return t}getMenuItems(e){if(e.isMriBlocked)return[];const t=o.default.getS4LUiFeaturesNoSubscription().contextHeaderDropdownActions,s=[];return i.each(e.otherPartyMri?t.oneOnOne:t.group,(t=>{this._validateMenuItem(t,e)&&s.push(t)})),s}getPresenceStatusForIcon(e,t){return e?r.UserStatus.Online:h.getMappedStatusIfValid(t)}};t.default=p},96539:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationsListHelper=t.ConversationListItemNames=t.engagementBannerModernizedHeight=t.engagementBannerHeight=void 0;const i=s(96486),o=s(31844),n=s(2604),r=s(34828),a=s(16778),l=s(44770),d=s(89391),c=s(94224),h=s(71830),u=s(96418),p=s(80128),g=s(98278),m=s(75760),S=s(31751),f=s(20770),y=s(92758),_=s(39549),v=s(31761),C=s(46172),b=s(72822),T=s(56280),M=s(68894),I=s(70942),w=s(46096),P=s(72146),k=s(36237),A=s(33754),E=s(3088),R=s(66127),L=s(34537),F=s(44285),x=s(93486),O=s(57538),D=s(16492),B=s(91659),V=s(12944),N=s(4735),U=s(46068),H=s(81736),z=s(28377),W=s(82052),j=s(68794),G=s(93003),K=s(29130),q=s(14976),Q=s(51070),X=s(70919),$=s(10541),J=s(40363),Y=s(11828),Z=s(78262),ee=s(60305),te=s(18037),se=s(88117),ie=s(67977),oe=s(21788);t.engagementBannerHeight=60,t.engagementBannerModernizedHeight=88;const ne=[M.EngagementBannerType.SyncContacts],re={searchBar:"clp_searchBar",header:"clp_header_",oneOnOneConv:"clp_1:1",groupChat:"clp_groupChat",topSpacer:"clp_topSpacer",itemSpacer:"clp_itemSpacer",bottomSpacer:"clp_bottomSpacer",notificationsPrompt:"clp_notificationsPrompt",emptyState:"clp_emptyState",finishSetupPrompt:"clp_finishSetupPrompt",nativeAd:"clp_nativeAd",loadingIndicator:"clp_loadingIndicator",engagementBanner:"clp_engagementBanner"};t.ConversationListItemNames=re;const ae=e=>e=>e.isOneOnOne()&&d.default.getS4LMessagingFeaturesNoSubscription().enableGroupedConversations?S.default.isGroupMarkedAsFavorite(e.id):e.isFavorite(),le=e=>ne.includes(e);class de{constructor(e,t,s){this._shownConversations=[],this._recentConversations=[],this._archivedConversations=(0,_.default)().getSortedArchivedConversations(),this._rowSize=W.default.recentRowSizeAndChanges(),this._contentSizeMultiplier=K.default.getContentSizeMultiplier(),this._onboardingFeatures=d.default.getOnboardingFeatures(),this._conversationSorter=e=>{let t=0;const s=f.default.getSavedMessageInput(e.id);s&&s.timestamp?t=s.timestamp:d.default.getS4LMessagingFeatures().enableMediaPreviewDrafts&&(t=E.default.getDraftPreviewTimestamp(e.id)||0);const o=(0,_.default)().getFakeTimestamp(e.id),n=e.getTimestamp();return-(i.max([o,t,n])||0)},this._rootViewId=e,this._isUsingStackNavigationContext=t,this._isPresentedInDesktopLeftNav=s}getShownConversationsCount(){return this._shownConversations.length}getFavoritesCount(){return i.filter(this._shownConversations,(e=>e.isFavorite())).length}_partitionConversationBasedOnSort(e,t,s,o){let n=[],r=[];const a=this._recentConversations;switch(s){case G.RecentsSortBy.Time:if(t){const e=i.partition(a,ae());n=e[0],r=e[1]}else r=a;return this._normalizeResults([],n,r);case G.RecentsSortBy.Unread:const s=m.default.getConversationsWithUnreadCounts(),l=t=>{const i=d.default.getS4LMessagingFeatures();if(f.default.getDraftTimestampForConversation(t.id))return!0;if(i.enableMediaPreviewDrafts&&E.default.getDraftPreviewTimestamp(t.id))return!0;if(this._isUsingStackNavigationContext)return s[t.id]&&!t.isMuted();return o===t.id&&e===o&&!t.isMuted()||s[t.id]&&!t.isMuted()};if(t){const e=i.partition(a,ae()),t=i.partition(e[0],l),s=t[0].concat(t[1]),o=i.partition(e[1],l);n=s,r=o[0].concat(o[1])}else{const e=i.partition(a,l);r=e[0].concat(e[1])}return this._normalizeResults([],n,r);case G.RecentsSortBy.Active:const c=oe.default.getActiveUserMris(),[h,u]=i.partition(a,(e=>c[e.id])),[p,g]=i.partition(u,ae());return this._normalizeResults(h,p,g);default:return[]}}_normalizeResults(e,t,s){return i.map([e,t,s],(e=>this._mapConversationsToIds(S.default.filterGrouped1on1s(e))))}_mapConversationsToIds(e){return i.map(e,(e=>e.id))}isAnyConversationArchived(){return!i.isEmpty(this._archivedConversations)}_getListItemHeight(e,t,s){const i=Math.min(this._contentSizeMultiplier,g.MaxContentSizeMultiplier),o=K.default.isMobileScreenSize(this._rootViewId)&&!ee.default.useTabletUI()&&!C.default.collapseDesktopStackNavContext(),n=this._isUsingStackNavigationContext?0:5;if(this._rowSize===G.RowSize.ExtraCompact)return 36*(i||1);if(this._rowSize===G.RowSize.Compact){return(this._isUsingStackNavigationContext?56:40)*(i||1)+n}{const r=e&&!t?50:o?35:44,a=e&&!t?s?26:28:10,l=e&&!t?s?76:78:o?35:55;return Math.max(l,r+n+Math.round(a*i))}}_mapConversationsToListItem(e,t=[],s,o,n,r,a,l,d,c,h=(e=>!1)){return i.flatten(i.map(e,((e,i)=>{const u=!!o&&this._isSelected(e,t,s,o),p=[this._allocateListItem(e,i,h(i),u,n,l,d,c)];return r&&p.push(this._getItemSpacer(2,a.idx++)),p})))}_allocateListItem(e,t,s,i,o,n,r,l){let d;return J.default.isElectronOsx()&&(d=A.getString("ConversationsListItem.ConversationItemLabel")),{key:e,height:this._getListItemHeight(o,n,r),index:t,isLastItem:s,isNavigable:!0,template:h.isThread(e)?re.groupChat:re.oneOnOneConv,isUsingStackNavigationContext:this._isUsingStackNavigationContext,itemHeight:-1,useMobileView:o,isSelected:i,rowSize:this._rowSize,useCompactIcon:l,ariaRoleDescription:d,accessibilityTrait:a.Types.AccessibilityTrait.Button,obfuscatedKeyForLogging:q.mriOrId(e)}}_isSelected(e,t,s,o){if(e===o)return!0;if(d.default.getS4LMessagingFeaturesNoSubscription().enableGroupedConversations){const n=i.find(s,(t=>t.id===e));if(n&&n.isOneOnOne()&&!n.hasActiveCall()){const e=(0,_.default)().getConversation(o);if(e&&e.isOneOnOne()&&!e.hasActiveCall()&&!i.some(t,(t=>t===e.id||t===n.id)))return!0}}return!1}_getTopInset(e){return{key:re.topSpacer,height:e,template:re.topSpacer,isNavigable:!1}}_getItemSpacer(e,t){return{key:re.itemSpacer+t,height:e,template:re.itemSpacer,isNavigable:!1}}_getBottomPadding(e){return{key:re.bottomSpacer,height:e,template:re.bottomSpacer,isNavigable:!1}}_getNotificationsPrompt(e){let t=this._getNotificationPromptListItemHeight(e);return{key:re.notificationsPrompt,height:t,template:re.notificationsPrompt}}_getNotificationPromptListItemHeight(e){let t=144;return t=K.default.getDeviceOrientation(this._rootViewId)===o.DeviceOrientation.Landscape?71:e||this._isPresentedInDesktopLeftNav?U.default.containsLargeContent()?190:160:144,t*Math.min(this._contentSizeMultiplier||1,g.MaxContentSizeMultiplier)}_getLoadingIndicator(e,t,s){return{key:re.loadingIndicator,height:this._getListItemHeight(e,t,s),template:re.loadingIndicator,isUsingStackNavigationContext:this._isUsingStackNavigationContext,measureHeight:!1,isNavigable:!1}}_getSearchBar(e,t){const s=p.default.useIOSSearchStyles(),i=t?X.SearchInputHeight.modernizedSmall:s?X.SearchInputHeight.iOS:K.default.isSmallDevice(this._rootViewId)?X.SearchInputHeight.small:X.SearchInputHeight.default;return{key:re.searchBar,height:i,template:re.searchBar,isUsingStackNavigationContext:this._isUsingStackNavigationContext,showFilterIcon:!!e,useIOSSearchStyles:s,theme:te.default.colorTheme(),safeAreaHorizontalInsets:this.getSafeAreaHorizontalInsets(t)}}_getFinishSetupPrompt(e){return{key:re.finishSetupPrompt,height:e||this._isPresentedInDesktopLeftNav?160:144,template:re.finishSetupPrompt}}_getEngagementBanner(e){return{key:re.engagementBanner,height:le(e)?t.engagementBannerModernizedHeight:t.engagementBannerHeight,template:e}}getSafeAreaHorizontalInsets(e){const t=L.default.getRowPadding(e),s=i.clone(Q.default.horizontalInsets());return s.left&&(s.left=Math.max(s.left-(this._isUsingStackNavigationContext?t.left:t.leftDesktop),0)),s.right&&(s.right=Math.max(s.right-(this._isUsingStackNavigationContext?t.right:t.rightDesktop),0)),s}_getRecentsViewModeType(e){let t=y.ConversationsListMode.AllConversations;return this._isUsingStackNavigationContext?e&&(t=e):t=y.default.getConversationsListMode(),t}_createSectionHeader(e,t,s){const i=A.getString(e);return{key:re.header+e,height:t?L.default.getCategoryHeaderHeight():s?L.default.getCategoryHeaderHeight(s):this._isPresentedInDesktopLeftNav?30:40,template:re.header,title:i,isNavigable:!1,accessibilityGroup:r.Types.AccessibilityGroupMarker.Begin,accessibilityGroupLabel:i,accessibilityTrait:a.Types.AccessibilityTrait.None}}_createSectionHeaderSpacer(e){return{key:re.header+e,height:20,template:re.header,title:"",isNavigable:!1,isHoverable:!1}}_getIconSize(e,t,s,i,o){return e===G.RowSize.Compact||e===G.RowSize.ExtraCompact||i?s?ie.AvatarIconSize.Size40:ie.AvatarIconSize.Size24:t&&!o?ie.AvatarIconSize.Size60:s?ie.AvatarIconSize.Size40:ie.AvatarIconSize.Size36}_getBaseAdHeight(e){return e.adsType===T.AdsType.PanelBanner?80:e.provider===T.AdsProvider.MeetNow&&e.adsType===T.AdsType.ListItem?140:e.adsType===T.AdsType.ListItemNarrow?78:154}_createNativeAdItem(e,t,s,i,o){const n=d.default.getAdsFeatures().placementSettings.conversationList,r=t||300,l=this._getIconSize(this._rowSize,s,!!this._isUsingStackNavigationContext,!!i,o),c=B.default.calculateConversationListNativeAdDimensions(r,this._getBaseAdHeight(e),this._getListItemHeight(s,o),B.default.includeMediaInAdHeight(e),l,se.default.getIconSize(l).user,n.dynamicDimensionsSettings,o);return{key:re.nativeAd,adsGuid:e.guid,adGuid:e.ads[0],isLastItem:!1,height:c.totalHeight,dimensions:c,placementId:n.placementIds[0],template:re.topSpacer,accessibilityTrait:a.Types.AccessibilityTrait.Group,accessibilityLabel:A.getString("NativeAd.AdAccessibilityLabel"),isUsingStackNavigationContext:!!this._isUsingStackNavigationContext,canHide:n.canHide,provider:e.provider,adType:e.adsType}}_insertNativeAdIntoList(e,t,s,i,o,n,r,a,l,c){const h=d.default.getAdsFeatures().placementSettings.conversationList,u=n||K.default.getHeight(this._rootViewId),p=this._createNativeAdItem(s,r,a,l,c),g=B.default.calculateNativeAdsPositionInListView({maxHeight:u,items:e,startPosition:i,additionalGroupsStartPositions:o,nativeAdsHeight:p.height,adsConfig:h});g===e.length?this._pushNativeAdToTheEnd(p,e,t):e.splice(g,0,p)}_pushNativeAdToTheEnd(e,t,s){e.isLastItem=!0,s.length&&t.length&&t[t.length-1].key===s[s.length-1]&&(t[t.length-1].isLastItem=!1),t.push(e)}_getUsedspace(e){return i.sumBy(e,(e=>e.key===re.emptyState?0:e.height))}_getEmptyStateListItemHeight(e,t,s){const i=t-e;return s<=i?i:s}_setRecentsConversations(e){this._recentConversations=i.orderBy(e,this._conversationSorter)}_splitConversationBasedOnOngoingCalls(){const e=c.default.CallingStore.getConnectedOrOutgoingCallIds(),t=i.map(e,(e=>c.default.CallingStore.getCallConversationMri(e)));return i.partition(this._shownConversations,(e=>e.hasActiveCall()||i.includes(t,e.id)))}_getEmptyStateListItem(e,t,s,i){const n=!e&&t,r=n&&s&&t?this._getEmptyStateListItemHeight(i,s,t):void 0;return{key:re.emptyState,height:r||1,measureHeight:!n,template:re.emptyState,isUsingStackNavigationContext:!!this._isUsingStackNavigationContext,hideSyncAddressBookCta:!0,isLandscape:K.default.getDeviceOrientation(this._rootViewId)===o.DeviceOrientation.Landscape,accessibilityTrait:a.Types.AccessibilityTrait.None}}_hasUserSyncedContacts(){return!H.default.systemPromptHasNotBeenDisplayed(Z.PermissionType.Contacts)&&H.default.permissionStatus(Z.PermissionType.Contacts)===n.PermissionStatus.Granted}_isPermissionsPromptRequired(){return H.default.systemPromptHasNotBeenDisplayed(Z.PermissionType.Microphone)||!this._onboardingFeatures.enableInContextCameraPermission&&H.default.systemPromptHasNotBeenDisplayed(Z.PermissionType.Camera)}_shouldDisplayFinishSetupPrompt(){let e=!1;P.default.isSetupWizardCompleted(),P.default.isOnboardingSkipped();return x.default.isChild()&&(e=!1),e}_shouldShowMobileNotificationPrompt(e,t){return e&&t&&!1}getNumberOfConversationsToFit(e,t){return Math.floor(e/this._getListItemHeight(!1,t))}getConversationsItemsList(e,s,o,n,r,a,l,c,h,p,g){this._shownConversations=y.default.getShownConversations();const m=this._splitConversationBasedOnOngoingCalls();this._setRecentsConversations(m[1]);let f=[],_=[],v=[],C=[];const b=e.selectedConversationId?S.default.getAllSiblingConversations(e.selectedConversationId):[];e.topInset&&f.push(this._getTopInset(e.topInset));const I=this._getRecentsViewModeType(e.viewType),A=R.default.canModernizeConversationList(),E=R.default.canModernizeMobileTab(),L=R.default.canModernizeMobileTabHeader(),F=R.default.canModernizeConversationList()&&(p||g);let O={idx:0};if(I===y.ConversationsListMode.ArchivedConversations)f.push.apply(f,this._mapConversationsToListItem(this._mapConversationsToIds(this._archivedConversations),[],b,e.selectedConversationId,e.useMobileView,F,O,A,E,e.useCompactIcon));else if(I===y.ConversationsListMode.AllConversations){const p=d.default.getAdsFeatures(),g=W.default.shouldShowCategories(),S=this._shownConversations,I=p.placementSettings.conversationList,R=(B.default.shouldGetAdsInConversationsList(T.AdsType.ListItem,S)||B.default.shouldGetAdsInConversationsList(T.AdsType.ListItemNarrow,S))&&this._rowSize===G.RowSize.Default,N=this._mapConversationsToIds(m[0]);e.useMobileView&&!e.hideSearchBar&&f.push(this._getSearchBar(e.showFilterIcon,L));let U=this._shouldDisplayFinishSetupPrompt();const H=d.default.getS4LMessagingFeatures(),Q=this._shouldShowMobileNotificationPrompt(H.enableNotificationPrompt,e.useMobileView)&&!U,X=K.default.isMobileScreenSize(this._rootViewId)&&!ee.default.useTabletUI();Q&&f.push(this._getNotificationsPrompt(X)),U&&f.push(this._getFinishSetupPrompt(X)),[_,v,C]=this._partitionConversationBasedOnSort(a,g,l,e.selectedConversationId);const $=g&&l!==G.RecentsSortBy.Active&&(N.length>0||v.length>0);let J=!1;if(!$&&E&&(f.push(this._getItemSpacer(8,O.idx++)),J=!0),N.length>0){if($||this._isPresentedInDesktopLeftNav){const e=A&&($||!this._isPresentedInDesktopLeftNav);e&&(J=!0,f.push(this._getItemSpacer(2,O.idx++))),E&&(f.push(this._getItemSpacer(8,O.idx++)),J=!0),f.push(this._createSectionHeader("ConversationsListPanel.OngoingCallsTitle",A,E)),e&&f.push(this._getItemSpacer(2,O.idx++))}f.push.apply(f,this._mapConversationsToListItem(N,N,b,e.selectedConversationId,e.useMobileView,F,O,A,E,e.useCompactIcon)),!$&&this._isPresentedInDesktopLeftNav&&f.push(this._createSectionHeaderSpacer("ongoingcall"))}const Y=f.length-1,Z=[];_&&_.length>0&&f.push.apply(f,this._mapConversationsToListItem(_,N,b,e.selectedConversationId,e.useMobileView,F,O,A,E,e.useCompactIcon)),v.length>0&&($&&(A&&!J&&(f.push(this._getItemSpacer(2,O.idx++)),J=!0),E&&!J&&(f.push(this._getItemSpacer(8,O.idx++)),J=!0),f.push(this._createSectionHeader("ConversationsListPanel.FavoritesTitle",A,E)),A&&f.push(this._getItemSpacer(2,O.idx++))),Z.push({groupName:T.AdsListGroupType.Favourites,position:f.length-1}),f.push.apply(f,this._mapConversationsToListItem(v,N,b,e.selectedConversationId,e.useMobileView,F,O,A,E,e.useCompactIcon))),$&&(A&&!J&&(f.push(this._getItemSpacer(2,O.idx++)),J=!0),E&&!J&&(f.push(this._getItemSpacer(8,O.idx++)),J=!0),f.push(this._createSectionHeader("ConversationsListPanel.ChatsTitle",A,E)),A&&f.push(this._getItemSpacer(2,O.idx++))),Z.push({groupName:T.AdsListGroupType.Recents,position:f.length-1}),f.push.apply(f,this._mapConversationsToListItem(C,N,b,e.selectedConversationId,e.useMobileView,F,O,A,E,e.useCompactIcon,(e=>e===C.length-1))),y.default.areConversationsLoading()&&f.push(this._getLoadingIndicator(e.useMobileView,A,E));const te=R?D.default.getAdsState(I.placementIds[0],{refreshIntervalInMinutes:I.refreshIntervalInMinutes,isAdMediaClickable:I.isAdMediaClickable,placementName:V.NativeAdPlacementName.ConversationList,provider:I.provider,adsType:I.adsType,otherProviders:I.otherProviders,testDevices:p.testDevices}):void 0;te&&te.status===D.AdsStatus.Loaded&&this._insertNativeAdIntoList(f,C,te,Y,Z,c,h,e.useMobileView,e.useCompactIcon,A),S.length<2&&!i.isUndefined(z.default.getSyncAddressBookPrivacySetting())&&f.push(this._getEmptyStateListItem(s,o,n,this._getUsedspace(f)));const se={[M.EngagementBannerType.CreateGroup]:this._getCreateGroupOrFallbackBanner.bind(this),[M.EngagementBannerType.SyncContacts]:this._getSyncContactOrFallbackBanner.bind(this),[M.EngagementBannerType.MeetNow]:this._getMeetNowOrFallbackBanner.bind(this)},ie=this._onboardingFeatures.features.emptyStateBanner,oe=P.default.getBannerState();if(!x.default.isChild()&&ie.enabled&&oe===M.EngagementBannerAction.NotDisplayed){const e=u.default.isCoachMarkBeingShown();if(k.log(w.LogTraceArea.ConversationsListItem,`\n                    Conditions for the CTA Banner _bannerState - ${oe},\n                    isCoachMarkBeingShown - ${e}\n                    shouldDisplayFinishSetupPrompt - ${U}\n                    active calls - ${N.length}\n                    BannerType - ${this._onboardingFeatures.features.emptyStateBanner.type}\n                `),!U&&!Q&&!e&&0===N.length){const e=se[ie.type](f);if(!i.isUndefined(e)){const s=f.findIndex((e=>e.template===t.ConversationListItemNames.searchBar));f.splice(s+1,0,this._getEngagementBanner(e))}}}s&&(j.default.trackSortByFilter(l),j.default.trackRowSize(this._rowSize),j.default.trackShowCategories(g));const ne=e.bottomPadding?f.length+1:f.length;"off"===H.convPanelLoggingLevel||!s&&ne===r||(k.log(w.LogTraceArea.ConversationsListItem,"ConversationsListPanel buildState: "+ne+" items, "+_.length+" top, "+v.length+" favorites, "+C.length+" rest, sorted by "+G.RecentsSortBy[l]),"full"===H.convPanelLoggingLevel&&k.log(w.LogTraceArea.ConversationsListItem,"ConversationsListPanel buildState: top: ["+i.join(i.map(_,(e=>q.mriOrId(e))),", ")+"], favorites: ["+i.join(i.map(v,(e=>q.mriOrId(e))),", ")+"], rest: ["+i.join(i.map(C,(e=>q.mriOrId(e))),", ")+"]"))}return e.bottomPadding&&f.push(this._getBottomPadding(e.bottomPadding)),f}_getCreateGroupOrFallbackBanner(e){return i.some(e,(e=>e.template===t.ConversationListItemNames.groupChat))?M.EngagementBannerType.MeetNow:M.EngagementBannerType.CreateGroup}_getMeetNowOrFallbackBanner(e){return M.EngagementBannerType.MeetNow}_getSyncContactOrFallbackBanner(e){const s=H.default.permissionStatus(Z.PermissionType.Contacts),o=e.find((e=>e.key===t.ConversationListItemNames.emptyState)),r=!!i.isUndefined(o)||o.hideSyncAddressBookCta,a=R.default.canModernizeMobileTab()?2:1,l=e.length-a;return s===n.PermissionStatus.Unknown&&r&&l<=this._onboardingFeatures.features.emptyStateBanner.syncContactsBannerConvCountLimit?M.EngagementBannerType.SyncContacts:M.EngagementBannerType.MeetNow}getConversationAdBanner(e,t,s){const i=d.default.getAdsFeatures(),o=i.placementSettings.conversationList,n=B.default.shouldGetAdsInConversationsList(T.AdsType.PanelBanner,this._shownConversations)&&!e?D.default.getAdsState(o.placementIds[0],{refreshIntervalInMinutes:o.refreshIntervalInMinutes,isAdMediaClickable:o.isAdMediaClickable,placementName:V.NativeAdPlacementName.ConversationList,provider:o.provider,adsType:o.adsType,otherProviders:o.otherProviders,testDevices:i.testDevices}):void 0;if(!n||n.status!==D.AdsStatus.Loaded)return;const r=t||300;return this._createNativeAdItem(n,r,!1,!1,s)}static syncContactsClickHandler(e,t){N.default.navigateToSyncAddressBook({origin:t,hideSkipButton:!0},void 0,e)}static isEngagementBannerConfigModernizedType(e){return void 0!==e&&"image"in e&&!("icon"in e)}static getEngagementBannerProps(e,t){return le(e)?this.getEngagementBannerModernizedProps(e,t):this.getEngagementBannerLegacyProps(e,t)}static getEngagementBannerOnCloseHandler(e){return()=>{P.default.setBannerState(M.EngagementBannerAction.Dismissed),k.track(new I.EngagementBannerTelemetryEvent(e,M.EngagementBannerAction.Dismissed))}}static getEngagementBannerModernizedProps(e,t){return e===M.EngagementBannerType.SyncContacts?{title:A.getString("UserSettingsPanel.SyncAddressBook"),description:A.getString("ConversationsListPanelEmptyState.SyncContactsEngagementBannerDescription"),bannerType:M.EngagementBannerType.SyncContacts,image:l.Collection.SYNC_CONTACTS_PEOPLE,onClick:()=>{de.syncContactsClickHandler(t.rootViewId,b.DialogNavOrigin.RecentChatsBanner),P.default.setBannerState(M.EngagementBannerAction.Clicked),k.track(new I.EngagementBannerTelemetryEvent(e,M.EngagementBannerAction.Clicked))},onClose:this.getEngagementBannerOnCloseHandler(e)}:this.getEngagementBannerLegacyProps(e,t)}static getEngagementBannerLegacyProps(e,t){const s=this.getEngagementBannerOnCloseHandler(e);switch(e){case M.EngagementBannerType.CreateGroup:return{title:A.getString("ConversationsListPanelEmptyState.FirstGroupEngagementBannerTitle"),description:A.getString("ConversationsListPanelEmptyState.FirstGroupEngagementBannerDescription"),bannerType:M.EngagementBannerType.CreateGroup,icon:Y.SkypeIcon.ContactGroupAdd,size:Y.IconSize.size28,onClick:()=>{new v.default({navigationOrigin:w.NavigationConversationOrigin.NewGroup,peopleType:$.PeopleType.All,filterPeopleType:$.FilterType.GroupCapable}).start(t.rootViewId),P.default.setBannerState(M.EngagementBannerAction.Clicked),k.track(new I.EngagementBannerTelemetryEvent(e,M.EngagementBannerAction.Clicked))},onClose:s};case M.EngagementBannerType.SyncContacts:return{title:A.getString("UserSettingsPanel.SyncAddressBook"),description:A.getString("ConversationsListPanelEmptyState.SyncContactsEngagementBannerDescription"),bannerType:M.EngagementBannerType.SyncContacts,icon:Y.SkypeIcon.ContactCard,size:Y.IconSize.size28,onClick:()=>{de.syncContactsClickHandler(t.rootViewId,b.DialogNavOrigin.RecentChatsBanner),P.default.setBannerState(M.EngagementBannerAction.Clicked),k.track(new I.EngagementBannerTelemetryEvent(e,M.EngagementBannerAction.Clicked))},onClose:s};case M.EngagementBannerType.MeetNow:default:return{title:A.getString("Onboarding.LandingScreenWithCardsCardTitle7"),description:A.getString("ConversationsListPanelEmptyState.MeetNowEngagementBannerDescription"),bannerType:M.EngagementBannerType.MeetNow,icon:Y.SkypeIcon.MeetNow,size:Y.IconSize.size28,onClick:()=>{F.MeetNowHelpers.showNewMeetNow(O.MeetNowOrigin.RecentChatsBanner),P.default.setBannerState(M.EngagementBannerAction.Clicked),k.track(new I.EngagementBannerTelemetryEvent(e,M.EngagementBannerAction.Clicked))},onClose:s}}}}t.ConversationsListHelper=de},37324:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RowDecoratorType=t.ConversationCommands=void 0;const i=s(96486),o=s(89391),n=s(80200),r=s(71830),a=s(11930),l=s(98278),d=s(33754),c=s(81760),h=s(11828),u=s(60305),p=s(97634),g=s(92772);var m,S;t.ConversationCommands={Unfavorite:"unfavorite",Favorite:"favorite",Unblock:"unblock",BlockContact:"block",Call:"call",AudioCall:"audioCall",ClearConversation:"clearConversation",DeleteConversation:"deleteConversation",DeleteBotFromContacts:"deleteBotFromContacts",AddBotToContacts:"addBotToContacts",LeaveConversation:"leave",MarkRead:"markRead",MarkUnread:"markUnread",Profile:"profile",ManageGroup:"settings",Archive:"archive",Unarchive:"unarchive",Mute:"mute",Unmute:"unmute",More:"more",CopyLink:"copyLink"},function(e){e.More="more",e.Call="call",e.Archive="archive",e.MarkRead="markread",e.Mute="mute"}(m||(m={})),function(e){e[e.Avatar=0]="Avatar",e[e.Status=1]="Status",e[e.Icon=2]="Icon",e[e.None=3]="None"}(S=t.RowDecoratorType||(t.RowDecoratorType={}));class f{static getMenuSections(e){return[{key:"favoriteSection",menuItems:this._getFavoriteSectionMenuItems(e)},{key:"otherSection",menuItems:this._getOtherSectionMenuItems(e)},{key:"leaveSection",menuItems:this._getLeaveSectionMenuItems(e)}]}static getMenuItems(e){let t=[];t=[...this._getFavoriteSectionMenuItems(e),...this._getOtherSectionMenuItems(e),...this._getLeaveSectionMenuItems(e)];return{items:t,destructiveIndex:t.length-1}}static getSwipeActions(e,t,s,n){if(t)return{rightActions:[]};{const t=o.default.getS4LUiFeaturesNoSubscription().recentChatsSwipeActionsConfig;return{rightActions:i.compact(i.map(t.right,(t=>this._commandToAction(t,e,s,n)))),leftActions:t.left?i.compact(i.map(t.left,(t=>this._commandToAction(t,e,s,n)))):void 0,overScrollLeft:t.overScrollLeft,overScrollRight:t.overScrollRight,overScrollDistance:t.overScrollDistance}}}static _commandToAction(e,s,i,o){switch(e){case m.More:return t.ConversationCommands.More;case m.Call:return t.ConversationCommands.AudioCall;case m.MarkRead:return i?t.ConversationCommands.MarkRead:t.ConversationCommands.MarkUnread;case m.Archive:return s?t.ConversationCommands.Unarchive:t.ConversationCommands.Archive;case m.Mute:return o?t.ConversationCommands.Unmute:t.ConversationCommands.Mute}}static conversationSwipeActionForCommand(e,s,i,o,n){let a,l,u=c.Color.white,g=c.Color.gray300;switch(e){case t.ConversationCommands.More:a=h.SkypeIcon.More,l=o?void 0:d.getString("Global.MoreButtonTitle"),g=p.isDarkTheme(i)?c.Color.gray400:c.Color.gray300;break;case t.ConversationCommands.Archive:a=h.SkypeIcon.Hide,l=o?void 0:d.getString("Global.HideLabel"),g=c.Color.blueDark;break;case t.ConversationCommands.Unarchive:a=h.SkypeIcon.QuickLook,l=o?void 0:d.getString("Global.UnhideLabel"),g=c.Color.blueDark;break;case t.ConversationCommands.MarkRead:a=h.SkypeIcon.MessageRead,l=o?void 0:d.getString("ConversationsListItem.MarkReadLabelShort"),g=c.Color.blueDark;break;case t.ConversationCommands.MarkUnread:a=h.SkypeIcon.MessageUnread,l=o?void 0:d.getString("ConversationsListItem.MarkUnreadLabelShort"),g=c.Color.blueDark;break;case t.ConversationCommands.Mute:a=h.SkypeIcon.NotificationOff,l=o?void 0:d.getString("ConversationsListItem.MuteLabel"),g=c.Color.blueDark;break;case t.ConversationCommands.Unmute:a=h.SkypeIcon.Notification,l=o?void 0:d.getString("ConversationsListItem.UnmuteLabel"),g=c.Color.blueDark;break;case t.ConversationCommands.Call:case t.ConversationCommands.AudioCall:a=r.isPhoneMri(s)?h.SkypeIcon.SkypeOut:h.SkypeIcon.CallStart,l=o?void 0:d.getString("Hub.NewCallMenuShortLabel"),g=c.Color.blueMedium}if(a)return{command:e,icon:a,iconColor:u,backgroundColor:g,label:l,onComplete:n}}static getAccessibilityLabel(e){let t="";if(e.isFavorite&&(t+=d.getString("ConversationsListItem.FavoriteConversation")),e.isAgent&&(t+=d.getString("ConversationsListItem.BotConversation")+", "),t+=e.conversationDisplayName+", ",e.isOneOnOne){const s=g.accessibilityLabelForUserStatus(e.presence);s&&(t+=s+", "),e.moodAccessibilityLabel&&(t+=e.moodAccessibilityLabel+", "),t+=d.getString("ConversationsListItem.OneonOneConversationLabel")}else t+=d.getString("ConversationsListItem.GroupConversationLabel");return e.hasActiveCall&&e.activeCallStatus!==n.ActiveCallStatus.None?t+=", "+(e.activeCallStatus===n.ActiveCallStatus.OnHold?d.getString("OngoingCall.OngoingCallOnHoldTitle"):d.getString("OngoingCall.OngoingCallTitle")):t+=d.getString("ConversationsListItem.LastMessageLabel",{message:e.lastMessageLabel,time:e.lastMessageTime}),e.isRecipientBlocked&&(t+=d.getString("ConversationsListItem.BlockedContact")),e.hasActiveCall||(e.isMuted?t+=d.getString("ConversationsListItem.MutedConversationLabel"):t+=d.getString("ConversationsListItem.NewMessages",{count:e.displayedUnreadCount||0}),e.isTyping&&(t+=d.getString("ConversationsListItem.ParticipantTyping"))),e.isSelected&&(t+=d.getString("Global.SelectedAccessibilityLabel")),e.addAccessibilityHint&&(t=a.default.applyMoreOptionsAccessibilityHint(t)),t}static rowDecorator(e){if(e.useExtraCompactLayout){if(e.hasActiveCall)return{type:S.Icon,icon:h.SkypeIcon.CallAnimSmall4};if(i.isUndefined(e.userStatus)){if(e.isOneOnOne){if(e.isTeamsUser)return{type:S.Icon,icon:h.SkypeIcon.MSTeams};{const t=e.conversationId?f.optionalMessageTypeIcon(!!e.useExtraCompactLayout,!!e.isEncrypted,!!e.isTranslated,e.conversationId):void 0;return t?{type:S.Icon,icon:t}:{type:S.None}}}return{type:S.Icon,icon:h.SkypeIcon.ContactGroup}}return{type:S.Status}}return{type:S.Avatar}}static optionalMessageTypeIcon(e,t,s,i,o){return o?h.SkypeIcon.Media:t?h.SkypeIcon.Lock:r.isPhoneMri(i)?e?h.SkypeIcon.SkypeOut:h.SkypeIcon.MobileSmsNew:e&&r.isAgent(i)?h.SkypeIcon.Bot:e&&r.isOneOnOneConversation(i)?h.SkypeIcon.Contact:u.default.isTabletNoSubscription()&&s?h.SkypeIcon.SkypeTranslator:void 0}}t.default=f,f._getFavoriteSectionMenuItems=e=>{let s=[];return e.isArchived||(e.isFavorite?s.push({text:d.getString("ConversationsListItem.UnfavoriteLabel"),command:t.ConversationCommands.Unfavorite,icon:l.SXMenuIcon.Favorite}):s.push({text:d.getString("ConversationsListItem.FavoriteLabel"),command:t.ConversationCommands.Favorite,icon:l.SXMenuIcon.Favorite})),s},f._getOtherSectionMenuItems=e=>{let s=[];return e.isOneOnOne?s.push({text:d.getString("ConversationsListItem.ChatOneOnOneProfileLabel"),command:t.ConversationCommands.Profile,icon:l.SXMenuIcon.Profile}):s.push({text:d.getString("ConversationsListItem.ChatGroupManageLabel"),command:t.ConversationCommands.ManageGroup,icon:l.SXMenuIcon.Settings}),!e.isOneOnOne&&e.isJoinEnabled&&s.push({text:d.getString("ConversationsListItem.CopyLinik"),command:t.ConversationCommands.CopyLink,icon:l.SXMenuIcon.Copy}),e.displayedUnreadCount>0&&!e.isArchived?s.push({text:d.getString("ConversationsListItem.MarkReadLabel"),command:t.ConversationCommands.MarkRead,icon:l.SXMenuIcon.ReadMark}):s.push({text:d.getString("ConversationsListItem.MarkUnreadLabel"),command:t.ConversationCommands.MarkUnread,icon:l.SXMenuIcon.UnreadMark}),e.isArchived?s.push({text:d.getString("ConversationsListItem.UnhideItemLabel"),command:t.ConversationCommands.Unarchive,icon:l.SXMenuIcon.UnhideMark}):e.hasActiveCall||s.push({text:d.getString("ConversationsListItem.HideItemLabel"),command:t.ConversationCommands.Archive,icon:l.SXMenuIcon.HideMark}),e.isMriAnAgent||(e.isOneOnOne?s.push({text:d.getString("InfoPanel.DeleteConversationLabel"),command:t.ConversationCommands.DeleteConversation,icon:l.SXMenuIcon.Delete}):s.push({text:d.getString("InfoPanel.ClearGroupConversationLabel"),command:t.ConversationCommands.ClearConversation,icon:l.SXMenuIcon.Clear})),e.isOneOnOne&&!e.isMriAContact&&(e.isRecipientBlocked?s.push({text:d.getString("ConversationsListItem.UnblockContact",{displayName:e.conversationShortDisplayName}),command:t.ConversationCommands.Unblock,icon:l.SXMenuIcon.Block}):e.displayBlockButton&&s.push({text:d.getString("ConversationsListItem.BlockContact",{displayName:e.conversationShortDisplayName}),command:t.ConversationCommands.BlockContact,icon:l.SXMenuIcon.Block})),e.isMriAnAgent&&!e.isEngagementBot&&s.push({text:d.getString("ConversationsListItem.DeleteBot",{displayName:e.conversationShortDisplayName}),command:t.ConversationCommands.DeleteBotFromContacts,icon:l.SXMenuIcon.Delete}),s},f._getLeaveSectionMenuItems=e=>{let s=[];return e.isOneOnOne||s.push({text:d.getString("InfoPanel.LeaveConversationLabel"),command:t.ConversationCommands.LeaveConversation,icon:l.SXMenuIcon.Leave}),s}},98401:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(89391),r=s(15877),a=s(33754),l=s(38915),d=s(9748),c=s(90284),h=s(78735),u=s(19675),p=(0,r.lazyProperties)({overflowItem:()=>o.Styles.createViewStyle({width:c.OverflowItemSizeInList,height:c.OverflowItemSizeInList,borderRadius:10,alignItems:"center",justifyContent:"center",marginRight:20}),overflowRoundedItem:()=>o.Styles.createViewStyle({width:c.OverflowItemSizeInGridOrCarousel,height:c.OverflowItemSizeInGridOrCarousel,borderRadius:c.OverflowItemSizeInGridOrCarousel/2,alignItems:"center",justifyContent:"center",marginHorizontal:5}),overflowItemContainer:()=>o.Styles.createViewStyle({alignItems:"center",justifyContent:"center"}),iconText:()=>o.Styles.createTextStyle({lineHeight:16,paddingVertical:10,alignItems:"center",marginHorizontal:1})});let g=new class{overflowItemForDescriptor(e,t,s,i){const n=this.getMediaBarItemProps(t,s,e),r=e.render(n);return o.createElement(o.View,{style:[p.overflowItemContainer,i],key:e.id},r,o.createElement(u.Caption,{style:p.iconText,numberOfLines:1,accessibilityHidden:!0},this.getMediaBarItemTitle(e.id)))}isMediaBarItemNew(e){const{mediaBarNewItems:t}=n.default.getS4LMessagingFeaturesNoSubscription();return t.includes(e)&&!h.default.isMediaBarNewItemSeen(e)}setMediaBarItemAsSeen(e){h.default.setMediaBarNewItemSeen(e,!0)}isAnyMediaBarItemNew(e){return e.some((e=>this.isMediaBarItemNew(e.id)))}getMediaBarItemTitle(e){let t;switch(e){case d.MediaBarItemKeys.Bing:t=(0,a.getString)("SearchInputControl.PlaceHolderTextShort");break;case d.MediaBarItemKeys.FilePicker:t=(0,a.getString)("MediaBar.MediaAndFilePickerTitle");break;case d.MediaBarItemKeys.Camera:t=(0,a.getString)("QuickCapturePanel.CameraButtonTitle");break;case d.MediaBarItemKeys.Location:t=(0,a.getString)("MediaBar.LocationTitle");break;case d.MediaBarItemKeys.Contact:t=(0,a.getString)("MediaBar.ContactTitle");break;case d.MediaBarItemKeys.MediaPicker:t=(0,a.getString)("MediaBar.MediaTitle");break;case d.MediaBarItemKeys.ScheduleCall:t=(0,a.getString)("MediaBar.ScheduleCallTitle");break;case d.MediaBarItemKeys.Sms:t=(0,a.getString)("MediaBar.SMSTitle");break;case d.MediaBarItemKeys.People:t=(0,a.getString)("MediaBar.PeopleTitle");break;case d.MediaBarItemKeys.Poll:t=(0,a.getString)("MediaBar.PollTitle");break;case d.MediaBarItemKeys.VideoMessage:t=(0,a.getString)("MediaBar.VideoMessageTitle");break;case d.MediaBarItemKeys.SendCredit:t=(0,a.getString)("MediaBar.SendCreditTitle")}return t}getMediaBarItemDescription(e){let t;switch(e){case d.MediaBarItemKeys.Location:t=(0,a.getString)("MediaBar.LocationDescription");break;case d.MediaBarItemKeys.MediaPicker:t=(0,a.getString)("MediaBar.MediaDescription");break;case d.MediaBarItemKeys.VideoMessage:t=(0,a.getString)("MediaBar.VideoMessageDescription");break;case d.MediaBarItemKeys.FilePicker:t=(0,a.getString)("MediaBar.MediaAndFilePickerDescription");break;case d.MediaBarItemKeys.Contact:t=(0,a.getString)("MediaBar.ContactPickerDescription");break;case d.MediaBarItemKeys.Sms:t=(0,a.getString)("MediaBar.SMSDescription");break;case d.MediaBarItemKeys.ScheduleCall:t=(0,a.getString)("MediaBar.ScheduleCallDescription");break;case d.MediaBarItemKeys.Poll:t=(0,a.getString)("MediaBar.PollDescription");break;case d.MediaBarItemKeys.SendCredit:t=(0,a.getString)("MediaBar.SendCreditDescription")}return t}getMediaBarItemProps(e,t,s,o=!0){const n=[o?p.overflowRoundedItem:p.overflowItem,t.buttonBackgroundColorStyle];return i.extend({id:s.id,key:s.id,conversationId:e.conversationId,otherPartyMri:e.otherPartyMri,presentedInOverflowMenu:!0,active:!1,iconStyleOverride:n,isMobileInterface:!0,disabled:s.disabled,onActive:e.onItemSelected,onCustomAction:e.onCustomAction,onFocus:e.onFocus,onBlur:e.onBlur,origin:l.MediaBarItemOrigin.MessageOverflow},s.propOverrides)}};t.default=g},48443:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=s(88837),n=s(61253),r=s(10400);let a=class extends o.StoreBase{constructor(){super(),this._keyboardHeight=0,this._offsetTop=0,this._dimensions={width:0,height:0},this._onKeyboardUpdate=()=>{const e=r.default.getUpdateInfo().height;e!==this._keyboardHeight&&(this._keyboardHeight=e,this.trigger())},r.default.subscribe(this._onKeyboardUpdate)}updateTopOffset(e){e!==this._offsetTop&&(this._offsetTop=e,this.trigger())}updateDimensions(e){(0,n.default)(e,this._dimensions)||(this._dimensions=e,this.trigger())}getDraggableArea(){return{x:0,y:this._offsetTop,width:this._dimensions.width,height:this._dimensions.height-this._keyboardHeight}}};(0,i.__decorate)([o.autoSubscribe],a.prototype,"getDraggableArea",null),a=(0,i.__decorate)([o.AutoSubscribeStore],a),t.default=new a},54663:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessagesSearchHelper=void 0;const i=s(96486),o=s(16778),n=s(88837),r=s(77340),a=s(95106),l=s(46096),d=s(33754),c=s(70919),h=s(1211),u=s(75150),p=s(4899),g="messagesHeader",m="messagesFooter",S="msg_";class f extends n.ComponentBase{constructor(){super(...arguments),this._onPress=(e,t)=>{this.props.item.onListItemClick&&this.props.item.onListItemClick(e,void 0,l.SearchResultsListGroup.Messages)}}render(){return o.createElement(a.default,{itemHeight:this.props.item.height-1,searchResult:this.props.result,rawSearchQuery:this.props.rawSearchQuery,isPseudoFocused:this.props.item.isPseudoFocused,onSearchMessagePress:this._onPress})}}const y={footer:m,header:g};class _ extends p.SearchSectionHelper{constructor(){super(...arguments),this._renderSearchResultItem=e=>{if(!i.isUndefined(e.item.index)&&this._searchConfig.messages[e.item.index])return o.createElement(f,Object.assign({result:this._searchConfig.messages[e.item.index]},e))}}static _getKey(e){return S+e.ConversationId+e.MessageId}buildConfig(e,t,s){return{messages:t.searchController.getMessagesResults(),isShowingMore:!!s.isShowingMore[l.SearchResultsListGroup.Messages],contentSizeMultiplier:s.contentSizeMultiplier,limit:e.isCollapsible?this._getMaxItemsInGroup(e):void 0,hideHeader:!!e.hideHeader,hideHeaderCaption:!!e.hideHeader}}getItems(e,t,s,i,o,n=!1){const r={itemHeight:c.SearchItemHeights.messageBaseItemHeight+Math.round(65*this._searchConfig.contentSizeMultiplier),itemTemplate:"content",measureHeightForNonHeaderItems:!0,showSectionEvenIfEmpty:!1,hideHeader:this._searchConfig.hideHeader||this._searchConfig.hideHeaderCaption,hideHeaderTitle:this._searchConfig.hideHeaderCaption,header:d.getString("SearchResultsList.MessagesHeader"),hasHeaderWithButtons:!0},a=p.SearchSectionHelper.generateItemsLists({searchResultsListState:e,searchResultsListProps:t,sourceList:this._searchConfig.messages,getKey:_._getKey,keys:y,renderConfig:r,groupType:l.SearchResultsListGroup.Messages,onFooterPress:o,limit:this._searchConfig.limit,forceInsertFooter:n}),h=a.defaultList;return this._searchConfig.isShowingMore&&h.push(...a.listWithRestOfItems),a.footerItem&&h.push(a.footerItem),h}renderItem(e,t=!1){return e.item.key===g?this._renderHeaderItem(e):e.item.key===m?this._renderFooterItem(e.item,t):e.item.key.substr(0,S.length)===S?this._renderSearchResultItem(e):void 0}_renderHeaderItem(e){const t=e.item;return o.createElement(u.default,{sectionTitle:t.hideTitle?void 0:d.getString("SearchResultsList.MessagesHeader"),enableNewSearchHeader:e.customizeExperienceByContactsLevel})}_renderFooterItem(e,t){return t?r.ActivityIndicatorHelper.renderItem(r.ActivityIndicatorHelper.getListItem(e.key)):o.createElement(h.default,{shouldShowAllResults:this._searchConfig.isShowingMore,groupType:l.SearchResultsListGroup.Messages,onShowMorePress:e.onPress})}}t.MessagesSearchHelper=_},49769:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(97691),n=s(66020),r=s(71830),a=s(78262),l=s(72758);t.default=class{static canSendSMSToMri(e){return!(!r.isPhoneMri(e)||r.isBlockedPSTNMri(e))||i.size(l.default.getFullUserProfileByMri(e).phones)>0}static getPhoneNumberToNavigateTo(e,t,s){const i=l.default.getFullUserProfileByMriNoSubscription(e).phones||[];if(r.isPhoneMri(e)||r.getMriNamespace(e)===r.Namespaces.OneToOneTextMessage){const t={number:r.getPhoneNumberFromMri(e)||"",type:a.PhoneNumberTypes.Other};return o.Resolved(t)}return i.length?1===i.length?o.Resolved(i[0]):this.showNumberSelectionPopup(t,s,e,i,!1):o.Resolved(void 0)}static showNumberSelectionPopup(e,t,s,i,r){const a=o.Defer();return n.default.showSendSmsPrompt(e,t,s,i,(e=>{a.resolve(e)}),r),a.promise()}}},3709:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.debugDumpMessagePretty=t.debugDumpMessage=t.cancelPoll=t.editScheduledCall=t.cancelScheduledCall=t.viewLink=t.selectMessages=t.showReportedMessage=t.reportMessage=t.markReadToHere=t.openFileLocation=t.openMediaLocation=t.copyLocationMessage=t.copyLinkMessage=t.copyImage=t.copyMessage=t.translateMessage=t.bookmarkMessage=t.forwardMessage=t.retryFailedSend=t.cancelFailedSend=t.cancelEditMessage=t.cancelSendMessage=t.removeMessage=t.quoteSelection=t.quoteMessage=t.editMessage=t.viewInChat=t.saveMediaAs=t.saveFileAs=t.saveMedia=t.addReaction=void 0;const i=s(96486),o=s(19784),n=s(89391),r=s(65976),a=s(81806),l=s(19061),d=s(87430),c=s(82773),h=s(51077),u=s(71830),p=s(98278),g=s(86374),m=s(46096),S=s(61317),f=s(53559),y=s(19596),_=s(17873),v=s(36237),C=s(33754),b=s(18606),T=s(87946),M=s(83503),I=s(64387),w=s(12762),P=s(12762),k=s(42036),A=s(12056),E=s(75043),R=s(10909),L=s(78735),F=s(4735),x=s(27357),O=s(22669),D=s(45151),B=s(44390),V=s(46122),N=s(34273),U=s(29034),H=s(79829),z=s(77914),W=s(71987),j=s(86045),G=s(33825),K=s(750),q=s(40363),Q=s(78262),X=s(11698),$=s(53374),J=s(48790);t.addReaction=e=>({command:K.CommandTypes.AddReaction,localizationKey:"StreamItem.React",onCommandSelected:()=>{if(_.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,K.CommandTypes.AddReaction),e.screenReaderEnabled){new B.default(e.message).showReactionActionSheet(e.getReactionMenuPopupAnchor,e.componentContext.rootViewId)}else{if(!e.getReactionMenuPopupAnchor||!e.getReactionMenuPopupAnchor())return;new V.ReactionsMenuPopup(e.message,void 0,e.getReactionMenuPopupAnchor,e.componentContext.rootViewId,e.componentContext.rootViewType).show()}}});t.saveMedia=e=>{const t=M.getSaveToDirectoryLocalizationKeys(e.message),s=e.message&&e.message.isAlbum();return{command:K.CommandTypes.SaveMedia,localizationKey:t.key,localizationKeyParameters:t.params,icon:t.icon,onCommandSelected:()=>{if(s){const t=b.default.getAllMediaMessagesForAlbum(e.message.getAlbumId());i.each(t,((t,s)=>{const i=g.decode(t).getFirstUriObjectChild(P.DisplayableMedia);i&&Y(i,t,e.componentContext.rootViewId,!0,"")}))}else{_.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,K.CommandTypes.SaveMedia);const t=e.decodedNode.getFirstUriObjectChild(P.DisplayableMedia);t&&Y(t,e.message,e.componentContext.rootViewId,!1)}}}};const Y=(e,t,s,i,o)=>{const n=$.default.newCauseId();v.log(m.LogTraceArea.Navigation,"onSaveMedia, causeId: "+n);let r,l=I.default.getMediaDescriptorForItem(t);switch(l&&l.mediaType){case O.PictureViewer.MediaType:case J.VideoViewer.MediaType:case a.default.MediaType:r=l.downloadFileName;break;default:return}l&&v.track(new T.MediaDownloadTelemetryEvent(t,T.MediaDownloadActionOrigin.StreamItem,T.MediaDownloadReason.SaveToDownloads,f.default.extractFileExtension(r)));const d=e.getNameForDownload()||e.getFullResolutionUrlSanitized();o||(o=L.default.getUserPreferencesLocal().fileDownloadPathDesktop);const c=S.FilePickerUtils.getFileUri(d,o);k.default.downloadToCameraRoll(t,e.getFullResolutionUrlSanitized(),c,n,s,i)};t.saveFileAs=e=>{const t=e.decodedNode.getFirstUriObjectChild(P.UriObjectFileNode);if(t)return{command:K.CommandTypes.SaveAsFile,localizationKey:"StreamItem.ActionSaveAs",icon:p.SXMenuIcon.Save,onCommandSelected:()=>{const s=$.default.newCauseId();v.log(m.LogTraceArea.Navigation,"onSaveAs, causeId: "+s),_.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,K.CommandTypes.SaveAsFile);const i=t.getFileContentUrlSanitized(),o=t.getNameForDownload();if(i&&o){const t=r.getDocumentId(i);if(t){const i=r.getDisplayUrl(t,Q.UploadFileType.File);k.default.desktopSaveAs(t,o,i,s,e.message,e.componentContext.rootViewId,e.getRootWindowComponent)}}}}};t.saveMediaAs=e=>{const t=e.message&&e.message.isAlbum();return{command:K.CommandTypes.SaveAsMedia,localizationKey:t?"StreamItem.ActionSaveAll":"StreamItem.ActionSaveAs",icon:p.SXMenuIcon.Save,onCommandSelected:()=>{const s=$.default.newCauseId();if(v.log(m.LogTraceArea.Navigation,"onSaveMediaAs, causeId: "+s),_.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,K.CommandTypes.SaveAsMedia),t)S.FilePickerUtils.showOpenDialog({properties:["openDirectory"]},(t=>{const s=b.default.getAllMediaMessagesForAlbum(e.message.getAlbumId());i.each(s,((s,i)=>{const o=g.decode(s).getFirstUriObjectChild(P.DisplayableMedia);o&&Y(o,s,e.componentContext.rootViewId,!0,t.path)}))}));else{let t,i,o=I.default.getMediaDescriptorForItem(e.message);switch(o&&o.mediaType){case O.PictureViewer.MediaType:t=o.downloadFileName,i=o.fullResolutionUrl;break;case J.VideoViewer.MediaType:t=o.downloadFileName,i=o.videoUrl;break;case a.default.MediaType:t=o.downloadFileName,i=o.audioUrl;break;default:return}t&&i&&(o&&v.track(new T.MediaDownloadTelemetryEvent(e.message,T.MediaDownloadActionOrigin.StreamItem,T.MediaDownloadReason.SaveAs,f.default.extractFileExtension(t))),k.default.desktopSaveAs(r.getFileCacheKeyMedia(e.message,!0),t,i,s,e.message,e.componentContext.rootViewId,e.getRootWindowComponent))}}}};t.viewInChat=e=>({command:K.CommandTypes.ViewInChat,localizationKey:"StreamItem.ViewInChat",onCommandSelected:()=>{const t=$.default.newCauseId();v.log(m.LogTraceArea.Navigation,"StreamItemCommands.viewInChat, causeId: "+t),_.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,K.CommandTypes.ViewInChat),F.default.navigateToConversation({convId:e.message.conversationId,causeId:t,focusedMessageCuid:e.message.cuid,scrollToTimestamp:Number(e.message.createdTime),origin:m.NavigationConversationOrigin.Gallery})}});t.editMessage=e=>({command:K.CommandTypes.Edit,localizationKey:"StreamItem.ActionEdit",icon:p.SXMenuIcon.Edit,onCommandSelected:()=>{_.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,K.CommandTypes.Edit),e.onEditCallback&&e.onEditCallback(e.message)}});t.quoteMessage=e=>{const{enableReply:t,enableMultiMessageQuoteOnKeyboard:s}=n.default.getS4LMessagingFeaturesNoSubscription(),{pasteAsQuotesEnabled:i}=L.default.getUserPreferencesLocalNoSubscription();return{command:K.CommandTypes.Quote,localizationKey:t?"StreamItem.ActionReply":"StreamItem.ActionQuote",icon:t?p.SXMenuIcon.Reply:p.SXMenuIcon.Quote,isVisible:()=>!(s&&i&&Z(e)),onCommandSelected:()=>{_.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,K.CommandTypes.Quote),e.onQuoteCallback&&e.onQuoteCallback([e.message],X.QuotesTriggerType.ActionMenu)}}};t.quoteSelection=e=>{const{enableReply:t}=n.default.getS4LMessagingFeaturesNoSubscription();return{command:K.CommandTypes.QuoteSelection,localizationKey:t?"StreamItem.ActionReplyToSelection":"StreamItem.ActionQuoteSelection",icon:t?p.SXMenuIcon.ReplySelection:p.SXMenuIcon.Quote,isVisible:()=>Z(e),onCommandSelected:()=>{if(_.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,K.CommandTypes.QuoteSelection),e.onQuoteSelection)e.onQuoteSelection();else if(e.onQuoteCallback&&(G.isTextSelected()||e.selectedText)){const t=e.message.applyMessageForPostingLie(G.getNewMessageFromSelection(e.message.conversationId,e.selectedText).messageForPosting);e.onQuoteCallback([t],X.QuotesTriggerType.Selection)}}}};const Z=e=>G.isTextSelected()||!!e.selectedText;t.removeMessage=e=>{const t=e.message&&e.message.messagetype===h.MessageTypes.MediaAlbum?"StreamItem.ActionRemoveAll":"StreamItem.ActionRemove";return{command:K.CommandTypes.Remove,localizationKey:t,icon:p.SXMenuIcon.Dismiss,onCommandSelected:()=>{_.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,K.CommandTypes.Remove),k.default.deleteMessage(e.message,e.componentContext.rootViewId,void 0,(()=>{j.default.maybeAnnounceForAccessibility(C.getString("Global.RemoveMessageConfirmation"))}))}}};t.cancelSendMessage=e=>({command:K.CommandTypes.CancelSend,localizationKey:"StreamItem.ActionRemove",onCommandSelected:()=>{_.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,K.CommandTypes.CancelSend),k.default.cancelMessageSend(e.message,e.componentContext.rootViewId)}});t.cancelEditMessage=e=>({command:K.CommandTypes.CancelEdit,localizationKey:"StreamItem.ActionCancelEdit",onCommandSelected:()=>{_.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,K.CommandTypes.CancelEdit),k.default.cancelFailedSend(e.message)}});t.cancelFailedSend=e=>({command:K.CommandTypes.CancelFailedSend,localizationKey:"StreamItem.ActionRemove",onCommandSelected:()=>{_.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,K.CommandTypes.CancelFailedSend),k.default.cancelFailedSend(e.message)}});t.retryFailedSend=e=>({command:K.CommandTypes.RetryFailedSend,localizationKey:"StreamItem.ActionRetry",onCommandSelected:()=>{_.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,K.CommandTypes.RetryFailedSend),k.default.retryFailedSend(e.message)}});t.forwardMessage=e=>{const t=e.message&&e.message.messagetype===h.MessageTypes.MediaAlbum?"StreamItem.ActionForwardAll":"StreamItem.ActionForward";return{command:K.CommandTypes.Forward,localizationKey:t,icon:p.SXMenuIcon.Forward,isVisible:()=>l.default.canForwardMessage()&&!e.message.isMessageInEncryptedThread(),onCommandSelected:t=>{_.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,K.CommandTypes.Forward);let s=e.message;const o=s.isAlbum()?$.default.newGuid():void 0;if(s.isBookmark()){const e=s.getBookmarkMetadata();if(e){const t=s.getMutableClone();t.creator=e.bookmarkSourceCreatorId||s.creator,t.createdTime=e.bookmarkSourceComposeTime||s.createdTime,s=t}}const n=[{message:s,node:e.decodedNode,forwardAlbumId:o}];if(s.isAlbum()){const e=b.default.getAllMediaMessagesForAlbum(s.getAlbumId());i.each(e,(e=>{n.push({message:e,node:g.decode(e),forwardAlbumId:o})}))}const r=s.isBookmark()?A.MessageActionOrigin.BookmarksViewer:t||A.MessageActionOrigin.StreamItem;y.forwardMessages(n,r,e.contextConversationId,void 0,e.componentContext)}}};t.bookmarkMessage=e=>{if(!e.message)return;const t=e.message.isBookmark(),s=e.message.isBookmarkSourceForCurrentUser(),o=t||s?"StreamItem.RemoveBookmark":"StreamItem.AddBookmark",n=x.default.isDesktopSplitNavStackCollapsedForRootViewIdNoSubscription(e.componentContext.rootViewId);return{command:K.CommandTypes.Bookmark,localizationKey:o,icon:p.SXMenuIcon.Bookmark,isVisible:()=>l.default.canBookmarkMessage()&&!e.message.isEphemeral()&&!e.message.isMessageInEncryptedThread()&&!e.message.isMessageInS4BBridgeConversation()&&!e.message.isEmote(),onCommandSelected:o=>{let r;e.message.isAlbum()&&(r=$.default.newGuid());const a=[{message:e.message,node:e.decodedNode,forwardAlbumId:r}];if(e.message.isAlbum()){const t=b.default.getAllMediaMessagesForAlbum(e.message.getAlbumId());i.each(t,(e=>{a.push({message:e,node:g.decode(e),forwardAlbumId:r})}))}const l=t?A.MessageActionOrigin.BookmarksViewer:o||A.MessageActionOrigin.StreamItem,h=s||t?void 0:t=>{c.default.setBookmarkAdded();const s=C.getString("BookmarksTooltips.BookmarkAddedToastText"),i=`${s} ${C.getString("BookmarksTooltips.BookmarkAddedToastLabel")}`;n?R.default.scheduleMessage({key:"bookmarkAdded",textMessage:s,actionLabel:C.getString("BookmarksTooltips.BookmarkAddedToastLabel"),accessibilityLabel:i,onPress:()=>F.default.navigateToConversation({convId:u.BookmarksThreadId,causeId:$.default.newCauseId(),origin:m.NavigationConversationOrigin.InAppNotification}),rootViewId:e.componentContext.rootViewId}):j.default.maybeAnnounceForAccessibility(i)};d.bookmarkMessageAction(a,l,h)}}};t.translateMessage=e=>({command:K.CommandTypes.Translate,localizationKey:e.showTranslatedMessage?"Translator.MessageShowOriginal":"Translator.MessageShowTranslation",onCommandSelected:()=>{_.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,K.CommandTypes.Translate),e.onTranslateCallback&&e.onTranslateCallback()}});function ee(e,t,s,i){t&&e.onCopy?e.onCopy():k.default.copyMessage(s||e.message,i||e.decodedNode,e.componentContext.rootViewId,e.selectedText)}t.copyMessage=e=>({command:K.CommandTypes.Copy,localizationKey:"StreamItem.ActionCopy",icon:p.SXMenuIcon.Copy,onCommandSelected:()=>{_.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,K.CommandTypes.Copy);const t=G.isTextSelected()||!!e.selectedText;if(e.hasTranslation&&e.showTranslatedMessage){const s=E.default.getTranslatedMessage(e.message.conversationId,e.message.cuid);s&&ee(e,t,s,g.decode(s))}else ee(e,t)}});t.copyImage=e=>({command:K.CommandTypes.CopyImage,localizationKey:"StreamItem.ActionCopy",icon:p.SXMenuIcon.Copy,onCommandSelected:()=>{_.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,K.CommandTypes.CopyImage);const t=g.decode(e.message).getFirstUriObjectChild(w.PictureNode);v.track(new T.MediaDownloadTelemetryEvent(e.message,T.MediaDownloadActionOrigin.StreamItem,T.MediaDownloadReason.Copy,t?f.default.extractFileExtension(t.getNameForUI()):void 0)),k.default.copyImageFromMessage(e.message)}});t.copyLinkMessage=e=>({command:K.CommandTypes.CopyLink,localizationKey:"StreamItem.ActionCopyLink",icon:p.SXMenuIcon.CopyLink,onCommandSelected:()=>{_.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,K.CommandTypes.CopyLink),k.default.copyLinkMessage(e.url,e.message)}});t.copyLocationMessage=e=>({command:K.CommandTypes.CopyLocation,localizationKey:"StreamItem.ActionCopy",icon:p.SXMenuIcon.Copy,onCommandSelected:()=>{_.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,K.CommandTypes.CopyLocation),k.default.copyLocationMessage(e.message,e.decodedNode)}});t.openMediaLocation=e=>({command:K.CommandTypes.OpenMediaLocation,localizationKey:q.default.getPlatformType()===m.PlatformType.OSX?"StreamItem.ActionOpenFileLocationMac":"StreamItem.ActionOpenFileLocation",icon:q.default.getPlatformType()===m.PlatformType.OSX?p.SXMenuIcon.OpenFolder:p.SXMenuIcon.Open,onCommandSelected:()=>{_.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,K.CommandTypes.OpenMediaLocation),k.default.openMediaLocationOnDesktop(e.message)}});t.openFileLocation=e=>({command:K.CommandTypes.OpenFileLocation,localizationKey:q.default.getPlatformType()===m.PlatformType.OSX?"StreamItem.ActionOpenFileLocationMac":"StreamItem.ActionOpenFileLocation",icon:q.default.getPlatformType()===m.PlatformType.OSX?p.SXMenuIcon.OpenFolder:p.SXMenuIcon.Open,onCommandSelected:()=>{_.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,K.CommandTypes.OpenFileLocation),k.default.openFileLocationOnDesktop(e.decodedNode)}});t.markReadToHere=e=>({command:K.CommandTypes.MarkReadToHere,localizationKey:"StreamItem.ActionUnreadFromHere",icon:p.SXMenuIcon.UnreadMark,onCommandSelected:()=>{_.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,K.CommandTypes.MarkReadToHere),k.default.markMessageUnread(e.message,e.onMarkAsUnread)}});t.reportMessage=e=>({command:K.CommandTypes.Report,localizationKey:"StreamItem.ActionReportMessage",icon:p.SXMenuIcon.Warning,onCommandSelected:()=>{_.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,K.CommandTypes.Report);const t={mriToBlock:e.message.creator,rootViewId:e.componentContext.rootViewId,content:e.message};F.default.navigateToReportConcernModal(t)}});t.showReportedMessage=e=>({command:K.CommandTypes.ShowReported,localizationKey:"StreamItem.ActionShowReportedMessage",onCommandSelected:()=>{k.default.showReportedMessage(e.message)}});t.selectMessages=e=>({command:K.CommandTypes.SelectMessages,localizationKey:"StreamItem.SelectMessages",icon:p.SXMenuIcon.Checkmark,onCommandSelected:()=>{e.onSelectMessagesCommandCallback&&e.onSelectMessagesCommandCallback(e.contextConversationId)}});t.viewLink=e=>({command:K.CommandTypes.ViewLink,localizationKey:"StreamItem.ViewLink",onCommandSelected:()=>{k.default.viewLink(e.displayUrl,e.componentContext.rootViewId)}});t.cancelScheduledCall=e=>({command:K.CommandTypes.CancelScheduledCall,localizationKey:"ScheduledCallCard.DeleteScheduledCallOverflowItem",icon:p.SXMenuIcon.Dismiss,onCommandSelected:()=>{const t=e.decodedNode.getFirstUriObjectChild(P.ScheduledCallInviteNode);if(!t)return void v.error(m.LogTraceArea.ScheduleCall,"Canceling a ScheduledCall message but no Scheduled Call node was found");const s=C.getString("ScheduleCall.DeleteDialogTitle"),i=W.default.getLocalizedDeleteDialogMessage(t.subject),n=[{text:C.getString("Global.CancelLabel"),isCancel:!0},{text:C.getString("Global.DeleteLabel"),isSubmit:!0,onPress:()=>{z.default.cancelScheduledCall(t.scheduledCallId),v.track(new U.ScheduledCallCancelEvent(H.ScheduleCallCancelEventEntryPoint.MessageStream,t.conversationId)),j.default.maybeAnnounceForAccessibility(C.getString("ScheduleCall.DeletedAnnoucement",{title:t.subject+""}))},style:"destructive"}];o.default.showWithOptions({title:s,message:i,buttons:n,dialogAccessibilityTitle:i,rootViewId:e.componentContext.rootViewId})}});t.editScheduledCall=e=>({command:K.CommandTypes.EditScheduledCall,localizationKey:"ScheduledCallCard.ViewDetailsOverflowItem",icon:p.SXMenuIcon.Calendar,onCommandSelected:()=>{const t=$.default.newCauseId();v.log(m.LogTraceArea.ScheduleCall,"StreamItemCommands.editScheduledCall causeId: "+t);const s=e.decodedNode.getFirstUriObjectChild(P.ScheduledCallInviteNode);if(!s)return void v.error(m.LogTraceArea.ScheduleCall,"Editing a ScheduledCall message but no Scheduled Call node was found");const i=z.default.getScheduledCallById(s.scheduledCallId);i&&N.default.NavigationActions.navigateToScheduledOverviewPanel({entryPoint:H.ScheduleCallEntryPoint.MessageStream,scheduledCallId:i.id},e.componentContext.rootViewId)}});t.cancelPoll=e=>{const t={title:C.getString("Poll.DeleteDialogTitle"),body:C.getString("Poll.DeleteDialogMessage")};return{command:K.CommandTypes.CancelPoll,localizationKey:"StreamItem.ActionRemove",icon:p.SXMenuIcon.Dismiss,onCommandSelected:()=>{k.default.deleteMessage(e.message,e.componentContext.rootViewId,t,(()=>{e.decodedNode.getFirstUriObjectChild(P.PollNode)?(D.default.cancelPoll(e.message.cuid),j.default.maybeAnnounceForAccessibility(C.getString("Poll.DeleteConfirmation"))):v.error(m.LogTraceArea.PollStore,"Removing a Poll message but no Poll node was found")}))}}};t.debugDumpMessage=e=>({command:K.CommandTypes.DebugDumpMessage,localizationKey:"StreamItem.DumpMessage",onCommandSelected:()=>{k.default.dumpMessage(e.message,!1)}});t.debugDumpMessagePretty=e=>({command:K.CommandTypes.DebugDumpMessagePretty,localizationKey:"StreamItem.DumpMessagePretty",onCommandSelected:()=>{k.default.dumpMessage(e.message,!0)}})},67241:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ItemListKey=void 0,t.ItemListKey={ReadOnlyChatHeader:"readOnlyChatHeader",ContactInviteHeaderItem:"contactInviteHeaderItem",ContactInviteHeaderSpacer:"contactInviteHeaderSpacer",Composing:"composing",UnreadMarker:"unread",DateMarkerPrefix:"d_",MessagePrefix:"m_",ReadReceiptPrefix:"readReceipt",InviteMorePeople:"inviteMorePeople",NewConnection:"newConnection",SpeechConsent:"speechConsent"}},25638:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(63060),o=s(26712);class n extends i.default{constructor(e){super(),this._components=o.default.getURIComponents(e)}isImmutable(){return!0}getDocumentId(){if(this._components&&this._components.pathname){const e=this._components.pathname.match(n.AmsObjectIdRegex);if(e)return e[1]}}getViewId(){if(this._components&&this._components.pathname){const e=this._components.pathname.match(n.AmsViewIdRegex);if(e)return e[1]}}}t.default=n,n.AmsObjectIdRegex=/objects\/([^/]*)\//,n.AmsViewIdRegex=/views\/([^/]*)/},82927:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(65976),n=s(71830),r=s(10102),a=s(67213),l=s(33754),d=s(18078),c=s(78262),h=s(51038);class u extends a.default{constructor(e,t){super(),this._conversationId=e,this._conversation=t,this._displayName=this._calcDisplayName(),this._conversationMemberShortNames={}}isImmutable(){return!1}updateConversationAndCheckIfChanged(e){const t=this._displayName,s=this.getAvatarUrl(),o=this.getColor();this._conversation=e,this._displayName=this._calcDisplayName();let n=t!==this._displayName;n||(n=i.some(this._conversationMemberShortNames,((e,t)=>e!==this._getAndUpdateMemberShortName(t))));s!==this.getAvatarUrl()&&(n=!0);return o!==this.getColor()&&(n=!0),n}getDisplayName(e,t){return this._displayName||super.getDisplayName(e||l.getString("Notifications.UnknownGroupConversation"),t)}getUniqueId(){return this.getMri()}getMri(){return this._conversationId}_getFirstName(){}_getLastName(){}getMemberShortName(e){return this._conversationMemberShortNames[e]||this._getAndUpdateMemberShortName(e)}_getAndUpdateMemberShortName(e){let t;const s=h.getDisplayableProfile(e);if(this._conversation&&n.isThread(this._conversationId)){let o=s.getShortName(),n=!1;o&&(o=o.trim().toLowerCase(),n=!i.some(this._conversation.getThreadMembers(),(t=>{if(t.id===e)return!1;const s=h.getDisplayableProfile(t.id).getShortName();return s&&o===s.trim().toLowerCase()}))),t=n?s.getShortName():s.getDisplayName()}else t=s.getShortName();return this._conversationMemberShortNames[e]=t,t}getAvatarUrl(){let e=this._conversation&&this._conversation.isThread()?this._conversation.getThreadProperty(n.ThreadProps.Picture):void 0;if(e&&0===e.indexOf("URL@")){e=e.substr(4);const t=c.MediaViewSize.Thumbnail,s=o.getDocumentId(e);return s&&o.getDisplayUrl(s,c.UploadFileType.GroupAvatar,t)}if(!e||0!==e.indexOf("P2P@"))return e}getColor(){return this._conversation?this._conversation.color():r.getDefaultColorInfo(this._conversationId)}_calcDisplayName(){if(!this._conversation)return;let e=this._conversation.topicName();if(e){const t=this._conversation.getThreadMembers(),s=i.compact(i.map(t,(e=>n.getSkypeIdFromMri(e.id))));s.push("...");let o=e.split(", ");return i.intersection(s,o).length===o.length?this._generateTitleName():n.unescapeTextWithoutXml(e)}return this._generateTitleName()}_generateTitleName(){if(!this._conversation)return;const e=this._conversation.getThreadMembers(),t=i.filter(e,(e=>!d.default.isMyMri(e.id)));let s;if(0!==t.length){s=i.map(t.length<=3?t:t.slice(0,2),(e=>h.getDisplayableProfile(e.id).getDisplayName())).join(", "),t.length>3&&(s+=", "+l.getString("DisplayInfoStore.ListOtherNames",{count:t.length-2}))}return 1===e.length&&(s=l.getString("Global.UntitledChat")),s}}t.default=u},85455:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MaximumGroupConversationNameLength=t.ConversationHistoryTimeSpanImportant=void 0;const i=s(89391),o=s(63060),n=s(96856);t.ConversationHistoryTimeSpanImportant=2592e6,t.MaximumGroupConversationNameLength=50;class r extends o.default{constructor(e,t,s,i){super(),e?(this.conv=n.default.fromDatabaseObject(e.conv),this.syncInfo=e.syncInfo,this.counts=e.counts,this._needsSync=e._needsSync,this._isHighlight=e._isHighlight,this._forceToRecents=e._forceToRecents):(this.conv=t,this.syncInfo=s,this.counts=i,this._needsSync=this.needsSyncMessages()||this.needsSyncThreadDetails()||this.conv.hasPendingLies()?1:0,this._isHighlight=this.conv.isHighlightsThread()?1:0,this._forceToRecents=i&&i.unreadCount>0||this.conv.isFavorite()?1:0)}isImmutable(){return!0}static fromDatabaseObject(e){return e?new r(e):void 0}static newFakeEmptyMeta(e,t){const s=this.newEmptySyncInfo(),i=n.default.newFakeEmptyConversation(e,t);return new r(void 0,i,s,void 0)}static newEmptySyncInfo(){return{messagesStale:!1,messagesSyncState:void 0,messageHistoryStartTime:Number.MAX_VALUE}}static firstTimeMeta(e,t,s){return new r(void 0,e,t,s)}updateConversation(e){return e===this.conv?this:new r(void 0,e,this.syncInfo,this.counts)}updateSyncInfo(e){return e===this.syncInfo?this:new r(void 0,this.conv,e,this.counts)}updateConversationAndSyncInfo(e,t){return e===this.conv&&t===this.syncInfo?this:new r(void 0,e,t,this.counts)}updateCounts(e){return e===this.counts?this:new r(void 0,this.conv,this.syncInfo,e)}updateEverything(e,t,s){return e===this.conv&&t===this.syncInfo&&s===this.counts?this:new r(void 0,e,t,s)}needsSyncMessages(){return!this.conv.isBricked&&this.syncInfo.messagesStale&&this.conv.isCurrentUserMember()&&this.conv.isSyncEnabled(i.default.getS4LMessagingFeaturesNoSubscription().syncSettings)}needsSyncThreadDetails(){return!(this.conv.isBricked||!this.conv.isSyncEnabled(i.default.getS4LMessagingFeaturesNoSubscription().syncSettings)||this.conv.isReactionsThread()||!this.conv.isCurrentUserMember())&&(!!this.conv.needsForceSyncThreadDetails()||!this.conv.hasApplicableMembersData())}}t.default=r},58962:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.cultureInfo=t.GifTrendingTabLocales=t.generateAssetKey=t.rewriteUrl=t.tabTypeToMediaBarCustomAction=t.mediaTypesToTabType=t.mediaTypes=t.frameHeights=t.getFrameHeight=t.getPixelSize=t.getEmoticonSizes=t.EmoticonUrl=t.PesPickerTriggeredBy=t.SearchableTabType=t.TabType=t.ModelDataState=t.PesPickerRenderPosition=t.PesItemTypes=t.AssetState=t.AssetDownloadStatus=void 0;const i=s(96486),o=s(16778),n=s(26424),r=s(78262);var a;!function(e){e[e.NONE=0]="NONE",e[e.DOWNLOADING=1]="DOWNLOADING",e[e.ERROR=2]="ERROR",e[e.SUCCESS=3]="SUCCESS",e[e.EXPIRED=4]="EXPIRED"}(t.AssetDownloadStatus||(t.AssetDownloadStatus={}));t.AssetState=class{constructor(e,t,s,i){this.status=e,this.name=t,this.url=s,this.localUri=i}},function(e){e[e.MODELZIP=0]="MODELZIP",e[e.IMAGEFILE=1]="IMAGEFILE",e[e.MODELBIN=2]="MODELBIN"}(t.PesItemTypes||(t.PesItemTypes={})),function(e){e[e.BOTTOM=0]="BOTTOM",e[e.TOP=1]="TOP"}(t.PesPickerRenderPosition||(t.PesPickerRenderPosition={}));t.ModelDataState=class{constructor(e,t,s,i,o,n,r){this.id=e,this.type=t,this.status=s,this.key=i,this.localUri=o,this.unzippedLocalUri=n,this.fileName=r}},function(e){e[e.Emoticon=0]="Emoticon",e[e.Moji=1]="Moji",e[e.CaptureSticker=2]="CaptureSticker",e[e.ChatSticker=3]="ChatSticker",e[e.Effect=4]="Effect",e[e.Gif=5]="Gif",e[e.PickerPopup=6]="PickerPopup",e[e.MeetNow=7]="MeetNow",e[e.ImageUploader=8]="ImageUploader"}(a=t.TabType||(t.TabType={})),function(e){e[e.Emoticon=0]="Emoticon",e[e.Moji=1]="Moji",e[e.CaptureSticker=2]="CaptureSticker",e[e.ChatSticker=3]="ChatSticker",e[e.Gif=4]="Gif",e[e.PickerPopup=5]="PickerPopup"}(t.SearchableTabType||(t.SearchableTabType={})),function(e){e[e.ContextMenu=1]="ContextMenu",e[e.LongPress=2]="LongPress",e[e.MeetNowLobby=3]="MeetNowLobby",e[e.GroupProfileHeader=4]="GroupProfileHeader"}(t.PesPickerTriggeredBy||(t.PesPickerTriggeredBy={}));const l=i.once((()=>({width:window.screen&&window.screen.width||0,height:window.screen&&window.screen.height||0,isHighDensity:o.UserInterface.isHighPixelDensityScreen()})));t.EmoticonUrl={profilePrefix:"default_",animSuffix:"_anim",flatSuffix:"_f",diverseSuffix:"_s"};let d={[n.EmoticonSize.Small]:40,[n.EmoticonSize.Medium]:60,[n.EmoticonSize.Large]:80,[n.EmoticonSize.ExtraLarge]:160,[n.EmoticonSize.ExtraExtraLarge]:240},c={[n.EmoticonSize.Small]:20,[n.EmoticonSize.Medium]:40,[n.EmoticonSize.Large]:40,[n.EmoticonSize.ExtraLarge]:80,[n.EmoticonSize.ExtraExtraLarge]:120};t.getEmoticonSizes=function(){return i.uniq(i.values(l().isHighDensity?d:c))},t.getPixelSize=function(e){return l().isHighDensity?d[e]:c[e]},t.getFrameHeight=function(e){switch(e){case n.EmoticonSize.Small:return t.frameHeights.emoticons.SMALL;case n.EmoticonSize.Medium:return t.frameHeights.emoticons.Size30;case n.EmoticonSize.Large:return t.frameHeights.emoticons.Size40;case n.EmoticonSize.ExtraLarge:return t.frameHeights.emoticons.Size80;case n.EmoticonSize.ExtraExtraLarge:return t.frameHeights.emoticons.Size120;default:return t.frameHeights.emoticons.Size40}},t.frameHeights={emoticons:{SMALL:20,Size30:30,Size40:40,Size80:80,Size120:120},moji:{Size40:40,Size70:70,Size80:80,Size108:108,Size200:200,Size232:232},stickers:{Size50:50,Size80:80,Size90:90,Size112:112,Size75:175},gifs:{Size90:90}},t.mediaTypes={emoticon:"emoticon",moji:"flik",sticker:"sticker",gif:"gif"},t.mediaTypesToTabType={[t.mediaTypes.emoticon]:a.Emoticon,[t.mediaTypes.moji]:a.Moji,[t.mediaTypes.sticker]:a.CaptureSticker,[t.mediaTypes.gif]:a.Gif},t.tabTypeToMediaBarCustomAction={[a.Emoticon]:r.MediaBarCustomAction.LaunchEmoticon,[a.Moji]:r.MediaBarCustomAction.LaunchMoji,[a.ChatSticker]:r.MediaBarCustomAction.LaunchSticker,[a.Gif]:r.MediaBarCustomAction.LaunchGif},t.rewriteUrl=function(e,t){let s=e;return i.some(t,(e=>-1!==s.search(e.from)&&(s=s.replace(e.from,e.to),!0))),s},t.generateAssetKey=function(e,t,s,i){return`${e}_${t}_${s}_${i||"NA"}`};!function(e){e[e["en-US"]=0]="en-US",e[e["en-CA"]=1]="en-CA",e[e["en-AU"]=2]="en-AU",e[e["zh-CN"]=3]="zh-CN"}(t.GifTrendingTabLocales||(t.GifTrendingTabLocales={})),t.cultureInfo=new class{constructor(){this.mappings=[{language:"am",defaultLocale:"am-et"},{language:"ar",defaultLocale:"ar-sa"},{language:"bg",defaultLocale:"bg-bg"},{language:"bn",defaultLocale:"bn-in"},{language:"ca",defaultLocale:"ca-es"},{language:"cs",defaultLocale:"cs-cz"},{language:"cy",defaultLocale:"cy-gb"},{language:"da",defaultLocale:"da-dk"},{language:"de",defaultLocale:"de-de"},{language:"el",defaultLocale:"el-gr"},{language:"en",defaultLocale:"en-us"},{language:"es",defaultLocale:"es-es"},{language:"et",defaultLocale:"et-ee"},{language:"eu",defaultLocale:"eu-es"},{language:"fa",defaultLocale:"fa-ir"},{language:"fi",defaultLocale:"fi-fl"},{language:"fil",defaultLocale:"fil-ph"},{language:"fr",defaultLocale:"fr-fr"},{language:"gl",defaultLocale:"gl-es"},{language:"gu",defaultLocale:"gu-in"},{language:"he",defaultLocale:"he-il"},{language:"hi",defaultLocale:"hi-in"},{language:"hr",defaultLocale:"hr-hr"},{language:"hu",defaultLocale:"hu-hu"},{language:"id",defaultLocale:"id-id"},{language:"is",defaultLocale:"is-is"},{language:"it",defaultLocale:"it-it"},{language:"ja",defaultLocale:"ja-jp"},{language:"kk",defaultLocale:"kk-kz"},{language:"kn",defaultLocale:"kn-in"},{language:"ko",defaultLocale:"ko-kr"},{language:"ku",defaultLocale:"ku-arab-iq"},{language:"lt",defaultLocale:"lt-lt"},{language:"lv",defaultLocale:"lv-lv"},{language:"ml",defaultLocale:"ml-in"},{language:"mr",defaultLocale:"mr-in"},{language:"ms",defaultLocale:"ms-my"},{language:"nb",defaultLocale:"nb-no"},{language:"nl",defaultLocale:"nl-nl"},{language:"nn",defaultLocale:"nn-no"},{language:"or",defaultLocale:"or-in"},{language:"pl",defaultLocale:"pl-pl"},{language:"pt",defaultLocale:"pt-pt"},{language:"ro",defaultLocale:"ro-ro"},{language:"ru",defaultLocale:"ru-ru"},{language:"sk",defaultLocale:"sk-sk"},{language:"sl",defaultLocale:"sl-si"},{language:"sr",defaultLocale:"sr-cyrl-rs"},{language:"sr-cyrl",defaultLocale:"sr-cyrl-rs"},{language:"sr-latn",defaultLocale:"sr-latn-rs"},{language:"sv",defaultLocale:"sv-se"},{language:"sw",defaultLocale:"sw-ke"},{language:"ta",defaultLocale:"ta-in"},{language:"te",defaultLocale:"te-in"},{language:"th",defaultLocale:"th-th"},{language:"tr",defaultLocale:"tr-tr"},{language:"uk",defaultLocale:"uk-ua"},{language:"ur",defaultLocale:"ur-pk"},{language:"vi",defaultLocale:"vi-vn"},{language:"zh",defaultLocale:"zh-cn"},{language:"zh-hant",defaultLocale:"zh-tw"},{language:"zh-cht",defaultLocale:"zh-tw"},{language:"zh-hk",defaultLocale:"zh-tw"},{language:"zh-mo",defaultLocale:"zh-tw"}],this.pesMappings=[{locale:"am-et",pesLocale:"am-ET"},{locale:"ar-sa",pesLocale:"ar-SA"},{locale:"az-latn-az",pesLocale:"az-Latn-AZ"},{locale:"be-by",pesLocale:"be-BY"},{locale:"bg-bg",pesLocale:"bg-BG"},{locale:"bn-bd",pesLocale:"bn-BD"},{locale:"bn-in",pesLocale:"bn-IN"},{locale:"bs-latn-ba",pesLocale:"bs-Latn-BA"},{locale:"ca-es",pesLocale:"ca-ES"},{locale:"ca-es-valencia",pesLocale:"ca-ES-valencia"},{locale:"cs-cz",pesLocale:"cs-CZ"},{locale:"cy-gb",pesLocale:"cy-GB"},{locale:"da-dk",pesLocale:"da-DK"},{locale:"de-de",pesLocale:"de-DE"},{locale:"el-gr",pesLocale:"el-GR"},{locale:"en-gb",pesLocale:"en-GB"},{locale:"en-us",pesLocale:"en-US"},{locale:"es-es",pesLocale:"es-ES"},{locale:"es-mx",pesLocale:"es-MX"},{locale:"es-us",pesLocale:"es-MX"},{locale:"es-ar",pesLocale:"es-MX"},{locale:"et-ee",pesLocale:"et-EE"},{locale:"eu-es",pesLocale:"eu-ES"},{locale:"fa-ir",pesLocale:"fa-IR"},{locale:"fi-fl",pesLocale:"fi"},{locale:"fil-ph",pesLocale:"fil-PH"},{locale:"fr-fr",pesLocale:"fr-FR"},{locale:"gd-gb",pesLocale:"gd-GB"},{locale:"gl-es",pesLocale:"gl-ES"},{locale:"gu-in",pesLocale:"gu-IN"},{locale:"he-il",pesLocale:"he-IL"},{locale:"hi-in",pesLocale:"hi-IN"},{locale:"hr-hr",pesLocale:"hr-HR"},{locale:"hu-hu",pesLocale:"hu-HU"},{locale:"id-id",pesLocale:"id-ID"},{locale:"is-is",pesLocale:"is-IS"},{locale:"it-it",pesLocale:"it-IT"},{locale:"ja-jp",pesLocale:"ja-JP"},{locale:"ka-ge",pesLocale:"ka-GE"},{locale:"kk-kz",pesLocale:"kk-KZ"},{locale:"kn-in",pesLocale:"kn-IN"},{locale:"ko-kr",pesLocale:"ko-KR"},{locale:"ku-arab-iq",pesLocale:"ku-Arab-IQ"},{locale:"lb-lu",pesLocale:"lb-LU"},{locale:"lt-lt",pesLocale:"lt-LT"},{locale:"lv-lv",pesLocale:"lv-LV"},{locale:"mk-mk",pesLocale:"mk-MK"},{locale:"ml-in",pesLocale:"ml-IN"},{locale:"mr-in",pesLocale:"mr-IN"},{locale:"ms-my",pesLocale:"ms-MY"},{locale:"nb-no",pesLocale:"nb-NO"},{locale:"nl-nl",pesLocale:"nl-NL"},{locale:"nn-no",pesLocale:"nn-NO"},{locale:"or-in",pesLocale:"or-IN"},{locale:"pl-pl",pesLocale:"pl-PL"},{locale:"pt-br",pesLocale:"pt-BR"},{locale:"pt-pt",pesLocale:"pt-PT"},{locale:"ro-ro",pesLocale:"ro-RO"},{locale:"ru-ru",pesLocale:"ru-RU"},{locale:"sk-sk",pesLocale:"sk-SK"},{locale:"sl-si",pesLocale:"sl-SI"},{locale:"sq-al",pesLocale:"sq-AL"},{locale:"sr-cyrl-ba",pesLocale:"sr-Cyrl-BA"},{locale:"sr-cyrl-rs",pesLocale:"sr-Cyrl-RS"},{locale:"sr-latn-rs",pesLocale:"sr-Latn-RS"},{locale:"sv-se",pesLocale:"sv-SE"},{locale:"sw-ke",pesLocale:"sw-KE"},{locale:"ta-in",pesLocale:"ta-IN"},{locale:"te-in",pesLocale:"te-IN"},{locale:"th-th",pesLocale:"th-TH"},{locale:"tr-tr",pesLocale:"tr-TR"},{locale:"uk-ua",pesLocale:"uk-UA"},{locale:"ur-pk",pesLocale:"ur-PK"},{locale:"uz-latn-uz",pesLocale:"uz-Latn-UZ"},{locale:"vi-vn",pesLocale:"vi-VN"},{locale:"zh-cn",pesLocale:"zh-CN"},{locale:"zh-tw",pesLocale:"zh-TW"}]}getMappingByLanguage(e){for(let t=0;t<this.mappings.length;t++)if(this.mappings[t].language.toLowerCase()===e.toLowerCase())return this.mappings[t]}getPesMapping(e){for(let t=0;t<this.pesMappings.length;t++)if(this.pesMappings[t].locale.toLowerCase()===e.toLowerCase()&&this.pesMappings[t])return this.pesMappings[t]}getPesLocale(e){if(!e)return"default";let t=this.getPesMapping(e);if(t&&t.pesLocale)return t.pesLocale;const s=this.getLocale(e);return s!==e&&(t=this.getPesMapping(s),t)?t.pesLocale:"default"}getLocale(e){const t=this.getMappingByLanguage(e);if(t)return t.defaultLocale;{const t=e.lastIndexOf("-");return t>-1?this.getLocale(e.substring(0,t)):e}}}},57946:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.convertDbSkypeDraftsInputToSavedMessageInput=t.convertSavedMessageInputToDbSkypeDraftsInput=t.SavedMessageType=void 0;const i=s(96486),o=s(81632),n=s(86374),r=s(23944),a=s(12692);var l;!function(e){e[e.None=0]="None",e[e.Edited=1]="Edited",e[e.Quoted=2]="Quoted"}(l=t.SavedMessageType||(t.SavedMessageType={})),t.convertSavedMessageInputToDbSkypeDraftsInput=function(e,t,s){const o=(0,r.decodeFromInput)(t.inputEntities,!1,s,!1),n=i.head(t.messages),a=i.tail(t.messages);return{conversationId:e,inputEntitiesDataVersion:t.inputEntitiesDataVersion,type:t.type,timestamp:t.timestamp,message:n,restMessages:i.size(a)>0?a:void 0,inputEntities:o.encodeToString()}},t.convertDbSkypeDraftsInputToSavedMessageInput=function(e){const{conversationId:t,inputEntities:s,inputEntitiesDataVersion:r,type:d,timestamp:c}=e;return{conversationId:t,messages:d===l.None?void 0:i.compact(i.map([e.message,...e.restMessages||[]],a.default.fromDatabaseObject)),inputEntities:(0,o.toEntities)(n.decodeFromContent(s),{supportEmoticons:!0}),inputEntitiesDataVersion:r,type:d,timestamp:c||Date.now()}}},96856:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ThreadPropLiesAllowed=t.PropLieType=t.ConvPropLiesAllowed=t.MagicUnreadPinnedNumber=t.MagicFavoritesPinnedNumber=void 0;const i=s(74958),o=s(96486),n=s(48467),r=s(68580),a=s(98925),l=s(51077),d=s(90239),c=s(71830),h=s(10102),u=s(63060),p=s(46096),g=s(36237),m=s(61253),S=s(18078),f=s(12692),y=s(4057),_=s(78262),v=s(27795),C="skypeid=";o.invert(c.ConversationProps),o.invert(c.ThreadProps);var b;t.MagicFavoritesPinnedNumber=31536e8,t.MagicUnreadPinnedNumber=15768e8,t.ConvPropLiesAllowed={[c.ConversationProps.Alerts]:!0,[c.ConversationProps.ConsumptionHorizon]:!0,[c.ConversationProps.Pinned]:!0,[c.ConversationProps.Subscription]:!0,[c.ConversationProps.ConversationStatus]:!0,[c.ConversationProps.ConversationBlocked]:!0,[c.ConversationProps.Color]:!0,[c.ConversationProps.Archived]:!0},function(e){e[e.Local=1]="Local",e[e.Global=2]="Global"}(b=t.PropLieType||(t.PropLieType={})),t.ThreadPropLiesAllowed={[c.ThreadProps.TopicName]:b.Global,[c.ThreadProps.Picture]:b.Global,[c.ThreadProps.JoinEnabled]:b.Global,[c.ThreadProps.LiveState]:b.Local,[c.ThreadProps.LastLeaveAt]:b.Local};const T=/identity="(.*?)"/g,M=/type="(.*?)"/g,I=[l.MessageTypes.HandshakeInvite,l.MessageTypes.HandshakeAccept,l.MessageTypes.HandshakeComplete];class w extends u.default{constructor(e,t=!1){super(),this.id=e.id,this.mriNamespace=c.getMriNamespace(this.id),this.convViewVersion=e.convViewVersion,this._convProps=e._convProps,this._convPropLieInfo=e._convPropLieInfo,this._consumptionHorizonPropVersion=e._consumptionHorizonPropVersion,this.memberConsumptionHorizonsSorted=e.memberConsumptionHorizonsSorted,this.threadDetailsVersion=e.threadDetailsVersion,this._threadProps=e._threadProps,this._threadPropLieInfo=e._threadPropLieInfo,this._threadMembers=e._threadMembers,this._forceSyncThreadDetails=e._forceSyncThreadDetails||!1,this.lastMessage=e.lastMessage?f.default.fromDatabaseObject(e.lastMessage):void 0,this.lastCallTime=e.lastCallTime,this.lastCallDirection=e.lastCallDirection,this.isFake=e.isFake,this.isBricked=e.isBricked&&!c.isOneOnOneConversation(this.id),this._timestamp=e._timestamp||this._calcTimestamp(),this._searchTerms=(t?e._searchTerms:this._generateSearchTerms())||"",this._lastHandshakeChangeTime=e._lastHandshakeChangeTime}_generateSearchTerms(){const e=[];let t=this.topicName();t&&(t=c.unescapeTextWithoutXml(t),e.push(t));const s=this.getMemberMrisWithoutMe();return s&&e.push(...s),e.join(" ")}isImmutable(){return!0}static _mergeLastMessage(e,t){return e&&!o.isEmpty(e)?t?t.applyServerMessage(e):f.default.fromFirstServerMessage(e):t}static fromRawConversation(e,t){let s=w._mergeLastMessage(e.lastMessage,t);return s&&s.isMergingBotHighlightMessageLocal(e.id)&&(s=void 0),new w({id:e.id,convViewVersion:e.version,_convProps:e.properties,_convPropLieInfo:void 0,_consumptionHorizonPropVersion:void 0,memberConsumptionHorizonsSorted:void 0,threadDetailsVersion:0,_threadProps:e.threadProperties,_threadPropLieInfo:void 0,_threadMembers:void 0,lastMessage:s,lastCallTime:void 0,lastCallDirection:void 0,isFake:!1,isBricked:!1,_timestamp:void 0,_forceSyncThreadDetails:!1})}static fromRawThread(e){return new w({id:e.id,convViewVersion:0,_convProps:{},_convPropLieInfo:void 0,_consumptionHorizonPropVersion:void 0,memberConsumptionHorizonsSorted:void 0,threadDetailsVersion:e.version,_threadProps:this._removeInvalidThreadProps(e.properties),_threadPropLieInfo:void 0,_threadMembers:e.members,lastMessage:void 0,lastCallTime:void 0,lastCallDirection:void 0,isFake:!1,isBricked:!1,_forceSyncThreadDetails:!1})}static newFakeEmptyConversation(e,t){return new w({id:e,convViewVersion:0,_convProps:{},_convPropLieInfo:void 0,_consumptionHorizonPropVersion:void 0,memberConsumptionHorizonsSorted:void 0,threadDetailsVersion:0,_threadProps:c.isThread(e)?{}:void 0,_threadPropLieInfo:void 0,lastMessage:void 0,_threadMembers:t?[{id:t,role:d.ThreadMemberRoles.User},{id:S.default.getSkypeMri(),role:d.ThreadMemberRoles.User}]:void 0,lastCallDirection:void 0,lastCallTime:void 0,isFake:!0,isBricked:!1,_forceSyncThreadDetails:!1})}static fromDatabaseObject(e){return e?new w(e,!0):void 0}mergeConversationUpdate(e,t){let s,n=w._mergeLastMessage(e.lastMessage,t);if(e.version<=this.convViewVersion)return g.log(p.LogTraceArea.SkypeConversationLocal,"Ignoring out of date conversation:, ",i.pii.Mri(this.id),"New version:",e.version,"<=",this.convViewVersion,"lastMessage version:",this.lastMessage?this.lastMessage.getLatestServerMessageVersion():"n/a","new lastMessage version:",n?n.getLatestServerMessageVersion():"n/a"),this;let r=!1;if(e.threadProperties){if(s=o.cloneDeep(this._threadProps)||{},void 0!==e.threadProperties[c.ThreadProps.TopicName]){const t=(this.getThreadProperty(c.ThreadProps.TopicName)||"").toString().length;let i=!0;e.threadProperties[c.ThreadProps.TopicName].toString().length>=60&&(t<60?r=!0:i=!1),i&&(s[c.ThreadProps.TopicName]=e.threadProperties[c.ThreadProps.TopicName])}o.each(c.getThreadPropsInConversationView(),(t=>{e.threadProperties[t]?s[t]=e.threadProperties[t]:delete s[t]}))}let a,l=e.properties;this._consumptionHorizonPropVersion&&this._consumptionHorizonPropVersion>e.version&&(a=this._consumptionHorizonPropVersion,l=o.cloneDeep(l),l[c.ConversationProps.ConsumptionHorizon]=this._convProps[c.ConversationProps.ConsumptionHorizon]);const[d,h,u]=this._calcNewServerMessageInfo(this.lastCallTime,this.lastCallDirection,n,!1);return new w({id:this.id,convViewVersion:e.version,_convProps:l,_convPropLieInfo:this._convPropLieInfo,_consumptionHorizonPropVersion:a,memberConsumptionHorizonsSorted:this.memberConsumptionHorizonsSorted,threadDetailsVersion:this.threadDetailsVersion,_threadProps:s,_threadPropLieInfo:this._threadPropLieInfo,_threadMembers:this._threadMembers,lastMessage:d,lastCallTime:h,lastCallDirection:u,isFake:!1,isBricked:!1,_lastHandshakeChangeTime:this._lastHandshakeChangeTime,_forceSyncThreadDetails:r})}mergeThreadUpdate(e){if(this._forceSyncThreadDetails)g.log(p.LogTraceArea.SkypeConversationLocal,"Force syncing thread update: "+i.pii.Mri(this.id)+"New version: "+e.version+", old version: "+this.threadDetailsVersion);else if(this.threadDetailsVersion&&e.version<=this.threadDetailsVersion)return g.log(p.LogTraceArea.SkypeConversationLocal,"Ignoring out of date thread: ",i.pii.Mri(this.id),"New version:",e.version,"<=",this.threadDetailsVersion),this;const t=w._removeInvalidThreadProps(e.properties);if(this._threadProps&&(this._threadProps[c.ThreadProps.LastJoinAt]&&(t[c.ThreadProps.LastJoinAt]=this._threadProps[c.ThreadProps.LastJoinAt]),this._threadProps[c.ThreadProps.LastLeaveAt]&&(t[c.ThreadProps.LastLeaveAt]=this._threadProps[c.ThreadProps.LastLeaveAt])),void 0===t[c.ThreadProps.TopicName]&&(t[c.ThreadProps.TopicName]=""),this._threadProps&&(this._threadProps[c.ThreadProps.ThreadDetailsVersion]||Number(this._threadProps[c.ThreadProps.ThreadDetailsVersion])<e.version)&&(t[c.ThreadProps.ThreadDetailsVersion]=e.version.toString()),this.isEncryptedThread()){const e=this.getEncryptionHandshake(),s=this._parseSecureHandshake(t[c.ThreadProps.SecureHandshake]);if(e&&s){const i=c.ThreadProps.SecureDeviceSwitch;"None"!==e.HandshakeState&&(this._threadProps&&this._threadProps[i]?t[i]=!0:t[i]=e.InviteId!==s.InviteId);const n=c.ThreadProps.SecureHandshakeOnceEstablished;this._threadProps&&!o.isUndefined(this._threadProps[n])?t[n]=this._threadProps[n]:"Completed"===s.HandshakeState&&(t[n]=!0)}}return new w({id:this.id,convViewVersion:this.convViewVersion,_convProps:this._convProps,_convPropLieInfo:this._convPropLieInfo,_consumptionHorizonPropVersion:this._consumptionHorizonPropVersion,memberConsumptionHorizonsSorted:this.memberConsumptionHorizonsSorted,threadDetailsVersion:e.version,_threadProps:t,_threadPropLieInfo:this._threadPropLieInfo,_threadMembers:c.filterMembersProp(e.members),lastMessage:this.lastMessage,lastCallTime:this.lastCallTime,lastCallDirection:this.lastCallDirection,isFake:!1,isBricked:!1,_lastHandshakeChangeTime:this._lastHandshakeChangeTime,_forceSyncThreadDetails:!1})}mergeMessageLocal(e,t){const[s,i,o,n,r]=this._calcNewServerMessageInfo(this.lastCallTime,this.lastCallDirection,e,t);return r?new w({id:this.id,convViewVersion:this.convViewVersion,_convProps:this._convProps,_convPropLieInfo:this._convPropLieInfo,_consumptionHorizonPropVersion:this._consumptionHorizonPropVersion,memberConsumptionHorizonsSorted:this.memberConsumptionHorizonsSorted,threadDetailsVersion:this.threadDetailsVersion,_threadProps:this._threadProps,_threadPropLieInfo:this._threadPropLieInfo,_threadMembers:this._threadMembers,lastMessage:s,lastCallTime:i,lastCallDirection:o,isFake:this.isFake,isBricked:this.isBricked,_lastHandshakeChangeTime:n,_forceSyncThreadDetails:this._forceSyncThreadDetails}):this}mergeConsumptionHorizonPush(e,t){if(t&&(t<this.convViewVersion||this._consumptionHorizonPropVersion&&t<this._consumptionHorizonPropVersion))return this;let s=o.cloneDeep(this._convProps);s[c.ConversationProps.ConsumptionHorizon]=e;const n=c.getServerTimestampFromConsumptionHorizon(e),r=this.getConsumptionHorizonTimestamp();return r>n&&g.log(p.LogTraceArea.SkypeConversationLocal,"Remote consumption horizon is older then local: ",i.pii.Mri(this.id)," remove:",n," local:",r),new w({id:this.id,convViewVersion:this.convViewVersion,_convProps:s,_convPropLieInfo:this._convPropLieInfo,_consumptionHorizonPropVersion:t,memberConsumptionHorizonsSorted:this.memberConsumptionHorizonsSorted,threadDetailsVersion:this.threadDetailsVersion,_threadProps:this._threadProps,_threadPropLieInfo:this._threadPropLieInfo,_threadMembers:this._threadMembers,lastMessage:this.lastMessage,lastCallTime:this.lastCallTime,lastCallDirection:this.lastCallDirection,isFake:this.isFake,isBricked:this.isBricked,_lastHandshakeChangeTime:this._lastHandshakeChangeTime,_forceSyncThreadDetails:this._forceSyncThreadDetails})}mergeMemberConsumptionHorizons(e){let t=!1;const s=o.keyBy(this.memberConsumptionHorizonsSorted||[],(e=>e.id));if(o.each(e,(e=>{const o=c.getServerTimestampFromConsumptionHorizon(e.consumptionhorizon),n=c.getConsumptionHorizonUpdateTime(e.consumptionhorizon);(!s[e.id]||s[e.id].consumptionHorizon<o)&&(t=!0,s[e.id]={id:e.id,consumptionHorizon:o,consumptionHorizonUpdateTime:n}),g.log(p.LogTraceArea.SkypeConversationLocal,"Merging member consumption horizons: ",i.pii.Mri(this.id)," id:",i.pii.Mri(e.id)," consumptionHorizon:",o," updated:",n," wasUpdated:",t)})),!t)return this;const n=o.sortBy(o.values(s),(e=>e.consumptionHorizon));return new w({id:this.id,convViewVersion:this.convViewVersion,_convProps:this._convProps,_convPropLieInfo:this._convPropLieInfo,_consumptionHorizonPropVersion:this._consumptionHorizonPropVersion,memberConsumptionHorizonsSorted:n,threadDetailsVersion:this.threadDetailsVersion,_threadProps:this._threadProps,_threadPropLieInfo:this._threadPropLieInfo,_threadMembers:this._threadMembers,lastMessage:this.lastMessage,lastCallTime:this.lastCallTime,lastCallDirection:this.lastCallDirection,isFake:this.isFake,isBricked:this.isBricked,_lastHandshakeChangeTime:this._lastHandshakeChangeTime,_forceSyncThreadDetails:this._forceSyncThreadDetails})}dropLastMessage(){return new w({id:this.id,convViewVersion:this.convViewVersion,_convProps:this._convProps,_convPropLieInfo:this._convPropLieInfo,_consumptionHorizonPropVersion:this._consumptionHorizonPropVersion,memberConsumptionHorizonsSorted:this.memberConsumptionHorizonsSorted,threadDetailsVersion:this.threadDetailsVersion,_threadProps:this._threadProps,_threadPropLieInfo:this._threadPropLieInfo,_threadMembers:this._threadMembers,lastMessage:void 0,lastCallTime:this.lastCallTime,lastCallDirection:this.lastCallDirection,isFake:this.isFake,isBricked:this.isBricked,_lastHandshakeChangeTime:this._lastHandshakeChangeTime,_forceSyncThreadDetails:this._forceSyncThreadDetails})}_setNewPropInfo(e,t,s,i){return new w({id:this.id,convViewVersion:this.convViewVersion,_convProps:e,_convPropLieInfo:t,_consumptionHorizonPropVersion:this._consumptionHorizonPropVersion,memberConsumptionHorizonsSorted:this.memberConsumptionHorizonsSorted,threadDetailsVersion:this.threadDetailsVersion,_threadProps:s,_threadPropLieInfo:i,_threadMembers:this._threadMembers,lastMessage:this.lastMessage,lastCallTime:this.lastCallTime,lastCallDirection:this.lastCallDirection,isFake:this.isFake,isBricked:this.isBricked,_lastHandshakeChangeTime:this._lastHandshakeChangeTime,_forceSyncThreadDetails:this._forceSyncThreadDetails})}setConvPropertyLie(e,t,s){if(this._convProps[e]===t&&(!this._convPropLieInfo||!(e in this._convPropLieInfo)||this._convPropLieInfo[e].value===t&&(0,m.default)(this._convPropLieInfo[e].additionalParams,s)))return this;const i=this.getConversationProperty(e);if(e===c.ConversationProps.ConsumptionHorizon&&s&&"false"===s.bookmark&&!c.isConsumptionHorizonNewer(i,t))return this;let n=o.cloneDeep(this._convPropLieInfo)||{};return n[e]={value:t,additionalParams:s},this._setNewPropInfo(this._convProps,n,this._threadProps,this._threadPropLieInfo)}revertConvPropertyLie(e,t,s){if(!this._convPropLieInfo||!this._convPropLieInfo[e]||this._convPropLieInfo[e].value!==t||!(0,m.default)(this._convPropLieInfo[e].additionalParams,s))return this;let i=o.cloneDeep(this._convPropLieInfo)||{};return delete i[e],o.isEmpty(i)&&(i=void 0),this._setNewPropInfo(this._convProps,i,this._threadProps,this._threadPropLieInfo)}confirmConvPropertyLieApplied(e,t,s){if(!this._convPropLieInfo||!this._convPropLieInfo[e]||this._convPropLieInfo[e].value!==t||!(0,m.default)(this._convPropLieInfo[e].additionalParams,s))return this;const i=this.getConversationProperty(e);let n=o.cloneDeep(this._convPropLieInfo)||{};delete n[e],o.isEmpty(n)&&(n=void 0);let r=o.cloneDeep(this._convProps);return r[e]=i,this._setNewPropInfo(r,n,this._threadProps,this._threadPropLieInfo)}setThreadPropertyLie(e,t){if(!this._threadProps)return this;if(!(this._threadProps[e]!==t||this._threadPropLieInfo&&e in this._threadPropLieInfo&&this._threadPropLieInfo[e].value!==t))return this;let s=o.cloneDeep(this._threadPropLieInfo)||{};return s[e]={value:t},this._setNewPropInfo(this._convProps,this._convPropLieInfo,this._threadProps,s)}revertThreadPropertyLie(e,t){if(!this._threadPropLieInfo||!this._threadPropLieInfo[e]||this._threadPropLieInfo[e].value!==t)return this;let s=o.cloneDeep(this._threadPropLieInfo)||{};return delete s[e],o.isEmpty(s)&&(s=void 0),this._setNewPropInfo(this._convProps,this._convPropLieInfo,this._threadProps,s)}confirmThreadPropertyLieApplied(e,t){if(!this._threadPropLieInfo||!this._threadPropLieInfo[e]||this._threadPropLieInfo[e].value!==t)return this;let s=o.cloneDeep(this._threadPropLieInfo)||{};delete s[e],o.isEmpty(s)&&(s=void 0);let i=o.cloneDeep(this._threadProps);return i[e]=t,this._setNewPropInfo(this._convProps,this._convPropLieInfo,i,s)}brickConversation(){let e=o.cloneDeep(this._threadProps);return e&&(e[c.ThreadProps.ThreadDetailsVersion]="0"),new w({id:this.id,convViewVersion:this.convViewVersion,_convProps:this._convProps,_convPropLieInfo:void 0,_consumptionHorizonPropVersion:void 0,memberConsumptionHorizonsSorted:void 0,threadDetailsVersion:0,_threadProps:e,_threadPropLieInfo:void 0,_threadMembers:this._threadMembers,lastMessage:this.lastMessage,lastCallTime:this.lastCallTime,lastCallDirection:this.lastCallDirection,isFake:this.isFake,isBricked:!0,_forceSyncThreadDetails:!1})}_calcNewServerMessageInfo(e,t,s,i){if(s&&s.isMergingBotHighlightMessageLocal(this.id))return[this.lastMessage,e,t,this._lastHandshakeChangeTime,!1];if(!s)return[this.lastMessage,e,t,this._lastHandshakeChangeTime,!1];let n,r=!1,a=this.lastMessage,d=e,h=t,u=this._lastHandshakeChangeTime;if(this.lastMessage){const e=this.lastMessage.getLatestServerMessageVersion();n=e?Number(e):0}else n=0;const m=s.getLatestServerMessageVersion(),S=m?Number(m):0;let f=!1;if(f=s.isDeletedMessage()||s.isReported()?!!this.lastMessage&&this.lastMessage.cuid===s.cuid:!this.lastMessage||s.createdTime>this.lastMessage.createdTime||S>=n&&(s.createdTime===this.lastMessage.createdTime||this.lastMessage.cuid===s.cuid)||i&&(this.lastMessage.isDeletedMessage()||this.lastMessage.isUnreconciledEdit()||this.lastMessage.isCanceledScheduledCall()||this.lastMessage.isReported()||this.lastMessage.isHiddenTranslationSettingsMessage()||this.lastMessage.isHiddenInPreviewTranslation()||c.isConciergeBotMri(this.lastMessage.creator)&&!this.lastMessage.isAllowedEngagementBotMessage()),f&&(a=s,r=!0,g.log(p.LogTraceArea.SkypeConversationLocal,`Updated last message to cuid: ${s.cuid} createdTime ${s.createdTime}`)),s.messagetype===l.MessageTypes.Call){const t=e;d=e?Math.max(e,s.createdTime):s.createdTime,h=w._getCallType(s.content),d!==t&&(r=!0)}return o.includes(I,s.messagetype)&&(u=o.max([u,s.createdTime]),r=r||u!==this._lastHandshakeChangeTime),[a,d,h,u,r]}static _getCallType(e){const t=T.exec(e);if(t&&t.length>0&&S.default.getSkypeId()===t[1])return _.CallDirectionType.Outgoing;{const t=M.exec(e);return t&&t.length>0&&t[1]===n.CallCardType.Missed?_.CallDirectionType.Missed:_.CallDirectionType.Incoming}}static _removeInvalidThreadProps(e){const t=o.cloneDeep(e);return delete t[c.ThreadProps.LastJoinAt],delete t[c.ThreadProps.LastLeaveAt],t}isCurrentUserMember(){return!this.isBricked&&(!this.isThread()||(this._threadMembers&&this.threadDetailsVersion&&this.threadDetailsVersion>=this.convViewVersion?o.some(this._threadMembers,(e=>S.default.isMyMri(e.id))):!(this._threadProps&&this._threadProps[c.ThreadProps.LastLeaveAt]&&(!this._threadProps[c.ThreadProps.LastJoinAt]||Number(this._threadProps[c.ThreadProps.LastJoinAt])<Number(this._threadProps[c.ThreadProps.LastLeaveAt])))))}isDeleted(){const e=this.getDeletedTimestamp(),t=this.getSecureHandshakeTimestamp();return!(e<=0)&&(!this._timestamp||e>=this._timestamp&&e>=t)}getDeletedTimestamp(){const e=this._convProps[c.ConversationProps.DeleteTimestamp];return e?Number(e):0}getSecureHandshakeTimestamp(){const e=this.isEncryptedThread()?this.getEncryptionHandshake():void 0;return e?Date.parse(e.LastUpdateTs):0}isUserMember(e){return this.isThread()?o.includes(this.getMemberMris(),e):this.id===e||!!S.default.isMyMri(e)}hasAgentMember(){return this.isThread()?o.some(this.getThreadMembers(),(e=>c.isAgent(e.id))):c.isAgent(this.id)}isThread(){return this.mriNamespace===c.Namespaces.Thread}isOneOnOne(){return this._isOneOnOneNonReentrantCheck()||this.isLogicalOneOnOneSmsConversation()}isOneToOneThread(){return c.isOneToOneThread(this.id)}isOneToOneUserConvWithThreadIdSupport(){return c.isOneToOneThreadUserMriNamespace(this.id)}_isOneOnOneNonReentrantCheck(){return c.isMriNamespaceUser(this.mriNamespace)||this.mriNamespace===c.Namespaces.OneToOneTextMessage||c.isOneToOneThread(this.id)||c.isEncryptedThread(this.id)}getOneOnOneThreadId(){if(c.isV2Thread(this.id))return this.isSticky()?this.id:void 0;if(c.isOneToOneThreadUserMriNamespace(this.id)){const e=this._convProps[c.ConversationProps.OneToOneThreadId];return e?c.Namespaces.Thread+":"+e:(g.track(new v.DevDebug("buildOneOnOneThreadId",this.id)),c.buildOneOnOneThreadId(this.id))}}getTrackableConversationId(){return this.isOneOnOne()?this.getOneOnOneThreadId():this.id}getOtherPartyMri(){if(c.isMriNamespaceUser(this.mriNamespace)||this.mriNamespace===c.Namespaces.OneToOneTextMessage)return this.id;const e=o.find(this.getThreadMembers(),(e=>!S.default.isMyMri(e.id)&&c.isSkypeIdMri(e.id)));return e?e.id:void 0}getOtherPartyMriForOneToOneThread(){const e=o.find(this.getThreadMembers(),(e=>!S.default.isMyMri(e.id)));return e?e.id:void 0}getOtherPartyMriOrConvId(){return(this.isOneOnOne()?this.getOtherPartyMri():void 0)||this.id}isHighlightsThread(){return c.isHighlightsThread(this.id)}isBotHighlightsThread(){return c.isBotHighlightsThread(this.id)}isReactionsThread(){return!!this.isThread()&&!(this.getThreadProperty(c.ThreadProps.ThreadType)!==c.ThreadTypes.Reactions&&!c.isReactionsThread(this.id))}isBookmarksThread(){return c.isBookmarkConversation(this.id)}isEncryptedThread(){return c.isEncryptedThread(this.id)}isSkypeSMSConversation(){return c.isPhoneMri(this.id)}isLogicalOneOnOneSmsConversation(){return c.isPhoneMri(this.id)}isSyncEnabled(e){return!this.isHighlightsThread()&&(!(e&&e.skipCastSync&&this.isReactionsThread())&&!(e&&e.skipSmsMmsSync&&c.isSmsMmsThread(this.id)))}hasSpecificAgentMember(e){return!!e&&(o.includes(this.getMemberMrisWithoutMe(),e)&&this.getMemberMrisWithoutMe().length>1)}getLastJoinAt(){if(this._threadProps)return Number(this._threadProps[c.ThreadProps.LastJoinAt])}topicName(){if(this.isThread())return this.getThreadProperty(c.ThreadProps.TopicName)}getSuggestedActions(e,t){return t?this._getSuggestedActionsV2(e):this._getSuggestedActionsV1()}_getSuggestedActionsV1(){const e=y.default.parseJsonErrorToUndefined(this._convProps[c.ConversationProps.SuggestedActions]);return e&&e.messageId?{messageId:e.messageId.toString(),to:e.to,actions:o.map(e.actions,(e=>({title:e.title,value:e.value,type:e.type,image:e.image,pageTitle:e.displayText,attributes:e.channelData?e.channelData.telemetryData:void 0})))}:void 0}_getSuggestedActionsV2(e){}getSuggestedMessageActivity(e){}creator(){if(!this._threadProps||!this._threadProps[c.ThreadProps.Creator]){if(this.isBotHighlightsThread()){const e=c.getSkypeIdFromHighlightsThreadMri(this.id);return e?c.asMri(e):void 0}if(this.isHighlightsThread()){const e=c.getSkypeIdFromHighlightsThreadMri(this.id);return e?c.idAndNamespaceToMri(e,c.Namespaces.SkypeId):void 0}return this.isOneOnOne()&&!this.isThread()?this.id:void 0}const e=this._threadProps[c.ThreadProps.Creator],t=e.split(";");if(1===t.length)return e;let s;for(let e=t.length-1;e>=0;e--){const i=t[e];if(0===i.indexOf(C))return c.skypeIdToMri(i.substr(C.length));!s&&c.isMri(i)&&(s=i)}return s}createdDate(){return this._threadProps&&this._threadProps[c.ThreadProps.CreatedAt]?parseInt(this._threadProps[c.ThreadProps.CreatedAt],10):void 0}color(){return this._convProps&&this._convProps[c.ConversationProps.Color]?h.deserializeColorInfo(this._convProps[c.ConversationProps.Color]):h.getDefaultColorInfo(this.id)}getConnector(e){if(!this._threadProps)return;const t=o.find(o.keys(this._threadProps),(t=>t===c.stripMriNamespace(e)));return t?y.default.parseJsonErrorToUndefined(this._threadProps[t]):void 0}getWebhookUrl(e){if(!this._threadProps)return;const t=o.filter(o.keys(this._threadProps),(e=>o.startsWith(e,c.ConnectorThreadPropPrefix))),s=o.find(t,(t=>{if(!t)return!1;const s=y.default.parseJsonErrorToUndefined(this._threadProps[t]);return s?e===s.displayName:(g.log(p.LogTraceArea.SkypeConversationLocal,"Parsing failed for key: "+t+", value: "+this._threadProps[t]),!1)}));if(!s)return void g.log(p.LogTraceArea.SkypeConversationLocal,"No matching thread prop found for "+i.pii.Omit(e));const n=y.default.parseJsonErrorToUndefined(this._threadProps[s]);return n&&n.incomingUrl}getConnectorMris(){return o.compact(o.map(o.keys(this._threadProps),(e=>{if(o.startsWith(e,c.ConnectorThreadPropPrefix))return c.sanitizeMri(e,c.Namespaces.Bot)})))}getTimestamp(){return this._timestamp}getSortRank(){return this._timestamp+(this.isFavorite()?t.MagicFavoritesPinnedNumber:0)}_calcTimestamp(){let e=[0];return this.lastMessage&&e.push(this.lastMessage.createdTime),this._threadProps&&(this._threadProps[c.ThreadProps.CreatedAt]&&e.push(this._threadProps[c.ThreadProps.CreatedAt]),this._threadProps[c.ThreadProps.LastJoinAt]&&e.push(this._threadProps[c.ThreadProps.LastJoinAt]),this._threadProps[c.ThreadProps.LastLeaveAt]&&e.push(this._threadProps[c.ThreadProps.LastLeaveAt])),Math.max.apply(Math,e)}hasPendingLies(){return!!this._convPropLieInfo||!!this._threadPropLieInfo}getPendingConvPropLies(){return this._convPropLieInfo}getPendingThreadPropLies(){return this._threadPropLieInfo}isUserAlertsEnabled(){const e=this.getConversationProperty(c.ConversationProps.Alerts);return!e||"true"===e.toLowerCase()}isArchived(){return!!this.getConversationProperty(c.ConversationProps.Archived)}canDisplayArchived(){const e=this.getConversationProperty(c.ConversationProps.Archived);return!e||e<this._timestamp}isMuted(){return this.getSubscription()===c.SubscriptionTypes.Muted}isLoud(){return this.getSubscription()===c.SubscriptionTypes.Loud}isFavorite(){const e="true"===(this.getConversationProperty(c.ConversationProps.Pinned)||"").toLowerCase(),t="true"===(this.getConversationProperty(c.ConversationProps.Favorite)||"").toLowerCase();return e||t}isTranslated(){return this.getTranslationState()===a.TranslationState.Enabled}isTranslationDisabled(){return!o.includes([a.TranslationState.Enabled,a.TranslationState.Requested,a.TranslationState.Pending],this.getTranslationState())}getTranslationState(){if(this._convProps[c.ConversationProps.Translated]){const e=this.getConversationProperty(c.ConversationProps.Translated),t=parseInt(a.TranslationState[e],10);return t||a.TranslationState.Disabled}return a.TranslationState.Disabled}getMessageTranslationLocale(){return this.isThread()?this.getThreadProperty(c.ThreadProps.MessageTranslationLocale):this.getConversationProperty(c.ConversationProps.MessageTranslationLocale)}isJoinEnabled(){return this.isThread()&&"true"===(this.getThreadProperty(c.ThreadProps.JoinEnabled)||"").toLowerCase()}isModerated(){return this.isThread()&&"true"===(this.getThreadProperty(c.ThreadProps.ModeratedThread)||"").toLowerCase()}isSticky(){return this.isThread()&&"true"===(this.getThreadProperty(c.ThreadProps.IsSticky)||"").toLowerCase()}getBannedSkypeIds(){const e=this.isThread()&&this.getThreadProperty(c.ThreadProps.BannedUserList)||"";if(e){const t=o.map(e.split(","),(e=>c.getSkypeIdFromMri(c.asMri(e))));return o.compact(t)}return[]}isHistoryDisclosed(){return this.isThread()&&"true"===(this.getThreadProperty(c.ThreadProps.HistoryDisclosed)||"").toLowerCase()}isGuestJoinDisabled(){return this.isThread()&&"true"===(this.getThreadProperty(c.ThreadProps.DisableAnonymousJoin)||"").toLowerCase()}getSubscription(){if(!this.isUserAlertsEnabled())return c.SubscriptionTypes.Muted;const e=this.getConversationProperty(c.ConversationProps.Subscription);return e===c.SubscriptionTypes.Muted?c.SubscriptionTypes.Loud:e||c.SubscriptionTypes.Loud}hasActiveCall(){return r.default.isLiveStateValid(this.liveState())}hasGoLive(){const e=this.validLiveState();return!!e&&r.default.isLiveStateForGoLive(e)}validLiveState(){const e=this.liveState();return r.default.isLiveStateValid(e)?e:void 0}liveState(){if(!this.isThread()){const e=this.getConversationProperty(c.ConversationProps.LiveState);return y.default.parseJsonErrorToUndefined(e)}const e=this.getThreadProperty(c.ThreadProps.LiveState);if(!e)return;const t=y.default.parseJsonErrorToUndefined(e);return t&&t.groupCallInitiator?(t.groupCallInitiator=c.sanitizeMri(t.groupCallInitiator,c.Namespaces.SkypeId),t):void 0}getConsumptionHorizon(){const e=this.getConversationProperty(c.ConversationProps.ConsumptionHorizon);if(e)return e;if(this.isThread()&&!this.isHighlightsThread()){const e=this.getLastJoinAt()||0;return e+";"+e+";0"}return"0;0;0"}getConsumptionHorizonTimestamp(){return c.getServerTimestampFromConsumptionHorizon(this.getConsumptionHorizon())}getConversationProperty(e){if(this._convPropLieInfo&&e in this._convPropLieInfo){const t=this._convPropLieInfo[e];if(e===c.ConversationProps.ConsumptionHorizon&&t.additionalParams&&"false"===t.additionalParams.bookmark&&!c.isConsumptionHorizonNewer(this._convProps[e],this._convPropLieInfo[e].value))return this._convProps[e];const s=this._convPropLieInfo[e].value;return null===s?void 0:s}return this._convProps[e]}getConversationPropertyLie(e){if(this._convPropLieInfo&&e in this._convPropLieInfo){const t=this._convPropLieInfo[e];return e===c.ConversationProps.ConsumptionHorizon&&t.additionalParams&&"false"===t.additionalParams.bookmark&&!c.isConsumptionHorizonNewer(this._convProps[e],this._convPropLieInfo[e].value)?this._convProps[e]:this._convPropLieInfo[e].value||void 0}}getThreadProperty(e,t=!0){if(this._threadProps){if(t&&this._threadPropLieInfo&&e in this._threadPropLieInfo){const t=this._threadPropLieInfo[e].value;return null===t?void 0:t}return this._threadProps[e]}}areThreadDetailsStale(){if(!this._threadProps)return!1;if(this.isFake&&this._isOneOnOneNonReentrantCheck())return!1;if(this._forceSyncThreadDetails)return!0;const e=Number(this._threadProps[c.ThreadProps.ThreadDetailsVersion]);return!e||this.threadDetailsVersion<e}isAdmin(e){return o.some(this.getThreadMembers(),(t=>t.id===e&&t.role===d.ThreadMemberRoles.Admin))}getThreadMembers(){if(!this.isThread())return[];if(this.areThreadDetailsStale()&&this.convViewVersion>this.threadDetailsVersion){const e=this._threadProps[c.ThreadProps.ConvView_MemberListString];if(e&&o.isString(e)){const t=y.default.parseJsonErrorToUndefined(e);if(t)return o.compact(o.map(t,(e=>e?o.isString(e)?{id:e,role:d.ThreadMemberRoles.User}:{id:e.MemberMri,role:1===e.MemberRole?d.ThreadMemberRoles.Admin:d.ThreadMemberRoles.User}:void 0)))}}return this._threadMembers||[]}getMemberMris(){return this.isThread()?o.map(this.getThreadMembers(),(e=>e.id)):[this.id,S.default.getSkypeMri()]}getMemberMrisWithoutMe(){return c.getMemberMrisWithoutMe(this.getMemberMris())}getMemberCount(){return this.isThread()?this.areThreadDetailsStale()&&c.ThreadProps.ConvView_MemberCount in this._threadProps?Number(this._threadProps[c.ThreadProps.ConvView_MemberCount]):this.getThreadMembers().length:this._convProps[c.ConversationProps.Participants]?this._convProps[c.ConversationProps.Participants].split(",").length:2}getConversationStatus(){const e=this._convProps[c.ConversationProps.ConversationStatus];if(e){const t=e;return parseInt(p.ConversationStatus[t],10)}}getConversationBlocked(){if(this._convProps[c.ConversationProps.ConversationBlocked])return"true"===this._convProps[c.ConversationProps.ConversationBlocked].toLowerCase()}isEmptyConversation(){if(this._convProps[c.ConversationProps.IsEmptyConversation])return"true"===this._convProps[c.ConversationProps.IsEmptyConversation].toLowerCase()}getAddedBy(){if(this._convProps[c.ConversationProps.ConversationStatusProperties]){const e=this._convProps[c.ConversationProps.ConversationStatusProperties],t=y.default.parseJsonErrorToUndefined(e);return t&&t.AddedBy}}getAcceptPendingMessageCount(){if(this._convProps[c.ConversationProps.ConversationStatusProperties]){const e=this._convProps[c.ConversationProps.ConversationStatusProperties],t=y.default.parseJsonErrorToUndefined(e);return t&&t.AcceptPendingMessageCount}}getEncryptionHandshake(){const e=this.getThreadProperty(c.ThreadProps.SecureHandshake);return this._parseSecureHandshake(e)}getLastEncryptionHandshakeChange(){return this._lastHandshakeChangeTime}isSwitchingSecureDevice(){return!!this.getThreadProperty(c.ThreadProps.SecureDeviceSwitch)}_parseSecureHandshake(e){if(!e)return;const t=y.default.parseJsonErrorToUndefined(e);if(!t)return void g.error(p.LogTraceArea.SkypeConversationLocal,`Failed to parse handshake info of secure thread ${i.pii.Mri(this.id)}`);const s=y.default.parseJsonErrorToUndefined(t.APartyKeyBundle),o=y.default.parseJsonErrorToUndefined(t.BPartyKeyBundle);return Object.assign(Object.assign({},t),{APartyPreKeyBundle:s,BPartyPreKeyBundle:o})}hasApplicableMembersData(){if(this.isBricked)return!1;if(!this.isCurrentUserMember())return!0;if(!this.isThread())return!0;if(c.ThreadProps.ConvView_MemberListString in this._threadProps)return!0;if(c.ThreadProps.ConvView_MemberCount in this._threadProps){if(Number(this._threadProps[c.ThreadProps.ConvView_MemberCount])>12)return!0}return!this.areThreadDetailsStale()}needsForceSyncThreadDetails(){return this._forceSyncThreadDetails}isGroupConversation(){return this.isThread()&&c.isGroupConversation(this.id)}getSource(){if(this.isThread())return this.getThreadProperty(c.ThreadProps.Source)}isLegacyMeetNowThread(){return this.isThread()&&this.getThreadProperty(c.ThreadProps.ThreadType)===c.ThreadTypes.LegacyMeetNow}}t.default=w},74163:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toClipboardObject=t.fromClipboardObject=void 0;const i=s(12692);t.fromClipboardObject=function(e){return i.default.fromFirstAcknowledgedLie({id:e.id,composetime:e.composetime,content:e.content,contenttype:e.contenttype,messagetype:e.messagetype},e.conversationId,e.creactor,e.createdTime)},t.toClipboardObject=function(e){return{id:e.getLatestServerMessageId()||"",content:e.content,composetime:new Date(e.composeTime).toDateString(),contenttype:e.contenttype,messagetype:e.messagetype,conversationId:e.conversationId,creactor:e.creator,createdTime:e.createdTime}}},12692:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(17003),n=s(89391),r=s(98925),a=s(81169),l=s(51077),d=s(71830),c=s(24898),h=s(46096),u=s(36237),p=s(61253),g=s(18078),m=s(69417),S=s(78262),f=s(53374),y=/\u2028|\u2029/g,_=(0,o.createRegExp)(o.Patterns.MATCH_IGNORABLE_SYMBOLS,"g"),v=/identity="(.*?)"/g,C=/(?:<|&lt;)quote((?:\s+[^=]+="[^"]+")+)\s*(?:>|&gt;)([^]*?)(?:<|&lt;)\/quote(?:>|&gt;)/gi,b=/([^\s=]+)="([^"]+)"/gi;class T extends c.default{constructor(e,t,s,o,n,r,a,c=!1,p,m,S,f,v){if(super(e),e){if(this.createdTime>=7e15&&(this.createdTime=Date.now()),this._isSendRejected){const e=i.findLast(this._unacknowledgedLies,(e=>!i.some(this._serverMessages,(t=>t.clientmessageid===e.clientmessageid))));this._sendRejectedCMID=e?e.clientmessageid:void 0}}else if(t||s||o){if(t){this._serverMessages=i.orderBy(t,[e=>e.version||e.id,e=>e.content?e.content.length:0,e=>e.properties?1:0]);{const e=this._serverMessages[0];for(let t=1;t<this._serverMessages.length;){const s=this._serverMessages[t-1],i=this._serverMessages[t];s.version===i.version?(this._serverMessages.splice(t-1,1),u.log(h.LogTraceArea.MessageStream,"Message "+s.id+" removed as not important")):!i.skypeeditedid&&i.id>e.id&&i.content!==e.content?(this._serverMessages.splice(t,1),u.log(h.LogTraceArea.MessageStream,"Message "+i.id+" removed as a fraud")):t++}}const e=i.find(this._serverMessages,(e=>!e.skypeeditedid))||i.head(this._serverMessages);if(e){this.cuid=d.getCuidForMessage(e);const t=d.getParsedConversationId(e);this.conversationId=t||r,this.createdTime=Number(e.id),this.creator=d.getCreatorMriForMessageFromLink(e.from);const s=Date.parse(e.composetime);this.composeTime=s||this.createdTime,e.messagetype!==l.MessageTypes.Call&&this._isOriginalConfirmedServerMessage(e)&&(this._serverMessages=i.filter(this._serverMessages,(e=>d.getCreatorMriForMessageFromLink(e.from)===this.creator)))}}else{const e=i.head(o)||i.head(s);if(e&&(this.cuid=d.getCuidForMessage(e)),this.conversationId=r,this.createdTime=S,e&&e===i.head(o)&&e.id&&(this.createdTime=Number(e.id)),e){const t=Date.parse(e.composetime);this.composeTime=t||this.createdTime}this.creator=a}let e,C;i.isEmpty(s)&&i.isEmpty(o)||(this._acknowledgedLies=i.filter(o,(e=>!i.some(this._serverMessages,(t=>t.clientmessageid===e.clientmessageid||t.version>=e.version)))),this._unacknowledgedLies=i.filter(s,(e=>!(i.some(this._serverMessages,(t=>t.clientmessageid===e.clientmessageid))||e.cancel&&i.some(this._serverMessages,(t=>t.clientmessageid===e.skypeeditedid))))));let b=!1;{const t=(e,t)=>i.maxBy([e,t],(e=>e?new Date(e.composetime).getTime():0)),s=e=>i.findLast(e,(e=>!l.isDeletedMessage(e)));e=t(s(this._acknowledgedLies),s(this._unacknowledgedLies)),C=t(i.last(this._acknowledgedLies),i.last(this._unacknowledgedLies)),p&&C&&C.clientmessageid===p&&l.isDeletedMessage(C)&&(b=!0)}const T=i.findLast(this._serverMessages,(e=>this._isContentEdited(e))),M=this.getOriginalServerMessage();let I=(b?e:C)||T||M||C;(I.clientmessageid===p||b&&C&&C.clientmessageid===p)&&(this._sendRejectedCMID=p,this._sendRetryInfo=m),this.content=(I.content||"").replace(_,"").replace(y,"\n"),this.messagetype=I.messagetype,this.contenttype=I.contenttype,I.skypeemoteoffset&&(this.skypeemoteoffset=Number(I.skypeemoteoffset)),I.skypeeditoffset&&(this.skypeeditoffset=Number(I.skypeeditoffset)),I.skypeguid&&(this.skypeguid=I.skypeguid),I.amsreferences&&(this.amsreferences=i.clone(I.amsreferences));const w=T||M;w&&w.fromline&&(this.fromline=w.fromline);const P=this._serverMessages&&this._serverMessages.length?this._getServerMessageForProperties():(b?e:void 0)||C;let k=P?i.cloneDeep(P.properties):void 0;i.isEmpty(n)||(this._unacknowledgedPropSets=n,i.each(n,(e=>{k||(k={}),k[e.key]=e.value}))),this.properties=k,this._isEphemeral=c,this._fileEncryptionKeys=f,this.reported=v,this._countsType=this.countsForUnreadCounts()?this._countsForHighPriorityUnreadCounts()?2:1:void 0,this._isMyMessage=g.default.isMyMri(this.creator)?1:0}}static fromDatabaseObject(e){return e?new T(e):void 0}static fromFirstLie(e,t,s,i,o=!1){return new T(void 0,void 0,[e],void 0,void 0,t,s,o,void 0,void 0,i)}static fromFirstAcknowledgedLie(e,t,s,i,o=!1){return new T(void 0,void 0,void 0,[e],void 0,t,s,o,void 0,void 0,i)}static fromFirstServerMessage(e){if(d.getParsedConversationId(e))return new T(void 0,[e]);u.warn(h.LogTraceArea.MessageStream,"Message "+e.id+" has invalid conversationLink")}isImmutable(){return!0}rejectMessageSend(e,t,s){return this._sendRejectedCMID===e&&this.createdTime===t&&(0,p.default)(this._sendRetryInfo,s)?this:new T(void 0,this._serverMessages,this._unacknowledgedLies,this._acknowledgedLies,this._unacknowledgedPropSets,this.conversationId,this.creator,this._isEphemeral,e,s,t,this._fileEncryptionKeys,this.reported)}applyServerMessage(e){let t=this._unacknowledgedPropSets;if(t){const s=this._getServerMessageForProperties();s&&s.id===e.id&&s.version<e.version&&(t=void 0)}if(d.isPhoneMri(this.conversationId)&&e.properties){const t=l.getSmsDeliveryReport(this.properties),s=l.getSmsDeliveryReport(e.properties);if(!t&&s&&!l.isSmsDeliveredSuccessfully(s)){const e=this.getLatestRelevantClientMessageId();u.track(new m.SmsDeliveryFailed(e,s))}}const s=(this._serverMessages||[]).concat(e);return new T(void 0,s,this._unacknowledgedLies,this._acknowledgedLies,t,this.conversationId,this.creator,this._isEphemeral,this._sendRejectedCMID,this._sendRetryInfo,this.createdTime,this._fileEncryptionKeys,this.reported)}applyMessageForPostingLie(e){const t=(this._unacknowledgedLies||[]).concat(e);return new T(void 0,this._serverMessages,t,this._acknowledgedLies,this._unacknowledgedPropSets,this.conversationId,this.creator,this._isEphemeral,void 0,void 0,this.createdTime,this._fileEncryptionKeys,this.reported)}revertMessageForPostingLie(e){const t=i.filter(this._unacknowledgedLies,(t=>t.clientmessageid!==e));if(!(t.length||this._serverMessages&&this._serverMessages.length)){const e={clientmessageid:f.default.newClientMessageId(),content:this.content.substr(0,this.skypeemoteoffset||0),contenttype:this.contenttype,messagetype:this.messagetype,skypeeditedid:this.getOriginalClientMessageId(),composetime:(new Date).toISOString(),cancel:!0};t.push(e)}return new T(void 0,this._serverMessages,t,this._acknowledgedLies,this._unacknowledgedPropSets,this.conversationId,this.creator,this._isEphemeral,this._sendRejectedCMID,this._sendRetryInfo,this.createdTime,this._fileEncryptionKeys,this.reported)}applyPropertyLie(e,t){const s=(this._unacknowledgedPropSets||[]).concat({key:e,value:t});return new T(void 0,this._serverMessages,this._unacknowledgedLies,this._acknowledgedLies,s,this.conversationId,this.creator,this._isEphemeral,this._sendRejectedCMID,this._sendRetryInfo,this.createdTime,this._fileEncryptionKeys,this.reported)}revertPropertyLie(e,t){const s=i.filter(this._unacknowledgedPropSets,(s=>s.key!==e||s.value!==t));return new T(void 0,this._serverMessages,this._unacknowledgedLies,this._acknowledgedLies,s,this.conversationId,this.creator,this._isEphemeral,this._sendRejectedCMID,this._sendRetryInfo,this.createdTime,this._fileEncryptionKeys,this.reported)}acknowledgeMessageLie(e,t,s){const o=i.partition(this._unacknowledgedLies,(t=>t.clientmessageid===e)),n=i.last(o[0]);if(!n)return this;const r=Object.assign(Object.assign({},n),{id:t,version:s}),a=(this._acknowledgedLies||[]).concat(r);return new T(void 0,this._serverMessages,o[1],a,this._unacknowledgedPropSets,this.conversationId,this.creator,this._isEphemeral,this._sendRejectedCMID,this._sendRetryInfo,this.createdTime,this._fileEncryptionKeys,this.reported)}addFileKeyMaterial(e){return(0,p.default)(e,this._fileEncryptionKeys)?this:new T(void 0,this._serverMessages,this._unacknowledgedLies,this._acknowledgedLies,this._unacknowledgedPropSets,this.conversationId,this.creator,this._isEphemeral,this._sendRejectedCMID,this._sendRetryInfo,this.createdTime,e,this.reported)}markAsReported(e){return e===this.reported?this:new T(void 0,this._serverMessages,this._unacknowledgedLies,this._acknowledgedLies,this._unacknowledgedPropSets,this.conversationId,this.creator,this._isEphemeral,this._sendRejectedCMID,this._sendRetryInfo,this.createdTime,this._fileEncryptionKeys,e)}clone(){return i.cloneDeep(this)}getMutableClone(){return this.clone()}getUniqueReactions(){const e=l.getCleanedEmotionMetadata(this.properties),t=i.flatten(i.map(e,(e=>i.map(e.users,(t=>({key:e.key,mri:t.mri,time:t.time})))))),s=i.groupBy(t,(e=>e.mri)),o=i.mapValues(s,((e,t)=>i.maxBy(e,(e=>e.time)))),n=i.groupBy(o,(e=>e.key));return i.sortBy(i.map(n,((e,t)=>({key:t,users:e}))),(e=>-e.users.length))}getReactionsAndFilterMri(e){const t=this.getUniqueReactions();let s;for(let o=0;o<t.length;o++)if(i.some(t[o].users,(t=>t.mri===e))){s=t[o].key;break}return{mriReactionKey:s,fullListReactions:t}}hasReactions(){const e=l.getCleanedEmotionMetadata(this.properties);return!i.isEmpty(e)}getReactions(){const e=l.getCleanedEmotionMetadata(this.properties),t=i.flatten(i.map(e,(e=>i.map(e.users,(t=>({key:e.key,mri:t.mri,time:t.time})))))),s=i.groupBy(t,(e=>e.key));return i.orderBy(i.map(s,((e,t)=>({key:t,users:e}))),[e=>-e.users.length,e=>-i.maxBy(e.users,(e=>e.time)).time])}isLastChangeScheduledCallMetadata(){return l.isScheduledCallMetadataType(this.messagetype)}isLastChangeReactionConsumptionHorizonUpdate(){if(!this._serverMessages)return!1;const e=this.getLatestServerMessage();if(!e)return!1;const t=this._getCurrentUserReactionConsumptionHorizonFromProperties(e.properties);if(!t)return!1;const s=this._serverMessages[this._serverMessages.length-2];if(s){const e=this._getCurrentUserReactionConsumptionHorizonFromProperties(s.properties);if(e)return e!==t}return!0}_getCurrentUserReactionConsumptionHorizonFromProperties(e){const t=l.getEmotionMetadata(e);if(!t)return;const s=i.find(t,(e=>e.key===l.MessageAnnotations.ReactionsConsumptionHorizon));if(!s)return;const o=i.find(s.users,(e=>g.default.isMyMri(e.mri)));return o?o.time:void 0}_getCurrentUserScheduledCallConsumptionHorizonFromProperties(e){const t=l.getScheduledCallConsumptionHorizons(e);if(!t)return;const s=i.find(t,((e,t)=>g.default.isMyMri(t)));return i.isUndefined(s)?void 0:s}getReactionUpdates(e){let t={added:[],removed:[]};const s=i.filter(l.flattenEmotionMetadata(this.getCleanedEmotionAnnotations()),(e=>!g.default.isMyMri(e.mri)));if(!e)return t.added=s,t;const o=i.filter(l.flattenEmotionMetadata(e.getCleanedEmotionAnnotations()),(e=>!g.default.isMyMri(e.mri)));return t.added=i.differenceWith(s,o,i.isEqual),t.removed=i.differenceWith(o,s,i.isEqual),t}hasUrlPreviewMetadata(){return l.getUrlPreviewMetadata(this.properties).length>0}isForwarded(){return l.getForwardMetadata(this.properties).isForwarded}isBookmark(){return d.isBookmarkConversation(this.conversationId)}getBookmarkMetadata(){return l.getBookmarkMetadata(this.properties)}isBookmarkSourceForCurrentUser(){return!!this.getBookmarkSourceMetadataForCurrentUser()}getBookmarkSourceMetadataForCurrentUser(){return l.getBookmarkMetadataForUser(this.properties,g.default.getSkypeMri())}isBookmarkSourceDeletedMessageForCurrentUser(){if(!this._serverMessages)return!1;if(!this.getLatestServerMessage())return!1;const e=this._serverMessages[this._serverMessages.length-2];return!!e&&(this.isDeletedMessage()&&!!l.getBookmarkMetadataForUser(e.properties,g.default.getSkypeMri()))}getBookmarkSourceMetadataForCurrentUserFromPreviousMessage(){if(!this._serverMessages)return;const e=this._serverMessages[this._serverMessages.length-2];return e?l.getBookmarkMetadataForUser(e.properties,g.default.getSkypeMri()):void 0}getUrlPreviewMetadata(e){if(!e)return;const t=l.getUrlPreviewMetadata(this.properties);if(0===t.length)return;const s=e.trim(),o=i.find(t,(e=>e.key.trim()===s));return o?o.value:void 0}getEmotionAnnotations(){return l.getEmotionMetadata(this.properties)}getCleanedEmotionAnnotations(){return l.getCleanedEmotionMetadata(this.properties)}getPollData(){return l.getPollMetadata(this.properties)}getScheduledCallsResponses(){return l.getScheduledCallMetadata(this.properties)}getSuggestedActions(){const e=this.properties?this.properties[l.MessageProperties.SuggestedActions]:void 0;return e?{creator:this.creator,to:e.to,actions:i.map(e.actions,(e=>({botId:this.creator,title:e.title,value:e.value,type:e.type,image:e.image,pageTitle:e.displayText,attributes:e.channelData?e.channelData.telemetryData:void 0})))}:void 0}isEmote(){const e=this.getOriginalServerMessage();return e?Number(e.skypeemoteoffset)>0:(this.skypeemoteoffset||0)>0}isEdited(){return!(!this.properties||!this.properties[l.MessageProperties.EditTime]&&!this.properties[l.MessageProperties.DeleteTime])||(!i.isEmpty(this._unacknowledgedLies)&&!!i.last(this._unacknowledgedLies).skypeeditedid||!i.isEmpty(this._acknowledgedLies)&&!!i.last(this._acknowledgedLies).skypeeditedid||i.some(this._serverMessages,(e=>!!e.skypeeditedid)))}isDeletedMessage(){return!(!this.properties||!this.properties[l.MessageProperties.DeleteTime])||l.isDeletedMessage(this)}isAllowedEngagementBotMessage(){const e=n.default.getEngagementFeatures().conciergeBotSettings;return e.enableVisibility&&d.isConciergeBotMri(this.creator)&&-1!==e.allowedRecentMessageTypes.indexOf(this.messagetype)}isTranslationSettings(){return!!this.isOldTranslationSettings()||i.includes([l.MessageTypes.TranslationSettings],this.messagetype)&&!!l.getTranslationSettingsMetadata(this.content)}isHiddenTranslationSettingsMessage(){if(!this.isTranslationSettings())return!1;const e=l.getTranslationSettingsMetadata(this.content),t=l.getTranslationSettingsState(this.content);if(e&&void 0!==t){if(e.isUpdate||this._isHiddenOldTranslationSettings())return!0;if(!i.includes([r.TranslationState.Disabled,r.TranslationState.Enabled],t))return g.default.isMyMri(this.creator)}return!1}isTranslation(){return this.messagetype===l.MessageTypes.Translation}isOldTranslationSettings(){if(!n.default.getS4LCMCFeaturesNoSubscription().enableOldMessageTranslation)return!1;if(this.messagetype!==l.MessageTypes.Data)return!1;return!!l.getTranslationSettingsMetadata(this.content)}_isHiddenOldTranslationSettings(){if(!n.default.getS4LCMCFeaturesNoSubscription().enableOldMessageTranslation)return!1;if(this.messagetype!==l.MessageTypes.Data)return!1;const e=l.getTranslationSettingsMetadata(this.content);return e&&e.isOldVersion}isHiddenInPreviewTranslation(){return this.isTranslation()&&(!n.default.getS4LCMCFeaturesNoSubscription().enableMessageTranslation||g.default.isMyMri(this.creator))}getMessageContentFromServerMessages(){const e=i.find(this._serverMessages,(e=>""!==e.content));return e?e.content:void 0}isDeletedHighlightServerMessage(){return this.isDeletedMessage()&&i.some(this._serverMessages,(e=>l.isHighlightMessageType(e)))}isMutated(){const e=this._getServerMessageForProperties();return e&&e.version>e.id||!i.isEmpty(this._unacknowledgedPropSets)}hasUnseenReactions(){const e=this.getLastReactionTimeExcludingCurrentUser();if(i.isUndefined(e))return!1;return this.getReactionsReadTimeForCurrentUser()<e}isAlbum(){return this.hasAlbumId()&&this.messagetype===l.MessageTypes.MediaAlbum}isAlbumItem(){return this.hasAlbumId()&&this.messagetype!==l.MessageTypes.MediaAlbum}hasAlbumId(){return this.properties&&this.properties[l.MessageProperties.AlbumId]}getAlbumId(){return this.properties&&this.properties[l.MessageProperties.AlbumId]}getAlbumIdFromPreviousMessage(){if(!this._serverMessages)return;const e=this._serverMessages[this._serverMessages.length-2];return e&&e.properties?e.properties[l.MessageProperties.AlbumId]:void 0}isUnreconciledEdit(){return!i.isEmpty(this._serverMessages)&&!this.getOriginalServerMessage()}isMessageLie(){return!i.isEmpty(this._unacknowledgedLies)}isPropertyLie(){return!i.isEmpty(this._unacknowledgedPropSets)}isCurrentVersionKnownByServer(){return this.isAnyVersionKnownByServer()&&!this.isMessageLie()&&!this.isPropertyLie()}isAnyVersionKnownByServer(){return!!this._serverMessages&&this._serverMessages.length>0||!!this._acknowledgedLies&&this._acknowledgedLies.length>0}isUnsent(){return!this._isEphemeral&&!this.isAnyVersionKnownByServer()}isEphemeral(){return!!this._isEphemeral}isSendRejected(){return!!this._sendRejectedCMID}getSendRejectedCMID(){return this._sendRejectedCMID}getSendRetryInfo(){return this._sendRetryInfo}isBotHighlightMessage(){return d.isBotHighlightsThread(this.conversationId)&&-1!==this.content.indexOf(d.BotHighlightMessageContent)}isHighlightMessage(){return d.isHighlightsThread(this.conversationId)&&(l.isHighlightMessageType(this)||this.isBotHighlightMessage())}isHighlightFollow(){return!!d.isHighlightsThread(this.conversationId)&&(this.messagetype===l.MessageTypes.AddMember||this.messagetype===l.MessageTypes.DeleteMember||this.messagetype===l.MessageTypes.HighlightsFollow||this.messagetype===l.MessageTypes.HighlightsRemoveFollow||this.messagetype===l.MessageTypes.HighlightsRefuseFollow)}isHighlightFollowRequest(){return!!d.isHighlightsThread(this.conversationId)&&this.messagetype===l.MessageTypes.HighlightsFollow}isHighlightFollowRemove(){return!!d.isHighlightsThread(this.conversationId)&&this.messagetype===l.MessageTypes.HighlightsRemoveFollow}isHighlightFollowAcceptedByOther(){return!!d.isHighlightsThread(this.conversationId)&&(!d.isMyHighlightThread(this.conversationId)&&this.messagetype===l.MessageTypes.AddMember)}isHighlightFollowAcceptedByMe(){return!!d.isHighlightsThread(this.conversationId)&&(d.isMyHighlightThread(this.conversationId)&&this.messagetype===l.MessageTypes.AddMember)}isMessageInEncryptedThread(){return d.isEncryptedThread(this.conversationId)}isMessageInS4BBridgeConversation(){return d.isS4BBridgeMri(this.conversationId)}isE2eeHandshakeTypeAllowedForNotification(){return d.isEncryptedThread(this.conversationId)&&(this.messagetype===l.MessageTypes.HandshakeInvite||this.messagetype===l.MessageTypes.HandshakeAccept||this.messagetype===l.MessageTypes.HandshakeComplete)&&!this._isCurrentUserInitiator()}getLatestRelevantClientMessageId(){const e=i.findLast(this._serverMessages,(e=>this._isContentEdited(e)))||this.getOriginalServerMessage();return e?e.skypeeditedid||e.clientmessageid:void 0}_isContentEdited(e){return!!e.skypeeditedid||!(!e.properties||!e.properties[l.MessageProperties.EditTime]&&!e.properties[l.MessageProperties.DeleteTime])}getLatestServerMessageVersion(){const e=this.getLatestServerMessage();return e&&(e.version||e.id)}getLatestServerMessage(){return i.last(this._serverMessages)}getLatestServerMessageId(){const e=i.findLast(this._serverMessages,(e=>this._isContentEdited(e)));return e&&e.id||this.getOriginalServerId()}getLastReactionTimeExcludingCurrentUser(){const e=this.getCleanedEmotionAnnotations();if(i.isEmpty(e))return;const t=(0,a.chain)(e,(0,a.map)((e=>e.users)),(0,a.flatten)(),(0,a.filter)((e=>!g.default.isMyMri(e.mri))));if(i.isEmpty(t))return;return i.maxBy(t,(e=>e.time)).time}getOriginalClientMessageId(){const e=this.getOriginalServerMessage()||i.head(this._acknowledgedLies)||i.head(this._unacknowledgedLies);return e&&(e.skypeeditedid||e.clientmessageid)}getOriginalServerMessage(){return i.find(this._serverMessages,(e=>!!this._isOriginalConfirmedServerMessage(e)))}_isOriginalConfirmedServerMessage(e){const t=e&&this.messagetype===l.MessageTypes.Call&&e.skypeguid===this.skypeguid;return e&&(d.getCuidForMessage(e)===this.cuid||t)&&!e.skypeeditedid}getOriginalServerId(){const e=this.getOriginalServerMessage()||i.head(this._acknowledgedLies);return e&&e.id}_getServerMessageForProperties(){const e=this.getOriginalServerId();if(e)return i.findLast(this._serverMessages,(t=>t.id===e))}getServerIdForPropertyChanges(){return this.getOriginalServerId()}getCHID(){if(!this.skypeguid)return this.cuid;const e=this.getLatestServerMessage();return e?e.skypeeditedid||e.clientmessageid||e.id:this.getOriginalServerId()}getConsumptionHorizonString(){const e=this.getOriginalServerId();if(!e)return void u.warn(h.LogTraceArea.MessageStream,"getConsumptionHorizonString called on an unreconciled edit");const t=this.getCHID();return i.isUndefined(t)?void 0:d.getConsumptionHorizonForMessageAndCHID(e,t)}getUnacknowledgedClientMessageIds(){return i.map(this._unacknowledgedLies,(e=>e.clientmessageid))}test_getServerMessages(){return this._serverMessages||[]}push_getThreadTopic(){const e=i.maxBy(this._serverMessages,(e=>e.version));return e?e.threadtopic:void 0}push_getSenderDisplayName(){const e=i.maxBy(this._serverMessages,(e=>e.version));return e?e.imdisplayname:void 0}static test_fromFirstServerMessage(e){return T.fromFirstServerMessage(e)}_isTargetingMe(){return null!==this.content.match(`<target>${i.escapeRegExp(g.default.getSkypeMri())}</target>`)}getCountsType(){return this._countsType}countsForUnreadCounts(){if(this.isEphemeral())return!1;if(g.default.isMyMri(this.creator))return!1;if(!this.isShownInStream())return!1;if(this.isUnreconciledEdit())return!1;if((this.messagetype===l.MessageTypes.HandshakeInvite||this.messagetype===l.MessageTypes.HandshakeAccept||this.messagetype===l.MessageTypes.HandshakeReject||this.messagetype===l.MessageTypes.HandshakeComplete)&&this._isTargetingMe())return!0;if(l.isThreadActivityType(this.messagetype))return!1;if(d.isHighlightsThread(this.conversationId)&&!this.isHighlightMessage())return!1;if(l.getMessageTypeGroup(this)===l.MessageTypeGroups.Calling){if(!i.startsWith(this.content,"<partlist"))return!1;if(d.isGroupConversation(this.conversationId)){const e=g.default.getSkypeId();let t;for(;t=v.exec(this.content);)if(t[1]===e)return v.lastIndex=0,!1}else if(-1===this.content.indexOf('type="missed"'))return!1}return!this.hasAlbumId()||this.isAlbum()}countsForReadReceipts(){if(this.isEphemeral())return!1;if(!this.isShownInStream())return!1;if(this.isUnreconciledEdit())return!1;if(l.isThreadActivityType(this.messagetype))return!1;return l.getMessageTypeGroup(this)!==l.MessageTypeGroups.Calling}_countsForHighPriorityUnreadCounts(){const e=this.getMessageNotificationClass();return e===S.MessageNotificationClass.OneOnOne||e===S.MessageNotificationClass.MentionedOrQuoted}getMessageNotificationClass(){let e=S.MessageNotificationClass.Normal;if(n.default.getS4LCMCFeaturesNoSubscription().enableMessageTranslation&&this.isTranslationSettings()&&!this.isHiddenTranslationSettingsMessage())return e;return l.getMessageTypeGroup(this)===l.MessageTypeGroups.System?S.MessageNotificationClass.SystemInformational:(g.default.isMyMri(this.creator)||(this.isCurrentUserMentionedOrQuoted()?e=S.MessageNotificationClass.MentionedOrQuoted:d.isUserMri(this.conversationId)&&(e=S.MessageNotificationClass.OneOnOne)),e)}isShownInStream(){if(this.isDeletedMessage())return!1;if(this.isUnreconciledEdit())return!1;if(this.messagetype===l.MessageTypes.HighlightsFollow||this.messagetype===l.MessageTypes.HighlightsRefuseFollow||this.messagetype===l.MessageTypes.HighlightsRemoveFollow)return!1;const e=l.getMessageTypeGroup(this);return!(e!==l.MessageTypeGroups.Calling||!l.isCallInfoForCallMessageType(this)&&!l.isEventCallStartedMessageType(this))||e!==l.MessageTypeGroups.Engagement&&(e!==l.MessageTypeGroups.Translation&&(this.isTranslationSettings()?!!n.default.getS4LCMCFeaturesNoSubscription().enableMessageTranslation&&!this.isHiddenTranslationSettingsMessage():!this.isCanceledScheduledCall()&&e!==l.MessageTypeGroups.None))}isShownInPreview(){return(this.isShownInStream()||this.isTranslation())&&!this.isReported()&&!this.isHiddenInPreviewTranslation()}isCanceledScheduledCall(){if(!l.isScheduledCallType(this.messagetype))return!1;const e=this.content.match(/canceledTimeMs=/i);return!i.isEmpty(e)}isCurrentUserMentionedOrQuoted(e=!0){return i.some(g.default.getMyMris(),(t=>this._isUserAtMentioned(t,e)||T._testUserIsQuoted(this.content,t)))}isCurrentUserMentioned(e=!0){return i.some(g.default.getMyMris(),(t=>this._isUserAtMentioned(t,e)))}isCurrentUserQuoted(){return i.some(g.default.getMyMris(),(e=>T._testUserIsQuoted(this.content,e)))}_isCurrentUserInitiator(){return i.some(g.default.getMyMris(),(e=>T._testUserIsInitiator(this.content,e)))}_isUserAtMentioned(e,t){const s=t?"?:\\*|":"";return this.messagetype===l.MessageTypes.TeamsHtml?!!i.find(l.getTeamsMentionProperties(this.properties),(t=>t.mri===e)):!!this.content&&null!==this.content.match(`<at id="(${s}${i.escapeRegExp(e)})">.*?</at>`)}static _testUserIsInitiator(e,t){return!!e&&null!==e.match(`.+initiator>${i.escapeRegExp(t)}</.+`)}static _testUserIsQuoted(e,t){let s,i=d.getSkypeIdFromMri(t);if(!i||!e)return!1;let o=!1;for(;(s=C.exec(e))&&!o;){const e=s[1];let t;for(;(t=b.exec(e))&&!o;)o=3===t.length&&"author"===t[1]&&t[2]===i}return b.lastIndex=0,C.lastIndex=0,o}isReactionRead(){const e=this.getLastReactionTimeExcludingCurrentUser();if(i.isUndefined(e))return!0;const t=this.getReactionsReadTimeForCurrentUser()||0;return!!e&&e<=t}getReactionsReadTimeForCurrentUser(){const e=this._getCurrentUserReactionConsumptionHorizonFromProperties(this.properties);return i.isUndefined(e)?0:e}getScheduledCallReadTimeForCurrentUser(){const e=this._getCurrentUserScheduledCallConsumptionHorizonFromProperties(this.properties);return i.isUndefined(e)?0:e}getFileEncryptionKeys(){return this._fileEncryptionKeys}isKnownServerMessageVersion(e){return i.some(this._serverMessages,(t=>t.version===e))}isMergingBotHighlightMessageLocal(e){return d.isAgent(e)&&-1!==this.content.indexOf(d.BotHighlightMessageContent)}getAcknowledgedLies(){return this._acknowledgedLies}isReported(){return!!this.reported}isEmoticonCallReaction(){return void 0!==this.getEmoticonCallReactionKey()}getEmoticonCallReactionKey(){const e=/^<ss type=\"(.*)\">\(([^\(]*)\)<\/ss><c_i/g.exec(this.content),t=/^\((flag_.*)\)<c_i/g.exec(this.content);return e&&e.length>2?e[2]:t?t[1]:void 0}}t.default=T},25759:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChatServicePresenceRequestFactory=void 0;const i=s(96486),o=s(62783),n=s(71830),r=s(95271);class a extends r.PresenceRequestFactory{getPriority(){return r.PresencePriority.ChatService}getMyPresenceStatus(e){return{request:r.PresenceRequestFactory._createRequest("GET","v1/users/ME/presenceDocs/messagingService",e,"getMyPresenceStatus"),responseConverter:e=>e&&n.parseStatus(e.status)}}setMyPresenceStatus(e,t){const s={status:n.encodeStatus(t)};return{request:r.PresenceRequestFactory._createRequest("PUT","v1/users/ME/presenceDocs/messagingService",e,"setMyPresenceStatus",s),responseConverter:()=>t}}getCurrentPresenceForMris(e){const t="v1/users/ME/contacts/ALL/presenceDocs/messagingService?"+i.map(e,(e=>"cMri="+e)).join("&");return{request:r.PresenceRequestFactory._createRequest("GET",t,void 0,"getCurrentPresenceForMris"),responseConverter:e=>{const t={};return i.each(e&&e.Responses||[],(e=>{t[e.Contact]=e.Payload})),t}}}setActiveEndpointTimeout(e,t){const s=`v1/users/ME/endpoints/${e}/active`;return r.PresenceRequestFactory._createRequest("POST",s,e,"setActiveEndpointTimeout",{timeout:t},{timeout:6e4,priority:o.WebRequestPriority.Critical,requirePresenceDocPublished:!0})}}t.ChatServicePresenceRequestFactory=a},65369:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deleteConnectors=t.e2eeReject=t.e2eeConfirm=t.e2eeAccept=t.e2eeInvite=t.getMemberConsumptionHorizons=t.deleteConversation=t.deleteMessage=t.editMessage=t.setMessageProperty=t.postMessageToConversation=t.getConversationMessage=t.getMyConversations=t.pollSubscription=t.updateSubscriptionProperty=t.deleteSubscription=t.createSubscription=t.getEndpointPresenceDoc=t.publishEndpointPresence=t.clearEndpoint=t.deleteEndpoint=t.updateEndpoint=t.createEndpoint=t.enumerateEndpoints=t.getWebhookUrl=t.invokeAgentRequest=t.addNewContact=t.setThreadProperty=t.getThread=t.removeMemberFromThread=t.addMembersToThread=t.addMemberToThread=t.createThread=t.setMyUserRing=t.setMyProperty=t.getMyProperties=t.calcMessageViewParam=t.calcMessagesViewParam=t.calcThreadViewParam=t.calcConvViewParam=t.CSRequestScenarios=void 0;const i=s(96486),o=s(62783),n=s(89391),r=s(51077),a=s(90239),l=s(71830),d=s(78262),c=s(26712);function h(){return i.compact(["supportsExtendedHistory","msnp24Equivalent"]).join("|")}function u(){return"msnp24Equivalent"}function p(){return i.compact(["msnp24Equivalent","supportsMessageProperties"]).join("|")}function g(e,t){return{method:"PUT",path:"v1/users/ME/properties?name="+encodeURIComponent(e),passedData:{[e]:t},scenario:"setMyProperty"}}t.CSRequestScenarios={createEndpoint:"createEndpoint",updateEndpoint:"updateEndpoint",updateSubscription:"updateSubscription",deleteSubscription:"deleteSubscription",postMessageToConversation:"postMessageToConversation",userComposingState:"userComposingState"},t.calcConvViewParam=h,t.calcThreadViewParam=u,t.calcMessagesViewParam=function(){return i.compact(["supportsExtendedHistory","msnp24Equivalent","supportsMessageProperties"]).join("|")},t.calcMessageViewParam=p,t.getMyProperties=function(){return{method:"GET",path:"v1/users/ME/properties",scenario:"getMyProperties"}},t.setMyProperty=g,t.setMyUserRing=function(e){return g(l.ServerUserProps.UserRing,e)},t.createThread=function(e,t,s={}){return t&&(s[l.ThreadProps.TopicName]=t),{method:"POST",path:"v1/threads",passedData:{members:i.map(e,((e,t)=>({id:t,role:e===d.ThreadMemberAccessType.Admin?a.ThreadMemberRoles.Admin:a.ThreadMemberRoles.User}))),properties:s},scenario:"createThread"}},t.addMemberToThread=function(e,t,s=!0){return{method:"PUT",path:"v1/threads/"+encodeURIComponent(e)+"/members/"+t,passedData:{role:s?a.ThreadMemberRoles.Admin:a.ThreadMemberRoles.User},scenario:"addMemberToThread",mriForTelemetry:e}},t.addMembersToThread=function(e,t){return{method:"POST",path:"v1/threads/"+encodeURIComponent(e)+"/members",passedData:{members:i.map(t,((e,t)=>({id:t,role:e===d.ThreadMemberAccessType.Admin?a.ThreadMemberRoles.Admin:a.ThreadMemberRoles.User})))},scenario:"addMembersToThread",mriForTelemetry:e}},t.removeMemberFromThread=function(e,t){return{method:"DELETE",path:"v1/threads/"+encodeURIComponent(e)+"/members/"+t,scenario:"removeMemberFromThread",mriForTelemetry:e}},t.getThread=function(e){return{method:"GET",path:"v1/threads/"+encodeURIComponent(e)+"?view="+encodeURIComponent("msnp24Equivalent"),scenario:"getThread",mriForTelemetry:e}},t.setThreadProperty=function(e,t,s){return{method:"PUT",path:"v1/threads/"+encodeURIComponent(e)+"/properties?name="+encodeURIComponent(t),passedData:{[t]:s},scenario:"setThreadProperty",mriForTelemetry:e}},t.addNewContact=function(e){const t="v1/users/ME/contacts/"+e;return{method:"PUT",path:t,passedData:t,scenario:"addNewContact",mriForTelemetry:e}},t.invokeAgentRequest=function(e,t,s,i){return{method:"POST",path:"v1/agents/"+encodeURIComponent(e)+"/invoke",passedData:{conversation:{id:t},value:s,name:i},scenario:"invokeAgentRequest",mriForTelemetry:e}},t.getWebhookUrl=function(e,t){return{method:"POST",path:"v1/threads/"+encodeURIComponent(e)+"/integrations",passedData:t,scenario:"getWebhookUrl"}},t.enumerateEndpoints=function(){return{path:"v1/users/ME/endpoints",method:"GET",timeout:6e4,priority:o.WebRequestPriority.Normal,scenario:"enumerateEndpoints",isV1OnlyRequest:!0}},t.createEndpoint=function(e){return{path:"v1/users/ME/endpoints",method:"POST",passedData:{endpointFeatures:e},timeout:6e4,priority:o.WebRequestPriority.Critical,scenario:t.CSRequestScenarios.createEndpoint,isLogin:!0,isV1OnlyRequest:!0}},t.updateEndpoint=function(e,s){return{path:"v1/users/ME/endpoints/"+e,method:"PUT",passedData:{endpointFeatures:s},timeout:6e4,priority:o.WebRequestPriority.Critical,endpointId:e,scenario:t.CSRequestScenarios.updateEndpoint,isLogin:!0,isV1OnlyRequest:!0}},t.deleteEndpoint=function(e){return{path:"v1/users/ME/endpoints/"+e,method:"DELETE",timeout:6e4,priority:o.WebRequestPriority.Critical,endpointId:e,scenario:"deleteEndpoint",requiresEndpoint:!0,isV1OnlyRequest:!0}},t.clearEndpoint=function(e){return{method:"PUT",path:"v1/users/ME/endpoints/"+e,passedData:{},endpointId:e,scenario:"clearEndpoint",requiresEndpoint:!0,isV1OnlyRequest:!0}},t.publishEndpointPresence=function(e,t){return{method:"PUT",path:"v1/users/ME/endpoints/"+e+"/presenceDocs/messagingService",passedData:t,endpointId:e,timeout:6e4,scenario:"publishEndpointPresence",requiresEndpoint:!0,isV1OnlyRequest:!0}},t.getEndpointPresenceDoc=function(e){return{method:"GET",path:"v1/users/ME/endpoints/"+e+"/presenceDocs/messagingService",endpointId:e,timeout:6e4,scenario:"getEndpointPresenceDoc",requiresEndpoint:!0,isV1OnlyRequest:!0}},t.createSubscription=function(e,t){return{method:"POST",path:"v1/users/ME/endpoints/"+e+"/subscriptions",passedData:t,endpointId:e,scenario:"createSubscription",requiresEndpoint:!0,isV1OnlyRequest:!0}},t.deleteSubscription=function(e,s){return{method:"DELETE",path:"v1/users/ME/endpoints/"+e+"/subscriptions/"+encodeURIComponent(s),endpointId:e,scenario:t.CSRequestScenarios.deleteSubscription,requiresEndpoint:!0,isV1OnlyRequest:!0}},t.updateSubscriptionProperty=function(e,t,s,i){return{method:"PUT",path:"v1/users/ME/endpoints/"+e+"/subscriptions/"+encodeURIComponent(t)+"?name="+encodeURIComponent(s),passedData:{[s]:i},endpointId:e,scenario:"updateSubscriptionProperty",requiresEndpoint:!0,isV1OnlyRequest:!0}},t.pollSubscription=function(e,t,s){let i="v1/users/ME/endpoints/"+encodeURIComponent(e)+"/subscriptions/"+encodeURIComponent(t)+"/poll";return void 0!==s&&(i+="?ackId="+s),{method:"POST",path:i,endpointId:e,timeout:9e4,priority:o.WebRequestPriority.Critical,scenario:"pollSubscription",requiresEndpoint:!0,isV1OnlyRequest:!0}},t.getMyConversations=function(e="All",t=1,s,i=100){let o="v1/users/ME/conversations?view="+encodeURIComponent(h());return o+="&pageSize="+Math.min(i,100),s?o+="&syncState="+encodeURIComponent(s):(o+="&startTime="+t,null!=e&&(o+="&targetType="+encodeURIComponent(e))),{method:"GET",path:o,scenario:"getMyConversations"}},t.getConversationMessage=function(e,t){return{method:"GET",path:"v1/users/ME/conversations/"+encodeURIComponent(e)+"/messages/"+encodeURIComponent(t)+"?view="+encodeURIComponent(p()),scenario:"getConversationMessage",mriForTelemetry:e}},t.postMessageToConversation=function(e,s,i=t.CSRequestScenarios.postMessageToConversation){let r="v1/users/ME/conversations/"+encodeURIComponent(e)+"/messages";return r=c.default.addUrlParameter(r,"x-ecs-etag",encodeURIComponent(n.default.getCachedEcsConfigEtag()),!0),{method:"POST",path:r,passedData:s,priority:o.WebRequestPriority.High,scenario:i,mriForTelemetry:e}},t.setMessageProperty=function(e,t,s,i,o=!1){let a="v1/users/ME/conversations/"+encodeURIComponent(e)+"/messages/"+encodeURIComponent(t)+"/properties?name="+encodeURIComponent(s);return o||s!==r.MessageProperties.Emotions||(a=c.default.addUrlParameter(a,"x-ecs-etag",encodeURIComponent(n.default.getCachedEcsConfigEtag()),!0)),{method:o?"DELETE":"PUT",path:a,passedData:{[s]:i},scenario:"setMessageProperty",mriForTelemetry:e}},t.editMessage=function(e,t,s,i){return{method:"PUT",path:"v1/users/ME/conversations/"+encodeURIComponent(e)+"/messages/"+encodeURIComponent(t),passedData:{messagetype:s,content:i},scenario:"editMessage",mriForTelemetry:e}},t.deleteMessage=function(e,t){return{method:"DELETE",path:"v1/users/ME/conversations/"+encodeURIComponent(e)+"/messages/"+encodeURIComponent(t),scenario:"deleteMessage",mriForTelemetry:e}},t.deleteConversation=function(e){return{method:"DELETE",path:"v1/users/ME/conversations/"+encodeURIComponent(e)+"/messages",scenario:"deleteConversation",mriForTelemetry:e}},t.getMemberConsumptionHorizons=function(e){return{method:"GET",path:"v1/threads/"+encodeURIComponent(e)+"/consumptionhorizons",scenario:"consumptionhorizons"}},t.e2eeInvite=function(e,t,s,i){return{method:"POST",path:"v1/e2ee/v1/invite",passedData:{DeviceId:e,KeyBundle:JSON.stringify(t),InviteeId:s,ThreadId:i},scenario:"e2eeInvite"}},t.e2eeAccept=function(e,t,s){return{method:"PUT",path:"v1/e2ee/v1/invite/"+t,passedData:{DeviceId:e,KeyBundle:JSON.stringify(s)},scenario:"e2eeAccept"}},t.e2eeConfirm=function(e){return{method:"PUT",path:"v1/e2ee/v1/invite/"+e,passedData:{},scenario:"e2eeConfirm"}},t.e2eeReject=function(e){return{method:"DELETE",path:"v1/e2ee/v1/invite/"+e,scenario:"e2eeReject"}},t.deleteConnectors=function(e,t){return{method:"DELETE",path:"v1/threads/"+e+"/integrations/"+t,scenario:"deleteConnectors"}}},13960:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getDeviceName=t.getDeviceType=t.toAvailabilityString=t.fromUpsAvailabilityAndActivityEnum=t.fromUpsAvailabilityAndActivityString=t.toUpsUserAvailability=void 0;const i=s(96486),o=s(90239),n=s(46096),r=s(36237),a=s(28575),l=s(53374);function d(e,t){switch(e){case a.Availability.PresenceUnknown:return o.UserStatus.Unknown;case a.Availability.Available:return o.UserStatus.Online;case a.Availability.AvailableIdle:return o.UserStatus.Idle;case a.Availability.Busy:case a.Availability.BusyIdle:case a.Availability.DoNotDisturb:return o.UserStatus.Busy;case a.Availability.BeRightBack:return o.UserStatus.BeRightBack;case a.Availability.Away:return o.UserStatus.Away;case a.Availability.Offline:return t===a.Activity.OffWork?o.UserStatus.Hidden:o.UserStatus.Offline;default:return r.warn(n.LogTraceArea.Presence,`UPS user availability not supported: ${e}`),o.UserStatus.Unknown}}t.toUpsUserAvailability=function(e){switch(e){case o.UserStatus.Offline:return"Offline";case o.UserStatus.Online:return"Available";case o.UserStatus.Busy:return"Busy";case o.UserStatus.Away:return"Away";case o.UserStatus.Idle:return"AvailableIdle";case o.UserStatus.OnThePhone:return"Busy";case o.UserStatus.OutToLunch:return"Away";case o.UserStatus.BeRightBack:return"BeRightBack";case o.UserStatus.Hidden:return"Offline";case o.UserStatus.Unknown:return"PresenceUnknown";default:return l.default.switchStatementExhaustiveChecking(e)}},t.fromUpsAvailabilityAndActivityString=function(e,t){return d(e&&a.Availability[e],t&&a.Activity[t])},t.fromUpsAvailabilityAndActivityEnum=d,t.toAvailabilityString=function(e){switch(i.isString(e)&&void 0!==e?a.Availability[e]:e){case a.Availability.Offline:case a.Availability.PresenceUnknown:case void 0:return"Offline";default:return"Online"}},t.getDeviceType=function(){return a.DeviceType.Web},t.getDeviceName=function(){return"desktop"}},95271:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PresenceRequestFactory=t.PresencePriority=void 0,function(e){e[e.ChatService=1]="ChatService",e[e.UPS=2]="UPS"}(t.PresencePriority||(t.PresencePriority={}));t.PresenceRequestFactory=class{getServiceType(){return this.getPriority()}static _createRequest(e,t,s,i,o,n={}){return Object.assign({method:e,path:t,passedData:o,endpointId:s,scenario:i,requiresEndpoint:Boolean(s),isV1OnlyRequest:!0},n)}}},62615:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpsPresenceRequestFactory=void 0;const i=s(81169),o=s(90239),n=s(71830),r=s(13960),a=s(95271);function l(e){return n.formatEndpointIdRemoveBrackets(e)}class d extends a.PresenceRequestFactory{getPriority(){return a.PresencePriority.UPS}getMyPresenceStatus(e){return{request:a.PresenceRequestFactory._createRequest("GET","v1/me/presence",l(e),"getMyPresenceStatus"),responseConverter:e=>r.fromUpsAvailabilityAndActivityString(e&&e.availability,e&&e.activity)}}setMyPresenceStatus(e,t){const s=this._buildSetMyPresenceStatusPayload(t);return{request:a.PresenceRequestFactory._createRequest("PUT","v1/me/forceavailability",l(e),"setMyPresenceStatus",s),responseConverter:()=>t}}_buildSetMyPresenceStatusPayload(e){return e===o.UserStatus.Hidden?{availability:r.toUpsUserAvailability(e),activity:"OffWork"}:{availability:r.toUpsUserAvailability(e)}}getCurrentPresenceForMris(e){const t=e.map((e=>({mri:e})));return{request:a.PresenceRequestFactory._createRequest("POST","v1/presence/getpresence",void 0,"getCurrentPresenceForMris",t),responseConverter:e=>(0,i.chain)(e,(0,i.filter)((e=>Boolean(e.mri))),(0,i.map)((e=>{var t,s,i,o;return{mri:e.mri,availability:r.toAvailabilityString(null===(t=e.presence)||void 0===t?void 0:t.availability),selfLink:"",lastSeenAt:(null===(s=e.presence)||void 0===s?void 0:s.lastActiveTime)||"",status:n.encodeStatus(r.fromUpsAvailabilityAndActivityString(null===(i=e.presence)||void 0===i?void 0:i.availability,null===(o=e.presence)||void 0===o?void 0:o.activity))||"Unknown"}})),(0,i.keyBy)((e=>e.mri)))}}setActiveEndpointTimeout(e,t){const s={endpointId:l(e),isActive:t};return a.PresenceRequestFactory._createRequest("POST","v1/me/reportmyactivity",l(e),"setActiveEndpointTimeout",s)}static updateEndpoint(e){const t={id:l(e),deviceType:r.getDeviceType()};return a.PresenceRequestFactory._createRequest("PUT","v1/me/endpoints",l(e),"updateEndpoint",t)}static deleteEndpoint(e){const t=`v1/me/endpoints/${l(e)}`;return a.PresenceRequestFactory._createRequest("DELETE",t,l(e),"deleteEndpoint")}static createSubscription(e,t,s){const i=`v1/pubsub/subscriptions/${l(e)}`,o={trouterUri:s,shouldPurgePreviousSubscriptions:!0,subscriptionsToAdd:t.map((e=>({mri:e}))),subscriptionsToRemove:[]};return a.PresenceRequestFactory._createRequest("POST",i,l(e),"createSubscription",o)}}t.UpsPresenceRequestFactory=d},47477:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getTranslationActionString=t.getLegacyMemberUpgradedNodeLocalizeInfo=t.getLegacyMemberAddedNodeLocalizeInfo=t.getJoiningEnabledUpdateNodeLocalizeInfo=t.getHistoryDisclosedUpdateLocalizeInfo=t.getPictureUpdateNodeLocalizeInfo=t.getHandshakeAcceptNodeLocalizedInfo=t.getHandshakeInviteNodeLocalizedInfo=t.getTopicUpdateNodeLocalizeInfo=t.getRoleUpdateNodeLocalizeInfo=t.renderBotDisclosureParts=t.getAddMemberLocalizeInfo=t.getDeleteMemberNodeLocalizeInfo=t.getThreadActivityMemberParts=t.getContactInfo=t.trimToFirstLineIfNeeded=t.TransformerBase=void 0;const i=s(96486),o=s(98925),n=s(51077),r=s(33754);t.TransformerBase=class{_renderPlainText(e,t){const s=e.split(/\r\n|\n|\r|\f|\x0b|\x85|\u2028|\u2029/);return this._renderLineBreakBetweenLines(s,t)}_renderSingleLine(e,t){return{value:e,stopProcessing:!1,renderAsInline:!0}}_renderLineBreak(e){return{value:"\r",stopProcessing:!1,renderAsInline:!0}}_renderLineBreakBetweenLines(e,t){if(!i.isArray(e))return{value:e,stopProcessing:!1,renderAsInline:!0};const s=e;let o=!1;const n=[];i.each(s,((e,i)=>{if(e||1===s.length){const s=this._renderSingleLine(e,t);if(s.stopProcessing)return o=!0,!1;n.push(s.value)}if(i<s.length-1){const e=this._renderLineBreak(t);if(e.stopProcessing)return o=!0,!1;n.push(e.value)}return!0}));return{value:1===n.length?n[0]:n,stopProcessing:o,renderAsInline:!0}}_renderLineBreakBetweenElements(e,t){if(!i.isArray(e))return e;const s=e;let o=!1;const n=[];i.each(s,((e,i)=>{if(e.value||1===s.length){if(e.stopProcessing)return o=!0,!1;n.push(e.value)}if(i<s.length-1){const e=this._renderLineBreak(t);if(e.stopProcessing)return o=!0,!1;n.push(e.value)}return!0}));return{value:1===n.length?n[0]:n,stopProcessing:o,renderAsInline:!0}}},t.trimToFirstLineIfNeeded=function(e,t){let s=e,i=!1;return t&&(s=e.split(/[\r\n]/)[0],i=s.length<e.length),{value:s,stopProcessing:i,renderAsInline:!0}},t.getContactInfo=function(e){let t;return e.fullName&&e.skypeId?t=r.getString("ContentToDisplayTransformerBase.ContactInfo",{fullName:e.fullName,skypeId:e.skypeId}):e.fullName?t=e.fullName:e.skypeId&&(t=r.getString("ContentToDisplayTransformerBase.ContactInfoOnlySkypeId",{skypeId:e.skypeId})),t},t.getThreadActivityMemberParts=function(e,t){const s=e.getRawText(),o=i.reject(t,(e=>e.getRawText()===s)),n=i.map(o,(e=>e.getRawText()));return{authorMri:s,personMris:n}},t.getDeleteMemberNodeLocalizeInfo=function(e,t,s){return i.isUndefined(e)?{key:"ContentToDisplayTransformerBase.RemovedGuestFromConversationMessage",params:{person:t}}:s?{key:"ContentToDisplayTransformerBase.RemovedFromConversationMessage",params:{initiator:e,person:t}}:{key:"ContentToDisplayTransformerBase.RemovedSelfFromConversationMessage",params:{initiator:e}}},t.getAddMemberLocalizeInfo=function(e,t,s){return s?{key:"ContentToDisplayTransformerBase.AddedToConversationMessage",params:{initiator:e,person:t}}:{key:"ContentToDisplayTransformerBase.JoinConversationMessage",params:{initiator:e}}},t.renderBotDisclosureParts=function(e,t){let s=[];return i.each(e,(e=>{s.push.apply(s,r.getParts("ContentToDisplayTransformerBase.BotReceivesAllContentText",{botName:e})),s.push("\n")})),i.each(t,(e=>{s.push.apply(s,r.getParts("ContentToDisplayTransformerBase.BotReceivesAtMentionMessagesText",{botName:e.botName,atMentionBotName:e.atMentionBotName})),s.push("\n")})),s},t.getRoleUpdateNodeLocalizeInfo=function(e,t,s){return i.isEmpty(t)?{key:"ContentToDisplayTransformerBase.RoleUpdateSelfMessage",params:{initiator:e,role:s}}:{key:"ContentToDisplayTransformerBase.RoleUpdateMessage",params:{initiator:e,person:t,role:s}}},t.getTopicUpdateNodeLocalizeInfo=function(e,t){return{key:"ContentToDisplayTransformerBase.TopicUpdateMessage",params:{initiator:e,topic:t}}},t.getHandshakeInviteNodeLocalizedInfo=function(e,t){return t?{key:"ContentToDisplayTransformerBase.E2eeInvitationSent",params:{BParty:e}}:{key:"ContentToDisplayTransformerBase.E2eeInvitationReceived",params:{AParty:e}}},t.getHandshakeAcceptNodeLocalizedInfo=function(e,t){return t?{key:"ContentToDisplayTransformerBase.E2eeInvitationAccepted",params:{AParty:e}}:{key:"ContentToDisplayTransformerBase.E2eeInvitationGotAccepted",params:{BParty:e}}},t.getPictureUpdateNodeLocalizeInfo=function(e){return{key:"ContentToDisplayTransformerBase.PictureUpdateMessage",params:{initiator:e}}},t.getHistoryDisclosedUpdateLocalizeInfo=function(e,t){return t?{key:"ContentToDisplayTransformerBase.HistoryDisclosedUpdateMessage",params:{initiator:e}}:{key:"ContentToDisplayTransformerBase.HistoryHiddenUpdateMessage",params:{initiator:e}}},t.getJoiningEnabledUpdateNodeLocalizeInfo=function(e,t){return t?{key:"ContentToDisplayTransformerBase.JoiningEnabledUpdateMessage",params:{initiator:e}}:{key:"ContentToDisplayTransformerBase.JoiningDisabledUpdateMessage",params:{initiator:e}}},t.getLegacyMemberAddedNodeLocalizeInfo=function(e,t){return{key:"ContentToDisplayTransformerBase.LegacyMemberAddedMessage",params:{initiator:e,link:t}}},t.getLegacyMemberUpgradedNodeLocalizeInfo=function(e){return{key:"ContentToDisplayTransformerBase.LegacyMemberUpgradeMessage",params:{initiator:e}}},t.getTranslationActionString=function(e){switch(n.getTranslationSettingsState(e)){case o.TranslationState.Enabled:return r.getString("ContentToDisplayTransformerBase.TranslationsEnabledMessage");case o.TranslationState.Pending:return r.getString("ContentToDisplayTransformerBase.TranslationsRequestedMessage");case o.TranslationState.Cancelled:return r.getString("ContentToDisplayTransformerBase.TranslationRequestCancelled");case o.TranslationState.Declined:return r.getString("ContentToDisplayTransformerBase.TranslationRequestDeclined");case o.TranslationState.Disabled:default:return r.getString("ContentToDisplayTransformerBase.TranslationsDisabledMessage")}}},97297:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.renderHtml=t.ContentToHtmlTransformer=void 0;const i=s(23719),o=s(96486),n=s(65976),r=s(98278),a=s(81959),l=s(16402),d=s(70891),c=s(46096),h=s(17213),u=s(36237),p=s(33754),g=s(4057),m=s(11010),S=s(78262),f=`font-family: ${m.default.fontFamily.uidDisplayRegular}; 'font-weight: ${r.FontWeight.regular}; color: #252423`;class y extends a.ContentToTextTransformer{transformRootNode(e){const t=super.transformRootNode(e);if(t.value){const e=`<div style="${f}">${t.value}</div>`;return o.assign({},t,{value:e})}return t}transformQuoteNode(e){if(this._options.trimToFirstLine&&this._options.onlyQuotedContent||this._options.processing.quotes===d.ProcessingLevel.None||this._options.processing.quotes===d.ProcessingLevel.Stripped)return super.transformQuoteNode(e);const t=this._default(e),s=1e3*e.timestamp;return{value:`[${l.default.getDisplayDateStringFull(s)}] ${e.getAuthorNameWithFallbackUnescaped()}:<blockquote style="background-color: rgba(37,36,35,0.05); border-left-color: #e1dfdd; border-left-style: solid; border-left-width: 4px; padding: 8px">${t.value}</blockquote>`,stopProcessing:t.stopProcessing}}transformHtmlNode(e){const t=this._transformHtmlDom(o.cloneDeep(e.getHtmlDom()),!1),s=i.DomUtils.getOuterHTML(t,{decodeEntities:!1,xmlMode:!0}),n=this._renderTextNodes(e.children,this._options.lineBreakString);return{value:s+n.value,stopProcessing:n.stopProcessing}}_transformHtmlDom(e,t){return o.map(e,(e=>{let s=e;return"tag"===e.type&&("img"===e.name&&e.attribs&&e.attribs.itemtype===h.SemanticObjectSchemas.amsImage?s=this._createAmsFallbackLink(e):(e.attribs&&"copy-paste-table"===e.attribs.class||t&&("td"===e.name||"th"===e.name))&&(s=this._annotateCopyPasteTable(e),t=!0)),s.children&&(s.children=this._transformHtmlDom(s.children,t)),s}))}_createAmsFallbackLink(e){const t=n.getDocumentId(e.attribs&&e.attribs.src||"");if(t){const s=n.getDocumentUrls(t,S.UploadFileType.Picture).fallback,o={type:"text",attribs:{},children:[],data:p.getString("InputEntity.SharedPhotoFallbackText")},r={type:"text",attribs:{},children:[],data:s},a={name:"a",type:"tag",attribs:{href:s},children:[]},l={name:"div",type:"tag",attribs:{},children:[]};return i.DomUtils.appendChild(a,r),i.DomUtils.appendChild(l,o),i.DomUtils.appendChild(l,a),i.DomUtils.replaceElement(e,l),l}return e}_annotateCopyPasteTable(e){const t=o.clone(e);return t.attribs?delete t.attribs.class:t.attribs={},t.attribs.style="td"===e.name||"th"===e.name?"padding: 4pt; border: solid 1px rgba(22,35,58,0.36)":"border: solid 1px rgba(22,35,58,0.36); background-color: #fff; color: #252423; border-collapse: collapse",e}}t.ContentToHtmlTransformer=y,t.renderHtml=function(e,t={}){try{const s=o.defaults(t,{utfFallback:t.utfFallback||!1,onlyQuotedContent:e&&e.hasOnlyQuotedContent&&e.hasOnlyQuotedContent(),processing:t.processing||{},lineBreakString:"<br/>"}),i=new y(s);return i.transform(e).value||""}catch(e){u.error(c.LogTraceArea.GenericUnsafe,"ContentToHtmlTransformer: Failed to transform tree: "+g.default.errorAsString(e))}return""}},33372:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toEntities=t.ContentToImBackTransformer=void 0;const i=s(96486),o=s(81169),n=s(81959),r=s(97174),a=s(53374);class l{constructor(){this.transformRootNode=this._default,this.transformUnknownNode=this._default,this.transformHighlightedNode=this._default,this.transformEditMessageMetaDataNode=this._default,this.transformAtMentionNode=this._default,this.transformUserMriNode=this._default,this.transformEmoticonNode=this._default,this.transformFlagNode=this._default,this.transformQuoteNode=this._toEmptyEntity,this.transformLegacyQuoteNode=this._toEmptyEntity,this.transformWikiMarkupNode=this._default,this.transformLinkNode=this._default,this.transformSuggestedTextHighlightNode=this._default,this.transformPollNode=this._default,this.transformCallerIDNode=this._default,this.transformTranslationNode=this._default,this.transformHtmlNode=this._default}_default(e){return(0,o.chain)(e.children,(0,o.map)((e=>e&&e.accept(this))),(0,o.compact)(),(0,o.flatten)())}_toUnhandledEntity(e,t){return i.isString(t)||(t=n.renderText(e)),[new r.UnhandledEntity(t)]}_toEmptyEntity(){return[new r.UnhandledEntity("")]}transform(e){return e.accept(this)}transformPlainTextNode(e){return this._toUnhandledEntity(e,e.getRawText())}transformUnicodeEmojiNode(e){return this.transformPlainTextNode(e.emojiTextNode)}transformEmoteNode(e){return[new r.UnhandledEntity(a.default.unescapeXml(e.escapedFallbackText))]}transformContextNode(e){return[new r.ContextEntity(e.encodedAttr())]}}t.ContentToImBackTransformer=l,t.toEntities=function(e){return(new l).transform(e)}},81632:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toEntities=t.ContentToInputEntityTransformer=void 0;const i=s(96486),o=s(81169),n=s(81959),r=s(97174),a=s(53374);class l{constructor(e){this._capabilities=e,this.transformRootNode=this._default,this.transformHighlightedNode=this._default,this.transformEditMessageMetaDataNode=this._default,this.transformUserMriNode=this._default,this.transformFlagNode=this._toUnhandledEntity,this.transformLegacyQuoteNode=this._default,this.transformContextNode=this._toUnhandledEntity,this.transformSuggestedTextHighlightNode=this._toUnhandledEntity,this.transformUnknownNode=this._default,this.transformSwiftNode=this._default,this.transformPollNode=this._default,this.transformCallerIDNode=this._default,this.transformTranslationNode=this._default,this.transformHtmlNode=this._default}_default(e){return(0,o.chain)(e.children,(0,o.map)((e=>e&&e.accept(this))),(0,o.compact)(),(0,o.flatten)())}_toUnhandledEntity(e,t){return i.isString(t)||(t=n.renderText(e)),[new r.UnhandledEntity(t)]}transform(e){return e.accept(this)}transformPlainTextNode(e){return this._toUnhandledEntity(e,e.getRawText())}transformAtMentionNode(e){var t;let s=null===(t=e.children[0])||void 0===t?void 0:t.getRawText();return e.isAllMention()&&(s=e.getLocalizedAllMention()),[new r.AtMentionEntity(s,e.id,void 0,void 0,e.itemid)]}transformUnicodeEmojiNode(e){return this.transformPlainTextNode(e.emojiTextNode)}transformEmoticonNode(e){return this._capabilities.supportEmoticons?[new r.EmoticonEntity(n.renderText(e),e.type,e.tone)]:this._toUnhandledEntity(e)}transformQuoteNode(e){return[new r.QuoteEntity(e)]}transformWikiMarkupNode(e){const t=this._default(e),s=a.default.unescapeXml(e.rawPre),i=e.rawPost&&a.default.unescapeXml(e.rawPost);return[new r.WikiMarkupEntity(t,e.getTag(),s,i)]}transformEmoteNode(e){return[new r.EmoteEntity(e)]}transformLinkNode(e){const t=e.children[0].getRawText();return this._capabilities.supportLinkEntity?[new r.LinkEntity(t,e.getSanitizedHref())]:this._toUnhandledEntity(e)}}t.ContentToInputEntityTransformer=l,t.toEntities=function(e,t){return new l(t).transform(e)}},17677:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.quoteMessage=t.quoteRenderer=void 0;const i=s(96486),o=s(71830),n=s(86374),r=s(12762),a=s(53374);t.quoteRenderer=new class{constructor(){this.transformRootNode=this._default,this.transformPlainTextNode=this._default,this.transformSuggestedTextHighlightNode=this._default,this.transformEditMessageMetaDataNode=this._default,this.transformUserMriNode=this._default,this.transformEmoticonNode=this._default,this.transformFlagNode=this._default,this.transformLegacyQuoteNode=this._default,this.transformWikiMarkupNode=this._default,this.transformLinkNode=this._default,this.transformEmoteNode=this._default,this.transformContextNode=this._asEmpty,this.transformSwiftUriObjectNode=this._asEmpty,this.transformSwiftNode=this._asEmpty,this.transformAdaptiveCardNode=this._asEmpty,this.transformScheduledCallInviteNode=this._asEmpty,this.transformUnknownNode=this._default,this.transformTextWrapperNode=this._default,this.transformTargetUserNode=this._default,this.transformTargetLegacyUserNode=this._default,this.transformTargetRoleNode=this._default,this.transformTargetsNode=this._default,this.transformContactNode=this._default,this.transformContactsNode=this._default,this.transformFileNode=this._default,this.transformFilesNode=this._default,this.transformPollNode=this._asEmpty,this.transformMetaNode=this._default,this.transformUriObjectNode=this._default,this.transformUriObjectFileNode=this._default,this.transformPictureNode=this._default,this.transformVideoNode=this._default,this.transformVideoMessageNode=this._default,this.transformAudioNode=this._default,this.transformAudioMessageNode=this._default,this.transformSkypeVideoMessageNode=this._default,this.transformMojiNode=this._default,this.transformStickerNode=this._default,this.transformCallInfoUriObjectNode=this._default,this.transformAddMemberNode=this._default,this.transformDeleteMemberNode=this._default,this.transformRoleUpdateNode=this._default,this.transformTopicUpdateNode=this._default,this.transformHandshakeInviteNode=this._default,this.transformHandshakeAcceptNode=this._default,this.transformHandshakeCompleteNode=this._default,this.transformHandshakeRejectNode=this._default,this.transformPictureUpdateNode=this._default,this.transformHistoryDisclosedUpdateNode=this._default,this.transformJoiningEnabledUpdateNode=this._default,this.transformLegacyMemberAddedNode=this._default,this.transformLegacyMemberUpgradedNode=this._default,this.transformPartNode=this._default,this.transformPartListNode=this._default,this.transformEndedNode=this._default,this.transformNgcUpgradeNode=this._default,this.transformHtmlNode=this._default,this.transformCallerIDNode=this._asEmpty,this.transformMediaAlbumNode=this._asEmpty,this.transformDataNode=this._asEmpty,this.transformGuestNameUpdateNode=this._default,this.transformGuestNameUpdateTargetNode=i.identity}_default(e){const t=i.map(e.children,(e=>e&&e.accept(this)));return e.cloneWithChildren(t)}_asEmpty(e){return r.PlainTextNode.fromPlainText("")}transform(e){return e.accept(this)}transformHighlightedNode(e){const[t]=e.children;if(t)return t.accept(this)}transformAtMentionNode(e){return this._default(r.AtMentionNode.transformToNonAlertingNode(e))}transformUnicodeEmojiNode(e){return this.transformPlainTextNode(e.emojiTextNode)}transformQuoteNode(e){return this._asEmpty(e)}transformSmsNode(e){return r.PlainTextNode.fromPlainText(e.smsContentUnescaped)}transformMmsNode(e){return r.MmsNode.parseMms(e.rawContent)}transformTranslationNode(e){return r.TranslationNode.parse(e.translation,e.originalLocale)}transformLocationNode(e){return r.PlainTextNode.fromPlainText(e.addressSanitized)}},t.quoteMessage=function(e,s){const l=o.getSkypeIdFromMri(e.creator);s=i.isString(s)?s:l;const d=Math.round(e.createdTime/1e3),c=n.decode(e);if(c.hasOnlyQuotedContent()&&c.children[0]instanceof r.QuoteNode)return c.children[0];const h=function(e,s,o,n,l){const d=i.flatten([r.LegacyQuoteNode.parse([r.PlainTextNode.fromPlainText("["+n+"] "+(o||s)+": ")]),t.quoteRenderer.transform(e),r.LegacyQuoteNode.parse([r.PlainTextNode.fromPlainText("\n\n<<< ")])]);let c;if(l.isBookmark()){const e=l.getBookmarkMetadata();c=e&&e.bookmarkSourceConversationId}return new r.QuoteNode(d,s&&a.default.escapeXml(s),o&&a.default.escapeXml(o),n,c||l.conversationId,l.getOriginalServerId(),l.cuid)}(c,l,s,d,e);return h}},81959:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.renderText=t.ContentToTextTransformer=void 0;const i=s(23719),o=s(96486),n=s(79957),r=s(96096),a=s(71830),l=s(47477),d=s(35521),c=s(70891),h=s(46096),u=s(73560),p=s(17213),g=s(36237),m=s(33754),S=s(18078),f=s(89391),y=s(18317),_=s(4057),v=s(53374);class C extends l.TransformerBase{constructor(e){super(),this.transformHighlightedNode=this._default,this.transformEditMessageMetaDataNode=this._skip,this.transformAtMentionNode=e=>{const t=this._renderTextNodes(e.children);let s=t.value;return e.isAllMention()&&(s=e.getLocalizedAllMention()),Object.assign(Object.assign({},t),{value:s})},this.transformFlagNode=this._default,this.transformLegacyQuoteNode=this._skip,this.transformContextNode=this._default,this.transformSuggestedTextHighlightNode=this._default,this.transformSwiftNode=this._skip,this.transformAdaptiveCardNode=this._skip,this.transformUnknownNode=this._default,this.transformTextWrapperNode=this._skip,this.transformTargetUserNode=this._skip,this.transformTargetLegacyUserNode=this._skip,this.transformTargetRoleNode=this._skip,this.transformTargetsNode=this._skip,this.transformFileNode=this._default,this.transformScheduledCallInviteNode=this._default,this.transformLocationNode=this._default,this.transformMetaNode=this._skip,this.transformUriObjectNode=this._default,this.transformUriObjectFileNode=this._default,this.transformPictureNode=this._default,this.transformAudioNode=this._default,this.transformAudioMessageNode=this._default,this.transformVideoNode=this._default,this.transformVideoMessageNode=this._default,this.transformMojiNode=this._default,this.transformStickerNode=this._default,this.transformSkypeVideoMessageNode=this._default,this.transformPartNode=this._skip,this.transformEndedNode=this._skip,this.transformPollNode=this._default,this.transformMediaAlbumNode=this._default,this.transformCallInfoUriObjectNode=this._skip,this.transformCallerIDNode=this._default,this.transformDataNode=this._skip,this.transformGuestNameUpdateTargetNode=o.identity,this._options=e}static addUtfFallback(e,t){C._utfFallback[e]=t}_default(e){return this._renderTextNodes(e.children)}_skip(){return{value:void 0,stopProcessing:!1}}_renderTextNodes(e,t=""){const s=[];let i=!1;const o=e.length;for(let t=0;t<o;t++){const o=e[t];let n=o&&o.accept(this);if(n||(g.warn(h.LogTraceArea.GenericUnsafe,"renderText returned falsy",o,this._options),n={value:void 0,stopProcessing:!1}),s.push(n.value),n.stopProcessing){i=!0;break}}return{value:s.join(t),stopProcessing:i}}transform(e){return e.accept(this)}transformRootNode(e){return this._default(e)}transformPlainTextNode(e){const t=this._renderPlainText(e.getRawText(),e);return{value:o.isArray(t.value)?t.value.join(""):t.value,stopProcessing:t.stopProcessing}}_renderLineBreak(e){return this._options.trimToFirstLine?{value:void 0,stopProcessing:!0}:{value:this._options.lineBreakString,stopProcessing:!1}}transformUserMriNode(e){let t=(0,d.displayNameText)(v.default.unescapeXml(e.mri),v.default.unescapeXml(e.textNode.getRawText()));return l.trimToFirstLineIfNeeded(t,!!this._options.trimToFirstLine)}transformUnicodeEmojiNode(e){return this.transformPlainTextNode(e.emojiTextNode)}transformEmoticonNode(e){return this._options.utfFallback&&e.type in C._utfFallback?{value:C._utfFallback[e.type],stopProcessing:!1}:this._default(e)}transformQuoteNode(e){if(this._options.trimToFirstLine&&this._options.onlyQuotedContent)return{value:m.getString("ContentToTextTransformer.QuotedMessageReceivedToast"),stopProcessing:!0};switch(this._options.processing.quotes){case c.ProcessingLevel.None:return this._skip();case c.ProcessingLevel.Stripped:const t=this._default(e);return t.stopProcessing?t:{value:t.value+this._options.lineBreakString,stopProcessing:t.stopProcessing}}const t=this._options.lineBreakString,s=this._default(e);return{value:`[${e.timestamp}] ${e.getAuthorNameWithFallbackUnescaped()}: `+s.value+(s.stopProcessing?"":t+t+"<<< "),stopProcessing:s.stopProcessing}}transformWikiMarkupNode(e){switch(this._options.processing.wikiMarkup){case c.ProcessingLevel.None:return this._skip();case c.ProcessingLevel.Stripped:return this._default(e)}const t=[e.rawPreNode,...e.children];return e.rawPostNode&&t.push(e.rawPostNode),this._renderTextNodes(t)}transformLinkNode(e){const{enableHandlingHyperlinkOnPaste:t}=f.default.getS4LMessagingFeaturesNoSubscription();return t?{value:e.getSanitizedHref(),stopProcessing:!1}:this._default(e)}transformEmoteNode(e){const t=(0,d.displayNameText)(v.default.unescapeXml(e.escapedAuthorMri),v.default.unescapeXml(e.escapedFallbackText)),s=this._renderTextNodes(e.children);return{value:t+" "+s.value,stopProcessing:s.stopProcessing}}transformSwiftUriObjectNode(e){return{value:new C(this._options).transform(e.titleChild).value,stopProcessing:!1}}transformContactNode(e){return{value:l.getContactInfo(e),stopProcessing:!1}}transformContactsNode(e){if(this._options.trimToFirstLine){return{value:m.getString("ContentToDisplayTransformerBase.ContactsSent"),stopProcessing:!0}}let t;if(this._options.message&&this._options.message.creator&&!S.default.isMyMri(this._options.message.creator)){const e="ContentToDisplayTransformerBase.ContactsReceived",s={initiator:(0,d.displayNameText)(this._options.message.creator,this._options.message.creator)};t=(0,u.localizeMessageString)(this._options.message.creator,e,s)}else t=m.getString("ContentToDisplayTransformerBase.ContactsSent");const s=this._renderTextNodes(e.children,", ");return t+=": "+s.value,{value:t,stopProcessing:s.stopProcessing}}transformFilesNode(e){const t=m.getString("ContentToDisplayTransformerBase.FilesReceivedNotSupported");if(this._options.trimToFirstLine)return{value:t,stopProcessing:!0};const s=this._renderLineBreak(e),i=this._renderTextNodes(e.children,", ");return{value:[t,s.value,i.value].join(""),stopProcessing:i.stopProcessing}}transformSmsNode(e){return l.trimToFirstLineIfNeeded(e.smsContentUnescaped,!!this._options.trimToFirstLine)}transformMmsNode(e){return this._renderTextNodes(e.contentNodes)}_getThreadActivityMemberParts(e,t,s){const{authorMri:i,personMris:n}=l.getThreadActivityMemberParts(t,s);return{authorName:(0,d.displayNameText)(i,i),personNames:o.map(n,(e=>(0,d.displayNameText)(e,e))),authorMri:i}}transformAddMemberNode(e){const{authorName:t,personNames:s,authorMri:i}=this._getThreadActivityMemberParts(this._options,e.initiator,e.content);let r=l.getAddMemberLocalizeInfo(t,s.join(", "),s.length>0),a=(0,u.localizeMessageParts)(i,r.key,r.params);if(s.length>0){const t=this._renderLineBreak(e);if(!t.stopProcessing){const{allMessagesBotsFormatted:s,atMentionOnlyBotsFormatted:i}=(0,n.getBotsForDisclosure)(e.content,e.conversationId,o.identity,(e=>"@"+e));if(s.length>0||i.length>0){const e=l.renderBotDisclosureParts(s,i);a=a.concat(t.value,o.compact(e))}}}return{value:a.join(""),stopProcessing:!1}}transformDeleteMemberNode(e){const{authorName:t,personNames:s,authorMri:i}=this._getThreadActivityMemberParts(this._options,e.initiator,e.content),o=a.isThread(i)?void 0:t,{key:n,params:r}=l.getDeleteMemberNodeLocalizeInfo(o,s.join(", "),s.length>0);return{value:(0,u.localizeMessageParts)(i,n,r).join(""),stopProcessing:!1}}transformRoleUpdateNode(e){const{authorName:t,personNames:s,authorMri:i}=this._getThreadActivityMemberParts(this._options,e.initiator,[e.content[0]]),o=e.content[0].roleChild.getRawText(),{key:n,params:r}=l.getRoleUpdateNodeLocalizeInfo(t,s.join(", "),o);return{value:(0,u.localizeMessageParts)(i,n,r).join(""),stopProcessing:!1}}transformTopicUpdateNode(e){const{authorName:t,authorMri:s}=this._getThreadActivityMemberParts(this._options,e.initiator),i=e.content.getRawText(),{key:o,params:n}=l.getTopicUpdateNodeLocalizeInfo(t,i);return{value:(0,u.localizeMessageParts)(s,o,n).join(""),stopProcessing:!1}}transformHandshakeInviteNode(e){const{authorName:t,personNames:s,authorMri:i}=this._getThreadActivityMemberParts(this._options,e.initiator,e.content),o=S.default.isMyMri(i),{key:n,params:r}=l.getHandshakeInviteNodeLocalizedInfo(o?s[0]:t,o);return{value:(0,u.localizeMessageParts)(i,n,r).join(""),stopProcessing:!1}}transformHandshakeAcceptNode(e){const{authorName:t,personNames:s,authorMri:i}=this._getThreadActivityMemberParts(this._options,e.initiator,e.content),o=S.default.isMyMri(i),{key:n,params:r}=l.getHandshakeAcceptNodeLocalizedInfo(o?s[0]:t,o);return{value:(0,u.localizeMessageParts)(i,n,r).join(""),stopProcessing:!1}}transformHandshakeCompleteNode(){return{value:m.getString("ContentToDisplayTransformerBase.E2eeInvitationConfirmed"),stopProcessing:!1}}transformHandshakeRejectNode(){return{value:m.getString("ContentToDisplayTransformerBase.E2eeInvitationRejected"),stopProcessing:!1}}transformPictureUpdateNode(e){const{authorName:t,authorMri:s}=this._getThreadActivityMemberParts(this._options,e.initiator),{key:i,params:o}=l.getPictureUpdateNodeLocalizeInfo(t);return{value:(0,u.localizeMessageParts)(s,i,o).join(""),stopProcessing:!1}}transformHistoryDisclosedUpdateNode(e){const{authorName:t,authorMri:s}=this._getThreadActivityMemberParts(this._options,e.initiator),{key:i,params:o}=l.getHistoryDisclosedUpdateLocalizeInfo(t,e.nowDisclosed);return{value:(0,u.localizeMessageParts)(s,i,o).join(""),stopProcessing:!1}}transformJoiningEnabledUpdateNode(e){const{authorName:t,authorMri:s}=this._getThreadActivityMemberParts(this._options,e.initiator),{key:i,params:o}=l.getJoiningEnabledUpdateNodeLocalizeInfo(t,e.nowEnabled);return{value:(0,u.localizeMessageParts)(s,i,o).join(""),stopProcessing:!1}}transformLegacyMemberAddedNode(e){const{authorName:t,authorMri:s}=this._getThreadActivityMemberParts(this._options,e.initiator),i=this.transformLinkNode(e.link),{key:o,params:n}=l.getLegacyMemberAddedNodeLocalizeInfo(t,i.value);return{value:(0,u.localizeMessageParts)(s,o,n).join(""),stopProcessing:i.stopProcessing}}transformLegacyMemberUpgradedNode(e){const{authorName:t,authorMri:s}=this._getThreadActivityMemberParts(this._options,e.initiator),{key:i,params:o}=l.getLegacyMemberUpgradedNodeLocalizeInfo(t);return{value:(0,u.localizeMessageParts)(s,i,o).join(""),stopProcessing:!1}}transformPartListNode(e){const t=r.default.calculateCallMarkerInfo(e);return{value:r.CallMarkerDisplayUtils.getText(t.type,t.duration),stopProcessing:!1}}transformNgcUpgradeNode(e){return{value:(0,y.ngcUpgradeMessageText)(e.userMrisOrNames),stopProcessing:!1}}transformTranslationNode(e){return{value:e.translation,stopProcessing:!1}}_getHtmlInnerTextWalker(e,t){o.each(e,(e=>{if(i.DomUtils.isTag(e)){const s=i.DomUtils.getName(e);if("br"===s)t.text+="\n",t.pendingSeparator=void 0;else if("img"===s&&e.attribs&&e.attribs.alt&&e.attribs.itemtype===p.SemanticObjectSchemas.emoji)t.text+=e.attribs.alt;else{const i=["p","div","h1","h2","h3","h4","h5","h6","tr","img"],n=o.indexOf(i,s)>=0?"\n":void 0;t.pendingSeparator=n,e.children&&this._getHtmlInnerTextWalker(e.children,t),t.pendingSeparator=t.pendingSeparator||n}}else{const s=i.DomUtils.getText(e).replace(/\r?\n/g," ");s&&(t.text+=(t.text&&t.pendingSeparator?t.pendingSeparator:"")+s,t.pendingSeparator=void 0)}}))}_getHtmlInnerText(e){const t={text:""};return this._getHtmlInnerTextWalker(e,t),o.trim(t.text," ").replace(/ +(?= )/g,"")}transformHtmlNode(e){let t=this._getHtmlInnerText(e.getHtmlDom());const s=this._renderTextNodes(e.children,this._options.lineBreakString);return s.value&&(t+=this._options.lineBreakString+s.value),{value:t,stopProcessing:s.stopProcessing}}transformGuestNameUpdateNode(e){var t;const s=null===(t=o.first(e.content))||void 0===t?void 0:t.encodedAttr(),i=null==s?void 0:s.newName,n=null==s?void 0:s.oldName;return{value:i&&n?m.getString("ContentToDisplayTransformerBase.GuestNameUpdate",{oldName:n,newName:i}):void 0,stopProcessing:!1}}}t.ContentToTextTransformer=C,C._utfFallback={},t.renderText=function(e,t={}){try{const s=o.defaults(t,{utfFallback:t.utfFallback||!1,onlyQuotedContent:e&&e.hasOnlyQuotedContent&&e.hasOnlyQuotedContent(),processing:t.processing||{},lineBreakString:"\r"}),i=new C(s);return i.transform(e).value||""}catch(e){g.error(h.LogTraceArea.GenericUnsafe,"ContentToTextTransformer: Failed to transform tree: "+_.default.errorAsString(e))}return""}},86374:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.decode=t.decodeFromContent=t.registerParser=t.Parser=void 0;const i=s(74958),o=s(96486),n=s(89391),r=s(51077),a=s(70891),l=s(46096),d=s(36237),c=s(12692),h=s(4057),u=s(53374),p=s(42222);function g(e,s,o){try{return function(e,s){let o=e||"",n=0;s&&s.skypeeditoffset&&s.skypeeditoffset>0&&(n+=Number(s.skypeeditoffset));let c,h="";if(s&&s.isEmote()){const e=s&&s.skypeemoteoffset;e&&e>0&&(n>0&&d.error(l.LogTraceArea.Deserializer,"Both skypeeditoffset and skypeemoteoffset: which comes first?",i.pii.Omit(JSON.stringify(s))),n+=e,h=o.substr(0,e))}n>0&&(o=o.substr(n));let g=!1;const f=!s||!s.messagetype||r.isXmlMessageType(s.messagetype);if(!s||f){if(o&&o.indexOf("<")>-1){const e=p.parse(o,a.rootTagName);if(e){c=S(m(e,s),s)}else d.log(l.LogTraceArea.Deserializer,"Could not XML parse content",i.pii.Omit(JSON.stringify({content:o,item:s}))),g=!0}}else if(s&&(r.isJsonMessageType(s.messagetype)||r.isHtmlMessageType(s.messagetype))){let e=t.Parser.parseFromMessageType(o,s.messagetype,s);e?c=t.Parser.root([e]):g=!0}if(!c){f||(o=u.default.escapeXml(o));const e=t.Parser.parseXmlText(o);c=S(t.Parser.root([e],g),s)}s&&s.isEmote()&&(c=t.Parser.emote(c,s.creator,h));return c}(e,s)}catch(e){return d.error(l.LogTraceArea.Deserializer,"Failed to parse "+o,h.default.errorAsString(e)),t.Parser.root([],!0)}}function m(e,s){const i=o.clone(e.attributes),n=[];o.each(e.children,(e=>{if(e.isTag){const t=m(e,s);n.push(t)}else{const s=e,i=t.Parser.parseXmlText(s.string);n.push(i)}}));const r=t.Parser.parse(n,i,e.name,s);return r||t.Parser.parseUnknown(n,i,e.name,s)}function S(e,s){if(!n.default.getS4LMessagingFeaturesNoSubscription().transformCorruptedMessages||!s)return e;let a;try{a=r.getMessageTypeGroup(s)}catch(t){return d.error(l.LogTraceArea.Deserializer,"Failed to transform corrupted message - Unknown message type.",i.pii.Omit(JSON.stringify(s))),e}let c=[r.MessageTypeGroups.System,r.MessageTypeGroups.Calling];if(o.includes(c,a)&&e.children&&1===e.children.length){let i=e.children[0];if(i&&s&&!o.includes(i.getMessageTypes(),s.messagetype)){let e=t.Parser.parseUnknown([],{},"",s);return t.Parser.root([e],!1)}}return e}t.Parser=void 0,t.registerParser=function(e){t.Parser=e},t.decodeFromContent=function(e){return g(e,void 0,"message content string")},t.decode=function(e,t,s){if(e instanceof c.default)return g(e.content,e,"messageLocal");{const i={creator:t,conversationId:s,content:e.content,contenttype:e.contenttype,messagetype:e.messagetype,properties:e.properties,skypeeditoffset:e.skypeeditoffset,skypeemoteoffset:e.skypeemoteoffset?parseInt(e.skypeemoteoffset,10):void 0,skypeguid:e.skypeguid,isMessageLie:()=>!e.id,isEmote:()=>!!e.skypeemoteoffset};return g(i.content,i,"messagePosting")}}},97174:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GuestNameUpdateEntity=t.TranslationSettingsEntity=t.DataEntity=t.ContextEntity=t.PartListEntity=t.CallInfoEntity=t.CallReactionMetadataEntity=t.SwiftEntity=t.GeoLocationEntity=t.AdaptiveUriObjectEntity=t.PollInputEntity=t.ScheduledCallInviteUriObjectEntity=t.SwiftUriObjectEntity=t.MediaAlbumEntity=t.MediaEntity=t.StickerEntity=t.CallerIDEntity=t.MojiEntity=t.WikiMarkupEntity=t.LinkEntity=t.SmsEntity=t.ContactEntity=t.QuoteEntity=t.CommandEntity=t.SuggestedTextHighlightEntity=t.FlagEntity=t.EmoticonEntity=t.EmoteEntity=t.AtMentionEntity=t.DoNotFormatEntity=t.EditMessageMetaDataEntity=t.EscapedEntity=t.UnhandledEntity=t.InputEntity=void 0;const i=s(96486),o=s(16778),n=s(89391),r=s(65976),a=(s(71830),s(81959)),l=s(40276),d=s(16402),c=s(70891),h=s(46096),u=s(36237),p=s(33754),g=s(12762),m=s(26424),S=s(71669),f=s(53891),y=s(79829),_=s(16568),v=s(15301),C=s(40363),b=s(78262),T=s(26712),M=s(53374);class I{constructor(e){this.children=e}renderReact(e,t){return o.createElement(o.Text,{style:e.defaultStyle,key:t,textBreakStrategy:"simple"},this.children[0])}}t.InputEntity=I;class w extends I{constructor(e){super(e?i.isString(e)?[e]:e:[])}text(){return this.children.join("")}decode(){return g.PlainTextNode.fromPlainText(this.text())}appendText(e){e&&this.children.push(e)}renderReact(e,t){return o.createElement(o.Text,{style:e.defaultStyle,key:t,textBreakStrategy:"simple"},this.text())}}t.UnhandledEntity=w;t.EscapedEntity=class extends I{constructor(e){super([e])}text(){return this.children.join("")}decode(){return g.PlainTextNode.fromEscapedXml(this.text())}};t.EditMessageMetaDataEntity=class extends I{constructor(e,t,s=(t?Math.floor(t/1e3):void 0),i=g.EditMessageMetaDataNode.ExpectedT){super([]),this.fallbackSkypeId=e,this.originalArrivalTime=t,this.originalArrivalTimeSeconds=s,this.t=i}text(){return""}decode(){return g.EditMessageMetaDataNode.parse([],{a:M.default.escapeXml(this.fallbackSkypeId),ts_ms:""+this.originalArrivalTime,ts:""+this.originalArrivalTimeSeconds,t:""+this.t})}renderReact(e,t){return null}};t.DoNotFormatEntity=class extends I{constructor(e){super([e])}text(){return this.children[0]}decode(){return g.PlainTextNode.fromEscapedXml(this.text())}};class P extends I{constructor(e,t,s,i,o){super([e]),this.userMri=t,this.shortName=s,this.displayName=i,this.itemid=o}text(){return this.children[0]}decode(){return g.AtMentionNode.parse([g.PlainTextNode.fromPlainText(this.children[0])],{id:M.default.escapeXml(this.userMri),itemid:this.itemid})}clone(e){return new P(e,this.userMri,this.shortName,this.displayName,this.itemid)}renderReact(e,t){return o.createElement(o.Text,{style:i.compact([e.defaultStyle,e.atMentionStyle]),key:t,textBreakStrategy:"simple"},this.children[0])}}t.AtMentionEntity=P;t.EmoteEntity=class extends I{constructor(e){super([e.escapedFallbackText]),this._escapedFallbackText=e.escapedFallbackText,this.fallbackText=M.default.unescapeXml(this._escapedFallbackText)}text(){return""}decode(){return g.PlainTextNode.fromEscapedXml(this._escapedFallbackText)}renderReact(e,t){return null}};t.EmoticonEntity=class extends I{constructor(e,t,s){super([e]),this.emoticonName=t,this.tone=s}text(){const e=this.children[0];if(this.tone&&e.length>2&&"("===i.first(e)&&")"===i.last(e)){const t=m.DiverseToneSeparator+this.tone+")";if(!i.endsWith(e,t))return e.slice(0,-1)+t}return e}defaultToneText(){return this.children[0]}decode(){const e=M.default.escapeXml(this.emoticonName),t=M.default.escapeXml(this.text());return g.EmoticonNode.parse([g.PlainTextNode.fromEscapedXml(t)],{type:e,tone:String(this.tone)})}renderReact(e,t){return o.createElement(o.Text,{style:i.compact([e.defaultStyle,e.emoticonAndFlagStyle]),key:t,textBreakStrategy:"simple"},this.children[0])}};t.FlagEntity=class extends I{constructor(e,t){super([e]),this.flagName=t}text(){return this.children[0]}decode(){return g.FlagNode.parse([g.PlainTextNode.fromPlainText(this.children[0])],{country:M.default.escapeXml(this.flagName)})}renderReact(e,t){return o.createElement(o.Text,{style:e.emoticonAndFlagStyle,key:t,textBreakStrategy:"simple"},this.children[0])}};t.SuggestedTextHighlightEntity=class extends I{constructor(e,t,s){super([e]),this.activityId=t,this.actionsIndexes=s}text(){return this.children[0]}decode(){return g.SuggestedTextHighlightNode.parse([g.PlainTextNode.fromPlainText(this.text())],{actionsIndexes:this.actionsIndexes.join(";"),activityId:this.activityId})}};t.CommandEntity=class extends I{constructor(e,t,s,i){super([e]),this.commandName=t,this.usageHint=s,this.description=i,this.usageHint=this.usageHint||""}text(){return this.children[0]}decode(){return u.log(h.LogTraceArea.InputEntity,"Decode() called on CommandEntity",this),new w(this.text()).decode()}};t.QuoteEntity=class extends I{constructor(e,t="",s,i){super([]),this.quoteNode=e,this.quotedMessage=s,this.quotesTriggerType=i,this.authorname=t;const o=e;this.author=o.author,this.timestamp=o.timestamp,this.conversationId=o.conversation,this.messagetimestamp=void 0===o.messageid?void 0:Number(o.messageid)}text(e){const t=e&&e.showQuotedText?c.ProcessingLevel.Stripped:c.ProcessingLevel.None;return a.renderText(this.quoteNode,{processing:{quotes:t}})}textForSMS(){const e=d.default.getAbsoluteDisplayDateTimeString(1e3*this.timestamp),t=a.renderText(this.quoteNode,{processing:{quotes:c.ProcessingLevel.Stripped}});return e+" "+this.authorname+":\n> "+t+"\n"}decode(){return this.quoteNode}};t.ContactEntity=class extends I{constructor(e,t,s,i,o){super([]),this._skypeId=e,this._fullName=t,this._isPstn=s,this._pstnName=i,this._isS4B=o}getSkypeId(){return this._skypeId}getFullName(){return this._fullName}isPstn(){return this._isPstn}isS4B(){return this._isS4B}text(){return""}decode(){const e=g.ContactNode.parse([],{t:g.ContactNode.getEncodedTypeAttr(this._isPstn,this._isS4B),p:this._pstnName,s:this._skypeId,f:this._fullName});return g.ContactsNode.parse([e])}};t.SmsEntity=class extends I{constructor(e,t){super([]),this._smsTextUnescaped=e,this._smsReceipient=t,this._flowId=v.default.getFlowId(),this._deliveryMethodText="reliable",this._uiVersion=C.default.getUIVersion(),this._fingerprint=_.default.CallingFingerprintId.get(),this._restApiVersion="2"}text(e){return this._smsTextUnescaped}decode(){let e=M.default.newGuid();const t=[g.UnknownNode.parse([g.PlainTextNode.fromPlainText("chatservice")],{},"deliveryReportVersion"),g.UnknownNode.parse([g.PlainTextNode.fromPlainText(this._uiVersion)],{},"uiVersion")],{enableSmsFingerprintId:s,smsFingerprintIdTag:i}=n.default.dangerouslyGetS4LMessagingFeatures();return s&&this._fingerprint&&t.push(g.UnknownNode.parse([g.PlainTextNode.fromPlainText(this._fingerprint)],{},i)),g.SmsNode.parse([g.UnknownNode.parse([g.PlainTextNode.fromPlainText(this._restApiVersion)],{},"restApiVersion"),g.UnknownNode.parse([g.PlainTextNode.fromPlainText(this._smsTextUnescaped)],{},"encoded_body"),g.UnknownNode.parse([g.UnknownNode.parse(t,{},"skype"),g.UnknownNode.parse([g.UnknownNode.parse([g.PlainTextNode.fromPlainText(this._flowId)],{},"flowId"),g.UnknownNode.parse([g.PlainTextNode.fromPlainText(this._deliveryMethodText)],{},"deliveryMethod")],{},"control"),g.UnknownNode.parse([g.UnknownNode.parse([g.PlainTextNode.fromPlainText(this._smsTextUnescaped)],{},"body")],{},"content")],{},"defaults"),g.UnknownNode.parse([g.UnknownNode.parse([g.UnknownNode.parse([g.PlainTextNode.fromPlainText(e)],{},"requestId"),g.UnknownNode.parse([g.UnknownNode.parse([g.PlainTextNode.fromPlainText(this._smsReceipient)],{},"address")],{},"recipient")],{},"bulkItem")],{},"bulkItems")],{alt:M.default.escapeXml(this._smsTextUnescaped)})}renderReact(e){return o.createElement(o.Text,{style:i.compact([e.defaultStyle,e.emoticonAndFlagStyle]),textBreakStrategy:"simple",key:"smsEntity"},this._smsTextUnescaped)}};t.LinkEntity=class extends I{constructor(e,t){super([e]),this.href=t}text(){return this.children[0]}computeType(){const e=T.default.getURIComponents(this.href);return e&&e.type}decode(){return g.LinkNode.parse([g.PlainTextNode.fromPlainText(this.children[0])],{href:M.default.escapeXml(this.href)})}};t.WikiMarkupEntity=class extends I{constructor(e,t,s,i){super(e),this.tag=t,this.raw_pre=s,this.raw_post=i}text(){return this.raw_pre+i.map(this.children,(e=>e.text())).join("")+(this.raw_post||"")}decode(){const e=i.map(this.children,(e=>e.decode()));return g.WikiMarkupNode.parse(e,{raw_pre:M.default.escapeXml(this.raw_pre),raw_post:this.raw_post&&M.default.escapeXml(this.raw_post)},this.tag)}renderReact(e,t){return o.createElement(o.Text,{style:e.defaultStyle,key:t,textBreakStrategy:"simple"},this.text())}};t.MojiEntity=class extends I{constructor(e,t,s,i,o,n,r,a){super([o]),this.id=e,this.uri=t,this.url_thumbnail=s,this.type=i,this.fallbackUrl=o,this.title=n,this.description=r,this.originalName=a}text(){return this.children[0]}decode(){return g.UriObjectNode.parse([g.UnknownNode.parse([g.PlainTextNode.fromPlainText(this.title)],{},"Title"),g.UnknownNode.parse([g.PlainTextNode.fromPlainText(this.description)],{},"Description"),g.LinkNode.parseFromHref(this.fallbackUrl),g.UnknownNode.parse([],{v:M.default.escapeXml(this.originalName)},"OriginalName")],{uri:M.default.escapeXml(this.uri),url_thumbnail:M.default.escapeXml(this.url_thumbnail),type:this.type})}renderReact(e,t){return o.createElement(o.Text,{style:i.compact([e.defaultStyle,e.emoticonAndFlagStyle]),key:t,textBreakStrategy:"simple"},this.children[0])}};t.CallerIDEntity=class extends I{constructor(e){super([e]),this._layoutOption=e}text(){return""}decode(){return g.CallerIDNode.parse([],{layoutOption:this._layoutOption})}};t.StickerEntity=class extends I{constructor(e,t,s,i,o=p.getString("InputEntity.StickerFallbackText"),r=n.default.getS4LMessagingFeaturesNoSubscription().stickersNotSupportedFallbackUrl){super([r]),this.id=e,this.uri=t,this.url_thumbnail=s,this.originalName=i,this.fallbackMessage=o,this.fallbackUrl=r}text(){return this.children[0]}decode(){const e=[g.PlainTextNode.fromPlainText(this.fallbackMessage),g.LinkNode.parseFromHref(this.fallbackUrl)];return this.originalName&&e.push(g.UnknownNode.parse([],{v:M.default.escapeXml(this.originalName)},"OriginalName")),g.UriObjectNode.parse(e,{uri:M.default.escapeXml(this.uri),url_thumbnail:M.default.escapeXml(this.url_thumbnail),type:"Sticker.1"})}renderReact(e,t){return o.createElement(o.Text,{style:i.compact([e.defaultStyle,e.emoticonAndFlagStyle]),key:t,textBreakStrategy:"simple"},this.children[0])}};t.MediaEntity=class extends I{constructor(e,t,s,i,o,n,r,a,l,d){super([s]),this.localUri=e,this.localThumbnailUrl=t,this.fallbackUrl=s,this.azureMSUrl=i,this.uploadType=o,this.filename=n,this.fileSize=r,this.dimensions=a,this.amsDocumentId=l,this.audioMessageDurationMs=d}text(){return this.children[0]}decode(){let e,t,s;switch(this.uploadType){case b.UploadFileType.Picture:t="Picture",e=p.getString("InputEntity.SharedPhotoFallbackText");break;case b.UploadFileType.Video:t="Video",e=p.getString("InputEntity.SharedVideoFallbackText");break;case b.UploadFileType.VideoMessage:t="Video",s="Message",e=p.getString("InputEntity.VideoMessageFallbackText");break;case b.UploadFileType.Audio:t="Audio",e=p.getString("InputEntity.AudioFileFallbackText");break;case b.UploadFileType.AudioMessage:t="Audio",s="Message",e=p.getString("InputEntity.AudioMessageFallbackText");break;default:case b.UploadFileType.File:t="File",e=p.getString("InputEntity.FileFallbackText")}let o={uri:this.amsDocumentId?r.getLegacyDocumentUrl(this.amsDocumentId):M.default.escapeXml(this.localUri),url_thumbnail:this.amsDocumentId?r.getLegacyDisplayUrl(this.amsDocumentId,this.uploadType):this.localThumbnailUrl&&M.default.escapeXml(this.localThumbnailUrl),url_azurems:this.azureMSUrl&&M.default.escapeXml(this.azureMSUrl),type:t+".1"+(s?"/"+s+".1":""),doc_id:this.amsDocumentId,duration_ms:this.audioMessageDurationMs};this.dimensions&&(o.width=this.dimensions.width.toString(),o.height=this.dimensions.height.toString());const n=this.filename&&M.default.escapeXml(this.filename),a=[g.PlainTextNode.fromPlainText(e),g.LinkNode.parseFromHref(this.fallbackUrl),g.UnknownNode.parse([],{v:n},"OriginalName"),g.UnknownNode.parse([],{v:this.fileSize},"FileSize")];this.uploadType!==b.UploadFileType.Picture||i.isEmpty(n)||a.push(g.MetaNode.parse([],{type:"photo",originalName:n},"meta",void 0));return g.UriObjectNode.parseFromSanitizedParts(a,o,this.localUri,this.localThumbnailUrl,this.azureMSUrl,void 0)}renderReact(e,t){return o.createElement(o.Text,{style:i.compact([e.defaultStyle,e.emoticonAndFlagStyle]),key:t,textBreakStrategy:"simple"},this.children[0])}};t.MediaAlbumEntity=class extends I{constructor(e){super([""]),this.albumId=e}text(){return""}decode(){let e={albumId:this.albumId};return g.MediaAlbumNode.parse([],e)}};class k extends I{constructor(e,t,s,i,o){super(o?[o]:[k.DEFAULT_FALLBACK_URI]),this.conversationId=e,this.skipSanitization=t,this.title=s,this.url_thumbnail=k.DEFAULT_THUMBNAIL_URI,this.fallbackUrl=k.DEFAULT_FALLBACK_URI,i&&(this.url_thumbnail=i),o&&(this.fallbackUrl=o)}text(){return this.children[0]}decode(){const e=p.getString("InputEntity.SwiftFallbackText"),t={type:"SWIFT.1",uri:void 0,url_thumbnail:M.default.escapeXml(this.url_thumbnail)},s=[g.PlainTextNode.fromPlainText(e),g.LinkNode.parseFromHref(this.fallbackUrl),g.UnknownNode.parse([g.PlainTextNode.fromPlainText(this.title)],{},"Title")],i=this._getCardNode();i&&s.push(i);return g.UriObjectNode.parseFromSanitizedParts(s,t,void 0,this.url_thumbnail,void 0,void 0)}renderReact(e,t){return null}}k.DEFAULT_THUMBNAIL_URI="https://urlp.asm.skype.com/v1/url/content?url=https://neu1-urlp.secure.skypeassets.com/static/card-128x128.png",k.DEFAULT_FALLBACK_URI="https://go.skype.com/cards.unsupported";t.SwiftUriObjectEntity=class extends k{constructor(e,t,s,i,o,n){super(t,s,i,o,n),this.swiftMessage=e}_getCardNode(){return g.SwiftNode.parseSwift(this.swiftMessage,this.conversationId,void 0,this.skipSanitization)}};class A extends I{constructor(e,t,s,i="",o,r){super([i]),this._scheduledCallId=e,this._datetimeMs=t,this._reminder=s,this._subject=i,this._canceledTimeMs=o,this._editedTimeMs=r,this._fallbackMessage=p.getString("InputEntity.CallInviteFallbackText"),this._fallbackUrl=n.default.getS4LCMCFeaturesNoSubscription().scheduledCallNotSupportedFallbackUrl}static fromScheduledCall(e){return new A(e.id,e.datetimeMs.toString(),e.reminder.toString(),e.subject,e.canceledTimeMs&&e.canceledTimeMs.toString()||void 0,e.editedTimeMs&&e.editedTimeMs.toString()||void 0)}text(e){return this._subject}decode(){const e=[g.PlainTextNode.fromPlainText(this._fallbackMessage),g.LinkNode.parseFromHref(this._fallbackUrl)];let t={type:y.ScheduleCallMessageNodeName,scheduledCallId:this._scheduledCallId,datetimeMs:this._datetimeMs,reminder:this._reminder,subject:this._subject,canceledTimeMs:this._canceledTimeMs,editedTimeMs:this._editedTimeMs};return g.UriObjectNode.parseFromSanitizedParts(e,t,void 0,void 0,void 0,void 0)}}t.ScheduledCallInviteUriObjectEntity=A;t.PollInputEntity=class extends I{constructor(e,t,s,i){super([e]),this._title=e,this._expirationDate=t,this._options=s,this._allowMultupleVotes=i}text(){return this._title}decode(){const e=[];this._title&&e.push(g.PlainTextNode.fromPlainText(this._title));const t={type:f.PollCardNodeName,title:this._title,expirationTimeMs:this._expirationDate,optionsEncoded:S.encodePollOptions(this._options),allowMultipleVotes:this._allowMultupleVotes?"true":"false"};return g.UriObjectNode.parseFromSanitizedParts(e,t,void 0,void 0,void 0,void 0)}};t.AdaptiveUriObjectEntity=class extends k{constructor(e,t,s,i,o,n){super(t,s,i,o,n),this.adaptiveMessage=e}_getCardNode(){return g.AdaptiveCardNode.parseAdaptiveCard(this.adaptiveMessage,this.conversationId,void 0)}};t.GeoLocationEntity=class extends I{constructor(e,t,s,i,o,n,r,a,l,d,c,h,u,p,g,m=[]){super(m),this.isUserLocation=e,this.userMri=t,this.latitude=s,this.longitude=i,this.accuracy=o,this.timestamp=n,this.timezone=r,this.altitude=a,this.locale=l,this.language=d,this.address=c,this.name=h,this.img=u,this.addressFriendlyName=p,this.shortAddress=g}text(){return""}decode(){let e={isUserLocation:this.isUserLocation?"1":"0",latitude:i.isFinite(this.latitude)?Math.round(1e6*this.latitude):void 0,longitude:i.isFinite(this.longitude)?Math.round(1e6*this.longitude):void 0,horizontalAccuracy:i.isFinite(this.accuracy)?this.accuracy:void 0,verticalAccuracy:i.isFinite(this.accuracy)?this.accuracy:void 0,timeStamp:i.isFinite(this.timestamp)?this.timestamp:void 0,altitude:i.isFinite(this.altitude)?Math.round(100*this.altitude):void 0,timezone:i.isNil(this.timezone)?void 0:M.default.escapeXml(this.timezone),locale:i.isNil(this.locale)?void 0:M.default.escapeXml(this.locale),language:i.isNil(this.language)?void 0:M.default.escapeXml(this.language),name:i.isNil(this.name)?void 0:M.default.escapeXml(this.name),address:i.isNil(this.address)?"":M.default.escapeXml(this.address),img:i.isNil(this.img)?void 0:M.default.escapeXml(this.img),addressFriendlyName:i.isNil(this.addressFriendlyName)?"":M.default.escapeXml(this.addressFriendlyName),shortAddress:i.isNil(this.shortAddress)?"":M.default.escapeXml(this.shortAddress),userMri:i.isNil(this.userMri)?void 0:M.default.escapeXml(this.userMri)};const t=i.map(this.children,(e=>e.decode()));return g.LocationNode.parse(t,e)}renderReact(e,t){return null}};t.SwiftEntity=class extends I{constructor(e,t,s,i=!1){if(super([""]),this.swift=e,this.conversationId=t,this._skipSanitization=i,this._b64="",s)this._b64=s;else{const e=JSON.stringify(this.swift);this._b64=l.btoaUtf8(e)}}text(){return this.children[0]}decode(){return this._decoded||(this._decoded=g.SwiftNode.parseSwift(this.swift,this.conversationId,this._b64,this._skipSanitization)),this._decoded}renderReact(e,t){return null}};t.CallReactionMetadataEntity=class extends I{constructor(e,t=b.ReactionsTextStyle.Default,s=b.ReactionsTextType.Default,i){super([""]),this.id=e,this.style=t,this.internalType=s,this.userMri=i}text(){return""}decode(){return g.UnknownNode.parse([],{id:M.default.escapeXml(this.id),style:this.style,internalType:this.internalType,userMri:this.userMri?M.default.escapeXml(this.userMri):""},"c_i")}renderReact(e,t){return null}};t.CallInfoEntity=class extends I{constructor(e,t,s,i,o,n){super([""]),this.callId=e,this.threadId=t,this.isCast=s,this.timestamp=i,this.label=o,this.locationName=n}text(){return""}decode(){const e=(this.isCast,p.getString("InputEntity.CallMessageFallback"));return g.CallInfoUriObjectNode.parse([g.PlainTextNode.fromPlainText(e)],{uri:void 0,url_thumbnail:void 0,type:"Cast.1",callId:this.callId,threadId:this.threadId,containerType:this.isCast?"Cast":"Call",timestamp:this.timestamp.toString(),label:this.label&&M.default.escapeXml(this.label),locationName:this.locationName&&M.default.escapeXml(this.locationName)})}renderReact(e,t){return null}};t.PartListEntity=class extends I{constructor(e,t,s,i){super(s),this.callId=e,this.type=t,this.alt=i}text(){return""}decode(){let e={callId:this.callId?this.callId:"",type:this.type,alt:this.alt?M.default.escapeXml(this.alt):""};return g.PartListNode.parse(this.children,e)||g.UnknownNode.parse([],e,"PartList")}};t.ContextEntity=class extends I{constructor(e){super([]),this.attributes=e}text(e){return""}decode(){return g.ContextNode.parse([],this.attributes)}renderReact(e,t){return null}};t.DataEntity=class extends I{constructor(e,t,s,i){super(s),this.type=e,this.content=t,this.alt=i}text(){return""}decode(){let e={content:this.content||"",type:this.type,alt:this.alt?M.default.escapeXml(this.alt):""};return g.DataNode.parse(e)||g.UnknownNode.parse([],e,"Data")}};t.TranslationSettingsEntity=class extends I{constructor(e,t,s,i){super(s),this.type=e,this.content=t,this.alt=i}text(){return""}decode(){let e={content:this.content||"",type:this.type,alt:this.alt?M.default.escapeXml(this.alt):""};return g.TranslationSettingsNode.parse(e)||g.UnknownNode.parse([],e,"Data")}};t.GuestNameUpdateEntity=class extends I{constructor(e){super(e)}text(){return""}decode(){return g.GuestUpdateNode.parse(this.children,{},"GuestNameUpdate",void 0)}}},23944:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.applyEditableContentToInputEntities=t.getEditableEntityFromInputEntity=t.getEditableContentFromInputEntities=t.getTextForSms=t.getRawText=t.encodeRawText=t.convertRawTextToInputEntities=t.decodeFromInput=t.test_handleEntities=t.renderReact=t.encode=t.handleLinks=t.hasOnlyEmoticonsOrWhitespaceText=t.handleEmoticons=t.handleSuggestedTextHighlights=void 0;const i=s(96486),o=s(79737),n=s(89391),r=s(81169),a=s(86374),l=s(82433),d=s(32183),c=s(97174),h=s(26424),u=s(26712),p=s(6509),g=s(33754),m=/\b(?:www\.|https?\:\/\/)[A-Z\u00a1-\uffff0-9-_.~!*'();:@&+$%,/?#[\]{|}<=>^]+/gi,S=/\b\S+@\S+\.[a-z]+/gi,f=/\bskype:(?:[^\W\s]|\.|\+|-|\:|\;)+?(?:[^\s\n\#\[\]]*)/gi,y=/\S+/g,_=".,!?:;\"'",v=/\[.*?\]\(\b(?:www\.|https?\:\/\/)[A-Z\u00a1-\uffff0-9-_.~!*'();:@&+$%,/?#[\]{|}<=>^]+?\)/gi,C=/^\b$/;function b(e,t,s){let o=[];return i.each(e,(e=>{if(!(e instanceof c.UnhandledEntity))return void o.push(e);const n=e.text();i.last(o)instanceof c.UnhandledEntity||o.push(new c.UnhandledEntity);let r,a=0;for(;r=t.exec(n);){if(r.index!==a){const e=n.substring(a,r.index);i.last(o).appendText(e)}const e=s(...r),t=i.isArray(e)?e:[e];if(i.head(t)instanceof c.UnhandledEntity){const e=t.shift();i.last(o).appendText(e.text())}o=o.concat(t),i.last(o)instanceof c.UnhandledEntity||o.push(new c.UnhandledEntity),a=r.index+r[0].length}if(a<n.length){const e=n.substr(a);i.last(o).appendText(e)}i.last(o).text()||o.pop()})),o}function T(e,t=0,s=e.length){const i=[];let o=s;for(let n=s-1;n>=t;--n){let t=e.substring(n,o);if(l.default.isEmoticon(t)){for(;n>0;){const s=e.substring(n-1,o);if(!l.default.isEmoticon(s))break;n--,t=e.substring(n,o)}let s=d.getEmoticonTone(t),r=d.getSanitizedEmoticonName(t);i.push(new c.EmoticonEntity(r,l.default.getEmoticonByShortcut(t).id,s)),o=n}else if("("===t[0]){const e=t.match(/^\(flag:(..)\)$/i);if(e){const s=e[1].toLowerCase();l.default.hasCountry(s)&&(i.push(new c.FlagEntity(t,s)),o=n)}}}return i.length?(0!==o&&i.push(new c.UnhandledEntity(e.substring(t,o))),i.reverse()):null}function M(e){for(let t=e.length;t>0;t--){const s=T(e,0,t);if(s)return t!==e.length&&s.push(new c.UnhandledEntity(e.substr(t))),1===s.length?s[0]:s;const i=e[t-1];if(-1===_.indexOf(i))break}return new c.UnhandledEntity(e)}function I(e){return b(e,y,M)}function w(e){let t=e;const s=-1===_.indexOf(i.last(t))?t.length:t.length-1;let o=s;for(;o>=0&&-1!==")>}".indexOf(t[o-1]);o--);if(o<s){const e=function(e,t){const s=i.mapValues(i.groupBy(t),i.constant(0));for(let t=0;t<e.length;t++){const i=e[t];s.hasOwnProperty(i)&&s[i]++}return s}(t.substring(0,o),"()<>{}"),n={")":e["("]-e[")"],">":e["<"]-e[">"],"}":e["{"]-e["}"]};for(;o<s;o++){const e=t[o];if(!(n.hasOwnProperty(e)&&n[e]>0))break;--n[e]}}let n="";o!==t.length&&(n=t.substr(o),t=t.substr(0,o));const r=u.default.createSanitizedHref(t);if(r){const e=new c.LinkEntity(r.text,r.href);return r.trailingCharacters||n?[e,new c.UnhandledEntity(n+(r.trailingCharacters||""))]:e}return new c.UnhandledEntity(e)}function P(e){const t=new c.UnhandledEntity(e),s=b([t],m,w),i=b(s,y,M),o=i[1],n=i[0];let r,a=n.text().trim();const l=g.getString("MessageComposer.DraftDecorator"),d=a.startsWith(l);return d&&(a=a.slice(l.length)),r=a.substring(1,a.length-2).trim(),d&&(r=l.concat(r)),o&&o.href&&n&&r.length>0?new c.LinkEntity(r,o.href):t}function k(e){let t=e;if(n.default.getS4LMessagingFeaturesNoSubscription().enableHandlingHyperlinkOnPaste){t=b(t,v,P)}const s=b(t,m,w),i=b(s,S,w);return b(i,f,w)}function A(e,t,s){return R(e,t,s,!1).encodeToString()}function E(e,t,s){const i=p.splitWikiMarkupPrefix(e,t,s);let o=i.prefix;t&&s||t?o=p.WikiPrefix.DoNotFormat:s&&(o=p.WikiPrefix.OnlyFormatLinks);const n=o!==p.WikiPrefix.DoNotFormat&&o!==p.WikiPrefix.OnlyFormatLinks?I(i.entities):i.entities,r=o===p.WikiPrefix.None?(a=n,p.encodeWikiMarkupWithoutPrefix(a)):n;var a;return o===p.WikiPrefix.DoNotFormat?[new c.DoNotFormatEntity(A(r,!0,!1))]:k(r)}function R(e,t,s,o){if(!e.length)return a.Parser.root([a.Parser.parseXmlText("")]);let n=e;t||(n=E(e,s,o));const r=i.map(n,(e=>e.decode()));return a.Parser.root(r)}function L(e,t,s){return E([new c.UnhandledEntity(e)],t,s)}function F(e,t={}){return(0,r.chain)(e,(0,r.drop)(t.startIndex||0),(0,r.map)((e=>e.text(t))),(0,r.join)(""))}function x(e,t,s){if(e instanceof c.AtMentionEntity){const t=e;return{type:o.EditableEntityType.AtMention,originId:s,displayText:t.text(),userMri:t.userMri,shortName:t.shortName||"",displayName:t.displayName||""}}if(e instanceof c.CommandEntity){const t=e;return{type:o.EditableEntityType.SlashCommand,originId:s,displayText:t.text().trim(),commandName:t.commandName,usageHint:t.usageHint,description:t.description}}if(e instanceof c.EmoteEntity){const t=e;return{type:o.EditableEntityType.Agnostic,originId:s,displayText:t.fallbackText||"?",position:o.AgnosticContentPosition.Leading}}if(e instanceof c.EmoticonEntity){const i=e,n=i.defaultToneText().toLowerCase(),r=t[d.getSanitizedEmoticonName(n)],a=r?d.getEmoticonUrl(r.id,h.EmoticonSize.Small,!0,e.tone,r.etag):void 0;return{type:o.EditableEntityType.Emoticon,originId:s,tone:i.tone,displayText:i.text(),emoticonName:i.emoticonName,url:a}}if(e instanceof c.LinkEntity){const t=e;if(n.default.getS4LMessagingFeaturesNoSubscription().enableHandlingHyperlinkOnPaste&&t.text()!==t.href&&!u.default.isUrlValid(t.text())){return{type:o.EditableEntityType.PlainText,originId:s,displayText:`[${t.text()}](${t.href})`}}return{type:o.EditableEntityType.Link,originId:s,displayText:t.text(),href:t.href}}if(e instanceof c.QuoteEntity){return{type:o.EditableEntityType.Agnostic,originId:s,displayText:e.text(),position:o.AgnosticContentPosition.Leading}}if(e instanceof c.UnhandledEntity){const t=e;return{type:o.EditableEntityType.PlainText,displayText:t.text(),originId:s}}if(e instanceof c.WikiMarkupEntity){const t=e;return{type:o.EditableEntityType.PlainText,displayText:t.text(),originId:s}}return{type:o.EditableEntityType.Agnostic,originId:s,displayText:e.text()||"?",position:o.AgnosticContentPosition.InPlaceWithTextStream}}t.handleSuggestedTextHighlights=function(e,t){const s=i.compact(i.map(t,(e=>e.phrase)));if(i.isEmpty(s))return e;const o=function(e){if(e.length>0){const t="("+i.map(e,(e=>i.escapeRegExp(e))).join("|")+")";return new RegExp(t,"g")}return C}(s);return b(e,o,(e=>{const s=i.find(t,(t=>t.phrase===e));return s?new c.SuggestedTextHighlightEntity(s.phrase,s.activityId,s.actionsIndexes):new c.UnhandledEntity(e)}))},t.handleEmoticons=I,t.hasOnlyEmoticonsOrWhitespaceText=function(e){return R(L(e.smsContentUnescaped,!1,!0),!1,!1,!0).hasOnlyEmoticonsOrWhitespaceText()},t.handleLinks=k,t.encode=A,t.renderReact=function(e,t){return e.map(((e,s)=>e.renderReact(t,s)))},t.test_handleEntities=function(e,t,s){return E(e,t,s)},t.decodeFromInput=R,t.convertRawTextToInputEntities=L,t.encodeRawText=function(e){return A(L(e,!1,!1),!1,!1)},t.getRawText=F,t.getTextForSms=function(e){const t=i.find(e,(e=>e instanceof c.QuoteEntity)),s=F(e);return t?(t.textForSMS()||"")+s:s},t.getEditableContentFromInputEntities=function(e,t,s){return{entities:e.map(((e,t)=>x(e,s,t))),downStreamDataVersion:t}},t.getEditableEntityFromInputEntity=x,t.applyEditableContentToInputEntities=function(e,t){const s=[];return i.each(e.entities,(e=>{let i;switch(e.type){case o.EditableEntityType.Agnostic:{const s=e;void 0!==s.originId&&s.originId<t.length&&(i=t[s.originId]);break}case o.EditableEntityType.AtMention:{const t=e;i=new c.AtMentionEntity(t.displayText,t.userMri,t.shortName,t.displayName);break}case o.EditableEntityType.Emoticon:{const t=e;i=new c.EmoticonEntity(t.displayText,t.emoticonName,t.tone);break}case o.EditableEntityType.Link:{const t=e;i=new c.LinkEntity(t.displayText,t.href);break}case o.EditableEntityType.PlainText:{const t=e;i=new c.UnhandledEntity(t.displayText);break}case o.EditableEntityType.SlashCommand:{const t=e;i=new c.CommandEntity(t.displayText,t.commandName,t.usageHint,t.description);break}}i&&s.push(i)})),s}},12762:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MojiNode=t.MediaAlbumNode=t.AudioMessageNode=t.AudioNode=t.VideoMessageNode=t.VideoNode=t.PictureNode=t.DisplayableMediaWithThumbnail=t.DisplayableMedia=t.UriObjectFileNode=t.ScheduledCallInviteNode=t.AdaptiveCardNode=t.SwiftNode=t.SwiftUriObjectNode=t.UriObjectNode=t.FilesNode=t.FileNode=t.MetaNode=t.LocationNode=t.MmsNode=t.SmsNode=t.ContactsNode=t.ContactNode=t.TargetsNode=t.TargetRoleNode=t.TargetLegacyUserNode=t.TargetUserNode=t.TargetNode=t.TextWrapperNode=t.CallerIDNode=t.ContextNode=t.SuggestedTextHighlightNode=t.EmoteNode=t.LinkNode=t.WikiMarkupNode=t.LegacyQuoteNode=t.HighlightedNode=t.QuoteNode=t.FlagNode=t.EmoticonNode=t.UnicodeEmojiNode=t.UserMriNode=t.AtMentionNode=t.EditMessageMetaDataNode=t.HtmlNode=t.PlainTextNode=t.UnknownNode=t.RootNode=t.InternalNode=t.init=void 0,t.GuestUpdateNode=t.GuestUpdateTargetNode=t.TranslationNode=t.TranslationSettingsNode=t.DataNode=t.PollNode=t.NgcUpgradeSystemMessageNode=t.CallReactionMetadataNode=t.CallInfoUriObjectNode=t.EndedNode=t.PartListNode=t.PartNode=t.LegacyMemberUpgradedNode=t.LegacyMemberAddedNode=t.JoiningEnabledUpdateNode=t.HistoryDisclosedUpdateNode=t.PictureUpdateNode=t.HandshakeRejectNode=t.HandshakeCompleteNode=t.HandshakeAcceptNode=t.HandshakeInviteNode=t.TopicUpdateNode=t.RoleUpdateNode=t.DeleteMemberNode=t.AddMemberNode=t.ThreadActivity=t.SkypeVideoMessageNode=t.StickerNode=void 0;const i=s(23719),o=s(96486),n=s(12852),r=s(81394),a=s(89391),l=s(65976),d=s(81169),c=s(51077),h=s(71830),u=s(40276),p=s(86374),g=s(79662),m=s(70891),S=s(46096),f=s(70004),y=s(50066),_=s(57199),v=s(36237),C=s(33754),b=s(65047),T=s(18078),M=s(95868),I=s(26424),w=s(71669),P=s(49130),k=s(79829),A=s(4057),E=s(67384),R=s(78262),L=s(61694),F=s(26712),x=s(53374),O=/content-type=\".*?\"/g;class D{static registerForXml(e,t){return D._XmlParsers[e]=t,e}static registerForXmlWithMessageTypes(e,t,...s){return D._XmlParsers[e]=(e,i,n,r)=>r&&r.messagetype&&o.some(s)&&!o.includes(s,r.messagetype)?void 0:t(e,i,n,r),e}static registerForJson(e,t){return D._JsonParsers[e]=t,"_"+e}static registerInvalid(e){return D._InvalidParsers[e]=!0,e}static getXmlParser(e){return D._XmlParsers.hasOwnProperty(e)?D._XmlParsers[e]:void 0}static getJsonParser(e){return D._JsonParsers.hasOwnProperty(e)?D._JsonParsers[e]:void 0}static isInvalidParser(e){return!!D._InvalidParsers[e]}}D._XmlParsers={},D._JsonParsers={},D._InvalidParsers={};const B=new class{parse(e,t,s,i){D.isInvalidParser(s)&&v.warn(S.LogTraceArea.GenericUnsafe,"Trying to decode an invalid tag",s);const o=D.getXmlParser(s);return o?o(e,t,s,i):void 0}parseXmlText(e){return z.fromEscapedXml(e)}parseFromMessageType(e,t,s){const i=D.getJsonParser(t);return i?i(e,s):void 0}parseUnknown(e,t,s,i){return U.parse(e,t,s,i)}root(e,t=!1){return new N(e,t)}emote(e,t,s){const i=x.default.escapeXml(t),n=x.default.escapeXml(s),r=o.clone(e.children);return r.unshift(new te(i,n)),B.root(r,e.parsingFailed())}};t.init=function(){p.registerParser(B)};class V{constructor(e,t){this.children=e,this._tag=t}getTag(){return this._tag}getMessageTypes(){return V._messageTypes}cloneWithChildren(e){const t=this.getTag(),s=D.getXmlParser(t);return s&&s(e,this.encodedAttr(),this.getTag(),void 0)}encode(){return this._encodeParts(this._encodeChildren(),o.mapValues(this.encodedAttr(),(e=>o.isString(e)||o.isNull(e)||o.isUndefined(e)?e:e.toString())),this.getTag())}encodeToString(){const e=this.encode();return o.isArray(e)?o.flattenDeep(e).join(""):e||""}encodedAttr(){return{}}isEmptyTextNodeOrContainingWhitespacesOnly(){return!1}isEmptyTextNodeOrContainingSpaceCharsOnly(){return!1}getUriObjectNode(e){}_encodeParts(e,t,s,i=!1){if(s){const n=o.map(t,((e,t)=>o.isUndefined(e)||o.isNull(e)?void 0:t+'="'+e+'"')),r=o.compact(n).join(" "),a="<"+s+(r?" "+r:"");return i&&o.isEmpty(e)?[a+"/>"]:[a+">",e,"</"+s+">"]}return e}_encodeChildren(e=!1){const t=o.map(this.children,(e=>e&&e.encode())),s=o.first(t);return e&&1===t.length&&s?s:t}}t.InternalNode=V,V._messageTypes=[];class N extends V{constructor(e,t=!1){super(e,N._defaultTag),this._parsingFailed=t}parsingFailed(){return this._parsingFailed}accept(e){return e.transformRootNode(this)}encode(){return this._encodeChildren(!0)}isEmptyTextNodeOrContainingWhitespacesOnly(){return o.every(this.children,(e=>!!e&&e.isEmptyTextNodeOrContainingWhitespacesOnly()))}isEmptyTextNodeOrContainingSpaceCharsOnly(){return o.every(this.children,(e=>!!e&&e.isEmptyTextNodeOrContainingSpaceCharsOnly()))}hasOnlyEmoticonsOrSpaceChars(){return o.every(this.children,(e=>e instanceof Q||!!e&&e.isEmptyTextNodeOrContainingSpaceCharsOnly()))}hasOnlyEmoticonsOrWhitespaceText(){return o.every(this.children,(e=>e instanceof Q||!!e&&e.isEmptyTextNodeOrContainingWhitespacesOnly()))}hasOnlyUnicodeEmoji(){return o.every(this.children,(e=>e instanceof q||!!e&&e.isEmptyTextNodeOrContainingWhitespacesOnly()))}getNumberOfEmoticons(){return o.size(o.filter(this.children,(e=>e instanceof Q)))}getNumberOfDiverseEmoticons(){const e=o.filter(this.children,(e=>e instanceof Q));return o.size(o.filter(e,(e=>e.tone&&e.tone!==I.DefaultDiverseTone)))}getNumberOfUnicodeEmoji(){return o.size(o.filter(this.children,(e=>e instanceof q)))}getNumberOfDirectMentions(){return o.size(o.filter(this.children,(e=>e instanceof G&&x.default.unescapeXml(e.id)!==G.AllMentionId)))}hasAllMention(){return o.some(this.children,(e=>e instanceof G&&x.default.unescapeXml(e.id)===G.AllMentionId))}getLinkNodeChildren(){return o.filter(this.children,(e=>e instanceof ee))}getNumberOfWebLinks(){return o.size(o.filter(this.getLinkNodeChildren(),(e=>e.getUrlType()===L.UrlType.Web)))}hasOnlyWebLinks(){return o.every(this.children,(e=>e instanceof ee&&e.getUrlType()===L.UrlType.Web))}getWebLinks(){return(0,d.chain)(this.getLinkNodeChildren(),(0,d.filter)((e=>e.getUrlType()===L.UrlType.Web)),(0,d.map)((e=>e.getSanitizedHref())))}hasOnlyQuotedContent(){return o.every(this.children,(e=>e instanceof $||!!e&&e.isEmptyTextNodeOrContainingWhitespacesOnly()))}getFirstUriObjectChild(e){let t;return o.each(this.children,(s=>(t=s&&s.getUriObjectNode(e),!t))),t}getFirstContactNode(){let e;return o.each(this.children,(t=>(t instanceof ye&&t.children.length&&(e=t.children[0]),!e))),e}getQuoteNodes(){let e=[];return o.each(this.children,(t=>{t instanceof $&&e.push(t)})),e}hasWikiMarkup(){return o.some(this.children,(e=>e instanceof Z))}hasHtmlContent(){return o.some(this.children,(e=>e instanceof W))||o.some(this.getQuoteNodes(),(e=>o.some(e.children,(e=>e instanceof W))))}isOnlyHyperLink(){var e,t;const s=this.children&&this.children[0];if(s&&1===(null===(e=s.children)||void 0===e?void 0:e.length)&&s instanceof ee){return s.getSanitizedHref()!==(s.children[0]instanceof z&&(null===(t=s.children[0])||void 0===t?void 0:t.getEscapedText()))}return!1}static parse(e,t={}){if(o.isEmpty(t))return new N(e,o.some(e,(e=>!e)));v.warn(S.LogTraceArea.GenericUnsafe,"Parsed RootNode has unknown attributes",t)}}t.RootNode=N,N._defaultTag=D.registerForXml(m.rootTagName,N.parse);class U extends V{constructor(e,t,s,i){super(e,s),this.attributes=t,this.item=i}cloneWithChildren(e){return U.parse(e,this.encodedAttr(),this.getTag(),void 0)}accept(e){return e.transformUnknownNode(this)}encodedAttr(){return this.attributes}static parse(e,t,s,i){return new U(e,t,s,i)}}t.UnknownNode=U,U._defaultTag=D.registerInvalid("");class H extends V{static register(e,t){return D.registerForXmlWithMessageTypes(e,t,c.MessageTypes.RichText)}accept(e){throw"Must override"}}class z extends H{constructor(e,t,s){super([],e),this._escapedText=t,this._text=s}getRawText(){return void 0===this._text&&(this._text=x.default.unescapeXml(this._escapedText)),this._text}getEscapedText(){return void 0===this._escapedText&&(this._escapedText=x.default.escapeXml(this._text)),this._escapedText}static merge(e){const t=o.map(e,(e=>e.encode())).join("");return z.fromEscapedXml(t)}cloneWithChildren(e){return z.fromEscapedXml(this.getEscapedText())}accept(e){return e.transformPlainTextNode(this)}encode(){return this.getTag()===z._lineBreakTag?"<br/>":this.getEscapedText()}isEmptyTextNodeOrContainingWhitespacesOnly(){return""===this.getEscapedText().trim()}isEmptyTextNodeOrContainingSpaceCharsOnly(){return""===this.getEscapedText().replace(/ /g,"")}static parse(e,t,s){if(s===z._lineBreakTag)return new z(z._lineBreakTag,void 0,"\n")}static fromPlainText(e){return new z(z._defaultTag,void 0,e)}static fromEscapedXml(e){return new z(z._defaultTag,e,void 0)}}t.PlainTextNode=z,z._defaultTag=D.registerInvalid("_text"),z._lineBreakTag=H.register("br",z.parse);class W extends H{constructor(e,t){super(e,W._defaultTag),this.children=e,this._dom=t,this._searchQuery="",this._isPrimarySearchResult=!1,this._isQuote=!1}cloneWithChildren(e){const t=new W(e,this._dom);return t._searchQuery=this._searchQuery,t._isPrimarySearchResult=this._isPrimarySearchResult,t._isQuote=this._isQuote,t}accept(e){return e.transformHtmlNode(this)}encode(){return i.DomUtils.getOuterHTML(this.getHtmlDom(),{decodeEntities:!1,xmlMode:!0})}getHtmlDom(){return this._dom.value}cloneAsSearchResult(e,t){const s=this.cloneWithChildren(this.children);return s._searchQuery=e,s._isPrimarySearchResult=t,s}cloneAsQuote(){const e=this.cloneWithChildren(this.children);return e._isQuote=!0,e}getSearchQuery(){return this._searchQuery}isPrimarySearchResult(){return this._isPrimarySearchResult}isQuote(){return this._isQuote}static parse(e,t){let s;const n=new i.DomHandler(((e,t)=>{e?v.warn(S.LogTraceArea.GenericUnsafe,"HtmlNode failed to parse HTML"):s=t})),r=new i.Parser(n,{decodeEntities:!1,xmlMode:!0});r.write(y.default.sanitizeHtml(e)),r.end();let a=[];if(t){const e=c.getTeamsFileProperties(t.properties);o.each(e,(e=>{const t=e.fileInfo&&(e.fileInfo.shareUrl||e.fileInfo.fileUrl);if(t){const s=F.default.createSanitizedHref(t);if(s&&s.href){o.isEmpty(a)||a.push(z.fromPlainText("\n"));const i=e.fileName||s.href,n=z.fromPlainText(i);a.push(new ee([n],t,s.href,s.urlType))}}}))}return s?new W(a,new _.default(s)):void 0}}t.HtmlNode=W,W._defaultTag=D.registerForJson(c.MessageTypes.TeamsHtml,W.parse);class j extends H{constructor(e,t,s,i){super([],j._defaultTag),this.fallbackSkypeId=e,this.originalArrivalTime=t,this.originalArrivalTimeSeconds=s,this.messageTypeEnum=i}accept(e){return e.transformEditMessageMetaDataNode(this)}encodedAttr(){return{a:this.fallbackSkypeId,ts_ms:this.originalArrivalTime,ts:this.originalArrivalTimeSeconds,t:this.messageTypeEnum}}isEmptyTextNodeOrContainingWhitespacesOnly(){return!0}isEmptyTextNodeOrContainingSpaceCharsOnly(){return!0}static parse(e,t){const s=t.a&&o.isString(t.a)&&x.default.unescapeXml(t.a),i=t.ts_ms?parseInt(t.ts_ms,10):void 0,n=t.ts?parseInt(t.ts,10):void 0,r=t.t&&parseInt(t.t,10);if((n||i)&&s&&r===j.ExpectedT)return new j(s,i,n,r)}}t.EditMessageMetaDataNode=j,j.ExpectedT=61,j._defaultTag=H.register("e_m",j.parse);class G extends H{constructor(e,t,s,i){super(e,G._defaultTag),this.children=e,this.id=t,this.isLegacyAtMention=s,this.itemid=i}accept(e){return e.transformAtMentionNode(this)}encodedAttr(){return{id:this.id,itemid:this.itemid}}isAllMention(){return!!a.default.getS4LMessagingFeaturesNoSubscription().enableTranslatedAllMentions&&(this.id===G.AllMentionId||this.id===G.AllMentionIdNonAlerting)}isInQuote(){return this.id===G.DirectMentionIdNonAlerting||this.id===G.AllMentionIdNonAlerting}getLocalizedAllMention(){return C.getString("MessageComposer.QouteAll")}static transformToNonAlertingNode(e){let t=G.DirectMentionIdNonAlerting;return a.default.getS4LMessagingFeaturesNoSubscription().enableTranslatedAllMentions&&(t=e.isAllMention()?G.AllMentionIdNonAlerting:G.DirectMentionIdNonAlerting),new G(e.children,t,e.isLegacyAtMention,void 0)}static parse(e,t){if(!e||!t.id)return;let s=!1;if(o.every(e,(e=>e instanceof z))){s="@"===z.merge(e).getRawText()[0]}return new G(e,t.id,s,t.itemid)}}t.AtMentionNode=G,G.AllMentionId="*",G.AllMentionIdNonAlerting="_*_",G.DirectMentionIdNonAlerting=" ",G._defaultTag=H.register("at",G.parse);class K extends H{constructor(e,t){super([e],K._defaultTag),this.textNode=e,this.mri=t}accept(e){return e.transformUserMriNode(this)}encodedAttr(){return{mri:this.mri}}static parse(e,t){const s=re(e);if(s&&t.mri)return new K(s,t.mri)}}t.UserMriNode=K,K._defaultTag=H.register("usermri",K.parse);class q extends H{constructor(e){super([e],q._defaultTag),this.emojiTextNode=e}accept(e){return e.transformUnicodeEmojiNode(this)}static parse(e){const t=re(e);if(t)return new q(t)}static fromPlainText(e){return new q(z.fromPlainText(e))}}t.UnicodeEmojiNode=q,q._defaultTag=H.register("_emoji",q.parse);class Q extends H{constructor(e,t,s){super([e],Q._defaultTag),this.type=t,this.tone=s}accept(e){return e.transformEmoticonNode(this)}encodedAttr(){return this.tone?{type:this.type,tone:this.tone}:{type:this.type}}static parse(e,t){const s=re(e);if(s&&t.type){let e=t.tone?M.default.getItemToneFromString(t.tone):void 0;return new Q(s,t.type,e)}}}t.EmoticonNode=Q,Q._defaultTag=D.registerForXml("ss",Q.parse);class X extends H{constructor(e,t){super([e],X._defaultTag),this.country=t}accept(e){return e.transformFlagNode(this)}encodedAttr(){return{country:this.country}}static parse(e,t){const s=re(e);if(s&&t.country)return new X(s,t.country)}}t.FlagNode=X,X._defaultTag=D.registerForXml("flag",X.parse);class $ extends H{constructor(e,t,s,i,o,n,r){super(e,$._defaultTag),this.author=t,this.authorname=s,this.timestamp=i,this.conversation=o,this.messageid=n,this.cuid=r}getAuthorNameWithFallbackUnescaped(){return x.default.unescapeXml(this.authorname||this.author)}accept(e){return e.transformQuoteNode(this)}encodedAttr(){return{author:this.author,authorname:this.authorname,timestamp:this.timestamp,conversation:this.conversation,messageid:this.messageid,cuid:this.cuid}}static parse(e,t,s,i){const n=t.timestamp?parseInt(t.timestamp,10):void 0;if((t.author||t.authorname)&&o.isFinite(n)){const s=a.default.getS4LMessagingFeaturesNoSubscription().enableParsingHtmlMessages?o.map(e,(e=>{if(e&&"div"===e.getTag()){const t=W.parse(e.encodeToString(),i);return t?t.cloneAsQuote():void 0}return e})):e;return new $(s,t.author,t.authorname,n,t.conversation,t.messageid,t.cuid)}}}t.QuoteNode=$,$._defaultTag=D.registerForXmlWithMessageTypes("quote",$.parse,c.MessageTypes.RichText,c.MessageTypes.EncryptedText);class J extends H{constructor(e,t,s){super([e],J._defaultTag),this._isBackgroundTransparent=!!t,this._isOwnMessage=!!s}cloneWithChildren(e){return J.parse(e,this._isBackgroundTransparent,this._isOwnMessage,this.encodedAttr())}accept(e){return e.transformHighlightedNode(this,this._isBackgroundTransparent,this._isOwnMessage)}static fromPlainText(e,t,s){return new J(z.fromPlainText(e),t,s)}static parse(e,t,s,i){o.isEmpty(i)||v.warn(S.LogTraceArea.GenericUnsafe,"attributes ignored while creating HighlightNode");const n=o.first(e);if(n)return new J(n,t,s)}}t.HighlightedNode=J,J._defaultTag=D.registerInvalid("_highlighted");class Y extends H{constructor(e){super([e],Y._defaultTag)}accept(e){return e.transformLegacyQuoteNode(this)}static parse(e){if(o.every(e,(e=>e instanceof z))){const t=z.merge(e);return new Y(t)}}}t.LegacyQuoteNode=Y,Y._defaultTag=D.registerForXmlWithMessageTypes("legacyquote",Y.parse,c.MessageTypes.RichText,c.MessageTypes.EncryptedText);class Z extends H{constructor(e,t,s,i){super(e,t),this.rawPre=s,this.rawPost=i,this.rawPreNode=z.fromEscapedXml(s),i&&(this.rawPostNode=z.fromEscapedXml(i))}accept(e){return e.transformWikiMarkupNode(this)}encodedAttr(){return{raw_pre:this.rawPre,raw_post:this.rawPost}}static parse(e,t,s){const i=t.raw_pre||Z._tagToDefaultMarkup[s],n=(i||"").toLowerCase().trim(),r=t.raw_post||Z._preToPostDefaultMarkup[n];if(o.includes(Z._tags,s)&&i)return new Z(e,s,i,r)}}t.WikiMarkupNode=Z,Z._tagToDefaultMarkup={b:"*",i:"_",s:"~",pre:"```"},Z._preToPostDefaultMarkup={"*":"*",_:"_","~":"~","```":"```","{code}":"{code}","!!":void 0},Z._tags=o.map(o.keys(Z._tagToDefaultMarkup),(e=>D.registerForXml(e,Z.parse)));class ee extends H{constructor(e,t,s,i){super(e,ee._defaultTag),this._href=t,this._sanitizedHref=s,this._urlType=i}getSanitizedHref(){return this._sanitizedHref}getUrlType(){return this._urlType}accept(e){return e.transformLinkNode(this)}encodedAttr(){return{href:this._href}}static parse(e,t){if(t.href){const s=F.default.createSanitizedHref(x.default.unescapeXml(t.href));if(s&&s.href)return new ee(e,t.href,s.href,s.urlType)}}static parseFromHref(e){const t=x.default.escapeXml(e);return ee.parse([z.fromEscapedXml(t)],{href:t})}}t.LinkNode=ee,ee._defaultTag=D.registerForXml("a",ee.parse);class te extends H{constructor(e,t){super([],te._defaultTag),this.escapedAuthorMri=e,this.escapedFallbackText=t}cloneWithChildren(e){return new te(this.escapedAuthorMri,this.escapedFallbackText)}accept(e){return e.transformEmoteNode(this)}encode(){}isEmptyTextNodeOrContainingWhitespacesOnly(){return!1}isEmptyTextNodeOrContainingSpaceCharsOnly(){return!1}}t.EmoteNode=te,te._defaultTag=D.registerInvalid("_emote");class se extends H{constructor(e,t,s){super([e],se._defaultTag),this.textNode=e,this.activityId=t,this._actionsIndexes=s}getActionsIndexes(){return o.compact(o.map(this._actionsIndexes.split(";"),(e=>parseInt(e,10))))}getActivityId(){return this.activityId}getPhrase(){return this.textNode.getRawText()}accept(e){return e.transformSuggestedTextHighlightNode(this)}getAttr(){return{actionsIndex:this._actionsIndexes,activityId:this.activityId}}static parse(e,t){const s=re(e);if(s&&t.activityId)return new se(s,t.activityId,t.actionsIndex)}}t.SuggestedTextHighlightNode=se,se._defaultTag=H.register("highlightedEntity",se.parse);class ie extends H{constructor(e,t){super(e,ie._defaultTag),this._attributes=t}getContextForKey(e){const t=x.default.escapeXml(e),s=this._attributes[t];return s?x.default.unescapeXml(""+s):void 0}accept(e){return e.transformContextNode(this)}encodedAttr(){return this._attributes}isEmptyTextNodeOrContainingWhitespacesOnly(){return!0}isEmptyTextNodeOrContainingSpaceCharsOnly(){return!0}static parse(e,t){if(t)return new ie(e,t)}}t.ContextNode=ie,ie._defaultTag=H.register(g.contextTagName,ie.parse);class oe extends H{constructor(e){super([],oe._defaultTag),this.layoutOption=e}cloneWithChildren(){return new oe(this.layoutOption)}accept(e){return e.transformCallerIDNode(this)}encodedAttr(){return{layoutOption:this.layoutOption}}static parse(e,t){return new oe(t.layoutOption||"text")}}t.CallerIDNode=oe,oe._defaultTag=D.registerForXml("_callerid",oe.parse);class ne extends V{}function re(e,t=!1){if(1===e.length){const t=e[0];if(t instanceof z)return t}else{if(0===e.length&&t)return z.fromEscapedXml("");if(o.every(e,(e=>e instanceof z)))return z.merge(e)}}function ae(e,t){const s=e[t];if(s&&1===s.length)return s[0]}function le(e){const t=o.groupBy(e,(e=>e&&e.getTag())),s=ae(t,he.tags.EventTime),i=ae(t,he.tags.Initiator),n=function(e){const t=ae(e,m.multiTargetsTagName),s=e[m.targetTagName];return t&&s?s.concat(t.children):t?t.children:s&&s.length?s:void 0}(t);return s&&i&&n?[s,i,n]:void 0}function de(e){const t=o.groupBy(e,(e=>e&&e.getTag())),s=ae(t,he.tags.EventTime),i=ae(t,he.tags.Initiator),n=ae(t,he.tags.Value);return s&&i&&n?[s,i,n]:void 0}var ce;!function(e){e[e.None=0]="None",e[e.NonEmpty=1]="NonEmpty",e[e.Mri=2]="Mri",e[e.Number=3]="Number"}(ce||(ce={}));class he extends ne{constructor(e,t){super([e],t),this._rawText=e.getRawText()}getRawText(){return this._rawText}getMessageTypes(){return he._messageTypes}accept(e){return e.transformTextWrapperNode(this)}static parse(e,t,s){if(!he._tagChecks.hasOwnProperty(s)){const i=o.includes(he._registeredTags,s)?"unregistered (but known)":"unknown";return void v.warn(S.LogTraceArea.GenericUnsafe,"TextWrapperNode.parse called with "+i+" tag",e,t,s)}const i=he._tagChecks[s];let n=re(e,i.check===ce.None);if(n){switch(i.check){case ce.None:case ce.NonEmpty:break;case ce.Mri:const e=n.getRawText(),t=/^(\d+:[^;]+)/.exec(e),s=t&&t[1];if(!s||!h.isMri(s))return;e!==s&&(n=z.fromPlainText(s));break;case ce.Number:if(!o.isFinite(parseInt(n.getRawText(),10)))return}return new he(n,s)}}}t.TextWrapperNode=he,he._messageTypes=[c.MessageTypes.RoleUpdate,c.MessageTypes.Call],he.tags={EventTime:"eventtime",Initiator:"initiator",Id:"id",Role:"role",Value:"value",Name:"name",Duration:"duration"},he._tagChecks={[he.tags.EventTime]:{check:ce.Number,messagetypes:[]},[he.tags.Initiator]:{check:ce.Mri,messagetypes:[]},[he.tags.Id]:{check:ce.Mri,messagetypes:[c.MessageTypes.RoleUpdate]},[he.tags.Role]:{check:ce.NonEmpty,messagetypes:[c.MessageTypes.RoleUpdate]},[he.tags.Value]:{check:ce.None,messagetypes:[]},[he.tags.Name]:{check:ce.NonEmpty,messagetypes:[c.MessageTypes.Call]},[he.tags.Duration]:{check:ce.Number,messagetypes:[c.MessageTypes.Call]}},he._registeredTags=o.map(he._tagChecks,((e,t)=>e.messagetypes&&e.messagetypes.length?D.registerForXmlWithMessageTypes(t,he.parse,...e.messagetypes):D.registerForXml(t,he.parse)));class ue extends ne{constructor(e){super(e,ue._defaultTag)}getRawText(){const e=o.head(this.children);if(e.getRawText)return e.getRawText();return v.warn(S.LogTraceArea.GenericUnsafe,"TargetNode.children[0] is not an IPlainTextNode",this),""}getMessageTypes(){return ue._messageTypes}static parse(e){return 1===e.length?pe.parseTargetUser(e):2===e.length?me.parseTargetRole(e):void 0}}t.TargetNode=ue,ue._messageTypes=[c.MessageTypes.AddMember,c.MessageTypes.RoleUpdate,c.MessageTypes.DeleteMember,c.MessageTypes.LegacyMemberAdded,c.MessageTypes.LegacyMemberUpgraded,c.MessageTypes.HandshakeInvite,c.MessageTypes.HandshakeAccept,c.MessageTypes.HandshakeComplete,c.MessageTypes.HandshakeReject,c.MessageTypes.GuestNameUpdate],ue._defaultTag=D.registerForXmlWithMessageTypes(m.targetTagName,ue.parse,...ue._messageTypes);class pe extends ue{accept(e){return e.transformTargetUserNode(this)}static parseTargetUser(e){const t=re(e),s=t?t.getRawText():void 0;if(s&&h.isMri(s)&&t)return new pe([t])}}t.TargetUserNode=pe;class ge extends pe{accept(e){return e.transformTargetLegacyUserNode(this)}static parseTargetLegacyUser(e){const t=re(e);if(t)return new ge([t])}}t.TargetLegacyUserNode=ge;class me extends ue{constructor(e,t){super([e,t]),this.idChild=e,this.roleChild=t}accept(e){return e.transformTargetRoleNode(this)}static parseTargetRole(e){const t=o.groupBy(e,(e=>e&&e.getTag())),s=ae(t,he.tags.Id),i=ae(t,he.tags.Role);if(s&&i)return new me(s,i)}}t.TargetRoleNode=me;class Se extends ne{constructor(e){super(e,Se._defaultTag)}accept(e){return e.transformTargetsNode(this)}getMessageTypes(){return Se._messageTypes}static parse(e){if(e.length>0&&o.every(e,(e=>e instanceof ue)))return new Se(e)}}t.TargetsNode=Se,Se._messageTypes=[c.MessageTypes.AddMember,c.MessageTypes.RoleUpdate,c.MessageTypes.DeleteMember,c.MessageTypes.LegacyMemberAdded,c.MessageTypes.LegacyMemberUpgraded,c.MessageTypes.GuestNameUpdate],Se._defaultTag=D.registerForXmlWithMessageTypes(m.multiTargetsTagName,Se.parse,...Se._messageTypes);class fe extends ne{constructor(e,t,s,i){super([],fe._defaultTag),this.skypeId=e,this.fullName=t,this.isPstn=s,this.isS4B=i,this.fullName&&(this.fullName=x.default.unescapeXml(this.fullName))}static getEncodedTypeAttr(e=!1,t=!1){return e?"":t?"b":"s"}accept(e){return e.transformContactNode(this)}encodedAttr(){return{t:fe.getEncodedTypeAttr(this.isPstn,this.isS4B),s:this.skypeId,f:this.fullName}}getMessageTypes(){return fe._messageTypes}static parse(e,t){let s,i,o=!1,n=!1;if("s"===t.t)s=t.s,i=t.f?t.f:"";else if("b"===t.t)s=t.s,i=t.f?t.f:"",n=!0;else{s=i=t.p||t.s,o=!0}if(0===e.length&&(s||i))return new fe(s,i,o,n)}}t.ContactNode=fe,fe._messageTypes=[c.MessageTypes.Contacts],fe._defaultTag=D.registerForXmlWithMessageTypes("c",fe.parse,...fe._messageTypes);class ye extends ne{constructor(e){super(e,ye._defaultTag)}accept(e){return e.transformContactsNode(this)}getMessageTypes(){return ye._messageTypes}static parse(e){if(e.length>0&&o.every(e,(e=>e instanceof fe)))return new ye(e)}}t.ContactsNode=ye,ye._messageTypes=[c.MessageTypes.Contacts],ye._defaultTag=D.registerForXmlWithMessageTypes("contacts",ye.parse,...ye._messageTypes);class _e extends ne{constructor(e,t){super(e,_e._defaultTag),this._smsContentEscaped=t,this.smsContentUnescaped=x.default.unescapeXml(this._smsContentEscaped)}accept(e){return e.transformSmsNode(this)}encodedAttr(){return{alt:this._smsContentEscaped}}getMessageTypes(){return _e._messageTypes}static parse(e,t){const s=o.find(e,(e=>e instanceof U&&"defaults"===e.getTag())),i=s&&o.find(s.children,(e=>e instanceof U&&"content"===e.getTag())),n=i&&o.find(i.children,(e=>e instanceof U&&"body"===e.getTag()));if(n&&n.children&&n.children.length>=1&&n.children[0]instanceof z){const t=n.children[0];return new _e(e,t.encode())}if(o.isString(t.alt))return new _e(e,t.alt)}}t.SmsNode=_e,_e._messageTypes=[c.MessageTypes.Sms],_e._defaultTag=D.registerForXmlWithMessageTypes("sms",_e.parse,..._e._messageTypes);class ve extends ne{constructor(e,t,s){super([],ve._defaultTag),this.rawContent=e,this.content=t,this.contentNodes=s}accept(e){return e.transformMmsNode(this)}encode(){return this.rawContent}getMessageTypes(){return ve._messageTypes}getUriObjectNode(e){let t;return o.each(this.contentNodes,(s=>(t=s.getUriObjectNode(e),!t))),t}static parseMms(e){if(e){const t=A.default.parseJsonErrorable(e);if(!o.isError(t)&&t&&t.content_list){const s=o.map(t.content_list,(e=>{if(!(e&&e.headers&&e.headers.content_type&&e.content&&e.content.location))return null;const t=e.content.location.toLowerCase();if(e.headers.content_type.indexOf("text/plain")>-1){const s=e.content.text;if(s&&"inline"===t)return z.fromPlainText(s)}else if(e.headers.content_type.indexOf("image/")>-1){const s=e;if("ams"===t&&s.content.object_id){const e=l.getDocumentUrls(s.content.object_id,R.UploadFileType.Picture);return xe.parse([],{uri:e.original,url_thumbnail:e.preview,type:"Picture.1"})}}return null})),i=o.compact(s);if(!i.length&&t.subject){const e=z.fromPlainText(t.subject);i.push(e)}if(i.length)return new ve(e,t,i)}}return ve._parseFallback(e)}static parse(e,t){return v.warn(S.LogTraceArea.GenericUnsafe,"MmsNode.parse called",e,t),ve._parseFallback(void 0)}static _parseFallback(e){const t=z.fromPlainText(C.getString("MessageContentNodes.MmsFallback"));return new ve(e,void 0,[t])}}t.MmsNode=ve,ve._messageTypes=[c.MessageTypes.Mms],ve._defaultTag=D.registerForJson(c.MessageTypes.Mms,ve.parseMms);class Ce extends ne{constructor(e,t,s,i,o,n,r,a,l,d){super(e,Ce._defaultTag),this._attributes=t,this.isUserLocation=s,this.latitude=i,this.longitude=o,this.addressSanitized=n,this.userMri=r,this.shortAddressSanitized=a,this.addressFriendlyNameSanitized=l,this.bingUrl=d}accept(e){return e.transformLocationNode(this)}encodedAttr(){return this._attributes}getMessageTypes(){return Ce._messageTypes}static parse(e,t){const s=o.find(e,(e=>e instanceof ee));if(s){const i=F.default.getURIComponents(s.getSanitizedHref());if(i&&i.host&&i.pathname&&"www.bing.com"===i.host.toLowerCase()&&("maps/"===i.pathname.toLowerCase()||"maps/default.aspx/"===i.pathname.toLowerCase())){const i="1"===t.isUserLocation;let n=o.isString(t.latitude)?parseInt(t.latitude,10):t.latitude;n=o.isFinite(n)?n:void 0;let r=o.isString(t.longitude)?parseInt(t.longitude,10):t.longitude;r=o.isFinite(r)?r:void 0;const a=t.address&&x.default.unescapeXml(t.address),l=t.userMri&&x.default.unescapeXml(t.userMri),d=t.shortAddress&&x.default.unescapeXml(t.shortAddress),c=t.addressFriendlyName&&x.default.unescapeXml(t.addressFriendlyName);return new Ce(e,t,i,n,r,a,l,d,c,s.getSanitizedHref())}}}}t.LocationNode=Ce,Ce._messageTypes=[c.MessageTypes.Location],Ce._defaultTag=D.registerForXmlWithMessageTypes("location",Ce.parse,...Ce._messageTypes);class be extends ne{constructor(e,t){super([],be._defaultTag),this.type=e,this.originalName=t}accept(e){return e.transformMetaNode(this)}encodedAttr(){return{type:this.type,originalName:this.originalName}}getMessageTypes(){return be._messageTypes}static parse(e,t,s,i){let o=t.originalName;if(!o&&i){let e=O.exec(i.content);if(e&&1===e.length){const t=e[0];let s=t.substring(t.indexOf("/")+1,t.length-1);o=x.default.newGuid()+"."+s}}if(0===e.length&&t.type&&o)return new be(t.type,o)}}t.MetaNode=be,be._messageTypes=[c.MessageTypes.UriObject],be._defaultTag=D.registerForXmlWithMessageTypes("meta",be.parse,...be._messageTypes);class Te extends ne{constructor(e,t,s,i){super([e],Te._defaultTag),this.nameChild=e,this.size=t,this.index=s,this.tid=i}accept(e){return e.transformFileNode(this)}encodedAttr(){return{size:this.size,index:this.index,tid:this.tid}}getMessageTypes(){return Te._messageTypes}static parse(e,t){const s=re(e);if(s){const e=t.size?parseInt(t.size,10):void 0,i=t.index?parseInt(t.index,10):void 0;if(o.isFinite(e)&&o.isFinite(i)&&t.tid)return new Te(s,e,i,t.tid)}}}t.FileNode=Te,Te._messageTypes=[c.MessageTypes.Files],Te._defaultTag=D.registerForXmlWithMessageTypes("file",Te.parse,...Te._messageTypes);class Me extends ne{constructor(e,t){super(e,Me._defaultTag),this.alt=t}accept(e){return e.transformFilesNode(this)}encodedAttr(){return{alt:this.alt}}getMessageTypes(){return Me._messageTypes}static parse(e,t){if((e=o.reject(e,(e=>!!e&&e.isEmptyTextNodeOrContainingWhitespacesOnly()))).length>0&&o.every(e,(e=>e instanceof Te)))return new Me(e,t.alt)}}t.FilesNode=Me,Me._messageTypes=[c.MessageTypes.Files],Me._defaultTag=D.registerForXmlWithMessageTypes("files",Me.parse,...Me._messageTypes);class Ie extends ne{constructor(e,t,s,i,n){if(super(e,Ie._defaultTag),this._attr=t,this._sanitizedUrl=s,this._sanitizedThumbnailUrl=i,this._sanitizedAzureMSUrl=n,this._originalDimensions={width:void 0,height:void 0},t.width&&t.height){const e=parseInt(t.width,10),s=parseInt(t.height,10);e>0&&s>0&&(this._originalDimensions.width=e,this._originalDimensions.height=s)}const r=o.keyBy(e,(e=>e?e.getTag():"undefined")),a=r.OriginalName instanceof U?r.OriginalName:void 0;let l;a&&(l=a.encodedAttr().v,l&&(l=l.replace(/[\u202A-\u202E\u2066-\u2069]/g,""))),this._objectNameUnescaped=l&&x.default.unescapeXml(l),this._amsDocumentId=t.doc_id}getMessageTypes(){return Ie._messageTypes}getNameForUI(){return this._objectNameUnescaped}getNameForDownload(){const e=this.getNameForUI();return e&&P.lossyForUserFile(e)}getOriginalDimensions(){return this._originalDimensions}accept(e){return e.transformUriObjectNode(this)}encodedAttr(){return this._attr}getUriObjectNode(e){return this instanceof e?this:void 0}getSubType(){if(this._attr.type){const e=this._attr.type.split("/");return Ie._subtypeFromParts(e)}}static _subtypeFromParts(e){return e[1]?e[1].split(".")[0]:""}static parse(e,t,s,i){const o=!!i&&i.isMessageLie()&&T.default.isMyMri(i.creator),n=t.uri&&Ie._sanitizeUrl(t.uri,o),r=Ie._sanitizeUrl(t.url_thumbnail,o),a=Ie._sanitizeUrl(t.url_azurems,o);return!t.doc_id&&n&&(t.doc_id=l.getDocumentId(n)),Ie.parseFromSanitizedParts(e,t,n,r,a,i)}static _sanitizeUrl(e,t){if(e){const s=x.default.unescapeXml(e);if(t){const e=f.FileUploadCacheUtils.getAbsoluteFromLocalCacheUri(s);if(F.default.isFileOrBlob(e))return e}if(a.default.isTrustedDomain(s,!0))return F.default.sanitizeUrl(s)}}static parseFromSanitizedParts(e,t,s,i,n,r){if(t.type){const o=t.type.split("/"),a=o[0].split(".")[0],l=this._subtypeFromParts(o);if("Sticker"===a)return He.parseFromSanitizedParts(e,t,s,i);if("Picture"===a)return xe.parseFromSanitizedParts(e,t,s,i);if("Video"===a&&l===c.UriObjectTypeSubTypes.Video.Flik)return Ue.parseFromSanitizedParts(e,t,s,i);if("Video"===a&&l===c.UriObjectTypeSubTypes.Video.Message)return De.parseFromSanitizedParts(e,t,s,i,n);if("Video"===a)return Oe.parseFromSanitizedParts(e,t,s,i,n);if("Audio"===a&&l===c.UriObjectTypeSubTypes.Audio.Message)return Ve.parseFromSanitizedParts(e,t,s,i);if("Audio"===a)return Be.parseFromSanitizedParts(e,t,s,i);if("File"===a)return Re.parseFromSanitizedParts(e,t,s,i,n);if("SWIFT"===a)return we.parseFromSanitizedParts(e,t,s,i);if("ScheduledCallInvite"===a)return Ee.parseFromSanitizedParts(e,t,s,i,n,r);if("Poll"===a)return dt.parseFromSanitizedParts(e,t,s,i,n);if("Cast"===a)return rt.parseFromSanitizedParts(e,t,s,i)}else{const n=o.find(e,(e=>e instanceof be));if(n&&"photo"===n.type)return xe.parseFromSanitizedParts(e,t,s,i)}}}t.UriObjectNode=Ie,Ie._messageTypes=[c.MessageTypes.RichText,...c.UriObjectMessageTypes],Ie._defaultTag=D.registerForXmlWithMessageTypes("URIObject",Ie.parse,...Ie._messageTypes);class we extends Ie{constructor(e,t,s,i,o){super(e,t,void 0,s,void 0),this.swiftChild=i,this.titleChild=o}accept(e){return e.transformSwiftUriObjectNode(this)}static parseFromSanitizedParts(e,t,s,i){const n=o.find(e,(e=>e instanceof ke)),r=o.find(e,(e=>!!e&&"Title"===e.getTag()))||z.fromPlainText(C.getString("SwiftCard.Card"));if(i)return new we(e,t,i,n,r)}getCardType(){if(this.swiftChild&&this.swiftChild.swiftMessage){const e=this.swiftChild.swiftMessage.attachments;if(e&&e.length){const t=e[0].content;return t&&t.images&&t.images.length?t.images[0].type:void 0}}}}t.SwiftUriObjectNode=we;class Pe extends ne{constructor(){super([],Pe._defaultTag)}getMessageTypes(){return Pe._messageTypes}static isAdaptiveCardMessage(e){return!(!e.attachments||!o.isArray(e.attachments))&&o.some(e.attachments,(e=>e.contentType===n.AdaptiveCardContentTypes.adaptive))}_encodeParts(e,t,s,i=!1){return super._encodeParts(e,t,s,!0)}static parse(e,t,s,i){if(!t.b64)return;const o=u.atobUtf8(t.b64),n=o&&A.default.parseJsonErrorToUndefined(o);if(!n)return;const r=i?i.conversationId:void 0;if(Pe.isAdaptiveCardMessage(n))return Ae.parseAdaptiveCard(n,r,t.b64);{const e=i&&i.isMessageLie()&&T.default.isMyMri(i.creator);return ke.parseSwift(n,r,t.b64,!1,e)}}}Pe._messageTypes=[c.MessageTypes.RichText,c.MessageTypes.Media_Card],Pe._defaultTag=D.registerForXmlWithMessageTypes("Swift",Pe.parse,...Pe._messageTypes);class ke extends Pe{constructor(e,t,s){super(),this.swiftMessage=e,this.conversationId=t,this.b64=s}accept(e){return e.transformSwiftNode(this)}encodedAttr(){if(!this.b64){const e=JSON.stringify(this.swiftMessage);this.b64=u.btoaUtf8(e)}return{b64:this.b64}}static parseSwift(e,t,s,i,o){const n=i?e:E.default.sanitizeSwiftMessage(e,o);return n?new ke(n,t,s):void 0}}t.SwiftNode=ke;class Ae extends Pe{constructor(e,t,s){super(),this.adaptiveCardMessage=e,this.conversationId=t,this.b64=s}accept(e){return e.transformAdaptiveCardNode(this)}encodedAttr(){if(!this.b64){const e=JSON.stringify(this.adaptiveCardMessage);this.b64=u.btoaUtf8(e)}return{b64:this.b64}}static parseAdaptiveCard(e,t,s){const i=r.default.sanitizeAdaptiveCardMessage(e);return i?new Ae(i,t,s):void 0}}t.AdaptiveCardNode=Ae;class Ee extends Ie{constructor(e,t,s,i,o,n,r,a,l,d,c,h,u){super(e,t,s,i,o),this.subject=n,this.datetimeMs=r,this.reminder=a,this.conversationId=l,this.scheduledCallId=d,this.isSender=c,this.canceledTimeMs=h,this.editedTimeMs=u}accept(e){return e.transformScheduledCallInviteNode(this)}static parseFromSanitizedParts(e,t,s,i,n,r){const a=!!r&&T.default.isMyMri(r.creator),l=r&&r.conversationId,d=t.datetimeMs&&Number(t.datetimeMs)||void 0,c=t.canceledTimeMs&&Number(t.canceledTimeMs)||void 0,h=t.editedTimeMs&&Number(t.editedTimeMs)||void 0,u=t.reminder&&Number(t.reminder)||k.ScheduledCallReminder.Minutes15;if(d&&o.isString(t.scheduledCallId))return new Ee(e,t,s,i,n,o.isString(t.subject)?t.subject:void 0,d,u,l,t.scheduledCallId,a,c,h)}}t.ScheduledCallInviteNode=Ee;class Re extends Ie{constructor(e,t,s,i,n){super(e,t,s,i,n);const r=o.keyBy(this.children,(e=>e?e.getTag():"undefined")).FileSize,a=r?parseInt(r.encodedAttr().v,10):0;this._objectSizeUnescaped=o.isFinite(a)?a:0}getFileContentUrlSanitized(){return this._amsDocumentId?l.getDisplayUrl(this._amsDocumentId,R.UploadFileType.File):this._sanitizedUrl||""}getFileType(){return R.UploadFileType.File}getSizeInBytes(){return this._objectSizeUnescaped}accept(e){return e.transformUriObjectFileNode(this)}static parseFromSanitizedParts(e,t,s,i,o){if(s)return new Re(e,t,s,void 0,void 0)}}t.UriObjectFileNode=Re;class Le extends Re{}t.DisplayableMedia=Le;class Fe extends Le{}t.DisplayableMediaWithThumbnail=Fe;class xe extends Fe{constructor(e,t,s,i,n){if(super(e,t,s,i,n),!this._objectNameUnescaped){const e=o.keyBy(this.children,(e=>e?e.getTag():"undefined")),t=e.meta instanceof be?e.meta:void 0;t&&t.originalName&&(this._objectNameUnescaped=t.originalName)}this._sanitizedThumbnailUrl||(this._sanitizedThumbnailUrl=this._sanitizedUrl)}getDisplayUrlSanitized(){return this._amsDocumentId?l.getDisplayUrl(this._amsDocumentId,R.UploadFileType.Picture,R.MediaViewSize.MobilePreview):this._sanitizedUrl||""}getFullResolutionUrlSanitized(){return a.default.getS4LMessagingFeaturesNoSubscription().enableFullResolutionImageDownload?this._amsDocumentId?l.getDisplayUrl(this._amsDocumentId,R.UploadFileType.Picture,R.MediaViewSize.Full):this._sanitizedUrl||"":this.getDisplayUrlSanitized()}getDisplayMobilePreviewUrlSanitized(){return this.getDisplayUrlSanitized()}getDisplayUrlAsThumbnailSanitized(){return this._amsDocumentId?l.getDisplayUrl(this._amsDocumentId,R.UploadFileType.Picture,R.MediaViewSize.Thumbnail):this._sanitizedUrl||""}getDisplayThumbnailUrlSanitized(e=!1){return this._amsDocumentId?l.getDisplayUrl(this._amsDocumentId,R.UploadFileType.Picture,e?R.MediaViewSize.ThumbnailBlurred:R.MediaViewSize.ThumbnailUncropped):this._sanitizedThumbnailUrl||""}getFileType(){return R.UploadFileType.Picture}getNameForUI(){let e=super.getNameForUI();if(!e){return"Skype_Picture_"+(new Date).toISOString().replace(/[:\.\-]/g,"_")+".jpeg"}return e}accept(e){return e.transformPictureNode(this)}static parseFromSanitizedParts(e,t,s,i){if(s||i)return new xe(e,t,s,i,void 0)}}t.PictureNode=xe,xe.parse=Ie.parse;class Oe extends Fe{getDisplayUrlSanitized(){let e=this._getAzMSUrl();return e||(this._amsDocumentId?l.getDisplayUrl(this._amsDocumentId,R.UploadFileType.Video,R.MediaViewSize.Full):this._sanitizedUrl||"")}getFullResolutionUrlSanitized(){return this.getDisplayUrlSanitized()}_getAzMSUrl(){this._sanitizedAzureMSUrl}getDisplayUrlMediaProvider(){return this._getAzMSUrl()?m.MediaProvider.AzureMS:m.MediaProvider.AMS}getDisplayThumbnailUrlSanitized(e=!1){return this._amsDocumentId?l.getDisplayUrl(this._amsDocumentId,R.UploadFileType.Video,e?R.MediaViewSize.ThumbnailBlurred:R.MediaViewSize.ThumbnailUncropped):this._sanitizedThumbnailUrl||""}getNameForUI(){let e=super.getNameForUI();return e||"Skype_Video.mp4"}getFileType(){return R.UploadFileType.Video}accept(e){return e.transformVideoNode(this)}static parseFromSanitizedParts(e,t,s,i,o){if(s||i||o)return new Oe(e,t,s,i,o)}}t.VideoNode=Oe,Oe.parse=Ie.parse;class De extends Oe{getNameForUI(){let e=super.getNameForUI();return e||"Skype_Video_Message.mp4"}accept(e){return e.transformVideoMessageNode(this)}getFileType(){return R.UploadFileType.VideoMessage}static parseFromSanitizedParts(e,t,s,i,o){if(s||i||o)return new De(e,t,s,i,o)}}t.VideoMessageNode=De,De.parse=Ie.parse;class Be extends Le{getDisplayUrlSanitized(){return this._amsDocumentId?l.getDisplayUrl(this._amsDocumentId,R.UploadFileType.Audio,R.MediaViewSize.Full):this._sanitizedUrl||""}getFullResolutionUrlSanitized(){return this.getDisplayUrlSanitized()}accept(e){return e.transformAudioNode(this)}getFileType(){return R.UploadFileType.Audio}static parseFromSanitizedParts(e,t,s,i){if(s)return new Be(e,t,s,void 0,void 0)}}t.AudioNode=Be,Be.parse=Ie.parse;class Ve extends Be{constructor(e,t,s,i,o){super(e,t,s,i,void 0),this.audioDurationMs=o}getDisplayUrlSanitized(){return this._amsDocumentId?l.getDisplayUrl(this._amsDocumentId,R.UploadFileType.AudioMessage,R.MediaViewSize.Full):this._sanitizedUrl||""}accept(e){return e.transformAudioMessageNode(this)}getFileType(){return R.UploadFileType.AudioMessage}getAudioDurationMs(){return this.audioDurationMs}static parseFromSanitizedParts(e,t,s,i){if(s)return new Ve(e,t,s,void 0,Number(t.duration_ms)||void 0)}}t.AudioMessageNode=Ve,Ve.parse=Ie.parse;class Ne extends ne{constructor(e,t,s){super(e,Ne._defaultTag),this.attributes=t,this._albumId=s}getMessageTypes(){return Ne._messageTypes}encodedAttr(){return this.attributes}getAlbumId(){return this._albumId}accept(e){return e.transformMediaAlbumNode(this)}static parse(e,t){if(o.isString(t.albumId))return new Ne(e,t,t.albumId)}}t.MediaAlbumNode=Ne,Ne._messageTypes=[c.MessageTypes.MediaAlbum],Ne._defaultTag=D.registerForXmlWithMessageTypes("MediaAlbum",Ne.parse,...Ne._messageTypes);class Ue extends Ie{constructor(e,t,s,i,o){super(e,t,s,i,void 0),this.type=o}getSourceUrlSanitized(){return this._sanitizedUrl}accept(e){return e.transformMojiNode(this)}static parseFromSanitizedParts(e,t,s,i){if(s)return new Ue(e,t,s,i,o.isString(t.type)?t.type:void 0)}}t.MojiNode=Ue;class He extends Ie{constructor(e,t,s,i){super(e,t,s,i,void 0)}getSourceUrlSanitized(){return this._sanitizedUrl}accept(e){return e.transformStickerNode(this)}static parseFromSanitizedParts(e,t,s,i){if(s)return new He(e,t,s,i)}}t.StickerNode=He;class ze extends ne{constructor(e,t){super(e,ze._defaultTag),this.attr=t}getMessageTypes(){return ze._messageTypes}accept(e){return e.transformSkypeVideoMessageNode(this)}encodedAttr(){return this.attr}static parse(e,t){if(o.isString(t.sid)&&0!==t.sid.length)return new ze(e,t)}}t.SkypeVideoMessageNode=ze,ze._messageTypes=[c.MessageTypes.SkypeVideoMessage],ze._defaultTag=D.registerForXmlWithMessageTypes("videomessage",ze.parse,...ze._messageTypes);class We extends ne{constructor(e,t,s,i){super([].concat(e,t,s),i),this.eventTime=e,this.initiator=t,this.content=s}static isCreatorTrusted(e){return!!e.creator&&h.isThread(e.creator)}}t.ThreadActivity=We;class je extends We{constructor(e,t,s,i){super(e,t,s,je._defaultTag),this.conversationId=i}getMessageTypes(){return je._messageTypes}accept(e){return e.transformAddMemberNode(this)}static parse(e,t,s,i){const n=le(e);if(n){const[e,t,s]=n;if(o.every(s,(e=>e instanceof pe))&&i&&We.isCreatorTrusted(i))return new je(e,t,s,i.conversationId)}}}t.AddMemberNode=je,je._messageTypes=[c.MessageTypes.AddMember],je._defaultTag=D.registerForXmlWithMessageTypes("addmember",je.parse,...je._messageTypes);class Ge extends We{constructor(e,t,s){super(e,t,s,Ge._defaultTag)}getMessageTypes(){return Ge._messageTypes}accept(e){return e.transformDeleteMemberNode(this)}static parse(e,t,s,i){const n=le(e);if(n){const[e,t,s]=n;if(o.every(s,(e=>e instanceof pe))&&i&&We.isCreatorTrusted(i))return new Ge(e,t,s)}}}t.DeleteMemberNode=Ge,Ge._messageTypes=[c.MessageTypes.DeleteMember],Ge._defaultTag=D.registerForXmlWithMessageTypes("deletemember",Ge.parse,...Ge._messageTypes);class Ke extends We{constructor(e,t,s){super(e,t,s,Ke._defaultTag)}getMessageTypes(){return Ke._messageTypes}accept(e){return e.transformRoleUpdateNode(this)}static parse(e,t,s,i){const n=le(e);if(n){const[e,t,s]=n;if(o.every(s,(e=>e instanceof me))&&i&&We.isCreatorTrusted(i))return new Ke(e,t,s)}}}t.RoleUpdateNode=Ke,Ke._messageTypes=[c.MessageTypes.RoleUpdate],Ke._defaultTag=D.registerForXmlWithMessageTypes("roleupdate",Ke.parse,...Ke._messageTypes);class qe extends We{constructor(e,t,s){super(e,t,s,qe._defaultTag)}getMessageTypes(){return qe._messageTypes}accept(e){return e.transformTopicUpdateNode(this)}static parse(e,t,s,i){const o=de(e);if(o){const[e,t,s]=o;if(i&&We.isCreatorTrusted(i))return new qe(e,t,s)}}}t.TopicUpdateNode=qe,qe._messageTypes=[c.MessageTypes.TopicUpdate],qe._defaultTag=D.registerForXmlWithMessageTypes("topicupdate",qe.parse,...qe._messageTypes);class Qe extends We{constructor(e,t,s){super(e,t,s,Qe._defaultTag)}getMessageTypes(){return Qe._messageTypes}accept(e){return e.transformHandshakeInviteNode(this)}static parse(e,t,s,i){const n=le(e);if(n){const[e,t,s]=n;if(o.every(s,(e=>e instanceof pe))&&i&&We.isCreatorTrusted(i))return new Qe(e,t,s)}}}t.HandshakeInviteNode=Qe,Qe._messageTypes=[c.MessageTypes.HandshakeInvite],Qe._defaultTag=D.registerForXmlWithMessageTypes("handshakeinvite",Qe.parse,...Qe._messageTypes);class Xe extends We{constructor(e,t,s){super(e,t,s,Xe._defaultTag)}getMessageTypes(){return Xe._messageTypes}accept(e){return e.transformHandshakeAcceptNode(this)}static parse(e,t,s,i){const n=le(e);if(n){const[e,t,s]=n;if(o.every(s,(e=>e instanceof pe))&&i&&We.isCreatorTrusted(i))return new Xe(e,t,s)}}}t.HandshakeAcceptNode=Xe,Xe._messageTypes=[c.MessageTypes.HandshakeAccept],Xe._defaultTag=D.registerForXmlWithMessageTypes("handshakeaccept",Xe.parse,...Xe._messageTypes);class $e extends We{constructor(e,t,s){super(e,t,s,$e._defaultTag)}getMessageTypes(){return $e._messageTypes}accept(e){return e.transformHandshakeCompleteNode(this)}static parse(e,t,s,i){const n=le(e);if(n){const[e,t,s]=n;if(o.every(s,(e=>e instanceof pe))&&i&&We.isCreatorTrusted(i))return new $e(e,t,s)}}}t.HandshakeCompleteNode=$e,$e._messageTypes=[c.MessageTypes.HandshakeComplete],$e._defaultTag=D.registerForXmlWithMessageTypes("handshakecomplete",$e.parse,...$e._messageTypes);class Je extends We{constructor(e,t,s){super(e,t,s,Je._defaultTag)}getMessageTypes(){return Je._messageTypes}accept(e){return e.transformHandshakeRejectNode(this)}static parse(e,t,s,i){const n=le(e);if(n){const[e,t,s]=n;if(o.every(s,(e=>e instanceof pe))&&i&&We.isCreatorTrusted(i))return new Je(e,t,s)}}}t.HandshakeRejectNode=Je,Je._messageTypes=[c.MessageTypes.HandshakeReject],Je._defaultTag=D.registerForXmlWithMessageTypes("handshakereject",Je.parse,...Je._messageTypes);class Ye extends We{constructor(e,t,s){super(e,t,s,Ye._defaultTag)}getMessageTypes(){return Ye._messageTypes}accept(e){return e.transformPictureUpdateNode(this)}static parse(e,t,s,i){const o=de(e);if(o){const[e,t,s]=o;if(i&&We.isCreatorTrusted(i))return new Ye(e,t,s)}}}t.PictureUpdateNode=Ye,Ye._messageTypes=[c.MessageTypes.PictureUpdate],Ye._defaultTag=D.registerForXmlWithMessageTypes("pictureupdate",Ye.parse,...Ye._messageTypes);class Ze extends We{constructor(e,t,s,i){super(e,t,s,Ze._defaultTag),this.nowDisclosed=i}getMessageTypes(){return Ze._messageTypes}accept(e){return e.transformHistoryDisclosedUpdateNode(this)}static parse(e,t,s,i){const o=de(e);if(o){const[e,t,s]=o;if(i&&We.isCreatorTrusted(i)){const i=s.getRawText().toLocaleLowerCase();return new Ze(e,t,s,"false"!==i)}}}}t.HistoryDisclosedUpdateNode=Ze,Ze._messageTypes=[c.MessageTypes.HistoryDisclosedUpdate],Ze._defaultTag=D.registerForXmlWithMessageTypes("historydisclosedupdate",Ze.parse,...Ze._messageTypes);class et extends We{constructor(e,t,s,i){super(e,t,s,et._defaultTag),this.nowEnabled=i}getMessageTypes(){return et._messageTypes}accept(e){return e.transformJoiningEnabledUpdateNode(this)}static parse(e,t,s,i){const o=de(e);if(o){const[e,t,s]=o;if(i&&We.isCreatorTrusted(i)){const i=s.getRawText().toLocaleLowerCase();return new et(e,t,s,"false"!==i)}}}}t.JoiningEnabledUpdateNode=et,et._messageTypes=[c.MessageTypes.JoiningEnabledUpdate],et._defaultTag=D.registerForXmlWithMessageTypes("joiningenabledupdate",et.parse,...et._messageTypes);class tt extends We{constructor(e,t,s){super(e,t,s,tt._defaultTag),this.link=tt._link}getMessageTypes(){return tt._messageTypes}accept(e){return e.transformLegacyMemberAddedNode(this)}static parse(e,t,s,i){const n=le(e);if(n){const[e,t,s]=n;if(o.every(s,(e=>e instanceof ge))&&i&&We.isCreatorTrusted(i))return new tt(e,t,s)}}}t.LegacyMemberAddedNode=tt,tt._link=ee.parseFromHref("https://www.skype.com/en/download-skype/skype-for-computer/"),tt._messageTypes=[c.MessageTypes.LegacyMemberAdded],tt._defaultTag=D.registerForXmlWithMessageTypes("legacymemberadded",tt.parse,...tt._messageTypes);class st extends We{constructor(e,t,s){super(e,t,s,st._defaultTag)}getMessageTypes(){return st._messageTypes}accept(e){return e.transformLegacyMemberUpgradedNode(this)}static parse(e,t,s,i){const n=le(e);if(n){const[e,t,s]=n;if(o.every(s,(e=>e instanceof ge))&&i&&We.isCreatorTrusted(i))return new st(e,t,s)}}}t.LegacyMemberUpgradedNode=st,st._messageTypes=[c.MessageTypes.LegacyMemberUpgraded],st._defaultTag=D.registerForXmlWithMessageTypes("legacymemberupgraded",st.parse,...st._messageTypes);class it extends ne{constructor(e,t,s,i){super([e].concat(t||[]),it._defaultTag),this.nameChild=e,this.durationChild=t,this.identity=s,this.live_identity=i}getMessageTypes(){return it._messageTypes}accept(e){return e.transformPartNode(this)}encodedAttr(){return{identity:this.identity,live_identity:this.live_identity}}static parse(e,t){if(2===(e=o.reject(e,(e=>!e||e.isEmptyTextNodeOrContainingWhitespacesOnly()))).length||1===e.length){const s=o.keyBy(e,(e=>e?e.getTag():"undefined")),i=s[he.tags.Name]instanceof he?s[he.tags.Name]:void 0,n=s[he.tags.Duration]instanceof he?s[he.tags.Duration]:void 0;if(i)return new it(i,n,String(t.identity),String(t.live_identity))}}}t.PartNode=it,it._messageTypes=[c.MessageTypes.Call],it._defaultTag=D.registerForXmlWithMessageTypes("part",it.parse,...it._messageTypes);class ot extends ne{constructor(e,t,s,i,o){super(e,ot._defaultTag),this.type=t,this.alt=s,this.callId=i,this.conversationId=o}accept(e){return e.transformPartListNode(this)}encodedAttr(){return{type:this.type,alt:this.alt,callId:this.callId}}getMessageTypes(){return ot._messageTypes}static parse(e,t,s,i){let n;if(e=o.reject(e,(e=>!!e&&e.isEmptyTextNodeOrContainingWhitespacesOnly())),o.isString(t.callId)&&t.callId.length)n=t.callId;else{if(!i||!o.isString(i.skypeguid)||0===i.skypeguid.length)return;n=i.skypeguid}const r=i?i.conversationId:void 0;if(o.every(e,(e=>e instanceof it)))return new ot(e,o.isString(t.type)?t.type:void 0,String(t.alt),n,r)}}t.PartListNode=ot,ot._messageTypes=[c.MessageTypes.Call],ot._defaultTag=D.registerForXmlWithMessageTypes("partlist",ot.parse,...ot._messageTypes);class nt extends ne{constructor(e){super(e,nt._defaultTag)}accept(e){return e.transformEndedNode(this)}getMessageTypes(){return nt._messageTypes}static parse(e){if(0===e.length)return new nt(e)}}t.EndedNode=nt,nt._messageTypes=[c.MessageTypes.Call],nt._defaultTag=D.registerForXmlWithMessageTypes("ended",nt.parse,...nt._messageTypes);class rt extends Ie{constructor(e,t,s,i,o,n,r,a){super(e,t,void 0,void 0,void 0),this.callId=s,this.threadId=i,this.containerType=o,this.timestamp=n,this.label=r,this.locationName=a}accept(e){return e.transformCallInfoUriObjectNode(this)}static parseFromSanitizedParts(e,t,s,i){if(!(o.isString(t.callId)&&t.threadId&&h.isThread(t.threadId)&&o.isString(t.containerType)&&o.isString(t.timestamp)))return;const n=o.isString(t.label)?x.default.unescapeXml(t.label):void 0,r=o.isString(t.locationName)?x.default.unescapeXml(t.locationName):void 0,a=Number(t.timestamp);return o.isNaN(a)?void 0:new rt(e,t,t.callId,t.threadId,t.containerType,a,n,r)}}t.CallInfoUriObjectNode=rt;class at extends H{constructor(e,t,s,i){super([],at._defaultTag),this._id=e,this._style=t,this._internalType=s,this._userMri=i}accept(e){return e.transformUnknownNode(this)}encodedAttr(){return{id:this._id,style:this._style,internalType:this._internalType,userMri:this._userMri}}getStyle(){return this._style||R.ReactionsTextStyle.Default}getInternalType(){return this._internalType||R.ReactionsTextType.Default}getUserMri(){return this._userMri}isEmptyTextNodeOrContainingWhitespacesOnly(){return!0}isEmptyTextNodeOrContainingSpaceCharsOnly(){return!0}static parse(e,t){if(0===e.length&&o.isString(t.id))return new at(t.id,t.style?parseInt(t.style,10):void 0,t.internalType?parseInt(t.internalType,10):void 0,t.userMri)}}t.CallReactionMetadataNode=at,at._defaultTag=D.registerForXml("c_i",at.parse);class lt extends ne{constructor(e,t,s,i){super(e,lt._defaultTag),this.type=t,this._rawUserMrisOrNames=s,this.userMrisOrNames=i}encodedAttr(){return{type:this.type,users:this._rawUserMrisOrNames}}accept(e){return e.transformNgcUpgradeNode(this)}static parse(e,t){if("ngcUpgradeMessage"===t.type)return new lt(e,t.type,String(t.users),o.isString(t.users)?x.default.unescapeXml(t.users).split(","):[])}}t.NgcUpgradeSystemMessageNode=lt,lt._defaultTag=D.registerForXml("systemMessage",lt.parse);class dt extends Ie{constructor(e,t,s,i,o,n,r,a,l){super(e,t,s,i,o),this.children=e,this.title=n,this.expirationTimeMs=r,this.options=a,this.allowMultipleVotes=l}accept(e){return e.transformPollNode(this)}getAttr(){return{}}static parseFromSanitizedParts(e,t,s,i,n){const r=t.expirationTimeMs&&Number(t.expirationTimeMs)||Date.now(),a=o.isString(t.title)?t.title:"",l=o.isString(t.optionsEncoded)?w.decodePollOptions(t.optionsEncoded):[],d="true"===t.allowMultipleVotes;return new dt(e,t,s,i,n,a,r,l,d)}}t.PollNode=dt;class ct extends ne{constructor(e,t,s,i){super([],i||ct._defaultTag),this.type=e,this.content=t,this.contentNode=s,this._customTag=i}accept(e){return e.transformDataNode(this)}encode(){return this.content}getMessageTypes(){return ct._messageTypes}static parse(e){const{type:t,content:s}=e;if(t){const e=parseInt(b.DataMessageContentType[t],10);if(e&&s){const i=z.fromPlainText(t||"");return new ct(e,s,i)}}return ct.parseFallback()}static parseData(e){if(e){const t=A.default.parseJsonErrorToUndefined(e);if(t&&t.type){const s=z.fromPlainText(b.DataMessageContentType[t.type]);return new ct(t.type,e,s)}}return ct.parseFallback()}static parseFallback(){const e=z.fromPlainText(C.getString("MessageContentNodes.DataFallback"));return new ct(b.DataMessageContentType.Unknown,"",e)}}t.DataNode=ct,ct._messageTypes=[c.MessageTypes.Data,c.MessageTypes.TranslationSettings],ct._defaultTag=D.registerForJson(c.MessageTypes.Data,ct.parseData);class ht extends ct{constructor(e,t,s){super(e,t,s,ht._defaultTagValue),this.type=e,this.content=t,this.contentNode=s}static parse(e){const{type:t,content:s}=e;if(t){const e=parseInt(b.DataMessageContentType[t],10);if(e&&s){const i=z.fromPlainText(t||"");return new ht(e,s,i)}}return ct.parseFallback()}static parseData(e){if(e){const t=A.default.parseJsonErrorToUndefined(e);if(t&&t.type){const s=z.fromPlainText(b.DataMessageContentType[t.type]);return new ht(t.type,e,s)}}return ct.parseFallback()}}t.TranslationSettingsNode=ht,ht._defaultTagValue=D.registerForJson(c.MessageTypes.TranslationSettings,ct.parseData);class ut extends ne{constructor(e,t,s){super([],ut._defaultTag),this.translation=e,this.originalLocale=t,this.contentNode=s}accept(e){return e.transformTranslationNode(this)}encode(){return this.translation}getUriObjectNode(e){return this.contentNode.getUriObjectNode(e)}getMessageTypes(){return ut._messageTypes}static parse(e,t){if(e&&t){const s=z.fromPlainText(e);return new ut(e,t,s)}return ut._parseFallback(e)}static parseTranslation(e){if(e){const t=c.getMessageTranslationMetadata(e);if(t){const e=z.fromPlainText(t.translations[0].translation);return new ut(t.translations[0].translation,t.oloc,e)}}return ut._parseFallback(e)}static _parseFallback(e){const t=z.fromPlainText(C.getString("MessageContentNodes.TranslationFallback"));return new ut(e,void 0,t)}}t.TranslationNode=ut,ut._messageTypes=[c.MessageTypes.Translation],ut._defaultTag=D.registerForJson(c.MessageTypes.Translation,ut.parseTranslation);class pt extends ue{constructor(e,t){super([]),this.oldName=e,this.newName=t}accept(e){return e.transformGuestNameUpdateTargetNode(this)}encodedAttr(){return{oldName:this.oldName,newName:this.newName}}}t.GuestUpdateTargetNode=pt;class gt extends We{constructor(e,t,s){super(e,t,s,gt._defaultTag)}getMessageTypes(){return gt._messageTypes}accept(e){return e.transformGuestNameUpdateNode(this)}static parse(e,t,s,i){const o=le(e);if(o){const[e,t,s]=o;return new gt(e,t,s)}return new gt(new he(z.fromPlainText(""),""),new he(z.fromPlainText(""),""),[new pt(String(t.oldName),String(t.newName))])}}t.GuestUpdateNode=gt,gt._messageTypes=[c.MessageTypes.GuestNameUpdate],gt._defaultTag=D.registerForXml("guestNameUpdate",gt.parse)},3109:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.extraTextNodeParsing=void 0;const i=s(96486),o=s(81169),n=s(46096),r=s(97174),a=s(23944),l=s(36237),d=s(12762),c=s(4057);class h{constructor(e){this._options=e,this.transformRootNode=this._default,this.transformEditMessageMetaDataNode=i.identity,this.transformHighlightedNode=i.identity,this.transformAtMentionNode=i.identity,this.transformUserMriNode=i.identity,this.transformEmoticonNode=i.identity,this.transformFlagNode=i.identity,this.transformQuoteNode=this._default,this.transformLegacyQuoteNode=i.identity,this.transformWikiMarkupNode=this._default,this.transformLinkNode=i.identity,this.transformEmoteNode=i.identity,this.transformContextNode=i.identity,this.transformSwiftUriObjectNode=i.identity,this.transformSwiftNode=i.identity,this.transformAdaptiveCardNode=i.identity,this.transformScheduledCallInviteNode=i.identity,this.transformUnknownNode=i.identity,this.transformTextWrapperNode=i.identity,this.transformTargetUserNode=i.identity,this.transformTargetLegacyUserNode=i.identity,this.transformTargetRoleNode=i.identity,this.transformTargetsNode=i.identity,this.transformContactNode=i.identity,this.transformContactsNode=i.identity,this.transformFileNode=i.identity,this.transformFilesNode=i.identity,this.transformSmsNode=i.identity,this.transformMmsNode=i.identity,this.transformLocationNode=i.identity,this.transformMetaNode=i.identity,this.transformUriObjectNode=i.identity,this.transformUriObjectFileNode=i.identity,this.transformPictureNode=i.identity,this.transformVideoNode=i.identity,this.transformVideoMessageNode=i.identity,this.transformAudioNode=i.identity,this.transformAudioMessageNode=i.identity,this.transformSkypeVideoMessageNode=i.identity,this.transformCallInfoUriObjectNode=i.identity,this.transformMojiNode=i.identity,this.transformStickerNode=i.identity,this.transformAddMemberNode=i.identity,this.transformDeleteMemberNode=i.identity,this.transformRoleUpdateNode=i.identity,this.transformTopicUpdateNode=i.identity,this.transformHandshakeInviteNode=i.identity,this.transformHandshakeAcceptNode=i.identity,this.transformHandshakeCompleteNode=i.identity,this.transformHandshakeRejectNode=i.identity,this.transformPictureUpdateNode=i.identity,this.transformHistoryDisclosedUpdateNode=i.identity,this.transformJoiningEnabledUpdateNode=i.identity,this.transformLegacyMemberAddedNode=i.identity,this.transformLegacyMemberUpgradedNode=i.identity,this.transformPartNode=i.identity,this.transformPartListNode=i.identity,this.transformEndedNode=i.identity,this.transformPollNode=i.identity,this.transformNgcUpgradeNode=i.identity,this.transformSuggestedTextHighlightNode=i.identity,this.transformCallerIDNode=i.identity,this.transformMediaAlbumNode=i.identity,this.transformTranslationNode=i.identity,this.transformDataNode=i.identity,this.transformHtmlNode=i.identity,this.transformGuestNameUpdateNode=i.identity,this.transformGuestNameUpdateTargetNode=i.identity}_default(e){const t=(0,o.chain)(e.children,(0,o.map)((e=>{const t=e&&e.accept(this);return t instanceof d.RootNode?i.compact(t.children):t})),(0,o.compact)(),(0,o.flatten)());return e.cloneWithChildren(t)}transform(e){return e.accept(this)}transformPlainTextNode(e){const t=e.getRawText();if(!t)return e;let s=[new r.UnhandledEntity(t)];this._options.extractEmoticons&&(s=a.handleEmoticons(s)),this._options.extractLinks&&(s=a.handleLinks(s)),this._options.extractSuggestedTextHighlights&&(s=a.handleSuggestedTextHighlights(s,this._options.extractSuggestedTextHighlights));const o=i.map(s,(e=>e.decode()));return 1===o.length?o[0]:d.RootNode.parse(o)}transformUnicodeEmojiNode(e){return this.transformPlainTextNode(e.emojiTextNode)}}t.extraTextNodeParsing=function(e,t,s,i){try{return new h({extractEmoticons:t,extractLinks:s,extractSuggestedTextHighlights:i}).transform(e)}catch(e){l.error(n.LogTraceArea.GenericUnsafe,"TextEntityExtractionTransformer: Failed to transform tree: "+c.default.errorAsString(e))}return e}},77878:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.transformUnicodeEmojis=t.UnicodeEmojiTransformer=void 0;const i=s(60809),o=s(96486),n=s(89391),r=s(81169),a=s(46096),l=s(36237),d=s(12762),c=s(4057),h=i();class u{constructor(){this.transformRootNode=this._default,this.transformHighlightedNode=o.identity,this.transformUnknownNode=o.identity,this.transformEditMessageMetaDataNode=o.identity,this.transformAtMentionNode=o.identity,this.transformUserMriNode=o.identity,this.transformUnicodeEmojiNode=o.identity,this.transformEmoticonNode=o.identity,this.transformFlagNode=o.identity,this.transformQuoteNode=o.identity,this.transformLegacyQuoteNode=o.identity,this.transformWikiMarkupNode=o.identity,this.transformLinkNode=o.identity,this.transformEmoteNode=o.identity,this.transformContextNode=o.identity,this.transformTextWrapperNode=o.identity,this.transformTargetUserNode=o.identity,this.transformTargetLegacyUserNode=o.identity,this.transformTargetRoleNode=o.identity,this.transformTargetsNode=o.identity,this.transformContactNode=o.identity,this.transformContactsNode=o.identity,this.transformFileNode=o.identity,this.transformFilesNode=o.identity,this.transformSmsNode=o.identity,this.transformMmsNode=o.identity,this.transformLocationNode=o.identity,this.transformMetaNode=o.identity,this.transformUriObjectNode=o.identity,this.transformUriObjectFileNode=o.identity,this.transformPictureNode=o.identity,this.transformVideoNode=o.identity,this.transformVideoMessageNode=o.identity,this.transformAudioNode=o.identity,this.transformAudioMessageNode=o.identity,this.transformCallInfoUriObjectNode=o.identity,this.transformMojiNode=o.identity,this.transformStickerNode=o.identity,this.transformSkypeVideoMessageNode=o.identity,this.transformAddMemberNode=o.identity,this.transformDeleteMemberNode=o.identity,this.transformRoleUpdateNode=o.identity,this.transformTopicUpdateNode=o.identity,this.transformHandshakeInviteNode=o.identity,this.transformHandshakeAcceptNode=o.identity,this.transformHandshakeCompleteNode=o.identity,this.transformHandshakeRejectNode=o.identity,this.transformPictureUpdateNode=o.identity,this.transformHistoryDisclosedUpdateNode=o.identity,this.transformJoiningEnabledUpdateNode=o.identity,this.transformLegacyMemberAddedNode=o.identity,this.transformLegacyMemberUpgradedNode=o.identity,this.transformPartNode=o.identity,this.transformPartListNode=o.identity,this.transformEndedNode=o.identity,this.transformSwiftUriObjectNode=o.identity,this.transformSwiftNode=o.identity,this.transformAdaptiveCardNode=o.identity,this.transformScheduledCallInviteNode=o.identity,this.transformNgcUpgradeNode=o.identity,this.transformSuggestedTextHighlightNode=o.identity,this.transformPollNode=o.identity,this.transformCallerIDNode=o.identity,this.transformMediaAlbumNode=o.identity,this.transformTranslationNode=o.identity,this.transformDataNode=o.identity,this.transformHtmlNode=o.identity,this.transformGuestNameUpdateNode=o.identity,this.transformGuestNameUpdateTargetNode=o.identity}_default(e){const t=(0,r.chain)(e.children,(0,r.map)((e=>{const t=e&&e.accept(this);return t instanceof d.RootNode?o.compact(t.children):t})),(0,r.compact)(),(0,r.flatten)());return e.cloneWithChildren(t)}transform(e){return e.accept(this)}transformPlainTextNode(e){const t=e.getRawText(),s=this._parseText(t);if(1===s.length)return s[0];return d.RootNode.parse(s)}_parseText(e){if(-1===e.search(h))return[d.PlainTextNode.fromPlainText(e)];const t=[];let s,i=0;for(;s=h.exec(e);)i!==s.index&&t.push(d.PlainTextNode.fromPlainText(e.substring(i,s.index))),i=s.index+s[0].length,t.push(d.UnicodeEmojiNode.fromPlainText(e.substring(s.index,i)));return i!==e.length&&t.push(d.PlainTextNode.fromPlainText(e.substring(i,e.length))),h.lastIndex=0,t}}t.UnicodeEmojiTransformer=u;const p=new u;t.transformUnicodeEmojis=function(e){try{return n.default.dangerouslyGetS4LMessagingFeatures().enableBigUnicodeEmoticons?p.transform(e):e}catch(e){l.error(a.LogTraceArea.GenericUnsafe,"TextEntityExtractionTransformer: Failed to transform tree: "+c.default.errorAsString(e))}return e}},6509:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.encodeWikiMarkupWithoutPrefix=t.splitWikiMarkupPrefix=t.WikiPrefix=void 0;const i=s(96486),o=s(81169),n=s(97174),r=s(61253),a=s(89391);var l,d,c;!function(e){e[e.WT_BOLD=0]="WT_BOLD",e[e.WT_ITALIC=1]="WT_ITALIC",e[e.WT_CODE=2]="WT_CODE",e[e.WT_STRIKE=3]="WT_STRIKE"}(l||(l={})),function(e){e[e.MT_SPAN=0]="MT_SPAN",e[e.MT_ANY=1]="MT_ANY"}(d||(d={})),function(e){e[e.None=0]="None",e[e.DoNotFormat=1]="DoNotFormat",e[e.NoWiki=2]="NoWiki",e[e.OnlyFormatLinks=3]="OnlyFormatLinks"}(c=t.WikiPrefix||(t.WikiPrefix={}));class h{constructor(e,t,s,i,o=i){this.type=e,this.matchType=t,this.tag=s,this.raw_pre=i,this.raw_post=o,this.tokenSymbol=this.raw_pre[0]}}let u=[new h(l.WT_BOLD,d.MT_SPAN,"b","*"),new h(l.WT_ITALIC,d.MT_SPAN,"i","_"),new h(l.WT_CODE,d.MT_ANY,"pre","{code}"),new h(l.WT_STRIKE,d.MT_SPAN,"s","~"),new h(l.WT_CODE,d.MT_ANY,"pre","```")];const p=i.map(u,(e=>e.raw_pre[0])).join(""),g=/[\r\n]/,m=/[,.!?*_{}()]/,S=/[ \f\t\v​\u00a0\u1680​\u180e\u2000-\u200a​\u2028\u2029\u202f\u205f​\u3000\ufeff]/;function f(e,t){return 0===t||-1!=="w \n".indexOf(e[t-1].char)||"!"===e[t-1].char&&(1===t||-1!=="w \n".indexOf(e[t-2].char))||t===e.length-1||-1!=="w \n".indexOf(e[t+1].char)||"!"===e[t+1].char&&(t+2===e.length||-1!=="w \n".indexOf(e[t+2].char))}function y(e){const t=[];return i.each(e,(e=>{const s=i.last(t),o=e.data;if(s instanceof n.UnhandledEntity){if(i.isString(o))return void s.appendText(o);if(o instanceof n.UnhandledEntity)return void s.appendText(o.text())}i.isString(o)?t.push(new n.UnhandledEntity(o)):t.push(o)})),t}function _(e){const t=new n.UnhandledEntity;return i.each(e,(e=>{const s=e.data;i.isString(s)?t.appendText(s):t.appendText(s.text())})),[t]}function v(e,t){let s=t;for(;s+1<e.length&&(0,r.default)(e[s+1],e[s]);)s++;return s}function C(e,t){const s=[];let o=0;const r=e.length;for(let c=0;c<r;c++){const h=i.find(u,(s=>e[c].char===s.raw_pre[0]&&!i.includes(t,s)));if(h&&f(e,c)){for(let i=v(e,c)+1;i<r&&(h.matchType!==d.MT_SPAN||(a=e[i].char,!g.test(a)));i++)if(e[i].char===h.raw_post[0]&&f(e,i)){if(i=v(e,i),o<c){const t=e.slice(o,c);s.push(y(t))}if(c+1<i){const o=e.slice(c+1,i),r=h.type!==l.WT_CODE?C(o,t.concat(h)):_(o),a=new n.WikiMarkupEntity(r,h.tag,h.raw_pre,h.raw_post);s.push([a])}c=i,o=c+1;break}}}var a;return s.length?(o!==e.length&&s.push(y(e.slice(o))),i.flatten(s)):y(e)}function b(e,t,s,i){const o=new RegExp("^"+e+"\\s+\\S"),n=new RegExp("^"+e+"\\s+");return o.test(t)||n.test(t)&&s+1<i}t.splitWikiMarkupPrefix=function(e,t,s){const o=i.clone(e),r=o[0]instanceof n.UnhandledEntity?0:o.length>1&&o[0]instanceof n.QuoteEntity&&o[1]instanceof n.UnhandledEntity?1:-1;let l=c.None;if(r>-1&&!t&&!s){const e=o[r].text();a.default.getS4LMessagingFeaturesNoSubscription().enableDoNotFormat&&b("!!",e,r,o.length)?l=c.DoNotFormat:b("@@",e,r,o.length)&&(l=c.NoWiki),l!==c.None&&(o[r]=new n.UnhandledEntity(e.substr(3)))}return{entities:o,prefix:l}},t.encodeWikiMarkupWithoutPrefix=function(e){if(!e||!e.length)return e;const t=function(e){return(0,o.chain)(e,(0,o.map)((e=>e instanceof n.UnhandledEntity?e.text():e)),(0,o.flatten)(),(0,o.map)((e=>{if(!i.isString(e)){const t=e;if(t instanceof n.QuoteEntity)return[{char:"h",data:t},{char:"\n",data:""}];if(t instanceof n.EditMessageMetaDataEntity||t instanceof n.ContextEntity)return{char:"w",data:t};const s=t.text();return{char:s&&g.test(s)?"\r":"h",data:t}}const t=e,s=[],o=t.length;for(let e=0;e<o;){let i;if(p.indexOf(t.charAt(e))>-1){const s=u.length;for(let o=0;o<s;o++){const s=u[o];if(s.raw_pre===t.substr(e,s.raw_pre.length)?i=s.raw_pre:s.raw_post===t.substr(e,s.raw_post.length)&&(i=s.raw_post),i)break}}if(i)s.push({char:t.charAt(e),data:i}),e+=i.length;else{const i=t.charAt(e),o={char:g.test(i)?"\n":m.test(i)?"!":S.test(i)?" ":"a",data:i};s.push(o),e++}}return s})),(0,o.flatten)(),(e=>{const t=[];return i.each(e,(e=>{const s=i.last(t);s&&s.char===e.char&&"\n! a".indexOf(e.char)>-1?s.data=s.data+e.data:t.push(e)})),t}))}(e);return C(t,[])}},65976:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getDocumentUrls=t.getDocumentId=t.getLegacyDocumentUrl=t.getDocumentUrl=t.getLegacyDisplayUrl=t.getDisplayUrl=t.isStaticAsyncMediaUrl=t.isAsyncMediaUrl=t.getCreateDocumentUrl=t.getCdnUrl=t.getAmsLoginFallbackUrl=t.getFileCacheKeyMediaThumbForId=t.getFileCacheKeyMediaThumb=t.getFileCacheKeyMediaForId=t.getFileCacheKeyMedia=t.checkIfSafeDomainToRender=t.getUploadContentId=t.getDownloadStatusUrl=t.getDownloadUrl=t.getUploadStatusUrl=t.getUploadUrl=t.getDownloadViewId=t.AmsCookieName=t.defaultContentId=void 0;const i=s(96486),o=s(89391),n=s(25638),r=s(46096),a=s(36237),l=s(78262),d=s(27795),c=s(26712);function h(e,s=l.MediaViewSize.Thumbnail){let i;switch(e){case l.UploadFileType.GroupAvatar:i="swx_avatar",s===l.MediaViewSize.Full&&(i="avatar_fullsize");break;case l.UploadFileType.Picture:i="imgt1_anim",s===l.MediaViewSize.Full?i="imgpsh_fullsize_anim":s===l.MediaViewSize.ThumbnailUncropped?i="imgpsh_thumbnail_sx":s===l.MediaViewSize.MobilePreview?i="imgpsh_mobile_save_anim":s===l.MediaViewSize.ThumbnailBlurred&&(i="imgpsh_thumbnail_blurred");break;case l.UploadFileType.Video:case l.UploadFileType.VideoMessage:i="thumbnail",s===l.MediaViewSize.Full?i="video":s===l.MediaViewSize.ThumbnailBlurred&&(i="thumbnail_blurred");break;case l.UploadFileType.Audio:case l.UploadFileType.AudioMessage:i="audio";break;default:i=t.defaultContentId}return i}function u(e,t){return v(e)+"/content/"+g(t)}function p(e,t){return v(e)+"/views/"+t}function g(e){const s=o.default.getS4LCMCFeatures();switch(e){case l.UploadFileType.Picture:return"imgpsh";case l.UploadFileType.Thumbnail:return"thumbnail";case l.UploadFileType.Video:return s.serverVideoTranscoding.enabled?"original":"video";case l.UploadFileType.VideoMessage:return s.serverVideoTranscoding.enabled||o.default.isDesktopVIMEnabled()?"original":"video";case l.UploadFileType.Audio:case l.UploadFileType.AudioMessage:return"audio";case l.UploadFileType.GroupAvatar:return"avatar";default:return t.defaultContentId}}function m(e,t){return e+t}function S(e,t){return e+t+"_thumb"}function f(){return o.default.getConfigSettingsNoSubscription().loginSkype.host+"login/sso"}function y(){return o.default.getConfigSettingsNoSubscription().asm.cdnUrl}function _(e,t,s=l.MediaViewSize.Thumbnail){return v(e)+"/views/"+h(t,s)}function v(e){const t=o.default.getAsyncMediaFeatures(),s=i.replace(t.ams_doc_url_format,"{0}",t.ams_base_url);return i.replace(s,"{1}",e)}function C(e){return"https://api.asm.skype.com/v1/objects/"+e}t.defaultContentId="original",t.AmsCookieName="skypetoken_asm",t.getDownloadViewId=h,t.getUploadUrl=u,t.getUploadStatusUrl=function(e,t){return u(e,t)+"/status"},t.getDownloadUrl=p,t.getDownloadStatusUrl=function(e,t){return p(e,t)+"/status"},t.getUploadContentId=g,t.checkIfSafeDomainToRender=function(e,t){if(!e)return!1;const s=c.default.isFileOrBlob(e)||!o.default.getS4LMessagingFeatures().enableSafeDomainRendering||o.default.isTrustedDomain(e,!1);if(!s){const s=c.default.getDomainName(e);a.warn(r.LogTraceArea.GenericUnsafe,t,"The domain",s,"is not whitelisted in ECS. The domain needs to be reviewed and approved by InfoSec."),a.track(new d.UnsafeDomain(s,t))}return s},t.getFileCacheKeyMedia=function(e,t){const s=m(e.conversationId,e.cuid);return o.default.getS4LMessagingFeaturesNoSubscription().enableFullResolutionImageDownload&&t?s+"_fullRes":s},t.getFileCacheKeyMediaForId=m,t.getFileCacheKeyMediaThumb=function(e){return S(e.conversationId,e.cuid)},t.getFileCacheKeyMediaThumbForId=S,t.getAmsLoginFallbackUrl=f,t.getCdnUrl=y,t.getCreateDocumentUrl=function(){const e=o.default.getAsyncMediaFeatures();return i.replace(e.ams_create_document_url_format,"{0}",e.ams_base_url)},t.isAsyncMediaUrl=function(e){const t=o.default.getAsyncMediaFeatures().ams_base_url,s=c.default.getURIComponents(t),i=c.default.getURIComponents(e);return c.default.areHostsSame(s,i)},t.isStaticAsyncMediaUrl=function(e){const t=c.default.getURIComponents(y()),s=c.default.getURIComponents(e);return c.default.areHostsSame(t,s)},t.getDisplayUrl=_,t.getLegacyDisplayUrl=function(e,t,s=l.MediaViewSize.Thumbnail){return C(e)+"/views/"+h(t,s)},t.getDocumentUrl=v,t.getLegacyDocumentUrl=C,t.getDocumentId=function(e){return new n.default(e).getDocumentId()},t.getDocumentUrls=function(e,t=l.UploadFileType.File){const s=v(e);let i,o;t!==l.UploadFileType.GroupAvatar&&t!==l.UploadFileType.Picture&&t!==l.UploadFileType.Video&&t!==l.UploadFileType.VideoMessage||(o=_(e,t,l.MediaViewSize.Thumbnail)),t!==l.UploadFileType.Picture&&t!==l.UploadFileType.Video&&t!==l.UploadFileType.VideoMessage&&t!==l.UploadFileType.Audio&&t!==l.UploadFileType.AudioMessage||(i=_(e,t,l.MediaViewSize.Full));let n="";return n=t===l.UploadFileType.Picture?f()+"?go=xmmfallback?pic="+e:t===l.UploadFileType.VideoMessage?f()+"?go=xmmfallback?vim="+e:t===l.UploadFileType.AudioMessage?f()+"?go=xmmfallback?am="+e:f()+"?go=webclient.xmm&docid="+e,{original:s,fullSize:i,fallback:n,preview:o}}},70804:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureMarkupUtils=void 0;class s{}t.CaptureMarkupUtils=s,s.filters=[{filterName:"Type9",accessibilityLabelTextPath:"CameraEffects.ColorFilterAccessibilityLabel"},{filterName:"Type4",accessibilityLabelTextPath:"CameraEffects.ColorFilterAccessibilityLabel"},{filterName:"Type6",accessibilityLabelTextPath:"CameraEffects.ColorFilterBWAccessibilityLabel"}]},60021:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getCorrelationIdFromMessageParts=t.getCorrelationIdForMessage=void 0;const i=s(96486),o=s(81169),n=s(71830),r=s(40276),a=s(18078);function l(e,t,s){let l=t;n.isOneOnOneConversation(l)&&!n.isThread(l)&&(a.default.isMyMri(e)||(l=a.default.getSkypeMri()));const d=e+"|"+l+"|"+s;return(0,o.chain)(r.computeSHA256(d),(0,o.take)(16),(0,o.map)((e=>i.padStart(e.toString(16),2,"0"))),(0,o.join)(""))}t.getCorrelationIdForMessage=function(e){return l(e.creator,e.conversationId,e.getOriginalClientMessageId())},t.getCorrelationIdFromMessageParts=l},51077:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isCallMessageType=t.isCallInfoForCallMessageType=t.isCallInfoMessageType=t.isScheduledCallMetadataType=t.isThreadActivityType=t.isHtmlMessageType=t.isJsonMessageType=t.isXmlMessageType=t.isDeletedMessage=t.getEditTime=t.getMessageTranslationMetadata=t.getTranslationSettingsState=t.getTranslationSettingsMetadata=t.getForwardMetadata=t.getUrlPreviewMetadata=t.isDoNotFormatType=t.getSmsDeliveryReport=t.getScheduledCallMetadata=t.getPollMetadata=t.getBookmarkSourceMetadata=t.getBookmarkMetadata=t.isPollUsingCustomProp=t.flattenEmotionMetadata=t.getCleanedEmotionMetadata=t.getEmotionMetadata=t.getScheduledCallConsumptionHorizons=t.getScheduledCallInviteData=t.getForwardedTeamsProperties=t.getTeamsFileProperties=t.getTeamsMentionProperties=t.getJsonFromMessageProperty=t.removeVoteForUser=t.addOrUpdateVoteForUser=t.getBookmarkMetadataForUser=t.addOrUpdateBookmarkMetadataForUser=t.removeBookmarkMetadataForUser=t.addOrUpdateEmotionMetadataForUser=t.removeEmotionMetadataForUser=t.addEmotionMetadataForUser=t.MessageAnnotations=t.MessageTypeGroups=t.UriObjectTypeSubTypes=t.UriObjectMessageTypes=t.MessageTypes=t.MessageBaseTypes=t.ContentTypes=t.TeamsMentionTypes=t.TeamsItemTypes=t.TeamsMessageProperties=t.MessageProperties=void 0,t.shouldServerMessageBeFilteredOut=t.getRenderingKindForUriObject=t.isWrittenTextMessageType=t.getMessageTypeGroup=t.isHighlightMessageType=t.isEventCallEndedMessageType=t.isEventCallStartedMessageType=t.hasEmoticons=t.contentContainsUriObjectExceptFile=t.contentContainsUriObject=t.hasAllAtMention=t.hasQuote=t.hasAtMention=t.isSmsDeliveredSuccessfully=t.isCallOrSmsMessageType=t.isEncryptedMessageType=t.isRichTextMessageType=t.isGuestNameUpdateMessageType=t.isTranslationMessageType=t.isCaptionMessageType=t.isPollType=t.isScheduledCallType=t.isMessageSms=t.isJoiningEnabledUpdateMessageType=t.isTopicUpdateMessageType=t.isHistoryDisclosedHiddenUpdateType=t.isJoinedCreatorMessageType=t.isAddMemberMessageType=t.isContactMessageType=void 0;const i=s(96486),o=s(89391),n=s(98925),r=s(81169),a=s(46096),l=s(36237),d=s(19524),c=s(4057);var h,u;function p(e,s,o=t.MessageAnnotations.Like,n,r){let a=i.find(e,(e=>e.key===o));a||(a={key:o,users:[]},e.push(a));const l=Date.now(),d=i.isNumber(n)?n:l,c=i.find(a.users,(e=>e.mri===s));return c?(c.time=d,c.value=void 0===r?""+l:r):a.users.push({mri:s,value:void 0===r?""+l:r,time:d}),e}function g(e,t){const s=e?e[t]:void 0;if(s)return i.isString(s)?c.default.parseJsonErrorToUndefined(s):i.cloneDeep(s)}function m(e){return g(e,t.MessageProperties.ScheduledCallInviteData)}function S(e){const s=g(e,t.MessageProperties.Emotions);return i.isArray(s)?s:[]}function f(e){const s=g(e,t.MessageProperties.PollData);return!i.isUndefined(s)}function y(e){const s=g(e,t.MessageProperties.Poll);return i.isArray(s)?s:[]}function _(e){const t=c.default.parseJsonErrorToUndefined(e);if(t&&t.data)return t.data}t.MessageProperties={Emotions:"emotions",UrlPreviews:"urlpreviews",ForwardMetadata:"forwardMetadata",Prototype:"prototype_skypex",CastParentThreadId:"castParentThreadId",SuggestedActions:"suggestedActions",EditTime:"edittime",DeleteTime:"deletetime",SmsDeliveryReports:"smsdeliveryreports",CellularRelayStatus:"cellularRelayStatus",PollData:"inlinePollData",ScheduledCallInviteData:"scheduledCallInviteData",AlbumId:"albumId",DoNotFormat:"doNotFormat",Skypeemoteoffset:"skypeemoteoffset",Poll:"poll",Starred:"starred",AdditionalData:"additionalData"},t.TeamsMessageProperties={Mentions:"mentions",Files:"files"},t.TeamsItemTypes={Emoticon:"http://schema.skype.com/Emoji",Mention:"http://schema.skype.com/Mention",File:"http://schema.skype.com/File"},t.TeamsMentionTypes={Person:"person",Channel:"channel",Team:"team"},t.ContentTypes={Text:"text",Xml:"text/xml; charset=UTF-8",Event:"json/event"},t.MessageBaseTypes={Message:"Message",Event:"Event"},function(e){e.Text="Text",e.RichText="RichText",e.PopCard="PopCard",e.Notice="Notice",e.SignalRelay="Signal/Relay",e.LegacyNudge="Nudge",e.Poll="Poll",e.UriObject="RichText/UriObject",e.Media_Card="RichText/Media_Card",e.Media_FlikMsg="RichText/Media_FlikMsg",e.Media_GenericFile="RichText/Media_GenericFile",e.ScheduledCallInvite="RichText/ScheduledCallInvite",e.SkypeVideoMessage="Event/SkypeVideoMessage",e.Media_Video="RichText/Media_Video",e.VideoMessage="RichText/Media_Video",e.CastRecording="RichText/Media_CallRecording",e.Media_Audio="RichText/Media_AudioMsg",e.AudioMessage="RichText/Media_AudioMsg",e.VoiceMail="RichText/Media_VoiceMail",e.Call="Event/Call",e.Typing="Control/Typing",e.ClearTyping="Control/ClearTyping",e.LiveState="Control/LiveState",e.Contacts="RichText/Contacts",e.Files="RichText/Files",e.Sms="RichText/Sms",e.Mms="RichText/Mms",e.Location="RichText/Location",e.CallerID="RichText/CallerID",e.MediaAlbum="RichText/Media_Album",e.AddMember="ThreadActivity/AddMember",e.DeleteMember="ThreadActivity/DeleteMember",e.RoleUpdate="ThreadActivity/RoleUpdate",e.TopicUpdate="ThreadActivity/TopicUpdate",e.PictureUpdate="ThreadActivity/PictureUpdate",e.HistoryDisclosedUpdate="ThreadActivity/HistoryDisclosedUpdate",e.JoiningEnabledUpdate="ThreadActivity/JoiningEnabledUpdate",e.LegacyMemberAdded="ThreadActivity/LegacyMemberAdded",e.LegacyMemberUpgraded="ThreadActivity/LegacyMemberUpgraded",e.HighlightsFollow="ThreadActivity/HighlightsFollow",e.HighlightsAdd="ThreadActivity/HighlightsAdd",e.HighlightsRefuseFollow="ThreadActivity/HighlightsRefuseFollow",e.HighlightsRemoveFollow="ThreadActivity/HighlightsRemoveFollow",e.HighlightsRefuseAdd="ThreadActivity/HighlightsRefuseAdd",e.HighlightsRemoveAdd="ThreadActivity/HighlightsRemoveAdd",e.ScheduledCallNowReminder="ThreadActivity/ScheduledCallNowReminder",e.ScheduledCallUpdate="ThreadActivity/ScheduledCallUpdate",e.ScheduledCallCancellation="ThreadActivity/ScheduledCallCancellation",e.ScheduledCallRSVP="ThreadActivity/ScheduledCallRSVP",e.HandshakeInvite="ThreadActivity/E2EEHandshakeInvite",e.HandshakeAccept="ThreadActivity/E2EEHandshakeAccept",e.HandshakeComplete="ThreadActivity/E2EEHandshakeComplete",e.HandshakeReject="ThreadActivity/E2EEHandshakeReject",e.ModeratedThreadUpdate="ThreadActivity/ModeratedThreadUpdate",e.CallInfo="RichText/Cast",e.InviteFreeText="InviteFreeRelationshipChanged/Initialized",e.InviteFreeConversationAccepted="InviteFreeRelationshipChanged/ConversationAccepted",e.EncryptedText="EndToEndEncryption/EncryptedText",e.EncryptedMedia="EndToEndEncryption/EncryptedMedia",e.EncryptedCall="Event/EncryptedCall",e.TeamsHtml="RichText/Html",e.TeamsFile="Spaces/File",e.TeamsMeetingMemberLeft="ThreadActivity/MemberLeft",e.TeamsMeetingMemberJoined="ThreadActivity/MemberJoined",e.TeamsTabUpdated="ThreadActivity/TabUpdated",e.Caption="Caption",e.SignalCaption="Signal/Caption",e.Translation="Translation",e.Data="Data",e.TranslationSettings="TranslationSettings",e.HistoryActivityDeleteMessage="HistoryActivity/DeleteMessage",e.GuestNameUpdate="Guest/NameUpdate"}(h||(h={})),t.MessageTypes=h,t.UriObjectMessageTypes=[t.MessageTypes.UriObject,t.MessageTypes.EncryptedMedia,t.MessageTypes.Media_Card,t.MessageTypes.Media_FlikMsg,t.MessageTypes.Media_GenericFile,t.MessageTypes.Media_Video,t.MessageTypes.Media_Audio,t.MessageTypes.VideoMessage,t.MessageTypes.CastRecording,t.MessageTypes.AudioMessage,t.MessageTypes.CallInfo,t.MessageTypes.ScheduledCallInvite,t.MessageTypes.Poll,t.MessageTypes.Data,t.MessageTypes.TranslationSettings,t.MessageTypes.MediaAlbum],t.UriObjectTypeSubTypes={Video:{CallRecording:"CallRecording",Flik:"Flik",Message:"Message"},Audio:{Message:"Message"}},function(e){e[e.None=1]="None",e[e.Text=2]="Text",e[e.System=3]="System",e[e.Picture=4]="Picture",e[e.Video=5]="Video",e[e.Audio=6]="Audio",e[e.Moji=7]="Moji",e[e.Calling=8]="Calling",e[e.UriFile=9]="UriFile",e[e.SwiftCard=10]="SwiftCard",e[e.Location=11]="Location",e[e.SMS=12]="SMS",e[e.CallerID=13]="CallerID",e[e.Sticker=14]="Sticker",e[e.CellularMessage=15]="CellularMessage",e[e.Contact=16]="Contact",e[e.ScheduledCallInvite=17]="ScheduledCallInvite",e[e.Poll=18]="Poll",e[e.Gif=19]="Gif",e[e.Engagement=20]="Engagement",e[e.MediaAlbum=21]="MediaAlbum",e[e.Translation=22]="Translation"}(u=t.MessageTypeGroups||(t.MessageTypeGroups={})),t.MessageAnnotations={ReactionsConsumptionHorizon:"reactionsConsumptionHorizon",Like:"like",Heart:"heart",ViewCount:"viewCount",Bookmark:"bookmark",ScheduledCallInviteAccepted:"scheduledCallInviteAccepted",ScheduledCallInviteDeclined:"scheduledCallInviteDeclined"},t.addEmotionMetadataForUser=function(e,s,i=t.MessageAnnotations.Like,o){return p(e,s,i,void 0,o)},t.removeEmotionMetadataForUser=function(e,s,o=t.MessageAnnotations.Like){const n=i.find(e,(e=>e.key===o));return n&&(i.remove(n.users,(e=>e.mri===s)),0===n.users.length&&i.remove(e,(e=>e.key===o))),e},t.addOrUpdateEmotionMetadataForUser=p,t.removeBookmarkMetadataForUser=function(e,s){const o=t.MessageAnnotations.Bookmark,n=i.find(e,(e=>e.key===o));return n&&(i.remove(n.users,(e=>e.mri===s)),0===n.users.length&&i.remove(e,(e=>e.key===o))),e},t.addOrUpdateBookmarkMetadataForUser=function(e,s,o){const n=t.MessageAnnotations.Bookmark;let r=i.find(e,(e=>e.key===n));r||(r={key:n,users:[]},e.push(r));const a=Date.now(),l=i.find(r.users,(e=>e.mri===s));return l?(l.time=a,l.value=JSON.stringify(i.merge(c.default.parseJsonErrorToUndefined(l.value),o))):r.users.push({mri:s,value:JSON.stringify(o),time:a}),e},t.getBookmarkMetadataForUser=function(e,s){const o=y(e),n=i.find(o,(e=>e.key===t.MessageAnnotations.Bookmark));if(!n)return;const r=i.find(n.users,(e=>e.mri===s));return r?c.default.parseJsonErrorToUndefined(r.value):void 0},t.addOrUpdateVoteForUser=function(e,t,s){let o=i.find(e,(e=>e.key===s));o||(o={key:s,users:[]},e.push(o));const n=i.indexOf(e,o),r=Date.now();let a=i.find(o.users,(e=>e.mri===t));if(a)a=Object.assign(Object.assign({},a),{time:r});else{const e={mri:t,time:r},s=[...o.users,e];o=Object.assign(Object.assign({},o),{users:s})}return e[n]=o,e},t.removeVoteForUser=function(e,t,s){let o=i.find(e,(e=>e.key===s));if(o){i.find(o.users,(e=>e.mri===t))&&i.remove(o.users,(e=>e.mri===t))}return e},t.getJsonFromMessageProperty=g,t.getTeamsMentionProperties=function(e){return g(e,t.TeamsMessageProperties.Mentions)},t.getTeamsFileProperties=function(e){return g(e,t.TeamsMessageProperties.Files)},t.getForwardedTeamsProperties=function(e){return i.pick(e,[t.TeamsMessageProperties.Mentions,t.TeamsMessageProperties.Files])},t.getScheduledCallInviteData=m,t.getScheduledCallConsumptionHorizons=function(e){const t=m(e);return t&&t.consumptionHorizons?t.consumptionHorizons:{}},t.getEmotionMetadata=S,t.getCleanedEmotionMetadata=function(e){return i.filter(S(e),(e=>e.key!==t.MessageAnnotations.ViewCount&&e.key!==t.MessageAnnotations.ReactionsConsumptionHorizon))},t.flattenEmotionMetadata=function(e){return(0,r.chain)(e,(0,r.map)((e=>i.map(e.users,(t=>({key:e.key,time:t.time||0,mri:t.mri}))))),(0,r.flatten)(),(0,r.sortBy)((e=>e.time)))},t.isPollUsingCustomProp=f,t.getBookmarkMetadata=function(e){return g(e,t.MessageProperties.Starred)},t.getBookmarkSourceMetadata=y,t.getPollMetadata=function(e){const s=f(e)?g(e,t.MessageProperties.PollData):g(e,t.MessageProperties.Emotions);return i.isArray(s)?s:[]},t.getScheduledCallMetadata=function(e){const s=g(e,t.MessageProperties.Emotions);return i.isArray(s)?s:[]},t.getSmsDeliveryReport=function(e){const s=g(e,t.MessageProperties.SmsDeliveryReports);if(s&&s.length>0&&s[0].users&&s[0].users.length>0)return c.default.parseJsonErrorToUndefined(s[0].users[0].value)},t.isDoNotFormatType=function(e){return!!g(e,t.MessageProperties.DoNotFormat)},t.getUrlPreviewMetadata=function(e){const s=g(e,t.MessageProperties.UrlPreviews);return i.isArray(s)?s:[]},t.getForwardMetadata=function(e){return g(e,t.MessageProperties.ForwardMetadata)||{isForwarded:!1}},t.getTranslationSettingsMetadata=_,t.getTranslationSettingsState=function(e){const t=_(e);if(t){const e=parseInt(n.TranslationState[t.newTranslationState],10);if(e in n.TranslationState)return e}},t.getMessageTranslationMetadata=function(e){const t=c.default.parseJsonErrorToUndefined(e);if(t&&t.translations)return t},t.getEditTime=function(e){const s=g(e,t.MessageProperties.EditTime);if(s)return s};const v=/<\/?e_m[^<>]*>/gi,C=/(<legacyquote[^>]*?\/>|<legacyquote[^>]*>[^]*?<\/legacyquote>)/gi;function b(e){const s=(e||"").toLowerCase();return i.includes([t.MessageTypes.Mms.toLowerCase(),t.MessageTypes.Translation.toLowerCase(),t.MessageTypes.Data.toLowerCase(),t.MessageTypes.TranslationSettings.toLowerCase()],s)}function T(e){if(!o.default.getS4LMessagingFeaturesNoSubscription().enableParsingHtmlMessages)return!1;return(e||"").toLowerCase()===t.MessageTypes.TeamsHtml.toLowerCase()}function M(e){return e.messagetype===t.MessageTypes.CallInfo}function I(e){return e.messagetype===t.MessageTypes.Call||e.messagetype===t.MessageTypes.EncryptedCall}function w(e,s,o){return e===t.MessageTypes.AddMember&&i.includes(s,`<target>${o}</target>`)}function P(e,s){return e===t.MessageTypes.HistoryDisclosedUpdate&&i.includes(s,"<value>false</value>")}function k(e){return e===t.MessageTypes.TopicUpdate}function A(e){return e===t.MessageTypes.Sms}function E(e){return e===t.MessageTypes.GuestNameUpdate}function R(e){return/<URIObject/.test(e)}function L(e){if(!e||!e.messagetype)return u.None;const s=e.messagetype;switch(s){case t.MessageTypes.UriObject:return x(e);case t.MessageTypes.Media_FlikMsg:return u.Moji;case t.MessageTypes.Media_GenericFile:case t.MessageTypes.EncryptedMedia:return u.UriFile;case t.MessageTypes.Media_Video:case t.MessageTypes.VideoMessage:case t.MessageTypes.CastRecording:return u.Video;case t.MessageTypes.Media_Audio:case t.MessageTypes.AudioMessage:return u.Audio;case t.MessageTypes.MediaAlbum:return u.MediaAlbum;case t.MessageTypes.CallInfo:case t.MessageTypes.Call:case t.MessageTypes.EncryptedCall:return u.Calling;case t.MessageTypes.Media_Card:return u.SwiftCard;case t.MessageTypes.CallerID:return u.CallerID;case t.MessageTypes.RichText:case t.MessageTypes.Text:case t.MessageTypes.InviteFreeText:case t.MessageTypes.EncryptedText:case t.MessageTypes.ScheduledCallInvite:case t.MessageTypes.Poll:case t.MessageTypes.Caption:case t.MessageTypes.SignalCaption:return x(e);case t.MessageTypes.Location:return u.Location;case t.MessageTypes.Contacts:return u.Contact;case t.MessageTypes.Files:return u.Text;case t.MessageTypes.Sms:return u.SMS;case t.MessageTypes.Mms:return function(e){return-1!==e.content.indexOf('"object_id"')?u.Picture:u.SMS}(e);case t.MessageTypes.AddMember:case t.MessageTypes.DeleteMember:case t.MessageTypes.RoleUpdate:case t.MessageTypes.TopicUpdate:case t.MessageTypes.PictureUpdate:case t.MessageTypes.HistoryDisclosedUpdate:case t.MessageTypes.JoiningEnabledUpdate:case t.MessageTypes.LegacyMemberAdded:case t.MessageTypes.LegacyMemberUpgraded:case t.MessageTypes.HighlightsFollow:case t.MessageTypes.HighlightsRefuseFollow:case t.MessageTypes.HighlightsRemoveFollow:case t.MessageTypes.HighlightsRefuseAdd:case t.MessageTypes.HighlightsRemoveAdd:case t.MessageTypes.HandshakeInvite:case t.MessageTypes.HandshakeAccept:case t.MessageTypes.HandshakeComplete:case t.MessageTypes.HandshakeReject:case t.MessageTypes.ModeratedThreadUpdate:case t.MessageTypes.ScheduledCallNowReminder:case t.MessageTypes.ScheduledCallCancellation:case t.MessageTypes.ScheduledCallUpdate:case t.MessageTypes.ScheduledCallRSVP:case t.MessageTypes.Data:case t.MessageTypes.TranslationSettings:case t.MessageTypes.GuestNameUpdate:return u.System;case t.MessageTypes.HighlightsAdd:case t.MessageTypes.LegacyNudge:case t.MessageTypes.Typing:case t.MessageTypes.ClearTyping:case t.MessageTypes.SignalRelay:case t.MessageTypes.LiveState:case t.MessageTypes.SkypeVideoMessage:case t.MessageTypes.VoiceMail:case t.MessageTypes.InviteFreeConversationAccepted:return u.None;case t.MessageTypes.Notice:case t.MessageTypes.PopCard:return u.Engagement;case t.MessageTypes.Translation:return u.Translation;case t.MessageTypes.TeamsHtml:return u.Text;case t.MessageTypes.TeamsFile:case t.MessageTypes.TeamsMeetingMemberLeft:case t.MessageTypes.TeamsMeetingMemberJoined:case t.MessageTypes.TeamsTabUpdated:return l.log(a.LogTraceArea.ChatService,`Unsupported 'Teams' MessageType received: ${s}`),u.None;case t.MessageTypes.HistoryActivityDeleteMessage:return l.log(a.LogTraceArea.ChatService,`Unsupported 'Windows Phone' MessageType received: ${s}`),u.None;default:return l.error(a.LogTraceArea.ChatService,"Unhandled Message Type: "+e.messagetype),u.None}}t.isDeletedMessage=function(e){if(!e.content)return!0;if(!e.skypeeditoffset&&!e.skypeemoteoffset&&"<"!==e.content[0])return!1;const t=(0|Number(e.skypeeditoffset))+(0|Number(e.skypeemoteoffset));return e.content.length<=t||"<"===e.content[t]&&">"===i.last(e.content)&&0===e.content.substr(t).replace(v,"").replace(C,"").length},t.isXmlMessageType=function(e){if(T(e))return!1;const s=(e||"").toLowerCase();return s!==t.MessageTypes.Text.toLowerCase()&&s!==t.MessageTypes.InviteFreeText.toLowerCase()&&!b(e)&&0!==s.indexOf("control")},t.isJsonMessageType=b,t.isHtmlMessageType=T,t.isThreadActivityType=function(e){return 0===(e||"").toLowerCase().indexOf("threadactivity")||E(e)},t.isScheduledCallMetadataType=function(e){return-1!==(e||"").toLowerCase().indexOf("scheduledcall")},t.isCallInfoMessageType=M,t.isCallInfoForCallMessageType=function(e){return M(e)&&-1!==e.content.indexOf('containerType="Call')},t.isCallMessageType=I,t.isContactMessageType=function(e){return e.messagetype===t.MessageTypes.Contacts},t.isAddMemberMessageType=function(e){return e===t.MessageTypes.AddMember},t.isJoinedCreatorMessageType=w,t.isHistoryDisclosedHiddenUpdateType=P,t.isTopicUpdateMessageType=k,t.isJoiningEnabledUpdateMessageType=function(e){return e===t.MessageTypes.JoiningEnabledUpdate},t.isMessageSms=A,t.isScheduledCallType=function(e){return e===t.MessageTypes.ScheduledCallInvite},t.isPollType=function(e){return e===t.MessageTypes.Poll},t.isCaptionMessageType=function(e){return e===t.MessageTypes.Caption||e===t.MessageTypes.SignalCaption},t.isTranslationMessageType=function(e){return e===t.MessageTypes.Translation},t.isGuestNameUpdateMessageType=E,t.isRichTextMessageType=function(e=""){return 0===e.indexOf("RichText")},t.isEncryptedMessageType=function(e=""){return 0===e.indexOf("EndToEndEncryption")},t.isCallOrSmsMessageType=function(e){return I(e)||A(e.messagetype)},t.isSmsDeliveredSuccessfully=function(e){const{status:t,errorCategory:s}=e;return t===d.SkypeSmsDeliveryStatus.Success&&s===d.SkypeSmsErrorCategory.NoError||s===d.SkypeSmsErrorCategory.NumberBlocked},t.hasAtMention=function(e){return/<at\s+id/.test(e)},t.hasQuote=function(e){return/<quote\s+author/.test(e)},t.hasAllAtMention=function(e){return/<at\s+id="\*"/.test(e)},t.contentContainsUriObject=R,t.contentContainsUriObjectExceptFile=function(e){return R(e)&&!/^[^>]+type=['"]File['"\.]/i.test(e)},t.hasEmoticons=function(e){return/<ss\s+type=\".*\"/.test(e)||/<span[^>]*>\s*<img[^>]*itemid=".*"/.test(e)},t.isEventCallStartedMessageType=function(e){return e&&e.messagetype===t.MessageTypes.Call&&(0===e.content.indexOf("<partlist ")&&-1!==e.content.indexOf('type="started"',10)||0===e.content.indexOf('<partlist alt=""></partlist>'))},t.isEventCallEndedMessageType=function(e){return e&&""!==e.content&&e.messagetype===t.MessageTypes.Call&&0===e.content.indexOf("<partlist ")&&-1!==e.content.indexOf('type="ended"',10)},t.isHighlightMessageType=function(e){const t=L(e);return t===u.Picture||t===u.Video},t.getMessageTypeGroup=L;const F=[t.MessageTypes.RichText,t.MessageTypes.Text,t.MessageTypes.InviteFreeText,t.MessageTypes.EncryptedText];function x(e){if(!e.content||!i.startsWith(e.content,"<URIObject"))return u.Text;const t=e.content.match(/<URIObject[^>]*?\stype=\"([^"]+?)\"/i),s=e.content.match(/<meta[^>]*?\stype=\"([^"]+?)\"/i);if(!t)return s&&"photo"===s[1]?u.Picture:e.content.match(/<Swift/)?u.SwiftCard:u.Text;const o=t[1].split(".")[0];return"File"===o?u.UriFile:"Picture"===o?u.Picture:"Video"===o?u.Video:"SWIFT"===o?u.SwiftCard:"Sticker"===o?u.Sticker:"ScheduledCallInvite"===o?u.ScheduledCallInvite:"Poll"===o?u.Poll:"Video.1/Flik.1"===t[1]||"Video.1/Flik.2"===t[1]?u.Moji:u.Text}t.isWrittenTextMessageType=function(e){return i.includes(F,e)},t.getRenderingKindForUriObject=x,t.shouldServerMessageBeFilteredOut=function(e,t){const s=t.createdDate(),n=t.creator();if(s&&e.createdTime-s<o.default.getS4LCMCFeatures().serverMessagesAfterThreadCreationTimeWindow){const t=[w,k,P];return i.some(t,(t=>t(e.messagetype,e.content,n)))}return!1}},71830:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isDisplayableStrippedMri=t.isConversationWithPhoneNumber=t.isPhoneMri=t.isOneToOneThreadUserMriNamespace=t.isMriNamespaceUser=t.isUserMri=t.isAllGlobalClearMri=t.asSkypeId=t.asSkypeThreadId=t.asSkypeThreadIdMaybe=t.asMri=t.asMriMaybe=t.isSkypeId=t.isMri=t.replaceNamespace=t.sanitizeMri=t.idAndNamespaceToMri=t.skypeIdToMri=t.getThreadPropsInConversationView=t.ThreadPropsInConversationView=t.ConnectorPrefixes=t.SubscriptionTypes=t.ServerUserProps=t.UserProps=t.newConnectionAcceptedPropValue=t.ConversationProps=t.ThreadProps=t.ConnectorThreadPropPrefix=t.V2ThreadIdSuffix=t.BookmarksThreadId=t.P2PSkypeThreadIdSuffix=t.SkypeThreadIdSuffix=t.OneToOneThreadIdSuffix=t.EncryptedThreadIdSuffix=t.ReactionThreadIdSuffix=t.HighlightsThreadIdSuffix=t.SkonsoleMri=t.AllGlobalClearMri=t.ThreadTypes=t.Namespaces=t.ChatServiceErrors=t.BotHighlightMessageContent=t.RecentMessageHistoryTimePeriodHighlights=t.RecentMessageHistoryTimePeriod=t.MinimumConversationsToTryToShow=t.BeginningOfTime=t.GuestUserMriPrefix=t.OrgIdUserPrefix=t.CIDPostfix=t.CIDPrefix=void 0,t.isComposingStateSupported=t.getReactionsThreadMriForCallId=t.getReactionThreadIdForCallId=t.getSkypeIdFromHighlightsThreadMri=t.getHighlightsThreadMriForSkypeId=t.getMemberMrisWithoutMe=t.getSkypeMriFromBotHighlightsThreadMri=t.isV2Thread=t.isP2PSkypeThread=t.isSkypeThread=t.isOneToOneThread=t.isEncryptedThread=t.isSmsMmsThread=t.isReactionsThread=t.isMyHighlightThread=t.isMergingBotHighlightMessageRaw=t.isBotHighlightsThread=t.isHighlightsThread=t.getConversationLinkWithNewId=t.getCreatorMriForMessageFromLink=t.getConnectorIntegrationIdFromMri=t.getMriFromS4BId=t.getMriFromPhoneNumberString=t.getMriFromPhoneNumber=t.getPhoneNumberFromMri=t.getSkypeIdFromMri=t.isOrgIdUserMri=t.isGuestUserMri=t.isS4BBridgeMri=t.isMsaMri=t.isSkypeIdMri=t.isBlockedPSTNMri=t.isCallLog=t.isEcho=t.isConnector=t.isGalleryInConversationSupported=t.isSearchInConversationSupported=t.isAgent=t.isThread=t.isGroupConversation=t.isBookmarkConversation=t.isOneOnOneConversation=t.stripMriNamespace=t.getMriNamespace=t.splitSkypeId=t.splitMri=t.isConciergeBotMri=t.isReadOnlyConversation=t.isValidNamespaceMri=t.isMriWithUserMetadata=void 0,t.getTcidDataFromServerMessageResponse=t.isValidPresenceMri=t.getTextualEndpointInfo=t.getEndpointIdFromPresenceDoc=t.formatEndpointIdRemoveBrackets=t.formatEndpointId=t.areEndpointIdsEqual=t.getMriTypeForTelemetry=t.getThreadSuffix=t.isDogfoodCloudUrl=t.getEpidFromUri=t.findPushSubscriptionInfo=t.createLongPollSubscriptionParams=t.createPushSubscriptionParams=t.ChannelTypes=t.getRegistrationTokenFromHeader=t.getSkypetokenFromAuthenticationHeader=t.REGISTRATION_TOKEN_HEADER_PREFIX=t.SKYPE_TOKEN_HEADER_PREFIX=t.getClientCapabilities=t.getClientInfoString=t.areEndpointPresenceDocsEqual=t.buildEndpointPresenceDocData=t.getEndpointFeaturesList=t.getExpiresFromRegToken=t.getEndpointIdFromRegToken=t.filterMembersProp=t.encodeEndpointInfoForLog=t.encodeSyncStateForLog=t.decodeSyncState=t.getHoverTitle=t.getLastSeenPresenceText=t.encodeStatus=t.parseStatus=t.parseAvailability=t.unescapeTextWithoutXml=t.getParsedConversationId=t.parseConversationId=t.getNewestConsumptionHorizon=t.isConsumptionHorizonNewer=t.getCuidFromConsumptionHorizon=t.getConsumptionHorizonUpdateTime=t.getServerTimestampFromConsumptionHorizon=t.getConsumptionHorizonForMessageAndCHID=t.getConsumptionHorizonForMessage=t.getCHIDForMessage=t.getCuidForMessage=t.updateConsumptionHorizonWithCurrentClientTime=t.buildOneOnOneEncryptedThreadId=t.buildOneOnOneThreadId=void 0,t.isNotFound=t.getRedirectUrl=t.isEndpointMissing=t.isRedirect=t.getConnectionTypeFromUrl=void 0;const i=s(96486),o=s(96073),n=s(89391),r=s(2040),a=s(51077),l=s(90239),d=s(40276),c=s(46096),h=s(61253),u=s(47662),p=s(33754),g=s(18078),m=s(53469),S=s(40363),f=s(26712),y=s(53374);var _;let v;var C,b;t.CIDPrefix=":cid-(",t.CIDPostfix=")@outlook.com",t.OrgIdUserPrefix="orgid:",t.GuestUserMriPrefix="guest:",t.BeginningOfTime=2,t.MinimumConversationsToTryToShow=50,t.RecentMessageHistoryTimePeriod=12096e5,t.RecentMessageHistoryTimePeriodHighlights=6048e5,t.BotHighlightMessageContent='highlight="true"',function(e){e[e.CT_UNKNOWN=0]="CT_UNKNOWN",e[e.CT_DESKTOP=1]="CT_DESKTOP",e[e.CT_WEB_MESSENGER=2]="CT_WEB_MESSENGER",e[e.CT_WINDOWS_MOBILE=3]="CT_WINDOWS_MOBILE",e[e.CT_XBOX=4]="CT_XBOX",e[e.CT_ZUNE=5]="CT_ZUNE",e[e.CT_IPHONE=6]="CT_IPHONE",e[e.CT_MAC_MESSENGER=7]="CT_MAC_MESSENGER",e[e.CT_SMS_MESSENGER=8]="CT_SMS_MESSENGER",e[e.CT_MODERN_MESSENGER=9]="CT_MODERN_MESSENGER",e[e.CT_SKYPE_OTHER=10]="CT_SKYPE_OTHER",e[e.CT_SKYPE_WINDOWS=11]="CT_SKYPE_WINDOWS",e[e.CT_SKYPE_WIN8=12]="CT_SKYPE_WIN8",e[e.CT_SKYPE_MAC=13]="CT_SKYPE_MAC",e[e.CT_SKYPE_LINUX=14]="CT_SKYPE_LINUX",e[e.CT_SKYPE_WINDOWS_PHONE=15]="CT_SKYPE_WINDOWS_PHONE",e[e.CT_SKYPE_IOS=16]="CT_SKYPE_IOS",e[e.CT_SKYPE_ANDROID=17]="CT_SKYPE_ANDROID",e[e.CT_SKYPE_SKYPEKIT=18]="CT_SKYPE_SKYPEKIT",e[e.CT_LAST=19]="CT_LAST"}(_||(_={})),function(e){e[e.AccessDenied=209]="AccessDenied",e[e.InvalidSyncToken=230]="InvalidSyncToken",e[e.ThreadAlreadyExists=409]="ThreadAlreadyExists",e[e.EndpointMissing=729]="EndpointMissing",e[e.InitiatorNotPartOfThread=730]="InitiatorNotPartOfThread",e[e.ThreadNotFound=732]="ThreadNotFound",e[e.UserInAnotherCloud=752]="UserInAnotherCloud",e[e.PerUserLoginLimitExceeded=803]="PerUserLoginLimitExceeded",e[e.QuarantineLimitExceeded=804]="QuarantineLimitExceeded",e[e.StaleUic=923]="StaleUic"}(C=t.ChatServiceErrors||(t.ChatServiceErrors={})),function(e){e[e.MSA=1]="MSA",e[e.S4B_Bridge=2]="S4B_Bridge",e[e.PSTN=4]="PSTN",e[e.SkypeId=8]="SkypeId",e[e.Thread=19]="Thread",e[e.LegacyShortCircuit=20]="LegacyShortCircuit",e[e.OneToOneTextMessage=21]="OneToOneTextMessage",e[e.GroupTextMessage=22]="GroupTextMessage",e[e.Bot=28]="Bot",e[e.PersonalUserStream=48]="PersonalUserStream"}(b=t.Namespaces||(t.Namespaces={}));function T(e,t){return t+":"+e}function M(e,t){const s=e.replace("#T/","");return I(s)?s:T(s,t)}function I(e){return r.ValidMriRegExp.test(e)}function w(e){return e&&I(e)?e:void 0}function P(e){return e}function k(e){return e}function A(e){return e}function E(e){return e===b.MSA||e===b.S4B_Bridge||e===b.SkypeId||e===b.Bot||e===b.LegacyShortCircuit||e===b.PSTN}function R(e){if(!I(e))return!1;return F(e)===b.PSTN}function L(e){const t=e.indexOf(":"),s=e.substr(0,t);return{namespace:Number(s),id:e.substr(t+1)}}function F(e){return L(e).namespace}function x(e){return L(e).id}function O(e){const t=F(e);return E(t)||z(e)||H(e)||R(e)||t===b.OneToOneTextMessage}function D(e){return e===t.BookmarksThreadId}function B(e){return F(e)===b.Thread}function V(e){return F(e)===b.Bot&&!i.startsWith(x(e),t.ConnectorPrefixes.IntegrationNamespace)}function N(e){return F(e)===b.SkypeId}function U(e){return B(e)&&i.endsWith(e,t.HighlightsThreadIdSuffix)}function H(e){return B(e)&&i.endsWith(e,t.EncryptedThreadIdSuffix)}function z(e){return B(e)&&i.endsWith(e,t.OneToOneThreadIdSuffix)}function W(e){return B(e)&&i.endsWith(e,t.SkypeThreadIdSuffix)||j(e)}function j(e){return B(e)&&i.endsWith(e,t.P2PSkypeThreadIdSuffix)}function G(e){return T(e+t.HighlightsThreadIdSuffix,b.Thread)}function K(e){return e.replace(/-/g,"")}function q(e,t){const s=e<t?e+"|"+t:t+"|"+e;return d.byteArrayToHexString(d.computeSHA256(s)).toLowerCase()}function Q(e,t,s){return e+":"+t+s}function X(e){if(a.isEventCallEndedMessageType(e)){return(e.skypeguid?"CallEnded_"+e.skypeguid:void 0)||e.clientmessageid||e.id}return e.skypeeditedid||e.clientmessageid||e.id}function $(e,t){return e+";"+Date.now()+";"+t}function J(e){if(!e)return 0;const t=e.split(";")[0];return Number(t)}function Y(e){if(!e)return"0";return e.split(";")[2]}function Z(e,t){if(e===t)return!1;const s=J(e),i=J(t);return!(s>i)&&(s!==i||Y(e)!==Y(t))}function ee(e){return i.split(e,";")[0]}t.ThreadTypes={Reactions:"cast",Phone:"phone",LegacyMeetNow:"meeting"},t.AllGlobalClearMri="ALL",t.SkonsoleMri="99:skonsole@skonsole.skonsole",t.HighlightsThreadIdSuffix="@highlights.skype",t.ReactionThreadIdSuffix="@cast.skype",t.EncryptedThreadIdSuffix="@encrypted.skype",t.OneToOneThreadIdSuffix="@oneToOne.skype",t.SkypeThreadIdSuffix="@thread.skype",t.P2PSkypeThreadIdSuffix="@p2p.thread.skype",t.BookmarksThreadId="48:starred",t.V2ThreadIdSuffix="@thread.v2",t.ConnectorThreadPropPrefix="integration",t.ThreadProps={BannedUserList:"banneduserlist",ConvView_MemberCount:"membercount",ConvView_MemberListString:"members",Creator:"creator",CreatedAt:"createdat",DisableAnonymousJoin:"disableanonymousjoin",HistoryDisclosed:"historydisclosed",IsSticky:"isStickyThread",JoinEnabled:"joiningenabled",LastJoinAt:"lastjoinat",LastLeaveAt:"lastleaveat",LiveState:"awareness_conversationLiveState",MessageTranslationLocale:"messageTranslationLocale",ModeratedThread:"moderatedthread",ParentThreadId:"castParentThreadId",Picture:"picture",SecureDeviceSwitch:"secureDeviceSwitch",SecureHandshake:"encryptionHandshake",SecureHandshakeOnceEstablished:"encryptionHandshakeOnceEstablished",Source:"source",ThreadDetailsVersion:"version",ThreadType:"threadType",TopicName:"topic",Translated:"translated"},t.ConversationProps={Alerts:"alerts",Archived:"archived",Color:"color",ConsumptionHorizon:"consumptionhorizon",ConversationBlocked:"conversationblocked",ConversationStatus:"conversationstatus",ConversationStatusProperties:"conversationstatusproperties",DeleteTimestamp:"clearedat",Favorite:"favorite",IsEmptyConversation:"isemptyconversation",LiveState:"awareness_conversationLiveState",MessageTranslationLocale:"messageTranslationLocale",NewConnectionMessageId:"new-connection-message-id",OneToOneThreadId:"onetoonethreadid",Participants:"participants",Pinned:"pinned",Subscription:"subscription",SuggestedActions:"suggestedactions",SuggestionsAugmentation:"suggestionsaugmentation",Translated:"translated"},t.newConnectionAcceptedPropValue="0",t.UserProps={AlertsLastReadTime:"alertsLastReadTime",BingBackgroundsEffectDismissed:"bingBackgroundsEffectSeen",CallNotificationsWhileDND:"callNotificationsWhileDND",CallTranslatorAlwaysStart:"callTranslatorAlwaysStart",CallTranslatorBotSpokenLanguageLocale:"callTranslatorBotSpokenLanguageLocale",CallTranslatorBotSubtitleLanguageLocale:"callTranslatorBotSubtitleLanguageLocale",CallTranslatorBotTranslationVoice:"callTranslatorBotTranslationVoice",CallTranslatorCaptionsPositionMode:"callTranslatorCaptionsPositionMode",CallTranslatorPrivacyConsent:"callTranslatorPrivacyConsent",CallTranslatorSpokenLanguage:"callTranslatorSpokenLanguage",CaptureFirstRunLevel:"captureFirstRunLevel",CaptureMarkupTooltipDismissed:"captureMarkupTooltipDismissed",CelebrationNotificationLastShownTime:"celebrationNotificationLastShownTime",ChatNotificationsWhileDND:"chatNotificationsWhileDND",ChatServiceRingChangedManually:"dogfoodUserRingForced",CoachMarksSeen:"coachMarksSeen",DisplayUrlPreviewsEnabled:"displayUrlPreviewsEnabled",E911Acknowledged:"e911Acknowledged",EmergencyCallDefaultCountryChanged:"emergencyCallDefaultCountryChanged",EnableSubtitlesForAllCalls:"enableSubtitlesForAllCalls",OnlyShowSubtitlesForOtherParticipants:"onlyShowSubtitlesForOtherParticipants",IntegrationAuthConsent:"integrationAuthConsent",IntegrationIdAuthStatePairs:"integrationIdAuthStatePairs",InterstitialForLargeGroupRinglessCallsShown:"interstitialForLargeGroupRinglessCallsShown",InterstitialForSmallGroupRinglessCallsShown:"interstitialForSmallGroupRinglessCallsShown",InviteSharingDisabled:"inviteSharingDisabled",IsSetupWizardCompleted:"isSetupWizardCompleted",LastEngagementProcessedMessageOnWebTimestamp:"lastEngagementProcessedMessageOnWebTimestamp",Locale:"locale",Market:"market",MsaProfile:"msaProfile",MediaEditorFirstRunLevel:"mediaEditorFirstRunLevel",NotifyOnPresenceChange:"notifyOnPresenceChange",OnboardingUserProfileScreenSeen:"onboardingUserProfileScreenSeen",PresentDNDSetting:"presentDNDSetting",PstnTranslationSettings:"pstnTranslationSettings",ReadReceiptsEnabled:"readReceiptsEnabled",Reactions:"customReactions",CustomCallReactions:"customCallReactions",ReactionPushNotificationsEnabled:"reactionPushNotificationsEnabled",ReadReceiptsUserPreference:"readReceipsUserPreference",SendOptionalTelemetry:"sendOptionalTelemetry",ScheduledCallReminders:"scheduledCallReminders",ScheduleNextCallDisplayedTimes:"scheduleNextCallDisplayedTimes",ScheduleNextCallCurrentSuccessfulCalls:"scheduleNextCallCurrentSuccessfulCalls",ScheduledCallBannerDismissStates:"scheduledCallBannerDismissStates",SuggestionsEnabled:"suggestionsEnabled",Timezone:"timezone",TranslatedConversationBannerDismissStates:"translatedConversationBannerDismissStates",UserAppearancePreferences:"userAppearancePreferences"},t.ServerUserProps={Cid:"cid",CidHex:"cidHex",UserRing:"userRing",SkypeName:"skypeName"},t.SubscriptionTypes={Loud:"loud",Normal:"normal",Muted:"muted"},t.ConnectorPrefixes={IntegrationNamespace:"integration:"},t.ThreadPropsInConversationView=[t.ThreadProps.LastJoinAt,t.ThreadProps.LastLeaveAt,t.ThreadProps.ThreadDetailsVersion,t.ThreadProps.ThreadType,t.ThreadProps.ConvView_MemberCount,t.ThreadProps.ConvView_MemberListString,t.ThreadProps.LiveState],t.getThreadPropsInConversationView=function(){return n.default.getS4LMessagingFeaturesNoSubscription().enableJoinEnabledThreadPropInConversationView?[...t.ThreadPropsInConversationView,t.ThreadProps.JoinEnabled]:t.ThreadPropsInConversationView},t.skypeIdToMri=function(e){return T(e,b.SkypeId)},t.idAndNamespaceToMri=T,t.sanitizeMri=M,t.replaceNamespace=function(e,t,s){const i=L(e);return i.namespace===t?M(i.id,s):e},t.isMri=I,t.isSkypeId=function(e){return r.ValidSkypeIdRegExp.test(e)},t.asMriMaybe=w,t.asMri=P,t.asSkypeThreadIdMaybe=function(e){const t=w(e);return t&&B(t)?t:void 0},t.asSkypeThreadId=k,t.asSkypeId=A,t.isAllGlobalClearMri=function(e){return e===t.AllGlobalClearMri},t.isUserMri=function(e){return E(F(e))},t.isMriNamespaceUser=E,t.isOneToOneThreadUserMriNamespace=function(e){const t=F(e);return t===b.S4B_Bridge||t===b.PSTN||t===b.SkypeId||t===b.Bot},t.isPhoneMri=R,t.isConversationWithPhoneNumber=function(e){return R(e)},t.isDisplayableStrippedMri=function(e){const t=F(e);return t===b.MSA||t===b.S4B_Bridge||t===b.PSTN||t===b.SkypeId||t===b.OneToOneTextMessage},t.isMriWithUserMetadata=function(e){const t=F(e);return t===b.MSA||t===b.SkypeId||t===b.S4B_Bridge},t.isValidNamespaceMri=function(e){return!!I(e)&&F(e)in b},t.isReadOnlyConversation=function(e){return e===S.default.getEchoMri()},t.isConciergeBotMri=function(e){return-1!==n.default.getEngagementFeatures().engagementSenderIdentity.indexOf(e)},t.splitMri=L,t.splitSkypeId=function(e){const t=e.indexOf(":");return t>=0?{prefix:e.substr(0,t),suffix:e.substr(t+1)}:{suffix:e}},t.getMriNamespace=F,t.stripMriNamespace=x,t.isOneOnOneConversation=O,t.isBookmarkConversation=D,t.isGroupConversation=function(e){return!O(e)&&!D(e)},t.isThread=B,t.isAgent=V,t.isSearchInConversationSupported=function(e){return N(e)||W(e)||z(e)},t.isGalleryInConversationSupported=function(e){return N(e)||H(e)||W(e)||z(e)},t.isConnector=function(e){return F(e)===b.Bot&&i.startsWith(x(e),t.ConnectorPrefixes.IntegrationNamespace)},t.isEcho=function(e){return S.default.getEchoMri()===e},t.isCallLog=function(e){return S.default.getCallLogMri()===e},t.isBlockedPSTNMri=function(e){return S.default.getBlockedPSTNMri()===e},t.isSkypeIdMri=N,t.isMsaMri=function(e){return F(e)===b.MSA},t.isS4BBridgeMri=function(e){return F(e)===b.S4B_Bridge},t.isGuestUserMri=function(e){const s=L(e);return s.namespace===b.SkypeId&&i.startsWith(s.id,t.GuestUserMriPrefix)},t.isOrgIdUserMri=function(e){const s=L(e);return s.namespace===b.SkypeId&&i.startsWith(s.id,t.OrgIdUserPrefix)},t.getSkypeIdFromMri=function(e){if(F(e)===b.SkypeId)return x(e)},t.getPhoneNumberFromMri=function(e){const t=L(e);if(t.namespace===b.PSTN||t.namespace===b.OneToOneTextMessage)return t.id},t.getMriFromPhoneNumber=function(e){return b.PSTN+":"+e.number},t.getMriFromPhoneNumberString=function(e){return b.PSTN+":"+e},t.getMriFromS4BId=function(e){return T(e,b.S4B_Bridge)},t.getConnectorIntegrationIdFromMri=function(e){const t=x(e),s=t.indexOf(":");return t.substr(s+1)},t.getCreatorMriForMessageFromLink=function(e){return i.first(i.last(e.split("/")).split(";"))},t.getConversationLinkWithNewId=function(e,t){const s=e.split("/");return s.pop(),i.join([...s,t],"/")},t.isHighlightsThread=U,t.isBotHighlightsThread=function(e){if(!U(e))return!1;const t=x(e);return!!I(t)&&V(t)},t.isMergingBotHighlightMessageRaw=function(e,s){return V(e)&&-1!==s.content.indexOf(t.BotHighlightMessageContent)},t.isMyHighlightThread=function(e){return!!B(e)&&e===G(g.default.getSkypeId())},t.isReactionsThread=function(e){return B(e)&&i.endsWith(e,t.ReactionThreadIdSuffix)},t.isSmsMmsThread=function(e){const t=L(e);return t.namespace===b.OneToOneTextMessage||t.namespace===b.GroupTextMessage},t.isEncryptedThread=H,t.isOneToOneThread=z,t.isSkypeThread=W,t.isP2PSkypeThread=j,t.isV2Thread=function(e){return B(e)&&i.endsWith(e,t.V2ThreadIdSuffix)},t.getSkypeMriFromBotHighlightsThreadMri=function(e){const s=e.indexOf(t.HighlightsThreadIdSuffix);if(F(e)===b.Thread&&-1!==s&&s===e.length-t.HighlightsThreadIdSuffix.length)return x(e.substr(0,s))},t.getMemberMrisWithoutMe=function(e){return i.filter(e,(e=>!g.default.isMyMri(e)))},t.getHighlightsThreadMriForSkypeId=G,t.getSkypeIdFromHighlightsThreadMri=function(e){const s=e.indexOf(t.HighlightsThreadIdSuffix);if(F(e)===b.Thread&&-1!==s&&s===e.length-t.HighlightsThreadIdSuffix.length)return x(e.substr(0,s))},t.getReactionThreadIdForCallId=K,t.getReactionsThreadMriForCallId=function(e){return T(K(e)+t.ReactionThreadIdSuffix,b.Thread)},t.isComposingStateSupported=function(e,t){if(!t)return!1;const s=F(e);return s===b.SkypeId?e!==S.default.getEchoMri():s===b.Thread||s===b.MSA||s===b.Bot||s===b.S4B_Bridge&&t},t.buildOneOnOneThreadId=function(e){return Q(b.Thread,q(e,g.default.getSkypeMri()),t.OneToOneThreadIdSuffix)},t.buildOneOnOneEncryptedThreadId=function(e){return Q(b.Thread,q(e,g.default.getSkypeMri()),t.EncryptedThreadIdSuffix)},t.updateConsumptionHorizonWithCurrentClientTime=function(e){if(!e)return"0";const t=e.split(";");return t[0]+";"+Date.now()+";"+t[2]},t.getCuidForMessage=function(e){return X(e)},t.getCHIDForMessage=X,t.getConsumptionHorizonForMessage=function(e){return $(e.id,X(e))},t.getConsumptionHorizonForMessageAndCHID=$,t.getServerTimestampFromConsumptionHorizon=J,t.getConsumptionHorizonUpdateTime=function(e){if(!e)return 0;const t=e.split(";")[1];return Number(t)},t.getCuidFromConsumptionHorizon=Y,t.isConsumptionHorizonNewer=Z,t.getNewestConsumptionHorizon=function(e,t){return Z(e,t)?t:e},t.parseConversationId=ee,t.getParsedConversationId=function(e){if(e.conversationLink){const t=i.last(e.conversationLink.split("/"));if(t){return ee(t)}}};const te=/<[^<>]+>/g;t.unescapeTextWithoutXml=function(e){if(!e)return"";const t=e.replace(te,"");return y.default.unescapeXml(t)},t.parseAvailability=function(e){return"Online"===e?l.UserAvailability.Online:"Offline"===e?l.UserAvailability.Offline:void 0};const se={Offline:l.UserStatus.Offline,Online:l.UserStatus.Online,Busy:l.UserStatus.Busy,Away:l.UserStatus.Away,Idle:l.UserStatus.Idle,OnThePhone:l.UserStatus.OnThePhone,OutToLunch:l.UserStatus.OutToLunch,BeRightBack:l.UserStatus.BeRightBack,Hidden:l.UserStatus.Hidden},ie=i.invert(se);function oe(e,t,s,i,o){if(!e)return"";const n=u.getLocalizeParamForGender(s);return e.status===l.UserStatus.Online||i?p.getString(t&&!o?"UserPresence.ActiveCaps":"UserPresence.Active",{gender:n}):e.status===l.UserStatus.Busy?p.getString(t&&!o?"UserPresence.DoNotDisturbCaps":"UserPresence.DoNotDisturb",{gender:n}):e.status===l.UserStatus.Unknown?p.getString("UserPresence.Unknown"):function(e,t,s,i){const o=Date.now().valueOf()-(e.lastSeenAtUtc||0),n=Math.round(o/6e4);if(n<60){const e=i?"UserPresence.LastSeenMinutesAceessibilityLabel":s?"UserPresence.LastSeenMinutesCaps":"UserPresence.LastSeenMinutes";return p.getString(e,{count:Math.max(n,1),gender:t})}const r=Math.round(o/36e5);if(r<24){const e=i?"UserPresence.LastSeenHoursAceessibilityLabel":s?"UserPresence.LastSeenHoursCaps":"UserPresence.LastSeenHours";return p.getString(e,{count:Math.max(r,1),gender:t})}const a=Math.round(o/864e5);if(a<7){const e=i?"UserPresence.LastSeenDaysAceessibilityLabel":s?"UserPresence.LastSeenDaysCaps":"UserPresence.LastSeenDays";return p.getString(e,{count:Math.max(a,1),gender:t})}return p.getString(s?"UserPresence.LastSeenLongTimeCaps":"UserPresence.LastSeenLongTime",{gender:t})}(e,n,t,o)}function ne(e,t){if(!e)return;const s=e.split(";");for(let e=0;e<s.length;e++){const i=s[e].split("=");if(2===i.length&&i[0].trim()===t)return i[1]}}function re(){if(void 0===v){let e=_.CT_UNKNOWN;e=_.CT_WEB_MESSENGER,v=e.toString()}return v}function ae(e){return t=>{if(!t)return;const s=t.indexOf(e);return-1!==s?t.substr(s+e.length):void 0}}function le(e){return"{"===e[0]?e:"{"+e+"}"}function de(e){const t=e.selfLink.split("/");return t[i.findIndex(t,(e=>"endpoints"===e))+1]}function ce(e){return e.headers.location}t.parseStatus=function(e){const t=se[e];return i.isNumber(t)?t:void 0},t.encodeStatus=function(e){const t=ie[e];return i.isString(t)?t:void 0},t.getLastSeenPresenceText=oe,t.getHoverTitle=function(e,t){if(!e)return;const s=i.isNil(e.mappedStatus)?e.status:e.mappedStatus,o=oe(e,!1,t),n=u.getLocalizeParamForGender(t);return s===l.UserStatus.Online?p.getString("UserPresence.Active",{gender:n}):s===l.UserStatus.Busy?p.getString("UserPresence.DoNotDisturb",{gender:n}):s===l.UserStatus.Away?p.getString("UserPresence.Away",{gender:n})+", "+o:s===l.UserStatus.Idle?p.getString("UserPresence.RecentlyActive",{gender:n})+", "+o:void 0},t.decodeSyncState=function(e){const t=e.match(/syncState=([^&]+)/);return t&&t.length>=2?t[1]:void 0},t.encodeSyncStateForLog=function(e){if(void 0===e)return String(e);let t=[];for(let s=0;s<e.length;s+=64)t.push(e.substr(s,64));return t.join("-")},t.encodeEndpointInfoForLog=function(e){const t=i.pick(e,["id","exists","featureFlags","presenceDocPublished","ecsEtag","reason","tcid","restEndpointUrl"]);return JSON.stringify(t)},t.filterMembersProp=function(e){return i.map(e,(e=>({id:e.id,role:e.role})))},t.getEndpointIdFromRegToken=function(e){return ne(e,"endpointId")},t.getExpiresFromRegToken=function(e){const t=ne(e,"expires");return t?Number(t):void 0},t.getEndpointFeaturesList=function(){const e=["Agent","Presence2015","MessageProperties","CustomUserProperties","Casts","ModernBots","AutoIdleForWebApi","secureThreads","notificationStream"];n.default.getS4LContactsFeatures().enableInviteFree&&e.push("InviteFree"),n.default.getS4LMessagingFeaturesNoSubscription().enableReadReceipts&&e.push("SupportsReadReceipts");const t=n.default.getS4LMessagingFeaturesNoSubscription().ued;return t&&t.enabled&&e.push("ued"),e.join(",")},t.buildEndpointPresenceDocData=function(e){return{id:"messagingService",privateInfo:{epname:S.default.getDeviceName()},publicInfo:{capabilities:e.join("|"),typ:re(),skypeNameVersion:S.default.getClientVersionAndPlatform()+"/SkypeX",nodeInfo:"xx",version:"15"}}},t.areEndpointPresenceDocsEqual=function(e,t){return!e&&!t||!(!e||!t)&&(e.id===t.id&&(!!(0,h.default)(e.publicInfo,t.publicInfo)&&e.privateInfo.epname===t.privateInfo.epname))},t.getClientInfoString=function(){const e="skype4life",t=S.default.getClientVersionAndPlatform()+"//"+e,s=S.default.getPlatformType()===c.PlatformType.iOS||S.default.getPlatformType()===c.PlatformType.Android?2:1,i=n.default.getHeaders().CountryCode||"Unknown",r=o.default.getDefaultId();let a="os="+S.default.getPlatformTypeName()+"; osVer="+S.default.getOSVersion()+"; proc=x86; lcid="+p.getLocale()+"; deviceType="+s+"; country="+i+"; clientName="+"skype4life; clientVer="+t;return r&&(a+="; timezone="+r),a},t.getClientCapabilities=function(){const{enableParsingHtmlMessages:e}=n.default.getS4LMessagingFeaturesNoSubscription();return e?"RenderHtml":void 0},t.SKYPE_TOKEN_HEADER_PREFIX="skypetoken=",t.REGISTRATION_TOKEN_HEADER_PREFIX="registrationToken=",t.getSkypetokenFromAuthenticationHeader=ae(t.SKYPE_TOKEN_HEADER_PREFIX),t.getRegistrationTokenFromHeader=ae(t.REGISTRATION_TOKEN_HEADER_PREFIX),t.ChannelTypes={PushNotification:"PushNotification",HttpLongPoll:"HttpLongPoll"},t.createPushSubscriptionParams=function(e,s,i){return{channelType:t.ChannelTypes.PushNotification,eventServiceName:"pnh",template:e,eventChannel:s,interestedResources:i,conversationType:l.DefaultConversationType}},t.createLongPollSubscriptionParams=function(e){return{channelType:t.ChannelTypes.HttpLongPoll,interestedResources:e,conversationType:l.DefaultConversationType}},t.findPushSubscriptionInfo=function(e){const s=i.find(e,(e=>e.channelType.toLowerCase()===t.ChannelTypes.PushNotification.toLowerCase()));return{pushSubscriptionId:s?s.id.toString():void 0,pushSubscriptionParams:s?{channelType:s.channelType,eventChannel:s.eventChannel,eventServiceName:s.eventServiceName,interestedResources:s.interestedResources,template:s.template}:void 0}},t.getEpidFromUri=function(e){const t=e.split("{");if(t.length>1){const e=t[1].split("}");if(e.length>1)return e[0]}},t.isDogfoodCloudUrl=function(e){let t=f.default.getURIComponents(e);return!(!t||!t.host)&&t.host.indexOf("df-")>=0},t.getThreadSuffix=function(e){if(B(e)){const t=i.split(e,";")[0],s=t.indexOf("@");return-1===s?"NoThreadSuffix":t.substring(s+1)}},t.getMriTypeForTelemetry=function(e){if(B(e)){const t=i.split(e,";")[0],s=t.indexOf("@");return-1===s?"UnknownThread":t.substring(s+1)}{const t=F(e);return t in b?b[t]:"UnknownMri"}},t.areEndpointIdsEqual=function(e,t){return void 0===e||void 0===t?e===t:le(e)===le(t)},t.formatEndpointId=le,t.formatEndpointIdRemoveBrackets=function(e){return e&&i.trim(e,"{}")},t.getEndpointIdFromPresenceDoc=de,t.getTextualEndpointInfo=function(e,t=!1){let s=le(de(e));t&&(s=s.substr(1,5));const o=e.publicInfo.skypeNameVersion.split("/"),n=Number(o[0]),r=n?i.findKey(m.default.platformId,(e=>e===n)):o.length>=3?o[2]:"undefined";return s+" ("+e.publicInfo.skypeNameVersion?r+": "+e.publicInfo.skypeNameVersion:e.privateInfo.epname+")"},t.isValidPresenceMri=function(e){return F(e)===b.MSA||F(e)===b.S4B_Bridge?r.ValidPresenceResourceRegExp.test(e):I(e)},t.getTcidDataFromServerMessageResponse=function(e){return{contextId:e.headers.contextid,date:e.headers.date}},t.getConnectionTypeFromUrl=function(e){return-1!==i.indexOf(e,"messenger")?c.ChatServiceConnectionType.ChatServiceV1:-1!==i.indexOf(e,"msgapi")?c.ChatServiceConnectionType.MessagingApi:c.ChatServiceConnectionType.Unknown},t.isRedirect=function(e){return 404===e.statusCode&&ce(e)},t.isEndpointMissing=function(e){return 404===e.statusCode&&e.errorCode===C.EndpointMissing},t.getRedirectUrl=ce,t.isNotFound=function(e){return 404===e.statusCode&&!ce(e)}},65848:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.validateUnreadMessageCounts=t.calculateCountsForConversation=t.MaxUnreadMessageCount=t.BlankCounts=void 0;const i=s(74958),o=s(96486),n=s(14589),r=s(97691),a=s(71830),l=s(62141),d=s(24339),c=s(40276),h=s(46096),u=s(72711),p=s(36237),g=s(14976);t.BlankCounts={convHashUsedForCalc:void 0,consumptionHorizonTimestamp:0,unreadCount:0,unreadCountOverflowed:!1,highPriorityUnreadCount:0,hasUnread:0,lastHighlightMessage:void 0,numMessagesSentByUser:0};function m(e,s,i){const o=e.conv;if(!o.lastMessage&&!e.counts)return r.Resolved({counts:void 0,earlyExit:!0,msg:"Skipping due to no lastMessage"});const n=function(e){let t=e.conv.convViewVersion.toString()+";"+(e.conv.lastMessage?e.conv.lastMessage.createdTime.toString():"0")+";"+e.conv.getConsumptionHorizon()+";"+e.conv.getConversationProperty(a.ConversationProps.Alerts)+";"+e.conv.getConversationProperty(a.ConversationProps.Subscription)+";"+e.conv.getConversationProperty(a.ConversationProps.ConversationBlocked)+";"+e.conv.getConversationProperty(a.ConversationProps.ConversationStatus)+";"+(e.conv.isCurrentUserMember()?"1":"0");e.conv.isThread()&&(t+=";"+e.conv.getThreadProperty(a.ThreadProps.LastJoinAt)+";"+e.conv.getThreadProperty(a.ThreadProps.LastLeaveAt));e.syncInfo&&e.syncInfo.messageHistoryStartTime&&(t+=";"+e.syncInfo.messageHistoryStartTime.toString());e.conv.isHighlightsThread()&&(t+=";H1");e.conv.isMuted()&&(t+=";M2");const s=c.computeSHA256(t);return c.byteArrayToBase64String(s)}(e);if(!s&&e.counts&&e.counts.convHashUsedForCalc===n)return r.Resolved({counts:e.counts,earlyExit:!0,msg:"Skipping due to matching cache"});const l=d.isConversationDisplayable(o),h=l||o.isHighlightsThread(),p=l,g=o.getConsumptionHorizon();let m=a.getServerTimestampFromConsumptionHorizon(g);if(!l&&!o.isHighlightsThread()||o.isArchived()||o.isHighlightsThread()&&!o.isBotHighlightsThread()&&!o.isCurrentUserMember())return r.Resolved({counts:t.BlankCounts,earlyExit:!0,msg:"Skipping due to not caring about it"});const y=Date.now();let _;const v=a.getCuidFromConsumptionHorizon(g);return _=v?i.getMessageByCuid(o.id,v).then((e=>{e&&e.createdTime>m&&(m=e.createdTime)})):r.Resolved(),_.then((()=>{if(o.isHighlightsThread()&&!a.isMyHighlightThread(o.id)){const e=u.getHighlightTimeWindow();m<e&&(m=e)}const e=t.MaxUnreadMessageCount+1;return r.all([h?i.getCountOfMessagesForConversationAfterTimeNormalPri(o.id,m,e):0,p?i.getCountOfMessagesForConversationAfterTimeHighPri(o.id,m):0,l?S(i,o):0,o.isHighlightsThread()?f(i,o,m):void 0])})).then((([e,s,i,r])=>{const a=e+s,l="Recalculated ("+(Date.now()-y)+"ms): Unread: "+a+", HiPri: "+s+", MyMessages: "+i+(o.isHighlightsThread()?", lastHighlightMessage: "+(r?r.cuid:0):""),d=a>0&&h&&!o.isMuted();return{counts:{convHashUsedForCalc:n,consumptionHorizonTimestamp:m,unreadCount:Math.min(a,t.MaxUnreadMessageCount),unreadCountOverflowed:a>t.MaxUnreadMessageCount,highPriorityUnreadCount:s,lastHighlightMessage:r,hasUnread:d?1:0,numMessagesSentByUser:i},earlyExit:!1,msg:l}}))}function S(e,t){return t?e.getCountOfMessagesForConversationISentSinceTime(t.id,Date.now()-2592e6):r.Rejected("Conversation null in getCountOfSentMessages")}function f(e,t,s){return e.getMessagesForConversationBeforeTime(t.id,Number.MAX_VALUE,100,!1).then((e=>{let i;return a.isMyHighlightThread(t.id)?i=o.find(e,(e=>e.isHighlightMessage()&&!e.isDeletedMessage())):o.each(e,(e=>{e.isHighlightMessage()&&!e.isDeletedMessage()&&(!i||e.createdTime>s)&&(i=e)})),i}))}t.MaxUnreadMessageCount=99,t.calculateCountsForConversation=m,t.validateUnreadMessageCounts=function(e){const t=o.keyBy(e,(e=>e.conv.id)),s=o.filter(o.keys(t),(e=>!!t[e]));return p.log(h.LogTraceArea.ConversationCalculations,"validateUnreadMessageCounts start"),l.default.openTransaction([l.Stores.Messages],!1).then((l=>r.all(o.map(s,(e=>m(t[e],!0,l)))).then((r=>{let l=0,d=0,c=!0;return o.each(s,((s,o)=>{let n=t[s].counts,u=r[o].counts;u&&(n&&function(e,t){if(!e)return!0;if(!t)return!1;if(e.unreadCount!==t.unreadCount||e.highPriorityUnreadCount!==t.highPriorityUnreadCount||e.hasUnread!==t.hasUnread)return!1;if(void 0!==e.unreadCountOverflowed&&void 0!==t.unreadCountOverflowed&&e.unreadCountOverflowed!==t.unreadCountOverflowed)return!1;return!0}(n,u)?(u.hasUnread&&p.log(h.LogTraceArea.ConversationCalculations,"Unread count for "+g.mriOrId(s)+" is "+u.unreadCount+" based on convHash "+u.convHashUsedForCalc),1===e.length&&p.log(h.LogTraceArea.ConversationCalculations,"  Current conversation "+i.pii.Omit(JSON.stringify(t[s])))):(p.log(h.LogTraceArea.ConversationCalculations,"Found inconsistent unread message counts for conversation "+g.mriOrId(s)),p.log(h.LogTraceArea.ConversationCalculations,"  Saved "+JSON.stringify(n)),p.log(h.LogTraceArea.ConversationCalculations,"  Computed "+JSON.stringify(u)),p.log(h.LogTraceArea.ConversationCalculations,"  Conversation "+i.pii.Omit(JSON.stringify(t[s]))),c=!1),a.isHighlightsThread(s)||(n&&n.hasUnread&&l++,u.hasUnread&&d++))})),l!==d&&(p.log(h.LogTraceArea.ConversationCalculations,"Found inconsistent unread conversation count. Was "+l+" but should be "+d),c=!1),n.default.getCount().then((e=>(l!==e&&(p.log(h.LogTraceArea.ConversationCalculations,"Found inconsistent home screen badge count. Old was "+l+" but actual badge count was "+e),c=!1),d!==e&&(p.log(h.LogTraceArea.ConversationCalculations,"Found inconsistent home screen badge count. New was "+d+" but actual should be "+e),c=!1),c&&p.log(h.LogTraceArea.ConversationCalculations,"Message counts appear to be consistent"),c)))})).fail((()=>{p.log(h.LogTraceArea.ConversationCalculations,"validateUnreadMessageCounts failed")}))))}},13991:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getContactNodeRenderDimensions=t.ContactNodeSizes=t.contactNodeHeigth=t.getUrlPreviewNodeRenderDimensions=t.UrlPreviewNodeSizes=t.getFileNodeRenderDimensions=t.FileNodeSizes=t.fileNodeWidthSmall=t.fileNodeWidth=t.getScaledThumbnailDimensions=t.prepareSwiftCardNodeDimensionsFunction=t.prepareMediaNodeDimensionsFunction=t.availableSpaceUtilization=t.ThumbnailMinHeight=t.ThumbnailMinWidth=t.CompositeGalleryThumbnailWidth=t.CompositeGalleryThumbnailHeight=t.UndefinedDimensions=void 0;const i=s(35566),o=s(70891),n=s(12762);t.UndefinedDimensions={width:void 0,height:void 0};t.CompositeGalleryThumbnailHeight=200,t.CompositeGalleryThumbnailWidth=300;const r={height:t.CompositeGalleryThumbnailHeight,width:t.CompositeGalleryThumbnailWidth};function a(e,s){const{width:o,height:n}=e;if(!o||!n)return t.UndefinedDimensions;const r=void 0===s.width||s.width*t.availableSpaceUtilization>300?300:s.width*t.availableSpaceUtilization,a=void 0===s.height||s.height>300?300:s.height,l=i.default.fitToContainer({width:o,height:n},{width:r,height:a});return l.width<t.ThumbnailMinWidth&&(l.width=t.ThumbnailMinWidth),l.height<t.ThumbnailMinHeight&&(l.height=t.ThumbnailMinHeight),l}t.ThumbnailMinWidth=60,t.ThumbnailMinHeight=60,t.availableSpaceUtilization=.55,t.prepareMediaNodeDimensionsFunction=function(e){if(e.renderOrigin===o.MessageRenderOrigin.CompositeGalleryCanvas)return()=>r;const s=e.decodedNode.getFirstUriObjectChild(n.PictureNode),i=s&&s.getOriginalDimensions();let l;return l=void 0===i||void 0===i.width||void 0===i.height?{width:t.CompositeGalleryThumbnailWidth,height:t.CompositeGalleryThumbnailHeight}:{width:i.width,height:i.height},(e,t)=>a(l,e)},t.prepareSwiftCardNodeDimensionsFunction=function(e,s){let i;return i=void 0===e||void 0===e.width||void 0===e.height?{width:t.CompositeGalleryThumbnailWidth,height:t.CompositeGalleryThumbnailHeight}:{width:e.width,height:e.height},a(i,s)},t.getScaledThumbnailDimensions=a,t.fileNodeWidth=245,t.fileNodeWidthSmall=200,t.FileNodeSizes={Regular:{width:t.fileNodeWidth,height:void 0},Small:{width:t.fileNodeWidthSmall,height:void 0},Gallery:{width:void 0,height:void 0}};t.getFileNodeRenderDimensions=(e,s)=>{if(s===o.MessageRenderOrigin.CompositeGalleryCanvas||s===o.MessageRenderOrigin.StackGalleryCanvas)return t.FileNodeSizes.Gallery;let i=t.FileNodeSizes.Regular;return e&&e.width&&e.width<400&&(i=t.FileNodeSizes.Small),i};t.UrlPreviewNodeSizes={Regular:{width:300,height:150},Small:{width:200,height:125},Gallery:{width:void 0,height:150}};t.getUrlPreviewNodeRenderDimensions=(e,s)=>{if(s===o.MessageRenderOrigin.CompositeGalleryCanvas||s===o.MessageRenderOrigin.StackGalleryCanvas)return t.UrlPreviewNodeSizes.Gallery;let i=t.UrlPreviewNodeSizes.Regular;return e&&e.width&&e.width<500&&(i=t.UrlPreviewNodeSizes.Small),i};t.contactNodeHeigth=175,t.ContactNodeSizes={Regular:{width:214,height:t.contactNodeHeigth},Small:{width:200,height:t.contactNodeHeigth},Gallery:{width:void 0,height:150}};t.getContactNodeRenderDimensions=(e,s)=>e&&e.width&&e.width<400?t.ContactNodeSizes.Small:t.ContactNodeSizes.Regular},36974:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(76975),n=s(75463),r=s(32183),a=s(26424),l=s(15963),d=s(94050);class c{constructor(e){this._lastResultType=void 0,this._scenario=new d.default(l.ScenarioName.EmoticonRendering),this._requestedIconData={requestedIconId:e.id,requestedIconSize:e.size,requestedIconType:a.EmoticonType[e.type],requestedIconCacheStatus:"not_checked"}}initialize(e){this._stepsSeq=o.default.isImageCached(e).then((e=>{this._requestedIconData.requestedIconCacheStatus=String(e)})).catch((()=>{this._requestedIconData.requestedIconCacheStatus="cache_error"}))}_isResultFinal(e){return!!e&&e.type===a.ResultIconType.Final}_getResultType(e){return e?a.ResultIconType[e.type]:"Placeholder"}queueSendingTelemetry(e){const t=this._scenario.getCurrentDuration(),s=this._lastResultType;this._stepsSeq=this._stepsSeq.then((()=>e?o.default.isImageCached((0,r.getUrl)(e.icon)).then((i=>{this._sendTelemetry(e,s,String(i),t)})).catch((()=>{this._sendTelemetry(e,s,"cache_error",t)})):this._sendTelemetry(e,s,"",t))),this._lastResultType=this._getResultType(e)}_sendTelemetry(e,t,s,o){if(this._scenario.isResolved())return;let n=Object.assign(Object.assign({},this._requestedIconData),{resultType:this._getResultType(e),prevResultType:String(t)});e&&i.assign(n,{resultIconId:e.icon.id,resultIconSize:e.icon.size,resultIconType:a.EmoticonType[e.icon.type],resultIconCacheStatus:s}),this._scenario.hasStarted()?this._isResultFinal(e)?this._scenario.finish(n,o):this._scenario.markStepCompleted("intermediateStep",n,o):(this._scenario.setDuplicateStepMarkingEnabled(!0),this._scenario.start(n))}finishScenario(){this._stepsSeq=this._stepsSeq.then((()=>{this._scenario.isResolved()||this._scenario.finish()}))}}t.default=class{constructor(e,t){this._sampleRate=e,this._getEmoticonInfo=t}_initTelemetry(){if(this._sampleRate>0&&0===Math.floor(this._sampleRate*n.getRandomValues(new Array(1))[0]/256)){const e=this._getEmoticonInfo();e?(this._collectTelemetry=!0,this._impl=new c(e),this._impl.initialize((0,r.getUrl)(e))):this._collectTelemetry=!1}else this._collectTelemetry=!1}finishAndResetTelemetry(){this._impl&&this._impl.finishScenario(),this._impl=void 0,this._collectTelemetry=void 0}updateTelemetry(e){void 0===this._collectTelemetry&&this._initTelemetry(),this._impl&&this._impl.queueSendingTelemetry(e)}}},39024:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getEmoticonAccessibilityLabel=t.getEmoticonInfoAccessibilityLabel=void 0;const i=s(96486),o=s(33754),n=s(26424);function r(e,t){if(i.includes(n.DiverseToneSuffixes,t)&&t!==n.DefaultDiverseTone){const s="AccessibilityLabel.EmoticonTone"+t;return o.getStringUnsafe(s,{emoticonName:e})}return e}t.getEmoticonInfoAccessibilityLabel=function(e){if(e.description)return r(e.description,e.tone)},t.getEmoticonAccessibilityLabel=r},32183:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getBaseUrl=t.setBaseUrl=t.getDefaultEmoticonSize=t.getEmoticonUrl=t.parseUrl=t.getUrl=t.getSanitizedEmoticonName=t.getEmoticonTone=void 0;const i=s(89391),o=s(95868),n=s(26424),r=s(58962),a=s(29130),l=s(26712);let d=i.default.getConfigSettingsNoSubscription().pes.emoticonBaseUrl;function c(e){const t=e.length;if(t>4&&e[t-3]===n.DiverseToneSeparator){const s=o.default.getItemToneFromString(e[t-2]);if(void 0!==s&&n.DiverseToneSuffixes.indexOf(s)>-1)return s}}function h(e){const t=d+"/",s=e.type===n.EmoticonType.Animated?r.EmoticonUrl.animSuffix:"",i=r.EmoticonUrl.flatSuffix,o=e.tone&&1!==e.tone?r.EmoticonUrl.diverseSuffix+e.tone:"",a=`${r.EmoticonUrl.profilePrefix}${e.size}${s}${i}${o}`;return`${t}${encodeURIComponent(e.id)}/views/${a}?etag=${e.etag?e.etag:"v1"}`}t.getEmoticonTone=c,t.getSanitizedEmoticonName=function(e){let t=c(e);return t?e.replace(n.DiverseToneSeparator+t+")",")"):e},t.getUrl=h,t.parseUrl=function(e){if(!l.default.isUrlValid(e))return;const t=e.split("/");if(9!==t.length)return;const s=decodeURIComponent(t[t.length-3]),i=t[t.length-1].split("?")[0].split("_"),o=Number(i[1]);let a;const d=e=>{const t=e.substr(r.EmoticonUrl.diverseSuffix.length-1);return Number(t)};let c;if(3===i.length)c=!1;else if(5===i.length){if("_"+i[2]!==r.EmoticonUrl.animSuffix)return;c=!0,a=d(i[4])}else{if(4!==i.length)return;if("_"+i[2]===r.EmoticonUrl.flatSuffix)a=d(i[3]);else{if("_"+i[2]!==r.EmoticonUrl.animSuffix)return;c=!0}}const h=l.default.getURIComponents(e);if(!h)return;const u=h.queryParameterKeyValues,p="etag";if(!u||!(p in u))return;const g=u.etag;return{id:s,size:o,type:c?n.EmoticonType.Animated:n.EmoticonType.Static,etag:g,tone:a}},t.getEmoticonUrl=function(e,t,s,i,o){return h({id:e,size:(0,r.getPixelSize)(t),type:s?n.EmoticonType.Static:n.EmoticonType.Animated,etag:o,tone:i})},t.getDefaultEmoticonSize=function(e){return a.default.isMobileScreenSize(e)?n.EmoticonSize.Large:n.EmoticonSize.Small},t.setBaseUrl=function(e){d=e},t.getBaseUrl=function(){return d}},19596:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.forwardMessages=void 0;const i=s(96486),o=s(64097),n=s(51077),r=s(46096),a=s(36237),l=s(33754),d=s(95691),c=s(5899),h=s(32293),u=s(78262),p=s(53374);function g(e,t,s,i,o,n){const r=c.default.getShareParametersForMedia(e,t,s,o,n);r&&i.push(r)}t.forwardMessages=function(e,t,s,m,S){const f=1===e.length,y=[];let _;const v=p.default.newCauseId();let C,b=!0;const T=i.filter(e,(e=>!e.forwardAlbumId||e.message.isAlbum())).length;let M=l.getString("StreamItem.ForwardMessagesHeader",{count:T});if(e&&e.length>0&&(i.each(e,((e,i)=>{switch(_=(0,n.getMessageTypeGroup)(e.message),_){case n.MessageTypeGroups.MediaAlbum:e.forwardAlbumId&&y.push(c.default.getShareParametersForAlbumMsg(e.message,t,e.forwardAlbumId));break;case n.MessageTypeGroups.Location:f&&(M=l.getString("StreamItem.ForwardLocationMessageHeader")),y.push(c.default.getShareParametesForLocation(e.message,t)),C=d.SharePreviewType.Location;break;case n.MessageTypeGroups.Picture:g(e.message,t,f,y,S.rootViewId,e.forwardAlbumId),C=d.SharePreviewType.Photo;break;case n.MessageTypeGroups.Video:g(e.message,t,f,y,S.rootViewId,e.forwardAlbumId),C=d.SharePreviewType.Video;break;case n.MessageTypeGroups.Audio:g(e.message,t,f,y,S.rootViewId),C=y[i].fileType===u.UploadFileType.AudioMessage?d.SharePreviewType.AudioMessage:d.SharePreviewType.Audio;break;case n.MessageTypeGroups.UriFile:g(e.message,t,f,y,S.rootViewId),C=d.SharePreviewType.File;break;case n.MessageTypeGroups.SwiftCard:let r;if(C=d.SharePreviewType.SwiftCards,!h.default.isNodeTextMessage(e.node)){let i;o.default.isAdaptiveCard(e.node)?(i=c.default.getShareParametersForAdaptiveMessage(e.message,e.node,s),r=o.default.isAdaptiveCardCarousel(e.node)):(i=c.default.getShareParametersForSwiftMessage(e.message,e.node,t,s,v,f),r=h.default.isSwiftCarousel(e.node)),i&&y.push(i)}f&&r&&(M=l.getString("SwiftCard.ShareCards"));break;case n.MessageTypeGroups.Contact:f&&(M=l.getString("StreamItem.ForwardMessageContact"));const a=c.default.getShareParametesForContactMessage(e.message,t);if(!a)return;b=!1,y.push(a),C=d.SharePreviewType.Contact;break;case n.MessageTypeGroups.Text:y.push(c.default.getShareParametersForText(e.message,e.node,t)),C=d.SharePreviewType.Text}})),f||(C=d.SharePreviewType.MultipleMessages)),f&&_?a.log(r.LogTraceArea.GenericUnsafe,`ShareMessageUtils.forwardMultipleMessages for single message of\n                message type , ${n.MessageTypeGroups[_]} causeId: ${v}`):a.log(r.LogTraceArea.GenericUnsafe,`ShareMessageUtils.forwardMultipleMessages for multiple messages\n              causeId: ${v}`),0===y.length)return void(m&&m());const I="_streamItemMultipleMessages"===t?r.SharePanelEntryOrigin.MultiSelect:r.SharePanelEntryOrigin.MessageActionMenu;return c.default.shareMultipleMessages(y,M,v,I,m,S,C,b)}},72711:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getHighlightTimeWindow=void 0;t.getHighlightTimeWindow=function(){return Date.now()-6048e5}},50066:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HtmlSanitizer=void 0;const i=s(96486),o=s(38289),n=s(17213);class r{constructor(){this._defaultAllowedTags=[],this._defaultAllowedAttributes=[],this._addTags=[],this._addAttributes=[],this._allowedSrcProtocols=["data","cid","blob","http","https","ftp","ftps"],this._allowedHrefProtocols=["http","https","mailto","onenote","tel","ftp","ftps"],this._transformATag=(e,t={})=>(t.href&&(t.href=this.sanitizeHrefUrl(t.href),t.title=this._getIdnSafeTitle(t.href)),{tagName:e,attribs:t=this._addTargetAndRelAttributes(t)}),this._transformAllTags=(e,t)=>(t&&t.style&&(t.style=this._sanitizeStyle(t.style)),{tagName:e,attribs:t}),this._semanticObjectSchemas=i.values(n.SemanticObjectSchemas),this._initCustomData(),this._sanitizeHtmlConfig=this._buildSanitizeHtmlConfig()}sanitizeHtml(e){return e?o(e,this._sanitizeHtmlConfig):e}sanitizeHrefUrl(e,t=!1){return function(e,t){if(!e)return"";if(e.startsWith("/"))return e;const s=e.indexOf(":");if(s<=0)return"";const i=(e=(e=e.replace(/(\')/g,"%27")).replace(/(\")/g,"%22")).substring(0,s).toLowerCase();for(const s of t)if(i===s)return e;if("http"===i)return`https${e.substring(s)}`;return""}(e,t?["mailto"]:this._allowedHrefProtocols)}_addTargetAndRelAttributes(e){return i.find(this._semanticObjectSchemas,(t=>t===e[n.Attributes.itemtype]))||(e.target="_blank",e.rel="noreferrer noopener"),e}_getIdnSafeTitle(e){let t=e;if(!e||e.startsWith("/"))return t;const s=function(e,t,s,i){try{return t(new URL(s,i))}catch(t){return e}}(void 0,(e=>e),e);return s&&s.hostname&&(s.hostname.startsWith("xn--")||s.hostname.indexOf(".xn--"))&&(t=s.href),t.toLowerCase()}_stripComments(e){let t="code";return i.reduce(e.split(""),((e,s,i,o)=>{switch(t){case"code":return"/"===s&&"*"===o[i+1]?(t="comment",e):`${e}${s}`;case"comment":return"/"===s&&"*"===o[i-1]&&(t="code"),e}}),"")}_sanitizeStyle(e){let t=e.replace(/(url|attr)\([^)]*\)?/gi,";");t=t.replace(/position\s*:\s*(\\66|f)\s*(\\69|i)\s*(\\78|x)\s*(\\65|e)\s*(\\64|d)\s*/gi,"position:absolute");const s=this._stripComments(t).split(";").filter((e=>{const t=e.split(":");return-1!==n.AllowedStyles.indexOf(t[0].trim())}));return i.join(s,";")}_initCustomData(){this._defaultAllowedTags=n.AllowedHtmlElements,this._defaultAllowedAttributes=n.AllowedHtmlAttributes,this._addTags=["URIObject","Title","Swift","Description","ended","partlist","part","name","duration","OriginalName","Identifiers","Id","RecordingContent","item","RecordingStatus","AddCustomApp","DeleteCustomApp","UpgradeCustomAppV2","eventtime","initiator","target","targetName","DeprecatedTargetName","UpdateFavDefault","isDefault"],this._addAttributes=[n.IgnoreSemanticLinkAttr,"url_thumbnail","b64","identity","uri","v"]}_buildSanitizeHtmlConfig(){return{allowedTags:this._defaultAllowedTags.concat(this._addTags),allowedAttributes:{"*":this._defaultAllowedAttributes.concat(this._addAttributes)},allowedSchemes:this._allowedHrefProtocols,allowedSchemesByTag:{img:this._allowedSrcProtocols},parser:{lowerCaseTags:!1},nonTextTags:["style","script","textarea","ts-hint"],transformTags:{a:this._transformATag,"*":this._transformAllTags}}}}t.HtmlSanitizer=r,t.default=new r},17213:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AllowedStyles=t.AllowedHtmlAttributes=t.AllowedHtmlElements=t.Attributes=t.IgnoreSemanticLinkAttr=t.SemanticObjectSchemas=void 0,function(e){e.mention="http://schema.skype.com/Mention",e.inputExtension="http://schema.skype.com/InputExtension",e.amsVideo="http://schema.skype.com/AMSVideo",e.amsImage="http://schema.skype.com/AMSImage",e.emoji="http://schema.skype.com/Emoji",e.live="http://schema.skype.com/Live"}(t.SemanticObjectSchemas||(t.SemanticObjectSchemas={})),t.IgnoreSemanticLinkAttr="data-ignore-semantic-link",function(e){e.color="color",e.bgColor="background-color",e.itemProps="data-itemprops",e.itemtype="itemtype",e.mentionId="data-mention-id",e.height="height",e.itemid="itemid",e.itemscope="itemscope",e.src="src",e.style="style",e.width="width"}(t.Attributes||(t.Attributes={}));t.AllowedHtmlElements=["a","abbr","acronym","address","area","article","aside","b","bdi","bdo","big","blockquote","br","caption","center","cite","code","col","colgroup","dd","del","dfn","dir","div","dl","dt","em","figcaption","figure","font","footer","h1","h2","h3","h4","h5","h6","header","hgroup","hr","i","img","img","ins","kbd","label","li","map","map","mark","menu","nav","ol","p","pre","q","rp","rp","rt","rt","ruby","s","samp","section","small","span","strike","strong","sub","sup","table","tbody","td","tfoot","th","thead","time","tr","tt","u","ul","var","wbr","mention","semantic-object"];t.AllowedHtmlAttributes=["abbr","align","alt","axis","bgcolor","border","cellpadding","cellspacing","class","clear","color","cols","colspan","compact","content","contenteditable","coords","data-ams-src","data-itemprops","data-preview-src","data-src","data-ts-imgid","data-ts-imglen","dir","face","headers","height","href","hreflang","hspace","ismap","itemid","itemprop","itemscope","itemtype","lang","language","nohref","nowrap","rel","rev","rows","rowspan","rules","scope","scrolling","shape","size","span","src","start","style","summary","target","title","type","usemap","valign","value","vspace","width","mri","type","originalsrc"],t.AllowedStyles=["@font-face","@font-feature-values","@keyframes","align-content","align-items","align-self","animation-delay","animation-direction","animation-duration","animation-fill-mode","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","animation","background-attachment","background-blend-mode","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","background","border-bottom-color","border-bottom-left","border-bottom-right","border-bottom-style","border-bottom-width","border-bottom","border-collapse","border-color","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-image","border-left-color","border-left-style","border-left-width","border-left","border-radius","border-right-color","border-right-style","border-right-width","border-right","border-spacing","border-style","border-top-color","border-top-left","border-top-right","border-top-style","border-top-width","border-top","border-width","border","bottom","box-decoration-break","box-shadow","break-after","break-before","break-inside","caption-side","clear","clip","color","column-count","column-fill","column-gap","column-rule-color","column-rule-style","column-rule-width","column-rule","column-span","column-width","columns","counter-increment","counter-reset","direction","display","empty-cells","flex-basis","flex-direction","flex-flow","flex-grow","flex-shrink","flex-wrap","flex","float","font-family","font-feature-settings","font-kerning","font-language-override","font-size-adjust","font-size","font-stretch","font-style","font-synthesis","font-variant-alternates","font-variant-caps","font-variant-east","font-variant-ligatures","font-variant-numeric","font-variant-position","font-variant","font-weight","font","hanging-punctuation","height","hyphens","image-orientation","image-rendering","image-resolution","justify-content","left","letter-spacing","line-break","line-height","list-style-image","list-style-position","list-style-type","list-style","margin-bottom","margin-left","margin-right","margin-top","margin","marquee-direction","marquee-play-count","marquee-speed","marquee-style","max-height","max-width","min-height","min-width","object-fit","object-position","opacity","order","overflow-wrap","overflow-x","overflow-y","overflow","padding-bottom","padding-left","padding-right","padding-top","padding","position","right","tab-size","table-layout","text-align-last","text-align","text-combine-upright","text-combine-upright","text-decoration-color","text-decoration-line","text-decoration-style","text-decoration","text-indent","text-justify","text-orientation","text-shadow","text-transform","text-underline-position","top","unicode-bidi","user-select","vertical-align","visibility","white-space","widows","width","word-break","word-spacing","word-wrap","writing-mode"]},86994:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.copyAllowed=void 0;const i=s(96486),o=s(51077),n=[o.MessageTypes.Text,o.MessageTypes.RichText,o.MessageTypes.UriObject,o.MessageTypes.Sms,o.MessageTypes.EncryptedText];t.copyAllowed=(e,t)=>e&&i.includes(n,t)},38165:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isMessageInSendingState=void 0;const i=s(70891);t.isMessageInSendingState=function(e,t){return t!==i.MessageRenderOrigin.CallCanvas&&e.isMessageLie()&&!e.isSendRejected()&&!e.isEphemeral()}},63189:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(74634),o=s(46096),n=s(36237);let r=new class{constructor(){this._focusMessageComposerEvent=new i.default}focusMessageComposerEvent(){return this._focusMessageComposerEvent}focusMessageComposer(){n.log(o.LogTraceArea.Navigation,"MobileContentPanelHelper focusMessageComposer"),this._focusMessageComposerEvent.fire(!0)}blurMessageComposer(){n.log(o.LogTraceArea.Navigation,"MobileContentPanelHelper blurMessageComposer"),this._focusMessageComposerEvent.fire(!1)}};t.default=r},95868:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});let s=new class{getItemToneFromString(e){const t=parseInt(e,10);return this.getItemToneFromNumber(t)}getItemToneFromNumber(e){let t;return void 0!==e&&e>0&&e<=6&&(t=e),t}};t.default=s},3404:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.computeMarks=void 0;const i=s(96486),o=s(89391),n=s(18078);t.computeMarks=function(e,t){let s=0,r=-1;const a={},l=[],d=1e3*o.default.getS4LMessagingFeaturesNoSubscription().readReceiptsAllowedLieTime,c=(e,t,s)=>{if(!n.default.isMyMri(t)){const i=a[e]||{readReceipts:[]};i.readReceipts.push({mri:t,timestamp:s}),a[e]=i}};if(i.each(e,((e,o)=>{for(;s<t.length&&e.createdTime>t[s].consumptionHorizon;){if(r>=0){const e=t[s];c(r,e.id,e.consumptionHorizonUpdateTime)}s++}const n=i.find(t,(t=>t.id===e.creator)),h=n?n.consumptionHorizonUpdateTime:0,u=e.createdTime-h;return!i.includes(l,e.creator)&&a[r]&&u>0&&u<d&&!i.isEmpty(i.remove(a[r].readReceipts,(t=>t.mri===e.creator)))&&(i.isEmpty(a[r].readReceipts)&&delete a[r],l.push(e.creator),c(o,e.creator,e.createdTime)),s!==t.length&&(e.countsForReadReceipts()&&(r=o),!0)})),r>=0)for(;s<t.length;){const e=t[s];c(r,e.id,e.consumptionHorizonUpdateTime),s++}return a}},68794:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(36237),o=s(49643),n=s(93003),r=s(53374);class a{static trackSortByFilter(e){if(!a._isSortByFilterTracked){let t;switch(a._isSortByFilterTracked=!0,e){case n.RecentsSortBy.Time:t=o.RecentConversationsFilterAction.SortByTime;break;case n.RecentsSortBy.Unread:t=o.RecentConversationsFilterAction.SortByUnread;break;case n.RecentsSortBy.Active:t=o.RecentConversationsFilterAction.SortByActive;break;default:t=r.default.switchStatementExhaustiveChecking(e)}i.track(new o.RecentConversationsFilterEvent(t))}}static trackRowSize(e){if(!a._isRowSizeTracked){let t;switch(a._isRowSizeTracked=!0,e){case n.RowSize.Default:t=o.RecentConversationsFilterAction.RowSizeDefault;break;case n.RowSize.Compact:case n.RowSize.ExtraCompact:t=o.RecentConversationsFilterAction.RowSizeCompact;break;default:t=r.default.switchStatementExhaustiveChecking(e)}i.track(new o.RecentConversationsFilterEvent(t))}}static trackShowCategories(e){if(!a._isShowCategoriesTracked){a._isShowCategoriesTracked=!0;const t=e?o.RecentConversationsFilterAction.ShowCategories:o.RecentConversationsFilterAction.HideCategories;i.track(new o.RecentConversationsFilterEvent(t))}}}t.default=a,a._isSortByFilterTracked=!1,a._isRowSizeTracked=!1,a._isShowCategoriesTracked=!1},77275:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(74958),o=s(96486),n=s(51077),r=s(16402),a=s(86374),l=s(46096),d=s(36237),c=s(12762),h=s(79829),u=s(71987),p=s(4057),g=s(53374);t.default=class{static _updateInvitations(e,t,s,i){const n=o.find(t,(e=>e.key===i));return n&&o.each(n.users,(t=>{const i=e[t.mri];(!i||t.time&&(!i.updatedTimeMs||t.time>i.updatedTimeMs))&&(e[t.mri]={invitationStatus:s,updatedTimeMs:t.time})})),e}static containsScheduledCallData(e){return!!e.properties}static extractScheduledCallFromMessage(e){const t=a.decode(e).getFirstUriObjectChild(c.ScheduledCallInviteNode);if(!t)return void d.error(l.LogTraceArea.ScheduleCall,"Received ScheduledCall message but it does not have a URIObject.");const s=e.properties&&e.properties[n.MessageProperties.ScheduledCallInviteData];if(!s)return void d.error(l.LogTraceArea.ScheduleCall,`Missing ScheduledCallInviteData property in scheduled call message,id: ${t.scheduledCallId},subject: ${t.subject?i.pii.Omit(t.subject):"''"},datetimeMs: ${r.default.getAbsoluteDisplayDateTimeString(t.datetimeMs)}`);const o=p.default.parseJsonErrorToUndefined(s);if(!this._validateScheduledCallInviteData(o,t))return;const m=e.getScheduledCallsResponses();return o.invitations=this._updateInvitations(o.invitations,m,h.ScheduledCallInvitationStatus.Accepted,n.MessageAnnotations.ScheduledCallInviteAccepted),o.invitations=this._updateInvitations(o.invitations,m,h.ScheduledCallInvitationStatus.Declined,n.MessageAnnotations.ScheduledCallInviteDeclined),{id:t.scheduledCallId,convId:e.conversationId,cuid:e.cuid,organizer:e.creator,invitations:o.invitations,consumptionHorizons:o.consumptionHorizons,datetimeMs:t.datetimeMs,reminder:t.reminder,subject:t.subject?g.default.unescapeXml(t.subject):u.default.getScheduledCallSubject(t.subject),canceledTimeMs:t.canceledTimeMs,editedTimeMs:t.editedTimeMs}}static _validateScheduledCallInviteData(e,t){if(e&&void 0!==e.invitations&&void 0!==e.consumptionHorizons)return!0;if(!e)return d.error(l.LogTraceArea.ScheduleCall,`ScheduledCallInviteData property is undefined,id: ${t.scheduledCallId},subject: ${t.subject?i.pii.Omit(t.subject):"''"},datetimeMs: ${r.default.getAbsoluteDisplayDateTimeString(t.datetimeMs)}`),!1;const s=`Unexpected content in the ScheduledCallInviteData property:id: ${t.scheduledCallId},subject: ${t.subject?i.pii.Omit(t.subject):"''"},datetimeMs: ${r.default.getAbsoluteDisplayDateTimeString(t.datetimeMs)},'invitations' property is undefined: ${!e.invitations},'consumptionHorizons' property is undefined: ${!e.consumptionHorizons}`;return d.error(l.LogTraceArea.ScheduleCall,s),!1}}},42987:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.transferServicesMeta=t.DownloadActionType=t.PostingActionType=t.BackgroundTransferActionType=void 0;const i=s(96486);t.BackgroundTransferActionType="backgroundTransfer",t.PostingActionType="messagePost",t.DownloadActionType="fileDownload",t.transferServicesMeta=function(e){const s={hasTransfer:!1,hasPost:!1,hasDownload:!1};return i.each(e,(e=>(e===t.BackgroundTransferActionType&&(s.hasTransfer=!0),e===t.PostingActionType&&(s.hasPost=!0),e===t.DownloadActionType&&(s.hasDownload=!0),!i.every(s)&&void 0))),s}},10609:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hasOnlyWebLink=t.getUrlPreviewInformationFromMetadata=t.getUrlPreviewInformation=t.getUrlPreviewInformationForMessage=void 0;const i=s(96486),o=s(12762),n=s(61694);function r(e,t){const s=e.getUrlPreviewMetadata(t);return s&&a(s,t)}function a(e,t){const s=function(e){return!(!e||!e.status_code||"200"!==e.status_code&&"ok"!==e.status_code.toLowerCase())}(e),o=function(e){return!!e&&!i.isEmpty(e.thumbnail)}(e);return{url:t,urlPreviewMetadata:e,isValid:s,hasThumbnail:o}}t.getUrlPreviewInformationForMessage=function(e,t){let s={};const a=[];return i.each(t.children,(t=>{if(t instanceof o.LinkNode&&t.getUrlType()===n.UrlType.Web){const i=t.getSanitizedHref();if(!s[i]){s[i]=!0;const t=r(e,i);t&&a.push(t)}}})),a},t.getUrlPreviewInformation=r,t.getUrlPreviewInformationFromMetadata=a,t.hasOnlyWebLink=function(e,t){return!i.isEmpty(e)&&1===e.length&&1===i.sumBy(t.children,(e=>e instanceof o.EditMessageMetaDataNode?0:1))}},91319:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(70891),n=s(26712),r=["youtube.com","m.youtube.com","www.youtube.com","youtu.be"],a=/^(?:(?:https?:)?\/\/)?(?:(?:www|m)\.)?(?:(?:youtube\.com|youtu.be))(?:\/(?:[\w\-]+\?v=|embed\/|v\/)?)([\w\-]+)(?:\S+)?$/;class l{static isYoutubeUrl(e){if(!n.default.isUrlValid(e))return!1;const t=n.default.getURIComponents(e);return!(!t||!t.host)&&i.includes(r,t.host)}static getYoutubeVideoPropsFromUrl(e){if(!l.isYoutubeUrl(e))return;const t=this._getVideoIdFromYoutubeLink(e);return t?{contentType:o.PipContentType.Youtube,videoUrl:e,videoId:t}:void 0}static getYoutubeVideoPropsFromUrlPreviewData(e){const t=e.url;if(!l.isYoutubeUrl(t))return;const s=this._getVideoIdFromYoutubeLink(t);return s?{contentType:o.PipContentType.Youtube,videoUrl:t,videoId:s,videoPreviewUrl:e.urlPreviewMetadata.thumbnail}:void 0}static _getVideoIdFromYoutubeLink(e){const t=e.match(a);if(t&&t.length>1)return t[1]}}t.default=l},72335:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(9748),o=s(50488),n={addMediaToSkypeAlbum:!1,asmImageProxy:"https://urlp.asm.skype.com/v1/url/content",audioSendTimeout:5e3,audioMessageMaxRecordingTimeMs:12e4,backgroundHeadlessPosting:!1,backgroundPostingOnPushDebounceTimeout:3e4,backgroundTransfersInFlightLimit:0,bingImageAppId:"NO_APP_ID",bingImageBaseUrl:"https://www.bingapis.com/api/v7/images",bingMapsImageryRestApiBaseUrl:"https://dev.virtualearth.net/REST/v1/Imagery/Map/CanvasLight",bingMapsLocationRestApiBaseUrl:"https://dev.virtualearth.net/REST/v1/Locations",bingMapsPoweredByImageUrl:"https://dev.virtualearth.net/Branding/logo_powered_by.png",bingMapsRestApiKey:"NO_API_KEY",bingPlacesAppId:"NO_APP_ID",browserMultiTabNotifications:{enabled:!1,activeTabRefreshInterval:4e4,activeTabExpirationInterval:6e4},tenorBaseUrl:"https://api.tenor.com/v1/",tenorApiKey:"NO_API_KEY",tenorSearchEndpoint:"search",tenorTrendingEndpoint:"trending",tenorContentFilter:"high",callingSendTimeout:3e3,captivePortalQuestionnaireFrequency:0,composerAutoCompletionDelay:500,consumePresenceFromPush:!1,contactSendTimeout:3e3,convPanelLoggingLevel:"on",enableAltMsgView:!1,disableFoursquareApi:!1,disableGifsInMediaPicker:!1,emoticonsOnlyEmoticonSize:2,enableAddAllDeviceContacts:!0,enableAddedToConversationNotification:!1,enableAndroidCustomDownloadFolder:!1,enableAndroidExpandedNotifications:!1,enableAndroidMessagingStyleNotifications:!1,enableAudioDownload:!1,enableAudioMessageDuration:!1,enableAutoDownloadFiles:!1,enableAutoDownloadFilesInCall:!1,enableBigUnicodeEmoticons:!0,enableBookmarks:!1,enableBookmarksStreamFromTop:!1,enableCacheableReactionPopup:!1,enableCaptivePortalQuestionnaire:!1,enableComposerForAndroidBrowser:!1,enableContactAddDragAndDrop:!1,enableContactShare:!1,enableContactShareDragAndDrop:!1,enableConversationSwitchWithoutRemount:!1,enableConversationTabsDropdown:!1,enableCustomFileDownloadLocation:!1,enableDebugMessageActions:!1,enableDefferedComposerOnAndroid:!1,enableDesktopComposerWithPopUpMenu:!1,enableDirectBookmarkDelete:!1,enableDoNotFormat:!1,enableDoubleTapReaction:!1,enableDraftMessagesPersistentStorage:!1,enableDragAndDropFilesFromConversationToRecentLists:!1,enableDragAndDropFromDesktopToRecentLists:!1,enableEmoticonGroups:!1,enableForwardingHtmlMessages:!1,enableForwardingQuotes:!1,enableForwardItemIconForStreamItems:!1,enableFullChatUx:!1,enableFullResolutionImageDownload:!0,enableGifPlayer:!1,enableGreetingCard:!1,enableGroupedConversations:!1,enableGroupProfileEmoticonPicker:!1,enableGuestJoinToggle:!1,enableHandlingHTMLonPaste:!1,enableHandlingHyperlinkOnPaste:!1,enableImageCachingStoreForAnimated:!1,enableImageCachingStoreForStatic:!1,enableImageForwarding:!1,enableImagePasteMobile:!1,enableInCallFindPanel:!1,enableIndividualPesItemTelemetry:!1,enableJoinEnabledThreadPropInConversationView:!1,enableKeepUnsentMessagesAtEndOfStream:!1,enableKeyboardNavigationBetweenConversations:!1,enableLastMessageAuthorAvatarDefaultSettingOn:!1,enableLastMessageAuthorAvatarOverGroupIcon:!1,enableLocationCardOnDesktop:!1,enableLocationSharingOnDesktopAndWeb:!1,enableMarkAsReadNotificationAction:!1,enableMediaPreviewDrafts:!1,enableMediaPreviewDraftsPersistentStorage:!1,enableMessageSendE2EPerfTracking:!1,enableMobileSearchInConversation:!1,enableModeratedGroupChats:!1,enableMultiMessageQuoteOnKeyboard:!1,enableNewConversationCreation:!1,enableNewEmoticonBackgroundRenderLogic:!1,enableNewReportingCategories:!1,enableReportingNonConsensualCategory:!1,enableNoNetworkInfoOnSendingMessage:!1,enableNotificationPeriods:!1,enableNotificationPrompt:!1,enableNotificationUtfFallback:!1,enableOpenLocationCardInFindPanel:!1,enableOverflowMenuGrid:!1,enableParsingHtmlMessages:!1,enablePesGifPagination:!1,enablePesGifs:!1,enablePollExtension:!1,enablePollExtensionEntryPoint:!1,enableQuotingHtmlMessages:!1,enableReactionAnnouncements:!0,enableReactionOverlays:!1,enableReactionsHoverSummary:!1,enableReadReceipts:!0,enableReply:!1,enableReportMessage:!0,enableRichStyleEditor:!1,enableSafeDomainRendering:!1,enableSecureThreadsInsecureStorage:!1,enableShareMediaPreview:!1,enableSmallEmoticonsInDesktopPicker:!1,enableSmallEmoticonsInMobilePicker:!1,enableSmsFingerprintId:!1,enableSmsGroupedConversations:!1,enableSyncFavoritesFirst:!1,enableTranslatedAllMentions:!1,enableUnifiedScrollToTimestamp:!1,enableVideoMessageForwardButton:!1,pesGifItemsLimit:20,globalMessageSearch:{initialPageSize:20,nextPageSize:0},hideHeaderInLandscape:!1,hidePrivateConversationsOnOtherEndpoints:!1,hideReportedMessages:!0,imageCaching:{cachedStatusMaxAge:3600,prefetchRetryCount:3,prefetchRetryCountNoConnection:1,prefetchRetryLongDelay:3e5,prefetchRetryShortDelay:1e3,queryCacheInFlightLimit:32},inConversationMessageSearch:{initialPageSize:30,nextPageSize:0},enableRecyclerListViewGlobal:!1,enableRecyclerListViewUseCases:[],limitForFilePicker:20,locationSendTimeout:3e3,maxMessagesToLoadFromDBForMediaSearch:25,maxNumberEmoticonsPerMessage:50,maxNumberOfCustomReactions:60,maxRecentConversationsToShow:50,mediaBarMenuOrder:i.MediaBarDefaultOrder,mediaBarNewItems:[],messageReadDelay:750,messageReadEventTimeout:5e3,messageStreamFontSizeMultiplier:{smaller:.7,small:.85,normal:1,large:1.2,larger:1.45},messageStreamStoreCacheMaxMessageCount:300,messageStreamStoreCacheSize:10,modernizeConversationList:!1,modernizeDefaultAvatars:!1,modernizeMobileHubFabs:!1,modernizeMobileTabHeader:!1,modernizeMobileTopOfTheScreen:!1,mojiSendTimeout:3e3,nativeEmoticonCacheLoggingSampleRate:0,nativeEmoticonCacheTelemetrySampleRate:0,noneGroupSendCallback:3e3,notifyForAdditionalReactions:!1,numberOfIconsInMediaBar:7,oldContentPanelForceHideTimeout:1e3,onlySendWithBackgroundSession:!1,openYouTubeLinksInPip:!1,overflowMenuOrder:i.OverflowMenuDefaultOrder,pesPickerCategoryOrder:i.PesPickerCategoryDefaultOrder,personalizationPickerCategoryOrder:i.PersonalizationPickerCategoryDefaultOrder,pictureSendTimeout:5e3,pollCardSendTimeout:3e3,pollWinnerEmoticonName:"party",pollNoVotesEmoticonName:"tumbleweed",reactionPacks:[["cry","sarcastic","surprised","cwl","heart","yes"],["rock","facepalm","porgsurprised","monkey","star","no"],["bow","gran","dance","party","highfive","ttm"]],readReceiptsAllowedLieTime:60,enableRevokeUserProfileShareLink:!1,recentConversationsIncrementor:20,retryAddMembersToThread:!1,richStyleEditorExp:o.RichtextEditorExperience.None,safeDisplayDomains:["bot-framework.azureedge.net","avatar.skype.com","api.skype.com","botavatar.azureedge.net"],scdPingIntervalInDays:14,sendingLieMaxDuration:3e3,setOverflowMenuButtonToPlainColor:!1,showMediaPickerInRightControlsForMobile:!1,showNewChatFirstInPlusMenu:!1,singleEmoticonSize:2,skypetokenAllowedDomains:["avatar.skype.com"],smsFingerprintIdTag:"systemId",staticSuggestions:[],staticSuggestionsDelay:2e3,stickerSendTimeout:3e3,stickersNotSupportedFallbackUrl:"https://go.skype.com/you.received.sticker",swiftCardSendTimeout:3e3,syncSettings:{skipConvTypeCast:!0,skipConvTypeSmsMms:!0,skipCastSync:!0,skipSmsMmsSync:!0,forceOnUiStarted:!1,forceOnForeground:!1},systemSendTimeout:3e3,textSendTimeout:3e3,transformCorruptedMessages:!0,ued:{enabled:!1,consumeEvents:!1,isExclusive:!1},unsafeFiles:[],uriFileSendTimeout:3e3,useColorfulSendButton:!1,useNewVideoMessageIcon:!1,usePesForBingGifSuggestions:!1,useSmsThreadsFor2way:!1,videoSendTimeout:5e3};t.default=n},92681:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CapturedContentHandlerForMarkupOnly=void 0;const i=s(33010),o=s(97691);t.CapturedContentHandlerForMarkupOnly=class{constructor(e){this._handler=e}handleCapturedContent(e,t){return e.forEach((e=>{(0,i.isNativeBlob)(e.file)&&this._handler(e.file.uri,e.file.size||0,e.dimensions.width,e.dimensions.height,t)})),o.Resolved()}handleMediaSelection(){return o.Rejected()}}},14920:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CapturedContentHandlerForPosting=void 0;const i=s(33010),o=s(97691),n=s(89391),r=s(98172),a=s(46096),l=s(8681),d=s(81157),c=s(6286),h=s(85207),u=s(15963);class p{constructor(e,t,s){this._conversationId=e,this._callId=t,this._parentConversationId=s}handleCapturedContent(e,t,s,i){const r=n.default.getS4LCMCFeaturesNoSubscription().enableOfficeLens;if(0===e.length)return o.Rejected("No file to process");if(r){const t=e.map((e=>{switch(e.file.type.split("/",1)[0]){case"image":return this._postImageNewFlow(e);case"video":return o.Resolved(e);default:return o.Rejected()}}));return o.all(t).then((e=>c.default.sendPreviewsWithData(this._conversationId,e,void 0)))}const a=e.map((e=>{switch(e.file.type.split("/",1)[0]){case"image":return this._postImage(e,t);case"video":return this._postVideo(e,t,i);default:return o.Rejected()}}));return o.all(a).then((()=>o.Resolved()))}handleMediaSelection(e,t,s,i){const o=p._makeScenarioInfo(t),n=this._makePostProperties(t);return d.default.postMediaSelections(e,this._conversationId,a.PostSource.MediaPicker,{callId:this._callId,scenarioInfo:o,properties:n},i,s)}static _makeScenarioInfo(e){const t={name:e?u.ScenarioName.SendVideo:u.ScenarioName.SendPicture};return e||(t.secondaryScenariosToSpawnAtCreation=[{name:u.ScenarioName.SendPictureUI}]),t}_makePostProperties(e){return!e&&this._callId&&this._parentConversationId?r.default.getReactionsThreadPostParams(this._parentConversationId):void 0}_downsizeImage(e){return(0,i.isNativeBlob)(e.file)?l.default.downsizeImageIfNeeded(e.file.uri,e.file.name,e.dimensions.width,e.dimensions.height,e.file.size):o.Rejected()}_postImage(e,t){return this._downsizeImage(e).then((e=>{const s=p._makeScenarioInfo(!1),i=this._makePostProperties(!1);return h.default.postUploadAndShowFeedbackToast([this._conversationId],e,t,!1,this._callId,void 0,s,i).then((()=>o.Resolved()))}))}_postImageNewFlow(e){return this._downsizeImage(e)}_postVideo(e,t,s){const i=p._makeScenarioInfo(!0),n=t===a.PostSource.Capture;return h.default.postVideoWithThumbnail([this._conversationId],e,t,n,i,void 0,s).then((()=>o.Resolved()))}}t.CapturedContentHandlerForPosting=p},98447:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CapturedContentHandlerForSharing=void 0;const i=s(33010),o=s(97691),n=s(33754),r=s(5899);function a(e){return e&&(0,i.isNativeBlob)(e.file)?e.file.uri:void 0}t.CapturedContentHandlerForSharing=class{constructor(e,t){this._componentContext=e,this._onShareComplete=t}handleCapturedContent(e,t,s){const i=e.map((e=>{switch(e.file.type.split("/",1)[0]){case"image":return this._shareImage(e,s);case"video":return this._shareVideo(e,s);default:return o.Rejected()}}));return o.all(i).then((()=>o.Resolved()))}handleMediaSelection(e,t){const s=n.getString(t?"CapturePreview.ShareVideoTitle":"CapturePreview.SharePhotoTitle");return r.default.shareMediaSelection(e,s,this._onShareComplete,void 0,this._componentContext),o.Resolved()}_shareImage(e,t){(0,i.isNativeBlob)(e.file)&&r.default.sharePhoto(e.file.uri,a(e.thumbnail),e.file.size,e.dimensions.width,e.dimensions.height,n.getString("CapturePreview.SharePhotoTitle"),this._onShareComplete,void 0,t,this._componentContext)}_shareVideo(e,t){(0,i.isNativeBlob)(e.file)&&r.default.shareVideo(e.file.uri,a(e.thumbnail),e.file.size||0,e.dimensions.width,e.dimensions.height,n.getString("CapturePreview.ShareVideoTitle"),this._onShareComplete,void 0,t,this._componentContext)}}},17252:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSupportedOnOS=t.isOfficeLensTelemetryActive=t.isOfficeLensAvailable=t.launchInCameraMode=t.launchInGalleryMode=void 0;const i=s(33287),o=s(2604),n=s(97691),r=s(19784),a=(s(89391),s(98278)),l=s(46096),d=s(53559),c=s(28719),h=s(36237),u=s(33754),p=s(46858),g=s(81736),m=s(64956),S=s(4057),f=(s(40363),s(78262)),y=s(89808),_=s(18037);function v(){return i.default.isImplemented()&&!1}function C(){return!1}function b(e,t){return e.then((e=>{if(e.statusCode===i.OfficeLensStatusCode.Success){h.log(l.LogTraceArea.Capture,"Successfully received OfficeLens data.");const s=e.identifiers.map((e=>{const t=e.content,s=e.thumbnail,i=(0,c.parseFileUri)(t.uri),o=i?d.default.extractFileNameWithExtension(i.path):"",n={file:{uri:t.uri,name:o,size:t.fileSize,type:t.mimetype},extension:d.default.extractFileExtension(o),dimensions:{width:t.width,height:t.height}};if(s){const e=(0,c.parseFileUri)(s.uri),t=e?d.default.extractFileNameWithExtension(e.path):"";n.thumbnail={file:{uri:s.uri,name:t,size:s.fileSize,type:s.mimetype},extension:d.default.extractFileExtension(t),dimensions:{width:s.width,height:s.height}}}return n}));return t.handleCapturedContent(s,l.PostSource.Capture).then((()=>(h.log(l.LogTraceArea.Capture,"OfficeLens media file processing successful"),p.trackMediaCapturedSuccess(s.length),n.Resolved(!0))),(e=>(h.warn(l.LogTraceArea.Capture,"OfficeLens media file processing error: "+S.default.errorAsString(e,!0)),p.trackMediaCapturedFailure("OfficeLens media file processing error: "+S.default.errorAsString(e,!0)),r.default.showErrorAlert(u.getString("Global.ErrorTitle"),a.MainRootViewId),n.Resolved(!1))))}return h.warn(l.LogTraceArea.Capture,"OfficeLens SDK error | Status code: "+e.statusCode.valueOf()),p.trackMediaCapturedFailure("OfficeLens SDK error",e.statusCode),r.default.showErrorAlert(u.getString("Global.ErrorTitle"),a.MainRootViewId),n.Resolved(!1)})).catch((e=>(h.error(l.LogTraceArea.Capture,"OfficeLens media file error: "+S.default.errorAsString(e,!0)),p.trackMediaCapturedFailure("OfficeLens media file error: "+S.default.errorAsString(e,!0)),r.default.showErrorAlert(u.getString("Global.ErrorTitle"),a.MainRootViewId),n.Resolved(!1))))}i.telemetryEventLaunchiOS.subscribe(p.handleTelemetryEventLaunchiOS),i.telemetryEventSaveiOS.subscribe(p.handleTelemetryEventSaveiOS),i.limitedAccesEvent.subscribe((function(){g.default.shouldShowLimitedPhotoSelectionPrompt()&&(m.default.showLimitedCameraRollPrompt(a.MainRootViewId),g.default.closeLimitedPhotoSelectionPrompt())})),t.launchInGalleryMode=function(e,t){const s=f.PermissionPromptOptions.SkipPrePrompt;return g.default.requestPermission(f.PermissionType.CameraRoll,s).then((t=>{if(t===o.PermissionStatus.Granted||t===o.PermissionStatus.Limited)return b((h.log(l.LogTraceArea.Capture,"Starting OfficeLens in Gallery mode"),i.default.enableTelemetryEvents(),i.default.startInGalleryMode(u.getLocale(),y.default.getPrimaryColorNoSubscription(),_.default.useDarkThemeNoSubscription(),_.default.useSystemThemeNoSubscription()).finally((()=>i.default.disableTelemetryEvents()))),e)}))},t.launchInCameraMode=function(e){const t=f.PermissionPromptOptions.SkipPrePrompt;return g.default.requestPermission(f.PermissionType.Camera,t).then((e=>{if(e===o.PermissionStatus.Granted)return g.default.requestPermission(f.PermissionType.CameraRoll,t)})).then((t=>{if(t===o.PermissionStatus.Granted)return b((h.log(l.LogTraceArea.Capture,"Starting OfficeLens in Camera mode"),i.default.enableTelemetryEvents(),i.default.startInCameraMode(u.getLocale(),y.default.getPrimaryColorNoSubscription(),_.default.useDarkThemeNoSubscription(),_.default.useSystemThemeNoSubscription()).finally((()=>i.default.disableTelemetryEvents()))),e)}))},t.isOfficeLensAvailable=v,t.isOfficeLensTelemetryActive=function(){return v()&&i.default.isTelemetryEnabled()},t.isSupportedOnOS=C},46858:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.handleTelemetryEventSaveiOS=t.handleTelemetryEventLaunchiOS=t.handleTelemetryEventSaveAndroid=t.handleTelemetryEventLaunchAndroid=t.trackMediaCapturedFailure=t.trackMediaCapturedSuccess=void 0;const i=s(72675),o=s(54086),n=s(36237),r=s(72675);t.trackMediaCapturedSuccess=function(e){n.track(new i.MediaCapturedEvent("true",r.MediaSource.OfficeLens,e))},t.trackMediaCapturedFailure=function(e,t){n.track(new i.MediaCapturedEvent("false",r.MediaSource.OfficeLens,0,e,t))},t.handleTelemetryEventLaunchAndroid=function(e){e&&n.track(new o.LensLaunchAndroid(e))},t.handleTelemetryEventSaveAndroid=function(e){e&&n.track(new o.LensSaveAndroid(e))},t.handleTelemetryEventLaunchiOS=function(e){e&&n.track(new o.LensLaunchiOS(e))},t.handleTelemetryEventSaveiOS=function(e){e&&n.track(new o.LensSaveiOS(e))}},22801:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(74958),o=s(96486),n=s(31844),r=s(97792),a=s(29860),l=s(16778),d=s(62783),c=s(74634),h=s(97691),u=s(60),p=s(89391),g=s(98925),m=s(5531),S=s(60021),f=s(51077),y=s(76621),_=s(36593),v=s(90239),C=s(25759),b=s(49868),T=s(65369),M=s(61375),I=s(59631),w=s(71830),P=s(10102),k=s(39549),A=s(46096),E=s(36237),R=s(98754),L=s(61253),F=s(4329),x=s(12056),O=s(56032),D=s(18078),B=s(17791),V=s(13651),N=s(83181),U=s(66765),H=s(16568),z=s(96856),W=s(22538),j=s(4057),G=s(78262),K=s(27795),q=s(12770),Q=s(94214),X=s(90424),$={statusCode:0,statusText:"",errorMessage:"Endpoint does not exist.",headers:{},url:"",method:"",canceled:!1,timedOut:!1,body:void 0},J={statusCode:0,statusText:"",errorMessage:"Endpoing presence doc not published",headers:{},url:"",method:"",canceled:!1,timedOut:!1,body:void 0};t.default=new class{constructor(){this._requestingWakelock=!1,this._releasingWakelock=!1,this._restLongPollResult=v.LongPollResult.Success,this._restConnectionState=v.SubscriptionState.None,this.subscriptionStateChanged=new c.default,this.disconnected=new c.default,this.reconnected=new c.default,this._wasConnected=!1,this.controlMessagesReceived=new c.default,this.incomingCallMessageReceived=new c.default,this.userPresenceReceived=new c.default,this.extendedPresenceDocReceived=new c.default,this.inviteFreeQuarantineTriggered=new c.default,this._trackedConvPropSets={},this._trackedThreadPropSets={},this.releasingWakelock=new c.default,this._longRunningRequests={},this._loggingOut=!1,this._subscriptions=[],this._restConnectionStateChanged=(e,t)=>{this._restConnectionState=e,this._restLongPollResult=t,this._connectionStateChanged()},this.feedInitialEndpointUrl=e=>{this._initialEndpointUrl=e},this.handleLocationChange=(e,t)=>{this._restTransport.handleLocationChange(e,t)},this._handleInviteFreeQuarantine=()=>{this.inviteFreeQuarantineTriggered.fire()},this.handleTrouterEvent=(e,t)=>{const s=A.MessageOrigin.Trouter,i=j.default.parseJsonErrorable(e);if(o.isError(i))E.error(A.LogTraceArea.ChatService,"Failed to parse Trouter event.");else{switch(i.cv=t,i.resourceType){case"CustomUserProperties":break;case"ThreadUpdate":const e=i.resource;if(w.isOneToOneThread(e.id))return;break;case"ConversationUpdate":const t=i.resource;if(w.isOneToOneThread(t.id)){const e=(0,k.default)().getOtherPartyMriFromOneToOneThreadId(t.id);if(o.isUndefined(e))return void E.track(new K.DevDebug("UED-Trouter","ConversationUpdate: missing 1:1 mapping"));t.id=e}t.lastMessage&&this._transformMessageToV1(t.lastMessage,t.id);break;case"NewMessage":case"MessageUpdate":const s=i.resource;if(this._transformMessageToV1(s),o.isUndefined(s.conversationLink))return void E.track(new K.DevDebug("UED-Trouter",`${i.resourceType}: empty transformed conversationLink`));break;default:return E.warn(A.LogTraceArea.ChatService,"Unhandled Trouter event with resource type: "+i.resourceType),void E.track(new K.DevDebug("UED-Trouter","Unknown event resource type"+i.resourceType))}this._handleEvents([i],s)}},this._handleEvents=(e,t=A.MessageOrigin.LongPoll)=>{let s={},n=[],r={};o.each(e,(e=>{switch(E.log(A.LogTraceArea.ChatService,`handle ${A.MessageOrigin[t]} Event: ${e.resourceType} ${e.cv?" , MS-CV: "+e.cv:""}`),e.resourceType){case"CustomUserProperties":o.extend(s,e.resource);break;case"ConversationUpdate":{const t=e.resource;E.log(A.LogTraceArea.ChatService,`Conv: ${i.pii.Mri(t.id)}, Version: ${t.version}`),y.default.queueConvUpdate(t)}break;case"ThreadUpdate":{const t=e.resource;E.log(A.LogTraceArea.ChatService,`Conv: ${i.pii.Mri(t.id)}, Version: ${t.version}`),y.default.queueThreadUpdate(t)}break;case"NewMessage":case"MessageUpdate":let a=e.resource;if(0===a.messagetype.indexOf("Control/"))n.push(a);else if(0===a.messagetype.indexOf("ThreadActivity/MemberConsumptionHorizonUpdate")){const e=w.getParsedConversationId(a);if(!e){E.log(A.LogTraceArea.ReadReceipts,"Failed to parse conversationLink: "+i.pii.Omit(a.conversationLink));break}const t=j.default.parseJsonErrorable(a.content);if(o.isError(t)){E.log(A.LogTraceArea.ReadReceipts,"Failed to parse consumptionHorizon: "+i.pii.Omit(a.content));break}const s={id:t.user,consumptionhorizon:t.consumptionhorizon};E.log(A.LogTraceArea.ReadReceipts,"Event: Message: Conv: "+i.pii.Mri(e)+", Id: "+a.id+", content: "+i.pii.Omit(a.content)+", consumptionHorizon: "+t.consumptionhorizon),y.default.queueMemberConsumptionHorizonUpdate(e,s)}else if(0===a.messagetype.indexOf("Signal/Flamingo"))E.log(A.LogTraceArea.ChatService,"Received Signal/Flamingo message, ID: "+a.id),this.incomingCallMessageReceived.fire(a);else{const s=w.getParsedConversationId(a);if(!s){E.log(A.LogTraceArea.ReadReceipts,"Failed to parse conversationLink: "+i.pii.Omit(a.conversationLink));break}const n=w.getCreatorMriForMessageFromLink(a.from),r=a.clientmessageid;E.log(A.LogTraceArea.ChatService,"Event: Message: Conv: "+i.pii.Mri(s)+", Id: "+a.id+", CMID: "+r+", CorrelationId:"+S.getCorrelationIdFromMessageParts(n,s,r)+", type: "+e.resourceType+", time: "+e.time);const l=Date.now().valueOf();E.log(A.LogTraceArea.LowBandwidth,"<NFR> || Receive_IM || Latency_Timestamp || "+l+" || Latency || "+(l-o.toNumber(a.id)));const d={message:a,origin:t,isOtherEndpointActive:!1,correlationVector:e.cv};y.default.queueMessagesForConversation(s,[d])}break;case"EndpointPresence":case"ReadReceipt":break;case"UserPresence":const l=e.resource,d=l.selfLink.split("/")[5];r[d]=l;break;default:E.warn(A.LogTraceArea.ChatService,`${t} Unhandled Event, MS-CV: ${e.cv}`,e)}})),o.isEmpty(s)||y.default.queuePartialUserPropertySet(s),n.length>0&&this.controlMessagesReceived.fire(n),o.isEmpty(r)||this.userPresenceReceived.fire(r),y.default.processQueuedBundle()},this._updateMyPropertiesRequestSuccessHandler=e=>(e&&(this._lastUserPropertiesUpdateTime=Date.now()),y.default.setNewUserPropertySet(e).then((()=>{if(this._fetchAndUpdatePropertiesDeferred){const e=this._fetchAndUpdatePropertiesDeferred;this._fetchAndUpdatePropertiesDeferred=void 0,e.resolve(void 0)}})).catch((e=>{if(this._fetchAndUpdatePropertiesDeferred){const t=this._fetchAndUpdatePropertiesDeferred;this._fetchAndUpdatePropertiesDeferred=void 0,t.reject(e)}}))),this._updateMyPropertiesRequestFailureHandler=e=>{if(!this._fetchPropertiesPromise&&this._fetchAndUpdatePropertiesDeferred){const t=this._fetchAndUpdatePropertiesDeferred;this._fetchAndUpdatePropertiesDeferred=void 0,t.reject(e)}},this.errorHandler=new _.ChatServiceErrorHandler(this.handleLocationChange,this._handleInviteFreeQuarantine),this._restTransport=new V.default(this,this._handleEvents,this._restConnectionStateChanged,this.errorHandler),this._messagingRestClient=new O.default(this.errorHandler),W.RegisterStartupable(this,"ChatService",[y.default,R.default,B.default,H.default,Q.default,U.default]),F.default.registerForLogout(this,"ChatService")}startup(){this._initialEndpointUrl&&U.default.setRestEndpointUrl(this._initialEndpointUrl),U.default.endpointInfoChanged.subscribe(((e,t)=>{this._restTransport.endpointInfoUpdated(e,t),this._pushSubscription&&this._pushSubscription.endpointInfoUpdated(e,t),I.default.endpointInfoUpdated(e,t),this._checkTransportState();const s=t.id,i=e.id;i&&s&&!w.areEndpointIdsEqual(i,s)&&X.getDurableEndpointId().then((e=>{(w.areEndpointIdsEqual(e,i)||w.areEndpointIdsEqual(e,s))&&(E.log(A.LogTraceArea.ChatService,"Deleting old endpoint "+s),this.serviceDeleteEndpoint(s).then((()=>{E.log(A.LogTraceArea.ChatService,"Endpoint ID "+s+" successfully deleted")})).catch((e=>{E.log(A.LogTraceArea.ChatService,"Failed to delete endpoint ID "+s+": "+j.default.errorAsString(e))})))}))})),this._restTransport.startup(),this._pushSubscription=new b.default(this,"Push",X.calculatePnhInterestedResources());const e=y.default.conversationsUpdated.subscribe((e=>{this._receivedConversationUpdates(e)}));this._subscriptions.push(e);const t=y.default.getRawConversationMetaMemoryCache();this._receivedConversationUpdates(t),this._connectivitySubToken=B.default.subscribe((()=>{B.default.getPassedConnectivityCheck()?(B.default.isNetworkingAvailable()&&(E.log(A.LogTraceArea.ChatService,"ReportedConnectivityStore reported connectivity, kicking transports"),this._resetBackoffTimers()),this._checkTransportState()):E.log(A.LogTraceArea.ChatService,"ReportedConnectivityStore reported captive portal, no action")}));const s=u.default.subscribeForChanges("ChatService",(e=>{e===l.Types.AppActivationState.Active&&(E.log(A.LogTraceArea.ChatService,"ActivationState reported active, kicking transports"),this._resetBackoffTimers()),this._checkTransportState()}));this._subscriptions.push(s);const i=n.default.onResume.subscribe((e=>{E.log(A.LogTraceArea.ChatService,"Resuming from sleep, kicking transports causeId: "+e),this._resetBackoffTimers(),this._checkTransportState()}));return this._subscriptions.push(i),this._appConfigSubToken=p.default.subscribe((()=>{this._checkIsConnectedStatus(),this._checkTransportState()})),this._capabilitiesSubToken=m.default.subscribe((()=>{this._checkTransportState()})),this._tokenStoreSubToken=Q.default.subscribe((()=>{this._checkTransportState()}),Q.TriggerKeys.SkypeTokenKey),this._stateStoreSubToken=N.default.subscribe((()=>{this._checkTransportState()}),N.TriggerKeys.UIDisplayedKey),this._checkTransportState(),h.Resolved()}getRestTransport(){return this._restTransport}serviceSetActiveEndpointTimeout(e,t){const s=(new C.ChatServicePresenceRequestFactory).setActiveEndpointTimeout(e,t);return this.performRequest(s).then(o.noop)}_resetBackoffTimers(){this._restTransport.resetBackoffTimers(),this._messagingRestClient.resetBackoffTimers()}_checkTransportState(){if(!this._loggingOut&&Q.default.hasUsableSkypeToken()&&N.default.isUIDisplayed())l.App.getActivationState(),l.Types.AppActivationState.Active,this._restTransport.setConnectionEnabled(!0,"Foreground");else{let e=this._loggingOut?"logout":Q.default.hasUsableSkypeToken()?N.default.isUIDisplayed()?"test":"no UI":"no token";if(this._restTransport.setConnectionEnabled(!1,e),this._loggingOut)return}if(this.isConnected())this._wakelockId||this._requestingWakelock||(this._requestingWakelock=!0,E.log(A.LogTraceArea.ChatService,"Requesting Wakelock"),r.default.requestMaxTime("Transport").finally((()=>{this._requestingWakelock=!1})).then((e=>{E.log(A.LogTraceArea.ChatService,"Got Wakelock: "+e),this._wakelockId&&(E.error(A.LogTraceArea.ChatService,"Got wakelock when already had wakelock: "+this._wakelockId),r.default.release(this._wakelockId,"Transport:duplicate")),this._wakelockId=e,this._checkTransportState()}),(e=>{E.error(A.LogTraceArea.ChatService,"Failed to get wakelock - "+(e?j.default.errorAsString(e):""))})));else if(this._wakelockId&&!this._releasingWakelock){this._releasingWakelock=!0;const e=p.default.getConfigSettingsNoSubscription().chat.backgroundReleaseWakeLockTime,t=this._wakelockId;E.log(A.LogTraceArea.ChatService,"Releasing Wakelock: "+t),this.releasingWakelock.fire(),a.default.setTimeout((()=>{r.default.release(t,"Transport").finally((()=>{this._releasingWakelock=!1})).then((()=>{E.log(A.LogTraceArea.ChatService,"Released Wakelock: "+t),this._wakelockId===t?this._wakelockId=void 0:E.error(A.LogTraceArea.ChatService,"Released wakelock when we had a different wakelock: "+this._wakelockId),this._checkTransportState()}),(e=>{E.error(A.LogTraceArea.ChatService,"Failed to release wakelock ("+t+") - "+j.default.errorAsString(e))}))}),e)}}pokeLongRunningRequest(e){this._longRunningRequests[e]||(this._longRunningRequests[e]=!0,this._checkTransportState())}removeLongRunningRequest(e){this._longRunningRequests[e]&&(delete this._longRunningRequests[e],this._checkTransportState())}logout(e,t,s){this._loggingOut=!0,this._restTransport.logout(),y.default.setBundleProcessingEnabled(!1);const i=U.default.getEndpointId();U.default.logout(e);const n=H.default.deleteIds({chatServiceSessionInfo:!0},!s),r=[];return i&&r.push(this.serviceDeleteEndpoint(i)),n.always((()=>h.raceTimer(h.all(r),500))).then(o.noop)}_receivedConversationUpdates(e){o.each(o.toArray(e),(e=>{e&&(o.each(e.conv.getPendingConvPropLies(),((t,s)=>{this._trackConversationPropertySet(e.conv.id,s,t.value,t.additionalParams)})),o.each(e.conv.getPendingThreadPropLies(),((t,s)=>{this._isThreadIconLie(t,s)||z.ThreadPropLiesAllowed[s]!==z.PropLieType.Local&&this._trackThreadPropertySet(e.conv.id,s,t.value)})))}))}_isThreadIconLie(e,t){return e.value&&o.startsWith(e.value.toString(),"blob:")&&t===w.ThreadProps.Picture}_connectionStateChanged(){E.log(A.LogTraceArea.ChatService,"Connection State Changed: REST: "+v.SubscriptionState[this._restConnectionState]+", LP result: "+v.LongPollResult[this._restLongPollResult]),this._checkIsConnectedStatus(),this.subscriptionStateChanged.fire()}_checkIsConnectedStatus(){const e=this.isConnected();this._wasConnected!==e&&(E.log(A.LogTraceArea.ChatService,"IsConnected changed: "+this._wasConnected+" -> "+e),this._wasConnected=e,e?this.reconnected.fire():this.disconnected.fire())}isConnected(){return this._restConnectionState===v.SubscriptionState.CreatedActive}getSubscriptionState(){return this._restConnectionState}getLongPollResult(){return this._restLongPollResult}debug_getCurrentCloudUrl(){return this._restTransport.debug_getCurrentCloudUrl()}restoreEndpoints(e,t){return I.default.restoreEndpoint(e,this._restTransport,t)}_transformMessageToV1(e,t){let s=e;const i=this._transformConversationLinkToV1(e,t);s.messagetype=this._transformMessageTypeToV1(e.messagetype),s.conversationLink=i,s.skypeemoteoffset=(0,f.getJsonFromMessageProperty)(e.properties,f.MessageProperties.Skypeemoteoffset)}_transformMessageTypeToV1(e){return e.endsWith("/None")?e.substr(0,e.indexOf("/None")):e}_transformConversationLinkToV1(e,t){const s=null!=t?t:e.to;if(w.isOneToOneThread(s)){const t=w.getCreatorMriForMessageFromLink(e.from);let i=t;if(D.default.isMyMri(t)&&(i=(0,k.default)().getOtherPartyMriFromOneToOneThreadId(s),o.isUndefined(i)))return;return w.getConversationLinkWithNewId(e.conversationLink,i)}return e.conversationLink}fetchMemberConsumptionHorizon(e){this._serviceGetMemberConsumptionHorizons(e).then((t=>{E.log(A.LogTraceArea.ReadReceipts,"Fetched consumption horizons for: "+i.pii.Mri(e)+", content: ",o.map(t,(e=>({id:i.pii.Mri(e.id),consumptionhorizon:e.consumptionhorizon})))),o.each(t,(t=>{y.default.queueMemberConsumptionHorizonUpdate(e,t)})),y.default.processQueuedBundle()})).catch((t=>{E.warn(A.LogTraceArea.ChatService,"Failed to fetch consumption horizons for: "+i.pii.Mri(e)+" Error code: "+t.errorCode+" Message: "+t.errorMessage)}))}setConversationProperty(e,t,s,o){return E.log(A.LogTraceArea.ChatService,"setConversationProperty "+(z.ConvPropLiesAllowed[t]?"with":"without")+" lie: "+i.pii.Mri(e)+": "+t+" => "+i.pii.Omit(JSON.stringify(s))+(o?", params: "+JSON.stringify(o):"")),z.ConvPropLiesAllowed[t]?y.default.setConversationPropertyLie(e,t,s,o).then((()=>{const i=y.default.getLastConversationPropertyLie(e,t);return!i||i.value===s&&i.additionalParams===o||(s=i.value,o=i.additionalParams,E.log(A.LogTraceArea.ChatService,"setConversationProperty: lie updated to last know value")),this._trackConversationPropertySet(e,t,s,o)})):this._serviceSetConversationProperty(e,t,s,o)}_trackConversationPropertySet(e,t,s,o){const n=this._trackedConvPropSets[e]||(this._trackedConvPropSets[e]={});let r=n[t];return r&&(0,L.default)(r.value,s)&&(0,L.default)(r.additionalParams,o)||(r=n[t]={value:s,additionalParams:o,defer:h.Defer(),inFlight:!1},E.log(A.LogTraceArea.ChatService,"Tracking Conversation Property Set: "+i.pii.Mri(e)+": "+t+" => "+i.pii.Omit(JSON.stringify(s))+(o?", params: "+JSON.stringify(o):"")),this._checkOnConvPropSet(e,t,s,o)),r.defer.promise()}_checkOnConvPropSet(e,t,s,o){const n=this._trackedConvPropSets[e];if(!n)return;const r=n[t];r&&(0,L.default)(r.value,s)&&(0,L.default)(r.additionalParams,o)&&(r.inFlight||(r.waitUntil&&r.waitUntil>Date.now()?q.default.setExpiration((()=>{this._checkOnConvPropSet(e,t,s,o)}),r.waitUntil):(E.log(A.LogTraceArea.ChatService,"Setting Conversation Prop on Server: "+i.pii.Mri(e)+": "+t+" => "+i.pii.Omit(JSON.stringify(s))+(o?", params: "+i.pii.Omit(JSON.stringify(o)):"")),r.inFlight=!0,this._serviceSetConversationProperty(e,t,s,o).then((()=>{y.default.confirmConversationPropertyLie(e,t,s,o).then((()=>{E.log(A.LogTraceArea.ChatService,"Confirmed Setting Conversation Prop on Server: "+i.pii.Mri(e)+": "+t+" => "+i.pii.Omit(JSON.stringify(s))+(o?", params: "+i.pii.Omit(JSON.stringify(o)):"")),r.defer.resolve(void 0)})).always((()=>{delete n[t]}))}),(i=>{if(0===i.statusCode)return r.inFlight=!1,r.retryTimer?r.retryTimer.calculateNext():r.retryTimer=this._createNewPropExponentialTime(),r.waitUntil=Date.now()+r.retryTimer.getTime(),void this._checkOnConvPropSet(e,t,s,o);y.default.revertConversationPropertyLie(e,t,s,o).then((()=>{r.defer.reject("Error changing conversation property: "+j.default.errorAsString(i))})).always((()=>{delete n[t]}))})))))}_createNewPropExponentialTime(){return new d.ExponentialTime(1e3,6e4)}setThreadProperty(e,t,s){return E.log(A.LogTraceArea.ChatService,"setThreadProperty "+(z.ThreadPropLiesAllowed[t]?"with":"without")+" lie: "+i.pii.Mri(e)+": "+t+" => "+i.pii.Omit(JSON.stringify(s))),z.ThreadPropLiesAllowed[t]?y.default.setThreadPropertyLie(e,t,s).then((()=>this._trackThreadPropertySet(e,t,s))):this._serviceSetThreadProperty(e,t,s)}_trackThreadPropertySet(e,t,s){const o=this._trackedThreadPropSets[e]||(this._trackedThreadPropSets[e]={});let n=o[t];return n&&(0,L.default)(n.value,s)||(n=o[t]={value:s,defer:h.Defer(),inFlight:!1},E.log(A.LogTraceArea.ChatService,"Tracking Thread Property Set: "+i.pii.Mri(e)+": "+t+" => "+i.pii.Omit(JSON.stringify(s))),this._checkOnThreadPropSet(e,t,s)),n.defer.promise()}_checkOnThreadPropSet(e,t,s){const o=this._trackedThreadPropSets[e];if(!o)return;const n=o[t];n&&(0,L.default)(n.value,s)&&(n.inFlight||(n.waitUntil&&n.waitUntil>Date.now()?q.default.setExpiration((()=>{this._checkOnThreadPropSet(e,t,s)}),n.waitUntil):(E.log(A.LogTraceArea.ChatService,"Setting Thread Prop on Server: "+i.pii.Mri(e)+": "+t+" => "+i.pii.Omit(JSON.stringify(s))),n.inFlight=!0,this._serviceSetThreadProperty(e,t,s).then((()=>{y.default.confirmThreadPropertyLie(e,t,s).then((()=>{E.log(A.LogTraceArea.ChatService,"Confirmed setting Thread Prop on Server: "+i.pii.Mri(e)+": "+t+" => "+i.pii.Omit(JSON.stringify(s))),n.defer.resolve(void 0)})).always((()=>{delete o[t]}))}),(i=>{if(0===i.statusCode)return n.inFlight=!1,n.retryTimer?n.retryTimer.calculateNext():n.retryTimer=this._createNewPropExponentialTime(),n.waitUntil=Date.now()+n.retryTimer.getTime(),void this._checkOnThreadPropSet(e,t,s);y.default.revertThreadPropertyLie(e,t,s).then((()=>{n.defer.reject("Error changing Thread property: "+j.default.errorAsString(i))})).always((()=>{delete o[t]}))})))))}setMessageProperty(e,t,s,i,o){return(e.properties||{})[t]===s?h.Resolved():y.default.setMessagePropertyLie(e.conversationId,e.cuid,t,i).then((()=>this.serviceSetMessageProperty(e.conversationId,e.getServerIdForPropertyChanges(),t,s,o).catch((s=>(y.default.revertMessagePropertyLie(e.conversationId,e.cuid,t,i),h.Rejected("Error changing message property: "+j.default.errorAsString(s)))))))}setConversationIconLie(e,t){const s=w.ThreadProps.Picture;y.default.setThreadPropertyLie(e,s,t).then((()=>y.default.confirmThreadPropertyLie(e,s,t)),(i=>i&&y.default.revertThreadPropertyLie(e,s,t)))}setConversationLiveState(e,t){return w.isThread(e)?this.setThreadProperty(e,w.ThreadProps.LiveState,t):this.setConversationProperty(e,w.ConversationProps.LiveState,t)}setConversationLiveStateLie(e,t){const s=w.ThreadProps.LiveState;y.default.setThreadPropertyLie(e,s,t).then((()=>y.default.confirmThreadPropertyLie(e,s,t)),(i=>i&&y.default.revertThreadPropertyLie(e,s,t)))}setConversationLeaveTimeLie(e,t){const s=w.ThreadProps.LastLeaveAt;y.default.setThreadPropertyLie(e,s,t).then((()=>y.default.confirmThreadPropertyLie(e,s,t)),(i=>i&&y.default.revertThreadPropertyLie(e,s,t)))}setFakeConsumptionHorizonBeforeFirstEverMessage(e,t,s=!1){if(t.isEphemeral())return void E.warn(A.LogTraceArea.ConsumptionHorizon,"setFakeConsumptionHorizonBeforeFirstEverMessage "+i.pii.Mri(e)+" tried to set a consumption horizon on an ephemeral message "+t.getOriginalClientMessageId());const n=t.getOriginalServerId(),r=t.getCHID();if(!r||!n)return void E.warn(A.LogTraceArea.ConsumptionHorizon,"setFakeConsumptionHorizonBeforeFirstEverMessage "+i.pii.Mri(e)+" tried to set a consumption horizon on an incomplete message: clientMessageId:"+t.getOriginalClientMessageId()+", serverId: "+n+", chid: "+r);const a=(o.toNumber(n)-1).toString(),l=(o.toNumber(r)-1).toString(),d=w.getConsumptionHorizonForMessageAndCHID(a,l);this.setConsumptionHorizon(e,d,s)}setConsumptionHorizonToMessage(e,t,s=!1){const i=t.getConsumptionHorizonString();i&&this.setConsumptionHorizon(e,i,s)}setConsumptionHorizon(e,t,s=!1){if(!t)return h.Rejected();const o=y.default.getConversationMetaFromMemoryCache(e);E.log(A.LogTraceArea.ConsumptionHorizon,"setConsumptionHorizon "+i.pii.Mri(e)+" to "+t+" canBeOlder="+s+" oldCH="+(o?o.conv.getConsumptionHorizon():"unknown"));const n={bookmark:s?"true":"false","x-ecs-etag":p.default.getCachedEcsConfigEtag()};return this.setConversationProperty(e,w.ConversationProps.ConsumptionHorizon,t,n)}setConversationAlerts(e,t){return this.setConversationProperty(e,w.ConversationProps.Alerts,t?"true":"false")}removeConversationIcon(e){return this.setThreadProperty(e,w.ThreadProps.Picture,null)}setThemeColor(e,t){return this.setConversationProperty(e,w.ConversationProps.Color,P.serializeColorInfo(t))}setJoinEnabled(e,t){return this.setThreadProperty(e,w.ThreadProps.JoinEnabled,t?"true":"false")}setBannedSkypeIds(e,t){const s=o.map(t,(e=>w.sanitizeMri(e,w.Namespaces.SkypeId)));return this.setThreadProperty(e,w.ThreadProps.BannedUserList,o.join(s,","))}discloseHistory(e,t){return this.setThreadProperty(e,w.ThreadProps.HistoryDisclosed,t?"true":"false")}setDisableGuestJoin(e,t){return this.setThreadProperty(e,w.ThreadProps.DisableAnonymousJoin,t?"true":"false")}setModeratedThreadProperty(e,t){return this.setThreadProperty(e,w.ThreadProps.ModeratedThread,t?"true":"false")}renameConversation(e,t){return this.setThreadProperty(e,w.ThreadProps.TopicName,t)}setConversationSubscription(e,t){return this.setConversationProperty(e,w.ConversationProps.Subscription,t).then((()=>this.setConversationAlerts(e,t!==w.SubscriptionTypes.Muted)))}setConversationArchived(e,t){return this.setConversationProperty(e,w.ConversationProps.Archived,t?Date.now():"")}setConversationPinned(e,t){return this.setConversationProperty(e,w.ConversationProps.Pinned,t?"true":"false")}setConversationFavorite(e,t){const s=this.setConversationProperty(e,w.ConversationProps.Favorite,t?"true":"false");return h.all([this.setConversationPinned(e,t),s]).then(o.noop)}setConversationStatus(e,t){return this.setConversationProperty(e,w.ConversationProps.ConversationStatus,A.ConversationStatus[t])}setConversationBlocked(e,t){return this.setConversationProperty(e,w.ConversationProps.ConversationBlocked,t?"true":"false")}setTranslationState(e,t){return w.isThread(e)?this.setThreadProperty(e,w.ThreadProps.Translated,g.TranslationState[t]):this.setConversationProperty(e,w.ConversationProps.Translated,g.TranslationState[t])}setMessageTranslationLocale(e,t){const s=!t||o.isEmpty(t)?null:t;return w.isThread(e)?this.setThreadProperty(e,w.ThreadProps.MessageTranslationLocale,s):this.setConversationProperty(e,w.ConversationProps.MessageTranslationLocale,s)}fetchAndUpdateMyProperties(e){if(this._fetchAndUpdatePropertiesDeferred)return this._fetchAndUpdatePropertiesDeferred.promise();if(!e&&this._lastUserPropertiesUpdateTime){const e=p.default.getConfigSettingsNoSubscription().chat.userPropertiesExpirationTime;if(e&&Date.now()<this._lastUserPropertiesUpdateTime+e)return h.Resolved()}const t=h.Defer();return this._fetchAndUpdatePropertiesDeferred=t,this._fetchPropertiesPromise=this.serviceGetMyProperties(),this._fetchPropertiesPromise.finally((()=>{this._fetchPropertiesPromise=void 0})).then(this._updateMyPropertiesRequestSuccessHandler,this._updateMyPropertiesRequestFailureHandler),t.promise()}getChatServiceErrorResponseMetadata(e){return _.ChatServiceErrorHandler.getChatServiceErrorResponseMetadata(e)}performRequest(e,t){if(e.requiresEndpoint&&!U.default.endpointExists())return E.log(A.LogTraceArea.ChatService,"Trying to perform a request: "+e.scenario+" that requires an endpoint , when the endpoint does not exist!"),E.track(new K.DevDebug("CSRequestNoEndpoint",e.scenario)),h.Rejected($);if(p.default.getConfigSettingsNoSubscription().endpointPresence.ensurePresencePublished&&e.requirePresenceDocPublished&&!U.default.presenceDocPublished())return E.log(A.LogTraceArea.ChatService,"Trying to perform a request: "+e.scenario+" that requires presence doc to be published"),E.track(new K.DevDebug("CSRequestPresenceDocNotPublished",e.scenario)),h.Rejected(J);const s={telemetryAttributes:t,scenario:e.scenario,mriForTelemetry:e.mriForTelemetry,isLoginRequest:e.isLogin,isSkypetokenOnlyRequest:e.isSkypetokenOnlyRequest},i=p.default.getConfigSettingsNoSubscription().chat.msgApiConfig,o=i&&i.enabled;return e.isV1OnlyRequest||!o?this._restTransport.performRequest(e,s):this._messagingRestClient.performRequest(e,s)}performPostingServiceMessageRequest(e,t){const s={source:M.PostMessageToConversationSource[t]};return this.performRequest(e,s)}performRequestBackground(e,t,s,i){const n={};s.endpointId&&(n.endpointId=s.endpointId);const r=o.extend(n,i),a=p.default.getConfigSettingsNoSubscription().chat.msgApiConfig,l=a&&a.enabled;return s.isV1OnlyRequest||!l?this._restTransport.performRequestBackground(e,t,s,r):this._messagingRestClient.performRequestBackground(e,t,s,r)}serviceGetMyProperties(){return this.performRequest(T.getMyProperties()).then((e=>e.body))}serviceSetMyProperty(e,t){return this.performRequest(T.setMyProperty(e,t)).then(o.noop)}serviceSetMyUserRing(e){return this.performRequest(T.setMyUserRing(e)).then(o.noop)}serviceEnumerateEndpoints(){return this.performRequest(T.enumerateEndpoints()).then((e=>({endpoints:e.body,tcid:w.getTcidDataFromServerMessageResponse(e)})))}serviceCreateEndpoint(e){return this.performRequest(T.createEndpoint(e)).then((e=>{const t={CSScenario:T.CSRequestScenarios.createEndpoint};return{endpointId:this._getLastResourceIdFromServerMessageResponse(e,t),tcid:w.getTcidDataFromServerMessageResponse(e)}}))}serviceUpdateEndpoint(e,t){return this.performRequest(T.updateEndpoint(e,t)).then((e=>({endpoint:e.body,tcid:w.getTcidDataFromServerMessageResponse(e)})))}serviceDeleteEndpoint(e){return this.performRequest(T.deleteEndpoint(e)).then(o.noop)}serviceClearEndpoint(e){return this.performRequest(T.clearEndpoint(e)).then(o.noop)}servicePublishEndpointPresence(e,t){return this.performRequest(T.publishEndpointPresence(e,t)).then(o.noop)}serviceGetEndpointPresenceDoc(e){return this.performRequest(T.getEndpointPresenceDoc(e)).then((e=>e.body))}serviceCreateSubscription(e,t){return this.performRequest(T.createSubscription(e,t)).then((t=>{const s=w.getTcidDataFromServerMessageResponse(t),i={CSScenario:T.CSRequestScenarios.updateSubscription,Epid:e},o=this._getLastResourceIdFromServerMessageResponse(t,i);return o?{subscriptionId:o,tcid:s}:h.Rejected(t)}))}serviceDeleteSubscription(e,t){return this.performRequest(T.deleteSubscription(e,t)).then(o.noop)}serviceUpdateSubscriptionProperty(e,t,s,i){return this.performRequest(T.updateSubscriptionProperty(e,t,s,i)).then((e=>w.getTcidDataFromServerMessageResponse(e)))}servicePollSubscription(e,t,s){return this.performRequest(T.pollSubscription(e,t,s)).then((e=>e.body))}serviceGetMyConversations(e="All",t=1,s,i=100){return this.performRequest(T.getMyConversations(e,t,s,i)).then((e=>({body:e.body,headers:e.headers})))}_serviceSetConversationProperty(e,t,s,i){const n=o.map(i,((e,t)=>"&"+encodeURIComponent(t)+"="+encodeURIComponent(e))).join(""),r="v1/users/ME/conversations/"+encodeURIComponent(e)+"/properties?name="+encodeURIComponent(t)+n;return this.performRequest({method:"PUT",path:r,passedData:{[t]:s},scenario:"setConversationProperty"}).then(o.noop)}serviceGetConversationMessages(e,t=1,s,i=100,o){let n="v1/users/ME/conversations/"+encodeURIComponent(e)+"/messages?view="+encodeURIComponent(T.calcMessagesViewParam());return n+="&pageSize="+Math.min(i,100),s&&(n+="&syncState="+encodeURIComponent(s)),n+="&startTime="+t,o&&o<=G.NumberShim.MAX_SAFE_INTEGER&&(n+="&endTime="+o),this.performRequest({method:"GET",path:n,scenario:"getConversationMessages"}).then((e=>e.body))}serviceGetConversationMessagesEarlierThanTime(e,t=1,s,i=100,o=Number.MAX_VALUE){return this._serviceLoopConversationMessagesEarlierThanTime(e,t,o,s,i,[],0)}_serviceLoopConversationMessagesEarlierThanTime(e,t,s,i,n,r,a){return this.serviceGetConversationMessages(e,t,i,n,s).then((i=>{i.messages.length&&r.push(i.messages);const l=a+i.messages.length;if(l<n&&i._metadata.backwardLink){const a=i.messages.length?Number(o.minBy(i.messages,(e=>e.version)).version):s,d=w.decodeSyncState(i._metadata.syncState);return this._serviceLoopConversationMessagesEarlierThanTime(e,t,a,d,n,r,l)}return{messages:o.flatten(r),_metadata:i._metadata}}))}serviceGetConversationMessagesLaterThanTime(e,t,s,i,o=100,n=!1){return n?this._serviceBinarySearchGetConversationMessagesLaterThanTime(e,t,s,void 0,i,o):this._serviceLoopConversationMessagesLaterThanTime(e,t,s,i,o,[],0)}_serviceBinarySearchGetConversationMessagesLaterThanTime(e,t,s,i,n,r=100){return this.serviceGetConversationMessages(e,t,n,r,s).then((a=>{if(a.messages.length){if(a.messages.length<r&&!a._metadata.backwardLink)return a;{const i=Math.min(Number(o.maxBy(a.messages,(e=>e.version)).version)+2,s),l=Math.floor((i+t)/2),d=s;return this._serviceBinarySearchGetConversationMessagesLaterThanTime(e,t,l,d,n,r)}}if(a._metadata.backwardLink){const o=w.decodeSyncState(a._metadata.syncState);return this._serviceBinarySearchGetConversationMessagesLaterThanTime(e,t,s,i,o,r)}if(i){const t=s,o=i<=G.NumberShim.MAX_SAFE_INTEGER?Math.floor((i+s)/2):i;return this._serviceBinarySearchGetConversationMessagesLaterThanTime(e,t,o,i,n,r)}return a}))}_serviceLoopConversationMessagesLaterThanTime(e,t,s,i,n,r,a){return this._serviceBinarySearchGetConversationMessagesLaterThanTime(e,t,s,void 0,i,n).then((i=>{if(i.messages.length){r.push(i.messages);const l=a+i.messages.length;if(l<n){const a=i.messages.length?Number(o.maxBy(i.messages,(e=>e.id)).id):t,d=w.decodeSyncState(i._metadata.syncState);return this._serviceLoopConversationMessagesLaterThanTime(e,a,s,d,n,r,l)}}return{messages:o.flatten(r),_metadata:i._metadata}}))}serviceGetConversationMessage(e,t){return this.performRequest(T.getConversationMessage(e,t)).then((e=>e.body))}servicePostMessageToConversation(e,t,s,i=T.CSRequestScenarios.postMessageToConversation){const o={source:M.PostMessageToConversationSource[s]},n=T.postMessageToConversation(e,t,i);return this.performRequest(n,o).then((e=>{const t={CSScenario:T.CSRequestScenarios.postMessageToConversation},s=this._getLastResourceIdFromServerMessageResponse(e,t);return Object.assign(Object.assign({},e),{body:{serverId:s}})}))}serviceDeleteMessage(e,t){const s=T.deleteMessage(e,t);return this.performRequest(s)}serviceSetMessageProperty(e,t,s,i,n=!1){const r={propKey:s},a=T.setMessageProperty(e,t,s,i,n);return this.performRequest(a,r).then(o.noop)}serviceSetMessagePropertyBackground(e,t,s,i,o,n,r=!1,a){return this.performRequestBackground(e,t,T.setMessageProperty(s,i,o,n,r),a)}_getAddMembersPartialFailures(e){return 207===e.statusCode&&e.body&&e.body.multipleStatus?o.filter(e.body.multipleStatus,(e=>0!==e.statusCode)):[]}serviceCreateThread(e,t,s,i={[w.ThreadProps.HistoryDisclosed]:"true",[w.ThreadProps.JoinEnabled]:"true"},n){const r=p.default.getS4LMessagingFeaturesNoSubscription().retryAddMembersToThread,a={source:M.CreateThreadSource[s]};i[w.ThreadProps.ThreadType]&&(a[w.ThreadProps.ThreadType]=i[w.ThreadProps.ThreadType]),i[w.ThreadProps.Source]&&(a.Partner=i[w.ThreadProps.Source]);const l=T.createThread(e,t,i);return n&&(l.scenario=n),this.performRequest(l,a).then((e=>{const t=w.asSkypeThreadId(this._getLastResourceIdFromServerMessageResponse(e,{CSScenario:"createThread"})),s=this._getAddMembersPartialFailures(e);if(r&&s.length){const e={};return o.each(s,(t=>e[t.id]=G.ThreadMemberAccessType.User)),this.serviceAddMembersToThread(t,e,!1).then((e=>({threadId:t,failedMembers:e})))}return{threadId:t,failedMembers:s}}))}serviceGetThread(e){return this.performRequest(T.getThread(e)).then((e=>e.body))}_serviceSetThreadProperty(e,t,s){if(!w.isThread(e))return h.Rejected("ID passed isn't a thread");const i={propKey:t},n=T.setThreadProperty(e,t,s);return this.performRequest(n,i).then(o.noop)}serviceAddMemberToThread(e,t,s,i=!0){const o={source:M.AddMemberToThreadSource[s]},n=T.addMemberToThread(e,t,i);return this.performRequest(n,o).then((()=>{E.track(new x.AddContactsTelemetry(s,e))}),(o=>i?this.serviceAddMemberToThread(e,t,s,!1):h.Rejected(o)))}serviceAddMembersToThread(e,t,s=!1,i,n){const r=T.addMembersToThread(e,t);return n&&(r.scenario=n),this.performRequest(r,i).then((t=>{const i=this._getAddMembersPartialFailures(t);if(s&&i.length){const t={};return o.each(i,(e=>t[e.id]=G.ThreadMemberAccessType.User)),this.serviceAddMembersToThread(e,t,!1)}return i}))}serviceRemoveMemberFromThread(e,t,s){const i={source:M.RemoveMemberFromThreadSource[s]},o=T.removeMemberFromThread(e,t);return this.performRequest(o,i).then((()=>{if(D.default.isMyMri(t)){const t=(0,k.default)().getConversation(e);if(t){const s=t.getLastJoinAt();s&&this.setConversationLeaveTimeLie(e,String(s+1))}}})).catch((e=>404===e.statusCode&&e.errorCode&&736===e.errorCode?h.Resolved():h.Rejected(e)))}serviceDeleteConversation(e,t){const s={source:M.DeleteConversationSource[t]},i=T.deleteConversation(e);return this.performRequest(i,s).then(o.noop)}serviceAddNewContact(e,t){const s={source:M.AddNewContactSource[t]},i=T.addNewContact(e);return this.performRequest(i,s).then(o.noop)}serviceInvokeAgent(e,t,s,i,o){const n={source:M.InvokeAgentSource[i]},r=T.invokeAgentRequest(e,t,s,o);return this.performRequest(r,n).then((e=>e.body))}serviceGetWebhookUrl(e,t){const s=T.getWebhookUrl(e,t);return this.performRequest(s).then((e=>e.body))}_serviceGetMemberConsumptionHorizons(e){return this.performRequest(T.getMemberConsumptionHorizons(e)).then((e=>e.body.consumptionhorizons))}_getLastResourceIdFromServerMessageResponse(e,t){const s=e.headers.location;if(!s){const s=w.getTcidDataFromServerMessageResponse(e),i=Object.assign({CSContextId:s.contextId,CSDate:s.date,StatusCode:e.statusCode},t);return E.track(new K.DevDebug("Empty location header",JSON.stringify(i))),""}return decodeURIComponent(o.last(s.split("/")))}serviceSendE2eeInvite(e,t,s,i){const o=T.e2eeInvite(s,e,t);return this.performRequest(o)}serviceSendE2eeReject(e){const t=T.e2eeReject(e);return this.performRequest(t)}serviceSendE2eeAccept(e,t,s){const i=T.e2eeAccept(s,e,t);return this.performRequest(i)}serviceSendE2eeConfirm(e){const t=T.e2eeConfirm(e);return this.performRequest(t)}serviceDeleteConnectors(e,t){const s=T.deleteConnectors(e,t);return this.performRequest(s).then(o.noop)}test_getTransport(){return this._restTransport}test_setPushSubscription(e){this._pushSubscription=e}test_reset(){this._loggingOut=!1,U.default.test_reset();const e=this._subscriptions;this._subscriptions=[],o.each(e,(e=>e.unsubscribe())),this._tokenStoreSubToken&&(Q.default.unsubscribe(this._tokenStoreSubToken),this._tokenStoreSubToken=void 0),this._appConfigSubToken&&(p.default.unsubscribe(this._appConfigSubToken),this._appConfigSubToken=void 0),this._capabilitiesSubToken&&(m.default.unsubscribe(this._capabilitiesSubToken),this._capabilitiesSubToken=void 0),this._connectivitySubToken&&(B.default.unsubscribe(this._connectivitySubToken),this._connectivitySubToken=void 0),this._stateStoreSubToken&&(N.default.unsubscribe(this._stateStoreSubToken),this._stateStoreSubToken=void 0)}}},76621:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(74958),o=s(96486),n=s(74634),r=s(97691),a=s(59294),l=s(42826),d=s(89391),c=s(63413),h=s(60021),u=s(51077),p=s(90239),g=s(9959),m=s(71830),S=s(62141),f=s(65848),y=s(85455),_=s(62843),v=s(36763),C=s(25793),b=s(70942),T=s(79041),M=s(46096),I=s(97811),w=s(57347),P=s(36237),k=s(98754),A=s(61253),E=s(94847),R=s(51470),L=s(78735),F=s(18078),x=s(96856),O=s(12692),D=s(22538),B=s(4057),V=s(40363),N=s(78262),U=s(26712),H=s(53374);t.default=new class{constructor(){this._lastFetchedTimestamp=N.NumberShim.MAX_SAFE_INTEGER,this._userProperties={},this.userPropertiesChanged=new n.default,this.messagesProcessed=new n.default,this.messagesProcessedWithBundleInfo=new n.default,this.conversationsUpdated=new n.default,this.alertsUpdated=new n.default,this.decryptionFailed=new n.default,this.callLogsReceived=new n.default,this.guestNameUpdate=new n.default,this._conversationMetaMap={},this._conversationMetaLoadPromises={},this._conversationIdsToEnsureLoaded=[],this._waitingForJoinedKnowledgeList={},this._waitingForJoinedAndRealKnowledgeList={},this._bundleProcessingEnabled=!0,this._alertsTrackedByAlertsStore=[],this._ensureConversationsLoadedDebounced=o.debounce((()=>{const e=this._conversationIdsToEnsureLoaded;this._conversationIdsToEnsureLoaded=[],P.log(M.LogTraceArea.GenericUnsafe,"Ensuring Conversations Loaded: "+o.join(o.map(e,(e=>i.pii.Mri(e))),", ")),this.getConversationMetasAsync(e).then((()=>{if(this._ensureConvLoadedDefer){const e=this._ensureConvLoadedDefer;this._ensureConvLoadedDefer=void 0,e.resolve(void 0)}}))})),this._setUpPendingBundle(),D.RegisterStartupable(this,"ChatServiceDataService",[c.default,T.default,k.default])}startup(){return this._userProperties=k.default.getData(S.InternalKeys.Prefs)||{},r.Resolved()}test_flushConversationCache(){this.conversationsUpdated.dispose(),this.messagesProcessed.dispose(),this.messagesProcessedWithBundleInfo.dispose(),this._loadingNeedsSyncConversationsPromise=void 0,this._conversationMetaMap={}}loadAndCacheAllNonHighlightsConversations(){const e=Date.now()-y.ConversationHistoryTimeSpanImportant;let t;return this._loadAndCacheAllConversationsPromise||(this._loadAndCacheAllConversationsPromise=S.default.getAllNonHighlightConversationMetas().then((t=>{this._lastFetchedTimestamp=Math.min(e,this._lastFetchedTimestamp),this._cacheLoadedConvs(t)})),t=this._loadAndCacheAllConversationsPromise,this._loadAndCacheAllConversationsPromise.finally((()=>{this._loadAndCacheAllConversationsPromise=void 0}))),t||this._loadAndCacheAllConversationsPromise}recalculateCountsForConversations(e){return o.each(e,(e=>{this._queueRecalculateConversationCounts(e)})),this.processQueuedBundle()}loadAndCacheNeedsSyncConversations(){return this._loadingNeedsSyncConversationsPromise||(this._loadingNeedsSyncConversationsPromise=S.default.openTransaction([S.Stores.Conversations],!1).then((e=>e.getNeedsSyncConversations().then((t=>{e.markCompleted(),this._cacheLoadedConvs(t)}))))),this._loadingNeedsSyncConversationsPromise}setAlertsTrackedByAlertsStore(e){this._alertsTrackedByAlertsStore=e}_cacheLoadedConvs(e){e=o.compact(e),o.isEmpty(e)||(o.remove(e,(e=>e.conv&&e.conv.id in this._conversationMetaMap)),o.each(e,(e=>{this._conversationMetaMap[e.conv.id]=e})),this.conversationsUpdated.fire(e))}_checkJoinedConvUpdates(e){o.each(e,(e=>{if(!e)return;const t=this._waitingForJoinedKnowledgeList[e.conv.id];t&&e&&e.conv.isCurrentUserMember()&&(delete this._waitingForJoinedKnowledgeList[e.conv.id],t.resolve(e.conv));const s=this._waitingForJoinedAndRealKnowledgeList[e.conv.id];s&&e&&e.conv.isCurrentUserMember()&&!e.conv.isFake&&(delete this._waitingForJoinedAndRealKnowledgeList[e.conv.id],s.resolve(e.conv))}))}createFakeConversation(e,t,s){if(this._conversationMetaMap[e])return;const i=y.default.newFakeEmptyMeta(e);this._conversationMetaMap[e]=i,this.conversationsUpdated.fire([i])}ensureConversationLoadedOrFaked(e,t,s){return this.getConversationMetaAsync(e).then((i=>!i&&(this.createFakeConversation(e,t,s),!0)))}ensureConversationLoaded(e){return this.getConversationMetaFromMemoryCache(e)?r.Resolved():(this._conversationIdsToEnsureLoaded.push(e),this._ensureConvLoadedDefer||(this._ensureConvLoadedDefer=r.Defer()),this._ensureConversationsLoadedDebounced(),this._ensureConvLoadedDefer.promise())}waitForJoinedKnowledgeOfConversation(e){return this.getConversationMetaAsync(e).then((t=>t&&t.conv.isCurrentUserMember()?r.Resolved(t.conv):(this._waitingForJoinedKnowledgeList[e]||(this._waitingForJoinedKnowledgeList[e]=r.Defer()),this._waitingForJoinedKnowledgeList[e].promise())))}waitForJoinedKnowledgeOfRealConversation(e){return this.getConversationMetaAsync(e).then((t=>t&&t.conv.isCurrentUserMember()&&!t.conv.isFake?r.Resolved(t.conv):(this._waitingForJoinedAndRealKnowledgeList[e]||(this._waitingForJoinedAndRealKnowledgeList[e]=r.Defer()),this._waitingForJoinedAndRealKnowledgeList[e].promise())))}getUserProperties(){return this._userProperties}getUserProperty(e){return this._userProperties[e]}hasFetchedUserPropertiesAtLeastOnce(){return!o.isEmpty(this._userProperties)}getConversationMetaAsync(e,t){return this.getConversationMetasAsync([e],t).then((t=>t[e]))}getConversationMetasAsync(e,t){const s=o.uniq(o.filter(e,(e=>!(e in this._conversationMetaMap)))),i=!t,[n,a]=o.partition(s,(e=>i&&this._conversationMetaLoadPromises[e])),l=o.map(n,(e=>{const t=this._conversationMetaLoadPromises[e];if(t)return t.then(o.noop);a.push(e)}));if(a.length>0){let e=(t?t.getConversationMetas(a):S.default.getConversationMetas(a)).then((e=>{const t=o.values(e);return this._cacheLoadedConvs(t),this._checkJoinedConvUpdates(t),o.each(a,(e=>{e in this._conversationMetaMap||(this._conversationMetaMap[e]=void 0);this._conversationMetaLoadPromises[e]&&delete this._conversationMetaLoadPromises[e]})),e}));o.each(a,(t=>{t in this._conversationMetaMap||(this._conversationMetaLoadPromises[t]=e.then((e=>e[t])))})),l.push(e.then(o.noop))}return r.all(l).then((()=>{const t={};return o.each(e,(e=>{t[e]=this._conversationMetaMap[e]})),t}))}getLastFetchedTimestamp(){return this._lastFetchedTimestamp}getConversationMetaFromMemoryCache(e){return this._conversationMetaMap[e]}getRawConversationMetaMemoryCache(){return this._conversationMetaMap}setBundleProcessingEnabled(e){this._bundleProcessingEnabled=e}processQueuedBundle(){return this._processBundle()}queueConvUpdate(e){let t=this._getPendingBundleConv(e.id);(!t.conversationUpdate||t.conversationUpdate.version<e.version)&&(t.conversationUpdate=e)}queueThreadUpdate(e){let t=this._getPendingBundleConv(e.id);(!t.threadUpdate||t.threadUpdate.version<e.version)&&(t.threadUpdate=e)}queueConvSyncInfoChange(e,t,s=!1){this._getPendingBundleConv(e).syncInfo=t}queueMessagesForConversation(e,t){let s=this._getPendingBundleConv(e);s.messageActions||(s.messageActions={}),o.each(t,(t=>{this._addServerMessageToPendingBundle(e,t)}))}queueMessagesForConversationAndWait(e,t){return this.queueMessagesForConversation(e,t),this._processBundle()}queuePartialUserPropertySet(e){let t;t=this._pendingBundle&&this._pendingBundle.newUserPropSet?this._pendingBundle.newUserPropSet:this._processingBundle&&this._processingBundle.newUserPropSet?this._processingBundle.newUserPropSet:this._userProperties;const s=o.extend({},t,e);(0,A.default)(this._pendingBundle.newUserPropSet||this._userProperties,s)||(this._pendingBundle.newUserPropSet=s)}queueMemberConsumptionHorizonUpdate(e,t){let s=this._getPendingBundleConv(e);s.memberConsumptionHorizons||(s.memberConsumptionHorizons={}),s.memberConsumptionHorizons[t.id]=t}setConvSyncInfo(e,t){return this.queueConvSyncInfoChange(e,t),this._processBundle()}setNewUserPropertySet(e){return e?(delete e.lastActivityAt,delete e.lastActivityAt2,(0,A.default)(this._pendingBundle.newUserPropSet||this._userProperties,e)?r.Resolved():(this._pendingBundle.newUserPropSet=e,this._processBundle())):r.Resolved()}setConvListSyncInfo(e){return this._pendingBundle.convListSyncInfo=e,this._processBundle()}brickConversation(e){return this._getPendingBundleConv(e).brickConversation=!0,this._processBundle()}setConversationPropertyLie(e,t,s,i){let o=this._getPendingBundleConv(e);const n={value:s,additionalParams:i};return o.conversationPropLieInfo?o.conversationPropLieInfo[t]=n:o.conversationPropLieInfo={[t]:n},this._processBundle()}confirmConversationPropertyLie(e,t,s,i){let o=this._getPendingBundleConv(e);const n={value:s,additionalParams:i};return o.conversationPropLieConfirms?o.conversationPropLieConfirms[t]=n:o.conversationPropLieConfirms={[t]:n},this._processBundle()}revertConversationPropertyLie(e,t,s,i){let o=this._getPendingBundleConv(e);const n={value:s,additionalParams:i};return o.conversationPropLieReverts?o.conversationPropLieReverts[t]=n:o.conversationPropLieReverts={[t]:n},this._processBundle()}getLastConversationPropertyLie(e,t){let s=this._getPendingBundleConv(e);return s.conversationPropLieInfo&&s.conversationPropLieInfo[t]}setThreadPropertyLie(e,t,s){let i=this._getPendingBundleConv(e);const o={value:s};return i.threadPropLieInfo?i.threadPropLieInfo[t]=o:i.threadPropLieInfo={[t]:o},this._processBundle()}confirmThreadPropertyLie(e,t,s){let i=this._getPendingBundleConv(e);const o={value:s};return i.threadPropLieConfirms?i.threadPropLieConfirms[t]=o:i.threadPropLieConfirms={[t]:o},this._processBundle()}revertThreadPropertyLie(e,t,s){let i=this._getPendingBundleConv(e);const o={value:s};return i.threadPropLieReverts?i.threadPropLieReverts[t]=o:i.threadPropLieReverts={[t]:o},this._processBundle()}processPushNotificationMessage(e,t,s,i){const o={message:e,origin:s,isOtherEndpointActive:!e.isactive,correlationVector:i};return this._addServerMessageToPendingBundle(t,o),this._processBundle()}processPushNotificationConsumptionHorizon(e,t,s){if(this._conversationMetaMap[e]&&s&&s<=this._conversationMetaMap[e].conv.convViewVersion)return r.Resolved();let i=this._getPendingBundleConv(e);return i.consumptionHorizonVersion&&s&&s<=i.consumptionHorizonVersion?r.Resolved():(i.consumptionHorizonUpdate=t,i.consumptionHorizonVersion=s,this._processBundle())}confirmMessageSend(e,t,s,o,n){P.log(M.LogTraceArea.ChatService,"confirmMessageSend: convId:"+i.pii.Mri(e)+" cuid:"+t+" serverId:"+s+" clientMessageId:"+o);let r=this._getPendingBundleConvMessageActions(e,t);return r.confirmSendId=s,r.confirmSendCMID=o,r.confirmSendVersion=n,this._processBundle()}rejectMessageSend(e,t,s,o){const n=m.getCuidForMessage(t);P.log(M.LogTraceArea.ChatService,"rejectMessageSend: convId:"+i.pii.Mri(e)+" cuid:"+n);let r=this._getPendingBundleConvMessageActions(e,n);return r.rejectSendCMID=t.clientmessageid,r.rejectSendTimestamp=s,r.rejectSendRetryInfo=o,this._processBundle()}applyMessageLie(e,t){return R.default.notifyMessageLieReachedChatServiceDataService(t.clientmessageid),this._applyMessageLie(e,t)}applyMessageLieWithPropertyLie(e,t,s,i){return this._applyMessageLie(e,t,s,i)}markMessageAsReported(e,t,s){return this._getPendingBundleConvMessageActions(e,t).isReported=s,this._processBundle()}applyMessageLieAndNotifyPrematurely(e,t,s){R.default.notifyMessageLieReachedChatServiceDataService(s.clientmessageid);const o={message:O.default.fromFirstLie(s,e,F.default.getSkypeMri(),t),reactionUpdates:p.EmptyReactionsUpdate,isOtherEndpointActive:!1,details:[{origin:M.MessageOrigin.LocalChange,clientMessageId:s.clientmessageid,correlationVector:void 0}]};return P.log(M.LogTraceArea.ChatService,`Sending premature message lie. ConvId: ${i.pii.Mri(e)} clientmessageid: ${s.clientmessageid}`),this.messagesProcessed.fire([o.message]),this.messagesProcessedWithBundleInfo.fire([o]),this._applyMessageLie(e,s)}_applyMessageLie(e,t,s,o){const n=m.getCuidForMessage(t);P.log(M.LogTraceArea.ChatService,"applyMessageLie: convId:"+i.pii.Mri(e)+" cuid:"+n);let r=this._getPendingBundleConvMessageActions(e,n);return r.applyMessageLies?r.applyMessageLies.push(t):r.applyMessageLies=[t],s?this.setMessagePropertyLie(e,n,s,o):this._processBundle()}revertMessageLie(e,t,s){let i=this._getPendingBundleConvMessageActions(e,t);return i.revertMessageLies?i.revertMessageLies.push(s):i.revertMessageLies=[s],this._processBundle()}setMessagePropertyLie(e,t,s,i){let o=this._getPendingBundleConvMessageActions(e,t);return o.setPropDeltas?o.setPropDeltas.push({key:s,value:i}):o.setPropDeltas=[{key:s,value:i}],this._processBundle()}revertMessagePropertyLie(e,t,s,i){let o=this._getPendingBundleConvMessageActions(e,t);return o.revertPropDeltas?o.revertPropDeltas.push({key:s,value:i}):o.revertPropDeltas=[{key:s,value:i}],this._processBundle()}setFileEncryptionKeys(e,t,s){return this._getPendingBundleConvMessageActions(e,t).fileEncryptionKeys=s,this._processBundle()}_setUpPendingBundle(){this._pendingBundle={}}_getPendingBundleConv(e){this._pendingBundle.convs||(this._pendingBundle.convs={});let t=this._pendingBundle.convs[e];return t||(t={},this._pendingBundle.convs[e]=t),t}_getPendingBundleConvMessageActions(e,t){let s=this._getPendingBundleConv(e);s.messageActions||(s.messageActions={});let i=s.messageActions[t];return i||(i={},s.messageActions[t]=i),i}_addServerMessageToPendingBundle(e,t){const s=m.getCuidForMessage(t.message);if(m.isEncryptedThread(e)){const e=t.message;if(C.default.shouldIgnoreMessage(e))return}let i=this._getPendingBundleConvMessageActions(e,s);i.serverMessages?i.serverMessages.push(t):i.serverMessages=[t]}_queueRecalculateConversationCounts(e){this._getPendingBundleConv(e).recalculateCounts=!0}test_processServerMessage(e,t=M.MessageOrigin.LongPoll){const s=o.isArray(e)?e:[e];return o.each(s,(e=>{const s=m.getParsedConversationId(e);if(s){const i={message:e,origin:t,isOtherEndpointActive:!1};this._addServerMessageToPendingBundle(s,i)}})),this._processBundle()}_preProcessBundle(e){let t=[];return o.each(e.convs,((e,s)=>{if(m.isAllGlobalClearMri(s)||!m.isEncryptedThread(s))return;let i=[];o.each(e.messageActions,((e,t)=>{let n=[],a=[];o.each(e.serverMessages,(e=>{const i=e.message.messagetype,l=i===u.MessageTypes.EncryptedText,d=i===u.MessageTypes.EncryptedMedia,c=i===u.MessageTypes.EncryptedCall;if(!l&&!d&&!c)return;const h=e.message,p=h.fromdeviceid,g=h.content,f=h.encryptedkey,y=c?u.MessageTypes.Call:i;if(p&&f){let i,l;n.push(this.getConversationMetaAsync(s).then((n=>n?(i=n.conv.getLastEncryptionHandshakeChange(),l=Number(h.id),i&&l&&i>l?(a.push(e),void P.log(M.LogTraceArea.E2EEncryption,`Discarding CMID(${h.clientmessageid}), it's from older secure session`)):S.default.getMessageByCuid(n.conv.id,t).then((s=>{const i=m.getCreatorMriForMessageFromLink(h.from),l=F.default.isMyMri(i);if(s){if(l)return void(e.message=Object.assign(Object.assign({},e.message),{content:s.content,messagetype:y}));if(s.isKnownServerMessageVersion(e.message.version))return P.log(M.LogTraceArea.E2EEncryption,`Ignoring already known server message version ${e.message.version} for CMID ${h.clientmessageid}`),void a.push(e)}else if(l)return P.log(M.LogTraceArea.E2EEncryption,`Ignoring own server message with unprocessed lie, CMID ${h.clientmessageid}`),void a.push(e);return _.default.decryptMessageForConv(n.conv,g,f).then((s=>{let i;if(d){const e=B.default.parseJsonErrorable(s);if(o.isError(e))return r.Rejected(e);i=e.originalContent,this.setFileEncryptionKeys(n.conv.id,t,e)}else i=s;e.message=Object.assign(Object.assign({},e.message),{content:i,messagetype:y})}))}))):r.Rejected(`No meta found for conv id ${s}`))).catch((t=>{C.default.isFatalDecryptionError(t)?(P.error(M.LogTraceArea.E2EEncryption,`Failed to decrypt message, CMID(${h.clientmessageid}, arrival ts ${l}, handshake ts ${i}),`,B.default.errorAsString(t)),P.track(new v.E2eeDecryptionFailure(t.toString())),this.decryptionFailed.fire(s)):P.log(M.LogTraceArea.E2EEncryption,`Non-fatal error decrypting message, probably a dupe, CMID(${h.clientmessageid}),`,B.default.errorAsString(t)),a.push(e)})))}})),i.push(r.all(n).then((()=>{e.serverMessages=o.difference(e.serverMessages,a),o.isEmpty(e.serverMessages)&&delete e.serverMessages})))})),t.push(r.all(i).then((()=>{e.messageActions&&(e.messageActions=o.omitBy(e.messageActions,(e=>o.isEmpty(e))))})))})),r.all(t).then(o.noop)}_processBundle(){if(this._processingBundle||!this._bundleProcessingEnabled)return this._pendingBundle.deferral||(this._pendingBundle.deferral=r.Defer()),this._pendingBundle.deferral.promise();if(o.isEmpty(this._pendingBundle.convs)&&!this._pendingBundle.convListSyncInfo&&!this._pendingBundle.newUserPropSet)return r.Resolved();this._processingBundle=this._pendingBundle;const e=this._processingBundle;e.deferral||(e.deferral=r.Defer());const t=e.deferral;this._setUpPendingBundle();const s=Date.now();return P.log(M.LogTraceArea.ChatService,"Starting ProcessBundle: "+o.keys(e.convs).length+" Convs"+(e.convListSyncInfo?", ConvListSyncInfo":"")+(e.newUserPropSet?", NewUserPropSet":"")),w.default.indicateBusyOperation(),this._preProcessBundle(e).then((()=>{const n=[S.Stores.Conversations,S.Stores.Messages,S.Stores.InternalData,S.Stores.Alerts];return e.convs&&V.default.getCallLogMri()in e.convs&&n.push(S.Stores.CallLogs),S.default.openTransaction(n,!0).then((n=>{const _=Date.now();let v=[],C=[],T=new E.default((e=>e.guid));const w=[],A=[],R=this.getConversationMetasAsync(o.keys(e.convs),n);let D,B=o.map(e.convs,((e,t)=>{if(m.isAllGlobalClearMri(t))return;if(!m.isMri(t))return void P.error(M.LogTraceArea.ChatService,"Attempted to process a conversation with an invalid mri: "+i.pii.Mri(t));P.log(M.LogTraceArea.ChatService,"Processing ConvBundle: "+i.pii.Mri(t)+": "+o.compact([e.messageActions?o.keys(e.messageActions).length+" MessageActions":void 0,e.conversationUpdate?"ConversationUpdate":void 0,e.conversationPropLieInfo?o.keys(e.conversationPropLieInfo).length+" ConversationPropLieInfo":void 0,e.conversationPropLieConfirms?o.keys(e.conversationPropLieConfirms).length+" ConversationPropLieConfirms":void 0,e.conversationPropLieReverts?o.keys(e.conversationPropLieReverts).length+" ConversationPropLieReverts":void 0,e.threadUpdate?"ThreadUpdate":void 0,e.threadPropLieInfo?o.keys(e.threadPropLieInfo).length+" ThreadPropLieInfo":void 0,e.threadPropLieConfirms?o.keys(e.threadPropLieConfirms).length+" ThreadPropLieConfirms":void 0,e.threadPropLieReverts?o.keys(e.threadPropLieReverts).length+" ThreadPropLieReverts":void 0,e.syncInfo?"SyncInfo":void 0,e.brickConversation?"Brick":void 0,e.recalculateCounts?"RecalculateCounts":void 0]).join(", "));const s=R.then((e=>e[t])),c=e.conversationUpdate&&e.conversationUpdate.lastMessage&&m.getCuidForMessage(e.conversationUpdate.lastMessage),S=o.keys(e.messageActions);c&&!o.includes(S,c)&&S.push(c);const _=S.length?n.getMessagesByCuid(t,S):void 0,k=e.messageActions?n.getAlertsForConversation(t):void 0;return r.all([s,_,k]).then((([s,S,_])=>{let k=s?s.conv:void 0,E=!1,R=!1;const D=o.keyBy(S,(e=>e.cuid));let B=!!_;_&&T.trackOriginalItems(_.concat(this._alertsTrackedByAlertsStore));let V=[],N=e.syncInfo||(s?s.syncInfo:void 0),U=!1;const H=e.conversationUpdate;if(H){let e;H.properties&&H.properties[m.ConversationProps.ConsumptionHorizon]&&P.log(M.LogTraceArea.ConsumptionHorizon,"Merging CH: "+H.properties[m.ConversationProps.ConsumptionHorizon]),c&&(e=D[c]),k?(P.log(M.LogTraceArea.ChatService,"Merging Conversation: "+i.pii.Mri(H.id)+", Version: "+k.convViewVersion+" => "+H.version+(k.isThread()?", ThreadVersion: "+k.getThreadProperty(m.ThreadProps.ThreadDetailsVersion)+" => "+H.threadProperties[m.ThreadProps.ThreadDetailsVersion]:"")),k=k.mergeConversationUpdate(H,e)):(P.log(M.LogTraceArea.ChatService,"New Conversation from ConvView: "+i.pii.Mri(H.id)+": Version: "+H.version+(m.isThread(H.id)?", ThreadVersion: "+H.threadProperties[m.ThreadProps.ThreadDetailsVersion]:"")),k=x.default.fromRawConversation(H,e)),E=!0}let z=[];const W=e.threadUpdate;if(W&&(k?(P.log(M.LogTraceArea.ChatService,"Merging Thread: "+i.pii.Mri(W.id)+", Details Version: "+k.threadDetailsVersion+" => "+W.version),U=0!==k.threadDetailsVersion&&W.properties[m.ThreadProps.HistoryDisclosed]!==k.getThreadProperty(m.ThreadProps.HistoryDisclosed),k=k.mergeThreadUpdate(W)):(P.log(M.LogTraceArea.ChatService,"New Conversation from Thread: "+i.pii.Mri(W.id)+", Details Version: "+W.version),k=x.default.fromRawThread(W))),!k){if(e.consumptionHorizonUpdate&&!e.messageActions&&!e.brickConversation)return void P.log(M.LogTraceArea.ChatService,"Skipped creating empty conversation from CH push: "+i.pii.Mri(t));P.log(M.LogTraceArea.ChatService,"New Conversation from Nothing: "+i.pii.Mri(t)),k=x.default.newFakeEmptyConversation(t)}if(o.each(e.conversationPropLieConfirms,((e,t)=>{k=k.confirmConvPropertyLieApplied(t,e.value,e.additionalParams)})),o.each(e.conversationPropLieReverts,((e,t)=>{k=k.revertConvPropertyLie(t,e.value,e.additionalParams)})),o.each(e.conversationPropLieInfo,((e,t)=>{k=k.setConvPropertyLie(t,e.value,e.additionalParams)})),o.each(e.threadPropLieConfirms,((e,t)=>{k=k.confirmThreadPropertyLieApplied(t,e.value)})),o.each(e.threadPropLieReverts,((e,t)=>{k=k.revertThreadPropertyLie(t,e.value)})),o.each(e.threadPropLieInfo,((e,t)=>{k=k.setThreadPropertyLie(t,e.value)})),e.consumptionHorizonUpdate&&(k=k.mergeConsumptionHorizonPush(e.consumptionHorizonUpdate,e.consumptionHorizonVersion)),e.brickConversation&&(k=k.brickConversation(),N={messagesStale:!1,messagesSyncState:void 0,messageHistoryStartTime:Number.MAX_VALUE}),e.memberConsumptionHorizons&&(k=k.mergeMemberConsumptionHorizons(o.values(e.memberConsumptionHorizons))),e.messageActions){this._remapCallEndedEventMessage(e.messageActions,D);let s=0;o.each(e.messageActions,((e,i)=>{let n;i in D&&(n=D[i]);let r=n,l=M.MessageOrigin.LocalChange,c=!1,p=[];if(o.each(e.serverMessages,(e=>{if(l=e.origin,c=c||e.isOtherEndpointActive,p.push({origin:e.origin,clientMessageId:e.message.clientmessageid,correlationVector:e.correlationVector}),r)r=r.applyServerMessage(e.message);else if(r=O.default.fromFirstServerMessage(e.message),!r)return;if(l===M.MessageOrigin.PushNotification&&P.track(new I.FundamentalsMessagePushDebug(r.getLatestRelevantClientMessageId()||"",h.getCorrelationIdForMessage(r),"ServerMessageApplied")),m.isCallLog(t)){const e=u.getJsonFromMessageProperty(r.properties,"call-log");e?(e.messageCuid=r.cuid,w.push(e),P.log(M.LogTraceArea.Calling,`Accepted calllog ${e.callId} state: ${e.callState} direction:${e.callType}`)):P.warn(M.LogTraceArea.Calling,"Expected message with property: call-log")}})),o.isEmpty(p)&&p.push({origin:l,clientMessageId:r&&r.getLatestRelevantClientMessageId()||void 0,correlationVector:void 0}),o.each(e.applyMessageLies,(e=>{r?r=r.applyMessageForPostingLie(e):(s=(s||Math.max(Date.now(),k.getTimestamp()))+1,r=O.default.fromFirstLie(e,t,F.default.getSkypeMri(),s))})),r){if(o.each(e.revertMessageLies,(e=>{r=r.revertMessageForPostingLie(e)})),o.each(e.setPropDeltas,(e=>{r=r.applyPropertyLie(e.key,e.value)})),o.each(e.revertPropDeltas,(e=>{r=r.revertPropertyLie(e.key,e.value)})),e.confirmSendId&&e.confirmSendCMID&&(r=r.acknowledgeMessageLie(e.confirmSendCMID,e.confirmSendId,e.confirmSendVersion)),e.rejectSendTimestamp&&e.rejectSendCMID&&(r=r.rejectMessageSend(e.rejectSendCMID,e.rejectSendTimestamp,e.rejectSendRetryInfo)),r&&m.isConciergeBotMri(r.creator)){const e=d.default.getEngagementFeatures();let t=!1;if(e.conciergeBotSettings.enableVisibility){const s=L.default.getUserPreferencesLocalNoSubscription(),i=s.enablePushEngagementNotifications&&s.enableInAppEngagementNotifications,n=o.some(e.conciergeBotSettings.allowedRecentMessageTypes,(e=>r&&e===r.messagetype));t=!i&&n}if(o.some(e.conciergeBlockedMessageTypes,(e=>r&&e===r.messagetype))||t)return void P.track(new b.EngagementMessageTelemetryEvent({eventType:b.EngagementMessageTelemetryEventType.ChatServiceBlockedMessage,messageType:r.messagetype,messageCorrelationId:h.getCorrelationIdFromMessageParts(r.creator,r.conversationId,r.cuid)}))}if(e.fileEncryptionKeys&&(r=r.addFileKeyMaterial(e.fileEncryptionKeys)),o.isUndefined(e.isReported)||(r=r.markAsReported(e.isReported)),r!==n&&k.getDeletedTimestamp()<r.createdTime){const e={message:r,isOtherEndpointActive:c,reactionUpdates:r.getReactionUpdates(n),messageAlreadySeen:!!n,details:p};C.push(e),u.isGuestNameUpdateMessageType(r.messagetype)&&A.push(r),k=k,u.isCaptionMessageType(r.messagetype)||(V.push(r),k=k.mergeMessageLocal(r,!1)),a.calcAlertsForUpdatedMessage(k,r,T),o.some(p,(e=>e.origin===M.MessageOrigin.PushNotification))&&P.track(new I.FundamentalsMessagePushDebug(r.getLatestRelevantClientMessageId()||"",h.getCorrelationIdForMessage(r),"MessageUpdatePushed"))}else{const e=M.MessageOrigin[l]+(r===n?", NoChange":"");l===M.MessageOrigin.LocalChange&&r===n||P.track(new I.FundamentalsDebugEvent("MessageNotUpdated",e))}}else P.error(M.LogTraceArea.ChatService,"Somehow we are working on a message that we can't get a local version of...")}))}let j;if(V.length>0&&z.push(n.putMessages(V)),k.lastMessage&&!k.lastMessage.isShownInPreview()){const e=k.lastMessage.isReported();R=!e,z.push(this._getLastDisplayableMessage(Number.MAX_VALUE,n,k,C).then((e=>{k&&(e?(P.log(M.LogTraceArea.ChatService,`Bumped lastMessage for ${i.pii.Mri(k.id)} back to ${e.createdTime}`),k=k.mergeMessageLocal(e,!0)):(P.log(M.LogTraceArea.ChatService,`Removed lastMessage ${k.lastMessage&&k.lastMessage.cuid} for ${i.pii.Mri(k.id)}`),k=k.dropLastMessage()))})))}if(e.conversationUpdate&&k.isDeleted()){const e=n.getMessagesForConversationBeforeTime(k.id,k.getDeletedTimestamp(),void 0,!1).then((e=>n.removeMessages(e)));z.push(e)}return r.all(z).then((()=>{j&&(k=k.mergeMessageLocal(j,!0),P.log(M.LogTraceArea.ChatService,"Updated decrypted SMS content for lastMessage for "+i.pii.Mri(t)+" and cuid "+j.cuid));const a=k.lastMessage,d=a&&a.getLatestServerMessageVersion(),c=Math.max(d&&Number(d)||0,k.getTimestamp())>Date.now()-m.RecentMessageHistoryTimePeriod,h=k.isCurrentUserMember();if(s&&s.syncInfo&&!s.conv.isCurrentUserMember()&&h&&(N=void 0),N){const e=k&&k.isHistoryDisclosed(),s=U&&e?Math.max(N.messageHistoryStartTime,k.getThreadProperty(m.ThreadProps.LastJoinAt)||Number.MAX_VALUE):N.messageHistoryStartTime;if(!N.messagesStale&&E&&(c||R)){const e=c?p.MessagesStaleReason.NeedSync:p.MessagesStaleReason.ReceivedUnreconciledEdit;P.log(M.LogTraceArea.ChatService,"Need new messages sync for conv "+i.pii.Mri(t)+", messagesStaleReason: "+p.MessagesStaleReason[e]),N={messagesStale:!0,messagesStaleReason:e,messagesSyncState:N.messagesSyncState,messageHistoryStartTime:s}}else U&&e&&(P.log(M.LogTraceArea.ChatService,"History was "+(e?"disclosed":"hidden")+" for conv "+i.pii.Mri(t)),N={messagesStale:!0,messagesStaleReason:p.MessagesStaleReason.HistoryDisclosedChanged,messagesSyncState:N.messagesSyncState,messageHistoryStartTime:s})}else if(h){let e;c?e=p.MessagesStaleReason.NeedSync:R?e=p.MessagesStaleReason.ReceivedUnreconciledEdit:this._isConversationPossiblyUnread(k)&&(e=p.MessagesStaleReason.ConversationPossiblyUnread);const s=void 0!==e;P.log(M.LogTraceArea.ChatService,"No syncInfo for conv "+i.pii.Mri(t)+", messagesStale: "+s.toString()+", messagesStaleReason: "+(void 0===e?"undefined":p.MessagesStaleReason[e])),N={messagesStale:s,messagesStaleReason:e,messagesSyncState:void 0,messageHistoryStartTime:Number.MAX_VALUE}}else N={messagesStale:!1,messagesSyncState:void 0,messageHistoryStartTime:Number.MAX_VALUE};const u=s?s.updateConversationAndSyncInfo(k,N):y.default.firstTimeMeta(k,N,void 0);return f.calculateCountsForConversation(u,!!e.messageActions||!!e.recalculateCounts,n).then((e=>{e.earlyExit||P.log(M.LogTraceArea.ChatService,"Calculated counts: "+i.pii.Mri(t)+": "+e.msg);const a=u.updateCounts(e.counts);if(s&&s.syncInfo.messagesStaleReason===p.MessagesStaleReason.ConversationPossiblyUnread&&N&&!N.messagesStale){const e=!(!a.counts||!a.counts.hasUnread);P.log(M.LogTraceArea.ChatService,"Got counts for possibly unread conversation: "+i.pii.Mri(t)+"; Has unread messages: "+(e?"Yes":"No"));const s=new g.ChatServiceForceSyncConversationEvent("ConversationPossiblyUnread",e);P.track(s)}else if(s&&s.syncInfo.messagesStaleReason===p.MessagesStaleReason.ReceivedUnreconciledEdit&&N&&!N.messagesStale){const e=new g.ChatServiceForceSyncConversationEvent("ReceivedUnreconciledEdit",!0);P.track(e)}const d=!!s&&(s.conv.isCurrentUserMember()&&!s.conv.isDeleted()),c=!(a.conv.isCurrentUserMember()&&!a.conv.isDeleted())&&d,h=!!a.counts&&(!s||!s.counts||a.counts&&a.counts.consumptionHorizonTimestamp!==s.counts.consumptionHorizonTimestamp);let m;return m=B||!c&&!h?r.Resolved():n.getAlertsForConversation(a.conv.id).then((e=>{B=!0,T.trackOriginalItems(e.concat(this._alertsTrackedByAlertsStore))})),m.then((()=>{if(c&&o.each(T.getAllItems(),(e=>{e.message&&e.message.conversationId===t&&T.deleteItem(e)})),h){const e=o.filter(T.getAllItems(),(e=>!!e.message&&e.message.conversationId===t&&e.alertType===l.AlertType.HighPriorityMessage&&!!e.isRead!=e.message.createdTime<=a.counts.consumptionHorizonTimestamp));o.each(e,(e=>{const t=e.applyRead(e.message.createdTime<=a.counts.consumptionHorizonTimestamp);T.updateItem(t)}))}a!==s&&v.push(a)}))}))}))}))}));r.all(B).then((()=>{D=Date.now();const i=[];if(v.length>0){i.push(n.putConversationMetas(v));let e={};o.each(v,(t=>{const s=t.conv.getConversationBlocked();void 0!==s&&(e[t.conv.id]=s)})),o.isEmpty(e)||i.push(c.default.internal_updateConversationBlockStatus(e,n))}const a=T.getDeltas();return a.deletes.length>0&&i.push(n.removeAlerts(a.deletes)),(a.adds.length>0||a.updates.length>0)&&i.push(n.putAlerts(a.adds.concat(o.map(a.updates,(e=>e.updated))))),e.newUserPropSet&&i.push(k.default.putData(S.InternalKeys.Prefs,e.newUserPropSet,n)),e.convListSyncInfo&&i.push(k.default.putData(S.InternalKeys.ConversationListSyncInfo,e.convListSyncInfo,n)),o.isEmpty(w)||i.push(n.putCallLogs(w)),r.all(i).then((()=>{o.each(v,(e=>{this._conversationMetaMap[e.conv.id]=e}));let i=[];e.newUserPropSet&&(o.each(this._userProperties,((t,s)=>{this._userProperties[s]!==e.newUserPropSet[s]&&i.push(s)})),o.each(e.newUserPropSet,((e,t)=>{t in this._userProperties||i.push(t)})),this._userProperties=e.newUserPropSet);const r=_-s,l=D-_,d=Date.now()-D,c=l+d;if(P.log(M.LogTraceArea.ChatService,"Finished Processing Bundle: "+c+"ms ("+r+"ms OpenTransLock, "+l+"ms Processing, "+d+"ms Persisting): "+o.compact([v.length?v.length+" ConvMetas":void 0,C.length?C.length+" Messages":void 0,a.adds.length?a.adds.length+" New Alerts":void 0,a.updates.length?a.updates.length+" Changed Alerts":void 0,a.deletes.length?a.deletes.length+" Deleted Alerts":void 0,i.length?i.length+" UserPropKeys":void 0]).join(", ")),v.length>0&&(this.conversationsUpdated.fire(v,n),this._checkJoinedConvUpdates(v)),C.length>0){const e=o.map(C,(e=>e.message));this.messagesProcessedWithBundleInfo.fire(C),this.messagesProcessed.fire(e)}(a.adds.length>0||a.updates.length>0||a.deletes.length>0)&&this.alertsUpdated.fire(a),e.newUserPropSet&&this.userPropertiesChanged.fire(i),o.isEmpty(w)||this.callLogsReceived.fire(w),A.length>0&&this.guestNameUpdate.fire(A),t.resolve(void 0)}))})).catch((e=>{this._handleBundlingError(t,e,"processing")})).finally((()=>{this._finishProcessingBundle()}))}))})).catch((e=>{this._handleBundlingError(t,e,"PreProcessing"),this._finishProcessingBundle()})),t.promise()}_getLastDisplayableMessage(e,t,s,i){return t.getMessagesForConversationBeforeTime(s.id,e,25,!1).then((e=>{if(0===e.length)return r.Resolved(void 0);const n=o.map(o.filter(i,(e=>e.message.conversationId===s.id)),(e=>e.message)),a=o.filter(e,(e=>!o.find(n,(t=>t.cuid===e.cuid)))),l=o.filter([...n,...a],(e=>e.isShownInPreview()));if(l.length>0){const e=o.maxBy(l,(e=>e.createdTime));return r.Resolved(e)}{const o=Math.min.apply(Math,e.map((e=>e.createdTime)));return this._getLastDisplayableMessage(o-1,t,s,i)}}))}_handleBundlingError(e,t,s){const i="Error "+s+" bundle: "+B.default.errorAsString(t);P.error(M.LogTraceArea.ChatService,i),P.track(new g.ChatServiceBundleProcessingErrorEvent(i)),e.reject(t)}_finishProcessingBundle(){this._processingBundle=void 0,this._processBundle()}_isBundleActionable(e,t){return t||!!e.serverMessages||!!e.applyMessageLies}_remapCallEndedEventMessage(e,t){o.each(o.keys(e),(s=>{const i=e[s];if(!i.serverMessages)return;const n=i.serverMessages;o.each(n,(t=>{if(!u.isEventCallEndedMessageType(t.message))return;t.message=Object.assign(Object.assign({},t.message),{skypeeditedid:void 0,clientmessageid:H.default.newClientMessageId()});const r=m.getCuidForMessage(t.message);if(s===r)return;P.log(M.LogTraceArea.ChatService,`_remapCallEndedEventMessage moving end call event message from ${s} to ${r}`);r in e||(e[r]=Object.assign(Object.assign({},i),{serverMessages:[]}));const a=e[r];a.serverMessages||(a.serverMessages=[]),a.serverMessages.push(t),o.pull(n,t)})),o.isEmpty(n)&&(delete e[s].serverMessages,this._isBundleActionable(e[s],!!t[s])||(delete e[s],P.log(M.LogTraceArea.ChatService,`_remapCallEndedEventMessage removing bundle from ${s} since it is not actionable.`)))}))}_isConversationPossiblyUnread(e){if(e&&e.lastMessage){if(m.isConciergeBotMri(e.id))return!1;const t=e.getConsumptionHorizon(),s=m.getCuidFromConsumptionHorizon(t);if("0"!==s){const i=e.lastMessage.getOriginalClientMessageId();return!(m.getServerTimestampFromConsumptionHorizon(t)>=e.lastMessage.createdTime)&&(!!i&&s!==i)}}return!1}getChatServiceHost(){const e=this.getUserProperty(m.ServerUserProps.UserRing),t=o.isUndefined(e)?void 0:p.UserRing[o.toNumber(e)]||e;return t?t===p.UserRing.PROD?U.default.getHost(d.default.getConfigSettingsNoSubscription().chat.productionHost):U.default.getHost(d.default.getConfigSettingsNoSubscription().chat.dogfoodHost):void 0}}},36593:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChatServiceErrorHandler=t.BackoffTimerWrapper=t.ChatServiceErrorTypes=void 0;const i=s(74958),o=s(96486),n=s(62783),r=s(97691),a=s(89391),l=s(9959),d=s(71830),c=s(46096),h=s(36237),u=s(17791),p=s(66765),g=s(12770),m=s(94214);var S;!function(e){e[e.EndpointMissing=0]="EndpointMissing",e[e.LocationChanged=1]="LocationChanged",e[e.InvalidRegToken=2]="InvalidRegToken",e[e.AuthenticationFailure=3]="AuthenticationFailure",e[e.TooManyRequests=4]="TooManyRequests",e[e.LoginRateLimitExceeded=5]="LoginRateLimitExceeded",e[e.LoginRequestError=6]="LoginRequestError",e[e.SkypeTokenRevoked=7]="SkypeTokenRevoked"}(S=t.ChatServiceErrorTypes||(t.ChatServiceErrorTypes={}));const f="Unknown";class y{constructor(e,t){this._exponentialTimer=e,this._debugName=t,this._backoffMinTime=0,this._bumpCount=0}reset(){this._exponentialTimer.reset(),this._backoffMinTime=0,this._bumpCount=0}getPromise(){return Date.now()>=this._backoffMinTime?r.Resolved(void 0):(this._waitingForBackoff||(this._waitingForBackoff=r.Defer()),this._waitingForBackoff.promise())}bumpTimer(e){const t=Date.now()+this._exponentialTimer.getTimeAndCalculateNext();t>this._backoffMinTime&&(this._backoffMinTime=t,h.log(c.LogTraceArea.ChatServiceTransport,e+": "+this._debugName+" : Backing off until "+new Date(this._backoffMinTime)),this._checkBackoff()),this._bumpCount++}getBackoffMinTime(){return this._backoffMinTime}getBumpCount(){return this._bumpCount}_checkBackoff(){this._isSleepingUntilMinTime||(this._isSleepingUntilMinTime=!0,g.default.sleepUntil(this._backoffMinTime).then((()=>{if(this._isSleepingUntilMinTime=!1,Date.now()<this._backoffMinTime)this._checkBackoff();else if(this._waitingForBackoff){h.log(c.LogTraceArea.ChatServiceTransport,this._debugName+" timer reset, firing blocked requests.");const e=this._waitingForBackoff;this._waitingForBackoff=void 0,e.resolve(void 0)}})))}test_getTimer(){return this._exponentialTimer}test_setBackoffMinTime(e){this._backoffMinTime=e}}t.BackoffTimerWrapper=y;class _{constructor(e,t){this._handleLocationChange=e,this._handleInviteFreeQuarantine=t}getSkypetokenFromHeaders(e){const t=e.Authentication;return d.getSkypetokenFromAuthenticationHeader(t)}getRegistrationTokenFromHeaders(e){const t=e.RegistrationToken;return d.getRegistrationTokenFromHeader(t)?t:void 0}augmentErrorResponse(e,t){e.statusText=e.headers.statustext;let s="";if(!t&&e.body){const t=e;t.body.errorCode&&(t.errorCode=t.body.errorCode),t.body.message&&(t.errorMessage=t.body.message),s=", Body: "+t.errorCode+"/"+t.errorMessage}h.log(c.LogTraceArea.ChatService,"Chat Service Response: "+e.statusCode+"/"+e.statusText+i.pii.Omit(s)+", ContextId: "+e.headers.contextid+", Date: "+e.headers.date)}static getChatServiceErrorResponseMetadata(e){let t,s;return e&&(t=e.errorMessage||e.errorInfo,!t&&e.timedOut&&(t="Request timeout"),e.headers&&(e.headers["ms-cv"]?s=e.headers["ms-cv"]:e.headers["MS-CV"]&&(s=e.headers["MS-CV"]))),{contextId:e&&e.headers&&e.headers.contextid?e.headers.contextid:f,date:e&&e.headers&&e.headers.date?e.headers.date:f,errorCode:e&&void 0!==e.errorCode?e.errorCode:-1,errorMessage:t||f,statusCode:e&&void 0!==e.statusCode?e.statusCode:-1,statusText:e&&e.statusText?e.statusText:f,msCv:s,canceled:null==e?void 0:e.canceled,timedOut:null==e?void 0:e.timedOut}}handleChatServiceFailure(e,t,s,i,n,r,g){const y=_.getChatServiceErrorResponseMetadata(t);h.warn(c.LogTraceArea.ChatService,e+": ChatServiceErrorHandler: Failed to perform chat service request "+r.scenario+". "+JSON.stringify(y)+" "+JSON.stringify(r.telemetryAttributes));const v=r.mriForTelemetry?d.getMriTypeForTelemetry(r.mriForTelemetry):void 0,{reportInternalFailures:C,reportUnknownInternalFailures:b,reportSystemExceptionInternalFailures:T,chatServiceRedirectTimerEnabled:M}=a.default.getConfigSettingsNoSubscription().chat,I=r.mriForTelemetry&&d.isGroupConversation(r.mriForTelemetry),w=u.default.isNetworkingAvailable();if(!t.statusCode||d.isRedirect(t)||d.isEndpointMissing(t)){if(y&&C&&w||I){const e=new l.ChatServiceInternalFailureEvent(r.scenario,v,r.telemetryAttributes,y,g,u.default.getNetworkType(),w),t=y.errorMessage===f,s=o.startsWith(y.errorMessage,"System.Exception");(t&&b||s&&T||!t&&!s||I)&&h.track(e)}}else h.track(new l.ChatServiceFailureEvent(r.scenario,v,r.telemetryAttributes,y,g));const P=d.getTcidDataFromServerMessageResponse(t);if(t&&t.errorCode===d.ChatServiceErrors.EndpointMissing&&n&&p.default.markEndpointMissing(n,P),d.isRedirect(t)){const s=d.getRedirectUrl(t);return h.warn(c.LogTraceArea.ChatService,e+": ChatServiceErrorHandler: Chat Service is redirecting us to another cloud: "+s),this._handleLocationChange(s,P),M&&_._redirectTimer.bumpTimer(e),S.LocationChanged}if(_._redirectTimer.reset(),401===t.statusCode||403===t.statusCode){let o=!1;if(t.statusText){const e=t.statusText.toLowerCase();0!==e.indexOf("invalid registration token")&&-1===e.indexOf("registrationtoken and/or cookie must be set")&&-1===e.indexOf("registration token is expired")||(o=!0)}if(t.errorCode===d.ChatServiceErrors.StaleUic&&(o=!0),o)return h.warn(c.LogTraceArea.ChatService,e+": ChatServiceErrorHandler: Chat Service doesn't like our registration token -- "+(i?"Nuking and waiting for it to refresh.":"We didn't send one, ")+" Skypetoken: "+(s?"Sent with request":"Not sent with request")),i&&p.default.markRegistrationTokenExpired(i),S.InvalidRegToken}if(401===t.statusCode&&!t.errorCode){let o=!1;if(t.statusText){-1!==t.statusText.toLowerCase().indexOf("skypetokenrevoked")&&(o=!0)}const n=o||s;if(h.warn(c.LogTraceArea.ChatService,e+"ChatServiceErrorHandler: Got 401 from request -- "+(n?"nuking skypetoken":i?"nuking registration token":"but no token provided")),n){if(m.default.skypeTokenInvalid(s),o)return S.SkypeTokenRevoked}else if(i)return p.default.markRegistrationTokenExpired(i),S.InvalidRegToken;return S.AuthenticationFailure}return 429===t.statusCode?t.errorCode===d.ChatServiceErrors.PerUserLoginLimitExceeded?(_._loginTimer.bumpTimer(e),S.LoginRateLimitExceeded):(_._429Timer.bumpTimer(e),S.TooManyRequests):(403===t.statusCode&&t.errorCode===d.ChatServiceErrors.QuarantineLimitExceeded&&this._handleInviteFreeQuarantine(),r.isLoginRequest?(_._loginTimer.bumpTimer(e),S.LoginRequestError):void 0)}getLoginTimer(){return _._loginTimer}get429Timer(){return _._429Timer}getRedirectTimer(){return _._redirectTimer}}t.ChatServiceErrorHandler=_,_._429Timer=new y(new n.ExponentialTime(500,3e4),"429 timer"),_._loginTimer=new y(new n.ExponentialTime(500,1e5),"Login timer"),_._redirectTimer=new y(new n.ExponentialTime(500,6e4),"Redirect timer")},83169:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(97691),n=s(22801),r=s(71830),a=s(72685),l=s(61253),d=s(54416),c=s(66765),h=s(22538);t.default=new class{constructor(){this._checkState=()=>{if(this._blockUntilValidEndpointDefer&&this._hasPushEndpoint()){const e=this._blockUntilValidEndpointDefer;this._blockUntilValidEndpointDefer=void 0,e.resolve(void 0)}},this._cleanupPushEndpoints=()=>this._blockUntilValidEndpoint().then((()=>this._hasPushEndpoint()?n.default.serviceEnumerateEndpoints().then((e=>{const t=c.default.getEndpointInfo(),s=d.default.getPushTransportPath();return this._hasPushEndpoint(t,s)?o.all(i.map(e.endpoints,(o=>{if(r.areEndpointIdsEqual(o.id,t.id)){const t=r.findPushSubscriptionInfo(o.subscriptions),s=c.default.getEndpointInfo();if(s.pushSubscriptionId!==t.pushSubscriptionId||!(0,l.default)(s.pushSubscriptionParams,t.pushSubscriptionParams)){const s=i.assign({pushSubscriptionId:void 0,pushSubscriptionParams:void 0,reason:"Endpoint cleanup",tcid:e.tcid},t);c.default.updateEndpointInfo(s)}return}if(!o.subscriptions||1!==o.subscriptions.length)return;const a=r.findPushSubscriptionInfo(o.subscriptions).pushSubscriptionParams;if(a&&this._isValidPushSubscription(a)&&a.eventChannel===s){const e=r.formatEndpointId(o.id);return n.default.serviceDeleteEndpoint(e).catch(i.noop)}}))):o.Rejected()})).then(i.noop):o.Rejected())),h.RegisterStartupable(this,"ChatServicePushEndpointCleanupService",[n.default,d.default])}startup(){return c.default.endpointInfoChanged.subscribe(this._checkState),d.default.pushTransportPathChanged.subscribe(this._checkState),a.default.setRefreshOptions("ChatServicePushEndpointCleanupService",{interval:864e5,callback:this._cleanupPushEndpoints,taskTypeFlags:a.TaskTypeFlags.UsesNetworking}),o.Resolved()}_blockUntilValidEndpoint(){if(this._hasPushEndpoint())return o.Resolved();this._blockUntilValidEndpointDefer||(this._blockUntilValidEndpointDefer=o.Defer());const e=this._blockUntilValidEndpointDefer.promise();return this._checkState(),e}_hasPushEndpoint(e=c.default.getEndpointInfo(),t=d.default.getPushTransportPath()){return!!(e.exists&&e.id&&e.pushSubscriptionParams&&this._isValidPushSubscription(e.pushSubscriptionParams))&&!!t}_isValidPushSubscription(e){return e.channelType===r.ChannelTypes.PushNotification&&!!e.eventChannel}}},49868:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(26426),o=s(71830),n=s(54416),r=s(66765);class a extends i.default{constructor(e,t,s){super(e,t),this._interestedResources=s,n.default.pushTransportPathChanged.subscribe((()=>{this._updateDesiredParams()}));const i=r.default.getEndpointInfo();this._subscriptionInfoUpdated(a._getSavedSubInfo(i)),this._updateDesiredParams()}static _getSavedSubInfo(e){if(e.pushSubscriptionId)return{endpointId:e.id,subscriptionId:e.pushSubscriptionId,params:e.pushSubscriptionParams}}endpointInfoUpdated(e,t){this._subscriptionInfoUpdated(a._getSavedSubInfo(e)),super.endpointInfoUpdated(e,t)}_updateDesiredParams(){const e=n.default.getPushTransportPath();e&&this._setDesiredSubParameters(o.createPushSubscriptionParams("Skype4Life",e,this._interestedResources))}_subscriptionAllowed(){return!!n.default.getPushTransportPath()&&super._subscriptionAllowed()}_updateActiveSubscriptionInfo(e,t,s){super._updateActiveSubscriptionInfo(e,t,s),r.default.setPushSubscriptionInfo(e,t,s)}}t.default=a},59631:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(97792),n=s(29860),r=s(97691),a=s(89391),l=s(46096),d=s(36237),c=s(66765),h=s(35478),u=s(94214);t.default=new class{restoreEndpoint(e,t,s){if(d.log(l.LogTraceArea.ChatService,"Received command to restore endpoints! ContextId: "+e),h.default.resume(),this._restoreEndpointDeferred)return d.log(l.LogTraceArea.ChatService,"Restore already in progress. Ignoring "+e),this._restoreEndpointDeferred.promise();const n=c.default.getEndpointInfo();this._restoreEndpointDeferred=r.Defer(),this._scenario=s,this._scenario.endpointMissing(n.id),n.id&&c.default.markEndpointMissing(n.id);const p=!u.default.hasUsableSkypeToken();u.default.skypeTokenInvalid(u.default.getRawSkypeToken()),u.default.performWhenValidSkypeTokenArrives().then((()=>(this._scenario&&this._scenario.gotSkypeToken(p),t.createOrUpdateEndpoint(n.id,n.ecsEtag||"").fail((e=>{this._scenario&&this._scenario.failed("Endpoint request failed",{statusCode:e.statusCode||"",contextId:e&&e.headers&&e.headers.contextid?e.headers.contextid:""})}))))).then((e=>{c.default.updateEndpointInfo(i.assign({},e,{reason:e.reason+" from restoreEndpoint"}))}));const g=o.default.requestMaxTime("RestoreEndpoint");return this._raceBackgroundTimer(this._restoreEndpointDeferred.promise(),a.default.getConfigSettingsNoSubscription().chat.restoreEndpointsTimeout).then((e=>{if(this._scenario){if(e.timedOut&&(this._scenario.timedOut(),this._restoreEndpointDeferred)){const e=this._restoreEndpointDeferred;this._restoreEndpointDeferred=void 0,e.reject(void 0)}this._scenario.finish()}return this._scenario=void 0,h.default.flush()})).always((()=>{g.then((e=>o.default.release(e,"RestoreEndpoint"))).catch(i.noop)}))}endpointInfoUpdated(e,t){if(this._restoreEndpointDeferred&&(!t.exists&&e.exists&&this._scenario&&this._scenario.endpointRestored(e.id),!t.pushSubscriptionId&&e.pushSubscriptionId)){this._scenario&&this._scenario.pushSubscriptionRestored(e.pushSubscriptionId);const t=this._restoreEndpointDeferred;this._restoreEndpointDeferred=void 0,t.resolve(void 0)}}_raceBackgroundTimer(e,t){let s=r.Defer();const i=n.default.setTimeout((()=>{s.resolve({timedOut:!0})}),t),o=e.then((e=>(n.default.clearTimeout(i),{timedOut:!1,result:e})));return r.race([o,s.promise()])}}},26426:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(74958),o=s(96486),n=s(31844),r=s(62783),a=s(36593),l=s(90239),d=s(71830),c=s(46096),h=s(36237),u=s(61253),p=s(16724),g=s(17791),m=s(66765),S=s(12770);t.default=class{constructor(e,t,s,i){this._restClient=e,this._subName=t,this._stateChangedCallback=s,this._longPollEventsCallback=i,this._checkStateRunning=!1,this._checkStateQueued=!1,this._exponentialTime=new r.ExponentialTime(1e3,3e5),this._dontCreateSubUntil=0,this._dontUpdateSubUntil=0,this._updateExponentialTime=new r.ExponentialTime(1e3,3e5),this._dontDeleteSubUntil=0,this._lastLongPollAttemptResult=l.LongPollResult.Success,this._dontLongPollUntil=0,this._longPollExponentialTime=new r.ExponentialTime(1e3,3e5),this._subscriptionState=l.SubscriptionState.None,this._checkState=()=>{this._checkStateKickTimer&&(S.default.clearTimeout(this._checkStateKickTimer),this._checkStateKickTimer=void 0),this._longPollEventsCallback&&(this._checkStateKickTimer=S.default.setTimeout((()=>{this._checkStateKickTimer=void 0,this._subscriptionAllowed()&&h.warn(c.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" Kick Timer Activated..."),this._checkState()}),12e4)),this._checkStateRunning?this._checkStateQueued=!0:(this._checkStateRunning=!0,this._checkStateInner(),this._checkStateRunning=!1,this._checkStateQueued&&(this._checkStateQueued=!1,this._checkState()))},n.default.onResume.subscribe((e=>{h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" Resuming from sleep, kicking subscriptions causeId: "+e),this.cancelPendingLongPollRequest("DeviceUtilities.onResume"),this._resetBackoffs(),this._checkState()})),g.default.subscribe((()=>{g.default.isNetworkingAvailable()&&(this.cancelPendingLongPollRequest("Networking is available again"),this._resetBackoffs(),this._checkState())}));const o=m.default.getEndpointInfo();h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" started up with endpoint Info: "+d.encodeEndpointInfoForLog(o))}_subscriptionInfoUpdated(e){this._activeSub=e}endpointInfoUpdated(e,t){h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" using new endpoint Info: "+d.encodeEndpointInfoForLog(e)),this._checkState()}_setDesiredSubParameters(e){h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" got desired sub parameters: "+i.pii.Omit(JSON.stringify(e))),this._desiredSubParameters=e,this._checkState()}_subscriptionAllowed(){return m.default.endpointExists()?this._activeSub&&this._activeSub.endpointId!==m.default.getEndpointId()?(h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" not allowed: Endpoint Id Mismatch"),!1):0!==this._desiredSubParameters.interestedResources.length||(h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" not allowed: No interestedResources"),!1):(h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" not allowed: Endpoint Doesn't exist"),!1)}_resetBackoffs(){this._dontCreateSubUntil=0,this._dontUpdateSubUntil=0,this._dontDeleteSubUntil=0,this._dontLongPollUntil=0,this._exponentialTime.reset(),this._updateExponentialTime.reset(),this._longPollExponentialTime.reset()}_updateActiveSubscriptionInfo(e,t,s){this._activeSub=e}_setState(e){this._subscriptionState!==e&&(h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" state changed from: "+l.SubscriptionState[this._subscriptionState]+", to: "+l.SubscriptionState[e]),this._subscriptionState=e,this._stateChangedCallback&&this._stateChangedCallback(this._subscriptionState,this._lastLongPollAttemptResult))}_checkStateInner(){if(this._checkStateRerunTimer&&(S.default.clearExpiration(this._checkStateRerunTimer),this._checkStateRerunTimer=void 0),!this._desiredSubParameters)return void h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" skipping checkState: No Current Desired Subscription Parameters");if(!this._subscriptionAllowed()){if(this.cancelPendingLongPollRequest("subscription not allowed"),this._subscriptionCreationInFlight){h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" killing pending subscription creation in flight");const e=this._subscriptionCreationInFlight;this._subscriptionCreationInFlight=void 0,e.cancel()}if(this._subscriptionUpdateInterestedResourcesInFlight){h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" killing pending subscription update in flight");const e=this._subscriptionUpdateInterestedResourcesInFlight;this._subscriptionUpdateInterestedResourcesInFlight=void 0,e.cancel()}return this._activeSub?(this._setState(l.SubscriptionState.Deleting),this._subscriptionDeleteInFlight?void h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" waiting for pending subscription delete in flight"):this._dontDeleteSubUntil>Date.now()?void(this._checkStateRerunTimer=S.default.setExpiration(this._checkState,this._dontDeleteSubUntil)):void this._checkState_deleteSubscription()):void this._setState(l.SubscriptionState.None)}if(!this._activeSub||!(0,u.default)(o.omit(this._desiredSubParameters,"interestedResources"),o.omit(this._activeSub.params,"interestedResources"))){if(this._setState(l.SubscriptionState.Creating),this._subscriptionDeleteInFlight){h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" killing pending subscription delete in flight for creation");const e=this._subscriptionDeleteInFlight;this._subscriptionDeleteInFlight=void 0,e.cancel()}if(this._subscriptionUpdateInterestedResourcesInFlight){h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" killing pending subscription update in flight for creation");const e=this._subscriptionUpdateInterestedResourcesInFlight;this._subscriptionUpdateInterestedResourcesInFlight=void 0,e.cancel()}return this._subscriptionCreationInFlight?void h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" waiting for pending subscription creation in flight"):this._dontCreateSubUntil>Date.now()?void(this._checkStateRerunTimer=S.default.setExpiration(this._checkState,this._dontCreateSubUntil)):void this._checkState_createSubscription()}if(!(0,u.default)(this._desiredSubParameters.interestedResources,this._activeSub.params?this._activeSub.params.interestedResources:[])&&(this._subscriptionCreationInFlight?h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" waiting for pending subscription creation in flight"):this._subscriptionUpdateInterestedResourcesInFlight?h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" waiting for pending subscription update in flight"):this._dontUpdateSubUntil>Date.now()?this._checkStateRerunTimer=S.default.setExpiration(this._checkState,this._dontUpdateSubUntil):this._checkState_updateSubscriptionInterestedResources()),this._setState(this._lastLongPollAttemptResult===l.LongPollResult.Success?l.SubscriptionState.CreatedActive:l.SubscriptionState.CreatedLongPollTrouble),this._longPollEventsCallback){if(this._longPollInFlight)return void h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" waiting for pending long poll in flight");if(this._dontLongPollUntil>Date.now())return void(this._checkStateRerunTimer=S.default.setExpiration(this._checkState,this._dontLongPollUntil));this._checkState_startLongPoll()}}_checkState_deleteSubscription(){if(!m.default.endpointExists())return h.log(c.LogTraceArea.ChatServiceSubscriptions,"Endpoint missing, deleting subscription locally"),void this._updateActiveSubscriptionInfo(void 0,"Endpoint missing");h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" deleting subscription: "+this._activeSub.endpointId+"/"+this._activeSub.subscriptionId),this._subscriptionDeleteInFlight=this._restClient.serviceDeleteSubscription(this._activeSub.endpointId,this._activeSub.subscriptionId).then(o.noop),this._subscriptionDeleteInFlight.finally((()=>{this._subscriptionDeleteInFlight=void 0})).then((()=>{this.cancelPendingLongPollRequest("Delete subscription"),this._resetBackoffs(),h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" deleted subscription!"),this._updateActiveSubscriptionInfo(void 0,"Deleted subscription"),this._checkState()}),(e=>{e&&!e.canceled&&(404===e.statusCode?(h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" failed to delete -- already missing!"),this._updateActiveSubscriptionInfo(void 0,"Failed to delete",d.getTcidDataFromServerMessageResponse(e))):403===e.statusCode?(h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" access forbidden -- giving up!"),this._updateActiveSubscriptionInfo(void 0,"Access forbidden",d.getTcidDataFromServerMessageResponse(e))):(this._dontDeleteSubUntil=Date.now()+this._exponentialTime.getTimeAndCalculateNext(),0===e.statusCode?h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" Delete failed due to connectivity issues. Retrying at "+new Date(this._dontDeleteSubUntil)):h.warn(c.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" Delete failure: "+e.statusCode+"/"+e.statusText+", "+e.errorCode+"/"+e.errorMessage+". Retrying at "+new Date(this._dontDeleteSubUntil))),this._checkState())}))}_checkState_createSubscription(){const e=m.default.getEndpointId(),t=this._desiredSubParameters;h.log(c.LogTraceArea.ChatServiceSubscriptions,"Creating subscription "+this._subName+". EndpointId: "+e+", Type: "+t.channelType+", Resources: "+i.pii.Omit(t.interestedResources.join(","))),this._subscriptionCreationInFlight=this._restClient.serviceCreateSubscription(e,t),this._subscriptionCreationInFlight.finally((()=>{this._subscriptionCreationInFlight=void 0})).then((s=>{this._resetBackoffs();const i=s.subscriptionId;h.log(c.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" Created: "+e+"/"+i),this._updateActiveSubscriptionInfo({endpointId:e,subscriptionId:i,params:t},"Subscription created",s.tcid),this._lastLongPollAttemptResult=l.LongPollResult.Success,this._checkState()}),(t=>{if(t&&!t.canceled)404===t.statusCode?(h.log(c.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" failed to create -- Endpoint is missing!",a.ChatServiceErrorHandler.getChatServiceErrorResponseMetadata(t)),m.default.markEndpointMissing(e,d.getTcidDataFromServerMessageResponse(t))):201===t.errorCode?h.error(c.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+": Bad request body on subscription creation. Err: ",a.ChatServiceErrorHandler.getChatServiceErrorResponseMetadata(t)):(this._dontCreateSubUntil=Date.now()+this._exponentialTime.getTimeAndCalculateNext(),0===t.statusCode?h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" creation failed due to connectivity issues. Retrying at "+new Date(this._dontCreateSubUntil)):h.warn(c.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" Creation failure: "+t.statusCode+"/"+t.statusText+", "+t.errorCode+"/"+t.errorMessage+". Retrying at "+new Date(this._dontCreateSubUntil))),this._checkState();else{const e=t&&t.canceled?"canceled":"no error";h.log(c.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" failed to create -- "+e)}}))}_checkState_updateSubscriptionInterestedResources(){const e=m.default.getEndpointId(),t=this._desiredSubParameters;h.log(c.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" Updating. EndpointId: "+e+", Params: "+i.pii.Omit(JSON.stringify(t))),this._subscriptionUpdateInterestedResourcesInFlight=this._restClient.serviceUpdateSubscriptionProperty(e,this._activeSub.subscriptionId,"interestedResources",t.interestedResources),this._subscriptionUpdateInterestedResourcesInFlight.finally((()=>{this._subscriptionUpdateInterestedResourcesInFlight=void 0})).then((s=>{this._updateExponentialTime.reset(),this._activeSub?(h.log(c.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" Updated: "+e+"/"+this._activeSub.subscriptionId),this._updateActiveSubscriptionInfo({endpointId:e,subscriptionId:this._activeSub.subscriptionId,params:t},"Subscription property updated",s)):h.warn(c.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" Updated with dead activeSub"),this._checkState()}),(t=>{t.canceled||(404===t.statusCode?(h.log(c.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" failed to update -- Endpoint is missing!",a.ChatServiceErrorHandler.getChatServiceErrorResponseMetadata(t)),m.default.markEndpointMissing(e,d.getTcidDataFromServerMessageResponse(t))):(this._dontUpdateSubUntil=Date.now()+this._updateExponentialTime.getTimeAndCalculateNext(),0===t.statusCode?h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" update failed due to connectivity issues. Retrying at "+new Date(this._dontUpdateSubUntil)):h.warn(c.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" Update failure: "+t.statusCode+"/"+t.statusText+", "+t.errorCode+"/"+t.errorMessage+". Retrying at "+new Date(this._dontUpdateSubUntil))),this._checkState())}))}cancelPendingLongPollRequest(e){if(this._longPollInFlight){h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" killing pending long poll in flight: "+e);const t=this._longPollInFlight;this._longPollInFlight=void 0,t.cancel()}}_checkState_startLongPoll(){this._lastLongPollAttemptResult!==l.LongPollResult.Success&&h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" attempting long poll while in recovery mode...");const e=this._activeSub.endpointId,t=Date.now();let s;this._longPollInFlight=this._restClient.servicePollSubscription(e,this._activeSub.subscriptionId,this._lastLongPollAckId),this._longPollInFlight.finally((()=>{s=Date.now()-t,this._longPollInFlight=void 0})).then((e=>{const t=new p.KpiLongPoll(e&&e.eventMessages||[],s);h.track(t),this._longPollExponentialTime.reset(),this._lastLongPollAttemptResult!==l.LongPollResult.Success&&(h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" long poll recovered"),this._lastLongPollAttemptResult=l.LongPollResult.Success),e&&e.eventMessages&&e.eventMessages.length>0&&(this._longPollEventsCallback(e.eventMessages),this._lastLongPollAckId=o.maxBy(e.eventMessages,(e=>e.id)).id),this._checkState()})).catch((t=>{if(t.canceled&&!t.timedOut)return;h.log(c.LogTraceArea.ChatServiceSubscriptions,"_checkState_startLongPoll error:",a.ChatServiceErrorHandler.getChatServiceErrorResponseMetadata(t));const i=new p.KpiLongPollFailure(t.statusCode,s);h.track(i),450===t.errorCode?(h.log(c.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" backing subscription has gone away. Recreating."),this._updateActiveSubscriptionInfo(void 0,"Longpoll 450",d.getTcidDataFromServerMessageResponse(t))):201===t.errorCode||729===t.errorCode?(h.log(c.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" failure that indicates that the endpoint is gone. Recreating the endpoint...",a.ChatServiceErrorHandler.getChatServiceErrorResponseMetadata(t)),this._updateActiveSubscriptionInfo(void 0,"Longpoll 201 or 729",d.getTcidDataFromServerMessageResponse(t)),m.default.markEndpointMissing(e,d.getTcidDataFromServerMessageResponse(t))):(this._lastLongPollAttemptResult=0===t.statusCode?l.LongPollResult.FailureExternal:l.LongPollResult.FailureErrorCode,this._dontLongPollUntil=Date.now()+this._longPollExponentialTime.getTimeAndCalculateNext(),0===t.statusCode?h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" poll failed due to connectivity issues. Retrying at "+new Date(this._dontLongPollUntil)):h.warn(c.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" Poll failure: "+t.statusCode+"/"+t.statusText+", "+t.errorCode+"/"+t.errorMessage+". Retrying at "+new Date(this._dontLongPollUntil))),this._checkState()}))}}},81697:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(74958),o=s(96486),n=s(16778),r=s(62783),a=s(74634),l=s(97691),d=s(60),c=s(89391),h=s(63413),u=s(22801),p=s(76621),g=s(90239),m=s(71830),S=s(11705),f=s(62141),y=s(87399),_=s(46096),v=s(97811),C=s(36237),b=s(98754),T=s(16724),M=s(18078),I=s(15963),w=s(83181),P=s(22538),k=s(88398),A=s(12770),E=s(73096),R=s(53374),L=18e5;t.default=new class{constructor(){this._syncDataAccumulator=new S.default,this.syncStarted=new a.default,this.syncComplete=new a.default,this._firstConversationListSync=!0,this._conversationListWaitForSyncUtc=0,this._conversationListExponentialTime=new r.ExponentialTime(1e3,3e5),this._conversationListStale=!1,this._conversationListSyncing=!1,this._conversationListSyncedAtLeastOnce=!1,this._conversationSyncInfoTransient={},this.conversationListSyncStarted=new a.default,this.conversationListSyncComplete=new a.default,this._messagesStale={},this._messagesSyncing={},this._waitingForMessageSync={},this._desiredMessageHistoryStartTime={},this._threadDetailsStale={},this._threadDetailsSyncing={},this._syncFailed={},this.startedSyncingConversation=new a.default,this.finishedSyncingConversation=new a.default,this._prioritizedConversationIds={},this._checkSyncProgressInside=!1,this._checkSyncProgressPending=!1,this._syncExponentialBackoff=new r.ExponentialTime(100,3e5),this._checkProgressAfter=0,this._receivedConversationUpdates=e=>{let t=!1;o.each(o.toArray(e),(e=>{if(e)if(0===e.conv.convViewVersion&&e.conv.threadDetailsVersion>0)this.forceConversationListSync();else{if(!e.conv.isCurrentUserMember()||M.default.isMyMri(e.conv.id))return delete this._messagesStale[e.conv.id],void delete this._threadDetailsStale[e.conv.id];if(e.syncInfo&&e.syncInfo.messagesSyncState||!e.needsSyncMessages()||(0,y.isConversationObjectBlocked)(e.conv)){const s=this._conversationSyncInfoTransient[e.conv.id];s&&(s.messages&&(s.messages.chatServiceErrorCount=0,t=!0,this._checkSyncStartingForConversation(e.conv.id),this._messagesStale[e.conv.id]=!0),s.thread&&(s.thread.chatServiceErrorCount=0,t=!0,this._checkSyncStartingForConversation(e.conv.id),this._threadDetailsStale[e.conv.id]=!0))}else this._checkSyncStartingForConversation(e.conv.id),this._messagesStale[e.conv.id]=!0,t=!0}})),t&&(C.log(_.LogTraceArea.ChatService,"Kicking sync: _receivedConversationUpdates"),this._checkSyncProgress())},this._onConnected=()=>{this._conversationListWaitForSyncUtc=0,this._conversationListExponentialTime.reset(),this._resetBackoffTimer(),this._nextForcedConversationListSyncTimer&&(A.default.clearTimeout(this._nextForcedConversationListSyncTimer),this._nextForcedConversationListSyncTimer=void 0),o.each(p.default.getRawConversationMetaMemoryCache(),(e=>{e&&this._markMessagesAndDetailsStaleAsNeeded(e)})),C.log(_.LogTraceArea.ChatService,"Kicking sync: _onConnected"),this.forceConversationListSync()},this._markFullSyncOnce=o.once((e=>this._syncDataAccumulator.markFullSync(e))),this._markFirstSyncOnce=o.once((()=>this._syncDataAccumulator.markFirstSync())),P.RegisterStartupable(this,"ChatServiceSyncService",[h.default,p.default,b.default])}startup(){return this._conversationListSyncInfo=b.default.getData(f.InternalKeys.ConversationListSyncInfo),C.log(_.LogTraceArea.ChatService,"Sync state loaded: "+JSON.stringify(this._conversationListSyncInfo)),this._connectedSubToken=u.default.reconnected.subscribe(this._onConnected),this._convSubToken=p.default.conversationsUpdated.subscribe(this._receivedConversationUpdates),w.default.performAfterUIStarted((()=>{p.default.loadAndCacheNeedsSyncConversations(),C.log(_.LogTraceArea.ChatService,"Kicking sync: UI started");const e=c.default.getS4LMessagingFeatures().syncSettings;e&&e.forceOnUiStarted?this.forceConversationListSync():this._checkSyncProgress()})),this._appStateSubToken=d.default.subscribeForChanges("ChatServiceSyncService",(e=>{if(e===n.Types.AppActivationState.Active){this._conversationListExponentialTime.reset(),this._resetBackoffTimer(),C.log(_.LogTraceArea.ChatService,"Kicking sync: app foregrounded");const e=c.default.getS4LMessagingFeatures().syncSettings;e&&e.forceOnForeground?this.forceConversationListSync():this._checkSyncProgress()}else 0})),l.Resolved()}prioritizeMeetNowThreadDetails(e){this._meetNowThreadId=e,this._checkSyncProgress()}prioritizeConversation(e,t=!0,s=!1){let o=s,n=t;if(this._threadDetailsStale[e]||(o=!1),this._messagesStale[e]||(n=!1),o||n){this._prunePriorizedConvList();const t=Date.now();let s=this._prioritizedConversationIds[e];s?(s.priorityTime=t,n&&(s.needMessages=!0),o&&(s.needThreadDetails=!0)):this._prioritizedConversationIds[e]={priorityTime:t,needMessages:n,needThreadDetails:o},C.log(_.LogTraceArea.ChatService,`Kicking sync: prioritizeConversation for ${i.pii.Mri(e)}`),this._checkSyncProgress()}}haveAllMessagesForConversation(e){const t=p.default.getConversationMetaFromMemoryCache(e);return!!t&&t.syncInfo.messageHistoryStartTime===m.BeginningOfTime}getEarliestKnownMessageTime(e){const t=p.default.getConversationMetaFromMemoryCache(e);return t?t.syncInfo.messageHistoryStartTime:Number.MAX_VALUE}getSyncState(e){const t=p.default.getConversationMetaFromMemoryCache(e);return t&&t.syncInfo.messagesSyncState}syncBackwards(e){return C.log(_.LogTraceArea.ChatService,"SyncBackwards: "+i.pii.Mri(e)),p.default.getConversationMetaAsync(e).then((t=>{if(!t)return!1;if(t.conv.isBricked||t.syncInfo.messageHistoryStartTime===m.BeginningOfTime)return!1;if((0,y.isConversationObjectBlocked)(t.conv))return!1;return this._checkSyncStartingForConversation(e),this._messagesStale[e]=!0,this._getOrCreateSyncInfoTransient(e).nextSyncSinglePage=!0,C.log(_.LogTraceArea.ChatService,"Kicking sync: syncBackwards"),this._checkSyncProgress(),!0}))}forceConversationListSync(){this._checkSyncStartingForConversationList(),this._conversationListStale=!0,C.log(_.LogTraceArea.ChatService,"Kicking sync: forceConversationListSync"),this._checkSyncProgress()}forceResyncConversation(e){const t=p.default.getConversationMetaFromMemoryCache(e);t&&p.default.processQueuedBundle().then((()=>{this._forceResyncMeta(t,!0),p.default.processQueuedBundle(),C.log(_.LogTraceArea.ChatService,"Kicking sync: forceResyncConversation: "+i.pii.Mri(e)),this._checkSyncProgress()}))}forceResyncAllConversations(){p.default.processQueuedBundle().then((()=>{o.each(p.default.getRawConversationMetaMemoryCache(),(e=>this._forceResyncMeta(e))),p.default.processQueuedBundle(),C.log(_.LogTraceArea.ChatService,"Kicking sync: forceResyncAllConversations"),this._checkSyncProgress()}))}forceThreadDetailsFetchIfNeeded(e){const t=p.default.getConversationMetaFromMemoryCache(e);t&&t.conv.isThread()&&t.conv.areThreadDetailsStale()&&!t.conv.isBricked&&t.conv.isCurrentUserMember()&&(this._checkSyncStartingForConversation(t.conv.id),this._threadDetailsStale[t.conv.id]=!0,C.log(_.LogTraceArea.ChatService,"Kicking sync: forceThreadDetailsFetchIfNeeded"),this._checkSyncProgress())}waitForMessageSyncToFinish(e){this._waitingForMessageSync[e]||(this._waitingForMessageSync[e]=l.Defer());const t=this._waitingForMessageSync[e].promise(),s=this.waitForConversationListSyncToFinish().then((()=>this.isSyncingMessagesForConversation(e)&&this._waitingForMessageSync[e]?this._waitingForMessageSync[e].promise():this._syncFailed[e]?l.Rejected():l.Resolved()));return l.race([t,s]).then(o.noop)}waitForConversationListSyncToFinish(){return u.default.isConnected()&&!this._conversationListStale?l.Resolved():(this._waitingConversationListSync||(this._waitingConversationListSync=l.Defer()),this._waitingConversationListSync.promise())}isCurrentlySyncing(){return!!this._syncStartTime}isConversationListDirty(){return this._conversationListStale}hasConversationListSyncFinishedAtLeastOnce(){return this._conversationListSyncedAtLeastOnce}isSyncingMessages(){return!o.isEmpty(this._messagesStale)}isSyncingMessagesForConversation(e){return!!this._messagesStale[e]}isSyncingThreadDetailsForConversation(e){return!!this._threadDetailsStale[e]}_prunePriorizedConvList(){const e=Date.now()-6e4;o.each(this._prioritizedConversationIds,((t,s)=>{t.priorityTime<e&&delete this._prioritizedConversationIds[s]}))}_getOrCreateSyncInfoTransient(e){let t=this._conversationSyncInfoTransient[e];return t||(t={},this._conversationSyncInfoTransient[e]=t),t}_checkSyncInfoTransientForClearing(e){o.isEmpty(this._conversationSyncInfoTransient[e])&&delete this._conversationSyncInfoTransient[e]}_forceResyncMeta(e,t=!1){if(!e||!e.conv.isCurrentUserMember())return;const s=e.syncInfo.messagesStale||t||e.conv.getTimestamp()>Date.now()-m.RecentMessageHistoryTimePeriod,i={messagesStale:s,messagesStaleReason:s?g.MessagesStaleReason.NeedSync:void 0,messagesSyncState:"",messageHistoryStartTime:Number.MAX_VALUE};i.messagesStale&&!(0,y.isConversationObjectBlocked)(e.conv)&&(this._checkSyncStartingForConversation(e.conv.id),this._messagesStale[e.conv.id]=!0),e.conv.isThread()&&(this._checkSyncStartingForConversation(e.conv.id),this._threadDetailsStale[e.conv.id]=!0),p.default.queueConvSyncInfoChange(e.conv.id,i,!0)}_markMessagesAndDetailsStaleAsNeeded(e){M.default.isMyMri(e.conv.id)||(e.needsSyncMessages()&&!(0,y.isConversationObjectBlocked)(e.conv)&&(this._checkSyncStartingForConversation(e.conv.id),this._messagesStale[e.conv.id]=!0),e.needsSyncThreadDetails()&&(this._checkSyncStartingForConversation(e.conv.id),this._threadDetailsStale[e.conv.id]=!0))}_checkSyncStartingForConversationList(){this._conversationListStale||this._conversationListSyncing||(C.log(_.LogTraceArea.ChatService,"Conversation List Sync: Started"),this.conversationListSyncStarted.fire(),this._checkSyncStarting())}_checkSyncFinishedForConversationList(){if(!this._conversationListStale&&!this._conversationListSyncing){if(C.log(_.LogTraceArea.ChatService,"Conversation List Sync: Completed"),this.conversationListSyncComplete.fire(),this._conversationListSyncedAtLeastOnce=!0,this._waitingConversationListSync){const e=this._waitingConversationListSync;this._waitingConversationListSync=void 0,e.resolve(void 0)}this._checkSyncFinished()}}_checkSyncStartingForConversation(e){this._threadDetailsStale[e]||this._threadDetailsSyncing[e]||this._messagesStale[e]||this._messagesSyncing[e]||(C.log(_.LogTraceArea.ChatService,"Started syncing conversation: "+i.pii.Mri(e)),this.startedSyncingConversation.fire(e),this._checkSyncStarting())}_checkSyncFinishedForConversation(e){if(!this._messagesStale[e]&&!this._messagesSyncing[e]){if(this._waitingForMessageSync[e]){const t=this._waitingForMessageSync[e];delete this._waitingForMessageSync[e],this._syncFailed[e]?t.reject():t.resolve(void 0)}this._threadDetailsStale[e]||this._threadDetailsSyncing[e]||(C.log(_.LogTraceArea.ChatService,"Finished syncing conversation: "+i.pii.Mri(e)),this.finishedSyncingConversation.fire(e),this._checkSyncFinished())}}_checkSyncStarting(){this._syncStartTime||(C.log(_.LogTraceArea.ChatService,"Sync Starting"),this._syncStartTime=Date.now(),this._startTelemetry(),this.syncStarted.fire())}_checkSyncFinished(){this._syncStartTime&&!this._conversationListStale&&!this._conversationListSyncing&&o.isEmpty(this._messagesStale)&&o.isEmpty(this._messagesSyncing)&&o.isEmpty(this._threadDetailsStale)&&o.isEmpty(this._threadDetailsSyncing)&&(C.log(_.LogTraceArea.ChatService,`Sync Finished: ${(Date.now()-this._syncStartTime)/1e3}s`),this._syncStartTime=void 0,this._stopTelemetry(),this.syncComplete.fire())}_checkSyncProgress(){if(w.default.isUIDisplayed()){if(this._checkSyncProgressInside)return this._checkSyncProgressPending=!0,void C.log(_.LogTraceArea.ChatService,"Sync not kicked: Pending");this._checkSyncProgressInside=!0,this._checkSyncProgressInner(),this._checkSyncProgressInside=!1,this._checkSyncProgressPending&&(this._checkSyncProgressPending=!1,C.log(_.LogTraceArea.ChatService,"Kicking sync: Pending"),this._checkSyncProgress())}else C.log(_.LogTraceArea.ChatService,"Sync not kicked: UI not displayed")}_checkSyncProgressInner(){if(this._checkSyncProgressCallbackTimer&&(A.default.clearExpiration(this._checkSyncProgressCallbackTimer),this._checkSyncProgressCallbackTimer=void 0),!c.default.getConfigSettingsNoSubscription().chat.syncWhenNoSubscription&&!u.default.isConnected())return void C.log(_.LogTraceArea.ChatService,"Sync not kicked: no active transport");const e=Date.now();if(c.default.getConfigSettingsNoSubscription().chat.syncBackoffOnNoNetwork&&this._checkProgressAfter>e)return C.log(_.LogTraceArea.ChatService,"Sync not kicked: no network"),void(this._checkSyncProgressCallbackTimer=A.default.setExpiration((()=>this._checkSyncProgress()),this._checkProgressAfter));const t=c.default.getConfigSettingsNoSubscription().chat.syncFreeFetchesConfig,s=E.default.isUserComposing();let i=s?t.bandwidthAwareFetchesREST:t.maxFetchesREST;this._conversationListSyncing&&i--;const n=o.keys(this._messagesSyncing).length;i-=n;const r=o.keys(this._threadDetailsSyncing).length;if(i-=r,i<=0)return void C.log(_.LogTraceArea.ChatService,"Sync not kicked: no free fetches; Conv List Syncing: "+(this._conversationListSyncing?"Yes":"No")+"; Active message syncs: "+n+"; Active thread details syncs: "+r+"; MeetNow thread is syncing: "+!(!this._meetNowThreadId||!this._threadDetailsSyncing[this._meetNowThreadId])+"; User is composing: "+s);if(this._meetNowThreadId&&!this._threadDetailsSyncing[this._meetNowThreadId]){const e=this._meetNowThreadId;this._checkSyncStartingForConversation(e),this._threadDetailsSyncing[e]=!0,delete this._syncFailed[e],i--,this._fetchThreadDetails(e).finally((()=>{delete this._threadDetailsSyncing[e],this._meetNowThreadId=void 0,this._checkSyncFinishedForConversation(e),this._checkSyncProgress()}))}let a=Number.MAX_VALUE;if(this._conversationListStale&&!this._conversationListSyncing&&(this._nextForcedConversationListSyncTimer&&(A.default.clearTimeout(this._nextForcedConversationListSyncTimer),this._nextForcedConversationListSyncTimer=void 0),this._conversationListWaitForSyncUtc>e?(C.log(_.LogTraceArea.ChatService,"Conversation List Sync not kicked: need to wait "+(e-this._conversationListWaitForSyncUtc)+"ms"),a=Math.min(a,this._conversationListWaitForSyncUtc)):(this._checkSyncStartingForConversationList(),this._conversationListSyncing=!0,this._conversationListSyncStarted=Date.now(),i--,this._syncConversationList().finally((()=>{this._conversationListSyncing=!1;const e=this._conversationListSyncStarted?Date.now()-this._conversationListSyncStarted:0;this._conversationListSyncStarted=void 0,this._checkSyncFinishedForConversationList(),this._checkSyncProgress(),this._conversationListStale||(C.log(_.LogTraceArea.ChatService,"Conversation list sync done in "+e+" ms - all up to date: next run scheduled in "+"1800000ms"),e>=L?(C.log(_.LogTraceArea.ChatService,"Restarting conversation list sync as last one took too long"),this.forceConversationListSync()):this._nextForcedConversationListSyncTimer=A.default.setTimeout((()=>this.forceConversationListSync()),L))})))),i<=0)return void C.log(_.LogTraceArea.ChatService,"Message/thread sync not kicked: no free fetches");const l=t=>{if(this._messagesSyncing[t])return;const s=this._conversationSyncInfoTransient[t];s&&s.messages&&s.messages.fetchAfterUtc>e?a=Math.min(a,s.messages.fetchAfterUtc):(this._checkSyncStartingForConversation(t),this._messagesSyncing[t]=!0,delete this._syncFailed[t],i--,this._startMessagesSync(t).finally((()=>{delete this._messagesSyncing[t],this._checkSyncFinishedForConversation(t),this._checkSyncProgress()})))},d=t=>{if(this._threadDetailsSyncing[t])return;const s=this._conversationSyncInfoTransient[t];s&&s.thread&&s.thread.fetchAfterUtc>e?a=Math.min(a,s.thread.fetchAfterUtc):(this._checkSyncStartingForConversation(t),this._threadDetailsSyncing[t]=!0,delete this._syncFailed[t],i--,this._fetchThreadDetails(t).finally((()=>{delete this._threadDetailsSyncing[t],this._checkSyncFinishedForConversation(t),this._checkSyncProgress()})))};if(!o.isEmpty(this._prioritizedConversationIds)){this._prunePriorizedConvList();const e=o.sortBy(o.keys(this._prioritizedConversationIds),(e=>-this._prioritizedConversationIds[e].priorityTime));o.each(e,(e=>(this._prioritizedConversationIds[e].needThreadDetails&&(this._threadDetailsStale[e]?d(e):this._prioritizedConversationIds[e].needThreadDetails=!1),this._prioritizedConversationIds[e].needMessages&&(this._messagesStale[e]?i>0&&l(e):this._prioritizedConversationIds[e].needMessages=!1),this._prioritizedConversationIds[e].needMessages||this._prioritizedConversationIds[e].needThreadDetails||delete this._prioritizedConversationIds[e],i>0)))}const h=c.default.getS4LMessagingFeatures().enableSyncFavoritesFirst;if(i>0){const e=o.sortBy(o.keys(this._messagesStale),(e=>-this._getConversationSyncSortRank(e,h)));o.each(e,(e=>(l(e),i>0)))}if(i>0){const e=o.sortBy(o.keys(this._threadDetailsStale),(e=>-this._getConversationSyncSortRank(e,h)));o.each(e,(e=>(d(e),i>0)))}C.log(_.LogTraceArea.ChatService,"CheckSyncProgress: Conversation List: "+(this._conversationListSyncing?"Syncing":this._conversationListStale?"Stale":"Done")+", Messages: "+o.keys(this._messagesStale).length+" Stale/"+o.keys(this._messagesSyncing).length+" Syncing, Details: "+o.keys(this._threadDetailsStale).length+" Stale/"+o.keys(this._threadDetailsSyncing).length+" Syncing"),a!==Number.MAX_VALUE&&(C.log(_.LogTraceArea.ChatService,"Next sync in "+(Date.now()-a)+"ms"),this._checkSyncProgressCallbackTimer=A.default.setExpiration((()=>this._checkSyncProgress()),a))}_getConversationSyncSortRank(e,t){const s=p.default.getConversationMetaFromMemoryCache(e).conv;return t?s.getSortRank():s.getTimestamp()}_syncConversationList(){const e=this._firstConversationListSync?25:100;this._firstConversationListSync=!1;const t=c.default.getS4LMessagingFeatures().syncSettings,s=["Passport","Skype","Lync","Thread","Agent","ShortCircuit","PSTN"];t&&t.skipConvTypeSmsMms||s.push("SmsMms"),s.push("Flxt","NotificationStream"),t&&!t.skipConvTypeCast&&s.push("Cast"),s.push("ModernBots","secureThreads"),c.default.getS4LContactsFeatures().enableInviteFree&&s.push("InviteFree");const n=s.join("|");let r=this._conversationListSyncInfo?this._conversationListSyncInfo.state:"";return this._conversationListSyncInfo&&this._conversationListSyncInfo.types!==n&&(C.log(_.LogTraceArea.ChatService,"Flushing sync state due to changed conversation types list"),r=""),this._markFullSyncOnce(o.isEmpty(r)),C.log(_.LogTraceArea.ChatService,"Syncing Conversation List, sync state: "+m.encodeSyncStateForLog(r)),u.default.serviceGetMyConversations(n,1,r,e).then((e=>{var t;const s=e.body;if(!s||!s._metadata||o.isNil(s._metadata.syncState))return C.warn(_.LogTraceArea.ChatService,"Conversation List Sync: received empty response "+(s?s._metadata?"syncState":"metadata":"body")),void(this._conversationListWaitForSyncUtc=Date.now()+this._conversationListExponentialTime.getTimeAndCalculateNext());C.log(_.LogTraceArea.ChatService,"Conversation List Sync: "+(s.conversations?s.conversations.length:0)+" updated conversations: "+o.join(o.map(s.conversations,(e=>i.pii.Mri(e.id))),", ")+(s._metadata.backwardLink?", more available":"")),null===(t=this._syncScenario)||void 0===t||t.markStepCompleted("Fetched"),this._conversationListExponentialTime.reset(),o.each(s.conversations,(e=>{m.isAllGlobalClearMri(e.id)||p.default.queueConvUpdate(e)}));const r={state:m.decodeSyncState(s._metadata.syncState),types:n};return p.default.setConvListSyncInfo(r).always((()=>{var e;this._conversationListSyncInfo=r,o.each(s.conversations,(e=>{const t=p.default.getConversationMetaFromMemoryCache(e.id);t?this._markMessagesAndDetailsStaleAsNeeded(t):C.log(_.LogTraceArea.ChatService,"Cannot mark messages/details as stale - no cached conv meta: "+i.pii.Mri(e.id))})),null===(e=this._syncScenario)||void 0===e||e.markStepCompleted("BundleProcessed");!!s._metadata.backwardLink||(this._conversationListStale=!1,this._checkSyncFinishedForConversationList())}))})).catch((e=>{e.errorCode&&C.track(new T.KpiChatSyncFailure(e.errorCode.toString())),e.errorCode===m.ChatServiceErrors.InvalidSyncToken?(C.warn(_.LogTraceArea.ChatService,"Conversation List Sync: Bad Sync key, resetting"),this._conversationListSyncInfo=void 0,b.default.putData(f.InternalKeys.ConversationListSyncInfo,this._conversationListSyncInfo),this._checkSyncStartingForConversationList(),this._conversationListStale=!0):(0===e.statusCode?C.log(_.LogTraceArea.ChatService,"Conversation List Sync: Failed due to connectivity issues. Retrying..."):C.warn(_.LogTraceArea.ChatService,"Conversation List Sync: Transient Error: "+e.statusCode+"/"+e.statusText+(e.errorCode?", "+e.errorCode+"/"+e.errorMessage:"")),this._conversationListWaitForSyncUtc=Date.now()+this._conversationListExponentialTime.getTimeAndCalculateNext())}))}_fetchThreadDetails(e){return C.log(_.LogTraceArea.ChatService,"Fetching Thread Details for: "+i.pii.Mri(e)),u.default.serviceGetThread(e).then((t=>(this._resetBackoffTimer(),this._conversationSyncInfoTransient[e]&&(delete this._conversationSyncInfoTransient[e].thread,this._checkSyncInfoTransientForClearing(e)),p.default.queueThreadUpdate(t),p.default.processQueuedBundle().always((()=>{delete this._threadDetailsStale[e],this._checkSyncFinishedForConversation(e)}))))).catch((t=>{if(t.errorCode&&C.track(new T.KpiChatSyncFailure(t.errorCode.toString())),this._bumpBackoffTimerIfNeeded(t.statusCode),this._isPermanentError(e,t.errorCode))return C.log(_.LogTraceArea.ChatService,"Permanent Error on Thread Details: "+i.pii.Mri(e)+": "+t.statusCode+"/"+t.statusText+(t.errorCode?", "+t.errorCode+"/"+t.errorMessage:"")),this._conversationSyncInfoTransient[e]&&(delete this._conversationSyncInfoTransient[e].thread,this._checkSyncInfoTransientForClearing(e)),p.default.brickConversation(e).always((()=>{delete this._threadDetailsStale[e],this._checkSyncFinishedForConversation(e)}));{C.warn(_.LogTraceArea.ChatService,"Error Syncing Thread Details for "+i.pii.Mri(e)+": "+t.statusCode+"/"+t.statusText+(t.errorCode?", "+t.errorCode+"/"+t.errorMessage:""));let s=this._getOrCreateSyncInfoTransient(e);s.thread||(s.thread={fetchAfterUtc:0,exponentialTime:new r.ExponentialTime(3e3,3e5),chatServiceErrorCount:0}),s.thread.fetchAfterUtc=Date.now()+s.thread.exponentialTime.getTimeAndCalculateNext(),0!==t.statusCode&&s.thread.chatServiceErrorCount++,s.thread.chatServiceErrorCount>=3&&(C.log(_.LogTraceArea.ChatService,"Too many transient thread details fetch errors, giving up for now: "+i.pii.Mri(e)),this._syncFailed[e]=!0,delete this._threadDetailsStale[e],this._checkSyncFinishedForConversation(e))}}))}_getDesiredMessageHistoryStartTime(e,t){return this._desiredMessageHistoryStartTime[t]||e.messageHistoryStartTime}_startMessagesSync(e){const t=p.default.getConversationMetaFromMemoryCache(e);let s,n,r=!1;const a=!t.syncInfo.messagesSyncState,l=this._getDesiredMessageHistoryStartTime(t.syncInfo,e);this._conversationSyncInfoTransient[e]&&this._conversationSyncInfoTransient[e].nextSyncSinglePage?(s=m.BeginningOfTime,n=30,r=!0):a?(s=Date.now()-m.RecentMessageHistoryTimePeriod,n=20):(s=l,n=20);const d=t.conv.getConsumptionHorizonTimestamp(),c=d?d-1e3:Date.now();return c<s&&(s=c),C.log(_.LogTraceArea.ChatService,"Syncing Messages for "+i.pii.Mri(e)+", Lower bound: "+s+", PageSize "+n+", Stale: "+t.syncInfo.messagesStale+", HistoryStartTime: "+t.syncInfo.messageHistoryStartTime+", DesiredHistoryStartTime: "+l+", SyncState: "+m.encodeSyncStateForLog(t.syncInfo.messagesSyncState)+", StaleReason: "+(void 0===t.syncInfo.messagesStaleReason?"undefined":g.MessagesStaleReason[t.syncInfo.messagesStaleReason])),u.default.serviceGetConversationMessages(e,s,t.syncInfo.messagesSyncState,n).then((n=>{if(!n||!n._metadata||!n.messages)return C.warn(_.LogTraceArea.ChatService,"Syncing Messages for "+i.pii.Mri(e)+" received empty response "+(n?n._metadata?"messages":"metadata":"body")),void this._handleTransientMessageSyncError(e,0);this._resetBackoffTimer(),this._conversationSyncInfoTransient[e]&&(delete this._conversationSyncInfoTransient[e].messages,delete this._conversationSyncInfoTransient[e].nextSyncSinglePage,this._checkSyncInfoTransientForClearing(e));const d=!!n._metadata.backwardLink;let h,u,S,f;if(n.messages.length>0){let t=e;const s=o.map(n.messages,(e=>({message:e,origin:_.MessageOrigin.ChatSync,isOtherEndpointActive:!1,reactionUpdates:g.EmptyReactionsUpdate,clientMessageIds:[e.clientmessageid]})));p.default.queueMessagesForConversation(t,s),this._accumulateTelemetryData(e,n.messages.length),h=Number(o.minBy(n.messages,(e=>Number(e.version))).version)}d?(u=h||Number.MAX_VALUE,S=R.default.clampValue(l,Date.now()-m.RecentMessageHistoryTimePeriod,u)):(u=Math.min(h||Number.MAX_VALUE,s),S=u),f=d&&!r&&(!a||u>c);const y={messagesStale:f,messagesStaleReason:f?t.syncInfo.messagesStaleReason:void 0,messagesSyncState:m.decodeSyncState(n._metadata.syncState),messageHistoryStartTime:u};return C.log(_.LogTraceArea.ChatService,"Synced Messages for "+i.pii.Mri(e)+": More: "+d+", Count: "+n.messages.length+", Stale: "+f+", HistoryStartTime: "+u+", SyncState: "+m.encodeSyncStateForLog(y.messagesSyncState)),this._desiredMessageHistoryStartTime[e]=S,p.default.queueConvSyncInfoChange(e,y),p.default.processQueuedBundle().always((()=>{y.messagesStale||(delete this._messagesStale[e],this._checkSyncFinishedForConversation(e))}))})).catch((t=>{if(t.errorCode&&C.track(new T.KpiChatSyncFailure(t.errorCode.toString())),this._bumpBackoffTimerIfNeeded(t.statusCode),this._isPermanentError(e,t.errorCode))return C.log(_.LogTraceArea.ChatService,"Permanent Error Syncing Messages: "+i.pii.Mri(e)+": "+t.statusCode+"/"+t.statusText+(t.errorCode?", "+t.errorCode+"/"+t.errorMessage:"")),this._conversationSyncInfoTransient[e]&&(delete this._conversationSyncInfoTransient[e].messages,delete this._conversationSyncInfoTransient[e].nextSyncSinglePage,this._checkSyncInfoTransientForClearing(e)),p.default.brickConversation(e).always((()=>{delete this._messagesStale[e],this._checkSyncFinishedForConversation(e)}));if(t.errorCode===m.ChatServiceErrors.InvalidSyncToken){C.log(_.LogTraceArea.ChatService,"Bad message sync key for conversation: ",i.pii.Mri(e));const t=p.default.getConversationMetaFromMemoryCache(e),s={messagesStale:!0,messagesStaleReason:g.MessagesStaleReason.NeedSync,messagesSyncState:void 0,messageHistoryStartTime:t.syncInfo.messageHistoryStartTime};return p.default.setConvSyncInfo(e,s)}C.warn(_.LogTraceArea.ChatService,"Error Syncing Messages for "+i.pii.Mri(e)+": "+t.errorCode+" - "+t.errorMessage+", "+t.statusCode+"/"+t.statusText),this._handleTransientMessageSyncError(e,t.statusCode)}))}_handleTransientMessageSyncError(e,t){let s=this._getOrCreateSyncInfoTransient(e);s.messages||(s.messages={fetchAfterUtc:0,exponentialTime:new r.ExponentialTime(3e3,3e5),chatServiceErrorCount:0}),s.messages.fetchAfterUtc=Date.now()+s.messages.exponentialTime.getTimeAndCalculateNext(),0!==t&&s.messages.chatServiceErrorCount++,s.messages.chatServiceErrorCount>=3&&(C.log(_.LogTraceArea.ChatService,"Too many transient message sync errors, giving up for now: "+i.pii.Mri(e)),this._syncFailed[e]=!0,delete this._messagesStale[e],this._checkSyncFinishedForConversation(e))}_isPermanentError(e,t){return!(t!==m.ChatServiceErrors.AccessDenied&&t!==m.ChatServiceErrors.InitiatorNotPartOfThread&&t!==m.ChatServiceErrors.ThreadNotFound)&&(!m.isOneOnOneConversation(e)||(C.track(new v.FundamentalsDebugEvent("BrickOneOnOne","Namespace: "+m.getMriNamespace(e))),!1))}_bumpBackoffTimerIfNeeded(e){(0===e||e>=500&&e<600)&&(this._checkProgressAfter=Date.now()+this._syncExponentialBackoff.getTimeAndCalculateNext())}_resetBackoffTimer(){this._syncExponentialBackoff.reset(),this._checkProgressAfter=0}_startTelemetry(){this._syncTelemetryEvent||(this._syncTelemetryEvent=new T.KpiChatSync),this._syncScenario||(this._syncScenario=new k.default(I.ScenarioName.InitialRecentsSync),this._syncScenario.start())}_stopTelemetry(){this._markFirstSyncOnce(),this._trackSyncTelemetry(),this._stopSyncScenario(),this._syncDataAccumulator.reset()}_stopSyncScenario(){this._syncScenario&&(this._syncScenario.finish(this._syncDataAccumulator.getData()),this._syncScenario=void 0)}_trackSyncTelemetry(){this._syncTelemetryEvent&&(this._syncTelemetryEvent.endSync(this._syncDataAccumulator.getData()),C.track(this._syncTelemetryEvent),this._syncTelemetryEvent=void 0)}_accumulateTelemetryData(e,t){this._syncDataAccumulator.accumulateData(e,t)}test_reset(){this._appStateSubToken&&this._appStateSubToken.unsubscribe(),this._connectedSubToken&&this._connectedSubToken.unsubscribe(),this._convSubToken&&this._convSubToken.unsubscribe(),this._messagesStale={},this._threadDetailsStale={},this._messagesSyncing={},this._threadDetailsSyncing={},this._conversationSyncInfoTransient={},this._resetBackoffTimer(),this._conversationListWaitForSyncUtc=0,this._conversationListExponentialTime.reset()}}},99146:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(60),r=(s(89391),s(26426)),a=s(71830),l=(s(46096),s(36237),s(61253));class d extends r.default{constructor(e,t,s,r,a,l=i.noop){super(e,t,l,a),this._baseInterestedResources=s,this._enabled=r,this._presenceTrackedMrisDesired=[],n.default.subscribeForChanges("LongPollSubscription",(e=>{e===o.Types.AppActivationState.Active&&this._resetBackoffs(),this._checkState()})),this._updateDesiredParams()}logout(){this._subscriptionInfoUpdated(void 0),this.setEnabled(!1),this.cancelPendingLongPollRequest("logout")}setEnabled(e){this._enabled!==e&&(this._enabled=e,this._checkState())}setPresenceMriTrackingList(e){(0,l.default)(e,this._presenceTrackedMrisDesired)||(this._presenceTrackedMrisDesired=e,this._updateDesiredParams())}setInterestedResources(e){this._baseInterestedResources=e,this._updateDesiredParams()}_updateDesiredParams(){const e=this._baseInterestedResources.concat(i.map(this._presenceTrackedMrisDesired,(e=>"/v1/users/ME/contacts/"+e)));this._setDesiredSubParameters(a.createLongPollSubscriptionParams(e))}_subscriptionAllowed(){return!!this._enabled&&super._subscriptionAllowed()}}t.default=d},56032:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(62783),n=s(97691),r=s(89391),a=s(36593),l=s(12228),d=s(71830),c=s(46096),h=s(66765),u=s(13159),p=s(90424),g=s(53374);class m extends u.SkypeRestClient{constructor(e){super(m._calcEndpointUrl()),this._errorHandler=e,this._customErrorHandler=(e,t)=>{this._updateRegistrationToken(t);const s=e.getOptions(),i=t.requestOptions,n=this._customErrorHandlerHelper(t,e,s);switch(n){case o.ErrorHandlingType.DoNotRetry:i.reliabilityTracker.failed(t);break;case o.ErrorHandlingType.PauseUntilResumed:case o.ErrorHandlingType.RetryCountedWithBackoff:case o.ErrorHandlingType.RetryUncountedImmediately:case o.ErrorHandlingType.RetryUncountedWithBackoff:i.reliabilityTracker.retry(t);break;default:g.default.switchStatementExhaustiveChecking(n)}return n},this._defaultOptions.mustHaveValidSkypeToken=!0,this._defaultOptions.customErrorHandler=this._customErrorHandler,this._defaultOptions.augmentErrorResponse=this._errorHandler.augmentErrorResponse}static _calcEndpointUrl(){const e=r.default.getConfigSettingsNoSubscription().chat.msgApiConfig;return e&&e.enabled?e.host:""}resetBackoffTimers(){this._errorHandler.getLoginTimer().reset()}_getHeaders(e){let t=super._getHeaders(e);t.Authentication=p.getSkypetokenHeaderValue();const s=h.default.getRegistrationToken();r.default.getConfigSettingsNoSubscription().chat.authentication.useRegToken&&s&&(t.RegistrationToken=s),t["X-Forward-To"]=h.default.getRestEndpointUrl()||h.default.calcChatV1EndpointUrl(),e.endpointId&&(t.EndpointId=e.endpointId),t.ClientInfo=d.getClientInfoString(),t["X-ECS-Etag"]=r.default.getCachedEcsConfigEtag();const i=d.getClientCapabilities();return i&&(t["X-Client-Capabilities"]=i),t}_blockRequestUntil(e){let t=[super._blockRequestUntil(e)];return t.push(this._errorHandler.get429Timer().getPromise()),e.isLoginRequest&&t.push(this._errorHandler.getLoginTimer().getPromise()),n.all(t).then(i.noop)}_customErrorHandlerHelper(e,t,s){const i=this._errorHandler.getRegistrationTokenFromHeaders(t.getRequestHeaders()),n=this._errorHandler.getSkypetokenFromHeaders(t.getRequestHeaders()),r=this._errorHandler.handleChatServiceFailure("MessagingRestClient",e,n,i,h.default.getEndpointInfo().id,s,c.ChatServiceConnectionType.MessagingApi);if(r===a.ChatServiceErrorTypes.LocationChanged&&e.headers.location)return t.setUrl(e.headers.location),o.ErrorHandlingType.RetryUncountedImmediately;switch(r){case a.ChatServiceErrorTypes.TooManyRequests:case a.ChatServiceErrorTypes.LoginRateLimitExceeded:case a.ChatServiceErrorTypes.LoginRequestError:return o.ErrorHandlingType.RetryUncountedWithBackoff}return(0,o.DefaultErrorHandler)(t,e)}_processSuccessResponse(e){e.requestOptions.reliabilityTracker.succeeded(e),this._errorHandler.get429Timer().reset(),this._updateRegistrationToken(e)}_updateRegistrationToken(e){if(r.default.getConfigSettingsNoSubscription().chat.authentication.useRegToken&&e.headers&&e.headers["set-registrationtoken"]){const t=e.headers["set-registrationtoken"];h.default.setRegistrationToken(t)}}performRequest(e,t){const s={scenario:e.scenario,reliabilityTracker:new l.default(e.scenario,c.ChatServiceConnectionType.MessagingApi),contentType:e.mediaType};return s.reliabilityTracker.begin(),this._endpointUrl=m._calcEndpointUrl(),e.endpointId&&(s.endpointId=e.endpointId),p.applyRestRequestTimeoutOverride(e.scenario,s),super.performRequest(e,i.extend(s,t)).done((()=>{s.reliabilityTracker.ensureResolved()})).fail((e=>{e.invalidNullBody?s.reliabilityTracker.ensureResolved():s.reliabilityTracker.ensureRejected()}))}performRequestBackground(e,t,s,i){return this._endpointUrl=m._calcEndpointUrl(),i=i||{},p.applyRestRequestTimeoutOverride(s.scenario,i),super.performRequestBackground(e,t,s,i)}}t.default=m},13651:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(74958),o=s(96486),n=s(62783),r=s(97691),a=s(89391),l=s(36593),d=s(90239),c=s(12228),h=s(71830),u=s(46096),p=s(97811),g=s(36237),m=s(99146),S=s(78735),f=s(15963),y=s(66765),_=s(13159),v=s(4057),C=s(94050),b=s(19358),T=s(94214),M=s(90424),I=s(26712),w=s(53374),P=new n.ExponentialTime(1e3,2e4);class k extends _.SkypeRestClient{constructor(e,t,s,o){super(y.default.calcChatV1EndpointUrl()),this._chatServiceClient=e,this._handleEvents=t,this._subscriptionStateChanged=s,this._errorHandler=o,this._connectivityEnabled=!1,this._checkStateInside=!1,this._checkStatePending=!1,this._timeToConnectedTelemetry=new C.default(f.ScenarioName.TimeToConnected),this._nextAllowedPresencePublish=0,this._uedIsExclusive=!1,this._restEndpointUrlChangedCallback=()=>{const e=y.default.calcChatV1EndpointUrl();g.log(u.LogTraceArea.ChatServiceTransport,"RestEndpointUrlChanged callback fired."),e!==this._endpointUrl&&(g.log(u.LogTraceArea.ChatServiceTransport,`Updating endpoint URL to ${i.pii.Omit(e)}`),this.handleLocationChange(e))},this._customErrorHandler=(e,t)=>{b.default.putCurrentServiceTime(Date.parse(t.headers.date),0),this._updateRegistrationToken(t);const s=e.getOptions(),i=t.requestOptions,o=this._customErrorHandlerHelper(t,e,s);switch(o){case n.ErrorHandlingType.DoNotRetry:i.reliabilityTracker.failed(t);break;case n.ErrorHandlingType.PauseUntilResumed:case n.ErrorHandlingType.RetryCountedWithBackoff:case n.ErrorHandlingType.RetryUncountedImmediately:case n.ErrorHandlingType.RetryUncountedWithBackoff:i.reliabilityTracker.retry(t);break;default:w.default.switchStatementExhaustiveChecking(o)}return o},this._defaultOptions.mustHaveValidSkypeToken=!0,this._defaultOptions.customErrorHandler=this._customErrorHandler,this._defaultOptions.augmentErrorResponse=this._errorHandler.augmentErrorResponse}startup(){const{chatServiceHostRefreshEnabled:e,chatServiceHostRefreshInterval:t,authentication:s}=a.default.getConfigSettings().chat;e&&!t&&y.default.setRestEndpointUrl(y.default.calcChatV1EndpointUrl()),this._endpointUrl=y.default.getRestEndpointUrl()||y.default.calcChatV1EndpointUrl(),s.useRegToken||(g.log(u.LogTraceArea.ChatServiceTransport,"Registration token auth disabled, setting reg token to undefined"),y.default.setRegistrationToken(void 0)),T.default.subscribe((()=>{y.default.setRegistrationToken(void 0),this._checkState()}),T.TriggerKeys.SkypeTokenKey),a.default.subscribe((()=>{const{blacklistedHosts:e,chatServiceHostRefreshEnabled:t,authentication:s}=a.default.getConfigSettings().chat;s.useRegToken||(g.log(u.LogTraceArea.ChatServiceTransport,"Registration token auth disabled, setting reg token to undefined"),y.default.setRegistrationToken(void 0));const i=a.default.getS4LMessagingFeaturesNoSubscription().ued;this._uedIsExclusive!==(i&&i.isExclusive)&&(this._uedIsExclusive=i&&i.isExclusive,this._longPollSubscription&&this._longPollSubscription.setInterestedResources(this._calculateInterestedResources())),o.includes(e,this._endpointUrl)&&this.handleLocationChange(y.default.calcChatV1EndpointUrl()),t&&!this._handleLocationChange?this._handleLocationChange=y.default.restEndpointUrlChanged.subscribe(this._restEndpointUrlChangedCallback):!t&&this._handleLocationChange&&(this._handleLocationChange.unsubscribe(),this._handleLocationChange=void 0),this._checkState()}));const i=a.default.getConfigSettings().chat.blacklistedHosts;o.includes(i,this._endpointUrl)&&this.handleLocationChange(y.default.calcChatV1EndpointUrl());const n=y.default.getEndpointInfo(),r=a.default.getS4LMessagingFeaturesNoSubscription().ued;this._uedIsExclusive!==(r&&r.isExclusive)&&(this._uedIsExclusive=r&&r.isExclusive),S.default.subscribe((()=>{this._longPollSubscription&&(this._longPollSubscription.setInterestedResources(this._calculateInterestedResources()),g.log(u.LogTraceArea.ChatServiceTransport,"MyUserPreferencesLocalStore: kick checkState in RestTransport"),this._checkState())})),g.log(u.LogTraceArea.ChatServiceTransport,"RestTransport Started Up. EndpointInfo: "+h.encodeEndpointInfoForLog(n)),this._longPollSubscription=new m.default(this._chatServiceClient,"LongPoll",this._calculateInterestedResources(),this._connectivityEnabled,this._handleEvents,((e,t)=>{(e===d.SubscriptionState.CreatedActive||d.SubscriptionState.CreatedLongPollTrouble)&&this._timeToConnectedTelemetry.hasStarted()&&(this._timeToConnectedTelemetry.finish(),this._timeToConnectedTelemetry.reset()),this._subscriptionStateChanged(e,t)})),this._pendingPresenceMriTrackingList&&(this._longPollSubscription.setPresenceMriTrackingList(this._pendingPresenceMriTrackingList),this._pendingPresenceMriTrackingList=void 0)}logout(){this.setConnectionEnabled(!1,"logout"),this._longPollSubscription&&this._longPollSubscription.logout()}handleLocationChange(e,t){const s=I.default.getURIComponents(e),o=I.default.getURIComponents(this._endpointUrl);if(s&&o&&s.host){const e=s.protocol||"https";let n=s.host;n&&n.length>0&&"/"!==n.charAt(n.length-1)&&(n+="/");const l=e+"://"+n+(o.pathname||"");if(this._endpointUrl!==l)return g.log(u.LogTraceArea.ChatServiceTransport,"RestTransport Endpoint URL Changed: "+i.pii.Omit(this._endpointUrl)+" => "+i.pii.Omit(l)),this._endpointUrl=l,y.default.setRestEndpointUrl(l),!0;if(g.warn(u.LogTraceArea.ChatServiceTransport,"RestTransport got response to change endpoint to the same thing: "+i.pii.Omit(l)),g.track(new p.FundamentalsDebugEvent("ChatServiceSameLocationRedirect",o.host+"/")),a.default.getConfigSettingsNoSubscription().chat.recreateEndpointOnSameLocationRedirect){const e=y.default.getEndpointInfo().id;M.getDurableEndpointId().then((s=>{let i;i=e&&h.areEndpointIdsEqual(e,s)?this._chatServiceClient.serviceDeleteEndpoint(e).then((()=>{g.warn(u.LogTraceArea.ChatServiceTransport,"Deleted endpoint ID "+e+" before recreating")})).catch((t=>{g.log(u.LogTraceArea.ChatServiceTransport,"Failed to delete endpoint ID "+e+" before recreating: "+v.default.errorAsString(t))})):r.Resolved(),i.then((()=>{const e=y.default.calcChatV1EndpointUrl();this._endpointUrl!==e&&(this._endpointUrl=e,y.default.setRestEndpointUrl(this._endpointUrl)),y.default.updateEndpointInfo({id:void 0,exists:!1,featureFlags:void 0,presenceDocPublished:void 0,pushSubscriptionId:void 0,pushSubscriptionParams:void 0,reason:"Redirect to same URL",tcid:t})}))}))}}return!1}debug_getCurrentCloudUrl(){return this._endpointUrl}setPresenceMriTrackingList(e){this._longPollSubscription?this._longPollSubscription.setPresenceMriTrackingList(e):this._pendingPresenceMriTrackingList=e}resetBackoffTimers(){this._errorHandler.getLoginTimer().reset(),this._checkState()}isConnectionEnabled(){return this._connectivityEnabled}setConnectionEnabled(e,t){if(this._connectivityEnabled!==e){if(e){const e={ConnectionType:"REST",ReasonForConnecting:t};this._timeToConnectedTelemetry.start(e)}else this._timeToConnectedTelemetry.hasStarted()&&(this._timeToConnectedTelemetry.fail(t),this._timeToConnectedTelemetry.reset());this._connectivityChangeReason=t,g.log(u.LogTraceArea.ChatServiceTransport,"RestTransport setConnectionEnabled: "+e+", reason: "+t),this._connectivityEnabled=e,this._longPollSubscription&&this._longPollSubscription.setEnabled(this._connectivityEnabled),this._checkState()}}endpointInfoUpdated(e,t){g.log(u.LogTraceArea.ChatServiceTransport,"RestTransport Endpoint Info Updated: "+h.encodeEndpointInfoForLog(e)),this._longPollSubscription&&this._longPollSubscription.endpointInfoUpdated(e,t),this._checkState()}_getEndpointFeaturesList(){return h.getEndpointFeaturesList()}_calculateInterestedResources(){return M.calculateInterestedResources(!this._uedIsExclusive)}_endpointPresencePublished(e,t){const s=y.default.getEndpointInfo();h.areEndpointIdsEqual(s.id,e)?s.exists?(g.log(u.LogTraceArea.ChatService,"Endpoint "+e+" presence published"),y.default.updateEndpointInfo({presenceDocPublished:t,reason:"Presence published"})):g.warn(u.LogTraceArea.ChatServiceTransport,"_endpointPresencePublished called with non-existing endpoint"):g.warn(u.LogTraceArea.ChatServiceTransport,"_endpointPresencePublished called with stale endpointid")}_checkState(){this._checkStateInside?this._checkStatePending=!0:(this._checkStateInside=!0,M.calculateDesiredEndpointId().then((e=>{this._checkStateInner(e),this._checkStateInside=!1,this._checkStatePending&&(this._checkStatePending=!1,this._checkState())})))}_checkStateInner(e){if(!(this._connectivityEnabled&&T.default.hasUsableSkypeToken())){if(g.log(u.LogTraceArea.ChatServiceTransport,"Cancelling requests in flight, reason: "+this._connectivityChangeReason),this._endpointCreationInFlight){const e=this._endpointCreationInFlight;this._endpointCreationInFlight=void 0,e.cancel()}if(this._presencePublishInFlight){const e=this._presencePublishInFlight;this._presencePublishInFlight=void 0,e.cancel()}return}const t=y.default.getEndpointInfo(),s=this._getEndpointFeaturesList(),i=a.default.getCachedEcsConfigEtag(),n=a.default.getConfigSettings().chat.updateEndpointOnEcsEtagChange;if(!t.exists||!t.id||!h.areEndpointIdsEqual(t.id,e)||t.featureFlags!==s||n&&t.ecsEtag!==i){if(this._endpointCreationInFlight)return;return g.log(u.LogTraceArea.ChatServiceTransport,"RestTransport Creating/Updating Endpoint. Features: "+s+(t.id?", Given Id: "+t.id:"")+", Desired Id: "+e),this._endpointCreationInFlight=this.createOrUpdateEndpoint(e,i),void this._endpointCreationInFlight.finally((()=>{this._endpointCreationInFlight=void 0})).then((t=>(this._errorHandler.getLoginTimer().reset(),M.getDurableEndpointId().then((s=>{(!e||!y.default.endpointExists()||h.areEndpointIdsEqual(t.id,y.default.getEndpointId())||h.areEndpointIdsEqual(s,t.id)||h.areEndpointIdsEqual(s,y.default.getEndpointId()))&&(g.log(u.LogTraceArea.ChatServiceTransport,"RestTransport Endpoint Created/Updated: "+h.encodeEndpointInfoForLog(t)),y.default.updateEndpointInfo(t))}))))).catch((e=>{e&&0!==e.statusCode?g.warn(u.LogTraceArea.ChatServiceTransport,"Endpoint Creation failure: "+e.statusCode+"/"+e.statusText+", "+e.errorCode+"/"+e.errorMessage):g.log(u.LogTraceArea.ChatServiceTransport,"Endpoint Creation failure: Empty error or connectivity issues. Reconnecting.")})).finally((()=>{this._checkState()}))}const r=t.id,l=M.calculateDesiredEndpointPresenceDoc(),d=h.areEndpointPresenceDocsEqual(t.presenceDocPublished,l);if(!d){if(this._presencePublishInFlight)return;if(Date.now()<this._nextAllowedPresencePublish){if(o.isUndefined(this._delayedPresencePublish)){const e=this._nextAllowedPresencePublish-Date.now();g.log(u.LogTraceArea.ChatServiceTransport,`Delaying presence publishing for ${e} ms`),this._delayedPresencePublish=o.delay((()=>this._checkState()),e)}return}return this._delayedPresencePublish=void 0,g.log(u.LogTraceArea.ChatServiceTransport,"RestTransport Publishing Presence on Endpoint: "+JSON.stringify(l)),void this._publishEndpointPresence(r,l)}}_publishEndpointPresence(e,t){this._presencePublishInFlight=this._chatServiceClient.servicePublishEndpointPresence(e,t),this._presencePublishInFlight.finally((()=>{this._presencePublishInFlight=void 0})).then((()=>{this._errorHandler.getLoginTimer().reset(),P.reset(),h.areEndpointIdsEqual(e,y.default.getEndpointId())?(g.log(u.LogTraceArea.ChatServiceTransport,"RestTransport Presence Published on Endpoint: "+e),this._endpointPresencePublished(e,t)):this._checkState()})).catch((t=>{if(this._nextAllowedPresencePublish=Date.now()+P.getTimeAndCalculateNext(),t&&404===t.statusCode)return g.log(u.LogTraceArea.ChatServiceTransport,"RestTransport Presence Publish reported missing endpoint: "+e),void y.default.markEndpointMissing(e,h.getTcidDataFromServerMessageResponse(t));t&&0!==t.statusCode?g.warn(u.LogTraceArea.ChatServiceTransport,"Presence Publish failure: "+t.statusCode+"/"+t.statusText+", "+t.errorCode+"/"+t.errorMessage+". Retrying..."):g.log(u.LogTraceArea.ChatServiceTransport,"Presence Publish failure: Empty error or connectivity issues. Retrying..."),this._checkState()}))}createOrUpdateEndpoint(e,t){const s=this._getEndpointFeaturesList();return g.log(u.LogTraceArea.ChatServiceTransport,"RestTransport Creating/Updating Endpoint. Features: "+s+(e?", Given Id: "+e:"")),e?this._chatServiceClient.serviceUpdateEndpoint(e,s).then((e=>{const i=h.findPushSubscriptionInfo(e.endpoint.subscriptions);return o.assign({id:e.endpoint.id,exists:!0,featureFlags:s,presenceDocPublished:void 0,pushSubscriptionId:void 0,pushSubscriptionParams:void 0,ecsEtag:t,reason:"REST update endpoint",tcid:e.tcid},i)})):this._chatServiceClient.serviceCreateEndpoint(s).then((e=>({id:e.endpointId,exists:!0,featureFlags:s,presenceDocPublished:void 0,pushSubscriptionId:void 0,pushSubscriptionParams:void 0,ecsEtag:t,reason:"REST create endpoint",tcid:e.tcid})))}_getHeaders(e){let t=super._getHeaders(e);t.Authentication=M.getSkypetokenHeaderValue();const s=a.default.getConfigSettingsNoSubscription().chat.authentication,i=y.default.getRegistrationToken();return s.useRegToken&&i&&!e.isSkypetokenOnlyRequest&&(t.RegistrationToken=i),e.endpointId&&(t.EndpointId=e.endpointId),t.ClientInfo=h.getClientInfoString(),t.BehaviorOverride="redirectAs404",t["X-ECS-Etag"]=a.default.getCachedEcsConfigEtag(),t}_blockRequestUntil(e){let t=[super._blockRequestUntil(e)];return t.push(this._errorHandler.get429Timer().getPromise()),this._errorHandler.getRedirectTimer().getBumpCount()>1&&t.push(this._errorHandler.getRedirectTimer().getPromise()),e.isLoginRequest&&t.push(this._errorHandler.getLoginTimer().getPromise()),r.all(t).then(o.noop)}_customErrorHandlerHelper(e,t,s){const i=this._errorHandler.getRegistrationTokenFromHeaders(t.getRequestHeaders()),o=this._errorHandler.getSkypetokenFromHeaders(t.getRequestHeaders()),r=this._errorHandler.handleChatServiceFailure("RestTransport",e,o,i,y.default.getEndpointInfo().id,s,u.ChatServiceConnectionType.ChatServiceV1);if(r===l.ChatServiceErrorTypes.LocationChanged&&e.headers.location)return t.setUrl(e.headers.location),n.ErrorHandlingType.RetryUncountedImmediately;switch(r){case l.ChatServiceErrorTypes.TooManyRequests:case l.ChatServiceErrorTypes.LoginRateLimitExceeded:case l.ChatServiceErrorTypes.LoginRequestError:return n.ErrorHandlingType.RetryUncountedWithBackoff}return(0,n.DefaultErrorHandler)(t,e)}_processSuccessResponse(e){e.requestOptions.reliabilityTracker.succeeded(e),b.default.putCurrentServiceTime(Date.parse(e.headers.date),0),this._errorHandler.get429Timer().reset(),this._errorHandler.getRedirectTimer().reset(),this._updateRegistrationToken(e)}_updateRegistrationToken(e){if(a.default.getConfigSettingsNoSubscription().chat.authentication.useRegToken&&e.headers&&e.headers["set-registrationtoken"]){const t=e.headers["set-registrationtoken"];y.default.setRegistrationToken(t)}}performRequest(e,t){const s={scenario:e.scenario,reliabilityTracker:new c.default(e.scenario,u.ChatServiceConnectionType.ChatServiceV1),contentType:e.mediaType};return s.reliabilityTracker.begin(),e.endpointId&&(s.endpointId=e.endpointId),M.applyRestRequestTimeoutOverride(e.scenario,s),super.performRequest(e,o.extend(s,t)).done((()=>{s.reliabilityTracker.ensureResolved()})).fail((e=>{e.invalidNullBody?s.reliabilityTracker.ensureResolved():s.reliabilityTracker.ensureRejected()}))}performRequestBackground(e,t,s,i){return i=i||{},M.applyRestRequestTimeoutOverride(s.scenario,i),super.performRequestBackground(e,t,s,i)}}t.default=k},90424:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.applyRestRequestTimeoutOverride=t.getSkypetokenHeaderValue=t.calculateDesiredEndpointId=t.getDurableEndpointId=t.calculatePnhInterestedResources=t.calculateV2InterestedResources=t.calculateInterestedResources=t.calculateDesiredEndpointPresenceDoc=void 0;const i=s(96486),o=s(97691),n=s(89391),r=s(90239),a=s(71830),l=s(66765),d=s(16568),c=s(94214),h=s(53374);function u(){return d.default.EdfRegistrationId.waitUntilSet().then((()=>{const e=d.default.EdfRegistrationId.get();return e&&h.default.isFormattedGuid(e)?a.formatEndpointId(e):void 0}))}t.calculateDesiredEndpointPresenceDoc=function(){return a.buildEndpointPresenceDocData(["Audio","Video"])},t.calculateInterestedResources=function(e,t){let s=i.map(t,(e=>"/v1/users/ME/contacts/"+e));return e?r.PrimaryResourcesToTrack.concat(s):s},t.calculateV2InterestedResources=function(){return r.PrimaryResourcesToTrack},t.calculatePnhInterestedResources=function(){return r.PnhResourcesToTrack},t.getDurableEndpointId=u,t.calculateDesiredEndpointId=function(){const e=n.default.getConfigSettingsNoSubscription().chat.durableEndpointId,t=l.default.getEndpointInfo().id;return t?e.recreateToMatchEnabled?u().then((s=>e.enabled?s||t:a.areEndpointIdsEqual(t,s)?void 0:t)):o.Resolved(t):e.enabled?u().then((e=>e)):o.Resolved(void 0)},t.getSkypetokenHeaderValue=function(){return a.SKYPE_TOKEN_HEADER_PREFIX+c.default.getRawSkypeToken()},t.applyRestRequestTimeoutOverride=function(e,t){const s=n.default.getConfigSettingsNoSubscription().chat.RESTRequestTimeouts;s&&(t.timeout=s.scenarioTimeouts&&s.scenarioTimeouts[e]||t.timeout,t.timeout=t.timeout||s.defaultTimeout)}},29791:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toAccessibilityTraits=t.getAccessibilityLabelForReaction=t.toAccessibilityLabel=t.ContentToAccessibilityLabelTransformer=void 0;const i=s(96486),o=s(89391),n=s(25638),r=s(25489),a=s(96096),l=s(51077),d=s(81959),c=s(16402),h=s(52262),u=s(35521),p=s(39024),g=s(82433),m=s(70891),S=s(46096),f=s(52115),y=s(73439),_=s(36237),v=s(33754),C=s(18606),b=s(12762),T=s(18078),M=s(77914),I=s(71987),w=s(86045),P=s(4057),k=s(32293);class A extends d.ContentToTextTransformer{constructor(){super(...arguments),this.transformPictureNode=e=>({value:v.getString("AccessibilityLabel.Picture"),stopProcessing:!1}),this.transformMediaAlbumNode=e=>{const t=e.getAlbumId();let s="";if(t){const e=C.default.getAllMediaMessagesForAlbum(t).length;s=v.getString("AccessibilityLabel.Photos",{count:e})}return{value:s,stopProcessing:!1}},this.transformVideoNode=e=>({value:e.getSubType()===l.UriObjectTypeSubTypes.Video.CallRecording?v.getString("AccessibilityLabel.CallRecording",{numberOfDays:o.default.getS4LCMCFeatures().callRecorderRetentionDurationDays}):v.getString("AccessibilityLabel.Video"),stopProcessing:!1}),this.transformVideoMessageNode=e=>({value:v.getString("AccessibilityLabel.VideoMessage"),stopProcessing:!1}),this.transformAudioNode=e=>({value:v.getString("AccessibilityLabel.Audio"),stopProcessing:!1}),this.transformAudioMessageNode=e=>{const t=e.getAudioDurationMs(),s=t?Math.round(t/1e3):0,i=c.default.getFormattedDuration(s,!0);return{value:v.getString("AccessibilityLabel.AudioMessage",{duration:i}),stopProcessing:!1}},this.transformUriObjectFileNode=e=>{const t=new n.default(e.getFileContentUrlSanitized()).getDocumentId(),s=f.default.formatFileSize(e.getSizeInBytes(),1).formattedString;let i;i=t&&y.default.getLocalUri(t)?v.getString("AccessibilityLabel.OpenFile",{fileSize:s}):v.getString("AccessibilityLabel.DownloadFile",{fileSize:s});return{value:v.getString("AccessibilityLabel.Document",{documentName:e.getNameForUI(),fileLabel:i}),stopProcessing:!1}},this.transformLocationNode=e=>({value:v.getString("AccessibilityLabel.Location",{locationName:e.addressFriendlyNameSanitized,address:e.addressSanitized}),stopProcessing:!1}),this.transformMojiNode=e=>({value:v.getString("AccessibilityLabel.Moji",{mojiName:e.getNameForUI()}),stopProcessing:!1}),this.transformStickerNode=e=>({value:v.getString("AccessibilityLabel.Sticker",{stickerName:e.getNameForUI()}),stopProcessing:!1}),this.transformAtMentionNode=e=>{const t=this._renderTextNodes(e.children);let s=t.value;return e.isAllMention()&&(s=e.getLocalizedAllMention()),{value:"("+s+")",stopProcessing:t.stopProcessing}},this.transformScheduledCallInviteNode=e=>{let t="";const s=M.default.getScheduledCallById(e.scheduledCallId);return s&&(t=I.default.getAccessibilityLabelForScheduledCall(s)),{value:t,stopProcessing:!1}},this.transformPollNode=e=>({value:v.getString("Poll.StreamItemAccessibilityLabel",{question:e.title}),stopProcessing:!1}),this.transformCallerIDNode=e=>({value:v.getString("CallerIdPrompt.CallerIDInChatIntro"),stopProcessing:!1})}_renderTextNodes(e){return super._renderTextNodes(e," ")}transformEmoticonNode(e){let t=e.type;const s=g.default.getEmoticonByName(e.type);s&&s.description&&(t=s.description);const i=p.getEmoticonAccessibilityLabel(t,e.tone);return{value:v.getString("AccessibilityLabel.Emoticon",{emoticonName:i}),stopProcessing:!1}}transformQuoteNode(e){const t=this._default(e);return{value:v.getString("AccessibilityLabel.QuotedMessage",{quotedName:e.getAuthorNameWithFallbackUnescaped(),quoteContent:t.value}),stopProcessing:!1}}transformSwiftUriObjectNode(e){if(k.default.isUriNodeTextMessage(e))return this._renderTextNodes(k.default.getTextNodes(e));return{value:v.getString("AccessibilityLabel.Bot"),stopProcessing:!1}}transformPartListNode(e){let t;if(a.default.calculateCallMarkerInfo(e).type===a.CallMarkerType.Missed)t=v.getString("AccessibilityLabel.CallMissed");else t=v.getString("AccessibilityLabel.Call");return{value:t,stopProcessing:!1}}transformContactsNode(e){const t=this._renderTextNodes(e.children);return{value:v.getString("ContactCard.ContactCardAccessibilityLabel",{contactValue:t.value}),stopProcessing:t.stopProcessing}}}function E(e,t){let s,i=h.default.getMemberShortNameForConversation(e,t.users[0].mri),o=0,n="AccessibilityLabel.Reactions1User";const r=t.users.length;r>1&&(s=h.default.getMemberShortNameForConversation(e,t.users[1].mri),n="AccessibilityLabel.Reactions2Users"),r>2&&(o=t.users.length-2,n="AccessibilityLabel.ReactionsMultipleUsers");const a=g.default.getEmoticonByName(t.key),l={count:t.users.length,firstUser:i,secondUser:s,remainingCount:o,reactionName:a&&a.description?a.description:t.key};return v.getString(n,l)}t.ContentToAccessibilityLabelTransformer=A,t.toAccessibilityLabel=function(e,t){const s=t.message;let o="";try{const s=i.defaults(t,{options:t,processing:{},onlyEmoticons:e.hasOnlyEmoticonsOrWhitespaceText(),utfFallback:!1,onlyQuotedContent:e.hasOnlyQuotedContent(),lineBreakString:"",includeSenderInformationInAccessibilityLabel:!0,includeReactionInformationInAccessibilityLabel:!0,includeMediaAlbumItemCountInAccessibilityLabel:!0,messageAccessibilityType:m.MessageAccessibilityType.Text}),n=new A(s);o=n.transform(e).value||""}catch(e){_.error(S.LogTraceArea.GenericUnsafe,"ContentToAccessibilityLabelTransformer: Failed to transform tree: "+P.default.errorAsString(e))}const n=s.isSendRejected(),d=s.isUnsent(),h=i.find(e.children,(e=>e instanceof b.PartListNode));if(h){const e=r.default.getCallLog(h.callId),t=a.default.calculateCallMarkerInfo(h,e);o=a.CallMarkerDisplayUtils.getTextForAccessibilityLabel(t.type)}if(t.message.isAlbum()&&!t.includeMediaAlbumItemCountInAccessibilityLabel&&(o=v.getString("AccessibilityLabel.MediaAlbumPhotosNoCount")),s.isReported()&&(o=v.getString("MessageContentNodes.ReportedMessageFallback")),!t.includeSenderInformationInAccessibilityLabel)return n?v.getString("AccessibilityLabel.FailedTextMessage",{messageContent:o}):d&&w.default.shouldAnnounceForAccessibility()?v.getString("AccessibilityLabel.TextMessageSending",{messageContent:o}):o;let p=s.creator,g=s.createdTime;const f=s.isBookmarkSourceForCurrentUser(),y=s.isBookmark();let C,M;if(y){const e=l.getBookmarkMetadata(s.properties),t=e&&e.bookmarkSourceCreatorId,o=e&&e.bookmarkSourceComposeTime;t&&(p=t,C=e&&e.bookmarkSourceConversationName),o&&(g=i.toNumber(o))}const I={senderName:(0,u.displayNameText)(p,p),timestamp:y?c.default.getDisplayDateStringDayMonthYearFormat(g):c.default.getDisplayTimeString(g),messageContent:o};if(y)I.receiverConversationName=!C&&T.default.isMyMri(s.creator)?v.getString("DisplayInfoStore.ListMyName"):C,M=v.getString("AccessibilityLabel.BookmarkMessage",I);else switch(t.messageAccessibilityType){case m.MessageAccessibilityType.Media:M=d?v.getString("AccessibilityLabel.MediaMessageSending",I):v.getString("AccessibilityLabel.MediaMessage",I);break;case m.MessageAccessibilityType.Call:M=v.getString("AccessibilityLabel.CallMessage",I);break;default:M=n?v.getString("AccessibilityLabel.FailedTextMessage",{messageContent:v.getString("AccessibilityLabel.TextMessage",I)}):d&&w.default.shouldAnnounceForAccessibility()?v.getString("AccessibilityLabel.TextMessageSending",{messageContent:v.getString("AccessibilityLabel.TextMessage",I)}):l.isThreadActivityType(s.messagetype)||s.isEmote()?v.getString("AccessibilityLabel.SystemMessage",I):s.isEdited()?v.getString("AccessibilityLabel.EditedTextMessage",I):s.messagetype===l.MessageTypes.CallerID?o:v.getString("AccessibilityLabel.TextMessage",I)}if(f&&(M=v.getString("AccessibilityLabel.BookmarkedMessage",{messageContent:M})),!t.includeReactionInformationInAccessibilityLabel)return M;const k=s.getReactions();return M+i.map(k,(e=>E(t.message.conversationId,e))).join("")},t.getAccessibilityLabelForReaction=E,t.toAccessibilityTraits=function(e){}},81725:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toForwardContactInfo=t.toForwardMediaInfo=t.toForwardLocationInfo=t.toForwardUrlInfo=t.toForwardQuoteMessageEntities=t.ContentToForwardMessageTransformer=void 0;const i=s(96486),o=s(65976),n=s(81169),r=s(51077),a=s(71830),l=s(17677),d=s(81959),c=s(86374),h=s(52262),u=s(46096),p=s(97174),g=s(36237),m=s(51176),S=s(12762),f=s(27683),y=s(78262),_=s(10609),v=s(53374);t.ContentToForwardMessageTransformer=class{constructor(){this.transformRootNode=this._default,this.transformHighlightedNode=this._default,this.transformEditMessageMetaDataNode=this._default,this.transformUserMriNode=this._default,this.transformEmoticonNode=this._toUnhandledEntity,this.transformFlagNode=this._toUnhandledEntity,this.transformLegacyQuoteNode=this._default,this.transformAtMentionNode=this._default,this.transformEmoteNode=this._toUnhandledEntity,this.transformSuggestedTextHighlightNode=this._toUnhandledEntity,this.transformContextNode=this._toUnhandledEntity,this.transformUnknownNode=this._default,this.transformSwiftNode=this._default,this.transformPollNode=this._default,this.transformCallerIDNode=this._default,this.transformHtmlNode=this._default}_default(e){return(0,n.chain)(e.children,(0,n.map)((e=>e&&e.accept(this))),(0,n.compact)(),(0,n.flatten)())}_toUnhandledEntity(e,t){return i.isString(t)||(t=d.renderText(e)),[new p.UnhandledEntity(t)]}transform(e){return e.accept(this)}transformPlainTextNode(e){return this._toUnhandledEntity(e,e.getRawText())}transformUnicodeEmojiNode(e){return this.transformPlainTextNode(e.emojiTextNode)}transformQuoteNode(e){return[new p.QuoteEntity(e)]}transformWikiMarkupNode(e){const t=this._default(e),s=v.default.unescapeXml(e.rawPre),i=e.rawPost&&v.default.unescapeXml(e.rawPost);return[new p.WikiMarkupEntity(t,e.getTag(),s,i)]}transformLinkNode(e){const t=d.renderText(e);return[new p.LinkEntity(t,e.getSanitizedHref())]}},t.toForwardQuoteMessageEntities=function(e){const t=h.default.getDisplayName(e.creator,!0),s=l.quoteMessage(e,t);return new p.QuoteEntity(s,t,e)},t.toForwardUrlInfo=function(e){const t=c.decode(e),s=_.getUrlPreviewInformationForMessage(e,t);if(_.hasOnlyWebLink(s,t)&&s[0].isValid)return s[0]},t.toForwardLocationInfo=function(e){const t=c.decode(e),s=i.find(t.children,(e=>e instanceof S.LocationNode));if(s&&s.latitude&&s.longitude){let t;t=m.default.getImageUriForLocation(s.latitude,s.longitude,e.cuid);return{snapshotUri:t,topAddress:s.addressFriendlyNameSanitized,bottomAddress:s.shortAddressSanitized}}},t.toForwardMediaInfo=function(e){const t=c.decode(e).getFirstUriObjectChild(S.UriObjectFileNode);let s,i;if(t)switch(t.getFileType()){case y.UploadFileType.Picture:case y.UploadFileType.VideoMessage:case y.UploadFileType.Video:t instanceof S.DisplayableMediaWithThumbnail&&(i=t.getDisplayThumbnailUrlSanitized());break;case y.UploadFileType.AudioMessage:t instanceof S.AudioMessageNode&&(s=t.getAudioDurationMs())}const n=r.getMessageTypeGroup(e);if(!t||!t.getFileContentUrlSanitized)return void g.error(u.LogTraceArea.GenericUnsafe,"No url available for this media type message:",n,"most likely an issue from the sender");const a=t.getFileContentUrlSanitized(),l=a&&o.getDocumentId(a);if(!l)return void g.error(u.LogTraceArea.GenericUnsafe,"Invalid media entity document id being forwarded.");const d=t.getOriginalDimensions(),h=d&&d.height&&d.width?d:void 0;return{objectId:l,fileType:t.getFileType(),filename:t.getNameForUI(),dimensions:h,fileSize:t.getSizeInBytes(),localMediaThumbnailUri:i,durationMs:s}},t.toForwardContactInfo=function(e){const t=c.decode(e).getFirstContactNode();if(!t)return;let s;if(t.isPstn&&t.skypeId&&""!==t.skypeId){let e={number:f.default.normalizePartialNumberWithCountryCode(t.skypeId),type:y.PhoneNumberTypes.Other};s=a.getMriFromPhoneNumber(e)}else s=a.skypeIdToMri(t.skypeId);return{skypeId:t.skypeId||"",fullName:t.fullName||"",isPstn:t.isPstn,isS4B:t.isS4B,userMri:s}}},51577:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getCacheKeyFullResOrDisplayable=t.getLocalDisplayableOrFullResUri=t.isDisplayableOrFullResImageCached=void 0;const i=s(89391),o=s(65976),n=s(7234);t.isDisplayableOrFullResImageCached=function(e){return i.default.getS4LMessagingFeaturesNoSubscription().enableFullResolutionImageDownload?n.default.isKnown(o.getFileCacheKeyMedia(e,!1))||n.default.isKnown(o.getFileCacheKeyMedia(e,!0)):n.default.isKnown(o.getFileCacheKeyMedia(e,!1))},t.getLocalDisplayableOrFullResUri=function(e,t=!1){return i.default.getS4LMessagingFeaturesNoSubscription().enableFullResolutionImageDownload?n.default.getLocalUri(o.getFileCacheKeyMedia(e,t))||n.default.getLocalUri(o.getFileCacheKeyMedia(e,!t)):n.default.getLocalUri(o.getFileCacheKeyMedia(e,!1))},t.getCacheKeyFullResOrDisplayable=function(e){return i.default.getS4LMessagingFeaturesNoSubscription().enableFullResolutionImageDownload&&n.default.isKnown(o.getFileCacheKeyMedia(e,!0))?o.getFileCacheKeyMedia(e,!0):o.getFileCacheKeyMedia(e,!1)}},41190:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.attemptTokenRefresh=void 0;const i=s(97691),o=s(72918),n=s(65976),r=s(46096),a=s(36237),l=s(14976),d=s(34907);let c,h;t.attemptTokenRefresh=function(e){return n.isStaticAsyncMediaUrl(e)?(a.log(r.LogTraceArea.GenericUnsafe,"Static file did not load, we try to refresh CDN token and try again",l.dev_unknownOmit(e)),h||(h=i.Defer(),c||(c=d.default.refreshed.subscribe((()=>{const e=h;e&&(h=void 0,e.resolve(void 0))}))),d.default.requestDebouncedCdnTokenRefresh()),h.promise()):n.isAsyncMediaUrl(e)?(a.log(r.LogTraceArea.GenericUnsafe,"AMS file did not load, we try to set auth cookie and try again",l.dev_unknownOmit(e)),o.default.setAuthCookieDebounced()):i.Rejected(void 0)}},20948:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.postAudio=void 0;const i=s(97691),o=s(90247),n=s(46096),r=s(12056),a=s(85207);function l(e,t){const s={name:t},i=o.default.getRecordingResult();a.default.postUpload([e],i.data,n.PostSource.AudioMessageComposer,!0,{scenarioInfo:s},void 0,{messageDurationMs:i.durationMs,contentType:r.MessageComposerSentContentType.Audio})}t.postAudio=function(e,t){if(o.default.getRecordingState()===o.RecordingState.HasAudio)return l(e,t),i.Resolved();const s=i.Defer(),n=o.default.subscribe((()=>{switch(o.default.getRecordingState()){case o.RecordingState.None:o.default.unsubscribe(n),s.reject();break;case o.RecordingState.HasAudio:o.default.unsubscribe(n),l(e,t),s.resolve(void 0)}}));return s.promise()}},43632:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getAvatarColorsFromMri=t.defaultAvatarColors=t.getLocalizedColorName=t.getInputEntityUrl=t.canGenerateAvatars=void 0;const i=s(32183),o=s(97174),n=s(33754),r=s(26424),a=s(35455),l=s(81760);t.canGenerateAvatars=function(){return!!HTMLCanvasElement.prototype.toBlob},t.getInputEntityUrl=function(e,t=r.EmoticonSize.ExtraExtraLarge,s=a.StickerSize.ThumbLarge){return e instanceof o.EmoticonEntity?(0,i.getEmoticonUrl)(e.emoticonName,t,!0,e.tone):e instanceof o.StickerEntity&&(0,a.getStickerUrl)(e.uri,s,!1,!0)||""},t.getLocalizedColorName=function(e){switch(e){case"White":return n.getString("Color.White");case"Red":return n.getString("Color.Red");case"Orange":return n.getString("Color.Orange");case"Yellow":return n.getString("Color.Yellow");case"Yellowgreen":return n.getString("Color.Yellowgreen");case"Green":return n.getString("Color.Green");case"Bluegreen":return n.getString("Color.Bluegreen");case"Blue":return n.getString("Color.Blue");case"Blueviolet":return n.getString("Color.Blueviolet");case"Violet":return n.getString("Color.Violet");case"Redviolet":return n.getString("Color.Redviolet")}return""},t.defaultAvatarColors=[{key:"Red",textColor:l.Color.avatarRed,background:[l.Color.avatarRedLighter,l.Color.avatarRedLight]},{key:"Orange",textColor:l.Color.avatarOrange,background:[l.Color.avatarOrangeLighter,l.Color.avatarOrangeLight]},{key:"brown",textColor:l.Color.avatarBrown,background:[l.Color.avatarBrownLighter,l.Color.avatarBrownLight]},{key:"Olive",textColor:l.Color.avatarOlive,background:[l.Color.avatarOliveLighter,l.Color.avatarOliveLight]},{key:"Green",textColor:l.Color.avatarGreen,background:[l.Color.avatarGreenLighter,l.Color.avatarGreenLight]},{key:"Teal",textColor:l.Color.avatarTeal,background:[l.Color.avatarTealLighter,l.Color.avatarTealLight]},{key:"Cyan",textColor:l.Color.avatarCyan,background:[l.Color.avatarCyanLighter,l.Color.avatarCyanLight]},{key:"Blue",textColor:l.Color.avatarBlue,background:[l.Color.avatarBlueLighter,l.Color.avatarBlueLight]},{key:"Blueviolet",textColor:l.Color.avatarBlueviolet,background:[l.Color.avatarBluevioletLighter,l.Color.avatarBlueLight]},{key:"purple",textColor:l.Color.avatarPurple,background:[l.Color.avatarPurpleLighter,l.Color.avatarPurpleLight]},{key:"Fuchsia",textColor:l.Color.avatarFuchsia,background:[l.Color.avatarFuchsiaLighter,l.Color.avatarFuchsiaLight]},{key:"Violet",textColor:l.Color.avatarViolet,background:[l.Color.avatarVioletLighter,l.Color.avatarVioletLight]}],t.getAvatarColorsFromMri=function(e){const s=e.includes("@")?e.indexOf("@"):e.length,i=e.substring(s-3,s);let o=0;for(let e of i)o+=e.charCodeAt(0);return t.defaultAvatarColors[o%t.defaultAvatarColors.length]}},87430:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSourceMessageDate=t.bookmarkMessageAction=void 0;const i=s(96486),o=s(97691),n=s(29815),r=s(51077),a=s(36237),l=s(33754),d=s(12056),c=s(86045),h=s(22538);t.bookmarkMessageAction=function(e,t,s){return h.EnsureStarted(n.default).then((()=>o.all(i.map(e,(e=>{const s=e.message,i=s.isBookmarkSourceForCurrentUser();if(s.isBookmark()||i){let e=s.createdTime;if(i){const t=s.getBookmarkSourceMetadataForCurrentUser();t&&t.id&&(e=Number(t.id))}return n.default.deleteBookmark(s).then((()=>{c.default.maybeAnnounceForAccessibility(l.getString("StreamItem.RemoveBookmarkConfirmation")),a.track(new d.MessageActionTelemetry(s.conversationId,s,e,t,d.MessageActionType.RemoveBookmark))}))}return n.default.bookmarkMessage(s,e.forwardAlbumId).then((()=>{a.track(new d.MessageActionTelemetry(s.conversationId,s,s.createdTime,t,d.MessageActionType.AddBookmark))}))}))))).then((()=>{s&&s()}))},t.getSourceMessageDate=function(e){const t=r.getBookmarkMetadata(e);return t?t.bookmarkSourceComposeTime:void 0}},93733:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContactMessageRenderingOptions=t.SwiftMessageRenderingOptions=t.PollRenderingOptions=t.ScheduledCallRenderingOptions=t.CallInfoRenderingOptions=t.FileMessageRenderingOptions=t.LocationRenderingOptions=void 0;const i=s(96486),o=s(16778),n=s(64097),r=s(65127),a=s(51077),l=s(71830),d=s(28229),c=s(13991),h=s(70891),u=s(15877),p=s(12762),g=s(63032),m=s(750),S=s(32293),f=(0,u.lazyProperties)({radius:()=>(0,u.lazyProperties)({swiftCarousel:()=>o.Styles.createViewStyle({borderRadius:0})}),containerPadding:()=>(0,u.lazyProperties)({cardWithSender:()=>o.Styles.createViewStyle({paddingTop:10})})});class y extends d.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){const t={renderMessageBackground:!this._messageProperties.isLocationCardOnDesktopEnabled,showTouchFeedbackOnPress:!0,showLocationCard:this._messageProperties.isLocationCardOnDesktopEnabled,showOuterButtons:this._outerButtonsFit,accessibilityLabelType:h.MessageAccessibilityType.Media};return i.assign({},e,t)}getMessageActions(e){const t=this._outerButtonsFit,s=!this._outerButtonsFit,i=this._defaultSupportsAddReactionsInActionMenu||this._defaultSupportsPostingReactions&&s;return{actionMenuCommands:this.getActionMenuCommands({supportsPostingReactions:i,supportsForward:this._supportsForward,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,supportsRemove:this._defaultSupportsRemove,supportsQuotes:!0,copyCommand:this._defaultSupportsCopy?m.CommandTypes.CopyLocation:void 0,supportsBookmarks:this._defaultSupportsBookmark}),outerButtonCommands:t?this.getActionsForButtonsToBeRenderedInMessageView(this._supportsForward,this._defaultSupportsAddReactionInMessageView,!0).concat(e.outerButtonCommands):[]}}}t.LocationRenderingOptions=y,y.messageTypeGroup=a.MessageTypeGroups.Location;class _ extends d.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){const t={renderMessageBackground:!1,showOuterButtons:this._outerButtonsFit,accessibilityLabelType:h.MessageAccessibilityType.Media,availableSpace:this._messageProperties.containerMaxDimensions,calcRenderDim:c.getFileNodeRenderDimensions,isDraggingEnabled:this._defaultSupportsDragging,sendingStatus:r.getOverriddenFileSendingStatus(e.sendingStatus)};return i.assign({},e,t)}getMessageActions(e){const t=l.isEncryptedThread(this._messageProperties.skypeMessage.conversationId),s=r.isFileAvailable(this._messageProperties.skypeMessage.createdTime),i=this._supportsForward&&!t&&s,o=this._defaultSupportsAddReactionsInActionMenu||this._defaultSupportsPostingReactions&&!this._outerButtonsFit;let n=this.getActionMenuCommands({supportsPostingReactions:o,supportsForward:i,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,supportsRemove:this._defaultSupportsRemove,saveAsCommand:undefined,openFileLocationCommand:r.canOpenFileLocation(this._messageProperties.decodedNode)?m.CommandTypes.OpenFileLocation:void 0,supportsBookmarks:this._defaultSupportsBookmark});n=n.concat(e.actionMenuCommands);return{actionMenuCommands:n,outerButtonCommands:this._outerButtonsFit?this.getActionsForButtonsToBeRenderedInMessageView(i,this._defaultSupportsAddReactionInMessageView,!0).concat(e.outerButtonCommands):[]}}}t.FileMessageRenderingOptions=_,_.messageTypeGroup=a.MessageTypeGroups.UriFile;class v extends d.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){let t={renderMessageBackground:!1,showReactionsOnMessage:!1,showMessageSender:!1,showMessageSenderIcon:!1,showMessageTimestamp:!1,sendingStatus:e.sendingStatus===g.MessageRenderSendingStatus.Sending?g.MessageRenderSendingStatus.None:e.sendingStatus,removeMessageSpacer:!0,messageContentExpandedToAvailableArea:!0,accessibilityLabelType:h.MessageAccessibilityType.Call};return i.assign({},e,t)}getMessageActions(e){let t=this.getActionMenuCommands({supportsPostingReactions:!1,supportsBookmarks:!1});t=t.concat(e.actionMenuCommands);return{actionMenuCommands:t,outerButtonCommands:this._outerButtonsFit?this.getActionsForButtonsToBeRenderedInMessageView(!1,!1,!1).concat(e.outerButtonCommands):e.outerButtonCommands}}}t.CallInfoRenderingOptions=v,v.messageTypeGroup=a.MessageTypeGroups.Calling;class C extends d.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){const t={renderMessageBackground:!1,showReactionsOnMessage:!1,sendingStatus:e.sendingStatus===g.MessageRenderSendingStatus.Sending?g.MessageRenderSendingStatus.None:e.sendingStatus,accessibilityLabelType:h.MessageAccessibilityType.Media,includeAccessibilityPropertiesOnMessageHeader:!0},s=this._messageProperties.decodedNode.getFirstUriObjectChild(p.ScheduledCallInviteNode);return s&&!i.isUndefined(s.canceledTimeMs)&&(t.showMessageSender=!1,t.showMessageTimestamp=!1,t.showMessageSenderIcon=!1,t.showStreamItemAccessory=!1),i.assign({},e,t)}getMessageActions(e){let t=this.getActionMenuCommands({supportsRemove:!1,supportsCancelScheduledCall:this._messageProperties.postedByCurrentUser,supportsEditScheduledCall:!0,supportsBookmarks:!1});return t=t.concat(e.actionMenuCommands),{actionMenuCommands:t,outerButtonCommands:e.outerButtonCommands}}}t.ScheduledCallRenderingOptions=C,C.messageTypeGroup=a.MessageTypeGroups.ScheduledCallInvite;class b extends d.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){const t={renderMessageBackground:!1,showReactionsOnMessage:!1,sendingStatus:e.sendingStatus===g.MessageRenderSendingStatus.Sending?g.MessageRenderSendingStatus.None:e.sendingStatus,accessibilityLabelType:h.MessageAccessibilityType.Media,messageContainerStyle:f.containerPadding.cardWithSender,includeAccessibilityPropertiesOnMessageHeader:!0};return this._messageProperties.decodedNode.getFirstUriObjectChild(p.PollNode)&&(t.showStreamItemAccessory=!0),i.assign({},e,t)}getMessageActions(e){let t=this.getActionMenuCommands({supportsRemove:!1,supportsCancelPoll:this._defaultSupportsRemove,supportsBookmarks:!1});return t=t.concat(e.actionMenuCommands),{actionMenuCommands:t,outerButtonCommands:e.outerButtonCommands}}}t.PollRenderingOptions=b,b.messageTypeGroup=a.MessageTypeGroups.Poll;class T extends d.DefaultMessageRenderingOptions{constructor(e){super(e),this.messageProperties=e,this._isAdaptiveNodeCard=n.default.isAdaptiveCard(this._messageProperties.decodedNode),this._isAdaptiveNodeCarousel=n.default.isAdaptiveCardCarousel(this._messageProperties.decodedNode),this._isSwiftNodeCard=S.default.isSwiftCard(this._messageProperties.decodedNode),this._isSwiftNodeCarousel=S.default.isSwiftCarousel(this._messageProperties.decodedNode),this._showOuterButtons=!this._isSwiftNodeText&&!this._isSwiftNodeCarousel,this._isSwiftNodeText=S.default.isNodeTextMessage(this._messageProperties.decodedNode)&&!this._isSwiftNodeCarousel,this._swiftCardAttribution=S.default.getSwiftCardAttribution(this.messageProperties.decodedNode)}getMessageSpecificViewRenderingOptions(e){let t;return t=this._isAdaptiveNodeCard?{renderMessageBackground:!1,messageContentExpandedToAvailableArea:this._isAdaptiveNodeCarousel,showOuterButtons:!this._isAdaptiveNodeCarousel&&this._outerButtonsFit,showReactionButtonInsideMessageView:!this._showOuterButtons&&this._defaultSupportsAddReactionInMessageView,removeMessageSpacer:!0,includeAccessibilityPropertiesOnMessageHeader:!0,messageContainerStyle:f.containerPadding.cardWithSender,messageContainerRadiusStyle:this._isAdaptiveNodeCarousel?[f.radius.swiftCarousel]:void 0,contentScrollEnabled:this._isAdaptiveNodeCarousel}:{renderMessageBackground:this._isSwiftNodeText,messageContentExpandedToAvailableArea:this._isSwiftNodeCarousel,showOuterButtons:this._showOuterButtons&&this._outerButtonsFit,showReactionButtonInsideMessageView:!this._showOuterButtons&&this._defaultSupportsAddReactionInMessageView,removeMessageSpacer:this._isSwiftNodeCard||this._isSwiftNodeCarousel,messageContainerRadiusStyle:this._isSwiftNodeCarousel?[f.radius.swiftCarousel]:e.messageContainerRadiusStyle,includeAccessibilityPropertiesOnMessageHeader:this._isSwiftNodeCard||this._isSwiftNodeCarousel,messageContainerStyle:this._isSwiftNodeText?void 0:f.containerPadding.cardWithSender,contentScrollEnabled:this._isSwiftNodeCarousel,swiftCardAttribution:this._swiftCardAttribution,shouldAnimateEmoticons:!0,availableSpace:this._messageProperties.containerMaxDimensions},i.assign({},e,t)}getMessageActions(e){const t=this._supportsForward&&S.default.isShareable(this._messageProperties.decodedNode),s=this._defaultSupportsAddReactionsInActionMenu||this._defaultSupportsPostingReactions&&this._showOuterButtons&&!this._outerButtonsFit,i=this._isSwiftNodeText&&this._defaultSupportsCopy?m.CommandTypes.Copy:void 0;let o=this.getActionMenuCommands({supportsPostingReactions:s,supportsForward:t,supportsRemove:this._defaultSupportsRemove,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,copyCommand:i,supportsViewLink:!1,supportsBookmarks:this._defaultSupportsBookmark});o=o.concat(e.actionMenuCommands);return{actionMenuCommands:o,outerButtonCommands:this._outerButtonsFit&&this._showOuterButtons?this.getActionsForButtonsToBeRenderedInMessageView(t,this._defaultSupportsAddReactionInMessageView,!1).concat(e.outerButtonCommands):e.outerButtonCommands}}}t.SwiftMessageRenderingOptions=T,T.messageTypeGroup=a.MessageTypeGroups.SwiftCard;class M extends d.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){const t={renderMessageBackground:!1,showOuterButtons:this._outerButtonsFit,accessibilityLabelType:h.MessageAccessibilityType.Media,availableSpace:this._messageProperties.containerMaxDimensions,calcRenderDim:c.getContactNodeRenderDimensions};return i.assign({},e,t)}getMessageActions(e){const t=this._supportsForward,s=this._defaultSupportsAddReactionsInActionMenu||this._defaultSupportsPostingReactions&&!this._outerButtonsFit;let i=this.getActionMenuCommands({supportsPostingReactions:s,supportsForward:t,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,supportsRemove:this._defaultSupportsRemove,supportsBookmarks:this._defaultSupportsBookmark});i=i.concat(e.actionMenuCommands);return{actionMenuCommands:i,outerButtonCommands:this._outerButtonsFit?this.getActionsForButtonsToBeRenderedInMessageView(t,this._defaultSupportsAddReactionInMessageView,!1).concat(e.outerButtonCommands):[]}}}t.ContactMessageRenderingOptions=M,M.messageTypeGroup=a.MessageTypeGroups.Contact},65127:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getOverriddenFileSendingStatus=t.isFileAvailable=t.canOpenFileLocation=void 0;const i=s(89391),o=(s(25638),s(16402)),n=(s(73439),s(12762),s(63032));t.canOpenFileLocation=function(e){return!1},t.isFileAvailable=function(e){const t=i.default.getS4LCMCFeaturesNoSubscription().callRecorderRetentionDurationDays;return o.default.getDaysDifferenceToNow(e)<t},t.getOverriddenFileSendingStatus=function(e){return e===n.MessageRenderSendingStatus.Sending?n.MessageRenderSendingStatus.None:e}},71908:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addMemberToThread=t.deleteBookmark=t.deleteBookmarkSource=t.markMessageBookmarked=t.markMessageReported=t.markScheduledCallAsRead=t.respondToScheduledCallProp=t.toggleVoteInReactionsProp=t.toggleVoteInPollCustomProp=t.setVote=t.markReactionsAsRead=t.changeEmotionAnnotation=t.removeEmotionAnnotation=t.addEmotionAnnotation=t.uploadConversationIcon=t.markMessageUnreadFromGivenMessage=t.markMessageUnreadFromConversationLastMessage=t.markMessageUnread=t.markConversationRead=t.didUserSendSmsInLast30Days=t.getSkypeBotConversation=t.setUserComposingStateIfSupported=t.removeParticipantFromConversation=t.deleteConversationAsync=t.leaveConversationAsync=void 0;const i=s(96486),o=s(97691),n=s(19784),r=s(89391),a=s(20603),l=s(65976),d=s(22801),c=s(76621),h=s(51077),u=s(65369),p=s(61375),g=s(71830),m=s(62141),S=s(98278),f=s(21780),y=s(26459),_=s(91114),v=s(39549),C=s(46096),b=s(11375),T=s(36237),M=s(33754),I=s(18078),w=s(14976),P=s(4057),k=s(53374);function A(e){if(e.countsForUnreadCounts())return E(e),o.Resolved(!0);return m.default.getMessagesNotSentByMe(e.conversationId,e.createdTime,10,!0).then((t=>(function(e,t){const s=i.findIndex(e,(e=>e.countsForUnreadCounts()));if(s>=0&&e.length>s+1)return d.default.setConsumptionHorizonToMessage(t.conversationId,e[s+1],!0),!0;return!1}(t,e)||d.default.setFakeConsumptionHorizonBeforeFirstEverMessage(e.conversationId,e,!0),!0))).fail((t=>{T.warn(C.LogTraceArea.ConsumptionHorizon,"Could not mark message unread: "+w.mriOrId(e.conversationId)+" "+P.default.errorAsString(t))}))}function E(e){return m.default.getMessagesForConversationBeforeTime(e.conversationId,e.createdTime,1,!0).then((t=>t.length>0?(d.default.setConsumptionHorizonToMessage(t[0].conversationId,t[0],!0),t[0].createdTime):(d.default.setFakeConsumptionHorizonBeforeFirstEverMessage(e.conversationId,e,!0),e.createdTime))).fail((t=>{T.warn(C.LogTraceArea.ConsumptionHorizon,"Could not mark message unread: "+w.mriOrId(e.conversationId)+" "+P.default.errorAsString(t))}))}function R(e,t,s){const n=h.getEmotionMetadata(e.properties),r=I.default.getSkypeMri(),a=h.addEmotionMetadataForUser(i.cloneDeep(n),r,t,s);if(!a)return o.Rejected();const l=i.find(a,(e=>e.key===t));if(!l)return o.Rejected();if(!i.find(l.users,(e=>e.mri===r)))return o.Rejected();const c=JSON.stringify({key:t,value:s});return d.default.setMessageProperty(e,h.MessageProperties.Emotions,c,JSON.stringify(a))}function L(e,t){const s=h.getEmotionMetadata(e.properties),n=I.default.getSkypeMri();if(t===h.MessageAnnotations.Heart){i.some(s,(e=>e.key===h.MessageAnnotations.Like&&i.some(e.users,(e=>e.mri===n))))&&(t=h.MessageAnnotations.Like)}const r=h.removeEmotionMetadataForUser(i.cloneDeep(s),n,t);if(!r)return o.Rejected();const a=i.find(r,(e=>e.key===t));if(a){if(i.find(a.users,(e=>e.mri===n)))return o.Rejected()}const l=JSON.stringify({key:t});return d.default.setMessageProperty(e,h.MessageProperties.Emotions,l,JSON.stringify(r),!0)}function F(e,t,s){const n=h.getEmotionMetadata(e.properties),r=I.default.getSkypeMri(),a=i.find(n,(e=>e.key===s));if(a){if(i.find(a.users,(e=>e.mri===r)))return o.Rejected()}let l=h.removeEmotionMetadataForUser(i.cloneDeep(n),r,t);if(!l)return o.Rejected();if(l=h.addEmotionMetadataForUser(i.cloneDeep(l),r,s),!l)return o.Rejected();const u=JSON.stringify({key:t}),p=JSON.stringify({key:s}),g=e.getServerIdForPropertyChanges();if(!g)return o.Rejected();const m=h.MessageProperties.Emotions;return c.default.setMessagePropertyLie(e.conversationId,e.cuid,m,JSON.stringify(l)).then((()=>{d.default.serviceSetMessageProperty(e.conversationId,g,m,u,!0).catch((()=>{const t=JSON.stringify(l);c.default.revertMessagePropertyLie(e.conversationId,e.cuid,m,t)})),d.default.serviceSetMessageProperty(e.conversationId,g,m,p).catch((()=>{const t=JSON.stringify(l);c.default.revertMessagePropertyLie(e.conversationId,e.cuid,m,t)}))}))}function x(e,t,s){let i=h.getPollMetadata(e.properties);if(!i)return o.Rejected();const n=I.default.getSkypeMri();t&&(i=h.removeVoteForUser(i,n,t)),s&&(i=h.addOrUpdateVoteForUser(i,n,s));const r=JSON.stringify(i);return d.default.setMessageProperty(e,h.MessageProperties.PollData,r,r)}function O(e,t,s){return t&&s?F(e,t,s):t?L(e,t):s?R(e,s):o.Rejected()}function D(e,t,s){return h.getPollMetadata(e.properties)&&t!==s?O(e,t,s):o.Rejected()}t.leaveConversationAsync=function(e,t){const s=(0,v.default)().getConversation(e);let o=I.default.getSkypeMri();if(s){const e=i.find(s.getThreadMembers(),(e=>I.default.isMyMri(e.id)&&g.getMriNamespace(e.id)!==g.Namespaces.MSA));e&&(o=e.id)}return f.default.deleteMyConfiguredConnectors(e).always((()=>{d.default.serviceRemoveMemberFromThread(e,o,t).fail((e=>{T.error(C.LogTraceArea.ChatService,"Error leaving conversation: "+P.default.errorAsString(e)),n.default.showErrorAlert(M.getString("InfoPanel.LeaveFailed"),S.MainRootViewId)}))}))},t.deleteConversationAsync=function(e,t,s){return d.default.serviceDeleteConversation(e,t).then((()=>{T.track(new _.ConversationDeleted(e,t,s)),b.setFocus(b.FocusEvent.ConversationDeleted)})).fail((t=>{T.error(C.LogTraceArea.ChatService,"Error deleting conversation: "+P.default.errorAsString(t)),T.track(new _.ConversationDeletionFailed(e,t.statusCode)),n.default.showErrorAlert(M.getString("InfoPanel.DeleteConversationFailed"),S.MainRootViewId)}))},t.removeParticipantFromConversation=function(e,t,s){let i=o.Rejected();return t&&e?(0,v.default)().isConversationKnown(t)?i=g.isConnector(e)?f.default.deleteConnectorFromChatService(t,e):f.default.deleteConversationConfiguredConnectorsForUser(t,e).always((()=>d.default.serviceRemoveMemberFromThread(t,e,s))):T.error(C.LogTraceArea.ChatService,"We somehow don't know about the conversation..."):T.error(C.LogTraceArea.ChatService,"Could not remove user because conversation or user mri were not provided as a prop"),i},t.setUserComposingStateIfSupported=function(e,t){if(!g.isComposingStateSupported(t,e))return;if(d.default.errorHandler.get429Timer().getBackoffMinTime()>Date.now())return void T.error(C.LogTraceArea.ChatService,"set UserComposingState - ignoring when throttled by chat service");const s={messagetype:e?h.MessageTypes.Typing:h.MessageTypes.ClearTyping,contenttype:"Application/Message",composetime:(new Date).toISOString(),content:"",properties:{}};d.default.servicePostMessageToConversation(t,s,p.PostMessageToConversationSource.UserComposingState,u.CSRequestScenarios.userComposingState).then(i.noop).catch(i.noop)},t.getSkypeBotConversation=function(){const e=g.sanitizeMri(r.default.getConfigSettingsNoSubscription().feedbackBot.id,g.Namespaces.Bot);return c.default.getConversationMetaAsync(e).then((e=>e?e.conv:void 0))},t.didUserSendSmsInLast30Days=function(e){return m.default.getMessagesSentByMeSinceTime(e,Date.now()-2592e6,void 0,!1).then((e=>i.some(e,(e=>h.getMessageTypeGroup(e)===h.MessageTypeGroups.SMS))))},t.markConversationRead=function(e){T.log(C.LogTraceArea.ConsumptionHorizon,"Marking conversation read "+w.mriOrId(e)),m.default.getMessagesForConversationBeforeTime(e,Number.MAX_VALUE,50,!1).then((t=>{const s=i.find(t,(e=>!!e.getOriginalServerId()));if(s){d.default.setConsumptionHorizonToMessage(e,s,!1);const t=s.getConsumptionHorizonString();T.track(new _.ConversationMarkedRead(e,t))}else{const t=(0,v.default)().getConversation(e);if(t&&t.lastMessage)if(t.lastMessage.getOriginalServerId()){d.default.setConsumptionHorizonToMessage(e,t.lastMessage,!1);const s=t.lastMessage.getConsumptionHorizonString();T.track(new _.ConversationMarkedRead(e,s))}else T.warn(C.LogTraceArea.ConsumptionHorizon,"Could not mark conversation read, as last message does not have a CH timestamp "+w.mriOrId(e));else T.warn(C.LogTraceArea.ConsumptionHorizon,"Could not mark conversation read, no last message "+w.mriOrId(e))}}))},t.markMessageUnread=function(e){const t=y.default.getPreviousConsumptionHorizon(e);if(t)d.default.setConsumptionHorizon(e,t,!0),y.default.onMarkConversationUnread(e);else{const t=(0,v.default)(),s=t.getConversation(e),i=s&&s.lastMessage||t.getFakeLastMessageFallback(e);i&&A(i).then((t=>{t&&y.default.onMarkConversationUnread(e)}))}},t.markMessageUnreadFromConversationLastMessage=A,t.markMessageUnreadFromGivenMessage=E,t.uploadConversationIcon=function(e,t,s){const i=k.default.newGuid();return a.default.createDocumentGetIdAsync([e],t.file.name,s,void 0,i).then((o=>a.default.uploadDocumentAsync(o,s,t.file,void 0,i).then((()=>{const t=l.getDocumentUrls(o,s);return d.default.setThreadProperty(e,g.ThreadProps.Picture,"URL@"+t.original)}))))},t.addEmotionAnnotation=R,t.removeEmotionAnnotation=L,t.changeEmotionAnnotation=F,t.markReactionsAsRead=function(e){const t=Date.now(),s=i.filter(h.getEmotionMetadata(e.properties),(e=>e.key!==h.MessageAnnotations.ReactionsConsumptionHorizon));s.push({key:h.MessageAnnotations.ReactionsConsumptionHorizon,users:[{mri:e.creator,value:"",time:t}]});const o=JSON.stringify({key:h.MessageAnnotations.ReactionsConsumptionHorizon,value:"",time:t});return d.default.setMessageProperty(e,h.MessageProperties.Emotions,o,JSON.stringify(s))},t.setVote=function(e,t,s){return h.isPollUsingCustomProp(e.properties)?x(e,t,s):D(e,t,s)},t.toggleVoteInPollCustomProp=x,t.toggleVoteInReactionsProp=D,t.respondToScheduledCallProp=function(e,t,s){return h.getScheduledCallMetadata(e.properties)&&s!==t?O(e,s,t):o.Rejected()},t.markScheduledCallAsRead=function(e){const t=h.getScheduledCallInviteData(e.properties),s={consumptionHorizons:{[I.default.getSkypeMri()]:Date.now()}},o=i.merge({},t,s),n=JSON.stringify(o);return d.default.setMessageProperty(e,h.MessageProperties.ScheduledCallInviteData,n,n)},t.markMessageReported=function(e,t){c.default.markMessageAsReported(e.conversationId,e.cuid,t)},t.markMessageBookmarked=function(e,t){const s=I.default.getSkypeMri(),n=h.MessageAnnotations.Bookmark,r=h.getBookmarkSourceMetadata(e.properties),a=h.addOrUpdateBookmarkMetadataForUser(i.cloneDeep(r),s,t);if(!a)return T.error(C.LogTraceArea.Bookmarks,"Failed to update bookmark annotations metadata."),o.Rejected();const l=i.find(a,(e=>e.key===n));if(!l)return T.error(C.LogTraceArea.Bookmarks,"Failed to find bookmark message annotation."),o.Rejected();const c=i.find(l.users,(e=>e.mri===s));if(!c)return T.error(C.LogTraceArea.Bookmarks,"Failed to find bookmark message annotation for current user."),o.Rejected();const u=JSON.stringify({key:n,value:c.value});return d.default.setMessageProperty(e,h.MessageProperties.Poll,u,JSON.stringify(a))},t.deleteBookmarkSource=function(e){if(!e)return T.log(C.LogTraceArea.ChatService,"SkypeMessageLocal needs to be provided for deleting bookmark source."),o.Rejected();const t=h.getBookmarkSourceMetadata(e.properties),s=I.default.getSkypeMri(),n=h.MessageAnnotations.Bookmark,r=h.removeBookmarkMetadataForUser(i.cloneDeep(t),s),a=i.find(r,(e=>e.key===n));if(a){if(i.find(a.users,(e=>e.mri===s)))return o.Resolved()}const l=JSON.stringify({key:n});return d.default.setMessageProperty(e,h.MessageProperties.Poll,l,JSON.stringify(r),!0)},t.deleteBookmark=function(e){if(!e)return T.error(C.LogTraceArea.ChatService,"Bookmark message ID is required for delete operation."),o.Rejected();const t=g.BookmarksThreadId,{enableDirectBookmarkDelete:s}=r.default.getS4LMessagingFeatures();if(T.log(C.LogTraceArea.ChatService,`Deleting bookmark message. id:${e} isDirectDelete:${s}`),s)return d.default.serviceDeleteMessage(t,e).then(i.noop).catch((e=>{T.error(C.LogTraceArea.ChatService,`There was an error while removing bookmark message. Error: ${P.default.errorAsString(e)}`)}));{const s=h.MessageProperties.DeleteTime,i=Date.now();return d.default.serviceSetMessageProperty(t,e,s,i).catch((e=>{T.error(C.LogTraceArea.ChatService,`There was an error while removing bookmark message. Error: ${P.default.errorAsString(e)}`)}))}},t.addMemberToThread=function(e,t,s){return d.default.serviceAddMemberToThread(e,t,s,!1)}},87399:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isConversationObjectBlocked=t.isConversationBlocked=t.isConversationBlockedAsync=void 0;const i=s(97691),o=s(63413),n=s(71830),r=s(39549),a=s(22538);t.isConversationBlockedAsync=function(e){return i.all([(0,r.default)().getConversationPotentiallyBeforeStartupAsync(e),a.EnsureStarted(o.default)]).then((([e])=>(0,r.default)().isConversationBlocked(e)))},t.isConversationBlocked=function(e){if(n.isGroupConversation(e))return o.default.isMriBlocked(e);if(n.isThread(e)){const t=(0,r.default)().getConversation(e),s=t?t.getOtherPartyMri():void 0;return!!s&&o.default.isMriBlocked(s)}return o.default.isMriBlocked(e)},t.isConversationObjectBlocked=function(e){return(0,r.default)().isConversationBlocked(e)}},75049:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(98278),n=s(31751),r=s(39549),a=s(57102);t.default=class{static rootViewIdForConversationMri(e){if(!e)return o.MainRootViewId;const t=(0,r.default)().getConversation(e),s=n.default.getAllSiblingConversations(e),l=a.ConversationUtils.getOrderedConversationIds(s,t);return l.length?i.first(l):e}}},57102:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationUtils=void 0;const i=s(96486),o=s(16778),n=s(97691),r=s(89391),a=s(47447),l=s(81169),d=s(22801),c=s(76621),h=s(71908),u=s(61375),p=s(71830),g=s(62141),m=s(984),S=s(81627),f=s(85455),y=s(23353),_=s(24339),v=s(41706),C=s(25793),b=s(33754),T=s(18078),M=s(27683),I=s(11828),w=s(78262),P=s(26712),k=s(72758);class A{static getPotentialExistingConversations(e,t=!1){return e&&1===e.length&&c.default.getConversationMetaAsync(e[0]).then((e=>e?[e.conv]:[])),A.getRecentConversationMetas().then((s=>(0,l.chain)(s,(0,l.filter)((s=>{if(t&&s.conv.topicName())return!1;const o=s.conv.getMemberMris();return o.length-1===e.length&&i.intersection(o,e).length===e.length})),(0,l.map)((e=>e.conv)))))}static getRecentConversationMetas(){const e=Date.now()-f.ConversationHistoryTimeSpanImportant;if(c.default.getLastFetchedTimestamp()<e){const e=c.default.getRawConversationMetaMemoryCache(),t=i.values(e).filter((e=>e&&_.isConversationDisplayable(e.conv)&&!e.conv.isHighlightsThread()));return n.Resolved(t)}return g.default.getRecentNonHighlightConversationMetas(p.MinimumConversationsToTryToShow).then((e=>i.filter(e,(e=>_.isConversationDisplayable(e.conv)))))}static createConversation(e,t,s,o=!1,a=u.CreateThreadSource.CreateNewConversation,l={[p.ThreadProps.HistoryDisclosed]:"false",[p.ThreadProps.JoinEnabled]:"true"},h){let g,m=[];return o&&(l[p.ThreadProps.ModeratedThread]="true"),d.default.serviceCreateThread(e,s,a,l,h).then((e=>{g=e.threadId;const s=0===i.size(t)?n.Resolved([]):d.default.serviceAddMembersToThread(g,t,r.default.getS4LMessagingFeaturesNoSubscription().retryAddMembersToThread,{},h);return d.default.discloseHistory(e.threadId,!0),s.then((e=>(m=e,c.default.waitForJoinedKnowledgeOfConversation(g))))})).then((()=>({threadId:g,failedMembers:m})))}static setConversationProps(e,t,s){if(t&&d.default.setThemeColor(e,t),s)return h.uploadConversationIcon(e,s,w.UploadFileType.GroupAvatar)}static getTranslatedChatWithUser(e,t,s){return n.fromThenable(m.default.addContact(s,S.AddContactOrigin.AddTranslatorBot)).then((()=>{const o=[e,s];return A.getPotentialExistingConversations(o).then((e=>{const s=i.first(e);if(s)return n.Resolved({conversationId:s.id,isNewConversation:!1});{const e=T.default.getSkypeMri(),s={};s[e]=w.ThreadMemberAccessType.Admin;const r={};i.each(o,(e=>{r[e]=p.isPhoneMri(e)?w.ThreadMemberAccessType.User:w.ThreadMemberAccessType.Admin}));const a=k.default.getDisplayableUserByMri(e),l=a.getShortName(),d=a.getDisplayName(),c=b.getString("Translator.TranslatedGroupChatName",{user1:t,user2:l||d});return A.createConversation(s,r,c).then((e=>n.Resolved({conversationId:e.threadId,isNewConversation:!0})))}}))}))}static getConversationTypeForUI(e){return p.isEncryptedThread(e)?y.ConversationUIType.Private:p.isConversationWithPhoneNumber(e)?y.ConversationUIType.Phone:p.isOneOnOneConversation(e)?y.ConversationUIType.OneOnOneSkype:p.isGroupConversation(e)?y.ConversationUIType.Group:y.ConversationUIType.Other}static getConversationNameForTab(e,t="",s){switch(A.getConversationTypeForUI(e)){case y.ConversationUIType.Private:return b.getString("ContentPanelHeader.PrivateConversationTab");case y.ConversationUIType.Phone:const e=t.slice(-2);return s?b.getString("ContentPanelHeader.SMSConversationTabWithNumber",{digits:e}):b.getString("ContentPanelHeader.SMSConversationTab");case y.ConversationUIType.OneOnOneSkype:return b.getString("ContentPanelHeader.SkypeConversationTab");default:return b.getString("ContentPanelHeader.GenericConversationTab")}}static getConversationForGivenType(e,t){return i.find(e,(e=>this.getConversationTypeForUI(e.id)===t))}static getDeleteConfirmationTitle(e){if(e.length>1)return b.getString("InfoPanel.DeleteAll");const t=e[0];switch(A.getConversationTypeForUI(t)){case y.ConversationUIType.Private:return b.getString("InfoPanel.DeleteConfirmationDialogTitleE2EE");case y.ConversationUIType.Phone:return b.getString("InfoPanel.DeleteConfirmationDialogTitleSMS");case y.ConversationUIType.OneOnOneSkype:return b.getString("InfoPanel.DeleteConfirmationDialogTitleSkype");default:return b.getString("InfoPanel.ClearGroupConfirmationDialogTitle")}}static getConversationTitleForSelection(e){switch(A.getConversationTypeForUI(e.mri)){case y.ConversationUIType.Private:return b.getString("InfoPanel.PrivateChat");case y.ConversationUIType.Phone:const t=p.getPhoneNumberFromMri(e.otherPartyMri||e.mri),s=(t?M.default.parseAndFormat(t,M.PhoneNumberFormat.INTERNATIONAL)||t:void 0)||"";return b.getString("InfoPanel.SMSChat",{phoneNumber:s});default:return b.getString("InfoPanel.SkypeChat")}}static getIconForConversation(e){if(!e)return I.SkypeIcon.Message;switch(A.getConversationTypeForUI(e.id)){case y.ConversationUIType.Private:return I.SkypeIcon.Lock;case y.ConversationUIType.Phone:return I.SkypeIcon.MobileSmsNew;default:return I.SkypeIcon.Message}}static getIconForConversationMri(e){return p.isPhoneMri(e)?I.SkypeIcon.MobileSmsNew:p.isEncryptedThread(e)?I.SkypeIcon.Lock:I.SkypeIcon.Message}static isPSTNGroup(e){if(e){const t=e.getMemberMrisWithoutMe();return t.length>0&&i.every(t,(e=>p.isPhoneMri(e)))}return!1}static getOrderedConversations(e,t){let s=i.find(e,(e=>e.isOneOnOne()&&!e.isEncryptedThread()&&!e.isLogicalOneOnOneSmsConversation())),o=i.find(e,(e=>e.isEncryptedThread()&&v.default.shouldShowPrivateConv(e.id))),n=i.filter(e,(e=>e.isLogicalOneOnOneSmsConversation()));if(t){const e=t.isOneOnOne()&&!t.isEncryptedThread()&&!t.isLogicalOneOnOneSmsConversation();!s&&e?s=t:!o&&t.isEncryptedThread()?o=t:i.isEmpty(n)&&t.isLogicalOneOnOneSmsConversation()&&(n=[t])}return i.compact([s,o,...n])}static getOrderedConversationIds(e,t){return this.getOrderedConversations(e,t).map((e=>e.id))}static hasMultipleAudioCallOptions(e){if(p.isOneOnOneConversation(e)&&!p.isEncryptedThread(e)){const t=k.default.getDisplayableUserByMri(e);if(p.isPhoneMri(e)){if(t.phoneNumbers&&t.phoneNumbers.length>1)return!0}else{if(t.getHasPhoneNumbers())return!0;if(a.CallingCapabilities.encryptedCallingSupported()&&p.isSkypeIdMri(e)){const t=p.buildOneOnOneEncryptedThreadId(e);if(v.default.getHandshakeState(t)===C.SecureHandshakeState.Completed)return!0}}}return!1}static createNewGroupConversationFromOneOnOne(e,t){return A.getPotentialExistingConversations(e).then((t=>{const s=i.first(t);if(s)return n.Resolved(s.id);const o={};o[T.default.getSkypeMri()]=w.ThreadMemberAccessType.Admin;let r,a={};return i.each(e,(e=>{a[e]=p.isPhoneMri(e)?w.ThreadMemberAccessType.User:w.ThreadMemberAccessType.Admin})),A.createConversation(o,a,"",!1).then((e=>(r=e.threadId,A.setConversationProps(r,void 0,void 0)))).then((()=>n.Resolved(r)))}))}static openClearLeaveConversationLearnMore(){o.Linking.openUrl(P.default.appendLanguageUrlParameter(r.default.getConfigSettingsNoSubscription().chat.msgDeletionLearnMoreLink))}}t.ConversationUtils=A},24339:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getConversationAlwaysHiddenStatus=t.getConversationDisplayableStatus=t.isConversationDisplayable=void 0;const i=s(89391),o=s(63413),n=s(71830),r=s(18078),a=s(39549);let l={};function d(e){const t=c(e.id);if(t.hidden)return{isDisplayable:!1,debugReason:t.reason};if(e.isOneOnOne()){const t=e.getOtherPartyMri();if(!t)return{isDisplayable:!1,debugReason:"unknown other party"};if(o.default.isMriBlocked(t))return{isDisplayable:!1,debugReason:"contact blocked"};if(e.isEmptyConversation()&&!e.isThread())return{isDisplayable:!1,debugReason:"empty 1:1"};const s=i.default.getEngagementFeatures();if(n.isConciergeBotMri(e.id)&&!s.conciergeBotSettings.enableVisibility)return{isDisplayable:!1,debugReason:"hidden Skype Bot"}}else{if(e.isThread()&&e.getThreadProperty(n.ThreadProps.ThreadType)===n.ThreadTypes.Reactions)return{isDisplayable:!1,debugReason:"reactions thread"};if(o.default.isMriBlocked(e.id))return{isDisplayable:!1,debugReason:"chat blocked"};if(!e.isCurrentUserMember())return{isDisplayable:!1,debugReason:"not a member"}}return e.isDeleted()&&!(0,a.default)().isClearApplicableAndKeepInRecents(e.id)?{isDisplayable:!1,debugReason:"conversation deleted"}:{isDisplayable:!0,debugReason:""}}function c(e){const t=n.getMriNamespace(e);return l[t]?n.isHighlightsThread(e)?{hidden:!0,reason:"Highlights thread"}:n.isReactionsThread(e)?{hidden:!0,reason:"Call reactions (cast) thread"}:n.isOneToOneThread(e)?{hidden:!0,reason:"OneToOne thread"}:r.default.isMyMri(e)?{hidden:!0,reason:"Conversation with self"}:e===i.default.getConfigSettingsNoSubscription().cortana.mri?{hidden:!0,reason:"Cortana conversation"}:{hidden:!1,reason:""}:{hidden:!0,reason:"Not visible thread namespace "+t}}l[n.Namespaces.MSA]=!1,l[n.Namespaces.S4B_Bridge]=!0,l[n.Namespaces.PSTN]=!0,l[n.Namespaces.SkypeId]=!0,l[n.Namespaces.Thread]=!0,l[n.Namespaces.OneToOneTextMessage]=!1,l[n.Namespaces.GroupTextMessage]=!1,l[n.Namespaces.Bot]=!0,t.isConversationDisplayable=function(e){return d(e).isDisplayable},t.getConversationDisplayableStatus=d,t.getConversationAlwaysHiddenStatus=c},82261:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createDataMessage=t.createTranslationSettingsMessage=t.tests_createMessageFromContent=t.createSendCreditMessage=t.createForwardMessageInfo=t.createForwardSwiftMessageInfo=t.hasDoNotFormatPrefixOrIsDoNotFormatEntity=t.createSwiftResponseMessageInfo=t.createAdaptiveFakeMessage=t.createGuestNameUpdateMessage=t.createPollMessage=t.createScheduledCallInviteMessage=t.createSwiftFakeMessage=t.createMediaAlbumMessage=t.createFakeMediaDraftMessage=t.createFakeDraftMessage=t.createInviteFakeMessage=t.createScheduledCallFakeMessageInfo=t.createScheduledCallFakeMessage=t.createLinkFakeMessage=t.createP2PMessage=t.createEmoteMessageInfo=t.createCallerIdMessage=t.createCallMessageInfo=t.createDeleteMessageInfo=t.createEditMessageInfo=t.createForwardMessageInfoFromEntities=t.createMessageFromServerMessage=t.createMessageInfo=t.createMessageInfoFromEscapedText=void 0;const i=s(96486),o=s(97691),n=s(66900),r=s(1706),a=s(89391),l=s(98925),d=s(51077),c=s(71830),h=s(98278),u=s(33372),p=s(86374),g=s(52262),m=s(46096),S=s(84457),f=s(97174),y=s(23944),_=s(33754),v=s(12762),C=s(6509),b=s(65047),T=s(78735),M=s(18078),I=s(27357),w=s(76817),P=s(12692),k=s(4057),A=s(34329),E=s(78262),R=s(3109),L=s(26712),F=s(53374);function x(e,t,s,i=!1,o){const n=D(e);if(!n.length&&i)return H(e,t,s,d.MessageTypes.Text,void 0,void 0,void 0,void 0,void 0,void 0,void 0,o);const r=new f.UnhandledEntity(s);return n.unshift(r),U(e,t,n,d.MessageTypes.RichText)}function O(e,t,s,i=d.MessageTypes.RichText,o,n,r){return U(e,t,D(e,s),i,void 0,void 0,void 0,void 0,o,n,r)}function D(e,t=[]){const s=[];if(e===c.sanitizeMri(a.default.getConfigSettingsNoSubscription().feedbackBot.id,c.Namespaces.Bot)&&!i.some(t,(e=>e instanceof f.ContextEntity))){let e={};e={ClientLanguage:_.getLocale()};const t=S.default.getCurrentSessionId();t&&(e.feedbackId=t),s.push(new f.ContextEntity(e))}return t.concat(s)}function B(e,t,s,i=e.messagetype){return U(e.conversationId,t,s,i,e,e.skypeemoteoffset)}function V(e,t,s,i){return U(e,t,s,d.MessageTypes.RichText,void 0,i)}function N(e){return C.splitWikiMarkupPrefix(e,!1,!1).prefix===C.WikiPrefix.DoNotFormat||1===e.length&&e[0]instanceof f.DoNotFormatEntity}function U(e,t,s,o,n,r,l,u,p,g,m){const S=i.some(s,(e=>e instanceof f.AtMentionEntity));let _,v=o;if(n&&(o===d.MessageTypes.Text||o===d.MessageTypes.RichText)){const e=n.getOriginalServerMessage(),t=e&&new Date(e.originalarrivaltime).getTime()||n.createdTime;i.remove(s,(e=>e instanceof f.EditMessageMetaDataEntity));const o=new f.EditMessageMetaDataEntity(M.default.getSkypeId(),t);s.push(o),v=d.MessageTypes.RichText}const C=a.default.getS4LMessagingFeatures().enableDoNotFormat,b=T.default.getValueOfDoNotFormatPreferenceOrFalseIfDisabled(e),w=c.isPhoneMri(e),P=b||w,k=C&&(b||N(s)&&!w);if(_=v===d.MessageTypes.Text&&i.every(s,(e=>e instanceof f.UnhandledEntity))?i.map(s,(e=>e.text())).join(""):y.encode(s,!!g,P),k){let e={};e[d.MessageProperties.DoNotFormat]=JSON.stringify(k),p=i.merge(p,e)}return{conversationId:e,postSource:t,conversationOrigin:I.default.dangerouslyGetActiveConversationContextOrigin(h.MainRootViewId),messageForPosting:z(_,S,v,n?n.getOriginalClientMessageId():void 0,r,e,l,p,m),inputEntities:s,isForward:u,editedMessageCuid:n?n.cuid:void 0,previousMessageBeingEditedProperties:n?n.properties:void 0,editedMessageTimestamp:n?n.createdTime:void 0,editedMessageServerId:n?n.getOriginalServerId():void 0,editedMessageVersion:n?n.getLatestServerMessageVersion():void 0}}function H(e,t,s,o,n,r,a,l,c,u,p,g){let m={};p&&(m[d.MessageProperties.AlbumId]=p),g&&(m=i.merge(g,m));const S=d.hasAtMention(s);return{conversationId:e,postSource:t,conversationOrigin:I.default.dangerouslyGetActiveConversationContextOrigin(h.MainRootViewId),messageForPosting:z(s,S,o,n?n.getOriginalClientMessageId():void 0,r,e,a,m),editedMessageCuid:n?n.cuid:void 0,previousMessageBeingEditedProperties:n?n.properties:void 0,editedMessageTimestamp:n?n.createdTime:void 0,isForward:l,forwardMediaInfos:c,swiftMessageDecoded:u,editedMessageServerId:n?n.getOriginalServerId():void 0,editedMessageVersion:n?n.getLatestServerMessageVersion():void 0}}function z(e,t,s,i,o,n,r,a,l){let h;h=l||F.default.newClientMessageId();const u=Date.now(),p=new Date(u).toISOString();let m;n&&c.isOneOnOneConversation(n)&&!c.isAgent(n)&&(m=g.default.getDisplayName(n));return{clientmessageid:h,composetime:p,content:e,messagetype:s,contenttype:d.ContentTypes.Text,imdisplayname:g.default.getDisplayName(M.default.getSkypeMri()),receiverdisplayname:m,"Has-Mentions":t?"true":void 0,skypeemoteoffset:o?o.toString():void 0,skypeeditedid:i||void 0,skypeguid:r||void 0,properties:a||void 0,from:void 0,fromline:void 0}}t.createMessageInfoFromEscapedText=x,t.createMessageInfo=O,t.createMessageFromServerMessage=function(e,t,s,i,o){const n=z(s.content,!1,s.messagetype,void 0,void 0,e,void 0,i,o);return{conversationId:e,postSource:t,conversationOrigin:m.NavigationConversationOrigin.Unknown,messageForPosting:n}},t.createForwardMessageInfoFromEntities=function(e,t,s,i=d.MessageTypes.RichText,o){return U(e,t,D(e,s),i,void 0,void 0,void 0,!0,o)},t.createEditMessageInfo=B,t.createDeleteMessageInfo=function(e,t){const s=[];if(e.isEmote()){const t=e.content.substr(0,e.skypeemoteoffset);s.push(new f.UnhandledEntity(t))}return i.assign(B(e,t,s),{isDelete:!0})},t.createCallMessageInfo=function(e,t,s,i,o,n){return U(e,t,s,i,n,void 0,o)},t.createCallerIdMessage=function(e,t,s=m.PostSource.EphemeralMessage){return U(e,s,[new f.CallerIDEntity(t)],d.MessageTypes.CallerID)},t.createEmoteMessageInfo=V,t.createP2PMessage=function(e,t,s){const i=M.default.getSkypeMri();return o.all([g.default.getDisplayableNamePotentiallyBeforeStartupAsync(i),g.default.getDisplayableNamePotentiallyBeforeStartupAsync(s)]).then((([s,i])=>V(e,t,[new f.UnhandledEntity(_.getString("Notifications.P2PCallMessage",{callee:s,caller:i}))],s.length+1)))},t.createLinkFakeMessage=function(e,t,s,i,o){const n=x(e,t,s);return P.default.fromFirstLie(n.messageForPosting,n.conversationId,i,o,!0)},t.createScheduledCallFakeMessage=function(e,t,s){return P.default.fromFirstLie(e.messageForPosting,e.conversationId,t,s,!0)},t.createScheduledCallFakeMessageInfo=function(e,t,s,i){return U(e,s,[new f.UnhandledEntity(i)],t)},t.createInviteFakeMessage=function(e,t,s,i,o){const n=x(e,t,s||_.getString("ContactsStore.DefaultInviteMessage"));return P.default.fromFirstLie(n.messageForPosting,n.conversationId,i,o,!0)},t.createFakeDraftMessage=function(e,t){const s=[new f.UnhandledEntity(_.getString("MessageComposer.DraftDecorator")),...t.inputEntities],i=O(e,m.PostSource.MessageComposer,s);return P.default.fromFirstLie(i.messageForPosting,i.conversationId,M.default.getSkypeMri(),t.timestamp||Date.now(),!0)},t.createFakeMediaDraftMessage=function(e,t,s){const i=L.default.getFileUrl(t.data),o=[];o.push(new f.UnhandledEntity(_.getString("MessageComposer.DraftDecorator")+" ")),o.push(new f.MediaEntity(i,void 0,i,void 0,E.UploadFileType.File,_.getString("MessageComposer.MediaDraftLabel"),void 0,void 0,void 0,void 0));const n=O(e,m.PostSource.MessageComposer,o,d.MessageTypes.UriObject,void 0,void 0,void 0);return P.default.fromFirstLie(n.messageForPosting,n.conversationId,M.default.getSkypeMri(),s||Date.now(),!0)},t.createMediaAlbumMessage=function(e,t,s,o,n){let r={};return r[d.MessageProperties.AlbumId]=s,o&&(r=i.merge(o,r)),O(e,t,[new f.MediaAlbumEntity(s)],d.MessageTypes.MediaAlbum,r,void 0,n)},t.createSwiftFakeMessage=function(e,t,s){const i=A.getTestMessage(s);if(i){return U(e,t,[new f.SwiftUriObjectEntity(i,e,!0)],d.MessageTypes.Media_Card)}},t.createScheduledCallInviteMessage=function(e,t,s,o,n,r,a,l,h){if(r&&r[e]&&c.isThread(e))return;const u=new f.ScheduledCallInviteUriObjectEntity(s,o.toString(),n.toString(),l,i.isUndefined(h)?void 0:h.toString()),p={invitations:r,consumptionHorizons:a},g={};return g[d.MessageProperties.ScheduledCallInviteData]=JSON.stringify(p),U(e,t,[u],d.MessageTypes.ScheduledCallInvite,void 0,void 0,void 0,void 0,g)},t.createPollMessage=function(e,t,s,i,o,n){return U(e,t,[new f.PollInputEntity(s,o.toString(),i,n)],d.MessageTypes.Poll,void 0,void 0,void 0,void 0,{})},t.createGuestNameUpdateMessage=function(e,t,s,i){const o=[new v.TextWrapperNode(v.PlainTextNode.fromPlainText(i),v.TextWrapperNode.tags.Initiator),new v.TextWrapperNode(v.PlainTextNode.fromPlainText(Date.now().toString()),v.TextWrapperNode.tags.EventTime),new v.GuestUpdateTargetNode(t,s)],n=new f.GuestNameUpdateEntity(o);return U(e,m.PostSource.GuestNameUpdate,[n],d.MessageTypes.GuestNameUpdate,void 0,void 0,void 0,void 0,undefined)},t.createAdaptiveFakeMessage=function(e,t,s){const i=n.getTestMessage(s);if(i){return U(e,t,[new f.AdaptiveUriObjectEntity(i,e,!0)],d.MessageTypes.Media_Card)}},t.createSwiftResponseMessageInfo=function(e,t,s,o,n,a){let l;if(c.isThread(e)&&n&&c.isAgent(n)&&!a){const e=r.default.getAgentDescriptionForMri(n);l=new f.AtMentionEntity(e.getDisplayName(),e.getMri()),s=" "+s}let h=p.decodeFromContent(s);h=R.extraTextNodeParsing(h,!0,!0);const g=u.toEntities(h).concat(o);if(function(e,t){return i.some(e.children,(e=>e instanceof v.UnknownNode||e instanceof v.ContextNode))||i.some(t,(e=>e instanceof f.ContextEntity))}(h,g)){const s=l?y.encode([l],!0,!1):"",o=i.filter(g,(e=>e instanceof f.ContextEntity)),n=y.encode(D(e,o),!0,!1);i.remove(h.children,(e=>e instanceof v.ContextNode));return H(e,t,s+h.encodeToString()+n,d.MessageTypes.RichText)}return l&&g.unshift(l),O(e,t,g,d.MessageTypes.RichText)},t.hasDoNotFormatPrefixOrIsDoNotFormatEntity=N,t.createForwardSwiftMessageInfo=function(e,t,s,i=d.MessageTypes.RichText,o,n){return H(e,t,s,i,void 0,void 0,void 0,!0,n,o)},t.createForwardMessageInfo=function(e,t,s,i=d.MessageTypes.RichText,o,n,r){return H(e,t,s,i,void 0,void 0,void 0,!0,o,void 0,n,r)},t.createSendCreditMessage=function(e,t,s,i,o){const n=w.getSwiftMessage(s,i,o);return U(e,t,[new f.SwiftUriObjectEntity(n,e,!0,n.summary)],d.MessageTypes.Media_Card)},t.tests_createMessageFromContent=function(e,t,s,i,o,n,r,a,l,d,c){return H(e,t,s,i,o,n,r,a,l,d,void 0,c)},t.createTranslationSettingsMessage=function(e,t,s,i,o=!1,n=d.MessageTypes.TranslationSettings){const r={type:b.DataMessageContentType.TranslationSettings,data:{newTranslationState:l.TranslationState[i],messageTranslationLocale:s,isUpdate:o,isOldVersion:n===d.MessageTypes.Data}};return U(e,t,[n===d.MessageTypes.Data?new f.DataEntity(b.DataMessageContentType[b.DataMessageContentType.TranslationSettings],k.default.asString(r),[]):new f.TranslationSettingsEntity(b.DataMessageContentType[b.DataMessageContentType.TranslationSettings],k.default.asString(r),[])],n)},t.createDataMessage=function(e,t){return U(e,t,[new f.DataEntity(b.DataMessageContentType[b.DataMessageContentType.TwinCamSync],"{}",[])],d.MessageTypes.Data)}},28229:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnknownMessageTypeRenderingOptions=t.DefaultMessageRenderingOptions=void 0;const i=s(16778),o=s(89391),n=s(47447),r=s(51077),a=s(71830),l=s(70891),d=s(15877),c=s(63032),h=s(6658),u=s(686),p=s(18078),g=s(85207),m=s(750),S=s(40363),f=s(80837),y=(0,d.lazyProperties)({radius:()=>(0,d.lazyProperties)({containerStyle:()=>i.Styles.createViewStyle({borderTopLeftRadius:h.messageBorderRadius,borderTopRightRadius:h.messageBorderRadius,borderBottomRightRadius:h.messageBorderRadius,borderBottomLeftRadius:h.messageBorderRadius}),othersMessageStyle:()=>i.Styles.createViewStyle({borderTopLeftRadius:0}),currentUserMessage:()=>i.Styles.createViewStyle({borderBottomRightRadius:0}),othersMessageRTL:()=>i.Styles.createViewStyle({borderTopRightRadius:0}),currentUserMessageRTL:()=>i.Styles.createViewStyle({borderBottomLeftRadius:0})}),containerPadding:()=>(0,d.lazyProperties)({firstInGroup:()=>i.Styles.createViewStyle({paddingTop:10}),notFirstInGroup:()=>i.Styles.createViewStyle({paddingTop:1})})});class _{constructor(e){this._messageProperties=e,this._getDefaultRadiusStylesForMessage=()=>{const e=[y.radius.containerStyle];if(!this.renderedInCompositeGallery()){const t=S.default.isRTL();this._messageProperties.postedByCurrentUser&&!this._isBookmark&&!this.renderedInStackGallery()?e.push(t?y.radius.currentUserMessageRTL:y.radius.currentUserMessage):e.push(t?y.radius.othersMessageRTL:y.radius.othersMessageStyle)}return e};const t=a.isEncryptedThread(this._messageProperties.skypeMessage.conversationId);this._messagingFeatures=o.default.getS4LMessagingFeaturesNoSubscription(),this._outerButtonsFit=!!this._messageProperties.layoutWidth&&this._messageProperties.layoutWidth>355;const s=a.isS4BBridgeMri(this._messageProperties.skypeMessage.conversationId),i=o.default.getEngagementFeatures().conciergeBotSettings.enableMessageReactions&&a.isConciergeBotMri(this._messageProperties.skypeMessage.conversationId);this._defaultSupportsShowingReactionsSummary=!this._messageProperties.disableReactions&&!this._messageProperties.isReadOnly&&!t&&!this._messageProperties.isConversationBlocked&&(!this._messageProperties.postedByBot||i)&&!this._messageProperties.skypeMessage.isEmote()&&!s,this._defaultSupportsOverlayingReactionsSummary=!1,this._defaultSupportsPostingReactions=this._defaultSupportsShowingReactionsSummary&&!this._messageProperties.postedByCurrentUser,this._defaultSupportsAddReactionsInActionMenu=this._defaultSupportsPostingReactions&&!!this._messageProperties.screenReaderEnabled,this._defaultSupportsAddReactionInMessageView=this._defaultSupportsPostingReactions&&!this._messageProperties.screenReaderEnabled,this._isMessageSent=!this._messageProperties.skypeMessage.isSendRejected()&&!this._messageProperties.skypeMessage.isMessageLie()&&!this._messageProperties.skypeMessage.isEphemeral(),this._isBookmark=this._messageProperties.skypeMessage.isBookmark(),this._isBookmarkSource=this._messageProperties.skypeMessage.isBookmarkSourceForCurrentUser(),this._supportsForward=!this._messageProperties.disableForward&&this._isMessageSent&&!t,this._defaultSupportsEdit=!t&&!r.isHtmlMessageType(this._messageProperties.skypeMessage.messagetype),this._defaultSupportsSelectMultipleMessages=this._messageProperties.isSelectMultipleMessagesEnabled&&!a.isPhoneMri(this._messageProperties.skypeMessage.conversationId),this._defaultSupportsRemove=(!!this._messageProperties.postedByCurrentUser||!!this._messageProperties.isModerator)&&!this._messageProperties.isConversationBlocked&&this._isMessageSent&&!this._messageProperties.isReadOnly&&!s&&!t,this._defaultSupportsCopy=n.UICapabilities.copyTextToClipboardSupported(),this._enableReactionOverlay=this._messagingFeatures.enableReactionOverlays,this._defaultSupportsDragging=this._messagingFeatures.enableDragAndDropFilesFromConversationToRecentLists&&!t,this._defaultSupportsBookmark=this._messagingFeatures.enableBookmarks&&this._isMessageSent,this._enableDebugMessageActions=this._messagingFeatures.enableDebugMessageActions}getRenderingOptions(){const e=this._getDefaultMessageViewRenderingOptions(),t=this._getDefaultMessageActions();return{messageViewRenderingOptions:this.getMessageSpecificViewRenderingOptions(e),messageActions:this.getMessageActions(this._getDefaultMessageActions()),renderOnlyUrlPreview:this.renderOnlyUrlPreview(),urlPreviewRenderInformation:this.getUrlPreviewRenderInformation(e,t)}}getActionMenuCommands(e){let t=[];if(this._isBookmark)return this.getActionMenuCommandsForBookmarkMessage(e);if(e.supportsPostingReactions&&t.push(m.CommandTypes.AddReaction),e.supportsForward&&t.push(m.CommandTypes.Forward),e.supportsSave&&t.push(m.CommandTypes.SaveMedia),e.saveAsCommand&&t.push(e.saveAsCommand),e.openFileLocationCommand&&t.push(e.openFileLocationCommand),e.supportsRemove&&t.push(m.CommandTypes.Remove),e.supportsEdit&&t.push(m.CommandTypes.Edit),e.supportsQuotes&&t.push(m.CommandTypes.Quote),e.supportsBookmarks&&!this._isBookmark&&t.push(m.CommandTypes.Bookmark),e.supportsTranslation&&t.push(m.CommandTypes.Translate),e.supportsQuotesSelection&&t.push(m.CommandTypes.QuoteSelection),e.copyCommand&&t.push(e.copyCommand),this._defaultSupportsSelectMultipleMessages){(e.copyCommand||e.supportsRemove||e.supportsForward)&&e.supportsSelectMessages&&t.push(m.CommandTypes.SelectMessages)}return e.supportsViewLink&&t.push(m.CommandTypes.ViewLink),e.supportsCancelScheduledCall&&t.push(m.CommandTypes.CancelScheduledCall),e.supportsEditScheduledCall&&t.push(m.CommandTypes.EditScheduledCall),e.supportsCancelPoll&&t.push(m.CommandTypes.CancelPoll),this._enableDebugMessageActions&&(t.push(m.CommandTypes.DebugDumpMessage),t.push(m.CommandTypes.DebugDumpMessagePretty)),t}getActionsForButtonsToBeRenderedInMessageView(e,t,s){const i=[];return this._isBookmark||(e&&i.push(m.CommandTypes.Forward),t&&i.push(m.CommandTypes.AddReaction)),i}renderOnlyUrlPreview(){return!1}getUrlPreviewRenderInformation(e,t){return[]}getActionMenuCommandsForBookmarkMessage(e){let t=[];return e.supportsForward&&t.push(m.CommandTypes.Forward),e.supportsSave&&t.push(m.CommandTypes.SaveMedia),e.saveAsCommand&&t.push(e.saveAsCommand),t.push(m.CommandTypes.Bookmark),e.copyCommand&&t.push(e.copyCommand),t}_getDefaultMessageActions(){const e=[],t=this._messageProperties.skypeMessage.isEphemeral(),s=this._messageProperties.skypeMessage.isMessageLie(),i=this._messageProperties.skypeMessage.isSendRejected();return s&&!t&&(i?(g.default.canRetry(this._messageProperties.skypeMessage.getSendRetryInfo())&&e.push(m.CommandTypes.RetryFailedSend),e.push(m.CommandTypes.CancelFailedSend)):this._messageProperties.skypeMessage.isEdited()?e.push(m.CommandTypes.CancelEdit):e.push(m.CommandTypes.CancelSend)),s||t||i||this._isBookmark||(this._messageProperties.isReportEnabled&&!this._messageProperties.postedByCurrentUser&&e.push(m.CommandTypes.Report),this._messageProperties.postedByCurrentUser||r.isThreadActivityType(this._messageProperties.skypeMessage.messagetype)||this.renderedInCompositeGallery()||this.renderedInStackGallery()||e.push(m.CommandTypes.MarkReadToHere),(this.renderedInStackGallery()||this.renderedInCompositeGallery())&&e.push(m.CommandTypes.ViewInChat)),{actionMenuCommands:e,outerButtonCommands:[]}}_getDefaultMessageViewRenderingOptions(){const e=this._messageProperties.skypeMessage,t=!e.isEmote();let s,i=!!this._messageProperties.postedByCurrentUser;this._isBookmark&&(s=r.getBookmarkMetadata(e.properties)),s&&s.bookmarkSourceCreatorId&&(i=p.default.isMyMri(s.bookmarkSourceCreatorId));const o=this.renderedInCompositeGallery()||this.renderedInStackGallery()||this._isBookmark||this._isBookmarkSource&&!this._messageProperties.postedByCurrentUser||this._messageProperties.messageFirstInGroup&&!this._messageProperties.postedByCurrentUser&&t,n=o&&!this.renderedInCompositeGallery(),a=!this._messageProperties.postedByCurrentUser&&!this.renderedInCompositeGallery(),d=t&&(o||this._messageProperties.messageFirstInGroup&&this._messageProperties.postedByCurrentUser||this._messageProperties.messageFirstInGroup&&this._messageProperties.messageLastInGroup)||this._isBookmarkSource&&this._messageProperties.postedByCurrentUser;let h=c.MessageRenderSendingStatus.None;e.isSendRejected()?h=c.MessageRenderSendingStatus.Failed:this._messageProperties.renderOrigin!==l.MessageRenderOrigin.CallCanvas&&e.isMessageLie()&&!e.isEphemeral()&&(h=c.MessageRenderSendingStatus.Sending);const g={messageCreatorMri:e.creator,postedByBot:!!this._messageProperties.postedByBot,postedByCurrentUser:i,messageRenderOrigin:this._messageProperties.renderOrigin,theme:this._messageProperties.colorTheme,themeColors:this._messageProperties.themeColors,themeStyles:this._messageProperties.themeStyles,messageStreamHasUnderlay:!!this._messageProperties.hasUnderlay,flipBubbleColors:this._messageProperties.flipBubbleColors},m=u.getBackgroundColorStyleForMessage(g),S=this.renderedInCompositeGallery()||this.renderedInStackGallery()?f.default.flexOne:void 0;return{renderMessageBackground:!0,showMessageSender:o,showMessageSenderIcon:n,allowMarginForSenderIcon:a,showMessageTimestamp:d,alignHeaderLeft:this.renderedInCompositeGallery()||this.renderedInStackGallery(),showDesktopButton:!e.isEphemeral()&&!this.renderedInCompositeGallery(),showStreamItemAccessory:!this.renderedInCompositeGallery()&&!this.renderedInStackGallery()&&!this.renderedInBookmarkConversationOnDesktop(),showReactionsOnMessage:this._defaultSupportsShowingReactionsSummary,overlayReactionsOnMessage:this._defaultSupportsOverlayingReactionsSummary,removeMessageSpacer:this.renderedInCompositeGallery()||this.renderedInStackGallery(),accessibilityLabelType:l.MessageAccessibilityType.Text,skipAccessibilityLabelForMessageView:!1,sendingStatus:h,shouldAnimateEmoticons:this._messageProperties.isCurrentUserActive&&(this._messageProperties.isLastMessage||!1),viewColorProperties:m,messageContainerStyle:this._messageProperties.messageFirstInGroup||o?y.containerPadding.firstInGroup:y.containerPadding.notFirstInGroup,messageContainerRadiusStyle:this._getDefaultRadiusStylesForMessage(),outerWrapperOverideStyle:S,showOuterButtons:this._defaultSupportsAddReactionInMessageView||this._isBookmark,showEditIndicator:!1,showDivider:this._isBookmark&&!this._messageProperties.isLastMessage}}renderedInStackGallery(){return this._messageProperties.renderOrigin===l.MessageRenderOrigin.StackGalleryCanvas}renderedInCompositeGallery(){return this._messageProperties.renderOrigin===l.MessageRenderOrigin.CompositeGalleryCanvas}renderedInBookmarkConversationOnDesktop(){return this._isBookmark&&!0}}t.DefaultMessageRenderingOptions=_;class v extends _{getMessageSpecificViewRenderingOptions(e){return e}getMessageActions(e){return e}}t.UnknownMessageTypeRenderingOptions=v,v.messageTypeGroup=r.MessageTypeGroups.None},88660:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(74634),n=s(14920),r=s(98278),a=s(20770),l=s(21468),d=s(46096),c=s(53559),h=s(23944),u=s(36237),p=s(13131),g=s(81157),m=s(4735),S=s(27357),f=s(57946),y=s(15963),_=s(53374);class v{static performShareNavigationAction(e,t="",s){let o=1;switch(e.type){case"text":e.text&&this._processTextShareEvent(e.text,s);break;case"media":if(!e.data||i.isEmpty(e.data))break;o=e.data.length,this._isFileTypeIncluded(e.data)?this._processFileShareEvent(e.data,s):1===e.data.length?this._processSingleMediaShareEvent(e.data[0],t,s):this._processMultipleMediaShareEvent(e.data,t,s);break;default:_.default.switchStatementExhaustiveChecking(e.type)}u.track(new l.DirectShareTelemetry(e.type,o))}static fileDirectShareEvent(){return this._fileShareEvent}static sendSharedFiles(e,t){g.default.postShareEventMediaSelections(e,[t],{name:y.ScenarioName.ShareToSkypeMedia},_.default.newCauseId())}static _processTextShareEvent(e,t){const s={entities:[{type:p.EditableEntityType.PlainText,displayText:e}],downStreamDataVersion:0},i={conversationId:t,inputEntities:(0,h.convertRawTextToInputEntities)(e,!1,!1),inputEntitiesDataVersion:0,messages:void 0,type:f.SavedMessageType.None,timestamp:Date.now()};a.default.saveMessageInput(t,i),a.default.updateInputEntitiesFromContent(t,s).commit(t).storeSavedMessage(t),m.default.navigateToConversation({convId:t,causeId:_.default.newCauseId(),shouldAutoFocusInput:!0})}static _processSingleMediaShareEvent(e,t,s){const i=this._getCapturePreviewParams(e,t,s);m.default.navigateToCapturePreview(i)}static _processMultipleMediaShareEvent(e,t,s){const o={mediaPreviews:i.map(e,(e=>{const o=this._getCapturePreviewParams(e,t,s),n={mediaSelection:this._getMediaSelectionParams(e,t)};return i.extend(n,o)})),conversationId:s,onReject:()=>this._onMediaPreviewReject(s)};m.default.navigateToCaptureMultiPreview(o)}static _processFileShareEvent(e,t){const s=_.default.newCauseId();S.default.getActiveConversationId(r.MainRootViewId)!==t?m.default.navigateToConversation({convId:t,causeId:s,directShareEventData:e}):this._fileShareEvent.fire(e)}static _getCapturePreviewParams(e,t,s){return{capturedContentHandler:new n.CapturedContentHandlerForPosting(s),localMediaObjectUri:t+e.uri,localMediaThumbnailUri:t+(e.thumbnailUri||e.uri),width:e.width,height:e.height,fileSize:e.size,entryPoint:d.PostSource.DirectShare,skipShareWithPanel:!0,fileExtension:c.default.extractFileExtension(e.name),conversationId:s,localMediaIsVideo:"video"===e.type,onCaptureFlowComplete:()=>this._onSendFlowComplete(s),onReject:()=>this._onMediaPreviewReject(s)}}static _getMediaSelectionParams(e,t){return{fileName:e.name,id:e.uri,node:{node:{image:{contentType:e.type+"/"+c.default.extractFileExtension(e.uri),duration:0,height:e.height,size:e.size,thumbnailUri:t+(e.thumbnailUri||e.uri),uri:t+e.uri,width:e.width},isPhoto:"image"===e.type,timestamp:Date.now()}}}}static _onSendFlowComplete(e){const t=_.default.newCauseId();u.log(d.LogTraceArea.DirectShareUtils,"DirectShareUtils._onSendFlowComplete: Sending selected files",t),m.default.navigateToConversation({convId:e,causeId:t})}static _onMediaPreviewReject(e){const t=_.default.newCauseId();u.log(d.LogTraceArea.DirectShareUtils,"DirectShareUtils._onMediaPreviewReject: Rejecting selected files",t),m.default.navigateToConversation({convId:e,causeId:t})}static _isFileTypeIncluded(e){return i.some(e,(e=>"image"!==e.type&&"video"!==e.type))}}t.default=v,v._fileShareEvent=new o.default},3291:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DropTargetOrigin=t.DragDropType=t.DropEffect=void 0;const i=s(96486),o=s(60014),n=s(89391),r=s(51077),a=s(71830),l=s(81725),d=s(82261),c=s(54543),h=s(46096),u=s(36237),p=s(12056),g=s(85207),m=s(4057),S=s(78262),f=s(72758);var y;t.DropEffect="copy",function(e){e.FileFromDesktop="filefromdesktop",e.FileFromConversationToRecents="filefromconversationtorecents",e.ContactFromRecentsToConversation="contactfromrecentstoconversation",e.Unknown="unknown"}(y=t.DragDropType||(t.DragDropType={})),function(e){e[e.AvatarPicker=0]="AvatarPicker",e[e.MessagePanel=1]="MessagePanel",e[e.DesktopGalleryPanel=2]="DesktopGalleryPanel",e[e.ConversationListItem=3]="ConversationListItem"}(t.DropTargetOrigin||(t.DropTargetOrigin={}));t.default=new class{getDataTransferType(e){return o.DragDropEvent.isContactEntityInDataTransfer(e)?y.ContactFromRecentsToConversation:this.isDataTransferFileFromConversationToRecents(e)?y.FileFromConversationToRecents:this.isDataTransferFilesFromDesktop(e)?y.FileFromDesktop:y.Unknown}isDataTransferFilesFromDesktop(e){return!(e.dataTransfer&&!e.dataTransfer.items||0===e.dataTransfer.items.length||i.every(e.dataTransfer.items,(e=>"string"===e.kind)))}isDataTransferFileFromConversationToRecents(e){return e.dataTransfer&&e.dataTransfer.items&&1===e.dataTransfer.items.length&&e.dataTransfer.items[0].type===y.FileFromConversationToRecents}isDragAndDropContactsEnabled(){return n.default.getS4LMessagingFeaturesNoSubscription().enableContactShareDragAndDrop&&!0}addDragAndDropContactInformation(e,t,s,i){const n=a.isPhoneMri(t),r=a.isS4BBridgeMri(t);let l={skypeId:a.stripMriNamespace(t),fullName:s,isPstn:n,isS4B:r,userMri:t};o.DragDropEvent.addDragAndDropContactInformation(e,l),u.track(new c.DragAndDropTelemetry(c.DragAction.DragStart,i,c.DragType.Contact))}isContactEntityInDataTransfer(e){return o.DragDropEvent.isContactEntityInDataTransfer(e)}extractContactEntityFromDataTransfer(e){if(!o.DragDropEvent.isContactEntityInDataTransfer(e))return;const t=e.dataTransfer.getData(y.ContactFromRecentsToConversation),s=m.default.parseJsonErrorToUndefined(t);if(!s)return void u.error(h.LogTraceArea.MessagePanel,"Failed to create information for dropping message of type");const{userMri:i}=s;if(!i||!a.isMri(i))return;const n=f.default.getDisplayableUserByMri(i);return n?{skypeId:a.stripMriNamespace(i),fullName:n.getDisplayName(),isPstn:a.isPhoneMri(i),isS4B:a.isS4BBridgeMri(i),userMri:n.getMri()}:void 0}addDragAndDropFileInformation(e,s){e.dataTransfer.effectAllowed=t.DropEffect,e.dataTransfer.dropEffect=t.DropEffect;const i=l.toForwardMediaInfo(s);if(!i)return void u.error(h.LogTraceArea.MessagePanel,"Failed to create information for dragging message of type"+s.messagetype);const o={message:s,forwardInfo:i};e.dataTransfer.setData(y.FileFromConversationToRecents,JSON.stringify(o)),u.track(new c.DragAndDropTelemetry(c.DragAction.DragStart,c.DragOrigin.MessageStream,this._convertMessageTypeToTelemetryType(i)))}dropFileFromConversationToRecents(e,t,s){let o=s;t&&(o=t.getData(y.FileFromConversationToRecents));const n=m.default.parseJsonErrorToUndefined(o);if(!n||i.isEmpty(n))return void u.error(h.LogTraceArea.MessagePanel,"Failed to create information for dropping message of type");const{message:a,forwardInfo:l}=n;if(!(i.isEmpty(l)||i.isEmpty(a)||i.isEmpty(a.content))&&i.isString(a.content)&&i.includes(r.UriObjectMessageTypes,a.messagetype)){try{g.default.postMessage(d.createForwardMessageInfo(e,h.PostSource.DragDropFromConversationToRecentLists,n.message.content,n.message.messagetype,[n.forwardInfo]))}catch(e){return void u.error(h.LogTraceArea.MessagePanel,"Failed to post message after dropping file to recents - "+m.default.errorAsString(e))}u.track(new p.MessageActionTelemetry(e,n.message,n.message.createdTime,p.MessageActionOrigin.MessageStream,p.MessageActionType.DragDropFromConversationToRecentLists))}}isFileEntityFromConversationInDataTransfer(e){return this.getDataTransferType(e)===y.FileFromConversationToRecents}isDragAndDropFilesFromConversationToRecentListsEnabled(){return n.default.getS4LMessagingFeaturesNoSubscription().enableDragAndDropFilesFromConversationToRecentLists&&!0}_convertMessageTypeToTelemetryType(e){switch(e.fileType){case S.UploadFileType.Picture:return c.DragType.Picture;case S.UploadFileType.Video:return c.DragType.Video}return c.DragType.File}}},20076:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getEstablishedEncryptedThreadId=t.createAndNavigateToPrivateConversation=void 0;const i=s(96486),o=s(97691),n=s(19784),r=s(76621),a=s(71830),l=s(41706),d=s(67121),c=s(25793),h=s(46096),u=s(36237),p=s(47662),g=s(33754),m=s(4735),S=s(21090),f=s(86045),y=s(4057),_=s(12770),v=s(72758),C=s(53374);t.createAndNavigateToPrivateConversation=function(e,t,s){const b=C.default.newCauseId();u.log(h.LogTraceArea.Navigation,"E2eeUIUtils.createAndNavigateToPrivateConversation, causeId: "+b);const T=S.rootViewIdForComponentContext(s),M=a.buildOneOnOneEncryptedThreadId(e);return r.default.getConversationMetaAsync(M).then((a=>{a||m.default.navigateToLoadingPanel(g.getString("SetConversationParticipantsPanel.CreatingNewConversation"),b,T);const S=a&&l.default.getHandshakeState(M)!==c.SecureHandshakeState.None?o.Resolved(M):d.default.sendInvite(e,t),C=e=>{f.default.isMobileScreenReaderEnabled()?i.delay(e,250):e()},I=e=>{m.default.navigateToHub(b),C((()=>n.default.showErrorAlert(e,T)))};return S.then((()=>o.race([r.default.waitForJoinedKnowledgeOfConversation(M),_.default.sleep(15e3)]))).then((e=>{e?m.default.navigateToConversation({convId:M,origin:h.NavigationConversationOrigin.NewPrivateConversation,causeId:b}):I(g.getString("E2eeNewConversation.ConversationInvitationTimedOut"))})).catch((t=>{if(405===t.statusCode){u.log(h.LogTraceArea.Navigation,"E2eeUIUtils.createAndNavigateToPrivateConversation error, causeId: "+b),m.default.goBack(b,s);const t=v.default.getFullUserProfileByMri(e),i=t.firstName||t.getDisplayName(),o=p.getLocalizeParamForGender(t.gender);C((()=>{n.default.showOKAlert(g.getString("E2eeNewConversation.InvitationNotSent"),g.getString("E2eeNewConversation.UpgradeNeeded",{buddy:i,gender:o}),T)}))}else if(409===t.statusCode&&666===t.errorCode)d.default.sendAccept(M,h.E2EEAcceptOrigin.Invitation).then((()=>{m.default.navigateToConversation({convId:M,origin:h.NavigationConversationOrigin.NewPrivateConversation,causeId:b})}));else{const e=g.getString("E2eeNewConversation.ConversationInvitationFailed",{reason:y.default.errorAsString(t)});C((()=>I(e)))}}))}))},t.getEstablishedEncryptedThreadId=function(e){const t=a.buildOneOnOneEncryptedThreadId(e);return r.default.getConversationMetaAsync(t).then((e=>{if(e&&l.default.getHandshakeState(t)===c.SecureHandshakeState.Completed)return t}))}},8681:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(62698),o=s(97691),n=s(46096),r=s(53559),a=s(36237),l=s(4057),d=s(40363),c=s(26712);t.default=class{static downsizeImageIfNeeded(e,t,s,d,c){const h=r.default.getFileContentType(t),u=this._getImageDownsizeDimensions(s,d,h);return this._shouldDownsize(s,d,u.resizeWidth,u.resizeHeight)?(e=this._getCorrectedUri(e),i.default.createResizedImage(e,u.resizeWidth,u.resizeHeight,"JPEG",60).then((e=>this._createFileData(e.uri,e.name||"image.jpg",void 0,e.size,u.resizeWidth,u.resizeHeight))).catch((i=>(a.log(n.LogTraceArea.ImageResizeUtils,"Compression failed: "+l.default.errorAsString(i)+"Sending the original media"),this._createFileData(e,t,h,c,s,d))))):o.Resolved(this._createFileData(e,t,h,c,s,d))}static _shouldDownsize(e,t,s,i){return e>0&&t>0&&(e>s||t>i)}static _getCorrectedUri(e){return d.default.getPlatformType()!==n.PlatformType.Android||c.default.isUrlValid(e)||c.default.isFileOrBlob(e)?e:"file://"+e}static _createFileData(e,t,s,i,o,n){return{file:{uri:e,name:t,size:i,type:s||r.default.getFileContentType(t)},extension:r.default.extractFileExtension(t),dimensions:{width:o,height:n}}}static _getImageDownsizeDimensions(e,t,s,i=2048){let o,n;return e<=0||t<=0?(n=0,o=0):s===r.default.imageContentTypes.gif?(n=e,o=t):t>i||e>i?t>e?(n=e*i/t,o=i):(n=i,o=t*i/e):(n=e,o=t),{resizeWidth:n,resizeHeight:o}}static test_shouldDownsize(e,t,s,i){return this._shouldDownsize(e,t,s,i)}static test_getCorrectedUri(e){return this._getCorrectedUri(e)}static test_createFileData(e,t,s,i,o,n){return this._createFileData(e,t,s,i,o,n)}static test_getImageDownsizeDimensions(e,t,s,i){return this._getImageDownsizeDimensions(e,t,s,i)}}},51176:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MapHeight=t.LocationHeight=t.FooterHeight=t.LocationSuffix=t.MapWidth=t.LatitudeLongitudeDelta=void 0;const i=s(96486),o=s(89391),n=s(7234),r=s(93924),a=s(57175),l=s(78735),d=s(81736),c=s(26712);t.LatitudeLongitudeDelta=3/69,t.MapWidth=200,t.LocationSuffix="_location_snapshot",t.FooterHeight=62,t.LocationHeight=182,t.MapHeight=t.LocationHeight-t.FooterHeight;const h=1e6;t.default=new class{getBingMapsImageUrl(e,t,s){const{urlBase:i,apiKey:n}=o.default.getBingMapsConfig();if("NO_API_KEY"!==n)return c.default.addUrlParameters(i,{key:n,mapSize:`${t},${s}`,mapArea:`${e.latitude-e.latitudeDelta/2},${e.longitude-e.longitudeDelta/2},${e.latitude+e.latitudeDelta/2},${e.longitude+e.longitudeDelta/2}`})}getBingMapsLocationUrl(e,t){const s={cp:e.latitude+"~"+e.longitude,dir:"0",lvl:"15",where1:t?encodeURI(t):e.latitude+","+e.longitude};return c.default.addUrlParameters("https://www.bing.com/maps/default.aspx",s)}getImageUriForLocation(e,s,i){const o=this.getFileIdForLocation(i);return n.default.isKnown(o)?n.default.getLocalUri(o):this.getBingMapsImageUrl(this.getLocationRegionFromLatLong(e,s),t.MapWidth,t.MapHeight)}getImageUriForLocationForwardAndroid(e,s){return this.getBingMapsImageUrl(this.getLocationRegionFromLatLong(e,s),t.MapWidth,t.MapHeight)}getLocationRegionFromLatLong(e,s){return{latitude:i.toNumber(e)/h,longitude:i.toNumber(s)/h,latitudeDelta:t.LatitudeLongitudeDelta,longitudeDelta:t.LatitudeLongitudeDelta*(t.MapWidth/t.MapHeight)}}getFileIdForLocation(e){return e+t.LocationSuffix}getLocationPermissionStatus(e){var t;const s=null===(t=l.default.getUserPreferencesLocal().msaProfileKey)||void 0===t?void 0:t.ageGroup;return a.MsaProfileHelper.isChild(s)?r.PermissionStatus.Denied:d.default.permissionStatus(e)}}},33596:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getStyleForDimensions=t.getThumbnailMaxWidth=t.defaultStyles=t.defaultDim=t.CompositeGalleryThumbnailWidth=t.CompositeGalleryThumbnailHeight=t.ThumbnailMinHeight=t.ThumbnailMinWidth=void 0;const i=s(16778),o=s(98278),n=s(15877),r=s(29130);t.ThumbnailMinWidth=60,t.ThumbnailMinHeight=60;const a={};t.CompositeGalleryThumbnailHeight=200,t.CompositeGalleryThumbnailWidth=300;function l(e,t){return t||r.default.isSmallDeviceNoSubscription(e)?200:r.default.isMediumPhoneDeviceNoSubscription(e)?250:300}t.defaultDim={compositeGalleryThumbnail:{height:t.CompositeGalleryThumbnailHeight,width:t.CompositeGalleryThumbnailWidth},inCallConvThumbnail:{height:133,width:200}},t.defaultStyles=(0,n.lazyProperties)({pictureDefaultThumbnail:()=>i.Styles.createImageStyle({height:l(o.MainRootViewId),width:l(o.MainRootViewId)}),compositeGalleryThumbnail:()=>i.Styles.createImageStyle({height:t.CompositeGalleryThumbnailHeight,width:t.CompositeGalleryThumbnailWidth})}),t.getThumbnailMaxWidth=l,t.getStyleForDimensions=function(e){const t=function(e){return`${e.width||"_"}x${e.height||"_"}`}(e);if(!a[t]){const{width:s,height:o}=e;a[t]=s&&o?i.Styles.createViewStyle({width:s,height:o},!1):s?i.Styles.createViewStyle({width:s},!1):o?i.Styles.createViewStyle({height:o},!1):i.Styles.createViewStyle({},!1)}return a[t]}},81157:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(57349),n=s(97792),r=s(97691),a=s(19784),l=s(89391),d=s(2278),c=s(72675),h=s(71830),u=s(98278),p=s(82261),g=s(46096),m=s(53559),S=s(8681),f=s(36237),y=s(50556),_=s(33754),v=s(18743),C=s(71349),b=s(85207),T=s(86045),M=s(4057),I=s(53374),w=s(53332),P="processingVideo";class k{static postMediaSelections(e,t,s,o,a,d){const c=n.default.requestMaxTime("mediaPickerPost:manyMedia"),h=i.isArray(e)?e:[e],u=i.some(h,(e=>e.node&&!e.node.node.isPhoto));if(s!==g.PostSource.ShareWith){const e=l.default.getS4LMessagingFeaturesNoSubscription().limitForFilePicker;f.track(new v.FilesSentViaPicker(v.FilePickerOrigin.MediaPickerItem,e,!1,i.map(h,(e=>m.default.extractFileExtension(e.fileName)))))}let p;if(u)if(k._canSendVideo(t,h)){k._startSharingProcess(!0);const e=i.map(h,(e=>k._postMediaSelection(e,t,s,o,a,d)));p=r.all(e).always((()=>{k.hideProcessingDialog(!0)}))}else{const e=r.Defer();k._showVideoPostError((()=>{e.reject()})),p=e.promise()}else{const e=i.map(h,(e=>k._postMediaSelection(e,t,s,o,a,d)));p=r.all(e).always(i.noop)}return p.finally((()=>{c.then((e=>n.default.release(e,"mediaPickerPost:manyMedia")))}))}static postShareEventMediaSelections(e,t,s,o){const a=n.default.requestMaxTime("mediaPickerPost:share"),l=i.some(e,(e=>"video"===e.type));k._startSharingProcess(l);let d=[];return i.sumBy(e,(e=>"video"===e.type||"image"===e.type?1:0))>1?i.each(t,(t=>{const n=!h.isAgent(t),a=I.default.newGuid(),l={scenarioInfo:s,properties:n?{albumId:a}:void 0},c=k._postShareEventMediaSelections(e,[t],l,o);if(n){const s=()=>r.Resolved().then((()=>{const e=p.createMediaAlbumMessage(t,g.PostSource.ShareToSkype,a);b.default.postMessage(e)})),o=i.findIndex(e,(e=>"video"===e.type||"image"===e.type))+1;c.splice(o,0,s)}const u=i.reduce(c,((e,t)=>e.then(t)),r.Resolved());d.push(u)})):d=k._postShareEventMediaSelections(e,t,{scenarioInfo:s},o).map((e=>e())),r.all(d).always((()=>{k.hideProcessingDialog(!0)})).finally((()=>{a.then((e=>n.default.release(e,"mediaPickerPost:share")))}))}static _postShareEventMediaSelections(e,t,s,o){return i.map(e,(e=>{const i=m.default.extractFileNameWithExtension(e.name),n=m.default.extractFileExtension(i),r=m.default.getFileContentType(i);if("video"===e.type){const a=e.thumbnailWidth?e.thumbnailWidth:e.width,l=e.thumbnailHeight?e.thumbnailHeight:e.height;return k._canVideoReencode(t,e.width,e.height)?()=>k._reencodeAndPostVideo(e.uri,e.width,e.height,e.size,e.thumbnailUri,a,l,i,n,r,t,g.PostSource.ShareToSkype,0,s.scenarioInfo,s.properties,o):()=>k._postVideoFromMediaPicker(e.uri,e.width,e.height,i,n,e.size,e.thumbnailUri,a,l,r,t,g.PostSource.ShareToSkype,s.scenarioInfo,s.properties)}if("image"===e.type)return()=>k._postImageFromMediaPicker(e.uri,i,e.width,e.height,n,t,g.PostSource.ShareToSkype,s);{let o={file:{uri:e.uri,name:i,size:e.size,type:e.type},extension:n};return e.width&&e.height&&(o.dimensions={width:e.width,height:e.height}),()=>b.default.postUpload(t,o,g.PostSource.ShareToSkype,!1,{scenarioInfo:s.scenarioInfo}).then((()=>{T.default.maybeAnnounceForAccessibility(_.getString("MessageComposer.FileSentLabel"))}))}}))}static _postMediaSelection(e,t,s,o,n,r){const a=e.node,l=a.node.image.uri,c=e.fileName||m.default.extractFileName(l),h=m.default.extractFileExtension(c),u=m.default.getFileContentType(c),p=i.isArray(t)?t:[t];let g;if(m.default.isVideoExtension(h)){const e=a,t=e.node.image.width,i=e.node.image.height,n=e.node.image.size,d=e.node.image.thumbnailUri;g=k._canVideoReencode(p,t,i)?k._reencodeAndPostVideo(l,t,i,n,d,t,i,c,h,u,p,s,e.node.image.duration,o.scenarioInfo,o.properties,r):k._postVideoFromMediaPicker(l,t,i,c,h,e.node.image.size,d,t,i,u,p,s,o.scenarioInfo,o.properties)}else{const e=a.node.image.width,t=a.node.image.height;g=k._postImageFromMediaPicker(l,c,e,t,h,p,s,o)}return g.always((()=>{o.callId?d.default.updateCallTelemetry(o.callId,"MediaPicker",(e=>e.postMediaPickerPhotoReaction())):n&&f.track(n)}))}static _postVideoFromMediaPicker(e,t,s,i,o,n,r,a,l,d,c,h,u,p){const g={file:{uri:e,size:n,name:i,type:d},extension:o,dimensions:{width:t,height:s}};if(r){const e=m.default.extractFileNameWithExtension(r),t=m.default.extractFileExtension(e),s=m.default.getFileContentType(e);g.thumbnail={file:{uri:r,name:e,type:s,size:0},extension:t,dimensions:{width:a,height:l}}}return b.default.postVideoWithThumbnail(c,g,h,!1,u,void 0,void 0,p).then((()=>{T.default.maybeAnnounceForAccessibility(_.getString("MessageComposer.FileSentLabel"))}))}static _postImageFromMediaPicker(e,t,s,i,o,n,r,a){return(s<=0||i<=0)&&f.track(new C.UnrecognizedMediaDimension(o,r)),S.default.downsizeImageIfNeeded(e,t,s,i,void 0).then((e=>this._postImage(e,n,r,a)),(e=>{f.log(g.LogTraceArea.MediaPickerPostUtils,"postImageFromMediaPicker failed: "+M.default.errorAsString(e))}))}static hideProcessingDialog(e){let t=!1;return y.LoadingDialog.isDisplayed(P,u.MainRootViewId)&&(y.LoadingDialog.dismiss(P,u.MainRootViewId),t=!0),t}static _reencodeAndPostVideo(e,t,s,i,n,r,a,l,d,h,u,p,m,S,y,_){const v=new c.VideoReencode(m?1e3*m:0);return o.default.reencodeVideo(e,void 0,w.default.reencodeOptions(),_).then((i=>{v.setStatus(!0);const o=i.width?i.width:t,r=i.height?i.height:s,a=i.uri?i.uri:e,c=i.thumbnailUri?i.thumbnailUri:n;k._postVideoFromMediaPicker(a,o,r,l,d,i.fileSize,c,o,r,h,u,p,S,y)})).catch((o=>{const c=M.default.errorAsString(o);v.setStatus(!1,c),f.error(g.LogTraceArea.MediaPickerPostUtils,"ReencodeVideo failed - "+c),k._postVideoFromMediaPicker(e,t,s,l,d,i,n,r,a,h,u,p,S,y)})).always((()=>{f.track(v)}))}static _startSharingProcess(e){e&&(y.LoadingDialog.dismiss(P,u.MainRootViewId),y.LoadingDialog.show({dialogId:P,dialogText:_.getString("CapturePreview.PreparingVideo"),showActivityIndicator:!0,showCancelButton:!1},u.MainRootViewId,!0))}static _canSendVideo(e,t){return!(!e||!t)}static _showVideoPostError(e){f.log(g.LogTraceArea.Capture,"CapturePreview not sending captured video");const t=[{text:_.getString("CapturePreview.HighlightsDialogConfirmButtonTitle"),onPress:()=>{e()}}],s=_.getString("CapturePreview.ItemCannotBeSelected");a.default.showWithOptions({title:_.getString("CapturePreview.UnableToAddToHighlightsDialogTitle"),dialogAccessibilityTitle:s,message:s,buttons:t,rootViewId:u.MainRootViewId,useFocussedWindowFallback:!0})}static _canVideoReencode(e,t,s){return!1}static _postImage(e,t,s,i){return b.default.postUpload(t,e,s,!1,i).then((()=>{T.default.maybeAnnounceForAccessibility(_.getString("MessageComposer.FileSentLabel"))}))}static test_postImageFromMediaPicker(e,t,s,i,o,n,r,a){this._postImageFromMediaPicker(e,t,s,i,o,n,r,a)}}t.default=k},96919:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MediaAlbumRenderingOptions=t.StickerRenderingOptions=t.MojiRenderingOptions=t.AudioMessageRenderingOptions=t.VideoMessageRenderingOptions=t.PictureMessageRenderingOptions=void 0;const i=s(96486),o=s(16778),n=s(89391),r=s(51077),a=s(28229),l=s(13991),d=s(70891),c=s(66649),h=s(15877),u=s(83503),p=s(63032),g=s(750),m=(0,h.lazyProperties)({messageContentSpacing:()=>o.Styles.createViewStyle({paddingTop:0,paddingBottom:0,paddingLeft:0})});function S(e){return e===p.MessageRenderSendingStatus.Sending?p.MessageRenderSendingStatus.None:e}class f extends a.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){const t=this._messagingFeatures.enableImageForwarding&&this._supportsForward,s={renderMessageBackground:!1,overlayReactionsOnMessage:this._defaultSupportsShowingReactionsSummary&&this._enableReactionOverlay,showTouchFeedbackOnPress:!0,showOuterButtons:this._defaultSupportsAddReactionInMessageView||t,includeCursor:!0,accessibilityLabelType:d.MessageAccessibilityType.Media,sendingStatus:S(e.sendingStatus),availableSpace:this._messageProperties.containerMaxDimensions,calcRenderDim:(0,l.prepareMediaNodeDimensionsFunction)(this._messageProperties),isDraggingEnabled:this._defaultSupportsDragging};return i.assign({},e,s)}getMessageActions(e){const t=this._messagingFeatures.enableImageForwarding&&this._supportsForward,s=c.default.isUsingGogoNetwork();let i=this.getActionMenuCommands({supportsPostingReactions:this._defaultSupportsAddReactionsInActionMenu&&!this.renderedInCompositeGallery()&&!this.renderedInStackGallery(),supportsForward:this._supportsForward&&!s,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,supportsSave:this._isMessageSent&&!s,supportsRemove:this._defaultSupportsRemove,copyCommand:void 0,openFileLocationCommand:u.canOpenFileLocation(this._messageProperties.skypeMessage)?g.CommandTypes.OpenMediaLocation:void 0,saveAsCommand:void 0,supportsBookmarks:this._defaultSupportsBookmark});return i=i.concat(e.actionMenuCommands),e.outerButtonCommands=this.getActionsForButtonsToBeRenderedInMessageView(t,this._defaultSupportsAddReactionInMessageView,!1).concat(e.outerButtonCommands),{actionMenuCommands:i,outerButtonCommands:e.outerButtonCommands}}}t.PictureMessageRenderingOptions=f,f.messageTypeGroup=r.MessageTypeGroups.Picture;class y extends a.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){const t=this._messagingFeatures.enableVideoMessageForwardButton&&this._supportsForward,s={renderMessageBackground:!1,overlayReactionsOnMessage:this._defaultSupportsShowingReactionsSummary&&this._enableReactionOverlay,showTouchFeedbackOnPress:!0,showOuterButtons:this._defaultSupportsAddReactionInMessageView||t,includeCursor:!0,accessibilityLabelType:d.MessageAccessibilityType.Media,sendingStatus:S(e.sendingStatus),availableSpace:this._messageProperties.containerMaxDimensions,calcRenderDim:(0,l.prepareMediaNodeDimensionsFunction)(this._messageProperties),isDraggingEnabled:this._defaultSupportsDragging};return i.assign({},e,s)}getMessageActions(e){const t=this._messagingFeatures.enableVideoMessageForwardButton&&this._supportsForward;let s=this.getActionMenuCommands({supportsPostingReactions:this._defaultSupportsAddReactionsInActionMenu&&!this.renderedInCompositeGallery()&&!this.renderedInStackGallery(),supportsForward:this._supportsForward,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,supportsSave:this._isMessageSent,saveAsCommand:void 0,openFileLocationCommand:u.canOpenFileLocation(this._messageProperties.skypeMessage)?g.CommandTypes.OpenMediaLocation:void 0,supportsRemove:this._defaultSupportsRemove,supportsBookmarks:this._defaultSupportsBookmark});return s=s.concat(e.actionMenuCommands),e.outerButtonCommands=this.getActionsForButtonsToBeRenderedInMessageView(t,this._defaultSupportsAddReactionInMessageView,!1).concat(e.outerButtonCommands),{actionMenuCommands:s,outerButtonCommands:e.outerButtonCommands}}}t.VideoMessageRenderingOptions=y,y.messageTypeGroup=r.MessageTypeGroups.Video;class _ extends a.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){const t={includeCursor:!0,overlayReactionsOnMessage:this._defaultSupportsShowingReactionsSummary&&this._enableReactionOverlay,messageContentSpacingStyle:m.messageContentSpacing,accessibilityLabelType:d.MessageAccessibilityType.Media};return i.assign({},e,t)}getMessageActions(e){const t=c.default.isUsingGogoNetwork(),s=n.default.getS4LMessagingFeaturesNoSubscription().enableAudioDownload;let i=this.getActionMenuCommands({supportsPostingReactions:this._defaultSupportsAddReactionsInActionMenu&&!this.renderedInCompositeGallery()&&!this.renderedInStackGallery(),supportsForward:this._supportsForward,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,supportsSave:s&&this._isMessageSent&&!t,saveAsCommand:void 0,supportsRemove:this._defaultSupportsRemove,supportsBookmarks:this._defaultSupportsBookmark});return i=i.concat(e.actionMenuCommands),e.outerButtonCommands=this.getActionsForButtonsToBeRenderedInMessageView(!1,this._defaultSupportsAddReactionInMessageView,!1).concat(e.outerButtonCommands),{actionMenuCommands:i,outerButtonCommands:e.outerButtonCommands}}}t.AudioMessageRenderingOptions=_,_.messageTypeGroup=r.MessageTypeGroups.Audio;class v extends a.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){return i.assign({},e,{renderMessageBackground:!1,showReactionsOnMessage:!1})}getMessageActions(e){let t=this.getActionMenuCommands({supportsRemove:this._defaultSupportsRemove,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,supportsBookmarks:this._defaultSupportsBookmark});return t=t.concat(e.actionMenuCommands),{actionMenuCommands:t,outerButtonCommands:e.outerButtonCommands}}}t.MojiRenderingOptions=v,v.messageTypeGroup=r.MessageTypeGroups.Moji;class C extends a.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){return i.assign({},e,{renderMessageBackground:!1,showReactionsOnMessage:!1})}getMessageActions(e){let t=this.getActionMenuCommands({supportsRemove:this._defaultSupportsRemove,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,supportsBookmarks:this._defaultSupportsBookmark});return t=t.concat(e.actionMenuCommands),{actionMenuCommands:t,outerButtonCommands:e.outerButtonCommands}}}t.StickerRenderingOptions=C,C.messageTypeGroup=r.MessageTypeGroups.Sticker;class b extends a.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){const t={renderMessageBackground:!1,overlayReactionsOnMessage:this._defaultSupportsShowingReactionsSummary&&this._enableReactionOverlay,showTouchFeedbackOnPress:!0,showOuterButtons:this._defaultSupportsAddReactionInMessageView||this._supportsForward,includeCursor:!0,accessibilityLabelType:d.MessageAccessibilityType.Media,sendingStatus:S(e.sendingStatus),availableSpace:this._messageProperties.containerMaxDimensions,calcRenderDim:(0,l.prepareMediaNodeDimensionsFunction)(this._messageProperties),isDraggingEnabled:this._defaultSupportsDragging};return i.assign({},e,t)}getMessageActions(e){let t=this.getActionMenuCommands({supportsPostingReactions:this._defaultSupportsAddReactionsInActionMenu,supportsSave:void 0,saveAsCommand:void 0,supportsForward:this._supportsForward,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,supportsRemove:this._defaultSupportsRemove,supportsBookmarks:this._defaultSupportsBookmark});return t=t.concat(e.actionMenuCommands),e.outerButtonCommands=this.getActionsForButtonsToBeRenderedInMessageView(this._supportsForward,this._defaultSupportsAddReactionInMessageView,!1).concat(e.outerButtonCommands),{actionMenuCommands:t,outerButtonCommands:e.outerButtonCommands}}}t.MediaAlbumRenderingOptions=b,b.messageTypeGroup=r.MessageTypeGroups.MediaAlbum},83503:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSaveToDirectoryLocalizationString=t.getSaveToDirectoryLocalizationKeys=t.isCommandSupported=t.canOpenFileLocation=void 0;const i=s(96486),o=(s(65976),s(51077)),n=s(98278),r=(s(73439),s(33754)),a=s(78735);function l(e){let t;if((0,o.getMessageTypeGroup)(e)===o.MessageTypeGroups.Picture)return{key:"StreamItem.OpenInNewTab",params:t,icon:n.SXMenuIcon.Open};const s=a.default.getUserPreferencesLocalNoSubscription();s&&s.fileDownloadDisplayNameDesktop&&(t={downloadFolder:s.fileDownloadDisplayNameDesktop});if(e&&e.isAlbum()){return{key:!1?"StreamItem.SaveAllToDownloadsCustomFolder":"StreamItem.SaveAll",params:t,icon:n.SXMenuIcon.SaveTo}}return{key:t?"StreamItem.SaveToDownloadsCustomFolder":"StreamItem.Save",params:t,icon:n.SXMenuIcon.SaveTo}}t.canOpenFileLocation=function(e){return!1},t.isCommandSupported=function(e,t){return!!e&&i.findIndex(e.actionMenuCommands,(e=>e===t))>-1},t.getSaveToDirectoryLocalizationKeys=l,t.getSaveToDirectoryLocalizationString=function(e){const t=l(e);return r.getString(t.key,t.params)}},64387:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(51077),n=s(86374),r=s(70891),a=s(46096),l=s(36237),d=s(45983),c=s(12762),h=s(53374);function u(e,t){let s={isEmpty:!e};return e&&(s={hasContent:e.content&&e.content.length>0,firstFourChars:e.content&&e.content.substr(0,4),contentType:e.contenttype,messageType:e.messagetype}),`Error decoding ${t} node from item with info ${JSON.stringify(s)}`}t.default=class{static getMediaDescriptorForItem(e){let t,s;switch(o.getMessageTypeGroup(e)){case o.MessageTypeGroups.Picture:s=n.decode(e);const i=s.getFirstUriObjectChild(c.PictureNode);t=this._getPictureDescriptor(i,e);break;case o.MessageTypeGroups.Video:s=n.decode(e);const r=s.getFirstUriObjectChild(c.VideoNode);t=this._getVideoDescriptor(r,e);break;case o.MessageTypeGroups.Audio:s=n.decode(e);const a=s.getFirstUriObjectChild(c.AudioNode);t=this._getAudioDescriptor(a,e)}return t}static _getPictureDescriptor(e,t){if(!e)return void l.error(a.LogTraceArea.MediaViewerPanel,u(t,"picture"));return{mediaType:d.MediaViewerTypes.Picture,thumbnailUrl:e.getDisplayThumbnailUrlSanitized(),displayResolutionUrl:e.getDisplayUrlSanitized(),fullResolutionUrl:e.getFullResolutionUrlSanitized(),downloadFileName:e.getNameForDownload(),originalSize:this._dimensionsForOptionalDimensions(e.getOriginalDimensions()),id:t.cuid,originalSizeInBytes:e.getSizeInBytes()}}static _getVideoDescriptor(e,t){if(!e)return void l.error(a.LogTraceArea.MediaViewerPanel,u(t,"video"));let s=e.getDisplayUrlSanitized(),i=e.getDisplayUrlMediaProvider();l.log(a.LogTraceArea.MediaViewerPanel,"Video "+i+" "+s);let o=e.getNameForDownload();return o||(o="video_"+h.default.newGuid()+".mp4",l.debug((()=>"MediaViewerUtils - received a file without downloadFileName, new value: "+o))),{mediaType:d.MediaViewerTypes.Video,thumbnailUrl:e.getDisplayThumbnailUrlSanitized(),downloadFileName:o,originalSize:this._dimensionsForOptionalDimensions(e.getOriginalDimensions()),videoUrl:s,id:t.cuid,videoProvider:i,amsReferences:t.amsreferences,originalSizeInBytes:e.getSizeInBytes()}}static _getAudioDescriptor(e,t){if(!e)return void l.error(a.LogTraceArea.MessageStream,u(t,"audio"));return{audioUrl:e.getDisplayUrlSanitized(),mediaType:d.MediaViewerTypes.Audio,downloadFileName:e.getNameForDownload(),id:t.cuid}}static isMediaItem(e){const t=o.getMessageTypeGroup(e);return(t===o.MessageTypeGroups.Picture||t===o.MessageTypeGroups.Video||e.messagetype===o.MessageTypes.CastRecording)&&o.contentContainsUriObjectExceptFile(e.content)}static isVideo(e){return o.getMessageTypeGroup(e)===o.MessageTypeGroups.Video}static isFile(e){return o.getMessageTypeGroup(e)===o.MessageTypeGroups.UriFile}static isLink(e){if(o.getMessageTypeGroup(e)===o.MessageTypeGroups.Text&&-1!==e.content.indexOf("<a ")){const t=n.decode(e);return t.getWebLinks()&&t.getWebLinks().length>0}return!1}static isSwiftCard(e){return o.getMessageTypeGroup(e)===o.MessageTypeGroups.SwiftCard}static isSwiftCardWithLink(e){if(o.getMessageTypeGroup(e)===o.MessageTypeGroups.SwiftCard){const t=n.decode(e).getFirstUriObjectChild(c.SwiftUriObjectNode);if(t&&t.swiftChild){const e=t.swiftChild.swiftMessage;if(e)return i.some(e.attachments,(e=>this.isSwiftCardAttachmentALink(e)))}}return!1}static isDecodedRootNodeASwiftCardWithLink(e){const t=e.getFirstUriObjectChild(c.SwiftUriObjectNode);if(t&&t.swiftChild){const e=t.swiftChild.swiftMessage;if(e)return i.some(e.attachments,(e=>this.isSwiftCardAttachmentALink(e)))}return!1}static isSwiftCardAttachmentALink(e){if(!e.content)return!1;if(e.content.tap&&e.content.tap.type===r.SwiftActionTypes.openUrl)return!0;if(e.content.images&&e.content.images[0]){let t=e.content.images[0].tap;if(t&&t.type===r.SwiftActionTypes.openUrl)return!0}return!1}static _dimensionsForOptionalDimensions(e){return i.isUndefined(e.width)||i.isUndefined(e.height)?void 0:{width:e.width,height:e.height}}}},47193:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives=t.getEditableContentFromEditableEntities=t.getEditableEntityFromInputEntityAndConsiderAlternatives=void 0;const i=s(96486),o=s(89391),n=s(32183),r=s(39597),a=s(97174),l=s(23944),d=s(26424);function c(e,t,s){let i=l.getEditableEntityFromInputEntity(e,t,s);if(!(e instanceof a.EmoticonEntity))return i;const n=o.default.getS4LMessagingFeaturesNoSubscription().enableImageCachingStoreForStatic,r=o.default.getS4LMessagingFeaturesNoSubscription().enableImageCachingStoreForAnimated;if(!n&&!r)return i;const d=i;return Object.assign(Object.assign({},d),{url:h(d.url,n,r)})}function h(e,t,s){if(i.isUndefined(e))return;const o=n.parseUrl(e);if(i.isUndefined(o))return e;if(o.type===d.EmoticonType.Static&&!t)return e;if(o.type===d.EmoticonType.Animated&&!s)return e;let a=r.default.requestEmoticon(e,o).result;return i.isUndefined(a)?e:n.getUrl(a.icon)}t.getEditableEntityFromInputEntityAndConsiderAlternatives=c,t.getEditableContentFromEditableEntities=function(e,t){return{entities:e,downStreamDataVersion:t}},t.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives=function(e,t){return e.map(((e,s)=>c(e,t,s)))}},32638:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.areNotificationsEnabled=t.getReasonForNotificationsDisabled=t.getLastReactionUserMri=t.sendRawMessageFromEntities=t.sendRawMessage=t.recomputeAndroidNotifications=t.getMessageNotificationType=t.getNotificationAction=t.getLatestMessageTimestamp=void 0;const i=s(96486),o=s(26999),n=s(97691),r=s(89391),a=s(51077),l=s(71830),d=s(62141),c=s(82261),h=s(82433),u=s(46096),p=s(36237),g=s(33754),m=s(78735),S=s(97223),f=s(13847),y=s(33326),_=s(33326),v=s(85207),C=s(22538),b=s(40363),T=s(78262),M=s(53374);function I(e){if((0,f.isLastMessageUpdateReaction)(e)){const t=e.getLastReactionTimeExcludingCurrentUser();if(t)return t}return e.createdTime}t.getLatestMessageTimestamp=I;const w={action:S.MessageNotificationAction.Ignore,snoozeUntil:void 0,notificationType:S.MessageNotificationType.RegularMessage};function P(e){return(0,f.isLastMessageUpdateReaction)(e)?S.MessageNotificationType.Reaction:e.isCurrentUserQuoted()?S.MessageNotificationType.Quote:e.isCurrentUserMentioned()?S.MessageNotificationType.Mention:S.MessageNotificationType.RegularMessage}t.getNotificationAction=function(e,t,s){return C.EnsureStarted([m.default]).then((()=>{const i=m.default.getUserPreferencesLocal();if(e&&!i.ignoreActiveEndpointFiltering)return p.log(u.LogTraceArea.Notifications,"Notification ignored, there is an active endpoint on another device"),w;{const e=t.getSubscription(),i=s.getMessageNotificationClass();return e===l.SubscriptionTypes.Muted?(p.log(u.LogTraceArea.Notifications,"Notification ignored, current chat is muted"),w):a.isAddMemberMessageType(s.messagetype)?{action:S.MessageNotificationAction.InterruptUser,snoozeUntil:void 0,notificationType:S.MessageNotificationType.AddToConversation}:i!==T.MessageNotificationClass.SystemInformational||t.isEncryptedThread()&&s.isE2eeHandshakeTypeAllowedForNotification()?t.isReactionsThread()?(p.log(u.LogTraceArea.Notifications,"Notification ignored, reactions thread"),w):t.isOneOnOne()||e!==l.SubscriptionTypes.Normal||i===T.MessageNotificationClass.MentionedOrQuoted||(0,f.isLastMessageUpdateReaction)(s)?a.isScheduledCallType(s.messagetype)?(p.log(u.LogTraceArea.Notifications,"Notification is from a scheduled call, inform user."),{action:S.MessageNotificationAction.InterruptUser,snoozeUntil:void 0,notificationType:S.MessageNotificationType.ScheduledCall}):d.default.getConversationMeta(t.id).then((e=>{if(!e||!e.counts)return p.log(u.LogTraceArea.Notifications,"Notification ignored, no counts"),w;const t=Number(e.counts.consumptionHorizonTimestamp),i=I(s);if(t>=i)return p.log(u.LogTraceArea.Notifications,"Notification ignored, message already viewed, consumptionHorizonTime ("+t+") >= newMessageTimestamp ("+i+")"),w;{const e=P(s);return p.log(u.LogTraceArea.Notifications,"Previous message is old, preparing to display current notification to user"),{action:S.MessageNotificationAction.InterruptUser,snoozeUntil:void 0,notificationType:e}}})).catch((()=>(p.log(u.LogTraceArea.Notifications,"Notification ignored, unknown failure"),w))):(p.log(u.LogTraceArea.Notifications,'Notification ignored, group message notification with no mention or quote ("smart" setting turned on)'),w):(p.log(u.LogTraceArea.Notifications,"Notification ignored, system info"),w)}}))},t.getMessageNotificationType=P;let k=!1;function A(e,t,s){1!==i.sum(i.map([t,s],(e=>void 0===e)))&&p.error(u.LogTraceArea.Notifications,"sendMessageInternal received invalid input");const r=n.Defer();return C.EnsureStarted([v.default,h.default]).then((()=>{const n=u.PostSource.ReplyFromNotification;let a;a=void 0!==t?c.createMessageInfoFromEscapedText(e,n,t):c.createMessageInfo(e,n,s);const l=a.messageForPosting.clientmessageid,d=v.default.postUpdated.subscribe((e=>{e.isFinished&&i.each(e.messagesForPosting,((e,t)=>{const s=e.clientmessageid;s===l&&(d.unsubscribe(),r.resolve(s))}))})),h={category:_.LocalNotificationIds.CHAT_ERROR_CATEGORY_IDENTIFIER,id:M.default.newGuid(),message:g.getString("Notifications.ReplyNotSent"),priority:o.NotificationPriority.Max};v.default.postMessage(a,h)})),r.promise()}function E(e=!1){const t=m.default.getUserPreferencesLocal();if(!t.enableChatNotifications)return u.MessageProcessResult.ChatNotificationsDisabled;t.disableChatNotificationsUntil}t.recomputeAndroidNotifications=function(e,t,s){if(b.default.getPlatformType()!==u.PlatformType.Android)return n.Resolved();if(k)return n.Resolved();const a=r.default.getS4LMessagingFeaturesNoSubscription().enableAndroidExpandedNotifications,l=a&&t;let d;if(s&&(s.enableExpandedNotifications=a),k=!0,1!==e.length||l)if(0===e.length)o.LocalNotifications.cancel({id:y.LocalNotificationIds.CHAT_CATEGORY_IDENTIFIER});else{if(!l){const t=e[e.length-1];o.LocalNotifications.cancel({id:t.conversationId+t.messageTimestamp}),o.LocalNotifications.cancel({id:y.LocalNotificationIds.CHAT_CATEGORY_IDENTIFIER})}let t=[],r=[],a="",c=!1,h=0;i.each(e,(e=>{let s={category:e.category,title:e.title,message:e.message,id:e.id};e.messageTimestamp>h&&(a=e.messageCreatorName||"",h=e.messageTimestamp,e.serviceSpecificData&&(c=e.serviceSpecificData.eventType===u.NotificationTypeAppLaunched.Reaction)),t.push(s),r.push(e.conversationId)}));const p=m.default.getUserPreferencesLocal();let S,f=!1;s&&!l&&(s.sound&&(S=s.sound),void 0!==s.enableVibration&&(f=s.enableVibration));const v={category:y.LocalNotificationIds.CHAT_CATEGORY_IDENTIFIER,id:l?y.LocalNotificationIds.CHAT_CATEGORY_IDENTIFIER:M.default.newGuid(),priority:o.NotificationPriority.Max,sound:S,silent:!S,enableVibration:f,enableExpandedNotifications:!!l,messageTimestamp:h};v.groupedNotifications=t,v.title=g.getString("Notifications.MultiNotificationTitle",{count:i.size(i.uniq(r))}),v.message=g.getString(c?"Notifications.MultiReactionNotificationMessage":"Notifications.MultiNotificationMessage",{creator:a||g.getString("Notifications.UnknownUser")}),v.enableLight=!!p.androidNotificationLight,v.icon=void 0,l&&s&&(_.printNotificationTrace(s,"recomputeAndroidNotification grouped current"),d=o.LocalNotifications.show(s)),_.printNotificationTrace(v,"recomputeAndroidNotification grouped");const C=o.LocalNotifications.show(v);d=d?n.all([C,d]).then(i.noop):C}else{const t=s||e[0];_.printNotificationTrace(t,"recomputeAndroidNotification single"),o.LocalNotifications.cancel({id:y.LocalNotificationIds.CHAT_CATEGORY_IDENTIFIER}),d=o.LocalNotifications.show(t)}return k=!1,d||n.Resolved()},t.sendRawMessage=function(e,t){return A(e,t,void 0)},t.sendRawMessageFromEntities=function(e,t){return A(e,void 0,t)},t.getLastReactionUserMri=function(e){const t=e.getCleanedEmotionAnnotations(),s=i.maxBy(i.flatMap(t,(e=>i.map(e.users,(e=>e)))),(e=>e.time||Number.MAX_VALUE));if(s)return s.mri},t.getReasonForNotificationsDisabled=E,t.areNotificationsEnabled=function(){return void 0===E()}},14572:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getMessageInitiator=t.isAddCurrentUserThreadActivity=void 0;const i=s(96486),o=s(51077),n=s(86374),r=s(12762),a=s(18078);t.isAddCurrentUserThreadActivity=function(e){if(!o.isAddMemberMessageType(e.messagetype))return!1;const t=n.decode(e),s=i.first(t.children);return s instanceof r.AddMemberNode&&!!i.find(s.content,(e=>a.default.isMyMri(e.getRawText())))},t.getMessageInitiator=function(e){const t=n.decode(e),s=t.children&&t.children.length>0?t.children[0]:void 0;if(s instanceof r.ThreadActivity){const e=s.initiator.getRawText();return e||void 0}}},29206:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getMessageRenderingOptions=void 0;const i=s(93733),o=s(51077),n=(s(51077),s(28229)),r=s(96919),a=s(53859);t.getMessageRenderingOptions=function(e){if(e.skypeMessage.isReported())return a.getReportedMessageRenderingOptions(e);const t=function(e,t){switch(t){case r.PictureMessageRenderingOptions.messageTypeGroup:return new r.PictureMessageRenderingOptions(e);case r.VideoMessageRenderingOptions.messageTypeGroup:return new r.VideoMessageRenderingOptions(e);case r.AudioMessageRenderingOptions.messageTypeGroup:return new r.AudioMessageRenderingOptions(e);case r.MojiRenderingOptions.messageTypeGroup:return new r.MojiRenderingOptions(e);case r.StickerRenderingOptions.messageTypeGroup:return new r.StickerRenderingOptions(e);case r.MediaAlbumRenderingOptions.messageTypeGroup:return new r.MediaAlbumRenderingOptions(e);case i.ScheduledCallRenderingOptions.messageTypeGroup:return new i.ScheduledCallRenderingOptions(e);case i.PollRenderingOptions.messageTypeGroup:return new i.PollRenderingOptions(e);case i.LocationRenderingOptions.messageTypeGroup:return new i.LocationRenderingOptions(e);case i.CallInfoRenderingOptions.messageTypeGroup:return new i.CallInfoRenderingOptions(e);case i.FileMessageRenderingOptions.messageTypeGroup:return new i.FileMessageRenderingOptions(e);case i.SwiftMessageRenderingOptions.messageTypeGroup:return new i.SwiftMessageRenderingOptions(e);case i.ContactMessageRenderingOptions.messageTypeGroup:return new i.ContactMessageRenderingOptions(e);case a.TextMessageRenderingOptions.messageTypeGroup:return new a.TextMessageRenderingOptions(e);case a.SystemMessageRenderingOptions.messageTypeGroup:return new a.SystemMessageRenderingOptions(e);case a.SMSMessageRenderingOptions.messageTypeGroup:return new a.SMSMessageRenderingOptions(e);case a.CallerIDRenderingOptions.messageTypeGroup:return new a.CallerIDRenderingOptions(e);case a.EngagementMessageRenderingOptions.messageTypeGroup:return new a.EngagementMessageRenderingOptions(e);case n.UnknownMessageTypeRenderingOptions.messageTypeGroup:default:return new n.UnknownMessageTypeRenderingOptions(e)}}(e,o.getMessageTypeGroup(e.skypeMessage));return t.getRenderingOptions()}},59405:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getMessageTimestamp=void 0;const i=s(97691),o=(s(96486),s(62141)),n=s(46096),r=s(36237),a=s(4057),l=s(14976);t.getMessageTimestamp=function(e,t){const s=e.MessageId,d=e.ServerMessageId?Number(e.ServerMessageId):void 0;return s?o.default.getMessageByCuid(t,s).then((e=>e?{timestamp:e.createdTime}:i.Rejected(void 0))).catch((e=>(r.log(n.LogTraceArea.ContentPanel,"_getMessageTimestamp could not fetch message conversationId="+l.mriOrId(t)+" cuid="+s+" id="+d+(e?" err="+a.default.errorAsString(e):"")),i.Resolved({timestamp:d,cuid:s})))):i.Resolved({timestamp:d})}},26378:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.shouldCancelMessageSelection=void 0,t.shouldCancelMessageSelection=function(e,t){return t!==e}},71639:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isFontLarge=t.isFontSmall=t.getStyle=t.getStyleFromStyle=t.getSize=t.getMultiplier=t.setFontSize=void 0;const i=s(2757),o=s(16778),n=s(89391),r=s(36237),a=s(6658),l=s(1246),d=s(78735);function c(e){const t=n.default.getS4LMessagingFeaturesNoSubscription().messageStreamFontSizeMultiplier;switch(e){case a.MessageStreamFontSize.Smaller:return t.smaller;case a.MessageStreamFontSize.Small:return t.small;case a.MessageStreamFontSize.Large:return t.large;case a.MessageStreamFontSize.Larger:return t.larger;case a.MessageStreamFontSize.Normal:default:return t.normal}}function h(e,t){return Math.round(e*c(t))}function u(e,t){return o.Styles.createTextStyle({fontSize:h(e,t)},!1)}t.setFontSize=function(e,t){d.default.setUserPreferencesLocal({messageStreamFontSize:e}),r.track(new l.FontSizeSetting(e,t))},t.getMultiplier=c,t.getSize=h,t.getStyleFromStyle=function(e,t){const s=i.default.getFontSize(e);if(s)return u(s,t)},t.getStyle=u,t.isFontSmall=function(e){return e===a.MessageStreamFontSize.Small||e===a.MessageStreamFontSize.Smaller},t.isFontLarge=function(e){return e===a.MessageStreamFontSize.Large||e===a.MessageStreamFontSize.Larger}},50353:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(97691),r=s(89391),a=s(76621),l=s(46096),d=s(36237),c=s(29510),h=s(81884),u=s(14976),p=s(22538);t.default=new class{constructor(){this._stores=new c.LinkedHashMap,this._removeLastCachedConversationOnGet=!1,this._conversationUpdatedCallback=e=>{i.each(e,(e=>{if(e.conv.isDeleted())if(e.conv.id===this._lastCachedConversationId)d.log(l.LogTraceArea.MessageStreamStoreCache,"Conversation updated callback for conversation delete"+u.mriOrId(e.conv.id)),this._removeLastCachedConversationOnGet=!0;else{const t=this._stores.remove(e.conv.id);t&&(d.log(l.LogTraceArea.MessageStreamStoreCache,"Destroying MessageStreamStore for "+u.mriOrId(e.conv.id)+" as conversation got deleted"),t.destroy())}}))},this._updateSettings=()=>{const e=r.default.getS4LMessagingFeaturesNoSubscription();this._maxCacheSize=e.messageStreamStoreCacheSize,this._maxMessageCountPerStore=e.messageStreamStoreCacheMaxMessageCount},this._destroyAllUnusedStores=()=>{for(d.log(l.LogTraceArea.MessageStreamStoreCache,"Destroying unused cached stores because of low memory");this._stores.length()>1;){this._stores.removeFirst().destroy()}},p.RegisterStartupable(this,"MessageStreamStoreCache",[a.default])}startup(){return r.default.subscribe(this._updateSettings),a.default.conversationsUpdated.subscribe(this._conversationUpdatedCallback),o.App.memoryWarningEvent.subscribe(this._destroyAllUnusedStores),this._updateSettings(),n.Resolved()}cachedStoreFor(e,t){if(this._removeLastCachedConversationOnGet){this._removeLastCachedConversationOnGet=!1;const e=this._stores.removeLast();e&&(d.log(l.LogTraceArea.MessageStreamStoreCache,"Destroying MessageStreamStore for "+u.mriOrId(e.getConversationId())+" as _removeLastCachedConversationOnGet == true for "+u.mriOrId(this._lastCachedConversationId)),e.destroy())}let s=this._stores.remove(e);const i=u.mriOrId(e)+" at="+(t||"EndOfTime");return s&&this._isCachedItemUseableFor(s,t)?d.log(l.LogTraceArea.MessageStreamStoreCache,"Reusing existing MessageStreamStore for "+i):(s&&s.destroy(),d.log(l.LogTraceArea.MessageStreamStoreCache,"Creating new MessageStreamStore for "+i+", was cached before: "+!!s),s=new h.MessageStreamStore(e,t)),this._removeStoresThatAreTooBigToBeCached(),this._removeFirstStoreIfNotEnoughSpace(),this._lastCachedConversationId=e,this._stores.addLast(e,s),s}_isCachedItemUseableFor(e,t){const s=e.getMessages();return 0===s.length?e.getTargetMessageTimestamp()===t:!(t&&i.first(s).createdTime>t||t&&i.last(s).createdTime<t||!t&&!e.isLatestMessageTheEnd())&&(!e.probablyShouldNotCache()||(d.log(l.LogTraceArea.MessageStreamStoreCache,"Invalidating MessageStreamStore for "+u.mriOrId(e.getConversationId())+" because it has a possible gap."),!1))}_removeStoresThatAreTooBigToBeCached(){const e=this._stores;for(this._stores=new c.LinkedHashMap;e.length()>0;){const t=e.removeFirst(),s=t.getMessages().length;s>this._maxMessageCountPerStore?(d.log(l.LogTraceArea.MessageStreamStoreCache,"Destroying MessageStreamStore for "+u.mriOrId(t.getConversationId())+" because its too big ("+s+" > "+this._maxMessageCountPerStore+" messages)"),t.destroy()):this._stores.addLast(t.getConversationId(),t)}}_removeFirstStoreIfNotEnoughSpace(){if(this._stores.length()>this._maxCacheSize){const e=this._stores.removeFirst();d.log(l.LogTraceArea.MessageStreamStoreCache,"Destroying MessageStreamStore for "+u.mriOrId(e.getConversationId())+" to free up space in the cache (max "+this._maxCacheSize+")"),e.destroy()}}}},53743:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GetEmoticonSuggestions=void 0;const i=s(96486),o=s(82433),n=s(97174),r=s(95868),a=s(26424);t.GetEmoticonSuggestions=function(e,t,s){const l=[];if(!t)return l;if(1===(e=e.toLowerCase()).length&&e[0]>="a"&&e[0]<="z")return l;const d=o.default.getEmoticonsNoSubscription(),c={};i.each(d,((t,s)=>{e.length>=s.length||0!==s.indexOf(e)||c[t.id]||(c[t.id]=s)}));let h=i.sortBy(c,(e=>e.length));if(0===h.length&&"("===i.first(e))if(i.last(e)===a.DiverseToneSeparator){const t=e.slice(0,-1)+")",s=d[t];if(s&&s.diverse)return i.each(a.DiverseToneSuffixes,(i=>{const o=new n.EmoticonEntity(t,s.id,i);l.push({entity:o,charsToReplace:e.length,replacementText:o.text()})})),l}else if(e.length>1&&":"===e.charAt(e.length-2)){const t=e.slice(0,-2)+")",s=d[t];if(s&&s.diverse){const o=r.default.getItemToneFromString(e.charAt(e.length-1));if(i.includes(a.DiverseToneSuffixes,o)){const i=new n.EmoticonEntity(t,s.id,o);l.push({entity:i,charsToReplace:e.length,replacementText:i.text()})}return l}}return h.length>s&&(h=h.slice(0,s)),i.each(h,(t=>{let s=o.default.getEmoticonByShortcutNoSubscription(t);if(!s)return;let i=new n.EmoticonEntity(t,s.id,s.tone);l.push({entity:i,charsToReplace:e.length,replacementText:t})})),l}},686:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getBackgroundColorStyleForMessage=void 0;const i=s(38933),o=s(16778),n=s(10102),r=s(23293),a=s(70891),l=s(89808),d=s(81760),c=s(63841),h=s(97634),u=s(66127);t.getBackgroundColorStyleForMessage=function(e){let t,s;e.postedByCurrentUser||e.theme===c.Theme.Mono?(t=l.default.getColorInfo(),s=l.default.getPrimaryColor()):(t=r.default.getColorInfo(e.messageCreatorMri),s=r.default.getPrimaryColor(e.messageCreatorMri));const p=e.flipBubbleColors&&!h.isAccessibleTheme(e.theme)&&!h.isDelphiTheme(e.theme),g=n.isMatchingColorInfo(t,n.SerializedColorByNumber.Rainbow),m=n.isCustomColor(t),S=!h.isAccessibleTheme(e.theme)&&(e.theme!==c.Theme.Mono||p)&&(g||m||p),f=e.messageRenderOrigin!==a.MessageRenderOrigin.StackGalleryCanvas&&e.messageRenderOrigin!==a.MessageRenderOrigin.CompositeGalleryCanvas,y=e.postedByCurrentUser&&f&&!S||!e.postedByCurrentUser&&p||e.postedByBot;let _,v,C=!!e.themeStyles.bubbleColorOtherStyle;const b=u.default.canModernizeConversationList();y?(_=e.postedByBot&&e.themeStyles.bubbleColorBotStyle?e.themeStyles.bubbleColorBotStyle:b?e.themeStyles.bubbleColorSelfStyleModernize:e.themeStyles.bubbleColorSelfStyle,v=[b?e.themeColors.bubbleColorSelfModernize:e.themeColors.bubbleColorSelf],C=!0):(v=n.subtleGradientColorsForColorInfo(t),_=e.postedByCurrentUser?b?e.themeStyles.bubbleColorSelfStyleModernize:e.themeStyles.bubbleColorSelfStyle:e.themeStyles.bubbleColorOtherStyle);const T=g?i.GradientDirection.BOTTOM_RIGHT:i.GradientDirection.RIGHT;let M,I,w,P=!0,k=e.themeStyles.secondaryTextColorStyle;return e.postedByBot&&e.themeStyles.bubbleTextColorBotStyle?(M=e.themeStyles.bubbleTextColorBotStyle,I=e.themeColors.bubbleTextColorBot,P=!1):e.postedByCurrentUser&&f&&!S||e.postedByCurrentUser&&!f&&h.isAccessibleTheme(e.theme)||!e.postedByCurrentUser&&p?(M=e.themeStyles.bubbleTextColorSelfStyle,I=e.themeColors.bubbleTextColorSelf,P=!1):e.themeStyles.bubbleTextColorOtherStyle?(M=e.themeStyles.bubbleTextColorOtherStyle,I=e.themeColors.bubbleTextColorOther,P=!1):(M=e.themeStyles.primaryTextColorStyle,I=e.themeColors.primaryTextColor),e.postedByCurrentUser||h.isDelphiTheme(e.theme)||(w=e.theme===c.Theme.AccessibleDark?M:o.Styles.createTextStyle({color:d.Color.white},!1)),{backgroundColorStyle:_,messageTextOverrideColorStyle:M,linkOverrideColorStyle:w,quoteAttributeOverrideColorStyle:k,gradientDirection:T,useColorBubbleForCurrentUserMessage:S,userIconBackgroundColor:e.messageStreamHasUnderlay?d.Color.transparent:e.themeColors.messageStreamBackgroundColor,gradientColors:v,disableGradient:C,useLightText:P,userPrimaryColor:s,quoteColor:I}}},66127:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(15069),o=s(89391),n=s(43632),r=s(60305),a=s(30124);t.default=new class{canModernizeConversationList(){const e=o.default.getS4LMessagingFeatures().modernizeConversationList;return e&&this._isSupportedPlatform()?r.default.isTablet()&&!a.default.isUsingStackNavigationContext():e}canSetEmoticonAvatarForGroup(){return o.default.getS4LMessagingFeatures().enableGroupProfileEmoticonPicker&&(0,n.canGenerateAvatars)()}canModernizeMobileHubFabs(){return this._isSupportedPlatform()&&o.default.getS4LMessagingFeatures().modernizeMobileHubFabs}canModernizeMobileTabHeader(){const e=o.default.getS4LMessagingFeatures().modernizeMobileTabHeader;return a.default.isUsingStackNavigationContext()&&e}canModernizeMobileTabHeaderTablets(){const e=o.default.getS4LMessagingFeatures().modernizeMobileTabHeader&&o.default.getS4LMessagingFeatures().modernizeMobileTopOfTheScreen;return r.default.isTablet()&&!a.default.isUsingStackNavigationContext()&&e}canModernizeMobileTab(){const e=o.default.getS4LMessagingFeatures().modernizeConversationList;return a.default.isUsingStackNavigationContext()&&e}canModernizeMobileTabHeaderNoSubscription(){const e=o.default.getS4LMessagingFeaturesNoSubscription().modernizeMobileTabHeader;return a.default.isUsingStackNavigationContextNoSubscription()&&e}canModernizeHubTabIcons(){return o.default.getS4LMessagingFeatures().modernizeConversationList}modernizeChatHeaderMobileVersion(){return this._isSupportedPlatform()&&!(r.default.isTablet()&&!a.default.isUsingStackNavigationContext())}_isSupportedPlatform(){return i.default.isMobile()&&o.default.getS4LUiFeatures().enableResponsiveDesign}}},44972:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isRegularMemberInModeratedGroup=t.isCurrentUserAdminInModeratedGroup=t.isModerated=t.moderatedChatsEnabled=void 0;const i=s(89391),o=s(18078);t.moderatedChatsEnabled=()=>i.default.getS4LMessagingFeatures().enableModeratedGroupChats;t.isModerated=e=>(0,t.moderatedChatsEnabled)()&&!!(null==e?void 0:e.isModerated());t.isCurrentUserAdminInModeratedGroup=e=>(0,t.isModerated)(e)&&!!(null==e?void 0:e.isAdmin(o.default.getSkypeMri()));t.isRegularMemberInModeratedGroup=e=>(0,t.isModerated)(e)&&!(null==e?void 0:e.isAdmin(o.default.getSkypeMri()))},83294:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getGifSwiftMessage=t.getInlineSearchPreviewDimensions=t.getGifAttribution=t.getNoSearchResultsAnnouncementKey=t.getSearchResultsAnnouncementKey=t.searchInPackDescriptionAndItemMetadata=t.searchInPackTitleAndDescription=t.searchInPackTitleAndItemKeyword=t.defaultTabType=void 0;const i=s(96486),o=s(31844),n=s(82433),r=s(70891),a=s(53559),l=s(33754),d=s(72666),c=s(26424),h=s(58962),u=s(13130),p=s(4057);function g(){return l.getString("PesPicker.TenorAttribution")}t.defaultTabType=h.TabType.Emoticon,t.searchInPackTitleAndItemKeyword=function(e,t){return t=p.default.deburr(t),i.map(e,(e=>{let s=i.filter(e.packs,(e=>!!e.description&&e.description.toLowerCase().indexOf(t)>-1));const o=i.differenceBy(e.packs,s,(e=>e.id));return s=i.map(o,(e=>{const s=i.filter(e.items,(e=>{const s=(o=e,n.default.getEmoticonByName(o));var o;if(s){const e=s.description&&p.default.deburr(s.description).toLowerCase().indexOf(t)>-1;let o,n;return e||(o=i.findIndex(s.keywords,(e=>p.default.deburr(e).indexOf(t)>-1))>-1),e||o||(n=i.findIndex(s.shortcuts,(e=>e.indexOf(t)>-1))>-1),e||!!o||!!n}return!1}));return Object.assign(Object.assign({},e),{items:s})})).concat(s),s=i.filter(s,(e=>e.items&&e.items.length>0)),Object.assign(Object.assign({},e),{packs:s})}))},t.searchInPackTitleAndDescription=function(e,t){return i.map(e,(e=>{let s=i.filter(e.packs,(e=>!!e.description&&e.description.toLowerCase().indexOf(t)>-1));const o=i.differenceBy(e.packs,s,(e=>e.id));return s=i.map(o,(e=>{const s=i.filter(e.items,(e=>{const s=(o=e,d.default.getMoji(o));var o;if(s){const e=s.pickerTitle&&s.pickerTitle.toLowerCase().indexOf(t)>-1,o=!e&&i.findIndex(s.keywords,(e=>e.indexOf(t)>-1))>-1;return e||o}return!1}));return Object.assign(Object.assign({},e),{items:s})})).concat(s),s=i.filter(s,(e=>e.items&&e.items.length>0)),Object.assign(Object.assign({},e),{packs:s})}))},t.searchInPackDescriptionAndItemMetadata=function(e,t){return i.map(e,(e=>{let s=i.filter(e.packs,(e=>!!e.description&&e.description.toLowerCase().indexOf(t)>-1));const o=i.differenceBy(e.packs,s,(e=>e.id));return s=i.map(o,(e=>{const s=i.filter(e.items,(e=>{const s=(i=e,u.default.getSticker(i));var i;if(s){const e=!!s.name&&s.name.toLowerCase().indexOf(t)>-1,i=!e&&!!s.description&&s.description.toLowerCase().indexOf(t)>-1;return e||i}return!1}));return Object.assign(Object.assign({},e),{items:s})})).concat(s),s=i.filter(s,(e=>e.items&&e.items.length>0)),Object.assign(Object.assign({},e),{packs:s})}))},t.getSearchResultsAnnouncementKey=function(e){switch(e){case h.TabType.Emoticon:return"PesSearch.SearchResultsAnnouncementEmoticons";case h.TabType.ChatSticker:return"PesSearch.SearchResultsAnnouncementStickers";case h.TabType.Moji:return"PesSearch.SearchResultsAnnouncementMojis";case h.TabType.Gif:return"PesSearch.SearchResultsAnnouncementGifs";default:return"PesSearch.DefaultPickerNoResultsSearchAccessibility"}},t.getNoSearchResultsAnnouncementKey=function(e){switch(e){case h.TabType.Emoticon:return"PesSearch.EmoticonPickerNoResultsSearchAccessibility";case h.TabType.ChatSticker:return"PesSearch.StickerPickerNoResultsSearchAccessibility";case h.TabType.Moji:return"PesSearch.MojiPickerNoResultsSearchAccessibility";case h.TabType.Gif:return"PesSearch.GifPickerNoResultsSearchAccessibility";default:return"PesSearch.DefaultPickerNoResultsSearchAccessibility"}},t.getGifAttribution=g,t.getInlineSearchPreviewDimensions=function(e,t){return t&&e===o.DeviceOrientation.Landscape?c.PesCarouselGifSizeLandscape:c.PesCarouselGifSizePortrait},t.getGifSwiftMessage=function(e){const t=g();return{type:r.SwiftMessageTypes.card,attachments:[{contentType:r.SwiftContentTypes.flex,content:{shareable:!0,subtitle:t,images:[{alt:e.title,url:e.full.url,tap:{type:r.SwiftActionTypes.showImage},type:a.default.imageContentTypes.gif,stillUrl:e.full.stillUrl,frames:e.full.frames}],aspect:e.full.width+":"+e.full.height,dimensions:{width:e.full.width,height:e.full.height}}}]}}},82677:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getReactionTone=t.isTonedReaction=t.getCustomReactionsStore=t.getReactionName=t.separateReactionNameAndTone=t.updateReactionNameWithTone=t.addRemoveReactionFromMessage=void 0;const i=s(71908),o=s(71830),n=s(51077),r=s(85329),a=s(17219),l=s(46096),d=s(36237),c=s(84912),h=s(95868),u=s(18078);function p(e,t){return t?e+":"+t:e}function g(e){return-1!==e.indexOf(":")&&(e=e.replace(/\:./,"")),e}function m(e){const t=e.indexOf(":");let s;return-1!==t&&(s=+e.charAt(t+1)),s?h.default.getItemToneFromNumber(s):void 0}function S(e,t,s,i){const o=e.reactionAction;o.success=s,t.recordReactionAdded(o),d.track(t),i&&i(!!o.success),o.success||d.error(l.LogTraceArea.ChatService,(e.reactionAction.reactionAdded,"react "))}t.addRemoveReactionFromMessage=function(e,t,s){const r=e.message;if(u.default.isMyMri(r.creator)||o.isPhoneMri(r.conversationId)||r.messagetype===n.MessageTypes.TeamsHtml)return;const a=e.reactionAction,l=p(a.reaction,a.reactionTone);a.reactionAdded?i.addEmotionAnnotation(r,l).then((()=>{S(e,t,!0,s)})).fail((()=>{S(e,t,!1,s)})):i.removeEmotionAnnotation(r,l).then((()=>{S(e,t,!0,s)})).fail((()=>{S(e,t,!1,s)}))},t.updateReactionNameWithTone=p,t.separateReactionNameAndTone=function(e){return{reactionTone:m(e),reactionNameWithoutTone:g(e)}},t.getReactionName=g,t.getCustomReactionsStore=function(e){return e===c.CustomReactionsType.Call?(0,r.default)():(0,a.default)()},t.isTonedReaction=function(e){return void 0!==m(e)},t.getReactionTone=m},55759:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.forwardContact=t.shareContact=void 0;const i=s(51077),o=s(82261),n=s(97174),r=s(23944),a=s(85207);t.shareContact=function(e,t,s){const r=new n.ContactEntity(e.skypeId,e.fullName,e.isPstn,e.skypeId,e.isS4B),l=o.createMessageInfo(t,s,[r],i.MessageTypes.Contacts);a.default.postMessage(l)},t.forwardContact=function(e,t,s){const l=r.encode([new n.ContactEntity(e.skypeId,e.fullName,e.isPstn,e.skypeId,e.isS4B)],!1,!1),d=o.createForwardMessageInfo(t,s,l,i.MessageTypes.Contacts);a.default.postMessage(d)}},5899:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(94011),n=s(19784),r=s(51077),a=s(81725),l=s(81725),d=s(82261),c=s(46096),h=s(97174),u=s(97174),p=s(36237),g=s(33754),m=s(12762),S=s(12056),f=s(10909),y=s(4735),_=s(95691),v=s(21090),C=s(85207),b=s(16392),T=s(32293),M=s(53374);class I{static getShareParametersForAdaptiveMessage(e,t,s){const n=t.getFirstUriObjectChild(m.SwiftUriObjectNode);if(n){const t=i.find(n.children,(e=>e instanceof m.AdaptiveCardNode));if(t&&t.adaptiveCardMessage){const i=()=>{o.TrackForwarding(e.creator)};return{messageContent:e.content,messageType:e.messagetype,adaptiveCardMessage:t.adaptiveCardMessage,conversationId:s,onShareCompleteForMessage:i}}}}static forwardDocument(e,t,s){const i=M.default.newCauseId();p.log(c.LogTraceArea.GenericUnsafe,"ShareMessageUtils.forwardMediaMessage, causeId: "+i);const o=this.getShareParametersForMedia(e,t,!0,s.rootViewId);o&&y.default.navigateToShareWithPanel({multipleMessagesParameters:[o],shareMessageTitle:g.getString("StreamItem.ForwardMessagesHeader",{count:1}),navigationDirection:b.StackNavigationDirection.Present,causeId:i,entryPoint:c.SharePanelEntryOrigin.DocumentActionMenu,sharePreviewType:_.SharePreviewType.File},s)}static showErrorForForwardMedia(e){n.default.showOKAlert(g.getString("ShareMessageUtils.FailedForwardMediaTitle"),g.getString("ShareMessageUtils.FailedFowardMediaDescription"),e)}static getShareParametersForSwiftMessage(e,t,s,o,n,r){const a=t.getFirstUriObjectChild(m.SwiftUriObjectNode);if(a){let s;const l=i.find(a.children,(e=>e instanceof m.SwiftNode));if(l&&l.swiftMessage){const a=i.map(l.swiftMessage.attachments,(e=>e.unsanitizedAttachment)),d={type:l.swiftMessage.type,summary:l.swiftMessage.summary,attachments:a},h=i.flatMap(a,(e=>T.default.getForwardMediaInfos(e))),u=()=>{o&&r&&y.default.navigateToConversation({convId:o,origin:c.NavigationConversationOrigin.SwiftForwardComplete,causeId:n})};if(!T.default.isSwiftCarousel(t)){const e=l.swiftMessage.attachments;e&&e.length&&(s=T.default.getImageUrl(e[0]))}return{messageContent:e.content,messageType:e.messagetype,swiftMessage:d,forwardMediaInfos:h,conversationId:o,onShareCompleteForMessage:u,localMediaThumbnailUri:s}}}}static shareSwiftMessageWithConfig(e){this._shareSwiftMessage(e.message,e.shareMessageTitle,e.sharePanelEntryOrigin,e.onShareComplete,e.onPostComplete,e.onShareCancel,e.conversationId,e.componentContext)}static getShareParametersForText(e,t,s){let i,o,n;const a=l.toForwardUrlInfo(e);return a?i=a.url:(n=t.hasOnlyQuotedContent(),o=l.toForwardQuoteMessageEntities(e)),{message:e,inputEntities:o,messageType:r.MessageTypes.RichText,onShareCompleteForMessage:t=>{const i=new S.ForwardedMessageTelemetry(e.conversationId,e,e.createdTime,s,S.MessageActionType.Forward,t);p.track(i)},urlPreviewData:a,url:i,sendAsForwardedQuote:n}}static getShareParametersForAlbumMsg(e,t,s){return{messageContent:d.createMediaAlbumMessage(e.conversationId,c.PostSource.ForwardAlbum,s).messageForPosting.content,messageType:r.MessageTypes.MediaAlbum,onShareCompleteForMessage:s=>{const i=new S.ForwardedMessageTelemetry(e.conversationId,e,e.createdTime,t,S.MessageActionType.Forward,s);p.track(i)},albumId:s}}static shareMultipleMessages(e,t,s,i,o,n,r,a){y.default.navigateToShareWithPanel({multipleMessagesParameters:e,shareMessageTitle:t,navigationDirection:b.StackNavigationDirection.Present,onShareComplete:o,causeId:s,sharePreviewType:r,showForwardPreview:a,entryPoint:i},n)}static getShareParametesForLocation(e,t){const s=l.toForwardLocationInfo(e);return{messageContent:e.content,messageType:r.MessageTypes.Location,onShareCompleteForMessage:s=>{const i=new S.ForwardedMessageTelemetry(e.conversationId,e,e.createdTime,t,S.MessageActionType.Forward,s);p.track(i)},locationInfo:s,localMediaThumbnailUri:s?s.snapshotUri:void 0}}static shareLocation(e,t,s){const i=[this.getShareParametesForLocation(e,t)],o=M.default.newCauseId();p.log(c.LogTraceArea.GenericUnsafe,"ShareMessageUtils.shareLocation, causeId: "+o),y.default.navigateToShareWithPanel({multipleMessagesParameters:i,shareMessageTitle:g.getString("StreamItem.ForwardLocationMessageHeader"),navigationDirection:b.StackNavigationDirection.Present,causeId:o,entryPoint:c.SharePanelEntryOrigin.LocationActionMenu,sharePreviewType:_.SharePreviewType.Location},s)}static getShareParametesForContactEntity(e,t,s){return{messageType:r.MessageTypes.Contacts,onShareCompleteForMessage:s||void 0,inputEntities:e,contactInfo:{skypeId:e.getSkypeId(),fullName:e.getFullName(),isPstn:e.isPstn(),isS4B:e.isS4B(),userMri:t}}}static getShareParametesForContactMessage(e,t,s){const i=l.toForwardContactInfo(e);if(!i)return;const o=new h.ContactEntity(i.skypeId,i.fullName,i.isPstn,i.isPstn?i.skypeId:"",i.isS4B);return{messageType:r.MessageTypes.Contacts,onShareCompleteForMessage:s||(s=>{const i=new S.ForwardedMessageTelemetry(e.conversationId,e,e.createdTime,t,S.MessageActionType.Forward,s);p.track(i)}),inputEntities:o,contactInfo:{skypeId:o.getSkypeId(),fullName:o.getFullName(),isPstn:o.isPstn(),userMri:i.userMri,isS4B:o.isS4B()}}}static shareContact(e,t,s,i){const o=M.default.newCauseId(),n=[this.getShareParametesForContactEntity(e,s,i)];y.default.navigateToShareWithPanel({multipleMessagesParameters:n,shareMessageTitle:g.getString("StreamItem.ForwardMessageContact"),navigationDirection:b.StackNavigationDirection.Present,causeId:o,entryPoint:c.SharePanelEntryOrigin.UserProfile,sharePreviewType:_.SharePreviewType.Contact,showForwardPreview:!1},t,!0)}static shareSwiftMessageToConversation(e,t,s){const i=new u.SwiftUriObjectEntity(e,t,!0,e.summary),o=d.createMessageInfo(t,c.PostSource.ShareSwiftMessage,[i],r.MessageTypes.Media_Card);C.default.postMessage(o),s&&s(e,{clientMessageId:o.messageForPosting.clientmessageid,conversationId:o.conversationId})}static shareAdaptiveMessageToConversation(e,t,s){const i=new u.AdaptiveUriObjectEntity(e,t,!0),o=d.createMessageInfo(t,c.PostSource.ShareSwiftMessage,[i],r.MessageTypes.Media_Card);C.default.postMessage(o),s&&s(e,{clientMessageId:o.messageForPosting.clientmessageid,conversationId:o.conversationId})}static shareMessageFromBrowser(e,t,s){const i=M.default.newCauseId();p.log(c.LogTraceArea.Navigation,"ShareMessageUtils.shareMessageFromBrowser, causeId: "+i),e.forward||!e.conversationId?I.shareSwiftMessageWithConfig({message:e.swiftMessage,shareMessageTitle:g.getString("InAppWebBrowser.ShareCardPanelTitle"),sharePanelEntryOrigin:c.SharePanelEntryOrigin.AddInMenu,onShareComplete:()=>{if(e.shareAndStay||y.default.closeInAppBrowser(i,s),e.showCompleteToast){const e=v.rootViewIdForComponentContext(s);f.default.scheduleTextMessage(g.getString("InAppWebBrowser.CardSharedTitle"),void 0,e)}},onPostComplete:t=>{e.onCardPostComplete&&e.onCardPostComplete(e,t)},onShareCancel:()=>{e.onShareCancel&&e.onShareCancel()},componentContext:s}):(e.shareAndStay||y.default.closeInAppBrowser(i,s),t?I.shareAdaptiveMessageToConversation(e.adaptiveMessage,e.conversationId,((t,s)=>{e.onCardPostComplete&&e.onCardPostComplete(e,[s])})):e.swiftMessage&&I.shareSwiftMessageToConversation(e.swiftMessage,e.conversationId,((t,s)=>{e.onCardPostComplete&&e.onCardPostComplete(e,[s])})))}static shareUrl(e,t,s,i,o,n,a){const l=M.default.newCauseId();p.log(c.LogTraceArea.GenericUnsafe,"ShareMessageUtils.shareUrl, causeId: "+l);const d={url:e,messageType:r.MessageTypes.RichText,conversationId:n};y.default.navigateToShareWithPanel({multipleMessagesParameters:[d],shareMessageTitle:t,navigationDirection:b.StackNavigationDirection.Present,onShareComplete:s,onPostComplete:i,onShareCancel:o,causeId:l,entryPoint:c.SharePanelEntryOrigin.InAppBrowserActionMenu,sharePreviewType:_.SharePreviewType.Text},a)}static shareUrlToConversation(e,t,s){const i=new u.LinkEntity(e,e),o=d.createMessageInfo(t,c.PostSource.ShareUrl,[i],r.MessageTypes.RichText);C.default.postMessage(o),s&&s({clientMessageId:o.messageForPosting.clientmessageid,conversationId:o.conversationId})}static shareUrlFromInAppBrowser(e,t){const s=M.default.newCauseId();p.log(c.LogTraceArea.Navigation,"ShareMessageUtils.shareUrlFromInAppBrowser, causeId: "+s),e.forward||!e.conversationId?I.shareUrl(e.url,g.getString("InAppWebBrowser.ShareLinkPanelTitle"),(()=>{if(e.shareAndStay||y.default.closeInAppBrowser(s,t),e.showCompleteToast){const e=v.rootViewIdForComponentContext(t);f.default.scheduleTextMessage(g.getString("InAppWebBrowser.LinkSharedTitle"),void 0,e)}}),(t=>{e.onUrlPostComplete&&e.onUrlPostComplete(e,t)}),(()=>{e.onShareCancel&&e.onShareCancel()}),void 0,t):(e.shareAndStay||y.default.closeInAppBrowser(s,t),I.shareUrlToConversation(e.url,e.conversationId,(t=>{e.onUrlPostComplete&&e.onUrlPostComplete(e,[t])})))}static sharePhoto(e,t,s,i,o,n,a,l,d,h){const u=M.default.newCauseId();p.log(c.LogTraceArea.GenericUnsafe,"ShareMessageUtils.sharePhoto, causeId: "+u);const g={localMediaObjectUri:e,localMediaThumbnailUri:t,fileSize:s,width:i,height:o,messageType:r.MessageTypes.UriObject,conversationId:l,cameraMode:d};y.default.navigateToShareWithPanel({multipleMessagesParameters:[g],shareMessageTitle:n,navigationDirection:b.StackNavigationDirection.Push,onShareComplete:a,causeId:u,entryPoint:c.SharePanelEntryOrigin.CapturePhotoOrVideo},h)}static shareVideo(e,t,s,i,o,n,a,l,d,h){const u=M.default.newCauseId();p.log(c.LogTraceArea.GenericUnsafe,"ShareMessageUtils.shareVideo, causeId: "+u);const g={localMediaObjectUri:e,localMediaThumbnailUri:t,fileSize:s,width:i,height:o,messageType:r.MessageTypes.Media_Video,conversationId:l,cameraMode:d};y.default.navigateToShareWithPanel({multipleMessagesParameters:[g],shareMessageTitle:n,navigationDirection:b.StackNavigationDirection.Push,onShareComplete:a,causeId:u,entryPoint:c.SharePanelEntryOrigin.CapturePhotoOrVideo},h)}static shareMediaSelection(e,t,s,i,o){const n=M.default.newCauseId();p.log(c.LogTraceArea.GenericUnsafe,"ShareMessageUtils.shareMediaSelection, causeId: "+n);const a={mediaSelection:e,messageType:e.node.node.isPhoto?r.MessageTypes.UriObject:r.MessageTypes.Media_Video,conversationId:i};y.default.navigateToShareWithPanel({multipleMessagesParameters:[a],shareMessageTitle:t,navigationDirection:b.StackNavigationDirection.Push,onShareComplete:s,causeId:n,entryPoint:c.SharePanelEntryOrigin.MessageActionMenu},o)}static _shareSwiftMessage(e,t,s,o,n,a,l,d){const h=M.default.newCauseId();p.log(c.LogTraceArea.GenericUnsafe,"ShareMessageUtils.shareSwiftMessage, causeId: "+h);const u=i.flatMap(e.attachments,(e=>T.default.getForwardMediaInfos(e))),g={swiftMessage:e,messageType:r.MessageTypes.Media_Card,forwardMediaInfos:u,conversationId:l,onShareCompleteForMessage:o};y.default.navigateToShareWithPanel({multipleMessagesParameters:[g],shareMessageTitle:t,navigationDirection:b.StackNavigationDirection.Present,onPostComplete:n,onShareCancel:a,causeId:h,entryPoint:s},d)}}t.default=I,I.getShareParametersForMedia=(e,t,s,i,o)=>{const n=a.toForwardMediaInfo(e);if(s&&!n)return void I.showErrorForForwardMedia(i);const r=Object.assign({},n);return{messageContent:e.content,messageType:e.messagetype,forwardMediaInfos:[r],onShareCompleteForMessage:s=>{const i=new S.ForwardedMessageTelemetry(e.conversationId,e,e.createdTime,t,S.MessageActionType.Forward,s);p.track(i)},localMediaThumbnailUri:r&&r.localMediaThumbnailUri,fileName:r&&r.filename,fileSize:r&&r.fileSize,fileType:r&&r.fileType,audioMessageDuration:r&&r.durationMs,albumId:o}}},94165:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(97691),n=s(51077),r=s(82261),a=s(46096),l=s(97174),d=s(33754),c=s(81157),h=s(95691),u=s(85207),p=s(15963),g=s(53374),m="image",S="video";class f{static processShareEvent(e,t=""){switch(e.type){case"text":return this._processTextShareEvent(e);case"media":return this._processMediaShareEvent(e,t);default:return g.default.switchStatementExhaustiveChecking(e.type)}}static _processTextShareEvent(e){return{multipleMessagesParameters:[{messageContent:e.text}],sharePreviewType:h.SharePreviewType.Text,directShareMri:e.directShareMri}}static _processMediaShareEvent(e,t){if(!e.data||i.isEmpty(e.data))return;return{multipleMessagesParameters:this._formatMediaMessageParameters(e.data,t),sharePreviewType:this._findMediaPreviewType(e.data),directShareMri:e.directShareMri}}static _formatMediaMessageParameters(e,t){return i.map(e,(e=>({localMediaThumbnailUri:t+(e.thumbnailUri||e.uri),fileName:e.name,fileSize:e.size})))}static _findMediaPreviewType(e){return i.every(e,(e=>e.type===m))?h.SharePreviewType.Photo:i.every(e,(e=>e.type===S))?h.SharePreviewType.Video:i.every(e,(e=>e.type===S||e.type===m))?h.SharePreviewType.MixedVideoAndPhoto:i.some(e,(e=>"file"===e.type))?h.SharePreviewType.File:h.SharePreviewType.Text}static postSharedMessage(e,t,s){return"media"===e.type?this._postSharedMedia(e.data,t,s):o.Resolved()}static _postSharedMedia(e,t,s){return c.default.postShareEventMediaSelections(e,t,{name:p.ScenarioName.ShareToSkypeMedia},s)}static getPreviewInfoTitle(e,t){return e&&1===e.length?e[0].fileName||"":this._getTitleWithShareItemsCount(e,t)}static _getTitleWithShareItemsCount(e,t){let s;switch(t){case h.SharePreviewType.Photo:s=d.getString("ShareWithPanel.PhotoCount",{count:e.length});break;case h.SharePreviewType.Video:s=d.getString("ShareWithPanel.VideoCount",{count:e.length});break;default:s=d.getString("ShareWithPanel.GenericCount",{count:e.length})}return s}static getPreviewInfoSizeInBytes(e){let t=0;return i.each(e,(e=>{e.fileSize&&(t+=e.fileSize)})),t}static sendPreviewTextMessage(e,t){const s=[new l.UnhandledEntity(t)];i.each(e,(e=>{u.default.postMessageFromInput(e,a.PostSource.ShareToSkype,s,n.MessageTypes.RichText,{name:p.ScenarioName.ForwardAdditionalText})}))}static shareMessageEntities(e,t,s,i=n.MessageTypes.RichText){const o=s?n.getForwardedTeamsProperties(s.properties):void 0,l=r.createForwardMessageInfoFromEntities(e,a.PostSource.ShareWith,t,i,o);return u.default.postMessage(l),{clientMessageId:l.messageForPosting.clientmessageid||"",conversationId:e}}static sendUrlAsLink(e,t){const s=[new l.LinkEntity(e,e)];return f.shareMessageEntities(t,s,void 0)}static sendUrlAsLinkMultipleConvs(e,t){i.each(t,(t=>{this.sendUrlAsLink(e,t)}))}}t.default=f},35455:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultEmoticonSize=t.getStickerUrl=t.StickerSize=void 0;const i=s(89391),o=s(58962),n=s(75865);var r;!function(e){e[e.ThumbLarge=0]="ThumbLarge",e[e.ThumbSmall=1]="ThumbSmall",e[e.ThumbNail=2]="ThumbNail",e[e.Large=3]="Large"}(r=t.StickerSize||(t.StickerSize={}));let a=i.default.getConfigSettingsNoSubscription().pes.rewriteRules;t.getStickerUrl=function(e,t,s,i,l){const d=o.rewriteUrl(e,a);let c;return c=t===r.ThumbLarge?`${d}/views/thumblarge?etag=${l||"v1"}`:t===r.ThumbSmall?`${d}/views/thumbsmall?etag=${l||"v1"}`:t===r.ThumbNail?`${d}/views/thumbnail?etag=${l||"v1"}`:`${d}/views/large?etag=${l||"v1"}`,n.default.getAuthenticatedUrl(c)},t.getDefaultEmoticonSize=function(){return r.ThumbLarge}},82176:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(89391),o=s(53559),n=s(78735),r=3600;t.default=class{static changeExtensionForTelemetry(e){const t=i.default.getAsyncMediaFeatures().max_extension_length;return e?e.length<=t?e:"..."+e.substr(-t).toLowerCase():""}static extractExtensionForTelemetry(e){const t=o.default.extractFileExtension(e,!0);return this.changeExtensionForTelemetry(t)}static currentMediaProfile(){const e=i.default.getS4LCMCFeatures().picturePrefetch;let t="Off";i.default.getS4LCMCFeatures().picturePrefetchEnabled&&(t=n.default.getUserPreferencesLocal().picturePrefetchMode||i.default.getS4LCMCFeatures().picturePrefetch.status);let s="ppref_"+t;if("Off"!==t){const t=Math.round(e.maxTimeIntervalPriorToStartupSec/r);s=s+"_"+e.maxQueuedEntriesCount+"_"+t+"h"}return s+"_"+("pcache_"+Math.round(i.default.getS4LCMCFeatures().picturePrefetchCacheExpiryTimeSec/r)+"h_vcache_"+Math.round(i.default.getS4LCMCFeatures().videoPrefetchCacheExpiryTimeSec/r)+"h")}}},53859:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EngagementMessageRenderingOptions=t.getReportedMessageRenderingOptions=t.CallerIDRenderingOptions=t.SMSMessageRenderingOptions=t.SystemMessageRenderingOptions=t.TextMessageRenderingOptions=void 0;const i=s(96486),o=s(16778),n=s(89391),r=s(51077),a=s(71830),l=s(28229),d=s(13991),c=s(70891),h=s(23944),u=s(15877),p=s(33754),g=s(12762),m=s(63032),S=s(6658),f=s(750),y=s(40363),_=s(60305),v=s(10609),C=(0,u.lazyProperties)({radius:()=>(0,u.lazyProperties)({currentUserUrlPreviewThumbnail:()=>o.Styles.createViewStyle({borderTopLeftRadius:S.messageBorderRadius,borderTopRightRadius:S.messageBorderRadius}),otherUserUrlPreviewThumbnail:()=>o.Styles.createViewStyle({borderTopLeftRadius:0,borderTopRightRadius:S.messageBorderRadius}),currentUserSubsequentMessage:()=>o.Styles.createViewStyle({borderTopRightRadius:0,borderBottomRightRadius:0}),currentUserSubsequentMessageRTL:()=>o.Styles.createViewStyle({borderTopLeftRadius:0,borderBottomLeftRadius:0}),othersSubsequentMessage:()=>o.Styles.createViewStyle({borderBottomLeftRadius:0}),othersSubsequentMessageRTL:()=>o.Styles.createViewStyle({borderBottomRightRadius:0})})});class b extends l.DefaultMessageRenderingOptions{constructor(e){super(e),this.messageProperties=e,e.isDisplayUrlPreviewsEnabled&&(this._urlPreviewData=v.getUrlPreviewInformationForMessage(e.skypeMessage,e.decodedNode),this._hasOnlyOneWebLink=v.hasOnlyWebLink(this._urlPreviewData,e.decodedNode),this._renderOnlyUrlPreview=this._hasOnlyOneWebLink&&this._urlPreviewData[0].isValid&&!e.decodedNode.isOnlyHyperLink())}_getTextMessageRadiusStyle(e){const t=y.default.isRTL();return this._messageProperties.skypeMessage.isBookmark()||(this._messageProperties.postedByCurrentUser?this._messageProperties.messageFirstInGroup||e.push(t?C.radius.currentUserSubsequentMessageRTL:C.radius.currentUserSubsequentMessage):this._messageProperties.messageLastInGroup||e.push(t?C.radius.othersSubsequentMessageRTL:C.radius.othersSubsequentMessage)),e}getMessageSpecificViewRenderingOptions(e){const t=this._messageProperties.skypeMessage.isEmote(),s=this._messageProperties.decodedNode.hasOnlyEmoticonsOrWhitespaceText(),o=n.default.getS4LMessagingFeaturesNoSubscription().enableNewEmoticonBackgroundRenderLogic?this._messageProperties.decodedNode.hasOnlyEmoticonsOrSpaceChars():s,a=this._messageProperties.decodedNode.hasOnlyUnicodeEmoji(),l=this._messageProperties.decodedNode.getNumberOfEmoticons(),d=this._messageProperties.decodedNode.getNumberOfUnicodeEmoji(),c=!(t||o&&l<=3||a&&d<=3),h=!t&&!this._messageProperties.postedByCurrentUser&&this._messageProperties.skypeMessage.isCurrentUserMentioned(!0)&&!r.hasQuote(this._messageProperties.skypeMessage.content),u=this._messageProperties.skypeMessage.isEdited(),p=this._defaultSupportsShowingReactionsSummary&&!s&&!a;return i.assign({},e,{renderMessageBackground:c,messageContentCentered:t,messageContainerRadiusStyle:e.messageContainerRadiusStyle&&this._getTextMessageRadiusStyle(e.messageContainerRadiusStyle),showReactionsOnMessage:p,overlayReactionsOnMessage:p&&this._enableReactionOverlay,showAtMentionIcon:h,overrideLongPressForLinks:!1,showEditIndicator:u},this._messageProperties.decodedNode.hasHtmlContent()?{availableSpace:this._messageProperties.containerMaxDimensions,calcRenderDim:(e,t)=>e}:{})}getMessageActions(e){const t=this._defaultSupportsAddReactionsInActionMenu&&!this._messageProperties.decodedNode.hasOnlyEmoticonsOrWhitespaceText()&&!this._messageProperties.decodedNode.hasOnlyUnicodeEmoji(),s=!this._messageProperties.skypeMessage.isEmote(),i=this._messageProperties.decodedNode.hasOnlyQuotedContent(),o=this._messageProperties.decodedNode.hasOnlyEmoticonsOrWhitespaceText(),n=this._messageProperties.decodedNode.hasOnlyUnicodeEmoji(),r=this._defaultSupportsAddReactionInMessageView&&this._defaultSupportsShowingReactionsSummary&&!o&&!n,a=this._messageProperties.hasTranslation,l=this._messageProperties.decodedNode.hasHtmlContent(),d=!i&&s&&!this._messageProperties.isReadOnly&&!this.renderedInCompositeGallery()&&!this.renderedInStackGallery()&&(!l||this._messagingFeatures.enableQuotingHtmlMessages),c=super.getActionMenuCommands({supportsPostingReactions:t&&!this.renderedInCompositeGallery()&&!this.renderedInStackGallery(),supportsForward:this._supportsForward&&(!i||this._messagingFeatures.enableForwardingQuotes)&&(!l||this._messagingFeatures.enableForwardingHtmlMessages)&&s,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,supportsRemove:this._defaultSupportsRemove,supportsEdit:this.supportsEdit(),supportsQuotes:d,supportsQuotesSelection:d&&!a,copyCommand:this._defaultSupportsCopy?f.CommandTypes.Copy:void 0,supportsBookmarks:this._messagingFeatures.enableBookmarks,supportsTranslation:this._messageProperties.hasTranslation&&_.default.isTablet()});return e.actionMenuCommands=c.concat(e.actionMenuCommands),r&&(e.outerButtonCommands=this.getActionsForButtonsToBeRenderedInMessageView(!1,this._defaultSupportsAddReactionInMessageView,!0).concat(e.outerButtonCommands)),e}renderOnlyUrlPreview(){return this._renderOnlyUrlPreview}supportsEdit(){const e=this._messageProperties.decodedNode instanceof g.NgcUpgradeSystemMessageNode;return this._defaultSupportsEdit&&(!!this._messageProperties.postedByCurrentUser||!!this._messageProperties.isModerator)&&!this.renderedInStackGallery()&&!this.renderedInCompositeGallery()&&!e&&!this._messageProperties.isReadOnly&&!a.isS4BBridgeMri(this._messageProperties.skypeMessage.conversationId)}getUrlPreviewRenderInformation(e,t){if(i.isEmpty(this._urlPreviewData)||this._messageProperties.skypeMessage.isEmote())return[];const s=[],o=this._defaultSupportsPostingReactions&&this._renderOnlyUrlPreview,n=this._defaultSupportsShowingReactionsSummary&&this._renderOnlyUrlPreview,r=e.sendingStatus===m.MessageRenderSendingStatus.Sending;return i.each(this._urlPreviewData,(a=>{if(a&&a.isValid){const l={renderMessageBackground:!1,showMessageSender:e.showMessageSender&&this._renderOnlyUrlPreview,showMessageSenderIcon:e.showMessageSenderIcon&&this._renderOnlyUrlPreview,showMessageTimestamp:e.showMessageTimestamp&&this._renderOnlyUrlPreview,sendingStatus:!this._renderOnlyUrlPreview&&r?m.MessageRenderSendingStatus.None:e.sendingStatus,obfuscateUrlPreview:!this._messageProperties.postedByCurrentUser&&!this._messageProperties.isConversationAccepted,urlPreviewThumbnailRadiusStyle:this._messageProperties.postedByCurrentUser&&!this.renderedInStackGallery()?C.radius.currentUserUrlPreviewThumbnail:C.radius.otherUserUrlPreviewThumbnail,showOuterButtons:this._outerButtonsFit,skipAccessibilityLabelForMessageView:!0,accessibilityLabelType:c.MessageAccessibilityType.Url,showReactionsOnMessage:n,overlayReactionsOnMessage:n&&this._enableReactionOverlay,availableSpace:this._messageProperties.containerMaxDimensions,calcRenderDim:d.getUrlPreviewNodeRenderDimensions},h=this._defaultSupportsCopy?f.CommandTypes.CopyLink:void 0,u=this.getActionMenuCommands({copyCommand:h,supportsBookmarks:this._defaultSupportsBookmark}),g=this._renderOnlyUrlPreview?this.getActionMenuCommands({supportsPostingReactions:o&&(this._messageProperties.screenReaderEnabled||!this._outerButtonsFit),supportsForward:this._supportsForward,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,supportsRemove:this._defaultSupportsRemove,supportsEdit:this.supportsEdit(),supportsQuotes:!this.renderedInCompositeGallery()&&!this.renderedInStackGallery()&&!this._messageProperties.isReadOnly,copyCommand:h,supportsBookmarks:this._defaultSupportsBookmark}).concat(t.actionMenuCommands):u,S=i.truncate(a.url,{length:100,omission:p.getString("Global.TruncationText")}),y={outerButtonCommands:this._outerButtonsFit?this.getActionsForButtonsToBeRenderedInMessageView(this._supportsForward&&this._renderOnlyUrlPreview,this._defaultSupportsAddReactionInMessageView&&this._renderOnlyUrlPreview,!0).concat(t.outerButtonCommands):[],actionMenuCommands:g,actionMenuTitle:S},_={viewRenderOptions:i.assign({},e,l),urlPreviewActions:y,urlPreviewData:a};s.push(_)}})),s}}t.TextMessageRenderingOptions=b,b.messageTypeGroup=r.MessageTypeGroups.Text;class T extends l.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){return i.assign({},e,{renderMessageBackground:!1,messageContentCentered:!0,showReactionsOnMessage:!1,showMessageSender:!1,showMessageSenderIcon:!1,showMessageTimestamp:!1})}getMessageActions(e){}}t.SystemMessageRenderingOptions=T,T.messageTypeGroup=r.MessageTypeGroups.System;class M extends l.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){const t=r.getSmsDeliveryReport(this._messageProperties.skypeMessage.properties);if(this._messageProperties.decodedNode.children.length>0){const s=!h.hasOnlyEmoticonsOrWhitespaceText(this._messageProperties.decodedNode.children[0]);return i.assign({},e,{renderMessageBackground:s,smsDeliveryStatus:t})}return e}getMessageActions(e){const t=!this._messageProperties.isReadOnly&&!this.renderedInCompositeGallery()&&!this.renderedInStackGallery(),s=r.getSmsDeliveryReport(this._messageProperties.skypeMessage.properties),i=s&&!r.isSmsDeliveredSuccessfully(s),o=super.getActionMenuCommands({supportsForward:this._supportsForward,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,copyCommand:this._defaultSupportsCopy?f.CommandTypes.Copy:void 0,supportsQuotes:t,supportsQuotesSelection:t,supportsRemove:i,supportsBookmarks:this._defaultSupportsBookmark});return e.actionMenuCommands=o.concat(e.actionMenuCommands),e}}t.SMSMessageRenderingOptions=M,M.messageTypeGroup=r.MessageTypeGroups.SMS;class I extends l.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){return i.assign({},e,{renderMessageBackground:!1,messageContentCentered:!0,showReactionsOnMessage:!1,showMessageSender:!1,showMessageSenderIcon:!1,showMessageTimestamp:!1,messageContentExpandedToAvailableArea:!0,includeAccessibilityPropertiesOnMessageHeader:!1,skipAccessibilityLabelForMessageView:!1})}getMessageActions(e){const t=super.getActionMenuCommands({supportsForward:!1,supportsSelectMessages:!1,copyCommand:void 0,supportsQuotes:!1,supportsQuotesSelection:!1,supportsRemove:!1,supportsBookmarks:!1});return e.actionMenuCommands=t.concat(e.actionMenuCommands),e}}t.CallerIDRenderingOptions=I,I.messageTypeGroup=r.MessageTypeGroups.CallerID;class w extends b{getMessageSpecificViewRenderingOptions(e){return i.assign({},e,{renderMessageBackground:!0})}getMessageActions(e){return{actionMenuCommands:[f.CommandTypes.ShowReported],outerButtonCommands:[]}}}t.getReportedMessageRenderingOptions=function(e){const t=new w(e);return i.assign({},t.getRenderingOptions(),{renderOnlyUrlPreview:void 0,urlPreviewRenderInformation:[]})};class P extends l.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){return e}getMessageActions(e){return e}}t.EngagementMessageRenderingOptions=P,P.messageTypeGroup=r.MessageTypeGroups.Engagement},53332:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(89391),o=s(52115),n=s(78262);t.default=class{static reencodeOptions(){const e=i.default.getS4LCMCFeatures().videoReencodeConfig;return{profile:e.profile,maxFileSize:o.default.getMaximumFileSizeForType(n.UploadFileType.File),highQualitySource:e.highQualitySource,customWidth:e.outputWidth,customHeight:e.outputHeight,customVideoBitrate:e.videoBitrate,customAudioBitrate:e.audioBitrate,minSizeDecreaseRatio:e.minSizeDecreaseRatio}}static shouldReencodeUpload(e,t){return e===n.UploadFileType.VideoMessage&&t}}},72918:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(89391),n=s(20603),r=s(65976),a=s(62141),l=s(46096),d=s(54799),c=s(94214);class h extends d.ImageCookieSetterService{constructor(){super("AmsImageCookieService",a.InternalKeys.AMSCookieSkypeToken,l.LogTraceArea.AsyncMediaClient,o.default.getAsyncMediaFeatures().ams_base_url,r.AmsCookieName)}setCookieFlag(e){c.default.setAMSCookieSet(e)}sendAuthCookieRequest(e){return n.default.setAuthCookie(e).then(i.noop)}}t.default=new h},66737:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AppActivity=void 0;const i=s(96486),o=s(16778),n=s(60),r=s(62141),a=s(98754),l=s(80457),d=s(40363);class c{constructor(e){this._maxValues=e,this._history=[]}getHistory(){return this._history}setHistory(e){this._history=i.takeRight(e,this._maxValues)}addActivity(e,t=Date.now()){this._history.push({timestamp:t,activity:e}),this.setHistory(this._history)}getDuration(e,t,s,o){let n=0,r=0;return s<=e?0:(i.each(this._history,(a=>{if(!n&&a.timestamp<s&&i.includes(t,a.activity))n=a.timestamp;else if(n&&i.includes(o,a.activity)){if(a.timestamp>=e){const t=a.timestamp<=s?a.timestamp:s;r+=e>n?t-e:t-n}n=0}})),n&&n<s&&(r+=s-(e>n?e:n)),r)}hasActivity(e,t,s){return i.some(this._history,(o=>o.timestamp>=e&&o.timestamp<=t&&i.includes(s,o.activity)))}}var h;!function(e){e[e.Start=1]="Start",e[e.Exit=2]="Exit",e[e.Foreground=3]="Foreground",e[e.Background=4]="Background"}(h=t.AppActivity||(t.AppActivity={}));t.default=new class{constructor(){this._history=new c(10)}init(e,t,s,i){const o=a.default.getDataExclusive(r.InternalKeys.AppActivity);this._history.setHistory(o?o.slice():[]),this._postingTrigger=l.PostingTrigger.None,e.subscribe((()=>{this._appStateSub||this._subscribeAppState()})),t.subscribe((()=>{const e=i();e&&!this._appStateSub?this._subscribeAppState():!e&&this._appStateSub&&(this._appStateSub.unsubscribe(),this._appStateSub=void 0,this._history.setHistory([]),this._lastActivity=void 0)})),s.subscribe((()=>{this._postingTrigger=l.PostingTrigger.None}))}getBackgroundTime(e,t=Date.now()){return this._history.getDuration(e,[h.Background],t,[h.Foreground,h.Exit])}hasAppStart(e,t=Date.now()){const s=d.default.getAppInitTime();return s>=e&&s<=t}getPostingTrigger(){return this._postingTrigger}setPostingTrigger(e){this._postingTrigger=e}test_setData(e){this._history.setHistory(e)}_subscribeAppState(){this._addActivity(this._fromActivationState(o.App.getActivationState())),this._appStateSub=n.default.subscribeForChanges("AppActivityHistoryService",(e=>{this._addActivity(this._fromActivationState(e)),e===o.Types.AppActivationState.Active&&(this._postingTrigger=l.PostingTrigger.None)}))}_fromActivationState(e){return e===o.Types.AppActivationState.Background?h.Background:h.Foreground}_addActivity(e){e!==this._lastActivity&&(this._lastActivity=e,this._history.addActivity(e),a.default.putData(r.InternalKeys.AppActivity,this._history.getHistory()))}}},53338:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(74958),o=s(96486),n=s(16778),r=s(97691),a=s(89391),l=s(22801),d=s(76621),c=s(71830),h=s(98278),u=s(91114),p=s(31751),g=s(92758),m=s(39549),S=s(52262),f=s(46096),y=s(36237),_=s(33754),v=s(10909),C=s(30124),b=s(27357),T=s(86045),M=s(22538),I=s(78735);t.default=new class{constructor(){M.RegisterStartupable(this,"ArchiveConversationService",[d.default,S.default,m.default,p.default])}startup(){return d.default.messagesProcessed.subscribe((e=>{o.each(e,(e=>{if(!e.isMutated()){const t=(0,m.default)().getConversation(e.conversationId);t&&this._possiblyUnarchiveConversation(t,e)}}))})),r.Resolved()}_possiblyUnarchiveConversation(e,t){const s=e.getConversationProperty(c.ConversationProps.Archived);let o=!1;if(a.default.getEngagementFeatures().conciergeBotSettings.enableVisibility&&c.isConciergeBotMri(t.creator)){o=!I.default.getUserPreferencesLocalNoSubscription().enableInAppEngagementNotifications||!t.isAllowedEngagementBotMessage()}s&&!o&&s<t.createdTime&&(y.log(f.LogTraceArea.ArchiveConversation,"ArchiveConversationService._possiblyUnarchiveConversation: Attempting to unarchive "+i.pii.Mri(t.conversationId)+" origin: "+f.UnarchiveConversationOrigin[f.UnarchiveConversationOrigin.ConversationUpdate]),this._setConversationArchived(e,!1).then((()=>{const s=b.default.getActiveConversationId(h.MainRootViewId);!C.default.isUsingStackNavigationContextNoSubscription()&&s===t.conversationId&&g.default.setConversationsListMode(g.ConversationsListMode.AllConversations),this._announceForAccessibility(e.id,!1),this._trackConversationUnarchived(e,f.UnarchiveConversationOrigin.ConversationUpdate)})))}_setConversationArchived(e,t){if(e.isOneOnOne()&&a.default.getS4LMessagingFeatures().enableGroupedConversations){const s=o.map(p.default.getAllSiblingConversations(e.id),(e=>l.default.setConversationArchived(e.id,t)));return r.all(s).then(o.noop)}return l.default.setConversationArchived(e.id,t)}_announceForAccessibility(e,t){if(T.default.shouldAnnounceForAccessibility()){const s=S.default.getDisplayName(e)||"",i=_.getString("AccessibilityLabel.ConversationHiddenAnnouncement",{conversationName:s}),o=_.getString("AccessibilityLabel.ConversationUnhiddenAnnouncement",{conversationName:s}),r=t?i:o;n.Accessibility.announceForAccessibility(r)}}_showUndoArchiveToast(e,t){const s={duration:5e3,textMessage:_.getString("HideConversation.ToastMessage"),actionLabel:_.getString("HideConversation.ToastUndoLabel"),key:"undo_archive_conversation",onPress:this.unarchiveConversation.bind(this,e,f.UnarchiveConversationOrigin.UndoPill),rootViewId:t};v.default.scheduleMessage(s)}_trackConversationArchived(e,t){y.track(new u.ConversationArchived(e.id,t,e.isOneOnOne()))}_trackConversationUnarchived(e,t){y.track(new u.ConversationUnarchived(e.id,t,e.isOneOnOne()))}archiveConversation(e,t,s){y.log(f.LogTraceArea.ArchiveConversation,"Attempting to archive "+i.pii.Mri(e)+" origin: "+f.ArchiveConversationOrigin[t]);const o=(0,m.default)().getConversation(e);o&&this._setConversationArchived(o,!0).then((()=>{this._announceForAccessibility(e,!0),this._showUndoArchiveToast(e,s),this._trackConversationArchived(o,t)}))}unarchiveConversation(e,t){y.log(f.LogTraceArea.ArchiveConversation,"Attempting to unarchive "+i.pii.Mri(e)+" origin: "+f.UnarchiveConversationOrigin[t]);const s=(0,m.default)().getConversation(e);s&&this._setConversationArchived(s,!1).then((()=>{this._announceForAccessibility(e,!1),this._trackConversationUnarchived(s,t)}))}}},46549:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.maxConcurrentDownloads=void 0;const i=s(96486),o=s(74634),n=s(97691),r=s(6452),a=s(46096),l=s(36237),d=s(16724),c=s(22538),h=s(82176),u=s(53374);t.maxConcurrentDownloads=2;t.default=new class{constructor(){this.downloadCancelled=new o.default,this._pendingItems=[],this._downloadingItems=[],c.RegisterStartupable(this,"AutoDownloadService",[r.default])}startup(){return r.default.downloadUpdated.subscribe((e=>{this._handleFileDownloadUpdate(e)})),n.Resolved()}isQueued(e){const t=[...this._pendingItems,...this._downloadingItems];return!i.isEmpty(i.find(t,(t=>t.key===e)))}cancelDownload(e){const t=i.find(this._downloadingItems,(t=>t.key===e));t&&this._cancelDownloadForKey(t.key)}cancelDownloadsByTag(e){i.each(i.cloneDeep(this._downloadingItems),(t=>{t.tag===e&&this._cancelDownloadForKey(t.key)})),i.each(i.cloneDeep(this._pendingItems),(t=>{t.tag===e&&i.remove(this._pendingItems,(t=>t.tag===e))}))}downloadItem(e){this.isQueued(e.key)||(this._pendingItems.push(e),this._downloadNext())}hasDownloadsOnQueue(e){return i.some([...this._downloadingItems,...this._pendingItems],["tag",e])}_removeItemFromDownloads(e){i.remove(this._downloadingItems,(t=>t.key===e))}_cancelDownloadForKey(e){this._isDownloading(e)&&(r.default.cancelDownloadForKey(e,this._genCauseId()),this.downloadCancelled.fire(e),this._removeItemFromDownloads(e))}_isDownloading(e){return r.default.isDownloading(e)}_genCauseId(){return u.default.newCauseId()}_downloadItem(e){this._downloadingItems.push(e),r.default.downloadAmsContentToPublicFolder(e.key,e.filename,e.url,this._genCauseId(),void 0,e.encryptionData)}_downloadNext(){if(this._downloadingItems.length>=t.maxConcurrentDownloads)return;const e=this._pendingItems.shift();e&&this._downloadItem(e)}_handleFileDownloadUpdate(e){if(e.isFinished){const t=i.find(this._downloadingItems,(t=>t.key===e.key));t&&(this._removeItemFromDownloads(t.key),this._downloadNext(),e.downloadTransfer&&e.downloadTransfer.success?this._sendTelemetryEvent(!0,a.MessagingFailureReason.None,e):this._sendTelemetryEvent(!1,a.MessagingFailureReason.AMSFailure,e))}}_sendTelemetryEvent(e,t,s){const i=s.targetUri||"",o=new d.FileReceived(i,void 0,h.default.extractExtensionForTelemetry(s.filename));o.setDownloadDuration(Date.now()-s.startTime),o.setIntent(a.MediaDownloadIntent.AutoDownload),o.setSuccess(e,t,s.finishedAttemptsSoFar,s.responseStatusCode),l.track(o)}}},33598:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.subscriberType=void 0;const i=s(96486),o=s(62520),n=s(97691),r=s(89391),a=s(44135),l=s(94224),d=s(46096),c=s(73439),h=s(53559),u=s(69382),p=s(36237),g=s(17791),m=s(22538),S=s(26712);t.subscriberType="backgroundEffects_downloader";t.default=new class{constructor(){this._queue={},this._items={},this._backgroundEffecs=[],this._downloadItemsFromEcs=()=>{const{backgroundEffects:e}=r.default.getS4LCMCFeatures();(this._isBackgroundReplacementCapable()||e)&&(this._backgroundEffecs=e.filter((e=>!!e.url&&"gif"!==h.default.extractFileExtension(e.url,!0))),this._backgroundEffecs.forEach((e=>this._maybeDownloadItem(e))))},this._maybeDownloadItem=e=>{if(!g.default.isNetworkConnected())return;const{category:t,filename:s,url:o}=this._getFileNameAndCategory(e.url),n=i.filter(this._items,(e=>e.originalUrl===o));if(i.isEmpty(n)||"remove"!==e.action||i.each(n,(e=>{const t={fileUri:e.localUri,fileSizeInBytes:e.sizeInBytes,lastUpdatedTime:e.lastUpdatedTimestamp};return u.fileExists(t).then((t=>{if(t)c.default.removeTrackedFile(c.default.getBackgroundEffectPrefix(e.localUri));else{const t=c.default.getBackgroundEffectPrefix(e.localUri);l.default.DeviceStore.getBackgroundEffectType()===t&&l.default.DeviceStore.setBackgroundEffectType(d.BackgroundEffect.Off)}})),c.default.removeTrackedFile(c.default.getBackgroundEffectPrefix(e.localUri))})),"remove"===e.action&&e.filename){const t=this.getPredefinedImagesTempFolderPath(e.filename);t&&c.default.removeTrackedFile(c.default.getBackgroundEffectPrefix(t));const i=this.getPredefinedImagesTempFolderPath(s);i&&c.default.removeTrackedFile(c.default.getBackgroundEffectPrefix(i))}if(i.isEmpty(n)&&"add"===e.action){const i=this.getPredefinedImagesTempFolderPath(s);if(!i)return;const n={fileUri:i};u.fileExists(n).then((n=>{if(n){const n=c.default.getBackgroundEffectPrefix(i);c.default.addFileInformationForTracking(n,i,s,{originalUrl:o,category:t,order:e.order})}else this._queueItem(e)}))}},this._queueItem=e=>{const{filename:t,url:s}=this._getFileNameAndCategory(e.url),i=this._getTransferObject(t,s),o=a.default.startTransfer(i);this._queue[o]=Object.assign({},e)},this._getTransferObject=(e,s)=>({subscriberType:t.subscriberType,context:void 0,action:"GET",downloadToUri:!0,url:s,filename:this.getPredefinedImagesTempFolderPath(e),downloadToPublicFolder:!0,headers:{responseType:"blob"}}),m.RegisterStartupable(this,"BackgroundEffectsProviderService",[a.default,c.default,g.default])}startup(){return this._items=c.default.getAllBackgroundEffectsFiles(),this._downloadItemsFromEcs(),g.default.subscribe((()=>{g.default.isNetworkingAvailable()&&this._downloadItemsFromEcs()})),a.default.subscribe(t.subscriberType,((e,t,s,i)=>{if(this._isBackgroundReplacementCapable()&&this._queue[e])if(s&&i.body){const{uri:t}=i.body,s=c.default.getBackgroundEffectPrefix(t);if(this._items[s])return;const{action:o,order:n,url:r}=this._queue[e],{category:a,filename:l,url:h}=this._getFileNameAndCategory(r),u={originalUrl:h,category:a,order:n};c.default.addFileInformationForTracking(s,t,l,u),p.log(d.LogTraceArea.Calling," - BackgroundTransferService: download success for background effect filename: "+l+"url: "+h+" action: "+o)}else s||p.error(d.LogTraceArea.Calling," - BackgroundTransferService: download failed for background effect filename: "+this._queue[e].filename+"url: "+this._queue[e].url+" action: "+this._queue[e].action)})),c.default.subscribe((()=>{this._items=c.default.getAllBackgroundEffectsFiles()})),r.default.subscribe(this._downloadItemsFromEcs),n.Resolved()}_isBackgroundReplacementCapable(){return r.default.getS4LCMCFeatures().enableBackgroundReplacement}getPredefinedImagesTempFolderPath(e){const t=this.getPredefinedDownloadPath();return t?o.join(t,e):void 0}getPredefinedDownloadPath(){return"undefined"!=typeof window&&void 0!==window.electronApi?window.electronApi.ipcProvider.downloadManager.getPredefinedImagesTempFolderPath.send():i.isUndefined(null===window||void 0===window?void 0:window.indexedDB)?void 0:"/tmp"}_getFullUrl(e){return S.default.isHttp(e)?e:r.default.getS4LCMCFeaturesNoSubscription().backgroundEffectsUri+e}_getFileNameAndCategory(e){const[t,s]=e.split("/").slice(-2);return{category:t,filename:s,url:this._getFullUrl(e)}}}},29675:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RESCHEDULE_TIMEOUT_5M=t.BING_CATEGORY_NAME=t.subscriberType=void 0;const i=s(62783),o=s(96486),n=s(97691),r=s(98861),a=s(89391),l=s(33598),d=s(44135),c=s(94224),h=s(9520),u=s(40276),p=s(46096),g=s(73439),m=s(69382),S=s(36237),f=s(33754),y=s(18078),_=s(17791),v=s(22538),C=s(4057),b=s(12770);t.subscriberType="bingBackgroundEffects_downloader",t.BING_CATEGORY_NAME="bing",t.RESCHEDULE_TIMEOUT_5M=5e3;t.default=new class{constructor(){this._queue={},this._allItems={},this._items=[],this._imageInfos={},this._itemsRemoved=[],this._apiCallErrorCount=0,this._maybeDownloadItem=e=>{if(!_.default.isNetworkConnected())return;const s=t.BING_CATEGORY_NAME,i=this._getFileName(e),n=this._getImageUrl(e),r=o.filter(this._items,(e=>e.originalUrl===n));if(o.isEmpty(r)){const t=l.default.getPredefinedImagesTempFolderPath(i);if(!t)return;const o={fileUri:t};m.fileExists(o).then((o=>{if(o){const o=g.default.getBackgroundEffectPrefix(t);g.default.addFileInformationForTracking(o,t,i,{originalUrl:n,category:s,order:parseInt(e.isoDate,10),isoDate:e.isoDate})}else this._queueItem(e)}))}},this._queueItem=e=>{const s=this._getFileName(e),i=this._getImageUrl(e),o=d.default.startTransfer({subscriberType:t.subscriberType,context:void 0,action:"GET",downloadToPublicFolder:!0,downloadToUri:!0,url:i,filename:l.default.getPredefinedImagesTempFolderPath(s)});this._queue[o]=Object.assign({},e)},this._bingHost=a.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds.host,this._httpClient=new i.GenericRestClient(this._bingHost),v.RegisterStartupable(this,"BingBackgroundEffectsProviderService",[d.default,g.default,_.default])}refreshInitiatedEvent(){return this._refreshInitiatedEvent||(this._refreshInitiatedEvent=new r.SubscribableEvent),this._refreshInitiatedEvent}startup(){const e=a.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds;return e.enabled&&e.enableImageDownload&&this._isBackgroundReplacementCapable()?(this._connectivityStoreSubscription=_.default.subscribe((()=>{_.default.isNetworkingAvailable()&&this.refresh()})),d.default.subscribe(t.subscriberType,((e,s,i,o)=>{if(this._isBackgroundReplacementCapable()&&this._queue[e]){const s=this._queue[e],n=t.BING_CATEGORY_NAME,r=this._getFileName(s),a=this._getImageUrl(s);if(i&&o.body){const{uri:e}=o.body,t=g.default.getBackgroundEffectPrefix(e);if(this._allItems[t])return;g.default.addFileInformationForTracking(t,e,r,{originalUrl:a,category:n,order:parseInt(s.isoDate,10),isoDate:s.isoDate}),S.log(p.LogTraceArea.Calling," - BingBackgroundTransferService: download success for Bing background effect filename: "+r+", url: "+a+", date: "+s.isoDate)}i||S.error(p.LogTraceArea.Calling," - BackgroundTransferService: download failed for background effect filename: "+r+", url: "+a+", date: "+s.isoDate)}})),this._fileTrackerSubscription=g.default.subscribe((()=>{S.log(p.LogTraceArea.Calling," - BingBackgroundTransferService: FileTrackerStore callback"),this._getBingBackgroundEffects(),this._changeActiveBackgroundIfNeeeded(),this._startupDone||(this.refresh(),this._startupDone=!0)})),f.localeChangedEvent.subscribe((e=>{this.refresh()})),n.Resolved()):n.Resolved()}test_reset(){this._connectivityStoreSubscription&&(_.default.unsubscribe(this._connectivityStoreSubscription),this._connectivityStoreSubscription=void 0),this._fileTrackerSubscription&&(g.default.unsubscribe(this._fileTrackerSubscription),this._fileTrackerSubscription=void 0),this._rescheduleTimer&&(b.default.clearTimeout(this._rescheduleTimer),this._rescheduleTimer=void 0),this._itemsRemoved=[],this._imageInfos={},this._apiCallErrorCount=0}refresh(){this._apiCallErrorCount=0,this._getPicturesFromBing()}_getBingBackgroundEffects(){this._allItems=g.default.getAllBackgroundEffectsFiles(),this._items=o.filter(this._allItems,(e=>e.category===t.BING_CATEGORY_NAME)),S.log(p.LogTraceArea.Calling," - BingBackgroundTransferService: Available "+this._allItems.length+" Bing images")}_getFileName(e){return"Bing - "+e.caption.replace(/[^a-zA-Z ]/g,"")+".jpg"}_getImageUrl(e){return this._bingHost+e.imageUrls.landscape.highDef}_getMarket(){let e=f.getLocale();if(f.isEnglishLanguage()){e=`${f.getLanguageFromLocale()}-${a.default.getHeaders().CountryCode.toLocaleLowerCase()}`}return e}_getPicturesFromBing(){this._rescheduleTimer&&b.default.clearTimeout(this._rescheduleTimer);if(!_.default.isNetworkConnected())return;this._market=this._getMarket();const e=a.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds,t=e.path.replace("[LOCALE]",this._market);this._httpClient.performApiGet(t).then((t=>{if(!t||!t.statusCode||200!==t.statusCode)return void this._handleApiDownloadError((null==t?void 0:t.statusMessage)||"",(null==t?void 0:t.statusCode)||0,0);let s;S.track(new h.BingBackgroundsDownloadApiEvent(this._market,this._apiCallErrorCount,t.statusCode,t.data.images.length,void 0)),this._apiCallErrorCount=0;let i=[];if(t.data.images.length>0){let e=0;if(a.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds.pickImageBasedOnUserIdHash){const s=y.default.getSkypeId(),i=u.hashCode(s);e=Math.abs(i)%t.data.images.length}s=t.data.images[e]}if(this._resetImages(),s){this._addImage(s),S.log(p.LogTraceArea.Calling," - BingBackgroundTransferService: Will download image.");const e=this._getImageUrl(s);i=[...o.filter(this._items,(t=>t.originalUrl===e)),...i]}const n=o.differenceWith(this._items,i,o.isEqual);S.log(p.LogTraceArea.Calling,` - BingBackgroundTransferService: Will remove ${n.length} images.`);for(let e of n)S.log(p.LogTraceArea.Calling," - BingBackgroundTransferService: Removing image: "+e.localFileName),this._itemsRemoved.push(e.id),g.default.removeTrackedFile(g.default.getBackgroundEffectPrefix(e.localUri),!0);s&&this._maybeDownloadItem(s),this.refreshInitiatedEvent().fire(o.values(this._imageInfos),i,n),this._rescheduleTimer=b.default.setTimeout((()=>{this._getPicturesFromBing()}),e.syncIntervalMs)})).catch((e=>this._handleApiDownloadError(e,void 0,void 0)))}_handleApiDownloadError(e,t,s){this._apiCallErrorCount+=1;const i=C.default.asString(e),o=this._apiCallErrorCount*this._apiCallErrorCount*1e3;S.error(p.LogTraceArea.Calling,` - BingBackgroundTransferService: bing images query failed. Error count: ${this._apiCallErrorCount}. Error: ${i}`),S.track(new h.BingBackgroundsDownloadApiEvent(this._market,this._apiCallErrorCount,t,s,i));const n=a.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds;this._apiCallErrorCount<n.maxImageDownloadRetries&&(this._rescheduleTimer=b.default.setTimeout((()=>{this._getPicturesFromBing()}),o))}_changeActiveBackgroundIfNeeeded(){if(0===this._items.length)return;const e=c.default.DeviceStore.getBackgroundEffectType(),t=this._itemRemoved(e);S.log(p.LogTraceArea.Calling," - BingBackgroundTransferService: current background: "+e+", itemRemoved: "+t),e&&t&&this._setNewBackgroundEffect()}_setNewBackgroundEffect(){const e=this.getNextIsoDate();if(S.log(p.LogTraceArea.Calling," - BingBackgroundTransferService: next isoDate: "+e),e){const t=this.getImageIdFromIsoDate(e);t&&(S.log(p.LogTraceArea.Calling," - BingBackgroundTransferService: setting new bg effect: "+t),c.default.DeviceStore.setBackgroundEffectType(t))}else S.log(p.LogTraceArea.Calling," - BingBackgroundTransferService: setting bg effect Blur"),c.default.DeviceStore.setBackgroundEffectType(p.BackgroundEffect.Blur)}getNextIsoDate(e){const t=o.sortBy(o.keys(this._imageInfos),(e=>e));if(e){const s=o.indexOf(t,e);let i=s;return i=s+1===t.length?0:s+1,o.nth(t,i)}return o.last(t)}getPreviousIsoDate(e){const t=o.sortBy(o.keys(this._imageInfos),(e=>e));if(e){const s=o.indexOf(t,e);let i=s;return i=0===s?t.length-1:s-1,o.nth(t,i)}return o.first(t)}_isBackgroundReplacementCapable(){return a.default.getS4LCMCFeaturesNoSubscription().enableBackgroundReplacement}_getImageMetadataFromId(e){if(!e)return;const t=o.filter(this._items,(t=>t.id===e))[0];return(null==t?void 0:t.originalUrl)?t:void 0}_itemRemoved(e){return!!o.includes(this._itemsRemoved,e)}getImageIsoDateFromId(e){const t=this._getImageMetadataFromId(e);if(t)return t.isoDate}getImageIdFromIsoDate(e){const t=o.filter(this._items,(t=>t.isoDate===e))[0];if(t)return t.id}_resetImages(){this._imageInfos={},this._itemsRemoved=[]}_addImage(e){const t=e;t.market=this._market,this._imageInfos[e.isoDate]=t}getImageFromId(e){const t=this.getImageIsoDateFromId(e);if(t)return this._imageInfos[t]}getBingBackgroundImageInfoFromId(e,t,s){const i=this.getImageFromId(e);if(i)return{callId:t,userId:s,caption:i.caption,copyright:i.copyright,isoDate:i.isoDate,market:i.market,link:i.clickUrl}}}},29815:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(97691),n=s(89391),r=s(76621),a=s(71908),l=s(51077),d=s(81697),c=s(71830),h=s(62141),u=s(39549),p=s(82261),g=s(52262),m=s(46096),S=s(36237),f=s(18078),y=s(85207),_=s(14976),v=s(22538),C=s(72758),b=s(53374);t.default=new class{constructor(){this._appConfigChanged=()=>{const{enableBookmarks:e}=n.default.getS4LMessagingFeatures();e&&!this._messagesProcessedToken?(this._messagesProcessedToken=r.default.messagesProcessed.subscribe(this._chatServiceDataServiceMessagesProcessed),d.default.prioritizeConversation(c.BookmarksThreadId,!0,!1)):!e&&this._messagesProcessedToken&&(this._messagesProcessedToken.unsubscribe(),this._messagesProcessedToken=void 0)},this._chatServiceDataServiceMessagesProcessed=e=>o.all(i.map(i.filter(e,(e=>e.isBookmark()||e.isBookmarkSourceDeletedMessageForCurrentUser())),(e=>e.isBookmark()?this._processBookmarkMsgUpdate(e):e.isBookmarkSourceDeletedMessageForCurrentUser()?this._processBookmarkSourceMsgDeletion(e):void 0))),v.RegisterStartupable(this,"BookmarksService",[r.default,u.default,g.default,C.default])}startup(){return n.default.subscribe(this._appConfigChanged),this._appConfigChanged(),o.Resolved()}bookmarkMessage(e,t){const s=e.getLatestServerMessage();if(!s)return S.error(m.LogTraceArea.Bookmarks,"Cannot bookmark message without having server message"),o.Resolved();const n={};t&&(n[l.MessageProperties.AlbumId]=t);const r=i.cloneDeep(s),d=b.default.newClientMessageId();return a.markMessageBookmarked(e,{cuid:d}).then((()=>{S.log(m.LogTraceArea.Bookmarks,"Bookmarking new message."),this._traceBookmarkSourceMessage(e);let s={bookmarkSourceClientMessageId:e.cuid,bookmarkSourceServerMessageId:e.getLatestServerMessageId(),bookmarkSourceComposeTime:e.createdTime,bookmarkSourceConversationId:e.conversationId,bookmarkSourceCreatorId:e.creator};const i=(0,u.default)().getConversation(e.conversationId);let o;i&&(i.isThread()||f.default.isMyMri(e.creator))&&(s.bookmarkSourceConversationName=g.default.getDisplayName(C.default.getConversationOwner(e.conversationId))),n[l.MessageProperties.Starred]=JSON.stringify(s),o=t&&e.isAlbum()?p.createMediaAlbumMessage(c.BookmarksThreadId,m.PostSource.Bookmarks,t,n,d):p.createMessageFromServerMessage(c.BookmarksThreadId,m.PostSource.Bookmarks,r,n,d),y.default.postMessage(o)}))}deleteBookmark(e){let t,s;return o.Resolved().then((()=>{if(e.isBookmark()){const i=l.getBookmarkMetadata(e.properties);if(t=e.getOriginalServerId(),i){const{bookmarkSourceConversationId:e,bookmarkSourceClientMessageId:t}=i;return h.default.getMessageByCuid(e,t).then((e=>{s=e}))}}else{s=e;const i=e.getBookmarkSourceMetadataForCurrentUser();if(!i)return;i.cuid&&i.id&&(t=i.id)}})).then((()=>o.all([a.deleteBookmark(t),a.deleteBookmarkSource(s)])))}_processBookmarkMsgUpdate(e){const t=l.getBookmarkMetadata(e.properties);if(this._traceBookmarkMessage(e,t),!t)return o.Resolved();const s=t.bookmarkSourceClientMessageId,i=t.bookmarkSourceConversationId;if(!s||!i)return o.Resolved();const n=e.getLatestServerMessageId();return n?h.default.getMessageByCuid(i,s).then((e=>{if(!e)return;const t=e.getBookmarkSourceMetadataForCurrentUser();return t&&t&&!t.id?a.markMessageBookmarked(e,{id:n}):void 0})):o.Resolved()}_processBookmarkSourceMsgDeletion(e){const t=e.getBookmarkSourceMetadataForCurrentUserFromPreviousMessage();return this._traceBookmarkSourceMessage(e),t&&t.id?(S.log(m.LogTraceArea.Bookmarks,"Bookmark source deleted, deleting bookmark."),a.deleteBookmark(t.id)):(S.log(m.LogTraceArea.Bookmarks,"Bookmark source message metadata not found for current user"),o.Resolved())}_traceBookmarkSourceMessage(e){S.log(m.LogTraceArea.Bookmarks,`BookmarkSourceMessage(cuid:${e.cuid} id:${e.getLatestServerMessageId()})`)}_traceBookmarkMessage(e,t){S.log(m.LogTraceArea.Bookmarks,`BookmarkMessage(cuid:${e.cuid} id:${e.getLatestServerMessageId()} sourceConversationId:${_.mriOrId(null==t?void 0:t.bookmarkSourceConversationId)}, sourceMessageCreatorId:${_.mriOrId(null==t?void 0:t.bookmarkSourceCreatorId)})`)}test_reset(){this._messagesProcessedToken=void 0}}},26459:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(74634),o=s(71830);t.default=new class{constructor(){this._consumptionHorizons={},this._markConversationUnreadCallbacks={},this.markConversationUnreadCallback=(e,t)=>(this._markConversationUnreadCallbacks[e]=new i.default,this._markConversationUnreadCallbacks[e].subscribe(t)),this.onMarkConversationUnread=e=>{const t=this._markConversationUnreadCallbacks[e];t&&t.fire()}}setPreviousConsumptionHorizon(e,t){this._consumptionHorizons[e]=t}getPreviousConsumptionHorizon(e){if(this._consumptionHorizons[e])return o.updateConsumptionHorizonWithCurrentClientTime(this._consumptionHorizons[e])}}},6452:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(74958),o=s(96486),n=s(68409),r=s(62783),a=s(74634),l=s(97691),d=s(72918),c=s(89391),h=s(17135),u=s(20603),p=s(25638),g=s(44135),m=s(22801),S=s(57569),f=s(40276),y=s(36763),_=s(46096),v=s(7234),C=s(73439),b=s(36237),T=s(68645),M=s(99097),I=s(17791),w=s(22538),P=s(4057),k=s(78262),A=s(12770),E=s(94214),R=s(42987),L=s(26712),F=s(53374),x="downloadService_amsGetStatusDownload",O="downloadService_download",D=[x,O],B={[x]:_.DownloadTransferSource.AMSGetStatus,[O]:_.DownloadTransferSource.AmsDownload},V={priority:r.WebRequestPriority.High,timeout:3e4},N={priority:r.WebRequestPriority.High,progressTimeout:2e4,timeout:0};class U extends S.default{constructor(){super(D,_.LogTraceArea.DownloadService),this._fileDownloads={},this._fileDownloadsCleaningUp={},this.downloadUpdated=new a.default,this.transferFinished=new a.default,w.RegisterStartupable(this,"DownloadService",[d.default,g.default,m.default,v.default,C.default,T.default,M.default,I.default])}startup(){return I.default.subscribe((()=>{I.default.isNetworkingAvailable()&&(this._resetBackoffs("ReportedConnectivityStore"),this._seeIfAnythingNeedsDoing())})),m.default.reconnected.subscribe((()=>{this._resetBackoffs("ChatService.reconnected"),this._seeIfAnythingNeedsDoing()})),E.default.subscribe((()=>{E.default.hasUsableSkypeToken()&&this._seeIfAnythingNeedsDoing()}),E.TriggerKeys.SkypeTokenKey),T.default.subscribe(R.DownloadActionType,((e,t)=>{const s=F.default.newCauseId();b.log(this._logTraceArea,"start fileDownload(s), restoredFromDatabase: "+t+", causeId: "+s),o.each(e,(e=>{if(b.log(this._logTraceArea,"Tracking Download: "+e.id+" , targetUri: "+e.targetUri+", restoredFromDatabase: "+t),e.startTime||(e.startTime=Date.now()),e.isCleaningUp)return e.isCleaningUp=!1,void this._cancelDownload(e,s);if(e.androidDownloadToPublicFolder&&(e.downloadToPublicFolder=e.androidDownloadToPublicFolder),e.contentUrl&&!e.amsViewId){const t=new p.default(e.contentUrl);e.amsViewId=t.getViewId()}e.downloadTempLocalUri||e.downloadToPublicFolder||e.amsObjectId||e.targetUri?(S.default.migrateTransfer(e.amsGetStatusTransfer),S.default.migrateTransfer(e.downloadTransfer),S.default.isTransferLost(e.amsGetStatusTransfer)&&(e.amsGetStatusTransfer=void 0,this._shouldCancelLostTransfer())||S.default.isTransferLost(e.downloadTransfer)&&(e.downloadTransfer=void 0,this._shouldCancelLostTransfer())?this._cancelDownload(e,s):(e.startedMovingDownload&&!e.isCached&&(e.startedMovingDownload=!1),this._isTransferCompletedSuccessfully(e.downloadTransfer)&&!e.downloadTempLocalUri&&e.expiration&&(e.downloadTransfer=void 0),o.isUndefined(e.needsDecryption)||delete e.needsDecryption,this._fileDownloads[e.id]=e,this._checkForNeededWork(e.id),this.downloadUpdated.fire(e))):this._cancelDownload(e,s)}))})),g.default.subscribe(x,((e,t,s,i,n)=>{const r=this._fileDownloads[t];if(!r)return void(this._fileDownloadsCleaningUp[t]||b.warn(this._logTraceArea,"Got DocumentStatusInfo for missing AmsGetStatus Download: ",t));s&&o.isEmpty(i.body)&&(b.log(this._logTraceArea,"AmsGetStatus missing body, success = false: "+r.id),s=!1);const a=h.ASMClient.getTracingHeaders(n);b.log(this._logTraceArea,"AmsGetStatus completed:",r.id+", success: "+s+", DocumentStatusInfo result: "+JSON.stringify(i.body)+", requestId:"+a.requestId+", correlationId:"+a.correlationId+", transactionId:"+a.transactionId);const l=r.amsGetStatusTransfer;l&&l.id===e?(this._transferFinished(r,l,"downloadService_amsGetStatusDownload",s,i,n),s?r.targetUri=i.body.view_location:u.default.checkAuthFailure(i.statusCode,n),this._downloadUpdated(r),this._checkForNeededWork(t)):b.warn(this._logTraceArea,"Got DocumentStatusInfo with transfer id mismatch: "+t+", expected: "+e+", current: "+(l&&l.id))})),g.default.subscribe(O,((e,t,s,i,n)=>{const r=this._fileDownloads[t];if(!r)return void b.warn(this._logTraceArea,"Got Download response for missing download: "+t);s&&o.isEmpty(i.body)&&(b.log(this._logTraceArea,"Download missing body, success = false: "+r.id),s=!1);const a=h.ASMClient.getTracingHeaders(n);b.log(this._logTraceArea,"Download completed: "+r.id+", success: "+s+", localUri result: "+JSON.stringify(i.body)+", requestId:"+a.requestId+", correlationId:"+a.correlationId+", transactionId:"+a.transactionId);const l=r.downloadTransfer;if(l&&l.id===e){if(this._transferFinished(r,l,"downloadService_download",s,i,n),s)r.downloadTempLocalUri=i.body.uri;else{const e=u.default.checkAuthFailure(i.statusCode,n);(e||307===i.statusCode)&&r.amsViewId&&(b.log(this._logTraceArea,"Will redo AmsGetStatus: "+r.id+", "+(e?"auth failure (possible redirect)":"redirect")),S.default.redoTransfer(r.amsGetStatusTransfer),r.targetUri=void 0)}this._downloadUpdated(r),this._checkForNeededWork(r.id)}else b.warn(this._logTraceArea,"Got Download response with transfer id mismatch: "+t+", expected: "+e+", current: "+(l&&l.id))})),l.Resolved()}_decryptFile(e){let t;if(e.fileEncryptionData){const s=f.base64StringToByteArray(e.fileEncryptionData.fileKey64),i=f.base64StringToByteArray(e.fileEncryptionData.fileIv64),o=f.base64StringToByteArray(e.fileEncryptionData.fileAuthKey64),r=f.base64StringToByteArray(e.fileEncryptionData.fileHMAC64),a=f.base64StringToByteArray(e.fileEncryptionData.fileHash64),d=F.default.newGuid()+".bin",c=e.downloadTempLocalUri;t=c?n.FileEncryption.getTempLocation(d).then((e=>n.FileEncryption.decryptFile(c,e,n.FileEncryption.getDefaultAlgo(),i,s,o,r,a).then((()=>n.FileEncryption.moveFile(e,c))))):l.Rejected("Can not find original url")}else t=l.Rejected("Incomplete file key material");t.then((()=>{e.needsDecryption=!1,this._downloadUpdated(e),this._checkForNeededWork(e.id)})).catch((t=>{b.track(new y.E2eeDecryptionFailure(t.toString())),b.error(this._logTraceArea,"Failed to decrypt file "+e.id,t),this._removeWithoutSuccess(e,O,!0)}))}downloadAmsContentToPublicFolder(e,t,s,o,n,r,a){L.default.isUrlValid(s)?this._downloadFile(e,void 0,t,!0,void 0,void 0,void 0,s,n,r,a,o):b.error(this._logTraceArea,`${i.pii.Omit(s)} is not a valid url`)}downloadAmsContentToCache(e,t,s,o,n,r,a,l,d,c){L.default.isUrlValid(r)?this._downloadFile(e,void 0,t,!1,s,o,n,r,l,d,c,a):b.error(this._logTraceArea,`${i.pii.Omit(r)} is not a valid url`)}androidDownloadAmsContentToPublicFolder(e,t,s,o,n,r,a){L.default.isUrlValid(s)?M.default.requestCameraRollPermission().then((i=>{this._downloadFile(e,void 0,t,!0,void 0,void 0,void 0,s,n,r,a,o)})):b.error(this._logTraceArea,`${i.pii.Omit(s)} is not a valid url`)}_downloadFile(e,t,s,o,n,r,a,l,d,h,u,g){const m=c.default.getS4LMessagingFeaturesNoSubscription().enableAndroidCustomDownloadFolder,S=Date.now(),f=new p.default(l),y=f.getDocumentId(),_=f.getViewId(),v=F.default.newGuid();if(!t&&!y){const e="DownloadService: Failed to find AMS download location for: "+l;return void b.error(this._logTraceArea,e)}const C={downloadType:u,key:e,filename:s,expiration:n,cacheEvictionKind:r,cacheEvictionRank:a,downloadToPublicFolder:o,downloadPublicFolderUseSkypeFolder:m,maxRetries:d,contentUrl:l,startTime:S,transactionId:v,amsObjectId:y,amsViewId:_,targetUri:t,fileEncryptionData:h};b.log(this._logTraceArea,"New download: key: "+i.pii.Omit(e)+"filename: "+i.pii.Omit(s)+", expiration: "+n+", targetUri: "+t+", amsObjectId: "+y+", amsViewId: "+_+", contentUrl: "+i.pii.Omit(l)+" DownloadToPublicFolder "+C.downloadToPublicFolder+" DownloadPublicFolderUseSkypeFolder "+C.downloadPublicFolderUseSkypeFolder+" transactionId "+C.transactionId+" starttime "+C.startTime+" iscleanup "+C.isCleaningUp+" causeId: "+g),T.default.persistAndStartAction(R.DownloadActionType,C)}androidDownloadAsmContentToPublicFolder(e,t,s,i,o){M.default.requestCameraRollPermission().then((n=>{this._downloadFileFromTargetUri(e,s,t,!0,void 0,void 0,void 0,s,i,o)}))}downloadAsmContentToCache(e,t,s,i,o,n,r,a){this._downloadFileFromTargetUri(e,n,t,!1,s,i,o,n,r,a)}_downloadFileFromTargetUri(e,t,s,o,n,r,a,l,d,h){if(this.isDownloading(e))return void b.error(this._logTraceArea,"Already downloading file for that key: "+i.pii.Omit(e));const u=c.default.getS4LMessagingFeaturesNoSubscription().enableAndroidCustomDownloadFolder,g=Date.now(),m=new p.default(l),S=m.getDocumentId(),f=m.getViewId(),y={downloadType:h,key:e,filename:s,expiration:n,cacheEvictionKind:r,cacheEvictionRank:a,downloadToPublicFolder:o,downloadPublicFolderUseSkypeFolder:u,maxRetries:d,contentUrl:l,startTime:g,transactionId:F.default.newGuid(),amsObjectId:S,amsViewId:f,targetUri:t};b.log(this._logTraceArea,"New download: key: "+i.pii.Omit(e)+"filename: "+i.pii.Omit(s)+", expiration: "+n+", targetUri: "+t+", amsObjectId: "+S+", amsViewId: "+f+", contentUrl: "+i.pii.Omit(l)+" DownloadToPublicFolder "+y.downloadToPublicFolder+" DownloadPublicFolderUseSkypeFolder "+y.downloadPublicFolderUseSkypeFolder+" transactionId "+y.transactionId+" starttime "+y.startTime+" iscleanup "+y.isCleaningUp),T.default.persistAndStartAction(R.DownloadActionType,y)}isDownloading(e){return!!this._getFileDownloadForKey(e)}hasDownloadOfType(e){return o.some(this._fileDownloads,(t=>t.downloadType===e))}_getFileDownloadForKey(e){return o.find(this._fileDownloads,(t=>t.key===e))}getFileDownloadByUrl(e){return o.find(this._fileDownloads,(t=>e===t.targetUri||e===t.contentUrl))}getUrlsForDownloadKey(e){const t=this._getFileDownloadForKey(e);if(!t)return;const s=[t.targetUri,t.contentUrl];return o.compact(s)}debug_allFileDownloads(){return this._fileDownloads}debug_allFileDownloadsCleaningUp(){return this._fileDownloadsCleaningUp}debug_allDownloadFailedRetryInfo(){return this._retryInfo}cancelDownloadForKey(e,t){const s=this._getFileDownloadForKey(e);return s?(b.log(this._logTraceArea,"Canceling key: "+i.pii.Omit(e)+", found file download: "+s.id+", causeId: "+t),this._cancelDownload(s,t),!0):(b.warn(this._logTraceArea,"Attempted to cancel key "+i.pii.Omit(e)+" but no pending file download found! causeID: "+t),!1)}_cancelDownload(e,t){const s=[e.amsGetStatusTransfer,e.downloadTransfer];o.each(s,(e=>{e&&e.id&&!e.finished&&g.default.transferIsTracked(e.id)&&g.default.cancelTransfer(e.id,t)})),this._cleanupDownload(e,!0)}_downloadUpdated(e,t=!1){T.default.updateAction(e),t||this.downloadUpdated.fire(e)}_resetBackoffs(e){b.log(this._logTraceArea,"Resetting backoffs due to: "+e),super._resetBackoffs()}_seeIfAnythingNeedsDoing(){const e=o.keys(this._fileDownloads);o.each(e,(e=>{this._checkForNeededWork(e)}))}_checkForNeededWork(e){const t=this._fileDownloads[e];if(t.expiration&&t.expiration<Date.now())return b.log(this._logTraceArea,"PesEffect Download expired before (re)starting: "+e+" "+t.targetUri),void this._cleanupDownload(t,!0);if(t.amsObjectId&&t.amsViewId&&!t.targetUri){const e=x,s=t.amsGetStatusTransfer;if(!this._isTransferCompletedSuccessfully(s)){if(this._isTransferCompletedWithoutSuccess(t.id,s,e))return void this._removeWithoutSuccess(t,e,S.default.isTransferPermanentFailure(s));if(this._isTransferReadyToStart(t.id,s,e,!0)){t.amsGetStatusId||(t.amsGetStatusId=F.default.newGuid());const i=Object.assign(Object.assign({},V),{transactionId:t.transactionId,correlationId:t.amsGetStatusId});t.amsGetStatusTransfer=this._createTrackedBackgroundTransfer(u.default.getStatusBackground(e,t.id,t.amsObjectId,t.amsViewId,i),s),this._downloadUpdated(t)}return}}{const s=O,i=t.downloadTransfer;if(!this._isTransferCompletedSuccessfully(i)){if(this._isTransferCompletedWithoutSuccess(t.id,i,s))return void this._removeWithoutSuccess(t,s,S.default.isTransferPermanentFailure(i));if(this._isTransferReadyToStart(t.id,i,s,!0)){t.downloadId||(t.downloadId=F.default.newGuid());const o=Object.assign(Object.assign({},N),{transactionId:t.transactionId,correlationId:t.downloadId});b.log(this._logTraceArea,"PesEffect Start download "+e+" "+t.targetUri+" ",t.downloadToPublicFolder),t.downloadTransfer=this._createTrackedBackgroundTransfer(u.default.downloadBackground(s,t.id,t.targetUri,t.filename,t.downloadToPublicFolder,t.downloadPublicFolderUseSkypeFolder,void 0,o),i),this._downloadUpdated(t)}return}}t.needsDecryption||(o.isUndefined(t.needsDecryption)&&(t.needsDecryption=!!t.fileEncryptionData,t.needsDecryption)?this._decryptFile(t):t.expiration&&v.default.isLocalCacheSupported()?v.default.isKnown(t.key)?(b.error(this._logTraceArea,"just got the file, but FileCache already has something for that key?"),t.isCached=!0,this.downloadUpdated.fire(t),this._cleanupDownload(t)):(t.startedMovingDownload=!0,v.default.save(t.key,t.downloadTempLocalUri,t.filename,t.expiration,!1,t.cacheEvictionKind,t.cacheEvictionRank).then((()=>{this._fileDownloads[e]&&(t.isCached=!0,this.downloadUpdated.fire(t),this._cleanupDownload(t))}),(s=>{const i=!!this._fileDownloads[e];b.warn(this._logTraceArea,"Failed to move file into cache: "+e+", downloadStillKnown: "+i+", error: "+P.default.errorAsString(s)),i&&(t.downloadTransfer=void 0,t.downloadTempLocalUri=void 0,t.isCached=!1,t.startedMovingDownload=!1,this._checkForNeededWork(t.id))}))):(this._cleanupDownload(t),t.downloadToPublicFolder&&C.default.addFileInformationForTracking(t.key,t.downloadTempLocalUri,t.filename)))}_removeWithoutSuccess(e,t,s){s?e.permanentFailureTransferType=t:e.maxRetriesExceededTransferType=t,b.log(this._logTraceArea,"Giving up: "+e.id+", transferType: "+t+", isPermanentFailure: "+!!s),this._cleanupDownload(e,!0)}_cleanupDownload(e,t=!1){e.isFinished=!0,delete this._fileDownloads[e.id],this._fileDownloadsCleaningUp[e.id]=e,this._cleanupRetryInfo(e.id);const s=v.default.isKnown(e.key);b.log(this._logTraceArea,"Cleaning up: "+e.id+", removeFromCache: "+t+", wasCleaningUp: "+e.isCleaningUp+", isCachedFileKnown: "+s),t&&s?e.isCleaningUp||(e.isCleaningUp=!0,this._downloadUpdated(e,!0),v.default.remove(e.key).catch((t=>{b.warn(this._logTraceArea,"Failed to remove file from cache (ignored during cleanup): "+e.id+", error: "+P.default.errorAsString(t))})).always((()=>{this._cleanupDownload(e,!1)}))):(delete this._fileDownloadsCleaningUp[e.id],T.default.removeAction(e.id),e.isCleaningUp=!0,this.downloadUpdated.fire(e))}_getMaxRetries(e,t){const s=c.default.getS4LCMCFeatures().retryPolicy;if(t===O){const t=this._fileDownloads[e];return t&&o.isNumber(t.maxRetries)?t.maxRetries:o.isNumber(s.maxRetries.downloadService_download)?s.maxRetries.downloadService_download:s.maxRetriesDefault}return k.NumberShim.MAX_SAFE_INTEGER}_getMaxTransferTime(e,t){const s=c.default.getS4LCMCFeatures().retryPolicy;return o.isNumber(s.maxTransferTime[t])?s.maxTransferTime[t]:s.maxPostElapsedTime}_transferFinished(e,t,s,i,o,n){const r=S.default.isPermanentFailure(o),a=this._handleTransferFinished(e.id,t,s,i,r,0,o);!a.transfer.success&&a.canRetry&&a.retryInfo&&A.default.setExpiration((()=>{this._fileDownloads[e.id]&&this._checkForNeededWork(e.id)}),a.retryInfo.nextAttempt);const l=B[s];return e.responseStatusCode=o.statusCode,e.finishedAttemptsSoFar=t.finishedAttemptsSoFarCount,this.transferFinished.fire(e,l,a,o,n),a}_shouldCancelLostTransfer(){return!1}}t.default=new U},21535:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(97691),o=s(17135),n=s(57569),r=s(6452),a=s(37614),l=s(46096),d=s(36237),c=s(14976),h=s(22538);t.default=new class{constructor(){this._failedTransfers={},h.RegisterStartupable(this,"DownloadTelemetryService",[r.default])}startup(){return r.default.transferFinished.subscribe(((e,t,s,i,o)=>{const r=this._getTransferId(e,t),h=this._getErrorMetadata(t,i,o);if(n.default.isTransferPermanentFailure(s.transfer)){d.warn(l.LogTraceArea.DownloadService,"Permanent failure: "+e.id+", source: "+l.DownloadTransferSource[t]+", status code: "+i.statusCode+", metadata: "+c.dev_unknownOmit(JSON.stringify(h)));const o=new a.PermanentDownloadFailure(t,e.startTime,s.transfer.finishedAttemptsSoFarCount,i.statusCode,i.statusText,h);d.track(o)}else if(s.transfer.success){if(this._failedTransfers[r]){const o=new a.DownloadRecovered(t,e.startTime,s.transfer.finishedAttemptsSoFarCount,i.statusCode,i.statusText,h);d.track(o),delete this._failedTransfers[r]}}else this._failedTransfers[r]={transferInfo:s,response:i}})),i.Resolved()}_getErrorMetadata(e,t,s){switch(e){case l.DownloadTransferSource.AmsDownload:case l.DownloadTransferSource.AMSGetStatus:const e=o.ASMClient.getTracingHeaders(s);return{requestId:e.requestId,correlationId:e.correlationId,transactionId:e.transactionId};default:return}}_getTransferId(e,t){return e.id+"_"+l.DownloadTransferSource[t]}}},28802:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(62141),o=s(78735),n=s(57946);t.default=new class{storeSavedMessage(e,t){const s=o.default.getValueOfDoNotFormatPreferenceOrFalseIfDisabled(e),r=(0,n.convertSavedMessageInputToDbSkypeDraftsInput)(e,t,s);return i.default.putDraftMessage(r)}deleteSavedMessage(e){return i.default.deleteDraftMessage(e)}loadSavedMessageInputs(){return i.default.getAllDraftMessages().then((e=>e.map(n.convertDbSkypeDraftsInputToSavedMessageInput)))}}},62843:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Test_E2eeCipherService=void 0;const i=s(58072),o=s(96486),n=s(64151),r=s(75463),a=s(97691),l=s(40276),d=s(57916),c=s(25793),h=s(98249),u=s(79041),p=s(18078),g=s(22538),m=s(4057),S=r.subtle,f="aes-cbc",y=32,_=32;class v{constructor(){g.RegisterStartupable(this,"E2eeCipherService",[c.default,u.default])}startup(){return this._storage=d.E2eeSessionStorage.getStorage(p.default.getSkypeId()),i.SignalProtocolLib.initialize(n),a.Resolved()}encryptMessageForConv(e,t){const s=e.getEncryptionHandshake();if(!s)return a.Rejected("No secure handshake in conversation");const i=c.default.getBuddyAddress(s);if(i.mri&&i.devId){const e=r.getRandomValues(new Array(16)),s=r.getRandomValues(new Array(y)),o=r.getRandomValues(new Array(_));return this._encryptWithAes(t,s,e).then((t=>this._signWithHMAC(new Uint8Array(o).buffer,new Uint8Array(e).buffer,t).then((n=>this._computeDigest(new Uint8Array(e).buffer,t,n).then((r=>{const a=l.mergeArrays([new Uint8Array(s).buffer,new Uint8Array(o).buffer,r,new Uint8Array(e).buffer,n]);return this._encryptBufferWithSignal(i,a.buffer).then((e=>{const s={[i.devId]:e};return{ciphertext:l.Uint8ArrayToBase64String(new Uint8Array(t)),keys:s}}))}))))))}return a.Rejected("Missing receiver information in handshake")}decryptMessageForConv(e,t,s){const i=e.getEncryptionHandshake();if(!i)return a.Rejected("No secure handshake in conversation");const o=c.default.getBuddyAddress(i),n=c.default.getDeviceId();if(o.mri&&o.devId){if(!(n in s))return a.Rejected("Missing message key");const e=s[n];return this._decryptBufferWithSignal(o,e).then((e=>{const s=new Uint8Array(e);if(144!==s.length)return a.Rejected("Unsupported message key length");const[i,o,n,r,d]=this._splitKeyMaterial(s),c=l.base64StringToUint8Array(t);return this._computeDigest(r,c.buffer,d).then((e=>this._compareArrays(e,n)?this._signWithHMAC(o,r,c.buffer).then((e=>this._compareArrays(e,d)?this._decryptWithAes(c,i,r):a.Rejected("HMAC mismatch"))):a.Rejected("Hash mismatch")))}))}return a.Rejected("Missing receiver information in handshake")}encryptMessage(e,t){return this._encryptBufferWithSignal(e,new Uint8Array(r.textToBytes(t)).buffer)}decryptMessage(e,t){return this._decryptBufferWithSignal(e,t).then((e=>r.bytesToText(o.toArray(new Uint8Array(e)))))}_encryptBufferWithSignal(e,t){const s=new i.SignalProtocolAddress(e.mri,e.devId),o=new i.SessionCipher(this._storage,s);try{return a.fromThenable(o.encrypt(t,"binary")).then((e=>l.btoaUtf8(JSON.stringify(e))))}catch(e){return a.Rejected(e)}}_decryptBufferWithSignal(e,t){const s=new i.SignalProtocolAddress(e.mri,e.devId),n=new i.SessionCipher(this._storage,s),r=l.atobUtf8(t),d=m.default.parseJsonErrorable(r);if(o.isError(d))return a.Rejected(d);try{const e=3===d.type?n.decryptPreKeyWhisperMessage(d.body,"binary"):n.decryptWhisperMessage(d.body,"binary");return a.fromThenable(e)}catch(e){return a.Rejected(e)}}_encryptWithAes(e,t,s){const i={name:f,iv:s,length:t.length};return a.fromThenable(S.importKey("raw",new Uint8Array(t),i,!1,["encrypt"])).then((t=>a.fromThenable(S.encrypt(i,t,new Uint8Array(r.textToBytes(e))))))}_decryptWithAes(e,t,s){const i={name:f,iv:s,length:t.byteLength};return a.fromThenable(S.importKey("raw",t,i,!1,["decrypt"])).then((t=>a.fromThenable(S.decrypt(i,t,e)).then((e=>r.bytesToText(o.toArray(new Uint8Array(e)))))))}_signWithHMAC(e,t,s){return a.fromThenable(S.importKey("raw",e,h.HMAC_ALGO,!1,["sign"])).then((e=>{const i=l.mergeArrays([t,s]);return a.fromThenable(S.sign(h.HMAC_ALGO,e,i))}))}_computeDigest(e,t,s){const i=l.mergeArrays([e,t,s]);return a.fromThenable(S.digest(h.DIGEST_ALGO,i))}_splitKeyMaterial(e){return[new Uint8Array(e.subarray(0,y)).buffer,new Uint8Array(e.subarray(y,64)).buffer,new Uint8Array(e.subarray(64,96)).buffer,new Uint8Array(e.subarray(96,112)).buffer,new Uint8Array(e.subarray(112,144)).buffer]}_compareArrays(e,t){if(e.byteLength!==t.byteLength)return!1;const s=new Uint8Array(e),i=new Uint8Array(t);let o=!0;for(let e=0;e<s.byteLength;++e)o=o&&s[e]===i[e];return o}}t.Test_E2eeCipherService=v;const C=new v;t.default=new class{encryptMessageForConv(e,t){return this._ensureServiceStarted().then((()=>C.encryptMessageForConv(e,t)))}decryptMessageForConv(e,t,s){return this._ensureServiceStarted().then((()=>C.decryptMessageForConv(e,t,s)))}encryptMessage(e,t){return this._ensureServiceStarted().then((()=>C.encryptMessage(e,t)))}decryptMessage(e,t){return this._ensureServiceStarted().then((()=>C.decryptMessage(e,t)))}_ensureServiceStarted(){return g.EnsureStarted(C)}}},58449:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(75463),o=s(97691),n=s(76621),r=s(40276),a=s(62843),l=s(67121),d=s(25793),c=s(46096),h=s(14976),u=s(22538);t.default=new class{constructor(){u.RegisterStartupable(this,"E2eeMediaCipherService",[d.default,n.default])}startup(){return o.Resolved()}generateCallKey(e){return r.byteArrayToBase64String(i.getRandomValues(new Array(48)))}encryptCallKeyForThread(e,t){return this._getReceiverAddress(e).then((s=>a.default.encryptMessage(s,t).catch((t=>(l.default.sendReject(e,c.E2EERejectionReason.EncryptionFailed),o.Rejected(t))))))}decryptCallKeyForThread(e,t){return this._getReceiverAddress(e).then((e=>a.default.decryptMessage(e,t)))}_getReceiverAddress(e){return n.default.getConversationMetaAsync(e).then((t=>{if(!t)return o.Rejected(`No conversation found for ${h.mriOrId(e)}`);const s=t.conv.getEncryptionHandshake();if(!s)return o.Rejected(`No secure handshake in conversation ${h.mriOrId(e)}`);const i=d.default.getBuddyAddress(s);return i.mri&&i.devId?i:o.Rejected(`Missing receiver information in handshake for ${h.mriOrId(e)}`)}))}}},67121:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Test_E2eeSessionService=void 0;const i=s(27484),o=s(1646),n=s(58072),r=s(96486),a=s(64151),l=s(74634),d=s(97691),c=s(22801),h=s(76621),u=s(81697),p=s(39549),g=s(40276),m=s(16402),S=s(57916),f=s(36763),y=s(25793),_=s(46096),v=s(36237),C=s(78735),b=s(18078),T=s(22538),M=s(4057),I=s(12770);i.extend(o);class w{constructor(){this._loadingPrivateConvs={},this.identityUpdated=new l.default,this.conversationStored=new l.default,T.RegisterStartupable(this,"E2eeSessionService",[c.default,h.default,u.default,p.default,y.default,C.default])}startup(){return this._storage=S.E2eeSessionStorage.getStorage(b.default.getSkypeId()),h.default.decryptionFailed.subscribe((e=>{this.sendReject(e,_.E2EERejectionReason.DecryptionFailed)})),n.SignalProtocolLib.initialize(a),d.Resolved()}sendInvite(e,t){let s;return this._ensureInit().then((()=>this._getInviteKeyBundle(e).then((t=>(s=t.PreKeyId,c.default.serviceSendE2eeInvite([t],e,y.default.getDeviceId()).then((e=>e.body.ThreadId))))).done((e=>{this._addLocalPrivateConversations(e,!0),v.track(new f.E2eeInvite(t))})).fail((e=>{v.track(new f.E2eeInvite(t,!0,M.default.errorAsString(e))),this._storage.removePreKey(s)}))))}sendAccept(e,t,s=!1){let i;return this._ensureInit().then((()=>this._getHandshake(e).then((o=>this._processInvite(o).then((n=>(i=n.PreKeyId,c.default.serviceSendE2eeAccept(o.InviteId,[n],y.default.getDeviceId()).then(r.noop,(i=>s||!this._shouldRefreshProperties(i)?d.Rejected(i):this._refreshInviteIdIfNeeded(o.InviteId,e,f.E2eeAction.Accept).then((()=>this.sendAccept(e,t,!0)))))))))).done((()=>{this._addLocalPrivateConversations(e,!0),v.track(new f.E2eeAccept(t))})).fail((e=>{v.track(new f.E2eeAccept(t,!0,M.default.errorAsString(e))),this._storage.removePreKey(i)}))))}sendConfirm(e,t=!1,s=!1){return this._ensureInit().then((()=>this._getHandshake(e).then((i=>this._processAccept(i).then((()=>c.default.serviceSendE2eeConfirm(i.InviteId).then(r.noop,(o=>s||!this._shouldRefreshProperties(o)?d.Rejected(o):this._refreshInviteIdIfNeeded(i.InviteId,e,f.E2eeAction.Confirm).then((()=>this.sendConfirm(e,t,!0))))))))).done((()=>{this._addLocalPrivateConversations(e,!0),v.track(new f.E2eeConfirm(t))})).fail((e=>{v.track(new f.E2eeConfirm(t,!0,M.default.errorAsString(e)))}))))}sendReject(e,t,s=!1){return this._ensureInit().then((()=>this._getHandshake(e).then((i=>c.default.serviceSendE2eeReject(i.InviteId).then(r.noop,(o=>s||!this._shouldRefreshProperties(o)?d.Rejected(o):this._refreshInviteIdIfNeeded(i.InviteId,e,f.E2eeAction.Reject).then((()=>this.sendReject(e,t,!0))))))).done((()=>{v.track(new f.E2eeReject(t))})).fail((e=>{v.track(new f.E2eeReject(t,!0,M.default.errorAsString(e)))})).then(r.noop)))}getFingerprint(e){return this._getHandshake(e).then((e=>{const t=y.default.getBuddyBundle(e),s=y.default.getBuddyAddress(e);if(s.mri&&s.devId){if(t){const e=this._toSignalPrekeyBundle(t);return this._getFingerprintFor(s.mri,e.identityKey)}const e=new n.SignalProtocolAddress(s.mri,s.devId);return d.fromThenable(this._storage.loadIdentity(e.toString())).then((e=>e?this._getFingerprintFor(s.mri,e):d.fromThenable(this._storage.loadIdentity(s.mri)).then((e=>e?this._getFingerprintFor(s.mri,e):d.Rejected("No identity available")))))}return d.Rejected("No fingerprint available")}))}isPrivateConvStoredLocally(e){if(this._loadingPrivateConvs[e])return this._loadingPrivateConvs[e];const t=d.fromThenable(this._storage.loadLocalPrivateConversations(e));return this._loadingPrivateConvs[e]=t,t.always((()=>delete this._loadingPrivateConvs[e])),t}forgetPrivateConversation(e){return this._addLocalPrivateConversations(e,!1)}terminateSession(e){return this._cleanupSession(e)}resetIdentity(){return C.default.setUserPreferencesLocal({e2eeV1Initialised:!1}),this._initEncryptionState().then((()=>{this.identityUpdated.fire()}))}_addLocalPrivateConversations(e,t){return d.fromThenable(this._storage.addLocalPrivateConversations(e,t)).then((()=>this.conversationStored.fire(e,t)))}_refreshInviteIdIfNeeded(e,t,s){return this._getHandshake(t).then((i=>{e===i.InviteId?(v.log(_.LogTraceArea.E2EEncryption,"_refreshInviteIdIfNeeded: Refreshing thread properties"),v.track(new f.E2eeRetry(s,f.E2eeRetryType.ForceInviteIdRefresh)),u.default.forceThreadDetailsFetchIfNeeded(t)):(v.log(_.LogTraceArea.E2EEncryption,"_refreshInviteIdIfNeeded: New handshake received in meantime - retry"),v.track(new f.E2eeRetry(s,f.E2eeRetryType.NewInviteIdSynced)))}))}_shouldRefreshProperties(e){return e&&410===e.statusCode&&667===e.errorCode}_getFingerprintFor(e,t){const s=new n.FingerprintGenerator(3);return this._ensureInit().then((()=>d.fromThenable(s.createFor(b.default.getSkypeMri(),this._pubIdentityKey.buffer,e,t))))}_processInvite(e){const t=y.default.getBestBundleMatch(e.APartyPreKeyBundle);return t?this._processInviteBundle(e.AParty,e.APartyDeviceId,e.BParty,t):d.Rejected(`No matching key bundle from AParty, was looking for algo ${y.PREFERRED_HANDSHAKE_ALGO}`)}_processInviteBundle(e,t,s,i){const o=new n.SignalProtocolAddress(e,t),r=new n.SessionBuilder(this._storage,o),a=this._toSignalPrekeyBundle(i);return d.fromThenable(r.processPreKey(a)).then((()=>this._getInviteKeyBundle(e)))}test_processInviteBundle(e,t,s,i){return this._ensureInit().then((()=>this._processInviteBundle(e,t,s,i)))}_processAccept(e){const t=y.default.getBestBundleMatch(e.BPartyPreKeyBundle);return e.BPartyDeviceId&&t?this._processAcceptBundle(e.BParty,e.BPartyDeviceId,e.AParty,t):d.Rejected(`No matching key bundle from BParty, was looking for algo ${y.PREFERRED_HANDSHAKE_ALGO}`)}_processAcceptBundle(e,t,s,i){const o=new n.SignalProtocolAddress(e,t),r=new n.SessionBuilder(this._storage,o),a=this._toSignalPrekeyBundle(i);return d.fromThenable(r.processPreKey(a))}test_processAcceptBundle(e,t,s,i){return this._ensureInit().then((()=>this._processAcceptBundle(e,t,s,i)))}_initEncryptionState(){return(C.default.getUserPreferencesLocal().e2eeV1Initialised?this._loadEncryptionState():this._generateAndStoreRegId().then((()=>this._generateAndStoreIdentityKey())).then((e=>this._generateAndStoreSignedPreKey(e))).then((()=>{C.default.setUserPreferencesLocal({e2eeV1Initialised:!0}),v.log(_.LogTraceArea.E2EEncryption,"Initialized e2e encryption state")}))).then((()=>{I.default.setTimeout((()=>this._checkSignedPreKeyRenewal(this._signedPreKeyExpiration)),432e5)}))}_generateAndStoreRegId(){return v.log(_.LogTraceArea.E2EEncryption,"Registration id generated"),d.fromThenable(this._storage.setLocalRegistrationId(n.KeyHelper.generateRegistrationId()))}_generateAndStoreIdentityKey(){return d.fromThenable(n.KeyHelper.generateIdentityKeyPair().then((e=>(v.log(_.LogTraceArea.E2EEncryption,"Indentity keypair generated"),this._pubIdentityKey=new Uint8Array(e.pubKey),this._storage.storeIdentityKeyPair(e).then((()=>e))))))}_generateAndStoreSignedPreKey(e){return d.fromThenable(n.KeyHelper.generateSignedPreKey(e,S.NOP_KEY_ID).then((e=>(v.log(_.LogTraceArea.E2EEncryption,"SignedPreKey keypair generated"),this._pubSignedPreKey=new Uint8Array(e.keyPair.pubKey),this._signedPreKeySignature=new Uint8Array(e.signature),this._signedPreKeyExpiration=m.default.add(Date.now(),0,14),this._storage.storeSignedPreKey(S.NOP_KEY_ID,e.keyPair).then((()=>this._storage.storeSignedPreKeySignature(S.NOP_KEY_ID,e.signature))).then((()=>this._storage.storeSignedPreKeyExpiration(S.NOP_KEY_ID,this._signedPreKeyExpiration)))))))}_loadEncryptionState(){return d.all([d.fromThenable(this._storage.getIdentityKeyPair()),d.fromThenable(this._storage.loadSignedPreKey(S.NOP_KEY_ID)),d.fromThenable(this._storage.loadSignedPreKeySignature(S.NOP_KEY_ID)),d.fromThenable(this._storage.loadSignedPreKeyExpiration(S.NOP_KEY_ID))]).then((([e,t,s,i])=>(e&&(this._pubIdentityKey=new Uint8Array(e.pubKey)),t&&(this._pubSignedPreKey=new Uint8Array(t.pubKey)),s&&(this._signedPreKeySignature=new Uint8Array(s)),i&&(this._signedPreKeyExpiration=i),this._pubIdentityKey&&this._pubSignedPreKey&&this._signedPreKeySignature&&this._signedPreKeyExpiration?(v.log(_.LogTraceArea.E2EEncryption,"Loaded e2e encryption state"),this._checkSignedPreKeyRenewal(this._signedPreKeyExpiration)):(v.error(_.LogTraceArea.E2EEncryption,"Failed to load encryption state, reinitializing"),this.resetIdentity()))))}_checkSignedPreKeyRenewal(e){return Date.now()>e?(v.log(_.LogTraceArea.E2EEncryption,"Renewing signed pre key"),d.fromThenable(this._storage.getIdentityKeyPair()).then((e=>e?this._generateAndStoreSignedPreKey(e):d.Rejected("Could not load identity key")))):d.Resolved()}test_forceSignedPreKeyRenewal(){return this._checkSignedPreKeyRenewal(0)}_getHandshake(e){const t=(0,p.default)().getConversation(e);if(!t)return d.Rejected(`No conv ${e} found`);const s=t.getEncryptionHandshake();return s?d.Resolved(s):d.Rejected(`No handshake in conv ${e}`)}_getInviteKeyBundle(e){const t=g.getRandomInt32();return d.fromThenable(n.KeyHelper.generatePreKey(t).then((e=>this._storage.storePreKey(t,e.keyPair).then((()=>this._getPreKeyBundle(t,e.keyPair.pubKey))))))}test_getInviteKeyBundle(e){return this._ensureInit().then((()=>this._getInviteKeyBundle(e)))}_ensureInit(){return this._lazyInitTask||(this._lazyInitTask=this._initEncryptionState()),this._lazyInitTask}test_init(){return this._lazyInitTask=void 0,this._ensureInit()}_getPreKeyBundle(e,t){const s=i.duration(this._signedPreKeyExpiration).subtract(Date.now(),"ms");return{IdentityKeyBase64:this._toBase64(this._pubIdentityKey),SignedPreKeyBase64:this._toBase64(this._pubSignedPreKey),PreKeySignatureBase64:this._toBase64(this._signedPreKeySignature),PreKeyBase64:this._toBase64(new Uint8Array(t)),ValidityPeriod:s.toISOString(),AlgorithmId:y.CURVE25519_ALGO_ID,SignedPreKeyId:S.NOP_KEY_ID,PreKeyId:e}}_toSignalPrekeyBundle(e){return{registrationId:S.NOP_KEY_ID,identityKey:this._fromBase64(e.IdentityKeyBase64),signedPreKey:{keyId:e.SignedPreKeyId,publicKey:this._fromBase64(e.SignedPreKeyBase64),signature:this._fromBase64(e.PreKeySignatureBase64)},preKey:{keyId:e.PreKeyId,publicKey:this._fromBase64(e.PreKeyBase64)}}}_cleanupSession(e){const t=y.default.getBuddyAddress(e);if(t.devId){const e=new n.SignalProtocolAddress(t.mri,t.devId);return d.all([d.fromThenable(this._storage.saveIdentity(e.getName(),void 0)),d.fromThenable(this._storage.saveIdentity(e.toString(),void 0)),d.fromThenable(this._storage.storeSession(e.toString(),void 0))]).then(r.noop)}return d.Resolved()}_toBase64(e){return g.Uint8ArrayToBase64String(e)}_fromBase64(e){return g.base64StringToUint8Array(e).buffer}}t.Test_E2eeSessionService=w;const P=new w;t.default=new class{constructor(){this.identityUpdated=P.identityUpdated,this.conversationStored=P.conversationStored}sendInvite(e,t){return this._ensureServiceStarted().then((()=>P.sendInvite(e,t)))}sendAccept(e,t){return this._ensureServiceStarted().then((()=>P.sendAccept(e,t)))}sendConfirm(e,t=!1){return this._ensureServiceStarted().then((()=>P.sendConfirm(e,t)))}sendReject(e,t){return this._ensureServiceStarted().then((()=>P.sendReject(e,t)))}getFingerprint(e){return this._ensureServiceStarted().then((()=>P.getFingerprint(e)))}terminateSession(e){return this._ensureServiceStarted().then((()=>P.terminateSession(e)))}resetIdentity(){return this._ensureServiceStarted().then((()=>P.resetIdentity()))}isPrivateConvStoredLocally(e){return this._ensureServiceStarted().then((()=>P.isPrivateConvStoredLocally(e)))}forgetPrivateConversation(e){return this._ensureServiceStarted().then((()=>P.forgetPrivateConversation(e)))}_ensureServiceStarted(){return T.EnsureStarted(P)}}},57916:(e,t,s)=>{var i=s(48764).Buffer;Object.defineProperty(t,"__esModule",{value:!0}),t.E2eeSessionStorage=t.NOP_KEY_ID=void 0;const o=s(96486),n=s(61544),r=s(97691),a=(s(89391),s(62141)),l=s(40276),d=s(46096),c=s(36237),h=s(98754),u=s(14976),p=s(4057),g=s(40363),m={IdentityKeyPair:"SkypeIdentityKeyPair",LocalRegistrationId:"SkypeLocalRegistrationId",Identity:"SkypeIdentity",PreKey:"SkypePreKey",Session:"SkypeSession",SessionBase64:"SkypeB64Session",SignedPreKey:"SkypeSignedPreKey",SignedPreKeySignature:"SkypeSignedPreKeySignature",SignedPreKeyExpiration:"SkypeSignedPreKeyExpiration",Fingerprints:"SkypeFingerprints",DeviceId:"SkypeSecureDeviceId",LocalPrivateConversations:"SkypeLocalPrivateConversations"};t.NOP_KEY_ID=42;let S={};const f="Unsupported storage type!";class y{constructor(e){this._storageKey=e,this._data={},this._testUseInsecureStorage=!0,this.Direction={SENDING:1,RECEIVING:2}}static getStorage(e){return S[e]||(S[e]=new y(e)),S[e]}storeIdentityKeyPair(e){return this._storeKeyPair(m.IdentityKeyPair,e)}loadIdentity(e){return this._loadString(m.Identity+e).then((e=>e?l.base64StringToUint8Array(e).buffer:void 0))}storeSignedPreKeySignature(e,t){const s=l.Uint8ArrayToBase64String(new Uint8Array(t));return this._storeString(m.SignedPreKeySignature+e,s)}loadSignedPreKeySignature(e){return this._loadString(m.SignedPreKeySignature+e).then((e=>e?l.base64StringToUint8Array(e).buffer:void 0))}setLocalRegistrationId(e){return this._storeString(m.LocalRegistrationId,e.toString())}storeDeviceId(e){return this._storeString(m.DeviceId,e)}loadDeviceId(){return this._loadString(m.DeviceId)}storePreKey(e,t){return this._storeKeyPair(m.PreKey+e,t)}storeSignedPreKey(e,t){return this._storeKeyPair(m.SignedPreKey+e,t)}storeSignedPreKeyExpiration(e,t){return this._storeString(m.SignedPreKeyExpiration+e,t.toString())}loadSignedPreKeyExpiration(e){return this._loadString(m.SignedPreKeyExpiration+e).then((e=>e?parseInt(e,10):void 0))}storeFingerprints(e,t){return this._storeString(m.Fingerprints+e,JSON.stringify(t))}loadFingerprints(e){return this._loadString(m.Fingerprints+e).then((e=>p.default.parseJsonErrorToUndefined(e)))}addLocalPrivateConversations(e,t){return this._storeString(m.LocalPrivateConversations+e,t.toString())}loadLocalPrivateConversations(e){return this._loadString(m.LocalPrivateConversations+e).then((e=>!!e&&"true"===e))}getIdentityKeyPair(){return this._loadKeyPair(m.IdentityKeyPair)}getLocalRegistrationId(){return this._loadString(m.LocalRegistrationId).then((e=>e?parseInt(e,10):void 0))}isTrustedIdentity(e,t){return new Promise(((e,t)=>{e(!0)}))}saveIdentity(e,t){const s=t?"string"==typeof t?l.byteArrayToBase64String(l.binaryStringToBytes(t)):l.Uint8ArrayToBase64String(new Uint8Array(t)):void 0;return this._storeString(m.Identity+e,s)}loadPreKey(e){return this._loadKeyPair(m.PreKey+e)}removePreKey(e){return this._removeEntry(m.PreKey+e)}loadSignedPreKey(e){return this._loadKeyPair(m.SignedPreKey+e)}loadSession(e){return g.default.isElectronLinux()?this._loadString(m.SessionBase64+e).then((t=>t?Promise.resolve(l.atobUtf8(t)):this._loadString(m.Session+e))):this._loadString(m.Session+e)}storeSession(e,t){if(g.default.isElectronLinux()){let s=[];return s.push(this._storeString(m.SessionBase64+e,t?l.btoaUtf8(t):void 0)),void 0===t&&s.push(this._storeString(m.Session+e,t)),Promise.all(s).then((e=>o.first(e)))}return this._storeString(m.Session+e,t)}_removeEntry(e){if(this._shouldUseInsecureStorage()){let t=o.cloneDeep(this._data);return delete t[e],this._data=t,this._toThenable(h.default.putData(a.InternalKeys.EndToEndEncryptionData,t))}return g.default.isElectronWindows()?this._toThenable(this._removeEntryWindowsHelper(e)):Promise.reject(f)}_storeKeyPair(e,t){const s={pubKey:l.Uint8ArrayToBase64String(new Uint8Array(t.pubKey)),privKey:l.Uint8ArrayToBase64String(new Uint8Array(t.privKey))},i=JSON.stringify(s);return this._storeString(e,i)}_loadKeyPair(e){return this._loadString(e).then((e=>{if(e){const t=p.default.parseJsonWithDefault(e,void 0);if(t)return Promise.resolve({pubKey:l.base64StringToUint8Array(t.pubKey).buffer,privKey:l.base64StringToUint8Array(t.privKey).buffer})}return Promise.resolve(void 0)}))}_storeString(e,t){if(!t)return this._removeEntry(e);if(c.log(d.LogTraceArea.E2EEncryption,`Storing credentials, service:${u.mriOrId(e)} data length:${t.length}`),this._shouldUseInsecureStorage()){let s=o.cloneDeep(this._data);return s[e]=t,this._data=s,this._toThenable(h.default.putData(a.InternalKeys.EndToEndEncryptionData,s))}return g.default.isElectronWindows()?this._toThenable(this._storeStringWindowsHelper(e,t)):Promise.reject(f)}_loadString(e){let t;return this._shouldUseInsecureStorage()?(o.isEmpty(this._data)&&(this._data=h.default.getData(a.InternalKeys.EndToEndEncryptionData)||{}),t=Promise.resolve(this._data[e])):t=g.default.isElectronWindows()?this._toThenable(this._loadStringWindowsHelper(e)):Promise.reject(f),t.catch((e=>{}))}_storeStringWindowsHelper(e,t){const s=2560;if(i.from(t).length<=s)return r.all([n.default.setPassword(e,this._storageKey,t),this._deleteSegments(e,0)]).then(o.noop);let a,l=[];for(let e=0;e<t.length;e+=a){a=o.floor(1280);let n=t.substr(e,a);i.from(n).length>s&&(a=o.floor(s/3),n=t.substr(e,a)),l.push(n)}c.log(d.LogTraceArea.E2EEncryption,`Splitting credentials into ${l.length} segments, service:${u.mriOrId(e)}`);const h=o.map(l,((t,s)=>n.default.setPassword(this._createWindowsServiceKey(e,s),this._storageKey,t)));return h.push(n.default.deletePassword(e,this._storageKey).then(o.noop)),h.push(this._deleteSegments(e,l.length)),r.all(h).then(o.noop)}_removeEntryWindowsHelper(e){return r.all([n.default.deletePassword(e,this._storageKey),this._deleteSegments(e,0)]).then(o.noop)}_loadStringWindowsHelper(e){return n.default.getPassword(e,this._storageKey).catch((()=>{const t=(s,i)=>n.default.getPassword(this._createWindowsServiceKey(e,s),this._storageKey).then((e=>t(++s,i=i?i+e:e))).catch((()=>({loadedSegments:s,data:i})));return t(0,void 0).then((t=>(void 0!==t.data&&c.log(d.LogTraceArea.E2EEncryption,`Loaded credentials from ${t.loadedSegments} segments, service:${u.mriOrId(e)}`),t.data)))}))}_createWindowsServiceKey(e,t){return e+"_"+t}_deleteSegments(e,t){const s=t=>n.default.deletePassword(this._createWindowsServiceKey(e,t),this._storageKey).then((e=>e?s(++t):r.Resolved(t)));return s(t).then((s=>{c.log(d.LogTraceArea.E2EEncryption,`Deleted credentials in ${s-t} segments, service:${u.mriOrId(e)}`)}))}test_resetStorage(e=!0){h.default.putData(a.InternalKeys.EndToEndEncryptionData,void 0),this._data={},this._testUseInsecureStorage=e}_toThenable(e){return new Promise(((t,s)=>e.then(t,s)))}_shouldUseInsecureStorage(){return!0}}t.E2eeSessionStorage=y},25793:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PREFERRED_HANDSHAKE_ALGO=t.CURVE25519_ALGO_ID=t.SecureHandshakeState=void 0;const i=s(96486),o=s(97691),n=s(51077),r=s(71830),a=s(62141),l=s(98754),d=s(18078),c=s(22538),h=s(53374);var u;!function(e){e[e.None=1]="None",e[e.OtherEndpointInUse=2]="OtherEndpointInUse",e[e.SentInvite=3]="SentInvite",e[e.GotInvite=4]="GotInvite",e[e.SentAccept=5]="SentAccept",e[e.GotAccept=6]="GotAccept",e[e.SentSwitch=7]="SentSwitch",e[e.GotSwitch=8]="GotSwitch",e[e.Completed=9]="Completed"}(u=t.SecureHandshakeState||(t.SecureHandshakeState={})),t.CURVE25519_ALGO_ID=2,t.PREFERRED_HANDSHAKE_ALGO=t.CURVE25519_ALGO_ID;const p=[t.PREFERRED_HANDSHAKE_ALGO],g=[n.MessageTypes.EncryptedText,n.MessageTypes.EncryptedMedia,n.MessageTypes.EncryptedCall],m=g.concat([n.MessageTypes.HandshakeInvite,n.MessageTypes.HandshakeAccept,n.MessageTypes.HandshakeComplete,n.MessageTypes.HandshakeReject,n.MessageTypes.Typing,n.MessageTypes.ClearTyping]);t.default=new class{constructor(){c.RegisterStartupable(this,"E2eeUtils",[l.default])}startup(){return o.Resolved()}getDeviceId(){if(this._cachedDeviceId)return this._cachedDeviceId;if(this._cachedDeviceId=l.default.getData(a.InternalKeys.SecureDeviceId),!this._cachedDeviceId){let e=l.default.getData(a.InternalKeys.DeviceId);e&&h.default.isFormattedGuid(e)?this._cachedDeviceId=e:this._cachedDeviceId=h.default.newGuid(),l.default.putData(a.InternalKeys.SecureDeviceId,this._cachedDeviceId)}return this._cachedDeviceId}shouldIgnoreMessage(e){if(!i.includes(m,e.messagetype))return!0;if(!i.includes(g,e.messagetype))return!1;const t=e.encryptedkey;if(!t)return!0;const s=r.getCreatorMriForMessageFromLink(e.from),o=d.default.isMyMri(s),n=o&&e.fromdeviceid!==this.getDeviceId(),a=!o&&!t[this.getDeviceId()];return n||a}isMyDeviceId(e){return!e||e===this.getDeviceId()}isInitiatedByMe(e){return d.default.isMyMri(e.AParty)}getBuddyAddress(e){return this.isInitiatedByMe(e)?{mri:e.BParty,devId:e.BPartyDeviceId}:{mri:e.AParty,devId:e.APartyDeviceId}}getBuddyBundle(e){return this.isInitiatedByMe(e)?this.getBestBundleMatch(e.BPartyPreKeyBundle):this.getBestBundleMatch(e.APartyPreKeyBundle)}getBestBundleMatch(e){const s=i.find(e,(e=>e.AlgorithmId===t.PREFERRED_HANDSHAKE_ALGO));return s||i.find(e,(e=>e.AlgorithmId in p))}getDetailedHandshakeState(e){const t=e.getEncryptionHandshake();if(!t)return u.None;const s=this.isInitiatedByMe(t),i=s?this.isMyDeviceId(t.APartyDeviceId):this.isMyDeviceId(t.BPartyDeviceId),o=e.isSwitchingSecureDevice();switch(t.HandshakeState){case"None":return u.None;case"Invited":case"Accepted":return i?"Invited"===t.HandshakeState?o?s?u.SentSwitch:u.GotSwitch:s?u.SentInvite:u.GotInvite:s?u.GotAccept:u.SentAccept:u.OtherEndpointInUse;case"Completed":return i?u.Completed:u.OtherEndpointInUse}}isAccepted(e){return"Accepted"===e.HandshakeState}isFatalDecryptionError(e){return!(e&&e.name&&"MessageCounterError"===e.name)}}},69295:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(60647),n=s(97691),r=s(60021),a=s(46096),l=(s(72685),s(36237)),d=s(18078),c=s(74243),h=s(14976),u=s(76812),p=s(22538),g=s(4057);t.default=new class{constructor(){p.RegisterStartupable(this,"ExtensionTelemetryService")}startup(){return n.Resolved()}_postShareExtensionTelemetryData(){o.default.getShareExtensionTelemetryData().then((e=>{if(l.log(a.LogTraceArea.ShareToSkype,"Processing share extension telemetry data: "+e.length),e.length){const t=this._reportSharedTelemetryEvents(e);t&&l.error(a.LogTraceArea.ShareToSkype,"Failed to report "+t+" events")}}),(e=>{l.error(a.LogTraceArea.ShareToSkype,"Failed to get telemetry data from share extension: "+g.default.errorAsString(e))}))}_postNotificationExtensionTelemetryData(){o.default.getNotificationExtensionTelemetryData().then((e=>{if(l.log(a.LogTraceArea.Notifications,"Processing notification extension telemetry data: "+e.length),e.length){const t=this._reportNotificatiomTelemetryEvents(e);t&&l.error(a.LogTraceArea.Notifications,"Failed to report "+t+" events")}}),(e=>{l.error(a.LogTraceArea.Notifications,"Failed to get telemetry data from notification extension: "+g.default.errorAsString(e))}))}isSupportedTelemetryEventTypes(e){return"ShareToSkypeEventActions.completed"===e||"ShareToSkypeEventActions.opened"===e||"ShareToSkypeEventActions.failed"===e}isSupportedEventType(e){return"text"===e||"media"===e}isSupportedDataType(e){return"image"===e||("video"===e||"file"===e)}getShareEventFromData(e,t){if(!this.isSupportedEventType(t))return null;let s=[];return i.each(e,(e=>{if(!this.isSupportedDataType(e))return void l.error(a.LogTraceArea.ShareToSkype,"Share Extension - Incorrect DataType "+e);let t={uri:"",name:"",width:0,height:0,size:0,type:e,thumbnailUri:"",thumbnailWidth:0,thumbnailHeight:0,thumbnailSize:0};s.push(t)})),{type:t,data:s.length?s:void 0}}_getSharedTelemetryEventFromData(e){const t=g.default.parseJsonErrorable(e);return i.isError(t)?(l.error(a.LogTraceArea.ShareToSkype,"Share Extension - Failed to parse telemetryData "+h.dev_unknownOmit(e)),null):t}_getNotificationTelemetryEventFromData(e){const t=g.default.parseJsonErrorable(e);return i.isError(t)?(l.error(a.LogTraceArea.Notifications,"Notification Extension - Failed to parse telemetryData "+h.dev_unknownOmit(e)),null):t}test_getTelemetryEventFromData(e){return this._getSharedTelemetryEventFromData(e)}test_reportSharedTelemetryEvents(e){return this._reportSharedTelemetryEvents(e)}_reportSharedTelemetryEvents(e){const t=this._getSharedTelemetryEventFromData(e);if(!t)return 1;l.log(a.LogTraceArea.ShareToSkype,(t.events,t.events.length));return i.sumBy(t.events,(e=>{if(!e)return l.error(a.LogTraceArea.ShareToSkype,"Share Extension - telemetryEvent.events contains undefined events"),1;if(!e.shareToSkypeEvent)return l.error(a.LogTraceArea.ShareToSkype,"Share Extension - telemetryEventItem.shareToSkypeEvent is undefined"),1;const t=e.shareToSkypeEvent.event;if(!this.isSupportedEventType(t.type))return l.error(a.LogTraceArea.ShareToSkype,"Share Extension - Incorrect EventType "+e.shareToSkypeEvent.event.type),1;const s=this.getShareEventFromData(t.data,t.type);if(!s)return 1;const i=e.eventType;if(!this.isSupportedTelemetryEventTypes(i))return l.error(a.LogTraceArea.ShareToSkype,"Share Extension - Incorrect Telemetry Event Type "+i),1;if(l.log(a.LogTraceArea.ShareToSkype,"Reporting Share Extension Telemetry for "+i),"ShareToSkypeEventActions.opened"===i){const t=e.shareToSkypeEvent.isSharedToContact;this._reportSharedTelemetryEventOpened(s,t)}else if("ShareToSkypeEventActions.completed"===i||"ShareToSkypeEventActions.failed"===i){const t=e.shareToSkypeEvent.conversationsCount,i=e.shareToSkypeEvent.messageAdded,o=e.shareToSkypeEvent.errorCode,n=e.shareToSkypeEvent.isSharedToContact;this._reportSharedTelemetryEventCompleted(s,t,i,n,o)}return 0}))}_reportNotificatiomTelemetryEvents(e){const t=this._getNotificationTelemetryEventFromData(e);if(!t)return 1;l.log(a.LogTraceArea.Notifications,(t.events,t.events.length));return i.sumBy(t.events,(e=>{if(!e)return l.error(a.LogTraceArea.Notifications,"Notification Extension - telemetryEvent.events contains undefined events"),1;const t=e.eventType;if("push_notification"!==t)return l.error(a.LogTraceArea.Notifications,"Notification Extension - Incorrect Telemetry Event Type "+t),1;const s=r.getCorrelationIdFromMessageParts(d.default.getSkypeMri(),e.conversationId,e.clientMessageId);return l.log(a.LogTraceArea.Notifications,"Notification Extension Telemetry for "+t),this._reportNotificationEvent(e,s),0}))}_reportSharedTelemetryEventOpened(e,t){l.track(new u.default({action:u.ShareToSkypeEventActions.opened,isSharedToContact:t,event:e}))}_reportSharedTelemetryEventCompleted(e,t,s,i,o){l.track(new u.default({action:u.ShareToSkypeEventActions.completed,event:e,conversationsCount:t,messageAdded:s,isSharedToContact:i,errorCode:o}))}_reportNotificationEvent(e,t){l.track(new c.default({eventType:e.eventType,eventCode:e.eventCode,conversationId:e.conversationId,messageId:e.messageId,clientMessageId:e.clientMessageId,isMyMessage:e.isMyMessage,result:e.result,messageCorrelationId:t,correlationVector:e.cv}))}}},82666:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(97691),n=s(46096),r=s(36237),a=s(26424),l=s(22538),d=s(69021),c=10*Math.pow(1024,2);t.default=new class{constructor(){l.RegisterStartupable(this,"GifProviderService")}startup(){return o.Resolved()}searchGifs(e,t,s){const i=o.Defer();return d.default.searchGifs(e,t,s).then((e=>(i.resolve(void 0),this._handleApiResults(e)))).catch((e=>(i.reject(void 0),r.error(n.LogTraceArea.GifProviderService,`There was an error when reaching out to Gif provider - Error: ${e}`),a.EmptyGifResult)))}getTrendingGifs(e){const t=o.Defer();return d.default.getTrendingGifs(e).then((e=>(t.resolve(void 0),this._handleApiResults(e)))).catch((e=>(t.reject(void 0),r.error(n.LogTraceArea.GifProviderService,`There was an error when reaching out to Gif provider - Error: ${e}`),a.EmptyGifResult)))}_handleApiResults(e){return{gifItems:i.map(e.results,(e=>({id:`_${e.id}`,title:e.h1_title||e.title,hostUrl:e.itemurl,full:{url:e.media[0].gif.size>=c?e.media[0].tinygif.url:e.media[0].gif.url,width:e.media[0].gif.dims[0]||0,height:e.media[0].gif.dims[1]||0,stillUrl:e.media[0].gif.preview,frames:0},small:{url:e.media[0].tinygif.url,width:e.media[0].tinygif.dims[0]||0,height:e.media[0].tinygif.dims[1]||0}}))),nextOffset:Number(e.next)}}}},54799:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ImageCookieSetterService=void 0;const i=s(96486),o=s(62783),n=s(97691),r=s(89391),a=s(57113),l=s(36237),d=s(98754),c=s(32226),h=(s(81956),s(22538)),u=s(12770),p=s(94214),g=s(26712);t.ImageCookieSetterService=class{constructor(e,t,s,i,n){this._serviceName=e,this._dbKey=t,this._logArea=s,this._cookieUrl=i,this._cookieName=n,this._exponentialTime=new o.ExponentialTime(1e3,3e5),this._checkCookieBasis=()=>{if(!p.default.hasUsableSkypeToken())return void this._invalidateCookieIfSkypeTokenExpired();const e=p.default.getSkypeToken();if(e&&(!this._lastSkypeTokenSet||e.rawToken!==this._lastSkypeTokenSet.rawToken))if(l.log(this._logArea,"SkypeToken updated - requesting new cookies"),this._setAuthCookieSleepPromise){const e=this._setAuthCookieSleepPromise;this._setAuthCookieSleepPromise=void 0,e.cancel()}else this._setAuthCookie()},h.RegisterStartupable(this,this._serviceName,[d.default,c.default,p.default])}startup(){d.default.getData(this._dbKey);return l.log(this._logArea,"Startup: Reset Cookie"),this.setCookieFlag(!1),p.default.subscribe(this._checkCookieBasis,p.TriggerKeys.SkypeTokenKey),c.default.subscribe(this._checkCookieBasis),this._checkCookieBasis(),n.Resolved()}_setAuthCookie(){return this._setAuthCookiePendingPromise||(this._setAuthCookiePendingPromise=this._setAuthCookieInternal().finally((()=>{this._setAuthCookiePendingPromise=void 0}))),this._setAuthCookiePendingPromise}_setAuthCookieInternal(){const e=p.default.getSkypeToken();return e?this.sendAuthCookieRequest(e).then((()=>{if(!a.default.getCookieSupported()||!this._cookieUrl||!this._cookieName)return;const t=g.default.getDomainName(this._cookieUrl);return a.default.checkCookieValue(t,this._cookieName,e.rawToken)}),(e=>(this._invalidateCookieIfSkypeTokenExpired(),l.error(this._logArea,"Cookie update request failed. Response code: "+e.statusCode),n.Rejected(e)))).then((()=>{this._exponentialTime.reset(),this._saveSkypeTokenWhenCookieSet(e)})).catch((e=>{const t=this._exponentialTime.getTimeAndCalculateNext();return this._setAuthCookieSleepPromise=u.default.sleep(t),this._setAuthCookieSleepPromise.always((()=>(this._setAuthCookieSleepPromise=void 0,p.default.hasUsableSkypeToken()?this._setAuthCookieInternal():(this._invalidateCookieIfSkypeTokenExpired(),n.Rejected(e)))))})):n.Rejected("Missing Token")}_invalidateCookieIfSkypeTokenExpired(){this._lastSkypeTokenSet&&!this._lastSkypeTokenSet.isTokenExpired()||(l.log(this._logArea,"SkypeToken is expired - cookies are not valid"),this.setCookieFlag(!1))}_saveSkypeTokenWhenCookieSet(e){const t=!e.isTokenExpired();l.log(this._logArea,"New cookies set. isTokenValid="+t),this.setCookieFlag(t),this._lastSkypeTokenSet=e,d.default.putData(this._dbKey,{rawToken:e.rawToken,expiration:e.expiration})}setAuthCookieDebounced(){return r.default.getAsyncMediaFeatures().ams_cookie_refresh_request_enabled?(l.log(this._logArea,"Set AuthCookie Debounced. Already have SyncTask=",!!this._setAuthCookieDebouncedPromise),this._setAuthCookieDebouncedPromise||(this._setAuthCookieDebouncedPromise=p.default.performWhenValidSkypeTokenArrives().then((()=>(l.log(this._logArea,"Valid Skype Token arrived. Setting auth cookie."),this._setAuthCookie().catch(i.noop)))),this._setAuthCookieDebouncedPromise.always((()=>{u.default.setTimeout((()=>{l.log(this._logArea,"Set AuthCookie Debounced. Setting SyncTask to undefined"),this._setAuthCookieDebouncedPromise=void 0}),r.default.getAsyncMediaFeatures().ams_cookie_setter_debounce_wait)}))),this._setAuthCookieDebouncedPromise):n.Rejected()}}},49956:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(16778),n=s(97691),r=s(89391),a=s(76621),l=s(51077),d=s(71830),c=s(98278),h=s(29791),u=s(39549),p=s(16402),g=s(86374),m=s(52262),S=s(82433),f=s(46096),y=s(33754),_=s(32638),v=s(18078),C=s(30124),b=s(27357),T=s(77275),M=s(79829),I=s(77914),w=s(71987),P=s(86045),k=s(22538),A=s(12770);t.default=new class{constructor(){k.RegisterStartupable(this,"IncomingMessageAnnouncementService",[a.default,m.default,b.default,u.default])}startup(){const e={},t={};return a.default.messagesProcessedWithBundleInfo.subscribe((s=>{if(P.default.shouldAnnounceForAccessibility()){const n=b.default.getActiveConversationId(c.MainRootViewId)||b.default.getActiveCallConversationId(c.MainRootViewId);i.each(s,(s=>{const i=s.message.cuid;if(i){if(this._shouldAnnounceMessage(s,n))if(s.message.isMutated()&&!this._isCurrentUserMessageReactionUpdate(s)||s.message.isDeletedMessage()){if(s.message.isDeletedMessage()&&!t[i]){const e=this.getAnnouncementText(s,!0);e&&(t[i]=A.default.setTimeout((()=>{delete t[i]}),1e4),o.Accessibility.announceForAccessibility(e))}}else{const t=this.getAnnouncementText(s);t&&!e[i]&&(e[i]=A.default.setTimeout((()=>{delete e[i]}),1e4),o.Accessibility.announceForAccessibility(t,!1,i))}s.message.isDeletedMessage()&&o.Accessibility.removeAnnouncementClass(i)}}))}})),n.Resolved()}getAnnouncementText(e,t){const s=e.message,o=(0,u.default)().getConversation(s.conversationId),n=o&&o.isThread()||!1,r=d.isEncryptedThread(s.conversationId);let a="";if(!r&&!t){const e=g.decode(s);a=h.toAccessibilityLabel(e,{message:s,includeSenderInformationInAccessibilityLabel:!1,includeReactionInformationInAccessibilityLabel:!1,includeMediaAlbumItemCountInAccessibilityLabel:!1})}let c="";v.default.isMyMri(s.creator)||(c=m.default.getDisplayName(s.creator)||"");const f={senderName:c,messageContent:a,timestamp:p.default.getDisplayTimeString(s.createdTime)};if(r){if(i.startsWith(s.content,"<handshakeinvite>"))return;return y.getString("AccessibilityLabel.NewPrivateMessage",f)}if(l.isScheduledCallType(s.messagetype))return this._getScheduledCallUpdateAnnouncement(s);if(i.isEmpty(e.reactionUpdates.added)){if(i.isEmpty(e.reactionUpdates.removed))return n?(f.threadName=m.default.getDisplayName(s.conversationId)||"",t?y.getString("AccessibilityLabel.RemovedMessageThreadAnnouncement",f):y.getString("AccessibilityLabel.NewThreadMessage",f)):t?y.getString("AccessibilityLabel.RemovedMessageConversationAnnouncement",f):y.getString("AccessibilityLabel.NewConversationMessage",f);{const t=i.last(e.reactionUpdates.removed);if(!t)return;f.senderName=m.default.getDisplayName(t.mri)||"";const s=S.default.getEmoticonByShortcutNoSubscription(t.key);return f.reaction=s&&s.description||t.key,y.getString("AccessibilityLabel.RemovedReactionToMessage",f)}}{const t=i.last(e.reactionUpdates.added);if(!t)return;f.senderName=m.default.getDisplayName(t.mri)||"";const s=S.default.getEmoticonByShortcutNoSubscription(t.key);return f.reaction=s&&s.description||t.key,y.getString("AccessibilityLabel.NewReactionToMessage",f)}}_isCurrentUserMessageReactionUpdate(e){const t=v.default.isMyMri(e.message.creator);return r.default.getS4LMessagingFeaturesNoSubscription().enableReactionAnnouncements&&t&&(!i.isEmpty(e.reactionUpdates.added)||!i.isEmpty(e.reactionUpdates.removed))}_isReactionUpdate(e){return!i.isEmpty(e.reactionUpdates.added)||!i.isEmpty(e.reactionUpdates.removed)}_isComingFromLongPollOrTrouter(e){return i.some(e.details,(e=>e.origin===f.MessageOrigin.LongPoll||e.origin===f.MessageOrigin.Trouter))}_shouldAnnounceMessage(e,t){const s=this._isComingFromLongPollOrTrouter(e),o=!i.isUndefined(t)&&t===e.message.conversationId,n=this._isComingFromEngagementSystem(e);if(!s||e.message.isDeletedMessage()&&!o||n)return!1;const r=(0,u.default)().getConversation(e.message.conversationId);if(r&&l.shouldServerMessageBeFilteredOut(e.message,r))return!1;const a=v.default.isMyMri(e.message.creator),d=this._isCurrentUserMessageReactionUpdate(e),c=_.areNotificationsEnabled(),h=r&&r.isMuted(),p=this._isReactionUpdate(e);return!e.message.isAlbumItem()&&(o?!a||d:C.default.isUsingStackNavigationContext()?!a&&c&&!h&&!p:!a&&!h&&!p)}_isComingFromEngagementSystem(e){const t=r.default.getEngagementFeatures().engagementSenderIdentity;return!!i.some(t,(t=>t===e.message.creator))}_getScheduledCallUpdateAnnouncement(e){const t=T.default.extractScheduledCallFromMessage(e);if(!t)return;const s=I.default.getScheduledCallById(t.id),o=I.default.getScheduledCallUpdatesDeltas(e.creator,s,t);if(i.isEmpty(o.invitations)){if(o.wasCanceled){const s=m.default.getDisplayName(e.creator)||"";return y.getString("Notifications.ScheduledCallDeletedBody",{displayName:s,subject:w.default.getScheduledCallSubject(t.subject)})}}else{let e="";if(i.forOwn(o.invitations,((s,i)=>{const o=m.default.getDisplayName(i)||"";e+=(s.invitationStatus===M.ScheduledCallInvitationStatus.Accepted?y.getString("Notifications.ScheduledCallAcceptedBody",{displayName:o,subject:w.default.getScheduledCallSubject(t.subject)}):y.getString("Notifications.ScheduledCallDeclinedBody",{displayName:o,subject:w.default.getScheduledCallSubject(t.subject)}))+" "})),e)return e}}}},9815:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocalMessageNotificationsService=void 0;const i=s(96486),o=s(31844),n=s(2604),r=s(26999),a=s(78045),l=s(97691),d=s(89391),c=s(63413),h=s(81169),u=s(76621),p=s(51077),g=s(71830),m=s(62141),S=s(98278),f=(s(984),s(87399)),y=s(75760),_=s(82927),v=s(31751),C=(s(75049),s(24339)),b=s(99686),T=(s(86374),s(52262)),M=s(76679),I=s(27447),w=s(10167),P=s(82433),k=s(46096),A=s(5581),E=s(36237),R=s(98754),L=s(33754),F=(s(12762),s(32638)),x=s(14572),O=s(26385),D=s(78735),B=s(46929),V=s(18078),N=s(17093),U=s(30124),H=s(27357),z=s(97223),W=s(88553),j=s(13847),G=s(33326),K=s(9582),q=s(29130),Q=s(14976),X=s(33714),$=s(77275),J=s(79829),Y=s(77914),Z=s(71987),ee=s(62232),te=s(22538),se=s(4057),ie=s(40363),oe=s(98762),ne=s(28069),re=s(72758),ae=s(53374),le=s(47447);class de{constructor(){this._recentlyNotifiedKeys=[],te.RegisterStartupable(this,"LocalMessageNotificationsService",[K.default,D.default])}startup(){return l.Resolved()}_getAppLaunchedNotificationType(e){const t=p.getMessageTypeGroup(e);if(e.isCurrentUserQuoted())return k.NotificationTypeAppLaunched.Quote;if(e.isCurrentUserMentioned())return k.NotificationTypeAppLaunched.Mention;switch(t){case p.MessageTypeGroups.MediaAlbum:return k.NotificationTypeAppLaunched.MediaAlbum;case p.MessageTypeGroups.Picture:return k.NotificationTypeAppLaunched.Photo;case p.MessageTypeGroups.Video:return k.NotificationTypeAppLaunched.Video;case p.MessageTypeGroups.UriFile:return k.NotificationTypeAppLaunched.File;case p.MessageTypeGroups.Moji:return k.NotificationTypeAppLaunched.Moji;case p.MessageTypeGroups.Sticker:return k.NotificationTypeAppLaunched.Sticker;case p.MessageTypeGroups.ScheduledCallInvite:return k.NotificationTypeAppLaunched.ScheduledCallInvite;case p.MessageTypeGroups.Location:return k.NotificationTypeAppLaunched.Location;case p.MessageTypeGroups.Text:return j.isLastMessageUpdateReaction(e)?k.NotificationTypeAppLaunched.Reaction:k.NotificationTypeAppLaunched.Text;default:return}}_shouldProcessReactionNotification(e){return j.isLastMessageUpdateReaction(e)?te.EnsureStarted(B.default).then((()=>B.default.getReactionNotificationsEnabled())):l.Resolved(!1)}_tryProcessingScheduledCallNotification(e){return p.isScheduledCallType(e.messagetype)?te.EnsureStarted(Y.default).then((()=>Y.default.processScheduledCallMessage(e))):l.Resolved(void 0)}processMessageInfoForNotifications(e){const t=e.message;return i.some(e.details,(e=>e.origin===k.MessageOrigin.ChatSync||e.origin===k.MessageOrigin.LocalChange))||(0,ne.isForceUpdateEnabled)()?l.Resolved(k.MessageProcessResult.CameFromSyncOrLocal):l.all([this._shouldProcessReactionNotification(t),this._tryProcessingScheduledCallNotification(t)]).then((([s,i])=>{const o=!(!i||!i.hasUpdates);if(V.default.isMyMri(t.creator)&&!s&&!o)return l.Resolved(k.MessageProcessResult.MyMessage);if(t.isDeletedMessage())return K.default.cancelNotificationById(t.conversationId+t.createdTime),l.Resolved(k.MessageProcessResult.DeletedMessage);if(t.isHiddenTranslationSettingsMessage())return l.Resolved(k.MessageProcessResult.TranslationSettingsSuppressed);if(d.default.getS4LCMCFeatures().enableMessageTranslation&&A.default.isConversationTranslated(t.conversationId)&&p.isWrittenTextMessageType(t.messagetype)&&!s)return l.Resolved(k.MessageProcessResult.OriginalForTranslatedConversationSuppressed);if(t.isEdited()&&!s&&!o)return l.Resolved(k.MessageProcessResult.EditedMessage);if(t.messagetype===p.MessageTypes.PopCard||t.messagetype===p.MessageTypes.Notice)return l.Resolved(k.MessageProcessResult.EngagementNotificationSuppressed);if(t.isMutated()&&!s&&!o)return l.Resolved(k.MessageProcessResult.MutatedMessage);if(p.isCallMessageType(t)||p.isCallInfoMessageType(t))return l.Resolved(k.MessageProcessResult.CallMessage);const n=p.isAddMemberMessageType(t.messagetype);if(p.isThreadActivityType(t.messagetype)&&!n&&!t.isE2eeHandshakeTypeAllowedForNotification())return E.log(k.LogTraceArea.Notifications,"Suppress all thread activity messages except e2e actions"),l.Resolved(k.MessageProcessResult.ThreadActivitySuppressed);if(n){const e=x.getMessageInitiator(t);if(!x.isAddCurrentUserThreadActivity(t)||C.getConversationAlwaysHiddenStatus(t.conversationId).hidden||!d.default.getS4LMessagingFeatures().enableAddedToConversationNotification||e&&V.default.isMyMri(e))return E.log(k.LogTraceArea.Notifications,"Suppress add member to thread activity"),l.Resolved(k.MessageProcessResult.ThreadActivitySuppressed)}if(t.hasAlbumId()){if(!t.isAlbum()&&!s)return l.Resolved(k.MessageProcessResult.Filtered)}const r=F.getReasonForNotificationsDisabled(!0);return void 0!==r?l.Resolved(r):l.all([u.default.getConversationMetaAsync(t.conversationId),I.isDisabledChatNotification(),te.EnsureStartedExclusive([b.default,c.default,R.default])]).then((s=>{const o=s[0],n=s[1];return void 0===o?l.Resolved(k.MessageProcessResult.UnknownConversation):n?l.Resolved(k.MessageProcessResult.DoNotDisturbEnabled):g.isUserMri(t.conversationId)&&f.isConversationObjectBlocked(o.conv)?l.Resolved(k.MessageProcessResult.FromBlockedUser):(E.log(k.LogTraceArea.Notifications,"Processed message info, deciding if we need to show a new notification"),F.getNotificationAction(e.isOtherEndpointActive,o.conv,t).then((e=>e.action!==z.MessageNotificationAction.InterruptUser&&e.action!==z.MessageNotificationAction.InformUserExternal?l.Resolved(k.MessageProcessResult.Filtered):(E.log(k.LogTraceArea.Notifications,"Preparing to present local message notification"),this._presentMessageNotification(t,o,e,i)))))}))}))}_presentMessageNotification(e,t,s,n){const r=D.default.getUserPreferencesLocal();let c=!1;const h=b.default.isCurrentUserActive();let u;if(te.HasStarted(H.default))if(U.default.isUsingSplitViewNoSubscription()){const e=a.default.getFocusedSplitViewId();e&&(u=H.default.getActiveConversationId(e))}else u=H.default.getActiveConversationId(S.MainRootViewId);if(h){if(u!==e.conversationId){const t=v.default.getAllSiblingConversations(e.conversationId);if(d.default.getS4LMessagingFeaturesNoSubscription().enableGroupedConversations&&i.some(t,(e=>e.id===u)))return l.Resolved(k.MessageProcessResult.SiblingConversationInTabActive)}if(!(u?u!==e.conversationId:this._shouldAllowChatNotificationsWhenNotInConversation()))return l.Resolved(k.MessageProcessResult.IsForegroundedInConversation);le.UICapabilities.inAppBrowserNotificationsSupported()&&q.default.isTinyScreenSizeNoSubscription(S.MainRootViewId)||(c=!0)}else if(c=!0,!r.enableScheduledCallNotifications&&s.notificationType===z.MessageNotificationType.ScheduledCall)return l.Resolved(k.MessageProcessResult.ScheduleCallNotificationsDisabled);if(!n||!n.hasUpdates){let t=e.cuid;if(s.notificationType===z.MessageNotificationType.Reaction&&(t+=e.getLastReactionTimeExcludingCurrentUser()),i.includes(this._recentlyNotifiedKeys,t))return l.Resolved(k.MessageProcessResult.RecentlyNotified);this._recentlyNotifiedKeys.push(t),this._recentlyNotifiedKeys.length>50&&this._recentlyNotifiedKeys.splice(0,this._recentlyNotifiedKeys.length-50)}if(c)return E.log(k.LogTraceArea.Notifications,"Presenting system notification"),this._showSystemLocalNotificationForMessage(e,t,s,n);{if(!r.enableInAppScheduledCallNotifications&&s.notificationType===z.MessageNotificationType.ScheduledCall)return l.Resolved(k.MessageProcessResult.InAppScheduleCallNotificationsDisabled);if(!r.enableInAppNotifications)return l.Resolved(k.MessageProcessResult.InAppNotificationsDisabled);const t=ae.default.newCauseId();E.log(k.LogTraceArea.Notifications,"Presenting in-app notification causeId: "+t),s.notificationType===z.MessageNotificationType.ScheduledCall?n&&this._showScheduledCallToast(e,n.updatesDelta):oe.default.scheduleSkypeMessage(e);const i=new O.MessagingToastShowEvent(e,s.notificationType,s.action,!1,!1,void 0);return E.track(i),r.enableNotificationSounds&&o.default.getRingerMode().then((e=>{e!==o.DeviceRingerMode.Silent&&e!==o.DeviceRingerMode.Vibrate&&ee.default.SkypeInAppNotification.playOnce(t)})),l.Resolved(k.MessageProcessResult.NotifiedInApp)}}_shouldAllowChatNotificationsWhenNotInConversation(){if(te.HasStarted(H.default)){if(U.default.isUsingStackNavigationContext())return oe.default.showMessageForScreenReaders();if(U.default.isUsingSplitViewNoSubscription())return!0;return H.default.getCompositeMainStageNavViewMode(S.MainRootViewId)===N.MainStageNavViewMode.WelcomeScreen}return!0}_showSystemLocalNotificationForMessage(e,t,s,o){if(w.default.isMandatoryUpdate())return l.Resolved(k.MessageProcessResult.MandatoryElectronUpdate);if(s.notificationType===z.MessageNotificationType.AddToConversation)return this._populateSystemLocalNotification(e.creator,e,t,void 0,s,void 0);if(s.notificationType===z.MessageNotificationType.Reaction){const i=F.getLastReactionUserMri(e);return i?T.default.getDisplayableProfilePotentiallyBeforeStartupAsync(i).then((i=>this._populateSystemLocalNotification(e.creator,e,t,i,s,void 0))):(E.warn(k.LogTraceArea.Notifications,"Could not find last notification user even though this is reaction notification."),l.Resolved(k.MessageProcessResult.LastReactionUserNotFound))}if(s.notificationType===z.MessageNotificationType.ScheduledCall){if(!o)return l.Resolved(k.MessageProcessResult.ScheduledCallInvitationUnknown);const n=Z.default.getScheduledCallSubject(o.scheduledCall.subject);if(o.updatesDelta.invitations&&!i.isEmpty(o.updatesDelta.invitations)){const i=this._getUserInvitationInfo(o.updatesDelta.invitations);if(!i)return l.Resolved(k.MessageProcessResult.ScheduledCallInvitationUnknown);const r=t.conv.isOneOnOne()&&t.conv.getOtherPartyMri()||e.creator;return T.default.getDisplayableProfilePotentiallyBeforeStartupAsync(r).then((r=>this._populateSystemLocalNotification(e.creator,e,t,r,s,{userMri:i.initiator,subject:n,invitationStatus:i.invitationStatus,scheduledCallId:o.scheduledCall.id,datetimeMs:o.scheduledCall.datetimeMs,hasNewResponses:!0})))}return T.default.getDisplayableProfilePotentiallyBeforeStartupAsync(e.creator).then((i=>{const r={userMri:e.creator,subject:n,wasCanceled:o.updatesDelta.wasCanceled,scheduledCallId:o.scheduledCall.id,hasUpdates:o.hasUpdates,datetimeMs:o.scheduledCall.datetimeMs};return this._populateSystemLocalNotification(e.creator,e,t,i,s,r)}))}{const i=te.HasStarted(re.default)?re.default.getConversationOwner(e.creator):e.creator;return T.default.getDisplayableProfilePotentiallyBeforeStartupAsync(i).then((o=>this._populateSystemLocalNotification(i,e,t,o,s)))}}_getUserInvitationInfo(e){let t,s;const o=i.keys(e);t=i.first(o);if(e[t]&&(s=e[t].invitationStatus),!i.isUndefined(s)&&s!==J.ScheduledCallInvitationStatus.Unknown)return{initiator:t,invitationStatus:s}}_showScheduledCallToast(e,t){let s,o;if(t)if(i.isUndefined(t.invitations)||i.isEmpty(t.invitations)){if(!t.hasSubjectOrDateTimeChanged&&!t.wasCanceled)return;s=e.creator,o=t.wasCanceled?X.ScheduleCallAlertTypes.Canceled:X.ScheduleCallAlertTypes.Edited}else{const e=this._getUserInvitationInfo(t.invitations);if(!e)return;s=e.initiator,o=e.invitationStatus===J.ScheduledCallInvitationStatus.Accepted?X.ScheduleCallAlertTypes.InvitationAccepted:X.ScheduleCallAlertTypes.InvitationDeclined}else s=e.creator,o=X.ScheduleCallAlertTypes.Received;const n=$.default.extractScheduledCallFromMessage(e);n&&oe.default.scheduleMessageForScheduledCall(e,o,s,n.subject)}_populateSystemLocalNotification(e,t,s,i,o,a){return te.EnsureStarted([W.default,P.default]).then((()=>{const d=W.default.getShowNotificationPermissionStatus();if(d===n.PermissionStatus.Denied||d===n.PermissionStatus.Unavailable)return l.Resolved(k.MessageProcessResult.SystemMessagePermissionsDenied);const c=new _.default(t.conversationId,s.conv),h=t.push_getSenderDisplayName(),u=i&&i.getDisplayName(h),p=i&&i.getShortName(),m=g.unescapeTextWithoutXml(t.push_getThreadTopic()),S=c.getDisplayName(m),f=j.getNotificationIcon(i,c),v={conversationId:t.conversationId,messageTimestamp:t.createdTime,senderId:e,eventType:this._getAppLaunchedNotificationType(t),scheduledCallId:a?a.scheduledCallId:void 0,consumptionHorizon:t.getConsumptionHorizonString()};return M.getCompactNotificationDisplayInfoPotentiallyBeforeStartupAsync(t,s.conv,o.notificationType,u,p,S,a).then((s=>{let i;i=t.isE2eeHandshakeTypeAllowedForNotification()?G.LocalNotificationIds.E2EE_CATEGORY_IDENTIFIER:o.notificationType===z.MessageNotificationType.ScheduledCall?a&&a.hasNewResponses?G.LocalNotificationIds.SCHEDULED_CALL_INVITE_RESPONSE:a&&a.hasUpdates?G.LocalNotificationIds.SCHEDULED_CALL_INVITE_EDIT:G.LocalNotificationIds.SCHEDULED_CALL_INVITE:G.LocalNotificationIds.CHAT_CATEGORY_IDENTIFIER;const c=D.default.getUserPreferencesLocal(),h=o.action===z.MessageNotificationAction.InterruptUser&&c.enablePushNotificationSounds,p=y.default.getActiveRecentsConversationCount();let g={conversationId:t.conversationId,messageTimestamp:F.getLatestMessageTimestamp(t),messageCreatorName:u,timestamp:Date.now(),category:i,message:s.body,title:s.title,serviceSpecificData:v,id:t.conversationId+t.createdTime,icon:f,priority:r.NotificationPriority.Max,silent:!h,senderId:e,applicationIconBadgeNumber:p};h&&(g.sound=ie.default.getSoundPath("Skype_Notification.m4a"));let m,S=[];return G.printNotificationTrace(g,"default"),S.push(K.default.saveLocalNotification(g,!0)),S.push(r.LocalNotifications.show(g)),o.snoozeUntil&&(E.log(k.LogTraceArea.Notifications,"Suppressing notifications for "+Q.mriOrId(t.conversationId)+" until "+o.snoozeUntil),K.default.snoozeConversation(t.conversationId,{createdAt:F.getLatestMessageTimestamp(t),until:o.snoozeUntil})),l.all(S).then((()=>{const e=new O.MessagingToastShowEvent(t,o.notificationType,o.action,!0,false,m);return E.track(e),d===n.PermissionStatus.Granted?k.MessageProcessResult.NotifiedSystemMessage:k.MessageProcessResult.SystemMessagePermissionsUnknown})).catch((e=>(E.warn(k.LogTraceArea.Notifications,"Local notification failure: "+se.default.errorAsString(e)),k.MessageProcessResult.SystemMessageFailure)))}))}))}_createAndroidNotification(e,t,s,o,n){if(!d.default.getS4LMessagingFeaturesNoSubscription().enableAndroidMessagingStyleNotifications||g.isEncryptedThread(e.conv.id)||n===z.MessageNotificationType.Reaction||p.isScheduledCallType(t.messagetype))return l.Resolved(s);const r=e.counts&&e.counts.unreadCount||1,a=ae.default.clampValue(r,1,5);return m.default.getMessagesForConversationBeforeTime(e.conv.id,Number.MAX_VALUE,a,!1).then((n=>(n=i.filter(n,(e=>!e.hasAlbumId()||t.isAlbum())))?this._getFormattedMessages(n).then((t=>{const i=L.getString("Notifications.MultiMessageTitleSingleConversation",{title:o,count:r});return Object.assign(Object.assign({messages:t,title:i,conversationName:o,conversationTitle:i},s),{isOneOnOne:e.conv.isOneOnOne(),id:e.conv.id})})):l.Resolved(s)))}_getFormattedMessages(e){e=i.orderBy(e,(e=>e.createdTime));let t=(0,h.chain)(e,(0,h.map)((e=>e.creator)),(0,h.uniq)());const s=i.map(t,(e=>T.default.getDisplayableProfilePotentiallyBeforeStartupAsync(e).then((t=>({creator:e,userDisplayable:t})))));return l.all(s).then((t=>i.map(e,(e=>{var s,o,n,r;const a=i.find(t,(t=>t.creator===e.creator));return M.formatPreviousMessagePotentiallyBeforeStartup(e,null!==(o=null===(s=null==a?void 0:a.userDisplayable)||void 0===s?void 0:s.getDisplayName())&&void 0!==o?o:"",null!==(r=null===(n=null==a?void 0:a.userDisplayable)||void 0===n?void 0:n.getAvatarUrl())&&void 0!==r?r:"",null==a?void 0:a.creator)}))))}}t.LocalMessageNotificationsService=de,t.default=new de},92350:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(62141),n=s(69382),r=s(26712),a=s(53374);t.default=new class{storeSavedMedia(e,t){const s=this._convertMediaPreviewInfoToDbSkypeMediaDrafts(e,t);return o.default.putMediaDrafts(s)}deleteSavedMedia(e){return o.default.deleteMediaDraft(e)}loadSavedMedia(){return o.default.getAllMediaDrafts().then((e=>e.map(this._convertDbSkypeMediaDraftsToMediaPreviewInfo)))}_convertMediaPreviewInfoToDbSkypeMediaDrafts(e,t){const s=i.filter(t.previews,(e=>this._isSerializableFile(e.data.file)&&(!e.data.thumbnail||this._isSerializableFile(e.data.thumbnail.file))));return{conversationId:e,albumId:t.albumId,previews:s,deletedPreviewsCount:t.deletedPreviewsCount+(t.previews.length-s.length),galleryOpenCount:t.galleryOpenCount,lastAddTimestamp:t.lastAddTimestamp}}_convertDbSkypeMediaDraftsToMediaPreviewInfo(e){const t=i.compact(i.map(e.previews,(e=>{if(n.fileExists({fileUri:r.default.getFileUrl(e.data)})&&(!e.data.thumbnail||n.fileExists({fileUri:r.default.getFileUrl(e.data.thumbnail)})))return e})));return{conversationId:e.conversationId,albumId:e.albumId?e.albumId:a.default.newGuid(),previews:t,deletedPreviewsCount:e.deletedPreviewsCount+(e.previews.length-t.length),galleryOpenCount:e.galleryOpenCount,wasSavedAsDraft:!0,wasRecoveredFromDb:!0,lastAddTimestamp:e.lastAddTimestamp}}_isSerializableFile(e){const t=e;return i.isString(t.uri)}}},14597:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Tests_MediaPrefetchService=t.QueueItem=void 0;const i=s(96486),o=s(97691),n=s(62141),r=s(6452),a=s(46096),l=s(7234),d=s(36237),c=s(98754),h=s(16724),u=s(14976),p=s(22538),g=s(4057),m=s(82176),S=s(26712),f=s(53374);class y{constructor(){this._pendingItems=[],this._downloadingItems=[],this._callbacks={},p.RegisterStartupable(this,"MediaPrefetchService",[r.default,l.default,c.default])}startup(){r.default.downloadUpdated.subscribe((e=>{if(e.isFinished){const t=f.default.newCauseId();d.log(a.LogTraceArea.MediaPrefetchService,"downloadUpdated, causeId: "+t);const s=i.find(this._downloadingItems,(t=>t.key===e.key));if(s){const o=i.filter(this._downloadingItems,(e=>e.key!==s.key));this._updateDownloadingItem(o);let n=l.default.getLocalUri(s.key);if(n)d.log(a.LogTraceArea.MediaPrefetchService,"Finished "+u.dev_unknownOmit(e.key)+" in "+(Date.now()-s.createdTime)+" causeId: "+t),this._sendTelemetryEvent(s,!0,a.MessagingFailureReason.None,e);else{e.isCached?d.error(a.LogTraceArea.MediaPrefetchService,"Download completed. Local uri missing "+u.dev_unknownOmit(s.key)):d.error(a.LogTraceArea.MediaPrefetchService,"Download failed. "+u.dev_unknownOmit(s.key));const t=e.amsGetStatusTransfer&&e.amsGetStatusTransfer.success,i=e.downloadTransfer&&e.downloadTransfer.success,o=t||i?a.MessagingFailureReason.CacheFailure:a.MessagingFailureReason.AMSFailure;this._sendTelemetryEvent(s,!1,o,e)}i.isEmpty(o)&&this._takeNext(t),n?this._resolve(s.key,{url:n}):this._reject(s.key,"Download failed. Local file missing",!!e.permanentFailureTransferType)}}}));const e=f.default.newCauseId();d.log(a.LogTraceArea.MediaPrefetchService,"startup, causeId: "+e);const t=c.default.getData(n.InternalKeys.PendingMediaPrefetchV1);i.isUndefined(t)||(r.default.cancelDownloadForKey(t,e),c.default.putData(n.InternalKeys.PendingMediaPrefetchV1,void 0));const s=c.default.getData(n.InternalKeys.PendingMediaPrefetch);return i.isEmpty(s)||(i.each(s,(t=>r.default.cancelDownloadForKey(t,e))),c.default.putData(n.InternalKeys.PendingMediaPrefetch,void 0)),o.Resolved()}add(e,t,s=!1){return i.first(this.addAll([e],t,s))}addAll(e,t,s=!1){let n;if(i.some(e,(e=>!e.key))&&(n="MediaPrefetchService empty key"),i.some(e,(e=>!e.url))&&(n="MediaPrefetchService empty url"),i.some(e,(e=>e.expiration<=Date.now()))&&(n="MediaPrefetchService expiration time in the past"),i.some(e,(e=>!S.default.isUrlValid(e.url)))&&(n="MediaPrefetchService invalid url"),n)return d.error(a.LogTraceArea.MediaPrefetchService,g.default.errorAsString(n)),i.map(e,(e=>o.Rejected(n)));const r=i.map(e,(e=>{const t=o.Defer();return this._callbacks[e.key]||(this._callbacks[e.key]=[]),this._callbacks[e.key].push({tag:e.tag,defer:t}),t.promise()}));return s?(this._pauseCurrentDownloadIfExists(t),this._pendingItems.unshift(i.clone(e))):this._pendingItems.push(i.clone(e)),this._takeNext(t),r}remove(e,t){if(!e)return void d.error(a.LogTraceArea.MediaPrefetchService,"Remove empty key");let s=!1;i.each(this._pendingItems,(t=>{const o=i.remove(t,(t=>t.key===e));i.isEmpty(o)&&(s=!0)}));const o=i.filter(this._downloadingItems,(t=>t.key===e));i.isEmpty(o)||(r.default.cancelDownloadForKey(e,t),this._updateDownloadingItem(i.filter(this._downloadingItems,(t=>t.key!==e))),s=!0),s&&(this._resolve(e,{cancelled:!0}),s=!0),l.default.isKnown(e)&&!r.default.isDownloading(e)&&(l.default.remove(e),s=!0),s&&(d.log(a.LogTraceArea.MediaPrefetchService,"Removed item: "+u.dev_unknownOmit(e)+", causeId: "+t),this._takeNext(t))}isQueued(e,t){return!!i.find(i.flatten(this._pendingItems),(s=>(!t||t===s.tag)&&s.key===e))||!!i.some(this._downloadingItems,(t=>t.key===e))&&(!t||i.some(this._downloadingItems,(e=>e.tag===t)))}reset(e){d.log(a.LogTraceArea.MediaPrefetchService,"Resetting, causeId: "+e),this._pendingItems=[];const t=this._callbacks;this._callbacks={},i.each(t,(e=>{i.each(e,(e=>{e.defer.resolve({cancelled:!0})}))})),this._callbacks={},i.isEmpty(this._downloadingItems)||this._cancelDownload(void 0,!1,e)}resetTag(e,t,s){let o=!1;d.log(a.LogTraceArea.MediaPrefetchService,"resetTag("+u.dev_unknownOmit(e)+") causeId: "+s),i.each(this._pendingItems,(s=>{i.remove(s,(s=>s.tag===e&&((!t||s.key===t)&&(this._resolve(s.key,{cancelled:!0},e),o=!0,!0))))})),i.some(this._downloadingItems,(t=>t.tag===e))&&(i.isUndefined(t)||i.some(this._downloadingItems,(e=>e.key===t)))&&(this._cancelDownload(t,!1,s),o=!0),o&&d.log(a.LogTraceArea.MediaPrefetchService,"did reset tag "+u.dev_unknownOmit(e)+", causeId: "+s),this._takeNext(s)}pause(e){d.log(a.LogTraceArea.MediaPrefetchService,"Pause, causeId: "+e),this._paused=!0,this._pauseCurrentDownloadIfExists(e)}resume(e){d.log(a.LogTraceArea.MediaPrefetchService,"Resume, causeId: "+e),this._paused=!1,this._takeNext(e)}isPaused(){return this._paused}_takeNext(e){if(d.log(a.LogTraceArea.MediaPrefetchService,"MediaPrefetchService._takeNext, causeId: "+e),this.isPaused())return void d.log(a.LogTraceArea.MediaPrefetchService,"TakeNext called while service is paused, causeId: "+e);if(!i.isEmpty(this._downloadingItems))return void i.each(this._downloadingItems,(t=>{if(!this._isDownloading(t.key)){const s="MediaPrefetchService has item set as downloading, but DownloadService is not tracking it";d.error(a.LogTraceArea.MediaPrefetchService,s),this._download([t],e)}}));let t;do{t=this._pendingItems.shift()}while(t&&i.isEmpty(t));t&&!i.isEmpty(t)&&this._download(t,e)}_download(e,t){const s=[];i.each(e,(e=>{const i=l.default.getLocalUri(e.key);i?(d.log(a.LogTraceArea.MediaPrefetchService,"Returning cached file for "+u.dev_unknownOmit(e.key)+" causeId: "+t),this._resolve(e.key,{url:i})):(this._isDownloading(e.key)?d.log(a.LogTraceArea.MediaPrefetchService,"Waiting on existing download "+u.dev_unknownOmit(e.key)+" causeId: "+t):(d.log(a.LogTraceArea.MediaPrefetchService,"Starting "+u.dev_unknownOmit(e.key)+" url: "+u.dev_unknownOmit(e.url)+" causeId: "+t),r.default.downloadAmsContentToCache(e.key,e.filename,e.expiration,e.evictionKind,e.evictionRank,e.url,t,3)),s.push(e))})),i.isEmpty(s)&&this._takeNext(t),this._updateDownloadingItem(s)}_updateDownloadingItem(e){const t=i.xorBy(e,this._downloadingItems,(e=>e.key));if(this._downloadingItems=e,!i.isEmpty(t)){const t=i.map(e,(e=>e.key));c.default.putData(n.InternalKeys.PendingMediaPrefetch,i.isEmpty(t)?void 0:t)}}_isDownloading(e){return r.default.isDownloading(e)||l.default.isKnown(e)}_resolve(e,t,s){const o=this._callbacks[e];delete this._callbacks[e],i.each(o,(e=>{(i.isUndefined(s)||e.tag===s)&&e.defer.resolve(t)}))}_reject(e,t,s,o){const n=this._callbacks[e];delete this._callbacks[e],i.each(n,(n=>{(i.isUndefined(o)||n.tag===o)&&n.defer.reject({key:e,message:t,isPermanent:s})}))}_cancelDownload(e,t,s){if(!i.isEmpty(this._downloadingItems)){let o=[],n=this._downloadingItems;i.isUndefined(e)||(o=i.filter(this._downloadingItems,(t=>t.key!==e)),n=i.filter(this._downloadingItems,(t=>t.key===e))),this._updateDownloadingItem(o),i.each(n,(e=>{l.default.isKnown(e.key)||r.default.cancelDownloadForKey(e.key,s),t||this._resolve(e.key,{cancelled:!0})}))}}_pauseCurrentDownloadIfExists(e){d.log(a.LogTraceArea.MediaPrefetchService,"MediaPrefetchService._pauseCurrentDownloadIfExists, causeId: "+e),i.isEmpty(this._downloadingItems)||(this._pendingItems.unshift(i.clone(this._downloadingItems)),this._cancelDownload(void 0,!0,e))}_sendTelemetryEvent(e,t,s,i){const o=new h.FileReceived(e.url,void 0,m.default.extractExtensionForTelemetry(i.filename));o.setDownloadDuration(Date.now()-e.createdTime),o.setSuccess(t,s,i.finishedAttemptsSoFar,i.responseStatusCode),d.track(o)}}t.Tests_MediaPrefetchService=y;t.QueueItem=class{constructor(e,t,s,i,o,n,r){this.key=e,this.url=t,this.filename=s,this.tag=i,this.expiration=o,this.evictionKind=n,this.evictionRank=r,this.createdTime=Date.now()}},t.default=new y},6286:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(97691),n=s(71830),r=s(82261),a=s(66923),l=s(46096),d=s(53559),c=s(36237),h=s(81157),u=s(3088),p=s(85207),g=s(15963),m=s(78262),S=s(26712),f=s(53374);t.default=new class{constructor(){this._getPostRequestByUploadType=(e,t,s)=>{const i=s?{albumId:s}:void 0;if(void 0!==t.mediaSelection)return h.default.postMediaSelections(t.mediaSelection,e,l.PostSource.MediaPreview,{scenarioInfo:t.scenario,properties:i},t.captureSessionTelemetry,t.causeId);const o=a.default.determineUploadFileType(t,n.isEncryptedThread(e));if(o===m.UploadFileType.Video){const s={name:g.ScenarioName.SendVideo};return p.default.postVideoWithThumbnail([e],t,l.PostSource.MediaPreview,!1,s,void 0,void 0,i)}if(o===m.UploadFileType.Picture){const s={name:g.ScenarioName.SendPicture};return p.default.postUpload([e],t,l.PostSource.MediaPreview,!1,{scenarioInfo:s,properties:i})}{const s={name:g.ScenarioName.SendFile};return p.default.postUpload([e],t,l.PostSource.MediaPreview,!1,{scenarioInfo:s})}}}sendPreviews(e,t){c.log(l.LogTraceArea.GenericUnsafe,"service sendPreviews causeId: "+t);const s=u.default.getPreviews(e);return s.length?this.sendPreviewsWithData(e,s.map((e=>e.data)),u.default.getAlbumId(e)).then((()=>{c.log(l.LogTraceArea.GenericUnsafe,"media sent causeId: "+t),u.default.markPreviewsSent(e,t)})):o.Resolved()}sendPreviewsWithData(e,t,s){if(!t.length)return o.Resolved();let a,c=-1;if(!n.isAgent(e)){i.sumBy(t,(e=>d.default.isImageExtension(e.extension)||d.default.isVideoExtension(e.extension)?1:0))>1&&(a=s||f.default.newGuid(),c=i.findIndex(t,(e=>d.default.isImageExtension(e.extension)||d.default.isVideoExtension(e.extension))))}const h=t.map((t=>()=>this._getPostRequestByUploadType(e,t,a)));if(c>=0){const t=c+1;h.splice(t,0,(()=>o.Resolved().then((()=>{if(void 0!==a){const t=r.createMediaAlbumMessage(e,l.PostSource.MediaPreview,a);p.default.postMessage(t)}}))))}return i.reduce(h,((e,t)=>e.then(t)),o.Resolved())}addPreviews(e,t,s){if(i.isEmpty(e)&&!this.isMediaPreviewEnabled(t))return;const o=e.map((e=>Object.assign({data:e,uid:f.default.newGuid(),originator:s},this._getThumbnailForPreview(e))));u.default.addPreviews(o,t)}isMediaPreviewEnabled(e){return e&&!n.isEncryptedThread(e)}_getThumbnailForPreview(e){return d.default.isVideoExtension(e.extension)&&e.thumbnail?{thumbnailUrl:S.default.getFileUrl(e.thumbnail),videoThumbnailUrl:S.default.getFileUrl(e)}:{thumbnailUrl:S.default.getFileUrl(e)}}}},51470:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageSendPerfRecordStore=void 0;const i=s(96486),o=s(89391),n=s(46096),r=s(36237),a=s(69399);function l(e,t){return t?t-e:-1}class d extends a.PerfEventBase{constructor(e,t,s){super(e,s),this._details=t}getScenarioName(){return"MessageSendToMessageLieRender"}getAttributes(){const e=super.getAttributes(),t=this._details.submittedToPostingServiceTime;return e.SubmittedToPostingServiceDelay=l(t,this._details.submittedToPostingServiceTime),e.ReachedPostingTransferServiceDelay=l(t,this._details.reachedPostingTransferServiceTime),e.LieReachedChatServiceDataServiceDelay=l(t,this._details.lieReachedChatServiceDataServiceTime),e.MessagPickedFromViewStoreIntoViewDelay=l(t,this._details.messagPickedFromViewStoreIntoViewTime),e.MessageLieRenderedDelay=l(t,this._details.messageLieRenderedTime),e}}class c{constructor(){this._perfRecords={}}notifyMessageSubmittedToPostingService(e){o.default.getS4LMessagingFeatures().enableMessageSendE2EPerfTracking&&(this._perfRecords[e]&&r.error(n.LogTraceArea.MessageComposer,"MessageSendPerfRecordStore: Msg for this clientMessageId already notified!"),this._perfRecords[e]={submittedToPostingServiceTime:Date.now()})}notifyMessageReachedPostingTransferService(e){const t=this._perfRecords[e];t&&!t.reachedPostingTransferServiceTime&&(t.reachedPostingTransferServiceTime=Date.now())}notifyMessageLieReachedChatServiceDataService(e){const t=this._perfRecords[e];t&&!t.lieReachedChatServiceDataServiceTime&&(t.lieReachedChatServiceDataServiceTime=Date.now())}notifyMessagePickedFromMessageViewStoreIntoView(e){const t=this._perfRecords[e];t&&!t.messagPickedFromViewStoreIntoViewTime&&(t.messagPickedFromViewStoreIntoViewTime=Date.now())}notifyMessageRendered(e,t){const s=this._perfRecords[e];s&&(s.messageLieRenderedTime=Date.now(),this._finalize(s,e,t))}_finalize(e,t,s){const i=e.submittedToPostingServiceTime;r.track(new d(e.messageLieRenderedTime?e.messageLieRenderedTime-i:void 0,e,s)),delete this._perfRecords[t],this._cleanupStaleRecords()}_cleanupStaleRecords(){const e=Date.now();this._perfRecords=i.omitBy(this._perfRecords,(t=>t.submittedToPostingServiceTime+6e4<e))}}t.MessageSendPerfRecordStore=c,t.default=new c},50513:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(74958),o=s(96486),n=s(89391),r=s(51077),a=s(51077),l=s(39549),d=s(86374),c=s(46096),h=s(5581),u=s(36237),p=s(12762),g=s(52305),m=s(18078),S=s(94214);t.default=new class{constructor(){this._endpointUrlOverride=void 0}setEndpointUrlOverride(e){o.isEmpty(e)||(this._endpointUrlOverride=e,u.log(c.LogTraceArea.MessageStream,"MessageTranslatorService.setEndpointUrlOverride: "+i.pii.Omit(e)))}getEndpointUrl(){return this._endpointUrlOverride&&!o.isEmpty(this._endpointUrlOverride)?this._endpointUrlOverride:n.default.getS4LCMCFeatures().messageTranslatorEndpointUrl}clearEndpointUrlOverride(){this._endpointUrlOverride=void 0,u.log(c.LogTraceArea.MessageStream,"MessageTranslatorService.clearEndpointUrlOverride")}maybeRequestTranslation(e,t,s,i){if(!n.default.getS4LCMCFeatures().enableMessageTranslation)return;if(!s&&!i)return;if(s){if(o.isEmpty(s.content))return;if(s.contenttype!==r.ContentTypes.Text)return;if(s.messagetype!==a.MessageTypes.RichText)return}const p=(0,l.default)().getConversation(e);if(!p||!h.default.isConversationTranslated(e))return;const f=p.getMessageTranslationLocale();if(!f||o.isEmpty(f))return void u.log(c.LogTraceArea.MessageStream,"MessageTranslatorService.maybeRequestTranslation: translation locale is undefined");const y=this.getEndpointUrl();if(o.isEmpty(y))return void u.log(c.LogTraceArea.MessageStream,"MessageTranslatorService.maybeRequestTranslation: translator endpoint is undefined");const _=m.default.getSkypeMri();let v=i;s&&(v=d.decode(s,_,e).children);const C=this._getRawText(v);if(!C)return void u.log(c.LogTraceArea.MessageStream,"MessageTranslatorService.maybeRequestTranslation: unable to extract raw text from message");const b={text:C,loc:f,chatThreadId:e,oid:t},T={type:"translate",auth:{provider:"Skype",parameters:{token:S.default.getRawSkypeToken(),identity:m.default.getSkypeId()}},request:b};g.default.requestTranslation(y,T)}_getRawText(e){const t=o.compact(o.map(e,(e=>{const t=e;if(t&&e instanceof p.PlainTextNode)return t.getRawText?t.getRawText():this._getRawText(t.children)})));return o.isEmpty(t)?void 0:t.join(" ")}}},86494:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(97691),n=s(89391),r=s(98925),a=s(22801),l=s(76621),d=s(51077),c=s(51077),h=s(39549),u=s(82261),p=s(46096),g=s(5581),m=s(36237),S=s(46929),f=s(18078),y=s(85207),_=s(22538);t.default=new class{constructor(){this._onAppConfigChange=()=>{const{enableMessageTranslation:e}=n.default.getS4LCMCFeatures();e&&!this._messagesProcessedToken?this._messagesProcessedToken=l.default.messagesProcessedWithBundleInfo.subscribe(this._messagesProcessed):!e&&this._messagesProcessedToken&&(this._messagesProcessedToken.unsubscribe(),this._messagesProcessedToken=void 0)},this._messagesProcessed=e=>o.all(i.map(i.filter(e,(e=>e.message.isTranslationSettings())),(e=>{if(e.messageAlreadySeen||i.includes(e.details.map((e=>e.origin)),p.MessageOrigin.LocalChange))return o.Resolved();const t=(0,h.default)().getConversation(e.message.conversationId);if(!t)return o.Resolved();const s=t.getConsumptionHorizonTimestamp();if(e.message.createdTime<=s)return o.Resolved();const n=d.getTranslationSettingsMetadata(e.message.content),l=g.default.getConversationTranslationState(e.message.conversationId)||r.TranslationState.Disabled;if(!n)return m.warn(p.LogTraceArea.ChatServiceSubscriptions,"MessageTranslatorSettingsService: translationSettings could not be parsed"),o.Resolved();const c=this._getNextTranslationState(n),u=c!==l,y=e.message.conversationId,_=f.default.isMyMri(e.message.creator);return this._isSettingsMessageValid(n,y,_)?a.default.setMessageTranslationLocale(y,n.messageTranslationLocale).then((()=>(c===r.TranslationState.Disabled&&S.default.deleteTranslationBannerDismissStates(y),u?a.default.setTranslationState(y,c):o.Resolved()))):o.Resolved()}))),this._getNextTranslationState=e=>{const{newTranslationState:t}=e,s=parseInt(r.TranslationState[t],10);return s===r.TranslationState.Cancelled||s===r.TranslationState.Declined?r.TranslationState.Disabled:s||r.TranslationState.Disabled},this._isSettingsMessageValid=(e,t,s)=>{const i=g.default.getConversationTranslationState(t)||r.TranslationState.Disabled,o=this._getNextTranslationState(e),n=o!==i;return m.log(p.LogTraceArea.ChatServiceSubscriptions,"MessageTranslatorSettingsService: currentState - "+i+", nextState - "+o+", ownMessage - "+s),!s&&(!(o===r.TranslationState.Enabled&&!e.messageTranslationLocale||!n&&i===r.TranslationState.Disabled)||(m.warn(p.LogTraceArea.ChatServiceSubscriptions,"MessageTranslatorSettingsService: failed to be Enabled - no messageTranslationLocale"),!1))},this._updateTranslationSettings=()=>{const e=g.default.getLocalCallTranslatorBotSpokenLanguageLocale(),t=n.default.getS4LCMCFeatures().enableOldMessageTranslation;return o.all(i.map((0,h.default)().getTranslatedConversations(),(s=>{const i=g.default.getConversationTranslationState(s.id)||r.TranslationState.Disabled;if(i===r.TranslationState.Disabled)return o.Resolved();const n=u.createTranslationSettingsMessage(s.id,p.PostSource.MessagePanel,e||"",i,!0);let a;return t&&(a=u.createTranslationSettingsMessage(s.id,p.PostSource.MessagePanel,e||"",i,!0,c.MessageTypes.Data)),n?(t&&a&&y.default.postMessage(a),y.default.postMessage(n)):m.log(p.LogTraceArea.ChatServiceSubscriptions,"_updateTranslationSettings failed to update setting for %s",s.id),o.Resolved()})))},_.RegisterStartupable(this,"MessageTranslatorSettingsService",[a.default,S.default])}startup(){return n.default.subscribe(this._onAppConfigChange),this._onAppConfigChange(),this._myUserPreferencesStoreSubscription&&S.default.unsubscribe(this._myUserPreferencesStoreSubscription),this._myUserPreferencesStoreSubscription=S.default.subscribe(this._updateTranslationSettings,S.TriggerKeys.CallTranslatorBotSpokenLanguageLocale),o.Resolved()}test_reset(){this._messagesProcessedToken&&this._messagesProcessedToken.unsubscribe(),this._myUserPreferencesStoreSubscription=void 0,this._messagesProcessedToken=void 0}}},22245:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(26999),o=s(97691),n=s(89391),r=s(98278),a=s(46096),l=s(36237),d=s(18078),c=s(27357),h=s(14976),u=s(66765),p=s(22538),g=s(12770);t.default=new class{constructor(){this._multiTabNotificationsEnabled=!1,p.RegisterStartupable(this,"MultiTabNotificationService",[c.default,u.default])}startup(){return c.default.subscribe((()=>this._refreshActiveConversation("NavigationStateStore"))),n.default.subscribe((()=>{const e=n.default.getS4LMessagingFeatures().browserMultiTabNotifications.enabled;e!==this._multiTabNotificationsEnabled&&(this._multiTabNotificationsEnabled=e,this._refreshActiveConversation("AppConfigStore"))})),this._multiTabNotificationsEnabled=n.default.getS4LMessagingFeatures().browserMultiTabNotifications.enabled,this._refreshActiveConversation("startup"),o.Resolved()}_refreshActiveConversation(e){if(this._activeConversationRefreshTimer&&(g.default.clearTimeout(this._activeConversationRefreshTimer),this._activeConversationRefreshTimer=void 0),this._multiTabNotificationsEnabled){const t=c.default.getActiveConversationId(r.MainRootViewId),s=n.default.getS4LMessagingFeatures().browserMultiTabNotifications;l.log(a.LogTraceArea.Notifications,"Refreshing active conversation to "+h.mriOrId(t)+", reason: "+e),i.LocalNotifications.setActiveConversation(d.default.getSkypeMri(),t,s.activeTabExpirationInterval),this._activeConversationRefreshTimer=g.default.setTimeout((()=>{this._refreshActiveConversation("Timer"),this._activeConversationRefreshTimer=void 0}),s.activeTabRefreshInterval)}}}},60621:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GifPreviewService=t.MojiPreviewService=void 0;const i=s(74634),o=s(70665);class n{constructor(){this._openPesPreviewEvent=new i.default,this._closePesPreviewEvent=new i.default,this._sendPesEvent=new i.default,this.openPesPreview=e=>{this._openedPesPreview&&this.closePesPreview(),this._navDismissalRegistrationHandle=o.register({dismiss:this.closePesPreview}),this._openPesPreviewEvent.fire(e),this._openedPesPreview=e},this.closePesPreview=()=>{this._openedPesPreview&&(this._navDismissalRegistrationHandle&&(o.unregister(this._navDismissalRegistrationHandle),this._navDismissalRegistrationHandle=void 0),this._closePesPreviewEvent.fire(this._openedPesPreview),this._openedPesPreview=void 0)},this.sendPes=e=>{this._sendPesEvent.fire(e)},this.onPesPreviewOpened=e=>this._openPesPreviewEvent.subscribe(e),this.onPesPreviewClosed=e=>this._closePesPreviewEvent.subscribe(e),this.onSend=e=>this._sendPesEvent.subscribe(e)}}t.MojiPreviewService=new n,t.GifPreviewService=new n},17707:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(97691),n=s(89391),r=s(81169),a=s(62141),l=s(82433),d=s(32183),c=s(46096),h=s(82666),u=s(43106),p=s(57347),g=s(72685),m=s(36237),S=s(98754),f=s(33754),y=s(72666),_=s(66501),v=s(26424),C=s(96168),b=s(58962),T=s(90025),M=s(22538),I=s(13130),w=s(4057),P=s(53374);var k;!function(e){e[e.MojiEmoticon=0]="MojiEmoticon",e[e.CaptureSticker=1]="CaptureSticker",e[e.ChatSticker=2]="ChatSticker",e[e.Gif=3]="Gif"}(k||(k={}));t.default=new class{constructor(){this._cachedPesConfigs={},this._numberOfFetchesInProgress={[k.MojiEmoticon]:0,[k.CaptureSticker]:0,[k.ChatSticker]:0,[k.Gif]:0},this._inProgressEmoticonInfoFetches={},this._trendingGifGenerationCount=0,this._searchGifGenerationCount=0,this._updateConfig=(e,t,s,n)=>{let r;m.log(c.LogTraceArea.PesService,`_updateConfig: ${k[t]} pesConfigUrl ${e} causeId:${s}`),this._updateFromLocalDB(t,s),r=this._cachedPesConfigs[t];const l=f.getLocale();let d,h=!(r&&r.url===e&&3===r.configVersion&&l===r.locale);if(t!==k.MojiEmoticon||h||(h=!(r&&r.emoticonsRoot),h&&m.log(c.LogTraceArea.PesService,`_updateConfig: updating pes config for emoticons due to bad emoticons root, configType ${k[t]} pesConfigUrl ${e} causeId:${s}`)),!h&&!n)return m.log(c.LogTraceArea.PesService,`_updateConfig: no need to refetch configType ${k[t]} pesConfigUrl ${e} causeId:${s}`),o.Resolved();if(""===e)return m.warn(c.LogTraceArea.PesService,`_updateConfig: isFetchNeeded: ${h}, forceFetch: ${n}, configType ${k[t]} but pesConfigUrl is empty! causeId:${s}`),o.Resolved();d=++this._numberOfFetchesInProgress[t];const u=Date.now();return this._fetchConfig(e,s).then((n=>{if(m.log(c.LogTraceArea.PesService,`_updateConfig: _fetchConfig ${k[t]} finished, fetchTime: ${Date.now()-u}[ms], causeId:${s}`),d===this._numberOfFetchesInProgress[t]){if(n.response){m.log(c.LogTraceArea.PesService,`_updateConfig: ${k[t]} pesConfigUrl ${e} fetching everything causeId:${s}`);const r=Date.now();let l=this._processConfig(n.response,t);m.log(c.LogTraceArea.PesService,`_updateConfig: _processConfig ${k[t]} finished, processingTime: ${Date.now()-r}[ms], causeId:${s}`);const d={url:e,eTag:n.eTag,configVersion:3,emoticonsRoot:n.response.emoticonsRoot,locale:f.getLocale()};if(t===k.MojiEmoticon){const t=i.filter(l.tabs,(e=>e.tabType===b.TabType.Emoticon)).length,o=i.filter(l.tabs,(e=>e.tabType===b.TabType.Moji)).length;if(0===t||0===o||0===l.emoticons.length||0===l.mojis.length){const i=b.cultureInfo.getPesLocale(f.getLocale());return m.track(new T.EmptyPesConfigurationReceived(i,e,t,o,l.emoticons.length,l.mojis.length)),void m.warn(c.LogTraceArea.PesService,"_updateConfig Received empty mojiEmoticon PES configuration. Using older version from DB. causeId:"+s)}}else if(t===k.CaptureSticker){if(0===i.filter(l.tabs,(e=>e.tabType===b.TabType.CaptureSticker)).length||0===l.stickers.length)return void m.warn(c.LogTraceArea.PesService,"_updateConfig Received empty sticker PES configuration. Using older version from DB. causeId:"+s)}else if(t===k.ChatSticker){if(0===i.filter(l.tabs,(e=>e.tabType===b.TabType.ChatSticker)).length||0===l.chatStickers.length)return void m.warn(c.LogTraceArea.PesService,"_updateConfig Received empty chat sticker PES configuration. Using older version from DB. causeId:"+s)}else if(t===k.Gif){if(0===i.filter(l.tabs,(e=>e.tabType===b.TabType.Gif)).length)return void m.warn(c.LogTraceArea.PesService,"_updateConfig Received empty chat gif PES configuration. Using older version from DB. causeId:"+s)}a.default.openTransaction([a.Stores.InternalData],!0).then((e=>t===k.MojiEmoticon?o.all([S.default.putData(a.InternalKeys.PesTabs,l.tabs,e),S.default.putData(a.InternalKeys.Emoticons,l.emoticons,e),S.default.putData(a.InternalKeys.Mojis,l.mojis,e),S.default.putData(a.InternalKeys.PesConfigInfo,d,e)]).then(i.noop):t===k.CaptureSticker?o.all([S.default.putData(a.InternalKeys.PesStickerInCaptureTabs,l.tabs,e),S.default.putData(a.InternalKeys.StickersInCapture,l.stickers,e),S.default.putData(a.InternalKeys.PesStickerInCaptureConfigInfo,d,e)]).then(i.noop):t===k.ChatSticker?o.all([S.default.putData(a.InternalKeys.PesStickerInChatTabs,l.tabs,e),S.default.putData(a.InternalKeys.StickersInChat,l.chatStickers,e),S.default.putData(a.InternalKeys.PesStickerInChatConfigInfo,d,e)]).then(i.noop):t===k.Gif?o.all([S.default.putData(a.InternalKeys.PesGifTabs,l.tabs,e),S.default.putData(a.InternalKeys.PesGifConfigInfo,d,e)]).then(i.noop):(P.default.switchStatementExhaustiveChecking(t),o.Rejected()))).then(i.noop,(e=>{m.error(c.LogTraceArea.PesService,"Unable to store updated config info: "+w.default.errorAsString(e)+" causeId:"+s)})),this._setConfig(d,t),t===k.MojiEmoticon?(C.default.setEmoticonMojiTabs(l.tabs),this._setEmoticons(l.emoticons),y.default.setMojis(l.mojis)):t===k.CaptureSticker?(C.default.setCaptureStickerTabs(l.tabs),I.default.setCaptureStickers(l.stickers)):t===k.ChatSticker?(C.default.setChatStickerTabs(l.tabs),I.default.setChatStickers(l.chatStickers)):t===k.Gif&&C.default.setGifTabs(l.tabs)}else m.error(c.LogTraceArea.PesService,"_updateConfig returned null configuration causeId:"+s);this._numberOfFetchesInProgress[t]=0}else m.log(c.LogTraceArea.PesService,"_updateConfig Newer update has been scheduled, returning! "+k[t]+" causeId:"+s)})).fail((e=>{m.error(c.LogTraceArea.PesService,"Fetch PES configuration data failed with: "+w.default.errorAsString(e))}))},this._itemTypes={EMOTICON:"emoticon",MOJI:"flik",STICKER:"sticker",TAB:"tab",GIF:"gif"},M.RegisterStartupable(this,"PesService",[g.default,S.default])}startup(){return m.log(c.LogTraceArea.PesService,"Startup"),C.default.setLoadingStatus(C.PesConfigLoadingStatus.Loading),this._queueRefreshConfigFromLocalDB("Startup"),this._queueRefreshConfig("Startup"),n.default.subscribe((()=>{this._queueRefreshConfig("AppConfigUpdate")})),g.default.setRefreshOptions("PesService",{interval:216e5,taskTypeFlags:p.TaskTypeFlags.CpuIntensive|p.TaskTypeFlags.UsesNetworking,callback:()=>(this._queueRefreshConfig("InfoRefresh"),o.Resolved())}),o.Resolved()}refreshConfig(e,t){m.log(c.LogTraceArea.PesService,"refreshConfig causeId:"+e+", forceFetch:"+t),this._refreshConfig(e,t)}_refreshConfigFromLocalDB(e){m.log(c.LogTraceArea.PesService,"_refreshConfigLocalOnly causeId:"+e),this._updateFromLocalDB(k.MojiEmoticon,e),this._updateFromLocalDB(k.CaptureSticker,e),this._updateFromLocalDB(k.ChatSticker,e),n.default.getS4LMessagingFeatures().enablePesGifs&&this._updateFromLocalDB(k.Gif,e)}_refreshConfig(e,t){m.log(c.LogTraceArea.PesService,"_refreshConfig causeId:"+e+", forceFetch:"+t),this._updateConfig(n.default.getPesConfig().pes_config,k.MojiEmoticon,e,t),this._updateConfig(n.default.getPesConfig().sticker_config,k.CaptureSticker,e,t),this._updateConfig(n.default.getPesConfig().sticker_chat_config,k.ChatSticker,e,t),n.default.getS4LMessagingFeatures().enablePesGifs&&this._updateConfig(n.default.getPesConfig().gif_config,k.Gif,e,t)}_queueRefreshConfigFromLocalDB(e){m.log(c.LogTraceArea.PesService,"_queueRefreshConfigFromLocalDB (localDB) causeId:"+e),p.default.queueIdleTask("PesService UpdateConfig (localDB)",p.TaskTypeFlags.CpuIntensive,(()=>this._refreshConfigFromLocalDB(e)))}_queueRefreshConfig(e){m.log(c.LogTraceArea.PesService,"_queueRefreshConfig (network) causeId:"+e),p.default.queueIdleTask("PesService UpdateConfig (network)",p.TaskTypeFlags.CpuIntensive|p.TaskTypeFlags.UsesNetworking,(()=>this._refreshConfig(e)))}_updateFromLocalDB(e,t){if(e in this._cachedPesConfigs)return;m.log(c.LogTraceArea.PesService,`_updateFromLocalDB: ${k[e]} not cached, causeId:${t}`);const s=Date.now(),i=f.getLocale();if(e===k.MojiEmoticon){const e=S.default.getDataExclusive(a.InternalKeys.PesConfigInfo);this._setConfig(e,k.MojiEmoticon);const t=S.default.getDataExclusive(a.InternalKeys.Emoticons),s=S.default.getDataExclusive(a.InternalKeys.PesTabs),o=S.default.getDataExclusive(a.InternalKeys.Mojis);this._setEmoticons(t),C.default.setEmoticonMojiTabs(s),y.default.setMojis(o),e&&s&&t&&o&&e.locale===i||this._setConfig(void 0,k.MojiEmoticon)}if(e===k.CaptureSticker){const e=S.default.getData(a.InternalKeys.PesStickerInCaptureConfigInfo);this._setConfig(e,k.CaptureSticker);const t=S.default.getData(a.InternalKeys.PesStickerInCaptureTabs),s=S.default.getData(a.InternalKeys.StickersInCapture);C.default.setCaptureStickerTabs(t),I.default.setCaptureStickers(s),e&&t&&s||this._setConfig(void 0,k.CaptureSticker)}if(e===k.ChatSticker){const e=S.default.getData(a.InternalKeys.PesStickerInChatConfigInfo);this._setConfig(e,k.ChatSticker);const t=S.default.getData(a.InternalKeys.PesStickerInChatTabs),s=S.default.getData(a.InternalKeys.StickersInChat);C.default.setChatStickerTabs(t),I.default.setChatStickers(s),e&&t&&s&&e.locale===i||this._setConfig(void 0,k.ChatSticker)}if(e===k.Gif){const e=S.default.getData(a.InternalKeys.PesGifConfigInfo);this._setConfig(e,k.Gif);const t=S.default.getData(a.InternalKeys.PesGifTabs);C.default.setGifTabs(t),e&&t&&e.locale===i||this._setConfig(void 0,k.Gif)}m.log(c.LogTraceArea.PesService,`_updateFromLocalDB: ${k[e]}, wasLoadedAndSet: ${e in this._cachedPesConfigs}, fetchTime: ${Date.now()-s}[ms], causeId:${t}`)}_setConfig(e,t){this._cachedPesConfigs[t]=e}_setEmoticons(e){this._cachedPesConfigs[k.MojiEmoticon]&&e&&e.length>0&&(d.setBaseUrl(this._cachedPesConfigs[k.MojiEmoticon].emoticonsRoot),l.default.setEmoticons(e))}_fetchConfig(e,t){m.log(c.LogTraceArea.Pes,"_fetchConfig causeId:"+t);const s=o.Defer(),i=b.cultureInfo.getPesLocale(f.getLocale()),n=e.replace("/default","/"+i);let r=i=>{_.default.getPesConfig(i).then((e=>{s.resolve(e)}),(o=>{i===e?s.reject(new Error("No PES configuration service endpoint: "+o)):(m.log(c.LogTraceArea.Pes,"PesService fetch Falling back to language-neutral PES configuration causeId:"+t),r(e))}))};return r(n),s.promise()}_processConfig(e,t){let s=[],o=[],r=[],a=[],l=[],d=[],h={},u=[];if(e)if(e.items){const p=n.default.getHeaders().CountryCode;if(p||m.error(c.LogTraceArea.PesService,"ECS Config is missing country header!"),i.each(e.items,(e=>{p&&(e.excludedCountries&&i.includes(e.excludedCountries,p)||!i.isEmpty(e.includedCountries)&&!i.includes(e.includedCountries,p))?d.push(e.id):(h[e.id]=e,e.group&&u.push(e))})),!i.isEmpty(d)){i.each(u,(e=>{const t=i.difference(e.group,d);0!==t.length?(t.unshift(e.id),e.group=t):delete e.group}));const t=i.remove(e.packs,(e=>(i.remove(e.items,(e=>i.includes(d,e))),i.isEmpty(e.items)))).map((e=>e.id));e.tabs&&i.remove(e.tabs,(e=>(i.remove(e.sections,(e=>i.includes(t,e.pack))),i.isEmpty(e.sections))))}i.each(h,(s=>{if(s.type===this._itemTypes.EMOTICON){let e=this._emoticonFromMetadata(s);e&&o.push(e)}else if(s.type===this._itemTypes.MOJI){let t=this._mojiFromMetadata(s,e);t&&r.push(t)}else if(s.type===this._itemTypes.STICKER&&t===k.ChatSticker){let t=this._stickerFromMetadata(s,e);t&&l.push(t)}else if(s.type===this._itemTypes.STICKER){let t=this._stickerFromMetadata(s,e);t&&a.push(t)}}));const g=i.keyBy(e.packs,(e=>e.id));s=i.map(e.tabs,(s=>this._tabFromMetadata(s,t,g,h,e)))}else m.error(c.LogTraceArea.PesService,"PES Config missing items property!"),C.default.setLoadingStatus(C.PesConfigLoadingStatus.Error);else m.error(c.LogTraceArea.PesService,"Null configuration passed to _processConfig!"),C.default.setLoadingStatus(C.PesConfigLoadingStatus.Error);return{tabs:s,emoticons:o,mojis:r,stickers:a,chatStickers:l,gifs:[]}}triggerEmoticonInfoFetch(e){if(this._inProgressEmoticonInfoFetches[e]||l.default.getEmoticonByNameNoSubscription(e))return;this._inProgressEmoticonInfoFetches[e]=!0,m.log(c.LogTraceArea.Pes,"Trigger Emoticon metadata fetch Name: "+e);const t=t=>{if(t){const s=this._emoticonFromMetadata(t);s?l.default.setEmoticon(s):m.warn(c.LogTraceArea.Pes,"Emoticon not found in metadata. Name: "+e)}else m.warn(c.LogTraceArea.Pes,"Emoticon metadata not found. Looking for Name: "+e)};return o.Resolved().thenAsync((()=>{_.default.getEmoticonMetadata(this._uriFromEmoticonId(e,f.getLocale())).then(t).catch((s=>404===s.statusCode?(m.warn(c.LogTraceArea.Pes,"Emoticon metadata falling back to default. Name: "+e),_.default.getEmoticonMetadata(this._uriFromEmoticonId(e,"default")).then(t).fail((t=>{m.warn(c.LogTraceArea.Pes,"Emoticon metadata fallback fetch failed. Name: "+e+", status: "+t.statusCode)}))):void m.warn(c.LogTraceArea.Pes,"Emoticon metadata fetch failed. Name: "+e+", status: "+s.statusCode))).always((()=>{delete this._inProgressEmoticonInfoFetches[e]}))}))}getCurrentCachedPesLocal(){return this._cachedPesConfigs[k.MojiEmoticon]?this._cachedPesConfigs[k.MojiEmoticon]&&this._cachedPesConfigs[k.MojiEmoticon].locale:void 0}getGifsForCategory(e,t,s){C.default.setGifItems([],e,!0);return(s?this._searchGifs(s,t):this._getTrendingGifs(t)).then(((t=v.EmptyGifResult)=>{const s=this._getGifIds(t.gifItems);return C.default.setGifItems(s,e,!1),u.default.setCategoryGifs(t),t})).fail((()=>{C.default.setGifItems([],e,!1),u.default.setCategoryGifs(v.EmptyGifResult)}))}getGifsForSearchTerm(e,t,s){return this._searchGifs(e,t,s).then(((t=v.EmptyGifResult)=>(u.default.setSearchGifs(t,e),t))).fail((()=>{u.default.setSearchGifs(v.EmptyGifResult,e)}))}_getTrendingGifs(e){this._trendingGifGenerationCount++;const t=this._trendingGifGenerationCount;return this._cancelRequestInProgress(),this._gifPromise=h.default.getTrendingGifs(e).then((e=>t===this._trendingGifGenerationCount&&e?e:v.EmptyGifResult)).finally((()=>{this._gifPromise=void 0})),this._gifPromise}_searchGifs(e,t,s){this._searchGifGenerationCount++;const i=this._searchGifGenerationCount,n=u.default.getSearchParams();return e===n.searchQuery&&t===n.limitCount&&s===n.offset?this._gifPromise||o.Resolved():(this._cancelRequestInProgress(),u.default.setSearchParams(e,t,s),u.default.setSearchingFlag(!0),this._gifPromise=h.default.searchGifs(e,t,s).then((e=>(u.default.setSearchingFlag(!1),i===this._searchGifGenerationCount&&e?e:v.EmptyGifResult))).finally((()=>{u.default.setSearchingFlag(!1),this._gifPromise=void 0})),this._gifPromise)}_getGifIds(e){return i.map(e,(e=>e.id))}_cancelRequestInProgress(){this._gifPromise&&(this._gifPromise.cancel(),this._gifPromise=void 0)}_stickerFromMetadata(e,t){if(e.type===b.mediaTypes.sticker)return{id:e.id,etag:e.etag,baseUrl:t.itemsRoot+"/"+e.id,auxiliaryUrl:e.auxiliaryUrl,auxiliaryText:e.auxiliaryText,description:e.description,copyright:e.copyright,title:e.title,name:e.name};m.log(c.LogTraceArea.PesService,"Unexpected sticker type")}_emoticonFromMetadata(e){if(!e)return;if(e.type!==b.mediaTypes.emoticon)return void m.warn(c.LogTraceArea.PesService,"Unexpected emoticon type: "+e.type);let t=e.media.default;return{id:e.id,etag:e.etag,visible:e.visible,firstFrame:t.firstFrame||0,frameCount:t.framesCount,description:e.description,diverse:e.diverse,utf:e.utf,group:e.group,shortcuts:i.uniq(i.map(e.shortcuts,(e=>e.length>=2&&"("===e[0]&&")"===e[e.length-1]?e.toLowerCase():e))),keywords:i.compact(e.keywords).map((e=>e.toLowerCase()))}}_uriFromEmoticonId(e,t){return(this._cachedPesConfigs[k.MojiEmoticon]?this._cachedPesConfigs[k.MojiEmoticon].emoticonsRoot:n.default.getConfigSettingsNoSubscription().pes.emoticonBaseUrl)+"/"+encodeURIComponent(e)+"/views/meta."+t}_mojiFromMetadata(e,t){if(e.type===b.mediaTypes.moji)return{id:e.id,etag:e.etag,baseUrl:t.itemsRoot+"/"+e.id,auxiliaryUrl:e.auxiliaryUrl,auxiliaryText:e.auxiliaryText,description:e.description,copyright:e.copyright,pickerTitle:e.pickerTitle,keywords:i.compact(e.keywords).map((e=>e.toLowerCase()))};m.warn(c.LogTraceArea.PesService,"Unexpected moji type: "+e.type)}_packFromMetadata(e){if(e&&e.title)return{id:e.id,title:e.title,description:e.description,copyright:e.copyright,items:e.items}}_tabFromMetadata(e,t,s,o,n){let a=(0,r.chain)(e.sections,(0,r.map)((e=>this._packFromMetadata(s[e.pack]))),(0,r.compact)()),l=b.TabType.Emoticon;const d=i.head(a);let c;if(d){const e=i.head(d.items);e&&o[e]&&(o[e].type===b.mediaTypes.sticker&&t===k.ChatSticker?l=b.TabType.ChatSticker:t===k.Gif?(l=b.TabType.Gif,c=o[e].searchTerm,a=this._clearItemsFromPacks(a)):l=b.mediaTypesToTabType[o[e].type])}return{id:e.id,tabType:l,iconUrlOrAssetID:n.tabsRoot+"/"+e.id+"/views/thumbnail",packs:a,title:e.title,description:e.description,copyright:e.copyright,glyphBgColor:e.glyphBgColor,searchTerm:c}}_clearItemsFromPacks(e){return i.map(e,(e=>Object.assign(Object.assign({},e),{items:[]})))}}},63986:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Test_PicturePrefetchService=void 0;const i=s(74958),o=s(96486),n=s(98861),r=s(97691),a=s(89391),l=s(51577),d=s(76621),c=s(46096),h=s(7234),u=s(57347),p=s(36237),g=s(16724),m=s(14597),S=s(45983),f=s(64387),y=s(78735),_=s(26584),v=s(82167),C=s(17791),b=s(22538),T=s(4057),M=s(82176),I=s(26712),w=s(53374);class P{constructor(){this._entries=[],this._processingScheduled=!1,b.RegisterStartupable(this,"PicturePrefetchService",[m.default,v.default,d.default,C.default])}startup(){return this._startupTime=Date.now(),d.default.messagesProcessed.subscribe((e=>{this._processMessages(e)})),C.default.subscribe((()=>{this._processNextEntry()})),r.Resolved()}_processMessages(e){this._isPrefetchEnabled()&&(p.log(c.LogTraceArea.PicturePrefetchService,"Process messages"),o.each(e,(e=>{this._processMessage(e)})),this._processNextEntry())}_processMessage(e){if((this._startupTime-e.createdTime)/1e3>a.default.getS4LCMCFeatures().picturePrefetch.maxTimeIntervalPriorToStartupSec)return;const t=f.default.getMediaDescriptorForItem(e);if(t&&t.mediaType===S.MediaViewerTypes.Picture){const s=t;if(s.downloadFileName&&s.displayResolutionUrl&&s.thumbnailUrl&&I.default.isUrlValid(s.displayResolutionUrl)){const t={createdTime:e.createdTime,cacheId:(0,l.getCacheKeyFullResOrDisplayable)(e),descriptor:s};this._shouldAddEntry(t)&&this._addEntry(t)}}}_shouldAddEntry(e){if(o.some(this._entries,{cacheId:e.cacheId}))return!1;if(h.default.isLocalCacheSupported()){if(m.default.isQueued(e.cacheId))return!1}else{const t=e.descriptor.displayResolutionUrl;if(t&&v.default.isImagePrefetched(t,!1,!1))return!1}return!0}_addEntry(e){p.log(c.LogTraceArea.PicturePrefetchService,"Add entry to prefetch queue: "+i.pii.Omit(e.descriptor.downloadFileName||"")),this._entries.splice(o.sortedIndexBy(this._entries,e,"createdTime"),0,e);const t=a.default.getS4LCMCFeatures().picturePrefetch.maxQueuedEntriesCount;this._entries.length>t&&(p.log(c.LogTraceArea.PicturePrefetchService,"Trimming prefetch queue to "+t+" entries"),this._entries.splice(0,this._entries.length-t),p.track(new _.PicturePrefetchEvent(_.PicturePrefetchAction.PrefetchQueueTrimmed)))}_processNextEntry(){!this._processingScheduled&&this._canPrefetchNow()&&0!==this._entries.length&&(this._processingScheduled=!0,u.default.queueIdleTask("PicturePrefetchService",u.TaskTypeFlags.UsesNetworking,(()=>{if(this._entries.length>0&&this._canPrefetchNow()){const e=this._entries.pop();if(e&&e.descriptor.displayResolutionUrl&&e.descriptor.downloadFileName){const t=new g.FileReceived(e.descriptor.displayResolutionUrl,e.descriptor.originalSizeInBytes,M.default.extractExtensionForTelemetry(e.descriptor.downloadFileName));let s;if(t.setMediaProfile(M.default.currentMediaProfile()),t.setIntent(c.MediaDownloadIntent.Prefetch),t.startDownload(),e.descriptor.thumbnailUrl&&v.default.prefetch(e.descriptor.thumbnailUrl),h.default.isLocalCacheSupported()){const t=1e3*a.default.getS4LCMCFeatures().picturePrefetchCacheExpiryTimeSec,i=Date.now()+t,o=new m.QueueItem(e.cacheId,e.descriptor.displayResolutionUrl,e.descriptor.downloadFileName,"PicturePrefetch",i,h.CacheEvictionKind.Preview,Date.now()),n=w.default.newCauseId();p.log(c.LogTraceArea.PicturePrefetchService,"Process next entry, causeId: "+n),s=m.default.add(o,n)}else s=v.default.prefetch(e.descriptor.displayResolutionUrl);s.then((()=>{p.log(c.LogTraceArea.PicturePrefetchService,"Image prefetch completed: "+i.pii.Omit(e.descriptor.downloadFileName||"")),t.endDownload(),t.setSuccess(!0,c.MessagingFailureReason.None),p.track(t)})).catch((e=>{p.warn(c.LogTraceArea.PicturePrefetchService,"Image prefetch failed: "+T.default.errorAsString(e)),t.endDownload(),t.setSuccess(!1,c.MessagingFailureReason.AMSFailure),p.track(t)})).finally((()=>{this._processingScheduled=!1,this._processNextEntry()}))}else this._processingScheduled=!1,this._processNextEntry()}else this._processingScheduled=!1}),u.Priority.Low))}_canPrefetchNow(){const e=this._picturePrefetchStatus(),t=C.default.getNetworkType()===n.DeviceNetworkType.Wifi;return"On"===e||"Wifi"===e&&t||"Off"!==e}_isPrefetchEnabled(){return"Off"!==this._picturePrefetchStatus()}_picturePrefetchStatus(){if(!a.default.getS4LCMCFeatures().picturePrefetchEnabled)return"Off";return y.default.getUserPreferencesLocal().picturePrefetchMode||a.default.getS4LCMCFeatures().picturePrefetch.status}test_processMessage(e){this._processMessage(e)}test_processMessages(e){this._processMessages(e)}test_entries(){return this._entries}test_setStartupTime(e){this._startupTime=e}}t.Test_PicturePrefetchService=P,t.default=new P},85207:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PostMessageScenarioStep=void 0;const i=s(96486),o=s(36345),n=s(59728),r=s(97792),a=s(97691),l=s(89391),d=s(76621),c=s(51077),h=s(71830),u=s(82261),p=s(66923),g=s(46096),m=s(84457),S=s(53559),f=s(53700),y=s(97174),_=s(36237),v=s(33754),C=s(24606);Object.defineProperty(t,"PostMessageScenarioStep",{enumerable:!0,get:function(){return C.PostMessageScenarioStep}});const b=s(80457),T=s(62817),M=s(43898),I=s(15963),w=s(22538),P=s(40363),k=s(78262),A=g.LogTraceArea.PostingService;t.default=new class{constructor(){this.postCreated=M.default.postCreated,this.postUpdated=M.default.postUpdated,this.transferFinished=M.default.transferFinished,this.allPostsFinished=M.default.allPostsFinished,this.foregroundUploadProgress=C.foregroundUploadProgress,this.serverTranscodingProgress=C.serverTranscodingProgress,w.RegisterStartupable(this,"PostingService",[p.default,f.default,M.default])}startup(){return a.Resolved()}setDiagnosticCallInfoCallbacks(e){this._diagnosticCallInfo=e}setDiagnosticDevicesInfoCallbacks(e){this._diagnosticDevicesInfo=e}postFeedbackStringThenAttachments(e,t,s,n,a,d,c){const S=r.default.requestMaxTime("posting:feedback"),f=w.EnsureStarted(this);m.default.startNewSession(),_.track(new T.FeedbackInititated),this._getLogCount(t,s).then((r=>{const S=h.sanitizeMri(l.default.getConfigSettingsNoSubscription().feedbackBot.id,h.Namespaces.Bot),_=P.default.getIOSModel()===g.IOSModel.iPad?"iPad":P.default.getPlatformTypeName(),C=P.default.getSkypePlatformId().toString(),b=P.default.getAppShellTypeName(),T=P.default.getAppVersion(),w=[];w.push(new y.UnhandledEntity("Sending feedback details..."));let k={};k={Platform:_+" - "+b,PlatformID:C,AppVersion:T,Attachments:r,OS:P.default.getOSVersion(),Device:P.default.getSystemModel(),ClientLanguage:v.getLocale(),BrbEnabled:l.default.getDebugabilitySquad().brb_enabled},a&&(k.Tags=a.toString());const A=o.default.getVersion();if(k.CallingVersion=A.build,k.OvbRevision=A.ovb,this._diagnosticCallInfo){const e=this._diagnosticCallInfo.getOngoingCallId();e&&(k.OngoingCallID=e);const t=this._diagnosticCallInfo.getLastCallId();t&&(k.LastCallID=t);const s=this._diagnosticCallInfo.getParticipantId(e||t);s&&(k.ParticipantId=s)}if(this._diagnosticDevicesInfo){const e=[{name:"Speakers",selectedDeviceId:e=>e.speaker,callback:e=>e.getSpeakers()},{name:"Microphones",selectedDeviceId:e=>e.microphone,callback:e=>e.getMicrophones()},{name:"Cameras",selectedDeviceId:e=>e.camera,callback:e=>e.getCameras()}],t=this._diagnosticDevicesInfo,s=this._diagnosticDevicesInfo.getSelectedDevices();i.each(e,(e=>{const o=e.callback(t),n=e.selectedDeviceId(s);k[e.name]=i.isEmpty(o)?"None":i.map(o,(e=>`${e.label}${e.id===n?" (selected)":""}`)).join(", ")}))}const E=m.default.getCurrentSessionId();E&&(k.feedbackId=E);const R=P.default.getSystemManufacturer();R&&(k.Manufacturer=R),d&&(k.Title=l.default.getConfigSettings().brb.extendReportTitle,k.ReportId=d),n&&(k.Title=(k.Title||"")+n.replace(/\n/g," ")),c&&(k.ReportCategory=c),w.push(new y.ContextEntity(k));let L=u.createMessageInfo(S,g.PostSource.FeedbackString,w);return f.then((()=>p.default.createMessageInfo(L,{shouldSendLogs:t,shouldSendScreenshot:s,screenshotUri:e}).then((e=>{M.default.startPost(e,{name:I.ScenarioName.SendTextMessage})}))))})).finally((()=>{S.then((e=>r.default.release(e,"posting:feedback")))}))}_getLogCount(e,t){return(e||t)&&n.default.supportsLogs()?n.default.allRecentLogFileUris(l.default.getDebugabilitySquad().brb_logs_history_secs).then((e=>e&&e.length?1:0)):a.Resolved(0)}postMessageFromInput(e,t,s,i=c.MessageTypes.RichText,o,n,r){const a=u.createMessageInfo(e,t,s,i,n);this.postMessage(a,void 0,o,r)}postMessage(e,t,s,i,o){const n=r.default.requestMaxTime("posting:message");w.EnsureStarted(this).then((()=>p.default.createMessageInfo(e,{showLocalNotificationOnFailure:t}).then((e=>{M.default.startPost(e,s,i,o)})))).finally((()=>{n.then((e=>r.default.release(e,"posting:message")))}))}editMessageFromInput(e,t,s){this.postMessage(u.createEditMessageInfo(e,t,s))}deleteMessage(e,t){this.postMessage(u.createDeleteMessageInfo(e,t))}postVideoWithThumbnail(e,t,s,i,o,n,a,l,d){const c=r.default.requestMaxTime("posting:video+thumb"),h=w.EnsureStarted(this),u={isRecorded:i,copyThumbnail:!0,copyUploadMedia:n,shouldTrackUpload:!0,overlayUrl:a,properties:l};return h.then((()=>p.default.createUploadInfo(e,t,s,u).then((e=>(M.default.startPost(e,o,d),this._correlationMessageInfo(e))),(()=>[])))).finally((()=>{c.then((e=>r.default.release(e,"posting:video+thumb")))}))}postUploadAndShowFeedbackToast(e,t,s,o=!1,n,a="CapturePanel.MediaPostedFailed",l,d){const c=r.default.requestMaxTime("posting:upload+toast"),h=w.EnsureStarted(this),u=t.extension.length?t.extension:i.last(t.file.name.split(".")),g={isRecorded:o,callId:n,toastMessageToShowOnFailure:a,properties:d,shouldTrackUpload:!i.isUndefined(u)&&S.default.isImageExtension(u)};return h.then((()=>p.default.createUploadInfo(e,t,s,g).then((e=>(M.default.startPost(e,l),this._correlationMessageInfo(e))),(()=>[])))).finally((()=>{c.then((e=>r.default.release(e,"posting:upload+toast")))}))}postUpload(e,t,s,o=!1,n={},a,l){const d=r.default.requestMaxTime("posting:upload"),c=w.EnsureStarted(this),h=t.extension.length?t.extension:i.last(t.file.name.split(".")),u={isRecorded:o,callId:n.callId,properties:n.properties,shouldTrackUpload:!i.isUndefined(h)&&S.default.isImageExtension(h),durationMs:i.isNil(l)?void 0:l.messageDurationMs};return c.then((()=>p.default.createUploadInfo(e,t,s,u).then((e=>(M.default.startPost(e,n.scenarioInfo,a,l),this._correlationMessageInfo(e))),(()=>[])))).finally((()=>{d.then((e=>r.default.release(e,"posting:upload")))}))}_correlationMessageInfo(e){return i.map(e.conversationIds,(t=>({clientMessageId:e.messagesForPosting[t].clientmessageid,conversationId:t})))}canRetry(e){return!!e&&(e.kind!==b.PostUploadInfoKind||(!w.HasStarted(f.default)||i.every([e.amsFullDataCacheInfo,e.amsThumbnailCacheInfo],(e=>!e||f.default.isKnown(e.name)))))}retry(e,t){let s;if(_.log(A,"Retry "+e.kind),e.kind===b.PostUploadInfoKind){s={name:I.ScenarioName.SendFile,failedAmsDocumentId:t};const o=i.first(e.amsUploads);o&&(o.amsUploadFileType===k.UploadFileType.Video||o.amsUploadFileType===k.UploadFileType.VideoMessage?s.name=I.ScenarioName.SendVideo:o.amsUploadFileType===k.UploadFileType.Picture&&(s.name=I.ScenarioName.SendPicture))}w.EnsureStarted(this).then((()=>M.default.startPost(e,s)))}cancelFailedPost(e){const t=e.getSendRetryInfo();if(t&&t.kind===b.PostUploadInfoKind&&w.EnsureStarted(f.default).then((()=>{t.amsFullDataCacheInfo&&f.default.abandon(t.amsFullDataCacheInfo.name),t.amsThumbnailCacheInfo&&f.default.abandon(t.amsThumbnailCacheInfo.name)})),e.isEdited()){const t=e.getSendRejectedCMID();t?d.default.revertMessageLie(e.conversationId,e.cuid,t):_.warn(g.LogTraceArea.PostingService,"Tried to revert a failed message that did not fail?",e.cuid)}else{const t=u.createDeleteMessageInfo(e,g.PostSource.CancelFailedPost),s=Object.assign(Object.assign({},t.messageForPosting),{version:e.getLatestServerMessageVersion()});d.default.applyMessageLie(e.conversationId,s)}}getPostByLocalUrl(e){return M.default.getPostByLocalUrl(e)}getLocalUrlsForPost(e){return M.default.getLocalUrlsForPost(e)}debug_allPosts(){return M.default.debug_allPosts()}debug_allPostsCleaningUp(){return M.default.debug_allPostsCleaningUp()}debug_allPostsFailedRetryInfo(){return M.default.debug_allPostsFailedRetryInfo()}test_resetBackoff(){M.default.test_resetBackoff()}test_cancelPost(e){return M.default.test_cancelPost(e)}cancelPostMessage(e,t){return M.default.cancelPostMessage(e,t)}}},39188:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(97691),n=s(66737),r=s(17135),a=s(22801),l=s(66923),d=s(46096),c=s(36237),h=s(85207),u=s(62817),p=s(22538);t.default=new class{constructor(){this._failedTransfers={},p.RegisterStartupable(this,"PostingTelemetryService",[h.default])}startup(){return h.default.transferFinished.subscribe(((e,t,s,o,r,a,l)=>{const h=this._getTransferId(e,t,a),p=this._getErrorMetadata(t,o,r),g=e.instrumentation_postSource,m=e.instrumentation_conversationOrigin,S=this._getIsConversationAcceptedMetadata(t,e,a);if(S&&i.extend(p,S),s.success){const i=this._failedTransfers[h];if(i){const o=new u.PostingRecovered(t,e.conversationIds,g,m,e.postTime,s.finishedAttemptsSoFarCount,i.response.statusCode,i.response.statusText,l,p,e.originalUploadFileType,n.default.getPostingTrigger());c.track(o),delete this._failedTransfers[h]}}else{c.warn(d.LogTraceArea.PostingService,"Posting failure: "+e.id+", permanent: "+s.permanentFailure+" source: "+d.PostingTransferSource[t]+", status code: "+o.statusCode+", metadata: "+JSON.stringify(p));const i=new u.PostingFailure(s.permanentFailure,t,e.conversationIds,g,m,e.postTime,s.finishedAttemptsSoFarCount,o.statusCode,o.statusText,l,p,e.originalUploadFileType,n.default.getPostingTrigger());c.track(i),s.permanentFailure||(this._failedTransfers[h]={transferInfo:s,response:o})}})),o.Resolved()}_getErrorMetadata(e,t,s){switch(e){case d.PostingTransferSource.ChatService:const e=a.default.getChatServiceErrorResponseMetadata(t);return{error_code:e.errorCode,error_message:e.errorMessage,context_id:e.contextId,date:e.date};case d.PostingTransferSource.AMSCreate:case d.PostingTransferSource.AMSForward:case d.PostingTransferSource.AMSGetStatus:case d.PostingTransferSource.AMSUploadContent:case d.PostingTransferSource.AMSUploadThumbnail:case d.PostingTransferSource.URLPreview:if(!s)return;const i=r.ASMClient.getTracingHeaders(s);return{requestId:i.requestId,correlationId:i.correlationId,transactionId:i.transactionId};default:return}}_getIsConversationAcceptedMetadata(e,t,s){if(e===d.PostingTransferSource.ChatService){const e=t.conversationAcceptedInfos&&t.conversationAcceptedInfos[s],i=l.default.getConversationAcceptedInfo(s);return{conv_accepted_before:""+(e&&(e.hasConvInMemory?e.isAccepted:void 0)),conv_accepted_now:""+(i.hasConvInMemory?i.isAccepted:void 0),conv_syncing_before:""+(e&&e.isSyncingConv),conv_syncing_now:""+i.isSyncingConv,has_all_messages_before:""+(e&&e.hasAllMessages),has_all_messages_now:""+i.hasAllMessages}}}_getTransferId(e,t,s){let i=e.id+"_"+d.PostingTransferSource[t];return s&&(i+="_"+s),i}}},51481:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(97691),o=s(89391),n=s(90239),r=s(62141),a=s(98278),l=s(46096),d=s(36237),c=s(98754),h=s(1246),u=s(46929),p=s(88273),g=s(4735),m=s(27357),S=s(22538);t.default=new class{constructor(){this._isOptingIn=!1,this._appConfigChanged=()=>{const e=o.default.getS4LMessagingFeatures().enableReadReceipts;this._readReceiptsPreviouslyEnabled!==e&&(this._readReceiptsPreviouslyEnabled=e,this._shouldOptInForReadReceipts()?(d.log(l.LogTraceArea.ReadReceipts,"[AppConfigChanged]We should opt in based on local data. Refresh user props and check again"),this._isOptingIn=!0,u.default.fetchAndUpdateProperties(!0).always((()=>{const e=this._shouldOptInForReadReceipts();if(d.log(l.LogTraceArea.ReadReceipts,"[AppConfigChanged]User props refreshed, shouldOptIn="+e),e){const e=p.default.getStatus()!==n.UserStatus.Hidden;u.default.setReadReceiptsEnabled(e,h.ReadReceiptsSettingOrigin.OptIn)}this._isOptingIn=!1}))):this._shouldOptOutFromReadReceipts()?(d.log(l.LogTraceArea.ReadReceipts,"[AppConfigChanged]We should opt out based on local data. Refresh user props and check again"),u.default.fetchAndUpdateProperties(!0).always((()=>{const e=this._shouldOptOutFromReadReceipts();d.log(l.LogTraceArea.ReadReceipts,"[AppConfigChanged]User props refreshed, shouldOptOut="+e),e&&(u.default.setReadReceiptsEnabled(!1,h.ReadReceiptsSettingOrigin.OptOut),this._fetchMemberConsumptionHorizon())}))):d.log(l.LogTraceArea.ReadReceipts,"[AppConfigChanged]No opt in or opt out needed"))},this._userPresenceChanged=()=>{if(this._isOptingIn||!o.default.getS4LMessagingFeatures().enableReadReceipts||!u.default.getUserPreferenceForReadReceipts())return void d.log(l.LogTraceArea.ReadReceipts,"[UserPresenceChanged]Bailing out, isOptingIn="+this._isOptingIn+";ecsEnableReadReceipts"+o.default.getS4LMessagingFeatures().enableReadReceipts+";userPreferenceForReadReceipts="+u.default.getUserPreferenceForReadReceipts());const e=p.default.getStatus()===n.UserStatus.Hidden,t=u.default.getReadReceiptsEnabled();e&&t?(u.default.setReadReceiptsEnabled(!1,h.ReadReceiptsSettingOrigin.UserStatusUpdate),this._fetchMemberConsumptionHorizon()):e||t||u.default.setReadReceiptsEnabled(!0,h.ReadReceiptsSettingOrigin.UserStatusUpdate)},S.RegisterStartupable(this,"ReadReceiptsStateService",[c.default,u.default,p.default,m.default])}startup(){const e=c.default.getData(r.InternalKeys.EcsConfig);return e&&e.config&&e.config.S4L_Messaging&&(this._readReceiptsPreviouslyEnabled=e.config.S4L_Messaging.enableReadReceipts),o.default.subscribe(this._appConfigChanged),p.default.subscribe(this._userPresenceChanged),this._appConfigChanged(),this._userPresenceChanged(),i.Resolved()}_fetchMemberConsumptionHorizon(){const e=m.default.getActiveConversationId(a.MainRootViewId);e&&g.default.fetchMemberConsumptionHorizon(e)}_shouldOptInForReadReceipts(){const e=u.default.getReadReceiptsEnabled(),t=u.default.getUserPreferenceForReadReceipts();return o.default.getS4LMessagingFeatures().enableReadReceipts&&!e&&t}_shouldOptOutFromReadReceipts(){const e=u.default.getReadReceiptsEnabled();return!o.default.getS4LMessagingFeatures().enableReadReceipts&&e}}},44521:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(8405),n=(s(16778),s(97691)),r=(s(60),s(89391),s(71830)),a=s(23293),l=s(82927),d=s(66923),c=s(88660),h=s(52262),u=s(46096),p=s(52115),g=s(53559),m=s(36237),S=s(33754),f=s(4329),y=(s(18078),s(4735)),_=s(32514),v=s(76812),C=s(94165),b=s(16392),T=s(22538),M=s(53374),I="file://";t.default=new class{constructor(){this._processShareEvent=e=>{const t=M.default.newCauseId();m.log(u.LogTraceArea.ShareToSkype,"Processing event with type: "+e.type+" causeId:"+t),m.track(new v.default({action:v.ShareToSkypeEventActions.opened,event:e}));const s=C.default.processShareEvent(e,I);s&&this._navigateToSharePanel(((s,i)=>{C.default.postSharedMessage(e,s,t)}),s,((t,s)=>{this._onShareCompleteReportTelemetryAndNavigateIfNeeded(e,t,s)}))},this._onShareCompleteReportTelemetryAndNavigateIfNeeded=(e,t,s)=>{if(this._reportSharedTelemetryEvent(e,t,s),1===t.length){const e=t[0];if(!r.isHighlightsThread(e)){const t=M.default.newCauseId();m.log(u.LogTraceArea.Navigation,"ShareToSkypeService._reportTelemetryAndNavigateIfNeeded, causeId: "+t),y.default.navigateToConversation({convId:e,origin:u.NavigationConversationOrigin.ShareToSkype,causeId:t})}}},T.RegisterStartupable(this,"ShareToSkypeService",[a.default,h.default]),f.default.registerForLogout(this,"ShareToSkypeService")}startup(){return o.default.setListener(this._processShareEvent,this._fileSizeLimit),n.Resolved()}setMaximumFileSizeLimitInBytes(e){this._fileSizeLimit=e}_exposeDirectShareShortcuts(){void 0===this._searchStore&&(this._searchStore=new _.default,this._searchStore.updateConfig({rawQuery:"",trimmedNormalizedQuery:"",excludeBots:!0,excludePstn:!0,onlyGroupCapable:!1,onlyCallCapable:!1,excludeShortCircuitMatches:!0},[u.SearchResultsListGroup.SuggestedRecentConversationsWithEstablishedPrivateConversations]));const e=this._searchStore.getSuggestedContactsAndConversationsResults(u.SearchResultsListGroup.SuggestedRecentConversationsWithEstablishedPrivateConversations);if(e){const t=e.map((e=>{const t=h.default.getDisplayableProfile(e);return t&&t.getDisplayName()?{mri:e,displayName:t.getDisplayName(),isGroup:t instanceof l.default,avatarUrl:t.getAvatarUrl(),initials:t.getInitials(),color:a.default.getPrimaryColor(e)}:void 0})).filter((e=>e));o.default.exposeDirectShareShortcuts(t)}}_processDirectShareEvent(e,t){c.default.performShareNavigationAction(e,I,t)}_navigateToSharePanel(e,t,s){const i=M.default.newCauseId();m.log(u.LogTraceArea.Navigation,"ShareToSkypeService._navigateToSharePanel, causeId: "+i),t.multipleMessagesParameters||(t.multipleMessagesParameters=[]),t.multipleMessagesParameters.length||t.multipleMessagesParameters.push({}),t.multipleMessagesParameters[0].onShareCompleteForMessage=e,y.default.navigateToSelectConversationsForSharingOrScheduleNavigationOnLaunch({isExternalShare:!0,navigationDirection:b.StackNavigationDirection.Present,onShareComplete:s,shareMessageTitle:S.getString("ShareWithPanel.ShareToSkypeHeader"),accessibilityLabelTitle:S.getString("ShareWithPanel.ShareToSkypeAccessibilityHeader"),multipleMessagesParameters:t.multipleMessagesParameters,sharePreviewType:t.sharePreviewType,enableMediaPreview:!0,causeId:i,entryPoint:u.SharePanelEntryOrigin.External,directShareMri:t.directShareMri})}_reportSharedTelemetryEvent(e,t,s){m.track(new v.default({action:v.ShareToSkypeEventActions.completed,event:e,conversationsCount:t.length,messageAdded:s}))}logout(e,t,s){return o.default.removeListener(),n.Resolved()}_shareElectronFile(e){const t=M.default.newCauseId();m.error(u.LogTraceArea.Navigation,"ShareToSkypeService._onShareFile, eventId: "+t);const s=i.first(e.data);if(s){const t=g.default.extractFileNameWithExtension(s.name),i=g.default.extractFileExtension(t),n=d.default.determineUploadFileType({extension:i,file:{uri:s.uri,size:s.size,name:s.name,type:""}},!1),r=p.default.getMaximumFileSizeForType(n);if(s.size>r){const e=S.getString("Global.FileTooBigContent",{maxSizeFormatted:p.default.formatFileSize(r,0).formattedString});window.electronApi.ipcProvider.dialog.showMessageBox.send({title:S.getString("ShareWithPanel.ShareWithHeader"),content:e,type:"warning"})}else o.default.open(e,S.getString("ShareWithPanel.ShareWithHeader"))}}}},13510:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(97691),n=s(89391),r=s(46096),a=s(36237),l=s(18078),d=s(22543);d.default.setThrottled((()=>n.default.getS4LFeatures().scheduler.enableSmsPriceThrottling));t.default=class{static getSmsPrice(e){const t=l.default.getSkypeId();return t?d.default.getPrice(e,t).then((t=>{const s=this._handleAPIReturn(t,e);return a.log(r.LogTraceArea.SMSClient,"Successfully got price for SMS. Returning: "+JSON.stringify(s)),s})).catch((e=>(a.log(r.LogTraceArea.SMSClient,"Getting price for SMS failed. Returning: "+JSON.stringify(e)),{rate:void 0,currency:void 0,failureReason:d.FailureReason.Other}))):o.Rejected("Unable to get User ID")}static _handleAPIReturn(e,t){return a.log(r.LogTraceArea.SMSClient,"Handled SMS Rate from new API"),{rate:i.isEmpty(e)?void 0:e[0].price,currency:i.isEmpty(e)?void 0:e[0].currency,failureReason:i.isEmpty(e)?d.FailureReason.Other:this._mapFailureReasons(e[0].status)}}static _mapFailureReasons(e){switch(e){case 200:return;case 407:case 405:return d.FailureReason.InsufficientFunds;default:return d.FailureReason.Other}}}},15301:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SmsFlowId=void 0;const i=s(46096),o=s(36237),n=s(14976);var r;!function(e){e.Default="skype.S4L.client.sms.1way",e.Contacts="skype.S4L.client.sms.1way.contacts",e.CallList="skype.S4L.client.sms.1way.callList",e.UserProfile="skype.S4L.client.sms.1way.userProfile",e.Dialer="skype.S4L.client.sms.1way.pstnDialer",e.QuickCallPanelCallingOptions="skype.S4L.client.sms.1way.quickCallPanelCallingOptions",e.NewSms="skype.S4L.client.sms.1way.newSms"}(r=t.SmsFlowId||(t.SmsFlowId={}));t.default=new class{constructor(){this.setDefault()}setNextFlowId(e){this._nextFlowId=e,o.log(i.LogTraceArea.SkypeSmsFlowIdStore,"Setting NEXT Flow ID to "+e)}commitNextFlowId(){o.log(i.LogTraceArea.SkypeSmsFlowIdStore,"Committing flow id "+n.dev_unknownOmit(this._nextFlowId)),this._nextFlowId&&(this.setFlowId(this._nextFlowId),this.clearNextFlowId())}clearNextFlowId(){o.log(i.LogTraceArea.SkypeSmsFlowIdStore,"Clearing next flow id"),this._nextFlowId=void 0}setFlowId(e){o.log(i.LogTraceArea.SkypeSmsFlowIdStore,"Setting flow ID to "+e),this._currentFlowId=e}getFlowId(){return o.log(i.LogTraceArea.SkypeSmsFlowIdStore,"RETURNING FLOW ID "+this._currentFlowId),this._currentFlowId}setDefault(){this.setFlowId(r.Default)}test_dontCallThis_getNextFlowId(){return this._nextFlowId}}},60634:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.videoManipulationProgressChangedEvent=void 0;const i=s(96486),o=s(57349),n=s(74634),r=s(97691),a=s(46096),l=s(36237);t.videoManipulationProgressChangedEvent=new n.default;t.default=new class{constructor(){this._sessionCounter=0,this._queue=[],o.reencodeProgressChangedEvent.subscribe((e=>{this._sessionIdInProgress?t.videoManipulationProgressChangedEvent.fire(this._sessionIdInProgress,e):l.warn(a.LogTraceArea.Capture,"reencodeProgressChangedEvent fired but no manipulations in progress")}))}saveVideoWithoutView(e,t,s,i,n){return this._createNewSession((()=>o.default.reencodeVideo(e,t,s,i)),n)}saveVideoWithView(e,t,s,i,o){return this._createNewSession((()=>e.captureWithOverlay(t,s,i)),o)}cancelSession(e){if(this._sessionIdInProgress===e)o.default.cancelReencode();else{const t=i.remove(this._queue,(t=>t.sessionId===e));if(t.length>0){t[0].deferred.reject({code:o.ReencodeErrorType.Cancelled,message:"Cancelled before reencoding had begun"})}}}_createNewSession(e,t){const s={sessionId:"session"+this._sessionCounter++,deferred:r.Defer(),manipulation:e,telemetrySession:t};return this._queue.push(s),this._maybeStartManipulation(),{sessionId:s.sessionId,manipulationPromise:s.deferred.promise()}}_maybeStartManipulation(){if(!this._sessionIdInProgress){const e=this._queue.shift();if(!e)return;this._sessionIdInProgress=e.sessionId,e.telemetrySession&&e.telemetrySession.startReencode(),e.manipulation().then((t=>{e.telemetrySession&&t.fileSize!==t.sourceFileSize&&this._logSuccessTelemetry(e.telemetrySession,t);let s=t;e.telemetrySession&&(s.scenarioAttributes=e.telemetrySession.getScenarioAttributes()),e.deferred.resolve(s)})).catch((t=>{e.telemetrySession&&(e.telemetrySession.setErrorType(t.code),t.code===o.ReencodeErrorType.Cancelled?this._logCancelledTelemetry(e.telemetrySession):this._logFailureTelemetry(e.telemetrySession,t.message)),e.deferred.reject(t)})).always((()=>{this._sessionIdInProgress=void 0,this._maybeStartManipulation()}))}}_logSuccessTelemetry(e,t){e.endReencode(),e.setState(a.ReencodeState.Success),e.setOutputFileSize(t.fileSize?t.fileSize:0),e.setOriginalAssetFetchDuration(t.fetchDuration),t.width&&t.height&&e.setOutputDimensions({width:t.width,height:t.height}),t.sourceFileSize&&e.setSourceFileSize(t.sourceFileSize),t.estimatedFileSize&&e.setEstimatedFileSize(t.estimatedFileSize),l.track(e)}_logFailureTelemetry(e,t){e.endReencode(),e.setState(a.ReencodeState.Fail),e.setErrorInfo(t),l.track(e)}_logCancelledTelemetry(e){e.endReencode(),e.setState(a.ReencodeState.Cancel),l.track(e)}test_reset(){this._sessionCounter=0,this._sessionIdInProgress=void 0,i.each(this._queue,(e=>{e.deferred.reject("Cleaning out from test_reset()")})),this._queue=[]}test_getInProgressErrorString(){return"LensVideoView had another session in progress"}}},66923:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(74958),o=s(96486),n=s(97691),r=s(19784),a=s(89391),l=s(65976),d=s(51077),c=s(81697),h=s(71830),u=s(62141),p=s(98278),g=s(984),m=s(39549),S=s(82261),f=s(70891),y=s(46096),_=s(52115),v=s(53559),C=s(53700),b=s(70004),T=s(97174),M=s(23944),I=s(36237),w=s(33754),P=s(71349),k=s(10909),A=s(27357),E=s(80457),R=s(31234),L=s(49130),F=s(22538),x=s(4057),O=s(78262),D=s(61694),B=s(26712),V=s(53374),N=s(53332),U=s(78735),H=y.LogTraceArea.PostingService;t.default=new class{constructor(){F.RegisterStartupable(this,"CreatePostInfoUtils",[C.default,R.default])}startup(){return n.Resolved()}createMessageInfo(e,t={}){let s;e.inputEntities&&R.default.registerEntities(e.inputEntities);let r={},l={},c=0;const p=d.getMessageTypeGroup(e.messageForPosting),g=e.conversationId;if(p===d.MessageTypeGroups.Text&&e.inputEntities&&!h.isEncryptedThread(g)){const t=U.default.getValueOfDoNotFormatPreferenceOrFalseIfDisabled(g),i=a.default.getS4LMessagingFeatures().enableDoNotFormat;let n=h.isPhoneMri(g)||!i||!t&&!S.hasDoNotFormatPrefixOrIsDoNotFormatEntity(e.inputEntities)?M.handleLinks(e.inputEntities):e.inputEntities;if(n&&n.length>0){const t=e.previousMessageBeingEditedProperties?e.previousMessageBeingEditedProperties:void 0;s=d.getJsonFromMessageProperty(t,d.MessageProperties.UrlPreviews),o.each(n,(e=>{if(e instanceof T.LinkEntity){const t=e.computeType();if(o.isNumber(t)&&t===D.UrlType.Web){const t=e.href;l[t]=!0,s&&o.some(s,(e=>e.key===t))||(r[t]=t)}}}))}c=M.getRawText(e.inputEntities).length}let m=o.values(r);const f=a.default.getConfigSettingsNoSubscription().urlPreview.maxPreviewsPerMessage;if(!o.isUndefined(f)){const e=f-(s?s.length:0);m.length>e&&(I.log(H,"Limiting URL previews to fetch to "+e),m=o.take(m,e))}m.length&&I.log(H,"Adding urls to the queue of URL previews: "+i.pii.Omit(m.join(", "))),p===d.MessageTypeGroups.SMS&&e.inputEntities&&(c=M.getRawText(e.inputEntities).length);return(e.editedMessageCuid?u.default.getMessageByCuid(g,e.editedMessageCuid):n.Resolved(void 0)).then((n=>{const r=!!s;let a;if(n&&s){const e=o.remove(s,(e=>!(e.key in l)));a=s.length?JSON.stringify(s):void 0,e.length>0&&I.log(H,"Message edit: removing unecessary urlpreviews: "+i.pii.Omit(a||""))}let u,p=e.messageForPosting;if(o.isEmpty(e.forwardMediaInfos))if(n)(m.length||a||r)&&(u={messageId:n.getServerIdForPropertyChanges(),urlPreviewJson:a});else if(a||e.isForward){let t=o.cloneDeep(p);if(t.properties=t.properties||{},a&&(t.properties[d.MessageProperties.UrlPreviews]=a),e.isForward){const e={isForwarded:!0};t.properties[d.MessageProperties.ForwardMetadata]=JSON.stringify(e)}p=t}const S=o.find(e.inputEntities,(e=>e instanceof T.QuoteEntity)),f=S&&S.quoteNode&&S.quoteNode.author&&h.skypeIdToMri(S.quoteNode.author),y=S&&S.quotesTriggerType,_=!!e.isForward;return{kind:E.PostMessageInfoKind,editedMessageCuid:e.editedMessageCuid,conversationId:g,postSource:e.postSource,conversationOrigin:e.conversationOrigin,messageForPosting:p,urlPreviewPropSet:u,forwardMediaInfos:e.forwardMediaInfos,swiftMessageDecoded:e.swiftMessageDecoded,urlPreviewEndpoints:m,rawContentLength:c,quoteAuthor:f,quotesTriggerType:y,isForward:_,showLocalNotificationOnFailure:t.showLocalNotificationOnFailure,shouldSendLogs:t.shouldSendLogs,shouldSendScreenshot:t.shouldSendScreenshot,screenshotUri:t.screenshotUri,conversationAcceptedInfo:this.getConversationAcceptedInfo(g),isDelete:!!e.isDelete,editedMessageServerId:e.editedMessageServerId,editedMessageVersion:e.editedMessageVersion}}))}createUploadInfo(e,t,s,i={}){return this.createUploadAndTextInfo(e,[{data:t,overlayUrl:i.overlayUrl}],s,i)}createUploadAndTextInfo(e,t,s,r={}){o.defaults(r,{copyUploadMedia:!0,copyThumbnail:!0});let l=!1;if(e.length&&o.some(e,(e=>h.isEncryptedThread(e)))){if(1!==e.length){const e="Encrypted files can be sent only to one thread at a time";return I.warn(H,e),this.alertOneThreadOnly(),n.Rejected(e)}l=!0}const d=[];let c=[];const u=[];return o.reduce(t,((e,t)=>e.then((()=>{if(o.isString(t))return c.push(t),void u.push(new T.UnhandledEntity(t));let{data:e,overlayUrl:h}=t,p=this.determineUploadFileType(e,l,r),g=e.thumbnail;if(v.default.isThumbnailSupportedFileType(p)||(g=void 0),!this.canUploadFile(e.file.size)){const t="Ignoring upload of empty file: "+i.pii.Omit(e.file.name);return I.warn(H,t),n.Rejected(t)}const m=N.default.shouldReencodeUpload(p,r.overlayUrl),S=m&&a.default.getS4LCMCFeaturesNoSubscription().disableCopyingOriginalVideoToCache;if(o.isNumber(e.file.size)&&!m){const t=_.default.getMaximumFileSizeForType(p);if(e.file.size>t){this.alertSizeTooBig(t,e.file.size,s,p);let i=`File is too large to upload: ${p} ${e.file.size} bytes`;return n.Rejected(i)}}const f=r.filename||e.file.name;let y,M,w,P;if(!S&&C.default.isLocalCacheSupported()){const t=this.generateLocalCacheName(e,p,f);y={name:t,asCopy:r.copyUploadMedia},M=b.FileUploadCacheUtils.getLocalCacheUri(t)}else M=B.default.getFileUrl(e);if(g)if(C.default.isLocalCacheSupported()){const e=this.generateLocalCacheName(g,O.UploadFileType.Thumbnail);w={name:e,asCopy:r.copyThumbnail},P=b.FileUploadCacheUtils.getLocalCacheUri(e)}else P=B.default.getFileUrl(g);return(S?n.Resolved():C.default.saveFileIfSupported(e,y)).then((()=>{let t=e.file.size;if(!o.isNumber(t)&&y){const i=C.default.getSize(y.name);if(o.isNumber(i)){t=i,p=this.determineUploadFileType(e,l,r,i);const o=_.default.getMaximumFileSizeForType(p);if(i>o&&!N.default.shouldReencodeUpload(p,r.overlayUrl)){this.alertSizeTooBig(o,t,s,p);let e=`File is too large to upload: ${p} ${o} bytes`;return n.Rejected(e)}}}v.default.isThumbnailSupportedFileType(p)||(g=void 0);const i=P||M,a=this.getMediaEntity(M,i,i,void 0,p,r.title,f,t,e.dimensions,void 0,r.durationMs);return u.push(a),c.push(d.length),d.push({amsUploadFullData:e,amsFullDataCacheInfo:y,amsFullDataLocalUrl:M,amsUploadFilename:f,amsUploadThumbnailData:g,amsThumbnailCacheInfo:w,amsThumbnailLocalUrl:P,amsUploadFileType:p,videoOverlayUrl:h,audioDurationMs:r.durationMs}),C.default.saveFileIfSupported(g,w)}))}))),n.Resolved()).then((()=>{o.some(c,o.isString)||(c=void 0);const i=d[0]?d[0].amsUploadFileType:void 0,n=this.determineChatMessageType(t,r,i);r.callId&&u.push(new T.CallReactionMetadataEntity(r.callId));const a={};o.each(e,(e=>{const t=S.createMessageInfo(e,s,u,n,r.properties,!!c);a[e]=t.messageForPosting}));return{kind:E.PostUploadInfoKind,conversationIds:e,amsUploads:d,textWithUploadIndexes:c,messagesForPosting:a,callId:r.callId,title:r.title,uploadSource:s,conversationOrigin:A.default.dangerouslyGetActiveConversationContextOrigin(p.MainRootViewId),toastMessageToShowOnSuccess:r.toastMessageToShowOnSuccess,toastMessageToShowOnFailure:r.toastMessageToShowOnFailure,shouldTrackUpload:r.shouldTrackUpload,conversationAcceptedInfos:o.mapValues(a,((e,t)=>this.getConversationAcceptedInfo(t)))}})).catch((t=>{if(I.warn(H,'Failed to start upload: ConvIds: "'+o.map(e,(e=>i.pii.Mri(e))).join(", ")+'", error: '+x.default.errorAsString(t)),o.each(d,(e=>{const{amsFullDataCacheInfo:t,amsThumbnailCacheInfo:s}=e;t&&C.default.abandon(t.name),s&&C.default.abandon(s.name)})),r.toastMessageToShowOnFailure){const e=w.getString(r.toastMessageToShowOnFailure);k.default.scheduleTextMessage(e,void 0,p.MainRootViewId)}return n.Rejected()}))}canUploadFile(e){return void 0===e||e>0}determineChatMessageType(e,t,s){if(e.length>1)return d.MessageTypes.RichText;if(t.title&&s===O.UploadFileType.Picture)return d.MessageTypes.Media_Card;if(!s)return d.MessageTypes.Text;switch(s){case O.UploadFileType.Picture:return d.MessageTypes.UriObject;case O.UploadFileType.Video:return d.MessageTypes.Media_Video;case O.UploadFileType.VideoMessage:return d.MessageTypes.VideoMessage;case O.UploadFileType.Audio:case O.UploadFileType.AudioMessage:return d.MessageTypes.AudioMessage;case O.UploadFileType.Thumbnail:case O.UploadFileType.GroupAvatar:case O.UploadFileType.Excel:case O.UploadFileType.OneNote:case O.UploadFileType.Powerpoint:case O.UploadFileType.Word:case O.UploadFileType.File:return d.MessageTypes.Media_GenericFile;default:return V.default.switchStatementExhaustiveChecking(s)}}determineUploadFileType(e,t,s={},i){if(t)return O.UploadFileType.File;let n=O.UploadFileType.File;if(v.default.isImageExtension(e.extension)){if(e.dimensions){n=O.UploadFileType.Picture;const t=_.default.getMaximumLimitsForType(n);t&&t.width&&t.height&&(e.dimensions.width>t.width||e.dimensions.height>t.height)&&(n=O.UploadFileType.File)}}else v.default.isVideoExtension(e.extension)?(this.isAmsVideoMessageExtension(e.extension)&&s.isRecorded?n=O.UploadFileType.VideoMessage:this.isAmsVideoExtension(e.extension)&&(n=O.UploadFileType.Video),e.thumbnail||(n=O.UploadFileType.File)):v.default.isAudioExtension(e.extension)&&(s.isRecorded?n=O.UploadFileType.AudioMessage:this.isAmsAudioExtension(e.extension)&&(n=O.UploadFileType.Audio));const r=o.isNumber(e.file.size)?e.file.size:i;if(o.isNumber(r)&&n!==O.UploadFileType.File){if(a.default.getAsyncMediaFeatures().fallback_to_file){r>_.default.getMaximumFileSizeForType(n)&&(n=O.UploadFileType.File)}}return n}isAmsVideoExtension(e){const t=a.default.getAsyncMediaFeatures().storage_limits.video.format;return o.includes(t,e.toLowerCase())}isAmsVideoMessageExtension(e){return o.includes(["mp4","webm"],e.toLowerCase())}isAmsAudioExtension(e){const t=a.default.getAsyncMediaFeatures().storage_limits,s=t.audio?t.audio.format:[];return o.includes(s,e.toLowerCase())}alertSizeTooBig(e,t,s,i,n=!1){const a=[{text:w.getString("Global.OkLabel"),isCancel:!0,onPress:o.noop}],l=w.getString("Global.FileTooBigContent",{maxSizeFormatted:_.default.formatFileSize(e,0).formattedString});r.default.showWithOptions({title:w.getString("Global.FileTooBig"),dialogAccessibilityTitle:l,message:l,buttons:a,rootViewId:p.MainRootViewId,useFocussedWindowFallback:!0});const d=new P.FileRejectedByClient(i,s,P.FileRejectedReason.FileSize);d.setFileSizeDetails(e,t),d.setIsRejectedFromPost(n),I.track(d)}alertOneThreadOnly(){const e=[{text:w.getString("Global.OkLabel"),isCancel:!0,onPress:o.noop}],t=w.getString("Global.OneThreadATimeContent");r.default.showWithOptions({title:w.getString("Global.OneThreadATime"),dialogAccessibilityTitle:t,message:t,buttons:e,rootViewId:p.MainRootViewId,useFocussedWindowFallback:!0})}getMediaEntity(e,t,s,i,o,n,r,a,l,d,c){let h;if(n){const t=this._getSwiftPictureMessage(e,n,d);h=new T.SwiftUriObjectEntity(t,void 0,!0,n)}else h=new T.MediaEntity(e,t,s,i,o,r,a,l,d,c);return h}_getSwiftPictureMessage(e,t,s){s||(s=l.getDocumentId(e));const i={images:[{url:s?l.getDisplayUrl(s,O.UploadFileType.Picture,O.MediaViewSize.MobilePreview):"",tap:{type:f.SwiftActionTypes.showImage}}],title:t},o={contentType:f.SwiftContentTypes.hero,content:i};return{type:f.SwiftMessageTypes.card,attachments:[o]}}generateLocalCacheName(e,t,s){let i=s?v.default.extractFileExtension(s):e.extension||v.default.extractFileExtension(e.file.name);if(!i)switch(t){case O.UploadFileType.File:case O.UploadFileType.Excel:case O.UploadFileType.OneNote:case O.UploadFileType.Powerpoint:case O.UploadFileType.Word:i="";break;case O.UploadFileType.Picture:case O.UploadFileType.Thumbnail:case O.UploadFileType.GroupAvatar:i="jpeg";break;case O.UploadFileType.Video:i="mp4";break;case O.UploadFileType.VideoMessage:i="webm";break;case O.UploadFileType.Audio:case O.UploadFileType.AudioMessage:i="mp3"}const o=V.default.newGuid()+(i?"."+i:"");return L.lossyForUserFile(o)}getConversationAcceptedInfo(e){return{hasConvInMemory:!!(0,m.default)().getConversation(e),isAccepted:g.default.isConversationAccepted(e),isSyncingConv:c.default.isSyncingMessagesForConversation(e),hasAllMessages:c.default.haveAllMessagesForConversation(e)}}}},24606:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.test_setForegroundPostEnabled=t.Test_CheckForUpdate=t.CheckForNeededWorkResult=t.postIdFromContext=t.PostMessageScenarioStep=t.TransferTypeToPostingTransferSource=t.ChatPostActionNames=t.AllForegroundTransferTypes=t.AllBackgroundTransferTypes=t.feedbackGathered=t.pokePost=t.serverTranscodingProgress=t.foregroundUploadProgress=t.foregroundResponse=t.Post=t.UpdateMediaTypeState=t.TranscodingState=t.EncryptionState=void 0;const i=s(74958),o=s(96486),n=s(57349),r=s(59728),a=s(26999),l=s(75463),d=s(16778),c=s(68409),h=s(62783),u=s(74634),p=s(97691),g=s(66737),m=s(89391),S=s(17135),f=s(20603),y=s(65976),_=s(34581),v=s(44135),C=s(22801),b=s(60021),T=s(76621),M=s(51077),I=s(65369),w=s(61375),P=s(71830),k=s(62141),A=s(98278),E=s(57569),R=s(66923),L=s(40276),F=s(62843),x=s(67121),O=s(36763),D=s(25793),B=s(98249),V=s(46096),N=s(84457),U=s(52115),H=s(53559),z=(s(53700),s(70004)),W=s(97174),j=s(23944),G=s(36237),K=s(16724),q=s(33754),Q=s(71349),X=s(12056),$=s(50513),J=s(26385),Y=s(10909),Z=s(18078),ee=s(15963),te=s(83181),se=s(66765),ie=s(16568),oe=s(4057),ne=s(40363),re=s(78262),ae=s(35370),le=s(94050),de=s(82176),ce=s(9426),he=s(65322),ue=s(26712),pe=s(53374),ge=s(60634),me=s(53332),Se=V.LogTraceArea.PostingService,fe={priority:h.WebRequestPriority.High,timeout:6e4},ye={priority:h.WebRequestPriority.High,progressTimeout:6e4,timeout:0};var _e,ve,Ce,be,Te,Me,Ie,we,Pe,ke,Ae,Ee,Re,Le,Fe,xe,Oe,De,Be,Ve,Ne,Ue,He,ze,We;!function(e){e[e.NotStarted=1]="NotStarted",e[e.InProgress=2]="InProgress",e[e.Success=3]="Success",e[e.Failure=4]="Failure"}(_e=t.EncryptionState||(t.EncryptionState={})),function(e){e[e.NotStarted=1]="NotStarted",e[e.InProgress=2]="InProgress",e[e.Success=3]="Success",e[e.Failure=4]="Failure"}(ve=t.TranscodingState||(t.TranscodingState={})),function(e){e[e.NotStarted=1]="NotStarted",e[e.InProgress=2]="InProgress",e[e.Success=3]="Success",e[e.Failure=4]="Failure"}(Ce=t.UpdateMediaTypeState||(t.UpdateMediaTypeState={}));class je{constructor(e,t,s){if(this.findAnythingBlockingPost=s,this.persisted=e,this.persisted.scenarioInfo&&o.size(e.amsUploads)<=1){const s=e.amsUploads&&e.amsUploads[0];this.telemetryScenarios=o.mapValues(this.persisted.messagesForPosting,((i,n)=>{const r=P.getCuidForMessage(i),a=b.getCorrelationIdFromMessageParts(Z.default.getSkypeMri(),n,i.clientmessageid);let l={};l.message_cuid=r,l.message_correlationId=a,l.message_type=ae.getMessageTypeName(i,Z.default.getSkypeMri(),n),l.message_rawtype=ae.getMessageRawTypeName(i,Z.default.getSkypeMri(),n),l.transaction_id=e.transactionId||"",s&&(s.amsUploadFullData.file&&(l.size=U.default.getAmsUploadFileSize(s)||0),s.amsUploadFullData.dimensions&&(l.width=s.amsUploadFullData.dimensions.width,l.height=s.amsUploadFullData.dimensions.height),l.extension=de.default.changeExtensionForTelemetry(s.amsUploadFullData.extension)),this.persisted.scenarioInfo&&this.persisted.scenarioInfo.failedAmsDocumentId&&(l.failed_docId=this.persisted.scenarioInfo.failedAmsDocumentId);const d=this.persisted.scenarioInfo.name,c=d===ee.ScenarioName.SendPicture||d===ee.ScenarioName.SendVideo||d===ee.ScenarioName.SendFile;let h=new le.default(d,a,l,void 0,c);return h.setDuplicateStepMarkingEnabled(),h.setScenarioTimeout((()=>(G.track(new X.MessageSendTimeout(i,n)),!1)),je._getInstrumentationTimeout(i)),t?(h.start(),o.each(this.persisted.scenarioInfo.secondaryScenariosToSpawnAtCreation,(e=>{h.spawnSecondaryScenario(e.name,e.timeout).start()}))):(h.resume(this.persisted.scenarioInfo.startTime),h.markStepCompleted("msg_restored",void 0,void 0,!0)),h}))}this._postSubSteps=Te.PostSubSteps.forPost(this,e),o.isUndefined(this.persisted.nonBlocking)&&(this.persisted.nonBlocking=!je._shouldBlock(e)),this._postSubSteps.redoLostTransfers()}markTelemetryStepCompleted(e,t,s,i){o.each(this.telemetryScenarios,((n,r)=>{if((!t||o.includes(t,r))&&o.size(this.persisted.amsUploads)<=1){let t=Ne[e],o={};const r=this._postSubSteps.amsManyData&&this._postSubSteps.amsManyData.amsSingleDatas[0];r&&(o.amsDocumentId=r.amsCreate.persisted.amsDocumentIds&&r.amsCreate.persisted.amsDocumentIds[0]),i&&(o[t+"_finished_attempts"]=i),n.extendProperties(o),n.markStepCompleted(t,s,void 0,!0)}}))}static _shouldBlock(e){const t=m.default.getS4LMessagingFeaturesNoSubscription().nonBlockingUploadsFromSize;if(o.isNumber(t)&&o.size(e.amsUploads)){let s=0;o.each(e.amsUploads,(e=>{e&&(o.isNumber(e.amsUploadFullData.file.size)&&(s+=e.amsUploadFullData.file.size),e.amsUploadThumbnailData&&o.isNumber(e.amsUploadThumbnailData.file.size)&&(s+=e.amsUploadThumbnailData.file.size))}));const i=o.some(e.messagesForPosting,((e,t)=>P.isAgent(t)));return t>s||i}return!0}static _getInstrumentationTimeout(e){const t=M.getMessageTypeGroup(e);let s=0;const i=m.default.getS4LMessagingFeatures();switch(t){case M.MessageTypeGroups.Location:s=i.locationSendTimeout;break;case M.MessageTypeGroups.Moji:s=i.mojiSendTimeout;break;case M.MessageTypeGroups.ScheduledCallInvite:s=m.default.getS4LCMCFeatures().scheduledCallInviteSendTimeout;break;case M.MessageTypeGroups.Poll:s=i.pollCardSendTimeout;break;case M.MessageTypeGroups.Sticker:s=i.stickerSendTimeout;break;case M.MessageTypeGroups.SwiftCard:s=i.swiftCardSendTimeout;break;case M.MessageTypeGroups.Text:case M.MessageTypeGroups.SMS:case M.MessageTypeGroups.CallerID:case M.MessageTypeGroups.MediaAlbum:case M.MessageTypeGroups.Translation:s=i.textSendTimeout;break;case M.MessageTypeGroups.UriFile:s=i.uriFileSendTimeout;break;case M.MessageTypeGroups.Audio:s=i.audioSendTimeout;break;case M.MessageTypeGroups.Picture:s=i.pictureSendTimeout;break;case M.MessageTypeGroups.Video:s=i.videoSendTimeout;break;case M.MessageTypeGroups.Calling:s=i.callingSendTimeout;break;case M.MessageTypeGroups.System:s=i.systemSendTimeout;break;case M.MessageTypeGroups.Contact:s=i.contactSendTimeout;break;case M.MessageTypeGroups.None:case M.MessageTypeGroups.Engagement:s=i.noneGroupSendCallback;break;default:pe.default.switchStatementExhaustiveChecking(t)}return s}getPersistedActionData(){return this.persisted}isUploadNeeded(){return!o.isEmpty(this.persisted.amsUploads)}doWorkIfNeeded(){const e=this._postSubSteps.checkForUpdate();let t;switch(e.kind){case Ue.Finished:case Ue.GiveUp:case Ue.Blocked:t=!1;break;case Ue.InProgress:case Ue.Update:const{backgroundWakeLockWhilePostWaitingForTransfer:s}=m.default.getConfigSettingsNoSubscription().chat,i=e=>s?!o.isEmpty(e):!o.every(e,(e=>e instanceof Ge));t=i(e.inProgress)||i(e.start);break;default:return pe.default.switchStatementExhaustiveChecking(e.kind)}switch(e.kind){case Ue.Finished:this._finished();break;case Ue.Blocked:case Ue.InProgress:break;case Ue.Update:o.each(e.start,(e=>{e.start()}));break;case Ue.GiveUp:const t=o.first(e.failure).stepType,s=He.getFailureReason(e);this._removeWithoutSuccess(t,s);break;default:return pe.default.switchStatementExhaustiveChecking(e.kind)}return{updateKind:e.kind,isActivelyWorking:t}}_finished(){if(this.persisted.shouldTrackUpload&&o.size(this.persisted.amsUploads)<=1){const e=this.persisted.amsUploads&&this.persisted.amsUploads[0];if(e){const t=Q.MediaUploadBase.mediaActionForFileType(e.amsUploadFileType);if(t){const s=this._postSubSteps.amsManyData,i=s&&s.amsSingleDatas[0],o=this.persisted.conversationIds&&this.persisted.conversationIds[0],n=o?P.isGroupConversation(o):void 0;G.track(new Q.MediaUploadBase(t,!0,V.MessagingFailureReason.None,Date.now()-this.persisted.postTime,e.amsUploadFileType,e.amsUploadFullData.dimensions,i?i.amsCreate.persisted.transactionId:void 0,i&&i.amsCreate.persisted.amsDocumentIds?i.amsCreate.persisted.amsDocumentIds[0]:void 0,n))}}}if(this.persisted.toastMessageToShowOnSuccess){const e=q.getString(this.persisted.toastMessageToShowOnSuccess);Y.default.scheduleTextMessage(e,void 0,A.MainRootViewId)}}_removeWithoutSuccess(e,t){switch(t){case E.FailureReason.Permanent:this.persisted.permanentFailureTransferType=e;break;case E.FailureReason.MaxElapsedTimeExceeded:this.persisted.maxElapsedTimeExceededTransferType=e;break;case E.FailureReason.MaxRetriesExceeded:this.persisted.maxRetriesExceededTransferType=e;break;case E.FailureReason.None:break;default:pe.default.switchStatementExhaustiveChecking(t)}if(G.log(Se,"Giving up: "+this.persisted.id+", transferType: "+e+", failureReason: "+E.FailureReason[t]),this.persisted.showLocalNotificationOnFailure){if(a.LocalNotifications.show(this.persisted.showLocalNotificationOnFailure),!o.isEmpty(this.persisted.conversationIds)){const e=new J.MessagingToastAlertEvent(J.MessagingToastAlertType.ReplyNotSent,this.persisted.conversationIds[0]);G.track(e)}this.persisted.showLocalNotificationOnFailure=void 0}}handleResponse(e,t,s,i,n,r){if(r===Ve.UrlPreviewsType&&o.isString(t)&&this._postSubSteps.urlPreview){const s=o.find(this._postSubSteps.urlPreview.steps,(t=>{const s=t,i=s.persisted&&s.persisted.urlPreviewBackgroundTransfer&&s.persisted.urlPreviewBackgroundTransfer[s.endpoint];return!!i&&i.id===e}));t={postId:t,endpoint:s&&s.endpoint}}const a=function(e,t){const s=e;switch(s){case Ve.AmsCreateType:case Ve.AmsThumbnailType:case Ve.AmsFullDataType:case Ve.AzureDataType:return o.isString(t)?{postId:t,stepSelector:0}:t;case Ve.AmsGetStatusForwardType:return ke.parseBackgroundContextForForward(t);case Ve.AmsGetStatusForwardUploadType:return ke.parseBackgroundContextForUpload(t);case Ve.AmsGetStatusServerTranscodingType:return ke.parseBackgroundContextForServerTranscoding(t);case Ve.AmsForwardContentType:return Ae.parseBackgroundContextForForward(t);case Ve.AmsForwardContentUploadType:return Ae.parseBackgroundContextForUpload(t);case Ve.UrlPreviewsType:return Ee.parseBackgroundContext(t);case Ve.ChatPostType:return Oe.parseBackgroundContext(t);case Ve.MessagePropSetType:return De.parseBackgroundContext(t);case Ve.AmsCreateForegroundType:case Ve.AmsThumbnailForegroundType:case Ve.AmsFullDataForegroundType:case Ve.ChatPostForegroundType:return t;default:return void pe.default.switchStatementExhaustiveChecking(s)}}(r,t);if(a)return this._postSubSteps.handleResponse(e,t,s,i,n,r,a.stepSelector)}resetBackoffs(){this._postSubSteps.resetBackoffs()}cleanup(){this._postSubSteps.cleanup()}updateTotalElapsedTime(e,t){const s=e?Date.now()-e:0;this.persisted.totalElapsedTime?this.persisted.totalElapsedTime+=s:this.persisted.totalElapsedTime=s,G.log(Se,`Post ${this.persisted.id} ${t} elapsedTime to handleResponse: ${s} total post elapsedTime: ${this.persisted.totalElapsedTime}`)}isMyLocalUrl(e){return o.includes(this.getMyLocalUrls(),e)}getMyLocalUrls(){const e=[];return o.each(this.persisted.amsUploads,(t=>{e.push(t.amsThumbnailLocalUrl,this._getCurrentFileUri(t.amsThumbnailCacheInfo)),e.push(t.amsFullDataLocalUrl,t.originalFullDataLocalUrl,this._getCurrentFileUri(t.amsFullDataCacheInfo))})),o.compact(e)}getMyLocalCacheNames(){const e=[];return o.each(this.persisted.amsUploads,(t=>{t.amsThumbnailCacheInfo&&e.push(t.amsThumbnailCacheInfo.name),t.amsFullDataCacheInfo&&e.push(t.amsFullDataCacheInfo.name)})),o.compact(e)}_getCurrentFileUri(e){return e?z.FileUploadCacheUtils.getAbsoluteUriForName(e.name):void 0}isPostedToChat(e){return this._postSubSteps.chatPosts.isPostedToChat(e)}debug_allPostsFailedRetryInfo(){return this._postSubSteps.debug_retryInfo()}}t.Post=je;class Ge extends E.default{constructor(e,t,s,i){super([s],Se),this.post=e,this.persisted=t,this.stepType=s,this.stepSelector=i}checkForUpdate(){const e=this.transfer(),{needValidSkypeToken:t}=this._config();if(this._isTransferCompletedSuccessfully(e))return He.Finished;if(this._isTransferCompletedWithoutSuccess(this.post.persisted.id,e,this.stepType)){const t=(null==e?void 0:e.failureReason)?e.failureReason:E.FailureReason.None;return He.NeedTo.giveUpBecauseStep(this,t)}return this._isTransferReadyToStart(this.post.persisted.id,e,this.stepType,t)?He.NeedTo.startSteps(this):e&&e.finished?He.NeedTo.waitBecauseBlocked(this):He.NeedTo.waitForProgress(this)}start(){this._startTime=Date.now(),this._start()}handleResponse(e,t,s,i){this.post.updateTotalElapsedTime(this._startTime,this.stepType);const n=this.transfer();if(!n||n.id!==i)return void G.warn(Se,"Got "+this.stepType+(this.stepSelector?" ("+this.stepSelector+")":"")+" for known post: "+this.post.persisted.id+", but transfer id mismatch, expected: "+i+", current: "+(n&&n.id));const{emptyResponse:r,shimChatServiceResponse:a,canBlockOthersInConv:l,convId:d,fileSize:c}=this._config();e&&!r&&o.isEmpty(t.body)&&(G.log(Se,this.stepType+" missing body, success = false: "+this.post.persisted.id),e=!1),e=this._overrideSuccess(e,t),a&&C.default.errorHandler.augmentErrorResponse(t,e);const h=this._isPermanentFailure(e,t),u=this.post.persisted.totalElapsedTime||0,p=this._handleTransferFinished(this.post.persisted.id,n,this.stepType,e,h,u,t);e=!!p.transfer.success;const g=this._telemetryInfo(e),m={success:e,permanentFailure:E.default.isTransferPermanentFailure(p.transfer),finishedAttemptsSoFarCount:p.transfer.finishedAttemptsSoFarCount,retryInfo:p.retryInfo,canRetry:p.canRetry,mightUnblockOthersInConv:l&&(e||!p.canRetry),telemetryInfo:g,convId:d,fileSize:c};return m.mightUnblockOthersInConv&&!d&&(m.mightUnblockOthersInConv=void 0),this._handleResponse(e,t,s),m}_overrideSuccess(e,t){return e}_getMaxRetries(e,t){const s=m.default.getS4LCMCFeatures().retryPolicy;return o.isNumber(s.maxRetries[t])?s.maxRetries[t]:s.maxRetriesDefault}_getMaxTransferTime(e,t){const s=m.default.getS4LCMCFeatures().retryPolicy;return o.isNumber(s.maxTransferTime[t])?s.maxTransferTime[t]:s.maxPostElapsedTime}_isPermanentFailure(e,t){const{fileSize:s,uploadFileType:i}=this._config();return Ye(e,t,s,i)}resetBackoffs(){this._resetBackoffs()}stop(e){const t=pe.default.newCauseId();G.log(Se,"stop, causeId: "+t);const s=this.transfer();s&&s.id&&(!s.finished&&v.default.transferIsTracked(s.id)&&v.default.cancelTransfer(s.id,t),e&&E.default.redoTransfer(s))}cleanup(){this.stop(!1),this._cleanupRetryInfo(this.post.persisted.id)}debug_retryInfo(){return this._getRetryInfo(this.post.persisted.id,this.stepType)}}class Ke{constructor(e,t,s,i){this.post=e,this.persisted=t,this.stepType=s,this.stepSelector=i}checkForUpdate(){const e=this._status();return e&&e.permanentFailure?He.NeedTo.giveUpBecauseStep(this,E.FailureReason.Permanent):e&&e.finished?He.Finished:this._foregroundRequest?He.NeedTo.waitForProgress(this):He.NeedTo.startSteps(this)}start(){this._startTime=Date.now();this._status();const e=this._startForegroundRequestOrFinish();if(!e)return void this._immediatelyFail();this._foregroundRequest=e,this._releasingWakeLockSubscription||(this._releasingWakeLockSubscription=C.default.releasingWakelock.subscribe((()=>{this._status(!0).finished||this._immediatelyFail()})));let s=!1;this._foregroundRequest.done((e=>{s=!0})).always((i=>{if(this._foregroundRequest!==e)return;this._foregroundRequest=void 0,this._releasingWakeLockSubscription&&(this._releasingWakeLockSubscription.unsubscribe(),this._releasingWakeLockSubscription=void 0);const o={postId:this.post.persisted.id,stepSelector:this.stepSelector},n=i.requestHeaders;t.foregroundResponse.fire(void 0,o,s,i,n,this.stepType)}))}_immediatelyFail(){this.stop(!1);const e=this._status(!0);e.finished=!0,e.finishedSuccess=!1;const{canBlockOthersInConv:s,convId:i}=this._config();t.pokePost.fire(this.post.persisted.id,s?i:void 0)}handleResponse(e,t,s,i){this.post.updateTotalElapsedTime(this._startTime,this.stepType);const o=this._status(!0);o.finished=!0,o.finishedSuccess=e,o.permanentFailure=this._isPermanentFailure(e,t),this._handleResponse(e,t,s);const{canBlockOthersInConv:n,convId:r,fileSize:a}=this._config(),l={success:e,permanentFailure:o.permanentFailure,finishedAttemptsSoFarCount:1,canRetry:!1,mightUnblockOthersInConv:n&&e,telemetryInfo:this._telemetryInfo(e),convId:r,fileSize:a};return l.mightUnblockOthersInConv&&!r&&(l.mightUnblockOthersInConv=void 0),l}_overrideSuccess(e,t){return e}_isPermanentFailure(e,t){const{fileSize:s,uploadFileType:i}=this._config();return Ye(e,t,s,i)}stop(e){if(this._foregroundRequest){const e=this._foregroundRequest;this._foregroundRequest=void 0,e.cancel()}if(e){const e=this._status(!0);e.finished=!0,e.finishedSuccess=!1}this._releasingWakeLockSubscription&&(this._releasingWakeLockSubscription.unsubscribe(),this._releasingWakeLockSubscription=void 0)}cleanup(){this.stop(!1)}}function qe(e,t){return!P.isEncryptedThread(e)&&(P.isThread(e)?m.default.getConfigSettings().chat.serverSideEdits:!M.isEventCallEndedMessageType(t)&&m.default.getConfigSettings().chat.serverSideEdits1to1)}function Qe(e){const t=m.default.getConfigSettingsNoSubscription().chat;return!e||t.backgroundWaitForAmsUpload}function Xe(){if(it&&d.App.getActivationState()===d.Types.AppActivationState.Active){const e=m.default.getConfigSettingsNoSubscription().chat.enableForegroundMessagePostWithREST;if(e["*"]||e[ne.default.getOSVersion()])return!0}return!1}function $e(e){const[t,...s]=e;return{uploadConvIds:[t],forwardConvIds:s}}function Je(e){return e instanceof Ge?"background transfer":e instanceof Ke?"foreground request":"other kind of Step"}function Ye(e,t,s,i){return E.default.isPermanentFailure(t)}function Ze(e){if(e.body&&e.body.errorCode)return e.body.errorCode}function et(e,t){const s=z.FileUploadCacheUtils.getAbsoluteFromLocalCacheUri(t),i=e.file.uri;if(!i||i===s)return e;const n=o.cloneDeep(e);return n.file.uri=s,n}function tt(e,t,s,i,o,n,r){return Object.assign(Object.assign({},e),{originalFileName:e.amsUploadFilename,originalFullDataLocalUrl:e.amsFullDataLocalUrl,originalUploadFileType:e.amsUploadFileType,amsFullDataLocalUrl:t,amsUploadFilename:i||e.amsUploadFilename,amsUploadFullData:s,amsUploadFileType:o||e.amsUploadFileType,amsThumbnailLocalUrl:n,amsUploadThumbnailData:r})}function st(e,s,i,o,n,r){const a=i?o?1:0:r&&r.total?r.loaded/r.total:0;t.foregroundUploadProgress.fire(e,s,n,{finished:i,success:o,progress:a})}t.foregroundResponse=new u.default,t.foregroundUploadProgress=new u.default,t.serverTranscodingProgress=new u.default,function(e){const t="_CONTAINER_";class s{constructor(e,s){this.post=e,this.stepType=t,this.steps=o.compact(s)}redoLostTransfers(){o.each(this.steps,(e=>{if(e.stepType===t)e.redoLostTransfers();else{const t=e;if(t&&o.isFunction(t.transfer)){const e=t.transfer();e&&E.default.isTransferLost(e)&&E.default.redoTransfer(e)}}}))}handleResponse(e,s,i,o,n,r,a){const l=this._findSubStep(r,a);if(l){if(l.stepType===t)return l.handleResponse(e,s,i,o,n,r,a);{const t=l;if(t.handleResponse)return t.handleResponse(i,o,n,e)}}}_findSubStep(e,s){let i;return o.each(this.steps,(o=>(o.stepType===t?o._findSubStep(e,s)&&(i=o):o.stepType===e&&o.stepSelector===s&&(i=o),!i&&void 0))),i}resetBackoffs(){o.each(this.steps,(e=>{if(e.stepType===t)e.resetBackoffs();else{const t=e;t&&t.resetBackoffs&&t.resetBackoffs()}}))}debug_retryInfo(){const e=o.map(this.steps,(e=>{if(e.stepType===t)return e.debug_retryInfo();{const t=e;if(t.debug_retryInfo)return t.debug_retryInfo()}}));return o.merge({},...e)}stop(e){o.each(this.steps,(t=>{t.stop(e)}))}cleanup(){o.each(this.steps,(e=>{e.cleanup()}))}}e.InSequence=class extends s{checkForUpdate(){return He.findWorkWithLowPriorityFinished(this.steps)}};e.InParallel=class extends s{checkForUpdate(){const e=o.map(this.steps,(e=>e.checkForUpdate()));return this._giveUpUpdateHasLowPriority?He.reduceWithLowPriorityGiveUp(e):He.reduceWithHighPriorityGiveUp(e)}}}(be||(be={})),function(e){class t extends be.InSequence{constructor(e,t,s,i,o,n,r){super(e,[t,s,i,o,n,r]),this.amsManyData=t,this.amsForward=s,this.urlPreview=i,this.chatPosts=o,this.propSets=n,this.feedback=r}static forPost(e,i){const o=s.forPost(e,i),n=r.forPost(e,i),a=c.forPost(e,i),l=u.forPost(e,i),d=p.forPost(e,i),h=Be.FeedbackStep.forPost(e,i);return new t(e,o,n,a,l,d,h)}}e.PostSubSteps=t;class s extends be.InSequence{constructor(e,t,s,i,o){super(e,[t,s,...i,o]),this.post=e,this.transcodeVideo=t,this.encryptFile=s,this.amsSingleDatas=i,this.amsForwardUpload=o}static forPost(e,t){if(t.amsUploads&&t.amsUploads.length){const i=o.map(t.amsUploads,((s,i)=>n.forPost(e,t,i))),r=xe.TranscodeVideoStep.forPost(e,t),a=Fe.EncryptFileStep.forPost(e,t),d=l.forPost(e,t);return new s(e,r,a,i,d)}}}class n extends be.InSequence{constructor(e,t,s,i,o,n,r,a,l){super(e,[t,s,i,o,n,r,a,l]),this.amsCreateForeground=t,this.amsCreate=s,this.amsThumbnailForeground=i,this.amsThumbnail=o,this.amsFullDataForeground=n,this.amsFullData=r,this.amsServerTranscodingStatus=a,this.azureData=l}static forPost(e,t,s){if(t.amsUploads&&t.amsUploads[s]){const i=Me.AmsCreateForegroundStep.forPost(e,t,s),o=Me.AmsCreateStep.forPost(e,t,s),r=Ie.AmsThumbnailForegroundStep.forPost(e,t,s),a=Ie.AmsThumbnailStep.forPost(e,t,s),l=we.AmsFullDataForegroundStep.forPost(e,t,s),d=we.AmsFullDataStep.forPost(e,t,s),c=ke.AmsGetStatusForServerTranscodingStep.forPost(e,t,s),h=Pe.AzureDataStep.forPost(e,t,s);if(o&&(a||r||d||l||h))return new n(e,i,o,r,a,l,d,c,h)}}handleResponse(e,t,s,i,o,n,r){const a=super.handleResponse(e,t,s,i,o,n,r),l=o&&f.default.checkAuthFailure(i.statusCode,o,!1);return(307===i.statusCode||l)&&(G.log(Se,"Will redo Upload: "+this.post.persisted.id+", "+(l?"auth failure (possible redirect)":"redirect")),this.stop(!0)),a}}class r extends be.InParallel{constructor(e,t){super(e,t),this.post=e,this._giveUpUpdateHasLowPriority=!1}static forPost(e,t){if(t.forwardMediaInfos&&t.forwardMediaInfos.length>0){const s=o.map(e.persisted.forwardMediaInfos,(s=>a.forPost(e,t,s)));return new r(e,s)}}}class a extends be.InSequence{constructor(e,t,s,i){super(e,[s,i]),this.post=e,this.info=t,this.amsGetStatusForward=s,this.amsForwardContent=i}static forPost(e,t,s){if(t.forwardMediaInfos&&t.forwardMediaInfos.length>0){const i=ke.AmsGetStatusForwardStep.forPost(e,t,s),o=Ae.AmsForwardContentStep.forPost(e,t,s);if(i&&o)return new a(e,s,i,o)}}handleResponse(e,t,s,i,o,n,r){const a=super.handleResponse(e,t,s,i,o,n,r),l=o&&f.default.checkAuthFailure(i.statusCode,o,!1);return(307===i.statusCode||l)&&(G.log(Se,"Will redo Forward: "+this.post.persisted.id+", objectId: "+this.info.objectId+", "+(l?"auth failure (possible redirect)":"redirect")),this.stop(!0)),a}}class l extends be.InParallel{constructor(e,t){super(e,t),this.post=e,this._giveUpUpdateHasLowPriority=!1}static forPost(e,t){const{forwardConvIds:s}=$e(t.conversationIds);if(e.isUploadNeeded()&&s.length){const i=o.map(s,(s=>d.forPost(e,t,s)));return new l(e,i)}}}class d extends be.InSequence{constructor(e,t,s,i){super(e,[s,i]),this.post=e,this.convId=t,this.amsGetStatusForward=s,this.amsForwardContent=i}static forPost(e,t,s){if(e.isUploadNeeded()){const i=ke.AmsGetStatusForUploadStep.forPost(e,t,s),o=Ae.AmsForwardContentForUploadStep.forPost(e,t,s);if(i&&o)return new d(e,s,i,o)}}handleResponse(e,t,s,o,n,r,a){const l=super.handleResponse(e,t,s,o,n,r,a),d=n&&f.default.checkAuthFailure(o.statusCode,n,!1);return(307===o.statusCode||d)&&(G.log(Se,"Will redo Forward: "+this.post.persisted.id+", convId: "+i.pii.Mri(this.convId)+", "+(d?"auth failure (possible redirect)":"redirect")),this.stop(!0)),l}}class c extends be.InParallel{constructor(e,t){super(e,t),this._giveUpUpdateHasLowPriority=!1}static forPost(e,t){if(t.urlPreviewEndpoints&&t.urlPreviewEndpoints.length>0){const s=o.uniq(t.urlPreviewEndpoints),i=o.map(s,(s=>Ee.UrlPreviewsStep.forPost(e,t,s)));return new c(e,i)}}checkForUpdate(){const e=super.checkForUpdate();return e.kind===Ue.GiveUp&&this.stop(!1),He.dontGiveUp(e)}}class h extends be.InSequence{constructor(e,t,s,i,o,n){super(e,[s,i,o,n]),this.convId=t,this.updateMediaType=s,this.encryptMessage=i,this.chatPostForegroundStep=o,this.chatPostTransferStep=n}static forPost(e,t,s){return new h(e,s,Le.UpdateMediaTypeStep.forPost(e,t,s),Re.EncryptMessageStep.forPost(e,t,s),Oe.ChatPostForegroundStep.forPost(e,t,s),Oe.ChatPostTransferStep.forPost(e,t,s))}}class u extends be.InParallel{constructor(e,t){super(e,t),this._giveUpUpdateHasLowPriority=!0,this.chatPostInConv={},this.chatPostInConv=o.keyBy(t,(e=>e?e.convId:"undefined"))}static forPost(e,t){const s=o.map(e.persisted.conversationIds,(s=>h.forPost(e,t,s)));return new u(e,s)}isPostedToChat(e){const t=this.chatPostInConv[e];return!!t&&t.checkForUpdate().kind===Ue.Finished}handleResponse(e,t,s,i,n,r,a){const l=super.handleResponse(e,t,s,i,n,r,a);return o.every(this.chatPostInConv,(e=>{if(e){const t=e.checkForUpdate();switch(t.kind){case Ue.Finished:case Ue.GiveUp:return!0;case Ue.InProgress:case Ue.Blocked:case Ue.Update:return!1;default:pe.default.switchStatementExhaustiveChecking(t.kind)}}return!0}))&&G.log(Se,"Finished posting to Chat Service: "+this.post.persisted.id),l}}class p extends be.InParallel{constructor(e,t){super(e,t),this._giveUpUpdateHasLowPriority=!0}static forPost(e,t){if(t.urlPreviewPropSet){const s=o.map(e.persisted.conversationIds,(s=>De.MessagePropSetStep.forPost(e,t,s)));return new p(e,s)}}checkForUpdate(){const e=super.checkForUpdate();return He.dontGiveUp(e)}}}(Te||(Te={})),t.pokePost=new u.default,function(e){function t(e,t){return!(!e.amsUploads||!e.amsUploads[t])}function s(e){return{needValidSkypeToken:!0,emptyResponse:!1,shimChatServiceResponse:!1,canBlockOthersInConv:!1,fileSize:U.default.getAmsUploadFileSize(e),uploadFileType:e.amsUploadFileType}}function i(e){return e.body&&e.body.id}function o(e,t,s,o){const n=o&&S.ASMClient.getTracingHeaders(o);if(G.log(Se,"AmsCreateDocument completed: "+e.post.persisted.id+", for: "+e.stepSelector+", success: "+t+", Document ID: "+i(s)+", from "+Je(e)+", tracing:"+JSON.stringify(n)),t){e.persisted.amsDocumentIds||(e.persisted.amsDocumentIds=[]);const t=i(s);e.persisted.amsDocumentIds[e.amsUploadIndex]=t,t?ze.updateAmsCreateReferences(e.post):G.warn(Se,"was not given amsDocumentId for successfully created document")}else f.default.checkAuthFailure(s.statusCode,o)}function n(e,t){e&&t.persisted.amsDocumentIds&&(t.persisted.amsDocumentIds[t.amsUploadIndex]=void 0)}function r(e){return{step:Ne.AmsDocumentCreated}}e.AmsCreateForegroundStepType="postingService_amsCreateForeground",e.AmsCreateTransferType="postingService_amsCreate";class a extends Ke{constructor(){super(...arguments),this.amsUploadIndex=this.stepSelector}static forPost(s,i,o){if(t(i,o)&&Qe(!0))return new a(s,i,e.AmsCreateForegroundStepType,o)}getAmsUpload(){return this.persisted.amsUploads[this.amsUploadIndex]}_config(){return s(this.getAmsUpload())}_status(e){return e&&(this.persisted.amsCreateDocumentForegroundRequests||(this.persisted.amsCreateDocumentForegroundRequests={}),this.persisted.amsCreateDocumentForegroundRequests[this.amsUploadIndex]||(this.persisted.amsCreateDocumentForegroundRequests[this.amsUploadIndex]={finished:!1,finishedSuccess:!1})),this.persisted.amsCreateDocumentForegroundRequests&&this.persisted.amsCreateDocumentForegroundRequests[this.amsUploadIndex]}_startForegroundRequestOrFinish(){if(!Xe())return;this.persisted.amsCreateDocumentBackgroundIds||(this.persisted.amsCreateDocumentBackgroundIds={}),this.persisted.amsCreateDocumentBackgroundIds[this.amsUploadIndex]||(this.persisted.amsCreateDocumentBackgroundIds[this.amsUploadIndex]=pe.default.newGuid());const e=this.getAmsUpload(),{uploadConvIds:t}=$e(this.post.persisted.conversationIds);return f.default.createDocumentAsync(t,e.amsUploadFilename,e.amsUploadFileType,void 0,this.persisted.transactionId,this.persisted.amsCreateDocumentBackgroundIds[this.amsUploadIndex],fe.timeout)}_overrideSuccess(e,t){return e&&!!i(t)}_handleResponse(e,t,s){o(this,e,t,s)}stop(e){super.stop(e),n(e,this)}_telemetryInfo(e){return r()}}e.AmsCreateForegroundStep=a;class l extends Ge{constructor(){super(...arguments),this.amsUploadIndex=this.stepSelector}static forPost(s,i,o){if(t(i,o))return new l(s,i,e.AmsCreateTransferType,o)}getAmsUpload(){return this.persisted.amsUploads[this.stepSelector]}_config(){return s(this.getAmsUpload())}transfer(){return this.persisted.amsCreateDocumentBackgroundTransfers&&this.persisted.amsCreateDocumentBackgroundTransfers[this.amsUploadIndex]}checkForUpdate(){return this.persisted.amsCreateDocumentForegroundRequests&&this.persisted.amsCreateDocumentForegroundRequests[this.amsUploadIndex]&&this.persisted.amsCreateDocumentForegroundRequests[this.amsUploadIndex].finishedSuccess?He.Finished:super.checkForUpdate()}_start(){this.persisted.amsCreateDocumentBackgroundIds||(this.persisted.amsCreateDocumentBackgroundIds={}),this.persisted.amsCreateDocumentBackgroundIds[this.amsUploadIndex]||(this.persisted.amsCreateDocumentBackgroundIds[this.amsUploadIndex]=pe.default.newGuid()),this.persisted.amsCreateDocumentBackgroundTransfers||(this.persisted.amsCreateDocumentBackgroundTransfers={});const e=Object.assign(Object.assign({},fe),{transactionId:this.persisted.transactionId,correlationId:this.persisted.amsCreateDocumentBackgroundIds[this.amsUploadIndex]}),t=this.getAmsUpload(),{uploadConvIds:s}=$e(this.post.persisted.conversationIds),i=this.transfer(),o=f.default.createDocumentBackground(this.stepType,{postId:this.post.persisted.id,stepSelector:this.stepSelector},s,t.amsUploadFilename,t.amsUploadFileType,void 0,e);this.persisted.amsCreateDocumentBackgroundTransfers[this.amsUploadIndex]=this._createTrackedBackgroundTransfer(o,i)}_overrideSuccess(e,t){return e&&!!i(t)}_handleResponse(e,t,s){o(this,e,t,s)}stop(e){super.stop(e),n(e,this)}_telemetryInfo(e){return r()}}e.AmsCreateStep=l}(Me||(Me={})),function(e){function t(e,t){if(!e.amsUploads||!e.amsUploads[t])return!1;return!!m.default.isDesktopVIMEnabled()&&e.amsUploads[t].amsUploadFileType===re.UploadFileType.VideoMessage&&!m.default.getS4LCMCFeatures().enableDesktopVIMThumbnailUpload?(G.log(Se,"Desktop VIM: thumbnail upload is disabled"),!1):!!e.amsUploads[t].amsUploadThumbnailData}function s(e){return{needValidSkypeToken:!0,emptyResponse:!0,shimChatServiceResponse:!1,canBlockOthersInConv:!1,fileSize:e.amsUploadThumbnailData.file.size,uploadFileType:re.UploadFileType.Thumbnail}}function i(e,t,s,i){const o=i&&S.ASMClient.getTracingHeaders(i);G.log(Se,"AmsUploadThumbContent completed: "+e.post.persisted.id+", for: "+e.stepSelector+", success: "+t+", from "+Je(e)+", tracing:"+JSON.stringify(o)),t||f.default.checkAuthFailure(s.statusCode,i),st(e.post.persisted.id,e.amsUploadIndex,!0,t,!1)}function o(e){return{step:Ne.AmsThumbContentUploaded,attributes:{success:e}}}e.AmsThumbnailTransferType="postingService_amsUpThumbContent",e.AmsThumbnailForegroundStepType="postingService_amsUpThumbContentForeground";class n extends Ke{constructor(){super(...arguments),this.amsUploadIndex=this.stepSelector}static forPost(s,i,o){if(t(i,o)&&Qe(!0))return new n(s,i,e.AmsThumbnailForegroundStepType,o)}getAmsUpload(){return this.persisted.amsUploads[this.amsUploadIndex]}_config(){return s(this.getAmsUpload())}_status(e){return e&&(this.persisted.amsThumbnailDocumentForegroundRequests||(this.persisted.amsThumbnailDocumentForegroundRequests={}),this.persisted.amsThumbnailDocumentForegroundRequests[this.amsUploadIndex]||(this.persisted.amsThumbnailDocumentForegroundRequests[this.amsUploadIndex]={finished:!1,finishedSuccess:!1})),this.persisted.amsThumbnailDocumentForegroundRequests&&this.persisted.amsThumbnailDocumentForegroundRequests[this.amsUploadIndex]}_startForegroundRequestOrFinish(){if(!Xe())return;this.persisted.amsThumbnailBackgroundIds||(this.persisted.amsThumbnailBackgroundIds={}),this.persisted.amsThumbnailBackgroundIds[this.amsUploadIndex]||(this.persisted.amsThumbnailBackgroundIds[this.amsUploadIndex]=pe.default.newGuid());const e=this.persisted.amsDocumentIds[this.amsUploadIndex],t=this.getAmsUpload();return st(this.post.persisted.id,this.amsUploadIndex,!1,!1,!1),f.default.uploadDocumentAsync(e,re.UploadFileType.Thumbnail,et(t.amsUploadThumbnailData,t.amsThumbnailLocalUrl).file,(e=>st(this.post.persisted.id,this.amsUploadIndex,!1,!1,!1,e)),this.persisted.transactionId,this.persisted.amsThumbnailBackgroundIds[this.amsUploadIndex])}_handleResponse(e,t,s){i(this,e,t,s)}stop(e){super.stop(e)}_telemetryInfo(e){return o(e)}}e.AmsThumbnailForegroundStep=n;class r extends Ge{constructor(){super(...arguments),this.amsUploadIndex=this.stepSelector}static forPost(s,i,o){if(t(i,o))return new r(s,i,e.AmsThumbnailTransferType,o)}getAmsUpload(){return this.persisted.amsUploads[this.amsUploadIndex]}_config(){return s(this.getAmsUpload())}transfer(){return this.persisted.amsThumbnailBackgroundTransfers&&this.persisted.amsThumbnailBackgroundTransfers[this.amsUploadIndex]}checkForUpdate(){return this.persisted.amsThumbnailDocumentForegroundRequests&&this.persisted.amsThumbnailDocumentForegroundRequests[this.amsUploadIndex]&&this.persisted.amsThumbnailDocumentForegroundRequests[this.amsUploadIndex].finishedSuccess?He.Finished:super.checkForUpdate()}_start(){this.persisted.amsThumbnailBackgroundIds||(this.persisted.amsThumbnailBackgroundIds={}),this.persisted.amsThumbnailBackgroundIds[this.amsUploadIndex]||(this.persisted.amsThumbnailBackgroundIds[this.amsUploadIndex]=pe.default.newGuid()),this.persisted.amsThumbnailBackgroundTransfers||(this.persisted.amsThumbnailBackgroundTransfers={});const e=Object.assign(Object.assign({},ye),{transactionId:this.persisted.transactionId,correlationId:this.persisted.amsThumbnailBackgroundIds[this.amsUploadIndex]}),t=this.persisted.amsDocumentIds[this.amsUploadIndex],s=this.getAmsUpload(),i=this.transfer(),o=f.default.uploadDocumentBackground(this.stepType,{postId:this.post.persisted.id,stepSelector:this.stepSelector},t,re.UploadFileType.Thumbnail,et(s.amsUploadThumbnailData,s.amsThumbnailLocalUrl).file,e);this.persisted.amsThumbnailBackgroundTransfers[this.amsUploadIndex]=this._createTrackedBackgroundTransfer(o,i)}_handleResponse(e,t,s){i(this,e,t,s)}stop(e){super.stop(e)}_telemetryInfo(e){return o(e)}}e.AmsThumbnailStep=r}(Ie||(Ie={})),function(e){function t(e,t){return!!(e.amsUploads&&e.amsUploads[t]&&e.amsUploads[t].amsUploadFullData)}function s(e,t){const s=e&&e[t],i=m.default.getS4LCMCFeatures();return!!(s&&s.amsUploadFileType&&i.resumableUploads.enabled)&&o.some(i.resumableUploads.types,(e=>s.amsUploadFileType===re.UploadFileType[e]))}function i(e){return{needValidSkypeToken:!0,emptyResponse:!0,shimChatServiceResponse:!1,canBlockOthersInConv:!1,fileSize:U.default.getAmsUploadFileSize(e),uploadFileType:e.amsUploadFileType}}function n(e,t,s,i,n){const r=i&&S.ASMClient.getTracingHeaders(i);G.log(Se,"AmsUploadFullContent completed: "+e.post.persisted.id+", for: "+e.stepSelector+", success: "+t+", from "+Je(e)+", tracing:"+JSON.stringify(r));const a=e.persisted.amsDocumentIds[e.amsUploadIndex],l=e.getAmsUpload(),d=e.persisted.instrumentation_uploadStartTimes[e.amsUploadIndex],c=Date.now()-d,h=H.default.extractFileExtension(l.amsUploadFilename,!0),u=y.getDownloadViewId(l.amsUploadFileType,re.MediaViewSize.Full),p=t?V.MessagingFailureReason.None:V.MessagingFailureReason.AMSFailure,g=U.default.getAmsUploadFileSize(l),m=new K.FileSent(e.post.persisted.conversationIds,e.persisted.instrumentation_postSource,de.default.changeExtensionForTelemetry(h),g,u,a,e.post.persisted.messagesForPosting);m.setSuccess(t,p,n,s.statusCode,d,c),G.track(m),t?(We.updateMessageUrls(e.post,a,void 0),o.each(e.post.persisted.messagesForPosting,((e,t)=>{T.default.applyMessageLie(t,e)}))):f.default.checkAuthFailure(s.statusCode,i),st(e.post.persisted.id,e.amsUploadIndex,!0,t,!0)}function r(e){return{step:Ne.AmsFullContentUploaded,attributes:{success:e}}}e.AmsFullDataTransferType="postingService_amsUpFullContent",e.AmsFullDataForegroundStepType="postingService_amsUpFullContentForeground";class a extends Ke{constructor(){super(...arguments),this.amsUploadIndex=this.stepSelector}static forPost(i,o,n){if(t(o,n)&&Qe(!0)&&!s(o.amsUploads,n))return new a(i,o,e.AmsFullDataForegroundStepType,n)}getAmsUpload(){return this.persisted.amsUploads[this.amsUploadIndex]}_config(){return i(this.getAmsUpload())}_status(e){return e&&(this.persisted.amsFullDataDocumentForegroundRequests||(this.persisted.amsFullDataDocumentForegroundRequests={}),this.persisted.amsFullDataDocumentForegroundRequests[this.amsUploadIndex]||(this.persisted.amsFullDataDocumentForegroundRequests[this.amsUploadIndex]={finished:!1,finishedSuccess:!1})),this.persisted.amsFullDataDocumentForegroundRequests&&this.persisted.amsFullDataDocumentForegroundRequests[this.amsUploadIndex]}_startForegroundRequestOrFinish(){if(!Xe())return;this.persisted.instrumentation_uploadStartTimes||(this.persisted.instrumentation_uploadStartTimes={}),this.persisted.instrumentation_uploadStartTimes[this.amsUploadIndex]=Date.now(),this.persisted.amsFullDataBackgroundIds||(this.persisted.amsFullDataBackgroundIds={}),this.persisted.amsFullDataBackgroundIds[this.amsUploadIndex]||(this.persisted.amsFullDataBackgroundIds[this.amsUploadIndex]=pe.default.newGuid());const e=this.persisted.amsDocumentIds[this.amsUploadIndex],t=this.getAmsUpload();return st(this.post.persisted.id,this.amsUploadIndex,!1,!1,!0),f.default.uploadDocumentAsync(e,t.amsUploadFileType,et(t.amsUploadFullData,t.amsFullDataLocalUrl).file,(e=>st(this.post.persisted.id,this.amsUploadIndex,!1,!1,!0,e)),this.persisted.transactionId,this.persisted.amsFullDataBackgroundIds[this.amsUploadIndex])}_handleResponse(e,t,s){n(this,e,t,s,1)}stop(e){super.stop(e)}_telemetryInfo(e){return r(e)}}e.AmsFullDataForegroundStep=a;class l extends Ge{constructor(){super(...arguments),this.amsUploadIndex=this.stepSelector}static forPost(s,i,o){if(t(i,o))return new l(s,i,e.AmsFullDataTransferType,o)}getAmsUpload(){return this.persisted.amsUploads[this.amsUploadIndex]}_config(){return i(this.getAmsUpload())}transfer(){return this.persisted.amsFullDataBackgroundTransfers&&this.persisted.amsFullDataBackgroundTransfers[this.amsUploadIndex]}checkForUpdate(){return this.persisted.amsFullDataDocumentForegroundRequests&&this.persisted.amsFullDataDocumentForegroundRequests[this.amsUploadIndex]&&this.persisted.amsFullDataDocumentForegroundRequests[this.amsUploadIndex].finishedSuccess?He.Finished:super.checkForUpdate()}_start(){this.persisted.instrumentation_uploadStartTimes||(this.persisted.instrumentation_uploadStartTimes={}),this.persisted.instrumentation_uploadStartTimes[this.amsUploadIndex]=Date.now(),this.persisted.amsFullDataBackgroundIds||(this.persisted.amsFullDataBackgroundIds={}),this.persisted.amsFullDataBackgroundIds[this.amsUploadIndex]||(this.persisted.amsFullDataBackgroundIds[this.amsUploadIndex]=pe.default.newGuid()),this.persisted.amsFullDataBackgroundTransfers||(this.persisted.amsFullDataBackgroundTransfers={});const e=this.getAmsUpload(),t=this.persisted.amsDocumentIds[this.amsUploadIndex],i=s(this.persisted.amsUploads,this.amsUploadIndex),o=y.getUploadStatusUrl(t,e.amsUploadFileType),n=this.persisted.amsFullDataBackgroundTransfers&&this.persisted.amsFullDataBackgroundTransfers[this.amsUploadIndex],r=n?n.finishedAttemptsSoFarCount:0,a=Object.assign(Object.assign({},ye),{transactionId:this.persisted.transactionId,correlationId:this.persisted.amsFullDataBackgroundIds[this.amsUploadIndex],resumable:i,resumableUploadStatusUrl:o,resumableAttemptsSoFar:r}),l=this.transfer(),d=f.default.uploadDocumentBackground(this.stepType,{postId:this.post.persisted.id,stepSelector:this.stepSelector},t,e.amsUploadFileType,et(e.amsUploadFullData,e.amsFullDataLocalUrl).file,a);this.persisted.amsFullDataBackgroundTransfers[this.amsUploadIndex]=this._createTrackedBackgroundTransfer(d,l)}_handleResponse(e,t,s){n(this,e,t,s,this.transfer().finishedAttemptsSoFarCount)}stop(e){super.stop(e)}_telemetryInfo(e){return r(e)}}e.AmsFullDataStep=l}(we||(we={})),function(e){e.AzureDataTransferType="postingService_azureUp";class t extends Ge{constructor(){super(...arguments),this.amsUploadIndex=this.stepSelector}static forPost(s,i,o){if(function(e,t){let s=!!(m.default.getS4LCMCFeatures().enableAzMSPublish&&m.default.isDesktopVIMEnabled()&&e.amsUploads&&e.amsUploads[t]&&e.amsUploads[t].amsUploadFileType===re.UploadFileType.VideoMessage&&e.amsUploads[t].amsUploadFullData);return G.log(Se,"AzMS: VIM upload is "+(s?"enabled":"disabled")),s}(i,o))return new t(s,i,e.AzureDataTransferType,o)}getAmsUpload(){return this.persisted.amsUploads[this.amsUploadIndex]}_config(){const e=this.getAmsUpload();return{needValidSkypeToken:!0,emptyResponse:!1,shimChatServiceResponse:!1,canBlockOthersInConv:!1,fileSize:U.default.getAmsUploadFileSize(e),uploadFileType:e.amsUploadFileType}}transfer(){return this.persisted.azureBackgroundTransfers&&this.persisted.azureBackgroundTransfers[this.amsUploadIndex]}_start(){this.persisted.azureBackgroundTransfers||(this.persisted.azureBackgroundTransfers={});const e=this.getAmsUpload(),t=this.transfer(),s=_.default.uploadDocumentBackground(this.stepType,{postId:this.post.persisted.id,stepSelector:this.stepSelector},et(e.amsUploadFullData,e.amsFullDataLocalUrl).file,ye);this.persisted.azureBackgroundTransfers[this.amsUploadIndex]=this._createTrackedBackgroundTransfer(s,t)}_handleResponse(e,t,s){if(G.log(Se,"AzureUpload completed: "+this.post.persisted.id+", for: "+this.stepSelector+", success: "+e+", videoId: "+(e&&t.body?t.body.id:void 0)),e){this.persisted.azureMSUrls||(this.persisted.azureMSUrls={});let e=t.body;this.persisted.azureMSUrls[this.amsUploadIndex]=_.default.getVideoUrl(e.id);const s=this.persisted.amsDocumentIds[this.amsUploadIndex];We.updateMessageUrls(this.post,s,this.persisted.azureMSUrls[this.amsUploadIndex]),o.each(this.post.persisted.messagesForPosting,((e,t)=>{T.default.applyMessageLie(t,e)}))}else f.default.checkAuthFailure(t.statusCode,s)}stop(e){super.stop(e),this.persisted.azureMSUrls&&(this.persisted.azureMSUrls[this.amsUploadIndex]=void 0)}_telemetryInfo(e){return{step:Ne.AzureUploadCompleted,attributes:{success:e}}}}e.AzureDataStep=t}(Pe||(Pe={})),function(e){e.AmsGetStatusForwardTransferType="postingService_getStatusForward",e.AmsGetStatusForwardUploadTransferType="postingService_getStatusForwardUpload",e.AmsGetStatusServerTranscodingTransferType="postingService_getStatusServerTranscoding",e.parseBackgroundContextForForward=function(e){if(e.postId&&e.objectId)return{postId:e.postId,stepSelector:e.objectId}},e.parseBackgroundContextForUpload=function(e){if(e.postId&&e.convId)return{postId:e.postId,stepSelector:e.convId}},e.parseBackgroundContextForServerTranscoding=function(e){if(e.postId&&e.objectId)return{postId:e.postId,stepSelector:"0"}};class s extends Ge{_config(){return{needValidSkypeToken:!0,emptyResponse:!1,shimChatServiceResponse:!1,canBlockOthersInConv:!1}}transfer(){return this.persisted.amsGetStatusBackgroundTransfers||(this.persisted.amsGetStatusBackgroundTransfers={}),this.persisted.amsGetStatusBackgroundTransfers[this.stepSelector]}_start(){const e=this.objectId();this.persisted.amsGetStatusBackgroundIds||(this.persisted.amsGetStatusBackgroundIds={}),this.persisted.amsGetStatusBackgroundIds[this.stepSelector]||(this.persisted.amsGetStatusBackgroundIds[this.stepSelector]=pe.default.newGuid()),this.persisted.amsGetStatusBackgroundTransfers||(this.persisted.amsGetStatusBackgroundTransfers={});const t=this.context(),s=this.getDownloadViewId(),i=Object.assign(Object.assign({},fe),{transactionId:this.persisted.transactionId,correlationId:this.persisted.amsGetStatusBackgroundIds[this.stepSelector]}),o=this.transfer(),n=f.default.getStatusBackground(this.stepType,t,e,s,i);this.persisted.amsGetStatusBackgroundTransfers[this.stepSelector]=this._createTrackedBackgroundTransfer(n,o)}_handleResponse(e,t,s){const i=s&&S.ASMClient.getTracingHeaders(s);G.log(Se,"AmsGetStatus completed: "+this.post.persisted.id+", for: "+this.stepSelector+", objectId: "+this.objectId()+", success: "+e+", amsStatusLocation: "+(e&&t.body?t.body.status_location:void 0)+", tracing:"+JSON.stringify(i)),e?(this.persisted.amsStatusLocations||(this.persisted.amsStatusLocations={}),this.persisted.amsStatusLocations[this.stepSelector]=t.body.status_location):f.default.checkAuthFailure(t.statusCode,s)}_makeExponentialTime(e,t){const s=m.default.getS4LCMCFeatures().retryPolicy.constantPollTime[t];return o.isNumber(s)?new h.ExponentialTime(s,this._getMaxTransferTime(e,t),0):super._makeExponentialTime(e,t)}stop(e){super.stop(e),this.persisted.amsStatusLocations&&delete this.persisted.amsStatusLocations[this.stepSelector]}}class i extends s{constructor(){super(...arguments),this.forwardMediaInfo=We.getForwardMessageMediaInfo(this.post.persisted.forwardMediaInfos,this.objectId())}static forPost(t,s,o){if(s.forwardMediaInfos&&s.forwardMediaInfos.length>0)return new i(t,s,e.AmsGetStatusForwardTransferType,o.objectId)}objectId(){return this.stepSelector}getDownloadViewId(){return this.forwardMediaInfo.viewId||y.getDownloadViewId(this.forwardMediaInfo.fileType)}context(){return{postId:this.post.persisted.id,objectId:this.objectId()}}_telemetryInfo(e){return{step:Ne.AmsGotStatusForward,attributes:{success:e}}}}e.AmsGetStatusForwardStep=i;class n extends s{constructor(){super(...arguments),this.convId=this.stepSelector}static forPost(t,s,i){const{forwardConvIds:r}=$e(s.conversationIds);if(t.isUploadNeeded()&&o.includes(r,i))return new n(t,s,e.AmsGetStatusForwardUploadTransferType,i)}objectId(){return this.persisted.amsDocumentIds[0]}getDownloadViewId(){return y.getDownloadViewId(this.persisted.amsUploads[0].amsUploadFileType)}context(){return{postId:this.post.persisted.id,convId:this.convId}}_telemetryInfo(e){return{step:Ne.AmsGotStatusForwardUpload,attributes:{success:e}}}}e.AmsGetStatusForUploadStep=n;class r extends s{constructor(t,s,i,o,n,r){super(t,s,i,o),this.post=t,this.persisted=s,this.stepType=i,this.stepSelector=o,this._amsUploadIndex=n,this._convId=r,this.persisted.willUploadForServerTranscoding=!0;const a=m.default.getS4LCMCFeatures();this._expectedTimeToCompleteMs=a.serverVideoTranscoding.expectedTimeToCompleteMs,this._expectedTimeDisplayPercentage=a.serverVideoTranscoding.expectedTimeDisplayPercentage;const l=a.retryPolicy.maxTransferTime[e.AmsGetStatusServerTranscodingTransferType];this._timeoutMs=l||a.retryPolicy.maxPostElapsedTime}static isNeeded(e,t){const s=e.amsUploads&&e.amsUploads[t];return!(!m.default.getS4LCMCFeatures().serverVideoTranscoding.enabled||!s||s.amsUploadFileType!==re.UploadFileType.Video)||(G.log(Se,`No GetStatusServerTranscoding needed, file type ${s&&s.amsUploadFileType}`),!1)}static forPost(t,s,i){if(r.isNeeded(s,i)){const n=o.first(s.conversationIds);if(!n)return;const a=i.toString();return new r(t,s,e.AmsGetStatusServerTranscodingTransferType,a,i,n)}}objectId(){return this.persisted.amsDocumentIds&&this.persisted.amsDocumentIds[this._amsUploadIndex]||""}getDownloadViewId(){const e=this.persisted.amsUploads[this._amsUploadIndex];return y.getDownloadViewId(e.amsUploadFileType,re.MediaViewSize.Full)}context(){return{postId:this.post.persisted.id,objectId:this.objectId()}}_overrideSuccess(e,t){return G.log(Se,`_overrideSuccess Got response ${t.body&&t.body.view_state}`),e&&t.body&&"in progress"!==t.body.view_state}_handleResponse(e,s,i){super._handleResponse(e,s,i);const n=s.body&&s.body.view_state,r={success:!1,finished:!1,progress:0};e?(this.persisted.amsStatusViewStates||(this.persisted.amsStatusViewStates={}),G.log(Se,`Got server view_state ${n} for ${this._convId}`),this.persisted.amsStatusViewStates[this._convId]=n,r.progress=1,r.finished=!0,r.success="ready"===n,"failed"===n&&(G.log(Se,"Server transcoding failed, updating message type"),this.persisted.amsUploads=o.map(this.persisted.amsUploads,((e,t)=>t===this._amsUploadIndex?Object.assign(Object.assign({},e),{amsUploadFileType:re.UploadFileType.File}):e)),We.updateMessageUrls(this.post,this.objectId(),void 0),o.each(this.post.persisted.messagesForPosting,((e,t)=>{T.default.applyMessageLie(t,e)})))):n&&"in progress"!==n||(r.progress=this._calculateProgress(),G.log(Se,`ServerTranscoding Progress: ${r.progress}`)),t.serverTranscodingProgress.fire(this.post.persisted.id,this._amsUploadIndex,r)}_telemetryInfo(e){return{step:Ne.AmsGotStatusServerTranscoding,attributes:{success:e}}}_calculateProgress(){if(!this.persisted.totalElapsedTime)return 0;G.log(Se,`Calculating progress after ${this.persisted.totalElapsedTime} ms`);const e=o.clamp(this.persisted.totalElapsedTime,0,this._timeoutMs),t=this._expectedTimeDisplayPercentage;if(e<this._expectedTimeToCompleteMs){return e/this._expectedTimeToCompleteMs*t}return t+(e-this._expectedTimeToCompleteMs)/Math.max(0,this._timeoutMs-this._expectedTimeToCompleteMs)*(1-t)}}e.AmsGetStatusForServerTranscodingStep=r}(ke||(ke={})),function(e){e.AmsForwardContentTransferType="postingService_amsForward",e.AmsForwardContentUploadTransferType="postingService_amsForwardUpload",e.parseBackgroundContextForForward=function(e){if(e.postId&&e.objectId)return{postId:e.postId,stepSelector:e.objectId}},e.parseBackgroundContextForUpload=function(e){if(e.postId&&e.convId)return{postId:e.postId,stepSelector:e.convId}};class t extends Ge{_config(){return{needValidSkypeToken:!0,emptyResponse:!1,shimChatServiceResponse:!1,canBlockOthersInConv:!1}}transfer(){return this.persisted.amsForwardBackgroundTransfers||(this.persisted.amsForwardBackgroundTransfers={}),this.persisted.amsForwardBackgroundTransfers[this.stepSelector]}_start(){const e=this.objectId();this.persisted.amsForwardBackgroundIds||(this.persisted.amsForwardBackgroundIds={}),this.persisted.amsForwardBackgroundIds[this.stepSelector]||(this.persisted.amsForwardBackgroundIds[this.stepSelector]=pe.default.newGuid()),this.persisted.amsForwardBackgroundTransfers||(this.persisted.amsForwardBackgroundTransfers={});const t=this.context(),s=Object.assign(Object.assign({},fe),{transactionId:this.persisted.transactionId,correlationId:this.persisted.amsForwardBackgroundIds[this.stepSelector]}),i=this.persisted.amsStatusLocations[this.stepSelector],o=this.transfer(),n=f.default.forwardMediaBackground(this.stepType,t,i,[this.convId],e,s);this.persisted.amsForwardBackgroundTransfers[this.stepSelector]=this._createTrackedBackgroundTransfer(n,o)}_handleResponse(e,t,s){const i=s&&S.ASMClient.getTracingHeaders(s);if(G.log(Se,"AmsForwardDocument completed: "+this.post.persisted.id+", for: "+this.stepSelector+", objectId: "+this.objectId()+", success: "+e+", Document ID: "+(e&&t.body?t.body.id:void 0)+", tracing:"+JSON.stringify(i)),e){this.persisted.amsForwardDocumentIds||(this.persisted.amsForwardDocumentIds={});const e=t.body.id;this.persisted.amsForwardDocumentIds[this.stepSelector]=e,We.updateMessageUrls(this.post,this.persisted.amsForwardDocumentIds[this.stepSelector],void 0,this.objectId(),this.convId)}else f.default.checkAuthFailure(t.statusCode,s)}stop(e){super.stop(e),this.persisted.amsForwardDocumentIds&&delete this.persisted.amsForwardDocumentIds[this.stepSelector]}}class s extends t{constructor(){super(...arguments),this.convId=this.post.persisted.conversationIds[0]}static forPost(t,i,o){if(i.forwardMediaInfos&&i.forwardMediaInfos.length>0)return new s(t,i,e.AmsForwardContentTransferType,o.objectId)}objectId(){return this.stepSelector}context(){return{postId:this.post.persisted.id,objectId:this.objectId()}}_handleResponse(e,t,s){super._handleResponse(e,t,s),e&&(ze.updateAmsForwardObjectsReferences(this.post),o.each(this.post.persisted.messagesForPosting,((e,t)=>{T.default.applyMessageLie(t,e)})))}_telemetryInfo(e){return{step:Ne.Forwarded,attributes:{success:e}}}}e.AmsForwardContentStep=s;class i extends t{constructor(){super(...arguments),this.convId=this.stepSelector}static forPost(t,s,n){const{forwardConvIds:r}=$e(s.conversationIds);if(t.isUploadNeeded()&&o.includes(r,n))return new i(t,s,e.AmsForwardContentUploadTransferType,n)}objectId(){return this.persisted.amsDocumentIds[0]}context(){return{postId:this.post.persisted.id,convId:this.convId}}_handleResponse(e,t,s){super._handleResponse(e,t,s),e&&(ze.updateAmsForwardUploadReferences(this.post,this.convId),T.default.applyMessageLie(this.convId,this.post.persisted.messagesForPosting[this.convId]))}_telemetryInfo(e){return{step:Ne.ForwardedUpload,attributes:{success:e}}}}e.AmsForwardContentForUploadStep=i}(Ae||(Ae={})),function(e){e.UrlPreviewsTransferType="postingService_urlPreviewFetching",e.parseBackgroundContext=function(e){if(e.postId&&e.endpoint)return{postId:e.postId,stepSelector:e.endpoint}};class t extends Ge{constructor(){super(...arguments),this.endpoint=this.stepSelector}static forPost(s,i,o){if(i.urlPreviewEndpoints&&i.urlPreviewEndpoints.length>0)return new t(s,i,e.UrlPreviewsTransferType,o)}_config(){return{needValidSkypeToken:!0,emptyResponse:!1,shimChatServiceResponse:!1,canBlockOthersInConv:!1}}transfer(){return this.persisted.urlPreviewBackgroundTransfer||(this.persisted.urlPreviewBackgroundTransfer={}),this.persisted.urlPreviewBackgroundTransfer[this.endpoint]}_start(){this.persisted.urlPreviewBackgroundId||(this.persisted.urlPreviewBackgroundId={}),this.persisted.urlPreviewBackgroundId[this.endpoint]||(this.persisted.urlPreviewBackgroundId[this.endpoint]=pe.default.newGuid()),this.persisted.urlPreviewBackgroundTransfer||(this.persisted.urlPreviewBackgroundTransfer={}),o.each(this.post.telemetryScenarios,(e=>{const t="UrlPreviewFetchingStarted";e.isStepMarked(t)||e.markStepCompleted(t)}));const e=Object.assign(Object.assign({},fe),{timeout:void 0,transactionId:this.persisted.transactionId,correlationId:this.persisted.urlPreviewBackgroundId[this.endpoint]}),t={postId:this.post.persisted.id,endpoint:this.endpoint};this._requestStartTimes||(this._requestStartTimes={});const s=this.transfer(),i=Date.now(),n=ce.default.getUrlInfoBackground(this.stepType,t,this.endpoint,e);this._requestStartTimes[n]=i,this.persisted.urlPreviewBackgroundTransfer[this.endpoint]=this._createTrackedBackgroundTransfer(n,s)}_handleResponse(e,t,s){const n=s&&S.ASMClient.getTracingHeaders(s);G.log(Se,"UrlPreviewFetching completed: "+this.post.persisted.id+", endpoint: "+i.pii.Omit(this.endpoint)+", success: "+e+", url:"+(e&&t.body?i.pii.Omit(t.body.url):void 0)+", tracing:"+JSON.stringify(n));const r=this.transfer(),a=r.finishedAttemptsSoFarCount;e?o.each(this.post.persisted.messagesForPosting,((e,s)=>{this._updateMessagePropertiesWithUrlPreviewMetadata(s,e,{key:t.body.url,value:t.body});const i=this.post.telemetryScenarios&&this.post.telemetryScenarios[s];let o;this._requestStartTimes&&void 0!==r.id&&(o=Date.now()-this._requestStartTimes[r.id]);const n=new he.UrlPreviewReceived(t.url,t.body,a-1,o);G.track(n);const l="UrlPreviewFetchingFinished";i&&!i.isStepMarked(l)&&i.markStepCompleted(l)})):this._getRetryInfo(this.post.persisted.id,this.stepType)&&o.each(this.post.persisted.messagesForPosting,((e,s)=>{const i=t.errorInfo||"Unknown",o=new he.UrlPreviewFailed(t.url,a,i);G.track(o)}))}_updateMessagePropertiesWithUrlPreviewMetadata(e,t,s){const n=this.post.persisted.urlPreviewPropSet;let r=o.cloneDeep(t);r.properties||(r.properties={});const a=M.MessageProperties.UrlPreviews,l=n?{[a]:n.urlPreviewJson}:r.properties;let d=M.getJsonFromMessageProperty(l,a);s&&(d?d.push(s):d=[s]);const c=JSON.stringify(d);if(G.log(Se,"Updating message properties with URLP metadata: "+this.post.persisted.id+(s&&s.value?", Initializing with:"+i.pii.Omit(JSON.stringify(s.value)):", Initializing with no data")),n){n.urlPreviewJson=c;const s=P.getCuidForMessage(t);T.default.setMessagePropertyLie(e,s,a,c)}else{r.properties[M.MessageProperties.UrlPreviews]=c;const t=r;this.post.persisted.messagesForPosting[e]=t,T.default.applyMessageLie(e,t)}}stop(e){super.stop(e)}_telemetryInfo(e){}}e.UrlPreviewsStep=t}(Ee||(Ee={})),function(e){e.EncryptionStepType="postingService_encryptPost";class s{constructor(t,s,i){this.post=t,this.persisted=s,this.convId=i,this.stepType=e.EncryptionStepType,this.stepSelector=this.convId}static forPost(e,t,i){return P.isEncryptedThread(i)?new s(e,t,i):void 0}checkForUpdate(){this.persisted.encryptionStatus||(this.persisted.encryptionStatus={}),this.persisted.encryptionStatus[this.convId]||(this.persisted.encryptionStatus[this.convId]=_e.NotStarted);const e=this.persisted.encryptionStatus[this.convId];switch(e){case _e.Success:return He.Finished;case _e.NotStarted:return He.NeedTo.startSteps(this);case _e.InProgress:return He.NeedTo.waitForProgress(this);case _e.Failure:return He.NeedTo.giveUpBecauseStep(this,E.FailureReason.Permanent);default:return pe.default.switchStatementExhaustiveChecking(e)}}start(){this.persisted.encryptionStatus||(this.persisted.encryptionStatus={}),this.persisted.encryptionStatus[this.convId]||(this.persisted.encryptionStatus[this.convId]=_e.NotStarted);const e=this.convId;this.persisted.encryptionStatus[this.convId]=_e.InProgress,this._encryptPromise=T.default.getConversationMetaAsync(e).then((t=>{if(!t)return p.Rejected();const s=this.post.persisted.messagesForPosting[e];if(!s)return p.Rejected(`Can't find message for posting in conversation ${e}`);const i=this._mapToEncryptedType(s.messagetype);let o;if(i===M.MessageTypes.EncryptedMedia){const t=this.persisted.amsUploadEncryptionKey64,i=this.persisted.amsUploadEncryptionIV64,n=this.persisted.amsUploadEncryptionAuthKey64,r=this.persisted.amsUploadEncryptionHMAC64,a=this.persisted.amsUploadEncryptionHash64;if(!(t&&i&&n&&r&&a))return p.Rejected("Missing key material for encrypted media");const l={originalContent:s.content,fileKey64:t,fileIv64:i,fileAuthKey64:n,fileHMAC64:r,fileHash64:a};o=JSON.stringify(l),this._updateMessageWithFileKeys(e,this.post.persisted.messagesForPosting[e],{fileKey64:t,fileIv64:i,fileAuthKey64:n,fileHMAC64:r,fileHash64:a})}else o=s.content;return F.default.encryptMessageForConv(t.conv,o).then((t=>{const o=Object.assign(Object.assign({},s),{content:t.ciphertext,messagetype:i,fromdeviceid:D.default.getDeviceId(),encryptedkey:t.keys});this.post.persisted.messagesForPosting[e]=o,this.persisted.encryptionStatus[this.convId]=_e.Success}))})).catch((t=>{this.persisted.encryptionStatus[this.convId]=_e.Failure,G.error(Se,`Failed to encrypt post ${this.post.persisted.id} for conversation ${i.pii.Mri(e)}`,oe.default.errorAsString(t)),G.track(new O.E2eeEncryptionFailure(t.toString())),x.default.sendReject(e,V.E2EERejectionReason.EncryptionFailed)})).finally((()=>{t.pokePost.fire(this.post.persisted.id)}))}stop(e){this._encryptPromise&&(this._encryptPromise.cancel(),this._encryptPromise=void 0),e&&this.persisted.encryptionStatus&&(this.persisted.encryptionStatus[this.convId]=_e.NotStarted)}cleanup(){this.stop(!1)}_updateMessageWithFileKeys(e,t,s){const i=P.getCuidForMessage(t);T.default.setFileEncryptionKeys(e,i,s)}_mapToEncryptedType(e){switch(e){case M.MessageTypes.Media_GenericFile:case M.MessageTypes.UriObject:return M.MessageTypes.EncryptedMedia;case M.MessageTypes.Call:return M.MessageTypes.EncryptedCall;default:return M.MessageTypes.EncryptedText}}}e.EncryptMessageStep=s}(Re||(Re={})),function(e){e.UpdateMediaTypeStepType="postingService_updateMediaType";class s{constructor(t,s,i){this.post=t,this.persisted=s,this.convId=i,this.stepType=e.UpdateMediaTypeStepType,this.stepSelector=this.convId}static forPost(e,t,i){if(function(e,t){return!!e.willUploadForServerTranscoding}(t))return new s(e,t,i)}checkForUpdate(){this.persisted.updateStatus||(this.persisted.updateStatus={}),this.persisted.updateStatus[this.convId]||(this.persisted.updateStatus[this.convId]=Ce.NotStarted);const e=this.persisted.updateStatus[this.convId];switch(e){case Ce.Success:return He.Finished;case Ce.NotStarted:return He.NeedTo.startSteps(this);case Ce.InProgress:return He.NeedTo.waitForProgress(this);case Ce.Failure:return He.NeedTo.giveUpBecauseStep(this,E.FailureReason.Permanent);default:return pe.default.switchStatementExhaustiveChecking(e)}}start(){this.persisted.updateStatus||(this.persisted.updateStatus={}),this.persisted.updateStatus[this.convId]||(this.persisted.updateStatus[this.convId]=Ce.NotStarted),this.persisted.updateStatus[this.convId]=Ce.InProgress,G.log(Se,`Started UpdateMediaTypeStep for ${this.convId}`);const e=this.post.persisted.messagesForPosting[this.convId];if(!e)return G.error(Se,`Can't find message for posting in conversation ${this.convId}`),void(this.persisted.updateStatus[this.convId]=Ce.Failure);if(!this.persisted.amsStatusViewStates||!this.persisted.amsStatusViewStates[this.convId])return G.error(Se,`Can't find view state from server transcoding ${this.convId}`),void(this.persisted.updateStatus[this.convId]=Ce.Failure);let s=e.messagetype;"failed"===this.persisted.amsStatusViewStates[this.convId]&&(G.log(Se,`Server transcoding failed for ${this.convId}`),s=M.MessageTypes.Media_GenericFile);const i=Object.assign(Object.assign({},e),{messagetype:s});this.post.persisted.messagesForPosting[this.convId]=i,this.persisted.updateStatus[this.convId]=Ce.Success,t.pokePost.fire(this.post.persisted.id)}stop(e){e&&this.persisted.updateStatus&&(this.persisted.updateStatus[this.convId]=Ce.NotStarted)}cleanup(){this.stop(!1)}}e.UpdateMediaTypeStep=s}(Le||(Le={})),function(e){e.FileEncryptionStepType="postingService_encryptFile";class s{constructor(t,s){this.post=t,this.persisted=s,this.stepType=e.FileEncryptionStepType,this.persisted.fileEncryptionStatus=_e.NotStarted}static forPost(e,t){return P.isEncryptedThread(t.conversationIds[0])&&t.amsUploads&&t.amsUploads[0]?new s(e,t):void 0}getAmsUpload(){return this.persisted.amsUploads[0]}checkForUpdate(){const e=this.persisted.fileEncryptionStatus;switch(e){case _e.Success:return He.Finished;case _e.NotStarted:return He.NeedTo.startSteps(this);case _e.InProgress:return He.NeedTo.waitForProgress(this);case _e.Failure:return He.NeedTo.giveUpBecauseStep(this,E.FailureReason.Permanent);default:return pe.default.switchStatementExhaustiveChecking(e)}}start(){this.persisted.fileEncryptionStatus=_e.InProgress;const e=this.getAmsUpload(),s=et(e.amsUploadFullData,e.amsFullDataLocalUrl).file,i=void 0===s.uri,n=i?s.path:s.uri,r=pe.default.newGuid()+".bin";this._encryptPromise=c.FileEncryption.getTempLocation(r).then((t=>{const a=new Uint8Array(l.getRandomValues(new Array(16))),d=new Uint8Array(l.getRandomValues(new Array(32))),h=new Uint8Array(l.getRandomValues(new Array(32))),u=o.toArray(d),p=o.toArray(a),g=o.toArray(h);let m;const S=Date.now();return(i?B.encryptFileInMemory(s,"aes-cbc",a,d,h).then((e=>(m=e.validation,new File([e.blob],r)))):c.FileEncryption.encryptFile(n,t,c.FileEncryption.getDefaultAlgo(),p,u,g).then((s=>(m=s,Object.assign(Object.assign({},e.amsUploadFullData.file),{name:r,type:"blob",uri:t}))))).then((e=>{G.log(Se,`File encryption took ${Date.now()-S}ms`),this.persisted.amsUploads=o.map(this.persisted.amsUploads,((s,i)=>0===i?tt(s,t,{file:e,extension:"bin"},r,re.UploadFileType.File):s)),this.persisted.amsUploadEncryptionKey64=L.byteArrayToBase64String(u),this.persisted.amsUploadEncryptionIV64=L.byteArrayToBase64String(p),this.persisted.amsUploadEncryptionAuthKey64=L.byteArrayToBase64String(g),this.persisted.amsUploadEncryptionHMAC64=L.byteArrayToBase64String(m.hmac),this.persisted.amsUploadEncryptionHash64=L.byteArrayToBase64String(m.hash),this.persisted.fileEncryptionStatus=_e.Success}))})).catch((e=>{this.persisted.fileEncryptionStatus=_e.Failure,G.error(Se,`Failed to encrypt file for post ${this.post.persisted.id}`,oe.default.errorAsString(e)),G.track(new O.E2eeEncryptionFailure(e.toString()))})).finally((()=>{t.pokePost.fire(this.post.persisted.id)}))}stop(e){this._encryptPromise&&(this._encryptPromise.cancel(),this._encryptPromise=void 0),e&&(this.persisted.fileEncryptionStatus=_e.NotStarted)}cleanup(){this.stop(!1)}}e.EncryptFileStep=s}(Fe||(Fe={})),function(e){e.VideoTranscodingStepType="postingService_transcodeVideo";class s{constructor(t,s){this.post=t,this.persisted=s,this.stepType=e.VideoTranscodingStepType,this._onReencodingProgressUpdate=(e,t)=>{this.persisted.transcodingSessionId===e&&(this.persisted.estimatedVideoUploadSize=t.estimatedSize,t.type===n.ReencodeProgressType.Fetch&&t.progress>0&&t.progress<1&&(this.persisted.wasFetchedFromiCloud=!0))},this.persisted.transcodingStatus&&this.persisted.transcodingStatus===ve.Success||(this.persisted.transcodingStatus=ve.NotStarted)}static forPost(e,t){const i=t.amsUploads&&t.amsUploads[0];return i&&me.default.shouldReencodeUpload(i.amsUploadFileType,i.videoOverlayUrl)?new s(e,t):void 0}getAmsUpload(){return this.persisted.amsUploads[0]}setAmsUpload(e){this.persisted.amsUploads[0]=e}checkForUpdate(){const e=this.persisted.transcodingStatus;switch(e){case void 0:case ve.Success:return He.Finished;case ve.NotStarted:return He.NeedTo.startSteps(this);case ve.InProgress:return He.NeedTo.waitForProgress(this);case ve.Failure:return He.NeedTo.giveUpBecauseStep(this,E.FailureReason.Permanent);default:return pe.default.switchStatementExhaustiveChecking(e)}}start(){const e=pe.default.newCauseId();G.log(Se,"TranscodeVideoStep.start causeId:",e),this.persisted.transcodingStatus=ve.InProgress;const s=this.getAmsUpload();if(me.default.shouldReencodeUpload(s.amsUploadFileType,s.videoOverlayUrl)){this._reencodeProgressSubscription=ge.videoManipulationProgressChangedEvent.subscribe(this._onReencodingProgressUpdate);let i=new Q.ReencodeSession;i.setTransactionID(this.persisted.transactionId),i.setVideoDuration(this.persisted.videoDuration||0),s.amsUploadFullData.dimensions&&i.setSourceDimensions(s.amsUploadFullData.dimensions),i.setSourceFileSize(s.amsUploadFullData.file.size||0),i.setHasOverlay(!!s.videoOverlayUrl);const r=et(s.amsUploadFullData,s.amsFullDataLocalUrl).file,a=void 0===r.uri?r.path:r.uri,l=s.videoOverlayUrl||a,d=me.default.reencodeOptions(),c=ge.default.saveVideoWithoutView(a,l,d,e,i);this.persisted.transcodingSessionId=c.sessionId,c.manipulationPromise.then((t=>{t.sourceFileSize!==t.fileSize?(G.log(Se,`TranscodeVideoStep.start reencodeVideo success causeId: ${e}`),o.each(this.post.telemetryScenarios,(e=>{t.scenarioAttributes&&e.extendProperties(t.scenarioAttributes)}))):G.log(Se,"TranscodeVideoStep.start encoding looked like a noop");const i=Object.assign(Object.assign({},s.amsUploadFullData),{file:Object.assign(Object.assign({},s.amsUploadFullData.file),{uri:t.uri,size:t.fileSize}),dimensions:t.width&&t.height?{width:t.width,height:t.height}:void 0}),n=t.thumbnailUri?{file:{uri:t.thumbnailUri,name:H.default.extractFileName(s.amsUploadFilename)+"-thumbnail.jpg",size:void 0,type:"image/jpg"},extension:"jpg",dimensions:t.width&&t.height?{width:t.width,height:t.height}:void 0}:void 0;this.setAmsUpload(tt(s,t.uri,i,void 0,void 0,t.thumbnailUri,n)),this.persisted.transcodingStatus=ve.Success})).catch((t=>(G.warn(Se,oe.default.errorAsString(t)),G.log(Se,`TranscodeVideoStep.start error causeId: ${e}`),t&&t.code===n.ReencodeErrorType.TooLargeFile&&!o.isUndefined(d.maxFileSize)?(R.default.alertSizeTooBig(d.maxFileSize,s.amsUploadFullData.file.size||0,this.persisted.instrumentation_postSource,s.amsUploadFileType,!0),this.persisted.transcodingStatus=ve.Failure,p.Resolved()):this._handleSkippedOrFailedTranscoding(s)))).finally((()=>{this._reencodeProgressSubscription&&this._reencodeProgressSubscription.unsubscribe(),G.log(Se,"TranscodeVideoStep success ",this.post.persisted.id),t.pokePost.fire(this.post.persisted.id)}))}else G.log(Se,"TranscodeVideoStep.start skipped reencoding"),this._handleSkippedOrFailedTranscoding(s).finally((()=>{t.pokePost.fire(this.post.persisted.id)}));t.pokePost.fire(this.post.persisted.id)}stop(e){this.persisted.transcodingStatus===ve.InProgress&&this.persisted.transcodingSessionId&&ge.default.cancelSession(this.persisted.transcodingSessionId),this._reencodeProgressSubscription&&this._reencodeProgressSubscription.unsubscribe(),e&&(this.persisted.transcodingStatus=ve.NotStarted)}cleanup(){this.stop(!1)}_handleSkippedOrFailedTranscoding(e){const t=U.default.getMaximumFileSizeForType(e.amsUploadFileType);return e.amsUploadFullData.file.size&&e.amsUploadFullData.file.size>t?(R.default.alertSizeTooBig(t,e.amsUploadFullData.file.size,this.persisted.instrumentation_postSource,e.amsUploadFileType,!0),G.warn(Se,"TranscodeVideoStep failing post because the file exceeds max size"),this.persisted.transcodingStatus=ve.Failure,p.Resolved()):(this.persisted.transcodingStatus=ve.Success,p.Resolved())}}e.TranscodeVideoStep=s}(xe||(xe={})),function(e){function t(e){return{needValidSkypeToken:!0,emptyResponse:!0,shimChatServiceResponse:!0,canBlockOthersInConv:!0,convId:e}}function s(e,t,s){return He.stepsToStartMightBeBlocked(t,(t=>{const o=t;if(o.stepType!==e.stepType)return!1;const r=o.post.findAnythingBlockingPost(o.post,o.convId);if(r){const t=function(e,t,s,o){const n=o.persisted.messagesForPosting[t]&&o.persisted.messagesForPosting[t].clientmessageid;return"Waiting to "+e+": "+s.persisted.id+", ConvId: "+i.pii.Mri(t)+", CMID: "+s.persisted.messagesForPosting[t].clientmessageid+", postTime: "+s.persisted.postTime+", blocked because post: "+o.persisted.id+", for CMID: "+n}(s,e.convId,e.post,r);G.log(Se,t)}const a=n(o.persisted,e.convId);if(r)void 0===a.lastBlockedStartTime&&(a.lastBlockedStartTime=Date.now());else if(void 0!==a.lastBlockedStartTime){const e=Date.now()-a.lastBlockedStartTime;a.totalBlockedTime=(a.totalBlockedTime||0)+e,a.lastBlockedStartTime=void 0}return!!r}))}function n(e,t){return e.messageSendingInfos||(e.messageSendingInfos={}),e.messageSendingInfos[t]||(e.messageSendingInfos[t]={}),e.messageSendingInfos[t]}function r(e){if(e.headers.location)return o.last(e.headers.location.split("/"))}function a(e,t,s,n,r,a,l,d){if(G.log(Se,t+" completed: "+e.post.persisted.id+", ConvId: "+i.pii.Mri(e.convId)+", success: "+a+", statustext: "+l.statusText+", from "+Je(e)),a){const{contextId:t,date:i}=P.getTcidDataFromServerMessageResponse(l);!function(e,t,s,i,n,r,a,l,d){const c=e.persisted.messagesForPosting[s],h=P.getCuidForMessage(c),u=Date.now();p.all([k.default.getMessageByCuid(s,h),T.default.getConversationMetaAsync(s)]).then((([p,S])=>{if(n){if(T.default.confirmMessageSend(s,h,n,c.clientmessageid,r),!t.isForward&&!c.skypeeditedid&&m.default.getConfigSettingsNoSubscription().chat.forceChSetOnSend){const e=P.getCHIDForMessage(c),t=P.getConsumptionHorizonForMessageAndCHID(n,e);C.default.setConsumptionHorizon(s,t,!1)}if(!t.isForward&&!t.isDelete){const e=P.getCuidForMessage(c);$.default.maybeRequestTranslation(s,e,c)}}else G.warn(Se,"Was not given server ID for successfully posted message");const f=S?S.conv.getMemberCount():1;if(p&&p.isDeletedMessage())G.track(new X.MessageActionTelemetry(s,c,p.createdTime,X.MessageActionOrigin.PostingService,X.MessageActionType.Delete));else if(p&&p.isEdited())G.track(new X.MessageActionTelemetry(s,c,p.createdTime,X.MessageActionOrigin.PostingService,X.MessageActionType.Edit));else{let o=t.transmitStartTime,r=0,h=V.ChatServiceConnectionType.Unknown;t.messageSendingInfos&&t.messageSendingInfos[s]&&(o=t.messageSendingInfos[s].transmitStartTime,r=t.messageSendingInfos[s].totalBlockedTime||0,h=t.messageSendingInfos[s].connectionType||P.getConnectionTypeFromUrl(d));const p=e.persisted.postTime,m=o?o-p:0,S=o?u-o:u-p,y=i-1,_=se.default.getEndpointInfo();G.track(new K.KpiMessageSent(s,c,f,m,r,S,y,t.rawContentLength,ie.default.EdfRegistrationId.get(),_,a,l,n,te.default.isInCall(),g.default.getBackgroundTime(p,u),g.default.hasAppStart(p,u),h,g.default.getPostingTrigger()))}p&&t.quoteAuthor&&!o.isUndefined(t.quotesTriggerType)&&G.track(new X.QuotesEventTelemetry(s,p,p.createdTime,X.MessageActionOrigin.PostingService,X.MessageActionType.Quote,t.quotesTriggerType))}))}(e.post,e.persisted,e.convId,s,n,r,t,i,l.url)}}function l(e){const t=function(e){if(404===e.statusCode&&e.headers&&e.headers.location)return!1;if(403===e.statusCode){const t=e.statusText||e.headers.statustext,s=t&&t.toLowerCase();if(!s||-1===s.indexOf("registration"))return!0}else if(Ze(e)===P.ChatServiceErrors.UserInAnotherCloud)return!1;return}(e);if(void 0!==t)return t;const s=Ze(e);return s===P.ChatServiceErrors.AccessDenied||s===P.ChatServiceErrors.InitiatorNotPartOfThread||s===P.ChatServiceErrors.ThreadNotFound||(404!==e.statusCode||s!==P.ChatServiceErrors.EndpointMissing)&&void 0}function d(e,t){return{step:Ne.MessagePosted,conversationIds:[t],attributes:{success:e}}}e.ChatPostTransferType="postingService_postChatMessage",e.ChatPostForegroundStepType="postingService_postChatMessageForeground",e.ActionNames={post:"PostChatMessage",edit:"EditChatMessage",delete:"DeleteChatMessage"},e.parseBackgroundContext=function(e){if(e.postId&&e.convId)return{postId:e.postId,stepSelector:e.convId}};class c extends Ke{constructor(){super(...arguments),this.convId=this.stepSelector,this.mightUnblockOthersInConv=this.convId}static forPost(t,s,i){if(Qe(!1)){if(qe(i,s.messagesForPosting[i])){if(s.isDelete)return new S(t,s,e.ChatPostForegroundStepType,i);if(s.editedMessageServerId)return new u(t,s,e.ChatPostForegroundStepType,i)}return new h(t,s,e.ChatPostForegroundStepType,i)}}checkForUpdate(){return s(this,super.checkForUpdate(),this._actionName)}_config(){return t(this.convId)}_status(e){return e&&(this.persisted.messageForegroundRequests||(this.persisted.messageForegroundRequests={}),this.persisted.messageForegroundRequests[this.convId]||(this.persisted.messageForegroundRequests[this.convId]={finished:!1,finishedSuccess:!1})),this.persisted.messageForegroundRequests&&this.persisted.messageForegroundRequests[this.convId]}_startForegroundRequestOrFinish(){if(!Xe())return;G.log(Se,this._actionName+": "+this.post.persisted.id+", ConvId: "+i.pii.Mri(this.convId)+", CMID: "+this.post.persisted.messagesForPosting[this.convId].clientmessageid+", in foreground");const e=this._createChatServiceReq(),t=n(this.persisted,this.convId);return t.scenario=e.scenario,t.transmitStartTime=Date.now(),C.default.performPostingServiceMessageRequest(e,w.PostMessageToConversationSource.MessagePost)}_handleResponse(e,t,s){if(e){n(this.persisted,this.convId).connectionType=P.getConnectionTypeFromUrl(t.url)}a(this,this._actionName,1,e?this._getMessageServerId(t):void 0,e?this._getMessageServerVersion(t):void 0,e,t)}_telemetryInfo(e){return d(e,this.convId)}_isPermanentFailure(e,t){const s=l(t);return void 0!==s?s:super._isPermanentFailure(e,t)}stop(e){super.stop(e)}}e.ChatPostForegroundStep=c;class h extends c{constructor(){super(...arguments),this._actionName=e.ActionNames.post}_createChatServiceReq(){const e=this.post.persisted.messagesForPosting[this.convId];return I.postMessageToConversation(this.convId,e)}_getMessageServerId(e){return r(e)}_getMessageServerVersion(e){return this._getMessageServerId(e)}}e.ChatPostCreateForegroundStep=h;class u extends c{constructor(){super(...arguments),this._actionName=e.ActionNames.edit}_createChatServiceReq(){const e=this.post.persisted.messagesForPosting[this.convId];return I.editMessage(this.convId,this.persisted.editedMessageServerId,e.messagetype,e.content)}_getMessageServerId(e){return this.persisted.editedMessageServerId}_getMessageServerVersion(e){return e.body?e.body.edittime:void 0}}e.ChatEditForegroundStep=u;class S extends c{constructor(){super(...arguments),this._actionName=e.ActionNames.delete}_createChatServiceReq(){return I.deleteMessage(this.convId,this.persisted.editedMessageServerId)}_getMessageServerId(e){return this.persisted.editedMessageServerId}_getMessageServerVersion(e){return e.body?e.body.deletetime:void 0}}e.ChatDeleteForegroundStep=S;class f extends Ge{constructor(){super(...arguments),this.convId=this.stepSelector}static forPost(t,s,i){if(qe(i,s.messagesForPosting[i])){if(s.isDelete)return new v(t,s,e.ChatPostTransferType,i);if(s.editedMessageServerId)return new _(t,s,e.ChatPostTransferType,i)}return new y(t,s,e.ChatPostTransferType,i)}_config(){return t(this.convId)}transfer(){return this.persisted.messageBackgroundTransfers||(this.persisted.messageBackgroundTransfers={}),this.persisted.messageBackgroundTransfers[this.convId]}checkForUpdate(){if(this.persisted.messageForegroundRequests&&this.persisted.messageForegroundRequests[this.convId]&&this.persisted.messageForegroundRequests[this.convId].finishedSuccess)return He.Finished;return s(this,super.checkForUpdate(),this._actionName)}_start(){this.persisted.messageBackgroundTransfers||(this.persisted.messageBackgroundTransfers={});const e=this.post.persisted.messagesForPosting[this.convId];G.log(Se,"Posting Message: "+this.post.persisted.id+", ConvId: "+i.pii.Mri(this.convId)+", CMID: "+this.post.persisted.messagesForPosting[this.convId].clientmessageid+", in background");const t=this.transfer(),s=this._createChatServiceReq(e),o=n(this.persisted,this.convId);o.scenario=s.scenario,o.transmitStartTime=Date.now();const r=C.default.performRequestBackground(this.stepType,{postId:this.post.persisted.id,convId:this.convId},s,fe);this.persisted.messageBackgroundTransfers[this.convId]=this._createTrackedBackgroundTransfer(r,t)}_handleResponse(e,t,s){const i=this.transfer().finishedAttemptsSoFarCount,o=e?this._getMessageServerId(t):void 0,n=e?this._getMessageServerVersion(t):void 0;if(a(this,this._actionName,i,o,n,e,t),!e){const e=this.persisted.messageSendingInfos&&this.persisted.messageSendingInfos[this.convId]&&this.persisted.messageSendingInfos[this.convId].scenario||"postMessageToConversation",i={source:w.PostMessageToConversationSource[w.PostMessageToConversationSource.MessagePost]},o=P.getConnectionTypeFromUrl(t.url),n=s&&C.default.errorHandler.getRegistrationTokenFromHeaders(s),r=s&&C.default.errorHandler.getSkypetokenFromHeaders(s);C.default.errorHandler.handleChatServiceFailure("PostingServicePostMessage",t,r,n,void 0,{scenario:e,telemetryAttributes:i},o)}}stop(e){super.stop(e)}_isPermanentFailure(e,t){const s=l(t);return void 0!==s?s:super._isPermanentFailure(e,t)}_telemetryInfo(e){return d(e,this.convId)}}e.ChatPostTransferStep=f;class y extends f{constructor(){super(...arguments),this._actionName=e.ActionNames.post}_createChatServiceReq(e){return I.postMessageToConversation(this.convId,e)}_getMessageServerId(e){return r(e)}_getMessageServerVersion(e){return this._getMessageServerId(e)}}e.ChatPostCreateTransferStep=y;class _ extends f{constructor(){super(...arguments),this._actionName=e.ActionNames.edit}_createChatServiceReq(e){return I.editMessage(this.convId,this.persisted.editedMessageServerId,e.messagetype,e.content)}_getMessageServerId(e){return this.persisted.editedMessageServerId}_getMessageServerVersion(e){return e.body?e.body.edittime:void 0}}e.ChatEditTransferStep=_;class v extends f{constructor(){super(...arguments),this._actionName=e.ActionNames.delete}_createChatServiceReq(e){return I.deleteMessage(this.convId,this.persisted.editedMessageServerId)}_getMessageServerId(e){return this.persisted.editedMessageServerId}_getMessageServerVersion(e){return e.body?e.body.deletetime:void 0}}e.ChatDeleteTransferStep=v}(Oe||(Oe={})),function(e){e.MessagePropSetTransferType="postingService_updateChatMessageProperties",e.parseBackgroundContext=function(e){if(e.postId&&e.convId)return{postId:e.postId,stepSelector:e.convId}};class t extends Ge{constructor(){super(...arguments),this.convId=this.stepSelector}static forPost(s,i,o){if(i.urlPreviewPropSet)return new t(s,i,e.MessagePropSetTransferType,o)}_config(){return{needValidSkypeToken:!0,emptyResponse:!0,shimChatServiceResponse:!0,canBlockOthersInConv:!1,convId:this.convId}}transfer(){return this.persisted.urlPreviewPropSetTransfers||(this.persisted.urlPreviewPropSetTransfers={}),this.persisted.urlPreviewPropSetTransfers[this.convId]}_start(){this.persisted.urlPreviewPropSetTransfers||(this.persisted.urlPreviewPropSetTransfers={});const e=this.post.persisted.urlPreviewPropSet,t=this.transfer(),s=C.default.serviceSetMessagePropertyBackground(this.stepType,{postId:this.post.persisted.id,convId:this.convId},this.convId,e.messageId,M.MessageProperties.UrlPreviews,e.urlPreviewJson,!e.urlPreviewJson,fe);this.persisted.urlPreviewPropSetTransfers[this.convId]=this._createTrackedBackgroundTransfer(s,t)}_handleResponse(e,t,s){if(G.log(Se,"UpdateChatMessageProperties completed: "+this.post.persisted.id+", ConvId: "+i.pii.Mri(this.convId)+", success: "+e+", statustext: "+t.statusText),!e){const e=P.getConnectionTypeFromUrl(t.url),i=s&&C.default.errorHandler.getRegistrationTokenFromHeaders(s),o=s&&C.default.errorHandler.getSkypetokenFromHeaders(s);C.default.errorHandler.handleChatServiceFailure("PostingServiceMessagePropSet",t,o,i,void 0,{scenario:"setMessageProperty"},e)}}stop(e){super.stop(e)}_telemetryInfo(e){}}e.MessagePropSetStep=t}(De||(De={})),function(e){e.feedbackGathered=new u.default,e.FeedbackStepType="postingService_feedbackGatherLogs";class t{constructor(t,s){this.post=t,this.persisted=s,this.stepType=e.FeedbackStepType,this.persisted.isCollectingFeedbackFiles=!1}static forPost(e,s){if(s.feedbackSendLogs||s.feedbackSendScreenshot)return new t(e,s)}checkForUpdate(){return this.persisted.feedbackUploadMetadata?He.Finished:this.persisted.isCollectingFeedbackFiles?He.NeedTo.waitForProgress(this):He.NeedTo.startSteps(this)}start(){this.persisted.isCollectingFeedbackFiles=!0;const e=[];let t;if(G.log(Se,"FeedbackHelper: attaching logs and/or screenshot"),r.default.supportsLogs()){const s=this._getScreenshotPathFromUri(this.persisted.feedbackScreenshotUri);t=r.default.zippedLogFileBundle(m.default.getDebugabilitySquad().brb_logs_history_secs,this.persisted.feedbackSendLogs,this.persisted.feedbackSendScreenshot,s).then((t=>{if(!t)return e;const s={file:t,extension:"blog"};return e.push({fileData:s,uploadSource:V.PostSource.Logs}),G.log(Se,"FeedbackHelper: Added Uri logs"),e}))}else t=p.Resolved([]);this._collectingFeedbackPromise=t,t.thenAsync((e=>{this._collectingFeedbackPromise===t&&this._handleResponse(e)}))}_getScreenshotPathFromUri(e){const t=ue.default.getURIComponents(e);return e&&t&&t.pathname?"/"+t.pathname.slice(0,-1):e}_handleResponse(t){this.persisted.feedbackUploadMetadata=t;const s=[];o.each(t,(e=>{if(e.fileData){const t=N.default.encodeSessionContextInFilename(e.fileData.file.name,this.persisted.feedbackSessionId,e.fileData.extension);s.push(R.default.createUploadInfo(this.post.persisted.conversationIds,e.fileData,e.uploadSource,{filename:t}))}else G.error(Se,"Incorrect fileMetadata object")})),e.feedbackGathered.fire(this.post.persisted.id,s)}stop(e){this.persisted.isCollectingFeedbackFiles=!1,this._collectingFeedbackPromise&&(this._collectingFeedbackPromise.cancel(),this._collectingFeedbackPromise=void 0)}cleanup(){this.stop(!1)}}e.FeedbackStep=t}(Be||(Be={})),t.feedbackGathered=Be.feedbackGathered,function(e){e.AmsCreateType=Me.AmsCreateTransferType,e.AmsCreateForegroundType=Me.AmsCreateForegroundStepType,e.AmsThumbnailType=Ie.AmsThumbnailTransferType,e.AmsThumbnailForegroundType=Ie.AmsThumbnailForegroundStepType,e.AmsFullDataType=we.AmsFullDataTransferType,e.AmsFullDataForegroundType=we.AmsFullDataForegroundStepType,e.AzureDataType=Pe.AzureDataTransferType,e.AmsGetStatusForwardType=ke.AmsGetStatusForwardTransferType,e.AmsGetStatusForwardUploadType=ke.AmsGetStatusForwardUploadTransferType,e.AmsGetStatusServerTranscodingType=ke.AmsGetStatusServerTranscodingTransferType,e.AmsForwardContentType=Ae.AmsForwardContentTransferType,e.AmsForwardContentUploadType=Ae.AmsForwardContentUploadTransferType,e.UrlPreviewsType=Ee.UrlPreviewsTransferType,e.EncryptMessageType=Re.EncryptionStepType,e.UpdateMediaTypeStepType=Le.UpdateMediaTypeStepType,e.FileEncryptionStepType=Fe.FileEncryptionStepType,e.VideoTranscodingStepType=xe.VideoTranscodingStepType,e.ChatPostType=Oe.ChatPostTransferType,e.ChatPostForegroundType=Oe.ChatPostForegroundStepType,e.MessagePropSetType=De.MessagePropSetTransferType,e.FeedbackType=Be.FeedbackStepType}(Ve||(Ve={})),t.AllBackgroundTransferTypes=[Ve.AmsCreateType,Ve.AmsThumbnailType,Ve.AmsFullDataType,Ve.AzureDataType,Ve.AmsGetStatusForwardType,Ve.AmsGetStatusForwardUploadType,Ve.AmsGetStatusServerTranscodingType,Ve.AmsForwardContentType,Ve.AmsForwardContentUploadType,Ve.UrlPreviewsType,Ve.ChatPostType,Ve.MessagePropSetType],t.AllForegroundTransferTypes=[Ve.AmsCreateForegroundType,Ve.AmsThumbnailForegroundType,Ve.AmsFullDataForegroundType,Ve.ChatPostForegroundType],t.ChatPostActionNames=Oe.ActionNames,t.TransferTypeToPostingTransferSource={[Ve.AmsCreateType]:V.PostingTransferSource.AMSCreate,[Ve.AmsCreateForegroundType]:V.PostingTransferSource.AMSCreate,[Ve.AmsThumbnailType]:V.PostingTransferSource.AMSUploadThumbnail,[Ve.AmsThumbnailForegroundType]:V.PostingTransferSource.AMSUploadThumbnail,[Ve.AmsFullDataType]:V.PostingTransferSource.AMSUploadContent,[Ve.AmsFullDataForegroundType]:V.PostingTransferSource.AMSUploadContent,[Ve.AzureDataType]:V.PostingTransferSource.Azure,[Ve.AmsGetStatusForwardType]:V.PostingTransferSource.AMSGetStatus,[Ve.AmsGetStatusForwardUploadType]:V.PostingTransferSource.AMSGetStatus,[Ve.AmsGetStatusServerTranscodingType]:V.PostingTransferSource.AMSGetStatus,[Ve.AmsForwardContentType]:V.PostingTransferSource.AMSForward,[Ve.AmsForwardContentUploadType]:V.PostingTransferSource.AMSForward,[Ve.UrlPreviewsType]:V.PostingTransferSource.URLPreview,[Ve.ChatPostType]:V.PostingTransferSource.ChatService,[Ve.ChatPostForegroundType]:V.PostingTransferSource.ChatService,[Ve.MessagePropSetType]:V.PostingTransferSource.ChatServiceUpdateProperties},function(e){e[e.GotPostFromPersistentStore=0]="GotPostFromPersistentStore",e[e.AmsDocumentCreated=1]="AmsDocumentCreated",e[e.AmsFullContentUploaded=2]="AmsFullContentUploaded",e[e.AmsThumbContentUploaded=3]="AmsThumbContentUploaded",e[e.AzureUploadCompleted=4]="AzureUploadCompleted",e[e.Forwarded=5]="Forwarded",e[e.ForwardedUpload=6]="ForwardedUpload",e[e.AmsGotStatusForward=7]="AmsGotStatusForward",e[e.AmsGotStatusForwardUpload=8]="AmsGotStatusForwardUpload",e[e.AmsGotStatusServerTranscoding=9]="AmsGotStatusServerTranscoding",e[e.MessagePosted=10]="MessagePosted",e[e.MessagePostingFailed=11]="MessagePostingFailed"}(Ne=t.PostMessageScenarioStep||(t.PostMessageScenarioStep={})),t.postIdFromContext=function(e){return o.isString(e)?e:e.postId},function(e){e[e.Finished=0]="Finished",e[e.InProgress=1]="InProgress",e[e.Blocked=2]="Blocked",e[e.Update=3]="Update",e[e.GiveUp=4]="GiveUp"}(Ue=t.CheckForNeededWorkResult||(t.CheckForNeededWorkResult={})),function(e){const t={kind:Ue.Finished};function s(...e){return{kind:Ue.Blocked,blocked:e}}function i(t,s){if(0===t.length)return e.Finished;return t.reduce(((e,t)=>{let i;e.kind===Ue.Finished?i=!0:t.kind===Ue.Finished?i=!1:e.kind===Ue.GiveUp?i=s:t.kind===Ue.GiveUp?i=!s:e.kind===Ue.InProgress?i=!0:t.kind===Ue.InProgress?i=!1:e.kind===Ue.Blocked?i=!0:t.kind===Ue.Blocked?i=!1:e.kind!==Ue.Update?(pe.default.switchStatementExhaustiveChecking(e.kind),i=!0):t.kind!==Ue.Update?(pe.default.switchStatementExhaustiveChecking(t.kind),i=!1):i=!1;return n(i?t:e,i?e:t)}))}function n(e,t){return Object.assign(Object.assign({},e),{inProgress:o.union(e.inProgress,t.inProgress),blocked:o.union(e.blocked,t.blocked),start:o.union(e.start,t.start),failure:o.union(e.failure,t.failure)})}e.Finished=t,e.NeedTo={waitForProgress:function(...e){return{kind:Ue.InProgress,inProgress:e}},waitBecauseBlocked:s,startSteps:function(...e){return{kind:Ue.Update,start:e}},giveUpBecauseStep:function(e,t){return{kind:Ue.GiveUp,failure:[{stepType:e.stepType,failureReason:t}]}}},e.stepsToStartMightBeBlocked=function(e,t){if(!e.start)return e;const[r,a]=o.partition(e.start,(e=>t(e)));if(0===r.length)return e;const l=Object.assign(Object.assign({},e),{start:a});return e.kind===Ue.Update&&0===a.length?n(s(...r),l):i([l,s(...r)],!1)},e.dontGiveUp=function(t){return t.kind===Ue.GiveUp?n(e.Finished,t):t},e.findWorkWithLowPriorityFinished=function(t){let s;return o.each(t,(e=>(s=e.checkForUpdate(),s.kind===Ue.Finished&&void 0))),s||e.Finished},e.reduceWithLowPriorityGiveUp=function(e){return i(e,!0)},e.reduceWithHighPriorityGiveUp=function(e){return i(e,!1)},e.getFailureReason=function(e){const t=o.maxBy(e.failure,(e=>e.failureReason));return t?t.failureReason:E.FailureReason.None}}(He||(He={})),t.Test_CheckForUpdate=He,function(e){function t(e,t,s){const i=e.persisted.messagesForPosting[t],o=Object.assign(Object.assign({},i),{amsreferences:s});e.persisted.messagesForPosting[t]=o}e.updateAmsCreateReferences=function(e){const s=e.getPersistedActionData(),i=s.amsDocumentIds&&o.compact(o.values(s.amsDocumentIds));o.each(e.persisted.conversationIds,(s=>{t(e,s,i)}))},e.updateAmsForwardUploadReferences=function(e,s){const i=e.getPersistedActionData(),o=i.amsForwardDocumentIds&&i.amsForwardDocumentIds[s];t(e,s,o?[o]:void 0)},e.updateAmsForwardObjectsReferences=function(e){const s=e.getPersistedActionData(),i=o.compact(o.values(s.amsForwardDocumentIds));o.each(e.persisted.conversationIds,(s=>{t(e,s,i)}))}}(ze||(ze={})),function(e){function t(e,t){return o.find(e,(e=>e.objectId===t))}e.updateMessageUrls=function(e,s,i,n,r){const a=e.getPersistedActionData();let l;const d=e.isUploadNeeded();if(d||!a.swiftMessageDecoded&&!o.isEmpty(a.forwardMediaInfos)){let r,c=!1;if(d){if(o.size(o.compact(o.values(a.amsDocumentIds)))!==o.size(a.amsUploads))return;const t=o.map(a.amsUploads,((t,s)=>{const o=a.amsDocumentIds[s],n=y.getDocumentUrls(o,t.amsUploadFileType),r=t.originalFileName||t.amsUploadFilename,l=t.originalUploadFileType||t.amsUploadFileType,d=U.default.getAmsUploadFileSize(t);let c;return t.amsUploadFileType===re.UploadFileType.AudioMessage&&(c=t.audioDurationMs),R.default.getMediaEntity(n.original,n.preview,n.fallback,i,l,e.persisted.title,r,d,t.amsUploadFullData.dimensions,o,c)}));a.textWithUploadIndexes?(r=o.map(a.textWithUploadIndexes,(e=>o.isString(e)?new W.UnhandledEntity(e):o.isNumber(e)?t[e]:pe.default.switchStatementExhaustiveChecking(e))),c=!0):r=t}else{const o=t(a.forwardMediaInfos,n),l=y.getDocumentUrls(s,o.fileType);r=[R.default.getMediaEntity(l.original,l.preview,l.fallback,i,o.fileType,e.persisted.title,o.filename,o.fileSize,o.dimensions,s,o.durationMs)]}const h=e.persisted.callId?[new W.CallReactionMetadataEntity(e.persisted.callId)]:[],u=r.concat(h),p=j.encode(u,c,!1);l={},o.each(e.persisted.messagesForPosting,((e,t)=>{l[t]=p}))}else l=a.swiftMessageDecoded?function(e,t,s,i){o.each(s.attachments,(e=>{!function(e,t,s){o.each(e.content.images,(e=>{e.url&&(e.url=e.url.replace(t,s))})),e.content.image&&e.content.image.url&&(e.content.image.url=e.content.image.url.replace(t,s));o.each(e.content.items,(e=>{e.image&&e.image.url&&(e.image.url=e.image.url.replace(t,s))})),o.each(e.content.media,(e=>{e.url&&(e.url=e.url.replace(t,s))}))}(e,t.objectId,i)}));let n={};return o.each(e.persisted.messagesForPosting,((e,t)=>{n[t]=j.encode([new W.SwiftUriObjectEntity(s,t,!0,s.summary)],!1,!1)})),n}(e,t(a.forwardMediaInfos,n),a.swiftMessageDecoded,s):{};r&&(l={[r]:l[r]}),o.each(l,((t,s)=>{const i=o.cloneDeep(e.persisted.messagesForPosting[s]);i.content=l[s],e.persisted.messagesForPosting[s]=i}))},e.getForwardMessageMediaInfo=t}(We||(We={}));let it=!0;t.test_setForegroundPostEnabled=function(e){it=e}},43898:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.test_migrateAmsUploadIfNeeded=void 0;const i=s(74958),o=s(96486),n=s(97792),r=(s(26999),s(80648)),a=(s(16778),s(74634)),l=s(97691),d=s(66737),c=s(89391),h=s(44135),u=s(22801),p=s(60021),g=s(76621),m=s(51077),S=s(71830),f=s(98278),y=s(57569),_=s(39549),v=s(66923),C=s(52262),b=s(79041),T=s(46096),M=s(84457),I=s(53559),w=s(53700),P=s(36237),k=s(19089),A=s(24606),E=s(51470),R=s(12056),L=s(18078),F=s(92210),x=s(68645),O=s(80457),D=s(17791),B=s(29130),V=s(66765),N=s(16568),U=s(22538),H=s(78262),z=s(35370),W=s(12770),j=s(94214),G=s(42987),K=s(72758),q=s(53374),Q=T.LogTraceArea.PostingService;function X(e){if(e.amsUploadFileType&&!e.amsUploads){e.amsUploads=[{originalUploadFileType:e.originalUploadFileType,originalFileName:e.originalFileName,amsUploadFileType:e.amsUploadFileType,amsUploadFilename:e.amsUploadFilename,amsUploadFullData:e.amsUploadFullData,amsFullDataLocalUrl:e.amsFullDataLocalUrl,amsFullDataCacheInfo:e.amsFullDataCacheInfo,amsUploadThumbnailData:e.amsUploadThumbnailData,amsThumbnailLocalUrl:e.amsThumbnailLocalUrl,amsThumbnailCacheInfo:e.amsThumbnailCacheInfo}];const t=e;delete t.amsUploadFileType,delete t.originalFileName,delete t.originalUploadFileType,delete t.amsUploadFilename,delete t.amsUploadFullData,delete t.amsFullDataLocalUrl,delete t.amsFullDataCacheInfo,delete t.amsUploadThumbnailData,delete t.amsThumbnailLocalUrl,delete t.amsThumbnailCacheInfo;const s=[["amsCreateDocumentBackgroundId","amsCreateDocumentBackgroundIds"],["amsCreateDocumentForegroundRequest","amsCreateDocumentForegroundRequests"],["amsCreateDocumentBackgroundTransfer","amsCreateDocumentBackgroundTransfers"],["amsDocumentId","amsDocumentIds"],["amsThumbnailBackgroundId","amsThumbnailBackgroundIds"],["amsThumbnailDocumentForegroundRequest","amsThumbnailDocumentForegroundRequests"],["amsThumbnailBackgroundTransfer","amsThumbnailBackgroundTransfers"],["amsFullDataBackgroundId","amsFullDataBackgroundIds"],["amsFullDataDocumentForegroundRequest","amsFullDataDocumentForegroundRequests"],["amsFullDataBackgroundTransfer","amsFullDataBackgroundTransfers"],["instrumentation_uploadStartTime","instrumentation_uploadStartTimes"],["azureBackgroundTransfer","azureBackgroundTransfers"],["azureMSUrl","azureMSUrls"]];o.each(s,(t=>{const[s,i]=t;s in e&&(e[i]||(e[i]={}),e[i][0]=e[s],delete e[s])}))}return e}t.default=new class{constructor(){this._lastPostTime=0,this._posts={},this._postsActivelyWorking={},this._postsCleaningUp={},this._postStartTimeThisRun={},this._scenarioCache={},this._checkForNeededWorkQueue={},this.postCreated=new a.default,this.postUpdated=new a.default,this.transferFinished=new a.default,this.allPostsFinished=new a.default,this.getPostByLocalUrl=e=>{const t=o.find(this._posts,(t=>t.isMyLocalUrl(e)));return t&&t.getPersistedActionData()},this.getLocalUrlsForPost=e=>{const t=this._posts[e];return t&&t.getMyLocalUrls()},this.debug_allPosts=()=>this._posts,this.debug_allPostsCleaningUp=()=>o.mapValues(this._postsCleaningUp,(e=>e.post)),this.debug_allPostsFailedRetryInfo=()=>{const e={};return o.each(this._posts,(t=>{const s=t.debug_allPostsFailedRetryInfo();s&&(e[t.persisted.id]=s)})),e},this.test_resetBackoff=()=>{this._resetBackoffs("Tests"),this._seeIfAnythingNeedsDoing()},this.cancelPostMessage=(e,t)=>{const s=o.find(this._posts,(s=>o.some(s.persisted.messagesForPosting,((s,i)=>i===e&&s.clientmessageid===t))));return s?(P.log(Q,"Canceling CMID: "+t+", ConvId: "+i.pii.Mri(e)+", found post: "+s.persisted.id),this._cancel(s),!0):(P.warn(Q,"Attempted to cancel CMID "+t+" but no pending message post found!"),!1)},this.test_cancelPost=e=>{const t=this._posts[e]||this._postsCleaningUp[e]&&this._postsCleaningUp[e].post;return P.log(Q,"Test canceling post: "+e+", found: "+!!t+", during cleanup: "+!(!t||!t.persisted.isCleaningUp)),t&&this._cancel(t)},U.RegisterStartupable(this,"PostingTransferService",[h.default,u.default,g.default,v.default,b.default,w.default,x.default,D.default,j.default])}startup(){d.default.init(this.postCreated,this.postUpdated,this.allPostsFinished,(()=>!o.isEmpty(this._posts))),D.default.subscribe((()=>{D.default.isNetworkingAvailable()&&(this._resetBackoffs("ReportedConnectivityStore"),this._seeIfAnythingNeedsDoing())})),u.default.reconnected.subscribe((()=>{this._resetBackoffs("ChatService.reconnected"),this._seeIfAnythingNeedsDoing()})),j.default.subscribe((()=>{j.default.hasUsableSkypeToken()&&this._seeIfAnythingNeedsDoing()}),j.TriggerKeys.SkypeTokenKey);const e=(e,t)=>o.find(this._posts,(s=>s!==e&&(!(s.persisted.postTime>e.persisted.postTime)&&!(!o.some(s.persisted.conversationIds,(e=>e===t&&!s.isPostedToChat(t)))||s.persisted.nonBlocking))));x.default.subscribe(G.PostingActionType,((t,s)=>{const n=o.sortBy(t,(e=>e.postTime));if(o.each(n,(t=>{P.log(Q,"Tracking Post: "+t.id+(s?", "+this._logStringForMessagePost(t,s):"")),t.postTime||(t.postTime=this._getNextPostTime()),t.forwardMediaInfo&&!t.forwardMediaInfos&&(t.forwardMediaInfos=[t.forwardMediaInfo]),t.instrumentation_uploadSource&&(t.instrumentation_postSource=t.instrumentation_uploadSource,t.instrumentation_uploadSource=void 0),function(e){!e.feedbackSendLogsAndScreenshot||e.feedbackSendLogs||e.feedbackSendScreenshot||(e.feedbackSendLogs=e.feedbackSendLogsAndScreenshot,e.feedbackSendScreenshot=e.feedbackSendLogsAndScreenshot)}(t),X(t),function(e){const t=[e.amsCreateDocumentBackgroundTransfers,e.amsForwardBackgroundTransfers,e.amsFullDataBackgroundTransfers,e.amsGetStatusBackgroundTransfers,e.amsThumbnailBackgroundTransfers,e.azureBackgroundTransfers,e.messageBackgroundTransfers,e.urlPreviewBackgroundTransfer];o.each(t,(e=>{o.each(e,(e=>{y.default.migrateTransfer(e)}))}))}(t);const i=new A.Post(t,!s,e);if(this._postStartTimeThisRun[i.persisted.id]=Date.now(),i.persisted.isCleaningUp)return i.persisted.isCleaningUp=!1,void this._removeAndCheckForNeededCleanup(i);this._pruneScenarioCache(),o.each(i.telemetryScenarios,((e,t)=>{const s=i.persisted.messagesForPosting[t],o=S.getCuidForMessage(s);this._scenarioCache[t]?this._scenarioCache[t][o]=e:this._scenarioCache[t]={[o]:e}})),this._posts[i.persisted.id]=i,this._checkForNeededWork(i.persisted.id),i.markTelemetryStepCompleted(A.PostMessageScenarioStep.GotPostFromPersistentStore),this.postUpdated.fire(i.getPersistedActionData())})),s&&t.length){const t=o.mapValues(this._posts,(t=>o.filter(t.persisted.conversationIds,(s=>!e(t,s))))),s=o.pickBy(t,(e=>e.length));P.log(Q,"Earliest post to convs: "+o.map(s,((e,t)=>t+": ["+o.map(e,(e=>i.pii.Mri(e)))+"]")).join(", "))}}));const t=(e,t,o,n,r,a)=>{const l=(0,A.postIdFromContext)(t);if(!l)return void(this._postsCleaningUp[t]||P.warn(Q,"Failed to parse context for "+a+" (probably old -> ignoring): "+i.pii.Omit(JSON.stringify(t))));const d=this._posts[l];if(!d)return void(this._postsCleaningUp[l]||P.warn(Q,"Got "+a+" for missing Post: "+l+", context: "+i.pii.Omit(JSON.stringify(t))));const c=d.handleResponse(e,t,o,n,r,a);if(!c)return void(this._postsCleaningUp[l]||P.warn(Q,"Got "+a+" for known post but failed to update: "+l+", context: "+i.pii.Omit(JSON.stringify(t))));if(!(o=c.success)&&c.canRetry&&c.retryInfo&&W.default.setExpiration((()=>{this._posts[d.persisted.id]&&this._checkForNeededWork(d.persisted.id)}),c.retryInfo.nextAttempt),c.permanentFailure){if(c.convId){const e=u.default.getChatServiceErrorResponseMetadata(n),t=c.convId&&d.persisted.messagesForPosting[c.convId],s={message_type:t&&z.getMessageTypeName(t,L.default.getSkypeMri(),c.convId),error_code:e.errorCode,status_code:n.statusCode};d.markTelemetryStepCompleted(A.PostMessageScenarioStep.MessagePostingFailed,[c.convId],s,c.finishedAttemptsSoFarCount)}this.postUpdated.fire(d.getPersistedActionData())}const h=A.TransferTypeToPostingTransferSource[a];this.transferFinished.fire(d.getPersistedActionData(),h,c,n,r,c.convId,c.fileSize),c.telemetryInfo&&d.markTelemetryStepCompleted(c.telemetryInfo.step,c.telemetryInfo.conversationIds,c.telemetryInfo.attributes,c.finishedAttemptsSoFarCount),s(d,c.mightUnblockOthersInConv?c.convId:void 0)},s=(e,t)=>{this._postUpdated(e),this._checkForNeededWork(e.persisted.id),t&&this._seeIfAnythingElseInConvNeedsDoing(e,t)};return o.each(A.AllBackgroundTransferTypes,(e=>{h.default.subscribe(e,t)})),A.foregroundResponse.subscribe(t),A.pokePost.subscribe(((e,t)=>{const i=this._posts[e];i&&s(i,t)})),A.feedbackGathered.subscribe(((e,t)=>{const s=this._posts[e];if(s){const e=o.map(t,(e=>e.then((e=>e),(()=>{}))));l.all(e).then((e=>{o.each(e,(e=>{e&&this.startPost(e,{name:F.ScenarioName.SendMessage})}))})),this._postUpdated(s),this._checkForNeededWork(s.persisted.id)}})),l.Resolved()}_pruneScenarioCache(){o.each(this._scenarioCache,((e,t)=>{o.each(e,((t,s)=>{t.isResolved()&&!t.hasUnresolvedSecondaryScenarios()&&delete e[s]})),o.isEmpty(e)&&delete this._scenarioCache[t]}))}getTelemetryScenarioForMessage(e,t){this._pruneScenarioCache();const s=this._scenarioCache[e];return s&&s[t]}startPost(e,t,s,n){let r;if(e.kind===O.PostMessageInfoKind)E.default.notifyMessageReachedPostingTransferService(e.messageForPosting.clientmessageid),r=this._postMessageFromInfo(e);else{if(e.kind!==O.PostUploadInfoKind)return P.error(Q,"Unknown retry info",i.pii.Omit(e)),q.default.switchStatementExhaustiveChecking(e);t&&e.amsUploads&&e.amsUploads.length>0&&e.amsUploads[0].amsUploadFileType===H.UploadFileType.File&&(t.name=F.ScenarioName.SendFile),r=this._postUploadFromInfo(e,t&&t.transactionId)}t&&(r.scenarioInfo=Object.assign(Object.assign({},t),{startTime:Date.now()})),this.postCreated.fire(r);x.default.persistAndStartAction(G.PostingActionType,r);let a;e.kind===O.PostMessageInfoKind?a=e.postSource:e.kind===O.PostUploadInfoKind&&(a=e.uploadSource),o.each(r.conversationIds,(e=>{this._donateConversationForShareSuggestions(e),this._trackMessageSent(e,r.messagesForPosting[e],r,a,s,n)}))}_donateConversationForShareSuggestions(e){const t=C.default.getDisplayableProfile(e);if(t){const s=t.getDisplayName(),i=t.getAvatarUrl(),o=S.isEncryptedThread(e),n=S.isConversationWithPhoneNumber(e),a=S.isAgent(e);!s||o||n||a||r.default.donateConversationForShareSuggestion(e,s,i)}}_trackMessageSent(e,t,s,i,o,n){if(t.skypeeditedid)return;const r=(0,_.default)().getConversation(e),a=this._getMessageReceiverMri(r),l=!!a&&this._isReceiverShortCircuitContact(a);let d,c;a&&(d=S.splitMri(a).id),r&&(c=r.getOneOnOneThreadId()),P.track(new R.MessageSent(e,t,l,s.rawContentLength||0,i,N.default.EdfRegistrationId.get(),V.default.getEndpointId(),a,d,c,s.nonBlocking,o,B.default.getDeviceOrientation(f.MainRootViewId),k.default.isPiPEnabled()?!!k.default.getContentProps():void 0,n&&n.messageComposerAction,n&&n.contentType,n&&n.messageDurationMs,m.isDoNotFormatType(t.properties)))}_postMessageFromInfo(e){const{conversationId:t,messageForPosting:s}=e;let i,n={postTime:this._getNextPostTime(),editedMessageCuid:e.editedMessageCuid,conversationIds:[t],conversationAcceptedInfos:{[t]:e.conversationAcceptedInfo},instrumentation_postSource:e.postSource,instrumentation_conversationOrigin:e.conversationOrigin,messagesForPosting:{[t]:s},urlPreviewPropSet:e.urlPreviewPropSet,transactionId:q.default.newGuid(),forwardMediaInfo:e.forwardMediaInfo,forwardMediaInfos:e.forwardMediaInfos,swiftMessageDecoded:e.swiftMessageDecoded,urlPreviewEndpoints:e.urlPreviewEndpoints,rawContentLength:e.rawContentLength,quoteAuthor:e.quoteAuthor,quotesTriggerType:e.quotesTriggerType,isForward:e.isForward,showLocalNotificationOnFailure:e.showLocalNotificationOnFailure,editedMessageServerId:e.editedMessageServerId,editedMessageVersion:e.editedMessageVersion,isDelete:e.isDelete},r=e.shouldSendLogsAndScreenshot||e.shouldSendLogs,a=e.shouldSendLogsAndScreenshot||e.shouldSendScreenshot;if((r||a)&&(n.feedbackSessionId=M.default.getCurrentSessionId(),n.feedbackScreenshotUri=e.screenshotUri,n.feedbackSendLogs=r,n.feedbackSendScreenshot=a),P.log(Q,this._logStringForMessagePost(n,!1)),i=m.isEventCallEndedMessageType(s)?Object.assign(Object.assign({},s),{skypeeditedid:void 0,version:n.editedMessageVersion}):Object.assign(Object.assign({},s),{version:n.editedMessageVersion}),e.editedMessageCuid&&e.urlPreviewPropSet)g.default.applyMessageLieWithPropertyLie(t,i,m.MessageProperties.UrlPreviews,e.urlPreviewPropSet.urlPreviewJson);else if(o.isUndefined(e.editedMessageCuid)&&o.isUndefined(e.editedMessageServerId)&&o.isUndefined(e.editedMessageVersion)){const e=(0,_.default)().getConversation(t),s=Math.max(Date.now(),e?e.getTimestamp()+1:0);g.default.applyMessageLieAndNotifyPrematurely(t,s,i)}else g.default.applyMessageLie(t,i);return n}_postUploadFromInfo(e,t){const s=e.amsUploads?[...e.amsUploads]:[{amsUploadFileType:e.amsUploadFileType,amsUploadFilename:e.amsUploadFilename,amsUploadFullData:e.amsUploadFullData,amsFullDataLocalUrl:e.amsFullDataLocalUrl,amsFullDataCacheInfo:e.amsFullDataCacheInfo,amsUploadThumbnailData:e.amsUploadThumbnailData,amsThumbnailLocalUrl:e.amsThumbnailLocalUrl,amsThumbnailCacheInfo:e.amsThumbnailCacheInfo}];let i={postTime:this._getNextPostTime(),conversationIds:e.conversationIds,conversationAcceptedInfos:e.conversationAcceptedInfos,amsUploads:s,textWithUploadIndexes:e.textWithUploadIndexes,transactionId:t||q.default.newGuid(),messagesForPosting:e.messagesForPosting,rawContentLength:0,callId:e.callId,title:e.title,instrumentation_postSource:e.uploadSource,instrumentation_conversationOrigin:e.conversationOrigin};return e.toastMessageToShowOnSuccess&&(i.toastMessageToShowOnSuccess=e.toastMessageToShowOnSuccess),e.toastMessageToShowOnFailure&&(i.toastMessageToShowOnFailure=e.toastMessageToShowOnFailure),e.shouldTrackUpload&&(i.shouldTrackUpload=e.shouldTrackUpload),P.log(Q,this._logStringForMessagePost(i,!1)),o.each(e.conversationIds,(e=>{g.default.applyMessageLie(e,i.messagesForPosting[e])})),i}_logStringForMessagePost(e,t){const s=o.find(e.messagesForPosting),n=s&&s.skypeeditedid,r=e.isDelete,a=r||!(!e.editedMessageServerId&&!n),l=o.map(e.amsUploads,(e=>{let t="";const s=e.amsUploadFullData;if(s){t+=", amsUploadFileSize: "+s.file.size+", ams upload ext: "+(s.extension||I.default.extractFileExtension(e.amsUploadFilename))}let i="";const o=e.amsUploadThumbnailData;if(o){i+=", amsThumbnailFileSize: "+o.file.size+", ams thumbnail ext: "+(o.extension||I.default.extractFileExtension(o.file.name))}return"(amsUploadFileType: "+e.amsUploadFileType+t+i+")"}));return(t?"Restored ":"New ")+(l.length?"upload":"message")+": ConvId/CMID: ["+o.map(e.messagesForPosting,((e,t)=>i.pii.Mri(t)+"/"+e.clientmessageid)).join(", ")+"], message action: "+(a?r?A.ChatPostActionNames.delete:A.ChatPostActionNames.edit:A.ChatPostActionNames.post)+(a?", previous message ids: "+n+"|"+e.editedMessageServerId:"")+(l.length?", uploads: ["+l.join(", ")+"]":"")}_isReceiverShortCircuitContact(e){const t=K.default.getFullUserProfileByMri(e);return!!t&&!!t.isSuggested}_getMessageReceiverMri(e){if(e&&e.isOneOnOne())return e.getOtherPartyMri()}_getPostInfo(e){if(e.persisted.permanentFailureTransferType)return;const t=e.getPersistedActionData();if(e.isUploadNeeded()){const e=t.amsUploads;return{kind:"postUpload",conversationIds:t.conversationIds,amsUploads:e,textWithUploadIndexes:t.textWithUploadIndexes,messagesForPosting:t.messagesForPosting,callId:t.callId,title:t.title,uploadSource:t.instrumentation_postSource,conversationOrigin:t.instrumentation_conversationOrigin,toastMessageToShowOnSuccess:t.toastMessageToShowOnSuccess,toastMessageToShowOnFailure:t.toastMessageToShowOnFailure,shouldTrackUpload:t.shouldTrackUpload,conversationAcceptedInfos:t.conversationAcceptedInfos}}return{kind:"postMessage",conversationId:t.conversationIds[0],postSource:t.instrumentation_postSource,conversationOrigin:t.instrumentation_conversationOrigin,messageForPosting:o.find(t.messagesForPosting),editedMessageCuid:t.editedMessageCuid,forwardMediaInfo:t.forwardMediaInfo,forwardMediaInfos:t.forwardMediaInfos,swiftMessageDecoded:t.swiftMessageDecoded,shouldSendLogs:t.feedbackSendLogs,shouldSendScreenshot:t.feedbackSendScreenshot,screenshotUri:t.feedbackScreenshotUri,showLocalNotificationOnFailure:t.showLocalNotificationOnFailure,urlPreviewPropSet:t.urlPreviewPropSet,urlPreviewEndpoints:t.urlPreviewEndpoints,rawContentLength:t.rawContentLength,quoteAuthor:t.quoteAuthor,quotesTriggerType:t.quotesTriggerType,isForward:t.isForward,editedMessageServerId:t.editedMessageServerId,editedMessageVersion:t.editedMessageVersion,isDelete:t.isDelete,conversationAcceptedInfo:t.conversationAcceptedInfos&&t.conversationAcceptedInfos[t.conversationIds[0]]}}_cancel(e){return e.persisted.isCanceled=!0,this._removeAndCheckForNeededCleanup(e)}_postUpdated(e,t=!1){const s=e.getPersistedActionData(),i=x.default.updateAction(s);return t||this.postUpdated.fire(s),i}_getNextPostTime(){let e=Date.now();return o.each(this._posts,(t=>{t.persisted.postTime>=e&&(e=t.persisted.postTime+1)})),e<=this._lastPostTime&&(e=this._lastPostTime+1),this._lastPostTime=e,e}_resetBackoffs(e){P.log(Q,"Resetting backoffs due to: "+e),o.each(this._posts,(e=>{e.resetBackoffs()}))}_seeIfAnythingNeedsDoing(){const e=o.keys(this._posts);o.each(e,(e=>{this._posts[e]&&this._checkForNeededWork(e)}))}_seeIfAnythingElseInConvNeedsDoing(e,...t){const s=o.keys(this._posts);o.each(s,(s=>{const i=this._posts[s];i&&o.intersection(i.persisted.conversationIds,t).length&&(!e||i!==e&&i.persisted.postTime>e.persisted.postTime)&&this._checkForNeededWork(s)}))}_checkForNeededWork(e){if(this._checkForNeededWorkQueue[e])return void this._checkForNeededWorkQueue[e]++;this._checkForNeededWorkQueue[e]=1;const t=this._posts[e];this._doWorkIfNeeded(t);const s=this._posts[e]&&this._checkForNeededWorkQueue[e]>1;delete this._checkForNeededWorkQueue[e],s&&this._checkForNeededWork(e)}_doWorkIfNeeded(e){if(o.some(e.persisted.conversationIds,(e=>!e)))return P.error(Q,"Null conversationId in postingService. Cleaning up PostId: "+e.persisted.id),void this._removeAndCheckForNeededCleanup(e);const{updateKind:t,isActivelyWorking:s}=e.doWorkIfNeeded();switch(this._updateIsActivelyWorking(e,s),t){case A.CheckForNeededWorkResult.Finished:case A.CheckForNeededWorkResult.GiveUp:return void this._removeAndCheckForNeededCleanup(e);case A.CheckForNeededWorkResult.InProgress:case A.CheckForNeededWorkResult.Blocked:return;case A.CheckForNeededWorkResult.Update:return void this._postUpdated(e);default:return q.default.switchStatementExhaustiveChecking(t)}}_updateIsActivelyWorking(e,t){t?(this._postsActivelyWorking[e.persisted.id]=!0,!this._wakeLockPromise&&c.default.getConfigSettingsNoSubscription().chat.backgroundPostingHoldOwnWakeLockEnabled&&(this._wakeLockPromise=n.default.requestMaxTime("posting:active")),u.default.pokeLongRunningRequest(e.persisted.id)):(delete this._postsActivelyWorking[e.persisted.id],this._wakeLockPromise&&o.isEmpty(this._postsActivelyWorking)&&(this._wakeLockPromise.then((e=>{n.default.release(e,"posting:active")})),this._wakeLockPromise=void 0),u.default.removeLongRunningRequest(e.persisted.id))}_removeAndCheckForNeededCleanup(e){e.persisted.isFinished=!0;const t=!!this._posts[e.persisted.id];if(e.persisted.isCleaningUp)return this._postsCleaningUp[e.persisted.id]&&this._postsCleaningUp[e.persisted.id].defer.promise();e.persisted.isCleaningUp=!0;{const s=Date.now()-e.persisted.postTime,i=Date.now()-this._postStartTimeThisRun[e.persisted.id];P.log(Q,"Cleaning up:",e.persisted.id,"reportedPostTimeTotalMs",s,"actualPostTimeThisRunMs",i,"isCanceled",!!e.persisted.isCanceled,"justFinished",t,"permanentFailureTransferType",e.persisted.permanentFailureTransferType||"none","maxRetriesExceededTransferType",e.persisted.maxRetriesExceededTransferType||"none","maxElapsedTimeExceededTransferType",e.persisted.maxElapsedTimeExceededTransferType||"none")}this._updateIsActivelyWorking(e,!1),delete this._posts[e.persisted.id],delete this._postStartTimeThisRun[e.persisted.id],this._postsCleaningUp[e.persisted.id]={post:e,defer:l.Defer()};const s=this._postUpdated(e,!0).always((()=>{let s;return e.cleanup(),t&&(o.each(e.telemetryScenarios,((t,s)=>{let i={conversations_count:e.persisted.conversationIds.length,correlationId:p.getCorrelationIdFromMessageParts(L.default.getSkypeMri(),s,e.persisted.messagesForPosting[s].clientmessageid)};e.persisted.isCanceled?t.fail("user_cancelled",i):e.persisted.permanentFailureTransferType?(i.transfer_type=e.persisted.permanentFailureTransferType,t.fail("permanent_failure",i)):e.persisted.maxElapsedTimeExceededTransferType?(i.transfer_type=e.persisted.maxElapsedTimeExceededTransferType,t.fail("max_transfer_time_exceeded",i)):e.persisted.maxRetriesExceededTransferType?(i.transfer_type=e.persisted.maxRetriesExceededTransferType,t.fail("max_retries_exceeded",i)):t.finish(i)})),this.postUpdated.fire(e.getPersistedActionData())),e.persisted.isCanceled&&(s=o.map(e.persisted.messagesForPosting,((e,t)=>{const s=S.getCuidForMessage(e);return g.default.revertMessageLie(t,s,e.clientmessageid)}))),l.all(s||[]).then((()=>{let s,n,r=!1;if(e.persisted.permanentFailureTransferType||e.persisted.maxRetriesExceededTransferType||e.persisted.maxElapsedTimeExceededTransferType){const t=Date.now();n=o.map(e.persisted.messagesForPosting,((i,o)=>{if(!e.isPostedToChat(o))return s=s||this._getPostInfo(e),r=r||!(e.persisted.permanentFailureTransferType||!s),g.default.rejectMessageSend(o,i,t,s)}))}return l.all(n||[]).then((()=>{const s=e.getMyLocalCacheNames();if(0===s.length)return;let n;return P.log(Q,"Keeping in cache for a while: "+e.persisted.id+", names: "+i.pii.Omit(s.join(", "))),n=r?o.map(s,(e=>w.default.finishedButKeepForRetry(e))):t?o.map(s,(e=>w.default.finished(e))):o.map(s,(e=>w.default.abandon(e))),l.all(n).then(o.noop)})).always((()=>{x.default.removeAction(e.persisted.id);const t=this._postsCleaningUp[e.persisted.id];delete this._postsCleaningUp[e.persisted.id],t.defer.resolve(void 0)}))}))}));this._seeIfAnythingElseInConvNeedsDoing(e,...e.persisted.conversationIds);{const t=o.filter(e.persisted.conversationIds,(e=>!o.some(this._posts,(t=>o.includes(t.persisted.conversationIds,e)))));o.isEmpty(t)||P.log(Q,"Cleaning up convs: ["+o.map(t,(e=>i.pii.Mri(e))).join(", ")+"]"),o.isEmpty(this._posts)&&P.log(Q,"Cleaning up everything!")}return s.finally((()=>{o.isEmpty(this._posts)&&o.isEmpty(this._postsCleaningUp)&&this.allPostsFinished.fire()})),s}},t.test_migrateAmsUploadIfNeeded=X},72374:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=s(96486),n=s(88837),r=s(29510);let a;a=100;let l=class extends n.StoreBase{constructor(){super(200),this._animatedEmoticons=new r.LinkedHashMap,this._staticEmoticons=new r.LinkedHashMap}register(e){if(!this._animatedEmoticons.has(e)&&!this._staticEmoticons.has(e)){if(this._animatedEmoticons.length()===a){const e=this._animatedEmoticons.removeFirst();this._staticEmoticons.addLast(e,e),o.defer((()=>{this.trigger(e)}))}this._animatedEmoticons.addLast(e,e)}}unregister(e){if(o.isUndefined(this._staticEmoticons.remove(e))&&!o.isUndefined(this._animatedEmoticons.remove(e))&&this._staticEmoticons.length()>0){const e=this._staticEmoticons.removeLast();this._animatedEmoticons.addFirst(e,e),o.defer((()=>{this.trigger(e)}))}}canAnimate(e){return this._animatedEmoticons.has(e)}};(0,i.__decorate)([n.autoSubscribe,(0,i.__param)(0,n.key)],l.prototype,"canAnimate",null),l=(0,i.__decorate)([n.AutoSubscribeStore],l),t.default=new l},63413:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=s(74958),n=s(96486),r=s(88837),a=s(97691),l=s(71830),d=s(62141),c=s(36237),h=s(98754),u=s(22538),p=s(27795);let g=class extends r.StoreBase{constructor(){super(),this._contactsBlockStatus={},this._conversationBlockStatus={},this._contactsBlockStatusOriginal={},this._conversationBlockStatusOriginal={},u.RegisterStartupable(this,"BlockedMriStore",[h.default])}startup(){const e=h.default.getDataExclusive(d.InternalKeys.BlockedMriStoreCache);return this._contactsBlockStatus=e?e.contactsBlockStatus:{},this._conversationBlockStatus=e?e.conversationBlockStatus:{},this._contactsBlockStatusOriginal={},this._conversationBlockStatusOriginal={},a.Resolved()}isMriBlocked(e){if(l.isOneToOneThread(e)){const t="BlockedMriStore:isMriBlocked doesn't support oneOnOneThreads: "+o.pii.Mri(e);return c.error(void 0,t),c.track(new p.DevDebug("IsMriBlockedOneOnOneThreads",t)),!1}let t=!1;return!(e in this._contactsBlockStatus&&(t=!0,!this._contactsBlockStatus[e]))&&(!(e in this._conversationBlockStatus&&(t=!0,!this._conversationBlockStatus[e]))&&!!t)}isContactBlocked(e){return!!this._contactsBlockStatus[e]}getBlockedMris(){const e=n.mergeWith(this._conversationBlockStatus,this._contactsBlockStatus,((e,t)=>!(!1===e||!1===t))),t=n.pickBy(e,(e=>e));return Object.keys(t)}internal_updateContactsBlockStatus(e,t,s){return this._updateSet(e,this._contactsBlockStatusOriginal,this._contactsBlockStatus,t,s)}internal_updateConversationBlockStatus(e,t){return this._updateSet(e,this._conversationBlockStatusOriginal,this._conversationBlockStatus,!0,t)}test_reset_store(){h.default.deleteKeys([d.InternalKeys.BlockedMriStoreCache]).then((()=>{const e=h.default.getDataExclusive(d.InternalKeys.BlockedMriStoreCache);this._contactsBlockStatus=e?e.contactsBlockStatus:{},this._conversationBlockStatus=e?e.conversationBlockStatus:{},this._contactsBlockStatusOriginal={},this._conversationBlockStatusOriginal={}}))}_updateSet(e,t,s,i,o){let r=[],l=!1;if(n.each(e,((e,o)=>{if(e!==s[o]){const n=this.isMriBlocked(o);i||o in t||(o in s?t[o]=s[o]:e&&(t[o]=!1)),s[o]=e,l=!0,this.isMriBlocked(o)!==n&&r.push(o)}})),i&&n.each(e,((e,s)=>{s in t&&delete t[s]})),l||i){const e={contactsBlockStatus:n.assign({},this._contactsBlockStatus,this._contactsBlockStatusOriginal),conversationBlockStatus:n.assign({},this._conversationBlockStatus,this._conversationBlockStatusOriginal)};return(i?h.default.putData(d.InternalKeys.BlockedMriStoreCache,e,o):a.Resolved()).then((()=>{r.length>0&&this.trigger(r)}))}return a.Resolved()}};(0,i.__decorate)([r.autoSubscribe,(0,i.__param)(0,r.key)],g.prototype,"isMriBlocked",null),(0,i.__decorate)([r.autoSubscribe,(0,i.__param)(0,r.key)],g.prototype,"isContactBlocked",null),(0,i.__decorate)([r.autoSubscribe],g.prototype,"getBlockedMris",null),g=(0,i.__decorate)([r.AutoSubscribeStore],g),t.default=new g},82773:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TriggerKeys=void 0;const i=s(70655),o=s(96486),n=s(88837),r=s(97691),a=s(89391),l=s(76621),d=s(62141),c=s(96418),h=s(46096),u=s(36237),p=s(78735),g=s(22538);var m;!function(e){e[e.BookmarkAddedKey=0]="BookmarkAddedKey"}(m=t.TriggerKeys||(t.TriggerKeys={}));let S=class extends n.StoreBase{constructor(){super(),this._bookmarkAdded=!1,this._updatedBookmarks={},this._appConfigChanged=()=>{const{enableBookmarks:e}=a.default.getS4LMessagingFeatures();e&&!this._messagesProcessedToken?this._messagesProcessedToken=l.default.messagesProcessed.subscribe(this._chatServiceDataServiceMessagesProcessed):!e&&this._messagesProcessedToken&&(this._messagesProcessedToken.unsubscribe(),this._messagesProcessedToken=void 0)},this._chatServiceDataServiceMessagesProcessed=e=>r.all(o.map(e,(e=>{if(e.isBookmarkSourceForCurrentUser()){const t=e.getBookmarkSourceMetadataForCurrentUser();if(!t||!t.cuid)return;this._maybeStoreUpdatedBookmarkTrigger(t.cuid,e)}}))),g.RegisterStartupable(this,"BookmarksStore",[p.default,l.default])}startup(){return a.default.subscribe(this._appConfigChanged),this._appConfigChanged(),r.Resolved()}isBookmarkAdded(){return this._bookmarkAdded}setBookmarkAdded(){this._bookmarkAdded=!0,this.trigger(m.BookmarkAddedKey)}bookmarkTooltipDisplayed(){this._bookmarkAdded=!1,this.trigger(m.BookmarkAddedKey)}shouldDisplayTooltipOnMobile(e){return!(p.default.getUserPreferencesLocal().notifiedAboutBookmarks||!this._bookmarkAdded||!e||c.default.isCoachMarkBeingShown())&&(p.default.setUserPreferencesLocal({notifiedAboutBookmarks:!0}),!0)}getBookmarkEditedMessage(e,t){if(o.has(this._updatedBookmarks,e))return this._updatedBookmarks[e];this._checkIfBookmarkContentUpdated(t)}_checkIfBookmarkContentUpdated(e){if(!e.isBookmark())return r.Resolved();const t=e.getBookmarkMetadata();return t?d.default.getMessageByCuid(t.bookmarkSourceConversationId,t.bookmarkSourceClientMessageId).then((t=>{t?e.content!==t.content&&(u.log(h.LogTraceArea.Bookmarks,"Newer bookmark source message found in local DB."),this._maybeStoreUpdatedBookmarkTrigger(e.cuid,t)):this._updatedBookmarks[e.cuid]=void 0})):r.Resolved()}_maybeStoreUpdatedBookmarkTrigger(e,t){const s=this._updatedBookmarks[e];if(!s)return u.log(h.LogTraceArea.Bookmarks,"Caching newer version bookmark source message."),this._updatedBookmarks[e]=t,void this.trigger(e);const i=s.getLatestServerMessageVersion(),o=t.getLatestServerMessageVersion();if(i&&o)return o>i&&s.content!==t.content?(u.log(h.LogTraceArea.Bookmarks,"Received new version of bookmark with new content."),this._updatedBookmarks[e]=t,void this.trigger(e)):void 0;u.log(h.LogTraceArea.Bookmarks,`Unable to compare versions of updated bookmarks. Local version:${i} Incoming update:${o}`)}test_reset(){this._bookmarkAdded=!1,this._updatedBookmarks={},this._messagesProcessedToken=void 0}test_getUpdatedBookmarks(){return this._updatedBookmarks}};(0,i.__decorate)([(0,n.autoSubscribeWithKey)(m.BookmarkAddedKey)],S.prototype,"isBookmarkAdded",null),(0,i.__decorate)([(0,n.autoSubscribeWithKey)(m.BookmarkAddedKey)],S.prototype,"shouldDisplayTooltipOnMobile",null),(0,i.__decorate)([n.autoSubscribe,(0,i.__param)(0,n.key)],S.prototype,"getBookmarkEditedMessage",null),S=(0,i.__decorate)([n.AutoSubscribeStore],S),t.default=new S},10666:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=s(96486),n=s(88837),r=s(89391),a=s(27028);s(70804);let l=class extends n.StoreBase{effectsEnabled(e,t,s){return!e&&!!r.default.getS4LCMCFeatures().enableFilters}getOverlays(e){let t=[{overlayType:a.OverlayType.None,order:0}];return o.sortBy(t,"order")}hasOverlays(e){return this.getOverlays(e).some((e=>e.overlayType!==a.OverlayType.None))}};(0,i.__decorate)([n.autoSubscribe],l.prototype,"effectsEnabled",null),(0,i.__decorate)([n.autoSubscribe],l.prototype,"getOverlays",null),(0,i.__decorate)([n.autoSubscribe],l.prototype,"hasOverlays",null),l=(0,i.__decorate)([n.AutoSubscribeStore],l);const d=new l;t.default=d},842:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=s(96486),n=s(88837),r=s(97691),a=s(22801),l=s(76621),d=s(51077),c=s(71830),h=s(39549),u=s(22538),p=s(12770);let g=class extends n.StoreBase{constructor(){super(),this._conversationMap={},u.RegisterStartupable(this,"ComposingStore",[a.default,l.default,h.default])}startup(){return a.default.controlMessagesReceived.subscribe((e=>{o.each(e,(e=>{const t=c.getParsedConversationId(e),s=c.getCreatorMriForMessageFromLink(e.from);t&&(e.messagetype===d.MessageTypes.Typing?this.addComposingUserData(t,s):e.messagetype===d.MessageTypes.ClearTyping&&this.clearComposingUserData(t,s))}))})),l.default.messagesProcessed.subscribe((e=>{o.each(e,(e=>{this.clearComposingUserData(e.conversationId,e.creator)}))})),(0,h.default)().subscribe((e=>{o.each(e,(e=>{if(this._conversationMap[e]){(0,h.default)().getConversation(e).isCurrentUserMember()||(delete this._conversationMap[e],this.trigger(e))}}))})),r.Resolved()}addComposingUserData(e,t){this._conversationMap[e]||(this._conversationMap[e]=[]),this._conversationMap[e]=o.filter(this._conversationMap[e],(e=>e.mri!==t));let s=Date.now();this._conversationMap[e].push({mri:t,startTypingTime:s}),p.default.setTimeout((()=>{this.clearComposingUserData(e,t,s)}),2e4),this.trigger(e)}clearComposingUserData(e,t,s=0){if(this._conversationMap[e]){let i=!1;this._conversationMap[e]=o.filter(this._conversationMap[e],(e=>e.mri!==t||0!==s&&e.startTypingTime!==s||(i=!0,!1))),i&&this.trigger(e)}}getComposingUsers(e){return this._conversationMap[e]?o.map(this._conversationMap[e],(e=>e.mri)):[]}};(0,i.__decorate)([n.autoSubscribe,(0,i.__param)(0,n.key)],g.prototype,"getComposingUsers",null),g=(0,i.__decorate)([n.AutoSubscribeStore],g),t.default=new g},75760:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationCalculationStore=void 0;const i=s(70655),o=s(96486),n=s(97792),r=s(14589),a=s(16778),l=s(88837),d=s(97691),c=s(60),h=s(89391),u=s(94224),p=s(76621),g=s(71830),m=s(62141),S=s(65848),f=s(31751),y=s(46096),_=s(36237),v=s(14976),C=s(83181),b=s(22538);var T;!function(e){e[e.ActiveConversationCount=0]="ActiveConversationCount",e[e.ZeroCountChanged=1]="ZeroCountChanged"}(T||(T={}));let M=class extends l.StoreBase{constructor(){super(200),this._notificationPromises=[],this._messageCounts={},this._activeConversationCount=0,this._onAppStateChange=e=>{e===a.Types.AppActivationState.Active&&this._recomputeActiveConversationCounts()},b.RegisterStartupable(this,"ConversationCalculationStore",[p.default])}setupPreStartupSubscriptions(){this._csdsToken&&this._csdsToken.unsubscribe(),this._csdsToken=p.default.conversationsUpdated.subscribe((e=>{let t=[],s=!1;if(o.each(e,(e=>{const i=e.counts;if(i&&this._messageCounts[e.conv.id]!==i){let o=this._messageCounts[e.conv.id]||S.BlankCounts;this._messageCounts[e.conv.id]=i;let n=!1;0===o.unreadCount!=(0===i.unreadCount)&&(s=!0),o.unreadCount===i.unreadCount&&o.unreadCountOverflowed===i.unreadCountOverflowed&&o.highPriorityUnreadCount===i.highPriorityUnreadCount&&o.hasUnread===i.hasUnread&&o.numMessagesSentByUser===i.numMessagesSentByUser&&o.consumptionHorizonTimestamp===i.consumptionHorizonTimestamp||(t.push(e.conv.id),n=!0),(o.unreadCount!==i.unreadCount||i.unreadCount>0)&&_.log(y.LogTraceArea.ConversationCalculations,"Conversation count - changed: "+n+" value: "+i.unreadCount+" for "+v.mriOrId(e.conv.id))}})),t.length>0){b.HasStarted(this)&&this.trigger(t);const e=this._recomputeActiveConversationCounts();this._notificationPromises.push(e),e.always((()=>{o.pull(this._notificationPromises,e)})),_.log(y.LogTraceArea.ConversationCalculations,"Unread conversation count: "+o.filter(this._messageCounts,(e=>e.unreadCount>0)).length)}s&&this.trigger(T.ZeroCountChanged)}))}startup(){return o.each(p.default.getRawConversationMetaMemoryCache(),(e=>{e&&e.counts&&(this._messageCounts[e.conv.id]=e.counts)})),C.default.performAfterUIStarted((()=>{o.defer((()=>{this._recomputeActiveConversationCounts()}))})),c.default.subscribeForChanges("ConversationCalculationStore",(e=>this._onAppStateChange(e))),d.Resolved()}test_reset(){this._messageCounts={},this._activeConversationCount=0}flushNotificationProcessingPromises(){const e=this._notificationPromises;return this._notificationPromises=[],d.all(e).then(o.noop)}getMessageCountsForConversation(e,t){if(t&&h.default.getS4LMessagingFeaturesNoSubscription().enableGroupedConversations){const t=f.default.getAllSiblingConversations(e);if(t.length>1){let s=0,i=0;return o.each(t,(e=>{if(u.default.ActiveCallUIHelper.hasActiveCall(e.id))return;const t=this._messageCounts[e.id];t&&(s+=t.unreadCount,i+=t.highPriorityUnreadCount)})),o.assign({},this._messageCounts[e],{hasUnread:s>0?1:0,unreadCount:s,highPriorityUnreadCount:i,unreadCountOverflowed:s>S.MaxUnreadMessageCount})}}return this._messageCounts[e]||S.BlankCounts}getConversationsWithUnreadCounts(){let e={};return o.each(this._messageCounts,((t,s)=>{t.unreadCount&&(e[s]=t)})),e}getSortedFrequentConversationMris(){let e=[];return o.each(this._messageCounts,((t,s)=>{t.numMessagesSentByUser>0&&(g.isUserMri(s)||g.isThread(s)||g.isAgent(s))&&e.push(s)})),o.sortBy(e,(e=>-this._messageCounts[e].numMessagesSentByUser))}getActiveRecentsConversationCount(){return this._activeConversationCount}_recomputeActiveConversationCounts(){const e=n.default.requestMaxTime("ConvCounts");let t,s=[];const i=h.default.getConfigSettingsNoSubscription().cortana.mri;if(b.HasStarted(this)){let e=0;o.each(this._messageCounts,((t,s)=>{s!==i&&t.hasUnread&&(g.isHighlightsThread(s)||e++)})),t=d.Resolved(e)}else t=m.default.getCountOfUnreadConversations(!1);return t.then((e=>(this._activeConversationCount!==e&&(this._activeConversationCount=e,s.push("activeConversationCount updated to "+e),this.trigger(T.ActiveConversationCount)),r.default.getCount().then((e=>{const t=this._activeConversationCount;e!==t&&(s.push("Home screen badge count: "+e+" => "+t),r.default.setCount(t)),s.length>0&&_.log(y.LogTraceArea.ConversationCalculations,"_recomputeActiveConversationCounts: "+s.join(", "))}))))).always((()=>{e.then((e=>n.default.release(e,"ConvCounts"))).catch(o.noop)}))}};(0,i.__decorate)([l.autoSubscribe,(0,i.__param)(0,l.key)],M.prototype,"getMessageCountsForConversation",null),(0,i.__decorate)([(0,l.autoSubscribeWithKey)(T.ZeroCountChanged)],M.prototype,"getConversationsWithUnreadCounts",null),(0,i.__decorate)([l.autoSubscribe],M.prototype,"getSortedFrequentConversationMris",null),(0,i.__decorate)([(0,l.autoSubscribeWithKey)(T.ActiveConversationCount)],M.prototype,"getActiveRecentsConversationCount",null),M=(0,i.__decorate)([l.AutoSubscribeStore],M),t.ConversationCalculationStore=M,t.default=new M},23293:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=s(96486),n=s(88837),r=s(97691),a=s(23606),l=s(10102),d=s(52262),c=s(46096),h=s(36237),u=s(89808),p=s(18078),g=s(22538),m=s(18037);let S=class extends n.StoreBase{constructor(){super(),this._colorInfoByMri={},g.RegisterStartupable(this,"ConversationColorStore",[d.default,m.default])}startup(){return this._overrideColorInfo=m.default.shouldOverrideColors(),d.default.subscribe((e=>{this._handleDisplayInfoStoreUpdates(e)})),u.default.subscribe((()=>{this._overrideColorInfo&&(h.log(c.LogTraceArea.ConversationColorStore,"Triggering color update for my user color change"),this.trigger())})),m.default.subscribe((()=>{const e=m.default.shouldOverrideColors();e!==this._overrideColorInfo&&(h.log(c.LogTraceArea.ConversationColorStore,"Triggering color update for theme change"),this._overrideColorInfo=e,this.trigger())})),r.Resolved()}getColorInfo(e,t=!1){if(this._overrideColorInfo&&!t)return u.default.getColorInfo();if(!e)return l.getDefaultUnknownColorInfo();let s=this._colorInfoByMri[e];return s||(s=this._getColorInfoWithDefault(e)),s||l.getDefaultUnknownColorInfo()}getPrimaryColor(e,t=!1){if(this._overrideColorInfo&&!t)return u.default.getPrimaryColor();const s=this.getColorInfo(e,t);return a.accentColor(s)}getGradientColors(e,t=!1){if(this._overrideColorInfo&&!t)return u.default.getGradientColors();const s=this.getColorInfo(e,t);return l.gradientColorsForColorInfo(s)}getSubtleGradientColors(e,t=!1){if(this._overrideColorInfo&&!t)return u.default.getSubtleGradientColors();const s=this.getColorInfo(e,t);return l.subtleGradientColorsForColorInfo(s)}_getColorInfoWithDefault(e){const t=d.default.getDisplayableProfile(e);let s=t?t.getColor():void 0;return l.isMatchingColorInfo(s,l.SerializedColorByNumber.Rainbow)&&(s=void 0),s||(s=l.getDefaultColorInfo(e)),this._colorInfoByMri[e]&&this._colorInfoByMri[e]===s||(this._colorInfoByMri[e]=s),s}_handleDisplayInfoStoreUpdates(e){const t=o.filter(e,(e=>{if(p.default.isMyMri(e))return!1;const t=this._colorInfoByMri[e],s=this._getColorInfoWithDefault(e);return!t||t!==s}));t.length>0&&this.trigger(t)}};(0,i.__decorate)([n.autoSubscribe,(0,i.__param)(0,n.key)],S.prototype,"getColorInfo",null),(0,i.__decorate)([n.autoSubscribe,(0,i.__param)(0,n.key)],S.prototype,"getPrimaryColor",null),(0,i.__decorate)([n.autoSubscribe,(0,i.__param)(0,n.key)],S.prototype,"getGradientColors",null),(0,i.__decorate)([n.autoSubscribe,(0,i.__param)(0,n.key)],S.prototype,"getSubtleGradientColors",null),S=(0,i.__decorate)([n.AutoSubscribeStore],S),t.default=new S},31751:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=s(96486),n=s(88837),r=s(97691),a=s(89391),l=s(71908),d=s(71830),c=s(39549),h=s(24339),u=s(41706),p=s(46096),g=s(62781),m=s(36237),S=s(14976),f=s(22538),y=s(72758);let _=class extends n.StoreBase{constructor(){super(),this._conversations={},this._updateConversations=e=>{const t=[];o.each(e,(e=>{const s=(0,c.default)().getConversation(e);if(s){const e=this._checkAndAddConversationMri(s);e&&t.push(e)}})),t.length&&this.trigger(t)},this._updateUsers=e=>{const t=[];o.each(e,(e=>{const s=y.default.getFullUserProfileByMri(e);s&&o.each(s.phones,(e=>{const s=d.sanitizeMri(e.number,d.Namespaces.PSTN),i=(0,c.default)().getConversation(s);if(i){const e=this._checkAndAddConversationMri(i);e&&t.push(e)}}))})),t.length&&this.trigger(t)},f.RegisterStartupable(this,"ConversationGroupingStore",[c.default,y.default])}_getPairedUserMri(e){let t=e.getOtherPartyMri();if(t)return y.default.getConversationOwner(t);m.log(p.LogTraceArea.ConversationGroupingStore,"_getPairedUserMri: getOtherPartyMri returned undefined")}_checkAndAddConversationMri(e){if(e.isOneOnOne()){const t=this._getPairedUserMri(e);if(t){this._conversations[t]||(this._conversations[t]=[]);const s=-1!==this._conversations[t].indexOf(e.id);if(s&&h.isConversationDisplayable(e))return t;if(!s)return this._conversations[t].push(e.id),t}}}startup(){const e=(0,c.default)();return o.each(e.getAllConversationsInMemory(),(e=>{e&&this._checkAndAddConversationMri(e)})),e.subscribe(this._updateConversations),y.default.subscribe(this._updateUsers),r.Resolved()}test_resetConversations(){this._conversations={}}getConversationsForUser(e,t=!0){if(this._conversations&&this._conversations[e]&&this._conversations[e].length)return o.compact(o.map(this._conversations[e],(e=>{const s=(0,c.default)().getConversation(e);if(!(t&&s&&s.isEncryptedThread())||u.default.shouldShowPrivateConv(e))return s})))}getDisplayableConversationsForUser(e){return o.filter(this.getAllSiblingConversations(e),(e=>h.isConversationDisplayable(e)))}getAllSiblingConversations(e){const t=(0,c.default)().getConversation(e);if(t||m.log(p.LogTraceArea.ConversationGroupingStore,"original conversation for "+S.mriOrId(e)+" does not exist"),!t&&d.isPhoneMri(e)){const t=this.getConversationsForUser(y.default.getConversationOwner(e));return this._maybeLogConversationsForUser(t,!0),t||[]}if(!t||t&&!t.isOneOnOne())return[];const s=this.getConversationsForUser(this._getPairedUserMri(t));return this._maybeLogConversationsForUser(s,!1),s||[]}_maybeLogConversationsForUser(e,t){if(o.isUndefined(e)||0===e.length){const s=o.isUndefined(e)?"undefined":"zero length",i=t?"PSTN case, ":"";m.log(p.LogTraceArea.ConversationGroupingStore,"getAllSiblingConversations: "+i+"conversationsForUser is "+s)}}isGroupMarkedAsFavorite(e){return o.some(this.getAllSiblingConversations(e),(e=>e.isFavorite()))}filterGrouped1on1s(e){return e&&a.default.getS4LMessagingFeaturesNoSubscription().enableGroupedConversations?o.uniqBy(e,(e=>{if(!e.isOneOnOne())return e.id;let t=e.getOtherPartyMri();return t&&(t=y.default.getConversationOwner(t)),t})):e}markGroupAsRead(e){o.each(this.getAllSiblingConversations(e),(e=>{l.markConversationRead(e.id)}))}removeFromFavorites(e){o.each(this.getAllSiblingConversations(e),(e=>{e.isFavorite()&&g.default.removeConversation(e.id)}))}addToFavorites(e){const t=(0,c.default)().getConversation(e);if(t){const e=this._getPairedUserMri(t);e&&g.default.addConversation(e)}}};(0,i.__decorate)([n.autoSubscribe,(0,i.__param)(0,n.key)],_.prototype,"getConversationsForUser",null),(0,i.__decorate)([n.autoSubscribe,(0,i.__param)(0,n.key)],_.prototype,"getDisplayableConversationsForUser",null),(0,i.__decorate)([n.autoSubscribe],_.prototype,"getAllSiblingConversations",null),(0,i.__decorate)([n.autoSubscribe,(0,i.__param)(0,n.key)],_.prototype,"isGroupMarkedAsFavorite",null),(0,i.__decorate)([n.autoSubscribe],_.prototype,"filterGrouped1on1s",null),_=(0,i.__decorate)([n.AutoSubscribeStore],_),t.default=new _},82453:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=(s(16778),s(88837)),n=s(97691),r=(s(60),s(99686)),a=(s(17093),s(27357)),l=s(22538);let d=class extends o.StoreBase{constructor(){super(100),this._appActive=!1,this._isVisible=!1,this._isUserActive=!1,this._shouldAnimate=!1,l.RegisterStartupable(this,"ConversationListAnimationStore",[a.default,r.default])}startup(){return this._appActive=!0,this._activitySubToken=r.default.subscribe((()=>{const e=r.default.isCurrentUserActive();e!==this._isUserActive&&(this._isUserActive=e,this._recalc())})),this._isUserActive=r.default.isCurrentUserActive(),this._isVisible=!0,this._recalc(),n.Resolved()}destroy(){this._activationSubToken&&(this._activationSubToken.unsubscribe(),this._activationSubToken=void 0),this._navigationSubToken&&(a.default.unsubscribe(this._navigationSubToken),this._navigationSubToken=void 0),this._activitySubToken&&(r.default.unsubscribe(this._activitySubToken),this._activitySubToken=void 0)}_recalc(){const e=this._isVisible&&this._appActive&&this._isUserActive;e!==this._shouldAnimate&&(this._shouldAnimate=e,this.trigger())}shouldAnimate(){return this._shouldAnimate}};(0,i.__decorate)([o.autoSubscribe],d.prototype,"shouldAnimate",null),d=(0,i.__decorate)([o.AutoSubscribeStore],d),t.default=new d},82146:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RetrievalMask=t.RetrievalState=void 0;const i=s(70655),o=s(96486),n=s(88837),r=s(97691),a=s(89391),l=s(81169),d=s(76621),c=s(51077),h=s(81697),u=s(62141),p=s(18083),g=s(46096),m=s(36237),S=s(61253),f=s(64387),y=s(14976),_=s(9212),v=s(53374);var C,b;!function(e){e[e.None=0]="None",e[e.Retrieving=1]="Retrieving",e[e.Failed=2]="Failed",e[e.Retrieved=3]="Retrieved"}(C=t.RetrievalState||(t.RetrievalState={})),function(e){e[e.Files=1]="Files",e[e.Media=2]="Media",e[e.Links=4]="Links",e[e.All=7]="All"}(b=t.RetrievalMask||(t.RetrievalMask={}));const T=e=>e||[];let M=class extends n.StoreBase{constructor(){super(...arguments),this._conversations={},this._populateSurroundMediaInProgress={},this._fetchFilesLinksMediaForConversation=(e,t)=>{this._needsMoreFileMessages(e)&&this._getFilesForConversation(e,t),this._needsMoreLinksMessages(e)&&this._getLinksForConversation(e,t),this._needsMoreMediaMessages(e)&&this._getMediaForConversation(e,t)},this._processNextConversationMessagesFromDb=(e,t)=>{if(!e||!e.length)return m.log(g.LogTraceArea.ConversationMediaStore,"_processNextConversationMessages() No more messages proccessed. causeId:"+t),r.Resolved();const s=o.filter(e,(e=>this._isSupportedMessage(e))),i=s.length,n=o.last(e).conversationId;return m.log(g.LogTraceArea.ConversationMediaStore,"_processNextConversationMessages() conversationId: "+y.mriOrId(n)+" numMediaMessages: "+i+", causeId: "+t),this._conversations[n]&&i?this._putMessages(n,s,!1,t):r.Resolved()},this._processPreviousConversationMessagesFromDb=(e,t,s)=>{if(!this._conversations[t])return r.Resolved();let i=r.Resolved();if(e.length){const n=o.filter(e,(e=>this._isSupportedMessage(e))),r=o.last(e).createdTime;m.log(g.LogTraceArea.ConversationMediaStore,"_processPreviousConversationMessages() conversationId: "+y.mriOrId(t)+" supportedMessages: "+n.length+" causeId: "+s),this._conversations[t].lastPreviousItemTime&&r<this._conversations[t].lastPreviousItemTime&&e.length&&(this._conversations[t].lastPreviousItemTime=r),i=this._putMessages(t,n,!1,s)}return!this._needsMoreMessages(t,!1)||this._conversations[t].retrievedFromService||this._retrievalFromServiceFailedInTheLastMinute(t)||(m.log(g.LogTraceArea.ConversationMediaStore,"_processPreviousConversationMessages() Fetching items"),this._fetchFilesLinksMediaForConversation(t,s)),i},this._processSuccessfulSearchResults=(e,t,s)=>{let i=[];const n=(0,l.chain)(e,(0,l.map)((e=>p.default.simulateFullMessage(e,c.MessageTypes.UriObject,t))),(0,l.compact)(),(0,l.filter)((e=>!(!e.cuid||!this._isSupportedMessage(e))&&(i.push(e.cuid),!0))));m.log(g.LogTraceArea.ConversationMediaStore,"_processSuccessfulSearchResults() Processing "+n.length+" results conversationId: "+y.mriOrId(t)+", causeId: "+s),u.default.openTransaction([u.Stores.Messages,u.Stores.Conversations],!0).then((e=>{m.log(g.LogTraceArea.ConversationMediaStore,"_processSuccessfulSearchResults() Getting local messages conversationId: "+y.mriOrId(t));const a=d.default.getConversationMetaAsync(t,e),l=e.getMessagesByCuid(t,i);return r.all([a,l]).then((([i,r])=>{const a=o.map(r,(e=>e.cuid)),l=i?i.conv.getDeletedTimestamp():0,d=o.filter(n,(e=>e.createdTime>l));this._putMessages(t,d,!0,s),m.log(g.LogTraceArea.ConversationMediaStore,"_processSuccessfulSearchResults() Found "+a.length+" messages stored locally for  conversationId: "+y.mriOrId(t));let c=d;a&&a.length&&(c=o.filter(d,(e=>-1===o.indexOf(a,e.cuid)))),c.length&&(m.log(g.LogTraceArea.ConversationMediaStore,"_processSuccessfulSearchResults() Putting "+c.length+" messages locally for  conversationId: "+y.mriOrId(t)),e.putMessages(c))}))}))}}_startedTrackingKey(e){this._conversations[e]||(m.log(g.LogTraceArea.ConversationMediaStore,"_startedTrackingKey() New conversationId: "+y.mriOrId(e)),0===o.size(this._conversations)&&(this._messagesProcessedSubscriptionToken=d.default.messagesProcessed.subscribe((e=>{const t=v.default.newCauseId();m.log(g.LogTraceArea.ConversationMediaStore,"messagesProcessed: causeId: "+t),(0,l.chain)(e,(0,l.filter)((e=>e.conversationId in this._conversations&&this._isSupportedMessage(e)&&!e.isMessageLie())),(0,l.groupBy)((e=>e.conversationId)),(0,l.eachWithKey)(((e,s)=>{this._putMessages(s,e,!1,t)})))})),this._conversationsUpdatedSubscriptionToken=d.default.conversationsUpdated.subscribe((e=>{const t=v.default.newCauseId();m.log(g.LogTraceArea.ConversationMediaStore,"conversationsUpdated: causeId: "+t),o.each(e,(e=>{e.conv.isDeleted()&&this._conversations[e.conv.id]&&(this._conversations[e.conv.id].media.messages=[],this._conversations[e.conv.id].files.messages=[],this._conversations[e.conv.id].links.messages=[],this._conversations[e.conv.id].retrievedFromService=!0,this._conversations[e.conv.id].lastNextItemTime=void 0,this._conversations[e.conv.id].lastPreviousItemTime=void 0,m.log(g.LogTraceArea.ConversationMediaStore,"conversationsUpdated: triggering: "+y.mriOrId(e.conv.id)+" causeId: "+t),this.trigger(e.conv.id))}))}))),this._conversations[e]={media:{messages:[],minResults:5,searchBase:0},files:{messages:[],minResults:5,searchBase:0},links:{messages:[],minResults:5,searchBase:0},isReverse:!1,lastNextItemTime:void 0,lastPreviousItemTime:void 0,retrievedFromService:!1,mediaRetrievalState:C.None,filesRetrievalState:C.None,linksRetrievalState:C.None})}_stoppedTrackingKey(e){m.log(g.LogTraceArea.ConversationMediaStore,"_stoppedTrackingKey() Stop tracking conversationId: "+y.mriOrId(e)),delete this._conversations[e],0===o.size(this._conversations)&&(this._messagesProcessedSubscriptionToken.unsubscribe(),this._messagesProcessedSubscriptionToken=void 0,this._conversationsUpdatedSubscriptionToken.unsubscribe(),this._conversationsUpdatedSubscriptionToken=void 0)}_isSupportedMessage(e){return f.default.isMediaItem(e)||f.default.isFile(e)||f.default.isLink(e)||f.default.isSwiftCardWithLink(e)||e.isDeletedMessage()}_putMessages(e,t,s,i){if(!this._conversations[e])return r.Resolved();let n=[],a=[],d=[],c=[],h=[];[h,n]=o.partition(t,(e=>e.isDeletedMessage())),o.each(n,(e=>{f.default.isFile(e)?a.push(e):f.default.isMediaItem(e)?c.push(e):d.push(e)})),m.log(g.LogTraceArea.ConversationMediaStore,"_putMessages() conversationId: "+y.mriOrId(e)+" filesToAdd: "+a.length+" linksToAdd: "+d.length+" mediaToAdd: "+c.length+" messagesToDelete: "+h.length+" causeId: "+i);let u=!1;h.length&&o.each(h,(t=>{let s,i;switch(o.each([this._conversations[e].files.messages,this._conversations[e].links.messages,this._conversations[e].media.messages],((e,n)=>(s=o.find(e,(e=>e.cuid===t.cuid)),!s||(i=n,u=!0,!1)))),i){case 0:this._conversations[e].files.messages=o.without(this._conversations[e].files.messages,s);break;case 1:this._conversations[e].links.messages=o.without(this._conversations[e].links.messages,s);break;case 2:this._conversations[e].media.messages=o.without(this._conversations[e].media.messages,s)}}));const p=this._conversations[e].isReverse,_=[a,d,c];return o.each(_,((t,i)=>{let n=[];0===i?(n=this._conversations[e].files.messages,m.log(g.LogTraceArea.ConversationMediaStore,"_putMessages() FILES existingItems: "+n.length)):1===i?(n=this._conversations[e].links.messages,m.log(g.LogTraceArea.ConversationMediaStore,"_putMessages() LINKS existingItems: "+n.length)):2===i&&(n=this._conversations[e].media.messages,m.log(g.LogTraceArea.ConversationMediaStore,"_putMessages() mediaToAdd existingItems: "+n.length)),t=o.filter(t,(e=>!o.some(n,(t=>t.cuid===e.cuid&&(s||(0,S.default)(t,e)))))),u=u||t.length>0;const r=(0,l.chain)(n,(0,l.concat)(t),(0,l.uniqBy)((e=>e.cuid)),(0,l.sortBy)((e=>(p?-1:1)*e.createdTime)),(0,l.filter)((e=>!e.isDeletedMessage())));0===i?(this._conversations[e].files.messages=r,m.log(g.LogTraceArea.ConversationMediaStore,"_putMessages() FILES mergedUniqueSortedItems: "+r.length)):1===i?(this._conversations[e].links.messages=r,m.log(g.LogTraceArea.ConversationMediaStore,"_putMessages() LINKS mergedUniqueSortedItems: "+r.length)):2===i&&(this._conversations[e].media.messages=r,m.log(g.LogTraceArea.ConversationMediaStore,"_putMessages() MEDIA mergedUniqueSortedItems: "+r.length))})),u&&(m.log(g.LogTraceArea.ConversationMediaStore,"_putMessages() triggering "+y.mriOrId(e)+" causeId: "+i),this.trigger(e)),r.Resolved()}_needsMoreMessages(e,t){return this._needsMoreFileMessages(e)||this._needsMoreLinksMessages(e)||this._needsMoreMediaMessages(e,t)}_needsMoreFileMessages(e){return this._conversations[e].files.messages.length<this._conversations[e].files.minResults}_needsMoreLinksMessages(e){return this._conversations[e].links.messages.length<this._conversations[e].links.minResults}_needsMoreMediaMessages(e,t=!1){const s=this._conversations[e].media.messages.length;return!t&&s<this._conversations[e].media.minResults||t&&s===this._conversations[e].media.minResults}_getFilesForConversation(e,t){if(this._conversations[e].filesRetrievalState===C.Retrieving)return void m.log(g.LogTraceArea.ConversationMediaStore,"ignoring _getFilesForConversation - retrieval in progress. causeId: "+t);this._conversations[e].filesRetrievalState=C.Retrieving;const s=this._conversations[e].files.searchBase;m.log(g.LogTraceArea.ConversationMediaStore,"_getFilesForConversation Fetching FILES conversationId: "+y.mriOrId(e)+" searchOffset: "+s+", causeId: "+t),_.default.getFilesForConversation(e,s).then(T).then((s=>{this._conversations[e]&&(this._conversations[e].retrievedFromService=!0,this._conversations[e].filesRetrievalState=C.Retrieved,this.trigger(e),m.log(g.LogTraceArea.ConversationMediaStore,"_getFilesForConversation retrieved FILES conversationId: "+y.mriOrId(e)+" results: "+s.length+" causeId: "+t),this._processSuccessfulSearchResults(s,e,t))})).catch((t=>{this._conversations[e]&&(this._conversations[e].filesRetrievalState=C.Failed,this._conversations[e].retrievalFailedTimestamp=Date.now(),this.trigger(e),m.warn(g.LogTraceArea.ConversationMediaStore,"_getFilesForConversation failed to retrieve FILES conversationId: "+y.mriOrId(e)+" error: "+t.statusCode+" - "+t.statusText))}))}_getLinksForConversation(e,t){if(this._conversations[e].linksRetrievalState===C.Retrieving)return void m.log(g.LogTraceArea.ConversationMediaStore,"ignoring _getLinksForConversation - retrieval in progress. causeId: "+t);this._conversations[e].linksRetrievalState=C.Retrieving;const s=this._conversations[e].links.searchBase;m.log(g.LogTraceArea.ConversationMediaStore,"_getLinksForConversation Fetching LINKS conversationId: "+y.mriOrId(e)+" searchOffset: "+s+", causeId: "+t),_.default.getLinksAndCardsForConversation(e,s).then(T).then((s=>{this._conversations[e]&&(this._conversations[e].retrievedFromService=!0,this._conversations[e].linksRetrievalState=C.Retrieved,this.trigger(e),m.log(g.LogTraceArea.ConversationMediaStore,"_getLinksForConversation retrieved LINKS conversationId: "+y.mriOrId(e)+" results: "+s.length+" causeId: "+t),this._processSuccessfulSearchResults(s,e,t))})).catch((s=>{this._conversations[e]&&(this._conversations[e].linksRetrievalState=C.Failed,this._conversations[e].retrievalFailedTimestamp=Date.now(),this.trigger(e),m.warn(g.LogTraceArea.ConversationMediaStore,"_getLinksForConversation failed to retrieve LINKS conversationId: "+y.mriOrId(e)+" error: "+s.statusCode+" - "+s.statusText+" causeId: "+t))}))}_getMediaForConversation(e,t){if(this._conversations[e].mediaRetrievalState===C.Retrieving)return void m.log(g.LogTraceArea.ConversationMediaStore,"ignoring _getMediaForConversation - retrieval in progress. causeId: "+t);this._conversations[e].mediaRetrievalState=C.Retrieving;const s=this._conversations[e].media.searchBase;m.log(g.LogTraceArea.ConversationMediaStore,"_getMediaForConversation Fetching MEDIA conversationId: "+y.mriOrId(e)+" searchOffset: "+s+", causeId: "+t),_.default.getMediaForConversation(e,s).then(T).then((s=>{this._conversations[e]&&(this._conversations[e].retrievedFromService=!0,this._conversations[e].mediaRetrievalState=C.Retrieved,this.trigger(e),m.log(g.LogTraceArea.ConversationMediaStore,"_getMediaForConversation retrieved MEDIA conversationId: "+y.mriOrId(e)+" results: "+s.length+" causeId: "+t),this._processSuccessfulSearchResults(s,e,t))})).catch((s=>{this._conversations[e]&&(this._conversations[e].mediaRetrievalState=C.Failed,this._conversations[e].retrievalFailedTimestamp=Date.now(),this.trigger(e),m.warn(g.LogTraceArea.ConversationMediaStore,"_getMediaForConversation failed to retrieve MEDIA conversationId: "+y.mriOrId(e)+" error: "+s.statusCode+" - "+s.statusText+" causeId: "+t))}))}_retrievalFromServiceFailedInTheLastMinute(e){const t=this._conversations[e],s=Date.now()-6e4;return!!t.retrievalFailedTimestamp&&t.retrievalFailedTimestamp>s}_initMinResults(e,t,s,i){this._conversations[e].files.minResults=t,this._conversations[e].links.minResults=s,this._conversations[e].media.minResults=i}_initConversation(e,t,s,i,o,n){m.log(g.LogTraceArea.ConversationMediaStore,"_initConversation conversationId: "+y.mriOrId(e)+", causeId: "+n);const r=this._conversations[e];r.isReverse=i,r.lastNextItemTime||r.lastPreviousItemTime?s&&(r.retrievedFromService=!1,m.log(g.LogTraceArea.ConversationMediaStore,"_initConv: getting more (3) causeId: "+n),this.populateSurroundMediaForConversation(e,!0,n)):(this._conversations[e].lastNextItemTime=t,this._conversations[e].lastPreviousItemTime=t,o?o.then((()=>{m.log(g.LogTraceArea.ConversationMediaStore,"_initConv: getting more (1) causeId: "+n),this.populateSurroundMediaForConversation(e,!1,n)})):(m.log(g.LogTraceArea.ConversationMediaStore,"_initConv: getting more (2) causeId: "+n),this.populateSurroundMediaForConversation(e,!1,n)))}getCombinedRetrievalState(e){let t=C.None;const s=this._conversations[e].mediaRetrievalState,i=this._conversations[e].filesRetrievalState,o=this._conversations[e].linksRetrievalState;return s===i&&i===o?t=s:s===C.Failed||i===C.Failed||o===C.Failed?t=C.Failed:s===C.Retrieving||i===C.Retrieving||o===C.Retrieving?t=C.Retrieving:s!==C.Retrieved&&i!==C.Retrieved&&o!==C.Retrieved||(t=C.Retrieved),m.log(g.LogTraceArea.ConversationMediaStore,"getCombinedRetrievalState() combinedRetrievalState: "+t),t}getMediaRetrievalState(e){const t=this._conversations[e].mediaRetrievalState;return m.log(g.LogTraceArea.ConversationMediaStore,"getMediaRetrievalState() mediaRetrievalState: "+t),t}getFilesRetrievalState(e){const t=this._conversations[e].filesRetrievalState;return m.log(g.LogTraceArea.ConversationMediaStore,"getFilesRetrievalState() filesRetrievalState: "+t),t}getLinksRetrievalState(e){const t=this._conversations[e].linksRetrievalState;return m.log(g.LogTraceArea.ConversationMediaStore,"getLinksRetrievalState() linksRetrievalState: "+t),t}getMediaForConversation(e,t,s=5,i=!1,n,r){const a=v.default.newCauseId(),l=this._conversations[e].media.messages;return m.log(g.LogTraceArea.ConversationMediaStore,"getMediaForConversation() MEDIA mediaMessages: "+l.length+", causeId: "+a),this._initMinResults(e,0,0,s),this._initConversation(e,t,i,!!n,r,a),o.sortBy(l,(e=>(n?-1:1)*e.createdTime))}getFilesForConversation(e,t,s=5,i=!1,n){const r=v.default.newCauseId(),a=this._conversations[e].files.messages;return m.log(g.LogTraceArea.ConversationMediaStore,"getFilesForConversation() FILES fileMessages: "+a.length+", causeId: "+r),this._initMinResults(e,s,0,0),this._initConversation(e,t,i,!!n,void 0,r),o.sortBy(a,(e=>(n?-1:1)*e.createdTime))}getLinksForConversation(e,t,s=5,i=!1,n){const r=v.default.newCauseId(),a=this._conversations[e].links.messages;return m.log(g.LogTraceArea.ConversationMediaStore,"getLinksForConversation() LINKS linkMessages: "+a.length+", causeId: "+r),this._initMinResults(e,0,s,0),this._initConversation(e,t,i,!!n,void 0,r),o.sortBy(a,(e=>(n?-1:1)*e.createdTime))}getCombinedItemsForConversation(e,t,s=5,i=!1,n){const r=v.default.newCauseId(),a=this._conversations[e].files.messages,l=this._conversations[e].links.messages,d=this._conversations[e].media.messages,c=this._conversations[e].isReverse;return m.log(g.LogTraceArea.ConversationMediaStore,"getCombinedItemsForConversation(): "+y.mriOrId(e)+" causeId: "+r),this._initMinResults(e,s,s,s),this._initConversation(e,t,i,!!n,void 0,r),o.sortBy(a.concat(l,d),(e=>(c?-1:1)*e.createdTime))}fetchMoreMessages(e,t){if(!this._conversations[e])return;const s=v.default.newCauseId();if(m.log(g.LogTraceArea.ConversationMediaStore,"fetchMoreMessages("+t+"): conversationId: "+y.mriOrId(e)+" causeId: "+s),t&b.Media){const t=this._conversations[e].media.messages.length;t>0&&t-1>this._conversations[e].media.searchBase?(this._conversations[e].media.searchBase=t-1,this._getMediaForConversation(e,s)):m.log(g.LogTraceArea.ConversationMediaStore,"no more media to get. causeId: "+s)}if(t&b.Links){const t=this._conversations[e].links.messages.length;t>0&&t-1>this._conversations[e].links.searchBase?(this._conversations[e].links.searchBase=t-1,this._getLinksForConversation(e,s)):m.log(g.LogTraceArea.ConversationMediaStore,"no more links to get. causeId: "+s)}if(t&b.Files){const t=this._conversations[e].files.messages.length;t>0&&t-1>this._conversations[e].files.searchBase?(this._conversations[e].files.searchBase=t-1,this._getFilesForConversation(e,s)):m.log(g.LogTraceArea.ConversationMediaStore,"no more files to get. causeId: "+s)}}isPopulatingOfSurroundMediaInProgressForConversation(e){return this._populateSurroundMediaInProgress[e]}populateSurroundMediaForConversation(e,t,s){return s=s+":"+v.default.newCauseId(),m.log(g.LogTraceArea.ConversationMediaStore,"populateSurroundMediaForConversation() conversationId: "+y.mriOrId(e)+" causeId: "+s),this._populateSurroundMediaInProgress[e]&&!t?r.Resolved():(this._populateSurroundMediaInProgress[e]=!0,r.all([this.populateNextMediaForConversation(e,s),this.populatePreviousMediaForConversation(e,s)]).then((()=>{this._populateSurroundMediaInProgress[e]=!1,this.trigger(e)})))}populateNextMediaForConversation(e,t){return t=t+":"+v.default.newCauseId(),m.log(g.LogTraceArea.ConversationMediaStore,"populateNextMediaForConversation() conversationId: "+y.mriOrId(e)+" causeId: "+t),this._conversations[e]?(m.log(g.LogTraceArea.ConversationMediaStore,"populateNextMediaForConversation() lastNextItemTime: "+new Date(this._conversations[e].lastNextItemTime).toString()+", causeId: "+t),u.default.getMessagesForConversationAfterTime(e,this._conversations[e].lastNextItemTime,this._getMaxMessagesToLoad(),!1).then((e=>this._processNextConversationMessagesFromDb(e,t)))):r.Resolved()}populatePreviousMediaForConversation(e,t){if(t=t+":"+v.default.newCauseId(),m.log(g.LogTraceArea.ConversationMediaStore,"populatePreviousMediaForConversation() conversationId: "+y.mriOrId(e)+", causeId: "+t),this._conversations[e]){const s=this._conversations[e].lastPreviousItemTime;m.log(g.LogTraceArea.ConversationMediaStore,"populatePreviousMediaForConversation() lastPreviousItemTime: "+new Date(s).toString()+", causeId: "+t);const i=h.default.getEarliestKnownMessageTime(e);return i===Number.MAX_VALUE||s<i?u.default.getMessagesForConversationBeforeTime(e,s,25,!1).then((s=>this._processPreviousConversationMessagesFromDb(s,e,t))):u.default.getMessagesForConversationAndTimeRange(e,i,s,!1,this._getMaxMessagesToLoad()).then((s=>this._processPreviousConversationMessagesFromDb(s,e,t)))}return r.Resolved()}_getMaxMessagesToLoad(){return a.default.getS4LMessagingFeatures().maxMessagesToLoadFromDBForMediaSearch||25}test_setIsPopulatingOfSurroundMediaInProgressForConversation(e,t){this._populateSurroundMediaInProgress[e]=t}};(0,i.__decorate)([n.disableWarnings],M.prototype,"_startedTrackingKey",null),(0,i.__decorate)([n.disableWarnings],M.prototype,"_stoppedTrackingKey",null),(0,i.__decorate)([n.autoSubscribe,(0,i.__param)(0,n.key)],M.prototype,"getCombinedRetrievalState",null),(0,i.__decorate)([n.autoSubscribe,(0,i.__param)(0,n.key)],M.prototype,"getMediaRetrievalState",null),(0,i.__decorate)([n.autoSubscribe,(0,i.__param)(0,n.key)],M.prototype,"getFilesRetrievalState",null),(0,i.__decorate)([n.autoSubscribe,(0,i.__param)(0,n.key)],M.prototype,"getLinksRetrievalState",null),(0,i.__decorate)([n.autoSubscribe,(0,i.__param)(0,n.key)],M.prototype,"getMediaForConversation",null),(0,i.__decorate)([n.autoSubscribe,(0,i.__param)(0,n.key)],M.prototype,"getFilesForConversation",null),(0,i.__decorate)([n.autoSubscribe,(0,i.__param)(0,n.key)],M.prototype,"getLinksForConversation",null),(0,i.__decorate)([n.autoSubscribe,(0,i.__param)(0,n.key)],M.prototype,"getCombinedItemsForConversation",null),(0,i.__decorate)([n.autoSubscribe],M.prototype,"fetchMoreMessages",null),(0,i.__decorate)([n.autoSubscribe,(0,i.__param)(0,n.key)],M.prototype,"isPopulatingOfSurroundMediaInProgressForConversation",null),M=(0,i.__decorate)([n.AutoSubscribeStore],M),t.default=new M},29241:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NOT_FOUND=void 0;const i=s(70655),o=s(96486),n=s(88837),r=s(97691),a=s(89391),l=s(71830),d=s(39549),c=s(16402),h=s(46096),u=s(36237),p=s(61253),g=s(35762),m=s(9212),S=s(53374),f=s(10996),y=s(69399);var _;t.NOT_FOUND=-1,function(e){e[e.SearchVisibility=0]="SearchVisibility",e[e.Timestamp=1]="Timestamp",e[e.Loading=2]="Loading",e[e.FocusedMessageIndex=3]="FocusedMessageIndex",e[e.Results=4]="Results",e[e.Query=5]="Query",e[e.Highlight=6]="Highlight"}(_||(_={}));const v={query:"",messageId:void 0};let C=class extends n.StoreBase{constructor(){super(...arguments),this._results=[],this._focusedMessageIndex=t.NOT_FOUND,this._isLoading=!1,this._resultMessageIds=[]}getSearchQuery(){return this._searchConversationQuery}findQuery(e,t,s){if(this._querySessionId=s,(0,p.default)(this._searchConversationQuery,e))return r.Resolved(this._results.length);if(this._searchConversationQuery=e,this._conversationId=t,0!==o.trim(e.query).length){this._isLoading=!0;const e=this._search(this._searchConversationQuery,t);return this.trigger([_.Query,_.Loading]),e}return this._clearData(),r.Resolved(0)}resetSearch(){this._searchConversationQuery=v,u.log(h.LogTraceArea.MessageSearch,"Reset search"),this._clearData()}cancelSearch(){this._searchConversationQuery=void 0,this._conversationId=void 0,u.log(h.LogTraceArea.MessageSearch,"Cancel search"),this._clearData()}getResults(){return this._results}isLoadingResults(){return this._isLoading}isMessageInConvSearchResults(e){return o.includes(this._resultMessageIds,e)}setTimestamp(e,t,s,i){e&&(o.isUndefined(this._conversationId)||(0,f.markMessageSearchScenarioResultMessageTimestamp)(this._querySessionId,e,this._conversationId),this._scrollRequest=e?{id:s||S.default.newGuid(),messageTimestamp:e,zeroTermSearch:!!i,cuid:t}:void 0,u.log(h.LogTraceArea.MessageSearch,`Search for message with timestamp: ${e}, cuid: ${t}`),this.trigger(_.Timestamp))}getTimestamp(){return this._scrollRequest}focusMessage(e){if(this._resultMessageIds){const t=this._resultMessageIds.indexOf(e);t>=0&&(this._focusedMessageIndex=t,this.trigger(_.FocusedMessageIndex))}}focusPreviousMessage(){this._focusedMessageIndex<this._results.length-1&&(this._focusedMessageIndex++,u.log(h.LogTraceArea.MessageSearch,"Navigating to previous result. Current message index: "+this._focusedMessageIndex),u.track(new g.NavigatedToPrevResult),(0,f.invalidateSearchScenario)(y.ScenarioSearchTypes.MessageInConversation,this._querySessionId),this.trigger(_.FocusedMessageIndex))}focusNextMessage(){this._focusedMessageIndex>0&&(this._focusedMessageIndex--,u.log(h.LogTraceArea.MessageSearch,"Navigating to next result. Current message index: "+this._focusedMessageIndex),u.track(new g.NavigatedToNextResult),(0,f.invalidateSearchScenario)(y.ScenarioSearchTypes.MessageInConversation,this._querySessionId),this.trigger(_.FocusedMessageIndex))}isFocusingNextDisabled(){return 0===this._focusedMessageIndex||0===this._results.length}isFocusingPreviousDisabled(){return 0===this._results.length||this._focusedMessageIndex+1===this._results.length}getFocusedMessageIndex(){return this._focusedMessageIndex}isMessageFocused(e){if(this._focusedMessageIndex!==t.NOT_FOUND){const t=this._results[this._focusedMessageIndex];return!!t&&t.MessageId===e}return!1}_search(e,t){return m.default.getSearchResults({query:e.query,limit:a.default.getS4LMessagingFeaturesNoSubscription().inConversationMessageSearch.initialPageSize,conversationId:t}).then((s=>{if(!this._searchConversationQuery||this._searchConversationQuery.query!==e.query||t!==this._conversationId)return r.Rejected();let i=s;const n=(0,d.default)().getConversation(t);if(n){const e=n.getConversationProperty(l.ConversationProps.DeleteTimestamp);e&&(i=o.filter(s,(t=>this._isResultDisplayable(t,e))))}return this._updateResults(i,e),this._results.length}))}_updateResults(e,s){if(e.length>0&&s.messageId){const t=o.findIndex(e,(e=>e.MessageId===s.messageId));this._focusedMessageIndex=t,u.log(h.LogTraceArea.MessageSearch,"Updating current message index: "+this._focusedMessageIndex)}else this._focusedMessageIndex=e.length?0:t.NOT_FOUND;this._results=e,this._isLoading=!1,this._resultMessageIds=e.map((e=>e.MessageId)),u.log(h.LogTraceArea.MessageSearch,"Updating search results. Count: "+this._results.length+". Current message index: "+this._focusedMessageIndex),this.trigger([_.Results,_.FocusedMessageIndex,_.Loading])}_isResultDisplayable(e,t){return c.default.getUnixMillisecondsTimestamp(e.CreationDate)>t}_clearData(){this._focusedMessageIndex=t.NOT_FOUND,this._results=[],this._resultMessageIds=[],this._isLoading=!1,this._scrollRequest=void 0,this.trigger([_.FocusedMessageIndex,_.Results,_.Loading,_.Query,_.Timestamp])}};(0,i.__decorate)([(0,n.autoSubscribeWithKey)(_.Query)],C.prototype,"getSearchQuery",null),(0,i.__decorate)([n.disableWarnings],C.prototype,"findQuery",null),(0,i.__decorate)([(0,n.autoSubscribeWithKey)(_.Results)],C.prototype,"getResults",null),(0,i.__decorate)([(0,n.autoSubscribeWithKey)(_.Loading)],C.prototype,"isLoadingResults",null),(0,i.__decorate)([(0,n.autoSubscribeWithKey)(_.Results)],C.prototype,"isMessageInConvSearchResults",null),(0,i.__decorate)([(0,n.autoSubscribeWithKey)(_.Timestamp)],C.prototype,"getTimestamp",null),(0,i.__decorate)([n.disableWarnings],C.prototype,"focusMessage",null),(0,i.__decorate)([(0,n.autoSubscribeWithKey)([_.FocusedMessageIndex,_.Results])],C.prototype,"isFocusingNextDisabled",null),(0,i.__decorate)([(0,n.autoSubscribeWithKey)([_.FocusedMessageIndex,_.Results])],C.prototype,"isFocusingPreviousDisabled",null),(0,i.__decorate)([(0,n.autoSubscribeWithKey)(_.FocusedMessageIndex)],C.prototype,"getFocusedMessageIndex",null),(0,i.__decorate)([(0,n.autoSubscribeWithKey)([_.FocusedMessageIndex,_.Results])],C.prototype,"isMessageFocused",null),C=(0,i.__decorate)([n.AutoSubscribeStore],C),t.default=C},46992:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=s(96486),n=s(88837);let r=class extends n.StoreBase{constructor(){super(...arguments),this._selectedConversations=[]}getSelectedConversations(){return this._selectedConversations}addConversation(e){this._selectedConversations=this._selectedConversations.concat(e),this.trigger()}removeConversation(e){this._selectedConversations=o.without(this._selectedConversations,e),this.trigger()}};(0,i.__decorate)([n.autoSubscribe],r.prototype,"getSelectedConversations",null),r=(0,i.__decorate)([n.AutoSubscribeStore],r),t.default=r},85641:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=s(88837),n=s(61253);let r=class extends o.StoreBase{constructor(){super(...arguments),this._spacerWidths={left:0,right:0}}storeSpacerWidths(e){(0,n.default)(this._spacerWidths,e)||(this._spacerWidths=e,this.trigger())}getSpacerWidths(){return this._spacerWidths}setRightPositionForJumpToBottomButton(e){this._jumpToBottomRightPosition!==e&&(this._jumpToBottomRightPosition=e,this.trigger())}getRightPositionForJumpToBottomButton(){return this._jumpToBottomRightPosition}};(0,i.__decorate)([o.autoSubscribe],r.prototype,"getSpacerWidths",null),(0,i.__decorate)([o.autoSubscribe],r.prototype,"getRightPositionForJumpToBottomButton",null),r=(0,i.__decorate)([o.AutoSubscribeStore],r),t.default=new r},20770:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=s(96486),n=s(79737),r=s(88837),a=s(74634),l=s(97691),d=s(89391),c=s(39549),h=s(28802),u=s(92069),p=s(66355),g=s(57347),m=s(97174),S=s(23944),f=s(36237),y=s(61253),_=s(14976),v=s(57946),C=s(22538);let b=class extends r.StoreBase{constructor(){super(),this.onInputEntitiesUpdatedEvent=new a.default,this._conversations={},this._conversationsBuffer={},this.saveMessageInput=(e,t)=>{if(!this._conversations[e]||!(0,y.default)(this._conversations[e].messages,t.messages)||this._conversations[e].type!==t.type){const s=o.join(o.map(t.messages,(e=>e.cuid)));f.log(p.LogTraceArea.ConversationsDraftStore,`saveMessageInput for conversation: ${_.mriOrId(e)}, messageType: ${v.SavedMessageType[t.type]}`+(o.isEmpty(s)?"":`, message ids: ${s}`)+`, currently stored: ${this.getConversationsNumber()}`)}this._conversationsBuffer[e]=Object.assign({},t)},this.clearMessageInput=e=>{this.getSavedMessageInput(e)&&(f.log(p.LogTraceArea.ConversationsDraftStore,`clearMessageInput for conversation: ${_.mriOrId(e)}, still stored: ${Object.keys(this._conversations).length}`),d.default.getS4LMessagingFeaturesNoSubscription().enableDraftMessagesPersistentStorage&&h.default.deleteSavedMessage(e).catch(o.noop)),delete this._conversations[e],delete this._conversationsBuffer[e],this.trigger(e)},this.storeSavedMessage=e=>{const t=this._conversations[e];return t?h.default.storeSavedMessage(e,t):l.Resolved()},this._setSavedMessageInputs=e=>{f.log(p.LogTraceArea.ConversationsDraftStore,`onLoadSavedMessageInputs for conversationsloaded: ${e.length}`),e.forEach((e=>{const t=e&&e.conversationId?e.conversationId:void 0;t&&(this._conversations[t]=e)})),this._cleanupBlankEntries()},this._updateInputEntities=e=>{const t=e.forCustomContext,s=this._conversationsBuffer[t]||this._conversations[t];if(s)s.inputEntitiesDataVersion<=e.newContent.downStreamDataVersion&&(this._conversationsBuffer[t]=Object.assign(Object.assign({},s),{inputEntities:S.applyEditableContentToInputEntities(e.newContent,s.inputEntities)}),f.log(p.LogTraceArea.ConversationsDraftStore,`_updateInputEntities for conversation:${_.mriOrId(t)}, updated entry count: ${this._conversationsBuffer[t].inputEntities.length}`));else{const s=S.applyEditableContentToInputEntities(e.newContent,[]);f.log(p.LogTraceArea.ConversationsDraftStore,`_updateInputEntities for conversation: ${_.mriOrId(t)}, created entry count: ${s.length}`),o.size(s)>0&&(this._conversationsBuffer[t]={inputEntities:s,inputEntitiesDataVersion:e.newContent.downStreamDataVersion,messages:void 0,type:v.SavedMessageType.None,timestamp:Date.now()},f.track(new u.DraftMessageCreated))}},this._cleanupBlankEntries=()=>{const e=[];o.each(this._conversations,((t,s)=>{0!==t.inputEntities.length&&!this._isOnlySpaces(t.inputEntities)||!o.isEmpty(t.messages)&&!o.includes([v.SavedMessageType.None,v.SavedMessageType.Edited],t.type)||(e.push(s),delete this._conversations[s],d.default.getS4LMessagingFeaturesNoSubscription().enableDraftMessagesPersistentStorage&&h.default.deleteSavedMessage(s).catch(o.noop))})),e.length>0&&(f.log(p.LogTraceArea.ConversationsDraftStore,`_cleanupBlankEntries deleted ${e.length} entries, still stored: ${o.size(this._conversations)}`),this.trigger(e))},C.RegisterStartupable(this,"ConversationsDraftStore")}startup(){return n.dataUpdateReceivedEvent.subscribe((e=>{this._updateInputEntities(e)})),d.default.getS4LMessagingFeaturesNoSubscription().enableDraftMessagesPersistentStorage&&g.default.queueIdleTask("ConversationsDraftStore",g.TaskTypeFlags.CpuIntensive,(()=>{h.default.loadSavedMessageInputs().then(this._setSavedMessageInputs)}),g.Priority.High),l.Resolved()}getSavedMessageInput(e){return this._conversations[e]}getDraftTimestampForConversation(e){const t=this.getSavedMessageInput(e);return t&&t.timestamp?t.timestamp:void 0}getConversationsWithDraft(){const e=[];return o.each(this._conversations,((t,s)=>{const i=(0,c.default)().getConversation(s);i&&e.push(i)})),e}getConversationsNumber(){return o.size(this._conversations)}updateInputEntitiesFromContent(e,t){return this._updateInputEntities({forCustomContext:e,newContent:t}),this}test_reset(){this._conversations={}}commit(e){return this._conversationsBuffer[e]&&(this._conversations[e]=Object.assign(Object.assign({},this._conversationsBuffer[e]),{timestamp:Date.now()}),delete this._conversationsBuffer[e],this.trigger(e),this.onInputEntitiesUpdatedEvent.fire(e)),this._cleanupBlankEntries(),this}_isOnlySpaces(e){return 1===e.length&&e[0]instanceof m.UnhandledEntity&&0===e[0].text().trim().length}};(0,i.__decorate)([r.autoSubscribe,(0,i.__param)(0,r.key)],b.prototype,"getSavedMessageInput",null),(0,i.__decorate)([r.autoSubscribe,(0,i.__param)(0,r.key)],b.prototype,"getDraftTimestampForConversation",null),(0,i.__decorate)([r.autoSubscribe],b.prototype,"getConversationsWithDraft",null),b=(0,i.__decorate)([r.AutoSubscribeStore],b),t.default=new b},92758:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationsListMode=void 0;const i=s(70655),o=s(96486),n=s(88837),r=s(89391),a=s(71830),l=s(20770),d=s(39549),c=s(41706),h=s(3088);var u,p;!function(e){e[e.AllConversations=0]="AllConversations",e[e.ArchivedConversations=1]="ArchivedConversations"}(u=t.ConversationsListMode||(t.ConversationsListMode={})),function(e){e[e.LastVisited=0]="LastVisited",e[e.ListMode=1]="ListMode",e[e.ConversationsLoading=2]="ConversationsLoading",e[e.ConversationsLoaded=3]="ConversationsLoaded"}(p||(p={}));let g=class extends n.StoreBase{constructor(){super(...arguments),this._listMode=u.AllConversations,this._conversationsAreLoading=!1}setConversationsListMode(e){e!==this._listMode&&(this._listMode=e,this.trigger(p.ListMode))}getConversationsListMode(){return this._listMode}_setConversationsLoadingStatus(e){this._conversationsAreLoading!==e&&(this._conversationsAreLoading=e,this.trigger(p.ConversationsLoading))}areConversationsLoading(){return this._conversationsAreLoading}loadMoreConversations(e){o.isUndefined(e)&&(e=r.default.getS4LMessagingFeaturesNoSubscription().recentConversationsIncrementor);const t=(0,d.default)();t.canPossiblyShowMoreRecentConversations()?(this._setConversationsLoadingStatus(!0),t.increaseLimitOfRecentJoinedConversationsSorted(e).then((e=>{e?this.trigger(p.ConversationsLoaded):this._setConversationsLoadingStatus(!1)}))):this._setConversationsLoadingStatus(!1)}getShownConversations(){let e=(0,d.default)().getDisplayableRecentConversationsSortedLimited();const t=r.default.getS4LMessagingFeatures();let s=l.default.getConversationsWithDraft(),i=t.enableMediaPreviewDrafts?h.default.getConversationsWithMediaDraft():[];return s=s.filter((e=>e.isCurrentUserMember()&&(!e.isDeleted()||e.getDeletedTimestamp()<(l.default.getDraftTimestampForConversation(e.id)||0)))),i=s.filter((e=>e.isCurrentUserMember()&&(!e.isDeleted()||e.getDeletedTimestamp()<(h.default.getDraftPreviewTimestamp(e.id)||0)))),e=o.unionBy(e,s,i,(e=>e.id)),o.compact(o.filter(e,(e=>(!e.isEncryptedThread()||c.default.shouldShowPrivateConv(e.id))&&!e.isArchived())))}setLastVisitedConversationId(e){this._lastVisitedConversationId===e||a.isBookmarkConversation(e)||(this._lastVisitedConversationId=e,this.trigger(p.LastVisited))}getLastVisitedConversationId(){return this._lastVisitedConversationId}test_reset_store(){this._listMode=u.AllConversations,this._conversationsAreLoading=!1,this._lastVisitedConversationId=void 0}};(0,i.__decorate)([(0,n.autoSubscribeWithKey)(p.ListMode)],g.prototype,"getConversationsListMode",null),(0,i.__decorate)([(0,n.autoSubscribeWithKey)(p.ConversationsLoading)],g.prototype,"areConversationsLoading",null),(0,i.__decorate)([(0,n.autoSubscribeWithKey)(p.ConversationsLoaded)],g.prototype,"getShownConversations",null),(0,i.__decorate)([(0,n.autoSubscribeWithKey)(p.LastVisited)],g.prototype,"getLastVisitedConversationId",null),g=(0,i.__decorate)([n.AutoSubscribeStore],g),t.default=new g},39549:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TriggerKeys=void 0;const i=s(70655),o=s(96486),n=s(78045),r=s(88837),a=s(97691),l=s(89391),d=s(63413),c=s(76621),h=s(24339),u=s(46096),p=s(36237),g=s(78735),m=s(18078),S=s(14976),f=s(96856),y=s(33384),_=s(22538),v=s(27795),C=s(93003),b=!0,T=C.RecentsSortBy.Time;t.TriggerKeys={AllConversations:"all",RecentDisplayed:"recentDisplayed",RecentDisplayedLimited:"recentDisplayedLimited"};let M,I=class extends r.StoreBase{constructor(){super(300),this._allConversations={},this._allOneToOneThreadIdsByUserMri={},this._allUserMriByOneOnOneThreadIds={},this._fakedTimestamps={},this._fakedLastMessages={},this._showFavorites=b,this._recentsSortedBy=T,this._sortedRecentConversations=new y.default((e=>e.id),(e=>this.recentConversationsSortRank(e))),this.recentConversationsSortRank=e=>{let t=-this._getConvTimestamp(e);if(this._showFavorites&&e.isFavorite()&&(t-=f.MagicFavoritesPinnedNumber),this._recentsSortedBy===C.RecentsSortBy.Unread){const s=c.default.getConversationMetaFromMemoryCache(e.id);s&&s.counts&&1===s.counts.hasUnread&&(t-=f.MagicUnreadPinnedNumber)}return t},_.RegisterStartupable(this,"ConversationsStore",[d.default,c.default,g.default])}_getConvTimestamp(e){return this._fakedTimestamps[e.id]||e.getTimestamp()}resortRecentConversations(){const{recentsShowCategories:e,recentsSortedBy:s}=g.default.getUserPreferencesLocal();this._showFavorites=null!=e?e:b,this._recentsSortedBy=null!=s?s:T,p.log(u.LogTraceArea.ConversationStore,"_getSortedRecentsConversations called ShowFavorites:"+this._showFavorites),this._sortedRecentConversations.sort(this.recentConversationsSortRank),this.trigger([t.TriggerKeys.RecentDisplayed,t.TriggerKeys.RecentDisplayedLimited])}startup(){this._maxRecentConversationsToShow=l.default.getS4LMessagingFeatures().maxRecentConversationsToShow;const{recentsShowCategories:e,recentsSortedBy:t}=g.default.getUserPreferencesLocal();return this._showFavorites=null!=e?e:b,this._recentsSortedBy=null!=t?t:T,this._conversationsUpdatedSubscription=c.default.conversationsUpdated.subscribe((e=>{const t=o.uniq(o.flatten(o.map(e,(e=>this._updateConversation(e.conv)))));t.length>0&&this.trigger(t)})),this._blockedMriStoreSubscription=d.default.subscribe((e=>{let t=[];o.each(e,(e=>{const s=this.getConversation(e);if(s&&(t=this._updateConversation(s,!1)),s&&this._allOneToOneThreadIdsByUserMri[e]){const s=this._allOneToOneThreadIdsByUserMri[e],i=this.getConversation(s);i&&t.push(...this._updateConversation(i,!1))}})),t=o.uniq(t),t.length>0&&this.trigger(t)})),c.default.loadAndCacheAllNonHighlightsConversations()}test_reset_store(){this._allConversations={},this._allOneToOneThreadIdsByUserMri={},this._allUserMriByOneOnOneThreadIds={},this._fakedTimestamps={},this._fakedLastMessages={},this._maxRecentConversationsToShow=0,this._showFavorites=b,this._recentsSortedBy=T,this._sortedRecentConversations=new y.default((e=>e.id),this.recentConversationsSortRank),this._conversationsUpdatedSubscription&&(this._conversationsUpdatedSubscription.unsubscribe(),this._conversationsUpdatedSubscription=void 0),this._blockedMriStoreSubscription&&(d.default.unsubscribe(this._blockedMriStoreSubscription),this._blockedMriStoreSubscription=void 0)}_updateConversation(e,s=!0){let i=[];if(!e)return i;if(m.default.isMyMri(e.id))return p.log(u.LogTraceArea.ConversationStore,"Ignoring conversation with self: "+S.mriOrId(e.id)),i;const n=this._allConversations[e.id]===e;if(s&&n)return i;this._allConversations[e.id]=e,i.push(t.TriggerKeys.AllConversations);if(!this._getConvTimestamp(e)&&!e.isDeleted())return i;if(e.isOneToOneUserConvWithThreadIdSupport()){const t=e.getOneOnOneThreadId();t&&(this._allOneToOneThreadIdsByUserMri[e.id]=t,this._allUserMriByOneOnOneThreadIds[t]=e.id)}else if(e.isOneToOneThread()&&o.isUndefined(this._allUserMriByOneOnOneThreadIds[e.id])){const t=e.getOtherPartyMriForOneToOneThread();t?(this._allOneToOneThreadIdsByUserMri[t]=e.id,this._allUserMriByOneOnOneThreadIds[e.id]=t):(p.log(u.LogTraceArea.ConversationStore,"Can not tell other party from 1:1 thread "+e.id),p.track(new v.DevDebug("ConversationsStore","Can not tell other party from 1:1 thread")))}const r=e.getTimestamp();this._fakedTimestamps[e.id]&&r>this._fakedTimestamps[e.id]&&delete this._fakedTimestamps[e.id],this._fakedLastMessages[e.id]&&e.lastMessage&&(this._fakedLastMessages[e.id].isLastChangeScheduledCallMetadata()&&this._fakedLastMessages[e.id].createdTime>e.lastMessage.createdTime||delete this._fakedLastMessages[e.id]);const a=this._updateDisplayableList(e);return i.push(...a.triggerKeys),s&&n&&!a.displayabilityChanged||i.push(e.id),i}_updateDisplayableList(e){if(!e)return{displayabilityChanged:!1,triggerKeys:[]};let s,i,r=[];const a=this._sortedRecentConversations.contains(e.id),l=h.getConversationDisplayableStatus(e);a&&!l.isDisplayable&&n.default.closeSplitView(e.id),a&&(s=l.isDisplayable?this._sortedRecentConversations.getIndex(e.id):this._sortedRecentConversations.remove(e.id)),l.isDisplayable&&(this._sortedRecentConversations.put(e),i=this._sortedRecentConversations.getIndex(e.id)),(i&&i!==s&&i<this._maxRecentConversationsToShow||s&&s<this._maxRecentConversationsToShow&&!l.isDisplayable)&&r.push(t.TriggerKeys.RecentDisplayedLimited),a!==l.isDisplayable&&r.push(t.TriggerKeys.RecentDisplayed);const d=c.default.getConversationMetaFromMemoryCache(e.id),g=d&&d.counts&&1===d.counts.hasUnread;return p.log(u.LogTraceArea.ConversationStore,`_updateDisplayableList for ${S.mriOrId(e.id)}, isFavorite:${e.isFavorite()}, hasUnread:${g}, timeStamp:${this._getConvTimestamp(e)}, wasDisplayed:${a}${s?" at position "+s:""}, isDisplayable:${l.isDisplayable}${i?" at position "+i:""}`+(o.isEmpty(l.debugReason)?"":", reason: "+l.debugReason)+`, maxRecentsShown: ${this._maxRecentConversationsToShow} from total ${this._sortedRecentConversations.getLength()}`+` displayable conversations. TriggerKeys ${o.join(r,",")}`),{displayabilityChanged:a!==l.isDisplayable,triggerKeys:r}}fakeConversationTime(e,t){this._fakedTimestamps[e]=t;const s=this.getConversation(e);let i=[e];s&&i.push(...this._updateConversation(s,!1)),this.trigger(o.uniq(i))}fakeLastMessage(e,t){this._fakedLastMessages[e]=t,this.trigger(e)}getConversationPotentiallyBeforeStartupAsync(e){const t=this._allConversations[e];return t?a.Resolved(t):c.default.getConversationMetaAsync(e).then((e=>{if(e)return this.trigger(this._updateConversation(e.conv)),e.conv}))}getConversation(e){const t=this._allConversations[e];if(!t){const t=c.default.getConversationMetaFromMemoryCache(e);if(t)return this.trigger(this._updateConversation(t.conv)),t.conv;c.default.ensureConversationLoaded(e)}return t}isConversationKnown(e){return!!this._allConversations[e]}isClearApplicableAndKeepInRecents(e){const t=this._allConversations[e];return!!t&&(t.isThread()&&!t.isOneOnOne())}ableToViewConversation(e){const t=this._allConversations[e];return t?p.log(u.LogTraceArea.ConversationStore,"ableToViewConversation: "+S.mriOrId(e)+"isCurrentUserMember: ",t.isCurrentUserMember()," is Blocked: ",this.isConversationBlocked(t)):p.log(u.LogTraceArea.ConversationStore,"conversation not found in this._allConversations"),t&&t.isCurrentUserMember()&&!this.isConversationBlocked(t)}getAllConversationsInMemory(){return this._allConversations}getFakeTimestamp(e){return this._fakedTimestamps[e]}getFakeLastMessageFallback(e){return this._fakedLastMessages[e]}hasJoinedConversationsWithCall(){return!!o.find(this._allConversations,(e=>e.isCurrentUserMember()&&!!e.lastCallTime))}getMostRecentJoinedConversationId(e){const t=this.getDisplayableRecentConversationsSortedAll(),s=e?o.find(t,(t=>t.id!==e)):o.head(t);return s?s.id:void 0}isConversationBlocked(e){return!!e&&d.default.isMriBlocked(e.getOtherPartyMriOrConvId())}getSortedArchivedConversations(){return o.sortBy(this.getArchivedConversations(),(e=>-this._getConvTimestamp(e)))}getArchivedConversations(){return o.filter(this._allConversations,(e=>e.isArchived()&&h.isConversationDisplayable(e)))}getDisplayableRecentConversationsSortedAll(){return this._sortedRecentConversations.getSortedArray()}getDisplayableRecentConversationsSortedLimited(){return this._sortedRecentConversations.getSortedArray().slice(0,this._maxRecentConversationsToShow)}canPossiblyShowMoreRecentConversations(){return this._maxRecentConversationsToShow<this._sortedRecentConversations.getLength()}increaseLimitOfRecentJoinedConversationsSorted(e){return this.canPossiblyShowMoreRecentConversations()?(p.log(u.LogTraceArea.ConversationStore,"Expanding displayable recent list limit, increase from "+this._maxRecentConversationsToShow+" by increment "+e),this._maxRecentConversationsToShow+=e,this.trigger(t.TriggerKeys.RecentDisplayedLimited),a.Resolved(!0)):a.Resolved(!1)}getTranslatedConversations(){return o.filter(this._allConversations,(e=>!e.isTranslationDisabled()))}getOtherPartyMriFromOneToOneThreadId(e){const t=this._allUserMriByOneOnOneThreadIds[e];return o.isUndefined(t)&&p.warn(u.LogTraceArea.ConversationStore,"Could not find otherPartyMri for OneOnOneThreadId"),t}};(0,i.__decorate)([r.autoSubscribe,(0,i.__param)(0,r.key)],I.prototype,"getConversation",null),(0,i.__decorate)([r.autoSubscribe,(0,i.__param)(0,r.key)],I.prototype,"isConversationKnown",null),(0,i.__decorate)([r.autoSubscribe,(0,i.__param)(0,r.key)],I.prototype,"isClearApplicableAndKeepInRecents",null),(0,i.__decorate)([r.autoSubscribe,(0,i.__param)(0,r.key)],I.prototype,"ableToViewConversation",null),(0,i.__decorate)([(0,r.autoSubscribeWithKey)(t.TriggerKeys.AllConversations)],I.prototype,"getAllConversationsInMemory",null),(0,i.__decorate)([r.autoSubscribe,(0,i.__param)(0,r.key)],I.prototype,"getFakeTimestamp",null),(0,i.__decorate)([r.autoSubscribe,(0,i.__param)(0,r.key)],I.prototype,"getFakeLastMessageFallback",null),(0,i.__decorate)([(0,r.autoSubscribeWithKey)(t.TriggerKeys.AllConversations)],I.prototype,"hasJoinedConversationsWithCall",null),(0,i.__decorate)([r.autoSubscribe],I.prototype,"getMostRecentJoinedConversationId",null),(0,i.__decorate)([r.autoSubscribe],I.prototype,"isConversationBlocked",null),(0,i.__decorate)([(0,r.autoSubscribeWithKey)(t.TriggerKeys.AllConversations)],I.prototype,"getSortedArchivedConversations",null),(0,i.__decorate)([(0,r.autoSubscribeWithKey)(t.TriggerKeys.AllConversations)],I.prototype,"getArchivedConversations",null),(0,i.__decorate)([(0,r.autoSubscribeWithKey)(t.TriggerKeys.RecentDisplayed)],I.prototype,"getDisplayableRecentConversationsSortedAll",null),(0,i.__decorate)([(0,r.autoSubscribeWithKey)(t.TriggerKeys.RecentDisplayedLimited)],I.prototype,"getDisplayableRecentConversationsSortedLimited",null),(0,i.__decorate)([(0,r.autoSubscribeWithKey)([t.TriggerKeys.RecentDisplayed])],I.prototype,"canPossiblyShowMoreRecentConversations",null),I=(0,i.__decorate)([r.AutoSubscribeStore],I),t.default=function(){return M||(M=new I)}},85329:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CustomCallReactionsStore=void 0;const i=s(70655),o=s(96486),n=s(88837),r=s(97691),a=s(89391),l=s(1446),d=s(33754),c=s(46929),h=s(22538);let u,p=class extends l.CustomReactionsStoreBase{constructor(){super(),h.RegisterStartupable(this,"CustomCallReactionsStore",[c.default])}startup(){var e;super.startup();const t=null===(e=a.default.getS4LCMCFeatures())||void 0===e?void 0:e.customCallReactions;return this._enabled=null==t?void 0:t.enabled,this._maxReactionsNumber=null==t?void 0:t.maxNumberOfCustomReactions,this._initialTabId=null==t?void 0:t.initialTabId,a.default.subscribe((()=>{const{enabled:e,maxNumberOfCustomReactions:t,initialTabId:s}=a.default.getS4LCMCFeatures().customCallReactions;let i=!1;this._enabled!==e&&(this._enabled=e,i=!0),this._maxReactionsNumber!==t&&(this._maxReactionsNumber=t,i=!0),this._initialTabId=s,i&&this.trigger()})),r.Resolved()}getDefaultReactions(){var e;return o.assign([],null===(e=a.default.getS4LCMCFeatures())||void 0===e?void 0:e.customCallReactions.defaultPack)}getSavedReactions(){return c.default.getCustomCallReactions()||[]}saveCurrentReactions(){c.default.setCustomCallReactions(this._localReactions),super.saveCurrentReactions()}getInitialTabId(){return this._initialTabId}isFeatureEnabled(){return this._enabled}getMaxReactionsCount(){return this._maxReactionsNumber}getModalTitle(){return d.getString("ReactionsPanel.CustomCallReactionsTitle")}};p=(0,i.__decorate)([n.AutoSubscribeStore],p),t.CustomCallReactionsStore=p,t.default=function(){return u||(u=new p)}},1446:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CustomReactionsStoreBase=t.TriggerKeys=void 0;const i=s(70655),o=s(96486),n=s(16778),r=s(88837),a=s(97691),l=s(33754);var d;!function(e){e[e.CurrentReactions=0]="CurrentReactions",e[e.SavedReactions=1]="SavedReactions"}(d=t.TriggerKeys||(t.TriggerKeys={}));let c=class extends r.StoreBase{startup(){return a.Resolved()}getCurrentReactions(){return this._loadCurrentReactionsPack()}getCustomReactions(){return this._getSavedOrDefaultReactions()}addReactions(e){const t=this._loadCurrentReactionsPack();this._localReactions&&this._localReactions.length<this.getMaxReactionsCount()&&(this._setLocalReactions(o.uniq([...e,...t])),this._getScreenReaderAnnouncement(e,"ReactionsPanel.AddedCustomReactios"),this.trigger(d.CurrentReactions))}removeReactions(e){const t=this._loadCurrentReactionsPack();this._setLocalReactions(t.filter((t=>!o.includes(e,t)))),this._getScreenReaderAnnouncement(e,"ReactionsPanel.RemovedCustomReactios"),this.trigger(d.CurrentReactions)}removeReactionsAt(e){const t=this._loadCurrentReactionsPack();this._setLocalReactions(t.filter(((t,s)=>!o.includes(e,s)))),this.trigger(d.CurrentReactions)}resetUnsavedReactions(){this._localReactions=void 0,this.trigger(d.CurrentReactions)}isCustomReaction(e){return!o.includes(this.getDefaultReactions(),e)}isLocalReaction(e){return o.includes(this._localReactions,e)}getLocalReactionsCount(){var e;return null===(e=this._localReactions)||void 0===e?void 0:e.length}getCustomReactionsCount(){return this.getMaxReactionsCount()}getCustomReactionsModalTitle(){return this.getModalTitle()}hasBeenCustomized(){return this.isFeatureEnabled()&&0!==this.getSavedReactions().length}saveCurrentReactions(){this._localReactions&&0===this._localReactions.length&&(this._localReactions=void 0),this.trigger(d.SavedReactions)}_loadCurrentReactionsPack(){return this._localReactions||(this._localReactions=this._getSavedOrDefaultReactions()),this._localReactions}_getScreenReaderAnnouncement(e,t){n.Accessibility.announceForAccessibility(l.getString(t,{name:e.join(", ")}))}_setLocalReactions(e){this._localReactions=e}_getSavedOrDefaultReactions(){const e=this.getSavedReactions();return this.isFeatureEnabled()&&0!==e.length?e:this.getDefaultReactions()||[]}};(0,i.__decorate)([(0,r.autoSubscribeWithKey)(d.CurrentReactions)],c.prototype,"getCurrentReactions",null),(0,i.__decorate)([(0,r.autoSubscribeWithKey)(d.SavedReactions)],c.prototype,"getCustomReactions",null),(0,i.__decorate)([r.autoSubscribe],c.prototype,"getCustomReactionsCount",null),(0,i.__decorate)([(0,r.autoSubscribeWithKey)(d.SavedReactions)],c.prototype,"hasBeenCustomized",null),c=(0,i.__decorate)([r.AutoSubscribeStore],c),t.CustomReactionsStoreBase=c},84817:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TriggerKeys=void 0;const i=s(70655),o=s(62897),n=s(88837),r=s(48540),a=s(97691),l=s(94224),d=s(84876),c=s(46096),h=s(36237),u=s(22538),p=s(4057);var g;!function(e){e[e.Device=0]="Device",e[e.DesktopVIMDeviceStatus=1]="DesktopVIMDeviceStatus"}(g=t.TriggerKeys||(t.TriggerKeys={}));let m=class extends n.StoreBase{constructor(){super(),this._desktopVIMDeviceUpdated=(e,t,s)=>{this._fireDesktopVIMDeviceUpdate(),this._onSelectedDeviceChanged(e,t,s)},this._onSelectedDeviceChanged=(e,t,s)=>{h.log(c.LogTraceArea.Calling,"DesktopCaptureSettingsStore._onSelectedDeviceChanged causeId: "+s+"; userAction: "+t+"; devices: "+JSON.stringify(e));let i=e.filter((e=>e.kind===r.DeviceType.Microphone));i.length>0&&d.default.CallManagerHelper.selectedMicDidChange(i[0].id,t,s)},this._isAVDeviceReady=!1,u.RegisterStartupable(this,"DesktopCaptureSettingsStore",[])}startup(){return l.default.DeviceStore.selectedDevicesChangedEvent().subscribe(this._desktopVIMDeviceUpdated),this._fireDesktopVIMDeviceUpdate(),a.Resolved()}destroy(){l.default.DeviceStore.selectedDevicesChangedEvent().unsubscribe(this._desktopVIMDeviceUpdated)}isAVDeviceReady(){return this._isAVDeviceReady&&l.default.DeviceStore.hasCameras()&&!l.default.CallingStore.hasConnectedCalls()}getSelectedCameraID(){return o.default.mapLabelToDeviceId("videoinput",l.default.DeviceStore.getCurrentDevicesLabel().camera)}getSelectedMicID(){return o.default.mapLabelToDeviceId("audioinput",l.default.DeviceStore.getCurrentDevicesLabel().microphone)}_fireDesktopVIMDeviceUpdate(){o.default.isAVRecordingSupported().then((e=>{this._isAVDeviceReady=e,h.log(c.LogTraceArea.Capture,"_desktopVIMDeviceUpdated, current Desktop VIM support is  "+e)})).catch((e=>{this._isAVDeviceReady=!1,h.error(c.LogTraceArea.Capture,"_desktopVIMDeviceUpdated Error when enumerateDevice as "+p.default.errorAsString(e))})).always((()=>{this.trigger(g.DesktopVIMDeviceStatus)}))}test_resetFields(){this._isAVDeviceReady=!1}};(0,i.__decorate)([(0,n.autoSubscribeWithKey)(g.DesktopVIMDeviceStatus)],m.prototype,"isAVDeviceReady",null),(0,i.__decorate)([(0,n.autoSubscribeWithKey)(g.Device)],m.prototype,"getSelectedCameraID",null),(0,i.__decorate)([(0,n.autoSubscribeWithKey)(g.Device)],m.prototype,"getSelectedMicID",null),m=(0,i.__decorate)([n.AutoSubscribeStore],m),t.default=new m},43368:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=s(88837),n=s(98278),r=s(83294);let a=class extends o.StoreBase{constructor(){super(...arguments),this._shouldShow={[n.MainRootViewId]:!1},this._selectedTabType=r.defaultTabType}shouldShow(e){return!!this._shouldShow[e]}open(e){this._shouldShow[e]=!0,this.trigger()}close(e){this._shouldShow[e]=!1,this._selectedTabType=r.defaultTabType,this._searchQuery=void 0,this.trigger()}openInSearchMode(e,t,s){this._shouldShow[s]=!0,this._selectedTabType=e,this._searchQuery=t,this.trigger()}getPickerSearchProps(){return{selectedTabType:this._selectedTabType,searchQuery:this._searchQuery}}};(0,i.__decorate)([o.autoSubscribe],a.prototype,"shouldShow",null),(0,i.__decorate)([o.autoSubscribe],a.prototype,"getPickerSearchProps",null),a=(0,i.__decorate)([o.AutoSubscribeStore],a),t.default=new a},41706:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=s(96486),n=s(88837),r=s(97691),a=s(89391),l=s(76621),d=s(81697),c=s(39549),h=s(67121),u=s(25793),p=s(46096),g=s(36237),m=s(61253),S=s(18078),f=s(75057),y=s(14976),_=s(22538),v=s(4057),C=[u.SecureHandshakeState.None,u.SecureHandshakeState.OtherEndpointInUse];let b=class extends n.StoreBase{constructor(){super(),this._handshakeStates={},this._localPrivateConvs={},this._updateLocalPrivateConvs=(e,t)=>{this._localPrivateConvs[e]=t},this._conversationUpdated=e=>{o.each(e,(e=>{if(e.conv.isEncryptedThread()){this._updatePrivateConvStoredLocaly(e.conv.id);const t=e.conv.getEncryptionHandshake();this._processHandshakeForConv(e.conv)&&u.default.isAccepted(t)&&u.default.isInitiatedByMe(t)&&o.defer((()=>{h.default.sendConfirm(e.conv.id,!0).catch((e=>{g.warn(p.LogTraceArea.E2EEncryption,"Auto accept failed with error: ",v.default.errorAsString(e))}))}))}}))},this._rejectActiveConversations=()=>{const e=f.default.getAllPrivateConversationMris(),t=o.filter(e,(e=>!o.includes(C,this.getHandshakeState(e)))),s=o.map(t,(e=>h.default.sendReject(e,p.E2EERejectionReason.IdentityLost).catch(o.noop)));return r.all(s)},_.RegisterStartupable(this,"E2eeHandshakeStore",[l.default,c.default,u.default])}startup(){return l.default.conversationsUpdated.subscribe(this._conversationUpdated),h.default.identityUpdated.subscribe(this._rejectActiveConversations),h.default.conversationStored.subscribe(this._updateLocalPrivateConvs),r.Resolved()}getHandshakeState(e){let t=this._handshakeStates[e];if(!t){const s=(0,c.default)().getConversation(e);s?(this._processHandshakeForConv(s),t=this._handshakeStates[e]):l.default.getConversationMetaAsync(e).then((e=>{e&&this._processHandshakeForConv(e.conv)}))}return t||u.SecureHandshakeState.None}shouldShowPrivateConv(e){if(!a.default.getS4LMessagingFeatures().hidePrivateConversationsOnOtherEndpoints)return!0;return this.getHandshakeState(e)!==u.SecureHandshakeState.OtherEndpointInUse||this._getLocalPrivateConv(e)}_getLocalPrivateConv(e){let t=this._localPrivateConvs[e];return o.isUndefined(t)&&(this._updatePrivateConvStoredLocaly(e),t=this._localPrivateConvs[e]),t||!1}test_resetSubscriptions(){l.default.conversationsUpdated.unsubscribe(this._conversationUpdated),h.default.identityUpdated.unsubscribe(this._rejectActiveConversations)}_updatePrivateConvStoredLocaly(e){h.default.isPrivateConvStoredLocally(e).then((t=>this._localPrivateConvs[e]=t))}_processHandshakeForConv(e){const t=e.getEncryptionHandshake(),s=e.id;if(!t)return g.warn(p.LogTraceArea.E2EEncryption,`Secure thread ${y.mriOrId(s)} with no handshake info`),d.default.forceThreadDetailsFetchIfNeeded(s),!1;if(!S.default.isMyMri(t.AParty)&&!S.default.isMyMri(t.BParty))return g.warn(p.LogTraceArea.E2EEncryption,"Got unrelated handshake"),d.default.forceThreadDetailsFetchIfNeeded(s),!1;const i=this._handshakeStates[s],o=u.default.getDetailedHandshakeState(e);return!(0,m.default)(i,o)&&(this._handshakeStates[s]=o,g.log(p.LogTraceArea.E2EEncryption,`Handshake for ${y.mriOrId(s)} changed state - ${u.SecureHandshakeState[o]}`),this.trigger(s),o===u.SecureHandshakeState.None&&h.default.terminateSession(t),!0)}};(0,i.__decorate)([n.autoSubscribe,(0,i.__param)(0,n.key)],b.prototype,"getHandshakeState",null),(0,i.__decorate)([n.autoSubscribe,(0,i.__param)(0,n.key)],b.prototype,"shouldShowPrivateConv",null),b=(0,i.__decorate)([n.AutoSubscribeStore],b),t.default=new b},82433:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EmoticonIconType=void 0;const i=s(70655),o=s(96486),n=s(88837),r=s(97691),a=s(81169),l=s(62141),d=s(81959),c=s(5450),h=s(12229),u=s(32183),p=s(98754),g=s(22538);var m;!function(e){e[e.Small=0]="Small",e[e.Large=1]="Large",e[e.ExtraLarge=2]="ExtraLarge",e[e.ExtraExtraLarge=3]="ExtraExtraLarge"}(t.EmoticonIconType||(t.EmoticonIconType={})),function(e){e[e.ToneChanged=0]="ToneChanged",e[e.GroupItemChanged=1]="GroupItemChanged"}(m||(m={}));let S=class extends n.StoreBase{constructor(){super(),this._map={},this._firstLettersMap={},this._validCharactersPattern="(?:[a-zA-Z_0-9():])",this._reverseMap={},this._reverseFirstLetterMap={},this._countryCodes={},this._lastUsedToneMap={},this._lastUsedEmoticonGroupItemMap={},this._groupedEmoticons=[],this.setLastUsedTone=(e,t)=>{this._lastUsedToneMap[e]!==t&&(t&&1!==t?this._lastUsedToneMap=Object.assign(Object.assign({},this._lastUsedToneMap),{[e]:t}):delete this._lastUsedToneMap[e],p.default.putData(l.InternalKeys.LastlyUsedEmoticonTones,this._lastUsedToneMap),this.trigger(m.ToneChanged))},this.setLastUsedEmoticonGroupItem=(e,t)=>{this._lastUsedEmoticonGroupItemMap[e]!==t&&(t&&t!==e?this._lastUsedEmoticonGroupItemMap=Object.assign(Object.assign({},this._lastUsedEmoticonGroupItemMap),{[e]:t}):delete this._lastUsedEmoticonGroupItemMap[e],p.default.putData(l.InternalKeys.LastlyUsedEmoticonGroupItem,this._lastUsedEmoticonGroupItemMap),this.trigger(m.GroupItemChanged))},g.RegisterStartupable(this,"EmoticonStore",[p.default])}startup(){this._lastUsedToneMap=p.default.getDataExclusive(l.InternalKeys.LastlyUsedEmoticonTones)||{},this._lastUsedEmoticonGroupItemMap=p.default.getDataExclusive(l.InternalKeys.LastlyUsedEmoticonGroupItem)||{};const e=c.getDefaultMap();return this._setMap(e),this.setEmoticons((0,o.values)(e),!1),this._countryCodes=(0,o.invert)(h.getCountryCodes()),r.Resolved()}setEmoticons(e,t=!0){let s={};(0,o.each)(e,(e=>{(0,o.each)(e.shortcuts,(t=>{s[t]=e}))})),this._groupedEmoticons=(0,o.uniq)((0,o.compact)((0,o.flatMap)(e,(e=>e.group?e.group.slice():[])))),this._setMap(s),t&&this.trigger()}getEmoticons(){return this.getEmoticonsNoSubscription()}getEmoticonsNoSubscription(){return this._map}getEmoticonsByName(){return(0,o.mapValues)(this._reverseMap,(e=>this._map[e]))}getEmoticonByShortcut(e){return this.getEmoticonByShortcutNoSubscription(e)}getEmoticonByShortcutNoSubscription(e){const t=this._normalizeEmoticonName(e);return this._map[t]}_getEmoticonByName(e){let t=this._reverseMap[e];if(t)return this._map[t]}getEmoticonByName(e){return this._getEmoticonByName(e)}getEmoticonByNameNoSubscription(e){return this._getEmoticonByName(e)}getEmoticonUrlFromName(e,t,s,i,o){const n=s||u.getDefaultEmoticonSize(t);return u.getEmoticonUrl(e,n,!0,i,o)}getEmoticonFirstLetterMap(){return this._firstLettersMap}getValidEmoticonCharactersPattern(){return this._validCharactersPattern}_normalizeEmoticonName(e){if(!e)return"";if(e.length>2&&e.startsWith("(")&&e.endsWith(")")){const t=u.getSanitizedEmoticonName(e).toLowerCase(),s=this._map[t];return s&&s.diverse?t:e.toLowerCase()}return e}isEmoticon(e){const t=this._normalizeEmoticonName(e);return!!this._firstLettersMap[t[0]]&&!!this._map[t]}isEmoticonType(e){return!!this._reverseFirstLetterMap[e[0]]&&!!this._reverseMap[e]}hasCountry(e){return e in this._countryCodes}setEmoticon(e){const t=(0,o.keyBy)(e.shortcuts),s=(0,o.mapValues)(t,(()=>e));(0,o.each)(this._map,((e,t)=>{s[t]=e})),this._setMap(s),this.trigger(e.id)}getLastUsedTones(){return this._lastUsedToneMap}getEmoticonTone(e){return this._lastUsedToneMap[e]}getEmoticonUtfFallback(e){var t;return null===(t=this._getEmoticonByName(e))||void 0===t?void 0:t.utf}getLastUsedEmoticonGroupItems(){return this._lastUsedEmoticonGroupItemMap}getGroupedEmoticons(){return this._groupedEmoticons}_setMap(e){this._map=e,this._firstLettersMap=this._findFirstLetters(this._map),this._validCharactersPattern=this._validCharacters(this._map);let t={};(0,o.each)(this._map,((e,s)=>{t[e.id]=s,void 0!==e.utf&&null!==e.utf&&d.ContentToTextTransformer.addUtfFallback(e.id,e.utf)})),this._reverseMap=t,this._reverseFirstLetterMap=this._findFirstLetters(this._reverseMap)}_findFirstLetters(e){const t=(0,o.map)(e,((e,t)=>t[0]));return(0,o.keyBy)(t)}_validCharacters(e){const t=new RegExp("[^a-zA-Z_0-9():]","gi"),s=(0,o.keys)(e);return"(?:[a-zA-Z_0-9():]|"+(0,a.chain)(s,(0,a.map)((e=>(0,o.flatten)(e.match(t)))),(0,a.flatten)(),(0,a.uniq)(),(0,a.map)(o.escapeRegExp),(0,a.join)("|"))+")"}};(0,i.__decorate)([n.autoSubscribe],S.prototype,"getEmoticons",null),(0,i.__decorate)([n.autoSubscribe],S.prototype,"getEmoticonsByName",null),(0,i.__decorate)([n.autoSubscribe],S.prototype,"getEmoticonByShortcut",null),(0,i.__decorate)([n.autoSubscribe],S.prototype,"getEmoticonByName",null),(0,i.__decorate)([n.disableWarnings],S.prototype,"getEmoticonByNameNoSubscription",null),(0,i.__decorate)([n.autoSubscribe],S.prototype,"getEmoticonUrlFromName",null),(0,i.__decorate)([n.autoSubscribe],S.prototype,"getEmoticonFirstLetterMap",null),(0,i.__decorate)([n.autoSubscribe],S.prototype,"getValidEmoticonCharactersPattern",null),(0,i.__decorate)([n.autoSubscribe],S.prototype,"isEmoticon",null),(0,i.__decorate)([n.autoSubscribe],S.prototype,"isEmoticonType",null),(0,i.__decorate)([n.autoSubscribe],S.prototype,"hasCountry",null),(0,i.__decorate)([(0,n.autoSubscribeWithKey)(m.ToneChanged)],S.prototype,"getLastUsedTones",null),(0,i.__decorate)([(0,n.autoSubscribeWithKey)(m.GroupItemChanged)],S.prototype,"getLastUsedEmoticonGroupItems",null),(0,i.__decorate)([n.autoSubscribe],S.prototype,"getGroupedEmoticons",null),S=(0,i.__decorate)([n.AutoSubscribeStore],S);let f=new S;t.default=f},39821:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=s(88837),n=s(97691),r=s(6452),a=s(7234),l=s(22538);let d=class extends o.StoreBase{constructor(){super(),l.RegisterStartupable(this,"FileDownloadStore",[r.default,a.default])}startup(){return r.default.downloadUpdated.subscribe((e=>{e.isCached&&this.trigger(e.key)})),a.default.cacheUpdated.subscribe((e=>{this.trigger(e)})),n.Resolved()}getLocalUri(e){return a.default.getLocalUri(e)}};(0,i.__decorate)([o.autoSubscribe,(0,i.__param)(0,o.key)],d.prototype,"getLocalUri",null),d=(0,i.__decorate)([o.AutoSubscribeStore],d),t.default=new d},9628:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ForwardMessageState=void 0;const i=s(70655),o=s(88837),n=s(33754);var r;!function(e){e[e.NotSent=0]="NotSent",e[e.Sending=1]="Sending",e[e.Sent=2]="Sent"}(r=t.ForwardMessageState||(t.ForwardMessageState={}));let a=class extends o.StoreBase{getStateForMri(e){return this._forwardMessageState[e]?this._forwardMessageState[e]:r.NotSent}updateSendingStatus(e,t){this._forwardMessageState[e]=t,this.trigger(e)}reset(){this._forwardMessageState={}}getAccessibilityLabelForMRI(e,t){const s=this._forwardMessageState[e];let i="ShareWithPanel.SendToAccessibilityLabel";return s&&s===r.Sent&&(i="ShareWithPanel.SentToAccessibilityLabel"),n.getString(i,{displayName:t})}};(0,i.__decorate)([o.autoSubscribe,(0,i.__param)(0,o.key)],a.prototype,"getStateForMri",null),(0,i.__decorate)([o.autoSubscribe,(0,i.__param)(0,o.key)],a.prototype,"getAccessibilityLabelForMRI",null),a=(0,i.__decorate)([o.AutoSubscribeStore],a),t.default=new a},43106:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TriggerKeys=void 0;const i=s(70655),o=s(96486),n=s(88837),r=s(89391),a=s(26712),l={gifItems:[],nextOffset:0,searchQuery:""};var d;!function(e){e[e.Searching=0]="Searching",e[e.CategoryResults=1]="CategoryResults",e[e.SearchResults=2]="SearchResults"}(d=t.TriggerKeys||(t.TriggerKeys={}));let c=class extends n.StoreBase{constructor(){super(...arguments),this._categoriesMap={},this._searchMap={},this._isSearching=!1,this._lastGifSearchParams={searchQuery:"",limitCount:void 0,offset:void 0}}getGifsForSearch(){return this._gifSearchResults?this._gifSearchResults:l}getGifsIdsFromSearch(){return o.map(this._searchMap,(e=>e.id))}getCategoryGif(e){return this._categoriesMap[e]}getSearchGif(e){return this._searchMap[e]}isSearching(){return this._isSearching}setCategoryGifs(e){this._setCategoryMap(e),this.trigger(d.CategoryResults)}setSearchGifs(e,t){let s=o.map(e.gifItems,((t,s)=>Object.assign(Object.assign({},t),{itemIndex:s,packItemsCount:e.gifItems.length,asmImageProxy:this._getImageProxyUrl(t.full.url),asmImageProxySmall:this._getImageProxyUrl(t.small.url)})));const i=this._gifSearchResults&&t===this._gifSearchResults.searchQuery?o.unionBy(this._gifSearchResults.gifItems,s,"id"):s;this._gifSearchResults={gifItems:i,nextOffset:e.nextOffset,searchQuery:t},this._setSearchMap(),this.trigger(d.SearchResults)}resetSearchGifs(){this._gifSearchResults=void 0,this._setSearchMap()}setSearchingFlag(e){this._isSearching=e,this.trigger(d.Searching)}setSearchParams(e,t,s){this._lastGifSearchParams.searchQuery=e,this._lastGifSearchParams.limitCount=t,this._lastGifSearchParams.offset=s}getSearchParams(){return this._lastGifSearchParams}_getImageProxyUrl(e){return a.default.addUrlParameter(r.default.getS4LMessagingFeatures().asmImageProxy,"url",encodeURIComponent(e))}_setCategoryMap(e){let t={};o.each(e.gifItems,((s,i)=>{t[s.id]=Object.assign(Object.assign({},s),{itemIndex:i,packItemsCount:e.gifItems.length,asmImageProxy:this._getImageProxyUrl(s.full.url),asmImageProxySmall:this._getImageProxyUrl(s.small.url)})})),this._categoriesMap=Object.assign(Object.assign({},this._categoriesMap),t)}_setSearchMap(){let e={};this._gifSearchResults&&o.each(this._gifSearchResults.gifItems,((t,s)=>{e[t.id]=Object.assign(Object.assign({},t),{itemIndex:s,packItemsCount:this._gifSearchResults?this._gifSearchResults.gifItems.length:0,asmImageProxy:this._getImageProxyUrl(t.full.url),asmImageProxySmall:this._getImageProxyUrl(t.small.url)})})),this._searchMap=e}};(0,i.__decorate)([(0,n.autoSubscribeWithKey)(d.SearchResults)],c.prototype,"getGifsForSearch",null),(0,i.__decorate)([(0,n.autoSubscribeWithKey)(d.SearchResults)],c.prototype,"getGifsIdsFromSearch",null),(0,i.__decorate)([n.autoSubscribe],c.prototype,"getCategoryGif",null),(0,i.__decorate)([n.autoSubscribe],c.prototype,"getSearchGif",null),(0,i.__decorate)([(0,n.autoSubscribeWithKey)(d.Searching)],c.prototype,"isSearching",null),(0,i.__decorate)([n.disableWarnings],c.prototype,"getSearchParams",null),c=(0,i.__decorate)([n.AutoSubscribeStore],c);const h=new c;t.default=h},53026:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=s(88837),n=s(61253);var r;!function(e){e[e.Query=0]="Query"}(r||(r={}));let a=class extends o.StoreBase{resetSearchQuery(){this._searchConversationQuery=void 0}getSearchQuery(){return this._searchConversationQuery}setSearchQuery(e){(0,n.default)(this._searchConversationQuery,e)||(this._searchConversationQuery=e,this.trigger(r.Query))}};(0,i.__decorate)([o.disableWarnings],a.prototype,"resetSearchQuery",null),(0,i.__decorate)([(0,o.autoSubscribeWithKey)(r.Query)],a.prototype,"getSearchQuery",null),a=(0,i.__decorate)([o.AutoSubscribeStore],a),t.default=new a},46634:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=s(74958),n=s(96486),r=s(49233),a=s(2604),l=s(88837),d=s(97691),c=s(89391),h=s(98278),u=s(16402),p=s(46096),g=s(36237),m=s(46705),S=s(57175),f=s(78735),y=s(81736),_=s(64956),v=s(22538),C=s(78262),b={enableHighAccuracy:!0,maximumAge:6e5},T={enableHighAccuracy:!1,timeout:5e3,maximumAge:6e5};let M=class extends l.StoreBase{constructor(){super(),this._locationPermissionStatus={},this._bingLocationConsentGranted=!1,v.RegisterStartupable(this,"LocationStore",[f.default,y.default])}startup(){return this._bingLocationConsentGranted=!!f.default.getUserPreferencesLocal().bingLocationConsentGranted,this._highAccuracyTimeout=c.default.getS4LCaapFeatures().highAccuracyLocationTimeout,this._updateLocationPermission(C.PermissionType.Location),this._updateLocationPermission(C.PermissionType.LocationAlways),y.default.subscribe((()=>{this._updateLocationPermission(C.PermissionType.Location)&&this.updateLocation(p.LocationUpdateReason.PermissionUpdate,!0)}),C.PermissionType.Location),y.default.subscribe((()=>{this._updateLocationPermission(C.PermissionType.LocationAlways)&&this.updateLocation(p.LocationUpdateReason.PermissionUpdate,!0)}),C.PermissionType.LocationAlways),f.default.subscribe((()=>{const e=!!f.default.getUserPreferencesLocal().bingLocationConsentGranted;this._bingLocationConsentGranted!==e&&(this._bingLocationConsentGranted=e,this._bingLocationConsentGranted&&this.updateLocation(p.LocationUpdateReason.BingConsentUpdate,!0))})),d.Resolved()}getLocation(){return this._lastPosition&&this._lastPosition.coords?this._lastPosition:void 0}getLocationForBing(){return!this._isChild()&&this._bingLocationConsentGranted?this.getLocation():void 0}needBingLocationConsentPrompt(){return!this._isChild()&&!this._bingLocationConsentGranted&&this.canPromptLocationAgain(C.PermissionType.Location)}bingLocationConsentAndPermissionGranted(){return!this._isChild()&&this._bingLocationConsentGranted&&this.locationPermissionGranted()}locationPermissionGranted(){return this._locationPermissionStatus[C.PermissionType.Location]===a.PermissionStatus.Granted||this._locationPermissionStatus[C.PermissionType.LocationAlways]===a.PermissionStatus.Granted}canPromptLocationAgain(e){if(e===C.PermissionType.Location){const e=f.default.getUserPreferencesLocal().locationStoreLastPromptTime;return!e||u.default.add(e,void 0,3)<Date.now()}{const e=n.max([f.default.getUserPreferencesLocal().locationStoreLastPromptTime,f.default.getUserPreferencesLocal().locationStoreLastPromptTimeAlways]);return!e||u.default.add(e,void 0,3)<Date.now()}}updateLocation(e,t=!1){var s;if(g.log(p.LogTraceArea.GenericUnsafe,"LocationStore.updateLocation requested, reason: "+p.LocationUpdateReason[e]),!this._canUpdateLocationForReason(e))return g.log(p.LogTraceArea.GenericUnsafe,"LocationStore.updateLocation not allowed"),d.Resolved(void 0);if(this._locationPermissionStatus[C.PermissionType.Location]!==a.PermissionStatus.Granted)return g.log(p.LogTraceArea.GenericUnsafe,"LocationStore.updateLocation locationPermissionStatus: "+this._locationPermissionStatus[C.PermissionType.Location]+", bingLocationConsentGranted: "+this._bingLocationConsentGranted),this._lastPosition=void 0,this._isLastPositionHighAccuracy=!1,d.Resolved(void 0);const i=this._isLastPositionHighAccuracy?b.maximumAge:T.maximumAge;if((null===(s=this._lastPosition)||void 0===s?void 0:s.coords)&&Date.now()<this._lastPosition.timestamp+i&&(!t||this._isLastPositionHighAccuracy))return d.Resolved(this._lastPosition);if(this._updatingLocation)return d.Resolved(this._lastPosition);this._updatingLocation=!0;const n=Date.now();return r.default.getCurrentPosition(Object.assign({},T)).then((e=>(g.log(p.LogTraceArea.GenericUnsafe,"LocationStore: Low accuracy location retrieved: "+o.pii.Omit(JSON.stringify(e))),this._lastPosition=e,this._isLastPositionHighAccuracy=!1,g.track(new m.LocationStoreGeolocationFetched(!1,Date.now()-n)),this.trigger(),t?this._updateHighAccuracyLocation():(this._updatingLocation=!1,e)))).catch((e=>(e.code===e.PERMISSION_DENIED&&(this._lastPosition=void 0,this._isLastPositionHighAccuracy=!1),g.track(new m.LocationStoreGeolocationFetchedFailed(!1,Date.now()-n,e.code===e.TIMEOUT,e.code===e.PERMISSION_DENIED,e.code===e.POSITION_UNAVAILABLE)),e.code===e.PERMISSION_DENIED?(g.warn(p.LogTraceArea.GenericUnsafe,"LocationStore: Permission to retrieve low accuracy location denied: "+e.code+" - "+e.message),this._updatingLocation=!1,this._locationPermissionStatus[C.PermissionType.Location]=a.PermissionStatus.Denied,void this.trigger()):t?this._updateHighAccuracyLocation():(g.warn(p.LogTraceArea.GenericUnsafe,"LocationStore: Unable to retrieve low accuracy location: "+e.code+" - "+e.message),this._updatingLocation=!1,void this.trigger()))))}_updateHighAccuracyLocation(){const e=Date.now();return r.default.getCurrentPosition(Object.assign(Object.assign({},b),{timeout:this._highAccuracyTimeout})).then((t=>(this._lastPosition=t,this._isLastPositionHighAccuracy=!0,this._updatingLocation=!1,g.log(p.LogTraceArea.GenericUnsafe,"LocationStore: High accuracy location retrieved: "+o.pii.Omit(JSON.stringify(t))),g.track(new m.LocationStoreGeolocationFetched(!0,Date.now()-e)),this.trigger(),t)),(t=>(this._updatingLocation=!1,g.track(new m.LocationStoreGeolocationFetchedFailed(!0,Date.now()-e,t.code===t.TIMEOUT,t.code===t.PERMISSION_DENIED,t.code===t.POSITION_UNAVAILABLE)),g.warn(p.LogTraceArea.GenericUnsafe,"LocationStore: Unable to retrieve high accuracy location: "+t.code+" - "+t.message),this.trigger(),this._lastPosition)))}updateLocationWithPermission(e,t=!1,s=!0,i=C.PermissionType.Location){return this.getLocationPermission(s,i).then((()=>this.updateLocation(e,t)))}getLocationPermission(e,t){if(this._locationPermissionStatus[C.PermissionType.LocationAlways]===a.PermissionStatus.Granted)return d.Resolved();if(t===C.PermissionType.Location&&this._locationPermissionStatus[C.PermissionType.Location]===a.PermissionStatus.Granted)return d.Resolved();let s=e?C.PermissionPromptOptions.SkipPrePrompt:void 0;this.canPromptLocationAgain(t)&&(s=s?s|C.PermissionPromptOptions.PromptAgainIfDenied:C.PermissionPromptOptions.PromptAgainIfDenied);const i=y.default.permissionStatus(t);return y.default.requestPermission(t,s).then((e=>e===a.PermissionStatus.Granted?d.Resolved():(t===C.PermissionType.Location&&(this._lastPosition=void 0,this._isLastPositionHighAccuracy=!1),this.canPromptLocationAgain(t)&&(t===C.PermissionType.Location?f.default.setUserPreferencesLocal({locationStoreLastPromptTime:Date.now()}):f.default.setUserPreferencesLocal({locationStoreLastPromptTimeAlways:Date.now()}),i===e&&_.default.showDeniedPromptWithSettingsOption(t,h.MainRootViewId)),d.Rejected()))).catch((e=>(g.log(p.LogTraceArea.GenericUnsafe,"LocationStore.getLocationPermission: error, permissionStatus = "+e),this._lastPosition=void 0,this._isLastPositionHighAccuracy=!1,d.Rejected())))}_updateLocationPermission(e){let t=!1;const s=y.default.permissionStatus(e);return s===a.PermissionStatus.Granted&&this._locationPermissionStatus[e]!==a.PermissionStatus.Granted&&(f.default.setUserPreferencesLocal({locationStoreLastPromptTime:0,locationStoreLastPromptTimeAlways:0}),t=!0),this._locationPermissionStatus[e]=s,t}_isChild(){var e;const t=null===(e=f.default.getUserPreferencesLocal().msaProfileKey)||void 0===e?void 0:e.ageGroup;return S.MsaProfileHelper.isChild(t)}_canUpdateLocationForReason(e){switch(e){case p.LocationUpdateReason.PermissionUpdate:case p.LocationUpdateReason.SlashCommand:case p.LocationUpdateReason.E911Startup:case p.LocationUpdateReason.E911NetworkChange:case p.LocationUpdateReason.E911ConsentUpdate:return!0;default:return!this._isChild()}}};(0,i.__decorate)([l.autoSubscribe],M.prototype,"getLocation",null),(0,i.__decorate)([l.autoSubscribe],M.prototype,"getLocationForBing",null),(0,i.__decorate)([l.autoSubscribe],M.prototype,"needBingLocationConsentPrompt",null),(0,i.__decorate)([l.autoSubscribe],M.prototype,"bingLocationConsentAndPermissionGranted",null),(0,i.__decorate)([l.autoSubscribe],M.prototype,"locationPermissionGranted",null),M=(0,i.__decorate)([l.AutoSubscribeStore],M),t.default=new M},18606:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=s(96486),n=s(88837),r=s(71830),a=s(46096),l=s(36237);let d=class extends n.StoreBase{constructor(){super(...arguments),this._albums={},this._albumMessages={},this._selectedMessageForAlbum={},this._albumMessagesDownloadInProgress={}}getAllMediaMessagesForAlbum(e){const t=o.some(this._albumMessages[e],(e=>e.isUnsent()));return o.sortBy(this._albumMessages[e],(e=>t?e.composeTime:e.createdTime))}getNotFailedMediaMessagesForAlbum(e){return this.getNotFailedMediaMessagesNoSubscription(e)}getAlbumMessage(e){return this._albums[e]}albumContainsMessage(e,t){return this._albumContainsMessage(e,t)}isDownloadingAlbum(e){return!!e&&this._albumMessagesDownloadInProgress[e]&&0!==this._albumMessagesDownloadInProgress[e].length}startAlbumDownload(e){this._albumMessagesDownloadInProgress[e]=o.map(this._albumMessages[e],(e=>e.cuid)),l.log(a.LogTraceArea.DownloadService,"MediaAlbum - starting download for album:"+e)}markAlbumMessageDownloadCompleted(e,t){this._albumMessagesDownloadInProgress[e]&&(o.remove(this._albumMessagesDownloadInProgress[e],(e=>e===t)),l.log(a.LogTraceArea.DownloadService,"MediaAlbum item downloading finished albumId:"+e+" cuid:"+t),0===this._albumMessagesDownloadInProgress[e].length&&(delete this._albumMessagesDownloadInProgress[e],l.log(a.LogTraceArea.DownloadService,"MediaAlbum downloading finished albumId:"+e)))}updateMessages(e){let t=[];o.each(e,(e=>{const s=e.conversationId===r.BookmarksThreadId&&e.isDeletedMessage()?e.getAlbumIdFromPreviousMessage():e.getAlbumId();if(s)if(e.isAlbum())e.isDeletedMessage()?delete this._albums[s]:this._albums[s]=e;else if(this._albumMessages[s]){let i=this._albumMessages[s][e.cuid];i&&e.isDeletedMessage()?(delete this._albumMessages[s][e.cuid],t.push(s)):e.isDeletedMessage()||i&&(!i.isUnsent()||e.isUnsent())||(this._albumMessages[s][e.cuid]=e,t.push(s))}else e.isDeletedMessage()||(this._albumMessages[s]={},this._albumMessages[s][e.cuid]=e,t.push(s))})),o.isEmpty(t)||this.trigger(o.uniq(t))}cleanupConversation(e){let t=o.sortBy(o.filter(this._albums,(t=>t.conversationId===e)),(e=>e.createdTime));t.pop(),o.each(t,(e=>{const t=e.getAlbumId();delete this._albums[t],delete this._albumMessages[t],delete this._selectedMessageForAlbum[t]})),o.isEmpty(t)||this.trigger(o.map(t,(e=>e.getAlbumId())))}getAlbumMessageByConversation(e,t){const s=o.map(o.filter(this._albums,(t=>t.conversationId===e)),(e=>e.getAlbumId()));let i;return o.each(s,(e=>(i=o.find(this._albumMessages[e],(e=>e.cuid===t)),!i))),i}setSelectedMediaForAlbum(e){const t=e.getAlbumId();this._selectedMessageForAlbum[t]=e}getSelectedMediaForAlbum(e){return this._selectedMessageForAlbum[e]}removeSelectedMediaForAlbum(e){this._selectedMessageForAlbum[e]&&delete this._selectedMessageForAlbum[e]}getNotFailedMediaMessagesNoSubscription(e){const t=o.filter(this._albumMessages[e],(e=>!e.isSendRejected())),s=o.some(t,(e=>e.isUnsent()));return o.sortBy(t,(e=>s?e.composeTime:e.createdTime))}test_reset_store(){this._albums={},this._albumMessages={},this._selectedMessageForAlbum={}}_albumContainsMessage(e,t){return 1===o.filter(this.getNotFailedMediaMessagesNoSubscription(e),(e=>e.cuid===t)).length}};(0,i.__decorate)([n.autoSubscribe,(0,i.__param)(0,n.key)],d.prototype,"getAllMediaMessagesForAlbum",null),(0,i.__decorate)([n.autoSubscribe,(0,i.__param)(0,n.key)],d.prototype,"getNotFailedMediaMessagesForAlbum",null),(0,i.__decorate)([n.disableWarnings],d.prototype,"albumContainsMessage",null),(0,i.__decorate)([n.autoSubscribe],d.prototype,"cleanupConversation",null),d=(0,i.__decorate)([n.AutoSubscribeStore],d),t.default=new d},65822:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=s(88837);let n=class extends o.StoreBase{constructor(){super(...arguments),this._playerNextToken=1,this._activePlayerToken=-1}getActivePlayerToken(){return this._activePlayerToken}registerAsPlayer(){return++this._playerNextToken}setAsActive(e){this._activePlayerToken=e,this.trigger()}stopActivePlayer(){this._activePlayerToken=-1,this.trigger()}};(0,i.__decorate)([o.autoSubscribe],n.prototype,"getActivePlayerToken",null),n=(0,i.__decorate)([o.AutoSubscribeStore],n),t.default=new n},3088:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=s(96486),n=s(88837),r=s(74634),a=s(97691),l=s(89391),d=s(39549),c=s(46096),h=(s(57347),s(36237)),u=s(33754),p=s(92350),g=s(26594),m=(s(14976),s(86045)),S=s(22538),f=s(4057),y=s(53374);let _=class extends n.StoreBase{constructor(){super(),this.previewLimitExceeded=new r.default,this._previewInfos={},S.RegisterStartupable(this,"MediaPreviewStore")}startup(){return a.Resolved()}getPreviews(e){const t=this._previewInfos[e];return t&&t.previews||[]}getDraftPreviews(e){const t=this._previewInfos[e];return t&&t.wasSavedAsDraft&&t.previews||[]}getDraftPreviewTimestamp(e){const t=this._previewInfos[e];return t&&t.wasSavedAsDraft&&!o.isEmpty(t.previews)?t.lastAddTimestamp:void 0}getConversationsWithMediaDraft(){const e=o.map(this._previewInfos,((e,t)=>{if(e.wasSavedAsDraft&&!o.isEmpty(e.previews)){const e=(0,d.default)().getConversation(t);if(e)return e}}));return o.compact(e)}addPreviews(e,t){const s=this._getOrCreatePreviewInfo(t),i=o.filter(e,(e=>void 0===o.find(s.previews,(t=>e.data.file.name===t.data.file.name&&e.data.file.size===t.data.file.size&&e.data.file.type===t.data.file.type))));if(!o.isEmpty(i)){const e=l.default.getS4LMessagingFeaturesNoSubscription().limitForFilePicker;if(s.previews.length+i.length>e)return void this.previewLimitExceeded.fire();s.previews=s.previews.concat(i),s.lastAddTimestamp=Date.now(),this.trigger(t),this._saveMediaPreviewsToDb(t)}}removePreview(e,t){if(!t)return;const s=this._getOrCreatePreviewInfo(e),i=o.find(s.previews,(e=>e.uid===t));i&&(s.previews=s.previews.filter((e=>e.uid!==t)),s.deletedPreviewsCount++,s.wasSavedAsDraft&&o.isEmpty(s.previews)&&(h.track(new g.MediaPreviewDraftDeletedEvent(this._getTelemetryProps(e))),s.wasSavedAsDraft=!1),m.default.maybeAnnounceForAccessibility(u.getString("MediaPreview.RemoveItem",{fileName:i.data.file.name})),this.trigger(e),this._saveMediaPreviewsToDb(e))}getAlbumId(e){const t=this._previewInfos[e];return t&&t.albumId}increaseOpenGalleryCount(e){this._getOrCreatePreviewInfo(e).galleryOpenCount++,this._saveMediaPreviewsToDb(e)}markSavedAsDraft(e){const t=this._previewInfos[e];return!t||o.isEmpty(t.previews)||t.wasSavedAsDraft?a.Resolved():(t.wasSavedAsDraft=!0,h.track(new g.MediaPreviewDraftCreatedEvent(this._getTelemetryProps(e))),this.trigger(e),this._saveMediaPreviewsToDb(e))}destroy(e,t=!1){t&&this._storeHasChanged(e)&&h.track(new g.MediaPreviewDraftDeletedEvent(this._getTelemetryProps(e))),this._resetStore(e)}markPreviewsSent(e,t){h.log(c.LogTraceArea.GenericUnsafe,"sendPreviews causeId: "+t),h.track(new g.MediaPreviewSentEvent(this._getTelemetryProps(e))),m.default.maybeAnnounceForAccessibility(u.getString("MessageComposer.FileSentLabel")),this._resetStore(e)}_getOrCreatePreviewInfo(e){let t=this._previewInfos[e];return t||(t={conversationId:e,previews:[],albumId:y.default.newGuid(),deletedPreviewsCount:0,galleryOpenCount:0,wasSavedAsDraft:!1,wasRecoveredFromDb:!1,lastAddTimestamp:void 0},this._previewInfos[e]=t),t}_storeHasChanged(e){const t=this._previewInfos[e];return t&&(!o.isEmpty(t.previews)||0!==t.deletedPreviewsCount)}_resetStore(e){const t=this._previewInfos[e];t&&(t.previews=[],this._saveMediaPreviewsToDb(e),delete this._previewInfos[e],this.trigger(e))}_getTelemetryProps(e){const t=this._getOrCreatePreviewInfo(e);return{previews:t.previews,deletedPreviewsCount:t.deletedPreviewsCount,galleryOpenCount:t.galleryOpenCount,wasSavedAsDraft:t.wasSavedAsDraft,wasRecoveredFromDb:t.wasRecoveredFromDb,lastAddTimestamp:t.lastAddTimestamp}}_loadAllMediaPreviewsFromDb(){return p.default.loadSavedMedia().then((e=>{h.log(c.LogTraceArea.GenericUnsafe,"Persisted media previews loaded for "+e.length+" conversations"),o.each(e,(e=>{const t=e.conversationId;this._previewInfos[t]||(this._previewInfos[t]=e)}))})).catch((e=>{h.warn(c.LogTraceArea.GenericUnsafe,"Error loading persisted media previews: "+f.default.errorAsString(e))}))}_saveMediaPreviewsToDb(e){return a.Resolved()}test_getDeletedPreviewsCount(e){return this._getOrCreatePreviewInfo(e).deletedPreviewsCount}test_getGalleryOpenCount(e){return this._getOrCreatePreviewInfo(e).galleryOpenCount}test_getWasSavedAsDraft(e){return this._getOrCreatePreviewInfo(e).wasSavedAsDraft}};(0,i.__decorate)([n.autoSubscribe,(0,i.__param)(0,n.key)],_.prototype,"getPreviews",null),(0,i.__decorate)([n.autoSubscribe,(0,i.__param)(0,n.key)],_.prototype,"getDraftPreviews",null),(0,i.__decorate)([n.autoSubscribe,(0,i.__param)(0,n.key)],_.prototype,"getDraftPreviewTimestamp",null),(0,i.__decorate)([n.autoSubscribe],_.prototype,"getConversationsWithMediaDraft",null),_=(0,i.__decorate)([n.AutoSubscribeStore],_),t.default=new _},19089:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessagePanelPiPContentStore=void 0;const i=s(70655),o=s(88837),n=s(89391),r=s(61253),a=s(86045),l=s(60305);let d=class extends o.StoreBase{getContentProps(){return this._pipViewContentProps}isPiPEnabled(){return n.default.getS4LMessagingFeaturesNoSubscription().openYouTubeLinksInPip&&!l.default.isTablet()&&!a.default.isMobileScreenReaderEnabled()}setContentProps(e){(0,r.default)(this._pipViewContentProps,e)||(this._pipViewContentProps=e,this.trigger())}};(0,i.__decorate)([o.autoSubscribe],d.prototype,"getContentProps",null),d=(0,i.__decorate)([o.AutoSubscribeStore],d),t.MessagePanelPiPContentStore=d,t.default=new d},22929:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(82261),n=s(46096),r=s(74163),a=s(4057),l=s(40363),d="skype/messages";t.default=new class{constructor(){this._selection=[],this._plainSelection=""}add(e,t,s,i){i?(this._newCopyChainStarted(i)&&this._cleanStore(),this._storeToStore(e,t,s),this._storeToClipboard(i)):this._storeToStore(e,t,s)}get(e){if(e){const t=this._getFromClipboard(e);return i.isEmpty(t)?this._getFromStore():t}return this._getFromStore()}hasContent(e){if(e.clipboardData){const t=e.clipboardData.getData("text/plain")||"";return(e.clipboardData.getData(d)||"").length>0&&t.length>0&&this._plainSelection===t}return!1}_newCopyChainStarted(e){return e.clipboardData&&!i.includes(e.clipboardData.types,d)}_getFromStore(){return this._selection}_cleanStore(){this._selection=[],this._plainSelection=""}_storeToStore(e,t,s){this._selection=i.sortBy([...this._selection,t],(e=>e.createdTime)),this._plainSelection=this._mapToPlainText(s)}_getFromClipboard(e){return e.clipboardData?this._mapToSelectionMeta(e.clipboardData.getData(d)):[]}_storeToClipboard(e){e.clipboardData&&(e.clipboardData.setData("text/plain",this._plainSelection),e.clipboardData.setData(d,this._mapToClipboardData(this._selection)))}_mapToClipboardData(e){return JSON.stringify(e.map((e=>(0,r.toClipboardObject)(e))))}_mapToSelectionMeta(e){return a.default.parseJsonWithDefault(e,[]).map((e=>{const t=o.createMessageInfoFromEscapedText(e.conversationId,n.PostSource.Clipboard,e.content).messageForPosting;return e.content=t.content,(0,r.fromClipboardObject)(e)}))}_mapToPlainText(e){return l.default.getPlatformType()===n.PlatformType.Windows?e.replace(/\r\n?|\n/g,"\r\n"):e}}},81884:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageStreamStore=void 0;const i=s(96486),o=s(88837),n=s(97691),r=s(89391),a=s(87430),l=s(22801),d=s(76621),c=s(51077),h=s(81697),u=s(71830),p=s(62141),g=s(984),m=s(39549),S=s(46096),f=s(36237),y=s(9785),_=s(18606),v=s(12056),C=s(75043),b=s(18078),T=s(14976),M=s(77914),I=s(12692),w=s(4057),P=s(78262),k=s(10996),A=s(69399),E=Number.MAX_VALUE;var R;!function(e){e[e.None=0]="None",e[e.Database=1]="Database",e[e.ChatService=2]="ChatService",e[e.WaitForSync=3]="WaitForSync",e[e.WaitForInit=4]="WaitForInit"}(R||(R={}));class L{constructor(e,t,s){this.messages={},this.messagesOutOfSyncWindow={},this.isEarliestTimeTheTopOfSyncWindow=!1,this.cannotSyncButNotAtBeginning=!1,this.isOutsideSyncWindow=!1,this.persistedMessagesFromQueries={},this.isLoadingEarlier=R.None,this.isLoadingLater=R.None,this.fetchedMessages=0,this.syncedBackwards=!1,this.conversationId=e,this.earliestMessageTime=t,this.latestMessageTime=s}_updateWindow(e,t=!1){let s=!1,o=this.earliestMessageTime,n=this.latestMessageTime;if(!t){if(2!==this.earliestMessageTime){const t=i.map(e,(e=>{const t=e.getLatestServerMessageVersion();return t&&+t||e.createdTime})),o=i.min(t);o<this.earliestMessageTime&&(this.earliestMessageTime=Math.max(o,2),s=!0)}if(this.latestMessageTime!==E){const t=i.maxBy(e,(e=>e.createdTime)).createdTime;t>this.latestMessageTime&&(this.latestMessageTime=t>P.NumberShim.MAX_SAFE_INTEGER?E:t,s=!0)}}return{windowChanged:s,oldEarliestMessageTime:o,oldLatestMessageTime:n}}updateWindowAndMessages(e,t,s){if(0===e.length)return{windowChanged:!1,messagesChanged:!1};const{windowChanged:i,oldEarliestMessageTime:o,oldLatestMessageTime:n}=this._updateWindow(e,t),{messagesChanged:r,visibleMessages:a,visibleMessagesInWindow:l,otherMessages:d}=this._updateMessageCache(e);if(e.length){let e="["+s+"] Message cache update:";if(r||!i){const t=a.length-l.length;e+=" "+l.length+" applied, "+t+" dropped, "+d.length+" other. "}if(i){e+=" "+this._getTraceWindowUpdateString(o,n)}D(this.conversationId,e)}return{windowChanged:i,messagesChanged:r}}updateWindowFromEmptyEarlierDBQuery(e){return e<this.earliestMessageTime&&(this.earliestMessageTime=Math.max(e,2),!0)}updateWindowToBeginningOfTime(){if(2===this.earliestMessageTime)return!1;const e=this.earliestMessageTime;return this.earliestMessageTime=2,D(this.conversationId,this._getTraceWindowUpdateString(e,this.latestMessageTime)),!0}updateWindowToEndOfTime(){if(this.latestMessageTime===E)return!1;const e=this.latestMessageTime;return this.latestMessageTime=E,D(this.conversationId,this._getTraceWindowUpdateString(this.earliestMessageTime,e)),!0}updateWindowHandleHistoryDisclosed(){if(!this.isEarliestTimeTheTopOfSyncWindow){const e=this.earliestMessageTime,t=i.values(this.messages);return t.length>0&&(this.earliestMessageTime=i.minBy(t,(e=>e.createdTime)).createdTime),e!==this.earliestMessageTime}const e=this.earliestMessageTime,t=h.default.getEarliestKnownMessageTime(this.conversationId);return this.earliestMessageTime=Math.max(t,e),e!==this.earliestMessageTime}_getTraceTimeString(e){return 2===e?"Beginning":e===E?"End":e.toString()}_getTraceWindowUpdateString(e,t){return"Window updated from ["+this._getTraceTimeString(e)+", "+this._getTraceTimeString(t)+"] to ["+this._getTraceTimeString(this.earliestMessageTime)+", "+this._getTraceTimeString(this.latestMessageTime)+"]"}_updateMessageCache(e){let t=!1,s=e,[o,n]=i.partition(s,(e=>e.isShownInStream())),[r,a]=i.partition(o,(e=>this.isTimeInWindow(e.createdTime)||this.latestMessageTime===E&&e.isMessageLie()));if(a.length&&i.extend(this.messagesOutOfSyncWindow,i.keyBy(a,(e=>e.cuid))),r.length){this.sortedMessages=void 0;const e=i.keyBy(r,(e=>e.cuid));i.extend(this.messages,e),t=!0}return i.each(n,(e=>{this.isTimeInWindow(e.createdTime)&&(e.isDeletedMessage()||e.isCanceledScheduledCall())&&this.messages[e.cuid]&&(delete this.messages[e.cuid],this.sortedMessages=void 0,t=!0)})),_.default.updateMessages(e),C.default.updateMessages(e),{messagesChanged:t,visibleMessages:o,visibleMessagesInWindow:r,otherMessages:n}}setAsNoLongerOutsideSyncWindow(){this.isOutsideSyncWindow=!1,this.localSyncState=void 0,D(this.conversationId,"No longer outside Sync window")}isTimeInWindow(e){return e>=this.earliestMessageTime&&e<=this.latestMessageTime}getLatestKnownMessage(){return i.last(this.sortedMessages)||i.maxBy(i.toArray(this.messages),(e=>e.createdTime))}checkForOutSideSyncWindowMessages(){i.each(this.messagesOutOfSyncWindow,(e=>{this.isTimeInWindow(e.createdTime)&&(this.messages[e.cuid]=this.messagesOutOfSyncWindow[e.cuid],delete this.messagesOutOfSyncWindow[e.cuid],this.sortedMessages=void 0)}))}}const F=55;class x extends o.StoreBase{constructor(e,t){super(0,!0),this._targetMessageTimestamp=t,this._isInitialized=!1,this._isInitialMessagesLoaded=!1,this._isRealConversationKnown=!1,this._syncCompleteCallback=()=>{if(this._conversationInfo){if(this._conversationInfo.isOutsideSyncWindow){h.default.getEarliestKnownMessageTime(this._conversationInfo.conversationId)<=this._conversationInfo.earliestMessageTime&&this._conversationInfo.setAsNoLongerOutsideSyncWindow()}if(this._waitForSyncCompleteDeferred){const e=this._waitForSyncCompleteDeferred;this._waitForSyncCompleteDeferred=void 0,e.resolve(void 0)}}else V(this._debug_convId,"Store was destroyed but got a callback for sync completed")},this._conversationUpdatedCallback=e=>{if(!this._isInitialized)return;if(!this._conversationInfo)return void V(this._debug_convId,"Store was destroyed but got a callback for conv updated");const t=i.find(e,(e=>e.conv.id===this._conversationInfo.conversationId));if(t){const e=this._conversationInfo.isHistoryDisclosed;this._conversationInfo.isHistoryDisclosed=t.conv.isHistoryDisclosed(),!e&&this._conversationInfo.isHistoryDisclosed&&(D(this._debug_convId,"History disclosed"),this._conversationInfo.updateWindowHandleHistoryDisclosed()&&(this._conversationInfo.checkForOutSideSyncWindowMessages(),this.fetchEarlierMessages()))}if(!this._conversationInfo.isOutsideSyncWindow){const e=h.default.getEarliestKnownMessageTime(this._conversationInfo.conversationId),t=this._conversationInfo.getLatestKnownMessage();t&&t.createdTime<e&&(D(this._debug_convId,"Invalidating store for future caching because it has a possible gap."),this._probablyShouldNotCache=!0)}},this._messagesUpdatedCallback=e=>{if(!this._conversationInfo)return void V(this._debug_convId,"Store was destroyed but got a callback for new messages");if(!this._isInitialized)return;const t=i.map(i.filter(e,(e=>e.conversationId===this._conversationInfo.conversationId))),{windowChanged:s,messagesChanged:o}=this._conversationInfo.updateWindowAndMessages(t,!0,"messagesUpdated");this._conversationInfo.checkForOutSideSyncWindowMessages(),(s||o)&&this.trigger()},this._updateContactInviteMessages=()=>{if(!this._conversationInfo)return void V(this._debug_convId,"Store was destroyed but got a callback for contact invite messages");const e=g.default.getInviteMessagesForConversation(this._conversationInfo.conversationId),t=i.filter(e,(e=>!i.some(this._conversationInfo.messages,(t=>t.createdTime===e.createdTime))));if(t.length>0){const{windowChanged:e,messagesChanged:s}=this._conversationInfo.updateWindowAndMessages(t,!1,"updateContactInvites");this._conversationInfo.checkForOutSideSyncWindowMessages(),(e||s)&&this.trigger()}},this._updateScheduledCallMessages=()=>{if(!this._conversationInfo)return void V(this._debug_convId,"Store was destroyed but got a callback for scheduled call messages");const e=M.default.getSystemMessagesForConversation(this._conversationInfo.conversationId);if(e.length>0){const{windowChanged:t,messagesChanged:s}=this._conversationInfo.updateWindowAndMessages(e,!1,"updateScheduledCalls");this._conversationInfo.checkForOutSideSyncWindowMessages(),(t||s)&&this.trigger()}},this._wrapWithTriggerLogic=e=>{if(!this._conversationInfo)return;const t=this.isLoadingItems(),s=this.isEarliestMessageTheBeginning(),i=this.isLatestMessageTheEnd(),o=e(),n=this.isLoadingItems(),r=this.isEarliestMessageTheBeginning(),a=this.isLatestMessageTheEnd();t===n&&s===r&&i===a||this.trigger();let l=!0;o.then((()=>{l||this._conversationInfo&&(n===this.isLoadingItems()&&r===this.isEarliestMessageTheBeginning()&&a===this.isLatestMessageTheEnd()||this.trigger())})),l=!1},this._debug_convId=e;const s=t||E;let o=Math.max(s,2);o>P.NumberShim.MAX_SAFE_INTEGER&&(o=E),this._conversationInfo=new L(e,o,o);const n=h.default.getEarliestKnownMessageTime(e);D(this._debug_convId,'Initializing at "'+o+'"'+(o<n?' (earlier than Sync at "'+n+'")':"")),this._messagesUpdatedSubscriptionToken=d.default.messagesProcessed.subscribe(this._messagesUpdatedCallback),this._conversationsUpdatedSubscriptionToken=d.default.conversationsUpdated.subscribe(this._conversationUpdatedCallback),this._syncCompleteSubscriptionToken=h.default.syncComplete.subscribe(this._syncCompleteCallback),this._initialize()}subscribe(e,t){const s=super.subscribe(e,t),i=this._waitForSubscribersDeferred;return i&&(this._waitForSubscribersDeferred=void 0,i.resolve(void 0)),s}_initialize(){this._conversationInfo&&this._wrapWithTriggerLogic((()=>this._conversationInfo?(this._conversationInfo.isLoadingEarlier=R.WaitForInit,this._conversationInfo.isLoadingLater=R.WaitForInit,n.Resolved().thenAsync((()=>this._initializeAfterWaitingForRealConversation())).then((()=>{if(!this._conversationInfo)return n.Rejected("Store was destroyed: nothing to do.");this._conversationInfo.isLoadingEarlier=R.None,this._conversationInfo.isLoadingLater=R.None;const e=d.default.getConversationMetaFromMemoryCache(this._conversationInfo.conversationId);return e&&(this._conversationInfo.isHistoryDisclosed=e.conv.isHistoryDisclosed()),this._isInitialized=!0,this._fetchInitialMessages()})).then((()=>this._conversationInfo?!this._conversationInfo.isOutsideSyncWindow&&this._isRealConversationKnown||!i.isEmpty(this._conversationInfo.messages)||this._conversationInfo.earliestMessageTime!==this._conversationInfo.latestMessageTime?void 0:(this._reinitializeAtEndOfTime(),this._fetchInitialMessages()):n.Rejected("Store was destroyed: nothing to do."))).then((()=>{if(!this._conversationInfo)return n.Rejected("Store was destroyed: nothing to do.");this._updateContactInviteMessages(),this._contactsStoreSubscriptionToken=g.default.subscribe(this._updateContactInviteMessages),this._updateScheduledCallMessages(),this._scheduledCallsStoreSubscriptionToken=M.default.subscribe(this._updateScheduledCallMessages)})).catch((e=>{this._conversationInfo&&V(this._debug_convId,"Unhandled error while store is alive: "+w.default.errorAsString(e))}))):n.Rejected("Store was destroyed: nothing to do.")))}_initializeAfterWaitingForRealConversation(){if(!this._conversationInfo)return n.Rejected("Store was destroyed: nothing to do.");const e=this._conversationInfo.conversationId;return d.default.waitForJoinedKnowledgeOfConversation(e).then((t=>{if(!this._conversationInfo)return n.Rejected("Store was destroyed: nothing to do.");if(!t.isFake)return this._isRealConversationKnown=!0,void D(this._debug_convId,"Conversation is known from the get-go");D(this._debug_convId,"Unknown conversation: waiting to hear about it or Sync finishing");const s=d.default.waitForJoinedKnowledgeOfRealConversation(e);let i;return h.default.isCurrentlySyncing()?(this._waitForSyncCompleteDeferred=n.Defer(),i=this._waitForSyncCompleteDeferred.promise()):i=n.Resolved(),n.race([s,i]).then((()=>{if(!this._conversationInfo)return n.Rejected("Store was destroyed: nothing to do.");const t=(0,m.default)().getConversation(e);if(t&&!t.isFake)return this._isRealConversationKnown=!0,void D(this._debug_convId,"Conversation became known while waiting: normal init");this._reinitializeAtEndOfTime(),s.then((()=>{this._conversationInfo&&(this._isRealConversationKnown=!0,D(this._debug_convId,"Conversation became known: attempting to fix our window"),this._conversationInfo.isEarliestTimeTheTopOfSyncWindow=!1,this._conversationInfo.earliestMessageTime=E,this.fetchEarlierMessages())}))}))}))}_reinitializeAtEndOfTime(){D(this._debug_convId,"Could not initialize: jumping to EndOfTime."+(this._isRealConversationKnown?"":" (Conversation is unknown.)")),this._conversationInfo&&(this._conversationInfo.isOutsideSyncWindow=!1,this._conversationInfo.isEarliestTimeTheTopOfSyncWindow=!1,this._conversationInfo.earliestMessageTime=E,this._conversationInfo.latestMessageTime=E)}isLoadingItems(){return this._conversationInfo?this._conversationInfo.isLoadingEarlier!==R.None||this._conversationInfo.isLoadingLater!==R.None:(V(this._debug_convId,"Store is already destroyed"),!1)}isLoadingItemsFromNetwork(){return this._conversationInfo?this._conversationInfo.isLoadingEarlier===R.ChatService||this._conversationInfo.isLoadingEarlier===R.WaitForSync||this._conversationInfo.isLoadingLater===R.ChatService||this._conversationInfo.isLoadingLater===R.WaitForSync:(V(this._debug_convId,"Store is already destroyed"),!1)}isInitialMessagesLoaded(){return this._conversationInfo?this._isInitialMessagesLoaded:(V(this._debug_convId,"Store is already destroyed"),!0)}cannotGetEarlierMessages(){return this._conversationInfo?this._conversationInfo.cannotSyncButNotAtBeginning:(V(this._debug_convId,"Store is already destroyed"),!0)}isEarliestMessageTheBeginning(){return this._conversationInfo?2===this._conversationInfo.earliestMessageTime:(V(this._debug_convId,"Store is already destroyed"),!0)}isLatestMessageTheEnd(){return this._conversationInfo?this._conversationInfo.latestMessageTime===E:(V(this._debug_convId,"Store is already destroyed"),!0)}getMessages(){var e;if(!this._conversationInfo)return V(this._debug_convId,"Store is already destroyed"),[];if(!this._conversationInfo.sortedMessages){let e;if(u.isBookmarkConversation(this._conversationInfo.conversationId))e=i.sortBy(this._conversationInfo.messages,(e=>a.getSourceMessageDate(e.properties)));else if(r.default.getS4LMessagingFeatures().enableKeepUnsentMessagesAtEndOfStream){const[t,s]=i.partition(this._conversationInfo.messages,(e=>e.isUnsent()&&!e.isSendRejected()&&!e.isEdited()&&(c.isEncryptedMessageType(e.messagetype)||c.isRichTextMessageType(e.messagetype)||c.isWrittenTextMessageType(e.messagetype)))),o=i.sortBy(s,(e=>e.createdTime)),n=i.sortBy(t,(e=>e.composeTime));e=o.concat(n)}else e=i.sortBy(this._conversationInfo.messages,(e=>e.createdTime));this._conversationInfo.sortedMessages=e}return(0,m.default)().isClearApplicableAndKeepInRecents(this._conversationInfo.conversationId)&&(null===(e=(0,m.default)().getConversation(this._conversationInfo.conversationId))||void 0===e?void 0:e.isDeleted())&&(this._conversationInfo.sortedMessages=[],this._conversationInfo.messages={}),this._conversationInfo.sortedMessages}getConversationId(){if(this._conversationInfo)return this._conversationInfo.conversationId;V(this._debug_convId,"Store is already destroyed")}getTargetMessageTimestamp(){if(this._conversationInfo)return this._targetMessageTimestamp;V(this._debug_convId,"Store is already destroyed")}probablyShouldNotCache(){return this._probablyShouldNotCache}fetchEarlierMessages(){this._wrapWithTriggerLogic((()=>this._fetchEarlierMessagesIfNeeded(F,!0)))}fetchLaterMessages(){this._wrapWithTriggerLogic((()=>this._fetchLaterMessagesIfNeeded(F,!0)))}feedEphemeralMessage(e){if(!this._conversationInfo)return;const t=this._conversationInfo.getLatestKnownMessage(),s=Math.max(t&&t.createdTime||0,Date.now())+1,i=I.default.fromFirstLie(e.messageForPosting,e.conversationId,b.default.getSkypeMri(),s,!0);this._messagesUpdatedCallback([i])}destroy(){this._syncCompleteSubscriptionToken&&this._syncCompleteSubscriptionToken.unsubscribe(),this._messagesUpdatedSubscriptionToken&&this._messagesUpdatedSubscriptionToken.unsubscribe(),this._conversationsUpdatedSubscriptionToken&&this._conversationsUpdatedSubscriptionToken.unsubscribe(),this._contactsStoreSubscriptionToken&&g.default.unsubscribe(this._contactsStoreSubscriptionToken),this._scheduledCallsStoreSubscriptionToken&&M.default.unsubscribe(this._scheduledCallsStoreSubscriptionToken);const e=this.getConversationId();e&&_.default.cleanupConversation(e),this._conversationInfo=void 0;const t=this._waitForSubscribersDeferred;t&&(this._waitForSubscribersDeferred=void 0,t.resolve(void 0))}isDestroyed(){return!this._conversationInfo}_fetchInitialMessages(){if(!this._conversationInfo)return n.Rejected("Store was destroyed: nothing to do.");const e=this._conversationInfo.conversationId;this._conversationInfo.isOutsideSyncWindow=this._isRealConversationKnown&&this._conversationInfo.latestMessageTime<h.default.getEarliestKnownMessageTime(e);const t=this._conversationInfo.isOutsideSyncWindow?h.default.waitForMessageSyncToFinish(this._conversationInfo.conversationId).catch(i.noop):n.Resolved();return this._conversationInfo.isLoadingEarlier=R.WaitForSync,this._conversationInfo.isLoadingLater=R.WaitForSync,t.then((()=>{if(!this._conversationInfo)return;this._conversationInfo.isLoadingEarlier=R.None,this._conversationInfo.isLoadingLater=R.None,this._conversationInfo.isOutsideSyncWindow=this._isRealConversationKnown&&this._conversationInfo.latestMessageTime<h.default.getEarliestKnownMessageTime(e),D(this._debug_convId,"Fetching initial messages");const t=Date.now(),s=this._fetchEarlierMessagesIfNeeded(Math.floor(27.5),!1),i=this._fetchLaterMessagesIfNeeded(Math.ceil(27.5),!1);return n.all([s,i]).then((()=>{this._isInitialMessagesLoaded=!0,this._conversationInfo&&(this._conversationInfo.fetchedMessages||this._conversationInfo.syncedBackwards)&&f.track(new v.MessagesFetched(e,this._conversationInfo.fetchedMessages,this._conversationInfo.syncedBackwards,Date.now()-t)),this.isDestroyed()||this.trigger()}))}))}_fetchEarlierMessagesIfNeeded(e,t){return this._conversationInfo?this._fetchEarlierMessagesIfNeededInternal(e,t,this._conversationInfo.earliestMessageTime):n.Rejected("Store was destroyed: nothing to do.")}_fetchEarlierMessagesIfNeededInternal(e,t,s){if(!this._conversationInfo)return n.Rejected("Store was destroyed: nothing to do.");const o=this._conversationInfo.conversationId;if(this._conversationInfo.isLoadingEarlier||2===this._conversationInfo.earliestMessageTime||this._conversationInfo.cannotSyncButNotAtBeginning||!this._isInitialized)return B(this._debug_convId,"_fetchEarlierMessages no need"),n.Resolved();if(this._conversationInfo.isOutsideSyncWindow){const n=this._conversationInfo.earliestMessageTime;return B(this._debug_convId,"_fetchEarlierMessages request more messages from ChatService, Max messages: "+e+", Earlier than: "+n+", SyncState: "+u.encodeSyncStateForLog(this._conversationInfo.localSyncState)),this._conversationInfo.isLoadingEarlier=R.ChatService,i.isUndefined(this._targetMessageTimestamp)||(0,k.markMessageSearchAdditionalMessageLoading)(o,this._targetMessageTimestamp,A.AdditionalLoading.ChatService),l.default.serviceGetConversationMessagesEarlierThanTime(o,2,this._conversationInfo.localSyncState,e,n).then((i=>{if(this._conversationInfo)return this._handleChatServiceResponse(i).then((o=>{if(this._conversationInfo){this._conversationInfo.isLoadingEarlier=R.None;const{windowChanged:n,messagesChanged:r}=this._conversationInfo.updateWindowAndMessages(o,!1,"fetchEarlierCS");if(this._conversationInfo.checkForOutSideSyncWindowMessages(),i.messages.length<e)this._conversationInfo.updateWindowToBeginningOfTime(),this._conversationInfo.checkForOutSideSyncWindowMessages();else if(n&&!r)return B(this._debug_convId,"_fetchEarlierMessages no visible messages within the updated window: try again"),this._fetchEarlierMessagesIfNeededInternal(e,t,s)}}))}),(e=>{this._conversationInfo&&(this._conversationInfo.isLoadingEarlier=R.None),V(this._debug_convId,'Failed to load earlier messages from the Chat Service (end time "'+n+'")',w.default.errorAsString(e))}))}if(this._conversationInfo.isEarliestTimeTheTopOfSyncWindow){B(this._debug_convId,"_fetchEarlierMessages use Sync to fetch");const n=i.clone(this._conversationInfo.messages),r=i.clone(this._conversationInfo.messagesOutOfSyncWindow),a=this._conversationInfo.earliestMessageTime;let l=!1;return this._conversationInfo.isLoadingEarlier=R.WaitForSync,this._syncBackwardsAndWait(o).then((()=>{if(this._conversationInfo){const t=h.default.getEarliestKnownMessageTime(this._conversationInfo.conversationId);return B(this._debug_convId,"_fetchEarlierMessages fetching from db between "+t+" and "+s+", max messages: "+e),this._getMessagesInRange(o,t,s,e).then((e=>{if(this._conversationInfo){const s=this._conversationInfo.updateWindowAndMessages(e,!1,"fetchEarlierSyncThenDB");l=s.messagesChanged,0===e.length&&this._conversationInfo.updateWindowFromEmptyEarlierDBQuery(t),this._conversationInfo.checkForOutSideSyncWindowMessages()}}))}})).then((()=>{if(this._conversationInfo){this._conversationInfo.isLoadingEarlier=R.None;const i=d.default.getConversationMetaFromMemoryCache(o);if(i)if(i.conv.isBricked)B(this._debug_convId,"_fetchEarlierMessages conversation bricked"),this._conversationInfo.cannotSyncButNotAtBeginning=!0;else{h.default.haveAllMessagesForConversation(o)&&(B(this._debug_convId,"_fetchEarlierMessages sync has everything"),this._conversationInfo.isEarliestTimeTheTopOfSyncWindow=!1);const i=!this._haveMessagesChanged(n,this._conversationInfo.messages);if(B(this._debug_convId,"_fetchEarlierMessages finished sync"+(i?" without changes - refetching":" and got message updates")),i){const i=this._haveMessagesChanged(r,this._conversationInfo.messagesOutOfSyncWindow);this._conversationInfo.earliestMessageTime!==a||!this._conversationInfo.isEarliestTimeTheTopOfSyncWindow||i||l?this._fetchEarlierMessagesIfNeededInternal(e,t,s):B(this._debug_convId,"_fetchEarlierMessages sync gave us nothing")}}else B(this._debug_convId,"_fetchEarlierMessages conversation not known")}}))}{const n=h.default.getEarliestKnownMessageTime(this._conversationInfo.conversationId);return B(this._debug_convId,"_fetchEarlierMessages Fetch from the DB between "+n+" and "+s+", max messages: "+e),this._conversationInfo.isLoadingEarlier=R.Database,i.isUndefined(this._targetMessageTimestamp)||(0,k.markMessageSearchAdditionalMessageLoading)(o,this._targetMessageTimestamp,A.AdditionalLoading.IndexedDB),this._getMessagesInRange(o,n,s,e).then((i=>{if(this._conversationInfo){this._conversationInfo.isLoadingEarlier=R.None;const{windowChanged:n,messagesChanged:r}=this._conversationInfo.updateWindowAndMessages(i,!1,"fetchEarlierDB");if(i.length<e){if(!this._isRealConversationKnown)return void this._conversationInfo.updateWindowToBeginningOfTime();h.default.haveAllMessagesForConversation(o)?(this._conversationInfo.updateWindowToBeginningOfTime(),this._conversationInfo.checkForOutSideSyncWindowMessages()):this._conversationInfo.isEarliestTimeTheTopOfSyncWindow=!0}const a=n||2===s;if(0===i.length||a&&!r&&e<550)return i.length===e&&(e+=Math.floor(27.5)),B(this._debug_convId,"_fetchEarlierMessages no visible messages within the updated window: try again, new maxMessages: "+e),this._fetchEarlierMessagesIfNeededInternal(e,t,s)}}))}}_haveMessagesChanged(e,t){return!(0,y.default)(e,t,((e,t,s)=>s?e===t:void 0))}_fetchLaterMessagesIfNeeded(e,t){if(!this._conversationInfo)return n.Rejected("Store was destroyed: nothing to do.");const s=this._conversationInfo.conversationId;if(this._conversationInfo.isLoadingLater||this._conversationInfo.latestMessageTime===E||!this._isInitialized)return B(this._debug_convId,"_fetchLaterMessages no need"),n.Resolved();if(this._conversationInfo.isOutsideSyncWindow){const o=this._conversationInfo.latestMessageTime,n=h.default.getEarliestKnownMessageTime(s);return B(this._debug_convId,"_fetchLaterMessages request more messages from ChatService, Max messages: "+e+", Start time: "+o+", Later than: "+n+", SyncState: "+u.encodeSyncStateForLog(this._conversationInfo.localSyncState)),this._conversationInfo.isLoadingLater=R.ChatService,i.isUndefined(this._targetMessageTimestamp)||(0,k.markMessageSearchAdditionalMessageLoading)(s,this._targetMessageTimestamp,A.AdditionalLoading.ChatService),l.default.serviceGetConversationMessagesLaterThanTime(s,o,n,this._conversationInfo.localSyncState,e,!1).then((s=>{if(this._conversationInfo)return this._handleChatServiceResponse(s,e).then((i=>{if(this._conversationInfo){this._conversationInfo.isLoadingLater=R.None;const{windowChanged:o,messagesChanged:n}=this._conversationInfo.updateWindowAndMessages(i,!1,"fetchLaterCS");if(this._conversationInfo.checkForOutSideSyncWindowMessages(),s.messages.length,0===i.length||o&&!n)return B(this._debug_convId,"_fetchLaterMessages mo visible messages within the updated window: try again"),this._fetchLaterMessagesIfNeeded(e,t)}}))}),(e=>{this._conversationInfo&&(this._conversationInfo.isLoadingLater=R.None),V(this._debug_convId,'Failed to load later messages from the Chat Service (start time "'+o+'")',w.default.errorAsString(e))}))}return B(this._debug_convId,"_fetchLaterMessages Fetch from the DB after "+this._conversationInfo.latestMessageTime),this._conversationInfo.isLoadingLater=R.Database,i.isUndefined(this._targetMessageTimestamp)||(0,k.markMessageSearchAdditionalMessageLoading)(s,this._targetMessageTimestamp,A.AdditionalLoading.IndexedDB),p.default.getMessagesForConversationAfterTime(s,this._conversationInfo.latestMessageTime,e,t).then((s=>{if(this._conversationInfo){this._conversationInfo.isLoadingLater=R.None;const{windowChanged:i,messagesChanged:o}=this._conversationInfo.updateWindowAndMessages(s,!1,"fetchLaterDB");if(this._conversationInfo.checkForOutSideSyncWindowMessages(),s.length<e)this._conversationInfo.updateWindowToEndOfTime(),this._conversationInfo.checkForOutSideSyncWindowMessages();else if(i&&!o)return B(this._debug_convId,"_fetchLaterMessages no visible messages within the updated window: try again"),this._fetchLaterMessagesIfNeeded(e,t)}}))}_getMessagesInRange(e,t,s,i){return t>s?n.Resolved([]):p.default.getMessagesForConversationAndTimeRange(e,t,s,!0,i)}_handleChatServiceResponse(e,t=0){if(!this._conversationInfo)return n.Resolved([]);if(this._conversationInfo.fetchedMessages+=e.messages.length,this._conversationInfo.isOutsideSyncWindow){let s=!1;if(e.messages.length<t)s=!0;else if(e.messages.length){s=Number(i.maxBy(e.messages,(e=>e.id)).id)>=h.default.getEarliestKnownMessageTime(this._conversationInfo.conversationId)}s?this._conversationInfo.setAsNoLongerOutsideSyncWindow():this._conversationInfo.localSyncState=u.decodeSyncState(e._metadata.syncState)}let s;const o=this._conversationInfo.conversationId;if(u.isEncryptedThread(o)){const t=i.map(e.messages,(e=>({message:e,origin:S.MessageOrigin.ChatSync,isOtherEndpointActive:!1})));s=d.default.queueMessagesForConversationAndWait(o,t).then((()=>p.default.openTransaction([p.Stores.Messages],!1).then((t=>{const s=i.map(e.messages,(e=>u.getCuidForMessage(e))),n=t.getMessagesByCuid(o,s);return t.markCompleted(),n}))))}else{const t=i.compact(i.map(e.messages,(e=>{const t=u.getCuidForMessage(e);return this._conversationInfo.persistedMessagesFromQueries[t]?this._conversationInfo.persistedMessagesFromQueries[t].applyServerMessage(e):I.default.fromFirstServerMessage(e)})));i.extend(this._conversationInfo.persistedMessagesFromQueries,i.keyBy(t,(e=>e.cuid))),s=n.Resolved(t)}return s}_syncBackwardsAndWait(e){return h.default.syncBackwards(e).then((t=>{if(this._conversationInfo){const s=t?h.default.waitForMessageSyncToFinish(this._conversationInfo.conversationId):n.Resolved();return!this._conversationInfo.syncedBackwards&&t&&(this._conversationInfo.syncedBackwards=!0),s.then(i.noop,(t=>{if(!this._conversationInfo)return;let s;return 0===this._getSubscriptionKeys().length?(D(this._debug_convId,"Failed to wait for message sync to finish, postponing retries due to no subscribers"),this._waitForSubscribersDeferred||(this._waitForSubscribersDeferred=n.Defer()),s=this._waitForSubscribersDeferred.promise()):s=n.Resolved(),s.thenAsync((()=>{if(this._conversationInfo)return D(this._debug_convId,"Failed to wait for message sync to finish, retrying"),this._syncBackwardsAndWait(e)}))}))}}))}}function O(e){return'For conv "'+T.mriOrId(e)+'"'}function D(e,...t){f.log(S.LogTraceArea.MessageStreamStore,O(e),...t)}function B(e,...t){f.log(S.LogTraceArea.MessageStreamStoreDebug,O(e),...t)}function V(e,...t){f.error(S.LogTraceArea.MessageStreamStore,O(e),...t)}t.MessageStreamStore=x},75043:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=s(96486),n=s(88837),r=s(89391),a=s(51077);let l=class extends n.StoreBase{constructor(){super(...arguments),this._translatedMessages={}}getTranslatedMessage(e,t){return this._translatedMessages[e]&&this._translatedMessages[e][t]}hasTranslatedMessage(e,t){return!(!this._translatedMessages[e]||!this._translatedMessages[e][t])}updateMessages(e){if(!r.default.getS4LCMCFeatures().enableMessageTranslation)return;let t=[];o.each(e,(e=>{const s=e.conversationId;if(s&&(0,a.isTranslationMessageType)(e.messagetype)){const i=(0,a.getMessageTranslationMetadata)(e.content);e.isDeletedMessage()||!i?delete this._translatedMessages[s]:(this._translatedMessages[s]||(this._translatedMessages[s]={}),this._translatedMessages[s][i.oid]=e),t.push(s)}})),o.isEmpty(t)||this.trigger(o.uniq(t))}test_reset(){this._translatedMessages={}}test_getUpdatedTranslationMessages(){return this._translatedMessages}};(0,i.__decorate)([n.autoSubscribe,(0,i.__param)(0,n.key)],l.prototype,"getTranslatedMessage",null),(0,i.__decorate)([n.autoSubscribe,(0,i.__param)(0,n.key)],l.prototype,"hasTranslatedMessage",null),l=(0,i.__decorate)([n.AutoSubscribeStore],l),t.default=new l},40897:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSupportedTabType=t.MobileExpressionPickerStore=void 0;const i=s(70655),o=s(31844),n=s(88837),r=s(97691),a=s(98278),l=s(83294),d=s(58962),c=s(29130),h=s(22538),u=s(60305);let p=class extends n.StoreBase{constructor(){super(),this._activeTabType=l.defaultTabType,this._isInlineSearchActive=!1,this._isPickerActive=!1,h.RegisterStartupable(this,"MobileExpressionPickerStore",[c.default])}startup(){return c.default.subscribe((()=>{c.default.getDeviceOrientation(a.MainRootViewId)!==o.DeviceOrientation.Landscape||u.default.useTabletUI()||this._activeTabType===d.TabType.Gif||this.deactivateInlineSearch()}),c.TriggerKeys.Orientation),r.Resolved(void 0)}tryActivateInlineSearch(e,t){return!(c.default.getDeviceOrientation(a.MainRootViewId)===o.DeviceOrientation.Landscape&&!u.default.useTabletUI()&&e!==d.TabType.Gif)&&(this._isInlineSearchActive&&this._activeTabType===e||(this._isInlineSearchActive=!0,this._isPickerActive=!1,this._activeTabType=e,this._initialSearch=t,this.trigger()),!0)}deactivateInlineSearch(){this._isInlineSearchActive&&(this._isInlineSearchActive=!1,this._activeTabType=l.defaultTabType,this._initialSearch=void 0,this.trigger())}setInlineSearchType(e){this._activeTabType!==e&&(this._activeTabType=e,this.trigger())}activatePicker(e){this._isPickerActive&&this._activeTabType===e||(this._isPickerActive=!0,this._isInlineSearchActive=!1,this._activeTabType=e,this.trigger())}deactivatePicker(){this._isPickerActive&&(this._isPickerActive=!1,this._activeTabType=l.defaultTabType,this.trigger())}isPickerActive(){return this._isPickerActive}isInlineSearchActive(){return this._isInlineSearchActive}getActiveTabType(){return this._activeTabType}getInitialSearch(){return this._initialSearch}};(0,i.__decorate)([n.autoSubscribe],p.prototype,"isPickerActive",null),(0,i.__decorate)([n.autoSubscribe],p.prototype,"isInlineSearchActive",null),(0,i.__decorate)([n.autoSubscribe],p.prototype,"getActiveTabType",null),(0,i.__decorate)([n.autoSubscribe],p.prototype,"getInitialSearch",null),p=(0,i.__decorate)([n.AutoSubscribeStore],p),t.MobileExpressionPickerStore=p,t.isSupportedTabType=function(e){return e===d.TabType.ChatSticker||e===d.TabType.Moji||e===d.TabType.Emoticon||e===d.TabType.Gif},t.default=new p},20849:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=s(88837),n=s(72666),r=s(66501),a=s(26712);let l=class extends o.StoreBase{constructor(){super(...arguments),this._map={},this._mojiToFetch={}}getMetadataForMoji(e,t,s){if(this._map[e])return this._map[e];if(void 0!==t){let e=n.default.getMoji(t);if(e)return e}if(s){let e=n.default.getMojiByUrl(s);if(e)return e}this._mojiToFetch[e]||(this._mojiToFetch[e]=!0,r.default.getMojiMetadata(e).then((t=>{const s={auxiliaryUrl:t.auxiliaryUrl?a.default.sanitizeUrl(t.auxiliaryUrl):"",auxiliaryText:t.auxiliaryText||t.auxiliaryUrl,description:t.description||"",copyright:t.copyright||"",pickerTitle:t.pickerTitle||""};this._map[e]=s,this.trigger(e)}),(()=>{})).always((()=>{delete this._mojiToFetch[e]})))}};(0,i.__decorate)([o.autoSubscribe,(0,i.__param)(0,o.key)],l.prototype,"getMetadataForMoji",null),l=(0,i.__decorate)([o.AutoSubscribeStore],l),t.default=new l},72666:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=s(96486),n=s(88837),r=s(26712);let a=class extends n.StoreBase{constructor(){super(...arguments),this._map={}}getMojis(){return this._map}getMoji(e){return this._map[e]}getMojiByUrl(e){const t=r.default.getURIComponents(e);if(!t)return;const s=t.pathname,i=s?s.split("/"):void 0,o=i&&i.length>=4?i[3]:void 0;return o?this._map[o]:void 0}setMojis(e){this._map=o.keyBy(e,(e=>e.id)),o.defer((()=>{this.trigger()}))}};(0,i.__decorate)([n.autoSubscribe],a.prototype,"getMojis",null),(0,i.__decorate)([n.autoSubscribe],a.prototype,"getMoji",null),a=(0,i.__decorate)([n.AutoSubscribeStore],a),t.default=new a},96168:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PesConfigLoadingStatus=void 0;const i=s(70655),o=s(96486),n=s(88837),r=s(58962);var a,l;!function(e){e[e.LoadingStatus=0]="LoadingStatus",e[e.FetchingItems=1]="FetchingItems",e[e.Emoticons=2]="Emoticons",e[e.Mojis=3]="Mojis",e[e.ChatStickers=4]="ChatStickers",e[e.CaptureStickers=5]="CaptureStickers",e[e.Gifs=6]="Gifs",e[e.Effects=7]="Effects"}(a||(a={})),function(e){e[e.NotStarted=1]="NotStarted",e[e.Loading=2]="Loading",e[e.Error=3]="Error",e[e.Completed=4]="Completed"}(l=t.PesConfigLoadingStatus||(t.PesConfigLoadingStatus={}));let d=class extends n.StoreBase{constructor(){super(...arguments),this._loadingStatus=l.NotStarted}getEmoticonTabs(){return o.values(this._emoticonTabs)}getMojiTabs(){return o.values(this._mojiTabs)}getChatStickerTabs(){return o.values(this._chatStickerTabs)}getCaptureStickerTabs(){return o.values(this._captureStickerTabs)}getGifTabs(){return o.values(this._gifTabs)}getLoadingStatus(){return this._loadingStatus}setEmoticonMojiTabs(e){this._emoticonTabs=this._getNewMapForTabs(o.filter(e,(e=>e.tabType===r.TabType.Emoticon))),this._mojiTabs=this._getNewMapForTabs(o.filter(e,(e=>e.tabType===r.TabType.Moji))),this._mergeTabs();const t=[a.Emoticons,a.Mojis];this._loadingStatus!==l.Completed&&(this._loadingStatus=l.Completed,t.push(a.LoadingStatus)),o.defer((()=>{this.trigger(t)}))}setCaptureStickerTabs(e){this._captureStickerTabs=this._getNewMapForTabs(e,!1),this._mergeTabs();const t=[a.CaptureStickers];this._loadingStatus!==l.Completed&&(this._loadingStatus=l.Completed,t.push(a.LoadingStatus)),o.defer((()=>{this.trigger(t)}))}setChatStickerTabs(e){this._chatStickerTabs=this._getNewMapForTabs(e),this._mergeTabs();const t=[a.ChatStickers];this._loadingStatus!==l.Completed&&(this._loadingStatus=l.Completed,t.push(a.LoadingStatus)),o.defer((()=>{this.trigger(t)}))}setGifTabs(e){this._gifTabs=this._getNewMapForTabs(e),this._mergeTabs();const t=[a.Gifs];this._loadingStatus!==l.Completed&&(this._loadingStatus=l.Completed,t.push(a.LoadingStatus)),o.defer((()=>{this.trigger(t)}))}setGifItems(e,t,s){if(!this._gifTabs||!this._gifTabs[t])return;const i=Object.assign(Object.assign({},this._gifTabs[t].packs[0]),{items:e}),n=Object.assign(Object.assign({},this._gifTabs[t]),{packs:[i],isFetchingItems:s});this._gifTabs=Object.assign(Object.assign({},this._gifTabs),{[t]:n}),o.defer((()=>{this.trigger([a.Gifs])}))}setLoadingStatus(e){e!==this._loadingStatus&&(this._loadingStatus=e,this.trigger(a.LoadingStatus))}getTabIconsUrl(){return o.map(this._mergedTabs,((e,t)=>e.iconUrlOrAssetID))}_mergeTabs(){let e={};o.each(this._emoticonTabs,((t,s)=>{e[s]=t})),o.each(this._mojiTabs,((t,s)=>{e[s]=t})),o.each(this._captureStickerTabs,((t,s)=>{e[s]=t})),o.each(this._chatStickerTabs,((t,s)=>{e[s]=t})),o.each(this._gifTabs,((t,s)=>{e[s]=t})),this._mergedTabs=e}_getNewMapForTabs(e,t=!0){let s={};return o.each(e,(e=>{if(t&&o.isEmpty(e.packs))return;let i=e;void 0===i.iconUrlOrAssetID&&void 0!==i.iconUrl&&(e=Object.assign(Object.assign({},e),{iconUrlOrAssetID:i.iconUrl})),s[e.id]=e})),s}};(0,i.__decorate)([(0,n.autoSubscribeWithKey)(a.Emoticons)],d.prototype,"getEmoticonTabs",null),(0,i.__decorate)([(0,n.autoSubscribeWithKey)(a.Mojis)],d.prototype,"getMojiTabs",null),(0,i.__decorate)([(0,n.autoSubscribeWithKey)(a.ChatStickers)],d.prototype,"getChatStickerTabs",null),(0,i.__decorate)([(0,n.autoSubscribeWithKey)(a.CaptureStickers)],d.prototype,"getCaptureStickerTabs",null),(0,i.__decorate)([(0,n.autoSubscribeWithKey)(a.Gifs)],d.prototype,"getGifTabs",null),(0,i.__decorate)([(0,n.autoSubscribeWithKey)(a.LoadingStatus)],d.prototype,"getLoadingStatus",null),d=(0,i.__decorate)([n.AutoSubscribeStore],d),t.default=new d},75057:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=s(96486),n=s(88837),r=s(97691),a=s(76621),l=s(71830),d=s(62141),c=s(25793),h=s(46096),u=s(36237),p=s(98754),g=s(14976),m=s(22538);let S=class extends n.StoreBase{constructor(){super(),this._privateConversations={},this._conversationsUpdated=e=>{o.each(e,(e=>{const t=e.conv.isEncryptedThread()?e.conv.getEncryptionHandshake():void 0;if(t){const s=c.default.getBuddyAddress(t).mri;this._savePrivateConversationMri(s,l.asSkypeThreadId(e.conv.id))}}))},m.RegisterStartupable(this,"PrivateConversationsStore",[a.default,p.default])}startup(){return this._privateConversations=p.default.getDataExclusive(d.InternalKeys.PrivateConversations)||{},a.default.conversationsUpdated.subscribe(this._conversationsUpdated),r.Resolved()}getPrivateConversationMriForContactMri(e){return this._privateConversations[e]}getAllPrivateConversationMris(){return o.values(this._privateConversations)}_savePrivateConversationMri(e,t){this._privateConversations[e]||(this._privateConversations[e]=t,p.default.putData(d.InternalKeys.PrivateConversations,this._privateConversations),u.log(h.LogTraceArea.PrivateConversationsStore,"Saving private conversation mri "+g.mriOrId(t)+" with contact mri "+g.mriOrId(e)),this.trigger(e))}};(0,i.__decorate)([n.autoSubscribe,(0,i.__param)(0,n.key)],S.prototype,"getPrivateConversationMriForContactMri",null),(0,i.__decorate)([n.autoSubscribe],S.prototype,"getAllPrivateConversationMris",null),S=(0,i.__decorate)([n.AutoSubscribeStore],S),t.default=new S},17219:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionsStore=void 0;const i=s(70655),o=s(96486),n=s(88837),r=s(97691),a=s(89391),l=s(81169),d=s(1446),c=s(33754),h=s(46929),u=s(22538);let p,g=class extends d.CustomReactionsStoreBase{constructor(){super(),u.RegisterStartupable(this,"ReactionsStore",[h.default])}startup(){super.startup();const e=a.default.getS4LMessagingFeatures();return this._maxReactionsNumber=e.maxNumberOfCustomReactions,this._initialTabId=e.customReactionsInitialTabId,a.default.subscribe((()=>{const{customReactionsInitialTabId:e}=a.default.getS4LMessagingFeatures();this._initialTabId=e})),r.Resolved()}getDefaultReactions(){return(0,l.chain)(o.assign({},a.default.getS4LMessagingFeatures().reactionPacks),(0,l.map)(o.toArray),o.flatten)}getSavedReactions(){return h.default.getReactions()||[]}saveCurrentReactions(){h.default.setReactions(this._localReactions),super.saveCurrentReactions()}getInitialTabId(){return this._initialTabId}isFeatureEnabled(){return!0}getMaxReactionsCount(){return this._maxReactionsNumber}getModalTitle(){return c.getString("ReactionsPanel.Title")}};g=(0,i.__decorate)([n.AutoSubscribeStore],g),t.ReactionsStore=g,t.default=function(){return p||(p=new g)}},88378:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Test_RecentAssetStore=t.TriggerKeys=void 0;const i=s(70655),o=s(29359),n=s(2604),r=s(16778),a=s(88837),l=s(97691),d=s(60),c=s(46096),h=s(36237),u=s(81736),p=s(14976),g=s(22538),m=s(78262),S="skypexRecentAssetTimestampKeyId";var f;!function(e){e[e.RecentAssetThumbnail=0]="RecentAssetThumbnail",e[e.RecentAssetTimestamp=1]="RecentAssetTimestamp",e[e.HasFreshRecentAsset=2]="HasFreshRecentAsset"}(f=t.TriggerKeys||(t.TriggerKeys={}));let y=class extends a.StoreBase{constructor(){super(),this._gettingRecentAssetThumbnail=!1,g.RegisterStartupable(this,"RecentAssetStore",[u.default])}getRecentAssetThumbnail(){return this._recentAssetThumbnail}getRecentAssetTimestamp(){return this._recentAssetTimestamp}hasRecentAsset(){return this._hasFreshRecentAsset}startup(){return o.default.setRecentAssetThumbnailChangedEventEnabled(!0),o.default.recentAssetThumbnailChangedEvent.subscribe((e=>{h.log(c.LogTraceArea.MediaPrefetchService,"RecentAssetStore recentAssetThumbnailChangedEvent"),this._updateRecentAssetProps(e)})),d.default.subscribeForChanges("RecentAssetStore",(e=>{e===r.Types.AppActivationState.Active&&(h.log(c.LogTraceArea.MediaPrefetchService,"RecentAssetStore AppActivationState become active"),this._getRecentAssetThumbnail())})),u.default.subscribe((()=>{h.log(c.LogTraceArea.MediaPrefetchService,"RecentAssetStore permission for camera roll changed"),this._getRecentAssetThumbnail()}),m.PermissionType.CameraRoll),r.Storage.getItem(S).then((e=>{h.log(c.LogTraceArea.MediaPrefetchService,"RecentAssetStore watched asset timestamp from local storage:"+e),this._storedRecentAssetTimestamp=e?Number(e):void 0,this._getRecentAssetThumbnail()})),l.Resolved()}_startedTrackingKey(e){g.EnsureStarted(this)}markAsWatched(){h.log(c.LogTraceArea.MediaPrefetchService,"RecentAssetStore markAsWatched"),this._recentAssetTimestamp&&r.Storage.setItem(S,String(this._recentAssetTimestamp)).then((()=>{this._storedRecentAssetTimestamp=this._recentAssetTimestamp,this._updateHasFreshRecentAsset()}))}forceRecentAssetCheck(){h.log(c.LogTraceArea.MediaPrefetchService,"RecentAssetStore forceRecentAssetCheck"),this._getRecentAssetThumbnail()}test_setRecentAssetTimestamp(e){this._recentAssetTimestamp=e}_getRecentAssetThumbnail(){h.log(c.LogTraceArea.MediaPrefetchService,"RecentAssetStore _getRecentAssetThumbnail"),this._gettingRecentAssetThumbnail||u.default.permissionStatus(m.PermissionType.CameraRoll)!==n.PermissionStatus.Granted||(this._gettingRecentAssetThumbnail=!0,o.default.getRecentAssetThumbnail().then((e=>{this._updateRecentAssetProps(e)})).finally((()=>{this._gettingRecentAssetThumbnail=!1})))}_updateRecentAssetProps(e){e.thumbnail===this._recentAssetThumbnail&&e.timestamp===this._recentAssetTimestamp||(h.log(c.LogTraceArea.MediaPrefetchService,"RecentAssetStore update recent asset data thumbnail("+p.dev_unknownOmit(e.thumbnail)+"), timestamp("+e.timestamp+")"),this._recentAssetThumbnail=e.thumbnail,this._recentAssetTimestamp=e.timestamp,this.trigger([f.RecentAssetThumbnail,f.RecentAssetTimestamp]),this._updateHasFreshRecentAsset())}_updateHasFreshRecentAsset(){const e=this._recentAssetTimestamp||0,t=this._storedRecentAssetTimestamp||0,s=Date.now()/1e3-604800,i=e>t,o=e>s,n=i&&o;h.log(c.LogTraceArea.MediaPrefetchService,"RecentAssetStore hasFreshRecentAsset check: recentTimestamp("+e+") storedTimestamp("+t+") minAllowedTimestamp("+s+") hasNewAsset("+i+") newAssetIsNotVeryOld("+o+") hasFreshAsset("+n+")"),this._hasFreshRecentAsset!==n&&(h.log(c.LogTraceArea.MediaPrefetchService,"RecentAssetStore triggers HasFreshRecentAsset change"),this._hasFreshRecentAsset=n,this.trigger(f.HasFreshRecentAsset))}};(0,i.__decorate)([(0,a.autoSubscribeWithKey)(f.RecentAssetThumbnail)],y.prototype,"getRecentAssetThumbnail",null),(0,i.__decorate)([(0,a.autoSubscribeWithKey)(f.RecentAssetTimestamp)],y.prototype,"getRecentAssetTimestamp",null),(0,i.__decorate)([(0,a.autoSubscribeWithKey)(f.HasFreshRecentAsset)],y.prototype,"hasRecentAsset",null),y=(0,i.__decorate)([a.AutoSubscribeStore],y),t.Test_RecentAssetStore=y,t.default=new y},31234:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TriggerKeys=void 0;const i=s(70655),o=s(96486),n=s(88837),r=s(44770),a=s(97691),l=s(62141),d=s(46096),c=s(97174),h=s(36237),u=s(98754),p=s(33754),g=s(58962),m=s(22538);var S;!function(e){e[e.emoticons=0]="emoticons",e[e.mojis=1]="mojis",e[e.stickersInChat=2]="stickersInChat",e[e.stickersInCapture=3]="stickersInCapture"}(S=t.TriggerKeys||(t.TriggerKeys={}));let f=class extends n.StoreBase{constructor(){super(),this.recentTabId="recent",m.RegisterStartupable(this,"PesPacksStore",[u.default])}startup(){return this._emoticons=u.default.getDataExclusive(l.InternalKeys.RecentlyUsedEmoticons),this._mojis=u.default.getDataExclusive(l.InternalKeys.RecentlyUsedMojis),this._stickersInChat=u.default.getDataExclusive(l.InternalKeys.RecentlyUsedStickersInChat),this._stickersInCapture=u.default.getDataExclusive(l.InternalKeys.RecentlyUsedStickersInCapture),a.Resolved()}getRecentEmoticonTabInfo(e){let t=[];const s=this._filterRecentlyUsed(this._emoticons,e);return s&&s.length&&t.push({id:this.recentTabId,items:s,title:p.getString("PesPicker.RecentEmoticonPackTitle")}),{id:this.recentTabId,title:p.getString("PesPicker.RecentEmoticonTabTitle"),tabType:g.TabType.Emoticon,iconUrlOrAssetID:r.Collection.TAB_MRU,packs:t}}getRecentMojiTabInfo(){let e=[];return this._mojis&&this._mojis.length&&e.push({id:this.recentTabId,items:this._mojis,title:p.getString("PesPicker.RecentMojiPackTitle")}),{id:this.recentTabId,title:p.getString("PesPicker.RecentMojiTabTitle"),tabType:g.TabType.Moji,iconUrlOrAssetID:r.Collection.TAB_MRU,packs:e}}getRecentStickerInChatTabInfo(){let e=[];return this._stickersInChat&&this._stickersInChat.length&&e.push({id:this.recentTabId,items:this._stickersInChat,title:p.getString("PesPicker.RecentStickerPackTitle")}),{id:this.recentTabId,title:p.getString("PesPicker.RecentStickerTabTitle"),tabType:g.TabType.ChatSticker,iconUrlOrAssetID:r.Collection.TAB_MRU,packs:e}}getRecentStickerInCaptureTabInfo(){let e=[],t=p.getString("PesPicker.RecentCaptureStickerPackTitle");return this._stickersInCapture&&this._stickersInCapture.length&&e.push({id:this.recentTabId,items:this._stickersInCapture,title:t}),{id:this.recentTabId,title:t,tabType:g.TabType.CaptureSticker,iconUrlOrAssetID:r.Collection.TAB_MRU_DARKTHEME,packs:e}}registerEntities(e){const t=[],s=[],i=[];o.each(e,(e=>{e instanceof c.EmoticonEntity?t.push(e):e instanceof c.MojiEntity?s.push(e):e instanceof c.StickerEntity&&i.push(e)}));const n=[];t.length>0&&(h.log(d.LogTraceArea.GenericUnsafe,"Registering emoticons in MRU:",o.map(t,(e=>e.emoticonName))),this._emoticons=o.reduce(t,((e,t)=>this._insertItem(e,t.emoticonName)),this._emoticons),n.push(S.emoticons)),s.length>0&&(h.log(d.LogTraceArea.GenericUnsafe,"Registering mojis in MRU:",o.map(s,(e=>e.id))),this._mojis=o.reduce(s,((e,t)=>this._insertItem(e,t.id)),this._mojis),n.push(S.mojis)),i.length>0&&(h.log(d.LogTraceArea.GenericUnsafe,"Registering stickers in MRU:",o.map(i,(e=>e.id))),this._stickersInChat=o.reduce(i,((e,t)=>this._insertItem(e,t.id)),this._stickersInChat),n.push(S.stickersInChat)),n.length>0&&(this.trigger(n),this._storeRecentlyUsedPes())}registerStickersInCapture(e){const t=[];e.length>0&&(h.log(d.LogTraceArea.GenericUnsafe,"Registering capture stickers in MRU:",e),this._stickersInCapture=o.reduce(e,((e,t)=>this._insertItem(e,t)),this._stickersInCapture),t.push(S.stickersInCapture)),t.length>0&&(this.trigger(t),this._storeRecentlyUsedPes())}clearHistory(){this._emoticons=[],this._mojis=[],this._stickersInChat=[],this._stickersInCapture=[],this._storeRecentlyUsedPes(),this.trigger([S.emoticons,S.mojis,S.stickersInChat,S.stickersInCapture])}_filterRecentlyUsed(e,t){return o.isEmpty(t)||o.isEmpty(e)?e:o.filter(e,(e=>!o.includes(t,e)))}_storeRecentlyUsedPes(){l.default.openTransaction([l.Stores.InternalData],!0).then((e=>{a.all([u.default.putData(l.InternalKeys.RecentlyUsedEmoticons,this._emoticons,e),u.default.putData(l.InternalKeys.RecentlyUsedMojis,this._mojis,e),u.default.putData(l.InternalKeys.RecentlyUsedStickersInChat,this._stickersInChat,e),u.default.putData(l.InternalKeys.RecentlyUsedStickersInCapture,this._stickersInCapture,e)]).finally((()=>{e.markCompleted()}))}))}_insertItem(e,t){if(!e||0===e.length)return[t];const s=o.filter(e,(e=>e!==t));return s.unshift(t),s.splice(24),s}};(0,i.__decorate)([(0,n.autoSubscribeWithKey)(S.emoticons)],f.prototype,"getRecentEmoticonTabInfo",null),(0,i.__decorate)([(0,n.autoSubscribeWithKey)(S.mojis)],f.prototype,"getRecentMojiTabInfo",null),(0,i.__decorate)([(0,n.autoSubscribeWithKey)(S.stickersInChat)],f.prototype,"getRecentStickerInChatTabInfo",null),(0,i.__decorate)([(0,n.autoSubscribeWithKey)(S.stickersInCapture)],f.prototype,"getRecentStickerInCaptureTabInfo",null),f=(0,i.__decorate)([n.AutoSubscribeStore],f);let y=new f;t.default=y},81571:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=s(88837),n=s(97691),r=s(89391),a=s(22538),l=s(61253),d=s(50488),c={isOpen:!1,popupPosition:{bottom:0,height:0,left:0,right:0,top:0,width:0}};var h;!function(e){e.ShowRichtextEditor="ShowRichtextEditor",e.PopupPositionUpdated="PopupPositionUpdated",e.RichStyleEditorExp="RichStyleEditorExp"}(h||(h={}));let u=class extends o.StoreBase{constructor(){super(),this._richTextEditorInfo=new Map,this._appConfigChanged=()=>{const{enableRichStyleEditor:e,richStyleEditorExp:t}=r.default.getS4LMessagingFeatures();this._enableRichStyleEditor=e,this._richStyleEditorExp=t,this._richStyleEditorExp!==t&&this.trigger(h.RichStyleEditorExp)},this._getRichTextEditorConfig=e=>this._richTextEditorInfo.get(e)||c,this._setRichTextEditorConfig=(e,t)=>{this._richTextEditorInfo.set(e,Object.assign(Object.assign({},this._richTextEditorInfo.get(e)||c),t))},a.RegisterStartupable(this,"RichtextEditorStore")}startup(){return r.default.subscribe(this._appConfigChanged),this._appConfigChanged(),n.Resolved()}setVisibility(e,t){t!==this._getRichTextEditorConfig(e).isOpen&&(this._setRichTextEditorConfig(e,{isOpen:t}),this.trigger((0,o.formCompoundKey)(e,h.ShowRichtextEditor)))}clear(e){this._richTextEditorInfo.delete(e),this.trigger((0,o.formCompoundKey)(e,h.ShowRichtextEditor))}panelOpened(e){return this._enableRichStyleEditor&&this._richStyleEditorExp===d.RichtextEditorExperience.Panel&&this._getRichTextEditorConfig(e).isOpen}setPopupPosition(e,t){(0,l.default)(t,this._getRichTextEditorConfig(e).popupPosition)||t&&t.top<800&&t.bottom<800||(this._setRichTextEditorConfig(e,{popupPosition:t}),this.trigger((0,o.formCompoundKey)(e,h.PopupPositionUpdated)))}getPopupPosition(e){if(this._enableRichStyleEditor&&this._richStyleEditorExp===d.RichtextEditorExperience.Popup)return this._getRichTextEditorConfig(e).popupPosition}getExperience(){return this._richStyleEditorExp}popupOpened(e){return this._getRichTextEditorConfig(e).popupPosition.width>0}};(0,i.__decorate)([(0,o.autoSubscribeWithKey)(h.ShowRichtextEditor),(0,i.__param)(0,o.key)],u.prototype,"panelOpened",null),(0,i.__decorate)([(0,o.autoSubscribeWithKey)(h.PopupPositionUpdated),(0,i.__param)(0,o.key)],u.prototype,"getPopupPosition",null),(0,i.__decorate)([(0,o.autoSubscribeWithKey)(h.RichStyleEditorExp)],u.prototype,"getExperience",null),(0,i.__decorate)([(0,o.autoSubscribeWithKey)(h.PopupPositionUpdated),(0,i.__param)(0,o.key)],u.prototype,"popupOpened",null),u=(0,i.__decorate)([o.AutoSubscribeStore],u),t.default=new u},27428:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=s(96486),n=s(88837),r=s(61253);let a=class extends n.StoreBase{constructor(){super(...arguments),this._allMris=[],this._selectedMris=[]}isMriSelected(e){return o.includes(this._selectedMris,e)}getSelectedMris(){return this._selectedMris}toggleMriSelection(e){o.includes(this._selectedMris,e)?this._removeMri(e):this._addMri(e),this.trigger([e])}createMriSelectionRange(e){const t=o.last(this._selectedMris);if(!t)return this._addMri(e),void this.trigger(e);const s=this._allMris.indexOf(e),i=this._allMris.indexOf(t),n=s>i?this._allMris.slice(i,s+1):this._allMris.slice(s,i+1);this._selectedMris=o.merge(this._selectedMris,n),this.trigger(this._selectedMris)}resetSelectedMris(){const e=[...this._selectedMris];this._selectedMris=[],this.trigger(e)}setAllMris(e){(0,r.default)(e,this._allMris)||(this._allMris=[...e])}_addMri(e){this._selectedMris=[...this._selectedMris,e]}_removeMri(e){this._selectedMris.splice(this._selectedMris.indexOf(e),1)}};(0,i.__decorate)([n.autoSubscribe,(0,i.__param)(0,n.key)],a.prototype,"isMriSelected",null),a=(0,i.__decorate)([n.AutoSubscribeStore],a),t.default=new a},44487:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TriggerKeys=void 0;const i=s(70655),o=s(96486),n=s(88837),r=s(98278);!function(e){e[e.SpacerWidthUpdates=0]="SpacerWidthUpdates"}(t.TriggerKeys||(t.TriggerKeys={}));let a=class extends n.StoreBase{constructor(){super(...arguments),this._selectedMessages=[],this._isSelectMessagesModeActive=!1,this._selectedMessagesScope=r.MainRootViewId}deactivateSelectMessagesMode(){this._isSelectMessagesModeActive&&(this._isSelectMessagesModeActive=!1,this._selectedMessages=[],this._selectedMessagesScope=r.MainRootViewId,this.trigger())}activateSelectMessagesMode(e){const t=e!==this._selectedMessagesScope;this._isSelectMessagesModeActive&&!t||(this._isSelectMessagesModeActive=!0,this._selectedMessagesScope=e,t&&(this._selectedMessages=[]),this.trigger())}addOrUpdateSelectedMessage(e){this._selectedMessages=o.filter(this._selectedMessages,(t=>!(t.message.cuid===e.message.cuid&&t.urlPreviewId===e.urlPreviewId))),this._selectedMessages=o.sortBy(this._selectedMessages.concat(e),(e=>e.message.createdTime)),this.trigger()}removeSelectedMessage(e){this._selectedMessages=o.filter(this._selectedMessages,(t=>!(t.message.cuid===e.message.cuid&&t.urlPreviewId===e.urlPreviewId))),this.trigger()}isMessageSelected(e){return o.some(this._selectedMessages,(t=>t.message.cuid===e))}isSelectMessagesModeActive(e){return this._isSelectMessagesModeActive&&this._selectedMessagesScope===e}getSelectedMessages(){return this._selectedMessages}};(0,i.__decorate)([n.autoSubscribe],a.prototype,"isSelectMessagesModeActive",null),(0,i.__decorate)([n.autoSubscribe],a.prototype,"getSelectedMessages",null),a=(0,i.__decorate)([n.AutoSubscribeStore],a),t.default=new a},66765:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(74958),o=s(96486),n=s(74634),r=s(97691),a=s(89391),l=s(90239),d=s(71830),c=s(46096),h=s(97811),u=s(72685),p=s(36237),g=s(61253),m=s(54416),S=s(16568),f=s(22538),y=s(40363),_=s(94214),v=s(26712),C="SessionInfoStore";t.default=new class{constructor(){this._sessionInfo={id:void 0,exists:!1,featureFlags:void 0,presenceDocPublished:void 0,pushSubscriptionId:void 0,pushSubscriptionParams:void 0,restEndpointUrl:void 0,ecsEtag:void 0,registrationToken:void 0},this.endpointInfoChanged=new n.default,this.restEndpointUrlChanged=new n.default,this._loggingOut=!1,this._appConfigStoreChanged=()=>{const{chatServiceHostRefreshEnabled:e,chatServiceHostRefreshInterval:t}=a.default.getConfigSettings().chat;e&&!this._chatServiceHostRefreshEnabled?t>0&&t!==this._chatServiceHostRefreshInterval?(this._chatServiceHostRefreshInterval=t,p.log(c.LogTraceArea.ChatService,`SessionInfoStore chatServiceHostRefreshInterval set to ${this._chatServiceHostRefreshInterval} s`),u.default.setRefreshOptions(C,{interval:a.default.getConfigSettings().chat.chatServiceHostRefreshInterval,taskTypeFlags:u.TaskTypeFlags.UsesNetworking,callback:()=>(p.log(c.LogTraceArea.ChatService,"SessionInfoStore restEndpointUrlChanged fire."),this.restEndpointUrlChanged.fire(),r.Resolved())})):this.restEndpointUrlChanged.fire():!e&&this._chatServiceHostRefreshEnabled&&u.default.setRefreshOptions(C,{interval:0,taskTypeFlags:u.TaskTypeFlags.UsesNetworking,callback:()=>{}})},f.RegisterStartupable(this,"SessionInfoStore",[S.default])}calcChatV1EndpointUrl(){switch(a.default.getS4LFeatures().chatFeatures.recommendedRing){case l.UserRing.DailyDF:case l.UserRing.MasterDF:return a.default.getConfigSettingsNoSubscription().chat.dogfoodHost;default:return a.default.getConfigSettingsNoSubscription().chat.productionHost}}startup(){if(!a.default.getConfigSettings().chat.dontPersistSessionInfoOnWeb){const e=o.cloneDeep(S.default.ChatServiceSessionInfo.get());e&&(this._sessionInfo=e,y.default.setChatEndpointId(d.formatEndpointIdRemoveBrackets(this._sessionInfo.id)))}return p.log(c.LogTraceArea.ChatService,"Startup: Stored Endpoint Info: "+d.encodeEndpointInfoForLog(this._sessionInfo)),a.default.subscribe(this._appConfigStoreChanged),this._appConfigStoreChanged(),r.Resolved(void 0)}setRestEndpointUrl(e){this._sessionInfo.restEndpointUrl!==e&&v.default.isUrlValid(e)&&(this._sessionInfo=Object.assign(Object.assign({},this._sessionInfo),{restEndpointUrl:e}),this._persistSessionInfo())}setRegistrationToken(e){if(this._sessionInfo.registrationToken===e)return;const t=d.getExpiresFromRegToken(e),s=_.default.getSkypeToken();p.log(c.LogTraceArea.ChatServiceTransport,"Registration token updated to "+(e?"using new":"undefined")+", Expires: "+(t?new Date(1e3*t):"undefined")+", EndpointId: "+d.getEndpointIdFromRegToken(e)+", SkypeToken valid: "+(s&&!s.isTokenExpired())+", SkypeToken expiration: "+(s?new Date(s.expiration):"undefined")),this._sessionInfo=Object.assign(Object.assign({},this._sessionInfo),{registrationToken:e}),this._persistSessionInfo()}markRegistrationTokenExpired(e){this._sessionInfo.registrationToken&&this._sessionInfo.registrationToken!==e?p.log(c.LogTraceArea.ChatServiceTransport,"RegistrationToken reported invalid, but it doesn't match our stored one -- ignoring!"):this.setRegistrationToken(void 0)}setPushSubscriptionInfo(e,t,s){!e||this._sessionInfo.exists&&d.areEndpointIdsEqual(this._sessionInfo.id,e.endpointId)?(e?p.log(c.LogTraceArea.ChatService,"Push Subscription Updated: "+e.endpointId+"/"+e.subscriptionId+", Params: "+i.pii.Omit(JSON.stringify(e.params))):p.log(c.LogTraceArea.ChatService,"Push Subscription Cleared"),this.updateEndpointInfo({pushSubscriptionId:e?e.subscriptionId:void 0,pushSubscriptionParams:e?e.params:void 0,reason:t,tcid:s})):p.log(c.LogTraceArea.ChatService,"pushSubscriptionUpdated called with stale endpointId")}markEndpointMissing(e,t){d.areEndpointIdsEqual(this._sessionInfo.id,e)?(p.log(c.LogTraceArea.ChatService,"Endpoint "+e+" reported missing"),this.updateEndpointInfo({exists:!1,featureFlags:void 0,presenceDocPublished:void 0,pushSubscriptionId:void 0,pushSubscriptionParams:void 0,reason:"Endpoint missing",tcid:t})):p.log(c.LogTraceArea.ChatService,"endpointMissing called with stale endpointId")}updateEndpointInfo(e){if(this._loggingOut)return;const t=o.assign({},this._sessionInfo,e);if((0,g.default)(this._sessionInfo,t))return;this._sessionInfo.exists&&!this._sessionInfo.id&&p.track(new h.FundamentalsDebugEvent("EndpointIdEmpty",e.reason)),this._sessionInfo.id&&this._sessionInfo.pushSubscriptionId&&!t.pushSubscriptionId&&p.track(new h.MissingPushSubscription(t.id||"None",this._sessionInfo.id,this._sessionInfo.pushSubscriptionId,m.default.getRegistrationId(),e.reason,e.tcid)),p.log(c.LogTraceArea.ChatService,"UpdateEndpointInfo: "+d.encodeEndpointInfoForLog(t));const s=this._sessionInfo;this._sessionInfo=t,this._persistSessionInfo(),this.endpointInfoChanged.fire(t,s)}getEndpointInfo(){return this._sessionInfo}getEndpointId(){return this._sessionInfo.exists?this._sessionInfo.id:void 0}endpointExists(){return this._sessionInfo.exists}presenceDocPublished(){return!!this.getEndpointInfo().presenceDocPublished}getRestEndpointUrl(){return this._sessionInfo.restEndpointUrl}getRegistrationToken(){return this._sessionInfo.registrationToken}logout(e){return this._loggingOut=!0,y.default.setChatEndpointId(void 0),S.default.deleteIds({chatServiceSessionInfo:!0})}_persistSessionInfo(){this._loggingOut||(y.default.setChatEndpointId(d.formatEndpointIdRemoveBrackets(this._sessionInfo.id)),a.default.getConfigSettings().chat.dontPersistSessionInfoOnWeb||S.default.setChatServiceSessionInfo(this._sessionInfo))}test_reset(){this._sessionInfo={id:void 0,exists:!1,featureFlags:void 0,presenceDocPublished:void 0,pushSubscriptionId:void 0,pushSubscriptionParams:void 0,restEndpointUrl:void 0,ecsEtag:void 0,registrationToken:void 0}}}},6262:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=s(88837),n=s(39119),r=s(4604);let a=class extends o.StoreBase{constructor(){super(),r.default.subscribe((()=>this.trigger()))}isPaidUser(){const e=r.default.getCreditEntitlement();return n.hasUsableCredit(e)||r.default.userHasSubscriptions()}};(0,i.__decorate)([o.autoSubscribe],a.prototype,"isPaidUser",null),a=(0,i.__decorate)([o.AutoSubscribeStore],a),t.default=new a},74342:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=s(88837),n=s(13510);let r=class extends o.StoreBase{constructor(){super(...arguments),this._phoneNumberRates={},this._lookups={}}_startedTrackingKey(e){this._lookups[e]||(this._lookups[e]=n.default.getSmsPrice(e).finally((()=>{delete this._lookups[e]})).then((t=>{t&&(this._phoneNumberRates[e]=t,this.trigger(e))})))}_stoppedTrackingKey(e){const t=this._lookups[e];t&&(delete this._lookups[e],t.cancel()),delete this._phoneNumberRates[e]}getSmsRateByPhoneNumber(e){return this._phoneNumberRates[e]}};(0,i.__decorate)([o.disableWarnings],r.prototype,"_startedTrackingKey",null),(0,i.__decorate)([o.disableWarnings],r.prototype,"_stoppedTrackingKey",null),(0,i.__decorate)([o.autoSubscribe,(0,i.__param)(0,o.key)],r.prototype,"getSmsRateByPhoneNumber",null),r=(0,i.__decorate)([o.AutoSubscribeStore],r),t.default=new r},24139:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=s(88837),n=s(66501),r=s(13130),a=s(26712);let l=class extends o.StoreBase{constructor(){super(...arguments),this._map={},this._stickerToFetch={}}getMetadataForSticker(e,t){if(this._map[e])return this._map[e];if(t){let e=r.default.getSticker(t);if(e)return e}this._stickerToFetch[e]||(this._stickerToFetch[e]=!0,n.default.getStickerMetadata(e).then((t=>{const s={auxiliaryUrl:t.auxiliaryUrl&&a.default.sanitizeUrl(t.auxiliaryUrl)||"",auxiliaryText:t.auxiliaryText||t.auxiliaryUrl,description:t.description||"",copyright:t.copyright||"",title:t.title||""};this._map[e]=s,this.trigger(e)}),(()=>{})).always((()=>{delete this._stickerToFetch[e]})))}};(0,i.__decorate)([o.autoSubscribe,(0,i.__param)(0,o.key)],l.prototype,"getMetadataForSticker",null),l=(0,i.__decorate)([o.AutoSubscribeStore],l),t.default=new l},13130:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=s(96486),n=s(88837),r=s(35455);let a=class extends n.StoreBase{constructor(){super(...arguments),this._mergedStickerMap={},this._captureStickerMap={},this._chatStickerMap={}}getSticker(e){return this._mergedStickerMap[e]}setCaptureStickers(e){this._captureStickerMap=o.keyBy(e,(e=>e.id)),this._mergeStickers(),this.trigger()}setChatStickers(e){this._chatStickerMap=o.keyBy(e,(e=>e.id)),this._mergeStickers(),this.trigger()}getStickerUrls(){return o.map(this._mergedStickerMap,((e,t)=>{const s=r.getDefaultEmoticonSize();return r.getStickerUrl(e.baseUrl,s,!1,!0,e.etag)}))}_mergeStickers(){this._mergedStickerMap={},o.each(this._captureStickerMap,((e,t)=>{this._mergedStickerMap[t]=this._captureStickerMap[t]})),o.each(this._chatStickerMap,((e,t)=>{this._mergedStickerMap[t]=this._chatStickerMap[t]}))}};(0,i.__decorate)([n.autoSubscribe],a.prototype,"getSticker",null),a=(0,i.__decorate)([n.AutoSubscribeStore],a),t.default=new a},26612:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=s(96486),n=s(57349),r=s(88837),a=s(97691),l=s(44135),d=s(6452),c=s(52115),h=s(61253),u=s(24606),p=s(85207),g=s(22538),m=s(26712),S=s(60634);var f;!function(e){e[e.Queued=1]="Queued",e[e.FetchingFromiCloud=2]="FetchingFromiCloud",e[e.Transcoding=3]="Transcoding",e[e.Uploading=4]="Uploading",e[e.Completed=5]="Completed",e[e.Failed=6]="Failed"}(f||(f={}));const y=.33;let _=class extends r.StoreBase{constructor(){super(),this._postIdToPostInfo={},this._fileDownloadKeyToDownloadInfo={},this._uploadTransactionIdToMessagePostBuilder={},this._transferIdToProgress={},this._urlsWithoutProgress=[],this._reencodingSessionIdToPostId={},this._foregroundPostInfo={postIdToThumbnailProgress:{},postIdToFullDataProgress:{}},this._postIdToServerTranscodingProgress={},this._reportedProgress=(e,t)=>{this._transferIdToProgress[e]=t;const s=o.find(this._postIdToPostInfo,(t=>o.some(t.uploads,(t=>e===t.dataTransferId||e===t.thumbnailTransferId)))),i=s?s.localUrls:[],n=o.find(this._fileDownloadKeyToDownloadInfo,(t=>e===t.downloadTransferId)),r=n?n.urls:[];this.trigger(o.flatten([i,r]))},g.RegisterStartupable(this,"TransferProgressStore",[l.default,d.default,p.default])}startup(){return d.default.downloadUpdated.subscribe((e=>{const{id:t,key:s,downloadTransfer:i}=e;let n=this._fileDownloadKeyToDownloadInfo[s];if(!n){const e=o.findIndex(this._urlsWithoutProgress,(e=>{const s=d.default.getFileDownloadByUrl(e);return!!s&&s.id===t}));if(-1===e)return;n={key:s,urls:this._urlsWithoutProgress.splice(e,1)}}const r=this._updateTransferTracking(i,n.downloadTransferId);this._fileDownloadKeyToDownloadInfo[s]={key:s,urls:n.urls,downloadTransferId:r},this.trigger(n.urls)})),p.default.postCreated.subscribe((e=>{e.amsUploads&&e.amsUploads.length>0&&e.transactionId&&(this._uploadTransactionIdToMessagePostBuilder[e.transactionId]||(this._uploadTransactionIdToMessagePostBuilder[e.transactionId]=e))})),p.default.postUpdated.subscribe((e=>{const t=e.amsUploads&&e.amsUploads.length>0;if(!this._postIdToPostInfo[e.id]&&e.transactionId&&this._uploadTransactionIdToMessagePostBuilder[e.transactionId]&&t){let t=o.map(e.amsUploads,(e=>e.amsFullDataLocalUrl));this._postIdToPostInfo[e.id]=this._updateUploadInfo(e,t,void 0),delete this._uploadTransactionIdToMessagePostBuilder[e.transactionId]}t&&e.transcodingSessionId&&(e.transcodingStatus===u.TranscodingState.InProgress?this._reencodingSessionIdToPostId[e.transcodingSessionId]=e.id:delete this._reencodingSessionIdToPostId[e.transcodingSessionId]);let s=this._postIdToPostInfo[e.id];if(!s){const t=o.findIndex(this._urlsWithoutProgress,(t=>{const s=p.default.getPostByLocalUrl(t);return!!s&&s.id===e.id}));if(-1===t)return;const i=this._urlsWithoutProgress.splice(t,1);s={id:e.id,localUrls:i}}this._postIdToPostInfo[e.id]=this._updateUploadInfo(e,s.localUrls,s.uploads),this.trigger(s.localUrls)})),p.default.foregroundUploadProgress.subscribe(((e,t,s,i)=>{const o=this._postIdToPostInfo[e];if(!o)return;let n=!1;s?(this._foregroundPostInfo.postIdToFullDataProgress[e]||(this._foregroundPostInfo.postIdToFullDataProgress[e]={}),(0,h.default)(this._foregroundPostInfo.postIdToFullDataProgress[e][t],i)||(this._foregroundPostInfo.postIdToFullDataProgress[e][t]=i,n=!0)):(this._foregroundPostInfo.postIdToThumbnailProgress[e]||(this._foregroundPostInfo.postIdToThumbnailProgress[e]={}),(0,h.default)(this._foregroundPostInfo.postIdToThumbnailProgress[e][t],i)||(this._foregroundPostInfo.postIdToThumbnailProgress[e][t]=i,n=!0)),n&&this.trigger(o.localUrls)})),p.default.serverTranscodingProgress.subscribe(((e,t,s)=>{const i=this._postIdToPostInfo[e];if(!i)return;let o=this._postIdToServerTranscodingProgress[e];o||(o=this._postIdToServerTranscodingProgress[e]={}),(0,h.default)(o[t],s)||(o[t]=s,this.trigger(i.localUrls))})),S.videoManipulationProgressChangedEvent.subscribe(((e,t)=>{const s=this._reencodingSessionIdToPostId[e],i=s&&this._postIdToPostInfo[s];i&&(i.lastReencodingUpdate=t,this.trigger(i.localUrls))})),a.Resolved()}_startedTrackingKey(e){if(m.default.isFileOrBlob(e)){const t=p.default.getPostByLocalUrl(e);t?this._postIdToPostInfo[t.id]?this._postIdToPostInfo[t.id].localUrls.push(e):this._postIdToPostInfo[t.id]=this._updateUploadInfo(t,[e],void 0):this._urlsWithoutProgress.push(e)}else if(m.default.isUrlValid(e)){const t=d.default.getFileDownloadByUrl(e);return void(t?this._fileDownloadKeyToDownloadInfo[t.key]?this._fileDownloadKeyToDownloadInfo[t.key].urls.push(e):this._fileDownloadKeyToDownloadInfo[t.key]={key:t.key,urls:[e],downloadTransferId:this._updateTransferTracking(t.downloadTransfer,void 0)}:this._urlsWithoutProgress.push(e))}}_stoppedTrackingKey(e){if(o.remove(this._urlsWithoutProgress,e),m.default.isFileOrBlob(e)){const t=p.default.getPostByLocalUrl(e),s=t&&this._postIdToPostInfo[t.id];t&&s&&(o.pull(s.localUrls,e),s.localUrls.length||(delete this._postIdToPostInfo[t.id],o.each(s.uploads,(e=>{this._updateTransferTracking(void 0,e.dataTransferId),this._updateTransferTracking(void 0,e.thumbnailTransferId)})),delete this._foregroundPostInfo.postIdToFullDataProgress[t.id],delete this._foregroundPostInfo.postIdToThumbnailProgress[t.id]))}else if(m.default.isUrlValid(e)){const t=d.default.getFileDownloadByUrl(e),s=t&&this._fileDownloadKeyToDownloadInfo[t.key];s&&(o.pull(s.urls,e),s.urls.length||(delete this._fileDownloadKeyToDownloadInfo[t.key],this._updateTransferTracking(void 0,s.downloadTransferId)))}}_updateUploadInfo(e,t,s){const i=o.map(e.amsUploads,((t,i)=>{let o,n,r,a;if(t.amsUploadFullData){const r=s&&s[i]&&s[i].dataTransferId;o=this._updateTransferTracking(e.amsFullDataBackgroundTransfers&&e.amsFullDataBackgroundTransfers[i],r),n=t.amsUploadFullData,o&&this._foregroundPostInfo.postIdToFullDataProgress[e.id]&&delete this._foregroundPostInfo.postIdToFullDataProgress[e.id][i]}if(t.amsUploadThumbnailData){const o=s&&s[i]&&s[i].thumbnailTransferId;r=this._updateTransferTracking(e.amsThumbnailBackgroundTransfers&&e.amsThumbnailBackgroundTransfers[i],o),a=t.amsUploadThumbnailData,r&&this._foregroundPostInfo.postIdToThumbnailProgress[e.id]&&delete this._foregroundPostInfo.postIdToThumbnailProgress[e.id][i]}return{dataTransferId:o,fullData:n,thumbnailTransferId:r,thumbnailData:a}}));return{id:e.id,localUrls:t,uploads:i}}_updateTransferTracking(e,t){const s=e?e.id:void 0;if(t!==s&&(t&&(delete this._transferIdToProgress[t],l.default.unsubscribeFromProgress(t,this._reportedProgress)),s)){const e=l.default.getProgress(s);e&&(this._transferIdToProgress[s]=e),l.default.subscribeToProgress(s,this._reportedProgress)}return s}_getVideoProgressForUrl(e,t){e.transcodingSessionId&&(this._reencodingSessionIdToPostId[e.transcodingSessionId]=e.id);let s=f.Queued,i=0;if(e.transcodingStatus===u.TranscodingState.InProgress){const e=t&&t.lastReencodingUpdate;e?(s=e.type===n.ReencodeProgressType.Fetch?f.FetchingFromiCloud:f.Transcoding,i=e.progress):s=f.Queued}else if(e.transcodingStatus===u.TranscodingState.Success){const o=t&&this._getUploadProgressForUrl(e,t);o?o.finished&&o.success?(s=f.Completed,i=1):o.finished?s=f.Failed:(s=f.Uploading,i=o.progress):(s=f.Transcoding,i=1)}let o=0;if(s!==f.Failed&&s!==f.Queued){let t=0,n=0;switch(s){case f.FetchingFromiCloud:n=y,t=0;break;case f.Transcoding:e.wasFetchedFromiCloud?(t=y,n=.33):(t=0,n=.5);break;case f.Uploading:default:e.wasFetchedFromiCloud?(t=.66,n=.34):(t=.5,n=.5)}o=t+n*i}return{finished:s===f.Completed||s===f.Failed,success:s===f.Completed,progress:o,totalSize:e.estimatedVideoUploadSize}}_getServerTranscodingVideoProgressForUrl(e,t){const s=this._getUploadProgressForUrl(e,t);if(!e.amsUploads||!s)return;const i=this._postIdToServerTranscodingProgress[e.id],o=i&&i[0];return s.finished&&s.success&&o?Object.assign(Object.assign({},o),{progress:.5+.5*o.progress}):Object.assign(Object.assign({},s),{progress:.5*s.progress})}_getUploadProgressForUrl(e,t){let s=0,i=0,n=!0,r=!0;const a=(e,t,o)=>{const a=t?this._transferIdToProgress[t]:o,l=e||0;i+=l,a?(s+=a.finished?l:(a.progress||0)*l,n=n&&a.finished,r=r&&a.success):(n=!1,r=!1)};return o.each(e.amsUploads,((s,i)=>{const o=t.uploads&&t.uploads[i];s.amsUploadFullData&&a(c.default.getAmsUploadFileSize(s),o&&o.dataTransferId,this._foregroundPostInfo.postIdToFullDataProgress[e.id]&&this._foregroundPostInfo.postIdToFullDataProgress[e.id][i]),s.amsUploadThumbnailData&&a(s.amsUploadThumbnailData.file.size,o&&o.thumbnailTransferId,this._foregroundPostInfo.postIdToThumbnailProgress[e.id]&&this._foregroundPostInfo.postIdToThumbnailProgress[e.id][i])})),{progress:i>0?s/i:0,finished:n,success:r}}getTransferProgressForUrl(e){const t=p.default.getPostByLocalUrl(e),s=t&&this._postIdToPostInfo[t.id];if(t&&t.transcodingStatus)return this._getVideoProgressForUrl(t,s);if(!t||!s){const t=d.default.getFileDownloadByUrl(e),s=t&&this._fileDownloadKeyToDownloadInfo[t.key];return s&&s.downloadTransferId?this._transferIdToProgress[s.downloadTransferId]:void 0}return t.willUploadForServerTranscoding?this._getServerTranscodingVideoProgressForUrl(t,s):this._getUploadProgressForUrl(t,s)}test_startTrackingKey(e){this._startedTrackingKey(e)}test_reset(){this._postIdToPostInfo={},this._fileDownloadKeyToDownloadInfo={},this._transferIdToProgress={},this._foregroundPostInfo={postIdToFullDataProgress:{},postIdToThumbnailProgress:{}},this._urlsWithoutProgress=[],this._reencodingSessionIdToPostId={}}};(0,i.__decorate)([r.disableWarnings],_.prototype,"_startedTrackingKey",null),(0,i.__decorate)([r.disableWarnings],_.prototype,"_stoppedTrackingKey",null),(0,i.__decorate)([r.autoSubscribe,(0,i.__param)(0,r.key)],_.prototype,"getTransferProgressForUrl",null),_=(0,i.__decorate)([r.AutoSubscribeStore],_),t.default=new _},75865:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(70655),o=s(88837),n=s(97691),r=s(72918),a=s(89391),l=s(65976),d=s(22538),c=s(94214);let h=class extends o.StoreBase{constructor(){super(),this._hasCdnToken=!1,this._hasCdnTokenCookie=!1,this._hasAmsCookie=!1,d.RegisterStartupable(this,"UrlAuthStore",[r.default,c.default])}startup(){return c.default.subscribe((()=>{const e=this._hasCdnToken,t=this._hasCdnTokenCookie;this._hasCdnToken=!!c.default.getCdnToken(),this._hasCdnTokenCookie=c.default.usingCdnCookie();let s=!1;e!==this._hasCdnToken&&(s=!0),t!==this._hasCdnTokenCookie&&(s=!0),s&&this.trigger()}),c.TriggerKeys.CdnTokenKey),c.default.subscribe((()=>{const e=this._hasAmsCookie;this._hasAmsCookie=c.default.getAmsCookieSet(),e!==this._hasAmsCookie&&this.trigger()}),c.TriggerKeys.AmsTokenKey),this._hasCdnToken=!!c.default.getCdnToken(),this._hasCdnTokenCookie=c.default.usingCdnCookie(),this._hasAmsCookie=c.default.getAmsCookieSet(),n.Resolved()}getAuthenticatedUrl(e){if(e)return l.isAsyncMediaUrl(e)?this._hasAmsCookie?e:void 0:this._isStaticAmsUrl(e)?this._hasCdnTokenCookie?e:this._hasCdnToken?e+"?"+c.default.getCdnToken():void 0:e}_isStaticAmsUrl(e){return 0===e.indexOf(a.default.getConfigSettingsNoSubscription().pes.skypeServiceHost)}};(0,i.__decorate)([o.autoSubscribe],h.prototype,"getAuthenticatedUrl",null),h=(0,i.__decorate)([o.AutoSubscribeStore],h),t.default=new h},73096:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UserComposingStateStore=void 0;const i=s(71908);class o{constructor(){this._composingStates={}}isUserComposing(){return Object.keys(this._composingStates).length>0}setComposingState(e,t){if(e)this._composingStates[t]=!0;else{if(!this._composingStates[t])return;delete this._composingStates[t]}i.setUserComposingStateIfSupported(e,t)}test_reset(){this._composingStates={}}}t.UserComposingStateStore=o,t.default=new o},27028:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OverlayType=t.QRCodeScanState=void 0,function(e){e[e.Disallowed=1]="Disallowed",e[e.Dismissed=2]="Dismissed",e[e.Opened=3]="Opened"}(t.QRCodeScanState||(t.QRCodeScanState={})),function(e){e[e.None=1]="None",e[e.Filter=2]="Filter"}(t.OverlayType||(t.OverlayType={}))},25854:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MediaType=t.MediaPickerMode=t.BingEmotions=t.CaptureFirstRunLevel=t.MediaEditorFirstRunLevel=t.LensStyle=t.FlashMode=t.CameraMode=void 0,function(e){e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.None=3]="None"}(t.CameraMode||(t.CameraMode={})),function(e){e[e.On=0]="On",e[e.Off=1]="Off"}(t.FlashMode||(t.FlashMode={})),function(e){e[e.None=0]="None",e[e.Sepia=1]="Sepia",e[e.Grayscale=2]="Grayscale",e[e.Red=3]="Red",e[e.Orange=4]="Orange",e[e.Yellow=5]="Yellow",e[e.Green=6]="Green",e[e.Blue=7]="Blue",e[e.Purple=8]="Purple"}(t.LensStyle||(t.LensStyle={})),function(e){e[e.None=0]="None",e[e.Conversation=1]="Conversation",e[e.Hub=2]="Hub"}(t.MediaEditorFirstRunLevel||(t.MediaEditorFirstRunLevel={})),function(e){e[e.None=0]="None",e[e.CaptureOnly=1]="CaptureOnly",e[e.All=2]="All"}(t.CaptureFirstRunLevel||(t.CaptureFirstRunLevel={})),function(e){e[e.Anger=0]="Anger",e[e.Disgust=1]="Disgust",e[e.Fear=2]="Fear",e[e.Happiness=3]="Happiness",e[e.Neutral=4]="Neutral",e[e.Sadness=5]="Sadness",e[e.Surprise=6]="Surprise"}(t.BingEmotions||(t.BingEmotions={})),function(e){e[e.Default=0]="Default",e[e.Inline=1]="Inline",e[e.InlinePeekaboo=2]="InlinePeekaboo"}(t.MediaPickerMode||(t.MediaPickerMode={})),function(e){e[e.PhotoOnly=0]="PhotoOnly",e[e.All=1]="All"}(t.MediaType||(t.MediaType={}))},31147:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationType=void 0,function(e){e[e.OneOnOneSkype=0]="OneOnOneSkype",e[e.Encrypted=1]="Encrypted",e[e.PSTN=2]="PSTN",e[e.Group=3]="Group",e[e.Bot=4]="Bot",e[e.Other=5]="Other"}(t.ConversationType||(t.ConversationType={}))},23353:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationUIType=void 0,function(e){e[e.OneOnOneSkype=0]="OneOnOneSkype",e[e.Private=1]="Private",e[e.Phone=2]="Phone",e[e.Group=3]="Group",e[e.Other=4]="Other"}(t.ConversationUIType||(t.ConversationUIType={}))},84912:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CustomReactionsType=void 0,function(e){e[e.Message=0]="Message",e[e.Call=1]="Call"}(t.CustomReactionsType||(t.CustomReactionsType={}))},5450:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultMap=void 0,t.getDefaultMap=function(){return{"(smile)":{id:"smile",frameCount:53,firstFrame:22,utf:"🙂",shortcuts:[":)",":-)",":=)","(smile)"]},"(sad)":{id:"sad",frameCount:63,firstFrame:17,utf:"🙁",shortcuts:[":(",":-(",":=(","(sad)",":<",":-<"]},"(laugh)":{id:"laugh",frameCount:77,firstFrame:19,utf:"😀",shortcuts:[":D",":-D",":=D",":d",":-d",":=d","(laugh)",":>",":->","(lol)"]},"(cool)":{id:"cool",frameCount:38,firstFrame:20,utf:"😎",shortcuts:["(cool)","8-)","8=)","B-)","B=)"]},"(surprised)":{id:"surprised",frameCount:68,firstFrame:17,utf:"😲",shortcuts:[":O",":-O",":=O",":o",":-o",":=o","(surprised)"]},"(sarcastic)":{id:"sarcastic",frameCount:84,firstFrame:53,shortcuts:["(sarcastic)","(sarcasm)","(slowclap)"]},"(cwl)":{id:"cwl",frameCount:61,firstFrame:12,utf:"😂",shortcuts:["(cwl)","(cryingwithlaughter)"]},"(wink)":{id:"wink",frameCount:36,firstFrame:16,utf:"😉",shortcuts:[";)",";-)",";=)","(wink)"]},"(cry)":{id:"cry",frameCount:50,firstFrame:38,utf:"😢",shortcuts:[";(",";-(",";=(","(cry)",':"(']},"(sweat)":{id:"sweat",frameCount:69,firstFrame:11,utf:"😓",shortcuts:["(:|","(sweat)"]},"(speechless)":{id:"speechless",frameCount:67,firstFrame:10,utf:"😐",shortcuts:[":|",":-|",":=|","(speechless)"]},"(kiss)":{id:"kiss",frameCount:50,firstFrame:1,utf:"😗",shortcuts:["(kiss)",":*",":-*",":=*","(xo)"]},"(tongueout)":{id:"tongueout",frameCount:71,firstFrame:12,utf:"😋",shortcuts:[":p",":-p",":=p",":P",":-P",":=P","(tongueout)"]},"(blush)":{id:"blush",frameCount:69,firstFrame:11,utf:"😊",shortcuts:[":$",":-$",":=$",":'>","(blush)"]},"(wonder)":{id:"wonder",frameCount:70,firstFrame:16,utf:"🤨",shortcuts:[":^)","(wonder)"]},"(sleepy)":{id:"sleepy",frameCount:72,firstFrame:1,utf:"😪",shortcuts:["|-)","I-)","I=)","(snooze)","(sleepy)"]},"(dull)":{id:"dull",frameCount:77,firstFrame:16,utf:"🙄",shortcuts:["|-(","|(","|=(","(dull)"]},"(inlove)":{id:"inlove",frameCount:63,firstFrame:1,utf:"🥰",shortcuts:["(inlove)","(love)",":]",":-]"]},"(eg)":{id:"eg",frameCount:78,firstFrame:8,shortcuts:["]:)",">:)","]:)",">:)","(evilgrin)","(evil)","(grin)","(eg)"]},"(yawn)":{id:"yawn",frameCount:74,firstFrame:27,shortcuts:["(yawn)"]},"(puke)":{id:"puke",frameCount:79,firstFrame:27,utf:"🤮",shortcuts:["(puke)",":&",":-&",":=&","+o("]},"(doh)":{id:"doh",frameCount:60,firstFrame:29,shortcuts:["(doh)"]},"(angry)":{id:"angry",frameCount:114,firstFrame:1,utf:"😠",shortcuts:["(angry)",":@",":-@",":=@","x(","x-(","X(","X-(","x=(","X=(",";@",";-@"]},"(wasntme)":{id:"wasntme",frameCount:76,firstFrame:18,utf:"🙄",shortcuts:["(wasntme)","(wm)"]},"(party)":{id:"party",frameCount:71,firstFrame:14,utf:"🥳",shortcuts:["(party)","<O)","<o)","<:o)"]},"(worry)":{id:"worry",frameCount:56,firstFrame:1,utf:"😧",shortcuts:["(worry)",":S",":s",":-s",":-S",":=s",":=S","(worried)"]},"(mmm)":{id:"mmm",frameCount:93,firstFrame:25,utf:"😋",shortcuts:["(mm)","(mmm)","(mmmm)"]},"(nerdy)":{id:"nerdy",frameCount:48,firstFrame:1,utf:"🤓",shortcuts:["(nerd)","8-|","B-|","8|","B|","8=|","B=|","(nerdy)"]},"(lipssealed)":{id:"lipssealed",frameCount:50,firstFrame:1,utf:"🤫",shortcuts:[":x",":-x",":X",":-X",":#",":-#",":=x",":=X",":=#","(lipssealed)"]},"(devil)":{id:"devil",frameCount:67,firstFrame:1,utf:"😈",shortcuts:["(devil)"]},"(angel)":{id:"angel",frameCount:84,firstFrame:37,utf:"😇",shortcuts:["(angel)"]},"(envy)":{id:"envy",frameCount:68,firstFrame:18,shortcuts:["(envy)","(v)"]},"(makeup)":{id:"makeup",frameCount:108,firstFrame:72,shortcuts:["(makeup)","(kate)"]},"(cash)":{id:"cash",frameCount:27,firstFrame:11,utf:"💲",shortcuts:["(cash)","($)"]},"(think)":{id:"think",frameCount:59,firstFrame:1,utf:"🤔",shortcuts:["(think)",":-?",":?",":=?","*-)"]},"(rofl)":{id:"rofl",frameCount:81,firstFrame:18,utf:"🤣",shortcuts:["(rofl)","(rotfl)"]},"(happy)":{id:"happy",frameCount:70,firstFrame:5,shortcuts:["(happy)"]},"(smirk)":{id:"smirk",frameCount:54,firstFrame:1,utf:"😏",shortcuts:["(smirk)"]},"(nod)":{id:"nod",frameCount:51,firstFrame:11,shortcuts:["(nod)"]},"(shake)":{id:"shake",frameCount:51,firstFrame:11,shortcuts:["(shake)"]},"(waiting)":{id:"waiting",frameCount:51,firstFrame:1,shortcuts:["(waiting)","(forever)","(impatience)"]},"(emo)":{id:"emo",frameCount:54,firstFrame:1,shortcuts:["(emo)"]},"(fingerscrossed)":{id:"fingerscrossed",frameCount:64,firstFrame:1,utf:"🤞",shortcuts:["(yn)","(fingers)","(fingerscrossed)","(crossedfingers)"]},"(hi)":{id:"hi",frameCount:57,firstFrame:1,utf:"👋",shortcuts:["(wave)","(hi)","(bye)"]},"(facepalm)":{id:"facepalm",frameCount:77,firstFrame:1,utf:"🤦",shortcuts:["(facepalm)","(fail)"]},"(wait)":{id:"wait",frameCount:45,firstFrame:16,shortcuts:["(wait)"]},"(giggle)":{id:"giggle",frameCount:45,firstFrame:1,utf:"🤭",shortcuts:["(chuckle)","(giggle)"]},"(clap)":{id:"clap",frameCount:40,firstFrame:1,utf:"👏",shortcuts:["(clap)"]},"(whew)":{id:"whew",frameCount:51,firstFrame:6,shortcuts:["(whew)","(phew)"]},"(highfive)":{id:"highfive",frameCount:38,firstFrame:9,utf:"✋",shortcuts:["(highfive)","(hifive)","(h5)"]},"(tmi)":{id:"tmi",frameCount:56,firstFrame:10,shortcuts:["(tmi)"]},"(call)":{id:"call",frameCount:46,firstFrame:1,shortcuts:["(call)","(t)"]},"(headbang)":{id:"headbang",frameCount:71,firstFrame:16,shortcuts:["(headbang)","(banghead)"]},"(idea)":{id:"idea",frameCount:119,firstFrame:1,shortcuts:["(idea)",":i",":I","*-:)"]},"(lalala)":{id:"lalala",frameCount:20,firstFrame:6,shortcuts:["(lalala)","(lalalala)","(lala)","(notlistening)"]},"(punch)":{id:"punch",frameCount:44,firstFrame:9,shortcuts:["(punch)","*|","*-|"]},"(rock)":{id:"rock",frameCount:12,firstFrame:1,utf:"🤘",shortcuts:["(rock)"]},"(swear)":{id:"swear",frameCount:77,firstFrame:6,utf:"😬",shortcuts:["(swear)"]},"(talk)":{id:"talk",frameCount:47,firstFrame:4,shortcuts:["(talk)"]},"(talktothehand)":{id:"talktothehand",frameCount:62,firstFrame:1,shortcuts:["(talktothehand)"]},"(bandit)":{id:"bandit",frameCount:102,firstFrame:4,shortcuts:["(bandit)"]},"(heart)":{id:"heart",frameCount:16,firstFrame:1,utf:"❤️",shortcuts:["(heart)","<3"]},"(brokenheart)":{id:"brokenheart",frameCount:105,firstFrame:50,utf:"💔",shortcuts:["(brokenheart)"]},"(yes)":{id:"yes",frameCount:40,firstFrame:1,utf:"👍",shortcuts:["(y)","(yes)"]},"(no)":{id:"no",frameCount:55,firstFrame:1,utf:"👎",shortcuts:["(n)","(no)"]},"(handshake)":{id:"handshake",frameCount:62,firstFrame:13,utf:"🤝",shortcuts:["(handshake)"]},"(ok)":{id:"ok",frameCount:72,firstFrame:1,utf:"👌",shortcuts:["(ok)","(okay)"]},"(muscle)":{id:"muscle",frameCount:59,firstFrame:1,utf:"💪",shortcuts:["(flex)","(muscle)"]},"(bow)":{id:"bow",frameCount:60,firstFrame:30,utf:"🙇",shortcuts:["(bow)"]},"(dance)":{id:"dance",frameCount:206,firstFrame:1,utf:"🕺",shortcuts:["\\o/","\\:D/","\\:d/","(dance)"]},"(bartlett)":{id:"bertlett",frameCount:80,firstFrame:2,utf:"⛹",shortcuts:["(bartlett)","(football)","(soccer)","(so)"]},"(bike)":{id:"bike",frameCount:12,firstFrame:1,utf:"🚴",shortcuts:["(bike)","(bicycle)","(sander)"]},"(ninja)":{id:"ninja",frameCount:122,firstFrame:19,shortcuts:["(ninja)","(j)"]},"(cat)":{id:"cat",frameCount:120,firstFrame:1,utf:"🐈",shortcuts:["(cat)","(@)","(meow)","(kitty)"]},"(dog)":{id:"dog",frameCount:54,firstFrame:1,utf:"🐕",shortcuts:["(dog)",":o3","(&)"]},"(hug)":{id:"hug",frameCount:76,firstFrame:10,utf:"🤗",shortcuts:["(hug)","(bear)"]},"(heidy)":{id:"heidy",frameCount:75,firstFrame:24,utf:"🐿",shortcuts:["(heidy)","(squirrel)"]},"(flower)":{id:"flower",frameCount:83,firstFrame:1,utf:"🌼",shortcuts:["(flower)"]},"(sun)":{id:"sun",frameCount:26,firstFrame:7,utf:"☀",shortcuts:["(sun)"]},"(rain)":{id:"rain",frameCount:30,firstFrame:3,utf:"🌧",shortcuts:["(rain)","(london)","(st)"]},"(star)":{id:"star",frameCount:64,firstFrame:1,utf:"⭐",shortcuts:["(star)","(*)"]},"(tumbleweed)":{id:"tumbleweed",frameCount:32,firstFrame:7,shortcuts:["(tumbleweed)"]},"(pizza)":{id:"pizza",frameCount:91,firstFrame:15,utf:"🍕",shortcuts:["(pi)","(pizza)"]},"(cake)":{id:"cake",frameCount:99,firstFrame:1,utf:"🎂",shortcuts:["(cake)"]},"(coffee)":{id:"coffee",frameCount:28,firstFrame:1,utf:"☕",shortcuts:["(coffee)"]},"(beer)":{id:"beer",frameCount:76,firstFrame:1,utf:"🍺",shortcuts:["(beer)","(bricklayers)"]},"(drink)":{id:"drink",frameCount:63,firstFrame:1,utf:"🍸",shortcuts:["(drink)"]},"(wfh)":{id:"wfh",frameCount:79,firstFrame:1,shortcuts:["(wfh)","(@h)"]},"(phone)":{id:"phone",frameCount:89,firstFrame:1,utf:"📱",shortcuts:["(mp)","(ph)","(phone)"]},"(mail)":{id:"mail",frameCount:54,firstFrame:1,utf:"✉",shortcuts:["(mail)"]},"(movie)":{id:"movie",frameCount:55,firstFrame:1,utf:"🎬",shortcuts:["(film)","(movie)"]},"(music)":{id:"music",frameCount:55,firstFrame:32,utf:"🎵",shortcuts:["(music)"]},"(time)":{id:"time",frameCount:60,firstFrame:18,utf:"🕰️",shortcuts:["(time)","(clock)"]},"(hearteyes)":{id:"hearteyes",frameCount:97,firstFrame:1,utf:"😍",shortcuts:["(hearteyes)"]},"(stareyes)":{id:"stareyes",frameCount:97,firstFrame:1,utf:"🤩",shortcuts:["(stareyes)"]},"(xd)":{id:"xd",frameCount:25,firstFrame:1,utf:"😊",shortcuts:["(xd)"]},"(unamused)":{id:"unamused",frameCount:188,firstFrame:1,utf:"😒",shortcuts:["(unamused)"]},"(pensive)":{id:"pensive",frameCount:130,firstFrame:1,utf:"😔",shortcuts:["(pensive)"]},"(weary)":{id:"weary",frameCount:83,firstFrame:1,utf:"😩",shortcuts:["(weary)"]},"(hysterical)":{id:"hysterical",frameCount:18,firstFrame:1,utf:"🤪",shortcuts:["(hysterical)"]},"(flushed)":{id:"flushed",frameCount:90,firstFrame:1,utf:"😳",shortcuts:["(flushed)"]},"(sweatgrinning)":{id:"sweatgrinning",frameCount:43,firstFrame:1,utf:"😅",shortcuts:["(sweatgrinning)"]},"(disappointed)":{id:"disappointed",frameCount:124,firstFrame:1,utf:"😞",shortcuts:["(disappointed)"]},"(loudlycrying)":{id:"loudlycrying",frameCount:71,firstFrame:1,utf:"😭",shortcuts:["(loudlycrying)"]},"(shivering)":{id:"shivering",frameCount:190,firstFrame:68,utf:"🥶",shortcuts:["(shivering)","(cold)","(freezing)"]},"(expressionless)":{id:"expressionless",frameCount:105,firstFrame:1,utf:"😑",shortcuts:["(expressionless)"]},"(relieved)":{id:"relieved",frameCount:82,firstFrame:1,utf:"😌",shortcuts:["(relieved)"]},"(confused)":{id:"confused",frameCount:60,firstFrame:1,utf:"😕",shortcuts:["(confused)",":-/",":-\\",":/",":\\"]},"(veryconfused)":{id:"veryconfused",frameCount:79,firstFrame:1,utf:"😖",shortcuts:["(veryconfused)"]},"(headphones)":{id:"headphones",frameCount:84,firstFrame:1,utf:"🎧",shortcuts:["(headphones)"]},"(selfie)":{id:"selfie",frameCount:61,firstFrame:1,utf:"🤳",shortcuts:["(selfie)"]},"(shock)":{id:"shock",frameCount:95,firstFrame:41,utf:"😱",shortcuts:["(shock)"]},"(ill)":{id:"ill",frameCount:110,firstFrame:1,utf:"🤒",shortcuts:["(ill)"]},"(tired)":{id:"tired",frameCount:148,firstFrame:1,utf:"😫",shortcuts:["(tired)"]},"(movember)":{id:"movember",frameCount:110,firstFrame:1,utf:"🧐",shortcuts:["(movember)","(mo)","(november)","(moustache)","(mustache)","(bowman)",":{"]},"(ghost)":{id:"ghost",frameCount:78,firstFrame:1,utf:"👻",shortcuts:["(ghost)"]},"(skull)":{id:"skull",frameCount:99,firstFrame:1,utf:"💀",shortcuts:["(skull)"]},"(pumpkin)":{id:"pumpkin",frameCount:56,firstFrame:1,utf:"🎃",shortcuts:["(pumpkin)","(halloween)"]},"(smoke)":{id:"smoke",frameCount:65,firstFrame:1,utf:"🚬",shortcuts:["(smoking)","(smoke)","(ci)"]},"(finger)":{id:"finger",frameCount:72,firstFrame:18,utf:"🖕",shortcuts:["(finger)"]},"(fistbump)":{id:"fistbump",frameCount:62,firstFrame:1,utf:"✊",shortcuts:["(fistbump)","=ƎE=","p#d"]},"(handsinair)":{id:"handsinair",frameCount:63,firstFrame:1,utf:"🙌",shortcuts:["(celebrate)","(celebration)","(handsinair)","(hia)"]},"(hearthands)":{id:"hearthands",frameCount:67,firstFrame:1,utf:"🤟",shortcuts:["(hearthands)"]},"(victory)":{id:"victory",frameCount:73,firstFrame:1,utf:"✌",shortcuts:["(victory)"]},"(praying)":{id:"praying",frameCount:90,firstFrame:1,utf:"🙏",shortcuts:["(pray)","(praying)","_/\\_","(namaste)"]},"(vulcansalute)":{id:"vulcansalute",frameCount:106,firstFrame:1,utf:"🖖",shortcuts:["(vulcansalute)"]},"(glassceiling)":{id:"glassceiling",frameCount:92,firstFrame:1,utf:"🤷‍♂️",shortcuts:["(glassceiling)"]},"(dropthemic)":{id:"dropthemic",frameCount:68,firstFrame:1,utf:"🤱",shortcuts:["(dropthemic)"]},"(womanshrug)":{id:"womanshrug",frameCount:108,firstFrame:1,utf:"🤷‍♀️",shortcuts:["(womanshrug)","(wshrug)","(fshrug)"]},"(cupcake)":{id:"cupcake",frameCount:100,firstFrame:1,utf:"🧁",shortcuts:["(cupcake)"]},"(lips)":{id:"lips",frameCount:89,firstFrame:36,utf:"💋",shortcuts:["(lips)"]},"(penguin)":{id:"penguin",frameCount:64,firstFrame:1,utf:"🐧",shortcuts:["(penguin)","(dancingpenguin)","(penguindance)","(linux)"]},"(monkey)":{id:"monkey",frameCount:50,firstFrame:12,utf:"🐒",shortcuts:["(monkey)","(ape)",":(|)"]},"(koala)":{id:"koala",frameCount:111,firstFrame:1,utf:"🐨",shortcuts:["(koala)"]},"(panda)":{id:"panda",frameCount:169,firstFrame:1,utf:"🐼",shortcuts:["(panda)"]},"(octopus)":{id:"octopus",frameCount:105,firstFrame:1,utf:"🐙",shortcuts:["(octopus)"]},"(whale)":{id:"whale",frameCount:101,firstFrame:1,utf:"🐋",shortcuts:["(whale)"]},"(dolphin)":{id:"dolphin",frameCount:65,firstFrame:1,utf:"🐬",shortcuts:["(dolphin)"]},"(fish)":{id:"fish",frameCount:60,firstFrame:1,utf:"🐟",shortcuts:["(fish)"]},"(bee)":{id:"bee",frameCount:32,firstFrame:1,utf:"🐝",shortcuts:["(bee)"]},"(unicornhead)":{id:"unicornhead",frameCount:87,firstFrame:1,utf:"🦄",shortcuts:["(unicornhead)"]},"(tortoise)":{id:"tortoise",frameCount:195,firstFrame:1,utf:"🐢",shortcuts:["(tortoise)"]},"(elephant)":{id:"elephant",frameCount:88,firstFrame:1,utf:"🐘",shortcuts:["(elephant)"]},"(spider)":{id:"spider",frameCount:125,firstFrame:1,utf:"🕷",shortcuts:["(spider)"]},"(snake)":{id:"snake",frameCount:75,firstFrame:1,utf:"🐍",shortcuts:["(snake)"]},"(bunnyhug)":{id:"bunnyhug",frameCount:76,firstFrame:1,utf:"🐰",shortcuts:["(bunnyhug)"]},"(foxhug)":{id:"foxhug",frameCount:95,firstFrame:1,utf:"🦊",shortcuts:["(foxhug)"]},"(pig)":{id:"pig",frameCount:64,firstFrame:1,utf:"🐖",shortcuts:["(pig)"]},"(polarbear)":{id:"polarbear",frameCount:120,firstFrame:1,utf:"🐻",shortcuts:["(polarbear)","(polarbearhug)"]},"(movinghome)":{id:"movinghome",frameCount:26,firstFrame:1,utf:"🦀",shortcuts:["(movinghome)"]},"(cricket)":{id:"cricket",frameCount:189,firstFrame:1,utf:"🦗",shortcuts:["(cricket)"]},"(snail)":{id:"snail",frameCount:74,firstFrame:1,utf:"🐌",shortcuts:["(snail)","(sn)"]},"(lamb)":{id:"lamb",frameCount:58,firstFrame:1,utf:"🐑",shortcuts:["(lamb)"]},"(hedgehog)":{id:"hedgehog",frameCount:50,firstFrame:1,utf:"🦔",shortcuts:["(hedgehog)"]},"(bunny)":{id:"bunny",frameCount:110,firstFrame:1,utf:"🐇",shortcuts:["(bunny)","(lovebunny)","(rabbit)"]},"(yotfr)":{id:"yotfr",frameCount:72,firstFrame:1,utf:"🐔",shortcuts:["(yotfr)"]},"(fire)":{id:"fire",frameCount:10,firstFrame:1,utf:"🔥",shortcuts:["(fire)"]},"(rainbow)":{id:"rainbow",frameCount:20,firstFrame:1,utf:"🌈",shortcuts:["(rainbow)"]},"(avocadolove)":{id:"avocadolove",frameCount:129,firstFrame:1,utf:"🥑",shortcuts:["(avocadolove)"]},"(redwine)":{id:"redwine",frameCount:1,firstFrame:1,utf:"🍷",shortcuts:["(redwine)"]},"(champagne)":{id:"champagne",frameCount:62,firstFrame:1,utf:"🍾",shortcuts:["(champagne)","(sparkling)"]},"(cheers)":{id:"cheers",frameCount:68,firstFrame:1,utf:"🥂",shortcuts:["(cheers)"]},"(chai)":{id:"chai",frameCount:130,firstFrame:1,utf:"🍵",shortcuts:["(chai)","(tea)"]},"(apple)":{id:"apple",frameCount:1,firstFrame:1,utf:"🍎",shortcuts:["(apple)"]},"(orange)":{id:"orange",frameCount:1,firstFrame:1,utf:"🍊",shortcuts:["(orange)"]},"(lemon)":{id:"lemon",frameCount:1,firstFrame:1,utf:"🍋",shortcuts:["(lemon)"]},"(banana)":{id:"banana",frameCount:1,firstFrame:1,utf:"🍌",shortcuts:["(banana)"]},"(watermelon)":{id:"watermelon",frameCount:1,firstFrame:1,utf:"🍉",shortcuts:["(watermelon)"]},"(grapes)":{id:"grapes",frameCount:1,firstFrame:1,utf:"🍇",shortcuts:["(grapes)"]},"(strawberry)":{id:"strawberry",frameCount:1,firstFrame:1,utf:"🍓",shortcuts:["(strawberry)"]},"(cherries)":{id:"cherries",frameCount:1,firstFrame:1,utf:"🍒",shortcuts:["(cherries)"]},"(peach)":{id:"peach",frameCount:1,firstFrame:1,utf:"🍑",shortcuts:["(peach)"]},"(pineapple)":{id:"pineapple",frameCount:1,firstFrame:1,utf:"🍍",shortcuts:["(pineapple)"]},"(aubergine)":{id:"aubergine",frameCount:1,firstFrame:1,utf:"🍆",shortcuts:["(aubergine)","(eggplant)"]},"(cheese)":{id:"cheese",frameCount:71,firstFrame:1,utf:"🧀",shortcuts:["(cheese)","(stink)"]},"(chickenleg)":{id:"chickenleg",frameCount:1,firstFrame:1,utf:"🍗",shortcuts:["(chickenleg)"]},"(burger)":{id:"burger",frameCount:1,firstFrame:1,utf:"🍔",shortcuts:["(burger)"]},"(fries)":{id:"fries",frameCount:1,firstFrame:1,utf:"🍟",shortcuts:["(fries)"]},"(noodles)":{id:"noodles",frameCount:1,firstFrame:1,utf:"🍜",shortcuts:["(noodles)"]},"(icecream)":{id:"icecream",frameCount:1,firstFrame:1,utf:"🍦",shortcuts:["(icecream)"]},"(cakeslice)":{id:"cakeslice",frameCount:1,firstFrame:1,utf:"🍰",shortcuts:["(cakeslice)"]},"(cookies)":{id:"cookies",frameCount:1,firstFrame:1,utf:"🍪",shortcuts:["(cookies)"]},"(pie)":{id:"pie",frameCount:70,firstFrame:1,utf:"🥧",shortcuts:["(pie)"]},"(laddu)":{id:"laddu",frameCount:70,firstFrame:1,utf:"🍬",shortcuts:["(laddu)"]},"(tandoorichicken)":{id:"tandoorichicken",frameCount:42,firstFrame:10,utf:"🍢",shortcuts:["(tandoori)","(tandoorichicken)"]},"(turkey)":{id:"turkey",frameCount:50,firstFrame:1,utf:"🦃",shortcuts:["(turkey)","(turkeydance)","(thanksgiving)"]},"(car)":{id:"car",frameCount:12,firstFrame:1,utf:"🚗",shortcuts:["(car)","(au)"]},"(truck)":{id:"truck",frameCount:12,firstFrame:1,utf:"🚚",shortcuts:["(truck)"]},"(ambulance)":{id:"ambulance",frameCount:12,firstFrame:1,utf:"🚑",shortcuts:["(ambulance)"]},"(policecar)":{id:"policecar",frameCount:12,firstFrame:1,utf:"🚓",shortcuts:["(policecar)"]},"(taxi)":{id:"taxi",frameCount:12,firstFrame:1,utf:"🚕",shortcuts:["(taxi)"]},"(scooter)":{id:"scooter",frameCount:60,firstFrame:1,utf:"🛵",shortcuts:["(scooter)"]},"(pushbike)":{id:"pushbike",frameCount:80,firstFrame:1,utf:"🛴",shortcuts:["(pushbike)"]},"(plane)":{id:"plane",frameCount:80,firstFrame:1,utf:"✈",shortcuts:["(plane)","(ap)","(airplane)","(aeroplane)","(aircraft)","(jet)"]},"(launch)":{id:"launch",frameCount:110,firstFrame:1,utf:"🚀",shortcuts:["(launch)","(rocket)","(shuttle)"]},"(desert)":{id:"desert",frameCount:1,firstFrame:1,utf:"🌵",shortcuts:["(desert)"]},"(parislove)":{id:"parislove",frameCount:59,firstFrame:1,utf:"🗼",shortcuts:["(parislove)"]},"(statueofliberty)":{id:"statueofliberty",frameCount:1,firstFrame:1,utf:"🗽",shortcuts:["(statueofliberty)"]},"(house)":{id:"house",frameCount:1,firstFrame:1,utf:"🏠",shortcuts:["(house)","(home)"]},"(gift)":{id:"gift",frameCount:13,firstFrame:12,utf:"🎁",shortcuts:["(gift)"]},"(trophy)":{id:"trophy",frameCount:65,firstFrame:1,utf:"🏆",shortcuts:["(trophy)"]},"(goldmedal)":{id:"goldmedal",frameCount:66,firstFrame:1,utf:"🥇",shortcuts:["(goldmedal)"]},"(silvermedal)":{id:"silvermedal",frameCount:66,firstFrame:1,utf:"🥈",shortcuts:["(silvermedal)"]},"(bronzemedal)":{id:"bronzemedal",frameCount:66,firstFrame:1,utf:"🥉",shortcuts:["(bronzemedal)"]},"(bell)":{id:"bell",frameCount:46,firstFrame:1,utf:"🔔",shortcuts:["(bell)","(ghanta)"]},"(key)":{id:"key",frameCount:66,firstFrame:1,utf:"🔑",shortcuts:["(key)","(success)"]},"(tubelight)":{id:"tubelight",frameCount:70,firstFrame:1,utf:"💡",shortcuts:["(tubelight)"]},"(americanfootball)":{id:"americanfootball",frameCount:1,firstFrame:1,utf:"🏈",shortcuts:["(americanfootball)"]},"(fallingleaf)":{id:"fallingleaf",frameCount:1,firstFrame:1,utf:"🍂",shortcuts:["(fallingleaf)"]},"(sunflower)":{id:"sunflower",frameCount:1,firstFrame:1,utf:"🌻",shortcuts:["(sunflower)"]},"(cherryblossom)":{id:"cherryblossom",frameCount:1,firstFrame:1,utf:"🌸",shortcuts:["(cherryblossom)"]},"(tulip)":{id:"tulip",frameCount:1,firstFrame:1,utf:"🌷",shortcuts:["(tulip)"]},"(rose)":{id:"rose",frameCount:1,firstFrame:1,utf:"🌹",shortcuts:["(rose)"]},"(wiltedflower)":{id:"wiltedflower",frameCount:85,firstFrame:1,utf:"🥀",shortcuts:["(wiltedflower)","(w)"]},"(loveletter)":{id:"loveletter",frameCount:59,firstFrame:1,utf:"💌",shortcuts:["(loveletter)"]},"(bomb)":{id:"bomb",frameCount:172,firstFrame:1,utf:"💣",shortcuts:["(bomb)","(explosion)","(explode)","@="]},"(sparkler)":{id:"sparkler",frameCount:36,firstFrame:1,utf:"🎇",shortcuts:["(sparkler)"]},"(fireworks)":{id:"fireworks",frameCount:84,firstFrame:18,utf:"🎆",shortcuts:["(fireworks)"]}}}},12229:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getCountryCodes=void 0,t.getCountryCodes=function(){return["eu","uk","af","ax","al","dz","as","ad","ao","ai","aq","ag","ar","am","aw","au","at","az","bs","bh","bd","bb","by","be","bz","bj","bm","bt","bo","ba","bw","bv","br","io","bn","bg","bf","bi","kh","cm","ca","cv","ky","cf","td","cl","cn","cx","cc","co","km","cg","cd","ck","cr","ci","hr","cu","cy","cz","dk","dj","dm","do","ec","eg","sv","gq","er","ee","et","fk","fo","fj","fi","fr","gf","pf","tf","ga","gm","ge","de","gh","gi","gr","gl","gd","gp","gu","gt","gg","gn","gw","gy","ht","hm","va","hn","hk","hu","is","in","id","ir","iq","ie","im","il","it","jm","jp","je","jo","kz","ke","ki","kp","kr","kw","kg","la","lv","lb","ls","lr","ly","li","lt","lu","mo","mk","mg","mw","my","mv","ml","mt","mh","mq","mr","mu","yt","mx","fm","md","mc","mn","me","ms","ma","mz","mm","na","nr","np","nl","an","nc","nz","ni","ne","ng","nu","nf","mp","no","om","pk","pw","ps","pa","pg","py","pe","ph","pn","pl","pt","pr","qa","re","ro","ru","rw","bl","sh","kn","lc","mf","pm","vc","ws","sm","st","sa","sn","rs","sc","sl","sg","sk","si","sb","so","za","gs","es","lk","sd","sr","sj","sz","se","ch","sy","tw","tj","tz","th","tl","tg","tk","to","tt","tn","tr","tm","tc","tv","ug","ua","ae","gb","us","um","uy","uz","vu","ve","vn","vg","vi","wf","ye","zm","zw"]}},81020:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ShareContactOrigin=void 0,function(e){e[e.MessageComposer=0]="MessageComposer",e[e.DragAndDrop=1]="DragAndDrop",e[e.Deeplink=2]="Deeplink"}(t.ShareContactOrigin||(t.ShareContactOrigin={}))},38915:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MediaBarItemOrigin=void 0,function(e){e[e.MessageOverflow=0]="MessageOverflow",e[e.MessageComposer=1]="MessageComposer",e[e.MeetNowInput=2]="MeetNowInput"}(t.MediaBarItemOrigin||(t.MediaBarItemOrigin={}))},9748:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OverflowMenuDefaultOrder=t.MediaBarDefaultOrder=t.PersonalizationPickerCategoryDefaultOrder=t.PesPickerCategoryDefaultOrder=t.MediaBarItemKeys=void 0,t.MediaBarItemKeys={Emoticon:"emoticon",Richtext:"richtext",Moji:"moji",MediaPicker:"media",FilePicker:"file",Location:"location",Contact:"contact",Camera:"camera",ComposerCamera:"composercamera",Bing:"bing",Sms:"sms",People:"people",VideoMessage:"video",Sticker:"sticker",Gif:"gif",ScheduleCall:"schedulecall",Poll:"poll",Audio:"audio",MeetNowIconPicker:"meetnowicon",ImagePicker:"imagepicker",SendCredit:"sendcredit"},t.PesPickerCategoryDefaultOrder=[t.MediaBarItemKeys.Emoticon,t.MediaBarItemKeys.Sticker,t.MediaBarItemKeys.Moji,t.MediaBarItemKeys.Gif],t.PersonalizationPickerCategoryDefaultOrder=[t.MediaBarItemKeys.Emoticon,t.MediaBarItemKeys.MeetNowIconPicker,t.MediaBarItemKeys.ImagePicker],t.MediaBarDefaultOrder=[t.MediaBarItemKeys.FilePicker,t.MediaBarItemKeys.VideoMessage,t.MediaBarItemKeys.Audio,t.MediaBarItemKeys.Location,t.MediaBarItemKeys.Contact,t.MediaBarItemKeys.ScheduleCall,t.MediaBarItemKeys.Gif,t.MediaBarItemKeys.Poll,t.MediaBarItemKeys.Sms,t.MediaBarItemKeys.Emoticon,t.MediaBarItemKeys.Moji,t.MediaBarItemKeys.Sticker,t.MediaBarItemKeys.MediaPicker,t.MediaBarItemKeys.SendCredit],t.OverflowMenuDefaultOrder=[t.MediaBarItemKeys.MediaPicker,t.MediaBarItemKeys.Camera,t.MediaBarItemKeys.FilePicker,t.MediaBarItemKeys.Contact,t.MediaBarItemKeys.Location,t.MediaBarItemKeys.Sms,t.MediaBarItemKeys.ScheduleCall,t.MediaBarItemKeys.Poll,t.MediaBarItemKeys.SendCredit]},45983:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DismissAnimationType=t.AnimateOverlayState=t.CacheMode=t.MediaViewerTypes=void 0,function(e){e.Picture="Picture",e.Video="Video",e.Audio="Audio",e.Swift="Swift",e.NoHighlights="NoHighlights",e.CallGalleryEmpty="CallGalleryEmpty",e.LoadingHighlights="LoadingHighlights"}(t.MediaViewerTypes||(t.MediaViewerTypes={})),function(e){e[e.FileCacheWithPrefetching=0]="FileCacheWithPrefetching",e[e.FileCacheWithNetFallback=1]="FileCacheWithNetFallback",e[e.Disabled=2]="Disabled"}(t.CacheMode||(t.CacheMode={})),function(e){e[e.None=0]="None",e[e.ShowOverlay=1]="ShowOverlay",e[e.HideOverlay=2]="HideOverlay"}(t.AnimateOverlayState||(t.AnimateOverlayState={})),function(e){e[e.Default=0]="Default",e[e.Vertical=1]="Vertical",e[e.Horizontal=2]="Horizontal"}(t.DismissAnimationType||(t.DismissAnimationType={}))},90284:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OverflowItemSizeInList=t.OverflowItemSizeInGridOrCarousel=void 0,t.OverflowItemSizeInGridOrCarousel=60,t.OverflowItemSizeInList=40},63032:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UrlPreviewRenderInformation=t.MessageRenderSendingStatus=void 0,function(e){e[e.None=0]="None",e[e.Sending=1]="Sending",e[e.NoNetwork=2]="NoNetwork",e[e.Failed=3]="Failed"}(t.MessageRenderSendingStatus||(t.MessageRenderSendingStatus={}));t.UrlPreviewRenderInformation=class{}},6658:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageStreamFontSize=t.streamItemOptionsMenuWidthInDesktopSubview=t.streamItemOptionsMenuWidth=t.streamItemOptionsMenuHeight=t.messageTextLineHeight=t.messageStreamMaxContentWidth=t.messageStreamOverflowWidth=t.messageBorderRadius=t.maxStreamContentWidth=t.headerTextHeight=t.addInsButtonWidth=t.adaptiveCardMessageFixedAspectRatio=t.adaptiveCardMessageFixedWidth=t.adaptiveCardMessageMaxHeight=t.adaptiveCardMessageMaxWidth=void 0,t.adaptiveCardMessageMaxWidth=300,t.adaptiveCardMessageMaxHeight=300,t.adaptiveCardMessageFixedWidth=240,t.adaptiveCardMessageFixedAspectRatio=1.96,t.addInsButtonWidth=44,t.headerTextHeight=17,t.maxStreamContentWidth=960,t.messageBorderRadius=10,t.messageStreamOverflowWidth=50,t.messageStreamMaxContentWidth=t.maxStreamContentWidth+2*t.messageStreamOverflowWidth,t.messageTextLineHeight=22,t.streamItemOptionsMenuHeight=30,t.streamItemOptionsMenuWidth=50,t.streamItemOptionsMenuWidthInDesktopSubview=32,function(e){e[e.Smaller=1]="Smaller",e[e.Small=2]="Small",e[e.Normal=3]="Normal",e[e.Large=4]="Large",e[e.Larger=5]="Larger"}(t.MessageStreamFontSize||(t.MessageStreamFontSize={}))},65047:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DataMessageContentType=void 0,function(e){e[e.Unknown=0]="Unknown",e[e.TranslationSettings=1]="TranslationSettings",e[e.TwinCamSync=2]="TwinCamSync"}(t.DataMessageContentType||(t.DataMessageContentType={}))},95691:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ModalNavigatorPrefix=t.MainContentNavigatorPrefix=t.RightSidebarNavigatorPrefix=t.SplitViewDefaultWindowDimensions=t.NavigationSettingsItem=t.NavigationSettingsOrigin=t.ContactsPanelV2=t.WizardSteps=t.SharePreviewType=t.CompositeNavigationType=t.TriggerKeys=void 0,function(e){e[e.NavigationAndTabs=1]="NavigationAndTabs",e[e.HubTab=2]="HubTab",e[e.RejoinCallOperation=3]="RejoinCallOperation",e[e.ModalNavigation=4]="ModalNavigation",e[e.DesktopSidebar=5]="DesktopSidebar",e[e.ReactNavigation=6]="ReactNavigation"}(t.TriggerKeys||(t.TriggerKeys={})),function(e){e[e.Default=0]="Default",e[e.MainContent=1]="MainContent",e[e.LeftSidebar=2]="LeftSidebar",e[e.RightSidebar=3]="RightSidebar",e[e.Modal=4]="Modal"}(t.CompositeNavigationType||(t.CompositeNavigationType={})),function(e){e[e.Photo=0]="Photo",e[e.Video=1]="Video",e[e.MixedVideoAndPhoto=2]="MixedVideoAndPhoto",e[e.Text=3]="Text",e[e.File=4]="File",e[e.MultipleMessages=5]="MultipleMessages",e[e.SwiftCards=6]="SwiftCards",e[e.Location=7]="Location",e[e.Audio=8]="Audio",e[e.AudioMessage=9]="AudioMessage",e[e.Contact=10]="Contact"}(t.SharePreviewType||(t.SharePreviewType={})),function(e){e[e.setConvInfo=0]="setConvInfo",e[e.setConvParticipants=1]="setConvParticipants"}(t.WizardSteps||(t.WizardSteps={})),function(e){e[e.Skype=0]="Skype",e[e.All=1]="All"}(t.ContactsPanelV2||(t.ContactsPanelV2={})),function(e){e[e.ApplicationMenu=0]="ApplicationMenu",e[e.ApplicationSettings=1]="ApplicationSettings",e[e.DesktopOverflowMenu=2]="DesktopOverflowMenu",e[e.HelpAndFeedbackMenu=3]="HelpAndFeedbackMenu",e[e.MySettingsPanel=4]="MySettingsPanel",e[e.NotificationsPanel=5]="NotificationsPanel",e[e.LandingScreen=6]="LandingScreen",e[e.KeyboardShortcut=7]="KeyboardShortcut",e[e.WebFooter=8]="WebFooter"}(t.NavigationSettingsOrigin||(t.NavigationSettingsOrigin={})),function(e){e[e.BrowseKnownIssues=0]="BrowseKnownIssues",e[e.GetHelp=1]="GetHelp",e[e.GoToSupport=2]="GoToSupport",e[e.HelpAndFeedback=3]="HelpAndFeedback",e[e.RateUs=4]="RateUs",e[e.ReportAProblem=5]="ReportAProblem",e[e.SendFeedback=6]="SendFeedback",e[e.SkypeStatus=7]="SkypeStatus",e[e.UserVoice=8]="UserVoice",e[e.CheckAccount=9]="CheckAccount",e[e.AccountReadMore=10]="AccountReadMore"}(t.NavigationSettingsItem||(t.NavigationSettingsItem={})),t.SplitViewDefaultWindowDimensions={width:460,height:600,x:void 0,y:void 0},t.RightSidebarNavigatorPrefix="rightSidebar_",t.MainContentNavigatorPrefix="mainContent_",t.ModalNavigatorPrefix="modal_"},97223:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NotificationPeriodsCommands=t.MessageNotificationActionResult=t.MessageNotificationType=t.MessageNotificationNotifyReason=t.MessageNotificationAction=void 0,function(e){e[e.InterruptUser=0]="InterruptUser",e[e.InformUserExternal=1]="InformUserExternal",e[e.Ignore=2]="Ignore"}(t.MessageNotificationAction||(t.MessageNotificationAction={})),function(e){e[e.NotifySilent=0]="NotifySilent",e[e.AlwaysRing=1]="AlwaysRing",e[e.PreviousMessageIsOld=2]="PreviousMessageIsOld",e[e.ScheduledCall=3]="ScheduledCall"}(t.MessageNotificationNotifyReason||(t.MessageNotificationNotifyReason={})),function(e){e[e.Quote=0]="Quote",e[e.Mention=1]="Mention",e[e.RegularMessage=2]="RegularMessage",e[e.SystemAlert=3]="SystemAlert",e[e.Reaction=4]="Reaction",e[e.AddToConversation=5]="AddToConversation",e[e.ScheduledCall=6]="ScheduledCall"}(t.MessageNotificationType||(t.MessageNotificationType={}));t.MessageNotificationActionResult=class{},function(e){e.oneHourPeriod="oneHour",e.eightHoursPeriod="eightHours",e.oneDayPeriod="oneDay",e.oneWeekPeriod="oneWeek",e.indefinitelyPeriod="indefinitely"}(t.NotificationPeriodsCommands||(t.NotificationPeriodsCommands={}))},69156:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EmailMissedRemindersOptionValue=t.OptionServiceOptions=t.ProfileInformedUserOptionName=t.AvatarPolicyOptionName=t.SkypeGraphSearchPolicy=t.OptionsServiceAvatarPolicyValueType=t.CallingOptionValues=t.VoicemailOptionName=t.CallForwardingOptionName=t.UiColorOptionName=void 0,t.UiColorOptionName="ui.color",t.CallForwardingOptionName="calling.call-forwarding",t.VoicemailOptionName="calling.voice-mail",t.CallingOptionValues={Disabled:"disable",Enabled:"enabled"},function(e){e.BUDDIES_OR_AUTHORIZED_CAN_SEE="BUDDIES_OR_AUTHORIZED_CAN_SEE",e.OBSOLETE_BUDDIES_CAN_SEE="BUDDIES_OR_AUTHORIZED_CAN_SEE",e.EVERYONE_CAN_SEE="EVERYONE_CAN_SEE"}(t.OptionsServiceAvatarPolicyValueType||(t.OptionsServiceAvatarPolicyValueType={})),function(e){e.SEARCHABLE="SEARCHABLE",e.NOT_SEARCHABLE="NOT_SEARCHABLE",e.NOT_SEARCHABLE_RECOMMENDABLE="NOT_SEARCHABLE_RECOMMENDABLE",e.SEARCHABLE_NOT_RECOMMENDABLE="SEARCHABLE_NOT_RECOMMENDABLE",e.NOT_SEARCHABLE_NOT_RECOMMENDABLE="NOT_SEARCHABLE_NOT_RECOMMENDABLE"}(t.SkypeGraphSearchPolicy||(t.SkypeGraphSearchPolicy={})),t.AvatarPolicyOptionName="profile.show-avatar-policy",t.ProfileInformedUserOptionName="profile.informed-user",function(e){e.EmailMissedCallReminders="reminders.missed-call.email",e.EmailMissedMessageReminders="reminders.missed-message.email"}(t.OptionServiceOptions||(t.OptionServiceOptions={})),function(e){e.Enabled="ENABLED",e.Disabled="DISABLED"}(t.EmailMissedRemindersOptionValue||(t.EmailMissedRemindersOptionValue={}))},26424:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EmptyGifResult=t.DefaultDiverseTone=t.DiverseToneSeparator=t.DiverseToneSuffixes=t.ResultIconType=t.EmoticonType=t.EmoticonSize=t.PesCategoryButtonSpacer=t.GifPickerLayoutBreakpoint=t.GifDefaultCategory=t.GifSearchMaxResultsCount=t.GifSearchDebounceMs=t.GifMinSearchChars=t.PesCarouselGifSizeLandscape=t.PesCarouselGifSizePortrait=t.PesCarouselGifHorizontalMarginWidth=t.PesPickerDesktopWidth=t.MojiPreviewMetadataHeight=t.PesCategorySwitcherHeight=t.GifInlineSearchTotalHeight=t.MojiInlineSearchTotalHeight=void 0,t.MojiInlineSearchTotalHeight=135,t.GifInlineSearchTotalHeight=165,t.PesCategorySwitcherHeight=34,t.MojiPreviewMetadataHeight=54,t.PesPickerDesktopWidth=290,t.PesCarouselGifHorizontalMarginWidth=5,t.PesCarouselGifSizePortrait=100,t.PesCarouselGifSizeLandscape=50,t.GifMinSearchChars=2,t.GifSearchDebounceMs=500,t.GifSearchMaxResultsCount=100,t.GifDefaultCategory="Trending",t.GifPickerLayoutBreakpoint=700,t.PesCategoryButtonSpacer=1,function(e){e[e.Small=0]="Small",e[e.Medium=1]="Medium",e[e.Large=2]="Large",e[e.ExtraLarge=3]="ExtraLarge",e[e.ExtraExtraLarge=4]="ExtraExtraLarge"}(t.EmoticonSize||(t.EmoticonSize={})),function(e){e[e.Animated=0]="Animated",e[e.Static=1]="Static"}(t.EmoticonType||(t.EmoticonType={})),function(e){e[e.Final=0]="Final",e[e.Intermediate=1]="Intermediate"}(t.ResultIconType||(t.ResultIconType={})),t.DiverseToneSuffixes=[1,2,3,4,5,6],t.DiverseToneSeparator=":",t.DefaultDiverseTone=1,t.EmptyGifResult={gifItems:[],nextOffset:0}},80457:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PostingTrigger=t.PostUploadInfoKind=t.PostMessageInfoKind=void 0,t.PostMessageInfoKind="postMessage",t.PostUploadInfoKind="postUpload",function(e){e[e.None=1]="None",e[e.BackgroundTask=2]="BackgroundTask",e[e.Push=3]="Push"}(t.PostingTrigger||(t.PostingTrigger={}))},50488:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RichtextEditorExperience=t.FormatterTypes=void 0,function(e){e.Italic="_",e.Bold="*",e.StrikeThrough="~",e.Code="```",e.Link="</>"}(t.FormatterTypes||(t.FormatterTypes={})),function(e){e.Popup="popupExp",e.Panel="panelExp",e.None=""}(t.RichtextEditorExperience||(t.RichtextEditorExperience={}))},19524:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SkypeSmsErrorCategory=t.SkypeSmsDeliveryStatus=void 0,function(e){e[e.Success=6]="Success"}(t.SkypeSmsDeliveryStatus||(t.SkypeSmsDeliveryStatus={})),function(e){e[e.NoError=0]="NoError",e[e.NumberBlocked=104]="NumberBlocked"}(t.SkypeSmsErrorCategory||(t.SkypeSmsErrorCategory={}))},750:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CommandTypes=void 0,function(e){e[e.EditScheduledCall=0]="EditScheduledCall",e[e.Edit=1]="Edit",e[e.Copy=2]="Copy",e[e.CopyImage=3]="CopyImage",e[e.CopyLink=4]="CopyLink",e[e.CopyLocation=5]="CopyLocation",e[e.Quote=6]="Quote",e[e.QuoteSelection=7]="QuoteSelection",e[e.QuoteFromSwipe=8]="QuoteFromSwipe",e[e.Announce=9]="Announce",e[e.RemoveAnnouncement=10]="RemoveAnnouncement",e[e.SaveMedia=11]="SaveMedia",e[e.SaveAsFile=12]="SaveAsFile",e[e.SaveAsMedia=13]="SaveAsMedia",e[e.OpenFileLocation=14]="OpenFileLocation",e[e.OpenMediaLocation=15]="OpenMediaLocation",e[e.Forward=16]="Forward",e[e.Translate=17]="Translate",e[e.Bookmark=18]="Bookmark",e[e.AddReaction=19]="AddReaction",e[e.ViewInChat=20]="ViewInChat",e[e.SelectMessages=21]="SelectMessages",e[e.MarkReadToHere=22]="MarkReadToHere",e[e.CancelSend=23]="CancelSend",e[e.CancelEdit=24]="CancelEdit",e[e.CancelFailedSend=25]="CancelFailedSend",e[e.RetryFailedSend=26]="RetryFailedSend",e[e.ViewLink=27]="ViewLink",e[e.Remove=28]="Remove",e[e.Report=29]="Report",e[e.CancelScheduledCall=30]="CancelScheduledCall",e[e.ShowReported=31]="ShowReported",e[e.CancelPoll=32]="CancelPoll",e[e.DebugDumpMessage=33]="DebugDumpMessage",e[e.DebugDumpMessagePretty=34]="DebugDumpMessagePretty"}(t.CommandTypes||(t.CommandTypes={}))},2040:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ValidPresenceResourceRegExp=t.ValidSkypeIdRegExp=t.ValidMriRegExp=void 0,t.ValidMriRegExp=/^[0-9][0-9]?:[^<>\*\{\}&'\"\/\\?^`|~\s]+$/,t.ValidSkypeIdRegExp=/^[^<>\*\{\}&'\"\/\\?^`|~\s]+$/,t.ValidPresenceResourceRegExp=/^[a-zA-Z0-9_\-\.\+:,@=;]+$/},90239:(e,t)=>{var s,i,o;Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultConversationType=t.UserRingChangedManually=t.UserRing=t.PnhResourcesToTrack=t.PrimaryResourcesToTrack=t.MessagesStaleReason=t.BotPresence=t.UserAvailability=t.UserStatus=t.ThreadMemberRoles=t.EmptyReactionsUpdate=t.LongPollResult=t.SubscriptionState=void 0,function(e){e[e.Creating=0]="Creating",e[e.CreatedActive=1]="CreatedActive",e[e.CreatedLongPollTrouble=2]="CreatedLongPollTrouble",e[e.Deleting=3]="Deleting",e[e.None=4]="None"}(t.SubscriptionState||(t.SubscriptionState={})),function(e){e[e.Success=0]="Success",e[e.FailureErrorCode=1]="FailureErrorCode",e[e.FailureExternal=2]="FailureExternal"}(t.LongPollResult||(t.LongPollResult={})),t.EmptyReactionsUpdate={added:[],removed:[]},t.ThreadMemberRoles={Admin:"Admin",User:"User"},function(e){e[e.Offline=0]="Offline",e[e.Online=1]="Online",e[e.Busy=2]="Busy",e[e.Away=3]="Away",e[e.Idle=4]="Idle",e[e.OnThePhone=5]="OnThePhone",e[e.OutToLunch=6]="OutToLunch",e[e.BeRightBack=7]="BeRightBack",e[e.Hidden=8]="Hidden",e[e.Unknown=9]="Unknown"}(s=t.UserStatus||(t.UserStatus={})),function(e){e[e.Online=0]="Online",e[e.Offline=1]="Offline"}(i=t.UserAvailability||(t.UserAvailability={})),t.BotPresence={availability:i.Online,status:s.Online,mobile:!1,capabilities:["Seamless"],lastUpdated:1},function(e){e[e.NeedSync=0]="NeedSync",e[e.HistoryDisclosedChanged=1]="HistoryDisclosedChanged",e[e.ReceivedUnreconciledEdit=2]="ReceivedUnreconciledEdit",e[e.ConversationPossiblyUnread=3]="ConversationPossiblyUnread"}(t.MessagesStaleReason||(t.MessagesStaleReason={})),t.PrimaryResourcesToTrack=["/v1/users/ME/conversations/ALL/properties","/v1/users/ME/conversations/ALL/messages","/v1/threads/ALL"],t.PnhResourcesToTrack=["/v1/users/ME/conversations/ALL/messages","/v1/users/ME/conversations/ALL/properties?view=consumptionHorizon"],function(e){e[e.PROD=0]="PROD",e[e.DailyDF=1]="DailyDF",e[e.MasterDF=2]="MasterDF"}(t.UserRing||(t.UserRing={})),t.UserRingChangedManually="true2",function(e){e[e.None=0]="None",e[e.Passport=1]="Passport",e[e.Lync=2]="Lync",e[e.Skype=4]="Skype",e[e.Room=8]="Room",e[e.Thread=16]="Thread",e[e.ShortCircuit=32]="ShortCircuit",e[e.PSTN=64]="PSTN",e[e.Facebook=128]="Facebook",e[e.GTalk=256]="GTalk",e[e.Flxt=512]="Flxt",e[e.SmsMms=1024]="SmsMms",e[e.Agent=2048]="Agent",e[e.NotificationStream=4096]="NotificationStream",e[e.Cast=8192]="Cast",e[e.InviteFree=16384]="InviteFree",e[e.Highlights=32768]="Highlights",e[e.ModernBots=131072]="ModernBots",e[e.OneToOneThreads=262144]="OneToOneThreads",e[e.SecureThreads=524288]="SecureThreads",e[e.PhoneThreads=1048576]="PhoneThreads",e[e.Default=1023]="Default",e[e.All=2047]="All"}(o||(o={})),t.DefaultConversationType=o.All},61375:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InvokeAgentSource=t.AddNewContactSource=t.DeleteConversationSource=t.RemoveMemberFromThreadSource=t.AddMemberToThreadSource=t.CreateThreadSource=t.PostMessageToConversationSource=void 0,function(e){e[e.UserComposingState=0]="UserComposingState",e[e.MessagePost=1]="MessagePost"}(t.PostMessageToConversationSource||(t.PostMessageToConversationSource={})),function(e){e[e.CreateNewConversation=0]="CreateNewConversation",e[e.EscalateOneOnOneToGroupCall=1]="EscalateOneOnOneToGroupCall",e[e.ReactionThread=2]="ReactionThread",e[e.StartNewGroupCall=3]="StartNewGroupCall",e[e.CreateAadConversation=4]="CreateAadConversation"}(t.CreateThreadSource||(t.CreateThreadSource={})),function(e){e[e.AddUserToGroupCall=0]="AddUserToGroupCall",e[e.AddUserToGroupCallDragAndDrop=1]="AddUserToGroupCallDragAndDrop",e[e.InviteUsersWorkflowStore=2]="InviteUsersWorkflowStore",e[e.JoiningConversation=3]="JoiningConversation",e[e.SetRoleCommand=4]="SetRoleCommand",e[e.SwiftCard=5]="SwiftCard"}(t.AddMemberToThreadSource||(t.AddMemberToThreadSource={})),function(e){e[e.ConversationListItem=0]="ConversationListItem",e[e.GroupChatSettings=1]="GroupChatSettings",e[e.GroupProfile=2]="GroupProfile",e[e.KickCommand=3]="KickCommand",e[e.LeaveCommand=4]="LeaveCommand",e[e.SkypeUserListItem=5]="SkypeUserListItem",e[e.LobbyButton=6]="LobbyButton"}(t.RemoveMemberFromThreadSource||(t.RemoveMemberFromThreadSource={})),function(e){e[e.BotChatSettingsPanel=0]="BotChatSettingsPanel",e[e.ConversationListItem=1]="ConversationListItem",e[e.UserChatSettingsPanel=2]="UserChatSettingsPanel",e[e.TabSwitcher=3]="TabSwitcher",e[e.CellularRelayAgent=4]="CellularRelayAgent"}(t.DeleteConversationSource||(t.DeleteConversationSource={})),function(e){e[e.AcceptContactInvite=0]="AcceptContactInvite",e[e.AddContact=1]="AddContact"}(t.AddNewContactSource||(t.AddNewContactSource={})),function(e){e[e.SwiftQuickReply=0]="SwiftQuickReply",e[e.PermanentMenuRequest=1]="PermanentMenuRequest"}(t.InvokeAgentSource||(t.InvokeAgentSource={}))},28575:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.DeviceType=t.Activity=t.Availability=void 0,function(e){e[e.PresenceUnknown=0]="PresenceUnknown",e[e.Available=1]="Available",e[e.AvailableIdle=2]="AvailableIdle",e[e.Busy=3]="Busy",e[e.BusyIdle=4]="BusyIdle",e[e.DoNotDisturb=5]="DoNotDisturb",e[e.BeRightBack=6]="BeRightBack",e[e.Away=7]="Away",e[e.Offline=8]="Offline"}(t.Availability||(t.Availability={})),function(e){e[e.PresenceUnknown=0]="PresenceUnknown",e[e.InAConferenceCall=1]="InAConferenceCall",e[e.InACall=2]="InACall",e[e.Presenting=3]="Presenting",e[e.OffWork=4]="OffWork",e[e.InAMeeting=5]="InAMeeting",e[e.OutOfOffice=6]="OutOfOffice",e[e.Available=7]="Available",e[e.Inactive=8]="Inactive",e[e.Busy=9]="Busy",e[e.DoNotDisturb=10]="DoNotDisturb",e[e.BeRightBack=11]="BeRightBack",e[e.Away=12]="Away",e[e.Offline=13]="Offline",e[e.UrgentInterruptionsOnly=14]="UrgentInterruptionsOnly"}(t.Activity||(t.Activity={})),function(e){e[e.Desktop=0]="Desktop",e[e.Web=1]="Web",e[e.Mobile=2]="Mobile"}(t.DeviceType||(t.DeviceType={})),function(e){e[e.OK=2e4]="OK",e[e.Pending=20200]="Pending",e[e.Forbidden=40300]="Forbidden",e[e.NotFound=40400]="NotFound",e[e.UserNotFound=40401]="UserNotFound",e[e.NoData=40402]="NoData",e[e.Failed=5e4]="Failed",e[e.RegionFailed=50001]="RegionFailed",e[e.NotImplemented=50100]="NotImplemented"}(s||(s={}))},79662:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.contextTagName=void 0,t.contextTagName="context"},70891:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.PipContentType=t.SwiftMediaProfiles=t.SwiftAspectRatios=t.SwiftSuggestionProviders=t.SwiftSuggestionTypes=t.SwiftInvokeActionIntents=t.SwiftActionTypes=t.SwiftContentTypes=t.SwiftMessageTypes=t.multiTargetsTagName=t.targetTagName=t.rootTagName=t.MessageRenderOrigin=t.MojiMetadataAlign=t.MojiSize=t.ProcessingDefaults=t.MediaProvider=t.MessageAccessibilityType=t.ProcessingLevel=void 0,function(e){e[e.None=0]="None",e[e.Full=1]="Full",e[e.Stripped=2]="Stripped"}(s=t.ProcessingLevel||(t.ProcessingLevel={})),function(e){e[e.Text=0]="Text",e[e.Media=1]="Media",e[e.Url=2]="Url",e[e.Call=3]="Call"}(t.MessageAccessibilityType||(t.MessageAccessibilityType={})),t.MediaProvider={AMS:"AMS",AzureMS:"AzureMS",FileCache:"FileCache",Preview:"Preview",Capture:"Capture",Moji:"Moji"},t.ProcessingDefaults={All:{emoticons:s.Full,quotes:s.Full,wikiMarkup:s.Full,links:s.Full,atMentions:s.Full},Stripped:{emoticons:s.Stripped,quotes:s.Stripped,wikiMarkup:s.Stripped,links:s.Stripped,atMentions:s.Stripped},Preview:{emoticons:s.Full,quotes:s.None,wikiMarkup:s.Stripped,links:s.Stripped,atMentions:s.Stripped}},function(e){e[e.Small=0]="Small",e[e.MediumSmall=1]="MediumSmall",e[e.Medium=2]="Medium",e[e.Large=3]="Large",e[e.ExtraLarge=4]="ExtraLarge"}(t.MojiSize||(t.MojiSize={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Bottom=2]="Bottom"}(t.MojiMetadataAlign||(t.MojiMetadataAlign={})),function(e){e[e.ChatCanvas=0]="ChatCanvas",e[e.StackGalleryCanvas=1]="StackGalleryCanvas",e[e.CompositeGalleryCanvas=2]="CompositeGalleryCanvas",e[e.CallCanvas=3]="CallCanvas",e[e.ForwardCanvas=4]="ForwardCanvas",e[e.MessageComposerCanvas=5]="MessageComposerCanvas"}(t.MessageRenderOrigin||(t.MessageRenderOrigin={})),t.rootTagName="_root",t.targetTagName="target",t.multiTargetsTagName="targets",t.SwiftMessageTypes={card:"message/card",carousel:"message/card.carousel",signin:"message/card.signin",receipt:"message/card.receipt"},t.SwiftContentTypes={hero:"application/vnd.microsoft.card.hero",flex:"application/vnd.microsoft.card.flex",thumbnail:"application/vnd.microsoft.card.thumbnail",animation:"application/vnd.microsoft.card.animation",audio:"application/vnd.microsoft.card.audio",video:"application/vnd.microsoft.card.video",signin:"application/vnd.microsoft.card.signin",receipt:"application/vnd.microsoft.card.receipt",unsupported:"application/vnd.microsoft.card.unsupported"},t.SwiftActionTypes={openUrl:"openUrl",imBack:"imBack",call:"call",signin:"signin",showImage:"showImage",showVideo:"showVideo",learnMore:"learnMore",invoke:"invoke",openView:"openView",reportAProblem:"reportAProblem",playGif:"playGif"},t.SwiftInvokeActionIntents={luSuggestionDisplay:"lu_suggestion_display",cardsDisplay:"card_display",reminderStartFlow:"reminder_start_flow",reminderSet:"reminder_set",startOptIn:"start_opt_in",calendarSchedule:"calendar_schedule_reply",calendarAvailability:"calendar_availability_reply",instrumentation:"instrumentation"},t.SwiftSuggestionTypes={Default:"Default",Static:"Static"},t.SwiftSuggestionProviders={Dorado:"dorado",Skype:"skype"},t.SwiftAspectRatios={landscape:"16:9",portrait:"9:16",square:"1:1"},t.SwiftMediaProfiles={animation:"animation",audio:"audio",sd:"sd",hd:"hd",video:"video"},function(e){e[e.Youtube=0]="Youtube"}(t.PipContentType||(t.PipContentType={}))},88110:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(96074),n=s(90631),r=s(15877),a=s(33754),l=s(97634),d=s(28805),c=s(92758),h=s(39549),u=s(4735),p=(0,r.lazyProperties)({panel:()=>i.Styles.createViewStyle({alignSelf:"stretch",flex:1})});class g extends o.BaseNavigationView{constructor(){super(...arguments),this._onCloseButtonPressed=e=>{e.stopPropagation(),this._close()}}_buildState(){return{archivedConversationsCount:(0,h.default)().getSortedArchivedConversations().length}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.archivedConversationsCount<1&&this._close()}_close(){this._isPresentedInTabletLeftNav()?c.default.setConversationsListMode(c.ConversationsListMode.AllConversations):u.default.navigateToRecentsTab()}render(){const e={closeButtonType:this._isPresentedInTabletLeftNav()?n.CloseButtonType.Back:n.CloseButtonType.Close,onPress:this._onCloseButtonPressed},{primaryBackgroundColorStyle:t}=l.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride);return i.createElement(i.View,{style:[p.panel,t]},i.createElement(n.SimplePanelHeader,{panelName:a.getString("ArchivedConversationsPanel.Title"),leftButton:e}),i.createElement(d.default,{useMobileView:!0,hideSearchBar:!0,isScrollToTopTarget:!0,viewType:c.ConversationsListMode.ArchivedConversations}))}}t.default=g},92076:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96074),o=s(65159);t.default=(0,i.forNavigation)(o.default)},87962:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96074),o=s(23303);t.default=(0,i.forNavigation)(o.default)},34635:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(96074),n=s(69198);t.default=(0,o.forNavigation)((e=>{const{height:t,width:s}=e;return i.createElement(n.default,Object.assign({},e,{mediaHeight:t,mediaWidth:s}))}))},34037:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96074),o=s(56397);t.default=(0,i.forNavigation)(o.default)},60180:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(31844),n=s(16778),r=s(19784),a=s(89391),l=s(67930),d=s(81169),c=s(71830),h=s(80128),u=s(3056),p=s(98278),g=s(39549),m=s(52262),S=s(46096),f=s(90070),y=s(36237),_=s(72707),v=s(46240),C=s(15877),b=s(65752),T=s(33754),M=s(18078),I=s(4735),w=s(30124),P=s(95691),k=s(48199),A=s(9341),E=s(28433),R=s(29130),L=s(51070),F=s(81115),x=s(36150),O=s(4101),D=s(70919),B=s(10541),V=s(32514),N=s(38931),U=s(24067),H=s(90631),z=s(6262),W=s(16392),j=s(80837),G=s(72758),K=s(53374),q=s(91066),Q=s(66127),X=s(97634),$=(0,C.lazyProperties)({panel:()=>n.Styles.createViewStyle({position:"absolute",left:0,top:0,right:0,bottom:0,alignSelf:"stretch"}),contentContainerInner:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",flexDirection:"column"}),participantsInputFrame:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch",justifyContent:"center",flexDirection:"row"}),participantsInputContainer:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch",flexDirection:"column"}),suggestionsContainer:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch",flexDirection:"row",justifyContent:"center"}),headerShadow:()=>n.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,height:1}),searchBoxContainerCompositeNav:()=>n.Styles.createViewStyle({alignSelf:"stretch",alignItems:"stretch",justifyContent:"center",flexDirection:"row",height:D.SearchInputHeight.default,paddingLeft:15,paddingVertical:10,flex:1})});class J extends l.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._isScrolledToTop=!0,this._shadowOpacityValue=new n.Animated.Value(0),this._shadowOpacityStyle=n.Styles.createAnimatedViewStyle({opacity:this._shadowOpacityValue}),this._resetTransitionTransformValue=new n.Animated.Value(0),this._resetTransitionOpacityValue=new n.Animated.Value(1),this._resetSearchTransitionStyle=n.Styles.createAnimatedViewStyle({opacity:this._resetTransitionOpacityValue,transform:[{translateY:this._resetTransitionTransformValue}]}),this._onInputChanged=e=>{this.isComponentMounted()&&this.setState({inputText:e})},this._goBack=e=>{var t;y.log(S.LogTraceArea.Navigation,"SetConversationParticipantsPanel._goBack, causeId: "+e);const s=this._getInvitedUserMris();return null===(t=this.props.route.params.navigator.context.newGroupTelemetryScenario)||void 0===t||t.setParticipantCount(s.length),this.props.route.params.navigator.extendContext({invitedUsersMris:s}),this.props.route.params.navigator.goBack(),!0},this._onShareLinkToggleChange=e=>{this.setState({shareLink:e})},this._onInviteSuggestionsListRef=e=>{this._inviteSuggestionsListRef=e||void 0},this._onProfileSelectionInputRef=e=>{this._profileSelectionInputRef=e||void 0},this._renderSuperComposerHeader=(e,t)=>{const s=e?F.default.horizontalPaddingStyle(e):void 0;let i=n.createElement(O.default,{key:"search",buttonOnly:!0,horizontalButtonPadding:0,placeholderText:this.state.modernizeMobileTabHeader?T.getString("SearchInputControl.PlaceHolderTextShort"):T.getString("ConversationsListPanel.SearchPeopleGroupsMessagesButtonTitle"),accessibilityLabel:this.state.isMobileScreenReaderEnabled?T.getString("HubHeaderPanel.SearchHubAccessibilityLabel"):void 0,useIOSStyles:!this.state.modernizeMobileTabHeader&&this.state.useIOSSearchStyles,safeAreaPaddingStyle:s,showSearchIcon:this._getContext().isPresentedInGenericDesktopModal,onPress:this._handleSuperComposerSearchButtonClick});if(this._getContext().isPresentedInDesktopSubview){const{searchBoxColorStyle:e}=X.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride);i=n.createElement(n.View,{style:[$.searchBoxContainerCompositeNav,e]},i)}if(e&&t){const t=n.Styles.createViewStyle({marginLeft:-1*e.left,marginRight:-1*e.right},!1);i=n.createElement(n.View,{style:t},i)}const o=n.Styles.createViewStyle({height:A.default.calculateHeight(this._newChatMenuCommands.length)},!1);return n.createElement(n.View,{style:[j.default.overflowVisible]},i,n.createElement(n.View,{style:o},n.createElement(A.default,{commands:this._newChatMenuCommands})))},this._handleSuperComposerSearchButtonClick=()=>{const e=K.default.newCauseId();y.log(S.LogTraceArea.Navigation,"SetConversationParticipantsPanel._handleSuperComposerSearchButtonClick, causeId: "+e),this._getContext().isPresentedInDesktopSubview?I.default.navigateToSearchInModal({searchOrigin:S.SearchPanelInitiator.SuperComposer,modalTitle:this._getHeaderText(this.state)},e,this._getContext()):I.default.navigateToSearch({searchOrigin:S.SearchPanelInitiator.SuperComposer},e)},this._onContentWrapperRef=e=>{this._wrappedContentTransitionView=e||void 0},this._getHeader=()=>n.createElement(H.SimplePanelHeader,{panelName:this._getHeaderText(this.state),leftButton:this._getHeaderLeftButton(),hideBottomBorder:!0,delayHeaderFocus:!1}),this._getHeaderRightButton=()=>{if(!this.props.route.params.navigator.context.creating1on1Conversation){return{text:(0,i.last)(this.props.route.params.navigator.context.wizardSteps)===P.WizardSteps.setConvParticipants?T.getString("SetConversationParticipantsPanel.DoneButtonLabel"):T.getString("Global.NextButtonTitle"),disabled:this.props.route.params.navigator.context.convId&&this.state.numberOfInvitees<1,onPress:this._handleNextButtonClick}}},this._onScroll=(e,t)=>{const s=e<=0;this._isScrolledToTop!==s&&(this._shadowOpacityValue.setValue(s?0:1),this._isScrolledToTop=s)},this._onProfileRemoved=()=>{this._inviteSuggestionsListRef?this._inviteSuggestionsListRef.focusFirst():this._profileSelectionInputRef&&this._profileSelectionInputRef.requestFocus()},this._handleBackButtonClick=()=>{const e=K.default.newCauseId();y.log(S.LogTraceArea.Navigation,"SetConversationParticipantsPanel._handleBackButtonClick,  causeId: "+e),this._goBack(e)},this._handleNextButtonClick=()=>{if(!this.state.navButtonsDisabled)if(this.state.panelSearchType===S.SearchResultsListOrigin.NewCellularSmsConversation)this._getInvitedUsersPhoneNumbersAsMris().then((e=>{this._completeNextButtonClick(e)}));else{const e=this._getInvitedUserMris();this._completeNextButtonClick(e)}},this._headerHeight=()=>(this.state.deviceOrientation!==o.DeviceOrientation.Landscape?this.state.isSmallDevice?H.HeaderHeightSmall:H.HeaderHeight:this.state.isSmallDevice?H.HeaderHeightLandscapeSmall:H.HeaderHeightLandscape)+this.state.statusBarPadding}_buildState(e,t){var s;const i=e.route.params.navigator.context.convId&&(0,g.default)().getConversation(e.route.params.navigator.context.convId),o=w.default.isUsingStackNavigationContext(),n=this._getPanelSearchType(),r=this._getRootViewId(),l={statusBarPadding:this._getContext().isPresentedInDesktopSubview?0:L.default.statusBarPadding(),deviceOrientation:R.default.getDeviceOrientation(r),isSmallDevice:R.default.isSmallDevice(r),contentSizeMultiplier:Math.min(R.default.getContentSizeMultiplier(),p.MaxContentSizeMultiplier),excludeGroups:!0,excludeEncrypted:n===S.SearchResultsListOrigin.NewPrivateChat||n===S.SearchResultsListOrigin.NewCellularSmsConversation,excludeS4B:n===S.SearchResultsListOrigin.NewGroup||n===S.SearchResultsListOrigin.AddingParticipantsToGroup||n===S.SearchResultsListOrigin.NewPrivateChat,useIOSSearchStyles:!this._getContext().isPresentedInDesktopSubview&&h.default.useIOSSearchStyles(),panelSearchType:n,isUsingStackNavigationContext:o,isModeratedThread:!!i&&i.isModerated(),isMobileScreenReaderEnabled:x.default.isMobileScreenReaderEnabled(),enableNewConversationCreation:a.default.getS4LMessagingFeatures().enableNewConversationCreation,modernizeMobileTabHeader:Q.default.canModernizeMobileTabHeader()};return t&&(this._inviteFlowController=new v.default,l.showLoadingMessage=!1,l.inputText="",l.shareLink=!1,this._searchController=new V.default,null===(s=e.route.params.navigator.context.newGroupTelemetryScenario)||void 0===s||s.setVisitedParticipantPicker(),this._newChatMenuCommands=[f.HubCommands.NewMeetNowCommand,f.HubCommands.AddConversationGroupCommand,f.HubCommands.NewGroupCallCommand,...e.route.params.navigator.context.showModeratedGroupOption?[f.HubCommands.AddConversationModeratedGroupCommand]:[],f.HubCommands.AddConversationPrivateCommand,...z.default.isPaidUser()&&a.default.getS4LMessagingFeatures().useSmsThreadsFor2way?[f.HubCommands.NewCellularSmsConversationCommand]:[],...a.default.getS4LCaapFeatures().botDiscoveryEnabled?[f.HubCommands.AddBotCommand]:[]]),l.invitingState=this._inviteFlowController.getState(),l.numberOfInvitees=this._inviteFlowController.getSelectedProfiles().length,l}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this._headerConfig={getHeader:this._getHeader,getHeaderHeight:this._headerHeight},this.props.route.params.isSuperComposer&&(this._transitionSubscriptionToken=k.default.transitionInfoEvent().subscribe((e=>{if(k.default.isSearchTransition()&&e.toRoute&&e.fromRoute&&e.progress){const t=e.toRoute.type===k.RouteType.Search?e.fromRoute.index:e.toRoute.index;void 0!==t?this._setAnimatedValues(e.progress,t):this._clearAnimatedValues()}else this._clearAnimatedValues()})))}componentWillUnmount(){var e,t;super.componentWillUnmount(),null===(e=this._searchController)||void 0===e||e.destroy(),null===(t=this._transitionSubscriptionToken)||void 0===t||t.unsubscribe()}componentDidMount(){var e;super.componentDidMount(),null===(e=this.props.route.params.navigator.context.invitedUsersMris)||void 0===e||e.forEach((e=>{const t=m.default.getDisplayableProfile(e);t&&this._inviteFlowController.addProfile(t)}))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),[v.InvitingUsersState.FinishedSuccess,v.InvitingUsersState.FinishedFail].indexOf(this.state.invitingState)>=0&&(this.props.route.params.navigator.goNext(),this.state.invitingState===v.InvitingUsersState.FinishedFail&&r.default.showErrorAlert(T.getString("InviteUsersWorkflowStore.CannotAddUser"),p.MainRootViewId)),this._inviteFlowController.getSelectedProfiles().length>0&&this.props.route.params.navigator&&this.props.route.params.navigator.context.creating1on1Conversation&&this._handleNextButtonClick()}render(){const{primaryBackgroundColorStyle:e}=X.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride),t=[$.panel,e];let s;if(this.state.showLoadingMessage){const e=this.props.route.params.navigator.context.convId?T.getString("SetConversationParticipantsPanel.AddingContactsToConversation"):T.getString("SetConversationParticipantsPanel.CreatingNewConversation");s=n.createElement(b.default,{message:e})}else s=this._getContentForSelectingPeople();return n.createElement(u.default,{goBack:this._goBack},n.createElement(q.default,{ref:this._onContentWrapperRef,style:t},s))}_getPanelSearchType(){return a.default.getS4LMessagingFeatures().enableNewConversationCreation&&this.props.route.params.navigator.context.navigationOrigin===S.NavigationConversationOrigin.Recents?S.SearchResultsListOrigin.NewChat:this.props.route.params.navigator.context.useSuperComposerFor1on1Conversation?S.SearchResultsListOrigin.SuperComposer:this.props.route.params.navigator.context.createCellularSmsConversation?S.SearchResultsListOrigin.NewCellularSmsConversation:this.props.route.params.navigator.context.creating1on1Conversation?this.props.route.params.navigator.context.navigationOrigin===S.NavigationConversationOrigin.NewPrivateChat?S.SearchResultsListOrigin.NewPrivateChat:S.SearchResultsListOrigin.NewChat:this.props.route.params.navigator.context.peopleType===B.PeopleType.Bots?S.SearchResultsListOrigin.FindBots:this.props.route.params.navigator.context.convId||this.props.route.params.navigator.context.navigationOrigin!==S.NavigationConversationOrigin.NewGroup&&this.props.route.params.navigator.context.navigationOrigin!==S.NavigationConversationOrigin.UserProfileNewGroupWithUser&&this.props.route.params.navigator.context.navigationOrigin!==S.NavigationConversationOrigin.KeyboardShortcutNewGroupWithUser?S.SearchResultsListOrigin.AddingParticipantsToGroup:S.SearchResultsListOrigin.NewGroup}_componentId(){return"SetConversationParticipantsPanel"}_getContentForSelectingPeople(){this._getContext().isPresentedInDesktopSubview;const e=n.createElement(_.default,{ref:this._onInviteSuggestionsListRef,conversationId:this.props.route.params.navigator.context.convId,inviteFlowController:this._inviteFlowController,searchController:this._searchController,peopleType:this.props.route.params.navigator.context.peopleType,filterPeopleType:this.props.route.params.navigator.context.filterPeopleType,excludeGroups:this.state.excludeGroups,excludeEncrypted:this.state.excludeEncrypted,excludeS4B:this.state.excludeS4B,isSingleContactSelect:!!this.props.route.params.navigator.context.isSingleContactSelect,navigationOrigin:this.props.route.params.navigator.context.navigationOrigin,parentPanelOrigin:this.state.panelSearchType,headerViewConfig:this._optionalSuperComposerHeaderConfig(),inputText:this.state.inputText,suppressPseudoFocus:!0,onScroll:this.props.route.params.isSuperComposer?this._onScroll:void 0}),t=[$.contentContainerInner],s=[$.suggestionsContainer],i=[$.participantsInputContainer],o=this.props.route.params.isSuperComposer?void 0:n.createElement(E.default,{key:"peopleInput",ref:this._onProfileSelectionInputRef,selectorController:this._inviteFlowController,searchController:this._searchController,headerConfig:this._headerConfig,allowSubmitWithNoProfile:!0,peopleType:this.props.route.params.navigator.context.peopleType,autoFocusOnInput:!n.UserInterface.isNavigatingWithKeyboard(),autoFocusWhenActive:!0,useCollapsableHeader:!1,inputText:this.state.inputText,onInputChanged:this._onInputChanged,onCancel:this._handleBackButtonClick,onProfileRemoved:this._onProfileRemoved}),r=this.props.route.params.navigator.context.navigationOrigin===S.NavigationConversationOrigin.Recents&&this.state.enableNewConversationCreation?n.createElement(N.default,{shareLink:this.state.shareLink,onChange:this._onShareLinkToggleChange}):void 0,a=this.props.route.params.isSuperComposer?this._getHeader():void 0,l=this._getFooter(),{headerShadowColorStyle:d}=X.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride),c=a?n.createElement(n.Animated.View,{style:[$.headerShadow,d,this._shadowOpacityStyle]}):void 0;return n.createElement(n.View,{style:j.default.flexOne},n.createElement(n.View,{style:t},n.createElement(n.View,{style:$.participantsInputFrame},n.createElement(n.View,{style:i},o,a,n.createElement(n.View,{style:s},e,c),r,l))))}_optionalSuperComposerHeaderConfig(){if(this.props.route.params.isSuperComposer)return{renderItem:this._renderSuperComposerHeader,isNavigable:!0,isHoverable:!1,height:A.default.calculateHeight(this._newChatMenuCommands.length)}}_getHeaderText(e){let t="";switch(e.panelSearchType){case S.SearchResultsListOrigin.NewChat:case S.SearchResultsListOrigin.SuperComposer:t=T.getString("SetConversationParticipantsPanel.NewChatTitle");break;case S.SearchResultsListOrigin.NewPrivateChat:t=T.getString("SetConversationParticipantsPanel.NewPrivateChatTitle");break;case S.SearchResultsListOrigin.FindBots:t=T.getString("SetConversationParticipantsPanel.FindBotTitle");break;case S.SearchResultsListOrigin.NewGroup:t=T.getString("SetConversationParticipantsPanel.CreateNewGroupTitle");break;case S.SearchResultsListOrigin.AddingParticipantsToGroup:t=T.getString("SetConversationParticipantsPanel.AddPeopleTitle");break;case S.SearchResultsListOrigin.NewCellularSmsConversation:t=T.getString("SetConversationParticipantsPanel.CreateNewCellularSmsConversation");break;default:K.default.switchStatementExhaustiveChecking(e.panelSearchType)}return t}_getFooter(){const e=this._getHeaderRightButton();if(e)return n.createElement(U.default,{button:e})}_getHeaderLeftButton(){var e;const t=(null===(e=this.props.route.params.navigator.context.wizardSteps)||void 0===e?void 0:e[0])===P.WizardSteps.setConvParticipants;let s=H.CloseButtonType.Back;return(this.props.route.params.navigationDirection===W.StackNavigationDirection.Present||this.props.route.params.navigator.context.creating1on1Conversation||!this.state.isUsingStackNavigationContext&&t)&&(s=H.CloseButtonType.Close),{closeButtonType:s,onPress:this._handleBackButtonClick}}_getInvitedUserMris(){const e=this._inviteFlowController.getSelectedProfiles(),t=(0,d.chain)(e,(0,d.map)((e=>e.getMri())),(0,d.filter)((e=>!!e&&!M.default.isMyMri(e))));return(0,i.compact)(t)}_getInvitedUsersPhoneNumbersAsMris(){const e=this._inviteFlowController.getSelectedProfiles(),t=[],s=[];return e.forEach((e=>{const i=e.getMri();i&&(c.isPhoneMri(i)||c.getMriNamespace(i)===c.Namespaces.OneToOneTextMessage?t.push(i):s.push(i))})),G.default.getFullUserProfileByMrisAsync(s).then((e=>(e.forEach((e=>{if(e&&e.phones&&e.phones.length>0){let s=c.idAndNamespaceToMri(e.phones[0].number.toString(),c.Namespaces.PSTN);t.push(s)}})),t)))}_completeNextButtonClick(e){var t,s,o;if(null===(t=this.props.route.params.navigator.context.newGroupTelemetryScenario)||void 0===t||t.setParticipantCount(e.length),null===(o=(s=this.props.route.params.navigator.context).onParticipantsAdded)||void 0===o||o.call(s,e.length),this.state.panelSearchType===S.SearchResultsListOrigin.NewCellularSmsConversation&&0===e.length)return;this.props.route.params.navigator.extendContext({invitedUsersMris:e});(0,i.last)(this.props.route.params.navigator.context.wizardSteps)===P.WizardSteps.setConvParticipants&&this.setState({showLoadingMessage:!0,navButtonsDisabled:!0}),this.props.route.params.navigator.context.convId?this._inviteFlowController.sendConversationInvitation(this.props.route.params.navigator.context.convId,!this.state.isModeratedThread||!!this.props.route.params.navigator.context.addAsAdmininModeratedGroup):(this.props.route.params.navigator.context.shareLink=this.state.shareLink,this.props.route.params.navigator.goNext())}_setAnimatedValues(e,t){if(this._wrappedContentTransitionView){const s=n.Styles.createAnimatedViewStyle({opacity:e.interpolate({inputRange:[t-1,t,t+.5,t+1],outputRange:[1,1,0,0]}),transform:[{translateY:e.interpolate({inputRange:[t-1,t,t+1],outputRange:[0,0,-100]})}]});this._wrappedContentTransitionView.setAnimatedStyle(s)}}_clearAnimatedValues(){this._wrappedContentTransitionView&&this._wrappedContentTransitionView.setAnimatedStyle(this._resetSearchTransitionStyle)}}t.default=J},86766:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(96486),n=s(4736),r=s(75672),a=s(67930),l=s(26651),d=s(10102),c=s(3056),h=s(98278),u=s(85455),p=s(37490),g=s(46096),m=s(36237),S=s(10400),f=s(47126),y=s(15877),_=s(65752),v=s(33754),C=s(89808),b=s(30124),T=s(95691),M=s(16819),I=s(29130),w=s(51070),P=s(81115),k=s(86045),A=s(90631),E=s(16392),R=s(81760),L=s(11010),F=s(11828),x=s(34528),O=s(53374),D=s(97634),B=(0,y.lazyProperties)({panel:()=>i.Styles.createViewStyle({position:"absolute",left:0,top:0,right:0,bottom:0,alignSelf:"stretch"}),panelContent:()=>i.Styles.createViewStyle({flex:1,alignSelf:"stretch",justifyContent:"center",flexDirection:"row"}),contentContainer:()=>i.Styles.createViewStyle({flex:1,flexDirection:"column",alignItems:"center"}),avatarPicker:()=>i.Styles.createButtonStyle({marginTop:20,alignSelf:"center"}),conversationNameInputContainer:()=>i.Styles.createViewStyle({backgroundColor:R.Color.transparent,borderBottomWidth:1,alignSelf:"stretch",borderStyle:"solid",marginHorizontal:40,marginTop:20}),conversationNameInputIOS:()=>i.Styles.createTextInputStyle({height:40}),conversationNameInput:()=>i.Styles.createTextInputStyle({alignSelf:"stretch",padding:0,backgroundColor:R.Color.transparent,textAlign:"center"}),nextButton:()=>i.Styles.createViewStyle({position:"absolute",bottom:10,right:10}),hiddenHeader:()=>i.Styles.createViewStyle({opacity:0})});class V extends a.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._goBack=e=>(m.log(g.LogTraceArea.Navigation,"SetConversationInfoPanel._goBack, causeId: "+e),this.props.route.params.navigator.goBack(),!0),this._onAvatarSelected=(e,t)=>{var s;this._conversationImage=e,this._conversationImageUrl=t,null===(s=this.props.route.params.navigator.context.newGroupTelemetryScenario)||void 0===s||s.setAvatarSelection(!!e)},this._onAvatarRemoved=()=>{var e;this._conversationImage=void 0,null===(e=this.props.route.params.navigator.context.newGroupTelemetryScenario)||void 0===e||e.setAvatarSelection(!1)},this._onBackButtonClick=e=>{e.stopPropagation();const t=O.default.newCauseId();m.log(g.LogTraceArea.Navigation,"SetConversationInfoPanel._onBackButtonClick, causeId: "+t),this._goBack(t)},this._onConversationNameChanged=e=>{this.isComponentMounted()&&this.setState({conversationName:e})},this._onNextButtonClick=e=>{e.stopPropagation(),this._handleNext()},this._onKeyPress=e=>{e.keyCode!==f.default.ENTER&&e.keyCode!==f.default.RETURN||(e.stopPropagation(),this._handleNext())},this._onBeforeOpeningCameraOrPicker=()=>{p.dismissAll()},this._onTextInputRef=e=>{this._textInput=e||void 0}}static getHeaderText(e){return e?v.getString("Hub.NewModeratedGroupChatShortLabel"):v.getString("SetConversationInfoPanel.Title")}_buildState(e,t){var s;const i=this._getRootViewId(),o={isUsingStackNavigationContext:b.default.isUsingStackNavigationContext(),safeAreaHorizontalInsets:w.default.horizontalInsets(h.HorizontalInsetDefault),safeAreaBottomInset:w.default.bottomSafeAreaInset(),bigAvatarHelper:new l.default(i),isSmallDevice:I.default.isSmallDevice(i)};return t&&(o.conversationColor=C.default.getColorInfo(),o.conversationName=e.route.params.navigator.context.convName||"",this._conversationImage=e.route.params.navigator.context.convAvatar,this._conversationImageUrl=e.route.params.navigator.context.convAvatarUrl,o.showLoadingPanel=!1,null===(s=e.route.params.navigator.context.newGroupTelemetryScenario)||void 0===s||s.setVisitedSetConvInfoPanel()),o}render(){let e;if(this.state.showLoadingPanel){const t=this.props.route.params.navigator.context.convId?v.getString("SetConversationParticipantsPanel.AddingContactsToConversation"):v.getString("SetConversationParticipantsPanel.CreatingNewConversation");e=i.createElement(_.default,{message:t})}else e=this._getContent();const{primaryBackgroundColorStyle:t}=D.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride);return i.createElement(c.default,{goBack:this._goBack},i.createElement(i.View,{style:[B.panel,t]},this._getHeader(this.state.showLoadingPanel),e))}_componentId(){return"SetConversationInfoPanel"}_getHeader(e){return i.createElement(A.SimplePanelHeader,{style:e?B.hiddenHeader:void 0,blockPointerEvents:e,panelName:this._getHeaderText(this.state),leftButton:this._getHeaderLeftButton(),hideBottomBorder:!0})}_getHeaderText(e){return V.getHeaderText(this.props.route.params.navigator.context.navigationOrigin===g.NavigationConversationOrigin.NewModeratedGroup)}_getHeaderLeftButton(){var e;const t=(null===(e=this.props.route.params.navigator.context.wizardSteps)||void 0===e?void 0:e[0])===T.WizardSteps.setConvInfo&&this.props.route.params.navigationDirection!==E.StackNavigationDirection.Push&&(!this._getContext().isPresentedInDesktopSubview||this.props.route.params.isAloneInNavStack);return{closeButtonType:t?A.CloseButtonType.Close:A.CloseButtonType.Back,title:t?v.getString("Global.CloseButtonTitle"):v.getString("Global.BackButtonTitle"),onPress:this._onBackButtonClick}}_getContent(){const{dividerBorderColorStyle:e}=D.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride),{secondaryTextColor:t}=D.themeColors(this._getContext(),this.props.route.params.colorThemeOverride),s=D.currentTheme(this._getContext(),this.props.route.params.colorThemeOverride),o=[L.default.messagingHeaderFontStyle(!1,this.state.isSmallDevice,s),B.conversationNameInput],a=[B.conversationNameInputContainer,e],l=d.gradientColorsForColorInfo(this.state.conversationColor);let c;const h=[B.nextButton];P.default.hasHorizontalSafeAreas(this.state.safeAreaHorizontalInsets)&&(c=P.default.horizontalPaddingStyle(this.state.safeAreaHorizontalInsets),a.push(c),h.push(i.Styles.createViewStyle({right:this.state.safeAreaHorizontalInsets.right},!1))),this.state.safeAreaBottomInset&&h.push(i.Styles.createViewStyle({bottom:this.state.safeAreaBottomInset},!1));const p=i.createElement(r.default,{style:[B.avatarPicker],onAvatarSelected:this._onAvatarSelected,onAvatarRemoved:this._onAvatarRemoved,iconSize:F.IconSize.size120,accessibilityLabel:v.getString("SetConversationInfoPanel.SelectGroupAvatarAccessibilityLabel"),onBeforeExecuteMenuCommand:this._onBeforeOpeningCameraOrPicker,initialAvatar:this._conversationImageUrl,showAltViewAsMediaIcon:!0,origin:g.AvatarPickerOrigin.ConversationInfoPanel}),m=F.IconSize.size120,S=v.getString("SetConversationInfoPanel.GroupConversationNameAccessibilityLabel",{conversationName:this.state.conversationName});return i.createElement(i.View,{style:B.panelContent},i.createElement(i.View,{style:B.contentContainer},i.createElement(M.default,{backgroundHeight:m,gradientColors:l,safeAreaHorizontalInsets:this.state.safeAreaHorizontalInsets},this.state.bigAvatarHelper.maybeWrapAvatar(p)),i.createElement(i.View,{style:a},i.createElement(i.TextInput,{ref:this._onTextInputRef,style:o,placeholder:v.getString("SetConversationInfoPanel.ConversationNamePlaceHolder"),placeholderTextColor:t,onChangeText:this._onConversationNameChanged,onKeyPress:this._onKeyPress,value:this.state.conversationName,autoFocus:!k.default.isMobileScreenReaderEnabled(),accessibilityLabel:S,returnKeyType:"done",maxLength:u.MaximumGroupConversationNameLength,editable:!0,clearButtonMode:"never",blurOnSubmit:!0}))),i.createElement(n.default,{style:h,icon:x.forwardIcon(),title:v.getString("Global.NextButtonTitle"),disabled:!this._canGoNext(),onPress:this._onNextButtonClick,userColor:this.state.conversationColor}))}_handleNext(){var e;if(!this._canGoNext())return;S.default.immediatelyResetUpdateInfo(),null===(e=this._textInput)||void 0===e||e.blur();const t=O.default.escapeXml(this.state.conversationName);this.props.route.params.navigator.extendContext({convAvatar:this._conversationImage,convAvatarUrl:this._conversationImageUrl,convColor:this.state.conversationColor,convName:t}),this.props.route.params.navigator.goNext();(0,o.last)(this.props.route.params.navigator.context.wizardSteps)===T.WizardSteps.setConvInfo&&this.setState({showLoadingPanel:!0})}_canGoNext(){const{conversationName:e}=this.state;return!!e&&!/^\s*$/.test(e)}}t.default=V},58454:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(67930),n=s(24112),r=s(46096),a=s(36237),l=s(61253),d=s(15877),c=s(33754),h=s(82677),u=s(46200),p=s(24067),g=s(33004),m=s(90631),S=s(53374),f=s(80837),y=s(97634),_=(0,d.lazyProperties)({panel:()=>i.Styles.createViewStyle({alignSelf:"stretch"})});class v extends o.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._shouldDisableDone=e=>this._reactionsListChanged(e),this._updateTelemetryData=({toggledEmoticonCount:e,searchInitiatedCount:t})=>{this._searchTelemetryData={toggledEmoticonCount:e,searchInitiatedCount:t}},this._onDonePress=()=>{const e=this._getAddedReactions();a.track(new u.CustomReactionsManipulationTelemetry(u.CustomReactionsManipulationAction.ReactionsSavedOnDoneButton,{numberOfReactions:this.state.selectedReactions.length,numberOfAddedReactions:this.state.selectedReactions.length-this._initialSelectedReactions.length,customReactionsType:this.props.route.params.origin,numberOfAnimatedReactions:g.default.superAnimationReactionsNumber(e),searchData:this._searchTelemetryData})),this._reactionsStore.saveCurrentReactions(),this._closeCustomReactionPanel()},this._onClosePressed=()=>{a.track(new u.CustomReactionsManipulationTelemetry(u.CustomReactionsManipulationAction.ReactionsNotSavedOnCloseButton,{numberOfReactions:this.state.selectedReactions.length,numberOfNotSavedReactions:this.state.selectedReactions.length-this._initialSelectedReactions.length,customReactionsType:this.props.route.params.origin,searchData:this._searchTelemetryData})),this._reactionsStore.resetUnsavedReactions(),this._closeCustomReactionPanel()},this._closeCustomReactionPanel=()=>{const e=S.default.newCauseId();a.log(r.LogTraceArea.Navigation,"SimplePanelHeader.onPress, causeId: "+e),super._goBack(e)}}_buildState(e,t){this._reactionsStore=this._getReactionsStore(e.route.params.origin);const s=this._reactionsStore.getCurrentReactions();return t&&(this._initialSelectedReactions=s),{selectedReactions:s,isPackChanged:!t&&this._shouldDisableDone(s)}}_getReactionsStore(e){return h.getCustomReactionsStore(e)}render(){const{primaryBackgroundColorStyle:e}=y.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride);return i.createElement(i.View,{style:[f.default.flexOne,_.panel,e]},i.createElement(m.SimplePanelHeader,{panelName:this._getHeaderText(),leftButton:{closeButtonType:m.CloseButtonType.Close,onPress:this._onClosePressed}}),i.createElement(n.default,{origin:this.props.route.params.origin,updateTelemetryData:this._updateTelemetryData}),i.createElement(p.default,{button:this._getHeaderDoneButton()}))}_reactionsListChanged(e){return!!e.length&&!(0,l.default)(e,this._initialSelectedReactions)}_getHeaderDoneButton(){return{text:c.getString("Global.DoneButtonTitle"),accessibilityLabel:c.getString("Global.DoneButtonTitle"),disabled:!this.state.isPackChanged,onPress:this._onDonePress}}_getAddedReactions(){return this.state.selectedReactions.filter((e=>-1===this._initialSelectedReactions.indexOf(e)))}_getHeaderText(){return this._reactionsStore.getCustomReactionsModalTitle()}}t.default=v},67337:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(65370),o=s(16778),n=s(74377),r=s(96074),a=s(90631),l=s(15877),d=s(46096),c=s(12056),h=s(71830),u=s(36237),p=s(33754),g=s(34528),m=s(53559),S=s(5899),f=s(93194),y=s(80837),_=s(53374),v="Share",C="Forward",b=(0,l.lazyProperties)({stretch:()=>o.Styles.combine(o.Styles.createViewStyle({alignSelf:"stretch"}),y.default.flexOne)});class T extends r.BaseNavigationView{constructor(){super(...arguments),this._onRightButtonRef=e=>{this._rightButton=e||void 0},this._onSharePress=e=>{if(h.isEncryptedThread(this.props.route.params.message.conversationId))return void this._showShareMenu();const t={anchor:()=>this._rightButton,buttons:[{text:p.getString("Global.ForwardButton"),command:C},{text:p.getString("Global.ShareButton"),command:v}]};f.default.showWithActionMenuConfig({options:t,callback:this._handleShareCommands,maintainAnchor:!0,rootViewId:this._getRootViewId(),invokingEvent:e})},this._handleShareCommands=e=>{switch(e){case C:S.default.forwardDocument(this.props.route.params.message,c.MessageActionOrigin.DocumentViewer,this._getContext());break;case v:this._showShareMenu();case f.SXActionMenuCancel:}},this._showShareMenu=()=>{const e={url:this.props.route.params.fileUri};n.default.show(e,this._onShareError,this._onShareCallback)},this._onShareError=e=>{this._trackShare(e)},this._onShareCallback=()=>{this._trackShare()},this._onBackPress=()=>{const e=_.default.newCauseId();u.log(d.LogTraceArea.Navigation,"DocumentViewer._onBackPress,  causeId: "+e),this._goBack(e)}}render(){const e=o.createElement(o.View,{style:y.default.flexOne},o.createElement(i.default,{url:this.props.route.params.fileUri,style:b.stretch}));return o.createElement(o.View,{style:b.stretch},this._getHeader(),e)}_getHeader(){const e={closeButtonType:a.CloseButtonType.Close,title:p.getString("Global.CloseButtonTitle"),onPress:this._onBackPress},t={icon:g.shareIcon(),title:p.getString("DocumentViewer.ShareButtonTitle"),onPress:this._onSharePress,setButtonRef:this._onRightButtonRef};return o.createElement(a.SimplePanelHeader,{panelName:this.props.route.params.fileName,leftButton:e,rightButtons:t})}_trackShare(e){const t=m.default.extractFileExtension(this.props.route.params.fileName);u.track(new c.ShareFileMessageTelemetry(this.props.route.params.message.conversationId,this.props.route.params.message,this.props.route.params.message.createdTime,c.MessageActionOrigin.DocumentViewer,c.MessageActionType.ShareFile,t,!1))}_getHeaderText(){}}t.default=T},235:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96074),o=s(65752);t.default=(0,i.forNavigation)(o.default)},50517:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(2604),n=s(93391),r=s(96073),a=s(16778),l=s(67930),d=s(19675),c=s(90631),h=s(81760),u=s(40392),p=s(11828),g=s(62523),m=s(15877),S=s(78262),f=s(46096),y=s(57175),_=s(46096),v=s(15963),C=s(98278),b=s(51077),T=s(97174),M=s(36237),I=s(33754),w=s(19784),P=s(52754),k=s(3056),A=s(13944),E=s(10117),R=s(61253),L=s(46705),F=s(51176),x=s(89808),O=s(78735),D=s(18078),B=s(13168),V=s(32226),N=s(81736),U=s(64956),H=s(85207),z=s(29130),W=s(86045),j=s(15415),G=s(80837),K=s(12770),q=s(53374),Q=6e4,X="permissionDenied",$="permissionGranted",J=(0,m.lazyProperties)({locationPicker:()=>(0,m.lazyProperties)({mapContainer:()=>a.Styles.createViewStyle({backgroundColor:h.Color.gray100})}),locationPickerPin:()=>(0,m.lazyProperties)({container:()=>a.Styles.createViewStyle({top:-u.CurrentLocationPinHeight/2,alignSelf:"stretch",alignItems:"center",justifyContent:"center"}),containerNonCurrentLocation:()=>a.Styles.createViewStyle({top:-u.NonCurrentLocationPinHeight/2}),containerSpinner:()=>a.Styles.createViewStyle({top:0}),pinContentAligment:()=>a.Styles.createViewStyle({justifyContent:"flex-end"}),currentLocationPinHeight:()=>a.Styles.createViewStyle({height:u.CurrentLocationPinHeight}),nonCurrentLocationPinHeight:()=>a.Styles.createViewStyle({height:u.NonCurrentLocationPinHeight}),goToMyLocationButton:()=>a.Styles.createButtonStyle({alignItems:"center",justifyContent:"center",position:"absolute",width:p.IconSize.default,height:p.IconSize.default,borderRadius:p.IconSize.default/2,bottom:12,right:12,backgroundColor:h.Color.gray400})}),map:()=>(0,m.lazyProperties)({mapStyle:()=>a.Styles.createViewStyle({flex:1,alignSelf:"stretch"})}),spinnerContainer:()=>a.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center",backgroundColor:h.Color.transparent}),error:()=>(0,m.lazyProperties)({container:()=>a.Styles.createViewStyle({flex:1,backgroundColor:h.Color.gray100Overlay30,borderWidth:1,borderColor:h.Color.gray100Overlay30,borderStyle:"solid",alignItems:"center",justifyContent:"center"}),iconContainer:()=>a.Styles.createViewStyle({flex:1,opacity:.15,alignItems:"center",marginBottom:30,justifyContent:"flex-end"}),textStyle:()=>a.Styles.createTextStyle({flex:1,paddingHorizontal:16,textAlignVertical:"top",textAlign:"center",alignItems:"center",justifyContent:"center"})})});class Y extends l.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._mapViewRef=e=>{this._mapView=e},this._onSearchHeaderRef=e=>{this._searchHeader=e||void 0},this._onSearchClick=()=>{this.state.currentSelectedLocation&&!this.state.isSearchingPlaceActive&&this.isComponentMounted()&&(this.setState({isSearchingPlaceActive:!0}),M.track(new L.LocationPickerSearchStart(this.state.locationType)))},this._onCancelSearchPress=()=>{this.state.isSearchingPlaceActive&&(M.track(new L.LocationPickerSearchCancel(this.state.locationType)),this._blurSearchInput(),this._currentSearchQueryInputText="",this.isComponentMounted()&&this.setState({searchQuery:"",isSearchingPlaceActive:!1}))},this._onMapPanelLayout=e=>{this.isComponentMounted()&&e.height!==this.state.mapViewHeight&&this.setState({mapViewHeight:e.height}),this.state.isPermissionUnknown&&!this.state.isChild&&N.default.requestPermission(S.PermissionType.Location,S.PermissionPromptOptions.SkipPrePrompt)},this._onInputTextChange=e=>{this._currentSearchQueryInputText!==e&&(this._currentSearchQueryInputText=e,this._searchTimeout=K.default.setTimeout((()=>{this._currentSearchQueryInputText===e&&this.isComponentMounted()&&this.setState({searchQuery:this._currentSearchQueryInputText})}),1e3))},this._onSubmitEditing=()=>{this.isComponentMounted()&&this.setState({searchQuery:this._currentSearchQueryInputText})},this._onNearByPlaceFromSearchSelected=e=>{this._onNearByPlaceSetState(e,S.LocationType.Search),M.track(new L.LocationPickerNearbyClicked(S.LocationType.Search))},this._onGoToMyLocation=()=>{this._refreshUserLocation("goToMyLocationButton",!1,Q,!0)},this._onRegionChangeComplete=e=>{if(!this.state.initialRegionChangeComplete)return void(this.isComponentMounted()&&this.setState({initialRegionChangeComplete:!0}));if(this.state.animatingLocationType)return;if(this.state.currentSelectedLocation&&q.default.linearDistanceBetweenCoordinates(e.latitude,e.longitude,this.state.currentSelectedLocation.latitude,this.state.currentSelectedLocation.longitude,"km")<=.01)return;let t=-1,s=!1;this.state.currentUserLocation&&(t=q.default.linearDistanceBetweenCoordinates(e.latitude,e.longitude,this.state.currentUserLocation.latitude,this.state.currentUserLocation.longitude,"km"),s=t<=.1),this.isComponentMounted()&&this.setState({locationType:s?S.LocationType.Current:S.LocationType.Custom,currentSelectedLocation:e})},this._onClose=()=>{this._goBack(q.default.newCauseId())},this._onSendPress=(e,t,s)=>{const o=q.default.newCauseId();M.log(f.LogTraceArea.LocationPicker,"LocationPicker._onSendPress causeId: "+o);let n=t;n||(n=I.getString("LocationPicker.LocationSharedFallback"));const a=this._getShownLocation(),l=new T.GeoLocationEntity(this.state.locationType===S.LocationType.Current,D.default.getSkypeMri(),a?a.latitude:void 0,a?a.longitude:void 0,void 0,(new Date).getTime(),r.default.getDefaultId(),void 0,I.getLocale(),I.getLanguageFromLocale(),n,void 0,void 0,e,s,a?[new T.LinkEntity(n,F.default.getBingMapsLocationUrl(a,e))]:void 0);H.default.postMessageFromInput(this.props.route.params.conversationId,_.PostSource.LocationPicker,[l],b.MessageTypes.Location,{name:v.ScenarioName.SendLocation}),M.track(new L.LocationPickerSend(this.state.locationType)),W.default.maybeAnnounceForAccessibility(I.getString("LocationPicker.LocationSent")),W.default.isMobileScreenReaderEnabled()?(0,i.delay)((()=>this._goBack(o)),1e3):this._goBack(o)},this._goBack=e=>(M.log(f.LogTraceArea.Navigation,"LocationPicker._goBack causeId: "+e),M.track(new L.LocationPickerNavigationClose(this.state.locationType)),super._goBack(e))}_buildState(e,t){var s;const i=null===(s=O.default.getUserPreferencesLocal().msaProfileKey)||void 0===s?void 0:s.ageGroup,n=y.MsaProfileHelper.isChild(i),r=F.default.getLocationPermissionStatus(S.PermissionType.Location),a=this._getRootViewId(),l={isPermissionUnavailable:r===o.PermissionStatus.Unavailable,isPermissionDenied:r===o.PermissionStatus.Denied,isPermissionUnknown:r===o.PermissionStatus.Unknown,isPermissionGranted:r===o.PermissionStatus.Granted,deviceOrientation:z.default.getDeviceOrientation(a),screenHeight:z.default.getHeight(a),isConnected:V.default.isConnected(),isChild:n};return t&&(l.searchQuery="",l.locationType=S.LocationType.None,this._currentSearchQueryInputText=""),l}componentDidMount(){super.componentDidMount(),this.state.isConnected&&(this.state.isPermissionDenied&&(M.track(new L.LocationPickerPermissionsChanged(this.state.locationType,"none",X)),U.default.showDeniedPromptWithSettingsOption(S.PermissionType.Location,this._getRootViewId())),this._refreshUserLocation("componentDidMount",!1,Q,!0)),M.track(new L.LocationPickerNavigationOpen(this.state.locationType))}componentWillUnmount(){super.componentWillUnmount(),this._searchTimeout&&(K.default.clearTimeout(this._searchTimeout),this._searchTimeout=void 0,this._currentSearchQueryInputText="")}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.isConnected&&(!t.isPermissionDenied&&this.state.isPermissionDenied&&(M.track(new L.LocationPickerPermissionsChanged(this.state.locationType,$,X)),U.default.showDeniedPromptWithSettingsOption(S.PermissionType.Location,this._getRootViewId())),(t.isPermissionDenied&&!this.state.isPermissionDenied&&!this.state.isPermissionUnknown||t.isPermissionUnknown&&!this.state.isPermissionUnknown&&!this.state.isPermissionDenied)&&(M.track(new L.LocationPickerPermissionsChanged(this.state.locationType,X,$)),this._refreshUserLocation("componentDidUpdate",!1,Q,!0)));const i=this.state.initialRegionChangeComplete&&!t.initialRegionChangeComplete,o=!(0,R.default)(this.state.animatingLocation,t.animatingLocation)&&this.state.initialRegionChangeComplete;if(this.state.animatingLocationType&&(o||i)){if(!this.state.animatingLocation)return;const e=this.state.initialLocationFetchComplete?750:1500;this._animateToRegion(this.state.animatingLocation,e)}}_refreshUserLocation(e,t=!0,s=6e4,i=!1){const o=!0;if(this.state.isPermissionGranted){t&&this.isComponentMounted()&&this.setState({isLoadingLocation:!0});const n=(new Date).getTime();a.Location.getCurrentPosition({maximumAge:0,enableHighAccuracy:o,timeout:s}).then((t=>{const s=this.isComponentMounted(),r=(new Date).getTime();if(M.track(new L.LocationPickerGeolocationFetched(S.LocationType.Current,e,o,s,r-n)),s){const e={latitude:t.coords.latitude,longitude:t.coords.longitude,latitudeDelta:g.LatitudeDelta,longitudeDelta:g.LongitudeDelta};i?this.setState({animatingLocation:e,animatingLocationType:S.LocationType.Current}):this.setState({locationType:S.LocationType.Current,currentUserLocation:e,currentSelectedLocation:e,isLoadingLocation:!1})}})).fail((t=>{M.warn(f.LogTraceArea.LocationPicker,"Was not possible to get the location; Error:"+t.message+";Code:"+t.code);const s=this.isComponentMounted(),i=(new Date).getTime();M.track(new L.LocationPickerGeolocationFetchedFailed(this.state.locationType,e,o,s,i-n,t.code===t.TIMEOUT,t.code===t.PERMISSION_DENIED,t.code===t.POSITION_UNAVAILABLE)),w.default.showOKAlert(I.getString("LocationPicker.UnableToFetchLocationTitle"),I.getString("LocationPicker.UnableToFetchLocationMessage"),this._getRootViewId()),s&&this.setState({isPermissionDenied:t.code===t.PERMISSION_DENIED,isLoadingLocation:!1})}))}}isNavigatingAwayOnPress(){return!0}render(){if(!this.state.isConnected)return a.createElement(k.default,{goBack:this._goBack},this._getPickerErrorScreen(p.SkypeIcon.EmoticonNotPresent,I.getString("LocationPicker.NoConnection")));const e=this._getHeaderElement(),t=this._getMapOverlay(),s=this.state.isSearchingPlaceActive?a.createElement(a.View,{style:G.default.absoluteFill},a.createElement(P.default,{key:"searchInputControl",ref:this._onSearchHeaderRef,initialValue:0,blurOnSubmit:!0,rawSearchQuery:this.state.searchQuery,onInputTextChange:this._onInputTextChange,onSubmitEditing:this._onSubmitEditing,cancelSearch:this._onCancelSearchPress}),a.createElement(a.View,{style:G.default.flexOne},a.createElement(B.default,{locationType:this.state.locationType,style:G.default.flexOne,query:this.state.searchQuery.trim(),searchModeOn:!0,latitude:this.state.currentSelectedLocation?this.state.currentSelectedLocation.latitude:void 0,longitude:this.state.currentSelectedLocation?this.state.currentSelectedLocation.longitude:void 0,onItemSelected:this._onNearByPlaceFromSearchSelected}))):null,i=a.createElement(n.MapView,{ref:this._mapViewRef,showsMyLocationButton:!1,region:this.state.animatingLocationType?void 0:this.state.currentSelectedLocation,rotateEnabled:!1,onRegionChangeComplete:this._onRegionChangeComplete,style:J.map.mapStyle,showsUserLocation:!this.state.isLoadingLocation});return a.createElement(k.default,{goBack:this._goBack},a.createElement(a.View,{style:G.default.flexOne},a.createElement(a.View,{style:G.default.flexOne,importantForAccessibility:this.state.isSearchingPlaceActive?a.Types.ImportantForAccessibility.NoHideDescendants:a.Types.ImportantForAccessibility.Auto},e,a.createElement(a.View,{style:[G.default.flexOne,J.locationPicker.mapContainer],onLayout:this._onMapPanelLayout},i,t)),s))}_getMapOverlay(){if(!this.state.mapViewHeight)return null;const e=this.state.isPermissionGranted?a.createElement(a.View,{key:"goToMyLocationButton",style:J.locationPickerPin.goToMyLocationButton},a.createElement(A.default,{title:I.getString("AccessibilityLabel.MyLocation"),size:p.IconSize.size24,onPress:this._onGoToMyLocation,color:h.Color.white,hoverColor:h.Color.whiteOverlay70,icon:p.SkypeIcon.MyLocation,activeOpacity:.6})):void 0;let t;const s=[G.default.absoluteFill,J.locationPickerPin.container,this._getHeightStyle(this.state.mapViewHeight)];if(this.state.isLoadingLocation)s.push(J.locationPickerPin.containerSpinner),t=a.createElement(a.View,{style:[J.spinnerContainer,G.default.absoluteFill]},a.createElement(j.default,{size:C.SXActivityIndicatorSize.Medium,tintColor:x.default.getPrimaryColorNoSubscription()}));else if(this._getShownLocation()){let e,i=this.state.locationType===S.LocationType.Current;i||s.push(J.locationPickerPin.containerNonCurrentLocation);const o=this._getShownPlace(),n=this._getShownLocation();o&&n&&o.latitude===n.latitude&&o.longitude===n.longitude&&(e={addressFriendlyName:o.name,address:o.address}),t=a.createElement(u.LocationPickerPin,{style:[J.locationPickerPin.pinContentAligment,i?J.locationPickerPin.currentLocationPinHeight:J.locationPickerPin.nonCurrentLocationPinHeight],location:this.state.currentSelectedLocation,userMri:D.default.getSkypeMri(),overrideAddress:e,locationType:this.state.locationType,hideLocationPin:this.state.locationType===S.LocationType.Current,showSendPopover:!0,onPressPopupOver:this._onSendPress})}return a.createElement(a.View,{style:G.default.absoluteFill,ignorePointerEvents:!0},a.createElement(a.View,{style:s,ignorePointerEvents:!0},t),e)}_getShownLocation(){return this.state.animatingLocation||this.state.currentSelectedLocation}_getShownPlace(){return this.state.animatingPlace||this.state.selectedPlace}_blurSearchInput(){var e;null===(e=this._searchHeader)||void 0===e||e.blurInput()}_onNearByPlaceSetState(e,t){this._blurSearchInput(),this._currentSearchQueryInputText="";const s={latitude:e.latitude,longitude:e.longitude,latitudeDelta:this.state.currentSelectedLocation?this.state.currentSelectedLocation.latitudeDelta:0,longitudeDelta:this.state.currentSelectedLocation?this.state.currentSelectedLocation.longitudeDelta:0};this.isComponentMounted()&&this.setState({isSearchingPlaceActive:!1,animatingPlace:e,animatingLocation:s,animatingLocationType:t})}_animateToRegion(e,t){this._mapView?this._mapView.animateToRegion(e,t).then((()=>{this.isComponentMounted()&&(this._completeAnimation(),!this.state.initialLocationFetchComplete&&this.isComponentMounted()&&this.setState({initialLocationFetchComplete:!0}))})).catch((e=>{M.warn(f.LogTraceArea.LocationPicker,"Animation was not completed",e),this.isComponentMounted()&&this._completeAnimation()})):M.warn(f.LogTraceArea.LocationPicker,"unable to animate to selected location since map is null")}_getHeightStyle(e){let t=Y._cachedHeightStyles[e];return t||(t=a.Styles.createViewStyle({height:e}),Y._cachedHeightStyles[e]=t),t}_getHeaderElement(){return this.state.isSearchingPlaceActive?void 0:a.createElement(c.SimplePanelHeader,{panelName:I.getString("LocationPicker.SendLocation"),leftButton:this._getHeaderLeftButton(),rightButtons:this._getHeaderRightButton(),hideBottomBorder:!0})}_getHeaderLeftButton(){return{closeButtonType:c.CloseButtonType.Close,title:I.getString("Global.CloseButtonTitle"),onPress:this._onClose}}_getHeaderRightButton(){return this.state.currentSelectedLocation?{icon:p.SkypeIcon.Search,title:I.getString("LocationPicker.SearchPlacesPlaceholder"),onPress:this._onSearchClick}:void 0}_completeAnimation(){switch(this.state.animatingLocationType){case S.LocationType.NearBy:case S.LocationType.Search:this.isComponentMounted()&&this.setState({selectedPlace:this.state.animatingPlace,currentSelectedLocation:this.state.animatingLocation,searchQuery:"",locationType:this.state.animatingLocationType,animatingLocation:void 0,animatingPlace:void 0,animatingLocationType:void 0});break;case S.LocationType.Current:this.isComponentMounted()&&this.setState({locationType:S.LocationType.Current,currentUserLocation:this.state.animatingLocation,currentSelectedLocation:this.state.animatingLocation,isLoadingLocation:!1,animatingLocation:void 0,animatingPlace:void 0,animatingLocationType:void 0});break;default:M.warn(f.LogTraceArea.LocationPicker,"No state change for "+this.state.locationType+"is defined")}}_getPickerErrorScreen(e,t){return a.createElement(a.View,{style:G.default.flexOne},this._getHeaderElement(),a.createElement(a.View,{style:J.error.container},a.createElement(a.View,{style:J.error.iconContainer},a.createElement(E.default,{icon:e,size:p.IconSize.size80,color:h.Color.gray300})),a.createElement(d.BodyText,{style:J.error.textStyle,textThemeColor:d.TextThemeColor.Secondary},t)))}_getHeaderText(e){}}t.default=Y,Y._cachedHeightStyles={}},90474:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(2604),o=s(93391),n=s(16778),r=s(67930),a=s(52262),l=s(46096),d=s(36237),c=s(15877),h=s(33754),u=s(62523),p=s(51176),g=s(40392),m=s(46705),S=s(12056),f=s(18078),y=s(5899),_=s(90631),v=s(93194),C=s(81760),b=s(40363),T=s(34528),M=s(78262),I=s(26712),w=s(53374),P=s(451),k=s(80837),A="OpenInMaps",E="OpenInGoogleMaps",R="Copy",L="Forward",F=(0,c.lazyProperties)({panel:()=>n.Styles.createViewStyle({alignSelf:"stretch"}),mapContainer:()=>n.Styles.createViewStyle({backgroundColor:C.Color.gray100})});class x extends r.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._onShareIconRef=e=>{this._shareIconButton=e||void 0},this._onShare=e=>{let t={anchor:()=>this._shareIconButton,message:this.props.route.params.fullAddress,buttons:[{text:h.getString("LocationPicker.Copy"),command:R},{text:h.getString("LocationPicker.ShareCommandForward"),command:L}]};v.default.showWithActionMenuConfig({options:t,callback:this._handleShareCommands,rootViewId:this._getRootViewId(),invokingEvent:e})},this._handleShareCommands=e=>{switch(e){case L:y.default.shareLocation(this.props.route.params.message,S.MessageActionOrigin.LocationViewer,this._getContext());break;case R:P.default.writeText(this.props.route.params.fullAddress),d.track(new S.MessageActionTelemetry(this.props.route.params.message.conversationId,this.props.route.params.message,this.props.route.params.message.createdTime,S.MessageActionOrigin.LocationViewer,S.MessageActionType.Copy));case v.SXActionMenuCancel:}},this._onClose=()=>{const e=w.default.newCauseId();d.log(l.LogTraceArea.Navigation,"LocationViewer._onClose causeId: "+e),this._goBack(e)},this._onPinPress=e=>{let t={anchor:()=>this._locationPickerPin,buttons:[]};b.default.getPlatformType()===l.PlatformType.iOS&&t.buttons.push({text:h.getString("LocationPicker.OpenInMaps"),command:A}),t.buttons.push({text:h.getString("LocationPicker.OpenInGoogleMaps"),command:E}),v.default.showWithActionMenuConfig({options:t,callback:this._handleGetDirectionsCommands,rootViewId:this._getRootViewId(),invokingEvent:e})},this._handleGetDirectionsCommands=e=>{switch(e){case A:let e;e=this.props.route.params.addressFriendlyName?{q:encodeURIComponent(this.props.route.params.addressFriendlyName),ll:this._getLatLongString()}:this.props.route.params.shortAddress?{q:encodeURIComponent(this.props.route.params.shortAddress),ll:this._getLatLongString()}:{q:this._getLatLongString()},n.Linking.openUrl(I.default.addUrlParameters("https://maps.apple.com",e)),d.track(new m.LocationViewerOpenMaps);break;case E:let t;t=this.props.route.params.addressFriendlyName?{q:encodeURIComponent(this.props.route.params.addressFriendlyName),center:this._getLatLongString()}:this.props.route.params.shortAddress?{q:encodeURIComponent(this.props.route.params.shortAddress),center:this._getLatLongString()}:{q:this._getLatLongString()},n.Linking.openUrl(I.default.addUrlParameters("https://maps.google.com/maps",t)),d.track(new m.LocationViewerOpenGoogleMaps);case v.SXActionMenuCancel:}},this._onLocationPickerPinRef=e=>{this._locationPickerPin=e||void 0}}_buildState(e){const t=p.default.getLocationPermissionStatus(M.PermissionType.Location),s={postedByCurrentUser:f.default.isMyMri(e.route.params.userMri),region:{latitude:e.route.params.latitude,longitude:e.route.params.longitude,latitudeDelta:u.LongitudeDelta,longitudeDelta:u.LatitudeDelta},isPermissionGranted:t===i.PermissionStatus.Granted};return s.postedByCurrentUser||(s.senderName=a.default.getDisplayableProfile(e.route.params.userMri).getShortName()),s}render(){const e=this.props.route.params.isUserLocation?g.CurrentLocationPinHeight:g.NonCurrentLocationPinHeight;return n.createElement(n.View,{style:[k.default.flexOne,F.panel]},this._getHeader(),n.createElement(n.View,{style:[k.default.flexOne,F.mapContainer]},n.createElement(o.MapView,{key:"map-view",region:this.state.region,style:[k.default.flexOne,F.panel],rotateEnabled:!1,showsUserLocation:this.state.isPermissionGranted,loadingIndicatorColor:C.Color.blue,showsMyLocationButton:!1},n.createElement(o.MapMarker,{centerOffset:{y:-e/2,x:0},coordinate:this.state.region,onPress:this._onPinPress},n.createElement(g.LocationPickerPin,{ref:this._onLocationPickerPinRef,conversationId:this.props.route.params.message.conversationId,userMri:this.props.route.params.userMri,locationType:this.props.route.params.isUserLocation?M.LocationType.Current:M.LocationType.None,overrideAddress:{addressFriendlyName:this.props.route.params.addressFriendlyName||"",address:this.props.route.params.shortAddress||""},showViewerPopover:!0})))))}_getHeader(){let e="";return this.props.route.params.isUserLocation?this.state.postedByCurrentUser?e=h.getString("LocationPicker.SharedCurrentLocationYou"):this.state.senderName&&(e=h.getString("LocationPicker.SharedCurrentLocation",{userName:this.state.senderName})):this.state.postedByCurrentUser?e=h.getString("LocationPicker.SharedByYou"):this.state.senderName&&(e=h.getString("LocationPicker.SharedLocation",{userName:this.state.senderName})),n.createElement(_.SimplePanelHeader,{panelName:e,leftButton:this._getHeaderLeftButton(),rightButtons:this._getHeaderRightButton(),hideBottomBorder:!0})}_getHeaderLeftButton(){return{closeButtonType:_.CloseButtonType.Close,title:h.getString("Global.BackButtonTitle"),onPress:this._onClose}}_getHeaderRightButton(){return{icon:T.shareIcon(),title:h.getString("LocationPicker.ShareButtonTitle"),onPress:this._onShare,setButtonRef:this._onShareIconRef}}_getLatLongString(){return this.props.route.params.latitude+","+this.props.route.params.longitude}_getHeaderText(e){}}t.default=x},35276:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96074),o=s(72071);t.default=(0,i.forNavigation)(o.default)},88755:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96074),o=s(5795);t.default=(0,i.forNavigation)(o.default)},54399:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(31844),n=s(25465),r=s(14069),a=s(98356),l=s(16778),d=s(15069),c=s(1706),h=s(89391),u=s(96074),p=s(94224),g=s(80200),m=s(5531),S=s(14920),f=s(14980),y=s(71830),_=s(11009),v=s(47204),C=s(98278),b=s(984),T=s(49748),M=s(25728),I=s(29241),w=s(39549),P=s(96060),k=s(37490),A=s(52262),E=s(46096),R=s(45381),L=s(11375),F=s(58481),x=s(9112),O=s(5581),D=s(66649),B=s(36237),V=s(10400),N=s(15877),U=s(18460),H=s(33754),z=s(6286),W=s(57236),j=s(73319),G=s(63328),K=s(94060),q=s(48443),Q=s(23005),X=s(53189),$=s(26378),J=s(35762),Y=s(10909),Z=s(63189),ee=s(40897),te=s(58660),se=s(89808),ie=s(45026),oe=s(4735),ne=s(17093),re=s(27357),ae=s(60621),le=s(58962),de=s(29130),ce=s(14976),he=s(51070),ue=s(81115),pe=s(86045),ge=s(70919),me=s(88361),Se=s(44487),fe=s(12187),ye=s(26978),_e=s(80837),ve=s(60305),Ce=s(94050),be=s(12770),Te=s(97634),Me=s(63066),Ie=s(67096),we=s(72758),Pe=s(53374),ke=s(73877),Ae="gifPreviewDialog",Ee="mojiPreviewDialog",Re=(0,N.lazyProperties)({contentPanelContents:()=>l.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),container:()=>l.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),contentPanelLowerContents:()=>l.Styles.createViewStyle({flex:1,flexDirection:"row",alignSelf:"stretch"}),fillParent:()=>_e.default.absoluteFill,contentWrapper:()=>l.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),tabShadow:()=>l.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,height:1}),tabBottomView:()=>l.Styles.createViewStyle({flex:1,height:44}),bottomViewWrapper:()=>l.Styles.createViewStyle({position:"absolute",left:0,top:0,right:0}),bottomViewHeight:()=>l.Styles.createViewStyle({height:44})});class Le extends u.BaseNavigationView{constructor(){super(...arguments),this._virtualStreamRefCount=0,this._miniToastKey=i.uniqueId("MobileContentPanel"),this._innerMovingContainerSelectMessagesHeader=new l.Animated.Value(0),this._innerMovingContainerSelectMessagesActions=new l.Animated.Value(0),this._searchStore=new I.default,this._coachMarkContext={coachMarkArea:_.CoachMarkAreaType.Conversation},this._onMojiPreviewClosed=()=>{this.isComponentMounted()&&this.setState({mojiPreview:void 0})},this._onGifPreviewClosed=()=>{this.isComponentMounted()&&this.setState({gifPreview:void 0})},this._onMessagePanelRef=e=>{this._messagePanel=e||void 0},this._onMessageComposerOverflowRef=e=>{this._messageComposerOverflow=e||void 0},this._onShowOverflow=(e,t,s)=>{this.isComponentMounted()&&this._messageComposerOverflow&&this.setState({overflowMenuVisible:e},(()=>{this.isComponentMounted()&&(e?(B.track(new j.MessageOverflowEvent(j.MessageOverflowAction.MessageOverflowOpenButtonClicked)),this._messageComposerOverflow&&this._messageComposerOverflow.showOrHide(!0,t,s,(()=>{be.default.setTimeout((()=>{k.dismissAll()}),20)}))):(B.track(new j.MessageOverflowEvent(j.MessageOverflowAction.MessageOverflowMinimized)),this._messageComposerOverflow&&this._messageComposerOverflow.showOrHide(!1,t,s),this._openFindPanelScenario&&this._openFindPanelScenario.hasStarted()&&!this._openFindPanelScenario.isResolved()&&(this._openFindPanelScenario.finish(),this._openFindPanelScenario=void 0)))}))},this._onMojiPreviewOpened=e=>{if(this.isComponentMounted()&&(this.setState({mojiPreview:e}),this.state.deviceOrientation===o.DeviceOrientation.Landscape)){ee.default.deactivatePicker(),k.dismissAll();const t=l.createElement(te.MojiPreview,{moji:e,onClose:this._onMojiPreviewCloseButtonPressed,onSend:this._onMojiSend,useFullScreen:!0,useTransparentDarkTheme:!0,showSendButton:!0,sendButtonTitle:H.getString("Moji.SendButtonTitle"),showReplayOnMojiAfterPlay:!0,setAccessibilityFocusOnMoji:!0});v.default.dismissModal(Ee,this._getRootViewId()),v.default.showModal(t,Ee,{rootViewId:this._getRootViewId()})}},this._onGifPreviewOpened=e=>{if(this.isComponentMounted()&&(this.setState({gifPreview:e}),this.state.deviceOrientation===o.DeviceOrientation.Landscape)){ee.default.deactivatePicker(),k.dismissAll();const t=l.createElement(F.default,{key:this.props.route.params.conversationId,gif:e,onClose:this._onGifPreviewCloseButtonPressed,onSend:this._onGifSend,useTransparentDarkTheme:!0,useFullScreen:!0,showSendButton:!0,sendButtonTitle:H.getString("PesPicker.GifPreviewSendButtonAccessibility")});v.default.dismissModal(Ae,this._getRootViewId()),v.default.showModal(t,Ae,{rootViewId:this._getRootViewId()})}},this._onMojiPreviewCloseButtonPressed=()=>{ae.MojiPreviewService.closePesPreview(),this.state.deviceOrientation===o.DeviceOrientation.Landscape&&(v.default.dismissModal(Ee,this._getRootViewId()),ee.default.activatePicker(le.TabType.Moji))},this._onGifPreviewCloseButtonPressed=()=>{ae.GifPreviewService.closePesPreview(),this.state.deviceOrientation===o.DeviceOrientation.Landscape&&(v.default.dismissModal(Ae,this._getRootViewId()),ee.default.activatePicker(le.TabType.Gif))},this._onMojiSend=()=>{this.state.mojiPreview&&ae.MojiPreviewService.sendPes(this.state.mojiPreview),ae.MojiPreviewService.closePesPreview(),this.state.deviceOrientation===o.DeviceOrientation.Landscape&&(ee.default.deactivatePicker(),v.default.dismissModal(Ee,this._getRootViewId()))},this._onGifSend=()=>{this.state.gifPreview&&ae.GifPreviewService.sendPes(this.state.gifPreview),ae.GifPreviewService.closePesPreview(),this.state.deviceOrientation===o.DeviceOrientation.Landscape&&(ee.default.deactivatePicker(),v.default.dismissModal(Ae,this._getRootViewId()))},this._onCloseMessageSearchPanel=()=>{this._searchStore.cancelSearch(),this._messageSearchPanel&&(this._trackSearchClosed(ge.MessageSearchToggleOrigin.CancelButton),L.setFocusWithDelay(L.FocusEvent.CloseMobileSearchInConversation,250))},this._onMessageSearchPanelRef=e=>{this._messageSearchPanel=e||void 0},this._onChatTabLayout=e=>{q.default.updateTopOffset(e.y)},this._headerOnLayout=e=>{if(this.state.headerHeightAndroid!==e.height&&this.setState({headerHeightAndroid:e.height}),!0===this.props.route.params.isInConversationBubbleMode){r.default.onBubbleConversationContextLoaded();const e=p.default.CallingStore.getIncomingCallIds();if(!i.isEmpty(e)){const t=Pe.default.newCauseId(),s=i.head(e);s&&(B.log(E.LogTraceArea.MobileHub,"Resuming incoming call screen for callId: "+s+", causeId: "+t+")"),p.default.CallNavigationHelper.presentIncomingRing(s,t))}}},this._onInteracted=()=>{this.state.shouldFlattenNavOnInteraction&&this.isComponentMounted()&&(this.state.onTopOfNavStack?oe.default.flattenNavStack():oe.default.reduceNavStack([ne.SearchNavigationId,ne.AlertsHubNavigationId]),this.setState({shouldFlattenNavOnInteraction:!1}))},this._launchCamera=()=>{k.dismissAll(),f.navigateToCaptureComboModalWithParams({capturedContentHandler:new S.CapturedContentHandlerForPosting(this.props.route.params.conversationId),conversationId:this.props.route.params.conversationId,allowVideo:!0,mediaPickerShouldCollapseFully:!0,showCoachmarksIfNeeded:!0,allowMultiple:this._isMediaPreviewEnabled(),allowOfficeLens:!0,onSendFlowComplete:this._onCameraSendFlowComplete},this._getContext())},this._onCallStartedAnsweredOrJoinedViaContentPanelHeader=()=>{this._blurStream()},this._onShowGestureHint=e=>{this.isComponentMounted()&&this.setState({toolTipInfo:e})},this._onDismissPopup=()=>{this.isComponentMounted()&&this.state.toolTipInfo&&this.setState({toolTipInfo:void 0})},this._onCloseSelectMessagesPanel=(e,t)=>{if(!this.isComponentMounted())return;this.setState({currentSelectMessagesUIState:P.SelectMessagesUIState.Closing});const s=[ie.default.timing(this._innerMovingContainerSelectMessagesHeader,{toValue:e,duration:a.Common.Duration.Default,easing:a.Easing.SkypeExpoIn5,useNativeDriver:!0}),ie.default.timing(this._innerMovingContainerSelectMessagesActions,{toValue:t,duration:a.Common.Duration.Default,easing:a.Easing.SkypeExpoIn5,useNativeDriver:!0})];l.Animated.parallel(s).start((e=>{e.finished&&this.isComponentMounted()&&this.setState({currentSelectMessagesUIState:P.SelectMessagesUIState.Deactive})}))},this._isMediaPreviewEnabled=()=>this.props.route.params.conversationId&&z.default.isMediaPreviewEnabled(this.props.route.params.conversationId),this._trackSearchClosed=e=>{this._messageSearchPanel&&(B.track(new J.ClosedSearch(e,this._messageSearchPanel.didUserSearch(),this._messageSearchPanel.getLastSearchResultsCount(),this._messageSearchPanel.getNumberOfRequests())),this._messageSearchPanel.resetTelemetryParams())},this._onCameraSendFlowComplete=()=>{pe.default.maybeAnnounceForAccessibility(H.getString("MessageComposer.FileSentLabel"))}}_componentId(){return"MobileContentPanel"}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t),e.route.params.conversationId!==this.props.route.params.conversationId&&this._virtualStreamRefCount++,this._searchStore.setTimestamp(e.route.params.scrollToTimestamp)}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),this._messagePanel&&this.state.onTopOfNavStack&&!t.onTopOfNavStack&&this._messagePanel.onNavigateAway(),this.state.deviceOrientation!==t.deviceOrientation&&(ae.MojiPreviewService.closePesPreview(),v.default.dismissModal(Ee,this._getRootViewId()),ae.GifPreviewService.closePesPreview(),v.default.dismissModal(Ae,this._getRootViewId()))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),n.default.hideKeyboardOnAndroidBackButton(!this.state.mojiPreview&&!this.state.gifPreview),this.state.onTopOfNavStack!==t.onTopOfNavStack&&(this.state.onTopOfNavStack?(Y.default.addOrUpdateBottomMargin(this._miniToastKey,60),be.default.setTimeout((()=>{this._focusStreamForAccessibility(this.state)}),100)):Y.default.removeBottomMargin(this._miniToastKey)),this.state.isKeyboardShown!==t.isKeyboardShown&&B.log(E.LogTraceArea.ContentPanel,"[MobileContentPanel] componentDidUpdate isKeyboardShown: "+this.state.isKeyboardShown)}componentDidMount(){super.componentDidMount(),this._searchStore.setTimestamp(this.props.route.params.scrollToTimestamp),this._focusMessageComposerToken=Z.default.focusMessageComposerEvent().subscribe((e=>{B.log(E.LogTraceArea.ContentPanel,"[MobileContentPanel] focusMessageComposerEvent, focus: "+e),e?this._focusStream(this.state):this._blurStream()}));const e=Pe.default.newCauseId();B.log(E.LogTraceArea.ContentPanel,"[MobileContentPanel] componentDidMount isKeyboardShown: "+this.state.isKeyboardShown+" causeId: "+e);const{defaultStatusBarTheme:t}=Te.themeColors(this._getContext(),this.props.route.params.colorThemeOverride),s=fe.default.mergeStyles([fe.default.createHiddenStyle(!1),fe.default.createBarStyle(t)]);this._updateStatusBarStyle(s),this.props.route.params.conversationId&&(B.log(E.LogTraceArea.ContentPanel,"[MobileContentPanel] - displaying conversation, id: "+ce.mriOrId(this.props.route.params.conversationId)+" causeId: "+e),p.default.CallPreheatHelper.maybePreheatCall(this.props.route.params.conversationId,e)),n.default.hideKeyboardOnAndroidBackButton(!0),this._mojiPreviewOpenToken=ae.MojiPreviewService.onPesPreviewOpened(this._onMojiPreviewOpened),this._mojiPreviewCloseToken=ae.MojiPreviewService.onPesPreviewClosed(this._onMojiPreviewClosed),this._gifPreviewOpenToken=ae.GifPreviewService.onPesPreviewOpened(this._onGifPreviewOpened),this._gifPreviewCloseToken=ae.GifPreviewService.onPesPreviewClosed(this._onGifPreviewClosed),this._searchStore.setTimestamp(this.props.route.params.scrollToTimestamp)}componentWillUnmount(){var e;super.componentWillUnmount();const t=[Me.Scenarios.SearchToConversation,Me.Scenarios.RecommendationFromRecentsToConversation,Me.Scenarios.RecommendationFromContactsToConversation];Ie.default.interruptScenarios(this.props.route.params.conversationId,t),this._mojiPreviewOpenToken&&this._mojiPreviewOpenToken.unsubscribe(),this._mojiPreviewCloseToken&&this._mojiPreviewCloseToken.unsubscribe(),this._gifPreviewOpenToken&&this._gifPreviewOpenToken.unsubscribe(),this._gifPreviewCloseToken&&this._gifPreviewCloseToken.unsubscribe(),this._focusMessageComposerToken&&this._focusMessageComposerToken.unsubscribe(),n.default.hideKeyboardOnAndroidBackButton(!0),Y.default.removeBottomMargin(this._miniToastKey),null===(e=this._backButtonHandlerSubscriptionToken)||void 0===e||e.unsubscribe()}_blurStream(){this._messagePanel&&this._messagePanel.blur()}_focusStream(e){this._messagePanel&&e.onTopOfNavStack&&this._messagePanel.requestFocus()}_focusStreamForAccessibility(e){this._messagePanel&&e.onTopOfNavStack&&!l.Modal.isDisplayed()&&pe.default.isMobileScreenReaderEnabled()&&this._messagePanel.focusTextInputForAccessibility()}_buildState(e,t){let s={};const i=this.props,n=h.default.getS4LMessagingFeatures(),r=this._getRootViewId(),a=(0,w.default)(),d=a.getConversation(e.route.params.conversationId),u=a.isConversationBlocked(d);return s.responsiveWidth=de.default.getResponsiveWidth(r),s.conversationDisplayName=A.default.getDisplayName(e.route.params.conversationId),s.isFileUploadCapable=!D.default.isUsingGogoNetwork()&&(!y.isAgent(e.route.params.conversationId)||c.default.hasCapability(e.route.params.conversationId,"file.send"))&&!u&&!(d&&d.isLogicalOneOnOneSmsConversation())&&!y.isS4BBridgeMri(e.route.params.conversationId),s.onTopOfNavStack=re.default.isConversationOnTopOfNavStack(e.route.params.conversationId)||!0===e.route.params.isInConversationBubbleMode,s.deviceOrientation=de.default.getDeviceOrientation(r),s.isKeyboardShown=V.default.isKeyboardSeen()&&s.onTopOfNavStack,s.userColorBackgroundStyle=se.default.getPrimaryBackgroundColorStyle(),s.leavePaddingForStatusBar=l.StatusBar.isOverlay()&&s.deviceOrientation===o.DeviceOrientation.Portrait,s.statusBarHeight=he.default.statusBarHeight(),s.isConnectedToCall=p.default.CallingStore.hasConnectedCalls(),s.otherPartyMri=d&&d.isOneOnOne()?d.getOtherPartyMri():void 0,s.isSendImCapable=!d||M.default.isSendImCapable(d),s.isIncomingContactInvitePending=d&&b.default.isIncomingContactInvitePending(d.id)||!!e.route.params.inviteToken&&(!this.state||d&&!b.default.isConversationAccepted(d.id))&&s.otherPartyMri&&!b.default.isContact(s.otherPartyMri),s.localAddressBookContact=d&&d.isOneOnOne()?U.default.getContactByCorrespondingMri(e.route.params.conversationId):void 0,s.otherPartyMri&&(s.userProfile=we.default.getFullUserProfileByMri(s.otherPartyMri)),s.activeCallId=p.default.ActiveCallUIHelper.getActiveCallId(e.route.params.conversationId),s.activeCallStatus=s.onTopOfNavStack?p.default.ActiveCallUIHelper.activeCallStatus(e.route.params.conversationId):g.ActiveCallStatus.None,t&&(s.overflowMenuVisible=!1,s.shouldFlattenNavOnInteraction=e.route.params.shouldFlattenNavOnInteraction,s.headerHeightAndroid=0),s.isConversationBlocked=u,s.bottomSafeAreaInset=he.default.bottomSafeAreaInset(4),s.safeAreaHorizontalInsets=he.default.horizontalInsets(C.HorizontalInsetDefault),t?(Se.default.isSelectMessagesModeActive(r)&&Se.default.deactivateSelectMessagesMode(),s.isSelectMessagesModeActive=!1):s.isSelectMessagesModeActive=Se.default.isSelectMessagesModeActive(r),s.isSelectMessagesModeActive?s.currentSelectMessagesUIState=P.SelectMessagesUIState.Active:!t&&$.shouldCancelMessageSelection(i.route.params.contextConversationId,e.route.params.contextConversationId)?s.currentSelectMessagesUIState=P.SelectMessagesUIState.Deactive:s.currentSelectMessagesUIState=this.state?this.state.currentSelectMessagesUIState:P.SelectMessagesUIState.Deactive,s.hideHeader=n.hideHeaderInLandscape&&s.deviceOrientation===o.DeviceOrientation.Landscape&&s.isKeyboardShown&&!ve.default.isTablet(),s.canSeeGuestUpsell=!s.hideHeader&&m.default.identity().canSeeGuestUpsell,s.isMessageSearchPanelVisible=!!this._searchStore.getSearchQuery(),s.isTranslatedConversation=O.default.isConversationTranslated(e.route.params.conversationId),s}render(){let e,t;this.state.deviceOrientation!==o.DeviceOrientation.Landscape&&(this.state.mojiPreview?e=l.createElement(te.MojiPreview,{moji:this.state.mojiPreview,onClose:this._onMojiPreviewCloseButtonPressed,onSend:this._onMojiSend,sendButtonTitle:H.getString("Moji.SendButtonTitle"),showSendButton:!0}):this.state.gifPreview&&(e=l.createElement(F.default,{gif:this.state.gifPreview,onClose:this._onGifPreviewCloseButtonPressed,onSend:this._onGifSend,sendButtonTitle:H.getString("PesPicker.GifPreviewSendButtonAccessibility"),showSendButton:!0}))),this._openFindPanelScenario||(this._openFindPanelScenario=new Ce.default(Ce.ScenarioName.OpenFindPanel));const s=this._getChatTabContent(this.props.route.params.contextConversationId),i=this.state.overflowMenuVisible||!this.state.onTopOfNavStack?l.Types.ImportantForAccessibility.NoHideDescendants:void 0,{headerShadowColorStyle:n,primaryBackgroundColorStyle:r}=Te.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride);t=l.createElement(l.View,{style:Re.fillParent,importantForAccessibility:i},this._renderHeader(),this._renderMessageSearchPanel(),this._renderSelectedMessagesPanelHeader(),this._renderGuestUpsellBannerIfAvailable(),l.createElement(l.View,{style:Re.contentPanelLowerContents,onLayout:this._onChatTabLayout},s,l.createElement(l.View,{style:[Re.bottomViewWrapper,Re.bottomViewHeight],ignorePointerEvents:!0},l.createElement(l.View,{style:Re.tabBottomView,ignorePointerEvents:!0},l.createElement(l.View,{style:[Re.tabShadow,n]})))),this._renderMessageSearchNavigation(),this._renderSelectedMessagesPanelActions());const a=l.createElement(W.default,{ref:this._onMessageComposerOverflowRef,conversationId:this.props.route.params.conversationId,otherPartyMri:this.state.otherPartyMri,findPerfScenario:this._openFindPanelScenario}),d=this.state.toolTipInfo?l.createElement(R.default,{toolTipInfo:this.state.toolTipInfo,onDismiss:this._onDismissPopup}):void 0;return l.createElement(l.View,{style:[Re.container,r]},l.createElement(_.CoachMarkContext.Provider,{value:this._coachMarkContext},t,e,d,a,l.createElement(K.default,null)))}_renderMessageSearchPanel(){if(this._shouldRenderSearchComponents())return l.createElement(Q.MessageSearchPanelAnimatedWrapper,{conversationId:this.props.route.params.conversationId,onCancel:this._onCloseMessageSearchPanel,ref:this._onMessageSearchPanelRef,isMessageSearchPanelVisible:this.state.isMessageSearchPanelVisible,useMobileUI:!0,searchStore:this._searchStore})}_renderMessageSearchNavigation(){if(this._shouldRenderSearchComponents())return l.createElement(X.MobileSearchNavigationPanel,{useMobileUI:!0,searchStore:this._searchStore})}_shouldRenderSearchComponents(){return this.state.deviceOrientation===o.DeviceOrientation.Portrait}_getChatTabContent(e){const t=d.default.isMobile()?ke.WindowDimensionUtils.measureWindow(this._getRootViewId()).width-ye.default.getWidthNoSubscription():void 0;let s=l.createElement(G.default,{key:this._virtualStreamRefCount,ref:this._onMessagePanelRef,conversationId:this.props.route.params.conversationId,otherPartyMri:this.state.otherPartyMri,isNewConversation:this.props.route.params.isNewConversation,scrollToTimestamp:this.props.route.params.scrollToTimestamp,focusedMessageCuid:this.props.route.params.focusedMessageCuid,forceRefreshFocus:this.props.route.params.forceRefreshFocus,allowUploads:this.state.isFileUploadCapable,hasUnderlay:!!this.props.route.params.contextConversationId,hasConnectedCalls:this.state.isConnectedToCall,shouldAutoFocusInput:this.props.route.params.shouldAutoFocusInput,onMessageSent:this.state.shouldFlattenNavOnInteraction?this._onInteracted:void 0,onLaunchCamera:this._launchCamera,inviteToken:this.props.route.params.inviteToken,onShowOverflow:this._onShowOverflow,onShowGestureHint:this._onShowGestureHint,preventAccessibilityFocus:this._secondaryViewDisplayed(),showBottomDivider:!0,safeAreaHorizontalInsets:this.state.safeAreaHorizontalInsets,selectedNumberForSMS:this.props.route.params.selectedNumberForSMS,isSelectMessagesModeActive:this.state.isSelectMessagesModeActive,headerHeightAndroid:this.state.headerHeightAndroid,isFromSearch:this.props.route.params.isFromGlobalSearch,isFromPeopleRecommendations:this.props.route.params.isFromPeopleRecommendations,directShareEventData:this.props.route.params.directShareEventData,isMessageSearchPanelVisible:this.state.isMessageSearchPanelVisible,isTranslatedConversation:this.state.isTranslatedConversation,isInConversationBubbleMode:this.props.route.params.isInConversationBubbleMode,searchStore:this._searchStore,availableWidth:t});s=l.createElement(l.View,{style:Re.contentPanelLowerContents},s);const i=[Re.contentWrapper];this.state.bottomSafeAreaInset&&!this.state.isKeyboardShown&&i.push(ue.default.paddingBottomStyle(this.state.bottomSafeAreaInset));const o=l.createElement(l.View,{style:i},s);return e?o:l.createElement(l.View,{key:"conversation",style:Re.contentPanelContents},o)}_renderHeader(){return this.state.hideHeader?void 0:l.createElement(T.ContentPanelHeader,{conversationId:this.props.route.params.conversationId,otherPartyMri:this.state.otherPartyMri,contextConversationId:this.props.route.params.contextConversationId,activeCallId:this.state.activeCallId,hasActiveCall:!!this.state.activeCallId,activeCallStatus:this.state.activeCallStatus,safeAreaHorizontalInsets:this.state.safeAreaHorizontalInsets,onCallStartedAnsweredOrJoined:this._onCallStartedAnsweredOrJoinedViaContentPanelHeader,preventAccessibilityFocus:this._secondaryViewDisplayed()||this.state.isSelectMessagesModeActive||this.state.isMessageSearchPanelVisible,hideConversationSwitcher:this.state.isSelectMessagesModeActive||this.state.isMessageSearchPanelVisible,localAddressBookPhones:this.state.localAddressBookContact?this.state.localAddressBookContact.phones:void 0,onLayout:void 0,isInConversationBubbleMode:this.props.route.params.isInConversationBubbleMode})}_renderSelectedMessagesPanelHeader(){if(this.state.currentSelectMessagesUIState!==P.SelectMessagesUIState.Deactive)return l.createElement(me.default,{renderHeader:!0,conversationId:this.props.route.params.conversationId,mobileUi:!0,bottomPadding:this.state.bottomSafeAreaInset,panelAnimatedValue:this._innerMovingContainerSelectMessagesHeader,onClosePanel:this._onCloseSelectMessagesPanel})}_renderGuestUpsellBannerIfAvailable(){if(this.state.canSeeGuestUpsell)return l.createElement(x.default,null)}_renderSelectedMessagesPanelActions(){if(this.state.currentSelectMessagesUIState!==P.SelectMessagesUIState.Deactive)return l.createElement(me.default,{renderActions:!0,conversationId:this.props.route.params.conversationId,mobileUi:!0,bottomPadding:this.state.bottomSafeAreaInset,panelAnimatedValue:this._innerMovingContainerSelectMessagesActions,onClosePanel:this._onCloseSelectMessagesPanel})}_secondaryViewDisplayed(){return!!this.state.mojiPreview||!!this.state.gifPreview}}t.default=Le},72980:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(16778),o=s(58962),n=s(32687),r=s(76359),a=s(36061);t.default=e=>{const{searchType:t,conversationId:s}=e.route.params;if(t===o.TabType.Emoticon){const{onMessageSent:o,onCloseSearch:r,clearEditInChatsComposer:a}=e.route.params;return i.createElement(n.default,{searchType:t,conversationId:s,onMessageSent:o,onCloseSearch:r,clearEditInChatsComposer:a})}return t===o.TabType.Moji?i.createElement(r.default,{searchType:t,conversationId:s}):t===o.TabType.ChatSticker?i.createElement(a.default,{searchType:t,conversationId:s}):null}},5327:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(31844),o=s(58108),n=s(16778),r=s(74634),a=s(96486),l=s(89391),d=s(67930),c=s(71830),h=s(46992),u=s(52262),p=s(46096),g=s(81020),m=s(36237),S=s(10400),f=s(15877),y=s(33754),_=s(12056),v=s(4735),C=s(30124),b=s(28433),T=s(29130),M=s(51070),I=s(94622),w=s(10541),P=s(32514),k=s(55759),A=s(24067),E=s(90631),R=s(16392),L=s(12187),F=s(53374),x=s(97634),O=(0,f.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch"})}),D={[p.SearchType.ZeroInput]:[{groupType:p.SearchResultsListGroup.SuggestedFrequentConversations},{groupType:p.SearchResultsListGroup.CombinedContactsWithoutAddressBookOrAlphaHeaders}],[p.SearchType.ShortQuery]:[{groupType:p.SearchResultsListGroup.AllPeople},{groupType:p.SearchResultsListGroup.PublicDirectory}],[p.SearchType.LongQuery]:[{groupType:p.SearchResultsListGroup.AllPeople},{groupType:p.SearchResultsListGroup.PublicDirectory}]};class B extends d.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._onKeyDownEvent=new r.default,this._keyboardAnimatedHeightValue=new n.Animated.Value(0),this._keyboardAnimatedHeightStyle=n.Styles.createAnimatedViewStyle({height:this._keyboardAnimatedHeightValue}),this._hasUsedSearch=!1,this._onSearchResultsListRef=e=>{this._searchResultsListRef=e||void 0},this._onProfileRemoved=()=>{this._searchResultsListRef&&this._searchResultsListRef.focusFirst()},this._onInputChanged=e=>{this.isComponentMounted()&&(!1===this._hasUsedSearch&&e.length>0&&(this._hasUsedSearch=!0),this.setState({inputText:e}))},this._getHeader=()=>{let e;const t={closeButtonType:this.props.route.params.navigationDirection===R.StackNavigationDirection.Push?E.CloseButtonType.Back:E.CloseButtonType.Close,onPress:this._cancelShare,title:y.getString("ShareWithPanel.CloseButtonTitle")},s=this._getHeaderText(this.state),i=this.props.route.params.accessibilityLabelTitle||(0,a.trimEnd)(s,".");return e=n.createElement(E.SimplePanelHeader,{panelName:s,accessibleName:i,leftButton:t,allowTextWrap:!0}),n.createElement(n.View,null,e)},this._onSearchInputKeyDown=e=>{this._onKeyDownEvent.fire(e.keyCode)},this._onSelectableItemClick=(e,t)=>{const s=this._conversationSelectionController.getSelectedConversations(),i=u.default.getDisplayableProfile(t);(0,a.includes)(s,t)?(this._conversationSelectionController.removeConversation(t),n.Accessibility.announceForAccessibility(y.getString("ShareWithPanel.ShareTargetRemovedAnnouncement",{displayName:i.getDisplayName()}))):(this._conversationSelectionController.addConversation(t),n.Accessibility.announceForAccessibility(y.getString("ShareWithPanel.ShareTargetSelectedAnnouncement",{displayName:i.getDisplayName()})))},this._onSendButtonPress=()=>{if(this._sendButtonPressed)return;this._sendButtonPressed=!0;const e=F.default.newCauseId();m.log(p.LogTraceArea.Contacts,"ShareContactsToConversationPanel._onSendButtonPress,  causeId: "+e);const t=this._conversationSelectionController.getSelectedConversations();this._completeSharingProcess(t,e)},this._cancelShare=()=>{const e=F.default.newCauseId();m.log(p.LogTraceArea.Contacts,"ShareContactsToConversationPanel._cancelShare,  causeId: "+e),this._goBack(e)},this._headerHeight=()=>(this.state.deviceOrientation!==i.DeviceOrientation.Landscape?this.state.isSmallDevice?E.HeaderHeightSmall:E.HeaderHeight:this.state.isSmallDevice?E.HeaderHeightLandscapeSmall:E.HeaderHeightLandscape)+this.state.statusBarPadding}_buildState(e,t){const s=this._getRootViewId();let i={statusBarPadding:M.default.statusBarPadding(),deviceOrientation:T.default.getDeviceOrientation(s),isSmallDevice:T.default.isSmallDevice(s)};return t&&(this._conversationSelectionController=new h.default,i.inputText=""),i.isUsingStackNavigationContext=C.default.isUsingStackNavigationContext(),i.keyboardUpdateInfo=S.default.getUpdateInfo(),i.keyboardResizeMode=S.default.getResizeMode(),i.selectedMris=this._conversationSelectionController.getSelectedConversations(),i.canSubmit=this._conversationSelectionController.getSelectedConversations().length>0,i.headerConfig={getHeader:this._getHeader,getHeaderHeight:this._headerHeight,key:"header"},i}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this._searchController=new P.default}componentDidMount(){super.componentDidMount();const{defaultStatusBarTheme:e}=x.themeColors(this._getContext(),this.props.route.params.colorThemeOverride),t=L.default.mergeStyles([L.default.createHiddenStyle(!1),L.default.createBarStyle(e)]);this._updateStatusBarStyle(t)}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),this.state.keyboardUpdateInfo.height!==t.keyboardUpdateInfo.height&&this._keyboardAnimatedHeightValue.setValue(t.keyboardUpdateInfo.height)}componentWillUnmount(){super.componentWillUnmount(),this._searchController&&this._searchController.destroy();let e=0,t=0;this.state.selectedMris.forEach((s=>{c.isPhoneMri(s)?e++:t++})),m.track(new _.ShareContactsTelemetry(this.props.route.params.entryPoint,this.props.route.params.conversationId,e,t,this._hasUsedSearch))}render(){const e=this.state.keyboardResizeMode===o.KeyboardAwareResizeMode.None?n.createElement(n.Animated.View,{style:this._keyboardAnimatedHeightStyle}):void 0,{primaryBackgroundColorStyle:t}=x.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride);return n.createElement(n.View,{style:[O.container,t]},n.createElement(n.View,{style:O.container},n.createElement(b.default,{key:"peopleInput",searchController:this._searchController,headerConfig:this.state.headerConfig,onCancel:this._cancelShare,peopleType:w.PeopleType.AllExcludingBots,includeGroups:!0,autoFocusOnInput:!n.UserInterface.isNavigatingWithKeyboard(),autoFocusWhenActive:!0,selectorController:this._conversationSelectionController,useCollapsableHeader:!1,onKeyDown:this._onSearchInputKeyDown,inputText:this.state.inputText,onInputChanged:this._onInputChanged,colorThemeOverride:this.props.route.params.colorThemeOverride,onProfileRemoved:this._onProfileRemoved,noFixedHeight:!1}),n.createElement(I.SearchResultsList,{ref:this._onSearchResultsListRef,rawSearchQuery:this.state.inputText,origin:p.SearchResultsListOrigin.ContactsPanel,searchResultGroups:this._getSearchResultsGroup(),searchController:this._searchController,arePeopleSelectableForInvite:!0,onListItemClick:this._onSelectableItemClick,selectedMris:this.state.selectedMris,peopleType:w.PeopleType.AllExcludingBots,maxNumberOfSuggestedContacts:20,excludePstn:!1,excludeGroups:!0,userMrisToExclude:this.props.route.params.userMrisToExclude,keyDownEvent:this._onKeyDownEvent,colorThemeOverride:this.props.route.params.colorThemeOverride})),n.createElement(A.default,{button:this._getActionSendButton()}),e)}_componentId(){return"ShareContactsToConversationPanel"}_getActionSendButton(){return{onPress:this._onSendButtonPress,disabled:!this.state.canSubmit,text:y.getString("ShareWithPanel.SendButton"),accessibilityLabel:y.getString("ShareWithPanel.SendButton")}}_getSearchResultsGroup(){let e;e=D;let t=this.state.inputText.trim();return 0===t.length?e[p.SearchType.ZeroInput]:t.length<l.default.getConfigSettingsNoSubscription().search.longQueryCharCount?e[p.SearchType.ShortQuery]:e[p.SearchType.LongQuery]}_completeSharingProcess(e,t){m.log(p.LogTraceArea.Contacts,"ShareContactsToConversationPanel._completeSharingProcess,  causeId: "+t),e.forEach((e=>{const t={skypeId:c.stripMriNamespace(e),isPstn:c.isPhoneMri(e),isS4B:c.isS4BBridgeMri(e),fullName:u.default.getDisplayName(e)||"",userMri:e};k.forwardContact(t,this.props.route.params.conversationId,p.PostSource.MessageComposer)})),this.props.route.params.entryPoint&&this.props.route.params.entryPoint===g.ShareContactOrigin.Deeplink&&C.default.isUsingStackNavigationContext()?v.default.navigateToConversation({convId:this.props.route.params.conversationId,origin:p.NavigationConversationOrigin.SharedContactCard,causeId:t}):(this._goBack(t),this.props.route.params.onShareComplete&&this.props.route.params.onShareComplete())}_getHeaderText(e){return this.props.route.params.panelTitle}}t.default=B},37867:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96074),o=s(90574);t.default=(0,i.forNavigation)(o.default)},22389:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(31844),o=s(16778),n=s(96486),r=s(96074),a=s(90631),l=s(81511),d=s(17093),c=s(44949),h=s(98278),u=s(15877),p=s(46096),g=s(36237),m=s(33754),S=s(24148),f=s(97634),y=s(3056),_=s(97647),v=s(7044),C=s(4735),b=s(30124),T=s(29130),M=s(51070),I=s(80837),w=s(53374),P=(0,u.lazyProperties)({galleryPanel:()=>o.Styles.combine(o.Styles.createViewStyle({alignItems:"stretch"}),I.default.flexOne)});class k extends r.BaseNavigationView{constructor(){super(...arguments),this._onTabSelected=e=>{g.track(new l.GalleryFilterSwitchedEvent(this.props.route.params.conversationId,this.state.viewMode,e)),this.isComponentMounted()&&this.state.viewMode!==e&&this.setState({viewMode:e}),g.track(new S.NavigationTab(d.GalleryViewMode[e])),this._telemetryScenario.markChangedViewMode(e)},this._onClose=()=>{const e=w.default.newCauseId();g.log(p.LogTraceArea.Navigation,"StackGalleryPanel._onClose,  causeId: "+e),C.default.closeGalleryPanel(e,this._getContext())},this._goBack=e=>(g.log(p.LogTraceArea.Navigation,"StackGalleryPanel._goBack,  causeId: "+e),(0,n.defer)((()=>{this._onClose()})),!0)}_buildState(e,t){const s=b.default.isUsingStackNavigationContext(),n=this._getRootViewId(),r=o.StatusBar.isOverlay()&&(T.default.getDeviceOrientation(n)===i.DeviceOrientation.Portrait||this._isPresentedInTabletLeftNav());return{isUsingStackNavigationContext:s,viewMode:t||!s?e.route.params.viewMode:this.state.viewMode,safeAreaHorizontalInsets:M.default.horizontalInsets(h.HorizontalInsetDefault),leavePaddingForStatusBar:r}}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this._telemetryScenario=c.GalleryTelemetryScenario.getInstance(!0),g.track(new l.GalleryOpenedEvent(this.props.route.params.conversationId))}componentWillUnmount(){super.componentWillUnmount(),this._telemetryScenario.markStep(c.GalleryScenarioStep.GalleryClosed),c.GalleryTelemetryScenario.destroyInstance()}render(){const{primaryBackgroundColorStyle:e}=f.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride);return o.createElement(y.default,{goBack:this._goBack},o.createElement(o.View,{style:[P.galleryPanel,e]},o.createElement(a.SimplePanelHeader,{panelName:m.getString("GalleryPanel.DesktopPanelTitle"),leavePaddingForStatusBar:this.state.leavePaddingForStatusBar,leftButton:{closeButtonType:a.CloseButtonType.Close,onPress:this._onClose}}),this._renderPanelContent()))}_renderPanelContent(){let e;if(this.props.route.params.viewMode===d.GalleryViewMode.None)return;switch(this.state.viewMode){case d.GalleryViewMode.Media:e=o.createElement(v.default,{conversationId:this.props.route.params.conversationId,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,viewMode:this.state.viewMode,displayTabBar:this.state.isUsingStackNavigationContext,safeAreaHorizontalInsets:this.state.safeAreaHorizontalInsets,onTabSelected:this._onTabSelected});break;case d.GalleryViewMode.Files:case d.GalleryViewMode.Links:e=o.createElement(_.default,{conversationId:this.props.route.params.conversationId,viewMode:this.state.viewMode,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,displayTabBar:this.state.isUsingStackNavigationContext,safeAreaHorizontalInsets:this.state.safeAreaHorizontalInsets,onTabSelected:this._onTabSelected})}const t=[I.default.flexOne];return this.state.isUsingStackNavigationContext||t.push(I.default.overflowVisible),o.createElement(o.View,{style:t},e)}_componentId(){return"StackGalleryPanel"}}t.default=k},47709:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StackGalleryNavigation=t.ShareWithNavigation=t.ShareContactsToConversationNavigation=t.PesSearchNavigation=t.MobileContentPanel=t.MediaViewerNavigation=t.MediaPickerNavigation=t.LocationViewerNavigation=t.LocationPickerNavigation=t.LoadingNavigation=t.DocumentViewerNavigation=t.CustomReactionsNavigation=t.ConversationParticipantsNavigation=t.ConversationMediaViewerNavigation=t.CreateConversationNavigation=t.CapturePreviewNavigation=t.CaptureMultiplePreviewNavigation=t.CaptureComboViewNavigation=t.ArchivedConversationsNavigation=void 0;var i=s(88110);Object.defineProperty(t,"ArchivedConversationsNavigation",{enumerable:!0,get:function(){return i.default}});var o=s(92076);Object.defineProperty(t,"CaptureComboViewNavigation",{enumerable:!0,get:function(){return o.default}});var n=s(87962);Object.defineProperty(t,"CaptureMultiplePreviewNavigation",{enumerable:!0,get:function(){return n.default}});var r=s(34635);Object.defineProperty(t,"CapturePreviewNavigation",{enumerable:!0,get:function(){return r.default}});var a=s(86766);Object.defineProperty(t,"CreateConversationNavigation",{enumerable:!0,get:function(){return a.default}});var l=s(34037);Object.defineProperty(t,"ConversationMediaViewerNavigation",{enumerable:!0,get:function(){return l.default}});var d=s(60180);Object.defineProperty(t,"ConversationParticipantsNavigation",{enumerable:!0,get:function(){return d.default}});var c=s(58454);Object.defineProperty(t,"CustomReactionsNavigation",{enumerable:!0,get:function(){return c.default}});var h=s(67337);Object.defineProperty(t,"DocumentViewerNavigation",{enumerable:!0,get:function(){return h.default}});var u=s(235);Object.defineProperty(t,"LoadingNavigation",{enumerable:!0,get:function(){return u.default}});var p=s(50517);Object.defineProperty(t,"LocationPickerNavigation",{enumerable:!0,get:function(){return p.default}});var g=s(90474);Object.defineProperty(t,"LocationViewerNavigation",{enumerable:!0,get:function(){return g.default}});var m=s(35276);Object.defineProperty(t,"MediaPickerNavigation",{enumerable:!0,get:function(){return m.default}});var S=s(88755);Object.defineProperty(t,"MediaViewerNavigation",{enumerable:!0,get:function(){return S.default}});var f=s(54399);Object.defineProperty(t,"MobileContentPanel",{enumerable:!0,get:function(){return f.default}});var y=s(72980);Object.defineProperty(t,"PesSearchNavigation",{enumerable:!0,get:function(){return y.default}});var _=s(5327);Object.defineProperty(t,"ShareContactsToConversationNavigation",{enumerable:!0,get:function(){return _.default}});var v=s(37867);Object.defineProperty(t,"ShareWithNavigation",{enumerable:!0,get:function(){return v.default}});var C=s(22389);Object.defineProperty(t,"StackGalleryNavigation",{enumerable:!0,get:function(){return C.default}})},17135:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ASMClient=void 0;const i=s(62783),o=s(77523),n=s(46096),r=s(36237),a=s(14976),l=s(13159),d=s(40363),c=s(94214),h=s(53374),u="Authorization",p="skype_token ";class g extends l.SkypeRestClient{constructor(e,t,s){super(t),this._defaultOptions.mustHaveValidSkypeToken=!0,s&&(this._defaultOptions.timeout=s),this._defaultOptions.customErrorHandler=(t,s)=>{const l=s?s.statusCode:-1,d=t.getRequestHeaders(),c=t.getOptions(),h=g.getTracingHeaders(d);return r.warn(n.LogTraceArea.AsyncMediaClient,"Failed to perform request to "+e+" url:"+a.dev_unknownOmit(s.url)+" status code "+l+" RequestId:"+h.requestId+" CorrelationId:"+h.correlationId+" TransactionId:"+h.transactionId),r.track(new o.ASMClientFailure(e,l,c.scenario,h)),(0,i.DefaultErrorHandler)(t,s)}}performRequest(e,t){return t.correlationId||(t.correlationId=h.default.newGuid()),super.performRequest(e,t)}_getHeaders(e){const t={"X-Client-Version":d.default.getClientVersionAndPlatform()+"//"};return t.CorrelationId=e.correlationId,t.RequestId=h.default.newGuid(),e.transactionId&&(t.TransactionId=e.transactionId),c.default.hasUsableSkypeToken()&&(t[u]=p+c.default.getRawSkypeToken()),t}_getSkypeTokenFromHeader(e){const t=e[u];if(!t)return;const s=t.indexOf(p);if(-1===s)return;return t.substr(s+p.length)}checkAuthFailure(e,t,s=!0){if(401===e){const e=t&&this._getSkypeTokenFromHeader(t);if(e)return s&&(r.warn(n.LogTraceArea.AsyncMediaClient,"Our skype token is dead. Nuking and waiting for it to refresh."),c.default.skypeTokenInvalid(e)),!0}return!1}static getTracingHeaders(e){return{requestId:e.RequestId,correlationId:e.CorrelationId,transactionId:e.TransactionId}}}t.ASMClient=g},20603:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(97691),n=s(89391),r=s(17135),a=s(65976),l=s(78262),d=s(26712),c=s(53374);class h extends r.ASMClient{constructor(){super("AsyncMediaClient","");const e=n.default.getAsyncMediaFeatures();this._amsSkypeTokenAuthUrl=i.replace(e.ams_skypetokenauth_url_format,"{0}",e.ams_base_url)}_getHeaders(e){const t=super._getHeaders(e);return e.rangeOffset&&e.rangeOffset>0&&(t.Range=`bytes=${e.rangeOffset}-`),t}setAuthCookie(e){return this.performRequest({method:"POST",path:this._amsSkypeTokenAuthUrl,passedData:"skypetoken="+e.rawToken},{withCredentials:!0,retries:5,scenario:"setAuthCookie"})}createDocumentAsync(e,t,s,i,o,n,r){const l=this._createCreateDocumentRequest(e,t,s,i),d={scenario:"createDocument",transactionId:o,correlationId:n,timeout:r};return this.performRequest({method:"POST",path:a.getCreateDocumentUrl(),passedData:l},d)}createDocumentGetIdAsync(e,t,s,i,n,r,a){return this.createDocumentAsync(e,t,s,i,n,r,a).then((e=>e.body&&e.body.id?e.body.id:o.Rejected("No Document ID provided")))}createDocumentBackground(e,t,s,i,o,n,r){const l=this._createCreateDocumentRequest(s,i,o,n);return this._performApiCallBackground({backgroundType:e,backgroundContext:t,apiPath:a.getCreateDocumentUrl(),action:"POST",postData:l,requestOptions:r})}_createCreateDocumentRequest(e,t,s,o){let r,a=!0;const d=n.default.getS4LCMCFeatures();switch(s){case l.UploadFileType.Picture:r="pish/image";break;case l.UploadFileType.Video:r=d.serverVideoTranscoding.enabled?d.desktopVIMAMSDocumentType:"sharing/video";break;case l.UploadFileType.VideoMessage:r=d.desktopVIMAMSDocumentType;break;case l.UploadFileType.Audio:case l.UploadFileType.AudioMessage:a=!1,r="sharing/audio";break;case l.UploadFileType.GroupAvatar:r="avatar/group";break;default:a=!1,r="sharing/file"}let c={};i.each(e,(e=>{c[e]=s===l.UploadFileType.GroupAvatar?["read","delete"]:["read"]}));let h={permissions:c,type:r,filename:t};return a&&o&&(h.expiry_date=o.toISOString()),h}uploadDocumentAsync(e,t,s,i,o,n){const r={onProgress:i,contentType:"application",scenario:"uploadDocument",transactionId:o,correlationId:n};return this.performRequest({method:"PUT",path:a.getUploadUrl(e,t),passedData:s},r)}uploadDocumentBackground(e,t,s,i,o,n){return this._performApiCallBackground({backgroundType:e,backgroundContext:t,apiPath:a.getUploadUrl(s,i),action:"PUT",postData:o,requestOptions:Object.assign(Object.assign({},n),{contentType:"application"})})}forwardDocumentAsync(e,t,s){let o={permissions:{}};i.each(s,(e=>{o.permissions[e]=["read"]}));const n=c.default.newGuid();return this.getStatusAsync(e,t,n).then((t=>{const s=d.default.getURIComponents(t.view_location),i=s.protocol+"://"+s.host+"/v1/objects/"+e+"/forward";return this.performRequest({method:"POST",path:i,passedData:o},{excludeEndpointUrl:!0,transactionId:n,scenario:"forwardDocument"}).then((e=>e.body.id))}))}forwardMediaBackground(e,t,s,o,n,r){const a=d.default.getURIComponents(s),l=a.protocol+"://"+a.host+"/v1/objects/"+n+"/forward";let c={permissions:{}};return i.each(o,(e=>{c.permissions[e]=["read"]})),this._performApiCallBackground({backgroundType:e,backgroundContext:t,apiPath:l,action:"POST",postData:c,requestOptions:r})}deleteAsync(e){return this.performRequest({method:"DELETE",path:a.getDocumentUrl(e)},{scenario:"delete"}).then(i.noop)}downloadBackground(e,t,s,o,n=!1,r=!1,a=0,l){const d=i.defaults({rangeOffset:a,acceptType:"blob",excludeEndpointUrl:!0,scenario:"download"},l);return this._performApiCallBackground({backgroundType:e,backgroundContext:t,apiPath:s,action:"GET",downloadGetToUri:!0,downloadToPublicFolder:n,downloadPublicFolderUseSkypeFolder:r,filename:o,requestOptions:d})}getStatusAsync(e,t,s){const i={scenario:"getStatus",transactionId:s};return this.performRequest({method:"GET",path:a.getDownloadStatusUrl(e,t)},i).then((e=>e.body&&!e.body.view_state&&d.default.isUrlValid(e.body.status_location)?this.performRequest({method:"GET",path:e.body.status_location},i).then((e=>e.body)):e.body))}getStatusBackground(e,t,s,i,o){return this._performApiCallBackground({backgroundType:e,backgroundContext:t,apiPath:a.getDownloadStatusUrl(s,i),action:"GET",requestOptions:o})}getUploadStatusAsync(e,t,s){const i={scenario:"getUploadStatus",transactionId:s};return this.performRequest({method:"GET",path:a.getUploadStatusUrl(e,t)},i).then((e=>e.body))}}t.default=new h},34581:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(96486),o=s(97691),n=s(89391),r=s(46096),a=s(36237),l=s(78735),d=s(13159),c=s(94214),h=s(26712);class u extends d.SkypeRestClient{constructor(){super(u._getAPIURL())}isValidURL(e){let t=[n.default.getConfigSettingsNoSubscription().azureMediaServices.apiUrl,"https://api.azms.skypeassets.net/api/"];const s=h.default.getURIComponents(e);return!(!s||"https"!==s.protocol)&&i.some(t,(e=>{const t=h.default.getURIComponents(e);if(!t||"https"!==t.protocol)return!1;let i=t.protocol===s.protocol;return i=i&&h.default.areHostsSame(t,s),i}))}static _getAPIURL(e){let t=n.default.getConfigSettingsNoSubscription().azureMediaServices.apiUrl;return e||(e=l.default.getUserPreferencesLocal().azmsEnvironment),void 0!==e&&"test"===e&&(t="https://api.azms.skypeassets.net/api/"),a.log(r.LogTraceArea.Video,"AzMS API: "+t),t}setEnvironment(e){this._endpointUrl=u._getAPIURL(e)}getAuthToken(){return c.default.performWhenValidSkypeTokenArrives().then((()=>c.default.getRawSkypeToken()))}getVideoUrl(e){return this._endpointUrl+"video/"+e}uploadDocumentAsync(e){return this._performApiCall("video","POST",e,{contentType:"application/octet-stream"}).then((e=>(a.log(r.LogTraceArea.Video,"AzMS uploadDocumentAsync statusCode="+e.statusCode),200===e.statusCode?e.body:o.Rejected())),(e=>(a.log(r.LogTraceArea.Video,"AzMS uploadDocumentAsync statusCode="+e.statusCode),o.Rejected())))}uploadDocumentBackground(e,t,s,i){return this._performApiCallBackground({backgroundType:e,backgroundContext:t,apiPath:"video",action:"POST",postData:s,requestOptions:Object.assign(Object.assign({},i),{contentType:"application/octet-stream"})})}_getHeaders(e){let t=super._getHeaders(e);return t["X-Skypetoken"]=c.default.getRawSkypeToken(),t}}t.default=new u},66501:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(46096),o=s(36237),n=s(13159),r=s(94214);class a extends n.SkypeRestClient{constructor(){super(""),this._defaultOptions.mustHaveValidSkypeToken=!0}_getHeaders(e){let t=super._getHeaders(e);return t.DataType="json",t}getMojiMetadata(e){return r.default.usingCdnCookie()?this.performApiGetDetailed(e,{withCredentials:!0}).then((e=>e.body),(t=>this._getMojiMetadataWithoutCookie(e).then((e=>(o.log(i.LogTraceArea.GenericUnsafe,"Error with PES CDN cookie, but retry without it succeeded. Previous error: ",t),e))))):this._getMojiMetadataWithoutCookie(e)}getStickerMetadata(e){return r.default.usingCdnCookie()?this.performApiGetDetailed(e,{withCredentials:!0}).then((e=>e.body),(t=>this._getStickerMetadataWithoutCookie(e).then((e=>(o.warn(i.LogTraceArea.GenericUnsafe,"Error with PES CDN cookie, but retry without it succeeded. Previous error: ",t),e))))):this._getStickerMetadataWithoutCookie(e)}getEmoticonMetadata(e){return this.performApiGetDetailed(e).then((e=>e.body))}_getMojiMetadataWithoutCookie(e){return r.default.performWhenCdnTokenArrives().then((()=>{const t=e+"?"+r.default.getCdnToken();return this.performApiGet(t)}))}_getStickerMetadataWithoutCookie(e){const t=e+"?"+r.default.getCdnToken();return this.performApiGet(t)}getPesConfig(e,t){let s={};return t&&(s.eTag=t),this.performApiGetDetailed(e,s).then((e=>({eTagMatched:304===e.statusCode,response:e.body,eTag:e.headers.etag})))}}let l=new a;t.default=l},22543:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TestSMSClient=t.FailureReason=void 0;const i=s(96486),o=s(62783),n=s(97691),r=s(71657),a=s(89391),l=s(46096),d=s(17379),c=s(36237),h=s(14976),u=s(13159),p=s(15301),g=s(94214),m=s(40363),S=s(71657),f=s(95358);!function(e){e.InsufficientFunds="InsufficientFunds",e.Other="Other"}(t.FailureReason||(t.FailureReason={}));const y=()=>!1;class _ extends u.SkypeRestClient{constructor(){super(a.default.getConfigSettingsNoSubscription().sms.host),this._throttled=y,this._customErrorHandler=(e,t)=>(c.log(l.LogTraceArea.SMSClient,`Server returned ${t.statusCode}: ${h.dev_unknownOmit(JSON.stringify(t.body))}`),400===t.statusCode||401===t.statusCode||403===t.statusCode||404===t.statusCode?o.ErrorHandlingType.DoNotRetry:o.ErrorHandlingType.RetryCountedWithBackoff),this._defaultOptions.mustHaveValidSkypeToken=!0,this._defaultOptions.customErrorHandler=this._customErrorHandler,this._defaultOptions.retries=3}_performApiCall(e,t,s,i){return super._performApiCall(e,t,s,i).finally((e=>{if(i&&i.telemetryEvent){let s="NO_RESPONSE";e&&(s=e.statusCode?e.statusCode.toString():"NO_STATUS_CODE");const o={method:t?t.toString():"",acceptType:i.acceptType||"",endpointUrl:a.default.getConfigSettingsNoSubscription().sms.host,statusCode:s,stratusStatusCode:"NO_STRATUS_STATUS_CODE"};i.telemetryEvent.stopTimer().addAttributes(o),c.track(i.telemetryEvent)}return e}))}_blockRequestUntil(e){const t=super._blockRequestUntil(e),s=n.Defer();return this._throttled()?d.default.queueIdleTask("SMSClient",d.TaskTypeFlags.UsesNetworking,(()=>{s.resolve(void 0)}),d.Priority.Normal):s.resolve(void 0),n.all([t,s.promise()]).then(i.noop)}_getHeaders(e){let t=super._getHeaders(e);return t["X-Skypetoken"]=g.default.getRawSkypeToken(),t}getPrice(e,t){return this._setGateway(),c.log(l.LogTraceArea.SMSClient,"Calling SMS Rates API"),this._getPrice(e,t)}_getPrice(e,t){const s=encodeURIComponent(t),i=a.default.getConfigSettingsNoSubscription().sms.organizationId,o=p.default.getFlowId(),n=encodeURIComponent(f.removeLeadingPlus(e)),l=`users/${s}/sms-rates?platform=${m.default.getSkypePlatformId()}&number=${n}&organizationId=${i}&flowId=${o}`;let d={acceptType:"application/json; ver=1.0",telemetryEvent:new r.CommerceStratusRequest(S.StratusApiTelemetry.GetSMSRates)};return this.performApiGet(l,d)}_setGateway(){this._endpointUrl=a.default.getConfigSettingsNoSubscription().sms.host}setThrottled(e){this._throttled=e}}t.TestSMSClient=_,t.default=new _},9212:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContentQueryType=void 0;const i=s(96486),o=s(17003),n=s(62783),r=s(97691),a=s(89391),l=s(71830),d=s(39549),c=s(46096),h=s(97811),u=s(36237),p=s(18078),g=s(13159),m=s(4057),S=s(94214),f=s(53374);var y;!function(e){e[e.Media=0]="Media",e[e.Files=1]="Files",e[e.LinksAndSwiftCards=2]="LinksAndSwiftCards",e[e.ScheduledCallInvites=3]="ScheduledCallInvites"}(y=t.ContentQueryType||(t.ContentQueryType={}));const _=e=>(0,o.replaceNotMatching)(o.Patterns.MATCH_LETTER," ",e),v=e=>({Content:e});class C extends g.SkypeRestClient{constructor(){super(a.default.getConfigSettingsNoSubscription().messageSearch.host),this._customErrorHandler=(e,t)=>(0,n.DefaultErrorHandler)(e,t),this._defaultOptions.mustHaveValidSkypeToken=!0,this._defaultOptions.customErrorHandler=this._customErrorHandler}_getHeaders(e){let t=super._getHeaders(e);t["Cache-Control"]="no-cache",t["X-Skypetoken"]=S.default.getRawSkypeToken();let s=f.default.newGuid().replace(new RegExp("-","g"),"");return t["x-ms-correlation-id"]=s,t}_getQueryPostObject(e){return{OPTION:{RESULTBASE:e.offset||0,RESULTCOUNT:e.limit},QUERYSTRING:{}}}getSearchResults(e){const t=m.default.deburrLowerCase(e.query),s={OR:i.uniq([e.query,_(e.query),t,_(t)]).filter((e=>!!e&&!!e.trim())).map(v)},o=this._getQueryPostObject(e);return e.conversationId?l.isThread(e.conversationId)?o.QUERYSTRING={AND:[s,{ThreadId:e.conversationId}]}:o.QUERYSTRING={AND:[s,{OR:[{AND:[{From:e.conversationId},{To:p.default.getSkypeMri()}]},{AND:[{To:e.conversationId},{From:p.default.getSkypeMri()}]}]}]}:o.QUERYSTRING=s,this._post(o,"getSearchResults")}getZeroTermResults(e){const t=this._getQueryPostObject(e),s={OR:[{Annotation:{TYPE:"at",VALUE:{id:p.default.getSkypeMri()}}},{Annotation:{TYPE:"quote",VALUE:{author:p.default.getSkypeId()}}}]};return e.conversationId?t.QUERYSTRING={AND:[{ThreadId:e.conversationId},s]}:t.QUERYSTRING=s,this._post(t,"getZeroTermResults")}getScheduledCalls(){const e=a.default.getS4LCMCFeaturesNoSubscription().scheduledCallSearchBatchSize;return this._recursivelyGetBatchedScheduledCalls(0,e,[])}_recursivelyGetBatchedScheduledCalls(e,t,s){const o=this._generateScheduledCallQuery(e,t);return this._endpointUrl=a.default.getConfigSettingsNoSubscription().messageSearch.host,this.performApiPost("query",o).then((o=>{if(!o)return[];const n=this._filterScheduledCallResults(o);return s=i.concat(s,n),o.length<t?(u.log(c.LogTraceArea.ScheduleCall,`Retrieved a total of ${o.length} scheduled calls.`),s):(e+=t,this._recursivelyGetBatchedScheduledCalls(e,t,s))}))}_filterScheduledCallResults(e){return i.filter(e,(e=>"0"!==e.ClientMessageId))}_generateScheduledCallQuery(e,t){return{OPTION:{RESULTBASE:e,RESULTCOUNT:t},QUERYSTRING:{AND:[{ContentType:"ScheduledCallInvite"}]}}}getLinksAndCardsForConversation(e,t){const s=this._formulateContentQuery(e,y.LinksAndSwiftCards,t);return this._endpointUrl=a.default.getConfigSettingsNoSubscription().messageSearch.host,this.performApiPost("query",s)}getFilesForConversation(e,t,s=""){const i=this._formulateContentQuery(e,y.Files,t,s);return this._endpointUrl=a.default.getConfigSettingsNoSubscription().messageSearch.host,this.performApiPost("query",i)}getMediaForConversation(e,t){const s=this._formulateContentQuery(e,y.Media,t);return this._endpointUrl=a.default.getConfigSettingsNoSubscription().messageSearch.host,this.performApiPost("query",s)}_post(e,t){return this._endpointUrl=a.default.getConfigSettingsNoSubscription().messageSearch.host,this.performApiPostDetailed("query",e).then((e=>200===e.statusCode&&e.body?e.body:(e.body||u.track(new h.FundamentalsDebugEmptyBodyEvent("SkypeMessageSearch",t,e.requestHeaders["x-ms-correlation-id"],e.statusCode,e.statusText)),r.Rejected(e))))}_formulateContentQuery(e,t,s,o="",n=20){let r;i.isEmpty(o)||(r={Content:o});const a=(0,d.default)().getConversation(e);let l=e;if(a&&a.isOneOnOne()&&!a.isThread()){const t=p.default.getSkypeMri();l=t<e?t+":"+e:e+":"+t}const c=[{ThreadId:l}];switch(t){case y.Media:c.push({OR:[{ContentType:"image"},{ContentType:"video"}]});break;case y.Files:c.push({Annotation:{TYPE:"URIObject",VALUE:{type:"File.1"}}});break;case y.LinksAndSwiftCards:c.push({OR:[{Annotation:{TYPE:"URIObject",VALUE:{type:"SWIFT.1"}}},{Annotation:{TYPE:"a",VALUE:{domain:"*"}}}]});break;case y.ScheduledCallInvites:c.push({ContentType:"ScheduledCallInvite"})}return r&&c.push(r),{OPTION:{RESULTBASE:s,RESULTCOUNT:n},QUERYSTRING:{AND:c}}}}t.default=new C},9426:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(74958),o=s(89391),n=s(17135),r=s(46096),a=s(36237),l=s(26712);class d extends n.ASMClient{constructor(){const e=o.default.getConfigSettingsNoSubscription().urlPreview;super("UrlPreviewClient",e.host,e.timeout)}getUrlInfoAsync(e){a.log(r.LogTraceArea.UrlPreviewClient,"Getting URL information: "+i.pii.Omit(e));return this._endpointUrl=o.default.getConfigSettingsNoSubscription().urlPreview.host,this.performRequest({method:"GET",path:"url/info?url="+encodeURIComponent(l.default.getIDNSafeUrl(e))},{retries:3,scenario:"getUrlInfo"}).then((e=>e.body))}getUrlInfoBackground(e,t,s,i){return this._endpointUrl=o.default.getConfigSettingsNoSubscription().urlPreview.host,this._performApiCallBackground({backgroundType:e,backgroundContext:t,apiPath:"url/info?url="+encodeURIComponent(l.default.getIDNSafeUrl(s)),action:"GET",requestOptions:i})}getContentUrl(e){return o.default.getConfigSettingsNoSubscription().urlPreview.host+"url/content?url="+encodeURIComponent(e)}}t.default=new d}}]);